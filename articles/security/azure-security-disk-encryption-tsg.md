---
title: "aaaAzure solução de problemas de criptografia de disco | Microsoft Docs"
description: "Este artigo fornece dicas de solução de problemas para o Microsoft Azure Disk Encryption para VMs de IaaS do Windows e Linux."
services: security
documentationcenter: na
author: deventiwari
manager: avibm
editor: yuridio
ms.assetid: ce0e23bd-07eb-43af-a56c-aa1a73bdb747
ms.service: security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/27/2017
ms.author: devtiw
ms.openlocfilehash: 2ecb8df1fb869e3bf8f3be4be4494e6485e75695
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="azure-disk-encryption-troubleshooting-guide"></a><span data-ttu-id="9e856-103">Guia de resolução de problemas do Azure Disk Encryption</span><span class="sxs-lookup"><span data-stu-id="9e856-103">Azure Disk Encryption Troubleshooting Guide</span></span>

<span data-ttu-id="9e856-104">Este guia é para profissionais de TI (tecnologia) de informações, informações de analistas de segurança, e os administradores de nuvem cujas organizações estão usando a criptografia de disco do Azure e precisam de criptografia de disco orientação tootroubleshoot relacionados a problemas.</span><span class="sxs-lookup"><span data-stu-id="9e856-104">This guide is for information technology (IT) professionals, information security analysts, and cloud administrators whose organizations are using Azure disk encryption and need guidance tootroubleshoot disk-encryption related issues.</span></span>

## <a name="troubleshooting-linux-os-disk-encryption"></a><span data-ttu-id="9e856-105">Solução de problemas de criptografia de disco do SO Linux</span><span class="sxs-lookup"><span data-stu-id="9e856-105">Troubleshooting Linux OS disk encryption</span></span>

<span data-ttu-id="9e856-106">Criptografia de disco do sistema operacional Linux deve desmontar Olá SO unidade anterior toorunning-lo por meio do processo de criptografia de disco cheio hello.</span><span class="sxs-lookup"><span data-stu-id="9e856-106">Linux OS disk encryption must unmount hello OS drive prior toorunning it through hello full disk encryption process.</span></span>   <span data-ttu-id="9e856-107">Caso contrário, uma mensagem de erro "Falha toounmount após..."</span><span class="sxs-lookup"><span data-stu-id="9e856-107">If it cannot, an error message of "failed toounmount after…"</span></span> <span data-ttu-id="9e856-108">mensagem de erro é provavelmente toooccur.</span><span class="sxs-lookup"><span data-stu-id="9e856-108">error message is likely toooccur.</span></span>

<span data-ttu-id="9e856-109">Isso é muito provável quando a criptografia de disco do SO for tentada em um ambiente de VM de destino modificado ou alterado a partir da imagem da galeria de estoque com suporte.</span><span class="sxs-lookup"><span data-stu-id="9e856-109">This is most likely when OS disk encryption is attempted on a target VM environment that has been modified or changed from its supported stock gallery image.</span></span>  <span data-ttu-id="9e856-110">Exemplos de desvios da imagem de saudação com suporte, que pode interferir na unidade de saudação SO da extensão Olá capacidade toounmount incluem:</span><span class="sxs-lookup"><span data-stu-id="9e856-110">Examples of deviations from hello supported image, which can interfere with hello extension’s ability toounmount hello OS drive include:</span></span>
- <span data-ttu-id="9e856-111">Imagens personalizadas que não correspondem mais a um sistema de arquivos com suporte e/ou esquema de particionamento.</span><span class="sxs-lookup"><span data-stu-id="9e856-111">Customized images that no longer match a supported file system and/or partitioning scheme.</span></span>
- <span data-ttu-id="9e856-112">Imagens personalizadas com aplicativos como antivírus, Docker, SAP, MongoDB ou Apache Cassandra em execução no tooencryption anterior do sistema operacional hello.</span><span class="sxs-lookup"><span data-stu-id="9e856-112">Customized images with applications such as antivirus, Docker, SAP, MongoDB, or Apache Cassandra running in hello OS prior tooencryption.</span></span>  <span data-ttu-id="9e856-113">Esses aplicativos são difíceis tooterminate e quando eles mantêm a unidade de toohello OS de identificadores de arquivos abertos, unidade de saudação não pode ser desmontada, causando a falha.</span><span class="sxs-lookup"><span data-stu-id="9e856-113">These applications are difficult tooterminate, and when they retain open file handles toohello OS drive, hello drive cannot be unmounted, causing failure.</span></span>
- <span data-ttu-id="9e856-114">Os scripts personalizados que são executados em Fechar etapa de criptografia toohello proximidade pode interferir e causar a falha de tempo.</span><span class="sxs-lookup"><span data-stu-id="9e856-114">Custom scripts that run in close time proximity toohello encryption step can interfere and cause this failure.</span></span> <span data-ttu-id="9e856-115">Isso pode acontecer quando um modelo do Gerenciador de recursos define tooexecute de várias extensões ao mesmo tempo, ou quando uma extensão de script personalizado ou outra ação é executar simultaneamente toodisk criptografia.</span><span class="sxs-lookup"><span data-stu-id="9e856-115">This can happen when a Resource Manager template defines multiple extensions tooexecute simultaneously, or when a custom script extension or other action is run simultaneously toodisk encryption.</span></span>   <span data-ttu-id="9e856-116">Serialização e isolando essas etapas podem resolver o problema de saudação.</span><span class="sxs-lookup"><span data-stu-id="9e856-116">Serializing and isolating such steps may resolve hello issue.</span></span>
- <span data-ttu-id="9e856-117">Quando SELinux não tiver sido desabilitado tooenabling anterior criptografia, Olá desmontar a etapa falhar.</span><span class="sxs-lookup"><span data-stu-id="9e856-117">When SELinux has not been disabled prior tooenabling encryption, hello unmount step fails.</span></span>  <span data-ttu-id="9e856-118">O SELinux pode ser novamente habilitado após a conclusão da criptografia.</span><span class="sxs-lookup"><span data-stu-id="9e856-118">SELinux can be re-enabled after encryption has completed.</span></span>
- <span data-ttu-id="9e856-119">Quando o disco Olá SO está usando um esquema de LVM (embora suporte limitado de disco de dados LVM estiver disponível, o disco de SO LVM não é)</span><span class="sxs-lookup"><span data-stu-id="9e856-119">When hello OS disk is using an LVM scheme (although limited LVM data disk support is available, LVM OS disk is not)</span></span>
- <span data-ttu-id="9e856-120">Quando os requisitos mínimos de memória não são atendidos (7 GB é sugerido para criptografia de disco do SO)</span><span class="sxs-lookup"><span data-stu-id="9e856-120">When minimum memory requirements are not met (7GB is suggested for OS disk encryption)</span></span>
- <span data-ttu-id="9e856-121">Quando as unidades de dados foram montadas recursivamente no diretório /mnt/ ou outro (por exemplo, /mnt/data1, /mnt/data2, /data3 + /data3/data4, etc.)</span><span class="sxs-lookup"><span data-stu-id="9e856-121">When data drives have been recursively mounted under /mnt/ directory, or each other (for example, /mnt/data1, /mnt/data2, /data3 + /data3/data4, etc.)</span></span>
- <span data-ttu-id="9e856-122">Quando outros [pré-requisitos](https://docs.microsoft.com/en-us/azure/security/azure-security-disk-encryption) do Azure Disk Encryption para Linux não forem atendidos</span><span class="sxs-lookup"><span data-stu-id="9e856-122">When other Azure Disk Encryption [prerequisites](https://docs.microsoft.com/en-us/azure/security/azure-security-disk-encryption) for Linux are not met</span></span>

## <a name="unable-tooencrypt"></a><span data-ttu-id="9e856-123">Não é possível tooencrypt</span><span class="sxs-lookup"><span data-stu-id="9e856-123">Unable tooencrypt</span></span>

<span data-ttu-id="9e856-124">Em alguns casos, a criptografia de disco Linux Olá aparece toobe preso em "Criptografia de disco SO iniciada" e SSH está desabilitada.</span><span class="sxs-lookup"><span data-stu-id="9e856-124">In some cases, hello Linux disk encryption appears toobe stuck at "OS disk encryption started" and SSH is disabled.</span></span> <span data-ttu-id="9e856-125">Esse processo pode levar entre toocomplete 3-16 horas em uma imagem da Galeria de estoque.</span><span class="sxs-lookup"><span data-stu-id="9e856-125">This process can take between 3-16 hours toocomplete on a stock gallery image.</span></span>  <span data-ttu-id="9e856-126">Se os discos de dados do multi-TB tamanho são adicionados, o processo de saudação pode levar dias.</span><span class="sxs-lookup"><span data-stu-id="9e856-126">If multi-TB size data disks are added, hello process may take days.</span></span> <span data-ttu-id="9e856-127">Olá sequência de criptografia de disco do sistema operacional Linux desmonta a unidade de saudação SO temporariamente e realiza a criptografia no bloco por bloco de disco do sistema operacional inteiro hello, antes de remontá-lo em seu estado criptografado.</span><span class="sxs-lookup"><span data-stu-id="9e856-127">hello Linux OS disk encryption sequence unmounts hello OS drive temporarily, and performs block by block encryption of hello entire OS disk, before remounting it in its encrypted state.</span></span>   <span data-ttu-id="9e856-128">Ao contrário de criptografia de disco do Azure no Windows, criptografia de disco do Linux não permitir uso simultâneo de saudação VM enquanto Olá criptografia está em andamento.</span><span class="sxs-lookup"><span data-stu-id="9e856-128">Unlike Azure Disk Encryption on Windows, Linux Disk Encryption does not allow concurrent use of hello VM while hello encryption is in progress.</span></span>  <span data-ttu-id="9e856-129">características de desempenho de saudação de saudação VM, incluindo tamanho de saudação do disco hello e se a conta de armazenamento Olá é apoiada por armazenamento (SSD) padrão ou premium, podem influenciar bastante Olá tempo necessário toocomplete criptografia.</span><span class="sxs-lookup"><span data-stu-id="9e856-129">hello performance characteristics of hello VM, including hello size of hello disk and whether hello storage account is backed by standard or premium (SSD) storage, can greatly influence hello time required toocomplete encryption.</span></span>

<span data-ttu-id="9e856-130">status de toocheck, campo de ProgressMessage Olá retornado de saudação [Get-AzureRmVmDiskEncryptionStatus](https://docs.microsoft.com/powershell/module/azurerm.compute/get-azurermvmdiskencryptionstatus) comando pode ser controlado.</span><span class="sxs-lookup"><span data-stu-id="9e856-130">toocheck status, hello ProgressMessage field returned from hello [Get-AzureRmVmDiskEncryptionStatus](https://docs.microsoft.com/powershell/module/azurerm.compute/get-azurermvmdiskencryptionstatus) command can be polled.</span></span>   <span data-ttu-id="9e856-131">Enquanto unidade Olá sistema operacional está sendo criptografada, Olá VM entra em um estado de manutenção e SSH também é desabilitado tooprevent qualquer processo contínuo de toohello de interrupção.</span><span class="sxs-lookup"><span data-stu-id="9e856-131">While hello OS drive is being encrypted, hello VM enters a servicing state, and SSH is also disabled tooprevent any disruption toohello ongoing process.</span></span>  <span data-ttu-id="9e856-132">EncryptionInProgress será relatado para a maioria de saudação do tempo de saudação enquanto a criptografia estiver em andamento, seguido de várias horas mais tarde com uma mensagem de VMRestartPending solicitando toorestart Olá VM.</span><span class="sxs-lookup"><span data-stu-id="9e856-132">EncryptionInProgress will be reported for hello majority of hello time while encryption is in progress, followed several hours later with a VMRestartPending message prompting toorestart hello VM.</span></span>  <span data-ttu-id="9e856-133">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="9e856-133">For example:</span></span>


```
PS > Get-AzureRmVMDiskEncryptionStatus -ResourceGroupName $resourceGroupName -VMName $vmName
OsVolumeEncrypted          : EncryptionInProgress
DataVolumesEncrypted       : EncryptionInProgress
OsVolumeEncryptionSettings : Microsoft.Azure.Management.Compute.Models.DiskEncryptionSettings
ProgressMessage            : OS disk encryption started

PS > Get-AzureRmVMDiskEncryptionStatus -ResourceGroupName $resourceGroupName -VMName $vmName
OsVolumeEncrypted          : VMRestartPending
DataVolumesEncrypted       : Encrypted
OsVolumeEncryptionSettings : Microsoft.Azure.Management.Compute.Models.DiskEncryptionSettings
ProgressMessage            : OS disk successfully encrypted, please reboot hello VM
```

<span data-ttu-id="9e856-134">Uma vez solicitado tooreboot Olá VM e, depois de reiniciar Olá VM e dando 2 a 3 minutos para reinicialização hello e etapas finais toobe executada no destino hello, mensagem de saudação do status indicará que a criptografia foi concluída por último.</span><span class="sxs-lookup"><span data-stu-id="9e856-134">Once prompted tooreboot hello VM, and after restarting hello VM, and giving 2-3 minutes for hello reboot and for final steps toobe performed on hello target, hello status message will indicate that encryption has finally completed.</span></span>   <span data-ttu-id="9e856-135">Quando essa mensagem estiver disponível, unidade do sistema operacional Olá criptografado é esperado toobe pronto para uso em Olá VM toobe utilizável novamente.</span><span class="sxs-lookup"><span data-stu-id="9e856-135">Once this message is available, hello encrypted OS drive is expected toobe ready for use and for hello VM toobe usable again.</span></span>

<span data-ttu-id="9e856-136">Em casos onde essa sequência não foi Vista, ou se as informações de inicialização, mensagem de progresso ou outros indicadores de erro informar que a criptografia de sistema operacional falhou no meio hello desse processo (por exemplo, se você estiver vendo o erro de "Falha toounmount" hello descrito neste guia), é recomendável instantâneo de backup toohello toorestore Olá VM ou backup feito tooencryption imediatamente anterior.</span><span class="sxs-lookup"><span data-stu-id="9e856-136">In cases where this sequence was not seen, or if boot information, progress message, or other error indicators report that OS encryption has failed in hello middle of this process (for example if you are seeing hello "failed toounmount" error described in this guide), it is recommended toorestore hello VM back toohello snapshot or backup taken immediately prior tooencryption.</span></span>  <span data-ttu-id="9e856-137">Próxima tentativa de toohello anterior, é sugerida toore-avaliar características de saudação do hello VM e certifique-se de que todos os pré-requisitos forem atendidos.</span><span class="sxs-lookup"><span data-stu-id="9e856-137">Prior toohello next attempt, it is suggested toore-evaluate hello characteristics of hello VM and ensure that all prerequisites are satisfied.</span></span>

## <a name="troubleshooting-azure-disk-encryption-behind-a-firewall"></a><span data-ttu-id="9e856-138">Solução de problemas do Azure Disk Encryption por trás de um firewall</span><span class="sxs-lookup"><span data-stu-id="9e856-138">Troubleshooting Azure Disk Encryption behind a Firewall</span></span>
<span data-ttu-id="9e856-139">Quando conectividade é restrito por capacidade de Olá um firewall, o requisito de proxy ou configurações de grupo (NSG) de segurança de rede, de saudação extensão tooperform necessário tarefas pode ser interrompidas.</span><span class="sxs-lookup"><span data-stu-id="9e856-139">When connectivity is restricted by a firewall, proxy requirement, or network security group (NSG) settings, hello ability of hello extension tooperform needed tasks can be disrupted.</span></span>   <span data-ttu-id="9e856-140">Isso pode resultar em mensagens de status como "Status da extensão não está disponível em Olá VM" e em cenários esperados falhando toofinish.</span><span class="sxs-lookup"><span data-stu-id="9e856-140">This can result in status messages such as "Extension status not available on hello VM" and in expected scenarios failing toofinish.</span></span>  <span data-ttu-id="9e856-141">Olá próximas seções tem alguns problemas comuns de firewall que você pode investigar.</span><span class="sxs-lookup"><span data-stu-id="9e856-141">hello sections that follow has some common firewall issues that you may investigate.</span></span>

### <a name="network-security-groups"></a><span data-ttu-id="9e856-142">Grupos de segurança de rede</span><span class="sxs-lookup"><span data-stu-id="9e856-142">Network security groups</span></span>
<span data-ttu-id="9e856-143">As configurações de grupo de segurança de rede aplicadas ainda devem permitir a configuração de rede do hello ponto de extremidade toomeet Olá documentado [pré-requisitos](https://docs.microsoft.com/azure/security/azure-security-disk-encryption#prerequisites) para criptografia de disco.</span><span class="sxs-lookup"><span data-stu-id="9e856-143">Any network security group settings applied must still allow hello endpoint toomeet hello documented network configuration [prerequisites](https://docs.microsoft.com/azure/security/azure-security-disk-encryption#prerequisites) for disk encryption.</span></span>

### <a name="azure-keyvault-behind-firewall"></a><span data-ttu-id="9e856-144">Azure Keyvault por trás do firewall</span><span class="sxs-lookup"><span data-stu-id="9e856-144">Azure Keyvault behind firewall</span></span>
<span data-ttu-id="9e856-145">Olá VM deve ser capaz de tooaccess Cofre de chaves.</span><span class="sxs-lookup"><span data-stu-id="9e856-145">hello VM must be able tooaccess key vault.</span></span> <span data-ttu-id="9e856-146">Consulte tooguidance na falha do access tookey por trás de um firewall que é mantida pela Olá [Cofre de chaves](https://docs.microsoft.com/azure/key-vault/key-vault-access-behind-firewall) equipe.</span><span class="sxs-lookup"><span data-stu-id="9e856-146">Refer tooguidance on access tookey fault from behind a firewall that is maintained by hello [Key Vault](https://docs.microsoft.com/azure/key-vault/key-vault-access-behind-firewall) team.</span></span>

### <a name="linux-package-management-behind-firewall"></a><span data-ttu-id="9e856-147">Gerenciamento de pacotes Linux por trás do firewall</span><span class="sxs-lookup"><span data-stu-id="9e856-147">Linux package management behind firewall</span></span>
<span data-ttu-id="9e856-148">Em tempo de execução, a criptografia de disco do Azure para Linux depende pacote gerenciamento tooinstall necessário componentes de pré-requisito tooenabling anteriores a criptografia do sistema da distribuição de destino Olá.</span><span class="sxs-lookup"><span data-stu-id="9e856-148">At run time, Azure Disk Encryption for Linux relies on hello target distribution’s package management system tooinstall needed prerequisite components prior tooenabling encryption.</span></span>  <span data-ttu-id="9e856-149">Se as configurações de firewall impedir Olá VM toodownload capaz e instalar esses componentes, falhas subsequentes são esperadas.</span><span class="sxs-lookup"><span data-stu-id="9e856-149">If firewall settings prevent hello VM from being able toodownload and install these components, then subsequent failures are expected.</span></span>    <span data-ttu-id="9e856-150">etapas de saudação tooconfigure que isso pode variar para distribuição.</span><span class="sxs-lookup"><span data-stu-id="9e856-150">hello steps tooconfigure this may vary by distribution.</span></span>  <span data-ttu-id="9e856-151">No Red Hat, quando um proxy é necessário, é vital garantir que o subscription-manager e o yum estejam configurados corretamente.</span><span class="sxs-lookup"><span data-stu-id="9e856-151">On Red Hat, when a proxy is required, ensuring that subscription-manager and yum are set up properly is vital.</span></span>  <span data-ttu-id="9e856-152">Consulte [este](https://access.redhat.com/solutions/189533) artigo de suporte do Red Hat sobre esse tópico.</span><span class="sxs-lookup"><span data-stu-id="9e856-152">See [this](https://access.redhat.com/solutions/189533) Red Hat support article on this topic.</span></span>  

## <a name="troubleshooting-windows-server-2016-server-core"></a><span data-ttu-id="9e856-153">Solução de problemas de Server Core do Windows Server 2016</span><span class="sxs-lookup"><span data-stu-id="9e856-153">Troubleshooting Windows Server 2016 Server Core</span></span>

<span data-ttu-id="9e856-154">No Server Core do Windows Server 2016, o componente de bdehdcfg Olá não está disponível por padrão.</span><span class="sxs-lookup"><span data-stu-id="9e856-154">On Windows Server 2016 Server Core, hello bdehdcfg component is not available by default.</span></span> <span data-ttu-id="9e856-155">Esse componente é exigido pelo Azure Disk Encryption.</span><span class="sxs-lookup"><span data-stu-id="9e856-155">This component is required by Azure Disk Encryption.</span></span>

<span data-ttu-id="9e856-156">tooworkaround esse problema, Olá cópia 4 arquivos a seguir de uma pasta de c:\windows\system32 toohello VM do Windows Server 2016 Data Center da imagem do Server Core hello:</span><span class="sxs-lookup"><span data-stu-id="9e856-156">tooworkaround this issue, copy hello following 4 files from a Windows Server 2016 Data Center VM toohello c:\windows\system32 folder of hello Server Core image:</span></span>

```
bdehdcfg.exe
bdehdcfglib.dll
bdehdcfglib.dll.mui
bdehdcfg.exe.mui
```

<span data-ttu-id="9e856-157">Em seguida, execute o comando a seguir de saudação:</span><span class="sxs-lookup"><span data-stu-id="9e856-157">Then, run hello following command:</span></span>

```
bdehdcfg.exe -target default
```

<span data-ttu-id="9e856-158">Isso criará uma partição de sistema 550MB e, em seguida, após uma reinicialização, você pode usar o Diskpart toocheck Olá volumes e continuar.</span><span class="sxs-lookup"><span data-stu-id="9e856-158">This will create a 550MB system partition and then after a reboot, you can use Diskpart toocheck hello volumes, and proceed.</span></span>  

<span data-ttu-id="9e856-159">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="9e856-159">For example:</span></span>

```
DISKPART> list vol

  Volume ###  Ltr  Label        Fs     Type        Size     Status     Info
  ----------  ---  -----------  -----  ----------  -------  ---------  --------
  Volume 0     C                NTFS   Partition    126 GB  Healthy    Boot
  Volume 1                      NTFS   Partition    550 MB  Healthy    System
  Volume 2     D   Temporary S  NTFS   Partition     13 GB  Healthy    Pagefile
```
## <a name="see-also"></a><span data-ttu-id="9e856-160">Consulte também</span><span class="sxs-lookup"><span data-stu-id="9e856-160">See also</span></span>
<span data-ttu-id="9e856-161">Neste documento, você aprendeu mais sobre alguns problemas comuns na criptografia de disco do Azure e como tootroubleshoot.</span><span class="sxs-lookup"><span data-stu-id="9e856-161">In this document, you learned more about some common issues in Azure disk encryption, and how tootroubleshoot.</span></span> <span data-ttu-id="9e856-162">Para obter mais informações sobre esse serviço e sua capacidade, leia:</span><span class="sxs-lookup"><span data-stu-id="9e856-162">For more information about this service and its capability read:</span></span>

- [<span data-ttu-id="9e856-163">Aplicar a criptografia de disco na Central de Segurança do Azure</span><span class="sxs-lookup"><span data-stu-id="9e856-163">Apply disk encryption in Azure Security Center</span></span>](https://docs.microsoft.com/azure/security-center/security-center-apply-disk-encryption)
- [<span data-ttu-id="9e856-164">Criptografar uma Máquina Virtual do Azure</span><span class="sxs-lookup"><span data-stu-id="9e856-164">Encrypt an Azure Virtual Machine</span></span>](https://docs.microsoft.com/azure/security-center/security-center-disk-encryption)
- [<span data-ttu-id="9e856-165">Criptografia de dados em repouso no Azure</span><span class="sxs-lookup"><span data-stu-id="9e856-165">Azure Data Encryption-at-Rest</span></span>](https://docs.microsoft.com/azure/security/azure-security-encryption-atrest)
