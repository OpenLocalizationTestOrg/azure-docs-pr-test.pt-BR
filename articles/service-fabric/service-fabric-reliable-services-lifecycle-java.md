---
title: "Visão geral do ciclo de vida do Azure Service Fabric Reliable Services | Microsoft Docs"
description: Saiba mais sobre os diferentes eventos de ciclo de vida no Service Fabric Reliable Services
services: Service-Fabric
documentationcenter: java
author: PavanKunapareddyMSFT
manager: timlt
ms.assetid: 
ms.service: Service-Fabric
ms.devlang: java
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/30/2017
ms.author: pakunapa;
ms.openlocfilehash: 80eb68346dd05c256c60725eb082aa0651fe7cbd
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/18/2017
---
# <a name="reliable-services-lifecycle-overview"></a><span data-ttu-id="068e3-103">Visão geral do ciclo de vida do Reliable Services</span><span class="sxs-lookup"><span data-stu-id="068e3-103">Reliable services lifecycle overview</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="068e3-104">C# em Windows</span><span class="sxs-lookup"><span data-stu-id="068e3-104">C# on Windows</span></span>](service-fabric-reliable-services-lifecycle.md)
> * [<span data-ttu-id="068e3-105">Java no Linux</span><span class="sxs-lookup"><span data-stu-id="068e3-105">Java on Linux</span></span>](service-fabric-reliable-services-lifecycle-java.md)
>
>

<span data-ttu-id="068e3-106">Ao pensar sobre os ciclos de vida do Reliable Services, os conceitos básicos são os mais importantes.</span><span class="sxs-lookup"><span data-stu-id="068e3-106">When thinking about the lifecycles of Reliable Services, the basics of the lifecycle are the most important.</span></span> <span data-ttu-id="068e3-107">Em geral:</span><span class="sxs-lookup"><span data-stu-id="068e3-107">In general:</span></span>

* <span data-ttu-id="068e3-108">Durante a inicialização</span><span class="sxs-lookup"><span data-stu-id="068e3-108">During Startup</span></span>
  * <span data-ttu-id="068e3-109">Serviços são construídos</span><span class="sxs-lookup"><span data-stu-id="068e3-109">Services are constructed</span></span>
  * <span data-ttu-id="068e3-110">Eles têm a oportunidade de construir e retornar zero ou mais ouvintes</span><span class="sxs-lookup"><span data-stu-id="068e3-110">They have an opportunity to construct and return zero or more listeners</span></span>
  * <span data-ttu-id="068e3-111">Todos os ouvintes retornados são abertos, permitindo a comunicação com o serviço</span><span class="sxs-lookup"><span data-stu-id="068e3-111">Any returned listeners are opened, allowing communication with the service</span></span>
  * <span data-ttu-id="068e3-112">O método runAsync do serviço é chamado, possibilitando um serviço de longa execução ou trabalho em segundo plano</span><span class="sxs-lookup"><span data-stu-id="068e3-112">The Service's runAsync method is called, allowing the service to do long running or background work</span></span>
* <span data-ttu-id="068e3-113">Durante o desligamento</span><span class="sxs-lookup"><span data-stu-id="068e3-113">During shutdown</span></span>
  * <span data-ttu-id="068e3-114">O token de cancelamento passado para o runAsync é cancelado e os ouvintes são fechados</span><span class="sxs-lookup"><span data-stu-id="068e3-114">The cancellation token passed to runAsync is canceled, and the listeners are closed</span></span>
  * <span data-ttu-id="068e3-115">Assim que estiver concluído, o objeto do serviço será destruído</span><span class="sxs-lookup"><span data-stu-id="068e3-115">Once that is complete, the service object itself is destructed</span></span>

<span data-ttu-id="068e3-116">Há detalhes sobre a ordem exata desses eventos.</span><span class="sxs-lookup"><span data-stu-id="068e3-116">There are details around the exact ordering of these events.</span></span> <span data-ttu-id="068e3-117">Em especial, a ordem de eventos pode mudar um pouco dependendo se o Reliable Service tem estado ou não.</span><span class="sxs-lookup"><span data-stu-id="068e3-117">In particular, the order of events may change slightly depending on whether the Reliable Service is Stateless or Stateful.</span></span> <span data-ttu-id="068e3-118">Além disso, para serviços com estado, temos de lidar com o cenário de troca primário.</span><span class="sxs-lookup"><span data-stu-id="068e3-118">In addition, for stateful services, we have to deal with the Primary swap scenario.</span></span> <span data-ttu-id="068e3-119">Durante esta sequência, a função da Primária é transferida para outra réplica (ou retorna) sem o desligamento do serviço.</span><span class="sxs-lookup"><span data-stu-id="068e3-119">During this sequence, the role of Primary is transferred to another replica (or comes back) without the service shutting down.</span></span> <span data-ttu-id="068e3-120">Por fim, temos de pensar sobre as condições de erro ou falha.</span><span class="sxs-lookup"><span data-stu-id="068e3-120">Finally, we have to think about error or failure conditions.</span></span>

## <a name="stateless-service-startup"></a><span data-ttu-id="068e3-121">Inicialização de serviço sem estado</span><span class="sxs-lookup"><span data-stu-id="068e3-121">Stateless service startup</span></span>
<span data-ttu-id="068e3-122">O ciclo de vida de um serviço sem estado é bastante simples.</span><span class="sxs-lookup"><span data-stu-id="068e3-122">The lifecycle of a stateless service is fairly straightforward.</span></span> <span data-ttu-id="068e3-123">Aqui está a ordem de eventos:</span><span class="sxs-lookup"><span data-stu-id="068e3-123">Here's the order of events:</span></span>

1. <span data-ttu-id="068e3-124">O Serviço foi construído</span><span class="sxs-lookup"><span data-stu-id="068e3-124">The Service is constructed</span></span>
2. <span data-ttu-id="068e3-125">Em seguida, ocorrem duas coisas em paralelo:</span><span class="sxs-lookup"><span data-stu-id="068e3-125">Then, in parallel two things happen:</span></span>
    - <span data-ttu-id="068e3-126">`StatelessService.createServiceInstanceListeners()` é invocado e todos os ouvintes retornados serão Abertos (`CommunicationListener.openAsync()` é chamado em cada ouvinte)</span><span class="sxs-lookup"><span data-stu-id="068e3-126">`StatelessService.createServiceInstanceListeners()` is invoked and any returned listeners are Opened (`CommunicationListener.openAsync()` is called on each listener)</span></span>
    - <span data-ttu-id="068e3-127">O método runAsync (`StatelessService.runAsync()`) do serviço é chamado</span><span class="sxs-lookup"><span data-stu-id="068e3-127">The service's runAsync method (`StatelessService.runAsync()`) is called</span></span>
3. <span data-ttu-id="068e3-128">Se existir, o próprio método onOpenAsync do serviço será chamado (especificamente, `StatelessService.onOpenAsync()` será chamado.</span><span class="sxs-lookup"><span data-stu-id="068e3-128">If present, the service's own onOpenAsync method is called (Specifically, `StatelessService.onOpenAsync()` is called.</span></span> <span data-ttu-id="068e3-129">Esta é uma substituição incomum, mas está disponível).</span><span class="sxs-lookup"><span data-stu-id="068e3-129">This is an uncommon override but it is available).</span></span>

<span data-ttu-id="068e3-130">É importante observar que não há nenhuma ordem entre as chamadas para criar e abrir os ouvintes e o runAsync.</span><span class="sxs-lookup"><span data-stu-id="068e3-130">It is important to note that there is no ordering between the calls to create and open the listeners and runAsync.</span></span> <span data-ttu-id="068e3-131">Os ouvintes podem ser abertos antes de o runAsync ser iniciado.</span><span class="sxs-lookup"><span data-stu-id="068e3-131">The listeners may open before runAsync is started.</span></span> <span data-ttu-id="068e3-132">Da mesma forma, o runAsync pode acabar sendo invocado antes que os ouvintes de comunicação sejam abertos ou até mesmo antes de serem construídos.</span><span class="sxs-lookup"><span data-stu-id="068e3-132">Similarly, runAsync may end up invoked before the communication listeners are open or have even been constructed.</span></span> <span data-ttu-id="068e3-133">Se nenhuma sincronização for necessária, isso será deixado como um exercício para o implementador.</span><span class="sxs-lookup"><span data-stu-id="068e3-133">If any synchronization is required, it is left as an exercise to the implementer.</span></span> <span data-ttu-id="068e3-134">Soluções comuns:</span><span class="sxs-lookup"><span data-stu-id="068e3-134">Common solutions:</span></span>

* <span data-ttu-id="068e3-135">Algumas vezes os ouvintes não funcionam até que outras informações sejam criadas ou algum trabalho seja realizado.</span><span class="sxs-lookup"><span data-stu-id="068e3-135">Sometimes listeners can't function until some other information is created or work done.</span></span> <span data-ttu-id="068e3-136">Para serviços sem monitoração de estado, esse trabalho geralmente pode ser realizado no construtor do serviço, durante a chamada `createServiceInstanceListeners()` ou como parte da construção do ouvinte propriamente dito.</span><span class="sxs-lookup"><span data-stu-id="068e3-136">For stateless services that work can usually be done in the service's constructor, during the `createServiceInstanceListeners()` call, or as a part of the construction of the listener itself.</span></span>
* <span data-ttu-id="068e3-137">Às vezes, o código em runAsync não é iniciado até que os ouvintes estejam abertos.</span><span class="sxs-lookup"><span data-stu-id="068e3-137">Sometimes the code in runAsync does not want to start until the listeners are open.</span></span> <span data-ttu-id="068e3-138">Nesse caso, coordenação adicional será necessária.</span><span class="sxs-lookup"><span data-stu-id="068e3-138">In this case additional coordination is necessary.</span></span> <span data-ttu-id="068e3-139">Uma solução comum é um sinalizador dentro dos ouvintes indicando quando eles foram concluídos, que é verificado no runAsync antes de passar para o trabalho real.</span><span class="sxs-lookup"><span data-stu-id="068e3-139">One common solution is some flag within the listeners indicating when they have completed, which is checked in runAsync before continuing to actual work.</span></span>

## <a name="stateless-service-shutdown"></a><span data-ttu-id="068e3-140">Desligamento de serviço sem estado</span><span class="sxs-lookup"><span data-stu-id="068e3-140">Stateless service shutdown</span></span>
<span data-ttu-id="068e3-141">Ao desligar um serviço sem estado, o mesmo padrão é seguido, porém na ordem inversa:</span><span class="sxs-lookup"><span data-stu-id="068e3-141">When shutting down a stateless service, the same pattern is followed, just in reverse:</span></span>

1. <span data-ttu-id="068e3-142">Em paralelo</span><span class="sxs-lookup"><span data-stu-id="068e3-142">In parallel</span></span>
    - <span data-ttu-id="068e3-143">Todos os ouvintes abertos são Fechados (`CommunicationListener.closeAsync()` é chamado em cada ouvinte)</span><span class="sxs-lookup"><span data-stu-id="068e3-143">Any open listeners are Closed (`CommunicationListener.closeAsync()` is called on each listener)</span></span>
    - <span data-ttu-id="068e3-144">O token de cancelamento passado para `runAsync()` é cancelado (verificar a propriedade `isCancelled` do token de cancelamento retornará true e, se chamado, o método `throwIfCancellationRequested` do token retornará um `CancellationException`)</span><span class="sxs-lookup"><span data-stu-id="068e3-144">The cancellation token passed to `runAsync()` is canceled (checking the cancellation token's `isCancelled` property returns true, and if called the token's `throwIfCancellationRequested` method throws a `CancellationException`)</span></span>
2. <span data-ttu-id="068e3-145">Uma vez que `closeAsync()` é concluído em cada ouvinte e `runAsync()` também é finalizado, o método `StatelessService.onCloseAsync()` do serviço é chamado, se existir (novamente, essa é uma substituição incomum).</span><span class="sxs-lookup"><span data-stu-id="068e3-145">Once `closeAsync()` completes on each listener and `runAsync()` also completes, the service's `StatelessService.onCloseAsync()` method is called, if present (again this is an uncommon override).</span></span>
3. <span data-ttu-id="068e3-146">Depois da conclusão de `StatelessService.onCloseAsync()`, o objeto de serviço é destruído</span><span class="sxs-lookup"><span data-stu-id="068e3-146">After `StatelessService.onCloseAsync()` completes, the service object is destructed</span></span>

## <a name="notes-on-service-lifecycle"></a><span data-ttu-id="068e3-147">Observações sobre o ciclo de vida do serviço</span><span class="sxs-lookup"><span data-stu-id="068e3-147">Notes on service lifecycle</span></span>
* <span data-ttu-id="068e3-148">Tanto o método `runAsync()` quanto as chamadas `createServiceInstanceListeners` são opcionais.</span><span class="sxs-lookup"><span data-stu-id="068e3-148">Both the `runAsync()` method and the `createServiceInstanceListeners` calls are optional.</span></span> <span data-ttu-id="068e3-149">Um serviço pode ter um deles, ambos ou nenhum.</span><span class="sxs-lookup"><span data-stu-id="068e3-149">A service may have one of them, both, or neither.</span></span> <span data-ttu-id="068e3-150">Por exemplo, se o serviço fizer todo seu trabalho em resposta a chamadas do usuário, não será necessário implementar `runAsync()`.</span><span class="sxs-lookup"><span data-stu-id="068e3-150">For example, if the service does all its work in response to user calls, there is no need for it to implement `runAsync()`.</span></span> <span data-ttu-id="068e3-151">Apenas os ouvintes de comunicação e seu código associado são necessários.</span><span class="sxs-lookup"><span data-stu-id="068e3-151">Only the communication listeners and their associated code are necessary.</span></span> <span data-ttu-id="068e3-152">Da mesma forma, criar e retornar ouvintes de comunicação é opcional, pois o serviço pode ter apenas trabalho em segundo plano e só precisar implementar `runAsync()`</span><span class="sxs-lookup"><span data-stu-id="068e3-152">Similarly, creating and returning communication listeners is optional, as the service may have only background work to do, and so only needs to implement `runAsync()`</span></span>
* <span data-ttu-id="068e3-153">Isso é válido para um serviço concluir `runAsync()` com êxito e retornar dele.</span><span class="sxs-lookup"><span data-stu-id="068e3-153">It is valid for a service to complete `runAsync()` successfully and return from it.</span></span> <span data-ttu-id="068e3-154">Isso não é considerado uma condição de falha e representa o trabalho em segundo plano após o término do serviço.</span><span class="sxs-lookup"><span data-stu-id="068e3-154">This is not considered a failure condition and would represent the background work of the service completing.</span></span> <span data-ttu-id="068e3-155">Para serviços confiáveis com estado, `runAsync()` seria chamado novamente se o serviço tiver sido rebaixado de primário e promovido novamente para primário.</span><span class="sxs-lookup"><span data-stu-id="068e3-155">For stateful reliable services `runAsync()` would be called again if the service were demoted from primary and then promoted back to primary.</span></span>
* <span data-ttu-id="068e3-156">Se um serviço sai de `runAsync()` gerando uma exceção inesperada, há uma falha e o objeto de serviço é desligado e relatado um erro de integridade.</span><span class="sxs-lookup"><span data-stu-id="068e3-156">If a service exits from `runAsync()` by throwing some unexpected exception, this is a failure and the service object is shut down and a health error reported.</span></span>
* <span data-ttu-id="068e3-157">Embora não haja um limite de tempo para o retorno desses métodos, você perde imediatamente a capacidade de gravar e, portanto, não pode concluir qualquer trabalho real.</span><span class="sxs-lookup"><span data-stu-id="068e3-157">While there is no time limit on returning from these methods, you immediately lose the ability to write and therefore cannot complete any real work.</span></span> <span data-ttu-id="068e3-158">Recomendamos que você retorne o mais rápido possível após o recebimento da solicitação de cancelamento.</span><span class="sxs-lookup"><span data-stu-id="068e3-158">It is recommended that you return as quickly as possible upon receiving the cancellation request.</span></span> <span data-ttu-id="068e3-159">Se o serviço não responder a essas chamadas à API dentro de um período razoável, o Service Fabric poderá forçar o encerramento do serviço.</span><span class="sxs-lookup"><span data-stu-id="068e3-159">If your service does not respond to these API calls in a reasonable amount of time Service Fabric may forcibly terminate your service.</span></span> <span data-ttu-id="068e3-160">Geralmente isso ocorre apenas durante atualizações de aplicativo ou quando um serviço está sendo excluído.</span><span class="sxs-lookup"><span data-stu-id="068e3-160">Usually this only happens during application upgrades or when a service is being deleted.</span></span> <span data-ttu-id="068e3-161">Esse tempo limite é de 15 minutos por padrão.</span><span class="sxs-lookup"><span data-stu-id="068e3-161">This timeout is 15 minutes by default.</span></span>
* <span data-ttu-id="068e3-162">Falhas no caminho de `onCloseAsync()` resultam em uma chamada de `onAbort()`, que é uma oportunidade de melhor esforço de última chance para o serviço ser limpo e liberar quaisquer recursos ocupados.</span><span class="sxs-lookup"><span data-stu-id="068e3-162">Failures in the `onCloseAsync()` path result in `onAbort()` being called which is a last-chance best-effort opportunity for the service to clean up and release any resources that they have claimed.</span></span>

> [!NOTE]
> <span data-ttu-id="068e3-163">Ainda não há suporte para Reliable Services com monitoração de estado em java.</span><span class="sxs-lookup"><span data-stu-id="068e3-163">Stateful reliable services are not supported in java yet.</span></span>
>
>

## <a name="next-steps"></a><span data-ttu-id="068e3-164">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="068e3-164">Next steps</span></span>
* [<span data-ttu-id="068e3-165">Introdução ao Reliable Services</span><span class="sxs-lookup"><span data-stu-id="068e3-165">Introduction to Reliable Services</span></span>](service-fabric-reliable-services-introduction.md)
* [<span data-ttu-id="068e3-166">Início Rápido dos Serviços Confiáveis</span><span class="sxs-lookup"><span data-stu-id="068e3-166">Reliable Services quick start</span></span>](service-fabric-reliable-services-quick-start.md)
* [<span data-ttu-id="068e3-167">Uso avançado de Reliable Services</span><span class="sxs-lookup"><span data-stu-id="068e3-167">Reliable Services advanced usage</span></span>](service-fabric-reliable-services-advanced-usage.md)
