---
title: "aaaOverview de saudação do ciclo de vida de serviços do Azure Service Fabric confiáveis | Microsoft Docs"
description: "Saiba mais sobre eventos de ciclo de vida diferente Olá em serviços confiáveis do Service Fabric"
services: Service-Fabric
documentationcenter: java
author: PavanKunapareddyMSFT
manager: timlt
ms.assetid: 
ms.service: Service-Fabric
ms.devlang: java
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/30/2017
ms.author: pakunapa;
ms.openlocfilehash: 6d48c217d12bc5248c2da57b544aac747cecd872
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="reliable-services-lifecycle-overview"></a><span data-ttu-id="88b40-103">Visão geral do ciclo de vida do Reliable Services</span><span class="sxs-lookup"><span data-stu-id="88b40-103">Reliable services lifecycle overview</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="88b40-104">C# em Windows</span><span class="sxs-lookup"><span data-stu-id="88b40-104">C# on Windows</span></span>](service-fabric-reliable-services-lifecycle.md)
> * [<span data-ttu-id="88b40-105">Java no Linux</span><span class="sxs-lookup"><span data-stu-id="88b40-105">Java on Linux</span></span>](service-fabric-reliable-services-lifecycle-java.md)
>
>

<span data-ttu-id="88b40-106">Ao pensar Olá ciclos de vida de serviços confiáveis, Noções básicas de saudação do ciclo de vida de saudação são hello mais importante.</span><span class="sxs-lookup"><span data-stu-id="88b40-106">When thinking about hello lifecycles of Reliable Services, hello basics of hello lifecycle are hello most important.</span></span> <span data-ttu-id="88b40-107">Em geral:</span><span class="sxs-lookup"><span data-stu-id="88b40-107">In general:</span></span>

* <span data-ttu-id="88b40-108">Durante a inicialização</span><span class="sxs-lookup"><span data-stu-id="88b40-108">During Startup</span></span>
  * <span data-ttu-id="88b40-109">Serviços são construídos</span><span class="sxs-lookup"><span data-stu-id="88b40-109">Services are constructed</span></span>
  * <span data-ttu-id="88b40-110">Eles têm uma oportunidade tooconstruct e retornam zero ou mais ouvintes</span><span class="sxs-lookup"><span data-stu-id="88b40-110">They have an opportunity tooconstruct and return zero or more listeners</span></span>
  * <span data-ttu-id="88b40-111">Todos os ouvintes retornados abertos, permitindo que a comunicação com o serviço de saudação</span><span class="sxs-lookup"><span data-stu-id="88b40-111">Any returned listeners are opened, allowing communication with hello service</span></span>
  * <span data-ttu-id="88b40-112">método de runAsync de saudação do serviço é chamado, permitindo Olá toodo do serviço de longa execução ou trabalho de plano de fundo</span><span class="sxs-lookup"><span data-stu-id="88b40-112">hello Service's runAsync method is called, allowing hello service toodo long running or background work</span></span>
* <span data-ttu-id="88b40-113">Durante o desligamento</span><span class="sxs-lookup"><span data-stu-id="88b40-113">During shutdown</span></span>
  * <span data-ttu-id="88b40-114">toorunAsync passado token de cancelamento Olá será cancelada e ouvintes de saudação são fechadas</span><span class="sxs-lookup"><span data-stu-id="88b40-114">hello cancellation token passed toorunAsync is canceled, and hello listeners are closed</span></span>
  * <span data-ttu-id="88b40-115">Assim que estiver concluído, próprio objeto de serviço Olá é destruído</span><span class="sxs-lookup"><span data-stu-id="88b40-115">Once that is complete, hello service object itself is destructed</span></span>

<span data-ttu-id="88b40-116">Há detalhes sobre Olá exata de ordenação desses eventos.</span><span class="sxs-lookup"><span data-stu-id="88b40-116">There are details around hello exact ordering of these events.</span></span> <span data-ttu-id="88b40-117">Em particular, a ordem de saudação de eventos pode mudar um pouco dependendo se Olá serviço confiável é sem monitoração de estado ou de monitoração de estado.</span><span class="sxs-lookup"><span data-stu-id="88b40-117">In particular, hello order of events may change slightly depending on whether hello Reliable Service is Stateless or Stateful.</span></span> <span data-ttu-id="88b40-118">Além disso, para os serviços com monitoração de estado, temos toodeal com cenário de troca primário hello.</span><span class="sxs-lookup"><span data-stu-id="88b40-118">In addition, for stateful services, we have toodeal with hello Primary swap scenario.</span></span> <span data-ttu-id="88b40-119">Durante essa sequência, função hello principal é transferido tooanother réplica (ou voltar a ficar) sem o desligamento do serviço hello.</span><span class="sxs-lookup"><span data-stu-id="88b40-119">During this sequence, hello role of Primary is transferred tooanother replica (or comes back) without hello service shutting down.</span></span> <span data-ttu-id="88b40-120">Por fim, temos toothink sobre condições de erro ou falha.</span><span class="sxs-lookup"><span data-stu-id="88b40-120">Finally, we have toothink about error or failure conditions.</span></span>

## <a name="stateless-service-startup"></a><span data-ttu-id="88b40-121">Inicialização de serviço sem estado</span><span class="sxs-lookup"><span data-stu-id="88b40-121">Stateless service startup</span></span>
<span data-ttu-id="88b40-122">saudação de ciclo de vida de um serviço sem monitoração de estado é bastante simples.</span><span class="sxs-lookup"><span data-stu-id="88b40-122">hello lifecycle of a stateless service is fairly straightforward.</span></span> <span data-ttu-id="88b40-123">Aqui está a ordem de saudação de eventos:</span><span class="sxs-lookup"><span data-stu-id="88b40-123">Here's hello order of events:</span></span>

1. <span data-ttu-id="88b40-124">Olá serviço é construído</span><span class="sxs-lookup"><span data-stu-id="88b40-124">hello Service is constructed</span></span>
2. <span data-ttu-id="88b40-125">Em seguida, ocorrem duas coisas em paralelo:</span><span class="sxs-lookup"><span data-stu-id="88b40-125">Then, in parallel two things happen:</span></span>
    - <span data-ttu-id="88b40-126">`StatelessService.createServiceInstanceListeners()` é invocado e todos os ouvintes retornados serão Abertos (`CommunicationListener.openAsync()` é chamado em cada ouvinte)</span><span class="sxs-lookup"><span data-stu-id="88b40-126">`StatelessService.createServiceInstanceListeners()` is invoked and any returned listeners are Opened (`CommunicationListener.openAsync()` is called on each listener)</span></span>
    - <span data-ttu-id="88b40-127">Olá runAsync método serviço (`StatelessService.runAsync()`) é chamado</span><span class="sxs-lookup"><span data-stu-id="88b40-127">hello service's runAsync method (`StatelessService.runAsync()`) is called</span></span>
3. <span data-ttu-id="88b40-128">Se estiver presente, o método de onOpenAsync hello do serviço é chamado (especificamente, `StatelessService.onOpenAsync()` é chamado.</span><span class="sxs-lookup"><span data-stu-id="88b40-128">If present, hello service's own onOpenAsync method is called (Specifically, `StatelessService.onOpenAsync()` is called.</span></span> <span data-ttu-id="88b40-129">Esta é uma substituição incomum, mas está disponível).</span><span class="sxs-lookup"><span data-stu-id="88b40-129">This is an uncommon override but it is available).</span></span>

<span data-ttu-id="88b40-130">É importante toonote que não há nenhuma ordem entre Olá chamadas toocreate e ouvintes de saudação aberto e runAsync.</span><span class="sxs-lookup"><span data-stu-id="88b40-130">It is important toonote that there is no ordering between hello calls toocreate and open hello listeners and runAsync.</span></span> <span data-ttu-id="88b40-131">ouvintes de saudação podem abrir antes runAsync é iniciado.</span><span class="sxs-lookup"><span data-stu-id="88b40-131">hello listeners may open before runAsync is started.</span></span> <span data-ttu-id="88b40-132">Da mesma forma, runAsync poderá acabar invocado antes de ouvintes de comunicação Olá estão abertas ou até mesmo foram construídos.</span><span class="sxs-lookup"><span data-stu-id="88b40-132">Similarly, runAsync may end up invoked before hello communication listeners are open or have even been constructed.</span></span> <span data-ttu-id="88b40-133">Se nenhuma sincronização é necessária, ela será deixada como implementador de toohello um exercício.</span><span class="sxs-lookup"><span data-stu-id="88b40-133">If any synchronization is required, it is left as an exercise toohello implementer.</span></span> <span data-ttu-id="88b40-134">Soluções comuns:</span><span class="sxs-lookup"><span data-stu-id="88b40-134">Common solutions:</span></span>

* <span data-ttu-id="88b40-135">Algumas vezes os ouvintes não funcionam até que outras informações sejam criadas ou algum trabalho seja realizado.</span><span class="sxs-lookup"><span data-stu-id="88b40-135">Sometimes listeners can't function until some other information is created or work done.</span></span> <span data-ttu-id="88b40-136">Para serviços sem monitoração de estado de trabalho geralmente pode ser feito no construtor do serviço hello, durante a saudação `createServiceInstanceListeners()` chamar, ou como parte da construção de saudação do ouvinte de saudação em si.</span><span class="sxs-lookup"><span data-stu-id="88b40-136">For stateless services that work can usually be done in hello service's constructor, during hello `createServiceInstanceListeners()` call, or as a part of hello construction of hello listener itself.</span></span>
* <span data-ttu-id="88b40-137">Às vezes, hello código runAsync não quer toostart até ouvintes Olá estão abertas.</span><span class="sxs-lookup"><span data-stu-id="88b40-137">Sometimes hello code in runAsync does not want toostart until hello listeners are open.</span></span> <span data-ttu-id="88b40-138">Nesse caso, coordenação adicional será necessária.</span><span class="sxs-lookup"><span data-stu-id="88b40-138">In this case additional coordination is necessary.</span></span> <span data-ttu-id="88b40-139">Uma solução comum é alguns sinalizador em ouvintes Olá indicando quando eles tem concluído, que é verificado no runAsync antes de continuar o trabalho de tooactual.</span><span class="sxs-lookup"><span data-stu-id="88b40-139">One common solution is some flag within hello listeners indicating when they have completed, which is checked in runAsync before continuing tooactual work.</span></span>

## <a name="stateless-service-shutdown"></a><span data-ttu-id="88b40-140">Desligamento de serviço sem estado</span><span class="sxs-lookup"><span data-stu-id="88b40-140">Stateless service shutdown</span></span>
<span data-ttu-id="88b40-141">Ao desligar um serviço sem monitoração de estado, Olá mesmo padrão é seguido apenas na ordem inversa:</span><span class="sxs-lookup"><span data-stu-id="88b40-141">When shutting down a stateless service, hello same pattern is followed, just in reverse:</span></span>

1. <span data-ttu-id="88b40-142">Em paralelo</span><span class="sxs-lookup"><span data-stu-id="88b40-142">In parallel</span></span>
    - <span data-ttu-id="88b40-143">Todos os ouvintes abertos são Fechados (`CommunicationListener.closeAsync()` é chamado em cada ouvinte)</span><span class="sxs-lookup"><span data-stu-id="88b40-143">Any open listeners are Closed (`CommunicationListener.closeAsync()` is called on each listener)</span></span>
    - <span data-ttu-id="88b40-144">token de cancelamento Olá passado muito`runAsync()` foi cancelada (verificação de token de cancelamento a saudação `isCancelled` propriedade retorna true e se a chamada do token Olá `throwIfCancellationRequested` método lança um `CancellationException`)</span><span class="sxs-lookup"><span data-stu-id="88b40-144">hello cancellation token passed too`runAsync()` is canceled (checking hello cancellation token's `isCancelled` property returns true, and if called hello token's `throwIfCancellationRequested` method throws a `CancellationException`)</span></span>
2. <span data-ttu-id="88b40-145">Uma vez `closeAsync()` conclusão em cada ouvinte e `runAsync()` também completa do serviço Olá `StatelessService.onCloseAsync()` método é chamado, se estiver presente (novamente essa é uma substituição incomuns).</span><span class="sxs-lookup"><span data-stu-id="88b40-145">Once `closeAsync()` completes on each listener and `runAsync()` also completes, hello service's `StatelessService.onCloseAsync()` method is called, if present (again this is an uncommon override).</span></span>
3. <span data-ttu-id="88b40-146">Depois de `StatelessService.onCloseAsync()` for concluído, o objeto de serviço Olá é destruído</span><span class="sxs-lookup"><span data-stu-id="88b40-146">After `StatelessService.onCloseAsync()` completes, hello service object is destructed</span></span>

## <a name="notes-on-service-lifecycle"></a><span data-ttu-id="88b40-147">Observações sobre o ciclo de vida do serviço</span><span class="sxs-lookup"><span data-stu-id="88b40-147">Notes on service lifecycle</span></span>
* <span data-ttu-id="88b40-148">Ambos os Olá `runAsync()` método e hello `createServiceInstanceListeners` chamadas são opcionais.</span><span class="sxs-lookup"><span data-stu-id="88b40-148">Both hello `runAsync()` method and hello `createServiceInstanceListeners` calls are optional.</span></span> <span data-ttu-id="88b40-149">Um serviço pode ter um deles, ambos ou nenhum.</span><span class="sxs-lookup"><span data-stu-id="88b40-149">A service may have one of them, both, or neither.</span></span> <span data-ttu-id="88b40-150">Por exemplo, se o serviço de saudação faz seu trabalho em resposta toouser chamadas, não é necessário para que ele tooimplement `runAsync()`.</span><span class="sxs-lookup"><span data-stu-id="88b40-150">For example, if hello service does all its work in response toouser calls, there is no need for it tooimplement `runAsync()`.</span></span> <span data-ttu-id="88b40-151">É necessário apenas os ouvintes de comunicação hello e seu código associado.</span><span class="sxs-lookup"><span data-stu-id="88b40-151">Only hello communication listeners and their associated code are necessary.</span></span> <span data-ttu-id="88b40-152">Da mesma forma, criando e retornando ouvintes de comunicação é opcional, pois o serviço Olá pode ter apenas em segundo plano toodo de trabalho e então só precisa tooimplement`runAsync()`</span><span class="sxs-lookup"><span data-stu-id="88b40-152">Similarly, creating and returning communication listeners is optional, as hello service may have only background work toodo, and so only needs tooimplement `runAsync()`</span></span>
* <span data-ttu-id="88b40-153">Ele é válido para um serviço toocomplete `runAsync()` com êxito e retorno dele.</span><span class="sxs-lookup"><span data-stu-id="88b40-153">It is valid for a service toocomplete `runAsync()` successfully and return from it.</span></span> <span data-ttu-id="88b40-154">Isso não é considerado uma condição de falha e pode representar o trabalho de plano de fundo Olá Olá serviço concluir.</span><span class="sxs-lookup"><span data-stu-id="88b40-154">This is not considered a failure condition and would represent hello background work of hello service completing.</span></span> <span data-ttu-id="88b40-155">Para serviços confiáveis com monitoração de estado `runAsync()` será chamado novamente se o serviço Olá foram rebaixado do primário e, em seguida, promovida tooprimary voltar.</span><span class="sxs-lookup"><span data-stu-id="88b40-155">For stateful reliable services `runAsync()` would be called again if hello service were demoted from primary and then promoted back tooprimary.</span></span>
* <span data-ttu-id="88b40-156">Se um serviço sai do `runAsync()` lançando uma exceção inesperada, esta é uma falha e o objeto de serviço Olá é desligado e relatou um erro de integridade.</span><span class="sxs-lookup"><span data-stu-id="88b40-156">If a service exits from `runAsync()` by throwing some unexpected exception, this is a failure and hello service object is shut down and a health error reported.</span></span>
* <span data-ttu-id="88b40-157">Embora não haja nenhum limite de tempo no retorno de um desses métodos, você perde imediatamente Olá capacidade toowrite e, portanto, não pode concluir qualquer trabalho real.</span><span class="sxs-lookup"><span data-stu-id="88b40-157">While there is no time limit on returning from these methods, you immediately lose hello ability toowrite and therefore cannot complete any real work.</span></span> <span data-ttu-id="88b40-158">É recomendável que você retorne mais rápido possível após o recebimento da solicitação de cancelamento de saudação.</span><span class="sxs-lookup"><span data-stu-id="88b40-158">It is recommended that you return as quickly as possible upon receiving hello cancellation request.</span></span> <span data-ttu-id="88b40-159">Se o serviço não responder chamadas de API do toothese em um período razoável que do Service Fabric pode forçar cancelar seu serviço.</span><span class="sxs-lookup"><span data-stu-id="88b40-159">If your service does not respond toothese API calls in a reasonable amount of time Service Fabric may forcibly terminate your service.</span></span> <span data-ttu-id="88b40-160">Geralmente isso ocorre apenas durante atualizações de aplicativo ou quando um serviço está sendo excluído.</span><span class="sxs-lookup"><span data-stu-id="88b40-160">Usually this only happens during application upgrades or when a service is being deleted.</span></span> <span data-ttu-id="88b40-161">Esse tempo limite é de 15 minutos por padrão.</span><span class="sxs-lookup"><span data-stu-id="88b40-161">This timeout is 15 minutes by default.</span></span>
* <span data-ttu-id="88b40-162">Falhas em Olá `onCloseAsync()` resultados de caminho em `onAbort()` sendo chamada que é uma oportunidade de melhor esforço de última chance de saudação serviço tooclean backup e liberar todos os recursos que eles já solicitou.</span><span class="sxs-lookup"><span data-stu-id="88b40-162">Failures in hello `onCloseAsync()` path result in `onAbort()` being called which is a last-chance best-effort opportunity for hello service tooclean up and release any resources that they have claimed.</span></span>

> [!NOTE]
> <span data-ttu-id="88b40-163">Ainda não há suporte para Reliable Services com monitoração de estado em java.</span><span class="sxs-lookup"><span data-stu-id="88b40-163">Stateful reliable services are not supported in java yet.</span></span>
>
>

## <a name="next-steps"></a><span data-ttu-id="88b40-164">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="88b40-164">Next steps</span></span>
* [<span data-ttu-id="88b40-165">Serviços de tooReliable de Introdução</span><span class="sxs-lookup"><span data-stu-id="88b40-165">Introduction tooReliable Services</span></span>](service-fabric-reliable-services-introduction.md)
* [<span data-ttu-id="88b40-166">Início Rápido dos Serviços Confiáveis</span><span class="sxs-lookup"><span data-stu-id="88b40-166">Reliable Services quick start</span></span>](service-fabric-reliable-services-quick-start.md)
* [<span data-ttu-id="88b40-167">Uso avançado de Reliable Services</span><span class="sxs-lookup"><span data-stu-id="88b40-167">Reliable Services advanced usage</span></span>](service-fabric-reliable-services-advanced-usage.md)
