---
title: "Análise de Evento do Azure Service Fabric com Application Insights | Microsoft Docs"
description: "Saiba mais sobre visualização e análise de eventos utilizando o Application Insights para o monitoramento e diagnóstico de clusters do Azure Service Fabric."
services: service-fabric
documentationcenter: .net
author: dkkapur
manager: timlt
editor: 
ms.assetid: 
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 05/26/2017
ms.author: dekapur
ms.openlocfilehash: 4085a607b800f4f4f155cdc266bc203b0858fd7c
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/03/2017
---
# <a name="event-analysis-and-visualization-with-application-insights"></a><span data-ttu-id="1bad6-103">Visualização e análise de eventos com o Application Insights</span><span class="sxs-lookup"><span data-stu-id="1bad6-103">Event analysis and visualization with Application Insights</span></span>

<span data-ttu-id="1bad6-104">O Azure Application Insights é uma plataforma extensível para monitoramento e diagnóstico de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="1bad6-104">Azure Application Insights is an extensible platform for application monitoring and diagnostics.</span></span> <span data-ttu-id="1bad6-105">Inclui uma poderosa ferramenta de análise e consulta, visualizações e dashboard personalizável e outras opções, incluindo alertas automatizados.</span><span class="sxs-lookup"><span data-stu-id="1bad6-105">It includes a powerful analytics and querying tool, customizable dashboard and visualizations, and further options including automated alerting.</span></span> <span data-ttu-id="1bad6-106">É a plataforma recomendada para monitoramento e diagnóstico para aplicativos e serviços do Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="1bad6-106">It is the recommended platform for monitoring and diagnostics for Service Fabric applications and services.</span></span>

## <a name="setting-up-application-insights"></a><span data-ttu-id="1bad6-107">Configurando o Application Insights</span><span class="sxs-lookup"><span data-stu-id="1bad6-107">Setting up Application Insights</span></span>

### <a name="creating-an-ai-resource"></a><span data-ttu-id="1bad6-108">Criar um Recurso do AI</span><span class="sxs-lookup"><span data-stu-id="1bad6-108">Creating an AI Resource</span></span>

<span data-ttu-id="1bad6-109">Para criar um recurso do AI, vá para o Azure Marketplace e pesquise por "Application Insights".</span><span class="sxs-lookup"><span data-stu-id="1bad6-109">To create an AI resource, head over to the Azure Marketplace, and search for "Application Insights".</span></span> <span data-ttu-id="1bad6-110">Ele deve aparecer como a primeira solução (está na categoria "Web + Móvel").</span><span class="sxs-lookup"><span data-stu-id="1bad6-110">It should show up as the first solution (it is under category "Web + Mobile").</span></span> <span data-ttu-id="1bad6-111">Clique em **Criar** quando estiver diante do recurso certo (confirme se seu caminho corresponde à imagem abaixo).</span><span class="sxs-lookup"><span data-stu-id="1bad6-111">Click **Create** when you are looking at the right resource (confirm that your path matches the image below).</span></span>

![Novo recurso do Application Insights](media/service-fabric-diagnostics-event-analysis-appinsights/create-new-ai-resource.png)

<span data-ttu-id="1bad6-113">Você precisará preencher algumas informações para fornecer o recurso corretamente.</span><span class="sxs-lookup"><span data-stu-id="1bad6-113">You will need to fill out some information to provision the resource correctly.</span></span> <span data-ttu-id="1bad6-114">No campo *Tipo do Aplicativo* utilize "aplicativo Web ASP.NET" se você estiver utilizando qualquer um dos modelos de programação do Service Fabric ou publicando um aplicativo .NET no cluster.</span><span class="sxs-lookup"><span data-stu-id="1bad6-114">In the *Application Type* field, use "ASP.NET web application" if you will be using any of Service Fabric's programming models or publishing a .NET application to the cluster.</span></span> <span data-ttu-id="1bad6-115">Utilize "Geral" se você estiver implantando contêineres e executáveis do convidado.</span><span class="sxs-lookup"><span data-stu-id="1bad6-115">Use "General" if you will be deploying guest executables and containers.</span></span> <span data-ttu-id="1bad6-116">Em geral, o padrão para usar o "aplicativo Web ASP.NET" para manter suas opções abertas no futuro.</span><span class="sxs-lookup"><span data-stu-id="1bad6-116">In general, default to using "ASP.NET web application" to keep your options open in the future.</span></span> <span data-ttu-id="1bad6-117">O nome é de acordo com sua preferência e tanto o grupo de recursos como a assinatura são pós-implantação alteráveis do recurso.</span><span class="sxs-lookup"><span data-stu-id="1bad6-117">The name is up to your preference, and both the resource group and subscription are changeable post-deployment of the resource.</span></span> <span data-ttu-id="1bad6-118">É recomendável que seu recurso do AI esteja no mesmo grupo de recursos do seu cluster.</span><span class="sxs-lookup"><span data-stu-id="1bad6-118">We recommend that your AI resource is in the same resource group as your cluster.</span></span> <span data-ttu-id="1bad6-119">Caso precise de mais informações, consulte [Criar um recurso do Application Insights](../application-insights/app-insights-create-new-resource.md)</span><span class="sxs-lookup"><span data-stu-id="1bad6-119">If you need more information, please see [Create an Application Insights resource](../application-insights/app-insights-create-new-resource.md)</span></span>

<span data-ttu-id="1bad6-120">É necessário a Chave de Instrumentação do AI para configurar o AI com sua ferramenta de agregação de eventos.</span><span class="sxs-lookup"><span data-stu-id="1bad6-120">You need the AI Instrumentation Key to configure AI with your event aggregation tool.</span></span> <span data-ttu-id="1bad6-121">Quando o recurso do AI for configurado (demora alguns minutos após a validação da implantação), navegue até ele e localize a seção **Propriedades**  na barra de navegação esquerda.</span><span class="sxs-lookup"><span data-stu-id="1bad6-121">Once your AI resource is set up (takes a few minutes after the deployment is validated), navigate to it and find the **Properties** section on the left navigation bar.</span></span> <span data-ttu-id="1bad6-122">Uma nova folha será aberta e exibirá uma *CHAVE DE INSTRUMENTAÇÃO*.</span><span class="sxs-lookup"><span data-stu-id="1bad6-122">A new blade will open up that shows an *INSTRUMENTATION KEY*.</span></span> <span data-ttu-id="1bad6-123">Se for necessário alterar a assinatura ou o grupo de recursos do recurso, isso também poderá feito aqui.</span><span class="sxs-lookup"><span data-stu-id="1bad6-123">If you need to change the subscription or resource group of the resource, it can be done here as well.</span></span>

### <a name="configuring-ai-with-wad"></a><span data-ttu-id="1bad6-124">Configurar o AI com WAD</span><span class="sxs-lookup"><span data-stu-id="1bad6-124">Configuring AI with WAD</span></span>

<span data-ttu-id="1bad6-125">Há duas maneiras primárias de enviar dados do WAD para o AI do Azure, o que é alcançado pela adição de um coletor do AI para a configuração WAD, conforme detalhado [neste artigo](../monitoring-and-diagnostics/azure-diagnostics-configure-application-insights.md).</span><span class="sxs-lookup"><span data-stu-id="1bad6-125">There are two primary ways to send data from WAD to Azure AI, which is achieved by adding an AI sink to the WAD configuration, as detailed in [this article](../monitoring-and-diagnostics/azure-diagnostics-configure-application-insights.md).</span></span>

#### <a name="add-an-ai-instrumentation-key-when-creating-a-cluster-in-azure-portal"></a><span data-ttu-id="1bad6-126">Adicione uma Chave de Instrumentação do AI ao criar um cluster no Portal do Azure</span><span class="sxs-lookup"><span data-stu-id="1bad6-126">Add an AI Instrumentation Key when creating a cluster in Azure portal</span></span>

![Adicionar uma AIKey](media/service-fabric-diagnostics-event-analysis-appinsights/azure-enable-diagnostics.png)

<span data-ttu-id="1bad6-128">Ao criar um cluster, se o Diagnóstico estiver ativado em "On", um campo opcional para inserir uma chave de Instrumentação do Application Insights será exibido.</span><span class="sxs-lookup"><span data-stu-id="1bad6-128">When creating a cluster, if Diagnostics is turned "On", an optional field to enter an Application Insights Instrumentation key will show.</span></span> <span data-ttu-id="1bad6-129">Se você colar a IKey do AI aqui, o coletor do AI será configurado automaticamente para você no modelo do Resource Manager que é utilizado para implantar seu cluster.</span><span class="sxs-lookup"><span data-stu-id="1bad6-129">If you paste your AI IKey here, the AI sink will be automatically configured for you in the Resource Manager template that is used to deploy your cluster.</span></span>

#### <a name="add-the-ai-sink-to-the-resource-manager-template"></a><span data-ttu-id="1bad6-130">Adicione o coletor do AI ao modelo do Resource Manager</span><span class="sxs-lookup"><span data-stu-id="1bad6-130">Add the AI Sink to the Resource Manager template</span></span>

<span data-ttu-id="1bad6-131">No "WadCfg" do modelo do Resource Manager, adicione um "Coletor", incluindo as duas alterações a seguir:</span><span class="sxs-lookup"><span data-stu-id="1bad6-131">In the "WadCfg" of the Resource Manager template, add a "Sink" by including the following two changes:</span></span>

1. <span data-ttu-id="1bad6-132">Adicione a configuração do coletor:</span><span class="sxs-lookup"><span data-stu-id="1bad6-132">Add the sink configuration:</span></span>

    ```json
    "SinksConfig": {
        "Sink": [
            {
                "name": "applicationInsights",
                "ApplicationInsights": "***ADD INSTRUMENTATION KEY HERE***"
            }
        ]
    }

    ```

2. <span data-ttu-id="1bad6-133">Inclua o Coletor na DiagnosticMonitorConfiguration, adicionando a seguinte linha em "DiagnosticMonitorConfiguration" do "WadCfg":</span><span class="sxs-lookup"><span data-stu-id="1bad6-133">Include the Sink in the DiagnosticMonitorConfiguration by adding the following line in "DiagnosticMonitorConfiguration" of the "WadCfg":</span></span>

    ```json
    "sinks": "applicationInsights"
    ```

<span data-ttu-id="1bad6-134">Nos dois trechos de código acima, o nome "applicationInsights" foi utilizado para descrever o coletor.</span><span class="sxs-lookup"><span data-stu-id="1bad6-134">In both the code snippets above, the name "applicationInsights" was used to describe the sink.</span></span> <span data-ttu-id="1bad6-135">Isso não é um requisito e, enquanto o nome do coletor estiver incluído em "coletores", você poderá definir o nome para qualquer cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="1bad6-135">This is not a requirement and as long as the name of the sink is included in "sinks", you can set the name to any string.</span></span>

<span data-ttu-id="1bad6-136">Atualmente, os logs do cluster aparecerão como rastreamentos no visualizador de logs do AI.</span><span class="sxs-lookup"><span data-stu-id="1bad6-136">Currently, logs from the cluster will show up as traces in AI's log viewer.</span></span> <span data-ttu-id="1bad6-137">Como a maioria dos rastreamentos provenientes da plataforma é do nível “Informativo”, considere também a alteração da configuração do coletor para enviar somente logs do tipo “Crítico” ou “Erro”.</span><span class="sxs-lookup"><span data-stu-id="1bad6-137">Since most of the traces coming from the platform are of level "Informational", you can also consider changing the sink configuration to only send logs of type "Critical" or "Error".</span></span> <span data-ttu-id="1bad6-138">Isso pode ser feito adicionando "Canais" ao seu coletor, conforme demonstrado [neste artigo](../monitoring-and-diagnostics/azure-diagnostics-configure-application-insights.md).</span><span class="sxs-lookup"><span data-stu-id="1bad6-138">This can be done by adding "Channels" to your sink, as demonstrated in [this article](../monitoring-and-diagnostics/azure-diagnostics-configure-application-insights.md).</span></span>

>[!NOTE]
><span data-ttu-id="1bad6-139">Se você utilizar IKey do AI incorretamente no portal ou no modelo do Resource Manager, será necessário alterar manualmente a chave e atualizar o cluster/reimplementá-la.</span><span class="sxs-lookup"><span data-stu-id="1bad6-139">If you use an incorrect AI IKey either in portal or in your Resource Manager template, you will have to manually change the key and update the cluster / redeploy it.</span></span> 

### <a name="configuring-ai-with-eventflow"></a><span data-ttu-id="1bad6-140">Configurar AI com EventFlow</span><span class="sxs-lookup"><span data-stu-id="1bad6-140">Configuring AI with EventFlow</span></span>

<span data-ttu-id="1bad6-141">Se você estiver utilizando EventFlow para agregar eventos, certifique-se de importar o pacote `Microsoft.Diagnostics.EventFlow.Output.ApplicationInsights`NuGet.</span><span class="sxs-lookup"><span data-stu-id="1bad6-141">If you are using EventFlow to aggregate events, make sure to import the `Microsoft.Diagnostics.EventFlow.Output.ApplicationInsights`NuGet package.</span></span> <span data-ttu-id="1bad6-142">O seguinte deve ser incluído na seção *saídas* do *eventFlowConfig.json*:</span><span class="sxs-lookup"><span data-stu-id="1bad6-142">The following has to be included in the *outputs* section of the *eventFlowConfig.json*:</span></span>

```json
"outputs": [
    {
        "type": "ApplicationInsights",
        // (replace the following value with your AI resource's instrumentation key)
        "instrumentationKey": "00000000-0000-0000-0000-000000000000"
    }
]
```

<span data-ttu-id="1bad6-143">Certifique-se de fazer as alterações necessárias nos filtros, assim como incluir quaisquer outras entradas (em conjunto com os respectivos pacotes NuGet).</span><span class="sxs-lookup"><span data-stu-id="1bad6-143">Make sure to make the required changes in your filters, as well as include any other inputs (along with their respective NuGet packages).</span></span>

## <a name="aisdk"></a><span data-ttu-id="1bad6-144">AI.SDK</span><span class="sxs-lookup"><span data-stu-id="1bad6-144">AI.SDK</span></span>

<span data-ttu-id="1bad6-145">Em geral, é recomendável utilizar EventFlow e WAD como soluções de agregação porque permitem uma abordagem mais modular para diagnósticos e monitoramento, ou seja, se você deseja alterar suas saídas do EventFlow isso não requer nenhuma alteração na sua instrumentação real, apenas uma modificação simples do seu arquivo de configuração.</span><span class="sxs-lookup"><span data-stu-id="1bad6-145">It is generally recommended to use EventFlow and WAD as aggregation solutions, because they allow for a more modular approach to diagnostics and monitoring, i.e. if you want to change your outputs from EventFlow, it requires no change to your actual instrumentation, just a simple modification to your config file.</span></span> <span data-ttu-id="1bad6-146">No entanto, se você decidir investir na utilização do Application Insights e não é provável que mude para uma plataforma diferente, será necessário procurar usar o novo SDK do AI para agregar eventos e enviá-los ao AI.</span><span class="sxs-lookup"><span data-stu-id="1bad6-146">If, however, you decide to invest in using Application Insights and are not likely to change to a different platform, you should look into using AI's new SDK for aggregating events and sending them to AI.</span></span> <span data-ttu-id="1bad6-147">Isso significa que não será mais necessário configurar o EventFlow para enviar os dados para o AI, mas, em vez disso, irá instalar o pacote do NuGet Service Fabric do Application Insight.</span><span class="sxs-lookup"><span data-stu-id="1bad6-147">This means that you will no longer have to configure EventFlow to send your data to AI, but instead will install the ApplicationInsight's Service Fabric NuGet package.</span></span> <span data-ttu-id="1bad6-148">Detalhes sobre o pacote podem ser encontrados [aqui](https://github.com/Microsoft/ApplicationInsights-ServiceFabric).</span><span class="sxs-lookup"><span data-stu-id="1bad6-148">Details on the package can be found [here](https://github.com/Microsoft/ApplicationInsights-ServiceFabric).</span></span>

<span data-ttu-id="1bad6-149">[O suporte do Application Insights para Microsserviços e Contêineres](https://azure.microsoft.com/app-insights-microservices/) apresenta alguns dos novos recursos que estão sendo trabalhados (atualmente ainda em versão beta), os quais permitem que você tenha opções de monitoramento prontas para uso com o AI.</span><span class="sxs-lookup"><span data-stu-id="1bad6-149">[Application Insights support for Microservices and Containers](https://azure.microsoft.com/app-insights-microservices/) shows you some of the new features that are being worked on (currently still in beta), which allow you to have richer out-of-the-box monitoring options with AI.</span></span> <span data-ttu-id="1bad6-150">Isso inclui o acompanhamento de dependência (utilizado na construção de um AppMap de todos os seus serviços e aplicativos em um cluster e a comunicação entre eles) e uma melhor correlação de rastreamentos provenientes de seus serviços (ajuda a identificar melhor um problema no fluxo de trabalho de um aplicativo ou serviço).</span><span class="sxs-lookup"><span data-stu-id="1bad6-150">These include dependency tracking (used in building an AppMap of all your services and applications in a cluster and the communication between them), and better correlation of traces coming from your services (helps in better pinpointing an issue in the workflow of an app or service).</span></span>

<span data-ttu-id="1bad6-151">Se você estiver desenvolvendo em .NET e provavelmente estará usando alguns dos modelos de programação do Service Fabric, e disposto a utilizar o AI como sua plataforma para visualizar e analisar dados de eventos e logs, então, é recomendável que você vá via a rota SDK do AI como seu fluxo de trabalho de diagnóstico e monitoramento.</span><span class="sxs-lookup"><span data-stu-id="1bad6-151">If you are developing in .NET and will likely be using some of Service Fabric's programming models, and are willing to use AI as your platform for visualizing and analyzing event and log data, then we recommend that you go via the AI SDK route as your monitoring and diagnostics workflow.</span></span> <span data-ttu-id="1bad6-152">Leia [este](../application-insights/app-insights-asp-net-more.md) e [este](../application-insights/app-insights-asp-net-trace-logs.md) para começar a utilizar o AI para coletar e exibir seus logs.</span><span class="sxs-lookup"><span data-stu-id="1bad6-152">Read [this](../application-insights/app-insights-asp-net-more.md) and [this](../application-insights/app-insights-asp-net-trace-logs.md) to get started with using AI to collect and display your logs.</span></span>

## <a name="navigating-the-ai-resource-in-azure-portal"></a><span data-ttu-id="1bad6-153">Navegar pelo recurso do AI no Portal do Azure</span><span class="sxs-lookup"><span data-stu-id="1bad6-153">Navigating the AI resource in Azure portal</span></span>

<span data-ttu-id="1bad6-154">Depois de configurar o AI como saída para seus eventos e logs, as informações deverão começar a aparecer no recurso do AI em alguns minutos.</span><span class="sxs-lookup"><span data-stu-id="1bad6-154">Once you have configured AI as an output for your events and logs, information should start to show up in your AI resource in a few minutes.</span></span> <span data-ttu-id="1bad6-155">Navegue até o recurso do AI, o qual o direcionará para o dashboard de recurso do AI.</span><span class="sxs-lookup"><span data-stu-id="1bad6-155">Navigate to the AI resource, which will take you to the AI resource dashboard.</span></span> <span data-ttu-id="1bad6-156">Clique em **Pesquisar** na barra de tarefas do AI para visualizar os últimos rastreamentos recebidos e poder filtrar através deles.</span><span class="sxs-lookup"><span data-stu-id="1bad6-156">Click **Search** in the AI taskbar to see the latest traces that it has received, and to be able to filter through them.</span></span>

<span data-ttu-id="1bad6-157">*Metrics Explorer* é uma ferramenta útil para criar painéis personalizados com base em métricas que seus aplicativos, serviços e clusters podem estar reportando.</span><span class="sxs-lookup"><span data-stu-id="1bad6-157">*Metrics Explorer* is a useful tool for creating custom dashboards based on metrics that your applications, services, and cluster may be reporting.</span></span> <span data-ttu-id="1bad6-158">Consulte [Exploring Metrics no Application Insights](../application-insights/app-insights-metrics-explorer.md) para configurar alguns gráficos com base nos dados que você está coletando.</span><span class="sxs-lookup"><span data-stu-id="1bad6-158">See [Exploring Metrics in Application Insights](../application-insights/app-insights-metrics-explorer.md) to set up a few charts for yourself based on the data you are collecting.</span></span>

<span data-ttu-id="1bad6-159">Ao clicar em **Análise** você será direcionado para o portal de Análise do Application Insights, onde poderá consultar eventos e rastreamentos com maior escopo e opcionalidade.</span><span class="sxs-lookup"><span data-stu-id="1bad6-159">Clicking **Analytics** will take you to the Application Insights Analytics portal, where you can query events and traces with greater scope and optionality.</span></span> <span data-ttu-id="1bad6-160">Leia mais sobre isso em [Análise no Application Insights](../application-insights/app-insights-analytics.md).</span><span class="sxs-lookup"><span data-stu-id="1bad6-160">Read more about this at [Analytics in Application Insights](../application-insights/app-insights-analytics.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="1bad6-161">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="1bad6-161">Next steps</span></span>

* <span data-ttu-id="1bad6-162">[Configurar alertas no AI](../application-insights/app-insights-alerts.md) para ser notificado sobre mudanças no desempenho ou uso</span><span class="sxs-lookup"><span data-stu-id="1bad6-162">[Set up Alerts in AI](../application-insights/app-insights-alerts.md) to be notified about changes in performance or usage</span></span>
* <span data-ttu-id="1bad6-163">[Detecção Inteligente no Application Insights](../application-insights/app-insights-proactive-diagnostics.md) realiza uma análise pró-ativa da telemetria enviada ao AI para avisá-lo sobre possíveis problemas de desempenho</span><span class="sxs-lookup"><span data-stu-id="1bad6-163">[Smart Detection in Application Insights](../application-insights/app-insights-proactive-diagnostics.md) performs a proactive analysis of the telemetry being sent to AI to warn you of potential performance problems</span></span>