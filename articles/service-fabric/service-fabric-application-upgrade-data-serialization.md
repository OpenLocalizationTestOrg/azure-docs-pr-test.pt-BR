---
title: "Atualização de aplicativos: serialização de dados | Microsoft Docs"
description: "Práticas recomendadas para a serialização de dados e como ela afeta as atualizações de aplicativo sem interrupção."
services: service-fabric
documentationcenter: .net
author: vturecek
manager: timlt
editor: 
ms.assetid: a5f36366-a2ab-4ae3-bb08-bc2f9533bc5a
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/29/2017
ms.author: vturecek
ms.openlocfilehash: 6aa3ac7842df4657fca7f6b4264e1c6fe52dc0c6
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="how-data-serialization-affects-an-application-upgrade"></a><span data-ttu-id="9bce6-103">Como a serialização de dados afeta a atualização de um aplicativo</span><span class="sxs-lookup"><span data-stu-id="9bce6-103">How data serialization affects an application upgrade</span></span>
<span data-ttu-id="9bce6-104">Em uma [atualização de aplicativo sem interrupção](service-fabric-application-upgrade.md), a atualização é aplicada a um subconjunto de nós, um domínio de atualização de cada vez.</span><span class="sxs-lookup"><span data-stu-id="9bce6-104">In a [rolling application upgrade](service-fabric-application-upgrade.md), the upgrade is applied to a subset of nodes, one upgrade domain at a time.</span></span> <span data-ttu-id="9bce6-105">Durante esse processo, alguns domínios de atualização têm a versão mais recente do aplicativo, enquanto outros têm a versão mais antiga do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="9bce6-105">During this process, some upgrade domains are on the newer version of your application, and some upgrade domains are on the older version of your application.</span></span> <span data-ttu-id="9bce6-106">Durante a distribuição, a nova versão do seu aplicativo deve ser capaz de ler a versão antiga dos dados, e a versão antiga do seu aplicativo deve ser capaz de ler a nova versão dos dados.</span><span class="sxs-lookup"><span data-stu-id="9bce6-106">During the rollout, the new version of your application must be able to read the old version of your data, and the old version of your application must be able to read the new version of your data.</span></span> <span data-ttu-id="9bce6-107">Se o formato de dados não for compatível com versões anteriores e posteriores, a atualização poderá falhar ou, pior ainda, os dados poderão ser perdidos ou corrompidos.</span><span class="sxs-lookup"><span data-stu-id="9bce6-107">If the data format is not forward and backward compatible, the upgrade may fail, or worse, data may be lost or corrupted.</span></span> <span data-ttu-id="9bce6-108">Este artigo discute o que constitui o formato de dados e oferece as práticas recomendadas para garantir que seus dados sejam compatíveis de uma versão para outra.</span><span class="sxs-lookup"><span data-stu-id="9bce6-108">This article discusses what constitutes your data format and offers best practices for ensuring that your data is forward and backward compatible.</span></span>

## <a name="what-makes-up-your-data-format"></a><span data-ttu-id="9bce6-109">O que compõe o seu formato de dados?</span><span class="sxs-lookup"><span data-stu-id="9bce6-109">What makes up your data format?</span></span>
<span data-ttu-id="9bce6-110">No Service Fabric do Azure, os dados persistidos e replicados vêm de suas classes C#.</span><span class="sxs-lookup"><span data-stu-id="9bce6-110">In Azure Service Fabric, the data that is persisted and replicated comes from your C# classes.</span></span> <span data-ttu-id="9bce6-111">Para aplicativos que usam [Coleções Confiáveis](service-fabric-reliable-services-reliable-collections.md), esses dados são os objetos nos dicionários e nas filas confiáveis.</span><span class="sxs-lookup"><span data-stu-id="9bce6-111">For applications that use [Reliable Collections](service-fabric-reliable-services-reliable-collections.md), that data is the objects in the reliable dictionaries and queues.</span></span> <span data-ttu-id="9bce6-112">Para aplicativos que usam [Reliable Actors](service-fabric-reliable-actors-introduction.md), esse é o estado de backup do ator.</span><span class="sxs-lookup"><span data-stu-id="9bce6-112">For applications that use [Reliable Actors](service-fabric-reliable-actors-introduction.md), that is the backing state for the actor.</span></span> <span data-ttu-id="9bce6-113">Essas classes C# devem ser serializáveis para que possam ser persistidas e replicadas.</span><span class="sxs-lookup"><span data-stu-id="9bce6-113">These C# classes must be serializable to be persisted and replicated.</span></span> <span data-ttu-id="9bce6-114">Portanto, o formato de dados é definido por campos e propriedades que são serializados e por como eles são serializados.</span><span class="sxs-lookup"><span data-stu-id="9bce6-114">Therefore, the data format is defined by the fields and properties that are serialized, as well as how they are serialized.</span></span> <span data-ttu-id="9bce6-115">Por exemplo, em um `IReliableDictionary<int, MyClass>` os dados são `int` serializados e `MyClass` serializadas.</span><span class="sxs-lookup"><span data-stu-id="9bce6-115">For example, in an `IReliableDictionary<int, MyClass>` the data is a serialized `int` and a serialized `MyClass`.</span></span>

### <a name="code-changes-that-result-in-a-data-format-change"></a><span data-ttu-id="9bce6-116">Alterações de código que resultam em uma alteração no formato dos dados</span><span class="sxs-lookup"><span data-stu-id="9bce6-116">Code changes that result in a data format change</span></span>
<span data-ttu-id="9bce6-117">Uma vez que o formato de dados é determinado pelas classes C#, alterações nas classes podem causar uma alteração no formato de dados.</span><span class="sxs-lookup"><span data-stu-id="9bce6-117">Since the data format is determined by C# classes, changes to the classes may cause a data format change.</span></span> <span data-ttu-id="9bce6-118">É necessário ter cuidado para garantir que uma atualização sem interrupção possa lidar com a alteração do formato de dados.</span><span class="sxs-lookup"><span data-stu-id="9bce6-118">Care must be taken to ensure that a rolling upgrade can handle the data format change.</span></span> <span data-ttu-id="9bce6-119">Exemplos que podem causar alterações no formato de dados:</span><span class="sxs-lookup"><span data-stu-id="9bce6-119">Examples that may cause data format changes:</span></span>

* <span data-ttu-id="9bce6-120">Adicionar ou remover campos ou propriedades</span><span class="sxs-lookup"><span data-stu-id="9bce6-120">Adding or removing fields or properties</span></span>
* <span data-ttu-id="9bce6-121">Renomear campos ou propriedades</span><span class="sxs-lookup"><span data-stu-id="9bce6-121">Renaming fields or properties</span></span>
* <span data-ttu-id="9bce6-122">Alterar os tipos de campo ou propriedades</span><span class="sxs-lookup"><span data-stu-id="9bce6-122">Changing the types of fields or properties</span></span>
* <span data-ttu-id="9bce6-123">Alterar o nome de classe ou namespace</span><span class="sxs-lookup"><span data-stu-id="9bce6-123">Changing the class name or namespace</span></span>

### <a name="data-contract-as-the-default-serializer"></a><span data-ttu-id="9bce6-124">Contrato de Dados como o serializador padrão</span><span class="sxs-lookup"><span data-stu-id="9bce6-124">Data Contract as the default serializer</span></span>
<span data-ttu-id="9bce6-125">O serializador é geralmente responsável por ler os dados e desserializá-los para a versão atual mesmo se os dados estiverem em uma versão mais antiga ou *mais recente* .</span><span class="sxs-lookup"><span data-stu-id="9bce6-125">The serializer is generally responsible for reading the data and deserializing it into the current version, even if the data is in an older or *newer* version.</span></span> <span data-ttu-id="9bce6-126">O serializador padrão é o [serializador de contrato de dados](https://msdn.microsoft.com/library/ms733127.aspx), que tem regras de controle de versão bem definidas.</span><span class="sxs-lookup"><span data-stu-id="9bce6-126">The default serializer is the [Data Contract serializer](https://msdn.microsoft.com/library/ms733127.aspx), which has well-defined versioning rules.</span></span> <span data-ttu-id="9bce6-127">As Coleções confiáveis permitem que o serializador seja substituído, mas os Reliable Actors ainda não.</span><span class="sxs-lookup"><span data-stu-id="9bce6-127">Reliable Collections allow the serializer to be overridden, but Reliable Actors currently do not.</span></span> <span data-ttu-id="9bce6-128">O serializador de dados desempenha um papel importante na habilitação de atualizações sem interrupção.</span><span class="sxs-lookup"><span data-stu-id="9bce6-128">The data serializer plays an important role in enabling rolling upgrades.</span></span> <span data-ttu-id="9bce6-129">O serializador de Contrato de Dados é o serializador recomendado para os aplicativos do Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="9bce6-129">The Data Contract serializer is the serializer that we recommend for Service Fabric applications.</span></span>

## <a name="how-the-data-format-affects-a-rolling-upgrade"></a><span data-ttu-id="9bce6-130">Como o formato de dados afeta uma atualização sem interrupção</span><span class="sxs-lookup"><span data-stu-id="9bce6-130">How the data format affects a rolling upgrade</span></span>
<span data-ttu-id="9bce6-131">Durante uma atualização sem interrupção, há dois cenários principais em que o serializador pode encontrar versão mais antiga ou *mais recente* dos dados:</span><span class="sxs-lookup"><span data-stu-id="9bce6-131">During a rolling upgrade, there are two main scenarios where the serializer may encounter an older or *newer* version of your data:</span></span>

1. <span data-ttu-id="9bce6-132">Depois que um nó é atualizado e inicia o backup, o novo serializador carrega os dados que foram mantidos em disco pela versão antiga.</span><span class="sxs-lookup"><span data-stu-id="9bce6-132">After a node is upgraded and starts back up, the new serializer will load the data that was persisted to disk by the old version.</span></span>
2. <span data-ttu-id="9bce6-133">Durante a atualização sem interrupção, o cluster conterá uma combinação das versões antiga e nova do seu código.</span><span class="sxs-lookup"><span data-stu-id="9bce6-133">During the rolling upgrade, the cluster will contain a mix of the old and new versions of your code.</span></span> <span data-ttu-id="9bce6-134">Como as réplicas podem ser colocadas em diferentes domínios de atualização, e as réplicas enviam dados entre si, a versão nova e/ou antiga de seus dados pode ser encontrada pela versão nova e/ou antiga do seu serializador.</span><span class="sxs-lookup"><span data-stu-id="9bce6-134">Since replicas may be placed in different upgrade domains, and replicas send data to each other, the new and/or old version of your data may be encountered by the new and/or old version of your serializer.</span></span>

> [!NOTE]
> <span data-ttu-id="9bce6-135">A "nova versão" e "versão antiga" aqui se referem à versão do seu código que está em execução.</span><span class="sxs-lookup"><span data-stu-id="9bce6-135">The "new version" and "old version" here refer to the version of your code that is running.</span></span> <span data-ttu-id="9bce6-136">"Novo serializador" refere-se ao código do serializador que está sendo executado na nova versão de seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="9bce6-136">The "new serializer" refers to the serializer code that is executing in the new version of your application.</span></span> <span data-ttu-id="9bce6-137">"Novos dados" refere-se à classe C# serializada da nova versão do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="9bce6-137">The "new data" refers to the serialized C# class from the new version of your application.</span></span>
> 
> 

<span data-ttu-id="9bce6-138">As duas versões do formato de dados e código devem ser compatíveis uma com a outra.</span><span class="sxs-lookup"><span data-stu-id="9bce6-138">The two versions of code and data format must be both forward and backward compatible.</span></span> <span data-ttu-id="9bce6-139">Se não forem compatíveis, a atualização sem interrupção pode falhar ou dados podem ser perdidos.</span><span class="sxs-lookup"><span data-stu-id="9bce6-139">If they are not compatible, the rolling upgrade may fail or data may be lost.</span></span> <span data-ttu-id="9bce6-140">A atualização sem interrupção pode falhar porque o código ou o serializador pode acionar exceções ou falhas ao encontrar a outra versão.</span><span class="sxs-lookup"><span data-stu-id="9bce6-140">The rolling upgrade may fail because the code or serializer may throw exceptions or a fault when it encounters the other version.</span></span> <span data-ttu-id="9bce6-141">Dados podem ser perdidos se, por exemplo, uma nova propriedade foi adicionada, mas o serializador antigo a descartar durante a desserialização.</span><span class="sxs-lookup"><span data-stu-id="9bce6-141">Data may be lost if, for example, a new property was added but the old serializer discards it during deserialization.</span></span>

<span data-ttu-id="9bce6-142">O Contrato de Dados é a solução recomendada para garantir que seus dados sejam compatíveis.</span><span class="sxs-lookup"><span data-stu-id="9bce6-142">Data Contract is the recommended solution for ensuring that your data is compatible.</span></span> <span data-ttu-id="9bce6-143">Ele possui regras de versão bem definidas para adição, remoção e alteração de campos.</span><span class="sxs-lookup"><span data-stu-id="9bce6-143">It has well-defined versioning rules for adding, removing, and changing fields.</span></span> <span data-ttu-id="9bce6-144">Ele também tem suporte para lidar com campos desconhecidos, conectando-se ao processo de serialização e desserialização e lidando com a herança de classe.</span><span class="sxs-lookup"><span data-stu-id="9bce6-144">It also has support for dealing with unknown fields, hooking into the serialization and deserialization process, and dealing with class inheritance.</span></span> <span data-ttu-id="9bce6-145">Para saber mais, confira [Usando o contrato de dados](https://msdn.microsoft.com/library/ms733127.aspx).</span><span class="sxs-lookup"><span data-stu-id="9bce6-145">For more information, see [Using Data Contract](https://msdn.microsoft.com/library/ms733127.aspx).</span></span>

## <a name="next-steps"></a><span data-ttu-id="9bce6-146">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="9bce6-146">Next steps</span></span>
<span data-ttu-id="9bce6-147">[Atualização do aplicativo usando o Visual Studio](service-fabric-application-upgrade-tutorial.md) orienta você durante a atualização de aplicativo usando o Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="9bce6-147">[Upgrading your Application Using Visual Studio](service-fabric-application-upgrade-tutorial.md) walks you through an application upgrade using Visual Studio.</span></span>

<span data-ttu-id="9bce6-148">[Atualização do aplicativo usando o PowerShell](service-fabric-application-upgrade-tutorial-powershell.md) orienta você uma atualização de aplicativo usando o PowerShell.</span><span class="sxs-lookup"><span data-stu-id="9bce6-148">[Upgrading your Application Using Powershell](service-fabric-application-upgrade-tutorial-powershell.md) walks you through an application upgrade using PowerShell.</span></span>

<span data-ttu-id="9bce6-149">Controle como seu aplicativo é atualizado usando [Parâmetros de Atualização](service-fabric-application-upgrade-parameters.md).</span><span class="sxs-lookup"><span data-stu-id="9bce6-149">Control how your application upgrades by using [Upgrade Parameters](service-fabric-application-upgrade-parameters.md).</span></span>

<span data-ttu-id="9bce6-150">Saiba como usar a funcionalidade avançada ao atualizar seu aplicativo consultando os [Tópicos Avançados](service-fabric-application-upgrade-advanced.md).</span><span class="sxs-lookup"><span data-stu-id="9bce6-150">Learn how to use advanced functionality while upgrading your application by referring to [Advanced Topics](service-fabric-application-upgrade-advanced.md).</span></span>

<span data-ttu-id="9bce6-151">Corrija problemas comuns em atualizações de aplicativo consultando as etapas em [Solucionando Problemas de Atualizações de Aplicativo ](service-fabric-application-upgrade-troubleshooting.md).</span><span class="sxs-lookup"><span data-stu-id="9bce6-151">Fix common problems in application upgrades by referring to the steps in [Troubleshooting Application Upgrades ](service-fabric-application-upgrade-troubleshooting.md).</span></span>

