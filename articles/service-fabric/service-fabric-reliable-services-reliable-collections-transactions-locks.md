---
title: "aaaTransactions e modos de bloqueio no Azure Service Fabric confiável coleções | Microsoft Docs"
description: "Gerenciador de estado confiável do Azure Service Fabric e Bloqueio e Transações de Coleções Confiáveis."
services: service-fabric
documentationcenter: .net
author: mcoskun
manager: timlt
editor: masnider,rajak
ms.assetid: 62857523-604b-434e-bd1c-2141ea4b00d1
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: required
ms.date: 5/1/2017
ms.author: mcoskun
ms.openlocfilehash: 340e029aa98f43ad6e46b48f687dad01f9d96f69
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="transactions-and-lock-modes-in-azure-service-fabric-reliable-collections"></a><span data-ttu-id="6c863-103">Transações e modos de bloqueio em Coleções Confiáveis do Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="6c863-103">Transactions and lock modes in Azure Service Fabric Reliable Collections</span></span>

## <a name="transaction"></a><span data-ttu-id="6c863-104">Transação</span><span class="sxs-lookup"><span data-stu-id="6c863-104">Transaction</span></span>
<span data-ttu-id="6c863-105">Uma transação é uma sequência de operações realizadas como uma única unidade lógica de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6c863-105">A transaction is a sequence of operations performed as a single logical unit of work.</span></span>
<span data-ttu-id="6c863-106">Uma transação deve apresentar Olá propriedades ACID a seguir.</span><span class="sxs-lookup"><span data-stu-id="6c863-106">A transaction must exhibit hello following ACID properties.</span></span> <span data-ttu-id="6c863-107">(consulte: https://technet.microsoft.com/en-us/library/ms190612)</span><span class="sxs-lookup"><span data-stu-id="6c863-107">(see: https://technet.microsoft.com/en-us/library/ms190612)</span></span>
* <span data-ttu-id="6c863-108">**Atomicidade**: uma transação deve ser uma unidade atômica de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6c863-108">**Atomicity**: A transaction must be an atomic unit of work.</span></span> <span data-ttu-id="6c863-109">Em outras palavras, todas as suas modificações de dados são realizadas ou nenhuma delas é realizada.</span><span class="sxs-lookup"><span data-stu-id="6c863-109">In other words, either all its data modifications are performed, or none of them is performed.</span></span>
* <span data-ttu-id="6c863-110">**Consistência**: quando concluída, uma transação deve deixar todos os dados em um estado consistente.</span><span class="sxs-lookup"><span data-stu-id="6c863-110">**Consistency**: When completed, a transaction must leave all data in a consistent state.</span></span> <span data-ttu-id="6c863-111">Todas as estruturas de dados internos devem estar corretas no final de saudação da transação de saudação.</span><span class="sxs-lookup"><span data-stu-id="6c863-111">All internal data structures must be correct at hello end of hello transaction.</span></span>
* <span data-ttu-id="6c863-112">**Isolamento**: as modificações feitas por transações simultâneas devem ser isoladas contra modificações de saudação feitas por qualquer outra transação simultânea.</span><span class="sxs-lookup"><span data-stu-id="6c863-112">**Isolation**: Modifications made by concurrent transactions must be isolated from hello modifications made by any other concurrent transactions.</span></span> <span data-ttu-id="6c863-113">nível de isolamento de saudação usado para uma operação em um ITransaction é determinado pelo Olá IReliableState executar operação de saudação.</span><span class="sxs-lookup"><span data-stu-id="6c863-113">hello isolation level used for an operation within an ITransaction is determined by hello IReliableState performing hello operation.</span></span>
* <span data-ttu-id="6c863-114">**Durabilidade**: após uma transação, seus efeitos ficam permanentemente no sistema de saudação.</span><span class="sxs-lookup"><span data-stu-id="6c863-114">**Durability**: After a transaction has completed, its effects are permanently in place in hello system.</span></span> <span data-ttu-id="6c863-115">modificações de saudação persistirem mesmo em caso de saudação de uma falha do sistema.</span><span class="sxs-lookup"><span data-stu-id="6c863-115">hello modifications persist even in hello event of a system failure.</span></span>

### <a name="isolation-levels"></a><span data-ttu-id="6c863-116">Níveis de isolamento</span><span class="sxs-lookup"><span data-stu-id="6c863-116">Isolation levels</span></span>
<span data-ttu-id="6c863-117">Nível de isolamento define o grau de saudação transações de saudação toowhich devem ser isoladas das modificações feitas por outras transações.</span><span class="sxs-lookup"><span data-stu-id="6c863-117">Isolation level defines hello degree toowhich hello transaction must be isolated from modifications made by other transactions.</span></span>
<span data-ttu-id="6c863-118">Há dois níveis de isolamento com suporte nas Coleções Confiáveis:</span><span class="sxs-lookup"><span data-stu-id="6c863-118">There are two isolation levels that are supported in Reliable Collections:</span></span>

* <span data-ttu-id="6c863-119">**Leitura repetida**: Especifica que as instruções não podem ler dados que foram modificados, mas ainda não foram confirmados por outras transações e que nenhuma outra transação pode modificar dados que foram lidos pela transação atual de saudação até Olá atual conclusão da transação.</span><span class="sxs-lookup"><span data-stu-id="6c863-119">**Repeatable Read**: Specifies that statements cannot read data that has been modified but not yet committed by other transactions and that no other transactions can modify data that has been read by hello current transaction until hello current transaction finishes.</span></span> <span data-ttu-id="6c863-120">Para obter mais detalhes, consulte [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span><span class="sxs-lookup"><span data-stu-id="6c863-120">For more details, see [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span></span>
* <span data-ttu-id="6c863-121">**Instantâneo**: Especifica que os dados lidos por qualquer instrução em uma transação são a versão transacionalmente consistente Olá dos dados Olá que existiam no início de saudação da transação de saudação.</span><span class="sxs-lookup"><span data-stu-id="6c863-121">**Snapshot**: Specifies that data read by any statement in a transaction is hello transactionally consistent version of hello data that existed at hello start of hello transaction.</span></span>
  <span data-ttu-id="6c863-122">transação Olá pode reconhecer apenas modificações de dados que foram confirmadas antes do início de saudação da transação de saudação.</span><span class="sxs-lookup"><span data-stu-id="6c863-122">hello transaction can recognize only data modifications that were committed before hello start of hello transaction.</span></span>
  <span data-ttu-id="6c863-123">Modificações de dados feitas por outras transações após Olá início da transação atual Olá não são visíveis toostatements execução na transação atual hello.</span><span class="sxs-lookup"><span data-stu-id="6c863-123">Data modifications made by other transactions after hello start of hello current transaction are not visible toostatements executing in hello current transaction.</span></span>
  <span data-ttu-id="6c863-124">efeito Olá é como se instruções Olá em uma transação de um instantâneo dos dados Olá confirmada conforme se encontravam no início de saudação da transação de saudação.</span><span class="sxs-lookup"><span data-stu-id="6c863-124">hello effect is as if hello statements in a transaction get a snapshot of hello committed data as it existed at hello start of hello transaction.</span></span>
  <span data-ttu-id="6c863-125">Os instantâneos são consistentes entre as Coleções Confiáveis.</span><span class="sxs-lookup"><span data-stu-id="6c863-125">Snapshots are consistent across Reliable Collections.</span></span>
  <span data-ttu-id="6c863-126">Para obter mais detalhes, consulte [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span><span class="sxs-lookup"><span data-stu-id="6c863-126">For more details, see [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span></span>

<span data-ttu-id="6c863-127">Coleções confiáveis automaticamente escolha toouse de nível de isolamento Olá para uma determinada operação leitura dependendo da operação de saudação e função hello da réplica Olá no tempo de saudação da criação da transação.</span><span class="sxs-lookup"><span data-stu-id="6c863-127">Reliable Collections automatically choose hello isolation level toouse for a given read operation depending on hello operation and hello role of hello replica at hello time of transaction's creation.</span></span>
<span data-ttu-id="6c863-128">A seguir é a tabela de saudação que descreve os padrões de nível de isolamento para operações de fila e dicionário confiável.</span><span class="sxs-lookup"><span data-stu-id="6c863-128">Following is hello table that depicts isolation level defaults for Reliable Dictionary and Queue operations.</span></span>

| <span data-ttu-id="6c863-129">Operação\função</span><span class="sxs-lookup"><span data-stu-id="6c863-129">Operation \ Role</span></span> | <span data-ttu-id="6c863-130">Primário</span><span class="sxs-lookup"><span data-stu-id="6c863-130">Primary</span></span> | <span data-ttu-id="6c863-131">Secundário</span><span class="sxs-lookup"><span data-stu-id="6c863-131">Secondary</span></span> |
| --- |:--- |:--- |
| <span data-ttu-id="6c863-132">Leitura de entidade única</span><span class="sxs-lookup"><span data-stu-id="6c863-132">Single Entity Read</span></span> |<span data-ttu-id="6c863-133">Leitura repetida</span><span class="sxs-lookup"><span data-stu-id="6c863-133">Repeatable Read</span></span> |<span data-ttu-id="6c863-134">Instantâneo</span><span class="sxs-lookup"><span data-stu-id="6c863-134">Snapshot</span></span> |
| <span data-ttu-id="6c863-135">Enumeração, Contagem</span><span class="sxs-lookup"><span data-stu-id="6c863-135">Enumeration, Count</span></span> |<span data-ttu-id="6c863-136">Instantâneo</span><span class="sxs-lookup"><span data-stu-id="6c863-136">Snapshot</span></span> |<span data-ttu-id="6c863-137">Instantâneo</span><span class="sxs-lookup"><span data-stu-id="6c863-137">Snapshot</span></span> |

> [!NOTE]
> <span data-ttu-id="6c863-138">Exemplos comuns de Operações de Entidade Única são `IReliableDictionary.TryGetValueAsync`, `IReliableQueue.TryPeekAsync`.</span><span class="sxs-lookup"><span data-stu-id="6c863-138">Common examples for Single Entity Operations are `IReliableDictionary.TryGetValueAsync`, `IReliableQueue.TryPeekAsync`.</span></span>
> 

<span data-ttu-id="6c863-139">Olá dicionário confiável e Olá fila confiável suportam grava seu de leitura.</span><span class="sxs-lookup"><span data-stu-id="6c863-139">Both hello Reliable Dictionary and hello Reliable Queue support Read Your Writes.</span></span>
<span data-ttu-id="6c863-140">Em outras palavras, qualquer gravação dentro de uma transação serão visíveis tooa seguinte lidos que pertence a toohello mesma transação.</span><span class="sxs-lookup"><span data-stu-id="6c863-140">In other words, any write within a transaction will be visible tooa following read that belongs toohello same transaction.</span></span>

## <a name="locks"></a><span data-ttu-id="6c863-141">Bloqueios</span><span class="sxs-lookup"><span data-stu-id="6c863-141">Locks</span></span>
<span data-ttu-id="6c863-142">Em coleções confiável, todas as transações de implementar rigorosos duas fases de bloqueio: uma transação não liberar bloqueios Olá adquiriu até que a transação Olá termina com uma operação de anulação ou uma confirmação.</span><span class="sxs-lookup"><span data-stu-id="6c863-142">In Reliable Collections, all transactions implement rigorous two phase locking: a transaction does not release hello locks it has acquired until hello transaction terminates with either an abort or a commit.</span></span>

<span data-ttu-id="6c863-143">Dicionário Confiável usa bloqueio para todas as operações de entidade única em nível de linha.</span><span class="sxs-lookup"><span data-stu-id="6c863-143">Reliable Dictionary uses row level locking for all single entity operations.</span></span>
<span data-ttu-id="6c863-144">Fila Confiável compensa simultaneidade para propriedade PEPS transacional estrita.</span><span class="sxs-lookup"><span data-stu-id="6c863-144">Reliable Queue trades off concurrency for strict transactional FIFO property.</span></span>
<span data-ttu-id="6c863-145">Fila Confiável usa bloqueios de nível de operação permitindo que uma transação com `TryPeekAsync` e/ou `TryDequeueAsync` e uma transação com `EnqueueAsync` por vez.</span><span class="sxs-lookup"><span data-stu-id="6c863-145">Reliable Queue uses operation level locks allowing one transaction with `TryPeekAsync` and/or `TryDequeueAsync` and one transaction with `EnqueueAsync` at a time.</span></span>
<span data-ttu-id="6c863-146">Observe que toopreserve FIFO, se um `TryPeekAsync` ou `TryDequeueAsync` nunca observa que Olá fila confiável está vazio, também será bloqueado `EnqueueAsync`.</span><span class="sxs-lookup"><span data-stu-id="6c863-146">Note that toopreserve FIFO, if a `TryPeekAsync` or `TryDequeueAsync` ever observes that hello Reliable Queue is empty, they will also lock `EnqueueAsync`.</span></span>

<span data-ttu-id="6c863-147">Operações de gravação sempre utilizam bloqueios exclusivos.</span><span class="sxs-lookup"><span data-stu-id="6c863-147">Write operations always take Exclusive locks.</span></span>
<span data-ttu-id="6c863-148">Para operações de leitura, Olá bloqueio depende de dois fatores.</span><span class="sxs-lookup"><span data-stu-id="6c863-148">For read operations, hello locking depends on a couple of factors.</span></span>
<span data-ttu-id="6c863-149">Qualquer operação de leitura feita usando o isolamento de Instantâneo é livre de bloqueio.</span><span class="sxs-lookup"><span data-stu-id="6c863-149">Any read operation done using Snapshot isolation is lock free.</span></span>
<span data-ttu-id="6c863-150">Qualquer operação de Leitura Repetida por padrão recebe bloqueios compartilhados.</span><span class="sxs-lookup"><span data-stu-id="6c863-150">Any Repeatable Read operation by default takes Shared locks.</span></span>
<span data-ttu-id="6c863-151">No entanto, para qualquer operação de leitura que dá suporte à leitura repetida, usuário Olá pode pedir para um bloqueio de atualização em vez da saudação bloqueio compartilhado.</span><span class="sxs-lookup"><span data-stu-id="6c863-151">However, for any read operation that supports Repeatable Read, hello user can ask for an Update lock instead of hello Shared lock.</span></span>
<span data-ttu-id="6c863-152">Um bloqueio de atualização é que um bloqueio assimétrico usado tooprevent uma forma comum de deadlock que ocorre quando várias transações bloqueiam recursos para possíveis atualizações em um momento posterior.</span><span class="sxs-lookup"><span data-stu-id="6c863-152">An Update lock is an asymmetric lock used tooprevent a common form of deadlock that occurs when multiple transactions lock resources for potential updates at a later time.</span></span>

<span data-ttu-id="6c863-153">matriz de compatibilidade de bloqueio Olá pode ser encontrada em Olá a tabela a seguir:</span><span class="sxs-lookup"><span data-stu-id="6c863-153">hello lock compatibility matrix can be found in hello following table:</span></span>

| <span data-ttu-id="6c863-154">Solicitação\concedida</span><span class="sxs-lookup"><span data-stu-id="6c863-154">Request \ Granted</span></span> | <span data-ttu-id="6c863-155">Nenhum</span><span class="sxs-lookup"><span data-stu-id="6c863-155">None</span></span> | <span data-ttu-id="6c863-156">Compartilhado</span><span class="sxs-lookup"><span data-stu-id="6c863-156">Shared</span></span> | <span data-ttu-id="6c863-157">Atualizar</span><span class="sxs-lookup"><span data-stu-id="6c863-157">Update</span></span> | <span data-ttu-id="6c863-158">Exclusivo</span><span class="sxs-lookup"><span data-stu-id="6c863-158">Exclusive</span></span> |
| --- |:--- |:--- |:--- |:--- |
| <span data-ttu-id="6c863-159">Compartilhado</span><span class="sxs-lookup"><span data-stu-id="6c863-159">Shared</span></span> |<span data-ttu-id="6c863-160">Sem conflito</span><span class="sxs-lookup"><span data-stu-id="6c863-160">No conflict</span></span> |<span data-ttu-id="6c863-161">Sem conflito</span><span class="sxs-lookup"><span data-stu-id="6c863-161">No conflict</span></span> |<span data-ttu-id="6c863-162">Conflito</span><span class="sxs-lookup"><span data-stu-id="6c863-162">Conflict</span></span> |<span data-ttu-id="6c863-163">Conflito</span><span class="sxs-lookup"><span data-stu-id="6c863-163">Conflict</span></span> |
| <span data-ttu-id="6c863-164">Atualizar</span><span class="sxs-lookup"><span data-stu-id="6c863-164">Update</span></span> |<span data-ttu-id="6c863-165">Sem conflito</span><span class="sxs-lookup"><span data-stu-id="6c863-165">No conflict</span></span> |<span data-ttu-id="6c863-166">Sem conflito</span><span class="sxs-lookup"><span data-stu-id="6c863-166">No conflict</span></span> |<span data-ttu-id="6c863-167">Conflito</span><span class="sxs-lookup"><span data-stu-id="6c863-167">Conflict</span></span> |<span data-ttu-id="6c863-168">Conflito</span><span class="sxs-lookup"><span data-stu-id="6c863-168">Conflict</span></span> |
| <span data-ttu-id="6c863-169">Exclusivo</span><span class="sxs-lookup"><span data-stu-id="6c863-169">Exclusive</span></span> |<span data-ttu-id="6c863-170">Sem conflito</span><span class="sxs-lookup"><span data-stu-id="6c863-170">No conflict</span></span> |<span data-ttu-id="6c863-171">Conflito</span><span class="sxs-lookup"><span data-stu-id="6c863-171">Conflict</span></span> |<span data-ttu-id="6c863-172">Conflito</span><span class="sxs-lookup"><span data-stu-id="6c863-172">Conflict</span></span> |<span data-ttu-id="6c863-173">Conflito</span><span class="sxs-lookup"><span data-stu-id="6c863-173">Conflict</span></span> |

<span data-ttu-id="6c863-174">Argumento de tempo limite em Olá APIs de coleções confiável é usado para detecção de deadlock.</span><span class="sxs-lookup"><span data-stu-id="6c863-174">Time-out argument in hello Reliable Collections APIs is used for deadlock detection.</span></span>
<span data-ttu-id="6c863-175">Por exemplo, duas transações (T1 e T2) estão tentando tooread e atualizar K1.</span><span class="sxs-lookup"><span data-stu-id="6c863-175">For example, two transactions (T1 and T2) are trying tooread and update K1.</span></span>
<span data-ttu-id="6c863-176">É possível que eles toodeadlock, porque ambos acabam tendo Olá compartilhado bloqueio.</span><span class="sxs-lookup"><span data-stu-id="6c863-176">It is possible for them toodeadlock, because they both end up having hello Shared lock.</span></span>
<span data-ttu-id="6c863-177">Nesse caso, uma ou ambas as operações de saudação atingirá o tempo limite.</span><span class="sxs-lookup"><span data-stu-id="6c863-177">In this case, one or both of hello operations will time out.</span></span>

<span data-ttu-id="6c863-178">Esse cenário de deadlock é um ótimo exemplo de como um Bloqueio de atualização pode evitar deadlocks.</span><span class="sxs-lookup"><span data-stu-id="6c863-178">This deadlock scenario is a great example of how an Update lock can prevent deadlocks.</span></span>

## <a name="next-steps"></a><span data-ttu-id="6c863-179">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="6c863-179">Next steps</span></span>
* [<span data-ttu-id="6c863-180">Trabalhando com Reliable Collections</span><span class="sxs-lookup"><span data-stu-id="6c863-180">Working with Reliable Collections</span></span>](service-fabric-work-with-reliable-collections.md)
* [<span data-ttu-id="6c863-181">Notificações do Reliable Services</span><span class="sxs-lookup"><span data-stu-id="6c863-181">Reliable Services notifications</span></span>](service-fabric-reliable-services-notifications.md)
* [<span data-ttu-id="6c863-182">Backup e restauração do Reliable Services (recuperação de desastre)</span><span class="sxs-lookup"><span data-stu-id="6c863-182">Reliable Services backup and restore (disaster recovery)</span></span>](service-fabric-reliable-services-backup-restore.md)
* [<span data-ttu-id="6c863-183">Configuração do Gerenciador de Estado Confiável</span><span class="sxs-lookup"><span data-stu-id="6c863-183">Reliable State Manager configuration</span></span>](service-fabric-reliable-services-configuration.md)
* [<span data-ttu-id="6c863-184">Referência do desenvolvedor para Coleções Confiáveis</span><span class="sxs-lookup"><span data-stu-id="6c863-184">Developer reference for Reliable Collections</span></span>](https://msdn.microsoft.com/library/azure/microsoft.servicefabric.data.collections.aspx)

