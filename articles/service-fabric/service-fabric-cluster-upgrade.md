---
title: Atualizar um cluster do Azure Service Fabric | Microsoft Docs
description: "Atualize o código e/ou configuração do Service Fabric que executa um cluster do Service Fabric, incluindo a definição do modo de atualização do cluster, a atualização de certificados, a adição de portas do aplicativo, a aplicação de patches no sistema operacional etc. O que você pode esperar após a execução das atualizações?"
services: service-fabric
documentationcenter: .net
author: ChackDan
manager: timlt
editor: 
ms.assetid: 15190ace-31ed-491f-a54b-b5ff61e718db
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 8/10/2017
ms.author: chackdan
ms.openlocfilehash: 7ea71ab891583c51b3c07a4d0a9f0b4f54e56669
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/18/2017
---
# <a name="upgrade-an-azure-service-fabric-cluster"></a><span data-ttu-id="77832-104">Atualizar um cluster do Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="77832-104">Upgrade an Azure Service Fabric cluster</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="77832-105">Cluster do Azure</span><span class="sxs-lookup"><span data-stu-id="77832-105">Azure Cluster</span></span>](service-fabric-cluster-upgrade.md)
> * [<span data-ttu-id="77832-106">Cluster Independente</span><span class="sxs-lookup"><span data-stu-id="77832-106">Standalone Cluster</span></span>](service-fabric-cluster-upgrade-windows-server.md)
> 
> 

<span data-ttu-id="77832-107">Para qualquer sistema moderno, oferecer a possibilidade de atualização é fundamental para o sucesso duradouro de seu produto.</span><span class="sxs-lookup"><span data-stu-id="77832-107">For any modern system, designing for upgradability is key to achieving long-term success of your product.</span></span> <span data-ttu-id="77832-108">Um cluster do Azure Service Fabric é um recurso cujo proprietário é você, mas que é parcialmente gerenciado pela Microsoft.</span><span class="sxs-lookup"><span data-stu-id="77832-108">An Azure Service Fabric cluster is a resource that you own, but is partly managed by Microsoft.</span></span> <span data-ttu-id="77832-109">Este artigo descreve o que é gerenciado automaticamente e o que você pode configurar por conta própria.</span><span class="sxs-lookup"><span data-stu-id="77832-109">This article describes what is managed automatically and what you can configure yourself.</span></span>

## <a name="controlling-the-fabric-version-that-runs-on-your-cluster"></a><span data-ttu-id="77832-110">Controlando a versão do Fabric em execução no Cluster</span><span class="sxs-lookup"><span data-stu-id="77832-110">Controlling the fabric version that runs on your Cluster</span></span>
<span data-ttu-id="77832-111">Você pode definir o cluster para receber atualizações automáticas do Fabric, assim que elas forem liberadas pela Microsoft ou pode optar por selecionar uma versão com suporte do Fabric na qual deseja que o cluster se encontre.</span><span class="sxs-lookup"><span data-stu-id="77832-111">You can set your cluster to receive automatic fabric upgrades as they are released by Microsoft or you can select a supported fabric version you want your cluster to be on.</span></span>

<span data-ttu-id="77832-112">Você pode fazer isso definindo a configuração do cluster "upgradeMode" no portal ou usando o Gerenciador de Recursos no momento da criação ou posteriormente em um cluster ativo</span><span class="sxs-lookup"><span data-stu-id="77832-112">You do this by setting the "upgradeMode" cluster configuration on the portal or using Resource Manager at the time of creation or later on a live cluster</span></span> 

> [!NOTE]
> <span data-ttu-id="77832-113">Certifique-se de manter o cluster sempre executando uma versão do Fabric com suporte.</span><span class="sxs-lookup"><span data-stu-id="77832-113">Make sure to keep your cluster running a supported fabric version always.</span></span> <span data-ttu-id="77832-114">Quando anunciamos o lançamento de uma nova versão do Service Fabric, a versão anterior é programada para encerrar seu tempo de vida após um mínimo de 60 dias a partir da data desse anúncio.</span><span class="sxs-lookup"><span data-stu-id="77832-114">As and when we announce the release of a new version of service fabric, the previous version is marked for end of support after a minimum of 60 days from that date.</span></span> <span data-ttu-id="77832-115">As novas versões são anunciadas [no blog da equipe do Service Fabric](https://blogs.msdn.microsoft.com/azureservicefabric/).</span><span class="sxs-lookup"><span data-stu-id="77832-115">the  The new releases are announced [on the service fabric team blog](https://blogs.msdn.microsoft.com/azureservicefabric/).</span></span> <span data-ttu-id="77832-116">Então, a nova versão está disponível para escolha.</span><span class="sxs-lookup"><span data-stu-id="77832-116">The new release is available to choose then.</span></span> 
> 
> 

<span data-ttu-id="77832-117">14 dias antes da expiração da versão do cluster em execução, um evento de integridade é gerado, colocando seu cluster em um estado de integridade de aviso.</span><span class="sxs-lookup"><span data-stu-id="77832-117">14 days prior to the expiry of the release your cluster is running, a health event is generated that puts your cluster into a warning health state.</span></span> <span data-ttu-id="77832-118">O cluster permanecerá em um estado de aviso até você atualize para uma versão do Fabric com suporte.</span><span class="sxs-lookup"><span data-stu-id="77832-118">The cluster remains in a warning state until you upgrade to a supported fabric version.</span></span>

### <a name="setting-the-upgrade-mode-via-portal"></a><span data-ttu-id="77832-119">Definindo o modo de atualização por meio do portal</span><span class="sxs-lookup"><span data-stu-id="77832-119">Setting the upgrade mode via portal</span></span>
<span data-ttu-id="77832-120">Você pode definir o cluster para manual ou automático ao criá-lo.</span><span class="sxs-lookup"><span data-stu-id="77832-120">You can set the cluster to automatic or manual when you are creating the cluster.</span></span>

![Create_Manualmode][Create_Manualmode]

<span data-ttu-id="77832-122">Você pode definir o cluster como automático ou manual quando estiver em um cluster ativo, usando a experiência de gerenciamento.</span><span class="sxs-lookup"><span data-stu-id="77832-122">You can set the cluster to automatic or manual when on a live cluster, using the manage experience.</span></span> 

#### <a name="upgrading-to-a-new-version-on-a-cluster-that-is-set-to-manual-mode-via-portal"></a><span data-ttu-id="77832-123">Atualizando para uma nova versão em um cluster que está definido para o modo Manual por meio do portal.</span><span class="sxs-lookup"><span data-stu-id="77832-123">Upgrading to a new version on a cluster that is set to Manual mode via portal.</span></span>
<span data-ttu-id="77832-124">Para atualizar para uma nova versão, tudo o que você precisa fazer é selecionar a versão disponível no menu suspenso e salvar.</span><span class="sxs-lookup"><span data-stu-id="77832-124">To upgrade to a new version, all you need to do is select the available version from the dropdown and save.</span></span> <span data-ttu-id="77832-125">A atualização do Fabric é inicializada automaticamente.</span><span class="sxs-lookup"><span data-stu-id="77832-125">The Fabric upgrade gets kicked off automatically.</span></span> <span data-ttu-id="77832-126">As políticas de integridade do cluster (uma combinação de integridade do nó e da integridade de todos os aplicativos executados no cluster) são atendidas durante a atualização.</span><span class="sxs-lookup"><span data-stu-id="77832-126">The cluster health policies (a combination of node health and the health all the applications running in the cluster) are adhered to during the upgrade.</span></span>

<span data-ttu-id="77832-127">Se as políticas de integridade do cluster não forem atendidas, a atualização será revertida.</span><span class="sxs-lookup"><span data-stu-id="77832-127">If the cluster health policies are not met, the upgrade is rolled back.</span></span> <span data-ttu-id="77832-128">Role para baixo deste documento para ler mais sobre como definir as políticas de integridade personalizadas.</span><span class="sxs-lookup"><span data-stu-id="77832-128">Scroll down this document to read more on how to set those custom health policies.</span></span> 

<span data-ttu-id="77832-129">Depois de corrigir os problemas que resultaram na reversão, você precisará iniciar a atualização novamente, seguindo as mesmas etapas de antes.</span><span class="sxs-lookup"><span data-stu-id="77832-129">Once you have fixed the issues that resulted in the rollback, you need to initiate the upgrade again, by following the same steps as before.</span></span>

![Manage_Automaticmode][Manage_Automaticmode]

### <a name="setting-the-upgrade-mode-via-a-resource-manager-template"></a><span data-ttu-id="77832-131">Definindo o modo de atualização por meio de um modelo do Resource Manager</span><span class="sxs-lookup"><span data-stu-id="77832-131">Setting the upgrade mode via a Resource Manager template</span></span>
<span data-ttu-id="77832-132">Adicione a configuração "upgradeMode" à definição de recursos Microsoft.ServiceFabric/clusters e defina "clusterCodeVersion" para uma das versões do Fabric com suporte, conforme mostrado abaixo e, em seguida, implante o modelo.</span><span class="sxs-lookup"><span data-stu-id="77832-132">Add the "upgradeMode" configuration to the Microsoft.ServiceFabric/clusters resource definition and set the "clusterCodeVersion" to one of the supported fabric versions as shown below and then deploy the template.</span></span> <span data-ttu-id="77832-133">Os valores válidos para "upgradeMode" são "Manual" ou "Automático"</span><span class="sxs-lookup"><span data-stu-id="77832-133">The valid values for "upgradeMode" are "Manual" or "Automatic"</span></span>

![ARMUpgradeMode][ARMUpgradeMode]

#### <a name="upgrading-to-a-new-version-on-a-cluster-that-is-set-to-manual-mode-via-a-resource-manager-template"></a><span data-ttu-id="77832-135">Atualizando para uma nova versão em um cluster que está definido para o modo Manual por meio do modelo do Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="77832-135">Upgrading to a new version on a cluster that is set to Manual mode via a Resource Manager template.</span></span>
<span data-ttu-id="77832-136">Quando o cluster está no modo Manual, para atualizar para uma nova versão, altere "clusterCodeVersion" para uma versão com suporte e implante-o.</span><span class="sxs-lookup"><span data-stu-id="77832-136">When the cluster is in Manual mode, to upgrade to a new version, change the "clusterCodeVersion" to a supported version and deploy it.</span></span> <span data-ttu-id="77832-137">A implantação do modelo ativa a atualização do Fabric, que é inicializada automaticamente.</span><span class="sxs-lookup"><span data-stu-id="77832-137">The deployment of the template, kicks of the Fabric upgrade gets kicked off automatically.</span></span> <span data-ttu-id="77832-138">As políticas de integridade do cluster (uma combinação de integridade do nó e da integridade de todos os aplicativos executados no cluster) são atendidas durante a atualização.</span><span class="sxs-lookup"><span data-stu-id="77832-138">The cluster health policies (a combination of node health and the health all the applications running in the cluster) are adhered to during the upgrade.</span></span>

<span data-ttu-id="77832-139">Se as políticas de integridade do cluster não forem atendidas, a atualização será revertida.</span><span class="sxs-lookup"><span data-stu-id="77832-139">If the cluster health policies are not met, the upgrade is rolled back.</span></span> <span data-ttu-id="77832-140">Role para baixo deste documento para ler mais sobre como definir as políticas de integridade personalizadas.</span><span class="sxs-lookup"><span data-stu-id="77832-140">Scroll down this document to read more on how to set those custom health policies.</span></span> 

<span data-ttu-id="77832-141">Depois de corrigir os problemas que resultaram na reversão, você precisará iniciar a atualização novamente, seguindo as mesmas etapas de antes.</span><span class="sxs-lookup"><span data-stu-id="77832-141">Once you have fixed the issues that resulted in the rollback, you need to initiate the upgrade again, by following the same steps as before.</span></span>

### <a name="get-list-of-all-available-version-for-all-environments-for-a-given-subscription"></a><span data-ttu-id="77832-142">Obter uma lista de todas as versões disponíveis para todos os ambientes para determinada assinatura</span><span class="sxs-lookup"><span data-stu-id="77832-142">Get list of all available version for all environments for a given subscription</span></span>
<span data-ttu-id="77832-143">Execute o comando a seguir e obtenha uma saída semelhante a esta.</span><span class="sxs-lookup"><span data-stu-id="77832-143">Run the following command, and you should get an output similar to this.</span></span>

<span data-ttu-id="77832-144">"supportExpiryUtc" informa o quando determinada versão está expirando ou expirou.</span><span class="sxs-lookup"><span data-stu-id="77832-144">"supportExpiryUtc" tells your when a given release is expiring or has expired.</span></span> <span data-ttu-id="77832-145">A versão mais recente não tem uma data válida, ela tem um valor de "9999-12-31T23:59:59.9999999", que significa apenas que a data de vencimento ainda não foi definida.</span><span class="sxs-lookup"><span data-stu-id="77832-145">The latest release does not have a valid date - it has a value of "9999-12-31T23:59:59.9999999", which just means that the expiry date is not yet set.</span></span>

```REST
GET https://<endpoint>/subscriptions/{{subscriptionId}}/providers/Microsoft.ServiceFabric/locations/{{location}}/clusterVersions?api-version=2016-09-01

Example: https://management.azure.com/subscriptions/1857f442-3bce-4b96-ad95-627f76437a67/providers/Microsoft.ServiceFabric/locations/eastus/clusterVersions?api-version=2016-09-01

Output:
{
                  "value": [
                    {
                      "id": "subscriptions/35349203-a0b3-405e-8a23-9f1450984307/providers/Microsoft.ServiceFabric/environments/Windows/clusterVersions/5.0.1427.9490",
                      "name": "5.0.1427.9490",
                      "type": "Microsoft.ServiceFabric/environments/clusterVersions",
                      "properties": {
                        "codeVersion": "5.0.1427.9490",
                        "supportExpiryUtc": "2016-11-26T23:59:59.9999999",
                        "environment": "Windows"
                      }
                    },
                    {
                      "id": "subscriptions/35349203-a0b3-405e-8a23-9f1450984307/providers/Microsoft.ServiceFabric/environments/Windows/clusterVersions/4.0.1427.9490",
                      "name": "5.1.1427.9490",
                      "type": " Microsoft.ServiceFabric/environments/clusterVersions",
                      "properties": {
                        "codeVersion": "5.1.1427.9490",
                        "supportExpiryUtc": "9999-12-31T23:59:59.9999999",
                        "environment": "Windows"
                      }
                    },
                    {
                      "id": "subscriptions/35349203-a0b3-405e-8a23-9f1450984307/providers/Microsoft.ServiceFabric/environments/Windows/clusterVersions/4.4.1427.9490",
                      "name": "4.4.1427.9490",
                      "type": " Microsoft.ServiceFabric/environments/clusterVersions",
                      "properties": {
                        "codeVersion": "4.4.1427.9490",
                        "supportExpiryUtc": "9999-12-31T23:59:59.9999999",
                        "environment": "Linux"
                      }
                    }
                  ]
                }


```

## <a name="fabric-upgrade-behavior-when-the-cluster-upgrade-mode-is-automatic"></a><span data-ttu-id="77832-146">Comportamento de atualização do Fabric quando Modo de Atualização do cluster for Automático</span><span class="sxs-lookup"><span data-stu-id="77832-146">Fabric upgrade behavior when the cluster Upgrade Mode is Automatic</span></span>
<span data-ttu-id="77832-147">A Microsoft mantém o código de fábrica e a configuração executada em um cluster do Azure.</span><span class="sxs-lookup"><span data-stu-id="77832-147">Microsoft maintains the fabric code and configuration that runs in an Azure cluster.</span></span> <span data-ttu-id="77832-148">Executamos atualizações automáticas monitoradas no software de acordo com a necessidade.</span><span class="sxs-lookup"><span data-stu-id="77832-148">We perform automatic monitored upgrades to the software on an as-needed basis.</span></span> <span data-ttu-id="77832-149">Essas atualizações podem ser feitas no código, na configuração ou em ambos.</span><span class="sxs-lookup"><span data-stu-id="77832-149">These upgrades could be code, configuration, or both.</span></span> <span data-ttu-id="77832-150">Para garantir que seu aplicativo sofra o mínimo ou nenhum impacto por conta dessas atualizações, nos ás executamos nas fases indicadas a seguir:</span><span class="sxs-lookup"><span data-stu-id="77832-150">To make sure that your application suffers no impact or minimal impact due to these upgrades, we perform the upgrades in the following phases:</span></span>

### <a name="phase-1-an-upgrade-is-performed-by-using-all-cluster-health-policies"></a><span data-ttu-id="77832-151">Fase 1: uma atualização é executada usando todas as políticas de integridade do cluster</span><span class="sxs-lookup"><span data-stu-id="77832-151">Phase 1: An upgrade is performed by using all cluster health policies</span></span>
<span data-ttu-id="77832-152">Durante esta fase, as atualizações realizam um domínio de atualização por vez, e os aplicativos em execução no cluster continuam em execução sem qualquer tempo de inatividade.</span><span class="sxs-lookup"><span data-stu-id="77832-152">During this phase, the upgrades proceed one upgrade domain at a time, and the applications that were running in the cluster continue to run without any downtime.</span></span> <span data-ttu-id="77832-153">As políticas de integridade do cluster (uma combinação de integridade do nó e da integridade de todos os aplicativos executados no cluster) são atendidas durante a atualização.</span><span class="sxs-lookup"><span data-stu-id="77832-153">The cluster health policies (a combination of node health and the health all the applications running in the cluster) are adhered to during the upgrade.</span></span>

<span data-ttu-id="77832-154">Se as políticas de integridade do cluster não forem atendidas, a atualização será revertida.</span><span class="sxs-lookup"><span data-stu-id="77832-154">If the cluster health policies are not met, the upgrade is rolled back.</span></span> <span data-ttu-id="77832-155">Em seguida, um email é enviado ao proprietário da assinatura.</span><span class="sxs-lookup"><span data-stu-id="77832-155">Then an email is sent to the owner of the subscription.</span></span> <span data-ttu-id="77832-156">O email contém as seguintes informações:</span><span class="sxs-lookup"><span data-stu-id="77832-156">The email contains the following information:</span></span>

* <span data-ttu-id="77832-157">Uma notificação de que precisamos reverter uma atualização de cluster.</span><span class="sxs-lookup"><span data-stu-id="77832-157">Notification that we had to roll back a cluster upgrade.</span></span>
* <span data-ttu-id="77832-158">Sugestões de ações corretivas, se houver alguma.</span><span class="sxs-lookup"><span data-stu-id="77832-158">Suggested remedial actions, if any.</span></span>
* <span data-ttu-id="77832-159">O número de dias (n) até a execução da Fase 2.</span><span class="sxs-lookup"><span data-stu-id="77832-159">The number of days (n) until we execute Phase 2.</span></span>

<span data-ttu-id="77832-160">Tentamos executar a mesma atualização algumas vezes mais, caso alguma atualização falhe por motivos de infraestrutura.</span><span class="sxs-lookup"><span data-stu-id="77832-160">We try to execute the same upgrade a few more times in case any upgrades failed for infrastructure reasons.</span></span> <span data-ttu-id="77832-161">Após os n dias a partir da data de envio do email, prosseguiremos para a Fase 2.</span><span class="sxs-lookup"><span data-stu-id="77832-161">After the n days from the date the email was sent, we proceed to Phase 2.</span></span>

<span data-ttu-id="77832-162">Se as políticas de integridade do cluster forem atendidas, a atualização será considerada bem-sucedida e marcada como concluída.</span><span class="sxs-lookup"><span data-stu-id="77832-162">If the cluster health policies are met, the upgrade is considered successful and marked complete.</span></span> <span data-ttu-id="77832-163">Isso poderá acontecer durante a atualização inicial ou durante qualquer nova execução das atualizações desta fase.</span><span class="sxs-lookup"><span data-stu-id="77832-163">This can happen during the initial upgrade or any of the upgrade reruns in this phase.</span></span> <span data-ttu-id="77832-164">Nenhum email de confirmação será enviado após uma execução bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="77832-164">There is no email confirmation of a successful run.</span></span> <span data-ttu-id="77832-165">Isso serve para evitar o envio de muitos emails. O recebimento de um email deve ser visto como uma exceção.</span><span class="sxs-lookup"><span data-stu-id="77832-165">This is to avoid sending you too many emails--receiving an email should be seen as an exception to normal.</span></span> <span data-ttu-id="77832-166">Esperamos que a maioria das atualizações do cluster tenha êxito sem afetar a disponibilidade de seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="77832-166">We expect most of the cluster upgrades to succeed without impacting your application availability.</span></span>

### <a name="phase-2-an-upgrade-is-performed-by-using-default-health-policies-only"></a><span data-ttu-id="77832-167">Fase 2: uma atualização é executada usando apenas as políticas de integridade padrão</span><span class="sxs-lookup"><span data-stu-id="77832-167">Phase 2: An upgrade is performed by using default health policies only</span></span>
<span data-ttu-id="77832-168">As políticas de integridade desta fase são definidas de forma que o número de aplicativos íntegros no início da atualização permaneça o mesmo durante o processo de atualização.</span><span class="sxs-lookup"><span data-stu-id="77832-168">The health policies in this phase are set in such a way that the number of applications that were healthy at the beginning of the upgrade remains the same for the duration of the upgrade process.</span></span> <span data-ttu-id="77832-169">Assim como na Fase 1, na Fase 2 as atualizações ocorrem em um domínio de atualização por vez, e os aplicativos em execução no cluster continuam em execução sem qualquer tempo de inatividade.</span><span class="sxs-lookup"><span data-stu-id="77832-169">As in Phase 1, the Phase 2 upgrades proceed one upgrade domain at a time, and the applications that were running in the cluster continue to run without any downtime.</span></span> <span data-ttu-id="77832-170">As políticas de integridade do cluster (uma combinação de integridade do nó e da integridade de todos os aplicativos executados no cluster) são atendidas durante a atualização.</span><span class="sxs-lookup"><span data-stu-id="77832-170">The cluster health policies (a combination of node health and the health all the applications running in the cluster) are adhered to for the duration of the upgrade.</span></span>

<span data-ttu-id="77832-171">Se as políticas de integridade do cluster em vigor não forem atendidas, a atualização será revertida.</span><span class="sxs-lookup"><span data-stu-id="77832-171">If the cluster health policies in effect are not met, the upgrade is rolled back.</span></span> <span data-ttu-id="77832-172">Em seguida, um email é enviado ao proprietário da assinatura.</span><span class="sxs-lookup"><span data-stu-id="77832-172">Then an email is sent to the owner of the subscription.</span></span> <span data-ttu-id="77832-173">O email contém as seguintes informações:</span><span class="sxs-lookup"><span data-stu-id="77832-173">The email contains the following information:</span></span>

* <span data-ttu-id="77832-174">Uma notificação de que precisamos reverter uma atualização de cluster.</span><span class="sxs-lookup"><span data-stu-id="77832-174">Notification that we had to roll back a cluster upgrade.</span></span>
* <span data-ttu-id="77832-175">Sugestões de ações corretivas, se houver alguma.</span><span class="sxs-lookup"><span data-stu-id="77832-175">Suggested remedial actions, if any.</span></span>
* <span data-ttu-id="77832-176">O número de dias (n) até a execução da Fase 3.</span><span class="sxs-lookup"><span data-stu-id="77832-176">The number of days (n) until we execute Phase 3.</span></span>

<span data-ttu-id="77832-177">Tentamos executar a mesma atualização algumas vezes mais, caso alguma atualização falhe por motivos de infraestrutura.</span><span class="sxs-lookup"><span data-stu-id="77832-177">We try to execute the same upgrade a few more times in case any upgrades failed for infrastructure reasons.</span></span> <span data-ttu-id="77832-178">Um lembrete será enviado por email alguns dias antes do término dos n dias.</span><span class="sxs-lookup"><span data-stu-id="77832-178">A reminder email is sent a couple of days before n days are up.</span></span> <span data-ttu-id="77832-179">Após os n dias a partir da data de envio do email, prosseguiremos para a Fase 3.</span><span class="sxs-lookup"><span data-stu-id="77832-179">After the n days from the date the email was sent, we proceed to Phase 3.</span></span> <span data-ttu-id="77832-180">Os emails que enviamos na Fase 2 devem ser levados a sério e as ações corretivas devem ser realizadas.</span><span class="sxs-lookup"><span data-stu-id="77832-180">The emails we send you in Phase 2 must be taken seriously and remedial actions must be taken.</span></span>

<span data-ttu-id="77832-181">Se as políticas de integridade do cluster forem atendidas, a atualização será considerada bem-sucedida e marcada como concluída.</span><span class="sxs-lookup"><span data-stu-id="77832-181">If the cluster health policies are met, the upgrade is considered successful and marked complete.</span></span> <span data-ttu-id="77832-182">Isso poderá acontecer durante a atualização inicial ou durante qualquer nova execução das atualizações desta fase.</span><span class="sxs-lookup"><span data-stu-id="77832-182">This can happen during the initial upgrade or any of the upgrade reruns in this phase.</span></span> <span data-ttu-id="77832-183">Nenhum email de confirmação será enviado após uma execução bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="77832-183">There is no email confirmation of a successful run.</span></span>

### <a name="phase-3-an-upgrade-is-performed-by-using-aggressive-health-policies"></a><span data-ttu-id="77832-184">Fase 3: uma atualização é executada usando políticas de integridade agressivas</span><span class="sxs-lookup"><span data-stu-id="77832-184">Phase 3: An upgrade is performed by using aggressive health policies</span></span>
<span data-ttu-id="77832-185">Essas políticas de integridade desta fase são destinadas à conclusão da atualização, em vez da integridade dos aplicativos.</span><span class="sxs-lookup"><span data-stu-id="77832-185">These health policies in this phase are geared towards completion of the upgrade rather than the health of the applications.</span></span> <span data-ttu-id="77832-186">Pouquíssimas atualizações de cluster chegam a esta fase.</span><span class="sxs-lookup"><span data-stu-id="77832-186">Very few cluster upgrades end up in this phase.</span></span> <span data-ttu-id="77832-187">Caso seu cluster chegue a esta fase, há uma boa chance de seu aplicativo deixar de ser íntegro e/ou de perder a disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="77832-187">If your cluster gets to this phase, there is a good chance that your application becomes unhealthy and/or lose availability.</span></span>

<span data-ttu-id="77832-188">Assim como nas duas outras fases, as atualizações da Fase 3 realizam um domínio de atualização por vez.</span><span class="sxs-lookup"><span data-stu-id="77832-188">Similar to the other two phases, Phase 3 upgrades proceed one upgrade domain at a time.</span></span>

<span data-ttu-id="77832-189">Se as políticas de integridade do cluster não forem atendidas, a atualização será revertida.</span><span class="sxs-lookup"><span data-stu-id="77832-189">If the cluster health policies are not met, the upgrade is rolled back.</span></span> <span data-ttu-id="77832-190">Tentamos executar a mesma atualização algumas vezes mais, caso alguma atualização falhe por motivos de infraestrutura.</span><span class="sxs-lookup"><span data-stu-id="77832-190">We try to execute the same upgrade a few more times in case any upgrades failed for infrastructure reasons.</span></span> <span data-ttu-id="77832-191">Depois disso, o cluster será marcado para que não receba mais suporte e/ou atualizações.</span><span class="sxs-lookup"><span data-stu-id="77832-191">After that, the cluster is pinned, so that it will no longer receive support and/or upgrades.</span></span>

<span data-ttu-id="77832-192">Um email com essas informações é enviado ao proprietário da assinatura, juntamente com as ações corretivas.</span><span class="sxs-lookup"><span data-stu-id="77832-192">An email with this information is sent to the subscription owner, along with the remedial actions.</span></span> <span data-ttu-id="77832-193">Não esperamos que qualquer cluster entre em um estado no qual a Fase 3 falhou.</span><span class="sxs-lookup"><span data-stu-id="77832-193">We do not expect any clusters to get into a state where Phase 3 has failed.</span></span>

<span data-ttu-id="77832-194">Se as políticas de integridade do cluster forem atendidas, a atualização será considerada bem-sucedida e marcada como concluída.</span><span class="sxs-lookup"><span data-stu-id="77832-194">If the cluster health policies are met, the upgrade is considered successful and marked complete.</span></span> <span data-ttu-id="77832-195">Isso poderá acontecer durante a atualização inicial ou durante qualquer nova execução das atualizações desta fase.</span><span class="sxs-lookup"><span data-stu-id="77832-195">This can happen during the initial upgrade or any of the upgrade reruns in this phase.</span></span> <span data-ttu-id="77832-196">Nenhum email de confirmação será enviado após uma execução bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="77832-196">There is no email confirmation of a successful run.</span></span>

## <a name="cluster-configurations-that-you-control"></a><span data-ttu-id="77832-197">Configurações do cluster que você controla</span><span class="sxs-lookup"><span data-stu-id="77832-197">Cluster configurations that you control</span></span>
<span data-ttu-id="77832-198">Além da capacidade de definir o cluster de modo de atualização, aqui estão as configurações que podem ser alteradas em um cluster ativo.</span><span class="sxs-lookup"><span data-stu-id="77832-198">In addition to the ability to set the cluster upgrade mode, Here are the configurations that you can change on a live cluster.</span></span>

### <a name="certificates"></a><span data-ttu-id="77832-199">Certificados</span><span class="sxs-lookup"><span data-stu-id="77832-199">Certificates</span></span>
<span data-ttu-id="77832-200">Você pode adicionar ou excluir novos certificados do cluster e do cliente facilmente por meio do portal.</span><span class="sxs-lookup"><span data-stu-id="77832-200">You can add new or delete certificates for the cluster and client via the portal easily.</span></span> <span data-ttu-id="77832-201">Confira [este documento para obter instruções detalhadas](service-fabric-cluster-security-update-certs-azure.md)</span><span class="sxs-lookup"><span data-stu-id="77832-201">Refer to [this document for detailed instructions](service-fabric-cluster-security-update-certs-azure.md)</span></span>

![Captura de tela que mostra as impressões digitais do certificado no Portal do Azure.][CertificateUpgrade]

### <a name="application-ports"></a><span data-ttu-id="77832-203">Portas do aplicativo</span><span class="sxs-lookup"><span data-stu-id="77832-203">Application ports</span></span>
<span data-ttu-id="77832-204">Você pode alterar as portas do aplicativo alterando as propriedades do recurso de Balanceador de carga associadas ao tipo de nó.</span><span class="sxs-lookup"><span data-stu-id="77832-204">You can change application ports by changing the Load Balancer resource properties that are associated with the node type.</span></span> <span data-ttu-id="77832-205">Você pode usar o portal ou o PowerShell do Gerenciador de Recursos diretamente.</span><span class="sxs-lookup"><span data-stu-id="77832-205">You can use the portal, or you can use Resource Manager PowerShell directly.</span></span>

<span data-ttu-id="77832-206">Para abrir uma nova porta em todas as VMs em um tipo de nó, faça o seguinte:</span><span class="sxs-lookup"><span data-stu-id="77832-206">To open a new port on all VMs in a node type, do the following:</span></span>

1. <span data-ttu-id="77832-207">Adicione uma nova investigação ao balanceador de carga apropriado.</span><span class="sxs-lookup"><span data-stu-id="77832-207">Add a new probe to the appropriate load balancer.</span></span>
   
    <span data-ttu-id="77832-208">Se você implantou o cluster usando o portal, os balanceadores de carga são nomeados como "LB-nome do grupo de recursos-NodeTypename", um para cada tipo de nó.</span><span class="sxs-lookup"><span data-stu-id="77832-208">If you deployed your cluster by using the portal, the load balancers are named "LB-name of the Resource group-NodeTypename", one for each node type.</span></span> <span data-ttu-id="77832-209">Como os nomes de balanceador de carga são exclusivos apenas em um grupo de recursos, será melhor pesquisá-los em um grupo de recursos específico.</span><span class="sxs-lookup"><span data-stu-id="77832-209">Since the load balancer names are unique only within a resource group, it is best if you search for them under a specific resource group.</span></span>
   
    ![Captura de tela que mostra a adição de uma investigação a um balanceador de carga no portal.][AddingProbes]
2. <span data-ttu-id="77832-211">Adicione uma nova regra ao balanceador de carga.</span><span class="sxs-lookup"><span data-stu-id="77832-211">Add a new rule to the load balancer.</span></span>
   
    <span data-ttu-id="77832-212">Adicione uma nova regra ao mesmo balanceador de carga usando a investigação criada na etapa anterior.</span><span class="sxs-lookup"><span data-stu-id="77832-212">Add a new rule to the same load balancer by using the probe that you created in the previous step.</span></span>
   
    ![Adicionando uma nova regra a um balanceador de carga no portal.][AddingLBRules]

### <a name="placement-properties"></a><span data-ttu-id="77832-214">Propriedades de posicionamento</span><span class="sxs-lookup"><span data-stu-id="77832-214">Placement properties</span></span>
<span data-ttu-id="77832-215">Para cada um dos tipos de nó, é possível adicionar as propriedades de posicionamento personalizadas que você deseja usar em seus aplicativos.</span><span class="sxs-lookup"><span data-stu-id="77832-215">For each of the node types, you can add custom placement properties that you want to use in your applications.</span></span> <span data-ttu-id="77832-216">NodeType é uma propriedade padrão que você pode usar sem adicioná-la explicitamente.</span><span class="sxs-lookup"><span data-stu-id="77832-216">NodeType is a default property that you can use without adding it explicitly.</span></span>

> [!NOTE]
> <span data-ttu-id="77832-217">Para obter detalhes sobre o uso de restrições de posicionamento, propriedades de nó e como defini-las, confira a seção "Restrições de posicionamento e propriedades de nó" no documento do Gerenciador de Recursos do cluster do Service Fabric em [Descrevendo seu cluster](service-fabric-cluster-resource-manager-cluster-description.md).</span><span class="sxs-lookup"><span data-stu-id="77832-217">For details on the use of placement constraints, node properties, and how to define them, refer to the section "Placement Constraints and Node Properties" in the Service Fabric Cluster Resource Manager Document on [Describing Your Cluster](service-fabric-cluster-resource-manager-cluster-description.md).</span></span>
> 
> 

### <a name="capacity-metrics"></a><span data-ttu-id="77832-218">Métricas de capacidade</span><span class="sxs-lookup"><span data-stu-id="77832-218">Capacity metrics</span></span>
<span data-ttu-id="77832-219">Para cada um dos tipos de nó, é possível adicionar métricas de capacidade personalizadas que você deseja usar em seus aplicativos para relatar a carga.</span><span class="sxs-lookup"><span data-stu-id="77832-219">For each of the node types, you can add custom capacity metrics that you want to use in your applications to report load.</span></span> <span data-ttu-id="77832-220">Para obter detalhes sobre o uso de métricas de capacidade para relatar carga, confira os documentos do Gerenciador de Recursos do cluster do Service Fabric em [Descrevendo seu cluster](service-fabric-cluster-resource-manager-cluster-description.md) e [Métricas e carga](service-fabric-cluster-resource-manager-metrics.md).</span><span class="sxs-lookup"><span data-stu-id="77832-220">For details on the use of capacity metrics to report load, refer to the Service Fabric Cluster Resource Manager Documents on [Describing Your Cluster](service-fabric-cluster-resource-manager-cluster-description.md) and [Metrics and Load](service-fabric-cluster-resource-manager-metrics.md).</span></span>

### <a name="fabric-upgrade-settings---health-polices"></a><span data-ttu-id="77832-221">Configurações de atualização do Fabric – Políticas de integridade</span><span class="sxs-lookup"><span data-stu-id="77832-221">Fabric upgrade settings - Health polices</span></span>
<span data-ttu-id="77832-222">Você pode especificar as políticas de integridade personalizadas para atualização do Fabric.</span><span class="sxs-lookup"><span data-stu-id="77832-222">You can specify custom health polices for fabric upgrade.</span></span> <span data-ttu-id="77832-223">Se você tiver configurado o cluster para atualizações automáticas do Fabric, essas políticas serão aplicadas à Fase 1 das atualizações automáticas do Fabric.</span><span class="sxs-lookup"><span data-stu-id="77832-223">If you have set your cluster to Automatic fabric upgrades, then these policies get applied to the Phase-1 of the automatic fabric upgrades.</span></span>
<span data-ttu-id="77832-224">Se você tiver configurado o cluster para atualizações manuais do Fabric, essas políticas serão aplicadas cada vez que você selecionar uma nova versão ao disparar o sistema para acionar a atualização do Fabric em seu cluster.</span><span class="sxs-lookup"><span data-stu-id="77832-224">If you have set your cluster for Manual fabric upgrades, then these policies get applied each time you select a new version triggering the system to kick off the fabric upgrade in your cluster.</span></span> <span data-ttu-id="77832-225">Se você não substituir as políticas, os padrões serão usados.</span><span class="sxs-lookup"><span data-stu-id="77832-225">If you do not override the policies, the defaults are used.</span></span>

<span data-ttu-id="77832-226">Você pode especificar as políticas de integridade personalizados ou examinar as configurações atuais na folha de "atualização de malha", selecionando as configurações avançadas de atualização.</span><span class="sxs-lookup"><span data-stu-id="77832-226">You can specify the custom health policies or review the current settings under the "fabric upgrade" blade, by selecting the advanced upgrade settings.</span></span> <span data-ttu-id="77832-227">Examine a imagem a seguir com detalhes.</span><span class="sxs-lookup"><span data-stu-id="77832-227">Review the following picture on how to.</span></span> 

![Gerenciar políticas de integridade personalizadas][HealthPolices]

### <a name="customize-fabric-settings-for-your-cluster"></a><span data-ttu-id="77832-229">Personalizar as configurações do Fabric para seu cluster</span><span class="sxs-lookup"><span data-stu-id="77832-229">Customize Fabric settings for your cluster</span></span>
<span data-ttu-id="77832-230">Consulte [configurações de malha do cluster do Service Fabric](service-fabric-cluster-fabric-settings.md) para saber o que e como você pode personalizá-lo.</span><span class="sxs-lookup"><span data-stu-id="77832-230">Refer to [service fabric cluster fabric settings](service-fabric-cluster-fabric-settings.md) on what and how you can customize them.</span></span>

### <a name="os-patches-on-the-vms-that-make-up-the-cluster"></a><span data-ttu-id="77832-231">Patches do sistema operacional nas VMs que fazem parte do cluster</span><span class="sxs-lookup"><span data-stu-id="77832-231">OS patches on the VMs that make up the cluster</span></span>
<span data-ttu-id="77832-232">Consulte o [Aplicativo de orquestração de patch](service-fabric-patch-orchestration-application.md) que pode ser implantado em seu cluster para instalar patches do Windows Update de maneira orquestrada, mantendo os serviços sempre disponíveis.</span><span class="sxs-lookup"><span data-stu-id="77832-232">Refer to [Patch Orchestration Application](service-fabric-patch-orchestration-application.md) which can be deployed on your cluster to install patches from Windows Update in an orchestrated manner, keeping the services available all the time.</span></span> 

### <a name="os-upgrades-on-the-vms-that-make-up-the-cluster"></a><span data-ttu-id="77832-233">Atualizações do sistema operacional nas VMs que fazem parte do cluster</span><span class="sxs-lookup"><span data-stu-id="77832-233">OS upgrades on the VMs that make up the cluster</span></span>
<span data-ttu-id="77832-234">Se for necessário atualizar a imagem do sistema operacional nas máquinas virtuais do cluster, faça isso uma VM por vez.</span><span class="sxs-lookup"><span data-stu-id="77832-234">If you must upgrade the OS image on the virtual machines of the cluster, you must do it one VM at a time.</span></span> <span data-ttu-id="77832-235">Você é responsável por esta atualização. Atualmente não há nenhuma automação para isso.</span><span class="sxs-lookup"><span data-stu-id="77832-235">You are responsible for this upgrade--there is currently no automation for this.</span></span>

## <a name="next-steps"></a><span data-ttu-id="77832-236">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="77832-236">Next steps</span></span>
* <span data-ttu-id="77832-237">Saiba como personalizar algumas das [configurações de malha do cluster do Service Fabric](service-fabric-cluster-fabric-settings.md)</span><span class="sxs-lookup"><span data-stu-id="77832-237">Learn how to customize some of the [service fabric cluster fabric settings](service-fabric-cluster-fabric-settings.md)</span></span>
* <span data-ttu-id="77832-238">Saiba como [reduzir e escalar horizontalmente seu cluster](service-fabric-cluster-scale-up-down.md)</span><span class="sxs-lookup"><span data-stu-id="77832-238">Learn how to [scale your cluster in and out](service-fabric-cluster-scale-up-down.md)</span></span>
* <span data-ttu-id="77832-239">Saiba mais sobre [atualizações de aplicativo](service-fabric-application-upgrade.md)</span><span class="sxs-lookup"><span data-stu-id="77832-239">Learn about [application upgrades](service-fabric-application-upgrade.md)</span></span>

<!--Image references-->
[CertificateUpgrade]: ./media/service-fabric-cluster-upgrade/CertificateUpgrade2.png
[AddingProbes]: ./media/service-fabric-cluster-upgrade/addingProbes2.PNG
[AddingLBRules]: ./media/service-fabric-cluster-upgrade/addingLBRules.png
[HealthPolices]: ./media/service-fabric-cluster-upgrade/Manage_AutomodeWadvSettings.PNG
[ARMUpgradeMode]: ./media/service-fabric-cluster-upgrade/ARMUpgradeMode.PNG
[Create_Manualmode]: ./media/service-fabric-cluster-upgrade/Create_Manualmode.PNG
[Manage_Automaticmode]: ./media/service-fabric-cluster-upgrade/Manage_Automaticmode.PNG
