---
title: aaaUpgrade um cluster do Azure Service Fabric | Microsoft Docs
description: "Atualizar o código do Service Fabric hello e/ou configuração que é executado de um cluster do Service Fabric, incluindo a definição do modo de atualização de cluster, atualizar certificados, adicionando portas de aplicativo, fazendo patches do sistema operacional, e assim por diante. O que você pode esperar quando são executadas atualizações Olá?"
services: service-fabric
documentationcenter: .net
author: ChackDan
manager: timlt
editor: 
ms.assetid: 15190ace-31ed-491f-a54b-b5ff61e718db
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 8/10/2017
ms.author: chackdan
ms.openlocfilehash: 94ac3833ec0810f79de06ecb50f254028fa90408
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="upgrade-an-azure-service-fabric-cluster"></a><span data-ttu-id="a71fa-104">Atualizar um cluster do Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="a71fa-104">Upgrade an Azure Service Fabric cluster</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="a71fa-105">Cluster do Azure</span><span class="sxs-lookup"><span data-stu-id="a71fa-105">Azure Cluster</span></span>](service-fabric-cluster-upgrade.md)
> * [<span data-ttu-id="a71fa-106">Cluster Independente</span><span class="sxs-lookup"><span data-stu-id="a71fa-106">Standalone Cluster</span></span>](service-fabric-cluster-upgrade-windows-server.md)
> 
> 

<span data-ttu-id="a71fa-107">Para qualquer sistema moderno, criar o sistema é sucesso a longo prazo tooachieving chave do produto.</span><span class="sxs-lookup"><span data-stu-id="a71fa-107">For any modern system, designing for upgradability is key tooachieving long-term success of your product.</span></span> <span data-ttu-id="a71fa-108">Um cluster do Azure Service Fabric é um recurso cujo proprietário é você, mas que é parcialmente gerenciado pela Microsoft.</span><span class="sxs-lookup"><span data-stu-id="a71fa-108">An Azure Service Fabric cluster is a resource that you own, but is partly managed by Microsoft.</span></span> <span data-ttu-id="a71fa-109">Este artigo descreve o que é gerenciado automaticamente e o que você pode configurar por conta própria.</span><span class="sxs-lookup"><span data-stu-id="a71fa-109">This article describes what is managed automatically and what you can configure yourself.</span></span>

## <a name="controlling-hello-fabric-version-that-runs-on-your-cluster"></a><span data-ttu-id="a71fa-110">Controle de versão do fabric Olá que é executado em seu Cluster</span><span class="sxs-lookup"><span data-stu-id="a71fa-110">Controlling hello fabric version that runs on your Cluster</span></span>
<span data-ttu-id="a71fa-111">Você pode definir sua malha automática do cluster tooreceive atualizações conforme elas são lançadas pela Microsoft ou você pode selecionar uma versão com suporte de malha que quiser toobe seu cluster.</span><span class="sxs-lookup"><span data-stu-id="a71fa-111">You can set your cluster tooreceive automatic fabric upgrades as they are released by Microsoft or you can select a supported fabric version you want your cluster toobe on.</span></span>

<span data-ttu-id="a71fa-112">Você pode fazer isso definindo hello "upgradeMode" cluster a configuração no portal de saudação ou usando o Gerenciador de recursos em tempo de saudação da criação ou posterior em um cluster ao vivo</span><span class="sxs-lookup"><span data-stu-id="a71fa-112">You do this by setting hello "upgradeMode" cluster configuration on hello portal or using Resource Manager at hello time of creation or later on a live cluster</span></span> 

> [!NOTE]
> <span data-ttu-id="a71fa-113">Verifique se tookeep o cluster executando uma versão com suporte de malha sempre.</span><span class="sxs-lookup"><span data-stu-id="a71fa-113">Make sure tookeep your cluster running a supported fabric version always.</span></span> <span data-ttu-id="a71fa-114">Como e quando é anunciar o lançamento de saudação de uma nova versão da malha do serviço, versão anterior de saudação está marcado para o fim do suporte após um mínimo de 60 dias a partir dessa data.</span><span class="sxs-lookup"><span data-stu-id="a71fa-114">As and when we announce hello release of a new version of service fabric, hello previous version is marked for end of support after a minimum of 60 days from that date.</span></span> <span data-ttu-id="a71fa-115">Olá novas versões de saudação são anunciadas [no blog da equipe Olá service fabric](https://blogs.msdn.microsoft.com/azureservicefabric/).</span><span class="sxs-lookup"><span data-stu-id="a71fa-115">hello  hello new releases are announced [on hello service fabric team blog](https://blogs.msdn.microsoft.com/azureservicefabric/).</span></span> <span data-ttu-id="a71fa-116">nova versão de Hello é toochoose disponível.</span><span class="sxs-lookup"><span data-stu-id="a71fa-116">hello new release is available toochoose then.</span></span> 
> 
> 

<span data-ttu-id="a71fa-117">14 dias anteriores toohello expiração da versão de saudação seu cluster está em execução, será gerado um evento de integridade que coloca o cluster em um estado de integridade de aviso.</span><span class="sxs-lookup"><span data-stu-id="a71fa-117">14 days prior toohello expiry of hello release your cluster is running, a health event is generated that puts your cluster into a warning health state.</span></span> <span data-ttu-id="a71fa-118">cluster Olá permanece em um estado de aviso até você atualizar a versão de malha com suporte de tooa.</span><span class="sxs-lookup"><span data-stu-id="a71fa-118">hello cluster remains in a warning state until you upgrade tooa supported fabric version.</span></span>

### <a name="setting-hello-upgrade-mode-via-portal"></a><span data-ttu-id="a71fa-119">Definir o modo de atualização de saudação por meio do portal</span><span class="sxs-lookup"><span data-stu-id="a71fa-119">Setting hello upgrade mode via portal</span></span>
<span data-ttu-id="a71fa-120">Quando você estiver criando Olá cluster, você pode definir Olá cluster tooautomatic ou manual.</span><span class="sxs-lookup"><span data-stu-id="a71fa-120">You can set hello cluster tooautomatic or manual when you are creating hello cluster.</span></span>

![Create_Manualmode][Create_Manualmode]

<span data-ttu-id="a71fa-122">Você pode definir Olá cluster tooautomatic ou manual quando em um cluster de ao vivo, usando o hello gerenciar a experiência.</span><span class="sxs-lookup"><span data-stu-id="a71fa-122">You can set hello cluster tooautomatic or manual when on a live cluster, using hello manage experience.</span></span> 

#### <a name="upgrading-tooa-new-version-on-a-cluster-that-is-set-toomanual-mode-via-portal"></a><span data-ttu-id="a71fa-123">Atualizando tooa nova versão em um cluster que é definir o modo de tooManual por meio do portal.</span><span class="sxs-lookup"><span data-stu-id="a71fa-123">Upgrading tooa new version on a cluster that is set tooManual mode via portal.</span></span>
<span data-ttu-id="a71fa-124">tooupgrade tooa nova versão, você só precisa toodo é selecionem versão disponível Olá Olá suspenso e salvar.</span><span class="sxs-lookup"><span data-stu-id="a71fa-124">tooupgrade tooa new version, all you need toodo is select hello available version from hello dropdown and save.</span></span> <span data-ttu-id="a71fa-125">atualização do Fabric Olá obtém foi iniciada automaticamente.</span><span class="sxs-lookup"><span data-stu-id="a71fa-125">hello Fabric upgrade gets kicked off automatically.</span></span> <span data-ttu-id="a71fa-126">Olá diretivas de integridade do cluster (uma combinação de integridade do nó e a integridade de saudação todos os aplicativos em execução no cluster de saudação de Olá) sejam atendidas tooduring atualização de saudação.</span><span class="sxs-lookup"><span data-stu-id="a71fa-126">hello cluster health policies (a combination of node health and hello health all hello applications running in hello cluster) are adhered tooduring hello upgrade.</span></span>

<span data-ttu-id="a71fa-127">Se as diretivas de integridade do cluster Olá não forem atendidas, atualização de saudação é revertida.</span><span class="sxs-lookup"><span data-stu-id="a71fa-127">If hello cluster health policies are not met, hello upgrade is rolled back.</span></span> <span data-ttu-id="a71fa-128">Role para baixo essa tooread de documento mais informações sobre como tooset as políticas de integridade personalizado.</span><span class="sxs-lookup"><span data-stu-id="a71fa-128">Scroll down this document tooread more on how tooset those custom health policies.</span></span> 

<span data-ttu-id="a71fa-129">Depois de corrigir problemas de saudação que resultaram em reversão hello, necessidade atualização de saudação tooinitiate novamente, por seguir Olá mesmo etapas como antes.</span><span class="sxs-lookup"><span data-stu-id="a71fa-129">Once you have fixed hello issues that resulted in hello rollback, you need tooinitiate hello upgrade again, by following hello same steps as before.</span></span>

![Manage_Automaticmode][Manage_Automaticmode]

### <a name="setting-hello-upgrade-mode-via-a-resource-manager-template"></a><span data-ttu-id="a71fa-131">Definir o modo de atualização de saudação por meio de um modelo do Gerenciador de recursos</span><span class="sxs-lookup"><span data-stu-id="a71fa-131">Setting hello upgrade mode via a Resource Manager template</span></span>
<span data-ttu-id="a71fa-132">Adicione Olá a definição de recurso "upgradeMode" configuração toohello Microsoft.ServiceFabric/clusters e conjunto hello "clusterCodeVersion" tooone de saudação suporte para versões de malha, conforme mostrado abaixo e, em seguida, implante o modelo de saudação.</span><span class="sxs-lookup"><span data-stu-id="a71fa-132">Add hello "upgradeMode" configuration toohello Microsoft.ServiceFabric/clusters resource definition and set hello "clusterCodeVersion" tooone of hello supported fabric versions as shown below and then deploy hello template.</span></span> <span data-ttu-id="a71fa-133">os valores válidos para "upgradeMode" Hello são "Manual" ou "Automático"</span><span class="sxs-lookup"><span data-stu-id="a71fa-133">hello valid values for "upgradeMode" are "Manual" or "Automatic"</span></span>

![ARMUpgradeMode][ARMUpgradeMode]

#### <a name="upgrading-tooa-new-version-on-a-cluster-that-is-set-toomanual-mode-via-a-resource-manager-template"></a><span data-ttu-id="a71fa-135">Atualizando tooa nova versão em um cluster que é definir o modo de tooManual por meio de um modelo do Gerenciador de recursos.</span><span class="sxs-lookup"><span data-stu-id="a71fa-135">Upgrading tooa new version on a cluster that is set tooManual mode via a Resource Manager template.</span></span>
<span data-ttu-id="a71fa-136">Quando o cluster hello está em modo Manual, tooupgrade tooa nova versão, alterar a versão com suporte do tooa clusterCodeVersion"hello" e implantá-lo.</span><span class="sxs-lookup"><span data-stu-id="a71fa-136">When hello cluster is in Manual mode, tooupgrade tooa new version, change hello "clusterCodeVersion" tooa supported version and deploy it.</span></span> <span data-ttu-id="a71fa-137">implantação de saudação do modelo Olá, é ativada de atualização do Fabric Olá obtém foi iniciada automaticamente.</span><span class="sxs-lookup"><span data-stu-id="a71fa-137">hello deployment of hello template, kicks of hello Fabric upgrade gets kicked off automatically.</span></span> <span data-ttu-id="a71fa-138">Olá diretivas de integridade do cluster (uma combinação de integridade do nó e a integridade de saudação todos os aplicativos em execução no cluster de saudação de Olá) sejam atendidas tooduring atualização de saudação.</span><span class="sxs-lookup"><span data-stu-id="a71fa-138">hello cluster health policies (a combination of node health and hello health all hello applications running in hello cluster) are adhered tooduring hello upgrade.</span></span>

<span data-ttu-id="a71fa-139">Se as diretivas de integridade do cluster Olá não forem atendidas, atualização de saudação é revertida.</span><span class="sxs-lookup"><span data-stu-id="a71fa-139">If hello cluster health policies are not met, hello upgrade is rolled back.</span></span> <span data-ttu-id="a71fa-140">Role para baixo essa tooread de documento mais informações sobre como tooset as políticas de integridade personalizado.</span><span class="sxs-lookup"><span data-stu-id="a71fa-140">Scroll down this document tooread more on how tooset those custom health policies.</span></span> 

<span data-ttu-id="a71fa-141">Depois de corrigir problemas de saudação que resultaram em reversão hello, necessidade atualização de saudação tooinitiate novamente, por seguir Olá mesmo etapas como antes.</span><span class="sxs-lookup"><span data-stu-id="a71fa-141">Once you have fixed hello issues that resulted in hello rollback, you need tooinitiate hello upgrade again, by following hello same steps as before.</span></span>

### <a name="get-list-of-all-available-version-for-all-environments-for-a-given-subscription"></a><span data-ttu-id="a71fa-142">Obter uma lista de todas as versões disponíveis para todos os ambientes para determinada assinatura</span><span class="sxs-lookup"><span data-stu-id="a71fa-142">Get list of all available version for all environments for a given subscription</span></span>
<span data-ttu-id="a71fa-143">Executar Olá o comando a seguir, e você deve obter um toothis semelhante de saída.</span><span class="sxs-lookup"><span data-stu-id="a71fa-143">Run hello following command, and you should get an output similar toothis.</span></span>

<span data-ttu-id="a71fa-144">"supportExpiryUtc" informa o quando determinada versão está expirando ou expirou.</span><span class="sxs-lookup"><span data-stu-id="a71fa-144">"supportExpiryUtc" tells your when a given release is expiring or has expired.</span></span> <span data-ttu-id="a71fa-145">Olá versão mais recente não tem uma data válida - possui um valor de "9999-12-31T23:59:59.9999999", que significa apenas data de expiração de saudação ainda não está definida.</span><span class="sxs-lookup"><span data-stu-id="a71fa-145">hello latest release does not have a valid date - it has a value of "9999-12-31T23:59:59.9999999", which just means that hello expiry date is not yet set.</span></span>

```REST
GET https://<endpoint>/subscriptions/{{subscriptionId}}/providers/Microsoft.ServiceFabric/locations/{{location}}/clusterVersions?api-version=2016-09-01

Example: https://management.azure.com/subscriptions/1857f442-3bce-4b96-ad95-627f76437a67/providers/Microsoft.ServiceFabric/locations/eastus/clusterVersions?api-version=2016-09-01

Output:
{
                  "value": [
                    {
                      "id": "subscriptions/35349203-a0b3-405e-8a23-9f1450984307/providers/Microsoft.ServiceFabric/environments/Windows/clusterVersions/5.0.1427.9490",
                      "name": "5.0.1427.9490",
                      "type": "Microsoft.ServiceFabric/environments/clusterVersions",
                      "properties": {
                        "codeVersion": "5.0.1427.9490",
                        "supportExpiryUtc": "2016-11-26T23:59:59.9999999",
                        "environment": "Windows"
                      }
                    },
                    {
                      "id": "subscriptions/35349203-a0b3-405e-8a23-9f1450984307/providers/Microsoft.ServiceFabric/environments/Windows/clusterVersions/4.0.1427.9490",
                      "name": "5.1.1427.9490",
                      "type": " Microsoft.ServiceFabric/environments/clusterVersions",
                      "properties": {
                        "codeVersion": "5.1.1427.9490",
                        "supportExpiryUtc": "9999-12-31T23:59:59.9999999",
                        "environment": "Windows"
                      }
                    },
                    {
                      "id": "subscriptions/35349203-a0b3-405e-8a23-9f1450984307/providers/Microsoft.ServiceFabric/environments/Windows/clusterVersions/4.4.1427.9490",
                      "name": "4.4.1427.9490",
                      "type": " Microsoft.ServiceFabric/environments/clusterVersions",
                      "properties": {
                        "codeVersion": "4.4.1427.9490",
                        "supportExpiryUtc": "9999-12-31T23:59:59.9999999",
                        "environment": "Linux"
                      }
                    }
                  ]
                }


```

## <a name="fabric-upgrade-behavior-when-hello-cluster-upgrade-mode-is-automatic"></a><span data-ttu-id="a71fa-146">Comportamento de atualização do Fabric quando o modo de atualização de cluster Olá é automático</span><span class="sxs-lookup"><span data-stu-id="a71fa-146">Fabric upgrade behavior when hello cluster Upgrade Mode is Automatic</span></span>
<span data-ttu-id="a71fa-147">A Microsoft mantém o código de malha de saudação e de configuração que é executado em um cluster do Azure.</span><span class="sxs-lookup"><span data-stu-id="a71fa-147">Microsoft maintains hello fabric code and configuration that runs in an Azure cluster.</span></span> <span data-ttu-id="a71fa-148">Podemos executar o software de toohello monitorado de atualizações automáticas como necessário.</span><span class="sxs-lookup"><span data-stu-id="a71fa-148">We perform automatic monitored upgrades toohello software on an as-needed basis.</span></span> <span data-ttu-id="a71fa-149">Essas atualizações podem ser feitas no código, na configuração ou em ambos.</span><span class="sxs-lookup"><span data-stu-id="a71fa-149">These upgrades could be code, configuration, or both.</span></span> <span data-ttu-id="a71fa-150">toomake-se de que seu aplicativo não sofre nenhum impacto ou o mínimo de impacto devido a atualizações toothese, podemos realizar atualizações Olá no hello fases a seguir:</span><span class="sxs-lookup"><span data-stu-id="a71fa-150">toomake sure that your application suffers no impact or minimal impact due toothese upgrades, we perform hello upgrades in hello following phases:</span></span>

### <a name="phase-1-an-upgrade-is-performed-by-using-all-cluster-health-policies"></a><span data-ttu-id="a71fa-151">Fase 1: uma atualização é executada usando todas as políticas de integridade do cluster</span><span class="sxs-lookup"><span data-stu-id="a71fa-151">Phase 1: An upgrade is performed by using all cluster health policies</span></span>
<span data-ttu-id="a71fa-152">Durante essa fase, atualizações Olá continuar um domínio de atualização por vez, e os aplicativos de saudação que estavam em execução no cluster Olá continuam toorun sem qualquer tempo de inatividade.</span><span class="sxs-lookup"><span data-stu-id="a71fa-152">During this phase, hello upgrades proceed one upgrade domain at a time, and hello applications that were running in hello cluster continue toorun without any downtime.</span></span> <span data-ttu-id="a71fa-153">Olá diretivas de integridade do cluster (uma combinação de integridade do nó e a integridade de saudação todos os aplicativos em execução no cluster de saudação de Olá) sejam atendidas tooduring atualização de saudação.</span><span class="sxs-lookup"><span data-stu-id="a71fa-153">hello cluster health policies (a combination of node health and hello health all hello applications running in hello cluster) are adhered tooduring hello upgrade.</span></span>

<span data-ttu-id="a71fa-154">Se as diretivas de integridade do cluster Olá não forem atendidas, atualização de saudação é revertida.</span><span class="sxs-lookup"><span data-stu-id="a71fa-154">If hello cluster health policies are not met, hello upgrade is rolled back.</span></span> <span data-ttu-id="a71fa-155">Em seguida, um email é enviado toohello proprietário da assinatura de saudação.</span><span class="sxs-lookup"><span data-stu-id="a71fa-155">Then an email is sent toohello owner of hello subscription.</span></span> <span data-ttu-id="a71fa-156">email Olá contém Olá informações a seguir:</span><span class="sxs-lookup"><span data-stu-id="a71fa-156">hello email contains hello following information:</span></span>

* <span data-ttu-id="a71fa-157">Notificação de que precisamos fazer tooroll uma atualização de cluster.</span><span class="sxs-lookup"><span data-stu-id="a71fa-157">Notification that we had tooroll back a cluster upgrade.</span></span>
* <span data-ttu-id="a71fa-158">Sugestões de ações corretivas, se houver alguma.</span><span class="sxs-lookup"><span data-stu-id="a71fa-158">Suggested remedial actions, if any.</span></span>
* <span data-ttu-id="a71fa-159">Olá quantos dias (n) até que executamos fase 2.</span><span class="sxs-lookup"><span data-stu-id="a71fa-159">hello number of days (n) until we execute Phase 2.</span></span>

<span data-ttu-id="a71fa-160">Tentamos Olá tooexecute que mesmo atualizar mais algumas vezes, no caso de falha de todas as atualizações por motivos de infraestrutura.</span><span class="sxs-lookup"><span data-stu-id="a71fa-160">We try tooexecute hello same upgrade a few more times in case any upgrades failed for infrastructure reasons.</span></span> <span data-ttu-id="a71fa-161">Após a saudação n dias do email de Olá Olá data foi enviado, podemos continuar tooPhase 2.</span><span class="sxs-lookup"><span data-stu-id="a71fa-161">After hello n days from hello date hello email was sent, we proceed tooPhase 2.</span></span>

<span data-ttu-id="a71fa-162">Se as diretivas de integridade do cluster Olá forem atendidas, atualização de saudação é considerada bem-sucedida e marcadas como concluída.</span><span class="sxs-lookup"><span data-stu-id="a71fa-162">If hello cluster health policies are met, hello upgrade is considered successful and marked complete.</span></span> <span data-ttu-id="a71fa-163">Isso pode ocorrer durante a atualização de saudação inicial ou de qualquer execução repetida de atualização de saudação nesta fase.</span><span class="sxs-lookup"><span data-stu-id="a71fa-163">This can happen during hello initial upgrade or any of hello upgrade reruns in this phase.</span></span> <span data-ttu-id="a71fa-164">Nenhum email de confirmação será enviado após uma execução bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="a71fa-164">There is no email confirmation of a successful run.</span></span> <span data-ttu-id="a71fa-165">Isso é tooavoid enviando você muitos emails – receber um email deve ser consideradas toonormal uma exceção.</span><span class="sxs-lookup"><span data-stu-id="a71fa-165">This is tooavoid sending you too many emails--receiving an email should be seen as an exception toonormal.</span></span> <span data-ttu-id="a71fa-166">Esperamos que a maioria das Olá toosucceed de atualizações de cluster sem afetar a disponibilidade do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a71fa-166">We expect most of hello cluster upgrades toosucceed without impacting your application availability.</span></span>

### <a name="phase-2-an-upgrade-is-performed-by-using-default-health-policies-only"></a><span data-ttu-id="a71fa-167">Fase 2: uma atualização é executada usando apenas as políticas de integridade padrão</span><span class="sxs-lookup"><span data-stu-id="a71fa-167">Phase 2: An upgrade is performed by using default health policies only</span></span>
<span data-ttu-id="a71fa-168">políticas de integridade Olá nesta fase são definidas de forma que o número de saudação de aplicativos que foram Íntegro no início de saudação da atualização Olá permanece Olá mesmo para Olá duração do processo de atualização de saudação.</span><span class="sxs-lookup"><span data-stu-id="a71fa-168">hello health policies in this phase are set in such a way that hello number of applications that were healthy at hello beginning of hello upgrade remains hello same for hello duration of hello upgrade process.</span></span> <span data-ttu-id="a71fa-169">Como na fase 1, atualizações Olá fase 2 continuar um domínio de atualização por vez, e os aplicativos de Olá que estavam em execução no cluster Olá continuam toorun sem qualquer tempo de inatividade.</span><span class="sxs-lookup"><span data-stu-id="a71fa-169">As in Phase 1, hello Phase 2 upgrades proceed one upgrade domain at a time, and hello applications that were running in hello cluster continue toorun without any downtime.</span></span> <span data-ttu-id="a71fa-170">diretivas de integridade do cluster Hello (uma combinação de integridade do nó e a integridade de saudação que todos os aplicativos em execução no cluster de saudação de Olá) são toofor sejam seguidos Olá durante atualização de saudação.</span><span class="sxs-lookup"><span data-stu-id="a71fa-170">hello cluster health policies (a combination of node health and hello health all hello applications running in hello cluster) are adhered toofor hello duration of hello upgrade.</span></span>

<span data-ttu-id="a71fa-171">Se as diretivas de integridade do cluster Olá em vigor não forem atendidas, atualização de saudação é revertida.</span><span class="sxs-lookup"><span data-stu-id="a71fa-171">If hello cluster health policies in effect are not met, hello upgrade is rolled back.</span></span> <span data-ttu-id="a71fa-172">Em seguida, um email é enviado toohello proprietário da assinatura de saudação.</span><span class="sxs-lookup"><span data-stu-id="a71fa-172">Then an email is sent toohello owner of hello subscription.</span></span> <span data-ttu-id="a71fa-173">email Olá contém Olá informações a seguir:</span><span class="sxs-lookup"><span data-stu-id="a71fa-173">hello email contains hello following information:</span></span>

* <span data-ttu-id="a71fa-174">Notificação de que precisamos fazer tooroll uma atualização de cluster.</span><span class="sxs-lookup"><span data-stu-id="a71fa-174">Notification that we had tooroll back a cluster upgrade.</span></span>
* <span data-ttu-id="a71fa-175">Sugestões de ações corretivas, se houver alguma.</span><span class="sxs-lookup"><span data-stu-id="a71fa-175">Suggested remedial actions, if any.</span></span>
* <span data-ttu-id="a71fa-176">Olá quantos dias (n) até que executamos fase 3.</span><span class="sxs-lookup"><span data-stu-id="a71fa-176">hello number of days (n) until we execute Phase 3.</span></span>

<span data-ttu-id="a71fa-177">Tentamos Olá tooexecute que mesmo atualizar mais algumas vezes, no caso de falha de todas as atualizações por motivos de infraestrutura.</span><span class="sxs-lookup"><span data-stu-id="a71fa-177">We try tooexecute hello same upgrade a few more times in case any upgrades failed for infrastructure reasons.</span></span> <span data-ttu-id="a71fa-178">Um lembrete será enviado por email alguns dias antes do término dos n dias.</span><span class="sxs-lookup"><span data-stu-id="a71fa-178">A reminder email is sent a couple of days before n days are up.</span></span> <span data-ttu-id="a71fa-179">Após a saudação n dias do email de Olá Olá data foi enviado, podemos continuar tooPhase 3.</span><span class="sxs-lookup"><span data-stu-id="a71fa-179">After hello n days from hello date hello email was sent, we proceed tooPhase 3.</span></span> <span data-ttu-id="a71fa-180">emails Olá que enviaremos na fase 2 devem ser levadas a sério e ações corretivas devem ser executadas.</span><span class="sxs-lookup"><span data-stu-id="a71fa-180">hello emails we send you in Phase 2 must be taken seriously and remedial actions must be taken.</span></span>

<span data-ttu-id="a71fa-181">Se as diretivas de integridade do cluster Olá forem atendidas, atualização de saudação é considerada bem-sucedida e marcadas como concluída.</span><span class="sxs-lookup"><span data-stu-id="a71fa-181">If hello cluster health policies are met, hello upgrade is considered successful and marked complete.</span></span> <span data-ttu-id="a71fa-182">Isso pode ocorrer durante a atualização de saudação inicial ou de qualquer execução repetida de atualização de saudação nesta fase.</span><span class="sxs-lookup"><span data-stu-id="a71fa-182">This can happen during hello initial upgrade or any of hello upgrade reruns in this phase.</span></span> <span data-ttu-id="a71fa-183">Nenhum email de confirmação será enviado após uma execução bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="a71fa-183">There is no email confirmation of a successful run.</span></span>

### <a name="phase-3-an-upgrade-is-performed-by-using-aggressive-health-policies"></a><span data-ttu-id="a71fa-184">Fase 3: uma atualização é executada usando políticas de integridade agressivas</span><span class="sxs-lookup"><span data-stu-id="a71fa-184">Phase 3: An upgrade is performed by using aggressive health policies</span></span>
<span data-ttu-id="a71fa-185">Essas políticas de integridade nessa fase se destinam a conclusão da atualização de saudação em vez de integridade de saudação de aplicativos de saudação.</span><span class="sxs-lookup"><span data-stu-id="a71fa-185">These health policies in this phase are geared towards completion of hello upgrade rather than hello health of hello applications.</span></span> <span data-ttu-id="a71fa-186">Pouquíssimas atualizações de cluster chegam a esta fase.</span><span class="sxs-lookup"><span data-stu-id="a71fa-186">Very few cluster upgrades end up in this phase.</span></span> <span data-ttu-id="a71fa-187">Se o cluster obtém toothis fase, há uma boa chance de que seu aplicativo se tornará não íntegro e/ou perda de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="a71fa-187">If your cluster gets toothis phase, there is a good chance that your application becomes unhealthy and/or lose availability.</span></span>

<span data-ttu-id="a71fa-188">Toohello semelhante outras duas fases, atualizações de fase 3 continuar um domínio de atualização por vez.</span><span class="sxs-lookup"><span data-stu-id="a71fa-188">Similar toohello other two phases, Phase 3 upgrades proceed one upgrade domain at a time.</span></span>

<span data-ttu-id="a71fa-189">Se as diretivas de integridade do cluster Olá não forem atendidas, atualização de saudação é revertida.</span><span class="sxs-lookup"><span data-stu-id="a71fa-189">If hello cluster health policies are not met, hello upgrade is rolled back.</span></span> <span data-ttu-id="a71fa-190">Tentamos Olá tooexecute que mesmo atualizar mais algumas vezes, no caso de falha de todas as atualizações por motivos de infraestrutura.</span><span class="sxs-lookup"><span data-stu-id="a71fa-190">We try tooexecute hello same upgrade a few more times in case any upgrades failed for infrastructure reasons.</span></span> <span data-ttu-id="a71fa-191">Depois disso, o cluster de saudação é fixado, para que ele não receberá mais suporte e/ou atualizações.</span><span class="sxs-lookup"><span data-stu-id="a71fa-191">After that, hello cluster is pinned, so that it will no longer receive support and/or upgrades.</span></span>

<span data-ttu-id="a71fa-192">Proprietário da assinatura toohello, junto com as ações corretivas Olá é enviado a um email com essas informações.</span><span class="sxs-lookup"><span data-stu-id="a71fa-192">An email with this information is sent toohello subscription owner, along with hello remedial actions.</span></span> <span data-ttu-id="a71fa-193">Não esperamos que qualquer tooget clusters em um estado em que a fase 3 falhou.</span><span class="sxs-lookup"><span data-stu-id="a71fa-193">We do not expect any clusters tooget into a state where Phase 3 has failed.</span></span>

<span data-ttu-id="a71fa-194">Se as diretivas de integridade do cluster Olá forem atendidas, atualização de saudação é considerada bem-sucedida e marcadas como concluída.</span><span class="sxs-lookup"><span data-stu-id="a71fa-194">If hello cluster health policies are met, hello upgrade is considered successful and marked complete.</span></span> <span data-ttu-id="a71fa-195">Isso pode ocorrer durante a atualização de saudação inicial ou de qualquer execução repetida de atualização de saudação nesta fase.</span><span class="sxs-lookup"><span data-stu-id="a71fa-195">This can happen during hello initial upgrade or any of hello upgrade reruns in this phase.</span></span> <span data-ttu-id="a71fa-196">Nenhum email de confirmação será enviado após uma execução bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="a71fa-196">There is no email confirmation of a successful run.</span></span>

## <a name="cluster-configurations-that-you-control"></a><span data-ttu-id="a71fa-197">Configurações do cluster que você controla</span><span class="sxs-lookup"><span data-stu-id="a71fa-197">Cluster configurations that you control</span></span>
<span data-ttu-id="a71fa-198">Além de modo a atualização do cluster de saudação do toohello capacidade tooset, aqui estão configurações de saudação que podem ser alteradas em um cluster ao vivo.</span><span class="sxs-lookup"><span data-stu-id="a71fa-198">In addition toohello ability tooset hello cluster upgrade mode, Here are hello configurations that you can change on a live cluster.</span></span>

### <a name="certificates"></a><span data-ttu-id="a71fa-199">Certificados</span><span class="sxs-lookup"><span data-stu-id="a71fa-199">Certificates</span></span>
<span data-ttu-id="a71fa-200">Você pode adicionar novas ou exclua os certificados de cliente por meio do portal hello e cluster Olá facilmente.</span><span class="sxs-lookup"><span data-stu-id="a71fa-200">You can add new or delete certificates for hello cluster and client via hello portal easily.</span></span> <span data-ttu-id="a71fa-201">Consulte também[neste documento para obter instruções detalhadas](service-fabric-cluster-security-update-certs-azure.md)</span><span class="sxs-lookup"><span data-stu-id="a71fa-201">Refer too[this document for detailed instructions](service-fabric-cluster-security-update-certs-azure.md)</span></span>

![Captura de tela que mostra as impressões digitais de certificado no portal do Azure de saudação.][CertificateUpgrade]

### <a name="application-ports"></a><span data-ttu-id="a71fa-203">Portas do aplicativo</span><span class="sxs-lookup"><span data-stu-id="a71fa-203">Application ports</span></span>
<span data-ttu-id="a71fa-204">Você pode alterar as portas de aplicativo alterando propriedades de recurso do hello balanceador de carga que estão associadas com o tipo de nó de saudação.</span><span class="sxs-lookup"><span data-stu-id="a71fa-204">You can change application ports by changing hello Load Balancer resource properties that are associated with hello node type.</span></span> <span data-ttu-id="a71fa-205">Você pode usar o portal de hello, ou você pode usar o Gerenciador de recursos do PowerShell diretamente.</span><span class="sxs-lookup"><span data-stu-id="a71fa-205">You can use hello portal, or you can use Resource Manager PowerShell directly.</span></span>

<span data-ttu-id="a71fa-206">tooopen uma nova porta em todas as VMs em um tipo de nó, Olá a seguir:</span><span class="sxs-lookup"><span data-stu-id="a71fa-206">tooopen a new port on all VMs in a node type, do hello following:</span></span>

1. <span data-ttu-id="a71fa-207">Adicione um novo balanceador de carga adequado de toohello de teste.</span><span class="sxs-lookup"><span data-stu-id="a71fa-207">Add a new probe toohello appropriate load balancer.</span></span>
   
    <span data-ttu-id="a71fa-208">Se você implantou o cluster usando o portal de hello, balanceadores de carga de saudação são nomeados "LB-nome do grupo de recursos de saudação-NodeTypename", uma para cada tipo de nó.</span><span class="sxs-lookup"><span data-stu-id="a71fa-208">If you deployed your cluster by using hello portal, hello load balancers are named "LB-name of hello Resource group-NodeTypename", one for each node type.</span></span> <span data-ttu-id="a71fa-209">Como os nomes de Balanceador de carga de saudação são exclusivos somente dentro de um grupo de recursos, é melhor se você pesquisar por-los em um grupo de recursos específicos.</span><span class="sxs-lookup"><span data-stu-id="a71fa-209">Since hello load balancer names are unique only within a resource group, it is best if you search for them under a specific resource group.</span></span>
   
    ![Captura de tela que mostra a adição de uma investigação tooa balanceador de carga no portal de saudação.][AddingProbes]
2. <span data-ttu-id="a71fa-211">Adicione um balanceador de carga de toohello regra nova.</span><span class="sxs-lookup"><span data-stu-id="a71fa-211">Add a new rule toohello load balancer.</span></span>
   
    <span data-ttu-id="a71fa-212">Adicione um novo toohello de regra mesmo balanceador de carga usando o teste Olá que você criou na etapa anterior hello.</span><span class="sxs-lookup"><span data-stu-id="a71fa-212">Add a new rule toohello same load balancer by using hello probe that you created in hello previous step.</span></span>
   
    ![Adicionar um balanceador de carga nova regra tooa no portal de saudação.][AddingLBRules]

### <a name="placement-properties"></a><span data-ttu-id="a71fa-214">Propriedades de posicionamento</span><span class="sxs-lookup"><span data-stu-id="a71fa-214">Placement properties</span></span>
<span data-ttu-id="a71fa-215">Para cada um dos tipos de nós hello, você pode adicionar propriedades de posicionamento personalizado que você deseja toouse em seus aplicativos.</span><span class="sxs-lookup"><span data-stu-id="a71fa-215">For each of hello node types, you can add custom placement properties that you want toouse in your applications.</span></span> <span data-ttu-id="a71fa-216">NodeType é uma propriedade padrão que você pode usar sem adicioná-la explicitamente.</span><span class="sxs-lookup"><span data-stu-id="a71fa-216">NodeType is a default property that you can use without adding it explicitly.</span></span>

> [!NOTE]
> <span data-ttu-id="a71fa-217">Para obter detalhes sobre o uso de saudação de restrições de posicionamento, propriedades de nó, e como toodefine-los, consulte toohello seção "Restrições de posicionamento e propriedades de nó" hello documento do Gerenciador de recursos de Cluster do serviço de malha em [descrevendo o Cluster ](service-fabric-cluster-resource-manager-cluster-description.md).</span><span class="sxs-lookup"><span data-stu-id="a71fa-217">For details on hello use of placement constraints, node properties, and how toodefine them, refer toohello section "Placement Constraints and Node Properties" in hello Service Fabric Cluster Resource Manager Document on [Describing Your Cluster](service-fabric-cluster-resource-manager-cluster-description.md).</span></span>
> 
> 

### <a name="capacity-metrics"></a><span data-ttu-id="a71fa-218">Métricas de capacidade</span><span class="sxs-lookup"><span data-stu-id="a71fa-218">Capacity metrics</span></span>
<span data-ttu-id="a71fa-219">Para cada um dos tipos de nós hello, você pode adicionar métricas de capacidade personalizadas que você deseja toouse em sua carga de tooreport de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="a71fa-219">For each of hello node types, you can add custom capacity metrics that you want toouse in your applications tooreport load.</span></span> <span data-ttu-id="a71fa-220">Para obter detalhes sobre o uso de saudação de carga de tooreport de métricas de capacidade, consulte toohello documentos do Gerenciador de recursos de Cluster do serviço de malha em [descrevendo seu Cluster](service-fabric-cluster-resource-manager-cluster-description.md) e [métricas e carga](service-fabric-cluster-resource-manager-metrics.md).</span><span class="sxs-lookup"><span data-stu-id="a71fa-220">For details on hello use of capacity metrics tooreport load, refer toohello Service Fabric Cluster Resource Manager Documents on [Describing Your Cluster](service-fabric-cluster-resource-manager-cluster-description.md) and [Metrics and Load](service-fabric-cluster-resource-manager-metrics.md).</span></span>

### <a name="fabric-upgrade-settings---health-polices"></a><span data-ttu-id="a71fa-221">Configurações de atualização do Fabric – Políticas de integridade</span><span class="sxs-lookup"><span data-stu-id="a71fa-221">Fabric upgrade settings - Health polices</span></span>
<span data-ttu-id="a71fa-222">Você pode especificar as políticas de integridade personalizadas para atualização do Fabric.</span><span class="sxs-lookup"><span data-stu-id="a71fa-222">You can specify custom health polices for fabric upgrade.</span></span> <span data-ttu-id="a71fa-223">Se você tiver configurado o cluster tooAutomatic atualizações de malha, essas políticas obtém aplicado toohello fase 1 de atualizações de malha automática hello.</span><span class="sxs-lookup"><span data-stu-id="a71fa-223">If you have set your cluster tooAutomatic fabric upgrades, then these policies get applied toohello Phase-1 of hello automatic fabric upgrades.</span></span>
<span data-ttu-id="a71fa-224">Se você tiver configurado o cluster para a malha Manual atualizações, em seguida, essas políticas são aplicadas a cada vez que você selecionar uma nova versão de disparo Olá sistema tookick desativar a atualização do fabric Olá no cluster.</span><span class="sxs-lookup"><span data-stu-id="a71fa-224">If you have set your cluster for Manual fabric upgrades, then these policies get applied each time you select a new version triggering hello system tookick off hello fabric upgrade in your cluster.</span></span> <span data-ttu-id="a71fa-225">Se você não substituir políticas hello, Olá padrões são usados.</span><span class="sxs-lookup"><span data-stu-id="a71fa-225">If you do not override hello policies, hello defaults are used.</span></span>

<span data-ttu-id="a71fa-226">Você pode especificar políticas de integridade personalizado hello ou revisar configurações atuais de saudação com folha de "atualização do fabric" Olá, selecionando Olá atualização configurações avançada.</span><span class="sxs-lookup"><span data-stu-id="a71fa-226">You can specify hello custom health policies or review hello current settings under hello "fabric upgrade" blade, by selecting hello advanced upgrade settings.</span></span> <span data-ttu-id="a71fa-227">Examine Olá figura abaixo sobre como.</span><span class="sxs-lookup"><span data-stu-id="a71fa-227">Review hello following picture on how to.</span></span> 

![Gerenciar políticas de integridade personalizadas][HealthPolices]

### <a name="customize-fabric-settings-for-your-cluster"></a><span data-ttu-id="a71fa-229">Personalizar as configurações do Fabric para seu cluster</span><span class="sxs-lookup"><span data-stu-id="a71fa-229">Customize Fabric settings for your cluster</span></span>
<span data-ttu-id="a71fa-230">Consulte também[configurações de malha de cluster de malha do serviço](service-fabric-cluster-fabric-settings.md) sobre o que e como você pode personalizá-los.</span><span class="sxs-lookup"><span data-stu-id="a71fa-230">Refer too[service fabric cluster fabric settings](service-fabric-cluster-fabric-settings.md) on what and how you can customize them.</span></span>

### <a name="os-patches-on-hello-vms-that-make-up-hello-cluster"></a><span data-ttu-id="a71fa-231">Patches do sistema operacional em Olá máquinas virtuais que compõem o cluster Olá</span><span class="sxs-lookup"><span data-stu-id="a71fa-231">OS patches on hello VMs that make up hello cluster</span></span>
<span data-ttu-id="a71fa-232">Consulte também[Patch orquestração de aplicativo](service-fabric-patch-orchestration-application.md) que pode ser implantado em seu patches tooinstall de cluster do Windows Update de uma maneira orquestrada, manter os serviços de saudação disponíveis todo o tempo de saudação.</span><span class="sxs-lookup"><span data-stu-id="a71fa-232">Refer too[Patch Orchestration Application](service-fabric-patch-orchestration-application.md) which can be deployed on your cluster tooinstall patches from Windows Update in an orchestrated manner, keeping hello services available all hello time.</span></span> 

### <a name="os-upgrades-on-hello-vms-that-make-up-hello-cluster"></a><span data-ttu-id="a71fa-233">Atualizações de sistema operacional em Olá máquinas virtuais que compõem o cluster Olá</span><span class="sxs-lookup"><span data-stu-id="a71fa-233">OS upgrades on hello VMs that make up hello cluster</span></span>
<span data-ttu-id="a71fa-234">Se você deve atualizar a imagem do sistema operacional Olá em máquinas virtuais de saudação do cluster hello, você deve fazê-lo uma VM por vez.</span><span class="sxs-lookup"><span data-stu-id="a71fa-234">If you must upgrade hello OS image on hello virtual machines of hello cluster, you must do it one VM at a time.</span></span> <span data-ttu-id="a71fa-235">Você é responsável por esta atualização. Atualmente não há nenhuma automação para isso.</span><span class="sxs-lookup"><span data-stu-id="a71fa-235">You are responsible for this upgrade--there is currently no automation for this.</span></span>

## <a name="next-steps"></a><span data-ttu-id="a71fa-236">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="a71fa-236">Next steps</span></span>
* <span data-ttu-id="a71fa-237">Saiba como toocustomize alguns Olá [configurações de malha de cluster de malha do serviço](service-fabric-cluster-fabric-settings.md)</span><span class="sxs-lookup"><span data-stu-id="a71fa-237">Learn how toocustomize some of hello [service fabric cluster fabric settings](service-fabric-cluster-fabric-settings.md)</span></span>
* <span data-ttu-id="a71fa-238">Saiba como muito[dimensionar o cluster e sair](service-fabric-cluster-scale-up-down.md)</span><span class="sxs-lookup"><span data-stu-id="a71fa-238">Learn how too[scale your cluster in and out](service-fabric-cluster-scale-up-down.md)</span></span>
* <span data-ttu-id="a71fa-239">Saiba mais sobre [atualizações de aplicativo](service-fabric-application-upgrade.md)</span><span class="sxs-lookup"><span data-stu-id="a71fa-239">Learn about [application upgrades](service-fabric-application-upgrade.md)</span></span>

<!--Image references-->
[CertificateUpgrade]: ./media/service-fabric-cluster-upgrade/CertificateUpgrade2.png
[AddingProbes]: ./media/service-fabric-cluster-upgrade/addingProbes2.PNG
[AddingLBRules]: ./media/service-fabric-cluster-upgrade/addingLBRules.png
[HealthPolices]: ./media/service-fabric-cluster-upgrade/Manage_AutomodeWadvSettings.PNG
[ARMUpgradeMode]: ./media/service-fabric-cluster-upgrade/ARMUpgradeMode.PNG
[Create_Manualmode]: ./media/service-fabric-cluster-upgrade/Create_Manualmode.PNG
[Manage_Automaticmode]: ./media/service-fabric-cluster-upgrade/Manage_Automaticmode.PNG
