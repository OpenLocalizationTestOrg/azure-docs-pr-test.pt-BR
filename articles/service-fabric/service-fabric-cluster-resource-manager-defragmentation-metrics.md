---
title: "aaaDefragmentation de métricas no Azure Service Fabric | Microsoft Docs"
description: "Uma visão geral do uso de desfragmentação ou como uma estratégia de métricas no Service Fabric"
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: e5ebfae5-c8f7-4d6c-9173-3e22a9730552
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: d09045a6cf196d2771f1a0794637f4579d3eb96b
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="defragmentation-of-metrics-and-load-in-service-fabric"></a><span data-ttu-id="a2ee4-103">Desfragmentação de métricas e carga no Service Fabric</span><span class="sxs-lookup"><span data-stu-id="a2ee4-103">Defragmentation of metrics and load in Service Fabric</span></span>
<span data-ttu-id="a2ee4-104">estratégia de padrão de saudação malha Cluster recursos do Service Manager para gerenciar as métricas de carga no cluster Olá tem a carga de saudação do toodistribute.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-104">hello Service Fabric Cluster Resource Manager's default strategy for managing load metrics in hello cluster is toodistribute hello load.</span></span> <span data-ttu-id="a2ee4-105">Garantindo que nós sejam utilizados uniformemente evita pontos altos e baixos que levam a contenção de tooboth e desperdício de recursos.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-105">Ensuring that nodes are evenly utilized avoids hot and cold spots that lead tooboth contention and wasted resources.</span></span> <span data-ttu-id="a2ee4-106">Distribuir cargas de trabalho no cluster Olá também é hello mais segura em termos de sobreviventes falhas porque garante que uma falha não tem um grande percentual de uma determinada carga de trabalho.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-106">Distributing workloads in hello cluster is also hello safest in terms of surviving failures since it ensures that a failure doesn’t take out a large percentage of a given workload.</span></span> 

<span data-ttu-id="a2ee4-107">Olá Gerenciador de recursos de Cluster do serviço de malha dá suporte a uma estratégia diferente para o gerenciamento de carga, que é a desfragmentação.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-107">hello Service Fabric Cluster Resource Manager does support a different strategy for managing load, which is defragmentation.</span></span> <span data-ttu-id="a2ee4-108">Desfragmentação significa que, em vez de tentar toodistribute utilização de saudação de uma métrica em cluster hello, ele é consolidado.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-108">Defragmentation means that instead of trying toodistribute hello utilization of a metric across hello cluster, it is consolidated.</span></span> <span data-ttu-id="a2ee4-109">A consolidação é apenas uma inversão do padrão de saudação balanceamento estratégia – em vez de minimizando Olá desvio médio de padrão de métrica de carga, Olá Gerenciador de recursos de Cluster tenta tooincrease-lo.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-109">Consolidation is just an inversion of hello default balancing strategy – instead of minimizing hello average standard deviation of metric load, hello Cluster Resource Manager tries tooincrease it.</span></span>

## <a name="when-toouse-defragmentation"></a><span data-ttu-id="a2ee4-110">Quando a desfragmentação toouse</span><span class="sxs-lookup"><span data-stu-id="a2ee4-110">When toouse defragmentation</span></span>
<span data-ttu-id="a2ee4-111">Distribuindo a carga no cluster Olá consome alguns dos recursos de saudação em cada nó.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-111">Distributing load in hello cluster consumes some of hello resources on each node.</span></span> <span data-ttu-id="a2ee4-112">Algumas cargas de trabalho criam serviços que são excepcionalmente grandes e consomem a maior parte de um nó.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-112">Some workloads create services that are exceptionally large and consume most or all of a node.</span></span> <span data-ttu-id="a2ee4-113">Nesses casos, é possível que quando houver grandes cargas de trabalho obtendo criadas que não há suficiente espaço em qualquer nó toorun-los.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-113">In these cases, it's possible that when there are large workloads getting created that there isn't enough space on any node toorun them.</span></span> <span data-ttu-id="a2ee4-114">Grandes cargas de trabalho não são um problema na malha do serviço; Olá esses casos Gerenciador de recursos de Cluster determina que ele precisa tooreorganize Olá cluster toomake espaço grande carga de trabalho.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-114">Large workloads aren't a problem in Service Fabric; in these cases hello Cluster Resource Manager determines that it needs tooreorganize hello cluster toomake room for this large workload.</span></span> <span data-ttu-id="a2ee4-115">No entanto, Olá enquanto isso carga de trabalho tem toobe toowait agendado no cluster hello.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-115">However, in hello meantime that workload has toowait toobe scheduled in hello cluster.</span></span>

<span data-ttu-id="a2ee4-116">Se houver muitos serviços e estado toomove ao redor, em seguida, pode levar muito tempo para Olá grande carga de trabalho toobe colocado em cluster hello.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-116">If there are many services and state toomove around, then it could take a long time for hello large workload toobe placed in hello cluster.</span></span> <span data-ttu-id="a2ee4-117">Isso é mais provável se outras cargas de trabalho no cluster Olá também são grandes e reserve tooreorganize mais.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-117">This is more likely if other workloads in hello cluster are also large and so take longer tooreorganize.</span></span> <span data-ttu-id="a2ee4-118">equipe do Service Fabric Olá medido tempo de criação no simulações deste cenário.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-118">hello Service Fabric team measured creation times in simulations of this scenario.</span></span> <span data-ttu-id="a2ee4-119">Descobrimos que a criação de serviços grandes passou a demorar muito mais assim que a utilização do cluster atingiu entre 30% e 50%.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-119">We found that creating large services took much longer as soon as cluster utilization got above between 30% and 50%.</span></span> <span data-ttu-id="a2ee4-120">toohandle neste cenário, apresentamos desfragmentação como uma estratégia de balanceamento.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-120">toohandle this scenario, we introduced defragmentation as a balancing strategy.</span></span> <span data-ttu-id="a2ee4-121">Descobrimos que para grandes cargas de trabalho, especialmente aqueles em que a hora de criação foi importante, desfragmentação realmente ajudou a essas novas cargas de trabalho seja agendadas em cluster hello.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-121">We found that for large workloads, especially ones where creation time was important, defragmentation really helped those new workloads get scheduled in hello cluster.</span></span>

<span data-ttu-id="a2ee4-122">Você pode configurar a desfragmentação métricas toohave Olá carga de saudação do tooproactively do Gerenciador de recursos de Cluster tente toocondense dos serviços de saudação em menos nós.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-122">You can configure defragmentation metrics toohave hello Cluster Resource Manager tooproactively try toocondense hello load of hello services into fewer nodes.</span></span> <span data-ttu-id="a2ee4-123">Isso ajuda a garantir que quase sempre há espaço para serviços grandes sem reorganizar cluster hello.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-123">This helps ensure that there is almost always room for large services without reorganizing hello cluster.</span></span> <span data-ttu-id="a2ee4-124">Não tem o cluster de saudação tooreorganize permite a criação de grandes cargas de trabalho rapidamente.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-124">Not having tooreorganize hello cluster allows creating large workloads quickly.</span></span>

<span data-ttu-id="a2ee4-125">A maioria das pessoas não precisa da desfragmentação.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-125">Most people don’t need defragmentation.</span></span> <span data-ttu-id="a2ee4-126">Os serviços são geralmente ser pequena, para que não seja espaço toofind disco rígido para eles no cluster de saudação.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-126">Services are usually be small, so it’s not hard toofind room for them in hello cluster.</span></span> <span data-ttu-id="a2ee4-127">Quando reorganização é possível, ela ocorre rapidamente, novamente porque a maioria dos serviços são pequenos e podem ser movidos rapidamente e em paralelo.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-127">When reorganization is possible, it goes quickly, again because most services are small and can be moved quickly and in parallel.</span></span> <span data-ttu-id="a2ee4-128">No entanto, se você tiver serviços grandes e necessário criado rapidamente Olá estratégia de desfragmentação é para você.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-128">However, if you have large services and need them created quickly then hello defragmentation strategy is for you.</span></span> <span data-ttu-id="a2ee4-129">Vamos discutir as compensações de saudação do uso de desfragmentação em seguida.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-129">We'll discuss hello tradeoffs of using defragmentation next.</span></span> 

## <a name="defragmentation-tradeoffs"></a><span data-ttu-id="a2ee4-130">Vantagens e desvantagens da desfragmentação</span><span class="sxs-lookup"><span data-stu-id="a2ee4-130">Defragmentation tradeoffs</span></span>
<span data-ttu-id="a2ee4-131">A desfragmentação pode aumentar o impacto das falhas, já que mais serviços estão em execução nos nós que falham.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-131">Defragmentation can increase impactfulness of failures, since more services are running on nodes that fail.</span></span> <span data-ttu-id="a2ee4-132">A desfragmentação também pode aumentar os custos, como recursos no cluster Olá devem ser mantidos em reserva, aguardando a criação de saudação de grandes cargas de trabalho.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-132">Defragmentation can also increase costs, since resources in hello cluster must be held in reserve, waiting for hello creation of large workloads.</span></span>

<span data-ttu-id="a2ee4-133">Olá diagrama a seguir fornece uma representação visual dos dois clusters, um que é desfragmentado e que não é.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-133">hello following diagram gives a visual representation of two clusters, one that is defragmented and one that is not.</span></span> 

<span data-ttu-id="a2ee4-134"><center>
![Comparando clusters balanceados e desfragmentados][Image1]
</center></span><span class="sxs-lookup"><span data-stu-id="a2ee4-134"><center>
![Comparing Balanced and Defragmented Clusters][Image1]
</center></span></span>

<span data-ttu-id="a2ee4-135">No caso de Olá balanceada, considere o número de Olá de movimentações que seria necessário tooplace uma saudação maior de objetos de serviço.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-135">In hello balanced case, consider hello number of movements that would be necessary tooplace one of hello largest service objects.</span></span> <span data-ttu-id="a2ee4-136">No cluster de desfragmentado hello, grande carga de trabalho de saudação pode ser colocada em nós quatro ou cinco sem ter que toowait para quaisquer outros serviços toomove.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-136">In hello defragmented cluster, hello large workload could be placed on nodes four or five without having toowait for any other services toomove.</span></span>

## <a name="defragmentation-pros-and-cons"></a><span data-ttu-id="a2ee4-137">Prós e contras da desfragmentação</span><span class="sxs-lookup"><span data-stu-id="a2ee4-137">Defragmentation pros and cons</span></span>
<span data-ttu-id="a2ee4-138">Quais são as outras compensações conceituais?</span><span class="sxs-lookup"><span data-stu-id="a2ee4-138">So what are those other conceptual tradeoffs?</span></span> <span data-ttu-id="a2ee4-139">Aqui está uma tabela rápida de coisas toothink sobre:</span><span class="sxs-lookup"><span data-stu-id="a2ee4-139">Here’s a quick table of things toothink about:</span></span>

| <span data-ttu-id="a2ee4-140">Vantagens da desfragmentação</span><span class="sxs-lookup"><span data-stu-id="a2ee4-140">Defragmentation Pros</span></span> | <span data-ttu-id="a2ee4-141">Desvantagens da desfragmentação</span><span class="sxs-lookup"><span data-stu-id="a2ee4-141">Defragmentation Cons</span></span> |
| --- | --- |
| <span data-ttu-id="a2ee4-142">Agiliza a criação de serviços grandes</span><span class="sxs-lookup"><span data-stu-id="a2ee4-142">Allows faster creation of large services</span></span> |<span data-ttu-id="a2ee4-143">Concentra a carga em menos nós, aumentando a contenção</span><span class="sxs-lookup"><span data-stu-id="a2ee4-143">Concentrates load onto fewer nodes, increasing contention</span></span> |
| <span data-ttu-id="a2ee4-144">Permite a redução da movimentação de dados durante a criação</span><span class="sxs-lookup"><span data-stu-id="a2ee4-144">Enables lower data movement during creation</span></span> |<span data-ttu-id="a2ee4-145">Falhas podem afetar mais serviços e causar mais variação</span><span class="sxs-lookup"><span data-stu-id="a2ee4-145">Failures can impact more services and cause more churn</span></span> |
| <span data-ttu-id="a2ee4-146">Permite a descrição detalhada dos requisitos e a recuperação de espaço</span><span class="sxs-lookup"><span data-stu-id="a2ee4-146">Allows rich description of requirements and reclamation of space</span></span> |<span data-ttu-id="a2ee4-147">Configuração geral mais complexa do Gerenciamento de Recursos</span><span class="sxs-lookup"><span data-stu-id="a2ee4-147">More complex overall Resource Management configuration</span></span> |

<span data-ttu-id="a2ee4-148">Você pode combinar desfragmentado e métricas normais no hello mesmo cluster.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-148">You can mix defragmented and normal metrics in hello same cluster.</span></span> <span data-ttu-id="a2ee4-149">Olá Gerenciador de recursos de Cluster tentativas tooconsolidate Olá desfragmentação métricas tanto quanto possível ao propagar Olá outras pessoas.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-149">hello Cluster Resource Manager tries tooconsolidate hello defragmentation metrics as much as possible while spreading out hello others.</span></span> <span data-ttu-id="a2ee4-150">resultados de saudação de uma combinação de desfragmentação e balanceamento estratégias depende de vários fatores, incluindo:</span><span class="sxs-lookup"><span data-stu-id="a2ee4-150">hello results of mixing defragmentation and balancing strategies depends on several factors, including:</span></span>
  - <span data-ttu-id="a2ee4-151">número de saudação do balanceamento de métricas versus o número de saudação de métricas de desfragmentação</span><span class="sxs-lookup"><span data-stu-id="a2ee4-151">hello number of balancing metrics vs. hello number of defragmentation metrics</span></span>
  - <span data-ttu-id="a2ee4-152">Se algum serviço usar os dois tipos de métricas</span><span class="sxs-lookup"><span data-stu-id="a2ee4-152">Whether any service uses both types of metrics</span></span> 
  - <span data-ttu-id="a2ee4-153">pesos de métrica Olá</span><span class="sxs-lookup"><span data-stu-id="a2ee4-153">hello metric weights</span></span>
  - <span data-ttu-id="a2ee4-154">as cargas da métrica atual</span><span class="sxs-lookup"><span data-stu-id="a2ee4-154">current metric loads</span></span>
  
<span data-ttu-id="a2ee4-155">Experimentação é necessário toodetermine Olá exata configuração necessária.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-155">Experimentation is required toodetermine hello exact configuration necessary.</span></span> <span data-ttu-id="a2ee4-156">Recomendamos fazer uma medição completa de suas cargas de trabalho antes de habilitar as métricas de desfragmentação na produção.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-156">We recommend thorough measurement of your workloads before you enable defragmentation metrics in production.</span></span> <span data-ttu-id="a2ee4-157">Isso é especialmente verdadeiro quando a combinação de desfragmentação e métricas equilibradas em Olá mesmo serviço.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-157">This is especially true when mixing defragmentation and balanced metrics within hello same service.</span></span> 

## <a name="configuring-defragmentation-metrics"></a><span data-ttu-id="a2ee4-158">Configurando métricas de desfragmentação</span><span class="sxs-lookup"><span data-stu-id="a2ee4-158">Configuring defragmentation metrics</span></span>
<span data-ttu-id="a2ee4-159">Configurar métricas de desfragmentação é uma decisão global no cluster hello e métricas individuais podem ser selecionadas para desfragmentação.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-159">Configuring defragmentation metrics is a global decision in hello cluster, and individual metrics can be selected for defragmentation.</span></span> <span data-ttu-id="a2ee4-160">Olá config trechos de código a seguir mostra como tooconfigure métricas para desfragmentação.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-160">hello following config snippets show how tooconfigure metrics for defragmentation.</span></span> <span data-ttu-id="a2ee4-161">Nesse caso, "Metric1" é configurado como uma métrica de desfragmentação, enquanto "Metric2" continuará toobe balanceada normalmente.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-161">In this case, "Metric1" is configured as a defragmentation metric, while "Metric2" will continue toobe balanced normally.</span></span> 

<span data-ttu-id="a2ee4-162">ClusterManifest.xml:</span><span class="sxs-lookup"><span data-stu-id="a2ee4-162">ClusterManifest.xml:</span></span>

```xml
<Section Name="DefragmentationMetrics">
    <Parameter Name="Metric1" Value="true" />
    <Parameter Name="Metric2" Value="false" />
</Section>
```

<span data-ttu-id="a2ee4-163">via ClusterConfig.json para implantações autônomas ou Template.json para clusters hospedados pelo Azure:</span><span class="sxs-lookup"><span data-stu-id="a2ee4-163">via ClusterConfig.json for Standalone deployments or Template.json for Azure hosted clusters:</span></span>

```json
"fabricSettings": [
  {
    "name": "DefragmentationMetrics",
    "parameters": [
      {
          "name": "Metric1",
          "value": "true"
      },
      {
          "name": "Metric2",
          "value": "false"
      }
    ]
  }
]
```


## <a name="next-steps"></a><span data-ttu-id="a2ee4-164">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="a2ee4-164">Next steps</span></span>
- <span data-ttu-id="a2ee4-165">Olá Gerenciador de recursos de Cluster tem opções de man para descrever o cluster hello.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-165">hello Cluster Resource Manager has man options for describing hello cluster.</span></span> <span data-ttu-id="a2ee4-166">toofind mais sobre eles, leia este artigo em [que descreve um cluster do Service Fabric](service-fabric-cluster-resource-manager-cluster-description.md)</span><span class="sxs-lookup"><span data-stu-id="a2ee4-166">toofind out more about them, check out this article on [describing a Service Fabric cluster](service-fabric-cluster-resource-manager-cluster-description.md)</span></span>
- <span data-ttu-id="a2ee4-167">Métricas são como Olá Gerenciador de recursos de Cluster do serviço de malha gerencia capacidade em cluster hello e consumo.</span><span class="sxs-lookup"><span data-stu-id="a2ee4-167">Metrics are how hello Service Fabric Cluster Resource Manger manages consumption and capacity in hello cluster.</span></span> <span data-ttu-id="a2ee4-168">toolearn mais sobre as métricas e como tooconfigure-los, confira [neste artigo](service-fabric-cluster-resource-manager-metrics.md)</span><span class="sxs-lookup"><span data-stu-id="a2ee4-168">toolearn more about metrics and how tooconfigure them, check out [this article](service-fabric-cluster-resource-manager-metrics.md)</span></span>

[Image1]:./media/service-fabric-cluster-resource-manager-defragmentation-metrics/balancing-defrag-compared.png
