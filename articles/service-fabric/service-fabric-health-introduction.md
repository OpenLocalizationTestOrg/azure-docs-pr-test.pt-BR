---
title: Monitoramento de integridade do Service Fabric | Microsoft Docs
description: "Uma introdução ao modelo de Monitoramento de integridade do Service Fabric do Azure, que fornece monitoramento do cluster e seus aplicativos e serviços."
services: service-fabric
documentationcenter: .net
author: oanapl
manager: timlt
editor: 
ms.assetid: 1d979210-b1eb-4022-be24-799fd9d8e003
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/19/2017
ms.author: oanapl
ms.openlocfilehash: 598a4d35faebb592f840b1bec7e77c7a091ea2de
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/18/2017
---
# <a name="introduction-to-service-fabric-health-monitoring"></a><span data-ttu-id="c9097-103">Introdução ao monitoramento da integridade do Service Fabric</span><span class="sxs-lookup"><span data-stu-id="c9097-103">Introduction to Service Fabric health monitoring</span></span>
<span data-ttu-id="c9097-104">O Service Fabric do Azure introduz um modelo de integridade que fornece avaliação e relatório de integridade avançados, flexíveis e extensíveis.</span><span class="sxs-lookup"><span data-stu-id="c9097-104">Azure Service Fabric introduces a health model that provides rich, flexible, and extensible health evaluation and reporting.</span></span> <span data-ttu-id="c9097-105">O modelo permite o monitoramento do estado quase em tempo real do cluster e dos serviços que são executados nele.</span><span class="sxs-lookup"><span data-stu-id="c9097-105">The model allows near-real-time monitoring of the state of the cluster and the services running in it.</span></span> <span data-ttu-id="c9097-106">Você pode obter as informações sobre integridade facilmente e corrigir possíveis problemas antes que eles se espalhem e causem interrupções massivas.</span><span class="sxs-lookup"><span data-stu-id="c9097-106">You can easily obtain health information and correct potential issues before they cascade and cause massive outages.</span></span> <span data-ttu-id="c9097-107">No modelo comum, os serviços enviam relatórios com base na respectiva exibição local e as informações são agregadas para fornecer uma exibição geral no nível de cluster.</span><span class="sxs-lookup"><span data-stu-id="c9097-107">In the typical model, services send reports based on their local views, and that information is aggregated to provide an overall cluster-level view.</span></span>

<span data-ttu-id="c9097-108">Os componentes do Service Fabric usam esse modelo de integridade avançado para reportar o respectivo estado atual.</span><span class="sxs-lookup"><span data-stu-id="c9097-108">Service Fabric components use this rich health model to report their current state.</span></span> <span data-ttu-id="c9097-109">É possível usar o mesmo mecanismo para reportar a integridade de seus aplicativos.</span><span class="sxs-lookup"><span data-stu-id="c9097-109">You can use the same mechanism to report health from your applications.</span></span> <span data-ttu-id="c9097-110">Se investir em relatórios de integridade de alta qualidade que capturam suas condições personalizadas, você poderá detectar e corrigir problemas do seu aplicativo em execução com muito mais facilidade.</span><span class="sxs-lookup"><span data-stu-id="c9097-110">If you invest in high-quality health reporting that captures your custom conditions, you can detect and fix issues for your running application much more easily.</span></span>

<span data-ttu-id="c9097-111">O vídeo do Microsoft Virtual Academy a seguir também descreve o modelo de integridade do Service Fabric e seu uso: <center><a target="_blank" href="https://mva.microsoft.com/training-courses/building-microservices-applications-on-azure-service-fabric-16747?l=tevZw56yC_1906218965">
<img src="./media/service-fabric-health-introduction/HealthIntroVid.png" WIDTH="360" HEIGHT="244">
</a></center></span><span class="sxs-lookup"><span data-stu-id="c9097-111">The following Microsoft Virtual Academy video also describes the Service Fabric health model and how it's used: <center><a target="_blank" href="https://mva.microsoft.com/training-courses/building-microservices-applications-on-azure-service-fabric-16747?l=tevZw56yC_1906218965">
<img src="./media/service-fabric-health-introduction/HealthIntroVid.png" WIDTH="360" HEIGHT="244">
</a></center></span></span>

> [!NOTE]
> <span data-ttu-id="c9097-112">Iniciamos o subsistema de integridade para atender à necessidade de atualizações monitoradas.</span><span class="sxs-lookup"><span data-stu-id="c9097-112">We started the health subsystem to address a need for monitored upgrades.</span></span> <span data-ttu-id="c9097-113">O Service Fabric fornece aplicativos monitorados e atualizações de cluster que garantem a disponibilidade completa, sem tempo de inatividade e mínima ou nenhuma intervenção do usuário.</span><span class="sxs-lookup"><span data-stu-id="c9097-113">Service Fabric provides monitored application and cluster upgrades that ensure full availability, no downtime and minimal to no user intervention.</span></span> <span data-ttu-id="c9097-114">Para atingir essas metas, a atualização verifica a integridade com base nas políticas de atualização configuradas.</span><span class="sxs-lookup"><span data-stu-id="c9097-114">To achieve these goals, the upgrade checks health based on configured upgrade policies.</span></span> <span data-ttu-id="c9097-115">Uma atualização pode continuar somente quando a integridade respeita os limites desejados.</span><span class="sxs-lookup"><span data-stu-id="c9097-115">An upgrade can proceed only when health respects desired thresholds.</span></span> <span data-ttu-id="c9097-116">Caso contrário, a atualização é automaticamente revertida ou pausada para dar aos administradores a oportunidade de corrigir os problemas.</span><span class="sxs-lookup"><span data-stu-id="c9097-116">Otherwise, the upgrade is either automatically rolled back or paused to give administrators a chance to fix the issues.</span></span> <span data-ttu-id="c9097-117">Para saber mais sobre atualizações de aplicativo, consulte [este artigo](service-fabric-application-upgrade.md).</span><span class="sxs-lookup"><span data-stu-id="c9097-117">To learn more about application upgrades, see [this article](service-fabric-application-upgrade.md).</span></span>
> 
> 

## <a name="health-store"></a><span data-ttu-id="c9097-118">Repositório de Integridade</span><span class="sxs-lookup"><span data-stu-id="c9097-118">Health store</span></span>
<span data-ttu-id="c9097-119">O Repositório de Integridade mantém informações relacionadas à integridade sobre entidades no cluster para facilidade de recuperação e avaliação.</span><span class="sxs-lookup"><span data-stu-id="c9097-119">The health store keeps health-related information about entities in the cluster for easy retrieval and evaluation.</span></span> <span data-ttu-id="c9097-120">Ele é implementado como um serviço com estado persistente da Malha do Serviço, garantindo alta disponibilidade e escalabilidade.</span><span class="sxs-lookup"><span data-stu-id="c9097-120">It is implemented as a Service Fabric persisted stateful service to ensure high availability and scalability.</span></span> <span data-ttu-id="c9097-121">O Repositório de Integridade faz parte do aplicativo **fabric:/System** e é disponibilizado quando o cluster é ativado e está em execução.</span><span class="sxs-lookup"><span data-stu-id="c9097-121">The health store is part of the **fabric:/System** application, and it is available when the cluster is up and running.</span></span>

## <a name="health-entities-and-hierarchy"></a><span data-ttu-id="c9097-122">Hierarquia e entidades de integridade</span><span class="sxs-lookup"><span data-stu-id="c9097-122">Health entities and hierarchy</span></span>
<span data-ttu-id="c9097-123">As entidades de integridade são organizadas em uma hierarquia lógica que captura as interações e dependências entre diferentes entidades.</span><span class="sxs-lookup"><span data-stu-id="c9097-123">The health entities are organized in a logical hierarchy that captures interactions and dependencies among different entities.</span></span> <span data-ttu-id="c9097-124">O repositório de integridade cria automaticamente entidades e hierarquia com base nos relatórios recebidos dos componentes do Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="c9097-124">The health store automatically builds health entities and hierarchy based on reports received from Service Fabric components.</span></span>

<span data-ttu-id="c9097-125">As entidades de integridade espelham as entidades do Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="c9097-125">The health entities mirror the Service Fabric entities.</span></span> <span data-ttu-id="c9097-126">(Por exemplo, a **entidade de aplicativo de integridade** corresponde a uma instância do aplicativo implantada no cluster, enquanto a **entidade de nó de integridade** corresponde a um nó de cluster do Service Fabric). A hierarquia de integridade captura as interações das entidades do sistema e é a base para a avaliação avançada de integridade.</span><span class="sxs-lookup"><span data-stu-id="c9097-126">(For example, **health application entity** matches an application instance deployed in the cluster, while **health node entity** matches a Service Fabric cluster node.) The health hierarchy captures the interactions of the system entities, and it is the basis for advanced health evaluation.</span></span> <span data-ttu-id="c9097-127">Você pode aprender sobre os principais conceitos do Service Fabric em [Visão geral técnica do Service Fabric](service-fabric-technical-overview.md).</span><span class="sxs-lookup"><span data-stu-id="c9097-127">You can learn about key Service Fabric concepts in [Service Fabric technical overview](service-fabric-technical-overview.md).</span></span> <span data-ttu-id="c9097-128">Para saber mais sobre aplicativos, confira [Modelo de aplicativo do Service Fabric](service-fabric-application-model.md).</span><span class="sxs-lookup"><span data-stu-id="c9097-128">For more on application, see [Service Fabric application model](service-fabric-application-model.md).</span></span>

<span data-ttu-id="c9097-129">As entidades de integridade e a hierarquia proporcionam relatório, depuração e monitoramento efetivos do cluster e dos aplicativos.</span><span class="sxs-lookup"><span data-stu-id="c9097-129">The health entities and hierarchy allow the cluster and applications to be effectively reported, debugged, and monitored.</span></span> <span data-ttu-id="c9097-130">O modelo de integridade oferece uma representação precisa e *granular* da integridade das muitas partes móveis do cluster.</span><span class="sxs-lookup"><span data-stu-id="c9097-130">The health model provides an accurate, *granular* representation of the health of the many moving pieces in the cluster.</span></span>

<span data-ttu-id="c9097-131">![Entidades de integridade.][1]</span><span class="sxs-lookup"><span data-stu-id="c9097-131">![Health entities.][1]</span></span>
<span data-ttu-id="c9097-132">As entidades de integridade, organizadas em uma hierarquia com base nas relações de pai/filho.</span><span class="sxs-lookup"><span data-stu-id="c9097-132">The health entities, organized in a hierarchy based on parent-child relationships.</span></span>

[1]: ./media/service-fabric-health-introduction/servicefabric-health-hierarchy.png

<span data-ttu-id="c9097-133">As entidades de integridade são:</span><span class="sxs-lookup"><span data-stu-id="c9097-133">The health entities are:</span></span>

* <span data-ttu-id="c9097-134">**Cluster**.</span><span class="sxs-lookup"><span data-stu-id="c9097-134">**Cluster**.</span></span> <span data-ttu-id="c9097-135">Representa a integridade de um cluster da Malha do Serviço.</span><span class="sxs-lookup"><span data-stu-id="c9097-135">Represents the health of a Service Fabric cluster.</span></span> <span data-ttu-id="c9097-136">Os relatórios de integridade do cluster descrevem condições que afetam todo o cluster.</span><span class="sxs-lookup"><span data-stu-id="c9097-136">Cluster health reports describe conditions that affect the entire cluster.</span></span> <span data-ttu-id="c9097-137">Essas condições afetam várias entidades no cluster ou o próprio cluster.</span><span class="sxs-lookup"><span data-stu-id="c9097-137">These conditions affect multiple entities in the cluster or the cluster itself.</span></span> <span data-ttu-id="c9097-138">Com base na condição, o gerador de relatórios não consegue restringir o problema para um ou mais filhos não íntegros.</span><span class="sxs-lookup"><span data-stu-id="c9097-138">Based on the condition, the reporter can't narrow the issue down to one or more unhealthy children.</span></span> <span data-ttu-id="c9097-139">O exemplo inclui a personalidade do cluster sendo dividida devido ao particionamento da rede ou problemas de comunicação.</span><span class="sxs-lookup"><span data-stu-id="c9097-139">Examples include the brain of the cluster splitting due to network partitioning or communication issues.</span></span>
* <span data-ttu-id="c9097-140">**Nó**.</span><span class="sxs-lookup"><span data-stu-id="c9097-140">**Node**.</span></span> <span data-ttu-id="c9097-141">Representa a integridade de um nó da Malha do Serviço.</span><span class="sxs-lookup"><span data-stu-id="c9097-141">Represents the health of a Service Fabric node.</span></span> <span data-ttu-id="c9097-142">Os relatórios de integridade do nó descrevem condições que afetam toda a funcionalidade do nó.</span><span class="sxs-lookup"><span data-stu-id="c9097-142">Node health reports describe conditions that affect the node functionality.</span></span> <span data-ttu-id="c9097-143">Normalmente, elas afetam todas as entidades implantadas em execução.</span><span class="sxs-lookup"><span data-stu-id="c9097-143">They typically affect all the deployed entities running on it.</span></span> <span data-ttu-id="c9097-144">Os exemplos incluem um nó sem espaço em disco (ou outras propriedades em todo o computador, como memória, conexões) ou quando o nó está desativado.</span><span class="sxs-lookup"><span data-stu-id="c9097-144">Examples include node out of disk space (or other machine-wide properties, such as memory, connections) and when a node is down.</span></span> <span data-ttu-id="c9097-145">A entidade de nó é identificada pelo nome do nó (cadeia de caracteres).</span><span class="sxs-lookup"><span data-stu-id="c9097-145">The node entity is identified by the node name (string).</span></span>
* <span data-ttu-id="c9097-146">**Aplicativo**.</span><span class="sxs-lookup"><span data-stu-id="c9097-146">**Application**.</span></span> <span data-ttu-id="c9097-147">Representa a integridade de uma instância do aplicativo em execução no cluster.</span><span class="sxs-lookup"><span data-stu-id="c9097-147">Represents the health of an application instance running in the cluster.</span></span> <span data-ttu-id="c9097-148">Os relatórios de integridade do aplicativo descrevem condições que afetam a integridade geral do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c9097-148">Application health reports describe conditions that affect the overall health of the application.</span></span> <span data-ttu-id="c9097-149">Elas não podem ser limitadas a filhos individuais (serviços ou aplicativos implantados).</span><span class="sxs-lookup"><span data-stu-id="c9097-149">They can't be narrowed down to individual children (services or deployed applications).</span></span> <span data-ttu-id="c9097-150">Os exemplos incluem a interação de ponta a ponta entre diferentes serviços no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c9097-150">Examples include the end-to-end interaction among different services in the application.</span></span> <span data-ttu-id="c9097-151">A entidade de aplicativo é identificada pelo nome do aplicativo (URI).</span><span class="sxs-lookup"><span data-stu-id="c9097-151">The application entity is identified by the application name (URI).</span></span>
* <span data-ttu-id="c9097-152">**Serviço**.</span><span class="sxs-lookup"><span data-stu-id="c9097-152">**Service**.</span></span> <span data-ttu-id="c9097-153">Representa a integridade de um serviço em execução no cluster.</span><span class="sxs-lookup"><span data-stu-id="c9097-153">Represents the health of a service running in the cluster.</span></span> <span data-ttu-id="c9097-154">Os relatórios de integridade do serviço descrevem condições que afetam a integridade geral do serviço.</span><span class="sxs-lookup"><span data-stu-id="c9097-154">Service health reports describe conditions that affect the overall health of the service.</span></span> <span data-ttu-id="c9097-155">O gerador de relatórios não consegue restringir o problema para uma partição ou réplica não íntegras.</span><span class="sxs-lookup"><span data-stu-id="c9097-155">The reporter can't narrow down the issue to an unhealthy partition or replica.</span></span> <span data-ttu-id="c9097-156">Os exemplos incluem uma configuração de serviço (como compartilhamento de arquivos externos ou porta) que está causando problemas em todas as partições.</span><span class="sxs-lookup"><span data-stu-id="c9097-156">Examples include a service configuration (such as port or external file share) that is causing issues for all partitions.</span></span> <span data-ttu-id="c9097-157">A entidade de serviço é identificada pelo nome do serviço (URI).</span><span class="sxs-lookup"><span data-stu-id="c9097-157">The service entity is identified by the service name (URI).</span></span>
* <span data-ttu-id="c9097-158">**Partição**.</span><span class="sxs-lookup"><span data-stu-id="c9097-158">**Partition**.</span></span> <span data-ttu-id="c9097-159">Representa a integridade de uma partição de serviço.</span><span class="sxs-lookup"><span data-stu-id="c9097-159">Represents the health of a service partition.</span></span> <span data-ttu-id="c9097-160">Os relatórios de integridade da partição descrevem condições que afetam todo o conjunto de réplicas.</span><span class="sxs-lookup"><span data-stu-id="c9097-160">Partition health reports describe conditions that affect the entire replica set.</span></span> <span data-ttu-id="c9097-161">Os exemplos incluem quando o número de réplicas está abaixo da contagem de destino e quando a partição está na perda do quórum.</span><span class="sxs-lookup"><span data-stu-id="c9097-161">Examples include when the number of replicas is below target count and when a partition is in quorum loss.</span></span> <span data-ttu-id="c9097-162">A entidade de partição é identificada pela ID da partição (GUID).</span><span class="sxs-lookup"><span data-stu-id="c9097-162">The partition entity is identified by the partition ID (GUID).</span></span>
* <span data-ttu-id="c9097-163">**Réplica**.</span><span class="sxs-lookup"><span data-stu-id="c9097-163">**Replica**.</span></span> <span data-ttu-id="c9097-164">Representa a integridade de uma réplica de serviço com estado ou uma instância de serviço sem estado.</span><span class="sxs-lookup"><span data-stu-id="c9097-164">Represents the health of a stateful service replica or a stateless service instance.</span></span> <span data-ttu-id="c9097-165">A réplica é menor unidade que os watchdogs e os componentes do sistema podem reportar para um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c9097-165">The replica is the smallest unit that watchdogs and system components can report on for an application.</span></span> <span data-ttu-id="c9097-166">Para serviços com estado, os exemplos incluem uma réplica primária que não consegue replicar operações em locais secundários e replicação lenta.</span><span class="sxs-lookup"><span data-stu-id="c9097-166">For stateful services, examples include a primary replica that can't replicate operations to secondaries and slow replication.</span></span> <span data-ttu-id="c9097-167">Além disso, uma instância sem estado pode relatar quando estiver em execução sem recursos ou tiver problemas de conectividade.</span><span class="sxs-lookup"><span data-stu-id="c9097-167">Also, a stateless instance can report when it is running out of resources or has connectivity issues.</span></span> <span data-ttu-id="c9097-168">A entidade de réplica é identificada pela ID da partição (GUID) e pela ID de réplica ou instância (longo).</span><span class="sxs-lookup"><span data-stu-id="c9097-168">The replica entity is identified by the partition ID (GUID) and the replica or instance ID (long).</span></span>
* <span data-ttu-id="c9097-169">**DeployedApplication**.</span><span class="sxs-lookup"><span data-stu-id="c9097-169">**DeployedApplication**.</span></span> <span data-ttu-id="c9097-170">Representa a integridade de um *aplicativo que é executado em um nó*.</span><span class="sxs-lookup"><span data-stu-id="c9097-170">Represents the health of an *application running on a node*.</span></span> <span data-ttu-id="c9097-171">Os relatórios de integridade do aplicativo implantado descrevem condições específicas ao aplicativo no nó que não podem ser limitados aos pacotes de serviço implantados no mesmo nó.</span><span class="sxs-lookup"><span data-stu-id="c9097-171">Deployed application health reports describe conditions specific to the application on the node that can't be narrowed down to service packages deployed on the same node.</span></span> <span data-ttu-id="c9097-172">Os exemplos incluem erros quando o pacote de aplicativos não pode ser baixado nesse nó e problemas na configuração das entidades de segurança do aplicativo no nó.</span><span class="sxs-lookup"><span data-stu-id="c9097-172">Examples include errors when application package can't be downloaded on that node and issues setting up application security principals on the node.</span></span> <span data-ttu-id="c9097-173">O aplicativo implantado é identificado pelo nome do aplicativo (URI) e pelo nome do nó (cadeia de caracteres).</span><span class="sxs-lookup"><span data-stu-id="c9097-173">The deployed application is identified by application name (URI) and node name (string).</span></span>
* <span data-ttu-id="c9097-174">**DeployedServicePackage**.</span><span class="sxs-lookup"><span data-stu-id="c9097-174">**DeployedServicePackage**.</span></span> <span data-ttu-id="c9097-175">Representa a integridade de um pacote de serviço em execução em um nó no cluster.</span><span class="sxs-lookup"><span data-stu-id="c9097-175">Represents the health of a service package running on a node in the cluster.</span></span> <span data-ttu-id="c9097-176">Descreve as condições específicas a um pacote de serviço que não afetam os outros pacotes de serviço no mesmo nó para o mesmo aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c9097-176">It describes conditions specific to a service package that do not affect the other service packages on the same node for the same application.</span></span> <span data-ttu-id="c9097-177">Os exemplos incluem um pacote de códigos no pacote de serviço que não pode ser iniciado e um pacote de configuração que não pode ser lido.</span><span class="sxs-lookup"><span data-stu-id="c9097-177">Examples include a code package in the service package that cannot be started and a configuration package that cannot be read.</span></span> <span data-ttu-id="c9097-178">O pacote de serviço implantado é identificado pelo nome do aplicativo (URI), o nome do nó (cadeia de caracteres), o nome do manifesto do serviço (cadeia de caracteres) e a ID de ativação do pacote de serviço (cadeia de caracteres).</span><span class="sxs-lookup"><span data-stu-id="c9097-178">The deployed service package is identified by application name (URI), node name (string), service manifest name (string), and service package activation ID (string).</span></span>

<span data-ttu-id="c9097-179">A granularidade do modelo de integridade facilita a detecção e correção dos problemas.</span><span class="sxs-lookup"><span data-stu-id="c9097-179">The granularity of the health model makes it easy to detect and correct issues.</span></span> <span data-ttu-id="c9097-180">Por exemplo, se um serviço não estiver respondendo, é possível relatar que a instância do aplicativo não está íntegra.</span><span class="sxs-lookup"><span data-stu-id="c9097-180">For example, if a service is not responding, it is feasible to report that the application instance is unhealthy.</span></span> <span data-ttu-id="c9097-181">No entanto, a emissão de relatórios neste nível não é ideal porque o problema talvez não esteja afetando todos os serviços no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c9097-181">Reporting at that level is not ideal, however, because the issue might not be affecting all the services within that application.</span></span> <span data-ttu-id="c9097-182">O relatório deve ser aplicado no serviço não íntegro ou partição filha específica, se mais informações apontarem para essa partição.</span><span class="sxs-lookup"><span data-stu-id="c9097-182">The report should be applied to the unhealthy service or to a specific child partition, if more information points to that partition.</span></span> <span data-ttu-id="c9097-183">Os dados emergem automaticamente pela hierarquia e uma partição não íntegra fica visível nos níveis de serviço e aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c9097-183">The data automatically surfaces through the hierarchy, and an unhealthy partition is made visible at service and application levels.</span></span> <span data-ttu-id="c9097-184">Essa agregação ajuda a identificar e resolver a causa raiz do problema mais rapidamente.</span><span class="sxs-lookup"><span data-stu-id="c9097-184">This aggregation helps to pinpoint and resolve the root cause of the issue more quickly.</span></span>

<span data-ttu-id="c9097-185">A hierarquia de integridade é composta por relações de pai/filho.</span><span class="sxs-lookup"><span data-stu-id="c9097-185">The health hierarchy is composed of parent-child relationships.</span></span> <span data-ttu-id="c9097-186">Um cluster é composto de nós e aplicativos.</span><span class="sxs-lookup"><span data-stu-id="c9097-186">A cluster is composed of nodes and applications.</span></span> <span data-ttu-id="c9097-187">Os aplicativos possuem serviços e aplicativos implantados.</span><span class="sxs-lookup"><span data-stu-id="c9097-187">Applications have services and deployed applications.</span></span> <span data-ttu-id="c9097-188">Os aplicativos implantados possuem pacotes de serviço implantados.</span><span class="sxs-lookup"><span data-stu-id="c9097-188">Deployed applications have deployed service packages.</span></span> <span data-ttu-id="c9097-189">Os serviços têm partições, e cada partição tem uma ou mais réplicas.</span><span class="sxs-lookup"><span data-stu-id="c9097-189">Services have partitions, and each partition has one or more replicas.</span></span> <span data-ttu-id="c9097-190">Há uma relação especial entre nós e entidades implantadas.</span><span class="sxs-lookup"><span data-stu-id="c9097-190">There is a special relationship between nodes and deployed entities.</span></span> <span data-ttu-id="c9097-191">Um nó não íntegro conforme reportado por seu componente de sistema de autoridade, o Serviço do Gerenciador de Failover, afeta os aplicativos implantados, os pacotes de serviço e as réplicas implantadas nele.</span><span class="sxs-lookup"><span data-stu-id="c9097-191">An unhealthy node as reported by its authority system component, the Failover Manager service, affects the deployed applications, service packages, and replicas deployed on it.</span></span>

<span data-ttu-id="c9097-192">A hierarquia de integridade representa o estado mais recente do sistema com base em relatórios de integridade mais recentes, que é uma informação quase em tempo real.</span><span class="sxs-lookup"><span data-stu-id="c9097-192">The health hierarchy represents the latest state of the system based on the latest health reports, which is almost real-time information.</span></span>
<span data-ttu-id="c9097-193">Os watchdogs internos e externos podem reportar as mesmas entidades com base na lógica específica do aplicativo ou nas condições monitoradas personalizadas.</span><span class="sxs-lookup"><span data-stu-id="c9097-193">Internal and external watchdogs can report on the same entities based on application-specific logic or custom monitored conditions.</span></span> <span data-ttu-id="c9097-194">Os relatórios do usuário coexistem com os relatórios do sistema.</span><span class="sxs-lookup"><span data-stu-id="c9097-194">User reports coexist with the system reports.</span></span>

<span data-ttu-id="c9097-195">Planeje para investir em como relatar e responder à integridade durante o criação de um serviço de nuvem grande.</span><span class="sxs-lookup"><span data-stu-id="c9097-195">Plan to invest in how to report and respond to health during the design of a large cloud service.</span></span> <span data-ttu-id="c9097-196">Este investimento inicial facilita a depuração, monitoramento e operação do serviço.</span><span class="sxs-lookup"><span data-stu-id="c9097-196">This up-front investement makes the service easier to debug, monitor, and operate.</span></span>

## <a name="health-states"></a><span data-ttu-id="c9097-197">Estados de integridade</span><span class="sxs-lookup"><span data-stu-id="c9097-197">Health states</span></span>
<span data-ttu-id="c9097-198">O Service Fabric usa três estados de integridade para descrever se uma entidade está íntegra ou não: OK, Aviso e Erro.</span><span class="sxs-lookup"><span data-stu-id="c9097-198">Service Fabric uses three health states to describe whether an entity is healthy or not: OK, warning, and error.</span></span> <span data-ttu-id="c9097-199">Qualquer relatório enviado ao Repositório de Integridade deve especificar um desses estados.</span><span class="sxs-lookup"><span data-stu-id="c9097-199">Any report sent to the health store must specify one of these states.</span></span> <span data-ttu-id="c9097-200">O resultado da avaliação de integridade é um desses estados.</span><span class="sxs-lookup"><span data-stu-id="c9097-200">The health evaluation result is one of these states.</span></span>

<span data-ttu-id="c9097-201">Os [estados de integridade](https://docs.microsoft.com/dotnet/api/system.fabric.health.healthstate) possíveis são:</span><span class="sxs-lookup"><span data-stu-id="c9097-201">The possible [health states](https://docs.microsoft.com/dotnet/api/system.fabric.health.healthstate) are:</span></span>

* <span data-ttu-id="c9097-202">**OK**.</span><span class="sxs-lookup"><span data-stu-id="c9097-202">**OK**.</span></span> <span data-ttu-id="c9097-203">A entidade está íntegra.</span><span class="sxs-lookup"><span data-stu-id="c9097-203">The entity is healthy.</span></span> <span data-ttu-id="c9097-204">Não há nenhum problema conhecido reportado em seus filhos (quando aplicável).</span><span class="sxs-lookup"><span data-stu-id="c9097-204">There are no known issues reported on it or its children (when applicable).</span></span>
* <span data-ttu-id="c9097-205">**Aviso**.</span><span class="sxs-lookup"><span data-stu-id="c9097-205">**Warning**.</span></span> <span data-ttu-id="c9097-206">A entidade tem alguns problemas, mas ainda funciona corretamente.</span><span class="sxs-lookup"><span data-stu-id="c9097-206">The entity has some issues, but it can still function correctly.</span></span> <span data-ttu-id="c9097-207">Por exemplo, há atrasos, mas eles ainda não causam problemas funcionais.</span><span class="sxs-lookup"><span data-stu-id="c9097-207">For example, there are delays, but they do not cause any functional issues yet.</span></span> <span data-ttu-id="c9097-208">Em alguns casos, a condição de aviso pode corrigir-se sozinha sem intervenção externa.</span><span class="sxs-lookup"><span data-stu-id="c9097-208">In some cases, the warning condition may fix itself without external intervention.</span></span> <span data-ttu-id="c9097-209">Nesses casos, os relatórios de integridade aumentam o reconhecimento e fornecem visibilidade sobre o que está acontecendo.</span><span class="sxs-lookup"><span data-stu-id="c9097-209">In these cases, health reports raise awareness and provide visibility into what is going on.</span></span> <span data-ttu-id="c9097-210">Em outros casos, a condição de Aviso pode se transformar em um problema grave sem intervenção do usuário.</span><span class="sxs-lookup"><span data-stu-id="c9097-210">In other cases, the warning condition may degrade into a severe problem without user intervention.</span></span>
* <span data-ttu-id="c9097-211">**Erro**.</span><span class="sxs-lookup"><span data-stu-id="c9097-211">**Error**.</span></span> <span data-ttu-id="c9097-212">A entidade não está íntegra.</span><span class="sxs-lookup"><span data-stu-id="c9097-212">The entity is unhealthy.</span></span> <span data-ttu-id="c9097-213">Uma medida deve ser tomada para corrigir o estado da entidade, pois ela não funciona corretamente.</span><span class="sxs-lookup"><span data-stu-id="c9097-213">Action should be taken to fix the state of the entity, because it can't function properly.</span></span>
* <span data-ttu-id="c9097-214">**Desconhecido**.</span><span class="sxs-lookup"><span data-stu-id="c9097-214">**Unknown**.</span></span> <span data-ttu-id="c9097-215">A entidade não existe no repositório de integridade.</span><span class="sxs-lookup"><span data-stu-id="c9097-215">The entity doesn't exist in the health store.</span></span> <span data-ttu-id="c9097-216">Esse resultado pode ser obtido em consultas distribuídas que mesclam resultados de vários componentes.</span><span class="sxs-lookup"><span data-stu-id="c9097-216">This result can be obtained from the distributed queries that merge results from multiple components.</span></span> <span data-ttu-id="c9097-217">Por exemplo, a consulta para obter a lista de nós vai para **FailoverManager** e **ClusterManager** e **HealthManager** e a consulta para obter a lista de aplicativos vai para **ClusterManager** e **HealthManager**.</span><span class="sxs-lookup"><span data-stu-id="c9097-217">For example, the get node list query goes to **FailoverManager**, **ClusterManager**, and **HealthManager**; get application list query goes to **ClusterManager** and **HealthManager**.</span></span> <span data-ttu-id="c9097-218">Essas consultas mesclam os resultados de vários componentes do sistema.</span><span class="sxs-lookup"><span data-stu-id="c9097-218">These queries merge results from multiple system components.</span></span> <span data-ttu-id="c9097-219">Se outro componente do sistema retornar uma entidade que não está presente no repositório de integridade, o resultado mesclado terá um estado de integridade desconhecido.</span><span class="sxs-lookup"><span data-stu-id="c9097-219">If another system component returns an entity that is not present in health store, the merged result has unknown health state.</span></span> <span data-ttu-id="c9097-220">Uma entidade não está no repositório porque os relatórios de integridade ainda não foram processados ou a entidade foi apagada após a exclusão.</span><span class="sxs-lookup"><span data-stu-id="c9097-220">An entity is not in store because health reports have not yet been processed or the entity has been cleaned up after deletion.</span></span>

## <a name="health-policies"></a><span data-ttu-id="c9097-221">Políticas de integridade</span><span class="sxs-lookup"><span data-stu-id="c9097-221">Health policies</span></span>
<span data-ttu-id="c9097-222">O Repositório de Integridade aplica políticas de integridade para determinar se uma entidade está íntegra com base em seus relatórios e filhos.</span><span class="sxs-lookup"><span data-stu-id="c9097-222">The health store applies health policies to determine whether an entity is healthy based on its reports and its children.</span></span>

> [!NOTE]
> <span data-ttu-id="c9097-223">As políticas de integridade podem ser especificadas no manifesto do cluster (para avaliação de integridade do cluster e do nó) ou no manifesto do aplicativo (para avaliação de aplicativo e qualquer um de seus filhos).</span><span class="sxs-lookup"><span data-stu-id="c9097-223">Health policies can be specified in the cluster manifest (for cluster and node health evaluation) or in the application manifest (for application evaluation and any of its children).</span></span> <span data-ttu-id="c9097-224">As solicitações de avaliação de integridade também podem passar pelas políticas de avaliação de integridade personalizadas, que são usadas apenas para avaliação.</span><span class="sxs-lookup"><span data-stu-id="c9097-224">Health evaluation requests can also pass in custom health evaluation policies, which are used only for that evaluation.</span></span>
> 
> 

<span data-ttu-id="c9097-225">Por padrão, o Service Fabric aplica regras rígidas (tudo deve estar íntegro) para a relação hierárquica pai-filho.</span><span class="sxs-lookup"><span data-stu-id="c9097-225">By default, Service Fabric applies strict rules (everything must be healthy) for the parent-child hierarchical relationship.</span></span> <span data-ttu-id="c9097-226">Se mesmo um dos filhos tem um evento não íntegro, o pai será considerado não íntegro.</span><span class="sxs-lookup"><span data-stu-id="c9097-226">If even one of the children has one unhealthy event, the parent is considered unhealthy.</span></span>

### <a name="cluster-health-policy"></a><span data-ttu-id="c9097-227">Política de integridade do cluster</span><span class="sxs-lookup"><span data-stu-id="c9097-227">Cluster health policy</span></span>
<span data-ttu-id="c9097-228">A [política de integridade do cluster](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy) é usada para avaliar o estado de integridade do cluster e os estados de integridade do nó.</span><span class="sxs-lookup"><span data-stu-id="c9097-228">The [cluster health policy](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy) is used to evaluate the cluster health state and node health states.</span></span> <span data-ttu-id="c9097-229">A política pode ser definida no manifesto do cluster.</span><span class="sxs-lookup"><span data-stu-id="c9097-229">The policy can be defined in the cluster manifest.</span></span> <span data-ttu-id="c9097-230">Se não estiver presente, a política padrão (zero falhas toleradas) é usada.</span><span class="sxs-lookup"><span data-stu-id="c9097-230">If it is not present, the default policy (zero tolerated failures) is used.</span></span>
<span data-ttu-id="c9097-231">A política de integridade do cluster contém:</span><span class="sxs-lookup"><span data-stu-id="c9097-231">The cluster health policy contains:</span></span>

* <span data-ttu-id="c9097-232">[ConsiderWarningAsError](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.considerwarningaserror).</span><span class="sxs-lookup"><span data-stu-id="c9097-232">[ConsiderWarningAsError](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.considerwarningaserror).</span></span> <span data-ttu-id="c9097-233">Especifica se os relatórios de integridade Aviso devem ser tratados como erros durante a avaliação de integridade.</span><span class="sxs-lookup"><span data-stu-id="c9097-233">Specifies whether to treat warning health reports as errors during health evaluation.</span></span> <span data-ttu-id="c9097-234">Padrão: falso.</span><span class="sxs-lookup"><span data-stu-id="c9097-234">Default: false.</span></span>
* <span data-ttu-id="c9097-235">[MaxPercentUnhealthyApplications](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.maxpercentunhealthyapplications).</span><span class="sxs-lookup"><span data-stu-id="c9097-235">[MaxPercentUnhealthyApplications](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.maxpercentunhealthyapplications).</span></span> <span data-ttu-id="c9097-236">Especifica a porcentagem máxima tolerada de aplicativos que podem estar não íntegros antes de o cluster ser considerado com erro.</span><span class="sxs-lookup"><span data-stu-id="c9097-236">Specifies the maximum tolerated percentage of applications that can be unhealthy before the cluster is considered in error.</span></span>
* <span data-ttu-id="c9097-237">[MaxPercentUnhealthyNodes](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.maxpercentunhealthynodes).</span><span class="sxs-lookup"><span data-stu-id="c9097-237">[MaxPercentUnhealthyNodes](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.maxpercentunhealthynodes).</span></span> <span data-ttu-id="c9097-238">Especifica a porcentagem máxima tolerada de nós que podem estar não íntegros antes de o cluster ser considerado com erro.</span><span class="sxs-lookup"><span data-stu-id="c9097-238">Specifies the maximum tolerated percentage of nodes that can be unhealthy before the cluster is considered in error.</span></span> <span data-ttu-id="c9097-239">Em clusters grandes, sempre há nós desativados ou ausentes para reparo, de modo que esse percentual deve ser configurado para tolerá-los.</span><span class="sxs-lookup"><span data-stu-id="c9097-239">In large clusters, some nodes are always down or out for repairs, so this percentage should be configured to tolerate that.</span></span>
* <span data-ttu-id="c9097-240">[ApplicationTypeHealthPolicyMap](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.applicationtypehealthpolicymap).</span><span class="sxs-lookup"><span data-stu-id="c9097-240">[ApplicationTypeHealthPolicyMap](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.applicationtypehealthpolicymap).</span></span> <span data-ttu-id="c9097-241">O mapa da política de integridade do tipo de aplicativo pode ser usado durante a avaliação da integridade do cluster para descrever tipos especiais de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c9097-241">The application type health policy map can be used during cluster health evaluation to describe special application types.</span></span> <span data-ttu-id="c9097-242">Por padrão, todos os aplicativos são colocados em um pool e avaliados com MaxPercentUnhealthyApplications.</span><span class="sxs-lookup"><span data-stu-id="c9097-242">By default, all applications are put into a pool and evaluated with MaxPercentUnhealthyApplications.</span></span> <span data-ttu-id="c9097-243">Se alguns tipos de aplicativos tiverem que ser tratados de forma diferente, eles poderão ser criados fora do pool global.</span><span class="sxs-lookup"><span data-stu-id="c9097-243">If some application types should be treated differently, they can be taken out of the global pool.</span></span> <span data-ttu-id="c9097-244">Em vez disso, eles são avaliados em relação às porcentagens associadas com seu nome de tipo de aplicativo no mapa.</span><span class="sxs-lookup"><span data-stu-id="c9097-244">Instead, they are evaluated against the percentages associated with their application type name in the map.</span></span> <span data-ttu-id="c9097-245">Por exemplo, em um cluster, há milhares de aplicativos de diferentes tipos e algumas instâncias de aplicativo de controle de um tipo especial de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c9097-245">For example, in a cluster there are thousands of applications of different types, and a few control application instances of a special application type.</span></span> <span data-ttu-id="c9097-246">Os aplicativos de controle nunca deve apresentar erro.</span><span class="sxs-lookup"><span data-stu-id="c9097-246">The control applications should never be in error.</span></span> <span data-ttu-id="c9097-247">Você pode especificar MaxPercentUnhealthyApplications global como 20% para tolerar algumas falhas, mas para o tipo de aplicativo "ControlApplicationType", defina MaxPercentUnhealthyApplications como 0.</span><span class="sxs-lookup"><span data-stu-id="c9097-247">You can specify global MaxPercentUnhealthyApplications to 20% to tolerate some failures, but for the application type "ControlApplicationType" set the MaxPercentUnhealthyApplications to 0.</span></span> <span data-ttu-id="c9097-248">Dessa forma, se alguns dos muitos aplicativos estiverem em estado não íntegro, mas abaixo da porcentagem de não integridade global, o estado do cluster será Aviso.</span><span class="sxs-lookup"><span data-stu-id="c9097-248">This way, if some of the many applications are unhealthy, but below the global unhealthy percentage, the cluster would be evaluated to Warning.</span></span> <span data-ttu-id="c9097-249">Um estado de integridade de aviso não afeta a atualização do cluster nem outros recursos de monitoramento disparados pelo estado de integridade Erro.</span><span class="sxs-lookup"><span data-stu-id="c9097-249">A warning health state does not impact cluster upgrade or other monitoring triggered by Error health state.</span></span> <span data-ttu-id="c9097-250">Mas, até mesmo um controle de aplicativo em erro poderia tornar o cluster não íntegro, que dispara a reversão ou pausa a atualização de cluster, dependendo da configuração de atualização.</span><span class="sxs-lookup"><span data-stu-id="c9097-250">But even one control application in error would make cluster unhealthy, which triggers roll back or pauses the cluster upgrade, depending on the upgrade configuration.</span></span>
  <span data-ttu-id="c9097-251">Para os tipos de aplicativo definidos no mapa, todas as instâncias do aplicativo são retiradas do pool global de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="c9097-251">For the application types defined in the map, all application instances are taken out of the global pool of applications.</span></span> <span data-ttu-id="c9097-252">Eles são avaliados com base no número total de aplicativos do tipo de aplicativo, usando MaxPercentUnhealthyApplications específico do mapa.</span><span class="sxs-lookup"><span data-stu-id="c9097-252">They are evaluated based on the total number of applications of the application type, using the specific MaxPercentUnhealthyApplications from the map.</span></span> <span data-ttu-id="c9097-253">O restante dos aplicativos permanece no pool global e é avaliado com MaxPercentUnhealthyApplications.</span><span class="sxs-lookup"><span data-stu-id="c9097-253">All the rest of the applications remain in the global pool and are evaluated with MaxPercentUnhealthyApplications.</span></span>

<span data-ttu-id="c9097-254">O exemplo a seguir é um trecho de um manifesto do cluster.</span><span class="sxs-lookup"><span data-stu-id="c9097-254">The following example is an excerpt from a cluster manifest.</span></span> <span data-ttu-id="c9097-255">Para definir as entradas no mapa do tipo de aplicativo, prefixe o nome do parâmetro com “ApplicationTypeMaxPercentUnhealthyApplications-”, seguido do nome do tipo de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c9097-255">To define entries in the application type map, prefix the parameter name with "ApplicationTypeMaxPercentUnhealthyApplications-", followed by the application type name.</span></span>

```xml
<FabricSettings>
  <Section Name="HealthManager/ClusterHealthPolicy">
    <Parameter Name="ConsiderWarningAsError" Value="False" />
    <Parameter Name="MaxPercentUnhealthyApplications" Value="20" />
    <Parameter Name="MaxPercentUnhealthyNodes" Value="20" />
    <Parameter Name="ApplicationTypeMaxPercentUnhealthyApplications-ControlApplicationType" Value="0" />
  </Section>
</FabricSettings>
```

### <a name="application-health-policy"></a><span data-ttu-id="c9097-256">Política de integridade do aplicativo</span><span class="sxs-lookup"><span data-stu-id="c9097-256">Application health policy</span></span>
<span data-ttu-id="c9097-257">A [política de integridade do aplicativo](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy) descreve como a avaliação da agregação dos estados de eventos e filhos é feita para aplicativos e seus filhos.</span><span class="sxs-lookup"><span data-stu-id="c9097-257">The [application health policy](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy) describes how the evaluation of events and child-states aggregation is done for applications and their children.</span></span> <span data-ttu-id="c9097-258">Ela pode ser definida no manifesto do aplicativo, **ApplicationManifest.xml**, no pacote de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="c9097-258">It can be defined in the application manifest, **ApplicationManifest.xml**, in the application package.</span></span> <span data-ttu-id="c9097-259">Se nenhuma política for especificada, o Service Fabric suporá que a entidade não está íntegra se ela tiver um relatório de integridade ou um filho no estado de integridade com erro ou aviso.</span><span class="sxs-lookup"><span data-stu-id="c9097-259">If no policies are specified, Service Fabric assumes that the entity is unhealthy if it has a health report or a child at the warning or error health state.</span></span>
<span data-ttu-id="c9097-260">As políticas configuráveis são:</span><span class="sxs-lookup"><span data-stu-id="c9097-260">The configurable policies are:</span></span>

* <span data-ttu-id="c9097-261">[ConsiderWarningAsError](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.considerwarningaserror.aspx).</span><span class="sxs-lookup"><span data-stu-id="c9097-261">[ConsiderWarningAsError](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.considerwarningaserror.aspx).</span></span> <span data-ttu-id="c9097-262">Especifica se os relatórios de integridade Aviso devem ser tratados como erros durante a avaliação de integridade.</span><span class="sxs-lookup"><span data-stu-id="c9097-262">Specifies whether to treat warning health reports as errors during health evaluation.</span></span> <span data-ttu-id="c9097-263">Padrão: falso.</span><span class="sxs-lookup"><span data-stu-id="c9097-263">Default: false.</span></span>
* <span data-ttu-id="c9097-264">[MaxPercentUnhealthyDeployedApplications](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.maxpercentunhealthydeployedapplications).</span><span class="sxs-lookup"><span data-stu-id="c9097-264">[MaxPercentUnhealthyDeployedApplications](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.maxpercentunhealthydeployedapplications).</span></span> <span data-ttu-id="c9097-265">Especifica a porcentagem máxima tolerada de aplicativos implantados que podem estar não íntegros antes de o aplicativo ser considerado com erro.</span><span class="sxs-lookup"><span data-stu-id="c9097-265">Specifies the maximum tolerated percentage of deployed applications that can be unhealthy before the application is considered in error.</span></span> <span data-ttu-id="c9097-266">Este percentual é calculado pela divisão do número de aplicativos implantados não íntegros pelo número de nós em que os aplicativos estão atualmente implantados no cluster.</span><span class="sxs-lookup"><span data-stu-id="c9097-266">This percentage is calculated by dividing the number of unhealthy deployed applications over the number of nodes that the applications are currently deployed on in the cluster.</span></span> <span data-ttu-id="c9097-267">O cálculo é arredondado para cima para tolerar uma falha em um número pequeno de nós.</span><span class="sxs-lookup"><span data-stu-id="c9097-267">The computation rounds up to tolerate one failure on small numbers of nodes.</span></span> <span data-ttu-id="c9097-268">Porcentagem padrão: zero.</span><span class="sxs-lookup"><span data-stu-id="c9097-268">Default percentage: zero.</span></span>
* <span data-ttu-id="c9097-269">[DefaultServiceTypeHealthPolicy](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.defaultservicetypehealthpolicy).</span><span class="sxs-lookup"><span data-stu-id="c9097-269">[DefaultServiceTypeHealthPolicy](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.defaultservicetypehealthpolicy).</span></span> <span data-ttu-id="c9097-270">Especifica a política de integridade do tipo de serviço padrão, que substitui a política de integridade padrão para todos os tipos de serviço no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c9097-270">Specifies the default service type health policy, which replaces the default health policy for all service types in the application.</span></span>
* <span data-ttu-id="c9097-271">[ServiceTypeHealthPolicyMap](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.servicetypehealthpolicymap).</span><span class="sxs-lookup"><span data-stu-id="c9097-271">[ServiceTypeHealthPolicyMap](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.servicetypehealthpolicymap).</span></span> <span data-ttu-id="c9097-272">Fornece um mapa de políticas de integridade do serviço por tipo de serviço.</span><span class="sxs-lookup"><span data-stu-id="c9097-272">Provides a map of service health policies per service type.</span></span> <span data-ttu-id="c9097-273">Estas políticas substituem as políticas de integridade do tipo de serviço padrão para cada tipo de serviço especificado.</span><span class="sxs-lookup"><span data-stu-id="c9097-273">These policies replace the default service type health policies for each specified service type.</span></span> <span data-ttu-id="c9097-274">Por exemplo, se um aplicativo tiver um tipo de serviço de gateway sem estado e um tipo de serviço de mecanismo com estado, você poderá configurar as políticas de integridade da avaliação de maneira diferente.</span><span class="sxs-lookup"><span data-stu-id="c9097-274">For example, if an application has a stateless gateway service type and a stateful engine service type, you can configure the health policies for their evaluation differently.</span></span> <span data-ttu-id="c9097-275">Ao especificar a política por tipo de serviço você permite um controle mais granular da integridade do serviço.</span><span class="sxs-lookup"><span data-stu-id="c9097-275">When you specify policy per service type, you can gain more granular control of the health of the service.</span></span>

### <a name="service-type-health-policy"></a><span data-ttu-id="c9097-276">Políticas de integridade do tipo de serviço</span><span class="sxs-lookup"><span data-stu-id="c9097-276">Service type health policy</span></span>
<span data-ttu-id="c9097-277">A [política de integridade do tipo de serviço](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy) especifica como avaliar e agregar os serviços e os filhos dos serviços.</span><span class="sxs-lookup"><span data-stu-id="c9097-277">The [service type health policy](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy) specifies how to evaluate and aggregate the services and the children of services.</span></span> <span data-ttu-id="c9097-278">A política contém:</span><span class="sxs-lookup"><span data-stu-id="c9097-278">The policy contains:</span></span>

* <span data-ttu-id="c9097-279">[MaxPercentUnhealthyPartitionsPerService](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy.maxpercentunhealthypartitionsperservice).</span><span class="sxs-lookup"><span data-stu-id="c9097-279">[MaxPercentUnhealthyPartitionsPerService](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy.maxpercentunhealthypartitionsperservice).</span></span> <span data-ttu-id="c9097-280">Especifica a porcentagem máxima tolerada de partições não íntegras antes de um serviço ser considerado não íntegro.</span><span class="sxs-lookup"><span data-stu-id="c9097-280">Specifies the maximum tolerated percentage of unhealthy partitions before a service is considered unhealthy.</span></span> <span data-ttu-id="c9097-281">Porcentagem padrão: zero.</span><span class="sxs-lookup"><span data-stu-id="c9097-281">Default percentage: zero.</span></span>
* <span data-ttu-id="c9097-282">[MaxPercentUnhealthyReplicasPerPartition](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy.maxpercentunhealthyreplicasperpartition).</span><span class="sxs-lookup"><span data-stu-id="c9097-282">[MaxPercentUnhealthyReplicasPerPartition](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy.maxpercentunhealthyreplicasperpartition).</span></span> <span data-ttu-id="c9097-283">Especifica a porcentagem máxima tolerada de réplicas não íntegras antes de uma partição ser considerada não íntegro.</span><span class="sxs-lookup"><span data-stu-id="c9097-283">Specifies the maximum tolerated percentage of unhealthy replicas before a partition is considered unhealthy.</span></span> <span data-ttu-id="c9097-284">Porcentagem padrão: zero.</span><span class="sxs-lookup"><span data-stu-id="c9097-284">Default percentage: zero.</span></span>
* <span data-ttu-id="c9097-285">[MaxPercentUnhealthyServices](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy.maxpercentunhealthyservices).</span><span class="sxs-lookup"><span data-stu-id="c9097-285">[MaxPercentUnhealthyServices](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy.maxpercentunhealthyservices).</span></span> <span data-ttu-id="c9097-286">Especifica a porcentagem máxima tolerada de serviços não íntegros antes de um aplicativo ser considerado não íntegro.</span><span class="sxs-lookup"><span data-stu-id="c9097-286">Specifies the maximum tolerated percentage of unhealthy services before the application is considered unhealthy.</span></span> <span data-ttu-id="c9097-287">Porcentagem padrão: zero.</span><span class="sxs-lookup"><span data-stu-id="c9097-287">Default percentage: zero.</span></span>

<span data-ttu-id="c9097-288">O exemplo a seguir é um trecho de um manifesto do aplicativo:</span><span class="sxs-lookup"><span data-stu-id="c9097-288">The following example is an excerpt from an application manifest:</span></span>

```xml
    <Policies>
        <HealthPolicy ConsiderWarningAsError="true" MaxPercentUnhealthyDeployedApplications="20">
            <DefaultServiceTypeHealthPolicy
                   MaxPercentUnhealthyServices="0"
                   MaxPercentUnhealthyPartitionsPerService="10"
                   MaxPercentUnhealthyReplicasPerPartition="0"/>
            <ServiceTypeHealthPolicy ServiceTypeName="FrontEndServiceType"
                   MaxPercentUnhealthyServices="0"
                   MaxPercentUnhealthyPartitionsPerService="20"
                   MaxPercentUnhealthyReplicasPerPartition="0"/>
            <ServiceTypeHealthPolicy ServiceTypeName="BackEndServiceType"
                   MaxPercentUnhealthyServices="20"
                   MaxPercentUnhealthyPartitionsPerService="0"
                   MaxPercentUnhealthyReplicasPerPartition="0">
            </ServiceTypeHealthPolicy>
        </HealthPolicy>
    </Policies>
```

## <a name="health-evaluation"></a><span data-ttu-id="c9097-289">Avaliação da integridade</span><span class="sxs-lookup"><span data-stu-id="c9097-289">Health evaluation</span></span>
<span data-ttu-id="c9097-290">Os usuários ou serviços automatizados podem avaliar a integridade de qualquer entidade a qualquer momento.</span><span class="sxs-lookup"><span data-stu-id="c9097-290">Users and automated services can evaluate health for any entity at any time.</span></span> <span data-ttu-id="c9097-291">Para avaliar a integridade de uma entidade, o Repositório de Integridade agrega todos os relatórios de integridade na entidade e avalia todos os seus filhos (quando aplicável).</span><span class="sxs-lookup"><span data-stu-id="c9097-291">To evaluate an entity's health, the health store aggregates all health reports on the entity and evaluates all its children (when applicable).</span></span> <span data-ttu-id="c9097-292">O algoritmo de agregação de integridade usa políticas de integridade que especificam como avaliar os relatórios de integridade e como agregar estados de integridade dos filhos (quando aplicável).</span><span class="sxs-lookup"><span data-stu-id="c9097-292">The health aggregation algorithm uses health policies that specify how to evaluate health reports and how to aggregate child health states (when applicable).</span></span>

### <a name="health-report-aggregation"></a><span data-ttu-id="c9097-293">Agregação do relatório de integridade</span><span class="sxs-lookup"><span data-stu-id="c9097-293">Health report aggregation</span></span>
<span data-ttu-id="c9097-294">Uma entidade pode ter vários relatórios de integridade enviados por diferentes relatores (componentes do sistema ou watchdogs) em propriedades diferentes.</span><span class="sxs-lookup"><span data-stu-id="c9097-294">One entity can have multiple health reports sent by different reporters (system components or watchdogs) on different properties.</span></span> <span data-ttu-id="c9097-295">A agregação usa as políticas de integridade associadas, especificamente o membro ConsiderWarningAsError da política de integridade do aplicativo ou cluster.</span><span class="sxs-lookup"><span data-stu-id="c9097-295">The aggregation uses the associated health policies, in particular the ConsiderWarningAsError member of application or cluster health policy.</span></span> <span data-ttu-id="c9097-296">ConsiderWarningAsError especifica como avaliar os avisos.</span><span class="sxs-lookup"><span data-stu-id="c9097-296">ConsiderWarningAsError specifies how to evaluate warnings.</span></span>

<span data-ttu-id="c9097-297">O estado de integridade agregada é disparado pelos *piores* relatórios de integridade da entidade.</span><span class="sxs-lookup"><span data-stu-id="c9097-297">The aggregated health state is triggered by the *worst* health reports on the entity.</span></span> <span data-ttu-id="c9097-298">Se houver pelo menos um relatório de integridade com Erro, o estado de integridade agregada será um erro.</span><span class="sxs-lookup"><span data-stu-id="c9097-298">If there is at least one error health report, the aggregated health state is an error.</span></span>

![Agregação de relatório de integridade com o relatório de erro.][2]

<span data-ttu-id="c9097-300">Uma entidade de integridade que tem um ou mais relatórios de integridade de erro é avaliada como Erro.</span><span class="sxs-lookup"><span data-stu-id="c9097-300">A health entity that has one or more error health reports is evaluated as Error.</span></span> <span data-ttu-id="c9097-301">O mesmo é verdadeiro para um relatório de integridade expirado, independentemente do seu estado de integridade.</span><span class="sxs-lookup"><span data-stu-id="c9097-301">The same is true for an expired health report, regardless of its health state.</span></span>

[2]: ./media/service-fabric-health-introduction/servicefabric-health-report-eval-error.png

<span data-ttu-id="c9097-302">Se não houver relatórios de erro, e um ou mais avisos, o estado de integridade agregada será aviso ou erro, dependendo do sinalizador de política ConsiderWarningAsError.</span><span class="sxs-lookup"><span data-stu-id="c9097-302">If there are no error reports and one or more warnings, the aggregated health state is either warning or error, depending on the ConsiderWarningAsError policy flag.</span></span>

![Agregação do relatório de integridade com o relatório de aviso e ConsiderWarningAsError false.][3]

<span data-ttu-id="c9097-304">A agregação do relatório de integridade com relatório de aviso e ConsiderWarningAsError definido como falso (padrão).</span><span class="sxs-lookup"><span data-stu-id="c9097-304">Health report aggregation with warning report and ConsiderWarningAsError set to false (default).</span></span>

[3]: ./media/service-fabric-health-introduction/servicefabric-health-report-eval-warning.png

### <a name="child-health-aggregation"></a><span data-ttu-id="c9097-305">Agregação de integridade de filhos</span><span class="sxs-lookup"><span data-stu-id="c9097-305">Child health aggregation</span></span>
<span data-ttu-id="c9097-306">O estado de integridade agregada de uma entidade reflete os estados de integridade dos filhos (quando aplicável).</span><span class="sxs-lookup"><span data-stu-id="c9097-306">The aggregated health state of an entity reflects the child health states (when applicable).</span></span> <span data-ttu-id="c9097-307">O algoritmo para agregar estados de integridade dos filhos usa as políticas aplicáveis de integridade com base no tipo de entidade.</span><span class="sxs-lookup"><span data-stu-id="c9097-307">The algorithm for aggregating child health states uses the health policies applicable based on the entity type.</span></span>

![Agregação de integridade de entidades filho.][4]

<span data-ttu-id="c9097-309">Agregação de filhos com base nas políticas de integridade.</span><span class="sxs-lookup"><span data-stu-id="c9097-309">Child aggregation based on health policies.</span></span>

[4]: ./media/service-fabric-health-introduction/servicefabric-health-hierarchy-eval.png

<span data-ttu-id="c9097-310">Depois que o Repositório de Integridade tiver avaliado todos os filhos, ele agregará seus estados de integridade com base no percentual máximo configurado de filhos não íntegros.</span><span class="sxs-lookup"><span data-stu-id="c9097-310">After the health store has evaluated all the children, it aggregates their health states based on the configured maximum percentage of unhealthy children.</span></span> <span data-ttu-id="c9097-311">Este percentual é obtido da política com base no tipo de entidade e filho.</span><span class="sxs-lookup"><span data-stu-id="c9097-311">This percentage is taken from the policy based on the entity and child type.</span></span>

* <span data-ttu-id="c9097-312">Se todos os filhos tiverem estados OK, o estado de integridade agregada dos filhos será OK.</span><span class="sxs-lookup"><span data-stu-id="c9097-312">If all children have OK states, the child aggregated health state is OK.</span></span>
* <span data-ttu-id="c9097-313">Se todos os filhos tiverem estados OK e aviso, o estado de integridade agregada dos filhos é um aviso.</span><span class="sxs-lookup"><span data-stu-id="c9097-313">If children have both OK and warning states, the child aggregated health state is warning.</span></span>
* <span data-ttu-id="c9097-314">Se houver filhos com estados de erro que não respeitarem a porcentagem máxima permitida de filhos não íntegros, o estado de integridade agregada é um erro.</span><span class="sxs-lookup"><span data-stu-id="c9097-314">If there are children with error states that do not respect the maximum allowed percentage of unhealthy children, the aggregated health state is an error.</span></span>
* <span data-ttu-id="c9097-315">Se os filhos com estados de erro respeitarem a porcentagem máxima permitida de filhos não íntegros, o estado de integridade agregada é um aviso.</span><span class="sxs-lookup"><span data-stu-id="c9097-315">If the children with error states respect the maximum allowed percentage of unhealthy children, the aggregated health state is warning.</span></span>

## <a name="health-reporting"></a><span data-ttu-id="c9097-316">Relatório de integridade</span><span class="sxs-lookup"><span data-stu-id="c9097-316">Health reporting</span></span>
<span data-ttu-id="c9097-317">Os componentes do sistema, os aplicativos do System Fabric e os watchdogs internos/externos podem ser relatados em relação às entidades do Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="c9097-317">System components, System Fabric applications, and internal/external watchdogs can report against Service Fabric entities.</span></span> <span data-ttu-id="c9097-318">Os relatores fazem uma determinação *local* da integridade da entidades monitoradas com base em algumas condições que estão monitorando.</span><span class="sxs-lookup"><span data-stu-id="c9097-318">The reporters make *local* determinations of the health of the monitored entities, based on the conditions they are monitoring.</span></span> <span data-ttu-id="c9097-319">Eles não precisam observar nenhum estado global ou dados agregados.</span><span class="sxs-lookup"><span data-stu-id="c9097-319">They don't need to look at any global state or aggregate data.</span></span> <span data-ttu-id="c9097-320">O comportamento desejado é ter relatores simples e organismos não complexos que precisariam observar muitas circunstâncias para inferir quais informações enviar.</span><span class="sxs-lookup"><span data-stu-id="c9097-320">The desired behavior is to have simple reporters, and not complex organisms that need to look at many things to infer what information to send.</span></span>

<span data-ttu-id="c9097-321">Para enviar dados de integridade ao repositório de integridade, o relator precisa identificar a entidade afetada e criar um relatório de integridade.</span><span class="sxs-lookup"><span data-stu-id="c9097-321">To send health data to the health store, a reporter needs to identify the affected entity and create a health report.</span></span> <span data-ttu-id="c9097-322">Para enviar o relatório, use a API [FabricClient.HealthClient.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth), relate as APIs de integridade expostos nos objetos `Partition` ou `CodePackageActivationContext`, os cmdlets do PowerShell ou REST.</span><span class="sxs-lookup"><span data-stu-id="c9097-322">To send the report, use the [FabricClient.HealthClient.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth) API, report health APIs exposed on the `Partition` or `CodePackageActivationContext` objects, PowerShell cmdlets, or REST.</span></span>

### <a name="health-reports"></a><span data-ttu-id="c9097-323">Relatórios de integridade</span><span class="sxs-lookup"><span data-stu-id="c9097-323">Health reports</span></span>
<span data-ttu-id="c9097-324">Os [relatórios de integridade](https://docs.microsoft.com/dotnet/api/system.fabric.health.healthreport) de cada uma das entidades no cluster contêm as seguintes informações:</span><span class="sxs-lookup"><span data-stu-id="c9097-324">The [health reports](https://docs.microsoft.com/dotnet/api/system.fabric.health.healthreport) for each of the entities in the cluster contain the following information:</span></span>

* <span data-ttu-id="c9097-325">**SourceId**.</span><span class="sxs-lookup"><span data-stu-id="c9097-325">**SourceId**.</span></span> <span data-ttu-id="c9097-326">Uma cadeia de caracteres que identifica exclusivamente o relator do evento de integridade.</span><span class="sxs-lookup"><span data-stu-id="c9097-326">A string that uniquely identifies the reporter of the health event.</span></span>
* <span data-ttu-id="c9097-327">**Identificador de entidade**.</span><span class="sxs-lookup"><span data-stu-id="c9097-327">**Entity identifier**.</span></span> <span data-ttu-id="c9097-328">Identifica a entidade na qual o relatório é aplicado.</span><span class="sxs-lookup"><span data-stu-id="c9097-328">Identifies the entity where the report is applied.</span></span> <span data-ttu-id="c9097-329">Varia de acordo com o [tipo de entidade](service-fabric-health-introduction.md#health-entities-and-hierarchy):</span><span class="sxs-lookup"><span data-stu-id="c9097-329">It differs based on the [entity type](service-fabric-health-introduction.md#health-entities-and-hierarchy):</span></span>
  
  * <span data-ttu-id="c9097-330">Cluster.</span><span class="sxs-lookup"><span data-stu-id="c9097-330">Cluster.</span></span> <span data-ttu-id="c9097-331">Nenhuma.</span><span class="sxs-lookup"><span data-stu-id="c9097-331">None.</span></span>
  * <span data-ttu-id="c9097-332">Nó.</span><span class="sxs-lookup"><span data-stu-id="c9097-332">Node.</span></span> <span data-ttu-id="c9097-333">Nome do nó (cadeia de caracteres).</span><span class="sxs-lookup"><span data-stu-id="c9097-333">Node name  (string).</span></span>
  * <span data-ttu-id="c9097-334">Console.</span><span class="sxs-lookup"><span data-stu-id="c9097-334">Application.</span></span> <span data-ttu-id="c9097-335">Nome do aplicativo (URI).</span><span class="sxs-lookup"><span data-stu-id="c9097-335">Application name (URI).</span></span> <span data-ttu-id="c9097-336">Representa o nome da instância do aplicativo implantado no cluster.</span><span class="sxs-lookup"><span data-stu-id="c9097-336">Represents the name of the application instance deployed in the cluster.</span></span>
  * <span data-ttu-id="c9097-337">Serviço.</span><span class="sxs-lookup"><span data-stu-id="c9097-337">Service.</span></span> <span data-ttu-id="c9097-338">Nome do serviço (URI).</span><span class="sxs-lookup"><span data-stu-id="c9097-338">Service name (URI).</span></span> <span data-ttu-id="c9097-339">Representa o nome da instância do serviço implantado no cluster.</span><span class="sxs-lookup"><span data-stu-id="c9097-339">Represents the name of the service instance deployed in the cluster.</span></span>
  * <span data-ttu-id="c9097-340">Partição.</span><span class="sxs-lookup"><span data-stu-id="c9097-340">Partition.</span></span> <span data-ttu-id="c9097-341">ID da partição (GUID).</span><span class="sxs-lookup"><span data-stu-id="c9097-341">Partition ID (GUID).</span></span> <span data-ttu-id="c9097-342">Representa o identificador exclusivo da partição.</span><span class="sxs-lookup"><span data-stu-id="c9097-342">Represents the partition unique identifier.</span></span>
  * <span data-ttu-id="c9097-343">Réplica.</span><span class="sxs-lookup"><span data-stu-id="c9097-343">Replica.</span></span> <span data-ttu-id="c9097-344">A ID de réplica do serviço com estado ou a ID da instância do serviço sem estado (INT64).</span><span class="sxs-lookup"><span data-stu-id="c9097-344">The stateful service replica ID or the stateless service instance ID (INT64).</span></span>
  * <span data-ttu-id="c9097-345">DeployedApplication.</span><span class="sxs-lookup"><span data-stu-id="c9097-345">DeployedApplication.</span></span> <span data-ttu-id="c9097-346">Nome do aplicativo (URI) e o nome do nó (cadeia de caracteres).</span><span class="sxs-lookup"><span data-stu-id="c9097-346">Application name (URI) and node name (string).</span></span>
  * <span data-ttu-id="c9097-347">DeployedServicePackage.</span><span class="sxs-lookup"><span data-stu-id="c9097-347">DeployedServicePackage.</span></span> <span data-ttu-id="c9097-348">Nome do aplicativo (URI), nome do nó (cadeia de caracteres) e nome do manifesto do serviço (cadeia de caracteres).</span><span class="sxs-lookup"><span data-stu-id="c9097-348">Application name (URI), node name (string), and service manifest name (string).</span></span>
* <span data-ttu-id="c9097-349">**Property**.</span><span class="sxs-lookup"><span data-stu-id="c9097-349">**Property**.</span></span> <span data-ttu-id="c9097-350">Um *cadeia de caracteres* (não uma enumeração fixa) que permite ao relator classificar o evento de integridade para uma propriedade específica da entidade.</span><span class="sxs-lookup"><span data-stu-id="c9097-350">A *string* (not a fixed enumeration) that allows the reporter to categorize the health event for a specific property of the entity.</span></span> <span data-ttu-id="c9097-351">Por exemplo, o relator A pode relatar a integridade da propriedade “Storage” de Node01 e o relator B pode relatar a integridade na propriedade “Connectivity” de Node01.</span><span class="sxs-lookup"><span data-stu-id="c9097-351">For example, reporter A can report the health of the Node01 "Storage" property and reporter B can report the health of the Node01 "Connectivity" property.</span></span> <span data-ttu-id="c9097-352">No Repositório de Integridade, esses relatórios são tratados como eventos de integridade distintos para a entidade Node01.</span><span class="sxs-lookup"><span data-stu-id="c9097-352">In the health store, these reports are treated as separate health events for the Node01 entity.</span></span>
* <span data-ttu-id="c9097-353">**Description**.</span><span class="sxs-lookup"><span data-stu-id="c9097-353">**Description**.</span></span> <span data-ttu-id="c9097-354">Uma cadeia de caracteres que permite ao relator fornecer informações detalhadas sobre o evento de integridade.</span><span class="sxs-lookup"><span data-stu-id="c9097-354">A string that allows a reporter to provide detailed information about the health event.</span></span> <span data-ttu-id="c9097-355">**SourceId**, **Property** e **HealthState** devem descrever o relatório por completo.</span><span class="sxs-lookup"><span data-stu-id="c9097-355">**SourceId**, **Property**, and **HealthState** should fully describe the report.</span></span> <span data-ttu-id="c9097-356">A descrição adiciona informações legíveis sobre o relatório.</span><span class="sxs-lookup"><span data-stu-id="c9097-356">The description adds human-readable information about the report.</span></span> <span data-ttu-id="c9097-357">O texto facilita para que os administradores e os usuários entendam o relatório de integridade.</span><span class="sxs-lookup"><span data-stu-id="c9097-357">The text makes it easier for administrators and users to understand the health report.</span></span>
* <span data-ttu-id="c9097-358">**HealthState**.</span><span class="sxs-lookup"><span data-stu-id="c9097-358">**HealthState**.</span></span> <span data-ttu-id="c9097-359">Uma [enumeração](service-fabric-health-introduction.md#health-states) que descreve o estado de integridade do relatório.</span><span class="sxs-lookup"><span data-stu-id="c9097-359">An [enumeration](service-fabric-health-introduction.md#health-states) that describes the health state of the report.</span></span> <span data-ttu-id="c9097-360">Os valores aceitáveis são OK, Aviso e Erro.</span><span class="sxs-lookup"><span data-stu-id="c9097-360">The accepted values are OK, Warning, and Error.</span></span>
* <span data-ttu-id="c9097-361">**TimeToLive**.</span><span class="sxs-lookup"><span data-stu-id="c9097-361">**TimeToLive**.</span></span> <span data-ttu-id="c9097-362">Um período de tempo que indica por quanto tempo o relatório de integridade é válido.</span><span class="sxs-lookup"><span data-stu-id="c9097-362">A timespan that indicates how long the health report is valid.</span></span> <span data-ttu-id="c9097-363">Em conjunto com **RemoveWhenExpired**, permite que o repositório de integridade saiba como avaliar eventos expirados.</span><span class="sxs-lookup"><span data-stu-id="c9097-363">Coupled with **RemoveWhenExpired**, it lets the health store know how to evaluate expired events.</span></span> <span data-ttu-id="c9097-364">Por padrão, o valor é infinito e o relatório é válido indefinidamente.</span><span class="sxs-lookup"><span data-stu-id="c9097-364">By default, the value is infinite, and the report is valid forever.</span></span>
* <span data-ttu-id="c9097-365">**RemoveWhenExpired**.</span><span class="sxs-lookup"><span data-stu-id="c9097-365">**RemoveWhenExpired**.</span></span> <span data-ttu-id="c9097-366">Um valor booleano.</span><span class="sxs-lookup"><span data-stu-id="c9097-366">A Boolean.</span></span> <span data-ttu-id="c9097-367">Se definido como verdadeiro, o relatório de integridade expirado será removido automaticamente do Repositório de Integridade e o relatório não afetará a avaliação da integridade da entidade.</span><span class="sxs-lookup"><span data-stu-id="c9097-367">If set to true, the expired health report is automatically removed from the health store, and the report doesn't impact entity health evaluation.</span></span> <span data-ttu-id="c9097-368">Usado quando o relatório for válido apenas por um período especificado de tempo e o relator não precisar removê-lo explicitamente. Ele também é usado para excluir relatórios do repositório de integridade (por exemplo, um watchdog é alterado e interrompe o envio de relatórios com propriedade e origem anteriores).</span><span class="sxs-lookup"><span data-stu-id="c9097-368">Used when the report is valid for a specified period of time only, and the reporter doesn't need to explicitly clear it out. It's also used to delete reports from the health store (for example, a watchdog is changed and stops sending reports with previous source and property).</span></span> <span data-ttu-id="c9097-369">Portanto, ele pode enviar um relatório com TimeToLive curto e RemoveWhenExpired para eliminar qualquer estado anterior do Repositório de Integridade.</span><span class="sxs-lookup"><span data-stu-id="c9097-369">It can send a report with a brief TimeToLive along with RemoveWhenExpired to clear up any previous state from the health store.</span></span> <span data-ttu-id="c9097-370">Se o valor for definido como false, o relatório expirado será tratado como erro na avaliação de integridade.</span><span class="sxs-lookup"><span data-stu-id="c9097-370">If the value is set to false, the expired report is treated as an error on the health evaluation.</span></span> <span data-ttu-id="c9097-371">O valor false indica ao repositório de integridade que a origem deve relatar periodicamente essa propriedade.</span><span class="sxs-lookup"><span data-stu-id="c9097-371">The false value signals to the health store that the source should report periodically on this property.</span></span> <span data-ttu-id="c9097-372">Caso contrário, deve haver algo errado com o watchdog.</span><span class="sxs-lookup"><span data-stu-id="c9097-372">If it doesn't, then there must be something wrong with the watchdog.</span></span> <span data-ttu-id="c9097-373">A integridade do watchdog é capturada ao considerar o evento como um erro.</span><span class="sxs-lookup"><span data-stu-id="c9097-373">The watchdog's health is captured by considering the event as an error.</span></span>
* <span data-ttu-id="c9097-374">**SequenceNumber**.</span><span class="sxs-lookup"><span data-stu-id="c9097-374">**SequenceNumber**.</span></span> <span data-ttu-id="c9097-375">Um inteiro positivo que sempre precisa ser aumentado, pois ele representa a ordem dos relatórios.</span><span class="sxs-lookup"><span data-stu-id="c9097-375">A positive integer that needs to be ever-increasing, it represents the order of the reports.</span></span> <span data-ttu-id="c9097-376">Ele é usado pelo Repositório de Integridade para detectar relatórios obsoletos que são recebidos em atraso devido a atrasos na rede ou outros problemas.</span><span class="sxs-lookup"><span data-stu-id="c9097-376">It is used by the health store to detect stale reports that are received late because of network delays or other issues.</span></span> <span data-ttu-id="c9097-377">Um relatório é rejeitado se o número da sequência for menor ou igual ao aplicado mais recentemente para a mesma entidade, origem e propriedade.</span><span class="sxs-lookup"><span data-stu-id="c9097-377">A report is rejected if the sequence number is less than or equal to the most recently applied number for the same entity, source, and property.</span></span> <span data-ttu-id="c9097-378">Se não for especificado, o número de sequência é gerado automaticamente.</span><span class="sxs-lookup"><span data-stu-id="c9097-378">If it is not specified, the sequence number is generated automatically.</span></span> <span data-ttu-id="c9097-379">É necessário colocar o número de sequência apenas ao relatar transições de estado.</span><span class="sxs-lookup"><span data-stu-id="c9097-379">It is necessary to put in the sequence number only when reporting on state transitions.</span></span> <span data-ttu-id="c9097-380">Nessa situação, a origem precisa lembrar quais relatórios enviou e manter as informações de recuperação no failover.</span><span class="sxs-lookup"><span data-stu-id="c9097-380">In this situation, the source needs to remember which reports it sent and keep the information for recovery on failover.</span></span>

<span data-ttu-id="c9097-381">Essas quatro informações: SourceId, identificador da entidade, Propriedade e HealthState são obrigatórios para cada relatório de integridade.</span><span class="sxs-lookup"><span data-stu-id="c9097-381">These four pieces of information--SourceId, entity identifier, Property, and HealthState--are required for every health report.</span></span> <span data-ttu-id="c9097-382">A cadeia de caracteres SourceId não pode iniciar com o prefixo "**System.**", que é reservado para relatórios do sistema.</span><span class="sxs-lookup"><span data-stu-id="c9097-382">The SourceId string is not allowed to start with the prefix "**System.**", which is reserved for system reports.</span></span> <span data-ttu-id="c9097-383">Para a mesma entidade, há apenas um relatório para a mesma origem e propriedade.</span><span class="sxs-lookup"><span data-stu-id="c9097-383">For the same entity, there is only one report for the same source and property.</span></span> <span data-ttu-id="c9097-384">Vários relatórios para a mesma fonte e propriedade substituirão uns aos outros, seja no lado do cliente de integridade (se estiverem divididos em lotes), seja no lado do Repositório de Integridade.</span><span class="sxs-lookup"><span data-stu-id="c9097-384">Multiple reports for the same source and property override each other, either on the health client side (if they are batched) or on the health store side.</span></span> <span data-ttu-id="c9097-385">A substituição é baseada nos números da sequência: relatórios mais recentes (com número de sequência mais alto) substituem os relatórios mais antigos.</span><span class="sxs-lookup"><span data-stu-id="c9097-385">The replacement is based on sequence numbers; newer reports (with higher sequence numbers) replace older reports.</span></span>

### <a name="health-events"></a><span data-ttu-id="c9097-386">Eventos de integridade</span><span class="sxs-lookup"><span data-stu-id="c9097-386">Health events</span></span>
<span data-ttu-id="c9097-387">Internamente, o Repositório de Integridade mantém os [eventos de integridade](https://docs.microsoft.com/dotnet/api/system.fabric.health.healthevent), que contêm todas as informações de relatórios e metadados adicionais.</span><span class="sxs-lookup"><span data-stu-id="c9097-387">Internally, the health store keeps [health events](https://docs.microsoft.com/dotnet/api/system.fabric.health.healthevent), which contain all the information from the reports, and additional metadata.</span></span> <span data-ttu-id="c9097-388">Os metadados incluem a hora em que o relatório foi fornecido ao cliente de integridade e a hora em que ele foi modificado no lado do servidor.</span><span class="sxs-lookup"><span data-stu-id="c9097-388">The metadata includes the time the report was given to the health client and the time it was modified on the server side.</span></span> <span data-ttu-id="c9097-389">Os eventos de integridade são retornados pelas [consultas de integridade](service-fabric-view-entities-aggregated-health.md#health-queries).</span><span class="sxs-lookup"><span data-stu-id="c9097-389">The health events are returned by [health queries](service-fabric-view-entities-aggregated-health.md#health-queries).</span></span>

<span data-ttu-id="c9097-390">Os metadados adicionados contêm:</span><span class="sxs-lookup"><span data-stu-id="c9097-390">The added metadata contains:</span></span>

* <span data-ttu-id="c9097-391">**SourceUtcTimestamp**.</span><span class="sxs-lookup"><span data-stu-id="c9097-391">**SourceUtcTimestamp**.</span></span> <span data-ttu-id="c9097-392">A hora que o relatório foi fornecido ao cliente de integridade (Coordinated Universal Time)</span><span class="sxs-lookup"><span data-stu-id="c9097-392">The time the report was given to the health client (Coordinated Universal Time).</span></span>
* <span data-ttu-id="c9097-393">**LastModifiedUtcTimestamp**.</span><span class="sxs-lookup"><span data-stu-id="c9097-393">**LastModifiedUtcTimestamp**.</span></span> <span data-ttu-id="c9097-394">A hora em que o relatório foi modificado pela última vez no lado do servidor (Coordinated Universal Time).</span><span class="sxs-lookup"><span data-stu-id="c9097-394">The time the report was last modified on the server side (Coordinated Universal Time).</span></span>
* <span data-ttu-id="c9097-395">**IsExpired**.</span><span class="sxs-lookup"><span data-stu-id="c9097-395">**IsExpired**.</span></span> <span data-ttu-id="c9097-396">Um sinalizador para indicar se o relatório estava expirado no momento que a consulta foi executada pelo Repositório de Integridade.</span><span class="sxs-lookup"><span data-stu-id="c9097-396">A flag to indicate whether the report was expired when the query was executed by the health store.</span></span> <span data-ttu-id="c9097-397">Um evento pode ter expirado somente se RemoveWhenExpired for false.</span><span class="sxs-lookup"><span data-stu-id="c9097-397">An event can be expired only if RemoveWhenExpired is false.</span></span> <span data-ttu-id="c9097-398">Caso contrário, o evento não é retornado pela consulta e é removido do armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c9097-398">Otherwise, the event is not returned by query and is removed from the store.</span></span>
* <span data-ttu-id="c9097-399">**LastOkTransitionAt**, **LastWarningTransitionAt**, **LastErrorTransitionAt**.</span><span class="sxs-lookup"><span data-stu-id="c9097-399">**LastOkTransitionAt**, **LastWarningTransitionAt**, **LastErrorTransitionAt**.</span></span> <span data-ttu-id="c9097-400">A última hora para transições OK/aviso/erro.</span><span class="sxs-lookup"><span data-stu-id="c9097-400">The last time for OK/warning/error transitions.</span></span> <span data-ttu-id="c9097-401">Esses campos fornecem o histórico das transições de estado de integridade para o evento.</span><span class="sxs-lookup"><span data-stu-id="c9097-401">These fields give the history of the health state transitions for the event.</span></span>

<span data-ttu-id="c9097-402">Os campos de transição de estado podem ser usados para gerar alertas mais inteligentes ou informações “históricas” de evento de integridade.</span><span class="sxs-lookup"><span data-stu-id="c9097-402">The state transition fields can be used for smarter alerts or "historical" health event information.</span></span> <span data-ttu-id="c9097-403">Eles permitem cenários como:</span><span class="sxs-lookup"><span data-stu-id="c9097-403">They enable scenarios such as:</span></span>

* <span data-ttu-id="c9097-404">Alertar quando uma propriedade estiver no estado aviso/erro por mais de X minutos.</span><span class="sxs-lookup"><span data-stu-id="c9097-404">Alert when a property has been at warning/error for more than X minutes.</span></span> <span data-ttu-id="c9097-405">A verificação da condição para um período de tempo evita alertas em condições temporárias.</span><span class="sxs-lookup"><span data-stu-id="c9097-405">Checking the condition for a period of time avoids alerts on temporary conditions.</span></span> <span data-ttu-id="c9097-406">Por exemplo, um alerta se o estado da integridade estiver em aviso por mais de 5 minutos pode ser traduzido em (HealthState == Aviso e Agora - LastWarningTransitionTime > 5 minutos).</span><span class="sxs-lookup"><span data-stu-id="c9097-406">For example, an alert if the health state has been warning for more than five minutes can be translated into (HealthState == Warning and Now - LastWarningTransitionTime > 5 minutes).</span></span>
* <span data-ttu-id="c9097-407">Alertar apenas em condições que mudaram nos últimos X minutos.</span><span class="sxs-lookup"><span data-stu-id="c9097-407">Alert only on conditions that have changed in the last X minutes.</span></span> <span data-ttu-id="c9097-408">Se um relatório estiver em estado de erro desde antes da hora especificada, ele poderá ser ignorado pois já tinha sido sinalizado anteriormente.</span><span class="sxs-lookup"><span data-stu-id="c9097-408">If a report was already at error before the specified time, it can be ignored because it was already signaled previously.</span></span>
* <span data-ttu-id="c9097-409">Se uma propriedade estiver alternando entre aviso e erro, determine por quanto tempo ele esteve não íntegro (isto é, não OK).</span><span class="sxs-lookup"><span data-stu-id="c9097-409">If a property is toggling between warning and error, determine how long it has been unhealthy (that is, not OK).</span></span> <span data-ttu-id="c9097-410">Por exemplo, um alerta se a propriedade não esteve íntegra por mais de 5 minutos pode ser traduzido em: (HealthState != Ok e Agora - LastOkTransitionTime > 5 minutos).</span><span class="sxs-lookup"><span data-stu-id="c9097-410">For example, an alert if the property hasn't been healthy for more than five minutes can be translated into (HealthState != Ok and Now - LastOkTransitionTime > 5 minutes).</span></span>

## <a name="example-report-and-evaluate-application-health"></a><span data-ttu-id="c9097-411">Exemplo: relatar e avaliar integridade do aplicativo</span><span class="sxs-lookup"><span data-stu-id="c9097-411">Example: Report and evaluate application health</span></span>
<span data-ttu-id="c9097-412">O exemplo a seguir envia um relatório de integridade por meio PowerShell no aplicativo **fabric:/WordCount** da origem **MyWatchdog**.</span><span class="sxs-lookup"><span data-stu-id="c9097-412">The following example sends a health report through PowerShell on the application **fabric:/WordCount** from the source **MyWatchdog**.</span></span> <span data-ttu-id="c9097-413">O relatório de integridade contém informações sobre a propriedade de integridade "availability" em um estado de integridade de erro, com TimeToLive infinito.</span><span class="sxs-lookup"><span data-stu-id="c9097-413">The health report contains information about the health property "availability" in an error health state, with infinite TimeToLive.</span></span> <span data-ttu-id="c9097-414">Em seguida, ele consulta a integridade do aplicativo, que retornará erro do estado de integridade agregada e o evento de integridade relatado como parte da lista de eventos de integridade.</span><span class="sxs-lookup"><span data-stu-id="c9097-414">Then it queries the application health, which returns aggregated health state errors and the reported health events in the list of health events.</span></span>

```powershell
PS C:\> Send-ServiceFabricApplicationHealthReport –ApplicationName fabric:/WordCount –SourceId "MyWatchdog" –HealthProperty "Availability" –HealthState Error

PS C:\> Get-ServiceFabricApplicationHealth fabric:/WordCount -ExcludeHealthStatistics


ApplicationName                 : fabric:/WordCount
AggregatedHealthState           : Error
UnhealthyEvaluations            :
                                  Error event: SourceId='MyWatchdog', Property='Availability'.

ServiceHealthStates             :
                                  ServiceName           : fabric:/WordCount/WordCountService
                                  AggregatedHealthState : Error

                                  ServiceName           : fabric:/WordCount/WordCountWebService
                                  AggregatedHealthState : Ok

DeployedApplicationHealthStates :
                                  ApplicationName       : fabric:/WordCount
                                  NodeName              : _Node_0
                                  AggregatedHealthState : Ok

                                  ApplicationName       : fabric:/WordCount
                                  NodeName              : _Node_2
                                  AggregatedHealthState : Ok

                                  ApplicationName       : fabric:/WordCount
                                  NodeName              : _Node_3
                                  AggregatedHealthState : Ok

                                  ApplicationName       : fabric:/WordCount
                                  NodeName              : _Node_4
                                  AggregatedHealthState : Ok

                                  ApplicationName       : fabric:/WordCount
                                  NodeName              : _Node_1
                                  AggregatedHealthState : Ok

HealthEvents                    :
                                  SourceId              : System.CM
                                  Property              : State
                                  HealthState           : Ok
                                  SequenceNumber        : 360
                                  SentAt                : 3/22/2016 7:56:53 PM
                                  ReceivedAt            : 3/22/2016 7:56:53 PM
                                  TTL                   : Infinite
                                  Description           : Application has been created.
                                  RemoveWhenExpired     : False
                                  IsExpired             : False
                                  Transitions           : Error->Ok = 3/22/2016 7:56:53 PM, LastWarning = 1/1/0001 12:00:00 AM

                                  SourceId              : MyWatchdog
                                  Property              : Availability
                                  HealthState           : Error
                                  SequenceNumber        : 131032204762818013
                                  SentAt                : 3/23/2016 3:27:56 PM
                                  ReceivedAt            : 3/23/2016 3:27:56 PM
                                  TTL                   : Infinite
                                  Description           :
                                  RemoveWhenExpired     : False
                                  IsExpired             : False
                                  Transitions           : Ok->Error = 3/23/2016 3:27:56 PM, LastWarning = 1/1/0001 12:00:00 AM
```

## <a name="health-model-usage"></a><span data-ttu-id="c9097-415">Uso do modelo de integridade</span><span class="sxs-lookup"><span data-stu-id="c9097-415">Health model usage</span></span>
<span data-ttu-id="c9097-416">O modelo de integridade permite que os serviços de nuvem e a plataforma subjacente do Service Fabric ajustem a escala, pois o monitoramento e a determinação da integridade são distribuídos entre os diferentes monitores no cluster.</span><span class="sxs-lookup"><span data-stu-id="c9097-416">The health model allows cloud services and the underlying Service Fabric platform to scale, because monitoring and health determinations are distributed among the different monitors within the cluster.</span></span>
<span data-ttu-id="c9097-417">Outros sistemas têm um único serviço centralizado no nível de cluster, que analisa todas as informações *potencialmente* úteis emitidas pelos serviços.</span><span class="sxs-lookup"><span data-stu-id="c9097-417">Other systems have a single, centralized service at the cluster level that parses all the *potentially* useful information emitted by services.</span></span> <span data-ttu-id="c9097-418">Essa abordagem impede a escalabilidade dos mesmos.</span><span class="sxs-lookup"><span data-stu-id="c9097-418">This approach hinders their scalability.</span></span> <span data-ttu-id="c9097-419">Isso também impede que eles coletem informações específicas que ajudam a identificar problemas e problemas potenciais mais próximos possíveis da causa raiz.</span><span class="sxs-lookup"><span data-stu-id="c9097-419">It also doesn't allow them to collect specific information to help identify issues and potential issues as close to the root cause as possible.</span></span>

<span data-ttu-id="c9097-420">O modelo de integridade é muito usado para monitoramento e diagnóstico, para avaliar a integridade do cluster e do aplicativo, bem como para atualizações monitoradas.</span><span class="sxs-lookup"><span data-stu-id="c9097-420">The health model is used heavily for monitoring and diagnosis, for evaluating cluster and application health, and for monitored upgrades.</span></span> <span data-ttu-id="c9097-421">Outros serviços usam os dados de integridade para executar reparos automáticos, para criar histórico de integridade do cluster e para emitir alertas em determinadas condições.</span><span class="sxs-lookup"><span data-stu-id="c9097-421">Other services use health data to perform automatic repairs, build cluster health history, and issue alerts on certain conditions.</span></span>

## <a name="next-steps"></a><span data-ttu-id="c9097-422">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="c9097-422">Next steps</span></span>
[<span data-ttu-id="c9097-423">Como exibir relatórios de integridade do Service Fabric</span><span class="sxs-lookup"><span data-stu-id="c9097-423">View Service Fabric health reports</span></span>](service-fabric-view-entities-aggregated-health.md)

[<span data-ttu-id="c9097-424">Usar relatórios de integridade do sistema para solução de problemas</span><span class="sxs-lookup"><span data-stu-id="c9097-424">Use system health reports for troubleshooting</span></span>](service-fabric-understand-and-troubleshoot-with-system-health-reports.md)

[<span data-ttu-id="c9097-425">Como relatar e verificar a integridade do serviço</span><span class="sxs-lookup"><span data-stu-id="c9097-425">How to report and check service health</span></span>](service-fabric-diagnostics-how-to-report-and-check-service-health.md)

[<span data-ttu-id="c9097-426">Adicionar relatórios de integridade personalizados do Service Fabric</span><span class="sxs-lookup"><span data-stu-id="c9097-426">Add custom Service Fabric health reports</span></span>](service-fabric-report-health.md)

[<span data-ttu-id="c9097-427">Monitorar e diagnosticar serviços localmente</span><span class="sxs-lookup"><span data-stu-id="c9097-427">Monitor and diagnose services locally</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)

[<span data-ttu-id="c9097-428">Atualização de aplicativos do Service Fabric</span><span class="sxs-lookup"><span data-stu-id="c9097-428">Service Fabric application upgrade</span></span>](service-fabric-application-upgrade.md)

