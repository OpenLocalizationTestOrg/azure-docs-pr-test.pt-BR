---
title: "aaaUsing Elasticsearch como um repositório de rastreamento de aplicativo do Service Fabric | Microsoft Docs"
description: "Descreve como aplicativos de serviço de malha podem usar toostore Elasticsearch e Kibana, índice e pesquisa por meio de rastreamentos do aplicativo (registros)"
services: service-fabric
documentationcenter: .net
author: karolz-ms
manager: adegeo
editor: 
ms.assetid: e59b0c39-e468-4d9e-b453-d5f2a8ad20d8
ms.service: service-fabric
ms.devlang: dotNet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/07/2017
ms.author: karolz@microsoft.com
redirect_url: /azure/service-fabric/service-fabric-diagnostics-event-aggregation-eventflow
ms.openlocfilehash: b5977c54e69319e3caa376e44a02f971b66a3254
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="use-elasticsearch-as-a-service-fabric-application-trace-store"></a><span data-ttu-id="503b1-103">Usar o Elasticsearch como um repositório de rastreamento do aplicativo Service Fabric</span><span class="sxs-lookup"><span data-stu-id="503b1-103">Use Elasticsearch as a Service Fabric application trace store</span></span>
## <a name="introduction"></a><span data-ttu-id="503b1-104">Introdução</span><span class="sxs-lookup"><span data-stu-id="503b1-104">Introduction</span></span>
<span data-ttu-id="503b1-105">Este artigo descreve como os aplicativos do [Azure Service Fabric](https://azure.microsoft.com/documentation/services/service-fabric/) podem usar o **Elasticsearch** e o **Kibana** para armazenamento de rastreamento do aplicativo, indexação e pesquisa.</span><span class="sxs-lookup"><span data-stu-id="503b1-105">This article describes how [Azure Service Fabric](https://azure.microsoft.com/documentation/services/service-fabric/) applications can use **Elasticsearch** and **Kibana** for application trace storage, indexing, and search.</span></span> <span data-ttu-id="503b1-106">[Elasticsearch](https://www.elastic.co/guide/index.html) é um mecanismo de análise e pesquisa em tempo real escalonável, distribuído de software livre adequado para essa tarefa.</span><span class="sxs-lookup"><span data-stu-id="503b1-106">[Elasticsearch](https://www.elastic.co/guide/index.html) is an open-source, distributed, and scalable real-time search and analytics engine that is well-suited for this task.</span></span> <span data-ttu-id="503b1-107">Ele pode ser instalado em máquinas virtuais Windows ou Linux em execução no Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="503b1-107">It can be installed on Windows and Linux virtual machines running in Microsoft Azure.</span></span> <span data-ttu-id="503b1-108">O Elasticsearch pode processar de maneira eficiente os rastreamentos *estruturados* produzidos usando tecnologias como **ETW (Rastreamento de Eventos para Windows)**.</span><span class="sxs-lookup"><span data-stu-id="503b1-108">Elasticsearch can efficiently process *structured* traces produced using technologies such as **Event Tracing for Windows (ETW)**.</span></span>

<span data-ttu-id="503b1-109">O ETW é usado pelo Service Fabric runtime toosource informações de diagnóstico (rastreamentos).</span><span class="sxs-lookup"><span data-stu-id="503b1-109">ETW is used by Service Fabric runtime toosource diagnostic information (traces).</span></span> <span data-ttu-id="503b1-110">É Olá recomendado suas informações de diagnóstico de método para toosource de aplicativos do Service Fabric muito.</span><span class="sxs-lookup"><span data-stu-id="503b1-110">It is hello recommended method for Service Fabric applications toosource their diagnostic information, too.</span></span> <span data-ttu-id="503b1-111">Usando o mesmo mecanismo permite a correlação entre fornecidas pelo aplicativo e fornecidos pelo tempo de execução de rastreamentos e torna a solução de problemas de saudação.</span><span class="sxs-lookup"><span data-stu-id="503b1-111">Using hello same mechanism allows for correlation between runtime-supplied and application-supplied traces and makes troubleshooting easier.</span></span> <span data-ttu-id="503b1-112">Modelos de projeto de malha do serviço no Visual Studio incluem uma API de registro em log (com base em Olá .NET **EventSource** classe) que emite rastreamentos ETW por padrão.</span><span class="sxs-lookup"><span data-stu-id="503b1-112">Service Fabric project templates in Visual Studio include a logging API (based on hello .NET **EventSource** class) that emits ETW traces by default.</span></span> <span data-ttu-id="503b1-113">Para obter uma visão geral do rastreamento de aplicativo do Service Fabric usando o ETW, consulte [Monitorar e diagnosticar serviços em uma configuração de desenvolvimento do computador local](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md).</span><span class="sxs-lookup"><span data-stu-id="503b1-113">For a general overview of Service Fabric application tracing using ETW, see [Monitoring and diagnosing services in a local machine development setup](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md).</span></span>

<span data-ttu-id="503b1-114">Para rastreamentos de saudação tooshow backup em Elasticsearch, eles precisam toobe capturados em nós de cluster do Service Fabric Olá em tempo real (enquanto o aplicativo hello está sendo executado) e enviadas tooan Elasticsearch endpoint.</span><span class="sxs-lookup"><span data-stu-id="503b1-114">For hello traces tooshow up in Elasticsearch, they need toobe captured at hello Service Fabric cluster nodes in real time (while hello application is running) and sent tooan Elasticsearch endpoint.</span></span> <span data-ttu-id="503b1-115">Há duas opções principais para a captura de rastreamento:</span><span class="sxs-lookup"><span data-stu-id="503b1-115">There are two major options for trace capturing:</span></span>

* <span data-ttu-id="503b1-116">**Captura de rastreamento dentro do processo**</span><span class="sxs-lookup"><span data-stu-id="503b1-116">**In-process trace capturing**</span></span>  
  <span data-ttu-id="503b1-117">aplicativo Hello, ou mais precisamente, processo de serviço, é responsável pelo envio de repositório de rastreamento de toohello de dados de diagnóstico de saudação (Elasticsearch).</span><span class="sxs-lookup"><span data-stu-id="503b1-117">hello application, or more precisely, service process, is responsible for sending out hello diagnostic data toohello trace store (Elasticsearch).</span></span>
* <span data-ttu-id="503b1-118">**Captura de rastreamento fora do processo**</span><span class="sxs-lookup"><span data-stu-id="503b1-118">**Out-of-process trace capturing**</span></span>  
  <span data-ttu-id="503b1-119">Um agente separado é capturar rastreamentos de processo do serviço hello ou processos e enviá-los toohello repositório de rastreamento.</span><span class="sxs-lookup"><span data-stu-id="503b1-119">A separate agent is capturing traces from hello service process or processes and sending them toohello trace store.</span></span>

<span data-ttu-id="503b1-120">Abaixo descrevemos como tooset backup Elasticsearch no Azure, discuta profissionais hello e contras tanto para capturar as opções e explicam como tooconfigure uma malha de serviço serviço toosend tooElasticsearch de dados.</span><span class="sxs-lookup"><span data-stu-id="503b1-120">Below, we describe how tooset up Elasticsearch on Azure, discuss hello pros and cons for both capture options, and explain how tooconfigure a Service Fabric service toosend data tooElasticsearch.</span></span>

## <a name="set-up-elasticsearch-on-azure"></a><span data-ttu-id="503b1-121">Configurar o Elasticsearch no Azure</span><span class="sxs-lookup"><span data-stu-id="503b1-121">Set up Elasticsearch on Azure</span></span>
<span data-ttu-id="503b1-122">Olá tooset de maneira mais direta o serviço de Elasticsearch Olá no Azure é por meio de [ **modelos do Azure Resource Manager**](../azure-resource-manager/resource-group-overview.md).</span><span class="sxs-lookup"><span data-stu-id="503b1-122">hello most straightforward way tooset up hello Elasticsearch service on Azure is through [**Azure Resource Manager templates**](../azure-resource-manager/resource-group-overview.md).</span></span> <span data-ttu-id="503b1-123">Um [modelo do Gerenciador de Recursos do Azure de início rápido para Elasticsearch](https://github.com/Azure/azure-quickstart-templates/tree/master/elasticsearch) abrangente está disponível no repositório de modelos de início rápido do Azure.</span><span class="sxs-lookup"><span data-stu-id="503b1-123">A comprehensive [Quickstart Azure Resource Manager template for Elasticsearch](https://github.com/Azure/azure-quickstart-templates/tree/master/elasticsearch) is available from Azure Quickstart templates repository.</span></span> <span data-ttu-id="503b1-124">Este modelo usa contas de armazenamento separada para as unidades de escala (grupos de nós).</span><span class="sxs-lookup"><span data-stu-id="503b1-124">This template uses separate storage accounts for scale units (groups of nodes).</span></span> <span data-ttu-id="503b1-125">Ele também pode provisionar nós de cliente e servidor separados com configurações diferentes e vários números de discos de dados anexados.</span><span class="sxs-lookup"><span data-stu-id="503b1-125">It can also provision separate client and server nodes with different configurations and various numbers of data disks attached.</span></span>

<span data-ttu-id="503b1-126">Aqui, podemos usar outro modelo, chamado **ES-vários nós** de saudação [repositório de ferramentas de diagnóstico do Azure](https://github.com/Azure/azure-diagnostics-tools).</span><span class="sxs-lookup"><span data-stu-id="503b1-126">Here, we use another template, called **ES-MultiNode** from hello [Azure diagnostic tools repository](https://github.com/Azure/azure-diagnostics-tools).</span></span> <span data-ttu-id="503b1-127">Este modelo é mais fácil toouse e cria um cluster Elasticsearch protegido pela autenticação básica HTTP.</span><span class="sxs-lookup"><span data-stu-id="503b1-127">This template is easier toouse, and it creates an Elasticsearch cluster protected by HTTP basic authentication.</span></span> <span data-ttu-id="503b1-128">Antes de prosseguir, baixe repositório de saudação do GitHub tooyour máquina (por clonagem do repositório de saudação ou baixar um arquivo zip).</span><span class="sxs-lookup"><span data-stu-id="503b1-128">Before you proceed, download hello repository from GitHub tooyour machine (by either cloning hello repository or downloading a zip file).</span></span> <span data-ttu-id="503b1-129">modelo de saudação ES-vários nós está localizado na pasta de saudação com hello mesmo nome.</span><span class="sxs-lookup"><span data-stu-id="503b1-129">hello ES-MultiNode template is located in hello folder with hello same name.</span></span>

### <a name="prepare-a-machine-toorun-elasticsearch-installation-scripts"></a><span data-ttu-id="503b1-130">Preparar uma máquina toorun Elasticsearch scripts de instalação</span><span class="sxs-lookup"><span data-stu-id="503b1-130">Prepare a machine toorun Elasticsearch installation scripts</span></span>
<span data-ttu-id="503b1-131">Olá modelo de saudação ES-vários nós de toouse de maneira mais fácil é através de um script do PowerShell do Azure fornecido chamado `CreateElasticSearchCluster`.</span><span class="sxs-lookup"><span data-stu-id="503b1-131">hello easiest way toouse hello ES-MultiNode template is through a provided Azure PowerShell script called `CreateElasticSearchCluster`.</span></span> <span data-ttu-id="503b1-132">toouse esse script, você precisa de módulos do PowerShell tooinstall e uma ferramenta chamada **openssl**.</span><span class="sxs-lookup"><span data-stu-id="503b1-132">toouse this script, you need tooinstall PowerShell modules and a tool called **openssl**.</span></span> <span data-ttu-id="503b1-133">Olá este último é necessário para criar uma chave SSH que pode ser usado tooadminister cluster Elasticsearch remotamente.</span><span class="sxs-lookup"><span data-stu-id="503b1-133">hello latter is needed for creating an SSH key that can be used tooadminister your Elasticsearch cluster remotely.</span></span>

<span data-ttu-id="503b1-134">`CreateElasticSearchCluster`script destina-se a facilidade de uso com o modelo de saudação ES-vários nós de um computador Windows.</span><span class="sxs-lookup"><span data-stu-id="503b1-134">`CreateElasticSearchCluster` script is designed for ease of use with hello ES-MultiNode template from a Windows machine.</span></span> <span data-ttu-id="503b1-135">É possível toouse Olá modelo em um computador diferente do Windows, mas esse cenário está além do escopo deste artigo hello.</span><span class="sxs-lookup"><span data-stu-id="503b1-135">It is possible toouse hello template on a non-Windows machine, but that scenario is beyond hello scope of this article.</span></span>

1. <span data-ttu-id="503b1-136">Se você ainda não os tiver instalado, instale os [**módulos do Azure PowerShell**](http://aka.ms/webpi-azps).</span><span class="sxs-lookup"><span data-stu-id="503b1-136">If you haven't installed them already, install [**Azure PowerShell modules**](http://aka.ms/webpi-azps).</span></span> <span data-ttu-id="503b1-137">Quando solicitado, clique em **Executar** e em **Instalar**.</span><span class="sxs-lookup"><span data-stu-id="503b1-137">When prompted, click **Run**, then **Install**.</span></span> <span data-ttu-id="503b1-138">O Azure PowerShell 1.3 ou mais recente é necessário.</span><span class="sxs-lookup"><span data-stu-id="503b1-138">Azure PowerShell 1.3 or newer is required.</span></span>
2. <span data-ttu-id="503b1-139">Olá **openssl** ferramenta está incluída na distribuição de saudação de [ **Git para Windows**](http://www.git-scm.com/downloads).</span><span class="sxs-lookup"><span data-stu-id="503b1-139">hello **openssl** tool is included in hello distribution of [**Git for Windows**](http://www.git-scm.com/downloads).</span></span> <span data-ttu-id="503b1-140">Se ainda não tiver feito isso, instale agora o [Git para Windows](http://www.git-scm.com/downloads) .</span><span class="sxs-lookup"><span data-stu-id="503b1-140">If you have not done so already, install [Git for Windows](http://www.git-scm.com/downloads) now.</span></span> <span data-ttu-id="503b1-141">(opções de instalação padrão Olá são Okey).</span><span class="sxs-lookup"><span data-stu-id="503b1-141">(hello default installation options are OK.)</span></span>
3. <span data-ttu-id="503b1-142">Supondo que Git foi instalado, mas não incluído no caminho do sistema hello, abra uma janela do Microsoft Azure PowerShell e execute Olá comandos a seguir:</span><span class="sxs-lookup"><span data-stu-id="503b1-142">Assuming that Git has been installed but not included in hello system path, open a Microsoft Azure PowerShell window and run hello following commands:</span></span>
   
    ```powershell
    $ENV:PATH += ";<Git installation folder>\usr\bin"
    $ENV:OPENSSL_CONF = "<Git installation folder>\usr\ssl\openssl.cnf"
    ```
   
    <span data-ttu-id="503b1-143">Substituir saudação `<Git installation folder>` com o local do Git de saudação em seu computador; padrão Olá é **"C:\Program Files\Git"**.</span><span class="sxs-lookup"><span data-stu-id="503b1-143">Replace hello `<Git installation folder>` with hello Git location on your machine; hello default is **"C:\Program Files\Git"**.</span></span> <span data-ttu-id="503b1-144">Observe o caractere de ponto e vírgula Olá no início de saudação do caminho de saudação primeiro.</span><span class="sxs-lookup"><span data-stu-id="503b1-144">Note hello semicolon character at hello beginning of hello first path.</span></span>
4. <span data-ttu-id="503b1-145">Certifique-se de que você está conectado tooAzure (via [ `Add-AzureRmAccount` ](https://msdn.microsoft.com/library/mt619267.aspx) cmdlet) e que você selecionou a assinatura de saudação que deve ser usado toocreate cluster pesquisa Elástico.</span><span class="sxs-lookup"><span data-stu-id="503b1-145">Ensure that you are logged on tooAzure (via [`Add-AzureRmAccount`](https://msdn.microsoft.com/library/mt619267.aspx) cmdlet) and that you have selected hello subscription that should be used toocreate your Elastic Search cluster.</span></span> <span data-ttu-id="503b1-146">Você pode verificar se a assinatura correta foi selecionada usando os cmdlets `Get-AzureRmContext` e `Get-AzureRmSubscription`.</span><span class="sxs-lookup"><span data-stu-id="503b1-146">You can verify that correct subscription is selected using `Get-AzureRmContext` and `Get-AzureRmSubscription` cmdlets.</span></span>
5. <span data-ttu-id="503b1-147">Se você ainda não tiver feito isso, altere a pasta de toohello ES-vários nós de diretório atual do hello.</span><span class="sxs-lookup"><span data-stu-id="503b1-147">If you haven't done so already, change hello current directory toohello ES-MultiNode folder.</span></span>

### <a name="run-hello-createelasticsearchcluster-script"></a><span data-ttu-id="503b1-148">Executar script de CreateElasticSearchCluster Olá</span><span class="sxs-lookup"><span data-stu-id="503b1-148">Run hello CreateElasticSearchCluster script</span></span>
<span data-ttu-id="503b1-149">Antes de executar o script hello, abra Olá `azuredeploy-parameters.json` de arquivo e verificar ou fornecer valores para parâmetros de script hello.</span><span class="sxs-lookup"><span data-stu-id="503b1-149">Before you run hello script, open hello `azuredeploy-parameters.json` file and verify or provide values for hello script parameters.</span></span> <span data-ttu-id="503b1-150">Olá parâmetros a seguir é fornecido:</span><span class="sxs-lookup"><span data-stu-id="503b1-150">hello following parameters are provided:</span></span>

| <span data-ttu-id="503b1-151">Nome do Parâmetro</span><span class="sxs-lookup"><span data-stu-id="503b1-151">Parameter Name</span></span> | <span data-ttu-id="503b1-152">Descrição</span><span class="sxs-lookup"><span data-stu-id="503b1-152">Description</span></span> |
| --- | --- |
| <span data-ttu-id="503b1-153">dnsNameForLoadBalancerIP</span><span class="sxs-lookup"><span data-stu-id="503b1-153">dnsNameForLoadBalancerIP</span></span> |<span data-ttu-id="503b1-154">Olá nome que seja toocreate usado Olá publicamente visível DNS de cluster de pesquisa Elástico Olá (acrescentando nome de toohello fornecido Olá região do Azure domínio).</span><span class="sxs-lookup"><span data-stu-id="503b1-154">hello name that is used toocreate hello publicly visible DNS name for hello Elastic Search cluster (by appending hello Azure region domain toohello provided name).</span></span> <span data-ttu-id="503b1-155">Por exemplo, se esse valor de parâmetro é "myBigCluster" e a região do Azure Olá escolhido é Oeste dos EUA, o nome DNS resultante do Olá para cluster Olá é myBigCluster.westus.cloudapp.azure.com.</span><span class="sxs-lookup"><span data-stu-id="503b1-155">For example, if this parameter value is "myBigCluster" and hello chosen Azure region is West US, hello resulting DNS name for hello cluster is myBigCluster.westus.cloudapp.azure.com.</span></span> <br /><br /><span data-ttu-id="503b1-156">Esse nome também serve como um nome de raiz para muitos artefatos associados Olá pesquisa Elástico cluster, como nomes de nó de dados.</span><span class="sxs-lookup"><span data-stu-id="503b1-156">This name also serves as a root name for many artifacts associated with hello Elastic Search cluster, such as data node names.</span></span> |
| <span data-ttu-id="503b1-157">adminUsername</span><span class="sxs-lookup"><span data-stu-id="503b1-157">adminUsername</span></span> |<span data-ttu-id="503b1-158">nome de Olá Olá da conta de administrador para o gerenciamento de cluster de pesquisa Elástico hello (chaves SSH correspondentes são geradas automaticamente).</span><span class="sxs-lookup"><span data-stu-id="503b1-158">hello name of hello administrator account for managing hello Elastic Search cluster (corresponding SSH keys are generated automatically).</span></span> |
| <span data-ttu-id="503b1-159">dataNodeCount</span><span class="sxs-lookup"><span data-stu-id="503b1-159">dataNodeCount</span></span> |<span data-ttu-id="503b1-160">número de saudação de nós no cluster de pesquisa Elástico hello.</span><span class="sxs-lookup"><span data-stu-id="503b1-160">hello number of nodes in hello Elastic Search cluster.</span></span> <span data-ttu-id="503b1-161">versão atual de saudação do script hello não faz distinção entre nós de dados e consultas. todos os nós de executar as duas funções.</span><span class="sxs-lookup"><span data-stu-id="503b1-161">hello current version of hello script does not distinguish between data and query nodes; all nodes play both roles.</span></span> <span data-ttu-id="503b1-162">Padrões too3 nós.</span><span class="sxs-lookup"><span data-stu-id="503b1-162">Defaults too3 nodes.</span></span> |
| <span data-ttu-id="503b1-163">dataDiskSize</span><span class="sxs-lookup"><span data-stu-id="503b1-163">dataDiskSize</span></span> |<span data-ttu-id="503b1-164">tamanho de saudação de discos de dados (em GB) que é alocado para cada nó de dados.</span><span class="sxs-lookup"><span data-stu-id="503b1-164">hello size of data disks (in GB) that is allocated for each data node.</span></span> <span data-ttu-id="503b1-165">Cada nó recebe 4 discos de dados, tooElastic dedicado exclusivamente o serviço de pesquisa.</span><span class="sxs-lookup"><span data-stu-id="503b1-165">Each node receives 4 data disks, exclusively dedicated tooElastic Search service.</span></span> |
| <span data-ttu-id="503b1-166">region</span><span class="sxs-lookup"><span data-stu-id="503b1-166">region</span></span> |<span data-ttu-id="503b1-167">nome de saudação da região do Azure em que o cluster de pesquisa Elástico Olá deve estar localizado.</span><span class="sxs-lookup"><span data-stu-id="503b1-167">hello name of Azure region where hello Elastic Search cluster should be located.</span></span> |
| <span data-ttu-id="503b1-168">esUserName</span><span class="sxs-lookup"><span data-stu-id="503b1-168">esUserName</span></span> |<span data-ttu-id="503b1-169">Olá, nome do usuário de saudação que é configurado cluster tooES de acesso toohave (autenticação básica do assunto tooHTTP).</span><span class="sxs-lookup"><span data-stu-id="503b1-169">hello user name of hello user that is configured toohave access tooES cluster (subject tooHTTP basic authentication).</span></span> <span data-ttu-id="503b1-170">Olá senha não é parte do arquivo de parâmetros e deve ser fornecida quando `CreateElasticSearchCluster` script é invocado.</span><span class="sxs-lookup"><span data-stu-id="503b1-170">hello password is not part of parameters file and must be provided when `CreateElasticSearchCluster` script is invoked.</span></span> |
| <span data-ttu-id="503b1-171">vmSizeDataNodes</span><span class="sxs-lookup"><span data-stu-id="503b1-171">vmSizeDataNodes</span></span> |<span data-ttu-id="503b1-172">Olá tamanho de máquina virtual do Azure para nós de cluster de pesquisa Elástico.</span><span class="sxs-lookup"><span data-stu-id="503b1-172">hello Azure virtual machine size for Elastic Search cluster nodes.</span></span> <span data-ttu-id="503b1-173">TooStandard_D2 padrões.</span><span class="sxs-lookup"><span data-stu-id="503b1-173">Defaults tooStandard_D2.</span></span> |

<span data-ttu-id="503b1-174">Agora você está pronto toorun script de saudação.</span><span class="sxs-lookup"><span data-stu-id="503b1-174">Now you are ready toorun hello script.</span></span> <span data-ttu-id="503b1-175">Saudação de problema comando a seguir:</span><span class="sxs-lookup"><span data-stu-id="503b1-175">Issue hello following command:</span></span>

```powershell
CreateElasticSearchCluster -ResourceGroupName <es-group-name> -Region <azure-region> -EsPassword <es-password>
```

<span data-ttu-id="503b1-176">onde</span><span class="sxs-lookup"><span data-stu-id="503b1-176">where</span></span> 

| <span data-ttu-id="503b1-177">Nome do parâmetro do script</span><span class="sxs-lookup"><span data-stu-id="503b1-177">Script Parameter Name</span></span> | <span data-ttu-id="503b1-178">Descrição</span><span class="sxs-lookup"><span data-stu-id="503b1-178">Description</span></span> |
| --- | --- |
| `<es-group-name>` |<span data-ttu-id="503b1-179">nome de Olá Olá do Azure do grupo de recursos que contém todos os recursos de cluster de pesquisa Elástico.</span><span class="sxs-lookup"><span data-stu-id="503b1-179">hello name of hello Azure resource group that will contain all Elastic Search cluster resources.</span></span> |
| `<azure-region>` |<span data-ttu-id="503b1-180">nome de saudação do hello região do Azure, onde o cluster de pesquisa Elástico Olá deve ser criado.</span><span class="sxs-lookup"><span data-stu-id="503b1-180">hello name of hello Azure region where hello Elastic Search cluster should be created.</span></span> |
| `<es-password>` |<span data-ttu-id="503b1-181">senha Olá Olá Elástico pesquisar usuário.</span><span class="sxs-lookup"><span data-stu-id="503b1-181">hello password for hello Elastic Search user.</span></span> |

> [!NOTE]
> <span data-ttu-id="503b1-182">Se você receber uma NullReferenceException de cmdlet Olá AzureResourceGroup de teste, você esqueceu toolog em tooAzure (`Add-AzureRmAccount`).</span><span class="sxs-lookup"><span data-stu-id="503b1-182">If you get a NullReferenceException from hello Test-AzureResourceGroup cmdlet, you have forgotten toolog on tooAzure (`Add-AzureRmAccount`).</span></span>
> 
> 

<span data-ttu-id="503b1-183">Se você receber um erro de execução de script hello e você determinar que o erro de saudação foi causado por um valor de parâmetro incorreto de modelo, corrija o arquivo de parâmetro hello e execute o script hello novamente com um nome de grupo de recursos diferente.</span><span class="sxs-lookup"><span data-stu-id="503b1-183">If you get an error from running hello script and you determine that hello error was caused by a wrong template parameter value, correct hello parameter file and run hello script again with a different resource group name.</span></span> <span data-ttu-id="503b1-184">Também é possível reutilizar Olá o mesmo nome do grupo de recursos e têm o script hello limpar Olá antigo adicionando Olá `-RemoveExistingResourceGroup` invocação de script do parâmetro toohello.</span><span class="sxs-lookup"><span data-stu-id="503b1-184">You can also reuse hello same resource group name and have hello script clean up hello old one by adding hello `-RemoveExistingResourceGroup` parameter toohello script invocation.</span></span>

### <a name="result-of-running-hello-createelasticsearchcluster-script"></a><span data-ttu-id="503b1-185">Resultado da execução do script de CreateElasticSearchCluster Olá</span><span class="sxs-lookup"><span data-stu-id="503b1-185">Result of running hello CreateElasticSearchCluster script</span></span>
<span data-ttu-id="503b1-186">Depois de executar Olá `CreateElasticSearchCluster` script hello artefatos principais a seguir será criado.</span><span class="sxs-lookup"><span data-stu-id="503b1-186">After you run hello `CreateElasticSearchCluster` script, hello following main artifacts will be created.</span></span> <span data-ttu-id="503b1-187">Para este exemplo, vamos supor que você usou "myBigCluster" como valor de saudação do hello `dnsNameForLoadBalancerIP` parâmetro e região Olá em que você criou o cluster Olá é Oeste dos EUA.</span><span class="sxs-lookup"><span data-stu-id="503b1-187">For this example we assume that you have used "myBigCluster" as hello value of hello `dnsNameForLoadBalancerIP` parameter and that hello region where you created hello cluster is West US.</span></span>

| <span data-ttu-id="503b1-188">Artefato</span><span class="sxs-lookup"><span data-stu-id="503b1-188">Artifact</span></span> | <span data-ttu-id="503b1-189">Nome, local e comentários</span><span class="sxs-lookup"><span data-stu-id="503b1-189">Name, location, and remarks</span></span> |
| --- | --- |
| <span data-ttu-id="503b1-190">Chave SSH para administração remota</span><span class="sxs-lookup"><span data-stu-id="503b1-190">SSH key for remote administration</span></span> |<span data-ttu-id="503b1-191">arquivo myBigCluster.key (no diretório de saudação de quais Olá CreateElasticSearchCluster foi executada).</span><span class="sxs-lookup"><span data-stu-id="503b1-191">myBigCluster.key file (in hello directory from which hello CreateElasticSearchCluster was run).</span></span> <br /><br /><span data-ttu-id="503b1-192">Esse arquivo pode ser usado tooconnect toohello admin nó e (por meio do nó de administração de saudação) toodata nós no cluster de saudação.</span><span class="sxs-lookup"><span data-stu-id="503b1-192">This key file can be used tooconnect toohello admin node and (through hello admin node) toodata nodes in hello cluster.</span></span> |
| <span data-ttu-id="503b1-193">Nó de Admin</span><span class="sxs-lookup"><span data-stu-id="503b1-193">Admin node</span></span> |<span data-ttu-id="503b1-194">myBigCluster-admin.westus.cloudapp.azure.com </span><span class="sxs-lookup"><span data-stu-id="503b1-194">myBigCluster-admin.westus.cloudapp.azure.com</span></span> <br /><br /><span data-ttu-id="503b1-195">Uma VM dedicada para administração remota do cluster Elasticsearch - Olá apenas um que permita conexões externas do SSH.</span><span class="sxs-lookup"><span data-stu-id="503b1-195">A dedicated VM for remote Elasticsearch cluster administration--hello only one that allows external SSH connections.</span></span> <span data-ttu-id="503b1-196">Ele é executado em Olá mesma rede virtual, como todos os nós de cluster Elasticsearch hello, mas não execute todos os serviços Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="503b1-196">It runs on hello same virtual network as all hello Elasticsearch cluster nodes, but it does not run any Elasticsearch services.</span></span> |
| <span data-ttu-id="503b1-197">Nós de dados</span><span class="sxs-lookup"><span data-stu-id="503b1-197">Data nodes</span></span> |<span data-ttu-id="503b1-198">myBigCluster1 ...</span><span class="sxs-lookup"><span data-stu-id="503b1-198">myBigCluster1 …</span></span> <span data-ttu-id="503b1-199">myBigCluster*N*</span><span class="sxs-lookup"><span data-stu-id="503b1-199">myBigCluster*N*</span></span> <br /><br /><span data-ttu-id="503b1-200">Os nós de dados que estão executando os serviços Elasticsearch e Kibana.</span><span class="sxs-lookup"><span data-stu-id="503b1-200">Data nodes that are running Elasticsearch and Kibana services.</span></span> <span data-ttu-id="503b1-201">Você pode se conectar via SSH tooeach nó, mas apenas por meio do nó de administração de saudação.</span><span class="sxs-lookup"><span data-stu-id="503b1-201">You can connect via SSH tooeach node, but only via hello admin node.</span></span> |
| <span data-ttu-id="503b1-202">Cluster Elasticsearch</span><span class="sxs-lookup"><span data-stu-id="503b1-202">Elasticsearch cluster</span></span> |<span data-ttu-id="503b1-203">http://myBigCluster.westus.cloudapp.azure.com/es/</span><span class="sxs-lookup"><span data-stu-id="503b1-203">http://myBigCluster.westus.cloudapp.azure.com/es/</span></span> <br /><br /><span data-ttu-id="503b1-204">Olá ponto de extremidade primário para o cluster de Elasticsearch de saudação (sufixo do Observação Olá /es).</span><span class="sxs-lookup"><span data-stu-id="503b1-204">hello primary endpoint for hello Elasticsearch cluster (note hello /es suffix).</span></span> <span data-ttu-id="503b1-205">Ele é protegido por autenticação HTTP básica (credenciais Olá foram Olá especificado esUserName/esPassword parâmetros de modelo Olá ES-vários nós).</span><span class="sxs-lookup"><span data-stu-id="503b1-205">It is protected by basic HTTP authentication (hello credentials were hello specified esUserName/esPassword parameters of hello ES-MultiNode template).</span></span> <span data-ttu-id="503b1-206">cluster Olá também tem Olá head plug-in instalado (http://myBigCluster.westus.cloudapp.azure.com/es/_plugin/head) para a administração de cluster básico.</span><span class="sxs-lookup"><span data-stu-id="503b1-206">hello cluster has also hello head plug-in installed (http://myBigCluster.westus.cloudapp.azure.com/es/_plugin/head) for basic cluster administration.</span></span> |
| <span data-ttu-id="503b1-207">Serviço Kibana</span><span class="sxs-lookup"><span data-stu-id="503b1-207">Kibana service</span></span> |<span data-ttu-id="503b1-208">http://myBigCluster.westus.cloudapp.azure.com</span><span class="sxs-lookup"><span data-stu-id="503b1-208">http://myBigCluster.westus.cloudapp.azure.com</span></span> <br /><br /><span data-ttu-id="503b1-209">Olá Kibana serviço é configurar os dados de tooshow de saudação criada cluster Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="503b1-209">hello Kibana service is set up tooshow data from hello created Elasticsearch cluster.</span></span> <span data-ttu-id="503b1-210">Ele é protegido por Olá mesmas credenciais de autenticação de saudação do cluster em si.</span><span class="sxs-lookup"><span data-stu-id="503b1-210">It is protected by hello same authentication credentials as hello cluster itself.</span></span> |

## <a name="in-process-versus-out-of-process-trace-capturing"></a><span data-ttu-id="503b1-211">Captura de rastreamento dentro do processo versus fora do processo</span><span class="sxs-lookup"><span data-stu-id="503b1-211">In-process versus out-of-process trace capturing</span></span>
<span data-ttu-id="503b1-212">Introdução de saudação mencionamos duas maneiras fundamentais de coleta de dados de diagnóstico: em processo e fora de processo.</span><span class="sxs-lookup"><span data-stu-id="503b1-212">In hello introduction, we mentioned two fundamental ways of collecting diagnostic data: in-process and out-of-process.</span></span> <span data-ttu-id="503b1-213">Cada uma tem suas vantagens e desvantagens.</span><span class="sxs-lookup"><span data-stu-id="503b1-213">Each has strengths and weaknesses.</span></span>

<span data-ttu-id="503b1-214">Vantagens da saudação **-processo de captura de rastreamento** incluem:</span><span class="sxs-lookup"><span data-stu-id="503b1-214">Advantages of hello **in-process trace capturing** include:</span></span>

1. <span data-ttu-id="503b1-215">*Fácil Configuração e implantação*</span><span class="sxs-lookup"><span data-stu-id="503b1-215">*Easy configuration and deployment*</span></span>
   
   * <span data-ttu-id="503b1-216">configuração de saudação da coleta de dados de diagnóstico é apenas parte da configuração de aplicativo hello.</span><span class="sxs-lookup"><span data-stu-id="503b1-216">hello configuration of diagnostic data collection is just part of hello application configuration.</span></span> <span data-ttu-id="503b1-217">É fácil tooalways manter "sincronizado" com hello-rest do aplicativo hello.</span><span class="sxs-lookup"><span data-stu-id="503b1-217">It is easy tooalways keep it "in sync" with hello rest of hello application.</span></span>
   * <span data-ttu-id="503b1-218">A configuração por aplicativo ou por serviço é facilmente realizável.</span><span class="sxs-lookup"><span data-stu-id="503b1-218">Per-application or per-service configuration is easily achievable.</span></span>
   * <span data-ttu-id="503b1-219">Captura de rastreamento de saída do processo normalmente requer uma implantação separada e a configuração do agente de diagnóstico hello, que é uma tarefa administrativa adicional e uma fonte de erros em potencial.</span><span class="sxs-lookup"><span data-stu-id="503b1-219">Out-of-process trace capturing usually requires a separate deployment and configuration of hello diagnostic agent, which is an extra administrative task and a potential source of errors.</span></span> <span data-ttu-id="503b1-220">a tecnologia de determinado agente Olá geralmente permite apenas uma instância do agente de saudação por máquina virtual (nó).</span><span class="sxs-lookup"><span data-stu-id="503b1-220">hello particular agent technology often allows only one instance of hello agent per virtual machine (node).</span></span> <span data-ttu-id="503b1-221">Isso significa que a configuração para a coleção de saudação da configuração de diagnóstico de saudação é compartilhada entre todos os aplicativos e serviços em execução nesse nó.</span><span class="sxs-lookup"><span data-stu-id="503b1-221">This means that configuration for hello collection of hello diagnostic configuration is shared among all applications and services running on that node.</span></span>
2. <span data-ttu-id="503b1-222">*Flexibilidade*</span><span class="sxs-lookup"><span data-stu-id="503b1-222">*Flexibility*</span></span>
   
   * <span data-ttu-id="503b1-223">aplicativo Hello pode enviar dados Olá sempre que ele precisa toogo, enquanto há uma biblioteca de cliente que oferece suporte ao sistema de armazenamento de dados Olá direcionado.</span><span class="sxs-lookup"><span data-stu-id="503b1-223">hello application can send hello data wherever it needs toogo, as long as there is a client library that supports hello targeted data storage system.</span></span> <span data-ttu-id="503b1-224">Novos coletores podem ser adicionados conforme desejado.</span><span class="sxs-lookup"><span data-stu-id="503b1-224">New sinks can be added as desired.</span></span>
   * <span data-ttu-id="503b1-225">Regras de captura complexa, filtragem e agregação de dados podem ser implementadas.</span><span class="sxs-lookup"><span data-stu-id="503b1-225">Complex capture, filtering, and data-aggregation rules can be implemented.</span></span>
   * <span data-ttu-id="503b1-226">Capturar um rastreamento de saída do processo geralmente é limitado pelo Coletores de dados de saudação que Olá agent dá suporte a.</span><span class="sxs-lookup"><span data-stu-id="503b1-226">An out-of-process trace capturing is often limited by hello data sinks that hello agent supports.</span></span> <span data-ttu-id="503b1-227">Alguns agentes são extensíveis.</span><span class="sxs-lookup"><span data-stu-id="503b1-227">Some agents are extensible.</span></span>
3. <span data-ttu-id="503b1-228">*Contexto e acessar dados de aplicativo toointernal*</span><span class="sxs-lookup"><span data-stu-id="503b1-228">*Access toointernal application data and context*</span></span>
   
   * <span data-ttu-id="503b1-229">subsistema de diagnóstico Olá em execução no processo de aplicativo/serviço Olá facilmente pode aumentar rastreamentos Olá com informações contextuais.</span><span class="sxs-lookup"><span data-stu-id="503b1-229">hello diagnostic subsystem running inside hello application/service process can easily augment hello traces with contextual information.</span></span>
   * <span data-ttu-id="503b1-230">Na abordagem de fora do processo Olá, dados saudação devem ser enviados tooan agent por meio de um mecanismo de comunicação entre processos, como o rastreamento de eventos do Windows.</span><span class="sxs-lookup"><span data-stu-id="503b1-230">In hello out-of-process approach, hello data must be sent tooan agent via some inter-process communication mechanism, such as Event Tracing for Windows.</span></span> <span data-ttu-id="503b1-231">Esse mecanismo pode impor limitações adicionais.</span><span class="sxs-lookup"><span data-stu-id="503b1-231">This mechanism could impose additional limitations.</span></span>

<span data-ttu-id="503b1-232">Vantagens da saudação **rastreamento fora do processo de captura** incluem:</span><span class="sxs-lookup"><span data-stu-id="503b1-232">Advantages of hello **out-of-process trace capturing** include:</span></span>

1. <span data-ttu-id="503b1-233">*Olá capacidade toomonitor Olá aplicativos e coletar despejos de memória*</span><span class="sxs-lookup"><span data-stu-id="503b1-233">*hello ability toomonitor hello application and collect crash dumps*</span></span>
   
   * <span data-ttu-id="503b1-234">Captura de rastreamento em processo pode ser bem-sucedida se o aplicativo hello falha toostart ou falha.</span><span class="sxs-lookup"><span data-stu-id="503b1-234">In-process trace capturing may be unsuccessful if hello application fails toostart or crashes.</span></span> <span data-ttu-id="503b1-235">Um agente independente tem muito mais chances de capturar informações de solução de problemas cruciais.</span><span class="sxs-lookup"><span data-stu-id="503b1-235">An independent agent has a much better chance of capturing crucial troubleshooting information.</span></span><br /><br />
2. <span data-ttu-id="503b1-236">*Maturidade, eficiência e desempenho comprovados*</span><span class="sxs-lookup"><span data-stu-id="503b1-236">*Maturity, robustness, and proven performance*</span></span>
   
   * <span data-ttu-id="503b1-237">Um agente desenvolvido por um fornecedor de plataforma (como um agente de diagnóstico do Microsoft Azure) foi toorigorous assunto de teste e otimização batalha.</span><span class="sxs-lookup"><span data-stu-id="503b1-237">An agent developed by a platform vendor (such as a Microsoft Azure Diagnostics agent) has been subject toorigorous testing and battle-hardening.</span></span>
   * <span data-ttu-id="503b1-238">Com o rastreamento em processo captura, tome cuidado tooensure atividade de saudação do envio de dados de diagnóstico de um processo de aplicativo não interferir com tarefas principal do aplicativo hello ou introduzir problemas de desempenho ou de tempo.</span><span class="sxs-lookup"><span data-stu-id="503b1-238">With in-process trace capturing, care must be taken tooensure that hello activity of sending diagnostic data from an application process does not interfere with hello application's main tasks or introduce timing or performance problems.</span></span> <span data-ttu-id="503b1-239">Um agente de forma independente em execução é diminui a probabilidade de problemas de toothese e é especificamente projetado toolimit seu impacto no sistema de saudação.</span><span class="sxs-lookup"><span data-stu-id="503b1-239">An independently running agent is less prone toothese issues and is specifically designed toolimit its impact on hello system.</span></span>

<span data-ttu-id="503b1-240">É possível toocombine e se beneficiam de ambas as abordagens.</span><span class="sxs-lookup"><span data-stu-id="503b1-240">It is possible toocombine and benefit from both approaches.</span></span> <span data-ttu-id="503b1-241">Na verdade, talvez seja melhor solução Olá para muitos aplicativos.</span><span class="sxs-lookup"><span data-stu-id="503b1-241">Indeed, it might be hello best solution for many applications.</span></span>

<span data-ttu-id="503b1-242">Aqui, podemos usar Olá **Microsoft.Diagnostic.Listeners biblioteca** e Olá em processo rastreamento captura dados toosend de um cluster do Service Fabric application tooan Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="503b1-242">Here, we use hello **Microsoft.Diagnostic.Listeners library** and hello in-process trace capturing toosend data from a Service Fabric application tooan Elasticsearch cluster.</span></span>

## <a name="use-hello-listeners-library-toosend-diagnostic-data-tooelasticsearch"></a><span data-ttu-id="503b1-243">Use Olá ouvintes biblioteca toosend dados de diagnóstico tooElasticsearch</span><span class="sxs-lookup"><span data-stu-id="503b1-243">Use hello Listeners library toosend diagnostic data tooElasticsearch</span></span>
<span data-ttu-id="503b1-244">a biblioteca de Microsoft.Diagnostic.Listeners Olá é parte do aplicativo de serviço de malha de exemplo PartyCluster.</span><span class="sxs-lookup"><span data-stu-id="503b1-244">hello Microsoft.Diagnostic.Listeners library is part of PartyCluster sample Service Fabric application.</span></span> <span data-ttu-id="503b1-245">toouse-lo:</span><span class="sxs-lookup"><span data-stu-id="503b1-245">toouse it:</span></span>

1. <span data-ttu-id="503b1-246">Baixar [exemplo de PartyCluster hello](https://github.com/Azure-Samples/service-fabric-dotnet-management-party-cluster) do GitHub.</span><span class="sxs-lookup"><span data-stu-id="503b1-246">Download [hello PartyCluster sample](https://github.com/Azure-Samples/service-fabric-dotnet-management-party-cluster) from GitHub.</span></span>
2. <span data-ttu-id="503b1-247">Copiar projetos Olá Microsoft.Diagnostics.Listeners e Microsoft.Diagnostics.Listeners.Fabric (pastas inteiros) de saudação PartyCluster exemplo diretório toohello pasta de solução de aplicativo hello que supostamente toosend Olá dados tooElasticsearch .</span><span class="sxs-lookup"><span data-stu-id="503b1-247">Copy hello Microsoft.Diagnostics.Listeners and Microsoft.Diagnostics.Listeners.Fabric projects (whole folders) from hello PartyCluster sample directory toohello solution folder of hello application that is supposed toosend hello data tooElasticsearch.</span></span>
3. <span data-ttu-id="503b1-248">Abrir a solução de destino hello, clique nó solução Olá Olá Gerenciador de soluções e escolha **Adicionar projeto existente**.</span><span class="sxs-lookup"><span data-stu-id="503b1-248">Open hello target solution, right-click hello solution node in hello Solution Explorer, and choose **Add Existing Project**.</span></span> <span data-ttu-id="503b1-249">Adicione Olá Microsoft.Diagnostics.Listeners projeto toohello solução.</span><span class="sxs-lookup"><span data-stu-id="503b1-249">Add hello Microsoft.Diagnostics.Listeners project toohello solution.</span></span> <span data-ttu-id="503b1-250">Repetir hello mesmo para projeto de Microsoft.Diagnostics.Listeners.Fabric hello.</span><span class="sxs-lookup"><span data-stu-id="503b1-250">Repeat hello same for hello Microsoft.Diagnostics.Listeners.Fabric project.</span></span>
4. <span data-ttu-id="503b1-251">Adicione uma referência de projeto de seus projetos toohello dois adicionados projetos de serviço.</span><span class="sxs-lookup"><span data-stu-id="503b1-251">Add a project reference from your service project(s) toohello two added projects.</span></span> <span data-ttu-id="503b1-252">(Cada serviço que supostamente toosend dados tooElasticsearch deve fazer referência Microsoft.Diagnostics.EventListeners e Microsoft.Diagnostics.EventListeners.Fabric).</span><span class="sxs-lookup"><span data-stu-id="503b1-252">(Each service that is supposed toosend data tooElasticsearch should reference Microsoft.Diagnostics.EventListeners and Microsoft.Diagnostics.EventListeners.Fabric).</span></span>
   
    ![Bibliotecas de Microsoft.Diagnostics.EventListeners.Fabric e tooMicrosoft.Diagnostics.EventListeners de referências de projeto][1]

### <a name="service-fabric-general-availability-release-and-microsoftdiagnosticstracing-nuget-package"></a><span data-ttu-id="503b1-254">A versão de Disponibilidade Geral do Service Fabric e o pacote Nuget Microsoft.Diagnostics.Tracing</span><span class="sxs-lookup"><span data-stu-id="503b1-254">Service Fabric General Availability release and Microsoft.Diagnostics.Tracing Nuget package</span></span>
<span data-ttu-id="503b1-255">Os aplicativos criados com a versão de Disponibilidade Geral do Service Fabric (2.0.135, lançada em 31 de março de 2016) são voltados para o **.NET Framework 4.5.2**.</span><span class="sxs-lookup"><span data-stu-id="503b1-255">Applications built with Service Fabric General Availability release (2.0.135, released March 31, 2016) target **.NET Framework 4.5.2**.</span></span> <span data-ttu-id="503b1-256">Esta versão é a versão mais recente de saudação do hello suportada pelo Azure no momento de saudação da versão GA de saudação do .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="503b1-256">This version is hello highest version of hello .NET Framework supported by Azure at hello time of hello GA release.</span></span> <span data-ttu-id="503b1-257">Infelizmente, essa versão do framework de saudação não tem determinadas APIs EventListener que Olá Microsoft.Diagnostics.Listeners precisa de biblioteca.</span><span class="sxs-lookup"><span data-stu-id="503b1-257">Unfortunately, this version of hello framework lacks certain EventListener APIs that hello Microsoft.Diagnostics.Listeners library needs.</span></span> <span data-ttu-id="503b1-258">Como EventSource (componente do hello que constitui a base saudação do log de APIs em aplicativos de malha) e EventListener estreitamente ligado, cada projeto que usa a biblioteca de Microsoft.Diagnostics.Listeners Olá deve usar uma implementação alternativa de EventSource.</span><span class="sxs-lookup"><span data-stu-id="503b1-258">Because EventSource (hello component that forms hello basis of logging APIs in Fabric applications) and EventListener are tightly coupled, every project that uses hello Microsoft.Diagnostics.Listeners library must use an alternative implementation of EventSource.</span></span> <span data-ttu-id="503b1-259">Essa implementação é fornecida pelo Olá **pacote Microsoft.Diagnostics.Tracing Nuget**, criados pela Microsoft.</span><span class="sxs-lookup"><span data-stu-id="503b1-259">This implementation is provided by hello **Microsoft.Diagnostics.Tracing Nuget package**, authored by Microsoft.</span></span> <span data-ttu-id="503b1-260">pacote de saudação é totalmente compatível com EventSource incluído na estrutura de hello, portanto, nenhuma alteração de código deve ser necessária que não sejam as alterações de namespace referenciado.</span><span class="sxs-lookup"><span data-stu-id="503b1-260">hello package is fully backward-compatible with EventSource included in hello framework, so no code changes should be necessary other than referenced namespace changes.</span></span>

<span data-ttu-id="503b1-261">toostart usando Olá Microsoft.Diagnostics.Tracing implementação da classe de EventSource hello, siga estas etapas para cada projeto de serviço que precisa toosend dados tooElasticsearch:</span><span class="sxs-lookup"><span data-stu-id="503b1-261">toostart using hello Microsoft.Diagnostics.Tracing implementation of hello EventSource class, follow these steps for each service project that needs toosend data tooElasticsearch:</span></span>

1. <span data-ttu-id="503b1-262">Clique com botão direito no projeto de serviço hello e escolha **gerenciar pacotes Nuget**.</span><span class="sxs-lookup"><span data-stu-id="503b1-262">Right-click on hello service project and choose **Manage Nuget Packages**.</span></span>
2. <span data-ttu-id="503b1-263">Alternar toohello nuget.org origem do pacote (se não já estiver selecionada) e procure "**Microsoft.Diagnostics.Tracing**".</span><span class="sxs-lookup"><span data-stu-id="503b1-263">Switch toohello nuget.org package source (if it is not already selected) and search for "**Microsoft.Diagnostics.Tracing**".</span></span>
3. <span data-ttu-id="503b1-264">Instalar Olá `Microsoft.Diagnostics.Tracing.EventSource` pacote (e suas dependências).</span><span class="sxs-lookup"><span data-stu-id="503b1-264">Install hello `Microsoft.Diagnostics.Tracing.EventSource` package (and its dependencies).</span></span>
4. <span data-ttu-id="503b1-265">Olá abrir **ServiceEventSource.cs** ou **ActorEventSource.cs** do arquivo em seu projeto de serviço e substitua Olá `using System.Diagnostics.Tracing` diretiva na parte superior do arquivo hello com hello `using Microsoft.Diagnostics.Tracing` diretiva.</span><span class="sxs-lookup"><span data-stu-id="503b1-265">Open hello **ServiceEventSource.cs** or **ActorEventSource.cs** file in your service project and replace hello `using System.Diagnostics.Tracing` directive on top of hello file with hello `using Microsoft.Diagnostics.Tracing` directive.</span></span>

<span data-ttu-id="503b1-266">Essas etapas não será necessárias uma vez Olá **do .NET Framework 4.6** é suportado pelo Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="503b1-266">These steps will not be necessary once hello **.NET Framework 4.6** is supported by Microsoft Azure.</span></span>

### <a name="elasticsearch-listener-instantiation-and-configuration"></a><span data-ttu-id="503b1-267">Configuração e instanciação de ouvinte de Elasticsearch</span><span class="sxs-lookup"><span data-stu-id="503b1-267">Elasticsearch listener instantiation and configuration</span></span>
<span data-ttu-id="503b1-268">Olá etapa final para enviar dados de diagnóstico tooElasticsearch é toocreate uma instância de `ElasticSearchListener` e configurá-lo com dados de conexão Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="503b1-268">hello final step for sending diagnostic data tooElasticsearch is toocreate an instance of `ElasticSearchListener` and configure it with Elasticsearch connection data.</span></span> <span data-ttu-id="503b1-269">ouvinte de saudação captura automaticamente todos os eventos gerados por meio de classes de EventSource definidas no projeto de serviço de saudação.</span><span class="sxs-lookup"><span data-stu-id="503b1-269">hello listener automatically captures all events raised via EventSource classes defined in hello service project.</span></span> <span data-ttu-id="503b1-270">Ele precisa toobe ativo durante o tempo de vida de saudação do serviço hello, então Olá melhor colocar toocreate está no código de inicialização do serviço de saudação.</span><span class="sxs-lookup"><span data-stu-id="503b1-270">It needs toobe alive during hello lifetime of hello service, so hello best place toocreate it is in hello service initialization code.</span></span> <span data-ttu-id="503b1-271">Aqui está como código de inicialização de saudação para um serviço sem monitoração de estado pode parecer após as alterações necessárias hello (adições indicadas em comentários, começando com `****`):</span><span class="sxs-lookup"><span data-stu-id="503b1-271">Here is how hello initialization code for a stateless service could look after hello necessary changes (additions pointed out in comments starting with `****`):</span></span>

```csharp
using System;
using System.Diagnostics;
using System.Fabric;
using System.Threading;
using System.Threading.Tasks;
using Microsoft.ServiceFabric.Services.Runtime;

// **** Add hello following directives
using Microsoft.Diagnostics.EventListeners;
using Microsoft.Diagnostics.EventListeners.Fabric;

namespace Stateless1
{
    internal static class Program
    {
        /// <summary>
        /// This is hello entry point of hello service host process.
        /// </summary>        
        private static void Main()
        {
            try
            {
                // **** Instantiate ElasticSearchListener
                var configProvider = new FabricConfigurationProvider("ElasticSearchEventListener");
                ElasticSearchListener esListener = null;
                if (configProvider.HasConfiguration)
                {
                    esListener = new ElasticSearchListener(configProvider, new FabricHealthReporter("ElasticSearchEventListener"));
                }

                // hello ServiceManifest.XML file defines one or more service type names.
                // Registering a service maps a service type name tooa .NET type.
                // When Service Fabric creates an instance of this service type,
                // an instance of hello class is created in this host process.

                ServiceRuntime.RegisterServiceAsync("Stateless1Type", 
                    context => new Stateless1(context)).GetAwaiter().GetResult();

                ServiceEventSource.Current.ServiceTypeRegistered(Process.GetCurrentProcess().Id, typeof(Stateless1).Name);

                // Prevents this host process from terminating so services keep running.
                Thread.Sleep(Timeout.Infinite);

                // **** Ensure that hello ElasticSearchListner instance is not garbage-collected prematurely
                GC.KeepAlive(esListener);
            }
            catch (Exception e)
            {
                ServiceEventSource.Current.ServiceHostInitializationFailed(e);
                throw;
            }
        }
    }
}
```

<span data-ttu-id="503b1-272">Dados de conexão Elasticsearch devem ser colocados em uma seção separada no arquivo de configuração do serviço de saudação (**PackageRoot\Config\Settings.xml**).</span><span class="sxs-lookup"><span data-stu-id="503b1-272">Elasticsearch connection data should be put in a separate section in hello service configuration file (**PackageRoot\Config\Settings.xml**).</span></span> <span data-ttu-id="503b1-273">nome de saudação da seção de saudação deve corresponder toohello valor passado toohello `FabricConfigurationProvider` construtor, por exemplo:</span><span class="sxs-lookup"><span data-stu-id="503b1-273">hello name of hello section must correspond toohello value passed toohello `FabricConfigurationProvider` constructor, for example:</span></span>

```xml
<Section Name="ElasticSearchEventListener">
  <Parameter Name="serviceUri" Value="http://myBigCluster.westus.cloudapp.azure.com/es/" />
  <Parameter Name="userName" Value="(ES user name)" />
  <Parameter Name="password" Value="(ES user password)" />
  <Parameter Name="indexNamePrefix" Value="myapp" />
</Section>
```
<span data-ttu-id="503b1-274">Olá valores de `serviceUri`, `userName` e `password` parâmetros correspondem endereço de ponto de extremidade de cluster toohello Elasticsearch Elasticsearch nome de usuário e senha, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="503b1-274">hello values of `serviceUri`, `userName` and `password` parameters correspond toohello Elasticsearch cluster endpoint address, Elasticsearch user name, and password, respectively.</span></span> <span data-ttu-id="503b1-275">`indexNamePrefix`é o prefixo Olá para índices de Elasticsearch; biblioteca de Microsoft.Diagnostics.Listeners Olá cria um novo índice para seus dados diariamente.</span><span class="sxs-lookup"><span data-stu-id="503b1-275">`indexNamePrefix` is hello prefix for Elasticsearch indexes; hello Microsoft.Diagnostics.Listeners library creates a new index for its data daily.</span></span>

### <a name="verification"></a><span data-ttu-id="503b1-276">Verificação</span><span class="sxs-lookup"><span data-stu-id="503b1-276">Verification</span></span>
<span data-ttu-id="503b1-277">É isso!</span><span class="sxs-lookup"><span data-stu-id="503b1-277">That's it!</span></span> <span data-ttu-id="503b1-278">Agora, sempre que o serviço de saudação é executado, ele começa a enviar o serviço de Elasticsearch toohello rastreamentos especificado na configuração de saudação.</span><span class="sxs-lookup"><span data-stu-id="503b1-278">Now, whenever hello service is run, it starts sending traces toohello Elasticsearch service specified in hello configuration.</span></span> <span data-ttu-id="503b1-279">Você pode verificar isso Olá abertura que kibana UI associado com a instância do hello destino Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="503b1-279">You can verify this by opening hello Kibana UI associated with hello target Elasticsearch instance.</span></span> <span data-ttu-id="503b1-280">Em nosso exemplo, o endereço da página Olá é http://myBigCluster.westus.cloudapp.azure.com/.</span><span class="sxs-lookup"><span data-stu-id="503b1-280">In our example, hello page address is http://myBigCluster.westus.cloudapp.azure.com/.</span></span> <span data-ttu-id="503b1-281">Verifique se os índices com prefixo de nome de saudação escolhido para hello `ElasticSearchListener` instância realmente foram criados e preenchidos com dados.</span><span class="sxs-lookup"><span data-stu-id="503b1-281">Check that indexes with hello name prefix chosen for hello `ElasticSearchListener` instance have indeed been created and populated with data.</span></span>

![Kibana mostrando os eventos do aplicativo PartyCluster][2]

## <a name="next-steps"></a><span data-ttu-id="503b1-283">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="503b1-283">Next steps</span></span>
* [<span data-ttu-id="503b1-284">Saiba mais sobre o diagnóstico e monitoramento de um serviço da Malha de Serviço</span><span class="sxs-lookup"><span data-stu-id="503b1-284">Learn more about diagnosing and monitoring a Service Fabric service</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)

<!--Image references-->
[1]: ./media/service-fabric-diagnostics-how-to-use-elasticsearch/listener-lib-references.png
[2]: ./media/service-fabric-diagnostics-how-to-use-elasticsearch/kibana.png
