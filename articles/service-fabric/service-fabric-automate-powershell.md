---
title: Automatizar o gerenciamento de aplicativos do Azure Service Fabric | Microsoft Docs
description: Implantar, atualizar, testar e remover aplicativos do Service Fabric usando o PowerShell.
services: service-fabric
documentationcenter: .net
author: rwike77
manager: timlt
editor: 
ms.assetid: f03f4294-571d-4262-8a77-cc8b481b959d
ms.service: service-fabric
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: dotnet
ms.topic: article
ms.date: 06/16/2017
ms.author: ryanwi
redirect_url: /azure/service-fabric/service-fabric-deploy-remove-applications
ms.openlocfilehash: fb3c2a77ea887289eebf343e223c190781d0e4c2
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="automate-the-application-lifecycle-using-powershell"></a><span data-ttu-id="20bd0-103">Automatizar o ciclo de vida do aplicativo usando o PowerShell</span><span class="sxs-lookup"><span data-stu-id="20bd0-103">Automate the application lifecycle using PowerShell</span></span>
<span data-ttu-id="20bd0-104">Muitos aspectos do [ciclo de vida de um aplicativo do Service Fabric](service-fabric-application-lifecycle.md) podem ser automatizados.</span><span class="sxs-lookup"><span data-stu-id="20bd0-104">Many aspects of the [Service Fabric application lifecycle](service-fabric-application-lifecycle.md) can be automated.</span></span>  <span data-ttu-id="20bd0-105">Este artigo mostra como usar o PowerShell para automatizar tarefas comuns de implantação, atualização, remoção e teste de aplicativos do Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="20bd0-105">This article shows how to use PowerShell to automate common tasks for deploying, upgrading, removing, and testing Azure Service Fabric applications.</span></span>  <span data-ttu-id="20bd0-106">APIs gerenciadas e HTTP para gerenciamento de aplicativos também estão disponíveis.</span><span class="sxs-lookup"><span data-stu-id="20bd0-106">Managed and HTTP APIs for app management are also available.</span></span> <span data-ttu-id="20bd0-107">Consulte [ciclo de vida do aplicativo](service-fabric-application-lifecycle.md) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="20bd0-107">See [app lifecycle](service-fabric-application-lifecycle.md) for more information.</span></span>  

## <a name="prerequisites"></a><span data-ttu-id="20bd0-108">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="20bd0-108">Prerequisites</span></span>
<span data-ttu-id="20bd0-109">Antes de passar para as tarefas deste artigo, não deixe de:</span><span class="sxs-lookup"><span data-stu-id="20bd0-109">Before you move on to the tasks in the article, be sure to:</span></span>

* <span data-ttu-id="20bd0-110">Familiarizar-se com os conceitos do Service Fabric descritos em [Visão geral técnica do Service Fabric](service-fabric-technical-overview.md).</span><span class="sxs-lookup"><span data-stu-id="20bd0-110">Get familiar with the Service Fabric concepts described in [Technical overview of Service Fabric](service-fabric-technical-overview.md).</span></span>
* <span data-ttu-id="20bd0-111">[Instalar as ferramentas, o SDK e o tempo de execução](service-fabric-get-started.md), o que também instala o módulo **ServiceFabric** do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="20bd0-111">[Install the runtime, SDK, and tools](service-fabric-get-started.md), which also installs the **ServiceFabric** PowerShell module.</span></span>
* <span data-ttu-id="20bd0-112">[Habilitar a execução de script do PowerShell](service-fabric-get-started.md#enable-powershell-script-execution).</span><span class="sxs-lookup"><span data-stu-id="20bd0-112">[Enable PowerShell script execution](service-fabric-get-started.md#enable-powershell-script-execution).</span></span>
* <span data-ttu-id="20bd0-113">Iniciar um cluster local.</span><span class="sxs-lookup"><span data-stu-id="20bd0-113">Start a local cluster.</span></span>  <span data-ttu-id="20bd0-114">Inicie uma nova janela do PowerShell como administrador e execute o script de instalação de cluster na pasta do SDK: `& "$ENV:ProgramFiles\Microsoft SDKs\Service Fabric\ClusterSetup\DevClusterSetup.ps1"`</span><span class="sxs-lookup"><span data-stu-id="20bd0-114">Launch a new PowerShell window as an administrator and then run the cluster setup script from the SDK folder: `& "$ENV:ProgramFiles\Microsoft SDKs\Service Fabric\ClusterSetup\DevClusterSetup.ps1"`</span></span>
* <span data-ttu-id="20bd0-115">Antes de executar qualquer comando do PowerShell deste artigo, primeiro conecte-se ao cluster local do Service Fabric usando [Connect-ServiceFabricCluster](/powershell/module/servicefabric/connect-servicefabriccluster?view=azureservicefabricps): `Connect-ServiceFabricCluster localhost:19000`</span><span class="sxs-lookup"><span data-stu-id="20bd0-115">Before you run any PowerShell commands in this article, first connect to the local Service Fabric cluster by using [Connect-ServiceFabricCluster](/powershell/module/servicefabric/connect-servicefabriccluster?view=azureservicefabricps): `Connect-ServiceFabricCluster localhost:19000`</span></span>
* <span data-ttu-id="20bd0-116">As tarefas a seguir exigem um pacote de aplicativos v1 para implantar e um pacote de aplicativos v2 para atualizar.</span><span class="sxs-lookup"><span data-stu-id="20bd0-116">The following tasks require a v1 application package to deploy and a v2 application package for upgrade.</span></span> <span data-ttu-id="20bd0-117">Baixe o [aplicativo de exemplo **WordCount**](http://aka.ms/servicefabricsamples) (localizado nas amostras da Introdução).</span><span class="sxs-lookup"><span data-stu-id="20bd0-117">Download the [**WordCount** sample application](http://aka.ms/servicefabricsamples) (located in the Getting Started samples).</span></span> <span data-ttu-id="20bd0-118">Compile e empacote o aplicativo no Visual Studio (clique com o botão direito do mouse em **WordCount** no Gerenciador de Soluções e selecione **Pacote**).</span><span class="sxs-lookup"><span data-stu-id="20bd0-118">Build and package the application in Visual Studio (right-click on **WordCount** in Solution Explorer and select **Package**).</span></span> <span data-ttu-id="20bd0-119">Copie o pacote v1 em `C:\ServiceFabricSamples\Services\WordCount\WordCount\pkg\Debug` para `C:\Temp\WordCount`.</span><span class="sxs-lookup"><span data-stu-id="20bd0-119">Copy the v1 package in `C:\ServiceFabricSamples\Services\WordCount\WordCount\pkg\Debug` to `C:\Temp\WordCount`.</span></span> <span data-ttu-id="20bd0-120">Copie `C:\Temp\WordCount` para `C:\Temp\WordCountV2`, criando o pacote de aplicativos v2 para a atualização.</span><span class="sxs-lookup"><span data-stu-id="20bd0-120">Copy `C:\Temp\WordCount` to `C:\Temp\WordCountV2`, creating the v2 application package for upgrade.</span></span> <span data-ttu-id="20bd0-121">Abra `C:\Temp\WordCountV2\ApplicationManifest.xml` em um editor de texto.</span><span class="sxs-lookup"><span data-stu-id="20bd0-121">Open `C:\Temp\WordCountV2\ApplicationManifest.xml` in a text editor.</span></span> <span data-ttu-id="20bd0-122">No elemento **ApplicationManifest**, altere o atributo **ApplicationTypeVersion** de "1.0.0" para "2.0.0" para atualizar o número de versão do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="20bd0-122">In the **ApplicationManifest** element, change the **ApplicationTypeVersion** attribute from "1.0.0" to "2.0.0" to update the app version number.</span></span> <span data-ttu-id="20bd0-123">Salve o arquivo ApplicationManifest.xml alterado.</span><span class="sxs-lookup"><span data-stu-id="20bd0-123">Save the changed ApplicationManifest.xml file.</span></span>

## <a name="task-deploy-a-service-fabric-application"></a><span data-ttu-id="20bd0-124">Tarefa: Implantar um aplicativo do Service Fabric</span><span class="sxs-lookup"><span data-stu-id="20bd0-124">Task: Deploy a Service Fabric application</span></span>
<span data-ttu-id="20bd0-125">Depois de compilar e empacotar o aplicativo (ou baixar o pacote de aplicativos), você poderá implantar o aplicativo em um cluster local do Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="20bd0-125">After you've built and packaged the application (or downloaded the application package), you can deploy the application into a local Service Fabric cluster.</span></span> <span data-ttu-id="20bd0-126">A implantação envolve o carregamento do pacote de aplicativos, o registro do tipo de aplicativo e a criação da instância do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="20bd0-126">Deployment involves uploading the application package, registering the application type, and creating the application instance.</span></span> <span data-ttu-id="20bd0-127">Use as instruções desta seção para implantar um novo aplicativo em um cluster.</span><span class="sxs-lookup"><span data-stu-id="20bd0-127">Use the instructions in this section to deploy a new application to a cluster.</span></span>

### <a name="step-1-upload-the-application-package"></a><span data-ttu-id="20bd0-128">Etapa 1: Carregar o pacote do aplicativo</span><span class="sxs-lookup"><span data-stu-id="20bd0-128">Step 1: Upload the application package</span></span>
<span data-ttu-id="20bd0-129">O carregamento do pacote de aplicativos no repositório de imagens coloca-o em um local acessível por componentes internos do Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="20bd0-129">Uploading the application package to the image store puts it in a location accessible to internal Service Fabric components.</span></span>  <span data-ttu-id="20bd0-130">O pacote de aplicativos contém o manifesto de aplicativo, os manifestos de serviço e os pacotes de dados, configuração e código necessários para criar as instâncias do aplicativo e do serviço.</span><span class="sxs-lookup"><span data-stu-id="20bd0-130">The application package contains the necessary application manifest, service manifests, and code, configuration, and data package(s) to create the application and service instances.</span></span> <span data-ttu-id="20bd0-131">Se quiser verificar o pacote do aplicativo localmente, use o cmdlet [Test-ServiceFabricApplicationPackage](/powershell/servicefabric/vlatest/test-servicefabricapplicationpackage).</span><span class="sxs-lookup"><span data-stu-id="20bd0-131">If you want to verify the app package locally, use the [Test-ServiceFabricApplicationPackage](/powershell/servicefabric/vlatest/test-servicefabricapplicationpackage) cmdlet.</span></span>  <span data-ttu-id="20bd0-132">O comando [Copy-ServiceFabricApplicationPackage](/powershell/module/servicefabric/copy-servicefabricapplicationpackage?view=azureservicefabricps) carrega o pacote.</span><span class="sxs-lookup"><span data-stu-id="20bd0-132">The [Copy-ServiceFabricApplicationPackage](/powershell/module/servicefabric/copy-servicefabricapplicationpackage?view=azureservicefabricps) command uploads the package.</span></span> <span data-ttu-id="20bd0-133">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="20bd0-133">For example:</span></span>

```powershell
Copy-ServiceFabricApplicationPackage C:\Temp\WordCount\ -ImageStoreConnectionString file:C:\SfDevCluster\Data\ImageStoreShare -ApplicationPackagePathInImageStore WordCount
```

### <a name="step-2-register-the-application-type"></a><span data-ttu-id="20bd0-134">Etapa 2: Registrar o tipo de aplicativo</span><span class="sxs-lookup"><span data-stu-id="20bd0-134">Step 2: Register the application type</span></span>
<span data-ttu-id="20bd0-135">O registro do pacote de aplicativos disponibiliza para uso o tipo de aplicativo e a versão declarada no manifesto do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="20bd0-135">Registering the application package makes the application type and version declared in the application manifest available for use.</span></span> <span data-ttu-id="20bd0-136">O sistema lê o pacote carregado na etapa 1, verifica o pacote (equivalente a executar [Test-ServiceFabricApplicationPackage](/powershell/servicefabric/vlatest/test-servicefabricapplicationpackage) localmente), processa o conteúdo do pacote e copia o pacote processado para uma localização interna do sistema.</span><span class="sxs-lookup"><span data-stu-id="20bd0-136">The system reads the package uploaded in the step 1, verify the package (equivalent to running [Test-ServiceFabricApplicationPackage](/powershell/servicefabric/vlatest/test-servicefabricapplicationpackage) locally), process the package contents, and copy the processed package to an internal system location.</span></span>  <span data-ttu-id="20bd0-137">Execute o cmdlet [Register-ServiceFabricApplicationType](/powershell/module/servicefabric/register-servicefabricapplicationtype?view=azureservicefabricps):</span><span class="sxs-lookup"><span data-stu-id="20bd0-137">Run the [Register-ServiceFabricApplicationType](/powershell/module/servicefabric/register-servicefabricapplicationtype?view=azureservicefabricps) cmdlet:</span></span>

```powershell
Register-ServiceFabricApplicationType WordCount
```
<span data-ttu-id="20bd0-138">Para ver todos os tipos de aplicativo registrados no cluster, execute o cmdlet [Get-ServiceFabricApplicationType](/powershell/module/servicefabric/get-servicefabricapplicationtype?view=azureservicefabricps):</span><span class="sxs-lookup"><span data-stu-id="20bd0-138">To see all the application types registered in the cluster, run the [Get-ServiceFabricApplicationType](/powershell/module/servicefabric/get-servicefabricapplicationtype?view=azureservicefabricps) cmdlet:</span></span>

```powershell
Get-ServiceFabricApplicationType
```

### <a name="step-3-create-the-application-instance"></a><span data-ttu-id="20bd0-139">Etapa 3: Criar a instância do aplicativo</span><span class="sxs-lookup"><span data-stu-id="20bd0-139">Step 3: Create the application instance</span></span>
<span data-ttu-id="20bd0-140">Um aplicativo pode ser instanciado usando qualquer versão do tipo de aplicativo registrada com êxito usando o comando [New-ServiceFabricApplication](/powershell/module/servicefabric/new-servicefabricapplication?view=azureservicefabricps).</span><span class="sxs-lookup"><span data-stu-id="20bd0-140">An application can be instantiated by using any application type version that has been registered successfully by using the [New-ServiceFabricApplication](/powershell/module/servicefabric/new-servicefabricapplication?view=azureservicefabricps) command.</span></span> <span data-ttu-id="20bd0-141">O nome de cada aplicativo é declarado no momento da implantação e deve começar com o esquema **fabric** : e ser exclusivo para cada instância do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="20bd0-141">The name of each application is declared at deploy time and must start with the **fabric:** scheme and be unique for each application instance.</span></span> <span data-ttu-id="20bd0-142">O nome do tipo de aplicativo e a versão do tipo de aplicativo são declarados no arquivo **ApplicationManifest.xml** do pacote de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="20bd0-142">The application type name and application type version are declared in the **ApplicationManifest.xml** file of the application package.</span></span> <span data-ttu-id="20bd0-143">Se algum serviço padrão tiver sido definido no manifesto do aplicativo do tipo de aplicativo de destino, ele também será criado nesse momento.</span><span class="sxs-lookup"><span data-stu-id="20bd0-143">If any default services were defined in the application manifest of the target application type, then those are created at this time.</span></span>

```powershell
New-ServiceFabricApplication fabric:/WordCount WordCount 1.0.0
```

<span data-ttu-id="20bd0-144">O comando [Get-ServiceFabricApplication](/powershell/servicefabric/vlatest/get-servicefabricapplication) lista todas as instâncias de aplicativos criadas com êxito juntamente com seu status geral.</span><span class="sxs-lookup"><span data-stu-id="20bd0-144">The [Get-ServiceFabricApplication](/powershell/servicefabric/vlatest/get-servicefabricapplication) command lists all application instances that were successfully created, along with their overall status.</span></span> <span data-ttu-id="20bd0-145">O comando [Get-ServiceFabricService](/powershell/module/servicefabric/get-servicefabricservice?view=azureservicefabricps) lista todas as instâncias de serviço criadas com êxito em uma determinada instância de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="20bd0-145">The [Get-ServiceFabricService](/powershell/module/servicefabric/get-servicefabricservice?view=azureservicefabricps) command lists all of the service instances that were successfully created within a given application instance.</span></span> <span data-ttu-id="20bd0-146">Os serviços padrão (se houver) são listados.</span><span class="sxs-lookup"><span data-stu-id="20bd0-146">Default services (if any) are listed.</span></span>

```powershell
Get-ServiceFabricApplication

Get-ServiceFabricApplication | Get-ServiceFabricService
```

## <a name="task-upgrade-a-service-fabric-application"></a><span data-ttu-id="20bd0-147">Tarefa: Atualizar um aplicativo do Service Fabric</span><span class="sxs-lookup"><span data-stu-id="20bd0-147">Task: Upgrade a Service Fabric application</span></span>
<span data-ttu-id="20bd0-148">Você pode atualizar um aplicativo do Service Fabric implantado anteriormente com um pacote de aplicativos atualizado.</span><span class="sxs-lookup"><span data-stu-id="20bd0-148">You can upgrade a previously deployed Service Fabric application with an updated application package.</span></span> <span data-ttu-id="20bd0-149">Essa tarefa atualiza o aplicativo WordCount implantado na “Tarefa: implantar um aplicativo do Service Fabric.”</span><span class="sxs-lookup"><span data-stu-id="20bd0-149">This task upgrades the WordCount application that was deployed in "Task: Deploy a Service Fabric application."</span></span> <span data-ttu-id="20bd0-150">Leia [Atualização de aplicativos do Service Fabric](service-fabric-application-upgrade.md) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="20bd0-150">Read through [Service Fabric application upgrade](service-fabric-application-upgrade.md) for more information.</span></span>

<span data-ttu-id="20bd0-151">Para manter as coisas simples neste exemplo, somente o número de versão do aplicativo foi atualizado no pacote de aplicativos WordCountV2 criado nos pré-requisitos.</span><span class="sxs-lookup"><span data-stu-id="20bd0-151">To keep things simple for this example, only the application version number was updated in the WordCountV2 application package created in the prerequisites.</span></span> <span data-ttu-id="20bd0-152">Um cenário mais realista envolveria a atualização de seus arquivos de código, configuração ou dados de serviço e a recriação e empacotamento do aplicativo com números de versão atualizados.</span><span class="sxs-lookup"><span data-stu-id="20bd0-152">A more realistic scenario would involve updating your service code, configuration, or data files and then rebuilding and packaging the application with updated version numbers.</span></span>  

### <a name="step-1-upload-the-updated-application-package"></a><span data-ttu-id="20bd0-153">Etapa 1: carregar o pacote de aplicativos</span><span class="sxs-lookup"><span data-stu-id="20bd0-153">Step 1: Upload the updated application package</span></span>
<span data-ttu-id="20bd0-154">O aplicativo v1 WordCount está pronto para ser atualizado.</span><span class="sxs-lookup"><span data-stu-id="20bd0-154">The WordCount v1 application is ready to be upgraded.</span></span> <span data-ttu-id="20bd0-155">Se você abrir uma janela do PowerShell como administrador e digitar [**Get-ServiceFabricApplication**](/powershell/module/servicefabric/get-servicefabricapplication?view=azureservicefabricps), verá que a versão 1.0.0 do tipo de aplicativo WordCount foi implantada.</span><span class="sxs-lookup"><span data-stu-id="20bd0-155">If you open up a PowerShell window as administrator and type [**Get-ServiceFabricApplication**](/powershell/module/servicefabric/get-servicefabricapplication?view=azureservicefabricps), you see that version 1.0.0 of the WordCount application type is deployed.</span></span>  

<span data-ttu-id="20bd0-156">Agora, copie o pacote de aplicativos atualizado para o repositório de imagens do Service Fabric (onde os pacotes de aplicativo são armazenados pelo Service Fabric).</span><span class="sxs-lookup"><span data-stu-id="20bd0-156">Now copy the updated application package to the Service Fabric image store (where the application packages are stored by Service Fabric).</span></span> <span data-ttu-id="20bd0-157">O parâmetro **ApplicationPackagePathInImageStore** informa à Malha de serviço onde ela pode encontrar o pacote do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="20bd0-157">The parameter **ApplicationPackagePathInImageStore** informs Service Fabric where it can find the application package.</span></span> <span data-ttu-id="20bd0-158">O comando a seguir copia o pacote de aplicativos para **WordCountV2** no repositório de imagens:</span><span class="sxs-lookup"><span data-stu-id="20bd0-158">The following command copies the application package to **WordCountV2** in the image store:</span></span>  

```powershell
Copy-ServiceFabricApplicationPackage C:\Temp\WordCountV2\ -ImageStoreConnectionString file:C:\SfDevCluster\Data\ImageStoreShare -ApplicationPackagePathInImageStore WordCountV2

```
### <a name="step-2-register-the-updated-application-type"></a><span data-ttu-id="20bd0-159">Etapa 2: registrar o tipo de aplicativo atualizado</span><span class="sxs-lookup"><span data-stu-id="20bd0-159">Step 2: Register the updated application type</span></span>
<span data-ttu-id="20bd0-160">A próxima etapa será registrar a nova versão do aplicativo no Service Fabric, o que pode ser feito usando o cmdlet [Register-ServiceFabricApplicationType](/powershell/module/servicefabric/register-servicefabricapplicationtype?view=azureservicefabricps):</span><span class="sxs-lookup"><span data-stu-id="20bd0-160">The next step is to register the new version of the application with Service Fabric, which can be performed by using the [Register-ServiceFabricApplicationType](/powershell/module/servicefabric/register-servicefabricapplicationtype?view=azureservicefabricps) cmdlet:</span></span>

```powershell
Register-ServiceFabricApplicationType WordCountV2
```

### <a name="step-3-start-the-upgrade"></a><span data-ttu-id="20bd0-161">Etapa 3: Iniciar a atualização</span><span class="sxs-lookup"><span data-stu-id="20bd0-161">Step 3: Start the upgrade</span></span>
<span data-ttu-id="20bd0-162">É possível aplicar vários parâmetros de atualização, tempo limite e critérios de integridade para atualizações de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="20bd0-162">Various upgrade parameters, timeouts, and health criteria can be applied to application upgrades.</span></span> <span data-ttu-id="20bd0-163">Leia os documentos [parâmetros de atualização de aplicativo](service-fabric-application-upgrade-parameters.md) e [processo de atualização](service-fabric-application-upgrade.md) para saber mais.</span><span class="sxs-lookup"><span data-stu-id="20bd0-163">Read through the [application upgrade parameters](service-fabric-application-upgrade-parameters.md) and [upgrade process](service-fabric-application-upgrade.md) documents to learn more.</span></span> <span data-ttu-id="20bd0-164">Todos os serviços e instâncias deverão estar *íntegros* após a atualização.</span><span class="sxs-lookup"><span data-stu-id="20bd0-164">All services and instances should be *healthy* after the upgrade.</span></span>  <span data-ttu-id="20bd0-165">Defina **HealthCheckStableDuration** como 60 segundos (de modo que os serviços fiquem íntegros por pelo menos 20 segundos antes que a atualização prossiga para o domínio de atualização seguinte).</span><span class="sxs-lookup"><span data-stu-id="20bd0-165">Set the **HealthCheckStableDuration** to 60 seconds (so that the services are healthy for at least 20 seconds before the upgrade proceeds to the next upgrade domain).</span></span>  <span data-ttu-id="20bd0-166">Defina também **UpgradeDomainTimeout** como 1.200 segundos e **UpgradeTimeout** como 3.000 segundos.</span><span class="sxs-lookup"><span data-stu-id="20bd0-166">Also set the **UpgradeDomainTimeout** to 1200 seconds and the **UpgradeTimeout** to 3000 seconds.</span></span> <span data-ttu-id="20bd0-167">Por fim, defina **UpgradeFailureAction** para **reversão**, o que solicita ao Service Fabric a reversão do aplicativo para a versão anterior caso ocorram falhas durante a atualização.</span><span class="sxs-lookup"><span data-stu-id="20bd0-167">Finally, set the **UpgradeFailureAction** to **rollback**, which requests that Service Fabric rolls back the application to the previous version if failures are encountered during upgrade.</span></span>

<span data-ttu-id="20bd0-168">Agora você pode iniciar a atualização do aplicativo usando o cmdlet [Start-ServiceFabricApplicationUpgrade](/powershell/module/servicefabric/start-servicefabricapplicationupgrade?view=azureservicefabricps):</span><span class="sxs-lookup"><span data-stu-id="20bd0-168">You can now start the application upgrade by using the [Start-ServiceFabricApplicationUpgrade](/powershell/module/servicefabric/start-servicefabricapplicationupgrade?view=azureservicefabricps) cmdlet:</span></span>

```powershell
Start-ServiceFabricApplicationUpgrade -ApplicationName fabric:/WordCount -ApplicationTypeVersion 2.0.0 -HealthCheckStableDurationSec 60 -UpgradeDomainTimeoutSec 1200 -UpgradeTimeout 3000  -FailureAction Rollback -Monitored
```

<span data-ttu-id="20bd0-169">Observe que o nome do aplicativo é igual ao do aplicativo v1.0.0 implantado anteriormente (fabric:/WordCount).</span><span class="sxs-lookup"><span data-stu-id="20bd0-169">Note that the application name is the same as the previously deployed v1.0.0 application name (fabric:/WordCount).</span></span> <span data-ttu-id="20bd0-170">A Malha de serviços usa esse nome para identificar qual aplicativo está sendo atualizado.</span><span class="sxs-lookup"><span data-stu-id="20bd0-170">Service Fabric uses this name to identify which application is getting upgraded.</span></span> <span data-ttu-id="20bd0-171">Se você definir um tempo limite muito curto, poderá receber uma mensagem de erro de tempo limite informando o problema.</span><span class="sxs-lookup"><span data-stu-id="20bd0-171">If you set the time-outs to be too short, you might encounter a time-out failure message that states the problem.</span></span> <span data-ttu-id="20bd0-172">Consulte [Solucionar problemas de atualizações de aplicativo](service-fabric-application-upgrade-troubleshooting.md)ou aumente o tempo limite.</span><span class="sxs-lookup"><span data-stu-id="20bd0-172">Refer to [Troubleshoot application upgrades](service-fabric-application-upgrade-troubleshooting.md), or increase the time-outs.</span></span>

### <a name="step-4-check-upgrade-progress"></a><span data-ttu-id="20bd0-173">Etapa 4: verificar o andamento da atualização</span><span class="sxs-lookup"><span data-stu-id="20bd0-173">Step 4: Check upgrade progress</span></span>
<span data-ttu-id="20bd0-174">Você pode monitorar o progresso da atualização do aplicativo usando o [Service Fabric Explorer](service-fabric-visualizing-your-cluster.md) ou o cmdlet [Get-ServiceFabricApplicationUpgrade](/powershell/module/servicefabric/get-servicefabricapplicationupgrade?view=azureservicefabricps):</span><span class="sxs-lookup"><span data-stu-id="20bd0-174">You can monitor application upgrade progress by using [Service Fabric Explorer](service-fabric-visualizing-your-cluster.md), or by using the [Get-ServiceFabricApplicationUpgrade](/powershell/module/servicefabric/get-servicefabricapplicationupgrade?view=azureservicefabricps) cmdlet:</span></span>

```powershell
Get-ServiceFabricApplicationUpgrade fabric:/WordCount
```

<span data-ttu-id="20bd0-175">Depois de alguns minutos, o cmdlet [Get-ServiceFabricApplicationUpgrade](/powershell/module/servicefabric/get-servicefabricapplicationupgrade?view=azureservicefabricps) mostrará que todos os domínios de atualização foram atualizados (concluídos).</span><span class="sxs-lookup"><span data-stu-id="20bd0-175">In a few minutes, the [Get-ServiceFabricApplicationUpgrade](/powershell/module/servicefabric/get-servicefabricapplicationupgrade?view=azureservicefabricps) cmdlet shows that all upgrade domains were upgraded (completed).</span></span>

## <a name="task-test-a-service-fabric-application"></a><span data-ttu-id="20bd0-176">Tarefa: testar um aplicativo do Service Fabric</span><span class="sxs-lookup"><span data-stu-id="20bd0-176">Task: Test a Service Fabric application</span></span>
<span data-ttu-id="20bd0-177">Para escrever serviços de alta qualidade, os desenvolvedores precisam ser capazes de induzir falhas de infraestrutura não confiável a fim de testar a estabilidade de seus serviços.</span><span class="sxs-lookup"><span data-stu-id="20bd0-177">To write high-quality services, developers need to be able to induce unreliable infrastructure faults to test the stability of their services.</span></span> <span data-ttu-id="20bd0-178">O Service Fabric fornece aos desenvolvedores a capacidade de induzir ações de falha e testar os serviços na presença de falhas usando cenários de teste de caos e de failover.</span><span class="sxs-lookup"><span data-stu-id="20bd0-178">Service Fabric gives developers the ability to induce fault actions and test services in the presence of failures by using the chaos and failover test scenarios.</span></span>  <span data-ttu-id="20bd0-179">Leia a [Introduction to the Fault Analysis Service (Introdução ao Fault Analysis Service)](service-fabric-testability-overview.md) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="20bd0-179">Read through [Introduction to the Fault Analysis Service](service-fabric-testability-overview.md) for additional information.</span></span>

### <a name="step-1-run-the-chaos-test-scenario"></a><span data-ttu-id="20bd0-180">Etapa 1: Executar o cenário de teste de caos</span><span class="sxs-lookup"><span data-stu-id="20bd0-180">Step 1: Run the chaos test scenario</span></span>
<span data-ttu-id="20bd0-181">O cenário de teste de caos gera falhas no cluster de todo o Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="20bd0-181">The chaos test scenario generates faults across the entire Service Fabric cluster.</span></span> <span data-ttu-id="20bd0-182">O cenário compacta falhas geralmente vistas em meses ou em anos em apenas algumas horas.</span><span class="sxs-lookup"><span data-stu-id="20bd0-182">The scenario compresses faults generally seen over months or years to a few hours.</span></span> <span data-ttu-id="20bd0-183">A combinação de falhas intercaladas com a alta taxa de falhas localiza casos específicos que de outra forma seriam ignorados.</span><span class="sxs-lookup"><span data-stu-id="20bd0-183">The combination of interleaved faults with a high fault rate finds corner cases that would otherwise be missed.</span></span> <span data-ttu-id="20bd0-184">O exemplo a seguir executa o cenário de teste de caos por 60 minutos.</span><span class="sxs-lookup"><span data-stu-id="20bd0-184">The following example runs the chaos test scenario for 60 minutes.</span></span>

```powershell
$timeToRun = 60
$maxStabilizationTimeSecs = 180
$concurrentFaults = 3
$waitTimeBetweenIterationsSec = 60

Invoke-ServiceFabricChaosTestScenario -TimeToRunMinute $timeToRun -MaxClusterStabilizationTimeoutSec $maxStabilizationTimeSecs -MaxConcurrentFaults $concurrentFaults -EnableMoveReplicaFaults -WaitTimeBetweenIterationsSec $waitTimeBetweenIterationsSec
```

### <a name="step-2-run-the-failover-test-scenario"></a><span data-ttu-id="20bd0-185">Etapa 2: Executar o cenário de teste de failover</span><span class="sxs-lookup"><span data-stu-id="20bd0-185">Step 2: Run the failover test scenario</span></span>
<span data-ttu-id="20bd0-186">O cenário de teste de failover destina-se a uma partição de serviço específica, em vez de todo o cluster, e não afeta outros serviços.</span><span class="sxs-lookup"><span data-stu-id="20bd0-186">The failover test scenario targets a specific service partition instead of the entire cluster, and it leaves other services unaffected.</span></span> <span data-ttu-id="20bd0-187">O cenário realiza a iteração por meio de uma sequência de falhas simuladas na validação de serviço enquanto a lógica de negócios é executada.</span><span class="sxs-lookup"><span data-stu-id="20bd0-187">The scenario iterates through a sequence of simulated faults in service validation while your business logic runs.</span></span> <span data-ttu-id="20bd0-188">Uma falha na validação do serviço indica um problema que precisa de mais investigação.</span><span class="sxs-lookup"><span data-stu-id="20bd0-188">A failure in service validation indicates an issue that needs further investigation.</span></span> <span data-ttu-id="20bd0-189">O teste de failover apenas induz a uma falha de cada vez, ao contrário do cenário de teste de caos que pode induzir várias falhas.</span><span class="sxs-lookup"><span data-stu-id="20bd0-189">The failover test induces only one fault at a time, as opposed to the chaos test scenario, which can induce multiple faults.</span></span> <span data-ttu-id="20bd0-190">O exemplo a seguir executa o teste de failover por 60 minutos em relação ao serviço fabric:/WordCount/WordCountService.</span><span class="sxs-lookup"><span data-stu-id="20bd0-190">The following example runs the failover test for 60 minutes against the fabric:/WordCount/WordCountService service.</span></span>

```powershell
$timeToRun = 60
$maxStabilizationTimeSecs = 180
$waitTimeBetweenFaultsSec = 10
$serviceName = "fabric:/WordCount/WordCountService"

Invoke-ServiceFabricFailoverTestScenario -TimeToRunMinute $timeToRun -MaxServiceStabilizationTimeoutSec $maxStabilizationTimeSecs -WaitTimeBetweenFaultsSec $waitTimeBetweenFaultsSec -ServiceName $serviceName -PartitionKindUniformInt64 -PartitionKey 1
```

## <a name="task-remove-a-service-fabric-application"></a><span data-ttu-id="20bd0-191">Tarefa: remover um aplicativo do Service Fabric</span><span class="sxs-lookup"><span data-stu-id="20bd0-191">Task: Remove a Service Fabric application</span></span>
<span data-ttu-id="20bd0-192">Você pode excluir uma instância de um aplicativo implantado, remover o tipo de aplicativo provisionado do cluster e remover o pacote de aplicativo da ImageStore.</span><span class="sxs-lookup"><span data-stu-id="20bd0-192">You can delete an instance of a deployed application, remove the provisioned application type from the cluster, and remove the application package from the ImageStore.</span></span>

### <a name="step-1-remove-an-application-instance"></a><span data-ttu-id="20bd0-193">Etapa 1: Remover uma instância de aplicativo</span><span class="sxs-lookup"><span data-stu-id="20bd0-193">Step 1: Remove an application instance</span></span>
<span data-ttu-id="20bd0-194">Quando uma instância de aplicativo não é mais necessária, você pode removê-la permanentemente usando o cmdlet [Remove-ServiceFabricApplication](/powershell/module/servicefabric/remove-servicefabricapplication?view=azureservicefabricps).</span><span class="sxs-lookup"><span data-stu-id="20bd0-194">When an application instance is no longer needed, you can permanently remove it by using the [Remove-ServiceFabricApplication](/powershell/module/servicefabric/remove-servicefabricapplication?view=azureservicefabricps) cmdlet.</span></span> <span data-ttu-id="20bd0-195">Isso também remove automaticamente todos os serviços que pertencem ao aplicativo, removendo permanentemente todos os estados de serviço.</span><span class="sxs-lookup"><span data-stu-id="20bd0-195">This also automatically removes all services belonging to the application, permanently removing all service state.</span></span> <span data-ttu-id="20bd0-196">Essa operação não pode ser revertida e o estado do aplicativo não pode ser recuperado.</span><span class="sxs-lookup"><span data-stu-id="20bd0-196">This operation cannot be reversed and application state cannot be recovered.</span></span>

```powershell
Remove-ServiceFabricApplication fabric:/WordCount
```

### <a name="step-2-unregister-the-application-type"></a><span data-ttu-id="20bd0-197">Etapa 2: Cancelar o registro do tipo de aplicativo</span><span class="sxs-lookup"><span data-stu-id="20bd0-197">Step 2: Unregister the application type</span></span>
<span data-ttu-id="20bd0-198">Quando não precisar mais de uma versão específica de um tipo de aplicativo, cancele seu registro usando o cmdlet [Unregister-ServiceFabricApplicationType](/powershell/module/servicefabric/unregister-servicefabricapplicationtype?view=azureservicefabricps).</span><span class="sxs-lookup"><span data-stu-id="20bd0-198">When you no longer need a particular version of an application type, unregister it by using the [Unregister-ServiceFabricApplicationType](/powershell/module/servicefabric/unregister-servicefabricapplicationtype?view=azureservicefabricps) cmdlet.</span></span> <span data-ttu-id="20bd0-199">O cancelamento de registro de tipos não utilizados libera espaço de armazenamento usado pelo pacote de aplicativos no repositório de imagens.</span><span class="sxs-lookup"><span data-stu-id="20bd0-199">Unregistering unused types releases storage space used by the application package in the image store.</span></span> <span data-ttu-id="20bd0-200">Um tipo de aplicativo pode ter seu registro cancelado, desde que não existam aplicativos instanciados nele ou atualizações de aplicativo pendentes que façam referência a ele.</span><span class="sxs-lookup"><span data-stu-id="20bd0-200">An application type can be unregistered as long as there are no applications instantiated against it or pending application upgrades referencing it.</span></span>

```powershell
Unregister-ServiceFabricApplicationType WordCount 1.0.0
```

### <a name="step-3-remove-the-application-package"></a><span data-ttu-id="20bd0-201">Etapa 3: remover o pacote de aplicativos</span><span class="sxs-lookup"><span data-stu-id="20bd0-201">Step 3: Remove the application package</span></span>
<span data-ttu-id="20bd0-202">Após o cancelamento do registro do tipo de aplicativo, o pacote de aplicativos poderá ser removido do repositório de imagens usando o cmdlet [Remove-ServiceFabricApplicationPackage](/powershell/module/servicefabric/remove-servicefabricapplicationpackage?view=azureservicefabricps).</span><span class="sxs-lookup"><span data-stu-id="20bd0-202">After the application type is unregistered, the application package can be removed from the image store by using the [Remove-ServiceFabricApplicationPackage](/powershell/module/servicefabric/remove-servicefabricapplicationpackage?view=azureservicefabricps) cmdlet.</span></span>

```powershell
Remove-ServiceFabricApplicationPackage -ImageStoreConnectionString file:C:\SfDevCluster\Data\ImageStoreShare -ApplicationPackagePathInImageStore WordCount
```

## <a name="next-steps"></a><span data-ttu-id="20bd0-203">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="20bd0-203">Next steps</span></span>
[<span data-ttu-id="20bd0-204">Ciclo de vida do aplicativo do Service Fabric</span><span class="sxs-lookup"><span data-stu-id="20bd0-204">Service Fabric application lifecycle</span></span>](service-fabric-application-lifecycle.md)

[<span data-ttu-id="20bd0-205">Implantar um aplicativo</span><span class="sxs-lookup"><span data-stu-id="20bd0-205">Deploy an application</span></span>](service-fabric-deploy-remove-applications.md)

[<span data-ttu-id="20bd0-206">Atualização de aplicativo</span><span class="sxs-lookup"><span data-stu-id="20bd0-206">Application upgrade</span></span>](service-fabric-application-upgrade.md)

[<span data-ttu-id="20bd0-207">Cmdlets do Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="20bd0-207">Azure Service Fabric cmdlets</span></span>](/powershell/azure/overview?view=azureservicefabricps)

