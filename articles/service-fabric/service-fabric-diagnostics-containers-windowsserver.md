---
title: "Diagnóstico e monitoramento de contêineres do Azure Service Fabric | Microsoft Docs"
description: "Saiba como monitorar e diagnosticar contêineres orquestrados no Microsoft Azure Service Fabric com a solução de contêineres do OMS."
services: service-fabric
documentationcenter: .net
author: dkkapur
manager: timlt
editor: 
ms.assetid: 
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 05/10/2017
ms.author: dekapur
ms.openlocfilehash: 874c1a5c4b399ff2254072b7282f05d83a005cc3
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="monitoring-windows-server-containers-with-oms"></a><span data-ttu-id="be4bb-103">Monitorando contêineres do Windows Server com o OMS</span><span class="sxs-lookup"><span data-stu-id="be4bb-103">Monitoring Windows Server containers with OMS</span></span>

## <a name="oms-containers-solution"></a><span data-ttu-id="be4bb-104">Solução de Contêineres do OMS</span><span class="sxs-lookup"><span data-stu-id="be4bb-104">OMS Containers Solution</span></span>

<span data-ttu-id="be4bb-105">A equipe do OMS (Operations Management Suite) publicou uma solução de Contêineres para diagnóstico e monitoramento de contêineres.</span><span class="sxs-lookup"><span data-stu-id="be4bb-105">The Operations Management Suite (OMS) team has published a Containers solution for diagnostics and monitoring for containers.</span></span> <span data-ttu-id="be4bb-106">Juntamente com sua solução Service Fabric, essa solução é uma excelente ferramenta para monitorar implantações de contêiner orquestradas no Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="be4bb-106">Alongside their Service Fabric solution, this solution is a great tool to monitor container deployments orchestrated on Service Fabric.</span></span> <span data-ttu-id="be4bb-107">Aqui está um exemplo simples da aparência do painel na solução:</span><span class="sxs-lookup"><span data-stu-id="be4bb-107">Here's a simple example of what the dashboard in the solution looks like:</span></span>

![Painel do OMS básico](./media/service-fabric-diagnostics-containers-windowsserver/oms-containers-dashboard.png)

<span data-ttu-id="be4bb-109">Ele também coleta diferentes tipos de logs que podem ser consultados na ferramenta Log Analytics do OMS e pode ser usado para visualizar todas as métricas ou eventos sendo gerados.</span><span class="sxs-lookup"><span data-stu-id="be4bb-109">It also collects different kinds of logs that can be queried in the OMS Log Analytics tool, and can be used to visualize any metrics or events being generated.</span></span> <span data-ttu-id="be4bb-110">Os tipos de log coletados são:</span><span class="sxs-lookup"><span data-stu-id="be4bb-110">The log types that are collected are:</span></span>

1. <span data-ttu-id="be4bb-111">ContainerInventory: mostra informações sobre imagens, nome e localização do contêiner</span><span class="sxs-lookup"><span data-stu-id="be4bb-111">ContainerInventory: shows information about container location, name, and images</span></span>
2. <span data-ttu-id="be4bb-112">ContainerImageInventory: informações sobre imagens implantadas, inclusive IDs ou tamanhos</span><span class="sxs-lookup"><span data-stu-id="be4bb-112">ContainerImageInventory: information about deployed images, including IDs or sizes</span></span>
3. <span data-ttu-id="be4bb-113">ContainerLog: logs de erros específicos, logs de docker (stdout etc.) e outras entradas</span><span class="sxs-lookup"><span data-stu-id="be4bb-113">ContainerLog: specific error logs, docker logs (stdout, etc.), and other entries</span></span>
4. <span data-ttu-id="be4bb-114">ContainerServiceLog: comandos de daemon do docker que foram executados</span><span class="sxs-lookup"><span data-stu-id="be4bb-114">ContainerServiceLog: docker daemon commands that have been run</span></span>
5. <span data-ttu-id="be4bb-115">Perf: contadores de desempenho incluindo o CPU, memória, tráfego de rede, E/S do disco e métricas personalizadas das máquinas de host do contêiner</span><span class="sxs-lookup"><span data-stu-id="be4bb-115">Perf: performance counters including container cpu, memory, network traffic, disk i/o, and custom metrics from the host machines</span></span>

<span data-ttu-id="be4bb-116">Este artigo aborda as etapas necessárias para configurar o monitoramento de contêiner para seu cluster.</span><span class="sxs-lookup"><span data-stu-id="be4bb-116">This article covers the steps required to set up container monitoring for your cluster.</span></span> <span data-ttu-id="be4bb-117">Para saber mais sobre a solução de Contêineres do OMS, consulte sua [documentação](../log-analytics/log-analytics-containers.md).</span><span class="sxs-lookup"><span data-stu-id="be4bb-117">To learn more about OMS's Containers solution, check out their [documentation](../log-analytics/log-analytics-containers.md).</span></span>

## <a name="1-set-up-a-service-fabric-cluster"></a><span data-ttu-id="be4bb-118">1. Configurar um cluster do Service Fabric</span><span class="sxs-lookup"><span data-stu-id="be4bb-118">1. Set up a Service Fabric cluster</span></span>

<span data-ttu-id="be4bb-119">Crie um cluster usando o modelo do Azure Resource Manager encontrado [aqui](https://github.com/dkkapur/Service-Fabric/tree/master/ARM%20Templates/SF%20OMS%20Sample).</span><span class="sxs-lookup"><span data-stu-id="be4bb-119">Create a cluster using the Azure Resource Manager template found [here](https://github.com/dkkapur/Service-Fabric/tree/master/ARM%20Templates/SF%20OMS%20Sample).</span></span> <span data-ttu-id="be4bb-120">Certifique-se de adicionar um nome exclusivo de espaço de trabalho do OMS.</span><span class="sxs-lookup"><span data-stu-id="be4bb-120">Make sure to add a unique OMS workspace name.</span></span> <span data-ttu-id="be4bb-121">Esse modelo também padroniza para implantar um cluster no build de versão prévia do Service Fabric (v255.255), o que significa que ele não pode ser usado na produção e não pode ser atualizado para uma versão diferente do Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="be4bb-121">This template also defaults to deploying a cluster in the preview build of Service Fabric (v255.255), which means that it cannot be used in production, and cannot be upgraded to a different Service Fabric version.</span></span> <span data-ttu-id="be4bb-122">Se você decidir utilizar este modelo para o uso em longo prazo ou em produção, altere a versão para um número de versão estável.</span><span class="sxs-lookup"><span data-stu-id="be4bb-122">If you decide to use this template for long-term or production use, change the version to a stable version number.</span></span>

<span data-ttu-id="be4bb-123">Depois que o cluster for configurado, confirme se você instalou o certificado apropriado e verifique se consegue se conectar ao cluster.</span><span class="sxs-lookup"><span data-stu-id="be4bb-123">Once the cluster is set up, confirm that you have installed the appropriate certificate, and make sure you are able to connect to the cluster.</span></span>

<span data-ttu-id="be4bb-124">Confirme se o grupo de recursos está configurado corretamente acessando o [Portal do Azure](https://portal.azure.com/) e localizando a implantação.</span><span class="sxs-lookup"><span data-stu-id="be4bb-124">Confirm that your Resource Group is set up correctly by heading to the [Azure portal](https://portal.azure.com/) and finding the deployment.</span></span> <span data-ttu-id="be4bb-125">O grupo de recursos deve conter todos os recursos do Service Fabric e também ter uma solução Log Analytics e uma solução Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="be4bb-125">The resource group should contain all the Service Fabric resources, and also have a Log Analytics solution as well as a Service Fabric solution.</span></span>

<span data-ttu-id="be4bb-126">Para modificar um cluster existente do Service Fabric:</span><span class="sxs-lookup"><span data-stu-id="be4bb-126">For modifying an existing Service Fabric cluster:</span></span>
* <span data-ttu-id="be4bb-127">Confirme se o Diagnóstico está habilitado (se não estiver, habilite-o por meio da [atualização do conjunto de dimensionamento de máquinas virtuais](/rest/api/virtualmachinescalesets/create-or-update-a-set))</span><span class="sxs-lookup"><span data-stu-id="be4bb-127">Confirm that Diagnostics is enabled (if not, enable it via [updating the virtual machine scale set](/rest/api/virtualmachinescalesets/create-or-update-a-set))</span></span>
* <span data-ttu-id="be4bb-128">Adicione um Espaço de Trabalho do OMS criando uma solução de "Análise do Service Fabric" usando o Azure Marketplace</span><span class="sxs-lookup"><span data-stu-id="be4bb-128">Add an OMS Workspace by creating a "Service Fabric Analytics" solution via the Azure Marketplace</span></span>
* <span data-ttu-id="be4bb-129">Edite as fontes de dados da solução Service Fabric para pegara dados das tabelas apropriadas do Armazenamento do Azure (definidas por WAD) no Grupo de Recursos no qual o cluster está</span><span class="sxs-lookup"><span data-stu-id="be4bb-129">Edit the data sources of the Service Fabric solution to pick up data from the appropriate Azure Storage tables (set up by WAD) in the Resource Group that the cluster is in</span></span>
* <span data-ttu-id="be4bb-130">Adicione o agente como uma [extensão para o conjunto de dimensionamento de máquinas virtuais](/powershell/module/azurerm.compute/add-azurermvmssextension) por meio do PowerShell ou atualizando o conjunto de dimensionamento de máquinas virtuais (mesmo link acima, para modificar o modelo do Resource Manager)</span><span class="sxs-lookup"><span data-stu-id="be4bb-130">Add the agent as an [extension to the virtual machine scale set](/powershell/module/azurerm.compute/add-azurermvmssextension) via PowerShell or through updating the virtual machine scale set (same link as above, to modify the Resource Manager template)</span></span>

## <a name="2-deploy-a-container"></a><span data-ttu-id="be4bb-131">2. Implantar um contêiner</span><span class="sxs-lookup"><span data-stu-id="be4bb-131">2. Deploy a container</span></span>

<span data-ttu-id="be4bb-132">Depois que o cluster estiver pronto e você confirmar que pode acessá-lo, implante um contêiner nele.</span><span class="sxs-lookup"><span data-stu-id="be4bb-132">Once the cluster is ready and you have confirmed that you can access it, deploy a container to it.</span></span> <span data-ttu-id="be4bb-133">Se você optar por usar a versão prévia conforme definido pelo modelo, também poderá explorar a nova funcionalidade Docker Compose do Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="be4bb-133">If you chose to use the preview version as set by the template, you can also explore Service Fabric's new docker compose functionality.</span></span> <span data-ttu-id="be4bb-134">Tenha em mente que na primeira vez que uma imagem de contêiner é implantada em um cluster, ela leva vários minutos para baixar a imagem, dependendo de seu tamanho.</span><span class="sxs-lookup"><span data-stu-id="be4bb-134">Bear in mind that the first time a container image is deployed to a cluster, it takes several minutes to download the image depending on its size.</span></span>

## <a name="3-add-the-containers-solution"></a><span data-ttu-id="be4bb-135">3. Adicionar a solução de Contêineres</span><span class="sxs-lookup"><span data-stu-id="be4bb-135">3. Add the Containers solution</span></span>

<span data-ttu-id="be4bb-136">No Portal do Azure, crie um recurso de Contêineres (sob a categoria Monitoramento+Gerenciamento) por meio do Azure Marketplace.</span><span class="sxs-lookup"><span data-stu-id="be4bb-136">In the Azure portal, create a Containers resource (under the Monitoring + Management category) through Azure Marketplace.</span></span> 

![Adicionando a solução de Contêineres](./media/service-fabric-diagnostics-containers-windowsserver/containers-solution.png)

<span data-ttu-id="be4bb-138">Na etapa de criação, é solicitado um espaço de trabalho do OMS.</span><span class="sxs-lookup"><span data-stu-id="be4bb-138">In the creation step, it requests an OMS workspace.</span></span> <span data-ttu-id="be4bb-139">Selecione o que foi criado com a implantação acima.</span><span class="sxs-lookup"><span data-stu-id="be4bb-139">Select the one that was created with the deployment above.</span></span> <span data-ttu-id="be4bb-140">Esta etapa adiciona uma solução de Contêineres dentro de seu espaço de trabalho do OMS e é detectada automaticamente pelo agente do OMS implantado pelo modelo.</span><span class="sxs-lookup"><span data-stu-id="be4bb-140">This step adds a Containers solution within your OMS workspace, and is automatically detected by the OMS agent deployed by the template.</span></span> <span data-ttu-id="be4bb-141">O agente começará a coletar dados sobre os processos de contêineres no cluster e, em cerca de 10 a 15 minutos, você deverá ver a solução se iluminar com os dados como a imagem do painel acima.</span><span class="sxs-lookup"><span data-stu-id="be4bb-141">The agent will start gathering data on the containers processes in the cluster, and in about 10-15 minutes, you should see the solution light up with data as in the image of the dashboard above.</span></span>

## <a name="4-next-steps"></a><span data-ttu-id="be4bb-142">4. Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="be4bb-142">4. Next steps</span></span>

<span data-ttu-id="be4bb-143">O OMS oferece várias ferramentas no espaço de trabalho para torná-lo mais útil para você.</span><span class="sxs-lookup"><span data-stu-id="be4bb-143">OMS offers various tools in the workspace to make if more useful for you.</span></span> <span data-ttu-id="be4bb-144">Explore as seguintes opções para personalizar a solução para suas necessidades:</span><span class="sxs-lookup"><span data-stu-id="be4bb-144">Explore the following options to customize the solution to your needs:</span></span>
- <span data-ttu-id="be4bb-145">Familiarize-se com os recursos de [pesquisa e consulta de logs](../log-analytics/log-analytics-log-searches.md) oferecidos como parte do Log Analytics</span><span class="sxs-lookup"><span data-stu-id="be4bb-145">Get familiarized with the [log search and querying](../log-analytics/log-analytics-log-searches.md) features offered as part of Log Analytics</span></span>
- <span data-ttu-id="be4bb-146">Configure o Agente do OMS para coletar contadores de desempenho específicos (acesse a Página Inicial > Configurações > Dados > Contadores de Desempenho do Windows do espaço de trabalho)</span><span class="sxs-lookup"><span data-stu-id="be4bb-146">Configure the OMS agent to pick up specific performance counters (go to the workspace Home > Settings > Data > Windows Performance Counters)</span></span>
- <span data-ttu-id="be4bb-147">Configure o OMS para configurar regras de [alerta automatizado](../log-analytics/log-analytics-alerts.md) para auxiliar na detecção e diagnóstico</span><span class="sxs-lookup"><span data-stu-id="be4bb-147">Configure OMS to set up [automated alerting](../log-analytics/log-analytics-alerts.md) rules to aid in detecting and diagnostics</span></span>