---
title: "Diretrizes e recomendações para Coleções Confiáveis no Azure Service Fabric | Microsoft Docs"
description: "Diretrizes e recomendações para usar as Coleções Confiáveis do Service Fabric"
services: service-fabric
documentationcenter: .net
author: mcoskun
manager: timlt
editor: masnider,rajak
ms.assetid: 62857523-604b-434e-bd1c-2141ea4b00d1
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: required
ms.date: 5/3/2017
ms.author: mcoskun
ms.openlocfilehash: 053a7bca76362035e428fc11806b3e4f83d00946
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="guidelines-and-recommendations-for-reliable-collections-in-azure-service-fabric"></a><span data-ttu-id="b3fff-103">Diretrizes e recomendações para Coleções Confiáveis no Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="b3fff-103">Guidelines and recommendations for Reliable Collections in Azure Service Fabric</span></span>
<span data-ttu-id="b3fff-104">Esta seção fornece diretrizes para usar o Gerenciador de Estado Confiável e Coleções Confiáveis.</span><span class="sxs-lookup"><span data-stu-id="b3fff-104">This section provides guidelines for using Reliable State Manager and Reliable Collections.</span></span> <span data-ttu-id="b3fff-105">A meta é ajudar os usuários a evitar armadilhas comuns.</span><span class="sxs-lookup"><span data-stu-id="b3fff-105">The goal is to help users avoid common pitfalls.</span></span>

<span data-ttu-id="b3fff-106">As diretrizes são organizadas como recomendações simples prefixadas com *uma ação a ser realizada* e os termos *Considere*, *Evite* e *Não*.</span><span class="sxs-lookup"><span data-stu-id="b3fff-106">The guidelines are organized as simple recommendations prefixed with the terms *Do*, *Consider*, *Avoid* and *Do not*.</span></span>

* <span data-ttu-id="b3fff-107">Não modifique um objeto de tipo personalizado retornado por operações de leitura (por exemplo, `TryPeekAsync` ou `TryGetValueAsync`).</span><span class="sxs-lookup"><span data-stu-id="b3fff-107">Do not modify an object of custom type returned by read operations (for example, `TryPeekAsync` or `TryGetValueAsync`).</span></span> <span data-ttu-id="b3fff-108">As Coleções Confiáveis, como as Coleções Simultâneas, retornam uma referência aos objetos e não uma cópia.</span><span class="sxs-lookup"><span data-stu-id="b3fff-108">Reliable Collections, just like Concurrent Collections, return a reference to the objects and not a copy.</span></span>
* <span data-ttu-id="b3fff-109">Faça uma cópia em profundidade do objeto de tipo personalizado retornado antes de modificá-lo.</span><span class="sxs-lookup"><span data-stu-id="b3fff-109">Do deep copy the returned object of a custom type before modifying it.</span></span> <span data-ttu-id="b3fff-110">Como structs e tipos internos são pass-by-value, você não precisa fazer uma cópia em profundidade neles.</span><span class="sxs-lookup"><span data-stu-id="b3fff-110">Since structs and built-in types are pass-by-value, you do not need to do a deep copy on them.</span></span>
* <span data-ttu-id="b3fff-111">Não use `TimeSpan.MaxValue` para tempos limites.</span><span class="sxs-lookup"><span data-stu-id="b3fff-111">Do not use `TimeSpan.MaxValue` for time-outs.</span></span> <span data-ttu-id="b3fff-112">Tempos limite devem ser usados para detectar deadlocks.</span><span class="sxs-lookup"><span data-stu-id="b3fff-112">Time-outs should be used to detect deadlocks.</span></span>
* <span data-ttu-id="b3fff-113">Não use uma transação depois que ela tiver sido confirmada, anulada ou descartada.</span><span class="sxs-lookup"><span data-stu-id="b3fff-113">Do not use a transaction after it has been committed, aborted, or disposed.</span></span>
* <span data-ttu-id="b3fff-114">Não use uma enumeração fora do escopo da transação que em foi criado.</span><span class="sxs-lookup"><span data-stu-id="b3fff-114">Do not use an enumeration outside of the transaction scope it was created in.</span></span>
* <span data-ttu-id="b3fff-115">Não crie uma transação dentro da instrução `using` de outra transação porque isso pode causar deadlocks.</span><span class="sxs-lookup"><span data-stu-id="b3fff-115">Do not create a transaction within another transaction’s `using` statement because it can cause deadlocks.</span></span>
* <span data-ttu-id="b3fff-116">Certifique-se de que a implementação de `IComparable<TKey>` esteja correta.</span><span class="sxs-lookup"><span data-stu-id="b3fff-116">Do ensure that your `IComparable<TKey>` implementation is correct.</span></span> <span data-ttu-id="b3fff-117">O sistema depende de `IComparable<TKey>` para mesclar os pontos de verificação.</span><span class="sxs-lookup"><span data-stu-id="b3fff-117">The system takes dependency on `IComparable<TKey>` for merging checkpoints and rows.</span></span>
* <span data-ttu-id="b3fff-118">Use bloqueio de atualização durante a leitura de um item com uma intenção de atualizá-lo para impedir determinada classe de deadlocks.</span><span class="sxs-lookup"><span data-stu-id="b3fff-118">Do use Update lock when reading an item with an intention to update it to prevent a certain class of deadlocks.</span></span>
* <span data-ttu-id="b3fff-119">Considere manter seus itens (por exemplo, TKey + TValue para o Dicionário Confiável) abaixo de 80 KBytes: quanto menor, melhor.</span><span class="sxs-lookup"><span data-stu-id="b3fff-119">Consider keeping your items (for example, TKey + TValue for Reliable Dictionary) below 80 KBytes: smaller the better.</span></span> <span data-ttu-id="b3fff-120">Isso reduz a quantidade de uso do Heap de Objetos Grandes, bem como os requisitos de disco e de E/S da rede.</span><span class="sxs-lookup"><span data-stu-id="b3fff-120">This reduces the amount of Large Object Heap usage as well as disk and network IO requirements.</span></span> <span data-ttu-id="b3fff-121">Muitas vezes, isso reduz a replicação de dados duplicados quando apenas uma pequena parte do valor está sendo atualizada.</span><span class="sxs-lookup"><span data-stu-id="b3fff-121">Often, it reduces replicating duplicate data when only one small part of the value is being updated.</span></span> <span data-ttu-id="b3fff-122">Uma maneira comum de fazer isso no Dicionário Confiável é dividir as linhas em várias linhas.</span><span class="sxs-lookup"><span data-stu-id="b3fff-122">Common way to achieve this in Reliable Dictionary, is to break your rows in to multiple rows.</span></span>
* <span data-ttu-id="b3fff-123">Considere o uso da funcionalidade de backup e restauração para ter uma recuperação de desastre.</span><span class="sxs-lookup"><span data-stu-id="b3fff-123">Consider using backup and restore functionality to have disaster recovery.</span></span>
* <span data-ttu-id="b3fff-124">Evite a mistura de operações de entidade única e operações de várias entidades (por exemplo, de `GetCountAsync`, `CreateEnumerableAsync`) na mesma transação devido a níveis de isolamento diferentes.</span><span class="sxs-lookup"><span data-stu-id="b3fff-124">Avoid mixing single entity operations and multi-entity operations (e.g `GetCountAsync`, `CreateEnumerableAsync`) in the same transaction due to the different isolation levels.</span></span>
* <span data-ttu-id="b3fff-125">Trate InvalidOperationException.</span><span class="sxs-lookup"><span data-stu-id="b3fff-125">Do handle InvalidOperationException.</span></span> <span data-ttu-id="b3fff-126">As transações do usuário podem ser anuladas pelo sistema por diversos motivos.</span><span class="sxs-lookup"><span data-stu-id="b3fff-126">User transactions can be aborted by the system for variety of reasons.</span></span> <span data-ttu-id="b3fff-127">Por exemplo, quando o Gerenciador de Estado Confiável muda sua função Primária ou quando uma transação de longa execução bloqueia o truncamento do log transacional.</span><span class="sxs-lookup"><span data-stu-id="b3fff-127">For example, when the Reliable State Manager is changing its role out of Primary or when a long-running transaction is blocking truncation of the transactional log.</span></span> <span data-ttu-id="b3fff-128">Nesses casos, o usuário pode receber InvalidOperationException, indicando que a transação já foi encerrada.</span><span class="sxs-lookup"><span data-stu-id="b3fff-128">In such cases, user may receive InvalidOperationException indicating that their transaction has already been terminated.</span></span> <span data-ttu-id="b3fff-129">Supondo que o encerramento da transação não foi solicitado pelo usuário, a melhor maneira de tratar essa exceção é descartar a transação, verificar se o token de cancelamento foi sinalizado (ou se a função da réplica foi alterada) e, caso não tenha, criar uma nova transação e tentar novamente.</span><span class="sxs-lookup"><span data-stu-id="b3fff-129">Assuming, the termination of the transaction was not requested by the user, best way to handle this exception is to dispose the transaction, check if the cancellation token has been signaled (or the role of the replica has been changed), and if not create a new transaction and retry.</span></span>  

<span data-ttu-id="b3fff-130">Eis aqui algumas coisas que se deve manter em mente:</span><span class="sxs-lookup"><span data-stu-id="b3fff-130">Here are some things to keep in mind:</span></span>

* <span data-ttu-id="b3fff-131">O tempo limite padrão é de 4 segundos para todas as APIs de Coleções Confiáveis.</span><span class="sxs-lookup"><span data-stu-id="b3fff-131">The default time-out is four seconds for all the Reliable Collection APIs.</span></span> <span data-ttu-id="b3fff-132">A maioria dos usuários deve usar o tempo limite padrão.</span><span class="sxs-lookup"><span data-stu-id="b3fff-132">Most users should use the default time-out.</span></span>
* <span data-ttu-id="b3fff-133">O token de cancelamento padrão é `CancellationToken.None` em todas as APIs de Coleções Confiáveis.</span><span class="sxs-lookup"><span data-stu-id="b3fff-133">The default cancellation token is `CancellationToken.None` in all Reliable Collections APIs.</span></span>
* <span data-ttu-id="b3fff-134">O parâmetro de tipo de chave (*TKey*) para um Dicionário Confiável deve implementar corretamente `GetHashCode()` e `Equals()`.</span><span class="sxs-lookup"><span data-stu-id="b3fff-134">The key type parameter (*TKey*) for a Reliable Dictionary must correctly implement `GetHashCode()` and `Equals()`.</span></span> <span data-ttu-id="b3fff-135">As chaves devem ser imutáveis.</span><span class="sxs-lookup"><span data-stu-id="b3fff-135">Keys must be immutable.</span></span>
* <span data-ttu-id="b3fff-136">Para obter alta disponibilidade para as Coleções Confiáveis, cada serviço deve ter pelo menos um destino e uma réplica mínima com tamanho definido como 3.</span><span class="sxs-lookup"><span data-stu-id="b3fff-136">To achieve high availability for the Reliable Collections, each service should have at least a target and minimum replica set size of 3.</span></span>
* <span data-ttu-id="b3fff-137">As operações de leitura no secundário podem ler versões que não são confirmadas por quorum.</span><span class="sxs-lookup"><span data-stu-id="b3fff-137">Read operations on the secondary may read versions that are not quorum committed.</span></span>
  <span data-ttu-id="b3fff-138">Isso significa que uma versão dos dados que é lida por meio de um único secundário pode ter um progresso falso.</span><span class="sxs-lookup"><span data-stu-id="b3fff-138">This means that a version of data that is read from a single secondary might be false progressed.</span></span>
  <span data-ttu-id="b3fff-139">As leituras do Primário são sempre estáveis: elas nunca podem ter um progresso falso.</span><span class="sxs-lookup"><span data-stu-id="b3fff-139">Reads from Primary are always stable: can never be false progressed.</span></span>

### <a name="next-steps"></a><span data-ttu-id="b3fff-140">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="b3fff-140">Next steps</span></span>
* [<span data-ttu-id="b3fff-141">Trabalhando com Reliable Collections</span><span class="sxs-lookup"><span data-stu-id="b3fff-141">Working with Reliable Collections</span></span>](service-fabric-work-with-reliable-collections.md)
* [<span data-ttu-id="b3fff-142">Transações e bloqueios</span><span class="sxs-lookup"><span data-stu-id="b3fff-142">Transactions and Locks</span></span>](service-fabric-reliable-services-reliable-collections-transactions-locks.md)
* [<span data-ttu-id="b3fff-143">Gerenciador de Estado Confiável e aspectos internos da coleção</span><span class="sxs-lookup"><span data-stu-id="b3fff-143">Reliable State Manager and Collection Internals</span></span>](service-fabric-reliable-services-reliable-collections-internals.md)
* <span data-ttu-id="b3fff-144">Gerenciando dados</span><span class="sxs-lookup"><span data-stu-id="b3fff-144">Managing Data</span></span>
  * [<span data-ttu-id="b3fff-145">Backup e restauração</span><span class="sxs-lookup"><span data-stu-id="b3fff-145">Backup and Restore</span></span>](service-fabric-reliable-services-backup-restore.md)
  * [<span data-ttu-id="b3fff-146">Notificações</span><span class="sxs-lookup"><span data-stu-id="b3fff-146">Notifications</span></span>](service-fabric-reliable-services-notifications.md)
  * [<span data-ttu-id="b3fff-147">Serialização e atualização</span><span class="sxs-lookup"><span data-stu-id="b3fff-147">Serialization and Upgrade</span></span>](service-fabric-application-upgrade-data-serialization.md)
  * [<span data-ttu-id="b3fff-148">Configuração do Gerenciador de Estado Confiável</span><span class="sxs-lookup"><span data-stu-id="b3fff-148">Reliable State Manager configuration</span></span>](service-fabric-reliable-services-configuration.md)
* <span data-ttu-id="b3fff-149">Outros</span><span class="sxs-lookup"><span data-stu-id="b3fff-149">Others</span></span>
  * [<span data-ttu-id="b3fff-150">Início Rápido dos Serviços Confiáveis</span><span class="sxs-lookup"><span data-stu-id="b3fff-150">Reliable Services quick start</span></span>](service-fabric-reliable-services-quick-start.md)
  * [<span data-ttu-id="b3fff-151">Referência do desenvolvedor para Coleções Confiáveis</span><span class="sxs-lookup"><span data-stu-id="b3fff-151">Developer reference for Reliable Collections</span></span>](https://msdn.microsoft.com/library/azure/microsoft.servicefabric.data.collections.aspx)
