---
title: "aaaGuidelines & recomendações para coleções confiável no Azure Service Fabric | Microsoft Docs"
description: "Diretrizes e recomendações para usar as Coleções Confiáveis do Service Fabric"
services: service-fabric
documentationcenter: .net
author: mcoskun
manager: timlt
editor: masnider,rajak
ms.assetid: 62857523-604b-434e-bd1c-2141ea4b00d1
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: required
ms.date: 5/3/2017
ms.author: mcoskun
ms.openlocfilehash: bcdbc9d013bc044e06c43761e7f515c7e4bf340c
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="guidelines-and-recommendations-for-reliable-collections-in-azure-service-fabric"></a><span data-ttu-id="1ebb8-103">Diretrizes e recomendações para Coleções Confiáveis no Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="1ebb8-103">Guidelines and recommendations for Reliable Collections in Azure Service Fabric</span></span>
<span data-ttu-id="1ebb8-104">Esta seção fornece diretrizes para usar o Gerenciador de Estado Confiável e Coleções Confiáveis.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-104">This section provides guidelines for using Reliable State Manager and Reliable Collections.</span></span> <span data-ttu-id="1ebb8-105">meta de saudação é toohelp usuários evitem armadilhas comuns.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-105">hello goal is toohelp users avoid common pitfalls.</span></span>

<span data-ttu-id="1ebb8-106">diretrizes de saudação são organizadas como recomendações simples prefixadas com termos Olá *fazer*, *considere*, *Evite* e *não*.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-106">hello guidelines are organized as simple recommendations prefixed with hello terms *Do*, *Consider*, *Avoid* and *Do not*.</span></span>

* <span data-ttu-id="1ebb8-107">Não modifique um objeto de tipo personalizado retornado por operações de leitura (por exemplo, `TryPeekAsync` ou `TryGetValueAsync`).</span><span class="sxs-lookup"><span data-stu-id="1ebb8-107">Do not modify an object of custom type returned by read operations (for example, `TryPeekAsync` or `TryGetValueAsync`).</span></span> <span data-ttu-id="1ebb8-108">Coleções confiáveis, como coleções simultâneas, retornam um objeto de toohello de referência e não uma cópia.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-108">Reliable Collections, just like Concurrent Collections, return a reference toohello objects and not a copy.</span></span>
* <span data-ttu-id="1ebb8-109">Faça a saudação de cópia em profundidade retornada um objeto de um tipo personalizado antes de modificá-lo.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-109">Do deep copy hello returned object of a custom type before modifying it.</span></span> <span data-ttu-id="1ebb8-110">Como estruturas e tipos internos são passagem-por-valor, não é necessário toodo uma cópia profunda sobre eles.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-110">Since structs and built-in types are pass-by-value, you do not need toodo a deep copy on them.</span></span>
* <span data-ttu-id="1ebb8-111">Não use `TimeSpan.MaxValue` para tempos limites.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-111">Do not use `TimeSpan.MaxValue` for time-outs.</span></span> <span data-ttu-id="1ebb8-112">Tempos limite deve ser usado toodetect deadlocks.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-112">Time-outs should be used toodetect deadlocks.</span></span>
* <span data-ttu-id="1ebb8-113">Não use uma transação depois que ela tiver sido confirmada, anulada ou descartada.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-113">Do not use a transaction after it has been committed, aborted, or disposed.</span></span>
* <span data-ttu-id="1ebb8-114">Não use uma enumeração fora do escopo de transação de saudação que foi criado.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-114">Do not use an enumeration outside of hello transaction scope it was created in.</span></span>
* <span data-ttu-id="1ebb8-115">Não crie uma transação dentro da instrução `using` de outra transação porque isso pode causar deadlocks.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-115">Do not create a transaction within another transaction’s `using` statement because it can cause deadlocks.</span></span>
* <span data-ttu-id="1ebb8-116">Certifique-se de que a implementação de `IComparable<TKey>` esteja correta.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-116">Do ensure that your `IComparable<TKey>` implementation is correct.</span></span> <span data-ttu-id="1ebb8-117">sistema de saudação leva a dependência `IComparable<TKey>` para mesclar as linhas e pontos de verificação.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-117">hello system takes dependency on `IComparable<TKey>` for merging checkpoints and rows.</span></span>
* <span data-ttu-id="1ebb8-118">Usar bloqueio de atualização durante a leitura de um item com uma intenção tooupdate-tooprevent uma determinada classe de deadlocks.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-118">Do use Update lock when reading an item with an intention tooupdate it tooprevent a certain class of deadlocks.</span></span>
* <span data-ttu-id="1ebb8-119">Considere a possibilidade de manter os itens (por exemplo, TKey + TValue para dicionário confiável) abaixo de 80 KBytes: Olá menor melhor.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-119">Consider keeping your items (for example, TKey + TValue for Reliable Dictionary) below 80 KBytes: smaller hello better.</span></span> <span data-ttu-id="1ebb8-120">Isso reduz a quantidade de saudação de requisitos de e/s de rede, bem como em disco e uso Heap de objeto grande.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-120">This reduces hello amount of Large Object Heap usage as well as disk and network IO requirements.</span></span> <span data-ttu-id="1ebb8-121">Geralmente, isso reduz o replicando dados duplicados quando apenas uma pequena parte do valor de hello está sendo atualizada.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-121">Often, it reduces replicating duplicate data when only one small part of hello value is being updated.</span></span> <span data-ttu-id="1ebb8-122">Tooachieve de maneira comum em dicionário confiável, é toobreak as linhas em toomultiple linhas.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-122">Common way tooachieve this in Reliable Dictionary, is toobreak your rows in toomultiple rows.</span></span>
* <span data-ttu-id="1ebb8-123">Considere o uso de backup e recuperação de desastres toohave funcionalidade de restauração.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-123">Consider using backup and restore functionality toohave disaster recovery.</span></span>
* <span data-ttu-id="1ebb8-124">Evitar misturar operações de várias entidades e operações da única entidade (por exemplo `GetCountAsync`, `CreateEnumerableAsync`) em Olá mesma transação devido toohello diferentes níveis de isolamento.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-124">Avoid mixing single entity operations and multi-entity operations (e.g `GetCountAsync`, `CreateEnumerableAsync`) in hello same transaction due toohello different isolation levels.</span></span>
* <span data-ttu-id="1ebb8-125">Trate InvalidOperationException.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-125">Do handle InvalidOperationException.</span></span> <span data-ttu-id="1ebb8-126">Transações de usuário podem ser anuladas pelo sistema Olá por diversas razões.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-126">User transactions can be aborted by hello system for variety of reasons.</span></span> <span data-ttu-id="1ebb8-127">Por exemplo, ao Gerenciador de estado confiável de saudação é alterar sua função de primário ou quando uma transação de longa execução está bloqueando o truncamento de log transacional hello.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-127">For example, when hello Reliable State Manager is changing its role out of Primary or when a long-running transaction is blocking truncation of hello transactional log.</span></span> <span data-ttu-id="1ebb8-128">Nesses casos, o usuário pode receber InvalidOperationException, indicando que a transação já foi encerrada.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-128">In such cases, user may receive InvalidOperationException indicating that their transaction has already been terminated.</span></span> <span data-ttu-id="1ebb8-129">Supondo que, encerramento de saudação da transação Olá não foi solicitado pelo usuário hello, toohandle de maneira melhor essa exceção é toodispose transação de saudação, verifique se o token de cancelamento de saudação foi sinalizado (ou função hello da réplica Olá foi alterada) e se não Crie uma nova transação e tente novamente.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-129">Assuming, hello termination of hello transaction was not requested by hello user, best way toohandle this exception is toodispose hello transaction, check if hello cancellation token has been signaled (or hello role of hello replica has been changed), and if not create a new transaction and retry.</span></span>  

<span data-ttu-id="1ebb8-130">Aqui estão algumas coisas tookeep em mente:</span><span class="sxs-lookup"><span data-stu-id="1ebb8-130">Here are some things tookeep in mind:</span></span>

* <span data-ttu-id="1ebb8-131">tempo limite padrão de saudação é quatro segundos para Olá todas as APIs de coleção confiável.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-131">hello default time-out is four seconds for all hello Reliable Collection APIs.</span></span> <span data-ttu-id="1ebb8-132">A maioria dos usuários devem usar o tempo limite padrão de saudação.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-132">Most users should use hello default time-out.</span></span>
* <span data-ttu-id="1ebb8-133">Olá token de cancelamento padrão é `CancellationToken.None` em todas as APIs de coleções confiável.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-133">hello default cancellation token is `CancellationToken.None` in all Reliable Collections APIs.</span></span>
* <span data-ttu-id="1ebb8-134">Olá parâmetro de tipo de chave (*TKey*) para um dicionário confiável deve implementar corretamente `GetHashCode()` e `Equals()`.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-134">hello key type parameter (*TKey*) for a Reliable Dictionary must correctly implement `GetHashCode()` and `Equals()`.</span></span> <span data-ttu-id="1ebb8-135">As chaves devem ser imutáveis.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-135">Keys must be immutable.</span></span>
* <span data-ttu-id="1ebb8-136">a alta disponibilidade para Olá coleções confiável tooachieve, cada serviço deve ter pelo menos um destino e mínimo réplica Definir tamanho de 3.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-136">tooachieve high availability for hello Reliable Collections, each service should have at least a target and minimum replica set size of 3.</span></span>
* <span data-ttu-id="1ebb8-137">Operações de leitura em Olá secundária podem ler versões que não são confirmada de quorum.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-137">Read operations on hello secondary may read versions that are not quorum committed.</span></span>
  <span data-ttu-id="1ebb8-138">Isso significa que uma versão dos dados que é lida por meio de um único secundário pode ter um progresso falso.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-138">This means that a version of data that is read from a single secondary might be false progressed.</span></span>
  <span data-ttu-id="1ebb8-139">As leituras do Primário são sempre estáveis: elas nunca podem ter um progresso falso.</span><span class="sxs-lookup"><span data-stu-id="1ebb8-139">Reads from Primary are always stable: can never be false progressed.</span></span>

### <a name="next-steps"></a><span data-ttu-id="1ebb8-140">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="1ebb8-140">Next steps</span></span>
* [<span data-ttu-id="1ebb8-141">Trabalhando com Reliable Collections</span><span class="sxs-lookup"><span data-stu-id="1ebb8-141">Working with Reliable Collections</span></span>](service-fabric-work-with-reliable-collections.md)
* [<span data-ttu-id="1ebb8-142">Transações e bloqueios</span><span class="sxs-lookup"><span data-stu-id="1ebb8-142">Transactions and Locks</span></span>](service-fabric-reliable-services-reliable-collections-transactions-locks.md)
* [<span data-ttu-id="1ebb8-143">Gerenciador de Estado Confiável e aspectos internos da coleção</span><span class="sxs-lookup"><span data-stu-id="1ebb8-143">Reliable State Manager and Collection Internals</span></span>](service-fabric-reliable-services-reliable-collections-internals.md)
* <span data-ttu-id="1ebb8-144">Gerenciando dados</span><span class="sxs-lookup"><span data-stu-id="1ebb8-144">Managing Data</span></span>
  * [<span data-ttu-id="1ebb8-145">Backup e restauração</span><span class="sxs-lookup"><span data-stu-id="1ebb8-145">Backup and Restore</span></span>](service-fabric-reliable-services-backup-restore.md)
  * [<span data-ttu-id="1ebb8-146">Notificações</span><span class="sxs-lookup"><span data-stu-id="1ebb8-146">Notifications</span></span>](service-fabric-reliable-services-notifications.md)
  * [<span data-ttu-id="1ebb8-147">Serialização e atualização</span><span class="sxs-lookup"><span data-stu-id="1ebb8-147">Serialization and Upgrade</span></span>](service-fabric-application-upgrade-data-serialization.md)
  * [<span data-ttu-id="1ebb8-148">Configuração do Gerenciador de Estado Confiável</span><span class="sxs-lookup"><span data-stu-id="1ebb8-148">Reliable State Manager configuration</span></span>](service-fabric-reliable-services-configuration.md)
* <span data-ttu-id="1ebb8-149">Outros</span><span class="sxs-lookup"><span data-stu-id="1ebb8-149">Others</span></span>
  * [<span data-ttu-id="1ebb8-150">Início Rápido dos Serviços Confiáveis</span><span class="sxs-lookup"><span data-stu-id="1ebb8-150">Reliable Services quick start</span></span>](service-fabric-reliable-services-quick-start.md)
  * [<span data-ttu-id="1ebb8-151">Referência do desenvolvedor para Coleções Confiáveis</span><span class="sxs-lookup"><span data-stu-id="1ebb8-151">Developer reference for Reliable Collections</span></span>](https://msdn.microsoft.com/library/azure/microsoft.servicefabric.data.collections.aspx)
