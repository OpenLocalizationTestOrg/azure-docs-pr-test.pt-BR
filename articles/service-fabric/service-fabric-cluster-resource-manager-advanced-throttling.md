---
title: "Limitação no Resource Manager de Cluster do Service Fabric | Microsoft Docs"
description: Aprenda a configurar os limitadores fornecidos pelo Resource Manager de Cluster do Service Fabric.
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: 4a44678b-a5aa-4d30-958f-dc4332ebfb63
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: 1be0beaf2e199a9c384187efd80b33c7dab5e87c
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/18/2017
---
# <a name="throttling-the-service-fabric-cluster-resource-manager"></a><span data-ttu-id="35355-103">Restringindo o Gerenciador de Recursos de Cluster do Service Fabric</span><span class="sxs-lookup"><span data-stu-id="35355-103">Throttling the Service Fabric Cluster Resource Manager</span></span>
<span data-ttu-id="35355-104">Mesmo se você tiver configurado o Gerenciador de Recursos do Cluster corretamente, o cluster poderá ser interrompido.</span><span class="sxs-lookup"><span data-stu-id="35355-104">Even if you’ve configured the Cluster Resource Manager correctly, the cluster can get disrupted.</span></span> <span data-ttu-id="35355-105">Por exemplo, poderia haver falhas simultâneas no domínio de falha e no nó – o que aconteceria se isso ocorresse durante um upgrade?</span><span class="sxs-lookup"><span data-stu-id="35355-105">For example, there could be simultaneous node and fault domain failures - what would happen if that occurred during an upgrade?</span></span> <span data-ttu-id="35355-106">O Gerenciador de Recursos de Cluster sempre tenta corrigir tudo, consumindo recursos do cluster ao tentar reorganizar e corrigir o cluster.</span><span class="sxs-lookup"><span data-stu-id="35355-106">The Cluster Resource Manager always tries to fix everything, consuming the cluster's resources trying to reorganize and fix the cluster.</span></span> <span data-ttu-id="35355-107">As restrições ajudam a construir uma barreira para que o cluster possa usar recursos para se estabilizar — os nós voltam, as partições de rede são corrigidas, os bits corrigidos são implantados.</span><span class="sxs-lookup"><span data-stu-id="35355-107">Throttles help provide a backstop so that the cluster can use resources to stabilize - the nodes come back, the network partitions heal, corrected bits get deployed.</span></span>

<span data-ttu-id="35355-108">Para ajudar com esses tipos de situação, o Gerenciador de Recursos de Cluster do Service Fabric inclui várias restrições.</span><span class="sxs-lookup"><span data-stu-id="35355-108">To help with these sorts of situations, the Service Fabric Cluster Resource Manager includes several throttles.</span></span> <span data-ttu-id="35355-109">Essas restrições são exigências razoavelmente grandes.</span><span class="sxs-lookup"><span data-stu-id="35355-109">These throttles are all fairly large hammers.</span></span> <span data-ttu-id="35355-110">Em geral, elas não devem ser alteradas sem planejamento e teste cuidadosos.</span><span class="sxs-lookup"><span data-stu-id="35355-110">Generally they shouldn’t be changed without careful planning and testing.</span></span>

<span data-ttu-id="35355-111">No caso de alterar as restrições do Gerenciador de Recursos de Cluster, você deve ajustá-las para sua carga real esperada.</span><span class="sxs-lookup"><span data-stu-id="35355-111">If you change the Cluster Resource Manager's throttles, you should tune them to your expected actual load.</span></span> <span data-ttu-id="35355-112">Você pode descobrir que precisa ter algumas restrições definidas, mesmo que isso signifique que o cluster levará mais tempo para ser estabilizado em algumas situações.</span><span class="sxs-lookup"><span data-stu-id="35355-112">You may determine you need to have some throttles in place, even if it means the cluster takes longer to stabilize in some situations.</span></span> <span data-ttu-id="35355-113">O teste é obrigatório para determinar os valores corretos das restrições.</span><span class="sxs-lookup"><span data-stu-id="35355-113">Testing is required to determine the correct values for throttles.</span></span> <span data-ttu-id="35355-114">As restrições precisam ser altas o suficiente para permitir que o cluster responda às alterações em um tempo razoável e baixas o suficiente para de fato impedir o consumo de muito recurso.</span><span class="sxs-lookup"><span data-stu-id="35355-114">Throttles need to be high enough to allow the cluster to respond to changes in a reasonable amount of time, and low enough to actually prevent too much resource consumption.</span></span> 

<span data-ttu-id="35355-115">Na maioria das vezes em que vimos os clientes usarem essas restrições era porque eles já estavam em um ambiente com restrição de recursos.</span><span class="sxs-lookup"><span data-stu-id="35355-115">Most of the time we’ve seen customers use throttles it has been because they were already in a resource constrained environment.</span></span> <span data-ttu-id="35355-116">Alguns exemplos disso são a largura de banda de rede limitada em nós individuais ou discos que não podem criar muitas réplicas com estado paralelamente devido às limitações da taxa de transferência.</span><span class="sxs-lookup"><span data-stu-id="35355-116">Some examples would be limited network bandwidth for individual nodes, or disks that aren't able to build many stateful replicas in parallel due to throughput limitations.</span></span> <span data-ttu-id="35355-117">Sem restrições, as operações poderiam sobrecarregar esses recursos, fazendo com que as operações falhassem ou ficassem lentas.</span><span class="sxs-lookup"><span data-stu-id="35355-117">Without throttles, operations could overwhelm these resources, causing operations to fail or be slow.</span></span> <span data-ttu-id="35355-118">Nessas situações, os clientes usavam restrições e sabiam que estavam estendendo o tempo que levaria para o cluster chegar a um estado estável.</span><span class="sxs-lookup"><span data-stu-id="35355-118">In these situations customers used throttles and knew they were extending the amount of time it would take the cluster to reach a stable state.</span></span> <span data-ttu-id="35355-119">Os clientes também entendiam que poderiam acabar executando com uma confiabilidade geral menor enquanto estivessem restritos.</span><span class="sxs-lookup"><span data-stu-id="35355-119">Customers also understood they could end up running at lower overall reliability while they were throttled.</span></span>


## <a name="configuring-the-throttles"></a><span data-ttu-id="35355-120">Configurando os limitadores</span><span class="sxs-lookup"><span data-stu-id="35355-120">Configuring the throttles</span></span>

<span data-ttu-id="35355-121">O Service Fabric tem dois mecanismos para restringir o número de movimentações de réplica.</span><span class="sxs-lookup"><span data-stu-id="35355-121">Service Fabric has two mechanisms for throttling the number of replica movements.</span></span> <span data-ttu-id="35355-122">O mecanismo padrão que existia antes do Service Fabric 5.7 representava a restrição como um número absoluto de movimentações permitidas.</span><span class="sxs-lookup"><span data-stu-id="35355-122">The default mechanism that existed before Service Fabric 5.7 represents throttling as an absolute number of moves allowed.</span></span> <span data-ttu-id="35355-123">Isso não funciona para clusters de todos os tamanhos.</span><span class="sxs-lookup"><span data-stu-id="35355-123">This does not work for clusters of all sizes.</span></span> <span data-ttu-id="35355-124">Particularmente, em clusters grandes, o valor padrão pode ser muito pequeno, o que reduz significativamente o balanceamento mesmo quando ele é necessário, não tendo qualquer efeito em clusters menores.</span><span class="sxs-lookup"><span data-stu-id="35355-124">In particular, for large clusters the default value can be too small, significantly slowing down balancing even when it is necessary, while having no effect in smaller clusters.</span></span> <span data-ttu-id="35355-125">Esse mecanismo anterior foi substituído pela restrição baseada em porcentagem, que é melhor escalada com clusters dinâmicos, nos quais o número de serviços e nós muda regularmente.</span><span class="sxs-lookup"><span data-stu-id="35355-125">This prior mechanism has been superseded by percentage-based throttling, which scales better with dynamic clusters in which the number of services and nodes change regularly.</span></span>

<span data-ttu-id="35355-126">As restrições são baseadas em uma porcentagem do número de réplicas nos clusters.</span><span class="sxs-lookup"><span data-stu-id="35355-126">The throttles are based on a percentage of the number of replicas in the clusters.</span></span> <span data-ttu-id="35355-127">As restrições baseadas em porcentagem permitem expressar a regra: "não mova mais de 10% das réplicas no intervalo de 10 minutos", por exemplo.</span><span class="sxs-lookup"><span data-stu-id="35355-127">Percetage based throttles enable expressing the rule: "do not move more than 10% of replicas in a 10 minute interval", for example.</span></span>

<span data-ttu-id="35355-128">As definições de configuração para restrição baseada em porcentagem são:</span><span class="sxs-lookup"><span data-stu-id="35355-128">The configuration settings for percentage-based throttling are:</span></span>

  - <span data-ttu-id="35355-129">GlobalMovementThrottleThresholdPercentage - o número máximo de movimentações permitidas no cluster a qualquer momento, expresso como porcentagem do número total de réplicas no cluster.</span><span class="sxs-lookup"><span data-stu-id="35355-129">GlobalMovementThrottleThresholdPercentage - Maximum number of movements allowed in cluster at any time, expressed as percentage of total number of replicas in the cluster.</span></span> <span data-ttu-id="35355-130">0 indica nenhum limite.</span><span class="sxs-lookup"><span data-stu-id="35355-130">0 indicates no limit.</span></span> <span data-ttu-id="35355-131">O valor padrão é 0.</span><span class="sxs-lookup"><span data-stu-id="35355-131">The default value is 0.</span></span> <span data-ttu-id="35355-132">Se essa configuração e GlobalMovementThrottleThreshold forem especificadas, será usado o limite mais conservador.</span><span class="sxs-lookup"><span data-stu-id="35355-132">If both this setting and GlobalMovementThrottleThreshold are specified, then the more conservative limit is used.</span></span>
  - <span data-ttu-id="35355-133">GlobalMovementThrottleThresholdPercentageForPlacement - o número máximo de movimentações permitidas durante a fase de posicionamento, expresso como porcentagem do número total de réplicas no cluster.</span><span class="sxs-lookup"><span data-stu-id="35355-133">GlobalMovementThrottleThresholdPercentageForPlacement - Maximum number of movements allowed during the placement phase, expressed as percentage of total number of replicas in the cluster.</span></span> <span data-ttu-id="35355-134">0 indica nenhum limite.</span><span class="sxs-lookup"><span data-stu-id="35355-134">0 indicates no limit.</span></span> <span data-ttu-id="35355-135">O valor padrão é 0.</span><span class="sxs-lookup"><span data-stu-id="35355-135">The default value is 0.</span></span> <span data-ttu-id="35355-136">Se essa configuração e GlobalMovementThrottleThresholdForPlacement forem especificadas, será usado o limite mais conservador.</span><span class="sxs-lookup"><span data-stu-id="35355-136">If both this setting and GlobalMovementThrottleThresholdForPlacement are specified, then the more conservative limit is used.</span></span>
  - <span data-ttu-id="35355-137">GlobalMovementThrottleThresholdPercentageForBalancing - o número máximo de movimentações permitidas durante a fase de balanceamento, expresso como porcentagem do número total de réplicas no cluster.</span><span class="sxs-lookup"><span data-stu-id="35355-137">GlobalMovementThrottleThresholdPercentageForBalancing - Maximum number of movements allowed during the balancing phase, expressed as percentage of total number of replicas in the cluster.</span></span> <span data-ttu-id="35355-138">0 indica nenhum limite.</span><span class="sxs-lookup"><span data-stu-id="35355-138">0 indicates no limit.</span></span> <span data-ttu-id="35355-139">O valor padrão é 0.</span><span class="sxs-lookup"><span data-stu-id="35355-139">The default value is 0.</span></span> <span data-ttu-id="35355-140">Se essa configuração e GlobalMovementThrottleThresholdForBalancing forem especificadas, será usado o limite mais conservador.</span><span class="sxs-lookup"><span data-stu-id="35355-140">If both this setting and GlobalMovementThrottleThresholdForBalancing are specified, then the more conservative limit is used.</span></span>

<span data-ttu-id="35355-141">Ao especificar a porcentagem de restrição, você deve especificar 5% como 0,05.</span><span class="sxs-lookup"><span data-stu-id="35355-141">When specifying the throttle percentage, you'd specify 5% as 0.05.</span></span> <span data-ttu-id="35355-142">O intervalo no qual essas restrições são governadas é GlobalMovementThrottleCountingInterval, que é especificado em segundos.</span><span class="sxs-lookup"><span data-stu-id="35355-142">The interval on which these throttles are governed is the GlobalMovementThrottleCountingInterval, which is specified in seconds.</span></span>


``` xml
<Section Name="PlacementAndLoadBalancing">
     <Parameter Name="GlobalMovementThrottleThresholdPercentage" Value="0" />
     <Parameter Name="GlobalMovementThrottleThresholdPercentageForPlacement" Value="0" />
     <Parameter Name="GlobalMovementThrottleThresholdPercentageForBalancing" Value="0" />
     <Parameter Name="GlobalMovementThrottleCountingInterval" Value="600" />
</Section>
```

<span data-ttu-id="35355-143">via ClusterConfig.json para implantações Autônomas ou Template.json para clusters hospedados pelo Azure:</span><span class="sxs-lookup"><span data-stu-id="35355-143">via ClusterConfig.json for Standalone deployments or Template.json for Azure hosted clusters:</span></span>

```json
"fabricSettings": [
  {
    "name": "PlacementAndLoadBalancing",
    "parameters": [
      {
          "name": "GlobalMovementThrottleThresholdPercentage",
          "value": "0.0"
      },
      {
          "name": "GlobalMovementThrottleThresholdPercentageForPlacement",
          "value": "0.0"
      },
      {
          "name": "GlobalMovementThrottleThresholdPercentageForBalancing",
          "value": "0.0"
      },
      {
          "name": "GlobalMovementThrottleCountingInterval",
          "value": "600"
      }
    ]
  }
]
```

### <a name="default-count-based-throttles"></a><span data-ttu-id="35355-144">Restrições baseadas em contagem padrão</span><span class="sxs-lookup"><span data-stu-id="35355-144">Default count based throttles</span></span>
<span data-ttu-id="35355-145">Essas informações são fornecidas para o caso em que você tenha clusters mais antigos ou ainda retenha essas configurações em clusters que foram atualizados desde então.</span><span class="sxs-lookup"><span data-stu-id="35355-145">This information is provided in case you have older clusters or still retain these configurations in clusters that have since been upgraded.</span></span> <span data-ttu-id="35355-146">Em geral, é recomendável que elas sejam substituídas pelas restrições baseadas em porcentagem acima.</span><span class="sxs-lookup"><span data-stu-id="35355-146">In general, it is recommended that these are replaced with the percentage-based throttles above.</span></span> <span data-ttu-id="35355-147">Uma vez que a restrição baseada em porcentagem é desabilitada por padrão, essas restrições permanecem como as restrições padrão para um cluster até que elas sejam desabilitadas e substituídas pelas restrições baseadas em porcentagem.</span><span class="sxs-lookup"><span data-stu-id="35355-147">Since percentage-based throttling is disabled by default, these throttles remain the default throttles for a cluster until they are disabled and replaced with the percentage-based throttles.</span></span> 

  - <span data-ttu-id="35355-148">GlobalMovementThrottleThreshold – essa configuração controla o número total de movimentações no cluster ao longo de um período.</span><span class="sxs-lookup"><span data-stu-id="35355-148">GlobalMovementThrottleThreshold – this setting controls the total number of movements in the cluster over some time.</span></span> <span data-ttu-id="35355-149">O tempo é especificado em segundos como GlobalMovementThrottleCountingInterval.</span><span class="sxs-lookup"><span data-stu-id="35355-149">The amount of time is specified in seconds as the GlobalMovementThrottleCountingInterval.</span></span> <span data-ttu-id="35355-150">O valor padrão para GlobalMovementThrottleThreshold é 1000 e o valor padrão para GlobalMovementThrottleCountingInterval é 600.</span><span class="sxs-lookup"><span data-stu-id="35355-150">The default value for the GlobalMovementThrottleThreshold is 1000 and the default value for the GlobalMovementThrottleCountingInterval is 600.</span></span>
  - <span data-ttu-id="35355-151">MovementPerPartitionThrottleThreshold – essa configuração controla o número total de movimentações de qualquer partição de serviço ao longo de um período.</span><span class="sxs-lookup"><span data-stu-id="35355-151">MovementPerPartitionThrottleThreshold – this setting controls the total number of movements for any service partition over some time.</span></span> <span data-ttu-id="35355-152">O tempo é especificado em segundos como MovementPerPartitionThrottleCountingInterval.</span><span class="sxs-lookup"><span data-stu-id="35355-152">The amount of time is specified in seconds as the MovementPerPartitionThrottleCountingInterval.</span></span> <span data-ttu-id="35355-153">O valor padrão para MovementPerPartitionThrottleThreshold é 50 e o valor padrão para MovementPerPartitionThrottleCountingInterval é 600.</span><span class="sxs-lookup"><span data-stu-id="35355-153">The default value for the MovementPerPartitionThrottleThreshold is 50 and the default value for the MovementPerPartitionThrottleCountingInterval is 600.</span></span>

<span data-ttu-id="35355-154">A configuração para essas restrições segue o mesmo padrão que a restrição baseada em porcentagem.</span><span class="sxs-lookup"><span data-stu-id="35355-154">The configuration for these throttles follows the same pattern as the percentage-based throttling.</span></span>

## <a name="next-steps"></a><span data-ttu-id="35355-155">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="35355-155">Next steps</span></span>
- <span data-ttu-id="35355-156">Para descobrir como o Gerenciador de Recursos de Cluster gerencia e balanceia carga no cluster, confira o artigo sobre [como balancear carga](service-fabric-cluster-resource-manager-balancing.md)</span><span class="sxs-lookup"><span data-stu-id="35355-156">To find out about how the Cluster Resource Manager manages and balances load in the cluster, check out the article on [balancing load](service-fabric-cluster-resource-manager-balancing.md)</span></span>
- <span data-ttu-id="35355-157">O Cluster Resource Manager tem muitas opções para descrever o cluster.</span><span class="sxs-lookup"><span data-stu-id="35355-157">The Cluster Resource Manager has many options for describing the cluster.</span></span> <span data-ttu-id="35355-158">Para saber mais sobre elas, confira este artigo sobre a [descrição de um cluster do Service Fabric](service-fabric-cluster-resource-manager-cluster-description.md)</span><span class="sxs-lookup"><span data-stu-id="35355-158">To find out more about them, check out this article on [describing a Service Fabric cluster](service-fabric-cluster-resource-manager-cluster-description.md)</span></span>
