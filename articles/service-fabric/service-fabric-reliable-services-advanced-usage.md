---
title: "Uso avançado dos Reliable Services | Microsoft Docs"
description: "Saiba mais sobre o uso avançado do Reliable Services do Service Fabric para obter maior flexibilidade em seus serviços."
services: Service-Fabric
documentationcenter: .net
author: vturecek
manager: timlt
editor: masnider
ms.assetid: f2942871-863d-47c3-b14a-7cdad9a742c7
ms.service: Service-Fabric
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/29/2017
ms.author: vturecek
ms.openlocfilehash: a87924faaf5c6c43716b06b6d70ab5100c61f097
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="advanced-usage-of-the-reliable-services-programming-model"></a><span data-ttu-id="d4d74-103">Uso avançado do modelo de programação de Serviços Confiáveis</span><span class="sxs-lookup"><span data-stu-id="d4d74-103">Advanced usage of the Reliable Services programming model</span></span>
<span data-ttu-id="d4d74-104">O Service Fabric do Azure simplifica o desenvolvimento e o gerenciamento de serviços confiáveis com e sem estado.</span><span class="sxs-lookup"><span data-stu-id="d4d74-104">Azure Service Fabric simplifies writing and managing reliable stateless and stateful services.</span></span> <span data-ttu-id="d4d74-105">Este guia trata dos usos avançados dos Reliable Services para obter mais controle e flexibilidade sobre seus serviços.</span><span class="sxs-lookup"><span data-stu-id="d4d74-105">This guide talks about advanced usages of Reliable Services to gain more control and flexibility over your services.</span></span> <span data-ttu-id="d4d74-106">Antes de ler este guia, familiarize-se com [o do modelo de programação de Serviços Confiáveis](service-fabric-reliable-services-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="d4d74-106">Prior to reading this guide, familiarize yourself with [the Reliable Services programming model](service-fabric-reliable-services-introduction.md).</span></span>

<span data-ttu-id="d4d74-107">Os serviços com e sem estado têm dois pontos de entrada principais para o código de usuário:</span><span class="sxs-lookup"><span data-stu-id="d4d74-107">Both stateful and stateless services have two primary entry points for user code:</span></span>

* <span data-ttu-id="d4d74-108">`RunAsync(C#) / runAsync(Java)` é um ponto de entrada de finalidade geral para seu código de serviço.</span><span class="sxs-lookup"><span data-stu-id="d4d74-108">`RunAsync(C#) / runAsync(Java)` is a general-purpose entry point for your service code.</span></span>
* <span data-ttu-id="d4d74-109">`CreateServiceReplicaListeners(C#)` e `CreateServiceInstanceListeners(C#) / createServiceInstanceListeners(Java)` servem para abrir ouvintes de comunicação para solicitações de cliente.</span><span class="sxs-lookup"><span data-stu-id="d4d74-109">`CreateServiceReplicaListeners(C#)` and `CreateServiceInstanceListeners(C#) / createServiceInstanceListeners(Java)` is for opening communication listeners for client requests.</span></span>

<span data-ttu-id="d4d74-110">Para a maioria dos serviços, esses dois pontos de entrada são suficientes.</span><span class="sxs-lookup"><span data-stu-id="d4d74-110">For most services, these two entry points are sufficient.</span></span> <span data-ttu-id="d4d74-111">Para casos raros, quando é necessário ter mais controle sobre o ciclo de vida do serviço, existem eventos de ciclo de vida adicionais disponíveis.</span><span class="sxs-lookup"><span data-stu-id="d4d74-111">In rare cases when more control over a service's lifecycle is required, additional lifecycle events are available.</span></span>

## <a name="stateless-service-instance-lifecycle"></a><span data-ttu-id="d4d74-112">Ciclo de vida de instância de serviço sem estado</span><span class="sxs-lookup"><span data-stu-id="d4d74-112">Stateless service instance lifecycle</span></span>
<span data-ttu-id="d4d74-113">O ciclo de vida de um serviço sem estado é muito simples.</span><span class="sxs-lookup"><span data-stu-id="d4d74-113">A stateless service's lifecycle is very simple.</span></span> <span data-ttu-id="d4d74-114">Um serviço sem estado só pode ser aberto, fechado ou anulado.</span><span class="sxs-lookup"><span data-stu-id="d4d74-114">A stateless service can only be opened, closed, or aborted.</span></span> <span data-ttu-id="d4d74-115">`RunAsync` em um serviço sem estado é executado quando uma instância de serviço é aberta e cancelado quando uma instância de serviço é fechada ou anulada.</span><span class="sxs-lookup"><span data-stu-id="d4d74-115">`RunAsync` in a stateless service is executed when a service instance is opened, and canceled when a service instance is closed or aborted.</span></span>

<span data-ttu-id="d4d74-116">Embora `RunAsync` deva ser suficiente em quase todos os casos, os eventos abrir, fechar e anular em um serviço sem estado também estão disponíveis:</span><span class="sxs-lookup"><span data-stu-id="d4d74-116">Although `RunAsync` should be sufficient in almost all cases, the open, close, and abort events in a stateless service are also available:</span></span>

* <span data-ttu-id="d4d74-117">`Task OnOpenAsync(IStatelessServicePartition, CancellationToken) - C# / CompletableFuture<String> onOpenAsync(CancellationToken) - Java` OnOpenAsync é chamado quando a instância do serviço sem estado está prestes a ser usada.</span><span class="sxs-lookup"><span data-stu-id="d4d74-117">`Task OnOpenAsync(IStatelessServicePartition, CancellationToken) - C# / CompletableFuture<String> onOpenAsync(CancellationToken) - Java` OnOpenAsync is called when the stateless service instance is about to be used.</span></span> <span data-ttu-id="d4d74-118">As tarefas de inicialização do serviço estendido podem ser iniciadas nesse momento.</span><span class="sxs-lookup"><span data-stu-id="d4d74-118">Extended service initialization tasks can be started at this time.</span></span>
* <span data-ttu-id="d4d74-119">`Task OnCloseAsync(CancellationToken) - C# / CompletableFuture onCloseAsync(CancellationToken) - Java` OnCloseAsync é chamado quando a instância do serviço sem estado está prestes a ser desligada de modo normal.</span><span class="sxs-lookup"><span data-stu-id="d4d74-119">`Task OnCloseAsync(CancellationToken) - C# / CompletableFuture onCloseAsync(CancellationToken) - Java` OnCloseAsync is called when the stateless service instance is going to be gracefully shut down.</span></span> <span data-ttu-id="d4d74-120">Isso pode ocorrer quando o código de serviço estiver sendo atualizado, quando a instância do serviço estiver sendo movida devido ao balanceamento de carga ou quando for detectada uma falha temporária.</span><span class="sxs-lookup"><span data-stu-id="d4d74-120">This can occur when the service's code is being upgraded, the service instance is being moved due to load balancing, or a transient fault is detected.</span></span> <span data-ttu-id="d4d74-121">OnCloseAsync pode ser usado para fechar todos os recursos com segurança, interromper todos os processamentos em segundo plano, terminar de salvar o estado externo ou fechar conexões existentes.</span><span class="sxs-lookup"><span data-stu-id="d4d74-121">OnCloseAsync can be used to safely close any resources, stop any background processing, finish saving external state, or close down existing connections.</span></span>
* <span data-ttu-id="d4d74-122">`void OnAbort() - C# / void onAbort() - Java` OnAbort é chamado quando a instância do serviço sem estado está sendo desligada de modo forçado.</span><span class="sxs-lookup"><span data-stu-id="d4d74-122">`void OnAbort() - C# / void onAbort() - Java` OnAbort is called when the stateless service instance is being forcefully shut down.</span></span> <span data-ttu-id="d4d74-123">Ele geralmente é chamado quando é detectada uma falha permanente no nó ou quando a malha de serviço não pode gerenciar confiavelmente o ciclo de vida da instância do serviço devido a falhas internas.</span><span class="sxs-lookup"><span data-stu-id="d4d74-123">This is generally called when a permanent fault is detected on the node, or when Service Fabric cannot reliably manage the service instance's lifecycle due to internal failures.</span></span>

## <a name="stateful-service-replica-lifecycle"></a><span data-ttu-id="d4d74-124">Ciclo de vida de réplica de serviço com estado</span><span class="sxs-lookup"><span data-stu-id="d4d74-124">Stateful service replica lifecycle</span></span>

> [!NOTE]
> <span data-ttu-id="d4d74-125">Ainda não há suporte para Reliable Services com monitoração de estado em Java.</span><span class="sxs-lookup"><span data-stu-id="d4d74-125">Stateful reliable services are not supported in Java yet.</span></span>
>
>

<span data-ttu-id="d4d74-126">Um ciclo de vida de uma réplica de serviço com estado é muito mais complexo do que uma instância de serviço sem estado.</span><span class="sxs-lookup"><span data-stu-id="d4d74-126">A stateful service replica's lifecycle is much more complex than a stateless service instance.</span></span> <span data-ttu-id="d4d74-127">Além dos eventos abrir, fechar e anular, uma réplica de serviço com estado sofre mudanças de função durante seu ciclo de vida.</span><span class="sxs-lookup"><span data-stu-id="d4d74-127">In addition to open, close, and abort events, a stateful service replica undergoes role changes during its lifetime.</span></span> <span data-ttu-id="d4d74-128">Quando uma réplica de serviço com estado muda de função, o evento `OnChangeRoleAsync` é disparado:</span><span class="sxs-lookup"><span data-stu-id="d4d74-128">When a stateful service replica changes role, the `OnChangeRoleAsync` event is triggered:</span></span>

* <span data-ttu-id="d4d74-129">`Task OnChangeRoleAsync(ReplicaRole, CancellationToken)` OnChangeRoleAsync é chamado quando a réplica de serviço com estado está alterando funções, por exemplo para primário ou secundário.</span><span class="sxs-lookup"><span data-stu-id="d4d74-129">`Task OnChangeRoleAsync(ReplicaRole, CancellationToken)` OnChangeRoleAsync is called when the stateful service replica is changing role, for example to primary or secondary.</span></span> <span data-ttu-id="d4d74-130">Réplicas primárias recebem status de gravação (têm permissão para criar as Coleções Confiáveis e gravar nelas).</span><span class="sxs-lookup"><span data-stu-id="d4d74-130">Primary replicas are given write status (are allowed to create and write to Reliable Collections).</span></span> <span data-ttu-id="d4d74-131">Réplicas secundárias recebem status de leitura (podem somente ler das coleções confiáveis existentes).</span><span class="sxs-lookup"><span data-stu-id="d4d74-131">Secondary replicas are given read status (can only read from existing Reliable Collections).</span></span> <span data-ttu-id="d4d74-132">A maior parte do trabalho em um serviço com estado é executado na réplica primária.</span><span class="sxs-lookup"><span data-stu-id="d4d74-132">Most work in a stateful service is performed at the primary replica.</span></span> <span data-ttu-id="d4d74-133">Réplicas secundárias podem realizar validação somente leitura, geração de relatórios, mineração de dados ou outros trabalhos somente leitura.</span><span class="sxs-lookup"><span data-stu-id="d4d74-133">Secondary replicas can perform read-only validation, report generation, data mining, or other read-only jobs.</span></span>

<span data-ttu-id="d4d74-134">Em um serviço com estado, somente a réplica primária tem acesso de gravação para o estado e isso ocorre geralmente quando o serviço está executando o trabalho real.</span><span class="sxs-lookup"><span data-stu-id="d4d74-134">In a stateful service, only the primary replica has write access to state and thus is generally when the service is performing actual work.</span></span> <span data-ttu-id="d4d74-135">O método `RunAsync` em um serviço com estado é executado somente quando a réplica de serviço com estado é primária.</span><span class="sxs-lookup"><span data-stu-id="d4d74-135">The `RunAsync` method in a stateful service is executed only when the stateful service replica is primary.</span></span> <span data-ttu-id="d4d74-136">O método `RunAsync` é cancelado quando a função de uma réplica primária é alterada para algo diferente de primária e também durante os eventos close e abort.</span><span class="sxs-lookup"><span data-stu-id="d4d74-136">The `RunAsync` method is canceled when a primary replica's role changes away from primary, as well as during the close and abort events.</span></span>

<span data-ttu-id="d4d74-137">O uso do evento `OnChangeRoleAsync` permite que você execute o trabalho dependendo da função da réplica, bem como em resposta à mudança de função.</span><span class="sxs-lookup"><span data-stu-id="d4d74-137">Using the `OnChangeRoleAsync` event allows you to perform work depending on replica role as well as in response to role change.</span></span>

<span data-ttu-id="d4d74-138">Um serviço com estado também fornece os mesmos quatro eventos do ciclo de vida que o serviço sem estado, com a mesma semântica e casos de uso:</span><span class="sxs-lookup"><span data-stu-id="d4d74-138">A stateful service also provides the same four lifecycle events as a stateless service, with the same semantics and use cases:</span></span>

```csharp
* Task OnOpenAsync(IStatefulServicePartition, CancellationToken)
* Task OnCloseAsync(CancellationToken)
* void OnAbort()
```

## <a name="next-steps"></a><span data-ttu-id="d4d74-139">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="d4d74-139">Next steps</span></span>
<span data-ttu-id="d4d74-140">Para tópicos mais avançados relacionados ao Service Fabric, consulte os artigos a seguir:</span><span class="sxs-lookup"><span data-stu-id="d4d74-140">For more advanced topics related to Service Fabric, see the following articles:</span></span>

* [<span data-ttu-id="d4d74-141">Configurando Reliable Services com estado</span><span class="sxs-lookup"><span data-stu-id="d4d74-141">Configuring stateful Reliable Services</span></span>](service-fabric-reliable-services-configuration.md)
* [<span data-ttu-id="d4d74-142">Introdução à integridade da Malha do Serviço</span><span class="sxs-lookup"><span data-stu-id="d4d74-142">Service Fabric health introduction</span></span>](service-fabric-health-introduction.md)
* [<span data-ttu-id="d4d74-143">Usando relatórios de integridade do sistema para solução de problemas</span><span class="sxs-lookup"><span data-stu-id="d4d74-143">Using system health reports for troubleshooting</span></span>](service-fabric-understand-and-troubleshoot-with-system-health-reports.md)
* [<span data-ttu-id="d4d74-144">Configurando serviços com o Gerenciador de Recursos de Cluster do Service Fabric</span><span class="sxs-lookup"><span data-stu-id="d4d74-144">Configuring Services with the Service Fabric Cluster Resource Manager</span></span>](service-fabric-cluster-resource-manager-configure-services.md)
