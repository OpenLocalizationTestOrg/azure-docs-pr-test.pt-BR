---
title: "Adicionar relatórios de integridade personalizados do Service Fabric | Microsoft Docs"
description: "Descreve como enviar relatórios de integridade personalizados para entidades de integridade da Malha de Serviço do Azure. Fornece recomendações para projetar e implementar relatórios de integridade de qualidade."
services: service-fabric
documentationcenter: .net
author: oanapl
manager: timlt
editor: 
ms.assetid: 0a00a7d2-510e-47d0-8aa8-24c851ea847f
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/19/2017
ms.author: oanapl
ms.openlocfilehash: ed10eef347d4d93012078456b3a145589e66d30e
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/18/2017
---
# <a name="add-custom-service-fabric-health-reports"></a><span data-ttu-id="34795-104">Adicionar relatórios de integridade personalizados do Service Fabric</span><span class="sxs-lookup"><span data-stu-id="34795-104">Add custom Service Fabric health reports</span></span>
<span data-ttu-id="34795-105">O Azure Service Fabric apresenta um [modelo de integridade](service-fabric-health-introduction.md) desenvolvido para sinalizar condições de cluster e aplicativo não íntegras em entidades específicas.</span><span class="sxs-lookup"><span data-stu-id="34795-105">Azure Service Fabric introduces a [health model](service-fabric-health-introduction.md) designed to flag unhealthy cluster and application conditions on specific entities.</span></span> <span data-ttu-id="34795-106">O modelo de integridade usa **relatores de integridade** (componentes do sistema e watchdogs).</span><span class="sxs-lookup"><span data-stu-id="34795-106">The health model uses **health reporters** (system components and watchdogs).</span></span> <span data-ttu-id="34795-107">O objetivo é facilitar e agilizar o diagnóstico e o reparo.</span><span class="sxs-lookup"><span data-stu-id="34795-107">The goal is easy and fast diagnosis and repair.</span></span> <span data-ttu-id="34795-108">Os criadores de serviço precisam pensar à frente sobre a integridade.</span><span class="sxs-lookup"><span data-stu-id="34795-108">Service writers need to think upfront about health.</span></span> <span data-ttu-id="34795-109">Qualquer condição que possa afetar a integridade deve ser apontada, especialmente se ela puder ajudar a sinalizar problemas próximos da raiz.</span><span class="sxs-lookup"><span data-stu-id="34795-109">Any condition that can impact health should be reported on, especially if it can help flag problems close to the root.</span></span> <span data-ttu-id="34795-110">As informações de integridade podem economizar tempo e esforço na investigação e depuração.</span><span class="sxs-lookup"><span data-stu-id="34795-110">The health information can save time and effort on debugging and investigation.</span></span> <span data-ttu-id="34795-111">A utilidade é especialmente clara quando o serviço está em funcionamento em grande escala na nuvem (Azure ou privada).</span><span class="sxs-lookup"><span data-stu-id="34795-111">The usefulness is especially clear once the service is up and running at scale in the cloud (private or Azure).</span></span>

<span data-ttu-id="34795-112">Os relatores da Malha de Serviço monitoram condições identificadas de interesse.</span><span class="sxs-lookup"><span data-stu-id="34795-112">The Service Fabric reporters monitor identified conditions of interest.</span></span> <span data-ttu-id="34795-113">Eles informam essas condições com base na respectiva exibição local.</span><span class="sxs-lookup"><span data-stu-id="34795-113">They report on those conditions based on their local view.</span></span> <span data-ttu-id="34795-114">O [repositório de integridade](service-fabric-health-introduction.md#health-store) agrega dados de integridade enviados por todos os relatores para determinar se as entidades estão globalmente íntegras.</span><span class="sxs-lookup"><span data-stu-id="34795-114">The [health store](service-fabric-health-introduction.md#health-store) aggregates health data sent by all reporters to determine whether entities are globally healthy.</span></span> <span data-ttu-id="34795-115">O modelo foi desenvolvido com a intenção de ser completo, flexível e fácil de usar.</span><span class="sxs-lookup"><span data-stu-id="34795-115">The model is intended to be rich, flexible, and easy to use.</span></span> <span data-ttu-id="34795-116">A qualidade dos relatórios de integridade determina a precisão da exibição de integridade do cluster.</span><span class="sxs-lookup"><span data-stu-id="34795-116">The quality of the health reports determines the accuracy of the health view of the cluster.</span></span> <span data-ttu-id="34795-117">Falsos positivos que mostram incorretamente problemas de integridade podem afetar negativamente atualizações ou outros serviços que usam dados de integridade.</span><span class="sxs-lookup"><span data-stu-id="34795-117">False positives that wrongly show unhealthy issues can negatively impact upgrades or other services that use health data.</span></span> <span data-ttu-id="34795-118">Exemplos de tais serviços são os serviços de reparo e os mecanismos de alerta.</span><span class="sxs-lookup"><span data-stu-id="34795-118">Examples of such services are repair services and alerting mechanisms.</span></span> <span data-ttu-id="34795-119">Portanto, é necessário um pouco de criatividade para fornecer relatórios que capturem condições de interesse da melhor forma possível.</span><span class="sxs-lookup"><span data-stu-id="34795-119">Therefore, some thought is needed to provide reports that capture conditions of interest in the best possible way.</span></span>

<span data-ttu-id="34795-120">Para projetar e implementar relatórios de integridade, os watchdogs e os componentes do sistema devem:</span><span class="sxs-lookup"><span data-stu-id="34795-120">To design and implement health reporting, watchdogs and system components must:</span></span>

* <span data-ttu-id="34795-121">Definir a condição de interesse, como ela será monitorada e o impacto sobre a funcionalidade do cluster ou do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="34795-121">Define the condition they are interested in, the way it is monitored, and the impact on the cluster or application functionality.</span></span> <span data-ttu-id="34795-122">Com base nessas informações, escolha a propriedade de relatório de integridade e o estado de integridade.</span><span class="sxs-lookup"><span data-stu-id="34795-122">Based on this information, decide on the health report property and health state.</span></span>
* <span data-ttu-id="34795-123">Determine a [entidade](service-fabric-health-introduction.md#health-entities-and-hierarchy) à qual o relatório se aplica.</span><span class="sxs-lookup"><span data-stu-id="34795-123">Determine the [entity](service-fabric-health-introduction.md#health-entities-and-hierarchy) that the report applies to.</span></span>
* <span data-ttu-id="34795-124">Determine onde o relatório é realizado, do watchdog dentro do serviço ou de um watchdog interno ou externo.</span><span class="sxs-lookup"><span data-stu-id="34795-124">Determine where the reporting is done, from within the service or from an internal or external watchdog.</span></span>
* <span data-ttu-id="34795-125">Definir uma fonte usada para identificar o relator.</span><span class="sxs-lookup"><span data-stu-id="34795-125">Define a source used to identify the reporter.</span></span>
* <span data-ttu-id="34795-126">Escolher uma estratégia de relatório: periodicamente ou nas transições.</span><span class="sxs-lookup"><span data-stu-id="34795-126">Choose a reporting strategy, either periodically or on transitions.</span></span> <span data-ttu-id="34795-127">A maneira recomendada é periodicamente, pois exige código mais simples e está menos sujeita a erros.</span><span class="sxs-lookup"><span data-stu-id="34795-127">The recommended way is periodically, as it requires simpler code and is less prone to errors.</span></span>
* <span data-ttu-id="34795-128">Determinar por quanto tempo o relatório de condições não íntegras deve permanecer no repositório de integridade e como ele deve ser eliminado.</span><span class="sxs-lookup"><span data-stu-id="34795-128">Determine how long the report for unhealthy conditions should stay in the health store and how it should be cleared.</span></span> <span data-ttu-id="34795-129">Usando essas informações, decida a vida útil do relatório e o comportamento de remoção à expiração.</span><span class="sxs-lookup"><span data-stu-id="34795-129">Using this information, decide the report's time to live and remove-on-expiration behavior.</span></span>

<span data-ttu-id="34795-130">Conforme mencionado, o relatório pode ser gerado:</span><span class="sxs-lookup"><span data-stu-id="34795-130">As mentioned, reporting can be done from:</span></span>

* <span data-ttu-id="34795-131">Na réplica do serviço da Malha de Serviço monitorada.</span><span class="sxs-lookup"><span data-stu-id="34795-131">The monitored Service Fabric service replica.</span></span>
* <span data-ttu-id="34795-132">De watchdogs internos implantados como um serviço do Service Fabric (por exemplo, um serviço sem estado do Service Fabric que monitora as condições e emite relatórios).</span><span class="sxs-lookup"><span data-stu-id="34795-132">Internal watchdogs deployed as a Service Fabric service (for example, a Service Fabric stateless service that monitors conditions and issues reports).</span></span> <span data-ttu-id="34795-133">Os watchdogs podem ser implantados em todos os nós ou podem ser relacionados por afinidade com o serviço monitorado.</span><span class="sxs-lookup"><span data-stu-id="34795-133">The watchdogs can be deployed an all nodes or can be affinitized to the monitored service.</span></span>
* <span data-ttu-id="34795-134">Watchdogs internos que são executados nos nós do Service Fabric, mas que *não* são implementados como serviços do Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="34795-134">Internal watchdogs that run on the Service Fabric nodes but are *not* implemented as Service Fabric services.</span></span>
* <span data-ttu-id="34795-135">De watchdogs externos que testam o recurso de *fora* do cluster do Service Fabric (por exemplo, um serviço de monitoramento, como o Gomez).</span><span class="sxs-lookup"><span data-stu-id="34795-135">External watchdogs that probe the resource from *outside* the Service Fabric cluster (for example, monitoring service like Gomez).</span></span>

> [!NOTE]
> <span data-ttu-id="34795-136">Pronto para uso, o cluster é populado com relatórios de integridade enviados pelos componentes do sistema.</span><span class="sxs-lookup"><span data-stu-id="34795-136">Out of the box, the cluster is populated with health reports sent by the system components.</span></span> <span data-ttu-id="34795-137">Leia mais em [Usando relatórios de integridade do sistema para solução de problemas](service-fabric-understand-and-troubleshoot-with-system-health-reports.md).</span><span class="sxs-lookup"><span data-stu-id="34795-137">Read more at [Using system health reports for troubleshooting](service-fabric-understand-and-troubleshoot-with-system-health-reports.md).</span></span> <span data-ttu-id="34795-138">Os relatórios do usuário devem ser enviados em [entidades de integridade](service-fabric-health-introduction.md#health-entities-and-hierarchy) que já foram criadas pelo sistema.</span><span class="sxs-lookup"><span data-stu-id="34795-138">The user reports must be sent on [health entities](service-fabric-health-introduction.md#health-entities-and-hierarchy) that have already been created by the system.</span></span>
> 
> 

<span data-ttu-id="34795-139">Uma vez o design de relatório de integridade estiver claro, os relatórios de integridade poderão ser enviados facilmente.</span><span class="sxs-lookup"><span data-stu-id="34795-139">Once the health reporting design is clear, health reports can be sent easily.</span></span> <span data-ttu-id="34795-140">Você poderá usar o [FabricClient](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient) para relatar a integridade se o cluster não for [seguro](service-fabric-cluster-security.md) ou se o cliente de malha tiver privilégios administrativos.</span><span class="sxs-lookup"><span data-stu-id="34795-140">You can use [FabricClient](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient) to report health if the cluster is not [secure](service-fabric-cluster-security.md) or if the fabric client has admin privileges.</span></span> <span data-ttu-id="34795-141">O relatório pode ser produzido pela API usando o [FabricClient.HealthManager.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth), por meio do PowerShell ou REST.</span><span class="sxs-lookup"><span data-stu-id="34795-141">Reporting can be done through the API by using [FabricClient.HealthManager.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth), through PowerShell, or through REST.</span></span> <span data-ttu-id="34795-142">Botões de configuração que dividem os relatórios em lotes para melhor desempenho.</span><span class="sxs-lookup"><span data-stu-id="34795-142">Configuration knobs batch reports for improved performance.</span></span>

> [!NOTE]
> <span data-ttu-id="34795-143">O relatório de integridade é síncrono e representa apenas o trabalho de validação no lado do cliente.</span><span class="sxs-lookup"><span data-stu-id="34795-143">Report health is synchronous, and it represents only the validation work on the client side.</span></span> <span data-ttu-id="34795-144">O fato de que o relatório é aceito pelo cliente de integridade, ou pelos objetos `Partition` ou `CodePackageActivationContext`, não significa que ele será aplicado no repositório.</span><span class="sxs-lookup"><span data-stu-id="34795-144">The fact that the report is accepted by the health client or the `Partition` or `CodePackageActivationContext` objects doesn't mean that it is applied in the store.</span></span> <span data-ttu-id="34795-145">Ele será enviado de forma assíncrona e, possivelmente, em lote com outros relatórios.</span><span class="sxs-lookup"><span data-stu-id="34795-145">It is sent asynchronously and possibly batched with other reports.</span></span> <span data-ttu-id="34795-146">O processamento no servidor ainda pode falhar: o número de sequência é obsoleto, a entidade na qual o relatório deve ser aplicado foi excluída, etc.</span><span class="sxs-lookup"><span data-stu-id="34795-146">The processing on the server may still fail: the sequence number could be stale, the entity on which the report must be applied has been deleted, etc.</span></span>
> 
> 

## <a name="health-client"></a><span data-ttu-id="34795-147">Cliente de integridade</span><span class="sxs-lookup"><span data-stu-id="34795-147">Health client</span></span>
<span data-ttu-id="34795-148">Os relatórios de integridade são enviados ao repositório de integridade usando um cliente de integridade, que reside dentro do cliente de malha.</span><span class="sxs-lookup"><span data-stu-id="34795-148">The health reports are sent to the health store through a health client, which lives inside the fabric client.</span></span> <span data-ttu-id="34795-149">O cliente de integridade pode ser configurado da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="34795-149">The health client can be configured with the following settings:</span></span>

* <span data-ttu-id="34795-150">**HealthReportSendInterval**: o atraso entre a hora em que o relatório é adicionado ao cliente e a hora em que ele é enviado ao repositório de integridade.</span><span class="sxs-lookup"><span data-stu-id="34795-150">**HealthReportSendInterval**: The delay between the time the report is added to the client and the time it is sent to the health store.</span></span> <span data-ttu-id="34795-151">Usado para relatórios de lote em uma única mensagem, em vez de enviar uma mensagem para cada relatório.</span><span class="sxs-lookup"><span data-stu-id="34795-151">Used to batch reports into a single message, rather than sending one message for each report.</span></span> <span data-ttu-id="34795-152">O envio em lote melhora o desempenho.</span><span class="sxs-lookup"><span data-stu-id="34795-152">The batching improves performance.</span></span> <span data-ttu-id="34795-153">Padrão: 30 segundos.</span><span class="sxs-lookup"><span data-stu-id="34795-153">Default: 30 seconds.</span></span>
* <span data-ttu-id="34795-154">**HealthReportRetrySendInterval**: o intervalo no qual o cliente de integridade reenvia os relatórios de integridade acumulados ao repositório de integridade.</span><span class="sxs-lookup"><span data-stu-id="34795-154">**HealthReportRetrySendInterval**: The interval at which the health client resends accumulated health reports to the health store.</span></span> <span data-ttu-id="34795-155">Padrão: 30 segundos.</span><span class="sxs-lookup"><span data-stu-id="34795-155">Default: 30 seconds.</span></span>
* <span data-ttu-id="34795-156">**HealthOperationTimeout**: o período de tempo limite para uma mensagem de relatório enviada ao repositório de integridade.</span><span class="sxs-lookup"><span data-stu-id="34795-156">**HealthOperationTimeout**: The timeout period for a report message sent to the health store.</span></span> <span data-ttu-id="34795-157">Se a mensagem atingir o tempo limite, o cliente de integridade fará uma nova tentativa até que o repositório de integridade confirme que o relatório foi processado.</span><span class="sxs-lookup"><span data-stu-id="34795-157">If a message times out, the health client retries it until the health store confirms that the report has been processed.</span></span> <span data-ttu-id="34795-158">Padrão: dois minutos.</span><span class="sxs-lookup"><span data-stu-id="34795-158">Default: two minutes.</span></span>

> [!NOTE]
> <span data-ttu-id="34795-159">Quando os relatórios são agrupados em lotes, o cliente de malha deve ser mantido em atividade até que, pelo menos, HealthReportSendInterval garanta que eles sejam enviados.</span><span class="sxs-lookup"><span data-stu-id="34795-159">When the reports are batched, the fabric client must be kept alive for at least the HealthReportSendInterval to ensure that they are sent.</span></span> <span data-ttu-id="34795-160">Se a mensagem for perdida ou o repositório de integridade não puder aplicá-la devido a erros transitórios, o cliente da malha deverá ser mantido em atividade por mais tempo para que tenha a chance de tentar novamente.</span><span class="sxs-lookup"><span data-stu-id="34795-160">If the message is lost or the health store cannot apply them due to transient errors, the fabric client must be kept alive longer to give it a chance to retry.</span></span>
> 
> 

<span data-ttu-id="34795-161">O armazenamento em buffer no cliente leva a exclusividade dos relatórios em consideração.</span><span class="sxs-lookup"><span data-stu-id="34795-161">The buffering on the client takes the uniqueness of the reports into consideration.</span></span> <span data-ttu-id="34795-162">Por exemplo, se um relator específico com problemas estiver relatando 100 relatórios por segundo na mesma propriedade da mesma entidade, os relatórios serão substituídos pela versão mais recente.</span><span class="sxs-lookup"><span data-stu-id="34795-162">For example, if a particular bad reporter is reporting 100 reports per second on the same property of the same entity, the reports are replaced with the last version.</span></span> <span data-ttu-id="34795-163">Existe, no máximo, um relatório como este na fila do cliente.</span><span class="sxs-lookup"><span data-stu-id="34795-163">At most one such report exists in the client queue.</span></span> <span data-ttu-id="34795-164">Se o envio em lote estiver configurado, o número de relatórios enviados ao repositório de integridade é de apenas um por intervalo de envio.</span><span class="sxs-lookup"><span data-stu-id="34795-164">If batching is configured, the number of reports sent to the health store is just one per send interval.</span></span> <span data-ttu-id="34795-165">Este relatório é o último adicionado, que reflete o estado mais atual da entidade.</span><span class="sxs-lookup"><span data-stu-id="34795-165">This report is the last added report, which reflects the most current state of the entity.</span></span>
<span data-ttu-id="34795-166">Os parâmetros de configuração podem ser especificados quando `FabricClient` é criado, passando o [FabricClientSettings](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclientsettings) com os valores desejados para as entradas relacionadas à integridade.</span><span class="sxs-lookup"><span data-stu-id="34795-166">Specify configuration parameters when `FabricClient` is created by passing [FabricClientSettings](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclientsettings) with the desired values for health-related entries.</span></span>

<span data-ttu-id="34795-167">O exemplo a seguir cria um cliente de malha e especifica que os relatórios devem ser enviados quando forem adicionados.</span><span class="sxs-lookup"><span data-stu-id="34795-167">The following example creates a fabric client and specifies that the reports should be sent when they are added.</span></span> <span data-ttu-id="34795-168">Em tempos limite e erros que podem ser recuperados, as repetições ocorrem a cada 40 segundos.</span><span class="sxs-lookup"><span data-stu-id="34795-168">On timeouts and errors that can be retried, retries happen every 40 seconds.</span></span>

```csharp
var clientSettings = new FabricClientSettings()
{
    HealthOperationTimeout = TimeSpan.FromSeconds(120),
    HealthReportSendInterval = TimeSpan.FromSeconds(0),
    HealthReportRetrySendInterval = TimeSpan.FromSeconds(40),
};
var fabricClient = new FabricClient(clientSettings);
```

<span data-ttu-id="34795-169">Recomendamos manter as configurações padrão de cliente de malha, que definem `HealthReportSendInterval` para 30 segundos.</span><span class="sxs-lookup"><span data-stu-id="34795-169">We recommend keeping the default fabric client settings, which set `HealthReportSendInterval` to 30 seconds.</span></span> <span data-ttu-id="34795-170">Essa configuração garante um desempenho ideal devido ao envio em lote.</span><span class="sxs-lookup"><span data-stu-id="34795-170">This setting ensures optimal performance due to batching.</span></span> <span data-ttu-id="34795-171">Para relatórios importantes que devem ser enviados o quanto antes, use `HealthReportSendOptions` com `true` imediato na API do [FabricClient.HealthClient.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth).</span><span class="sxs-lookup"><span data-stu-id="34795-171">For critical reports that must be sent as soon as possible, use `HealthReportSendOptions` with Immediate `true` in [FabricClient.HealthClient.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth) API.</span></span> <span data-ttu-id="34795-172">Relatórios imediatos ignoram o intervalo de envio em lote.</span><span class="sxs-lookup"><span data-stu-id="34795-172">Immediate reports bypass the batching interval.</span></span> <span data-ttu-id="34795-173">Use este sinalizador com cuidado. Queremos aproveitar o envio em lote do cliente de integridade sempre que possível.</span><span class="sxs-lookup"><span data-stu-id="34795-173">Use this flag with care; we want to take advantage of the health client batching whenever possible.</span></span> <span data-ttu-id="34795-174">O envio imediato também é útil quando o cliente de malha está em encerramento (por exemplo, o processo determinou estado inválido e precisa ser desligado para evitar efeitos colaterais).</span><span class="sxs-lookup"><span data-stu-id="34795-174">Immediate send is also useful when the fabric client is closing (for example, the process has determined invalid state and needs to shut down to prevent side effects).</span></span> <span data-ttu-id="34795-175">Isso garante envios de melhor esforço dos relatórios acumulados.</span><span class="sxs-lookup"><span data-stu-id="34795-175">It ensures a best-effort send of the accumulated reports.</span></span> <span data-ttu-id="34795-176">Quando um relatório é adicionado com o sinalizador de Imediato, o cliente de integridade envia em lote todos os relatórios acumulados desde o último envio.</span><span class="sxs-lookup"><span data-stu-id="34795-176">When one report is added with Immediate flag, the health client batches all the accumulated reports since last send.</span></span>

<span data-ttu-id="34795-177">Os mesmos parâmetros podem ser especificados ao criar uma conexão com um cluster por meio do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="34795-177">Same parameters can be specified when a connection to a cluster is created through PowerShell.</span></span> <span data-ttu-id="34795-178">Veja abaixo o início de uma conexão com um cluster local:</span><span class="sxs-lookup"><span data-stu-id="34795-178">The following example starts a connection to a local cluster:</span></span>

```powershell
PS C:\> Connect-ServiceFabricCluster -HealthOperationTimeoutInSec 120 -HealthReportSendIntervalInSec 0 -HealthReportRetrySendIntervalInSec 40
True

ConnectionEndpoint   :
FabricClientSettings : {
                       ClientFriendlyName                   : PowerShell-1944858a-4c6d-465f-89c7-9021c12ac0bb
                       PartitionLocationCacheLimit          : 100000
                       PartitionLocationCacheBucketCount    : 1024
                       ServiceChangePollInterval            : 00:02:00
                       ConnectionInitializationTimeout      : 00:00:02
                       KeepAliveInterval                    : 00:00:20
                       HealthOperationTimeout               : 00:02:00
                       HealthReportSendInterval             : 00:00:00
                       HealthReportRetrySendInterval        : 00:00:40
                       NotificationGatewayConnectionTimeout : 00:00:00
                       NotificationCacheUpdateTimeout       : 00:00:00
                       }
GatewayInformation   : {
                       NodeAddress                          : localhost:19000
                       NodeId                               : 1880ec88a3187766a6da323399721f53
                       NodeInstanceId                       : 130729063464981219
                       NodeName                             : Node.1
                       }
```

<span data-ttu-id="34795-179">Os relatórios podem ser enviados de maneira semelhante à API, usando o comutador `-Immediate` a ser enviado imediatamente, independentemente do valor `HealthReportSendInterval`.</span><span class="sxs-lookup"><span data-stu-id="34795-179">Similarly to API, reports can be sent using `-Immediate` switch to be sent immediately, regardless of the `HealthReportSendInterval` value.</span></span>

<span data-ttu-id="34795-180">Para REST, os relatórios são enviados para o gateway do Service Fabric, que tem um cliente de malha interno.</span><span class="sxs-lookup"><span data-stu-id="34795-180">For REST, the reports are sent to the Service Fabric gateway, which has an internal fabric client.</span></span> <span data-ttu-id="34795-181">Por padrão, esse cliente está configurado para enviar relatórios em lote a cada 30 segundos.</span><span class="sxs-lookup"><span data-stu-id="34795-181">By default, this client is configured to send reports batched every 30 seconds.</span></span> <span data-ttu-id="34795-182">Você pode alterar o intervalo de lote com a configuração de cluster `HttpGatewayHealthReportSendInterval` em `HttpGateway`.</span><span class="sxs-lookup"><span data-stu-id="34795-182">You can change the batch interval with the cluster configuration setting `HttpGatewayHealthReportSendInterval` on `HttpGateway`.</span></span> <span data-ttu-id="34795-183">Conforme mencionado, a melhor opção é enviar os relatórios com `Immediate` verdadeiro.</span><span class="sxs-lookup"><span data-stu-id="34795-183">As mentioned, a better option is to send the reports with `Immediate` true.</span></span> 

> [!NOTE]
> <span data-ttu-id="34795-184">Para garantir que os serviços não autorizados não possam relatar a integridade em relação às entidades no cluster, o servidor pode ser configurado para aceitar somente solicitações de clientes protegidos.</span><span class="sxs-lookup"><span data-stu-id="34795-184">To ensure that unauthorized services can't report health against the entities in the cluster, configure the server to accept requests only from secured clients.</span></span> <span data-ttu-id="34795-185">O `FabricClient` usado para o relatório deve ter a segurança habilitada para ser capaz de se comunicar com o cluster (por exemplo, com a autenticação Kerberos ou de certificado).</span><span class="sxs-lookup"><span data-stu-id="34795-185">The `FabricClient` used for reporting must have security enabled to be able to communicate with the cluster (for example, with Kerberos or certificate authentication).</span></span> <span data-ttu-id="34795-186">Leia mais sobre [segurança de cluster](service-fabric-cluster-security.md).</span><span class="sxs-lookup"><span data-stu-id="34795-186">Read more about [cluster security](service-fabric-cluster-security.md).</span></span>
> 
> 

## <a name="report-from-within-low-privilege-services"></a><span data-ttu-id="34795-187">Relatório nos serviços de baixo privilégio</span><span class="sxs-lookup"><span data-stu-id="34795-187">Report from within low privilege services</span></span>
<span data-ttu-id="34795-188">Se os serviços do Service Fabric não têm acesso administrativo ao cluster, você pode enviar relatórios de integridade sobre entidades do contexto atual por meio de `Partition` ou `CodePackageActivationContext`.</span><span class="sxs-lookup"><span data-stu-id="34795-188">If Service Fabric services do not have admin access to the cluster, you can report health on entities from the current context through `Partition` or `CodePackageActivationContext`.</span></span>

* <span data-ttu-id="34795-189">Em serviços sem estado, use [IStatelessServicePartition.ReportInstanceHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatelessservicepartition.reportinstancehealth) para relatar a instância atual do serviço.</span><span class="sxs-lookup"><span data-stu-id="34795-189">For stateless services, use [IStatelessServicePartition.ReportInstanceHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatelessservicepartition.reportinstancehealth) to report on the current service instance.</span></span>
* <span data-ttu-id="34795-190">Em serviços com estado, use [IStatefulServicePartition.ReportReplicaHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatefulservicepartition.reportreplicahealth) para relatar a réplica atual.</span><span class="sxs-lookup"><span data-stu-id="34795-190">For stateful services, use [IStatefulServicePartition.ReportReplicaHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatefulservicepartition.reportreplicahealth) to report on current replica.</span></span>
* <span data-ttu-id="34795-191">Use [IServicePartition.ReportPartitionHealth](https://docs.microsoft.com/dotnet/api/system.fabric.iservicepartition.reportpartitionhealth) para relatar a entidade de partição atual.</span><span class="sxs-lookup"><span data-stu-id="34795-191">Use [IServicePartition.ReportPartitionHealth](https://docs.microsoft.com/dotnet/api/system.fabric.iservicepartition.reportpartitionhealth) to report on the current partition entity.</span></span>
* <span data-ttu-id="34795-192">Use [CodePackageActivationContext.ReportApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportapplicationhealth) para relatar o aplicativo atual.</span><span class="sxs-lookup"><span data-stu-id="34795-192">Use [CodePackageActivationContext.ReportApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportapplicationhealth) to report on current application.</span></span>
* <span data-ttu-id="34795-193">Use [CodePackageActivationContext.ReportDeployedApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedapplicationhealth) para relatar o aplicativo atual implantado no nó atual.</span><span class="sxs-lookup"><span data-stu-id="34795-193">Use [CodePackageActivationContext.ReportDeployedApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedapplicationhealth) to report on the current application deployed on the current node.</span></span>
* <span data-ttu-id="34795-194">Use [CodePackageActivationContext.ReportDeployedServicePackageHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedservicepackagehealth) para enviar relatório sobre um pacote de serviços ao aplicativo atual implantado no nó atual.</span><span class="sxs-lookup"><span data-stu-id="34795-194">Use [CodePackageActivationContext.ReportDeployedServicePackageHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedservicepackagehealth) to report on a service package for the application deployed on the current node.</span></span>

> [!NOTE]
> <span data-ttu-id="34795-195">Internamente, `Partition` e `CodePackageActivationContext` mantêm um cliente de integridade que é configurado com parâmetros padrão.</span><span class="sxs-lookup"><span data-stu-id="34795-195">Internally, the `Partition` and the `CodePackageActivationContext` hold a health client configured with default settings.</span></span> <span data-ttu-id="34795-196">Conforme explicado para o [cliente de integridade](service-fabric-report-health.md#health-client), os relatórios são reunidos e enviados em lote de acordo com um temporizador.</span><span class="sxs-lookup"><span data-stu-id="34795-196">As explained for the [health client](service-fabric-report-health.md#health-client), reports are batched and sent on a timer.</span></span> <span data-ttu-id="34795-197">Os objetos devem ser mantidos ativos para tentar enviar o relatório.</span><span class="sxs-lookup"><span data-stu-id="34795-197">The objects should be kept alive to have a chance to send the report.</span></span>
> 
> 

<span data-ttu-id="34795-198">Você pode especificar `HealthReportSendOptions` durante o envio de relatórios por meio de APIs de integridade de`Partition` e `CodePackageActivationContext`.</span><span class="sxs-lookup"><span data-stu-id="34795-198">You can specify `HealthReportSendOptions` when sending reports through `Partition` and `CodePackageActivationContext` health APIs.</span></span> <span data-ttu-id="34795-199">Se você tiver relatórios importantes que devem ser enviados assim que possível, use `HealthReportSendOptions` com `true` imediato.</span><span class="sxs-lookup"><span data-stu-id="34795-199">If you have critical reports that must be sent as soon as possible, use `HealthReportSendOptions` with Immediate `true`.</span></span> <span data-ttu-id="34795-200">Os relatórios imediatos ignoram o intervalo de envio em lote do cliente de integridade interno.</span><span class="sxs-lookup"><span data-stu-id="34795-200">Immediate reports bypass the batching interval of the internal health client.</span></span> <span data-ttu-id="34795-201">Como mencionado anteriormente, use este sinalizador com cuidado. Queremos aproveitar o envio em lote do cliente de integridade sempre que possível.</span><span class="sxs-lookup"><span data-stu-id="34795-201">As mentioned before, use this flag with care; we want to take advantage of the health client batching whenever possible.</span></span>

## <a name="design-health-reporting"></a><span data-ttu-id="34795-202">Projetar relatórios de integridade</span><span class="sxs-lookup"><span data-stu-id="34795-202">Design health reporting</span></span>
<span data-ttu-id="34795-203">A primeira etapa da geração de relatórios de alta qualidade é identificar as condições que podem afetar a integridade do serviço.</span><span class="sxs-lookup"><span data-stu-id="34795-203">The first step in generating high-quality reports is identifying the conditions that can impact the health of the service.</span></span> <span data-ttu-id="34795-204">Qualquer condição que possa ajudar a sinalizar problemas no serviço ou cluster no início ou, melhor ainda, antes de um problema ocorrer, tem o potencial para economizar bilhões de dólares.</span><span class="sxs-lookup"><span data-stu-id="34795-204">Any condition that can help flag problems in the service or cluster when it starts--or even better, before a problem happens--can potentially save billions of dollars.</span></span> <span data-ttu-id="34795-205">Os benefícios incluem menos tempo de inatividade, menos horas à noite gastas para investigar e corrigir problemas e maior satisfação do cliente.</span><span class="sxs-lookup"><span data-stu-id="34795-205">The benefits include less down time, fewer night hours spent investigating and repairing issues, and higher customer satisfaction.</span></span>

<span data-ttu-id="34795-206">Assim que as condições são identificadas, os desenvolvedores de watchdog precisam descobrir a melhor maneira de monitorá-las para atingir o equilíbrio entre sobrecarga e utilidade.</span><span class="sxs-lookup"><span data-stu-id="34795-206">Once the conditions are identified, watchdog writers need to figure out the best way to monitor them for balance between overhead and usefulness.</span></span> <span data-ttu-id="34795-207">Por exemplo, pense em um serviço que faça cálculos complexos usando alguns arquivos temporários em um compartilhamento.</span><span class="sxs-lookup"><span data-stu-id="34795-207">For example, consider a service that does complex calculations that use some temporary files on a share.</span></span> <span data-ttu-id="34795-208">Um watchdog pode monitorar o compartilhamento para garantir que haja espaço suficiente disponível.</span><span class="sxs-lookup"><span data-stu-id="34795-208">A watchdog could monitor the share to ensure that enough space is available.</span></span> <span data-ttu-id="34795-209">Ele pode escutar notificações de alterações em arquivo ou diretório.</span><span class="sxs-lookup"><span data-stu-id="34795-209">It could listen for notifications of file or directory changes.</span></span> <span data-ttu-id="34795-210">Ele pode relatar um aviso se um limite inicial for atingido e um erro se o compartilhamento estiver cheio.</span><span class="sxs-lookup"><span data-stu-id="34795-210">It could report a warning if an upfront threshold is reached, and report an error if the share is full.</span></span> <span data-ttu-id="34795-211">Ao aviso, um sistema de reparo pode começar a remover arquivos mais antigos do compartilhamento.</span><span class="sxs-lookup"><span data-stu-id="34795-211">On a warning, a repair system could start cleaning up older files on the share.</span></span> <span data-ttu-id="34795-212">Em um erro, um sistema de reparo pode mover a réplica de serviço para outro nó.</span><span class="sxs-lookup"><span data-stu-id="34795-212">On an error, a repair system could move the service replica to another node.</span></span> <span data-ttu-id="34795-213">Observe como os estados de condição são descritos em termos de integridade: o estado da condição que pode ser considerada íntegra (ok) ou não íntegra (aviso ou erro).</span><span class="sxs-lookup"><span data-stu-id="34795-213">Note how the condition states are described in terms of health: the state of the condition that can be considered healthy (ok) or unhealthy (warning or error).</span></span>

<span data-ttu-id="34795-214">Quando os detalhes do monitoramento são definidos, o criador do watchdog precisará descobrir como implementar o watchdog.</span><span class="sxs-lookup"><span data-stu-id="34795-214">Once the monitoring details are set, a watchdog writer needs to figure out how to implement the watchdog.</span></span> <span data-ttu-id="34795-215">Se as condições puderem ser determinadas dentro do serviço, o watchdog poderá fazer parte do próprio serviço monitorado.</span><span class="sxs-lookup"><span data-stu-id="34795-215">If the conditions can be determined from within the service, the watchdog can be part of the monitored service itself.</span></span> <span data-ttu-id="34795-216">Por exemplo, o código de serviço pode verificar o uso de compartilhamento e enviar relatórios sempre que tentar gravar um arquivo.</span><span class="sxs-lookup"><span data-stu-id="34795-216">For example, the service code can check the share usage, and then report every time it tries to write a file.</span></span> <span data-ttu-id="34795-217">A vantagem dessa abordagem é que o relatório é simples.</span><span class="sxs-lookup"><span data-stu-id="34795-217">The advantage of this approach is that reporting is simple.</span></span> <span data-ttu-id="34795-218">É preciso ter cuidado para evitar que bugs no watchdog afetem a funcionalidade do serviço.</span><span class="sxs-lookup"><span data-stu-id="34795-218">Care must be taken to prevent watchdog bugs from impacting the service functionality.</span></span>

<span data-ttu-id="34795-219">Os relatórios de dentro do serviço monitorado nem sempre são uma opção.</span><span class="sxs-lookup"><span data-stu-id="34795-219">Reporting from within the monitored service is not always an option.</span></span> <span data-ttu-id="34795-220">Um watchdog dentro do serviço não poderá detectar as condições.</span><span class="sxs-lookup"><span data-stu-id="34795-220">A watchdog within the service may not be able to detect the conditions.</span></span> <span data-ttu-id="34795-221">Ele pode não ter a lógica ou os dados para fazer a determinação.</span><span class="sxs-lookup"><span data-stu-id="34795-221">It may not have the logic or data to make the determination.</span></span> <span data-ttu-id="34795-222">A sobrecarga do monitoramento das condições pode ser alta.</span><span class="sxs-lookup"><span data-stu-id="34795-222">The overhead of monitoring the conditions may be high.</span></span> <span data-ttu-id="34795-223">As condições também podem não ser específicas para um serviço, mas, em vez disso, afetar as interações entre os serviços.</span><span class="sxs-lookup"><span data-stu-id="34795-223">The conditions also may not be specific to a service, but instead affect interactions between services.</span></span> <span data-ttu-id="34795-224">Outra opção é ter watchdogs no cluster como processos separados.</span><span class="sxs-lookup"><span data-stu-id="34795-224">Another option is to have watchdogs in the cluster as separate processes.</span></span> <span data-ttu-id="34795-225">Os watchdogs monitoram as condições e o relatório sem afetar os serviços principais.</span><span class="sxs-lookup"><span data-stu-id="34795-225">The watchdogs monitor the conditions and report, without affecting the main services in any way.</span></span> <span data-ttu-id="34795-226">Por exemplo, esses watchdogs podem ser implementados como serviços sem estado no mesmo aplicativo, implantados em todos os nós ou nos mesmos nós do serviço.</span><span class="sxs-lookup"><span data-stu-id="34795-226">For example, these watchdogs could be implemented as stateless services in the same application, deployed on all nodes or on the same nodes as the service.</span></span>

<span data-ttu-id="34795-227">Às vezes, um watchdog em execução no cluster também não é uma opção.</span><span class="sxs-lookup"><span data-stu-id="34795-227">Sometimes, a watchdog running in the cluster is not an option either.</span></span> <span data-ttu-id="34795-228">Se a condição monitorada for a disponibilidade ou a funcionalidade do serviço como os usuários a veem, é melhor ter os watchdogs no mesmo local que os clientes do usuário.</span><span class="sxs-lookup"><span data-stu-id="34795-228">If the monitored condition is the availability or functionality of the service as users see it, it's best to have the watchdogs in the same place as the user clients.</span></span> <span data-ttu-id="34795-229">Lá, eles podem testar as operações da mesma forma que os usuários as chamam.</span><span class="sxs-lookup"><span data-stu-id="34795-229">There, they can test the operations in the same way users call them.</span></span> <span data-ttu-id="34795-230">Por exemplo, você pode ter um watchdog que reside fora do cluster e emite solicitações para o serviço e, então, verifica a latência e a exatidão do resultado.</span><span class="sxs-lookup"><span data-stu-id="34795-230">For example, you can have a watchdog that lives outside the cluster, issues requests to the service, and checks the latency and correctness of the result.</span></span> <span data-ttu-id="34795-231">(Para um serviço de calculadora, por exemplo, 2+2 retorna 4 em um período de tempo razoável?)</span><span class="sxs-lookup"><span data-stu-id="34795-231">(For a calculator service, for example, does 2+2 return 4 in a reasonable amount of time?)</span></span>

<span data-ttu-id="34795-232">Depois que os detalhes do watchdog tiverem sido finalizados, escolha uma ID de origem que o identifique de modo exclusivo.</span><span class="sxs-lookup"><span data-stu-id="34795-232">Once the watchdog details have been finalized, you should decide on a source ID that uniquely identifies it.</span></span> <span data-ttu-id="34795-233">Se vários watchdogs do mesmo tipo são residentes no cluster, eles devem relatar entidades diferentes, ou, se eles relatam na mesma entidade, use ID de origem ou propriedade diferente.</span><span class="sxs-lookup"><span data-stu-id="34795-233">If multiple watchdogs of the same type are living in the cluster, they must report on different entities, or, if they report on the same entity, use different source ID or property.</span></span> <span data-ttu-id="34795-234">Dessa forma, os relatórios poderão coexistir.</span><span class="sxs-lookup"><span data-stu-id="34795-234">This way, their reports can coexist.</span></span> <span data-ttu-id="34795-235">A propriedade do relatório de integridade deve capturar a condição monitorada.</span><span class="sxs-lookup"><span data-stu-id="34795-235">The property of the health report should capture the monitored condition.</span></span> <span data-ttu-id="34795-236">(Para o exemplo anterior, a propriedade poderia ser **TamanhoDoCompartilhamento**). Se vários relatórios aplicarem-se à mesma condição, a propriedade deverá conter algumas informações dinâmicas que permitem a coexistência dos relatórios.</span><span class="sxs-lookup"><span data-stu-id="34795-236">(For the example above, the property could be **ShareSize**.) If multiple reports apply to the same condition, the property should contain some dynamic information that allows reports to coexist.</span></span> <span data-ttu-id="34795-237">Por exemplo, se houver vários compartilhamentos que precisem ser monitorados, o nome da propriedade poderá ser **TamanhoDoCompartilhamento-nomedocompartilhamento**.</span><span class="sxs-lookup"><span data-stu-id="34795-237">For example, if multiple shares need to be monitored, the property name can be **ShareSize-sharename**.</span></span>

> [!NOTE]
> <span data-ttu-id="34795-238">*Não* use o repositório de integridade para manter informações de status.</span><span class="sxs-lookup"><span data-stu-id="34795-238">Do *not* use the health store to keep status information.</span></span> <span data-ttu-id="34795-239">Apenas informações relacionadas à integridade devem ser relatadas como integridade, uma vez que essas informações afetam a avaliação de integridade de uma entidade.</span><span class="sxs-lookup"><span data-stu-id="34795-239">Only health-related information should be reported as health, as this information impacts the health evaluation of an entity.</span></span> <span data-ttu-id="34795-240">O repositório de integridade não foi desenvolvido como um repositório para fins gerais.</span><span class="sxs-lookup"><span data-stu-id="34795-240">The health store was not designed as a general-purpose store.</span></span> <span data-ttu-id="34795-241">Ele usa a lógica de avaliação de integridade para agregar todos os dados no estado de integridade.</span><span class="sxs-lookup"><span data-stu-id="34795-241">It uses health evaluation logic to aggregate all data into the health state.</span></span> <span data-ttu-id="34795-242">O envio de informações não relacionadas à integridade (como relatórios de status com um estado de integridade OK) não afetará o estado de integridade agregado, mas poderá afetar negativamente o desempenho do repositório de integridade.</span><span class="sxs-lookup"><span data-stu-id="34795-242">Sending information unrelated to health (like reporting status with a health state of OK) doesn't impact the aggregated health state, but it can negatively affect the performance of the health store.</span></span>
> 
> 

<span data-ttu-id="34795-243">O próximo ponto de decisão é qual entidade relatar.</span><span class="sxs-lookup"><span data-stu-id="34795-243">The next decision point is which entity to report on.</span></span> <span data-ttu-id="34795-244">A condição identifica a entidade na maioria das vezes.</span><span class="sxs-lookup"><span data-stu-id="34795-244">Most of the time, the condition clearly idetifies the entity.</span></span> <span data-ttu-id="34795-245">Você deve escolher a entidade com a melhor granularidade possível.</span><span class="sxs-lookup"><span data-stu-id="34795-245">Choose the entity with best possible granularity.</span></span> <span data-ttu-id="34795-246">Se uma condição afeta todas as réplicas em uma partição, reporte a partição, não o serviço.</span><span class="sxs-lookup"><span data-stu-id="34795-246">If a condition impacts all replicas in a partition, report on the partition, not on the service.</span></span> <span data-ttu-id="34795-247">Porém, há situações extremas em que é preciso ter mais cuidado.</span><span class="sxs-lookup"><span data-stu-id="34795-247">There are corner cases where more thought is needed, though.</span></span> <span data-ttu-id="34795-248">Se a condição afetar uma entidade, como uma réplica, mas o que se quer é sinalizar a condição por mais tempo do que a duração da vida útil da réplica, ela deverá ser relatada na partição.</span><span class="sxs-lookup"><span data-stu-id="34795-248">If the condition impacts an entity, such as a replica, but the desire is to have the condition flagged for more than the duration of replica life, then it should be reported on the partition.</span></span> <span data-ttu-id="34795-249">Caso contrário, quando a réplica for excluída, o repositório de integridade apagará todos os seus relatórios.</span><span class="sxs-lookup"><span data-stu-id="34795-249">Otherwise, when the replica is deleted, the health store cleans up all its reports.</span></span> <span data-ttu-id="34795-250">Os gravadores de watchdog devem pensar sobre o tempo de vida da entidade e do relatório.</span><span class="sxs-lookup"><span data-stu-id="34795-250">Watchdog writers must think about the lifetimes of the entity and the report.</span></span> <span data-ttu-id="34795-251">Deve ficar claro quando um relatório deverá ser eliminado de um repositório (por exemplo, quando um erro relatado em uma entidade não for mais aplicável).</span><span class="sxs-lookup"><span data-stu-id="34795-251">It must be clear when a report should be cleaned up from a store (for example, when an error reported on an entity no longer applies).</span></span>

<span data-ttu-id="34795-252">Vamos analisar um exemplo que reúne os pontos que descrevi.</span><span class="sxs-lookup"><span data-stu-id="34795-252">Let's look at an example that puts together the points I described.</span></span> <span data-ttu-id="34795-253">Considere um aplicativo do Service Fabric composto por um serviço persistente com estado mestre e serviços sem estado secundários implantados em todos os nós (um tipo de serviço secundário para cada tipo de tarefa).</span><span class="sxs-lookup"><span data-stu-id="34795-253">Consider a Service Fabric application composed of a master stateful persistent service and secondary stateless services deployed on all nodes (one secondary service type for each type of task).</span></span> <span data-ttu-id="34795-254">O mestre tem uma fila de processamento que contém os comandos a serem executados pelos secundários.</span><span class="sxs-lookup"><span data-stu-id="34795-254">The master has a processing queue that contains commands to be executed by secondaries.</span></span> <span data-ttu-id="34795-255">Os secundários executam as solicitações de entrada e enviam de volta sinais de confirmação.</span><span class="sxs-lookup"><span data-stu-id="34795-255">The secondaries execute the incoming requests and send back acknowledgement signals.</span></span> <span data-ttu-id="34795-256">Uma condição que pode ser monitorada é o comprimento da fila de processamento mestre.</span><span class="sxs-lookup"><span data-stu-id="34795-256">One condition that could be monitored is the length of the master processing queue.</span></span> <span data-ttu-id="34795-257">Se o comprimento da fila mestre atingir um limite, um aviso é relatado.</span><span class="sxs-lookup"><span data-stu-id="34795-257">If the master queue length reaches a threshold, a warning is reported.</span></span> <span data-ttu-id="34795-258">O aviso indica que os secundários não conseguem processar a carga.</span><span class="sxs-lookup"><span data-stu-id="34795-258">The warning indicates that the secondaries can't handle the load.</span></span> <span data-ttu-id="34795-259">Se a fila atinge o tamanho máximo e comandos são descartados, um erro será relatado, uma vez que não será possível recuperar o serviço.</span><span class="sxs-lookup"><span data-stu-id="34795-259">If the queue reaches the maximum length and commands are dropped, an error is reported, as the service can't recover.</span></span> <span data-ttu-id="34795-260">Os relatórios podem estar na propriedade **QueueStatus**.</span><span class="sxs-lookup"><span data-stu-id="34795-260">The reports can be on the property **QueueStatus**.</span></span> <span data-ttu-id="34795-261">O watchdog reside no serviço e é enviado periodicamente na réplica primária mestre.</span><span class="sxs-lookup"><span data-stu-id="34795-261">The watchdog lives inside the service, and it's sent periodically on the master primary replica.</span></span> <span data-ttu-id="34795-262">A vida útil é de dois minutos e é enviada periodicamente a cada 30 segundos.</span><span class="sxs-lookup"><span data-stu-id="34795-262">The time to live is two minutes, and it's sent periodically every 30 seconds.</span></span> <span data-ttu-id="34795-263">Se a primária falhar, o relatório será automaticamente removido do repositório.</span><span class="sxs-lookup"><span data-stu-id="34795-263">If the primary goes down, the report is cleaned up automatically from store.</span></span> <span data-ttu-id="34795-264">Se a réplica de serviço estiver ativa, mas apresentar deadlock ou outros problemas, o relatório expirará no Repositório de Integridade.</span><span class="sxs-lookup"><span data-stu-id="34795-264">If the service replica is up, but it is deadlocked or having other issues, the report expires in the health store.</span></span> <span data-ttu-id="34795-265">Neste caso, a entidade é avaliada no erro.</span><span class="sxs-lookup"><span data-stu-id="34795-265">In this case, the entity is evaluated at error.</span></span>

<span data-ttu-id="34795-266">Outra condição que pode ser monitorada é o tempo de execução da tarefa.</span><span class="sxs-lookup"><span data-stu-id="34795-266">Another condition that can be monitored is task execution time.</span></span> <span data-ttu-id="34795-267">O mestre distribui as tarefas aos secundários com base no tipo de tarefa.</span><span class="sxs-lookup"><span data-stu-id="34795-267">The master distributes tasks to the secondaries based on the task type.</span></span> <span data-ttu-id="34795-268">Dependendo do design, o mestre pode sondar os secundários quanto ao status da tarefa.</span><span class="sxs-lookup"><span data-stu-id="34795-268">Depending on the design, the master could poll the secondaries for task status.</span></span> <span data-ttu-id="34795-269">Ele também pode aguardar que os secundários enviem sinais de confirmação de volta quando tiverem concluído.</span><span class="sxs-lookup"><span data-stu-id="34795-269">It could also wait for secondaries to send back acknowledgement signals when they are done.</span></span> <span data-ttu-id="34795-270">No segundo caso, é preciso ter cuidado para detectar situações em que os subordinados são desativados ou as mensagens são perdidas.</span><span class="sxs-lookup"><span data-stu-id="34795-270">In the second case, care must be taken to detect situations where secondaries die or messages are lost.</span></span> <span data-ttu-id="34795-271">Uma opção é o mestre enviar uma solicitação de ping para o mesmo secundário, que envia o status de volta.</span><span class="sxs-lookup"><span data-stu-id="34795-271">One option is for the master to send a ping request to the same secondary, which sends back its status.</span></span> <span data-ttu-id="34795-272">Se nenhum status for recebido, o mestre considerará uma falha e reagendará a tarefa.</span><span class="sxs-lookup"><span data-stu-id="34795-272">If no status is received, the master considers it a failure and reschedules the task.</span></span> <span data-ttu-id="34795-273">Este comportamento pressupõe que as tarefas sejam idempotentes.</span><span class="sxs-lookup"><span data-stu-id="34795-273">This behavior assumes that the tasks are idempotent.</span></span>

<span data-ttu-id="34795-274">A condição monitorada poderá ser traduzida como um aviso se a tarefa não for executada em um determinado momento (**t1**, por exemplo, 10 minutos).</span><span class="sxs-lookup"><span data-stu-id="34795-274">The monitored condition can be translated as a warning if the task is not done in a certain time (**t1**, for example 10 minutes).</span></span> <span data-ttu-id="34795-275">Se a tarefa não for concluída no prazo (**t2**, por exemplo, 20 minutos), a condição monitorada poderá ser traduzida como Erro.</span><span class="sxs-lookup"><span data-stu-id="34795-275">If the task is not completed in time (**t2**, for example 20 minutes), the monitored condition can be translated as Error.</span></span> <span data-ttu-id="34795-276">Esse relatório pode ser gerado de várias maneiras:</span><span class="sxs-lookup"><span data-stu-id="34795-276">This reporting can be done in multiple ways:</span></span>

* <span data-ttu-id="34795-277">A réplica primária mestre relata a si mesma periodicamente.</span><span class="sxs-lookup"><span data-stu-id="34795-277">The master primary replica reports on itself periodically.</span></span> <span data-ttu-id="34795-278">Você pode ter uma propriedade para todas as tarefas pendentes na fila.</span><span class="sxs-lookup"><span data-stu-id="34795-278">You can have one property for all pending tasks in the queue.</span></span> <span data-ttu-id="34795-279">Se pelo menos uma tarefa demorar mais, o status do relatório na propriedade **PendingTasks** será um aviso ou erro, conforme apropriado.</span><span class="sxs-lookup"><span data-stu-id="34795-279">If at least one task takes longer, the report status on the property **PendingTasks** is a warning or error, as appropriate.</span></span> <span data-ttu-id="34795-280">Se não houver tarefas pendentes ou se a execução de todas tiver sido iniciada, o status de relatório será OK.</span><span class="sxs-lookup"><span data-stu-id="34795-280">If there are no pending tasks or all tasks started execution, the report status is OK.</span></span> <span data-ttu-id="34795-281">As tarefas são persistentes.</span><span class="sxs-lookup"><span data-stu-id="34795-281">The tasks are persistent.</span></span> <span data-ttu-id="34795-282">Se a primária falhar, a nova primária promovida poderá continuar relatando adequadamente.</span><span class="sxs-lookup"><span data-stu-id="34795-282">If the primary goes down, the newly promoted primary can continue to report properly.</span></span>
* <span data-ttu-id="34795-283">Outro processo do watchdog (na nuvem ou externo) verifica as tarefas (do lado de fora, com base no resultado da tarefa desejado) para ver se estão concluídas.</span><span class="sxs-lookup"><span data-stu-id="34795-283">Another watchdog process (in the cloud or external) checks the tasks (from outside, based on the desired task result) to see if they are completed.</span></span> <span data-ttu-id="34795-284">Se elas não respeitarem os limites, um relatório será enviado no serviço mestre.</span><span class="sxs-lookup"><span data-stu-id="34795-284">If they do not respect the thresholds, a report is sent on the master service.</span></span> <span data-ttu-id="34795-285">Um relatório também será enviado em cada tarefa que inclui o identificador de tarefa, como **PendingTask+taskId**.</span><span class="sxs-lookup"><span data-stu-id="34795-285">A report is also sent on each task that includes the task identifier, like **PendingTask+taskId**.</span></span> <span data-ttu-id="34795-286">Os relatórios devem ser enviados somente em estados não íntegros.</span><span class="sxs-lookup"><span data-stu-id="34795-286">Reports should be sent only on unhealthy states.</span></span> <span data-ttu-id="34795-287">Defina a vida útil para alguns minutos e marque os relatórios a serem removidos quando expirados para garantir a limpeza.</span><span class="sxs-lookup"><span data-stu-id="34795-287">Set time to live to a few minutes, and mark the reports to be removed when they expire to ensure cleanup.</span></span>
* <span data-ttu-id="34795-288">O secundário que está executando uma tarefa relatará quando demorar mais do que o esperado para executá-la.</span><span class="sxs-lookup"><span data-stu-id="34795-288">The secondary that is executing a task reports when it takes longer than expected to run it.</span></span> <span data-ttu-id="34795-289">Ele relata a instância do serviço na propriedade **PendingTasks**.</span><span class="sxs-lookup"><span data-stu-id="34795-289">It reports on the service instance on the property **PendingTasks**.</span></span> <span data-ttu-id="34795-290">O relatório identifica a instância do serviço que apresenta problemas, mas não captura a situação em que a instância é desativada.</span><span class="sxs-lookup"><span data-stu-id="34795-290">The report pinpoints the service instance that has issues, but it doesn't capture the situation where the instance dies.</span></span> <span data-ttu-id="34795-291">Os relatórios são removidos neste momento.</span><span class="sxs-lookup"><span data-stu-id="34795-291">The reports are cleaned up then.</span></span> <span data-ttu-id="34795-292">Ele pode relatar o serviço secundário.</span><span class="sxs-lookup"><span data-stu-id="34795-292">It could report on the secondary service.</span></span> <span data-ttu-id="34795-293">Se o subordinado concluir a tarefa, a instância secundária removerá o relatório do repositório.</span><span class="sxs-lookup"><span data-stu-id="34795-293">If the secondary completes the task, the secondary instance clears the report from the store.</span></span> <span data-ttu-id="34795-294">Este relatório não captura a situação em que a mensagem de confirmação é perdida e a tarefa não é finalizada do ponto de vista do mestre.</span><span class="sxs-lookup"><span data-stu-id="34795-294">The report doesn't capture the situation where the acknowledgement message is lost and the task is not finished from the master's point of view.</span></span>

<span data-ttu-id="34795-295">No entanto, o relatório será gerado nos casos descritos acima; eles serão capturados na integridade do aplicativo quando a integridade for avaliada.</span><span class="sxs-lookup"><span data-stu-id="34795-295">However the reporting is done in the cases described above, the reports are captured in application health when health is evaluated.</span></span>

## <a name="report-periodically-vs-on-transition"></a><span data-ttu-id="34795-296">Relatar periodicamente x na transição</span><span class="sxs-lookup"><span data-stu-id="34795-296">Report periodically vs. on transition</span></span>
<span data-ttu-id="34795-297">Usando o modelo de relatório de integridade, os watchdogs podem enviar relatórios periodicamente ou nas transições.</span><span class="sxs-lookup"><span data-stu-id="34795-297">By using the health reporting model, watchdogs can send reports periodically or on transitions.</span></span> <span data-ttu-id="34795-298">A forma recomendada para relatórios watchdog é periodicamente, pois o código é muito mais simples e menos sujeito a erros.</span><span class="sxs-lookup"><span data-stu-id="34795-298">The recommended way for watchdog reporting is periodically, because the code is much simpler and less prone to errors.</span></span> <span data-ttu-id="34795-299">Os watchdogs devem ser sempre buscar ser o mais simples possível para evitar bugs que disparem relatórios incorretos.</span><span class="sxs-lookup"><span data-stu-id="34795-299">The watchdogs must strive to be as simple as possible to avoid bugs that trigger incorrect reports.</span></span> <span data-ttu-id="34795-300">Relatórios *não íntegro* incorretos afetam as avaliações de integridade e os cenários com base na integridade, incluindo atualizações.</span><span class="sxs-lookup"><span data-stu-id="34795-300">Incorrect *unhealthy* reports impact health evaluations and scenarios based on health, including upgrades.</span></span> <span data-ttu-id="34795-301">Os relatórios incorretos de *integridade* ocultam problemas no cluster, o que não é desejado.</span><span class="sxs-lookup"><span data-stu-id="34795-301">Incorrect *healthy* reports hide issues in the cluster, which is not desired.</span></span>

<span data-ttu-id="34795-302">Para relatórios periódicos, o watchdog pode ser implementado com um temporizador.</span><span class="sxs-lookup"><span data-stu-id="34795-302">For periodic reporting, the watchdog can be implemented with a timer.</span></span> <span data-ttu-id="34795-303">Em um retorno de chamada do temporizador, o watchdog pode verificar o estado e enviar um relatório com base no estado atual.</span><span class="sxs-lookup"><span data-stu-id="34795-303">On a timer callback, the watchdog can check the state and send a report based on the current state.</span></span> <span data-ttu-id="34795-304">Não é necessário ver qual relatório foi enviado anteriormente nem fazer qualquer otimização em termos de mensagens.</span><span class="sxs-lookup"><span data-stu-id="34795-304">There is no need to see which report was sent previously or make any optimizations in terms of messaging.</span></span> <span data-ttu-id="34795-305">O cliente de integridade tem lógica de envio em lote para ajudar com o desempenho.</span><span class="sxs-lookup"><span data-stu-id="34795-305">The health client has batching logic to help with performance.</span></span> <span data-ttu-id="34795-306">Enquanto o cliente de integridade for mantido em atividade, ele fará novas tentativas até que o relatório seja confirmado pelo Repositório de Integridade ou até que o watchdog gere um relatório mais recente com a mesma entidade, propriedade e origem.</span><span class="sxs-lookup"><span data-stu-id="34795-306">While the health client is kept alive, it retries internally until the report is acknowledged by the health store or the watchdog generates a newer report with the same entity, property, and source.</span></span>

<span data-ttu-id="34795-307">Relatórios sobre transições exigem tratamento cuidadoso do estado.</span><span class="sxs-lookup"><span data-stu-id="34795-307">Reporting on transitions requires careful handling of state.</span></span> <span data-ttu-id="34795-308">O watchdog monitora algumas condições e relata apenas quando as condições mudam.</span><span class="sxs-lookup"><span data-stu-id="34795-308">The watchdog monitors some conditions and reports only when the conditions change.</span></span> <span data-ttu-id="34795-309">A vantagem dessa abordagem é que menos relatórios são necessários.</span><span class="sxs-lookup"><span data-stu-id="34795-309">The upside of this approach is that fewer reports are needed.</span></span> <span data-ttu-id="34795-310">O lado negativo é que a lógica do watchdog é complexa.</span><span class="sxs-lookup"><span data-stu-id="34795-310">The downside is that the logic of the watchdog is complex.</span></span> <span data-ttu-id="34795-311">O watchdog deve manter as condições ou os relatórios para que possam ser inspecionados para determinar as mudanças de estado.</span><span class="sxs-lookup"><span data-stu-id="34795-311">The watchdog must maintain the conditions or the reports, so that they can be inspected to determine state changes.</span></span> <span data-ttu-id="34795-312">Durante o failover, deve-se ter cuidado com relatórios adicionados que ainda não foram enviados ao repositório de integridade.</span><span class="sxs-lookup"><span data-stu-id="34795-312">On failover, care must be taken with reports added, but not yet sent to the health store.</span></span> <span data-ttu-id="34795-313">O número de sequência deve ser crescente.</span><span class="sxs-lookup"><span data-stu-id="34795-313">The sequence number must be ever-increasing.</span></span> <span data-ttu-id="34795-314">Caso contrário, os relatórios serão rejeitados como obsoletos.</span><span class="sxs-lookup"><span data-stu-id="34795-314">If not, the reports are rejected as stale.</span></span> <span data-ttu-id="34795-315">Em raros casos em que ocorra perda de dados, pode ser necessária sincronização entre o estado do relator e o estado do repositório de integridade.</span><span class="sxs-lookup"><span data-stu-id="34795-315">In the rare cases where data loss is incurred, synchronization may be needed between the state of the reporter and the state of the health store.</span></span>

<span data-ttu-id="34795-316">Relatar transições faz sentido para serviços que relatam a si próprios, por meio de `Partition` ou `CodePackageActivationContext`.</span><span class="sxs-lookup"><span data-stu-id="34795-316">Reporting on transitions makes sense for services reporting on themselves, through `Partition` or `CodePackageActivationContext`.</span></span> <span data-ttu-id="34795-317">Quando o objeto local (réplica ou pacote de serviços implantado/aplicativo implantado) é removido, todos os seus relatórios também serão removidos.</span><span class="sxs-lookup"><span data-stu-id="34795-317">When the local object (replica or deployed service package / deployed application) is removed, all its reports are also removed.</span></span> <span data-ttu-id="34795-318">Esta limpeza automática alivia a necessidade de sincronização entre o relator e o Repositório de Integridade.</span><span class="sxs-lookup"><span data-stu-id="34795-318">This automatic cleanup relaxes the need for synchronization between reporter and health store.</span></span> <span data-ttu-id="34795-319">Se o relatório for para a partição pai ou o aplicativo pai, será preciso tomar cuidado com o failover para evitar relatórios obsoletos no repositório de integridade.</span><span class="sxs-lookup"><span data-stu-id="34795-319">If the report is for parent partition or parent application, care must be taken on failover to avoid stale reports in the health store.</span></span> <span data-ttu-id="34795-320">A lógica deve ser adicionada para manter o estado correto e limpar o relatório do repositório quando ele não for mais necessário.</span><span class="sxs-lookup"><span data-stu-id="34795-320">Logic must be added to maintain the correct state and clear the report from store when not needed anymore.</span></span>

## <a name="implement-health-reporting"></a><span data-ttu-id="34795-321">Implementar relatório de integridade</span><span class="sxs-lookup"><span data-stu-id="34795-321">Implement health reporting</span></span>
<span data-ttu-id="34795-322">Quando os detalhes da entidade e do relatório estiverem claros, os relatórios de integridade podem ser enviados usando API, PowerShell ou REST.</span><span class="sxs-lookup"><span data-stu-id="34795-322">Once the entity and report details are clear, sending health reports can be done through the API, PowerShell, or REST.</span></span>

### <a name="api"></a><span data-ttu-id="34795-323">API</span><span class="sxs-lookup"><span data-stu-id="34795-323">API</span></span>
<span data-ttu-id="34795-324">Para relatar por meio da API, você precisa criar um relatório de integridade específico para o tipo de entidade que deseja relatar.</span><span class="sxs-lookup"><span data-stu-id="34795-324">To report through the API, you need to create a health report specific to the entity type they want to report on.</span></span> <span data-ttu-id="34795-325">Envie o relatório a um cliente de integridade.</span><span class="sxs-lookup"><span data-stu-id="34795-325">Give the report to a health client.</span></span> <span data-ttu-id="34795-326">Como alternativa, crie informações de integridade e transmita-as aos métodos corretos de relatório em `Partition` ou `CodePackageActivationContext` para relatar em entidades atuais.</span><span class="sxs-lookup"><span data-stu-id="34795-326">Alternatively, create a health information and pass it to correct reporting methods on `Partition` or `CodePackageActivationContext` to report on current entities.</span></span>

<span data-ttu-id="34795-327">O exemplo a seguir mostra um relatório periódico de um watchdog dentro do cluster.</span><span class="sxs-lookup"><span data-stu-id="34795-327">The following example shows periodic reporting from a watchdog within the cluster.</span></span> <span data-ttu-id="34795-328">O watchdog verifica se um recurso externo pode ser acessado em um nó.</span><span class="sxs-lookup"><span data-stu-id="34795-328">The watchdog checks whether an external resource can be accessed from within a node.</span></span> <span data-ttu-id="34795-329">O recurso é necessário para um manifesto do serviço no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="34795-329">The resource is needed by a service manifest within the application.</span></span> <span data-ttu-id="34795-330">Mesmo que o recurso não esteja disponível, os outros serviços no aplicativo ainda poderão funcionar corretamente.</span><span class="sxs-lookup"><span data-stu-id="34795-330">If the resource is unavailable, the other services within the application can still function properly.</span></span> <span data-ttu-id="34795-331">Desse modo, o relatório é enviado na entidade do pacote de serviço implantado a cada 30 segundos.</span><span class="sxs-lookup"><span data-stu-id="34795-331">Therefore, the report is sent on the deployed service package entity every 30 seconds.</span></span>

```csharp
private static Uri ApplicationName = new Uri("fabric:/WordCount");
private static string ServiceManifestName = "WordCount.Service";
private static string NodeName = FabricRuntime.GetNodeContext().NodeName;
private static Timer ReportTimer = new Timer(new TimerCallback(SendReport), null, 30 * 1000, 30 * 1000);
private static FabricClient Client = new FabricClient(new FabricClientSettings() { HealthReportSendInterval = TimeSpan.FromSeconds(0) });

public static void SendReport(object obj)
{
    // Test whether the resource can be accessed from the node
    HealthState healthState = this.TestConnectivityToExternalResource();

    // Send report on deployed service package, as the connectivity is needed by the specific service manifest
    // and can be different on different nodes
    var deployedServicePackageHealthReport = new DeployedServicePackageHealthReport(
        ApplicationName,
        ServiceManifestName,
        NodeName,
        new HealthInformation("ExternalSourceWatcher", "Connectivity", healthState));

    // TODO: handle exception. Code omitted for snippet brevity.
    // Possible exceptions: FabricException with error codes
    // FabricHealthStaleReport (non-retryable, the report is already queued on the health client),
    // FabricHealthMaxReportsReached (retryable; user should retry with exponential delay until the report is accepted).
    Client.HealthManager.ReportHealth(deployedServicePackageHealthReport);
}
```

### <a name="powershell"></a><span data-ttu-id="34795-332">PowerShell</span><span class="sxs-lookup"><span data-stu-id="34795-332">PowerShell</span></span>
<span data-ttu-id="34795-333">Enviar relatórios de integridade com **Send-ServiceFabric*EntityType*HealthReport**.</span><span class="sxs-lookup"><span data-stu-id="34795-333">Send health reports with **Send-ServiceFabric*EntityType*HealthReport**.</span></span>

<span data-ttu-id="34795-334">O exemplo a seguir mostra um relatório periódico sobre valores de CPU em um nó.</span><span class="sxs-lookup"><span data-stu-id="34795-334">The following example shows periodic reporting on CPU values on a node.</span></span> <span data-ttu-id="34795-335">Os relatórios devem ser enviados a cada 30 segundos e têm uma vida útil de dois minutos.</span><span class="sxs-lookup"><span data-stu-id="34795-335">The reports should be sent every 30 seconds, and they have a time to live of two minutes.</span></span> <span data-ttu-id="34795-336">Se eles expirarem, o relator está com problemas, de modo que o nó é avaliado com erro.</span><span class="sxs-lookup"><span data-stu-id="34795-336">If they expire, the reporter has issues, so the node is evaluated at error.</span></span> <span data-ttu-id="34795-337">Quando a CPU estiver acima de um limite, o relatório terá um estado de integridade de aviso.</span><span class="sxs-lookup"><span data-stu-id="34795-337">When the CPU is above a threshold, the report has a health state of warning.</span></span> <span data-ttu-id="34795-338">Quando a CPU permanece acima de um limite por mais do que o tempo configurado, ela é relatada como um erro.</span><span class="sxs-lookup"><span data-stu-id="34795-338">When the CPU remains above a threshold for more than the configured time, it's reported as an error.</span></span> <span data-ttu-id="34795-339">Caso contrário, o relator enviará um estado de integridade OK.</span><span class="sxs-lookup"><span data-stu-id="34795-339">Otherwise, the reporter sends a health state of OK.</span></span>

```powershell
PS C:\> Send-ServiceFabricNodeHealthReport -NodeName Node.1 -HealthState Warning -SourceId PowershellWatcher -HealthProperty CPU -Description "CPU is above 80% threshold" -TimeToLiveSec 120

PS C:\> Get-ServiceFabricNodeHealth -NodeName Node.1
NodeName              : Node.1
AggregatedHealthState : Warning
UnhealthyEvaluations  :
                        Unhealthy event: SourceId='PowershellWatcher', Property='CPU', HealthState='Warning', ConsiderWarningAsError=false.

HealthEvents          :
                        SourceId              : System.FM
                        Property              : State
                        HealthState           : Ok
                        SequenceNumber        : 5
                        SentAt                : 4/21/2015 8:01:17 AM
                        ReceivedAt            : 4/21/2015 8:02:12 AM
                        TTL                   : Infinite
                        Description           : Fabric node is up.
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Ok = 4/21/2015 8:02:12 AM

                        SourceId              : PowershellWatcher
                        Property              : CPU
                        HealthState           : Warning
                        SequenceNumber        : 130741236814913394
                        SentAt                : 4/21/2015 9:01:21 PM
                        ReceivedAt            : 4/21/2015 9:01:21 PM
                        TTL                   : 00:02:00
                        Description           : CPU is above 80% threshold
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Warning = 4/21/2015 9:01:21 PM
```

<span data-ttu-id="34795-340">O exemplo a seguir relata um aviso transitório em uma réplica.</span><span class="sxs-lookup"><span data-stu-id="34795-340">The following example reports a transient warning on a replica.</span></span> <span data-ttu-id="34795-341">Primeiro, ele obtém a ID da partição e então a ID de réplica para o serviço em que está interessado.</span><span class="sxs-lookup"><span data-stu-id="34795-341">It first gets the partition ID and then the replica ID for the service it is interested in.</span></span> <span data-ttu-id="34795-342">Ele envia um relatório do **PowershellWatcher** na propriedade **ResourceDependency**.</span><span class="sxs-lookup"><span data-stu-id="34795-342">It then sends a report from **PowershellWatcher** on the property **ResourceDependency**.</span></span> <span data-ttu-id="34795-343">O relatório é de interesse somente por dois minutos, e ele é removido do repositório automaticamente.</span><span class="sxs-lookup"><span data-stu-id="34795-343">The report is of interest for only two minutes, and it is removed from the store automatically.</span></span>

```powershell
PS C:\> $partitionId = (Get-ServiceFabricPartition -ServiceName fabric:/WordCount/WordCount.Service).PartitionId

PS C:\> $replicaId = (Get-ServiceFabricReplica -PartitionId $partitionId | where {$_.ReplicaRole -eq "Primary"}).ReplicaId

PS C:\> Send-ServiceFabricReplicaHealthReport -PartitionId $partitionId -ReplicaId $replicaId -HealthState Warning -SourceId PowershellWatcher -HealthProperty ResourceDependency -Description "The external resource that the primary is using has been rebooted at 4/21/2015 9:01:21 PM. Expect processing delays for a few minutes." -TimeToLiveSec 120 -RemoveWhenExpired

PS C:\> Get-ServiceFabricReplicaHealth  -PartitionId $partitionId -ReplicaOrInstanceId $replicaId


PartitionId           : 8f82daff-eb68-4fd9-b631-7a37629e08c0
ReplicaId             : 130740415594605869
AggregatedHealthState : Warning
UnhealthyEvaluations  :
                        Unhealthy event: SourceId='PowershellWatcher', Property='ResourceDependency', HealthState='Warning', ConsiderWarningAsError=false.

HealthEvents          :
                        SourceId              : System.RA
                        Property              : State
                        HealthState           : Ok
                        SequenceNumber        : 130740768777734943
                        SentAt                : 4/21/2015 8:01:17 AM
                        ReceivedAt            : 4/21/2015 8:02:12 AM
                        TTL                   : Infinite
                        Description           : Replica has been created.
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Ok = 4/21/2015 8:02:12 AM

                        SourceId              : PowershellWatcher
                        Property              : ResourceDependency
                        HealthState           : Warning
                        SequenceNumber        : 130741243777723555
                        SentAt                : 4/21/2015 9:12:57 PM
                        ReceivedAt            : 4/21/2015 9:12:57 PM
                        TTL                   : 00:02:00
                        Description           : The external resource that the primary is using has been rebooted at 4/21/2015 9:01:21 PM. Expect processing delays for a few minutes.
                        RemoveWhenExpired     : True
                        IsExpired             : False
                        Transitions           : ->Warning = 4/21/2015 9:12:32 PM
```

### <a name="rest"></a><span data-ttu-id="34795-344">REST</span><span class="sxs-lookup"><span data-stu-id="34795-344">REST</span></span>
<span data-ttu-id="34795-345">Envie relatórios de integridade usando o REST com solicitações POST que vão para a entidade desejada e têm, no corpo, a descrição do relatório de integridade.</span><span class="sxs-lookup"><span data-stu-id="34795-345">Send health reports using REST with POST requests that go to the desired entity and have in the body the health report description.</span></span> <span data-ttu-id="34795-346">Por exemplo, veja como enviar [relatórios de integridade do cluster](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-cluster) ou [relatórios de integridade do serviço](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-service) de REST.</span><span class="sxs-lookup"><span data-stu-id="34795-346">For example, see how to send REST [cluster health reports](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-cluster) or [service health reports](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-service).</span></span> <span data-ttu-id="34795-347">Todas as entidades têm suporte.</span><span class="sxs-lookup"><span data-stu-id="34795-347">All entities are supported.</span></span>

## <a name="next-steps"></a><span data-ttu-id="34795-348">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="34795-348">Next steps</span></span>
<span data-ttu-id="34795-349">Com base nos dados de integridade, os criadores de serviço e administradores de cluster/aplicativo podem pensar em maneiras de consumir as informações.</span><span class="sxs-lookup"><span data-stu-id="34795-349">Based on the health data, service writers and cluster/application administrators can think of ways to consume the information.</span></span> <span data-ttu-id="34795-350">Por exemplo, eles podem configurar alertas com base no status de integridade para capturar problemas graves antes que eles provoquem interrupções.</span><span class="sxs-lookup"><span data-stu-id="34795-350">For example, they can set up alerts based on health status to catch severe issues before they provoke outages.</span></span> <span data-ttu-id="34795-351">Os administradores também podem definir os sistemas de reparo para corrigir problemas automaticamente.</span><span class="sxs-lookup"><span data-stu-id="34795-351">Administrators can also set up repair systems to fix issues automatically.</span></span>

[<span data-ttu-id="34795-352">Introdução ao monitoramento da integridade do Service Fabric</span><span class="sxs-lookup"><span data-stu-id="34795-352">Introduction to Service Fabric health Monitoring</span></span>](service-fabric-health-introduction.md)

[<span data-ttu-id="34795-353">Como exibir relatórios de integridade do Service Fabric</span><span class="sxs-lookup"><span data-stu-id="34795-353">View Service Fabric health reports</span></span>](service-fabric-view-entities-aggregated-health.md)

[<span data-ttu-id="34795-354">Como relatar e verificar a integridade do serviço</span><span class="sxs-lookup"><span data-stu-id="34795-354">How to report and check service health</span></span>](service-fabric-diagnostics-how-to-report-and-check-service-health.md)

[<span data-ttu-id="34795-355">Usar relatórios de integridade do sistema para solução de problemas</span><span class="sxs-lookup"><span data-stu-id="34795-355">Use system health reports for troubleshooting</span></span>](service-fabric-understand-and-troubleshoot-with-system-health-reports.md)

[<span data-ttu-id="34795-356">Monitorar e diagnosticar serviços localmente</span><span class="sxs-lookup"><span data-stu-id="34795-356">Monitor and diagnose services locally</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)

[<span data-ttu-id="34795-357">Atualização de aplicativos do Service Fabric</span><span class="sxs-lookup"><span data-stu-id="34795-357">Service Fabric application upgrade</span></span>](service-fabric-application-upgrade.md)

