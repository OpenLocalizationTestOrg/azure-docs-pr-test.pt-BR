---
title: "relatórios de integridade de malha de serviço personalizados aaaAdd | Microsoft Docs"
description: "Descreve como os relatórios de integridade personalizado toosend tooAzure entidades de integridade de malha do serviço. Fornece recomendações para projetar e implementar relatórios de integridade de qualidade."
services: service-fabric
documentationcenter: .net
author: oanapl
manager: timlt
editor: 
ms.assetid: 0a00a7d2-510e-47d0-8aa8-24c851ea847f
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/19/2017
ms.author: oanapl
ms.openlocfilehash: 12c9f664e2a457b4e1e8f340873ca60ebcefb097
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="add-custom-service-fabric-health-reports"></a><span data-ttu-id="50e31-104">Adicionar relatórios de integridade personalizados do Service Fabric</span><span class="sxs-lookup"><span data-stu-id="50e31-104">Add custom Service Fabric health reports</span></span>
<span data-ttu-id="50e31-105">Malha do serviço do Azure apresenta um [modelo de integridade](service-fabric-health-introduction.md) projetado cluster não íntegro tooflag e condições de aplicativo em entidades específicas.</span><span class="sxs-lookup"><span data-stu-id="50e31-105">Azure Service Fabric introduces a [health model](service-fabric-health-introduction.md) designed tooflag unhealthy cluster and application conditions on specific entities.</span></span> <span data-ttu-id="50e31-106">usa o modelo de integridade Olá **relatórios de integridade** (componentes do sistema e watchdogs).</span><span class="sxs-lookup"><span data-stu-id="50e31-106">hello health model uses **health reporters** (system components and watchdogs).</span></span> <span data-ttu-id="50e31-107">meta de saudação é fácil e rápido de diagnóstico e reparo.</span><span class="sxs-lookup"><span data-stu-id="50e31-107">hello goal is easy and fast diagnosis and repair.</span></span> <span data-ttu-id="50e31-108">Gravadores de serviço necessário toothink antecipadamente sobre integridade.</span><span class="sxs-lookup"><span data-stu-id="50e31-108">Service writers need toothink upfront about health.</span></span> <span data-ttu-id="50e31-109">Qualquer condição que pode afetar a integridade deve ser relatada, especialmente se ele pode ajudar a problemas de sinalizador fechar toohello raiz.</span><span class="sxs-lookup"><span data-stu-id="50e31-109">Any condition that can impact health should be reported on, especially if it can help flag problems close toohello root.</span></span> <span data-ttu-id="50e31-110">informações de integridade Olá podem economizar tempo e esforço na investigação e depuração.</span><span class="sxs-lookup"><span data-stu-id="50e31-110">hello health information can save time and effort on debugging and investigation.</span></span> <span data-ttu-id="50e31-111">Olá utilidade é especialmente clara depois que o serviço hello está em execução em grande escala na nuvem hello (particular ou do Azure).</span><span class="sxs-lookup"><span data-stu-id="50e31-111">hello usefulness is especially clear once hello service is up and running at scale in hello cloud (private or Azure).</span></span>

<span data-ttu-id="50e31-112">monitor de recursos do Service Fabric Olá identificado condições de interesse.</span><span class="sxs-lookup"><span data-stu-id="50e31-112">hello Service Fabric reporters monitor identified conditions of interest.</span></span> <span data-ttu-id="50e31-113">Eles informam essas condições com base na respectiva exibição local.</span><span class="sxs-lookup"><span data-stu-id="50e31-113">They report on those conditions based on their local view.</span></span> <span data-ttu-id="50e31-114">Olá [repositório de integridade](service-fabric-health-introduction.md#health-store) agrega dados de integridade enviados por toodetermine de Relatores todas as entidades estão íntegros globalmente.</span><span class="sxs-lookup"><span data-stu-id="50e31-114">hello [health store](service-fabric-health-introduction.md#health-store) aggregates health data sent by all reporters toodetermine whether entities are globally healthy.</span></span> <span data-ttu-id="50e31-115">modelo de saudação é toouse avançados, flexíveis e fáceis de toobe pretendido.</span><span class="sxs-lookup"><span data-stu-id="50e31-115">hello model is intended toobe rich, flexible, and easy toouse.</span></span> <span data-ttu-id="50e31-116">qualidade Olá Olá de relatórios de integridade determina a precisão de saudação do modo de exibição de integridade de saudação do cluster de saudação.</span><span class="sxs-lookup"><span data-stu-id="50e31-116">hello quality of hello health reports determines hello accuracy of hello health view of hello cluster.</span></span> <span data-ttu-id="50e31-117">Falsos positivos que mostram incorretamente problemas de integridade podem afetar negativamente atualizações ou outros serviços que usam dados de integridade.</span><span class="sxs-lookup"><span data-stu-id="50e31-117">False positives that wrongly show unhealthy issues can negatively impact upgrades or other services that use health data.</span></span> <span data-ttu-id="50e31-118">Exemplos de tais serviços são os serviços de reparo e os mecanismos de alerta.</span><span class="sxs-lookup"><span data-stu-id="50e31-118">Examples of such services are repair services and alerting mechanisms.</span></span> <span data-ttu-id="50e31-119">Portanto, alguns pensamento é relatórios tooprovide necessários que capturam as condições de interesse em Olá melhor maneira possível.</span><span class="sxs-lookup"><span data-stu-id="50e31-119">Therefore, some thought is needed tooprovide reports that capture conditions of interest in hello best possible way.</span></span>

<span data-ttu-id="50e31-120">toodesign e implementar integridade reporting, watchdogs e componentes do sistema devem:</span><span class="sxs-lookup"><span data-stu-id="50e31-120">toodesign and implement health reporting, watchdogs and system components must:</span></span>

* <span data-ttu-id="50e31-121">Definir condição Olá estão interessados, forma Olá que é monitorado e hello impacto sobre a funcionalidade do cluster ou o aplicativo hello.</span><span class="sxs-lookup"><span data-stu-id="50e31-121">Define hello condition they are interested in, hello way it is monitored, and hello impact on hello cluster or application functionality.</span></span> <span data-ttu-id="50e31-122">Com base nessas informações, decida no estado de integridade e a propriedade de relatório de integridade do hello.</span><span class="sxs-lookup"><span data-stu-id="50e31-122">Based on this information, decide on hello health report property and health state.</span></span>
* <span data-ttu-id="50e31-123">Determinar Olá [entidade](service-fabric-health-introduction.md#health-entities-and-hierarchy) relatório Olá aplica-se a.</span><span class="sxs-lookup"><span data-stu-id="50e31-123">Determine hello [entity](service-fabric-health-introduction.md#health-entities-and-hierarchy) that hello report applies to.</span></span>
* <span data-ttu-id="50e31-124">Determinar onde Olá reporting é feita, no hello watchdog de serviço ou de interno ou externo.</span><span class="sxs-lookup"><span data-stu-id="50e31-124">Determine where hello reporting is done, from within hello service or from an internal or external watchdog.</span></span>
* <span data-ttu-id="50e31-125">Defina um Relator de saudação tooidentify fonte usada.</span><span class="sxs-lookup"><span data-stu-id="50e31-125">Define a source used tooidentify hello reporter.</span></span>
* <span data-ttu-id="50e31-126">Escolher uma estratégia de relatório: periodicamente ou nas transições.</span><span class="sxs-lookup"><span data-stu-id="50e31-126">Choose a reporting strategy, either periodically or on transitions.</span></span> <span data-ttu-id="50e31-127">Olá recomendado maneira é periodicamente, como ele requer código mais simples e diminui a probabilidade de tooerrors.</span><span class="sxs-lookup"><span data-stu-id="50e31-127">hello recommended way is periodically, as it requires simpler code and is less prone tooerrors.</span></span>
* <span data-ttu-id="50e31-128">Determine quanto tempo relatório de saudação para não íntegro condições devem permanecer no repositório de integridade hello e como ela deve ser desmarcada.</span><span class="sxs-lookup"><span data-stu-id="50e31-128">Determine how long hello report for unhealthy conditions should stay in hello health store and how it should be cleared.</span></span> <span data-ttu-id="50e31-129">Usando essas informações, decida o comportamento de toolive e remover na expiração do tempo do relatório hello.</span><span class="sxs-lookup"><span data-stu-id="50e31-129">Using this information, decide hello report's time toolive and remove-on-expiration behavior.</span></span>

<span data-ttu-id="50e31-130">Conforme mencionado, o relatório pode ser gerado:</span><span class="sxs-lookup"><span data-stu-id="50e31-130">As mentioned, reporting can be done from:</span></span>

* <span data-ttu-id="50e31-131">Olá monitorado réplicas do serviço do Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="50e31-131">hello monitored Service Fabric service replica.</span></span>
* <span data-ttu-id="50e31-132">De watchdogs internos implantados como um serviço do Service Fabric (por exemplo, um serviço sem estado do Service Fabric que monitora as condições e emite relatórios).</span><span class="sxs-lookup"><span data-stu-id="50e31-132">Internal watchdogs deployed as a Service Fabric service (for example, a Service Fabric stateless service that monitors conditions and issues reports).</span></span> <span data-ttu-id="50e31-133">watchdogs Olá podem ser implantado um todos os nós ou pode ser serviço de afinidade toohello monitorado.</span><span class="sxs-lookup"><span data-stu-id="50e31-133">hello watchdogs can be deployed an all nodes or can be affinitized toohello monitored service.</span></span>
* <span data-ttu-id="50e31-134">Watchdogs internos que executar em nós do Service Fabric hello, mas são *não* implementado como serviços do Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="50e31-134">Internal watchdogs that run on hello Service Fabric nodes but are *not* implemented as Service Fabric services.</span></span>
* <span data-ttu-id="50e31-135">Externa watchdogs esse recurso de saudação de investigação de *fora* cluster do Service Fabric de saudação (por exemplo, serviço de monitoramento como Gomez).</span><span class="sxs-lookup"><span data-stu-id="50e31-135">External watchdogs that probe hello resource from *outside* hello Service Fabric cluster (for example, monitoring service like Gomez).</span></span>

> [!NOTE]
> <span data-ttu-id="50e31-136">Sem necessidade de saudação cluster Olá é populada com relatórios de integridade enviados pelos componentes do sistema hello.</span><span class="sxs-lookup"><span data-stu-id="50e31-136">Out of hello box, hello cluster is populated with health reports sent by hello system components.</span></span> <span data-ttu-id="50e31-137">Leia mais em [Usando relatórios de integridade do sistema para solução de problemas](service-fabric-understand-and-troubleshoot-with-system-health-reports.md).</span><span class="sxs-lookup"><span data-stu-id="50e31-137">Read more at [Using system health reports for troubleshooting](service-fabric-understand-and-troubleshoot-with-system-health-reports.md).</span></span> <span data-ttu-id="50e31-138">Olá relatórios do usuário devem ser enviados [entidades de integridade](service-fabric-health-introduction.md#health-entities-and-hierarchy) que já foram criados pelo sistema hello.</span><span class="sxs-lookup"><span data-stu-id="50e31-138">hello user reports must be sent on [health entities](service-fabric-health-introduction.md#health-entities-and-hierarchy) that have already been created by hello system.</span></span>
> 
> 

<span data-ttu-id="50e31-139">Uma vez hello design de relatório de integridade é claro, relatórios de integridade podem ser enviados facilmente.</span><span class="sxs-lookup"><span data-stu-id="50e31-139">Once hello health reporting design is clear, health reports can be sent easily.</span></span> <span data-ttu-id="50e31-140">Você pode usar [FabricClient](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient) tooreport integridade se Olá cluster não está [segura](service-fabric-cluster-security.md) ou se o cliente de malha Olá tem privilégios de administrador.</span><span class="sxs-lookup"><span data-stu-id="50e31-140">You can use [FabricClient](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient) tooreport health if hello cluster is not [secure](service-fabric-cluster-security.md) or if hello fabric client has admin privileges.</span></span> <span data-ttu-id="50e31-141">Emissão de relatórios pode ser feito por meio Olá API por usando [FabricClient.HealthManager.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth), por meio do PowerShell ou por meio do REST.</span><span class="sxs-lookup"><span data-stu-id="50e31-141">Reporting can be done through hello API by using [FabricClient.HealthManager.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth), through PowerShell, or through REST.</span></span> <span data-ttu-id="50e31-142">Botões de configuração que dividem os relatórios em lotes para melhor desempenho.</span><span class="sxs-lookup"><span data-stu-id="50e31-142">Configuration knobs batch reports for improved performance.</span></span>

> [!NOTE]
> <span data-ttu-id="50e31-143">Relatório de integridade é síncrona e representa apenas Olá trabalho de validação no lado do cliente de saudação.</span><span class="sxs-lookup"><span data-stu-id="50e31-143">Report health is synchronous, and it represents only hello validation work on hello client side.</span></span> <span data-ttu-id="50e31-144">Olá fato Olá relatório é aceito pelo cliente de integridade de saudação ou hello `Partition` ou `CodePackageActivationContext` objetos não significa que ela é aplicada no repositório de saudação.</span><span class="sxs-lookup"><span data-stu-id="50e31-144">hello fact that hello report is accepted by hello health client or hello `Partition` or `CodePackageActivationContext` objects doesn't mean that it is applied in hello store.</span></span> <span data-ttu-id="50e31-145">Ele será enviado de forma assíncrona e, possivelmente, em lote com outros relatórios.</span><span class="sxs-lookup"><span data-stu-id="50e31-145">It is sent asynchronously and possibly batched with other reports.</span></span> <span data-ttu-id="50e31-146">saudação de processamento no servidor de saudação ainda pode falhar: número de sequência de saudação poderia estar obsoleto, entidade Olá no qual Olá relatório deve ser aplicado foi excluído, etc.</span><span class="sxs-lookup"><span data-stu-id="50e31-146">hello processing on hello server may still fail: hello sequence number could be stale, hello entity on which hello report must be applied has been deleted, etc.</span></span>
> 
> 

## <a name="health-client"></a><span data-ttu-id="50e31-147">Cliente de integridade</span><span class="sxs-lookup"><span data-stu-id="50e31-147">Health client</span></span>
<span data-ttu-id="50e31-148">Olá relatórios de integridade são enviados toohello repositório de integridade através de um cliente de integridade, que reside dentro de cliente de malha hello.</span><span class="sxs-lookup"><span data-stu-id="50e31-148">hello health reports are sent toohello health store through a health client, which lives inside hello fabric client.</span></span> <span data-ttu-id="50e31-149">cliente de integridade Olá pode ser configurado com hello configurações a seguir:</span><span class="sxs-lookup"><span data-stu-id="50e31-149">hello health client can be configured with hello following settings:</span></span>

* <span data-ttu-id="50e31-150">**HealthReportSendInterval**: atraso Olá entre o relatório de saudação do tempo de saudação é adicionado toohello cliente e tempo de saudação toohello repositório de integridade é enviado.</span><span class="sxs-lookup"><span data-stu-id="50e31-150">**HealthReportSendInterval**: hello delay between hello time hello report is added toohello client and hello time it is sent toohello health store.</span></span> <span data-ttu-id="50e31-151">Relatórios de toobatch usado em uma única mensagem, em vez de enviar uma mensagem para cada relatório.</span><span class="sxs-lookup"><span data-stu-id="50e31-151">Used toobatch reports into a single message, rather than sending one message for each report.</span></span> <span data-ttu-id="50e31-152">Olá envio em lote melhora o desempenho.</span><span class="sxs-lookup"><span data-stu-id="50e31-152">hello batching improves performance.</span></span> <span data-ttu-id="50e31-153">Padrão: 30 segundos.</span><span class="sxs-lookup"><span data-stu-id="50e31-153">Default: 30 seconds.</span></span>
* <span data-ttu-id="50e31-154">**HealthReportRetrySendInterval**: intervalo de saudação em qual Olá cliente integridade reenvia a integridade acumulada relatórios toohello repositório de integridade.</span><span class="sxs-lookup"><span data-stu-id="50e31-154">**HealthReportRetrySendInterval**: hello interval at which hello health client resends accumulated health reports toohello health store.</span></span> <span data-ttu-id="50e31-155">Padrão: 30 segundos.</span><span class="sxs-lookup"><span data-stu-id="50e31-155">Default: 30 seconds.</span></span>
* <span data-ttu-id="50e31-156">**HealthOperationTimeout**: período de tempo limite de saudação para uma mensagem de relatório enviada toohello repositório de integridade.</span><span class="sxs-lookup"><span data-stu-id="50e31-156">**HealthOperationTimeout**: hello timeout period for a report message sent toohello health store.</span></span> <span data-ttu-id="50e31-157">Se uma mensagem de tempo limite, Olá integridade cliente tentará novamente a ele até que o repositório de integridade Olá confirma que o relatório de saudação foi processado.</span><span class="sxs-lookup"><span data-stu-id="50e31-157">If a message times out, hello health client retries it until hello health store confirms that hello report has been processed.</span></span> <span data-ttu-id="50e31-158">Padrão: dois minutos.</span><span class="sxs-lookup"><span data-stu-id="50e31-158">Default: two minutes.</span></span>

> [!NOTE]
> <span data-ttu-id="50e31-159">Quando Olá relatórios são em lote, cliente de malha de saudação deve ser mantida ativa pelo menos Olá tooensure HealthReportSendInterval que eles são enviados.</span><span class="sxs-lookup"><span data-stu-id="50e31-159">When hello reports are batched, hello fabric client must be kept alive for at least hello HealthReportSendInterval tooensure that they are sent.</span></span> <span data-ttu-id="50e31-160">Se a mensagem de saudação é perdida ou repositório de integridade de saudação não é possível aplicar devido a erros de tootransient, cliente de malha Olá deve ser mantido toogive mais atividade-tooretry uma possibilidade.</span><span class="sxs-lookup"><span data-stu-id="50e31-160">If hello message is lost or hello health store cannot apply them due tootransient errors, hello fabric client must be kept alive longer toogive it a chance tooretry.</span></span>
> 
> 

<span data-ttu-id="50e31-161">saudação de buffer no cliente de saudação leva exclusividade Olá Olá relatórios em consideração.</span><span class="sxs-lookup"><span data-stu-id="50e31-161">hello buffering on hello client takes hello uniqueness of hello reports into consideration.</span></span> <span data-ttu-id="50e31-162">Por exemplo, se um determinado Relator incorreto estiver se comunicando 100 relatórios por segundo em Olá mesmo propriedade Olá Olá relatórios são substituídos com a última versão de saudação de mesma entidade.</span><span class="sxs-lookup"><span data-stu-id="50e31-162">For example, if a particular bad reporter is reporting 100 reports per second on hello same property of hello same entity, hello reports are replaced with hello last version.</span></span> <span data-ttu-id="50e31-163">No máximo um tal relatório existe na fila de cliente hello.</span><span class="sxs-lookup"><span data-stu-id="50e31-163">At most one such report exists in hello client queue.</span></span> <span data-ttu-id="50e31-164">Se o envio em lote estiver configurado, o número de saudação de relatórios enviados toohello repositório de integridade é apenas uma por intervalo de envio.</span><span class="sxs-lookup"><span data-stu-id="50e31-164">If batching is configured, hello number of reports sent toohello health store is just one per send interval.</span></span> <span data-ttu-id="50e31-165">Esse relatório é Olá último adicionado, que refletem o estado mais atual do hello da entidade de saudação.</span><span class="sxs-lookup"><span data-stu-id="50e31-165">This report is hello last added report, which reflects hello most current state of hello entity.</span></span>
<span data-ttu-id="50e31-166">Especificar parâmetros de configuração quando `FabricClient` é criado, passando [FabricClientSettings](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclientsettings) com hello desejado valores para entradas de integridade.</span><span class="sxs-lookup"><span data-stu-id="50e31-166">Specify configuration parameters when `FabricClient` is created by passing [FabricClientSettings](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclientsettings) with hello desired values for health-related entries.</span></span>

<span data-ttu-id="50e31-167">Olá exemplo a seguir cria um cliente de malha e especifica que os relatórios de saudação devem ser enviados quando eles são adicionados.</span><span class="sxs-lookup"><span data-stu-id="50e31-167">hello following example creates a fabric client and specifies that hello reports should be sent when they are added.</span></span> <span data-ttu-id="50e31-168">Em tempos limite e erros que podem ser recuperados, as repetições ocorrem a cada 40 segundos.</span><span class="sxs-lookup"><span data-stu-id="50e31-168">On timeouts and errors that can be retried, retries happen every 40 seconds.</span></span>

```csharp
var clientSettings = new FabricClientSettings()
{
    HealthOperationTimeout = TimeSpan.FromSeconds(120),
    HealthReportSendInterval = TimeSpan.FromSeconds(0),
    HealthReportRetrySendInterval = TimeSpan.FromSeconds(40),
};
var fabricClient = new FabricClient(clientSettings);
```

<span data-ttu-id="50e31-169">É recomendável manter a malha de padrão de saudação configurações do cliente, definir `HealthReportSendInterval` too30 segundos.</span><span class="sxs-lookup"><span data-stu-id="50e31-169">We recommend keeping hello default fabric client settings, which set `HealthReportSendInterval` too30 seconds.</span></span> <span data-ttu-id="50e31-170">Essa configuração garante que o desempenho ideal devido toobatching.</span><span class="sxs-lookup"><span data-stu-id="50e31-170">This setting ensures optimal performance due toobatching.</span></span> <span data-ttu-id="50e31-171">Para relatórios importantes que devem ser enviados o quanto antes, use `HealthReportSendOptions` com `true` imediato na API do [FabricClient.HealthClient.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth).</span><span class="sxs-lookup"><span data-stu-id="50e31-171">For critical reports that must be sent as soon as possible, use `HealthReportSendOptions` with Immediate `true` in [FabricClient.HealthClient.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth) API.</span></span> <span data-ttu-id="50e31-172">Relatórios imediatos ignoram Olá intervalo de processamento em lotes.</span><span class="sxs-lookup"><span data-stu-id="50e31-172">Immediate reports bypass hello batching interval.</span></span> <span data-ttu-id="50e31-173">Use este sinalizador com cuidado. queremos tootake vantagem do cliente de integridade Olá envio em lote sempre que possível.</span><span class="sxs-lookup"><span data-stu-id="50e31-173">Use this flag with care; we want tootake advantage of hello health client batching whenever possible.</span></span> <span data-ttu-id="50e31-174">Envio imediato também é útil quando está fechando o cliente de malha hello (por exemplo, o processo de saudação determinou estado inválido e precisa tooshut para baixo tooprevent efeito colateral).</span><span class="sxs-lookup"><span data-stu-id="50e31-174">Immediate send is also useful when hello fabric client is closing (for example, hello process has determined invalid state and needs tooshut down tooprevent side effects).</span></span> <span data-ttu-id="50e31-175">Isso garante que um envio de melhor esforço de relatórios Olá acumulado.</span><span class="sxs-lookup"><span data-stu-id="50e31-175">It ensures a best-effort send of hello accumulated reports.</span></span> <span data-ttu-id="50e31-176">Quando um relatório é adicionado com o sinalizador de imediato, o cliente da integridade de saudação lotes todos os relatórios de saudação acumulado desde o último envio.</span><span class="sxs-lookup"><span data-stu-id="50e31-176">When one report is added with Immediate flag, hello health client batches all hello accumulated reports since last send.</span></span>

<span data-ttu-id="50e31-177">Os mesmos parâmetros podem ser especificados quando um cluster de tooa de conexão é criado por meio do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="50e31-177">Same parameters can be specified when a connection tooa cluster is created through PowerShell.</span></span> <span data-ttu-id="50e31-178">saudação de exemplo a seguir inicia um cluster local do tooa de conexão:</span><span class="sxs-lookup"><span data-stu-id="50e31-178">hello following example starts a connection tooa local cluster:</span></span>

```powershell
PS C:\> Connect-ServiceFabricCluster -HealthOperationTimeoutInSec 120 -HealthReportSendIntervalInSec 0 -HealthReportRetrySendIntervalInSec 40
True

ConnectionEndpoint   :
FabricClientSettings : {
                       ClientFriendlyName                   : PowerShell-1944858a-4c6d-465f-89c7-9021c12ac0bb
                       PartitionLocationCacheLimit          : 100000
                       PartitionLocationCacheBucketCount    : 1024
                       ServiceChangePollInterval            : 00:02:00
                       ConnectionInitializationTimeout      : 00:00:02
                       KeepAliveInterval                    : 00:00:20
                       HealthOperationTimeout               : 00:02:00
                       HealthReportSendInterval             : 00:00:00
                       HealthReportRetrySendInterval        : 00:00:40
                       NotificationGatewayConnectionTimeout : 00:00:00
                       NotificationCacheUpdateTimeout       : 00:00:00
                       }
GatewayInformation   : {
                       NodeAddress                          : localhost:19000
                       NodeId                               : 1880ec88a3187766a6da323399721f53
                       NodeInstanceId                       : 130729063464981219
                       NodeName                             : Node.1
                       }
```

<span data-ttu-id="50e31-179">Da mesma forma tooAPI, relatórios podem ser enviados usando `-Immediate` alternar toobe enviada imediatamente, independentemente de saudação `HealthReportSendInterval` valor.</span><span class="sxs-lookup"><span data-stu-id="50e31-179">Similarly tooAPI, reports can be sent using `-Immediate` switch toobe sent immediately, regardless of hello `HealthReportSendInterval` value.</span></span>

<span data-ttu-id="50e31-180">Para REST, Olá relatórios são enviados gateway do Service Fabric toohello, que tem um cliente de malha interna.</span><span class="sxs-lookup"><span data-stu-id="50e31-180">For REST, hello reports are sent toohello Service Fabric gateway, which has an internal fabric client.</span></span> <span data-ttu-id="50e31-181">Por padrão, esse cliente estiver configurado toosend relatórios em lote a cada 30 segundos.</span><span class="sxs-lookup"><span data-stu-id="50e31-181">By default, this client is configured toosend reports batched every 30 seconds.</span></span> <span data-ttu-id="50e31-182">Você pode alterar o intervalo de lote de saudação com configuração de cluster Olá `HttpGatewayHealthReportSendInterval` em `HttpGateway`.</span><span class="sxs-lookup"><span data-stu-id="50e31-182">You can change hello batch interval with hello cluster configuration setting `HttpGatewayHealthReportSendInterval` on `HttpGateway`.</span></span> <span data-ttu-id="50e31-183">Conforme mencionado, a melhor opção é toosend Olá relatórios com `Immediate` true.</span><span class="sxs-lookup"><span data-stu-id="50e31-183">As mentioned, a better option is toosend hello reports with `Immediate` true.</span></span> 

> [!NOTE]
> <span data-ttu-id="50e31-184">tooensure não autorizados de serviços não pode relatar a integridade em relação a entidades de saudação em cluster hello, configurar tooaccept solicitações Olá somente de clientes protegidos.</span><span class="sxs-lookup"><span data-stu-id="50e31-184">tooensure that unauthorized services can't report health against hello entities in hello cluster, configure hello server tooaccept requests only from secured clients.</span></span> <span data-ttu-id="50e31-185">Olá `FabricClient` usado para o relatório deve ter segurança habilitada toocommunicate capaz de toobe com cluster hello (por exemplo, com a autenticação Kerberos ou certificado).</span><span class="sxs-lookup"><span data-stu-id="50e31-185">hello `FabricClient` used for reporting must have security enabled toobe able toocommunicate with hello cluster (for example, with Kerberos or certificate authentication).</span></span> <span data-ttu-id="50e31-186">Leia mais sobre [segurança de cluster](service-fabric-cluster-security.md).</span><span class="sxs-lookup"><span data-stu-id="50e31-186">Read more about [cluster security](service-fabric-cluster-security.md).</span></span>
> 
> 

## <a name="report-from-within-low-privilege-services"></a><span data-ttu-id="50e31-187">Relatório nos serviços de baixo privilégio</span><span class="sxs-lookup"><span data-stu-id="50e31-187">Report from within low privilege services</span></span>
<span data-ttu-id="50e31-188">Se os serviços do Service Fabric não tiver um cluster de toohello de acesso de administrador, você poderá relatar integridade de entidades de contexto atual por meio de saudação `Partition` ou `CodePackageActivationContext`.</span><span class="sxs-lookup"><span data-stu-id="50e31-188">If Service Fabric services do not have admin access toohello cluster, you can report health on entities from hello current context through `Partition` or `CodePackageActivationContext`.</span></span>

* <span data-ttu-id="50e31-189">Para serviços sem monitoração de estado, use [IStatelessServicePartition.ReportInstanceHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatelessservicepartition.reportinstancehealth) tooreport na instância de serviço atual hello.</span><span class="sxs-lookup"><span data-stu-id="50e31-189">For stateless services, use [IStatelessServicePartition.ReportInstanceHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatelessservicepartition.reportinstancehealth) tooreport on hello current service instance.</span></span>
* <span data-ttu-id="50e31-190">Para serviços com monitoração de estado, use [IStatefulServicePartition.ReportReplicaHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatefulservicepartition.reportreplicahealth) tooreport na réplica atual.</span><span class="sxs-lookup"><span data-stu-id="50e31-190">For stateful services, use [IStatefulServicePartition.ReportReplicaHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatefulservicepartition.reportreplicahealth) tooreport on current replica.</span></span>
* <span data-ttu-id="50e31-191">Use [IServicePartition.ReportPartitionHealth](https://docs.microsoft.com/dotnet/api/system.fabric.iservicepartition.reportpartitionhealth) tooreport na entidade de partição atual hello.</span><span class="sxs-lookup"><span data-stu-id="50e31-191">Use [IServicePartition.ReportPartitionHealth](https://docs.microsoft.com/dotnet/api/system.fabric.iservicepartition.reportpartitionhealth) tooreport on hello current partition entity.</span></span>
* <span data-ttu-id="50e31-192">Use [CodePackageActivationContext.ReportApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportapplicationhealth) tooreport no aplicativo atual.</span><span class="sxs-lookup"><span data-stu-id="50e31-192">Use [CodePackageActivationContext.ReportApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportapplicationhealth) tooreport on current application.</span></span>
* <span data-ttu-id="50e31-193">Use [CodePackageActivationContext.ReportDeployedApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedapplicationhealth) tooreport no aplicativo atual de saudação implantado no nó atual hello.</span><span class="sxs-lookup"><span data-stu-id="50e31-193">Use [CodePackageActivationContext.ReportDeployedApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedapplicationhealth) tooreport on hello current application deployed on hello current node.</span></span>
* <span data-ttu-id="50e31-194">Use [CodePackageActivationContext.ReportDeployedServicePackageHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedservicepackagehealth) tooreport em um pacote de serviço para o aplicativo hello implantado no nó atual hello.</span><span class="sxs-lookup"><span data-stu-id="50e31-194">Use [CodePackageActivationContext.ReportDeployedServicePackageHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedservicepackagehealth) tooreport on a service package for hello application deployed on hello current node.</span></span>

> [!NOTE]
> <span data-ttu-id="50e31-195">Internamente, Olá `Partition` e hello `CodePackageActivationContext` mantenha um cliente de integridade configurado com as configurações padrão.</span><span class="sxs-lookup"><span data-stu-id="50e31-195">Internally, hello `Partition` and hello `CodePackageActivationContext` hold a health client configured with default settings.</span></span> <span data-ttu-id="50e31-196">Conforme explicado para Olá [cliente integridade](service-fabric-report-health.md#health-client), relatórios são reunidos e enviados em um timer.</span><span class="sxs-lookup"><span data-stu-id="50e31-196">As explained for hello [health client](service-fabric-report-health.md#health-client), reports are batched and sent on a timer.</span></span> <span data-ttu-id="50e31-197">Olá objetos devem ser mantidos toohave ativa um relatório de saudação toosend chance.</span><span class="sxs-lookup"><span data-stu-id="50e31-197">hello objects should be kept alive toohave a chance toosend hello report.</span></span>
> 
> 

<span data-ttu-id="50e31-198">Você pode especificar `HealthReportSendOptions` durante o envio de relatórios por meio de APIs de integridade de`Partition` e `CodePackageActivationContext`.</span><span class="sxs-lookup"><span data-stu-id="50e31-198">You can specify `HealthReportSendOptions` when sending reports through `Partition` and `CodePackageActivationContext` health APIs.</span></span> <span data-ttu-id="50e31-199">Se você tiver relatórios importantes que devem ser enviados assim que possível, use `HealthReportSendOptions` com `true` imediato.</span><span class="sxs-lookup"><span data-stu-id="50e31-199">If you have critical reports that must be sent as soon as possible, use `HealthReportSendOptions` with Immediate `true`.</span></span> <span data-ttu-id="50e31-200">Relatórios imediatos ignoram Olá intervalo do cliente do hello interna de integridade de envio em lote.</span><span class="sxs-lookup"><span data-stu-id="50e31-200">Immediate reports bypass hello batching interval of hello internal health client.</span></span> <span data-ttu-id="50e31-201">Como mencionado anteriormente, use este sinalizador com cuidado. queremos tootake vantagem do cliente de integridade Olá envio em lote sempre que possível.</span><span class="sxs-lookup"><span data-stu-id="50e31-201">As mentioned before, use this flag with care; we want tootake advantage of hello health client batching whenever possible.</span></span>

## <a name="design-health-reporting"></a><span data-ttu-id="50e31-202">Projetar relatórios de integridade</span><span class="sxs-lookup"><span data-stu-id="50e31-202">Design health reporting</span></span>
<span data-ttu-id="50e31-203">Olá primeira etapa na geração de relatórios de alta qualidade é identificar condições de saudação que podem afetar a integridade de saudação do serviço de saudação.</span><span class="sxs-lookup"><span data-stu-id="50e31-203">hello first step in generating high-quality reports is identifying hello conditions that can impact hello health of hello service.</span></span> <span data-ttu-id="50e31-204">Qualquer condição que pode ajudar a problemas de sinalizador em cluster ou serviço hello quando ele for – ou melhor ainda, antes de um problema ocorre, poderá salvar bilhões de dólares.</span><span class="sxs-lookup"><span data-stu-id="50e31-204">Any condition that can help flag problems in hello service or cluster when it starts--or even better, before a problem happens--can potentially save billions of dollars.</span></span> <span data-ttu-id="50e31-205">benefícios de saudação incluem menor tempo de inatividade, menos horas noite gastaram analisar e reparar problemas e maior satisfação do cliente.</span><span class="sxs-lookup"><span data-stu-id="50e31-205">hello benefits include less down time, fewer night hours spent investigating and repairing issues, and higher customer satisfaction.</span></span>

<span data-ttu-id="50e31-206">Depois de condições de saudação são identificadas, gravadores de watchdog necessário toofigure out Olá melhor maneira toomonitor-los para o equilíbrio entre sobrecarga e utilidade.</span><span class="sxs-lookup"><span data-stu-id="50e31-206">Once hello conditions are identified, watchdog writers need toofigure out hello best way toomonitor them for balance between overhead and usefulness.</span></span> <span data-ttu-id="50e31-207">Por exemplo, pense em um serviço que faça cálculos complexos usando alguns arquivos temporários em um compartilhamento.</span><span class="sxs-lookup"><span data-stu-id="50e31-207">For example, consider a service that does complex calculations that use some temporary files on a share.</span></span> <span data-ttu-id="50e31-208">Um watchdog pode monitorar Olá compartilhamento tooensure que espaço suficiente está disponível.</span><span class="sxs-lookup"><span data-stu-id="50e31-208">A watchdog could monitor hello share tooensure that enough space is available.</span></span> <span data-ttu-id="50e31-209">Ele pode escutar notificações de alterações em arquivo ou diretório.</span><span class="sxs-lookup"><span data-stu-id="50e31-209">It could listen for notifications of file or directory changes.</span></span> <span data-ttu-id="50e31-210">Ele poderia relatar um aviso se um limite inicial for alcançado e relatará um erro se o compartilhamento de saudação está cheio.</span><span class="sxs-lookup"><span data-stu-id="50e31-210">It could report a warning if an upfront threshold is reached, and report an error if hello share is full.</span></span> <span data-ttu-id="50e31-211">Em um aviso, um sistema de reparo foi possível iniciar a limpeza dos arquivos mais antigos no compartilhamento de saudação.</span><span class="sxs-lookup"><span data-stu-id="50e31-211">On a warning, a repair system could start cleaning up older files on hello share.</span></span> <span data-ttu-id="50e31-212">Em um erro, um sistema de reparo podia se mover tooanother nó da réplica de serviço hello.</span><span class="sxs-lookup"><span data-stu-id="50e31-212">On an error, a repair system could move hello service replica tooanother node.</span></span> <span data-ttu-id="50e31-213">Observe como os estados de condição Olá estão descritos em termos de integridade: Olá estado de saudação condição que pode ser considerada íntegra (okey) ou não íntegro (aviso ou erro).</span><span class="sxs-lookup"><span data-stu-id="50e31-213">Note how hello condition states are described in terms of health: hello state of hello condition that can be considered healthy (ok) or unhealthy (warning or error).</span></span>

<span data-ttu-id="50e31-214">Depois de definir os detalhes de monitoramento de saudação, um gravador de watchdog precisa toofigure out como tooimplement Olá watchdog.</span><span class="sxs-lookup"><span data-stu-id="50e31-214">Once hello monitoring details are set, a watchdog writer needs toofigure out how tooimplement hello watchdog.</span></span> <span data-ttu-id="50e31-215">Se condições Olá podem ser determinadas no serviço hello, watchdog Olá pode ser parte do próprio serviço Olá monitorado.</span><span class="sxs-lookup"><span data-stu-id="50e31-215">If hello conditions can be determined from within hello service, hello watchdog can be part of hello monitored service itself.</span></span> <span data-ttu-id="50e31-216">Por exemplo, código de serviço de Olá pode verificar o uso de compartilhamento de saudação e relatar toda vez que ele tenta toowrite um arquivo.</span><span class="sxs-lookup"><span data-stu-id="50e31-216">For example, hello service code can check hello share usage, and then report every time it tries toowrite a file.</span></span> <span data-ttu-id="50e31-217">Olá vantagem dessa abordagem é reporting simple.</span><span class="sxs-lookup"><span data-stu-id="50e31-217">hello advantage of this approach is that reporting is simple.</span></span> <span data-ttu-id="50e31-218">Tome cuidado tooprevent bugs de watchdog de afetar a funcionalidade do serviço hello.</span><span class="sxs-lookup"><span data-stu-id="50e31-218">Care must be taken tooprevent watchdog bugs from impacting hello service functionality.</span></span>

<span data-ttu-id="50e31-219">Emissão de relatórios do serviço Olá monitorado nem sempre é uma opção.</span><span class="sxs-lookup"><span data-stu-id="50e31-219">Reporting from within hello monitored service is not always an option.</span></span> <span data-ttu-id="50e31-220">Um watchdog no serviço de saudação não pode ser capaz de toodetect condições de saudação.</span><span class="sxs-lookup"><span data-stu-id="50e31-220">A watchdog within hello service may not be able toodetect hello conditions.</span></span> <span data-ttu-id="50e31-221">Ele pode não ter Olá lógica ou dados toomake Olá determinação.</span><span class="sxs-lookup"><span data-stu-id="50e31-221">It may not have hello logic or data toomake hello determination.</span></span> <span data-ttu-id="50e31-222">sobrecarga de saudação do monitoramento de condições de saudação poderá ser alta.</span><span class="sxs-lookup"><span data-stu-id="50e31-222">hello overhead of monitoring hello conditions may be high.</span></span> <span data-ttu-id="50e31-223">Olá condições também podem não ser tooa específico de serviço, mas em vez disso, afetam as interações entre serviços.</span><span class="sxs-lookup"><span data-stu-id="50e31-223">hello conditions also may not be specific tooa service, but instead affect interactions between services.</span></span> <span data-ttu-id="50e31-224">Outra opção é toohave watchdogs cluster hello como processos separados.</span><span class="sxs-lookup"><span data-stu-id="50e31-224">Another option is toohave watchdogs in hello cluster as separate processes.</span></span> <span data-ttu-id="50e31-225">watchdogs Olá monitoram condições hello e relatório, sem afetar os principais serviços Olá de qualquer forma.</span><span class="sxs-lookup"><span data-stu-id="50e31-225">hello watchdogs monitor hello conditions and report, without affecting hello main services in any way.</span></span> <span data-ttu-id="50e31-226">Por exemplo, esses watchdogs podem ser implementados como serviços sem monitoração de estado no hello mesmo aplicativo, implantado em todos os nós ou Olá mesmos nós como serviço hello.</span><span class="sxs-lookup"><span data-stu-id="50e31-226">For example, these watchdogs could be implemented as stateless services in hello same application, deployed on all nodes or on hello same nodes as hello service.</span></span>

<span data-ttu-id="50e31-227">Às vezes, uma vigia em execução no cluster de saudação não é uma opção.</span><span class="sxs-lookup"><span data-stu-id="50e31-227">Sometimes, a watchdog running in hello cluster is not an option either.</span></span> <span data-ttu-id="50e31-228">Se condição Olá monitorado for disponibilidade hello ou a funcionalidade do serviço de saudação como os usuários o vejam, é melhor watchdogs de saudação toohave em Olá mesmo local como clientes do usuário Olá.</span><span class="sxs-lookup"><span data-stu-id="50e31-228">If hello monitored condition is hello availability or functionality of hello service as users see it, it's best toohave hello watchdogs in hello same place as hello user clients.</span></span> <span data-ttu-id="50e31-229">Lá, eles podem testar operações Olá Olá mesmo modo como os usuários chamá-los.</span><span class="sxs-lookup"><span data-stu-id="50e31-229">There, they can test hello operations in hello same way users call them.</span></span> <span data-ttu-id="50e31-230">Por exemplo, você pode ter um watchdog que reside fora de cluster hello, emite solicitações de serviço toohello e verifica a latência de saudação e a exatidão dos resultados de saudação.</span><span class="sxs-lookup"><span data-stu-id="50e31-230">For example, you can have a watchdog that lives outside hello cluster, issues requests toohello service, and checks hello latency and correctness of hello result.</span></span> <span data-ttu-id="50e31-231">(Para um serviço de calculadora, por exemplo, 2+2 retorna 4 em um período de tempo razoável?)</span><span class="sxs-lookup"><span data-stu-id="50e31-231">(For a calculator service, for example, does 2+2 return 4 in a reasonable amount of time?)</span></span>

<span data-ttu-id="50e31-232">Depois que os detalhes de watchdog Olá forem concluídas, você deve escolher uma ID de origem que identifica com exclusividade.</span><span class="sxs-lookup"><span data-stu-id="50e31-232">Once hello watchdog details have been finalized, you should decide on a source ID that uniquely identifies it.</span></span> <span data-ttu-id="50e31-233">Se vários watchdogs de saudação mesmo tipo são mora em hello cluster, eles devem relatar entidades diferentes ou, se eles relatam Olá mesma entidade, ID de origem diferente do uso ou propriedade.</span><span class="sxs-lookup"><span data-stu-id="50e31-233">If multiple watchdogs of hello same type are living in hello cluster, they must report on different entities, or, if they report on hello same entity, use different source ID or property.</span></span> <span data-ttu-id="50e31-234">Dessa forma, os relatórios poderão coexistir.</span><span class="sxs-lookup"><span data-stu-id="50e31-234">This way, their reports can coexist.</span></span> <span data-ttu-id="50e31-235">propriedade de saudação do relatório de integridade Olá deve capturar condição Olá monitorado.</span><span class="sxs-lookup"><span data-stu-id="50e31-235">hello property of hello health report should capture hello monitored condition.</span></span> <span data-ttu-id="50e31-236">(Para o exemplo hello acima, a propriedade Olá poderia ser **ShareSize**.) Se vários relatórios aplicam toohello mesma condição, hello propriedade deve conter algumas informações dinâmicas que permite toocoexist de relatórios.</span><span class="sxs-lookup"><span data-stu-id="50e31-236">(For hello example above, hello property could be **ShareSize**.) If multiple reports apply toohello same condition, hello property should contain some dynamic information that allows reports toocoexist.</span></span> <span data-ttu-id="50e31-237">Por exemplo, se precisarem de vários compartilhamentos toobe monitorado, pode ser o nome da propriedade Olá **ShareSize sharename**.</span><span class="sxs-lookup"><span data-stu-id="50e31-237">For example, if multiple shares need toobe monitored, hello property name can be **ShareSize-sharename**.</span></span>

> [!NOTE]
> <span data-ttu-id="50e31-238">Fazer *não* use informações de status tookeep do repositório de integridade hello.</span><span class="sxs-lookup"><span data-stu-id="50e31-238">Do *not* use hello health store tookeep status information.</span></span> <span data-ttu-id="50e31-239">Somente as informações relacionadas à integridade devem ser relatadas como integridade, como esta avaliação de integridade de saudação impactos informações de uma entidade.</span><span class="sxs-lookup"><span data-stu-id="50e31-239">Only health-related information should be reported as health, as this information impacts hello health evaluation of an entity.</span></span> <span data-ttu-id="50e31-240">repositório de integridade de saudação não foi projetado como um repositório de finalidade geral.</span><span class="sxs-lookup"><span data-stu-id="50e31-240">hello health store was not designed as a general-purpose store.</span></span> <span data-ttu-id="50e31-241">Ele usa todos os dados tooaggregate de lógica de avaliação de integridade para o estado de integridade de saudação.</span><span class="sxs-lookup"><span data-stu-id="50e31-241">It uses health evaluation logic tooaggregate all data into hello health state.</span></span> <span data-ttu-id="50e31-242">Envio de informações não relacionada toohealth (como o relatório de status com um estado de integridade de Okey) não afeta a saudação agregado estado de integridade, mas isso pode afetar negativamente o desempenho de saudação do repositório de integridade de saudação.</span><span class="sxs-lookup"><span data-stu-id="50e31-242">Sending information unrelated toohealth (like reporting status with a health state of OK) doesn't impact hello aggregated health state, but it can negatively affect hello performance of hello health store.</span></span>
> 
> 

<span data-ttu-id="50e31-243">Olá próximo ponto de decisão seja tooreport qual entidade no.</span><span class="sxs-lookup"><span data-stu-id="50e31-243">hello next decision point is which entity tooreport on.</span></span> <span data-ttu-id="50e31-244">A maioria de tempo de saudação, condição Olá claramente idetifies Olá entidade.</span><span class="sxs-lookup"><span data-stu-id="50e31-244">Most of hello time, hello condition clearly idetifies hello entity.</span></span> <span data-ttu-id="50e31-245">Escolha a entidade de saudação com melhor granularidade possíveis.</span><span class="sxs-lookup"><span data-stu-id="50e31-245">Choose hello entity with best possible granularity.</span></span> <span data-ttu-id="50e31-246">Se uma condição afeta todas as réplicas de uma partição, relate partição hello, não no serviço de saudação.</span><span class="sxs-lookup"><span data-stu-id="50e31-246">If a condition impacts all replicas in a partition, report on hello partition, not on hello service.</span></span> <span data-ttu-id="50e31-247">Porém, há situações extremas em que é preciso ter mais cuidado.</span><span class="sxs-lookup"><span data-stu-id="50e31-247">There are corner cases where more thought is needed, though.</span></span> <span data-ttu-id="50e31-248">Se condição Olá afeta uma entidade, como uma réplica, mas Olá desejo é toohave Olá condição sinalizada para mais de duração de saudação da vida útil da réplica, em seguida, ele deve ser relatado na partição de saudação.</span><span class="sxs-lookup"><span data-stu-id="50e31-248">If hello condition impacts an entity, such as a replica, but hello desire is toohave hello condition flagged for more than hello duration of replica life, then it should be reported on hello partition.</span></span> <span data-ttu-id="50e31-249">Caso contrário, quando Olá réplica for excluída, o repositório de integridade Olá limpa todos os seus relatórios.</span><span class="sxs-lookup"><span data-stu-id="50e31-249">Otherwise, when hello replica is deleted, hello health store cleans up all its reports.</span></span> <span data-ttu-id="50e31-250">Gravadores de watchdog devem pensar em tempos de vida de saudação de entidade hello e relatório hello.</span><span class="sxs-lookup"><span data-stu-id="50e31-250">Watchdog writers must think about hello lifetimes of hello entity and hello report.</span></span> <span data-ttu-id="50e31-251">Deve ficar claro quando um relatório deverá ser eliminado de um repositório (por exemplo, quando um erro relatado em uma entidade não for mais aplicável).</span><span class="sxs-lookup"><span data-stu-id="50e31-251">It must be clear when a report should be cleaned up from a store (for example, when an error reported on an entity no longer applies).</span></span>

<span data-ttu-id="50e31-252">Vejamos um exemplo que reúna pontos Olá descrito.</span><span class="sxs-lookup"><span data-stu-id="50e31-252">Let's look at an example that puts together hello points I described.</span></span> <span data-ttu-id="50e31-253">Considere um aplicativo do Service Fabric composto por um serviço persistente com estado mestre e serviços sem estado secundários implantados em todos os nós (um tipo de serviço secundário para cada tipo de tarefa).</span><span class="sxs-lookup"><span data-stu-id="50e31-253">Consider a Service Fabric application composed of a master stateful persistent service and secondary stateless services deployed on all nodes (one secondary service type for each type of task).</span></span> <span data-ttu-id="50e31-254">mestre de saudação tem uma fila de processamento que contém comandos toobe executado pelo secundários.</span><span class="sxs-lookup"><span data-stu-id="50e31-254">hello master has a processing queue that contains commands toobe executed by secondaries.</span></span> <span data-ttu-id="50e31-255">secundários Olá executar solicitações de entrada hello e enviar confirmação back sinais.</span><span class="sxs-lookup"><span data-stu-id="50e31-255">hello secondaries execute hello incoming requests and send back acknowledgement signals.</span></span> <span data-ttu-id="50e31-256">Uma condição que pode ser monitorada é o comprimento de saudação da fila de processamento mestre hello.</span><span class="sxs-lookup"><span data-stu-id="50e31-256">One condition that could be monitored is hello length of hello master processing queue.</span></span> <span data-ttu-id="50e31-257">Se o comprimento de fila mestre Olá atinge um limite, um aviso é relatado.</span><span class="sxs-lookup"><span data-stu-id="50e31-257">If hello master queue length reaches a threshold, a warning is reported.</span></span> <span data-ttu-id="50e31-258">Aviso de saudação indica que secundários Olá não podem lidar com a carga de saudação.</span><span class="sxs-lookup"><span data-stu-id="50e31-258">hello warning indicates that hello secondaries can't handle hello load.</span></span> <span data-ttu-id="50e31-259">Se fila Olá atinge o tamanho máximo de saudação e comandos são descartados, um erro for relatado, como Olá não é possível recuperar o serviço.</span><span class="sxs-lookup"><span data-stu-id="50e31-259">If hello queue reaches hello maximum length and commands are dropped, an error is reported, as hello service can't recover.</span></span> <span data-ttu-id="50e31-260">Olá os relatórios podem ser propriedade de saudação **QueueStatus**.</span><span class="sxs-lookup"><span data-stu-id="50e31-260">hello reports can be on hello property **QueueStatus**.</span></span> <span data-ttu-id="50e31-261">watchdog Olá reside no serviço hello e são enviada periodicamente na réplica primária do mestre hello.</span><span class="sxs-lookup"><span data-stu-id="50e31-261">hello watchdog lives inside hello service, and it's sent periodically on hello master primary replica.</span></span> <span data-ttu-id="50e31-262">tempo de saudação toolive é 2 minutos e é enviado periodicamente a cada 30 segundos.</span><span class="sxs-lookup"><span data-stu-id="50e31-262">hello time toolive is two minutes, and it's sent periodically every 30 seconds.</span></span> <span data-ttu-id="50e31-263">Se Olá primário falhar, relatório de saudação é limpa automaticamente da loja.</span><span class="sxs-lookup"><span data-stu-id="50e31-263">If hello primary goes down, hello report is cleaned up automatically from store.</span></span> <span data-ttu-id="50e31-264">Se a réplica de serviço Olá estiver ativo, mas ele está bloqueado ou outros problemas, Olá relatório expira no repositório de integridade de saudação.</span><span class="sxs-lookup"><span data-stu-id="50e31-264">If hello service replica is up, but it is deadlocked or having other issues, hello report expires in hello health store.</span></span> <span data-ttu-id="50e31-265">Nesse caso, a entidade de saudação é avaliada em erro.</span><span class="sxs-lookup"><span data-stu-id="50e31-265">In this case, hello entity is evaluated at error.</span></span>

<span data-ttu-id="50e31-266">Outra condição que pode ser monitorada é o tempo de execução da tarefa.</span><span class="sxs-lookup"><span data-stu-id="50e31-266">Another condition that can be monitored is task execution time.</span></span> <span data-ttu-id="50e31-267">Olá, mestre distribui tarefas toohello secundários com base no tipo de tarefa de saudação.</span><span class="sxs-lookup"><span data-stu-id="50e31-267">hello master distributes tasks toohello secondaries based on hello task type.</span></span> <span data-ttu-id="50e31-268">Dependendo do design de saudação mestre Olá pode sondar secundários Olá para o status da tarefa.</span><span class="sxs-lookup"><span data-stu-id="50e31-268">Depending on hello design, hello master could poll hello secondaries for task status.</span></span> <span data-ttu-id="50e31-269">Ele também pode aguardar secundários toosend confirmação back sinais quando eles são feitos.</span><span class="sxs-lookup"><span data-stu-id="50e31-269">It could also wait for secondaries toosend back acknowledgement signals when they are done.</span></span> <span data-ttu-id="50e31-270">No segundo caso de Olá, tome cuidado toodetect situações em que o chip secundários ou mensagens sejam perdidas.</span><span class="sxs-lookup"><span data-stu-id="50e31-270">In hello second case, care must be taken toodetect situations where secondaries die or messages are lost.</span></span> <span data-ttu-id="50e31-271">Uma opção é para Olá mestre toosend um toohello de solicitação de ping mesmo secundário, que envia seu status.</span><span class="sxs-lookup"><span data-stu-id="50e31-271">One option is for hello master toosend a ping request toohello same secondary, which sends back its status.</span></span> <span data-ttu-id="50e31-272">Se nenhum status for recebida, o mestre de saudação considera uma falha e reagenda tarefas hello.</span><span class="sxs-lookup"><span data-stu-id="50e31-272">If no status is received, hello master considers it a failure and reschedules hello task.</span></span> <span data-ttu-id="50e31-273">Esse comportamento assume que tarefas de saudação são idempotentes.</span><span class="sxs-lookup"><span data-stu-id="50e31-273">This behavior assumes that hello tasks are idempotent.</span></span>

<span data-ttu-id="50e31-274">condição Olá monitorado pode ser traduzida como um aviso se a tarefa de saudação não é feita em uma determinada hora (**t1**, por exemplo, 10 minutos).</span><span class="sxs-lookup"><span data-stu-id="50e31-274">hello monitored condition can be translated as a warning if hello task is not done in a certain time (**t1**, for example 10 minutes).</span></span> <span data-ttu-id="50e31-275">Se a tarefa de saudação não foi concluída no tempo (**t2**, por exemplo, 20 minutos), condição Olá monitorado pode ser traduzida como o erro.</span><span class="sxs-lookup"><span data-stu-id="50e31-275">If hello task is not completed in time (**t2**, for example 20 minutes), hello monitored condition can be translated as Error.</span></span> <span data-ttu-id="50e31-276">Esse relatório pode ser gerado de várias maneiras:</span><span class="sxs-lookup"><span data-stu-id="50e31-276">This reporting can be done in multiple ways:</span></span>

* <span data-ttu-id="50e31-277">réplica primária do mestre Olá relata periodicamente em si mesmo.</span><span class="sxs-lookup"><span data-stu-id="50e31-277">hello master primary replica reports on itself periodically.</span></span> <span data-ttu-id="50e31-278">Você pode ter uma propriedade para todas as tarefas pendentes na fila de saudação.</span><span class="sxs-lookup"><span data-stu-id="50e31-278">You can have one property for all pending tasks in hello queue.</span></span> <span data-ttu-id="50e31-279">Se pelo menos uma tarefa leva mais tempo, relatar o status do hello na propriedade Olá **PendingTasks** é um aviso ou erro, conforme apropriado.</span><span class="sxs-lookup"><span data-stu-id="50e31-279">If at least one task takes longer, hello report status on hello property **PendingTasks** is a warning or error, as appropriate.</span></span> <span data-ttu-id="50e31-280">Se não existem tarefas pendentes ou todas as tarefas iniciou a execução, o status do relatório Olá é Okey.</span><span class="sxs-lookup"><span data-stu-id="50e31-280">If there are no pending tasks or all tasks started execution, hello report status is OK.</span></span> <span data-ttu-id="50e31-281">tarefas de saudação são persistentes.</span><span class="sxs-lookup"><span data-stu-id="50e31-281">hello tasks are persistent.</span></span> <span data-ttu-id="50e31-282">Se Olá primário falhar, primário Olá promovido recentemente pode continuar tooreport corretamente.</span><span class="sxs-lookup"><span data-stu-id="50e31-282">If hello primary goes down, hello newly promoted primary can continue tooreport properly.</span></span>
* <span data-ttu-id="50e31-283">Outro processo de watchdog (na nuvem hello ou externa) verifica tarefas hello (de fora, com base no resultado da tarefa Olá desejado) toosee se eles são concluídos.</span><span class="sxs-lookup"><span data-stu-id="50e31-283">Another watchdog process (in hello cloud or external) checks hello tasks (from outside, based on hello desired task result) toosee if they are completed.</span></span> <span data-ttu-id="50e31-284">Se eles não respeitam os limites de saudação, um relatório é enviado no serviço mestre hello.</span><span class="sxs-lookup"><span data-stu-id="50e31-284">If they do not respect hello thresholds, a report is sent on hello master service.</span></span> <span data-ttu-id="50e31-285">Um relatório também é enviado em cada tarefa que inclui o identificador de tarefa hello, como **PendingTask + taskId**.</span><span class="sxs-lookup"><span data-stu-id="50e31-285">A report is also sent on each task that includes hello task identifier, like **PendingTask+taskId**.</span></span> <span data-ttu-id="50e31-286">Os relatórios devem ser enviados somente em estados não íntegros.</span><span class="sxs-lookup"><span data-stu-id="50e31-286">Reports should be sent only on unhealthy states.</span></span> <span data-ttu-id="50e31-287">Defina tooa toolive tempo alguns minutos e marcar Olá relatórios toobe removido quando eles expiram tooensure limpeza.</span><span class="sxs-lookup"><span data-stu-id="50e31-287">Set time toolive tooa few minutes, and mark hello reports toobe removed when they expire tooensure cleanup.</span></span>
* <span data-ttu-id="50e31-288">Olá secundária que está executando uma tarefa informa quando leva mais tempo do que esperado toorun-lo.</span><span class="sxs-lookup"><span data-stu-id="50e31-288">hello secondary that is executing a task reports when it takes longer than expected toorun it.</span></span> <span data-ttu-id="50e31-289">Informa na instância de serviço Olá na propriedade Olá **PendingTasks**.</span><span class="sxs-lookup"><span data-stu-id="50e31-289">It reports on hello service instance on hello property **PendingTasks**.</span></span> <span data-ttu-id="50e31-290">relatório Olá identifica a instância de serviço de saudação que tem problemas, mas ele não captura situação Olá onde a instância de saudação falhar.</span><span class="sxs-lookup"><span data-stu-id="50e31-290">hello report pinpoints hello service instance that has issues, but it doesn't capture hello situation where hello instance dies.</span></span> <span data-ttu-id="50e31-291">Olá relatórios são limpos depois.</span><span class="sxs-lookup"><span data-stu-id="50e31-291">hello reports are cleaned up then.</span></span> <span data-ttu-id="50e31-292">Ele pode relatar serviço secundário hello.</span><span class="sxs-lookup"><span data-stu-id="50e31-292">It could report on hello secondary service.</span></span> <span data-ttu-id="50e31-293">Se Olá secundário tiver concluído a tarefa hello, instância secundária Olá limpa relatório de saudação do repositório de saudação.</span><span class="sxs-lookup"><span data-stu-id="50e31-293">If hello secondary completes hello task, hello secondary instance clears hello report from hello store.</span></span> <span data-ttu-id="50e31-294">relatório de saudação não captura situação Olá onde mensagem de confirmação de saudação é perdida e tarefa Olá não ainda terminou de ponto de vista do mestre de saudação.</span><span class="sxs-lookup"><span data-stu-id="50e31-294">hello report doesn't capture hello situation where hello acknowledgement message is lost and hello task is not finished from hello master's point of view.</span></span>

<span data-ttu-id="50e31-295">Mas Olá reporting é feito em casos Olá descritos acima, Olá relatórios são capturados na integridade do aplicativo quando a integridade é avaliada.</span><span class="sxs-lookup"><span data-stu-id="50e31-295">However hello reporting is done in hello cases described above, hello reports are captured in application health when health is evaluated.</span></span>

## <a name="report-periodically-vs-on-transition"></a><span data-ttu-id="50e31-296">Relatar periodicamente x na transição</span><span class="sxs-lookup"><span data-stu-id="50e31-296">Report periodically vs. on transition</span></span>
<span data-ttu-id="50e31-297">Usando o modelo de relatório de integridade de hello, watchdogs podem enviar relatórios periodicamente ou transições.</span><span class="sxs-lookup"><span data-stu-id="50e31-297">By using hello health reporting model, watchdogs can send reports periodically or on transitions.</span></span> <span data-ttu-id="50e31-298">Olá recomendado maneira de watchdog reporting periodicamente, é porque o código de saudação é muito mais simples e menos propenso tooerrors.</span><span class="sxs-lookup"><span data-stu-id="50e31-298">hello recommended way for watchdog reporting is periodically, because hello code is much simpler and less prone tooerrors.</span></span> <span data-ttu-id="50e31-299">watchdogs Olá devem buscar toobe tão simple quanto possível tooavoid bugs que disparam relatórios incorretos.</span><span class="sxs-lookup"><span data-stu-id="50e31-299">hello watchdogs must strive toobe as simple as possible tooavoid bugs that trigger incorrect reports.</span></span> <span data-ttu-id="50e31-300">Relatórios *não íntegro* incorretos afetam as avaliações de integridade e os cenários com base na integridade, incluindo atualizações.</span><span class="sxs-lookup"><span data-stu-id="50e31-300">Incorrect *unhealthy* reports impact health evaluations and scenarios based on health, including upgrades.</span></span> <span data-ttu-id="50e31-301">Incorreto *Íntegro* relatórios ocultar problemas no cluster hello, que não é desejado.</span><span class="sxs-lookup"><span data-stu-id="50e31-301">Incorrect *healthy* reports hide issues in hello cluster, which is not desired.</span></span>

<span data-ttu-id="50e31-302">Para relatórios periódica, watchdog Olá pode ser implementado com um temporizador.</span><span class="sxs-lookup"><span data-stu-id="50e31-302">For periodic reporting, hello watchdog can be implemented with a timer.</span></span> <span data-ttu-id="50e31-303">Em um retorno de chamada do timer, watchdog Olá pode verificar o estado de saudação e enviar um relatório com base no estado atual da saudação.</span><span class="sxs-lookup"><span data-stu-id="50e31-303">On a timer callback, hello watchdog can check hello state and send a report based on hello current state.</span></span> <span data-ttu-id="50e31-304">Não há nenhum toosee necessidade que o relatório foi enviada anteriormente ou fazer qualquer otimizações em termos de mensagens.</span><span class="sxs-lookup"><span data-stu-id="50e31-304">There is no need toosee which report was sent previously or make any optimizations in terms of messaging.</span></span> <span data-ttu-id="50e31-305">cliente de integridade de saudação tem lógica toohelp com o desempenho de processamento em lotes.</span><span class="sxs-lookup"><span data-stu-id="50e31-305">hello health client has batching logic toohelp with performance.</span></span> <span data-ttu-id="50e31-306">Enquanto o cliente da integridade de saudação é mantida ativa, ele tenta novamente internamente até relatório Olá é confirmado pelo repositório de integridade de saudação ou watchdog hello gera um relatório mais recente com hello mesma entidade, propriedade e fonte.</span><span class="sxs-lookup"><span data-stu-id="50e31-306">While hello health client is kept alive, it retries internally until hello report is acknowledged by hello health store or hello watchdog generates a newer report with hello same entity, property, and source.</span></span>

<span data-ttu-id="50e31-307">Relatórios sobre transições exigem tratamento cuidadoso do estado.</span><span class="sxs-lookup"><span data-stu-id="50e31-307">Reporting on transitions requires careful handling of state.</span></span> <span data-ttu-id="50e31-308">watchdog Olá monitora algumas condições e relata somente quando alterar condições hello.</span><span class="sxs-lookup"><span data-stu-id="50e31-308">hello watchdog monitors some conditions and reports only when hello conditions change.</span></span> <span data-ttu-id="50e31-309">Olá cabeça dessa abordagem é que menos relatórios são necessários.</span><span class="sxs-lookup"><span data-stu-id="50e31-309">hello upside of this approach is that fewer reports are needed.</span></span> <span data-ttu-id="50e31-310">desvantagem de Olá é que a lógica de saudação do watchdog Olá é complexa.</span><span class="sxs-lookup"><span data-stu-id="50e31-310">hello downside is that hello logic of hello watchdog is complex.</span></span> <span data-ttu-id="50e31-311">watchdog Olá deve manter condições hello ou Olá relatórios, para que eles possam ser inspecionados toodetermine alterações de estado.</span><span class="sxs-lookup"><span data-stu-id="50e31-311">hello watchdog must maintain hello conditions or hello reports, so that they can be inspected toodetermine state changes.</span></span> <span data-ttu-id="50e31-312">Durante o failover, deve-se ter cuidado com relatórios adicionados, mas ainda não enviadas toohello repositório de integridade.</span><span class="sxs-lookup"><span data-stu-id="50e31-312">On failover, care must be taken with reports added, but not yet sent toohello health store.</span></span> <span data-ttu-id="50e31-313">número de sequência de saudação deve ser crescente.</span><span class="sxs-lookup"><span data-stu-id="50e31-313">hello sequence number must be ever-increasing.</span></span> <span data-ttu-id="50e31-314">Caso contrário, Olá relatórios são rejeitados como obsoleto.</span><span class="sxs-lookup"><span data-stu-id="50e31-314">If not, hello reports are rejected as stale.</span></span> <span data-ttu-id="50e31-315">Em casos raros Olá onde ocorre a perda de dados, sincronização pode ser necessário entre o estado de saudação do Relator de saudação e estado de saudação do repositório de integridade de saudação.</span><span class="sxs-lookup"><span data-stu-id="50e31-315">In hello rare cases where data loss is incurred, synchronization may be needed between hello state of hello reporter and hello state of hello health store.</span></span>

<span data-ttu-id="50e31-316">Relatar transições faz sentido para serviços que relatam a si próprios, por meio de `Partition` ou `CodePackageActivationContext`.</span><span class="sxs-lookup"><span data-stu-id="50e31-316">Reporting on transitions makes sense for services reporting on themselves, through `Partition` or `CodePackageActivationContext`.</span></span> <span data-ttu-id="50e31-317">Olá quando o objeto local (réplica ou um pacote de serviço implantado / aplicativo implantado) é removido, todos os seus relatórios também serão removidos.</span><span class="sxs-lookup"><span data-stu-id="50e31-317">When hello local object (replica or deployed service package / deployed application) is removed, all its reports are also removed.</span></span> <span data-ttu-id="50e31-318">A limpeza automática alivia a necessidade de saudação para sincronização entre Relator e repositório de integridade.</span><span class="sxs-lookup"><span data-stu-id="50e31-318">This automatic cleanup relaxes hello need for synchronization between reporter and health store.</span></span> <span data-ttu-id="50e31-319">Se o relatório de saudação é para a partição pai ou o aplicativo pai, deve ter cuidado em failover tooavoid obsoletos relatórios no repositório de integridade de saudação.</span><span class="sxs-lookup"><span data-stu-id="50e31-319">If hello report is for parent partition or parent application, care must be taken on failover tooavoid stale reports in hello health store.</span></span> <span data-ttu-id="50e31-320">Lógica deve ser adicionada estado correto do toomaintain hello e relatório Olá clara do armazenamento quando não é necessário mais.</span><span class="sxs-lookup"><span data-stu-id="50e31-320">Logic must be added toomaintain hello correct state and clear hello report from store when not needed anymore.</span></span>

## <a name="implement-health-reporting"></a><span data-ttu-id="50e31-321">Implementar relatório de integridade</span><span class="sxs-lookup"><span data-stu-id="50e31-321">Implement health reporting</span></span>
<span data-ttu-id="50e31-322">Depois de hello a entidade e o relatório de detalhes estão desmarcados, enviar relatórios de integridade pode ser feito por meio da API de hello, PowerShell ou REST.</span><span class="sxs-lookup"><span data-stu-id="50e31-322">Once hello entity and report details are clear, sending health reports can be done through hello API, PowerShell, or REST.</span></span>

### <a name="api"></a><span data-ttu-id="50e31-323">API</span><span class="sxs-lookup"><span data-stu-id="50e31-323">API</span></span>
<span data-ttu-id="50e31-324">tooreport por meio de saudação API, você precisa toocreate um tipo de entidade integridade relatório toohello específicas que quiserem tooreport.</span><span class="sxs-lookup"><span data-stu-id="50e31-324">tooreport through hello API, you need toocreate a health report specific toohello entity type they want tooreport on.</span></span> <span data-ttu-id="50e31-325">Dê o cliente de integridade de tooa Olá relatórios.</span><span class="sxs-lookup"><span data-stu-id="50e31-325">Give hello report tooa health client.</span></span> <span data-ttu-id="50e31-326">Como alternativa, crie uma informações de integridade e passá-lo toocorrect reporting métodos em `Partition` ou `CodePackageActivationContext` tooreport em entidades atuais.</span><span class="sxs-lookup"><span data-stu-id="50e31-326">Alternatively, create a health information and pass it toocorrect reporting methods on `Partition` or `CodePackageActivationContext` tooreport on current entities.</span></span>

<span data-ttu-id="50e31-327">Olá a exemplo a seguir mostra periódico de relatórios a partir de um watchdog em cluster hello.</span><span class="sxs-lookup"><span data-stu-id="50e31-327">hello following example shows periodic reporting from a watchdog within hello cluster.</span></span> <span data-ttu-id="50e31-328">watchdog Olá verifica se um recurso externo pode ser acessado de dentro de um nó.</span><span class="sxs-lookup"><span data-stu-id="50e31-328">hello watchdog checks whether an external resource can be accessed from within a node.</span></span> <span data-ttu-id="50e31-329">recurso de saudação é necessária para um manifesto do serviço de aplicativo hello.</span><span class="sxs-lookup"><span data-stu-id="50e31-329">hello resource is needed by a service manifest within hello application.</span></span> <span data-ttu-id="50e31-330">Se o recurso de saudação não estiver disponível, hello outros serviços no aplicativo hello ainda funcionarão corretamente.</span><span class="sxs-lookup"><span data-stu-id="50e31-330">If hello resource is unavailable, hello other services within hello application can still function properly.</span></span> <span data-ttu-id="50e31-331">Portanto, Olá relatório é enviado na entidade de pacote de serviço Olá implantado a cada 30 segundos.</span><span class="sxs-lookup"><span data-stu-id="50e31-331">Therefore, hello report is sent on hello deployed service package entity every 30 seconds.</span></span>

```csharp
private static Uri ApplicationName = new Uri("fabric:/WordCount");
private static string ServiceManifestName = "WordCount.Service";
private static string NodeName = FabricRuntime.GetNodeContext().NodeName;
private static Timer ReportTimer = new Timer(new TimerCallback(SendReport), null, 30 * 1000, 30 * 1000);
private static FabricClient Client = new FabricClient(new FabricClientSettings() { HealthReportSendInterval = TimeSpan.FromSeconds(0) });

public static void SendReport(object obj)
{
    // Test whether hello resource can be accessed from hello node
    HealthState healthState = this.TestConnectivityToExternalResource();

    // Send report on deployed service package, as hello connectivity is needed by hello specific service manifest
    // and can be different on different nodes
    var deployedServicePackageHealthReport = new DeployedServicePackageHealthReport(
        ApplicationName,
        ServiceManifestName,
        NodeName,
        new HealthInformation("ExternalSourceWatcher", "Connectivity", healthState));

    // TODO: handle exception. Code omitted for snippet brevity.
    // Possible exceptions: FabricException with error codes
    // FabricHealthStaleReport (non-retryable, hello report is already queued on hello health client),
    // FabricHealthMaxReportsReached (retryable; user should retry with exponential delay until hello report is accepted).
    Client.HealthManager.ReportHealth(deployedServicePackageHealthReport);
}
```

### <a name="powershell"></a><span data-ttu-id="50e31-332">PowerShell</span><span class="sxs-lookup"><span data-stu-id="50e31-332">PowerShell</span></span>
<span data-ttu-id="50e31-333">Enviar relatórios de integridade com **Send-ServiceFabric*EntityType*HealthReport**.</span><span class="sxs-lookup"><span data-stu-id="50e31-333">Send health reports with **Send-ServiceFabric*EntityType*HealthReport**.</span></span>

<span data-ttu-id="50e31-334">Olá a exemplo a seguir mostra periódico de relatórios em valores de CPU em um nó.</span><span class="sxs-lookup"><span data-stu-id="50e31-334">hello following example shows periodic reporting on CPU values on a node.</span></span> <span data-ttu-id="50e31-335">Olá relatórios devem ser enviados a cada 30 segundos, e que têm um tempo toolive de dois minutos.</span><span class="sxs-lookup"><span data-stu-id="50e31-335">hello reports should be sent every 30 seconds, and they have a time toolive of two minutes.</span></span> <span data-ttu-id="50e31-336">Se eles expiram, Relator Olá tem problemas, para que o nó de saudação é avaliado em erro.</span><span class="sxs-lookup"><span data-stu-id="50e31-336">If they expire, hello reporter has issues, so hello node is evaluated at error.</span></span> <span data-ttu-id="50e31-337">Quando a saudação da CPU estiver acima de um limite, o relatório de saudação tem um estado de integridade de aviso.</span><span class="sxs-lookup"><span data-stu-id="50e31-337">When hello CPU is above a threshold, hello report has a health state of warning.</span></span> <span data-ttu-id="50e31-338">Quando a saudação da CPU permanece acima de um limite mais de tempo de saudação configurado, ele é relatado como um erro.</span><span class="sxs-lookup"><span data-stu-id="50e31-338">When hello CPU remains above a threshold for more than hello configured time, it's reported as an error.</span></span> <span data-ttu-id="50e31-339">Caso contrário, Relator Olá envia um estado de integridade de Okey.</span><span class="sxs-lookup"><span data-stu-id="50e31-339">Otherwise, hello reporter sends a health state of OK.</span></span>

```powershell
PS C:\> Send-ServiceFabricNodeHealthReport -NodeName Node.1 -HealthState Warning -SourceId PowershellWatcher -HealthProperty CPU -Description "CPU is above 80% threshold" -TimeToLiveSec 120

PS C:\> Get-ServiceFabricNodeHealth -NodeName Node.1
NodeName              : Node.1
AggregatedHealthState : Warning
UnhealthyEvaluations  :
                        Unhealthy event: SourceId='PowershellWatcher', Property='CPU', HealthState='Warning', ConsiderWarningAsError=false.

HealthEvents          :
                        SourceId              : System.FM
                        Property              : State
                        HealthState           : Ok
                        SequenceNumber        : 5
                        SentAt                : 4/21/2015 8:01:17 AM
                        ReceivedAt            : 4/21/2015 8:02:12 AM
                        TTL                   : Infinite
                        Description           : Fabric node is up.
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Ok = 4/21/2015 8:02:12 AM

                        SourceId              : PowershellWatcher
                        Property              : CPU
                        HealthState           : Warning
                        SequenceNumber        : 130741236814913394
                        SentAt                : 4/21/2015 9:01:21 PM
                        ReceivedAt            : 4/21/2015 9:01:21 PM
                        TTL                   : 00:02:00
                        Description           : CPU is above 80% threshold
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Warning = 4/21/2015 9:01:21 PM
```

<span data-ttu-id="50e31-340">Olá exemplo a seguir relata um aviso transitório em uma réplica.</span><span class="sxs-lookup"><span data-stu-id="50e31-340">hello following example reports a transient warning on a replica.</span></span> <span data-ttu-id="50e31-341">Ele primeiro obtém a ID de partição hello e hello, em seguida, a ID de réplica para o serviço de saudação em que está interessada.</span><span class="sxs-lookup"><span data-stu-id="50e31-341">It first gets hello partition ID and then hello replica ID for hello service it is interested in.</span></span> <span data-ttu-id="50e31-342">Em seguida, envia um relatório de **PowershellWatcher** na propriedade Olá **ResourceDependency**.</span><span class="sxs-lookup"><span data-stu-id="50e31-342">It then sends a report from **PowershellWatcher** on hello property **ResourceDependency**.</span></span> <span data-ttu-id="50e31-343">relatório de saudação é de interesse para apenas dois minutos e ele será removido do repositório de saudação automaticamente.</span><span class="sxs-lookup"><span data-stu-id="50e31-343">hello report is of interest for only two minutes, and it is removed from hello store automatically.</span></span>

```powershell
PS C:\> $partitionId = (Get-ServiceFabricPartition -ServiceName fabric:/WordCount/WordCount.Service).PartitionId

PS C:\> $replicaId = (Get-ServiceFabricReplica -PartitionId $partitionId | where {$_.ReplicaRole -eq "Primary"}).ReplicaId

PS C:\> Send-ServiceFabricReplicaHealthReport -PartitionId $partitionId -ReplicaId $replicaId -HealthState Warning -SourceId PowershellWatcher -HealthProperty ResourceDependency -Description "hello external resource that hello primary is using has been rebooted at 4/21/2015 9:01:21 PM. Expect processing delays for a few minutes." -TimeToLiveSec 120 -RemoveWhenExpired

PS C:\> Get-ServiceFabricReplicaHealth  -PartitionId $partitionId -ReplicaOrInstanceId $replicaId


PartitionId           : 8f82daff-eb68-4fd9-b631-7a37629e08c0
ReplicaId             : 130740415594605869
AggregatedHealthState : Warning
UnhealthyEvaluations  :
                        Unhealthy event: SourceId='PowershellWatcher', Property='ResourceDependency', HealthState='Warning', ConsiderWarningAsError=false.

HealthEvents          :
                        SourceId              : System.RA
                        Property              : State
                        HealthState           : Ok
                        SequenceNumber        : 130740768777734943
                        SentAt                : 4/21/2015 8:01:17 AM
                        ReceivedAt            : 4/21/2015 8:02:12 AM
                        TTL                   : Infinite
                        Description           : Replica has been created.
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Ok = 4/21/2015 8:02:12 AM

                        SourceId              : PowershellWatcher
                        Property              : ResourceDependency
                        HealthState           : Warning
                        SequenceNumber        : 130741243777723555
                        SentAt                : 4/21/2015 9:12:57 PM
                        ReceivedAt            : 4/21/2015 9:12:57 PM
                        TTL                   : 00:02:00
                        Description           : hello external resource that hello primary is using has been rebooted at 4/21/2015 9:01:21 PM. Expect processing delays for a few minutes.
                        RemoveWhenExpired     : True
                        IsExpired             : False
                        Transitions           : ->Warning = 4/21/2015 9:12:32 PM
```

### <a name="rest"></a><span data-ttu-id="50e31-344">REST</span><span class="sxs-lookup"><span data-stu-id="50e31-344">REST</span></span>
<span data-ttu-id="50e31-345">Envie relatórios de integridade usando REST com solicitações POST que vá entidade toohello desejado e tem na descrição do relatório de integridade do hello corpo hello.</span><span class="sxs-lookup"><span data-stu-id="50e31-345">Send health reports using REST with POST requests that go toohello desired entity and have in hello body hello health report description.</span></span> <span data-ttu-id="50e31-346">Por exemplo, consulte como toosend REST [relatórios de integridade do cluster](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-cluster) ou [relatórios de integridade do serviço](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-service).</span><span class="sxs-lookup"><span data-stu-id="50e31-346">For example, see how toosend REST [cluster health reports](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-cluster) or [service health reports](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-service).</span></span> <span data-ttu-id="50e31-347">Todas as entidades têm suporte.</span><span class="sxs-lookup"><span data-stu-id="50e31-347">All entities are supported.</span></span>

## <a name="next-steps"></a><span data-ttu-id="50e31-348">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="50e31-348">Next steps</span></span>
<span data-ttu-id="50e31-349">Com base nos dados de integridade de saudação, gravadores de serviço e administradores de aplicativo/cluster podem pensar informações de saudação tooconsume maneiras.</span><span class="sxs-lookup"><span data-stu-id="50e31-349">Based on hello health data, service writers and cluster/application administrators can think of ways tooconsume hello information.</span></span> <span data-ttu-id="50e31-350">Por exemplo, eles podem configurar alertas com base em problemas graves de toocatch de status de integridade antes que provocam interrupções.</span><span class="sxs-lookup"><span data-stu-id="50e31-350">For example, they can set up alerts based on health status toocatch severe issues before they provoke outages.</span></span> <span data-ttu-id="50e31-351">Os administradores também podem definir automaticamente reparar problemas de toofix de sistemas.</span><span class="sxs-lookup"><span data-stu-id="50e31-351">Administrators can also set up repair systems toofix issues automatically.</span></span>

[<span data-ttu-id="50e31-352">Introdução tooService integridade da malha monitoramento</span><span class="sxs-lookup"><span data-stu-id="50e31-352">Introduction tooService Fabric health Monitoring</span></span>](service-fabric-health-introduction.md)

[<span data-ttu-id="50e31-353">Como exibir relatórios de integridade do Service Fabric</span><span class="sxs-lookup"><span data-stu-id="50e31-353">View Service Fabric health reports</span></span>](service-fabric-view-entities-aggregated-health.md)

[<span data-ttu-id="50e31-354">Como tooreport e verificação de integridade do serviço</span><span class="sxs-lookup"><span data-stu-id="50e31-354">How tooreport and check service health</span></span>](service-fabric-diagnostics-how-to-report-and-check-service-health.md)

[<span data-ttu-id="50e31-355">Usar relatórios de integridade do sistema para solução de problemas</span><span class="sxs-lookup"><span data-stu-id="50e31-355">Use system health reports for troubleshooting</span></span>](service-fabric-understand-and-troubleshoot-with-system-health-reports.md)

[<span data-ttu-id="50e31-356">Monitorar e diagnosticar serviços localmente</span><span class="sxs-lookup"><span data-stu-id="50e31-356">Monitor and diagnose services locally</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)

[<span data-ttu-id="50e31-357">Atualização de aplicativos do Service Fabric</span><span class="sxs-lookup"><span data-stu-id="50e31-357">Service Fabric application upgrade</span></span>](service-fabric-application-upgrade.md)

