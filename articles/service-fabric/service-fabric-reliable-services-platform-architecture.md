---
title: Arquitetura do Reliable Service | Microsoft Docs
description: "Visão geral da arquitetura do Reliable Service para serviços com e sem estado"
services: service-fabric
documentationcenter: .net
author: AlanWarwick
manager: timlt
editor: vturecek
ms.assetid: af002ae6-7f6d-4769-b049-82aa1ba0891b
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 03/30/2016
ms.author: alanwar
redirect_url: /azure/service-fabric/service-fabric-reliable-services-introduction
ms.openlocfilehash: a00a16945356b9731485554e06df46528b5c7bb2
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="architecture-for-stateful-and-stateless-reliable-services"></a><span data-ttu-id="bfbe6-103">Arquitetura de Reliable Services com e sem estado</span><span class="sxs-lookup"><span data-stu-id="bfbe6-103">Architecture for stateful and stateless Reliable Services</span></span>
<span data-ttu-id="bfbe6-104">Um serviço confiável do Service Fabric do Azure pode ser com ou sem estado.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-104">An Azure Service Fabric Reliable Service may be stateful or stateless.</span></span> <span data-ttu-id="bfbe6-105">Cada tipo de serviço é executado em uma arquitetura específica.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-105">Each type of service runs within a specific architecture.</span></span> <span data-ttu-id="bfbe6-106">Essas arquiteturas são descritas neste artigo.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-106">These architectures are described in this article.</span></span>
<span data-ttu-id="bfbe6-107">Confira [Visão geral do Reliable Services](service-fabric-reliable-services-introduction.md) para saber mais sobre as diferenças entre serviços com e sem estado.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-107">See the [Reliable Service overview](service-fabric-reliable-services-introduction.md) for more information about the differences between stateful and stateless services.</span></span>

## <a name="stateful-reliable-services"></a><span data-ttu-id="bfbe6-108">Serviços Confiáveis com estado</span><span class="sxs-lookup"><span data-stu-id="bfbe6-108">Stateful Reliable Services</span></span>
### <a name="architecture-of-a-stateful-service"></a><span data-ttu-id="bfbe6-109">Arquitetura de um serviço com estado</span><span class="sxs-lookup"><span data-stu-id="bfbe6-109">Architecture of a stateful service</span></span>
![Diagrama da arquitetura de um serviço com estado](./media/service-fabric-reliable-services-platform-architecture/reliable-stateful-service-architecture.png)

### <a name="stateful-reliable-service"></a><span data-ttu-id="bfbe6-111">Serviço Confiável com estado</span><span class="sxs-lookup"><span data-stu-id="bfbe6-111">Stateful Reliable Service</span></span>
<span data-ttu-id="bfbe6-112">Um serviço confiável com estado pode ser derivado da classe StatefulService ou StatefulServiceBase.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-112">A stateful Reliable Service can derive from either the StatefulService or StatefulServiceBase class.</span></span> <span data-ttu-id="bfbe6-113">Ambas essas classes base são fornecidas pelo Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-113">Both of these base classes are provided by Service Fabric.</span></span> <span data-ttu-id="bfbe6-114">Eles oferecem vários níveis de suporte e abstração para o serviço com estado para fazer interface com o Service Fabric – e para participar como um serviço dentro do cluster do Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-114">They offer various levels of support and abstraction for the stateful service to interface with Service Fabric--and to participate as a service within the Service Fabric cluster.</span></span>

<span data-ttu-id="bfbe6-115">StatefulService deriva de StatefulServiceBase.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-115">StatefulService derives from StatefulServiceBase.</span></span> <span data-ttu-id="bfbe6-116">StatefulServiceBase oferece aos serviços mais flexibilidade, mas requer mais compreensão dos itens internos do Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-116">StatefulServiceBase offers services more flexibility, but requires more understanding of the internals of Service Fabric.</span></span>
<span data-ttu-id="bfbe6-117">Confira a [Visão geral dos Reliable Services](service-fabric-reliable-services-introduction.md) e [Uso avançado dos Reliable Services](service-fabric-reliable-services-advanced-usage.md) para saber mais sobre os detalhes de escrever serviços usando as classes StatefulService e StatefulServiceBase.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-117">See the [Reliable Service overview](service-fabric-reliable-services-introduction.md) and [Reliable Service advanced usage](service-fabric-reliable-services-advanced-usage.md) for more information on the specifics of writing services by using the StatefulService and StatefulServiceBase classes.</span></span>

<span data-ttu-id="bfbe6-118">Ambas as classes base gerenciam a vida útil e a função da implementação do serviço.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-118">Both base classes manage the lifetime and role of the service implementation.</span></span> <span data-ttu-id="bfbe6-119">A implementação do serviço pode substituir métodos virtuais de qualquer classe base se a implementação do serviço tiver trabalho a fazer nesses pontos do ciclo de vida de implementação de serviço ou se quiser criar um objeto de ouvinte de comunicação.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-119">The service implementation may override virtual methods of either base class if the service implementation has work to do at those points in the service implementation lifecycle--or if it wants to create a communication listener object.</span></span> <span data-ttu-id="bfbe6-120">Embora uma implementação de serviço possa implementar seu próprio objeto de ouvinte de comunicação expondo ICommunicationListener, no diagrama acima, o ouvinte de comunicação é implementado pelo Service Fabric como a implementação de serviço usa um ouvinte de comunicação implementado pelo Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-120">Note that although a service implementation may implement its own communication listener object exposing ICommunicationListener, in the diagram above, the communication listener is implemented by Service Fabric--as the service implementation uses a communication listener that is implemented by Service Fabric.</span></span>

<span data-ttu-id="bfbe6-121">Um serviço confiável com estado usa o gerenciador de estado confiável para tirar proveito das coleções confiáveis.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-121">A stateful Reliable Service uses the reliable state manager to take advantage of reliable collections.</span></span> <span data-ttu-id="bfbe6-122">Coleções confiáveis são estruturas de dados locais que são altamente disponíveis para o serviço, ou seja, estão sempre disponíveis, independentemente de failovers de serviço.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-122">Reliable collections are local data structures that are highly available to the service--that is, they are always available, regardless of service failovers.</span></span> <span data-ttu-id="bfbe6-123">Cada tipo de coleção confiável é implementado por um provedor de estado confiável.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-123">Each type of reliable collection is implemented by a reliable state provider.</span></span>
<span data-ttu-id="bfbe6-124">Para obter mais informações sobre coleções confiáveis, consulte [a visão geral das coleções confiáveis](service-fabric-reliable-services-reliable-collections.md).</span><span class="sxs-lookup"><span data-stu-id="bfbe6-124">For more information on reliable collections, see the [reliable collections overview](service-fabric-reliable-services-reliable-collections.md).</span></span>

### <a name="reliable-state-manager-and-state-providers"></a><span data-ttu-id="bfbe6-125">Provedores e gerenciador de estado confiáveis</span><span class="sxs-lookup"><span data-stu-id="bfbe6-125">Reliable state manager and state providers</span></span>
<span data-ttu-id="bfbe6-126">O gerenciador de estado confiável é o objeto que gerencia os provedores de estado confiável.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-126">The reliable state manager is the object that manages reliable state providers.</span></span> <span data-ttu-id="bfbe6-127">Ele tem a funcionalidade para criar, excluir, enumerar e garantir que os provedores de estado confiável sejam persistentes e altamente disponíveis.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-127">It has the functionality to create, delete, enumerate, and ensure that the reliable state providers are persisted and highly available.</span></span> <span data-ttu-id="bfbe6-128">Uma instância do provedor de estado confiável representa uma instância de uma estrutura de dados persistente e altamente disponível, como um dicionário ou uma fila.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-128">A reliable state provider instance represents an instance of a persisted and highly available data structure, such as a dictionary or a queue.</span></span>

<span data-ttu-id="bfbe6-129">Cada provedor de estado confiável expõe uma interface que é usada pelo serviço com estado para interagir com o provedor de estado confiável.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-129">Each reliable state provider exposes an interface that is used by a stateful service to interact with the reliable state provider.</span></span> <span data-ttu-id="bfbe6-130">Por exemplo, IReliableDictionary é usado para interagir com o dicionário confiável, enquanto IReliableQueue é usado para interagir com a fila confiável.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-130">For example, IReliableDictionary is used to interface with the reliable dictionary, while IReliableQueue is used to interface with the reliable queue.</span></span> <span data-ttu-id="bfbe6-131">Todos os provedores de estado confiável implementam a interface IReliableState.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-131">All reliable state providers implement the IReliableState interface.</span></span>

<span data-ttu-id="bfbe6-132">O gerenciador de estado confiável tem uma interface chamada IReliableStateManager, que permite o acesso por meio do serviço com estado.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-132">The reliable state manager has an interface named IReliableStateManager, which allows access to it from a stateful service.</span></span> <span data-ttu-id="bfbe6-133">Interfaces para provedores de estado confiável são retornadas por meio de IReliableStateManager.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-133">Interfaces to reliable state providers are returned through IReliableStateManager.</span></span>

<span data-ttu-id="bfbe6-134">O gerenciador de estado confiável usa uma arquitetura de plug-in para que novos tipos de coleções confiáveis possam ser conectados dinamicamente.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-134">The reliable state manager uses a plug-in architecture so that new types of reliable collections can be plugged in dynamically.</span></span>

<span data-ttu-id="bfbe6-135">O dicionário confiável e a fila confiável são criados após a implementação de um repositório diferencial com controle de versão de alto desempenho.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-135">The reliable dictionary and reliable queue are built upon the implementation of a high-performance, versioned differential store.</span></span>

### <a name="transactional-replicator"></a><span data-ttu-id="bfbe6-136">Replicator transacional</span><span class="sxs-lookup"><span data-stu-id="bfbe6-136">Transactional replicator</span></span>
<span data-ttu-id="bfbe6-137">O componente de replicador transacional é responsável por garantir que o estado de um serviço (ou seja, o estado dentro do estado no gerenciador de estado confiável e nas coleções confiáveis), seja consistente em todas as réplicas que executam o serviço.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-137">The transactional replicator component is responsible for ensuring that the state of a service (that is, the state within the reliable state manager and the reliable collections) is consistent across all replicas running the service.</span></span> <span data-ttu-id="bfbe6-138">Ela também garante que o estado seja mantido no log.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-138">It also ensures that the state is persisted in the log.</span></span> <span data-ttu-id="bfbe6-139">O gerenciador de estado confiável faz interface com o replicador transacional por meio de um mecanismo privado.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-139">The reliable state manager interfaces with the transactional replicator via a private mechanism.</span></span>

<span data-ttu-id="bfbe6-140">O replicador transacional usa um protocolo de rede para comunicar o estado com outras réplicas da instância do serviço para que todas as réplicas tenham informações de estado atualizadas.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-140">The transactional replicator uses a network protocol to communicate state with other replicas of the service instance so that all replicas have up-to-date state information.</span></span>

<span data-ttu-id="bfbe6-141">O replicador transacional usa um log para manter informações de estado para que as informações de estado sobrevive processo ou falha de nó.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-141">The transactional replicator uses a log to persist state information so that the state information survives process or node crashes.</span></span> <span data-ttu-id="bfbe6-142">A interface para o log é através de um mecanismo privado.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-142">The interface to the log is via a private mechanism.</span></span>

### <a name="log"></a><span data-ttu-id="bfbe6-143">Registro</span><span class="sxs-lookup"><span data-stu-id="bfbe6-143">Log</span></span>
<span data-ttu-id="bfbe6-144">O componente de log fornece um armazenamento persistente de alto desempenho que pode ser otimizado para gravação discos giratórios ou de estado sólido.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-144">The log component provides a high-performance persistent store that can be optimized for writing to spinning or solid-state disks.</span></span>  <span data-ttu-id="bfbe6-145">O design do log é para o armazenamento persistente (ou seja, discos rígidos) ser local para os nós que estão executando o serviço com estado.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-145">The design of the log is for the persistent storage (i.e., hard disks) to be local to the nodes that are running the stateful service.</span></span> <span data-ttu-id="bfbe6-146">Isso permite baixas latências e altas taxas de transferência em comparação ao armazenamento persistente remoto, que não é local ao nó.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-146">This allows for low latencies and high throughput, as compared to remote persistent storage, which is not local to the node.</span></span>

<span data-ttu-id="bfbe6-147">O componente de log usa vários arquivos de log.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-147">The log component uses multiple log files.</span></span> <span data-ttu-id="bfbe6-148">Há um arquivo de log compartilhado em todo o nó que todas as réplicas usam, uma vez que ele pode fornecer a menor latência e a maior taxa de transferência para armazenar dados de estado.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-148">There is a node-wide shared log file that all replicas use as it can provide the lowest latency and highest throughput for storing state data.</span></span> <span data-ttu-id="bfbe6-149">Por padrão, o log compartilhado é colocado no diretório de trabalho do nó do Service Fabric, mas também pode ser configurado para ser colocado em outro local, idealmente em um disco reservado apenas para o log compartilhado.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-149">By default the shared log is placed in the Service Fabric node work directory but it may also be configured to be placed at another location, ideally on a disk reserved for only the shared log.</span></span> <span data-ttu-id="bfbe6-150">Cada réplica do serviço também tem um arquivo de log dedicado e é colocada no diretório de trabalho do serviço.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-150">Each replica for the service also has a dedicated log file and the dedicated log is placed within the service's work directory.</span></span> <span data-ttu-id="bfbe6-151">Não há nenhum mecanismo para configurar o log dedicado a ser colocado em um local diferente.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-151">There is no mechanism to configure the dedicated log to be placed at a different location.</span></span>

<span data-ttu-id="bfbe6-152">O log compartilhado é uma área de transição para as informações de estado da réplica, enquanto o arquivo de log dedicado é seu destino final, onde ele é mantido.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-152">The shared log is a transitional area for the replica's state information, while the dedicated log file is the final destination where it is persisted.</span></span> <span data-ttu-id="bfbe6-153">Nesse design, as informações de estado são primeiro gravadas no arquivo de log compartilhado e então transferidas lentamente para o arquivo de log dedicado em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-153">In this design, the state information is first written to the shared log file and then lazily moved to the dedicated log file in the background.</span></span> <span data-ttu-id="bfbe6-154">Dessa forma, a gravação para o log compartilhado teria a menor latência e a maior taxa de transferência, permitindo ao serviço progredir com mais rapidez.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-154">In this way, the write to the shared log would have the lowest latency and highest throughput which allows the service to make progress faster.</span></span>

<span data-ttu-id="bfbe6-155">Leituras e gravações no log compartilhado são feitas por meio de E/S direta para o espaço pré-alocado no disco para o arquivo de log compartilhado.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-155">Reads and writes to the shared log are done via direct IO to preallocated space on the disk for the shared log file.</span></span> <span data-ttu-id="bfbe6-156">Para permitir o uso ideal de espaço em disco na unidade com logs dedicados, o arquivo de log dedicado é criado como um arquivo esparso do NTFS.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-156">To allow optimal use of disk space on the drive with dedicated logs, the dedicated log file is created as a NTFS sparse file.</span></span> <span data-ttu-id="bfbe6-157">Observe que isso permitirá excesso de provisionamento de espaço em disco, e o SO mostrará os arquivos de log dedicados usando muito mais espaço em disco do que é realmente usado.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-157">Note that this will allow overprovisioning of disk space and the OS will show the dedicated log files using much more disk space than is actually used.</span></span>

<span data-ttu-id="bfbe6-158">Além de uma interface de modo de usuário mínima para o log, o log é gravado como um driver de modo kernel.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-158">Aside from a minimal user-mode interface to the log, the log is written as a kernel-mode driver.</span></span> <span data-ttu-id="bfbe6-159">Executado como um driver de modo kernel, o log pode fornecer o melhor desempenho para todos os serviços que o usam.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-159">By running as a kernel-mode driver, the log can provide the highest performance to all services that use it.</span></span>

<span data-ttu-id="bfbe6-160">Para saber mais sobre como configurar o log, confira [Configurando Reliable Services com estado](service-fabric-reliable-services-configuration.md).</span><span class="sxs-lookup"><span data-stu-id="bfbe6-160">For more information about configuring the log, see [Configuring stateful Reliable Services](service-fabric-reliable-services-configuration.md).</span></span>

## <a name="stateless-reliable-service"></a><span data-ttu-id="bfbe6-161">Serviço Confiável sem estado</span><span class="sxs-lookup"><span data-stu-id="bfbe6-161">Stateless Reliable Service</span></span>
### <a name="architecture-of-a-stateless-service"></a><span data-ttu-id="bfbe6-162">Arquitetura de um serviço sem estado</span><span class="sxs-lookup"><span data-stu-id="bfbe6-162">Architecture of a stateless service</span></span>
![Diagrama da arquitetura de um serviço sem estado](./media/service-fabric-reliable-services-platform-architecture/reliable-stateless-service-architecture.png)

### <a name="stateless-reliable-service"></a><span data-ttu-id="bfbe6-164">Serviço Confiável sem estado</span><span class="sxs-lookup"><span data-stu-id="bfbe6-164">Stateless Reliable Service</span></span>
<span data-ttu-id="bfbe6-165">Implementações de serviço sem estado derivam da classe StatelessService ou StatelessServiceBase.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-165">Stateless service implementations derive from the StatelessService or StatelessServiceBase class.</span></span> <span data-ttu-id="bfbe6-166">A classe StatelessServiceBase permite mais flexibilidade do que a classe StatelessService.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-166">The StatelessServiceBase class allows more flexibility than the StatelessService class.</span></span>
<span data-ttu-id="bfbe6-167">Ambas as classes base gerenciam o tempo de vida e a função de um serviço.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-167">Both base classes manage the lifetime and role of a service.</span></span>

<span data-ttu-id="bfbe6-168">A implementação do serviço pode substituir métodos virtuais de qualquer classe base se o serviço tiver trabalho a fazer nesses pontos do ciclo de vida de serviço ou se quiser criar um objeto de ouvinte de comunicação.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-168">The service implementation may override virtual methods of either base class if the service has work to do at those points in the service lifecycle--or if it wants to create a communication listener object.</span></span> <span data-ttu-id="bfbe6-169">Embora seu serviço possa implementar o próprio objeto de ouvinte de comunicação expondo ICommunicationListener, no diagrama acima, o ouvinte de comunicação é implementado pelo Service Fabric, uma vez que essa implementação de serviço usa um ouvinte de comunicação implementado pelo Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-169">Note that although the service may implement its own communication listener object exposing ICommunicationListener, in the diagram above, the communication listener is implemented by Service Fabric, as that service implementation uses a communication listener that is implemented by Service Fabric.</span></span>

<span data-ttu-id="bfbe6-170">Confira [Visão geral dos Reliable Services](service-fabric-reliable-services-introduction.md) e [Uso avançado dos Reliable Services](service-fabric-reliable-services-advanced-usage.md) para saber mais sobre os detalhes de escrever serviços usando as classes StatelessService e StatelessServiceBase.</span><span class="sxs-lookup"><span data-stu-id="bfbe6-170">See the [Reliable Service overview](service-fabric-reliable-services-introduction.md) and [Reliable Service advanced usage](service-fabric-reliable-services-advanced-usage.md) for more information on the specifics of writing services using the StatelessService and StatelessServiceBase classes.</span></span>

<!--Every topic should have next steps and links to the next logical set of content to keep the customer engaged-->
## <a name="next-steps"></a><span data-ttu-id="bfbe6-171">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="bfbe6-171">Next steps</span></span>
<span data-ttu-id="bfbe6-172">Para obter mais informações sobre a Malha de Serviços, consulte:</span><span class="sxs-lookup"><span data-stu-id="bfbe6-172">For more information about Service Fabric, see:</span></span>

[<span data-ttu-id="bfbe6-173">Visão geral de Reliable Services</span><span class="sxs-lookup"><span data-stu-id="bfbe6-173">Reliable service overview</span></span>](service-fabric-reliable-services-introduction.md)

[<span data-ttu-id="bfbe6-174">Início rápido</span><span class="sxs-lookup"><span data-stu-id="bfbe6-174">Quick start</span></span>](service-fabric-reliable-services-quick-start.md)

[<span data-ttu-id="bfbe6-175">Visão geral das coleções confiáveis</span><span class="sxs-lookup"><span data-stu-id="bfbe6-175">Reliable collections overview</span></span>](service-fabric-reliable-services-reliable-collections.md)

[<span data-ttu-id="bfbe6-176">Uso avançado de Reliable Services</span><span class="sxs-lookup"><span data-stu-id="bfbe6-176">Reliable service advanced usage</span></span>](service-fabric-reliable-services-advanced-usage.md)

[<span data-ttu-id="bfbe6-177">Configuração de Reliable Services</span><span class="sxs-lookup"><span data-stu-id="bfbe6-177">Reliable service configuration</span></span>](service-fabric-reliable-services-configuration.md)  

