---
title: "Possibilidade de teste: comunicação de serviço | Microsoft Docs"
description: "As comunicação entre serviços é um ponto de integração essencial de um aplicativo da Malha do Serviço. Este artigo aborda as considerações de design e as técnicas de teste."
services: service-fabric
documentationcenter: .net
author: vturecek
manager: timlt
editor: 
ms.assetid: 017557df-fb59-4e4a-a65d-2732f29255b8
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/29/2017
ms.author: vturecek
ms.openlocfilehash: 4a8f941c1e8e641384a9ee3a1149dabaaf9983cc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="service-fabric-testability-scenarios-service-communication"></a><span data-ttu-id="e3807-104">Cenários de Possibilidade de Teste do Service Fabric: Comunicação do serviço</span><span class="sxs-lookup"><span data-stu-id="e3807-104">Service Fabric testability scenarios: Service communication</span></span>
<span data-ttu-id="e3807-105">Os estilos de arquitetura orientada a serviços e microsserviços surgem naturalmente no Azure Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="e3807-105">Microservices and service-oriented architectural styles surface naturally in Azure Service Fabric.</span></span> <span data-ttu-id="e3807-106">Esses tipos de arquiteturas distribuídas, microsserviço em componentes de aplicativos normalmente são compostos de vários serviços que precisam tootalk tooeach outros.</span><span class="sxs-lookup"><span data-stu-id="e3807-106">In these types of distributed architectures, componentized microservice applications are typically composed of multiple services that need tootalk tooeach other.</span></span> <span data-ttu-id="e3807-107">Em casos mais simples do mesmo hello, você geralmente tem pelo menos um serviço web sem monitoração de estado e um serviço de armazenamento de dados com monitoração de estado que precisam de toocommunicate.</span><span class="sxs-lookup"><span data-stu-id="e3807-107">In even hello simplest cases, you generally have at least a stateless web service and a stateful data storage service that need toocommunicate.</span></span>

<span data-ttu-id="e3807-108">Comunicação de serviços é um ponto de integração crítico de um aplicativo, pois cada serviço expõe um remoto tooother serviços da API.</span><span class="sxs-lookup"><span data-stu-id="e3807-108">Service-to-service communication is a critical integration point of an application, because each service exposes a remote API tooother services.</span></span> <span data-ttu-id="e3807-109">Trabalhar com um conjunto de limites de API que envolve E/S geralmente exige algum cuidado e uma boa quantidade de teste e validação.</span><span class="sxs-lookup"><span data-stu-id="e3807-109">Working with a set of API boundaries that involves I/O generally requires some care, with a good amount of testing and validation.</span></span>

<span data-ttu-id="e3807-110">Há inúmeros toomake de considerações sobre quando esses limites de serviço são conectados em um sistema distribuído:</span><span class="sxs-lookup"><span data-stu-id="e3807-110">There are numerous considerations toomake when these service boundaries are wired together in a distributed system:</span></span>

* <span data-ttu-id="e3807-111">*Protocolo de transporte*.</span><span class="sxs-lookup"><span data-stu-id="e3807-111">*Transport protocol*.</span></span> <span data-ttu-id="e3807-112">Você usará HTTP para maior interoperabilidade, ou um protocolo binário personalizado para taxa de transferência máxima?</span><span class="sxs-lookup"><span data-stu-id="e3807-112">Will you use HTTP for increased interoperability, or a custom binary protocol for maximum throughput?</span></span>
* <span data-ttu-id="e3807-113">*Manipulação de erros*.</span><span class="sxs-lookup"><span data-stu-id="e3807-113">*Error handling*.</span></span> <span data-ttu-id="e3807-114">Como os erros transitórios e permanentes serão tratados?</span><span class="sxs-lookup"><span data-stu-id="e3807-114">How will permanent and transient errors be handled?</span></span> <span data-ttu-id="e3807-115">O que acontecerá quando um serviço move tooa um nó diferente?</span><span class="sxs-lookup"><span data-stu-id="e3807-115">What will happen when a service moves tooa different node?</span></span>
* <span data-ttu-id="e3807-116">*Tempos limite e latência*.</span><span class="sxs-lookup"><span data-stu-id="e3807-116">*Timeouts and latency*.</span></span> <span data-ttu-id="e3807-117">Em aplicativos de várias camadas, como cada camada de serviço tratará latência por meio de usuário de pilha e toohello Olá?</span><span class="sxs-lookup"><span data-stu-id="e3807-117">In multitiered applications, how will each service layer handle latency through hello stack and toohello user?</span></span>

<span data-ttu-id="e3807-118">Se você usar um dos componentes de comunicação de serviço interno Olá fornecidos pelo serviço de malha ou criar seu próprio, teste interações de saudação entre seus serviços é crítico tooensuring resiliência em seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e3807-118">Whether you use one of hello built-in service communication components provided by Service Fabric or you build your own, testing hello interactions between your services is critical tooensuring resiliency in your application.</span></span>

## <a name="prepare-for-services-toomove"></a><span data-ttu-id="e3807-119">Preparar para serviços toomove</span><span class="sxs-lookup"><span data-stu-id="e3807-119">Prepare for services toomove</span></span>
<span data-ttu-id="e3807-120">As instâncias do serviço podem se movimentar com o tempo.</span><span class="sxs-lookup"><span data-stu-id="e3807-120">Service instances may move around over time.</span></span> <span data-ttu-id="e3807-121">Isso acontece especialmente quando são configuradas com métricas de carga para balanceamento personalizado e ideal de recursos.</span><span class="sxs-lookup"><span data-stu-id="e3807-121">This is especially true when they are configured with load metrics for custom-tailored optimal resource balancing.</span></span> <span data-ttu-id="e3807-122">Malha do serviço move o toomaximize de instâncias do serviço sua disponibilidade mesmo durante atualizações, failovers, expansão e outras situações que ocorrem em tempo de vida de saudação de um sistema distribuído.</span><span class="sxs-lookup"><span data-stu-id="e3807-122">Service Fabric moves your service instances toomaximize their availability even during upgrades, failovers, scale-out, and other situations that occur over hello lifetime of a distributed system.</span></span>

<span data-ttu-id="e3807-123">Como serviços mover-se no cluster hello, seus clientes e outros serviços devem ser preparado toohandle dois cenários quando falam tooa serviço:</span><span class="sxs-lookup"><span data-stu-id="e3807-123">As services move around in hello cluster, your clients and other services should be prepared toohandle two scenarios when they talk tooa service:</span></span>

* <span data-ttu-id="e3807-124">réplica de partição ou instância de serviço Olá foi movido desde Olá falou tooit de hora.</span><span class="sxs-lookup"><span data-stu-id="e3807-124">hello service instance or partition replica has moved since hello last time you talked tooit.</span></span> <span data-ttu-id="e3807-125">Esta é uma parte normal de um ciclo de vida do serviço e deve ser toohappen esperado durante a vida útil de saudação do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e3807-125">This is a normal part of a service lifecycle, and it should be expected toohappen during hello lifetime of your application.</span></span>
* <span data-ttu-id="e3807-126">réplica de partição ou instância de serviço Hello está no processo de saudação de movimentação.</span><span class="sxs-lookup"><span data-stu-id="e3807-126">hello service instance or partition replica is in hello process of moving.</span></span> <span data-ttu-id="e3807-127">Embora o failover de um serviço tooanother de um nó ocorre rapidamente na malha do serviço, pode haver um atraso na disponibilidade se o componente de comunicação de saudação do seu serviço é toostart lenta.</span><span class="sxs-lookup"><span data-stu-id="e3807-127">Although failover of a service from one node tooanother occurs very quickly in Service Fabric, there may be a delay in availability if hello communication component of your service is slow toostart.</span></span>

<span data-ttu-id="e3807-128">A manipulação tranquila desses cenários é importante para um sistema em execução adequada.</span><span class="sxs-lookup"><span data-stu-id="e3807-128">Handling these scenarios gracefully is important for a smooth-running system.</span></span> <span data-ttu-id="e3807-129">toodo, portanto, tenha em mente que:</span><span class="sxs-lookup"><span data-stu-id="e3807-129">toodo so, keep in mind that:</span></span>

* <span data-ttu-id="e3807-130">Cada serviço que pode ser conectado toohas um *endereço* que escuta (por exemplo, HTTP ou WebSockets).</span><span class="sxs-lookup"><span data-stu-id="e3807-130">Every service that can be connected toohas an *address* that it listens on (for example, HTTP or WebSockets).</span></span> <span data-ttu-id="e3807-131">Quando uma instância de serviço ou partição se move, altera seu ponto de extremidade do endereço.</span><span class="sxs-lookup"><span data-stu-id="e3807-131">When a service instance or partition moves, its address endpoint changes.</span></span> <span data-ttu-id="e3807-132">(Ele move tooa outro nó com um endereço IP diferente.) Se você estiver usando componentes de comunicação interna hello, eles tratarão novamente resolvendo endereços de serviço para você.</span><span class="sxs-lookup"><span data-stu-id="e3807-132">(It moves tooa different node with a different IP address.) If you're using hello built-in communication components, they will handle re-resolving service addresses for you.</span></span>
* <span data-ttu-id="e3807-133">Pode haver um aumento temporário na latência de serviço como Olá serviço instância começa a escuta novamente.</span><span class="sxs-lookup"><span data-stu-id="e3807-133">There may be a temporary increase in service latency as hello service instance starts up its listener again.</span></span> <span data-ttu-id="e3807-134">Isso depende de como serviço Olá abre rapidamente ouvinte Olá depois que a instância do serviço Olá é movida.</span><span class="sxs-lookup"><span data-stu-id="e3807-134">This depends on how quickly hello service opens hello listener after hello service instance is moved.</span></span>
* <span data-ttu-id="e3807-135">Todas as conexões existentes necessário toobe fechado e reaberto depois que o serviço Olá é aberto em um novo nó.</span><span class="sxs-lookup"><span data-stu-id="e3807-135">Any existing connections need toobe closed and reopened after hello service opens on a new node.</span></span> <span data-ttu-id="e3807-136">Um desligamento normal do nó ou reinicialização dá tempo para toobe de conexões existentes desligar normalmente.</span><span class="sxs-lookup"><span data-stu-id="e3807-136">A graceful node shutdown or restart allows time for existing connections toobe shut down gracefully.</span></span>

### <a name="test-it-move-service-instances"></a><span data-ttu-id="e3807-137">Teste: Mover instâncias do serviço</span><span class="sxs-lookup"><span data-stu-id="e3807-137">Test it: Move service instances</span></span>
<span data-ttu-id="e3807-138">Usando ferramentas de capacidade de teste do Service Fabric, você pode criar um tootest de cenário de teste nessas situações de maneiras diferentes:</span><span class="sxs-lookup"><span data-stu-id="e3807-138">By using Service Fabric's testability tools, you can author a test scenario tootest these situations in different ways:</span></span>

1. <span data-ttu-id="e3807-139">Mova a réplica primária de um serviço com estado.</span><span class="sxs-lookup"><span data-stu-id="e3807-139">Move a stateful service's primary replica.</span></span>
   
    <span data-ttu-id="e3807-140">Olá réplica primária de uma partição de serviço com monitoração de estado pode ser movida por vários motivos.</span><span class="sxs-lookup"><span data-stu-id="e3807-140">hello primary replica of a stateful service partition can be moved for any number of reasons.</span></span> <span data-ttu-id="e3807-141">Use esta réplica primária de saudação tootarget de um toosee partição específica como seu toohello reagir de serviços para mover de uma maneira muito controlada.</span><span class="sxs-lookup"><span data-stu-id="e3807-141">Use this tootarget hello primary replica of a specific partition toosee how your services react toohello move in a very controlled manner.</span></span>
   
    ```powershell
   
    PS > Move-ServiceFabricPrimaryReplica -PartitionId 6faa4ffa-521a-44e9-8351-dfca0f7e0466 -ServiceName fabric:/MyApplication/MyService
   
    ```
2. <span data-ttu-id="e3807-142">Parar um nó.</span><span class="sxs-lookup"><span data-stu-id="e3807-142">Stop a node.</span></span>
   
    <span data-ttu-id="e3807-143">Quando um nó é interrompido, Service Fabric move todos Olá service instâncias ou partições que estavam no tooone desse nó de Olá outros nós disponíveis no cluster hello.</span><span class="sxs-lookup"><span data-stu-id="e3807-143">When a node is stopped, Service Fabric moves all of hello service instances or partitions that were on that node tooone of hello other available nodes in hello cluster.</span></span> <span data-ttu-id="e3807-144">Use este tootest uma situação em que um nó for perdido do cluster e todas as instâncias de serviço hello e réplicas nesse nó tem toomove.</span><span class="sxs-lookup"><span data-stu-id="e3807-144">Use this tootest a situation where a node is lost from your cluster and all of hello service instances and replicas on that node have toomove.</span></span>
   
    <span data-ttu-id="e3807-145">Você pode interromper um nó usando Olá PowerShell **ServiceFabricNode Stop** cmdlet:</span><span class="sxs-lookup"><span data-stu-id="e3807-145">You can stop a node by using hello PowerShell **Stop-ServiceFabricNode** cmdlet:</span></span>
   
    ```powershell
   
    PS > Restart-ServiceFabricNode -NodeName Node_1
   
    ```

## <a name="maintain-service-availability"></a><span data-ttu-id="e3807-146">Manter a disponibilidade do serviço</span><span class="sxs-lookup"><span data-stu-id="e3807-146">Maintain service availability</span></span>
<span data-ttu-id="e3807-147">Como uma plataforma, o Service Fabric é projetado tooprovide alta disponibilidade de seus serviços.</span><span class="sxs-lookup"><span data-stu-id="e3807-147">As a platform, Service Fabric is designed tooprovide high availability of your services.</span></span> <span data-ttu-id="e3807-148">Em casos extremos, porém, os problemas de infraestrutura subjacentes ainda podem causar indisponibilidade.</span><span class="sxs-lookup"><span data-stu-id="e3807-148">But in extreme cases, underlying infrastructure problems can still cause unavailability.</span></span> <span data-ttu-id="e3807-149">É muito importante tootest para esses cenários.</span><span class="sxs-lookup"><span data-stu-id="e3807-149">It is important tootest for these scenarios, too.</span></span>

<span data-ttu-id="e3807-150">Serviços com monitoração de estado usam um estado do sistema baseado em quorum tooreplicate para alta disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="e3807-150">Stateful services use a quorum-based system tooreplicate state for high availability.</span></span> <span data-ttu-id="e3807-151">Isso significa que um quorum de réplicas precisa de operações de gravação do toobe tooperform disponíveis.</span><span class="sxs-lookup"><span data-stu-id="e3807-151">This means that a quorum of replicas needs toobe available tooperform write operations.</span></span> <span data-ttu-id="e3807-152">Em casos raros, como em uma falha generalizada de hardware, talvez um quorum de réplicas não esteja disponível.</span><span class="sxs-lookup"><span data-stu-id="e3807-152">In rare cases, such as a widespread hardware failure, a quorum of replicas may not be available.</span></span> <span data-ttu-id="e3807-153">Nesses casos, não será capaz de tooperform operações de gravação, mas ainda será capaz de tooperform operações de leitura.</span><span class="sxs-lookup"><span data-stu-id="e3807-153">In these cases, you will not be able tooperform write operations, but you will still be able tooperform read operations.</span></span>

### <a name="test-it-write-operation-unavailability"></a><span data-ttu-id="e3807-154">Teste: Indisponibilidade da operação de gravação</span><span class="sxs-lookup"><span data-stu-id="e3807-154">Test it: Write operation unavailability</span></span>
<span data-ttu-id="e3807-155">Usando ferramentas de capacidade de teste de saudação na malha do serviço, você pode injetar uma falha que induz à perda de quorum como um teste.</span><span class="sxs-lookup"><span data-stu-id="e3807-155">By using hello testability tools in Service Fabric, you can inject a fault that induces quorum loss as a test.</span></span> <span data-ttu-id="e3807-156">Embora esse cenário é raro, é importante que os clientes e serviços que dependem de um serviço com monitoração de estado são preparados toohandle situações em que eles não podem fazer tooit solicitações de gravação.</span><span class="sxs-lookup"><span data-stu-id="e3807-156">Although such a scenario is rare, it is important that clients and services that depend on a stateful service are prepared toohandle situations where they cannot make write requests tooit.</span></span> <span data-ttu-id="e3807-157">Também é importante que o serviço de monitoração de estado Olá em si está ciente de que essa possibilidade e pode normalmente comunicá-la toocallers.</span><span class="sxs-lookup"><span data-stu-id="e3807-157">It is also important that hello stateful service itself is aware of this possibility and can gracefully communicate it toocallers.</span></span>

<span data-ttu-id="e3807-158">Você pode induzir a perda de quorum usando Olá PowerShell **ServiceFabricPartitionQuorumLoss Invoke** cmdlet:</span><span class="sxs-lookup"><span data-stu-id="e3807-158">You can induce quorum loss by using hello PowerShell **Invoke-ServiceFabricPartitionQuorumLoss** cmdlet:</span></span>

```powershell

PS > Invoke-ServiceFabricPartitionQuorumLoss -ServiceName fabric:/Myapplication/MyService -QuorumLossMode QuorumReplicas -QuorumLossDurationInSeconds 20

```

<span data-ttu-id="e3807-159">Neste exemplo, vamos definir `QuorumLossMode` muito`QuorumReplicas` tooindicate que desejamos perda de quorum tooinduce sem interromper todas as réplicas.</span><span class="sxs-lookup"><span data-stu-id="e3807-159">In this example, we set `QuorumLossMode` too`QuorumReplicas` tooindicate that we want tooinduce quorum loss without taking down all replicas.</span></span> <span data-ttu-id="e3807-160">Dessa forma, as operações de leitura ainda são possíveis.</span><span class="sxs-lookup"><span data-stu-id="e3807-160">This way, read operations are still possible.</span></span> <span data-ttu-id="e3807-161">tootest um cenário em que uma partição inteira estiver disponível, você pode definir essa opção muito`AllReplicas`.</span><span class="sxs-lookup"><span data-stu-id="e3807-161">tootest a scenario where an entire partition is unavailable, you can set this switch too`AllReplicas`.</span></span>

## <a name="next-steps"></a><span data-ttu-id="e3807-162">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="e3807-162">Next steps</span></span>
[<span data-ttu-id="e3807-163">Saiba mais sobre as ações de possibilidade de teste</span><span class="sxs-lookup"><span data-stu-id="e3807-163">Learn more about testability actions</span></span>](service-fabric-testability-actions.md)

[<span data-ttu-id="e3807-164">Saiba mais sobre os cenários de possibilidade de teste</span><span class="sxs-lookup"><span data-stu-id="e3807-164">Learn more about testability scenarios</span></span>](service-fabric-testability-scenarios.md)

