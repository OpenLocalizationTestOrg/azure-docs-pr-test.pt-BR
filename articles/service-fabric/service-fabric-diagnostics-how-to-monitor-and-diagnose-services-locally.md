---
title: "Depurar microsserviços do Azure no Windows | Microsoft Docs"
description: "Saiba como monitorar e diagnosticar seus serviços escritos com o Service Fabric do Microsoft Azure em um computador de desenvolvimento local."
services: service-fabric
documentationcenter: .net
author: dkkapur
manager: timlt
editor: 
ms.assetid: edcc0631-ed2d-45a3-851d-2c4fa0f4a326
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/24/2017
ms.author: dekapur
ms.openlocfilehash: 08998340afb2f242b9a268331607b0d1ddb9b0c6
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="monitor-and-diagnose-services-in-a-local-machine-development-setup"></a><span data-ttu-id="34f1b-103">Monitorar e diagnosticar serviços em uma configuração de desenvolvimento do computador local</span><span class="sxs-lookup"><span data-stu-id="34f1b-103">Monitor and diagnose services in a local machine development setup</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="34f1b-104">Windows</span><span class="sxs-lookup"><span data-stu-id="34f1b-104">Windows</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)
> * [<span data-ttu-id="34f1b-105">Linux</span><span class="sxs-lookup"><span data-stu-id="34f1b-105">Linux</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally-linux.md)
> 
> 

<span data-ttu-id="34f1b-106">Monitoramento, detecção, diagnóstico e solução de problemas permitem dar continuidade aos serviços com mínima interrupção da experiência do usuário.</span><span class="sxs-lookup"><span data-stu-id="34f1b-106">Monitoring, detecting, diagnosing, and troubleshooting allow for services to continue with minimal disruption to the user experience.</span></span> <span data-ttu-id="34f1b-107">Embora o monitoramento e o diagnóstico sejam essenciais em um ambiente de produção implantado, a eficiência dependerá da adoção de um modelo semelhante durante o desenvolvimento de serviços para garantir que eles funcionem quando você os mover para uma configuração real.</span><span class="sxs-lookup"><span data-stu-id="34f1b-107">While monitoring and diagnostics are critical in an actual deployed production environment, the efficiency will depend on adopting a similar model during development of services to ensure they work when you move to a real-world setup.</span></span> <span data-ttu-id="34f1b-108">O Service Fabric facilita para o desenvolvedor de serviço implementar diagnóstico que possa funcionar perfeitamente tanto em configurações de desenvolvimento local de computador único, quanto em configurações reais de cluster de produção.</span><span class="sxs-lookup"><span data-stu-id="34f1b-108">Service Fabric makes it easy for service developers to implement diagnostics that can seamlessly work across both single-machine local development setups and real-world production cluster setups.</span></span>

## <a name="event-tracing-for-windows"></a><span data-ttu-id="34f1b-109">Rastreamento de Eventos para Windows</span><span class="sxs-lookup"><span data-stu-id="34f1b-109">Event Tracing for Windows</span></span>
<span data-ttu-id="34f1b-110">[Rastreamento de Eventos para Windows](https://msdn.microsoft.com/library/windows/desktop/bb968803.aspx) (ETW) é a tecnologia recomendada para mensagens de rastreamento na Malha do Serviço.</span><span class="sxs-lookup"><span data-stu-id="34f1b-110">[Event Tracing for Windows](https://msdn.microsoft.com/library/windows/desktop/bb968803.aspx) (ETW) is the recommended technology for tracing messages in Service Fabric.</span></span> <span data-ttu-id="34f1b-111">Alguns benefícios de usar ETW são:</span><span class="sxs-lookup"><span data-stu-id="34f1b-111">Some benefits of using ETW are:</span></span>

* <span data-ttu-id="34f1b-112">**O ETW é rápido.**</span><span class="sxs-lookup"><span data-stu-id="34f1b-112">**ETW is fast.**</span></span> <span data-ttu-id="34f1b-113">Ele foi criado como uma tecnologia de rastreamento que tem impacto mínimo sobre os tempos de execução de código.</span><span class="sxs-lookup"><span data-stu-id="34f1b-113">It was built as a tracing technology that has minimal impact on code execution times.</span></span>
* <span data-ttu-id="34f1b-114">**O rastreamento ETW funciona perfeitamente nos ambientes de desenvolvimento locais e também nas configurações de cluster reais.**</span><span class="sxs-lookup"><span data-stu-id="34f1b-114">**ETW tracing works seamlessly across local development environments and also real-world cluster setups.**</span></span> <span data-ttu-id="34f1b-115">Isso significa que você não precisa reescrever o código de rastreamento quando estiver pronto para implantar seu código em um cluster real.</span><span class="sxs-lookup"><span data-stu-id="34f1b-115">This  means you don't have to rewrite your tracing code when you are ready to deploy your code to a real cluster.</span></span>
* <span data-ttu-id="34f1b-116">**O código do sistema da Malha do Serviço também usa o ETW para rastreamento interno.**</span><span class="sxs-lookup"><span data-stu-id="34f1b-116">**Service Fabric system code also uses ETW for internal tracing.**</span></span> <span data-ttu-id="34f1b-117">Isso permite exibir os rastreamentos do aplicativo intercalados com os rastreamentos do sistema do Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="34f1b-117">This allows you to view your application traces interleaved with Service Fabric system traces.</span></span> <span data-ttu-id="34f1b-118">Ele também ajuda você a entender mais facilmente as sequências e as inter-relações entre o código do aplicativo e os eventos no sistema subjacente.</span><span class="sxs-lookup"><span data-stu-id="34f1b-118">It also helps you to more easily understand the sequences and interrelationships between your application code and events in the underlying system.</span></span>
* <span data-ttu-id="34f1b-119">**Há suporte interno nas ferramentas do Visual Studio da Malha do Serviço para exibir os eventos do ETW.**</span><span class="sxs-lookup"><span data-stu-id="34f1b-119">**There is built-in support in Service Fabric Visual Studio tools to view ETW events.**</span></span> <span data-ttu-id="34f1b-120">Os eventos do ETW aparecem na exibição de Eventos de Diagnóstico do Visual Studio depois que o Visual Studio estiver configurado corretamente com o Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="34f1b-120">ETW events appear in the Diagnostic Events view of Visual Studio once Visual Studio is correctly configured with Service Fabric.</span></span> 

## <a name="view-service-fabric-system-events-in-visual-studio"></a><span data-ttu-id="34f1b-121">Exibir eventos do sistema da Malha do Serviço no Visual Studio</span><span class="sxs-lookup"><span data-stu-id="34f1b-121">View Service Fabric system events in Visual Studio</span></span>
<span data-ttu-id="34f1b-122">O Service Fabric emite eventos do ETW para ajudar os desenvolvedores de aplicativos a entender o que está acontecendo na plataforma.</span><span class="sxs-lookup"><span data-stu-id="34f1b-122">Service Fabric emits ETW events to help application developers understand what's happening in the platform.</span></span> <span data-ttu-id="34f1b-123">Se você ainda não tiver feito isso, vá em frente e siga as etapas em [Criando seu primeiro aplicativo no Visual Studio](service-fabric-create-your-first-application-in-visual-studio.md).</span><span class="sxs-lookup"><span data-stu-id="34f1b-123">If you haven't already done so, go ahead and follow the steps in [Creating your first application in Visual Studio](service-fabric-create-your-first-application-in-visual-studio.md).</span></span> <span data-ttu-id="34f1b-124">Essas informações ajudarão você a colocar um aplicativo para funcionar com o Visualizador de Eventos de Diagnóstico mostrando as mensagens de rastreamento.</span><span class="sxs-lookup"><span data-stu-id="34f1b-124">This information will help you get an application up and running with the Diagnostics Events Viewer showing the trace messages.</span></span>

1. <span data-ttu-id="34f1b-125">Se a janela de eventos de diagnóstico não for mostrada automaticamente, acesse a guia **Exibir** no Visual Studio, escolha **Outras Janelas** e **Visualizador de Eventos de Diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="34f1b-125">If the diagnostics events window does not automatically show, Go to the **View** tab in Visual Studio, choose **Other Windows** and then **Diagnostic Events Viewer**.</span></span>
2. <span data-ttu-id="34f1b-126">Cada evento tem informações de metadados padrão que informam de que nó, aplicativo e serviço ele surge.</span><span class="sxs-lookup"><span data-stu-id="34f1b-126">Each event has standard metadata information that tells you the node, application and service the event is coming from.</span></span> <span data-ttu-id="34f1b-127">Também é possível filtrar a lista de eventos usando a caixa **Filtrar eventos** na parte superior da janela de eventos.</span><span class="sxs-lookup"><span data-stu-id="34f1b-127">You can also filter the list of events by using the **Filter events** box at the top of the events window.</span></span> <span data-ttu-id="34f1b-128">Por exemplo, você pode filtrar por **Nome do Nó** ou **Nome do Serviço.**</span><span class="sxs-lookup"><span data-stu-id="34f1b-128">For example, you can filter on **Node Name** or **Service Name.**</span></span> <span data-ttu-id="34f1b-129">E quando estiver examinando os detalhes de um evento, você também poderá pausar usando o botão **Pausar** na parte superior da janela e continuar mais tarde sem qualquer perda de eventos.</span><span class="sxs-lookup"><span data-stu-id="34f1b-129">And when you're looking at event details, you can also pause by using the **Pause** button at the top of the events window and resume later without any loss of events.</span></span>
   
   ![Visualizador de Eventos de Diagnóstico do Visual Studio](./media/service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally/DiagEventsExamples2.png)

## <a name="add-your-own-custom-traces-to-the-application-code"></a><span data-ttu-id="34f1b-131">Adicionar seus próprios rastreamentos personalizados ao código do aplicativo</span><span class="sxs-lookup"><span data-stu-id="34f1b-131">Add your own custom traces to the application code</span></span>
<span data-ttu-id="34f1b-132">Os modelos de projeto do Visual Studio da Malha do Serviço contêm amostra de código.</span><span class="sxs-lookup"><span data-stu-id="34f1b-132">The Service Fabric Visual Studio project templates contain sample code.</span></span> <span data-ttu-id="34f1b-133">O código mostra como adicionar rastreamentos personalizados do ETW do código de aplicativo, que é mostrado no visualizador do ETW no Visual Studio ao lado dos rastreamentos do sistema do Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="34f1b-133">The code shows how to add custom application code ETW traces that show up in the Visual Studio ETW viewer alongside system traces from Service Fabric.</span></span> <span data-ttu-id="34f1b-134">A vantagem desse método é que os metadados são adicionados automaticamente aos rastreamentos, e o Visualizador de Eventos de Diagnóstico do Visual Studio já está configurado para exibi-los.</span><span class="sxs-lookup"><span data-stu-id="34f1b-134">The advantage of this method is that metadata is automatically added to traces, and the Visual Studio Diagnostic Events Viewer is already configured to display them.</span></span>

<span data-ttu-id="34f1b-135">Para projetos criados dos **modelos de serviço** (com ou sem estado), basta procurar a implementação de `RunAsync`:</span><span class="sxs-lookup"><span data-stu-id="34f1b-135">For projects created from the **service templates** (stateless or stateful) just search for the `RunAsync` implementation:</span></span>

1. <span data-ttu-id="34f1b-136">A chamada para `ServiceEventSource.Current.ServiceMessage` in the `RunAsync` mostra um exemplo de rastreamento ETW personalizado do código de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="34f1b-136">The call to `ServiceEventSource.Current.ServiceMessage` in the `RunAsync` method shows an example of a custom ETW trace from the application code.</span></span>
2. <span data-ttu-id="34f1b-137">No arquivo **ServiceEventSource.cs**, você encontrará uma sobrecarga para o método `ServiceEventSource.ServiceMessage` que deve ser usado para eventos de alta frequência por motivos de desempenho.</span><span class="sxs-lookup"><span data-stu-id="34f1b-137">In the **ServiceEventSource.cs** file, you will find an overload for the `ServiceEventSource.ServiceMessage` method that should be used for high-frequency events due to performance reasons.</span></span>

<span data-ttu-id="34f1b-138">Para projetos criados de **modelos de ator** (com ou sem estado):</span><span class="sxs-lookup"><span data-stu-id="34f1b-138">For projects created from the **actor templates** (stateless or stateful):</span></span>

1. <span data-ttu-id="34f1b-139">Abra o arquivo **"ProjectName".cs** , onde *ProjectName* é o nome escolhido para seu projeto do Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="34f1b-139">Open the **"ProjectName".cs** file where *ProjectName* is the name you chose for your Visual Studio project.</span></span>  
2. <span data-ttu-id="34f1b-140">Localize o código `ActorEventSource.Current.ActorMessage(this, "Doing Work");` no método *DoWorkAsync* .</span><span class="sxs-lookup"><span data-stu-id="34f1b-140">Find the code `ActorEventSource.Current.ActorMessage(this, "Doing Work");` in the *DoWorkAsync* method.</span></span>  <span data-ttu-id="34f1b-141">Este é um exemplo de um rastreamento ETW personalizado escrito a partir do código do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="34f1b-141">This is an example of a custom ETW trace written from application code.</span></span>  
3. <span data-ttu-id="34f1b-142">No arquivo **ActorEventSource.cs**, você encontrará uma sobrecarga para o método `ActorEventSource.ActorMessage` que deve ser usado para eventos de alta frequência por motivos de desempenho.</span><span class="sxs-lookup"><span data-stu-id="34f1b-142">In file **ActorEventSource.cs**, you will find an overload for the `ActorEventSource.ActorMessage` method that should be used for high-frequency events due to performance reasons.</span></span>

<span data-ttu-id="34f1b-143">Depois de adicionar o rastreamento ETW personalizado ao código de serviço, você pode criar, implantar e executar o aplicativo novamente para ver seus eventos no Visualizador de Eventos de Diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="34f1b-143">After adding custom ETW tracing to your service code, you can build, deploy, and run the application again to see your event(s) in the Diagnostic Events Viewer.</span></span> <span data-ttu-id="34f1b-144">Se você depurar o aplicativo com **F5**, o Visualizador de Eventos de Diagnóstico será aberto automaticamente.</span><span class="sxs-lookup"><span data-stu-id="34f1b-144">If you debug the application with **F5**, the Diagnostic Events Viewer will open automatically.</span></span>

## <a name="next-steps"></a><span data-ttu-id="34f1b-145">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="34f1b-145">Next steps</span></span>
<span data-ttu-id="34f1b-146">O mesmo código de rastreamento que você adicionou ao aplicativo acima para diagnóstico local funcionará com ferramentas que podem ser usadas para exibir esses eventos ao executar o aplicativo em um cluster do Azure.</span><span class="sxs-lookup"><span data-stu-id="34f1b-146">The same tracing code that you added to your application above for local diagnostics will work with tools that you can use to view these events when running your application on an Azure cluster.</span></span> <span data-ttu-id="34f1b-147">Consulte estes artigos que abordam as diferentes opções para as ferramentas e descrevem como configurá-las.</span><span class="sxs-lookup"><span data-stu-id="34f1b-147">Check out these articles that discuss the different options for the tools and describe how you can set them up.</span></span>

* [<span data-ttu-id="34f1b-148">Como coletar logs com o Diagnóstico do Azure</span><span class="sxs-lookup"><span data-stu-id="34f1b-148">How to collect logs with Azure Diagnostics</span></span>](service-fabric-diagnostics-how-to-setup-wad.md)
* [<span data-ttu-id="34f1b-149">Agregação e coleta de eventos usando o EventFlow</span><span class="sxs-lookup"><span data-stu-id="34f1b-149">Event aggregation and collection using EventFlow</span></span>](service-fabric-diagnostics-event-aggregation-eventflow.md)

