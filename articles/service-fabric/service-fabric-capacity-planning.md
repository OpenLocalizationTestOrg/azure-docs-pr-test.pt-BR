---
title: Planejamento de capacidade para aplicativos Service Fabric | Microsoft Docs
description: "Descreve como identificar o número de nós de computação necessários para um aplicativo do Service Fabric"
services: service-fabric
documentationcenter: .net
author: mani-ramaswamy
manager: markfuss
editor: 
ms.assetid: 9fa47be0-50a2-4a51-84a5-20992af94bea
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 8/9/2017
ms.author: subramar
ms.openlocfilehash: fc98bdd8b3597810b0c07563af507e93c611f769
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/18/2017
---
# <a name="capacity-planning-for-service-fabric-applications"></a><span data-ttu-id="be1ee-103">Planejamento de capacidade para Aplicativos do Service Fabric</span><span class="sxs-lookup"><span data-stu-id="be1ee-103">Capacity planning for Service Fabric applications</span></span>
<span data-ttu-id="be1ee-104">Este documento ensina a você como estimar a quantidade de recursos (CPU, RAM, armazenamento de disco) necessários para a execução dos aplicativos Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="be1ee-104">This document teaches you how to estimate the amount of resources (CPUs, RAM, disk storage) you need to run your Azure Service Fabric applications.</span></span> <span data-ttu-id="be1ee-105">É comum os requisitos de recursos mudarem ao longo do tempo.</span><span class="sxs-lookup"><span data-stu-id="be1ee-105">It is common for your resource requirements to change over time.</span></span> <span data-ttu-id="be1ee-106">Normalmente, você precisa de alguns recursos enquanto desenvolve/testa seu serviço e, posteriormente, precisa de mais recursos à medida que entra na fase de produção e a popularidade de seu aplicativo aumenta.</span><span class="sxs-lookup"><span data-stu-id="be1ee-106">You typically require few resources as you develop/test your service, and then require more resources as you go into production and your application grows in popularity.</span></span> <span data-ttu-id="be1ee-107">Ao projetar o aplicativo, pense nos requisitos de longo prazo e faça escolhas que permitam a ampliação do serviço, a fim de atender à alta demanda dos clientes.</span><span class="sxs-lookup"><span data-stu-id="be1ee-107">When you design your application, think through the long-term requirements and make choices that allow your service to scale to meet high customer demand.</span></span>

 <span data-ttu-id="be1ee-108">Ao criar um cluster do Service Fabric, você decide quais tipos de VMs (máquinas virtuais) compõem o cluster.</span><span class="sxs-lookup"><span data-stu-id="be1ee-108">When you create a Service Fabric cluster, you decide what kinds of virtual machines (VMs) make up the cluster.</span></span> <span data-ttu-id="be1ee-109">Cada VM é acompanhada por uma quantidade limitada de recursos na forma de CPU (núcleos e velocidade), largura de banda de rede, RAM e armazenamento em disco.</span><span class="sxs-lookup"><span data-stu-id="be1ee-109">Each VM comes with a limited amount of resources in the form of CPUs (cores and speed), network bandwidth, RAM, and disk storage.</span></span> <span data-ttu-id="be1ee-110">À medida que o serviço cresce com o tempo, você pode atualizar para VMs que oferecem mais recursos e/ou adicionar mais VMs ao seu cluster.</span><span class="sxs-lookup"><span data-stu-id="be1ee-110">As your service grows over time, you can upgrade to VMs that offer greater resources and/or add more VMs to your cluster.</span></span> <span data-ttu-id="be1ee-111">Para executar a última sugestão, você deverá arquitetar seu serviço inicialmente para que ele possa tirar proveito de novas VMs adicionadas dinamicamente ao cluster.</span><span class="sxs-lookup"><span data-stu-id="be1ee-111">To do the latter, you must architect your service initially so it can take advantage of new VMs that get dynamically added to the cluster.</span></span>

<span data-ttu-id="be1ee-112">Alguns serviços gerenciam nenhum ou poucos dados nas VMs em si.</span><span class="sxs-lookup"><span data-stu-id="be1ee-112">Some services manage little to no data on the VMs themselves.</span></span> <span data-ttu-id="be1ee-113">Portanto, o planejamento de capacidade para esses serviços deve se concentrar principalmente no desempenho, o que significa selecionar as CPUs apropriadas (núcleos e velocidade) das VMs.</span><span class="sxs-lookup"><span data-stu-id="be1ee-113">Therefore, capacity planning for these services should focus primarily on performance, which means selecting the appropriate CPUs (cores and speed) of the VMs.</span></span> <span data-ttu-id="be1ee-114">Além disso, você deve considerar a largura de banda da rede, incluindo a frequência das transferências de rede e a quantidade de dados que está sendo transferida.</span><span class="sxs-lookup"><span data-stu-id="be1ee-114">In addition, you should consider network bandwidth, including how frequently network transfers are occurring and how much data is being transferred.</span></span> <span data-ttu-id="be1ee-115">Se o serviço precisar ser executado com qualidade à medida que o uso do serviço aumenta, você poderá adicionar mais VMs ao cluster e balancear a carga das solicitações de rede em todas as VMs.</span><span class="sxs-lookup"><span data-stu-id="be1ee-115">If your service needs to perform well as service usage increases, you can add more VMs to the cluster and load balance the network requests across all the VMs.</span></span>

<span data-ttu-id="be1ee-116">Para serviços que gerenciam grandes volumes dados nas VMs, o planejamento de capacidade deve se concentrar principalmente no tamanho.</span><span class="sxs-lookup"><span data-stu-id="be1ee-116">For services that manage large amounts of data on the VMs, capacity planning should focus primarily on size.</span></span> <span data-ttu-id="be1ee-117">Portanto, você deve considerar cuidadosamente a capacidade de RAM e o armazenamento de disco da VM.</span><span class="sxs-lookup"><span data-stu-id="be1ee-117">Thus, you should carefully consider the capacity of the VM's RAM and disk storage.</span></span> <span data-ttu-id="be1ee-118">O sistema de gerenciamento de memória virtual no Windows faz o espaço em disco se parecer com a memória RAM para o código do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="be1ee-118">The virtual memory management system in Windows makes disk space look like RAM to application code.</span></span> <span data-ttu-id="be1ee-119">Além disso, o tempo de execução do Service Fabric fornece a paginação inteligente mantendo apenas dados dinâmicos na memória e movendo dados sem vida para o disco.</span><span class="sxs-lookup"><span data-stu-id="be1ee-119">In addition, the Service Fabric runtime provides smart paging keeping only hot data in memory and moving the cold data to disk.</span></span> <span data-ttu-id="be1ee-120">Assim, os aplicativos usam mais memória do que está fisicamente disponível na VM.</span><span class="sxs-lookup"><span data-stu-id="be1ee-120">Applications can thus use more memory than is physically available on the VM.</span></span> <span data-ttu-id="be1ee-121">Ter mais RAM simplesmente aumenta o desempenho, pois a VM pode manter mais armazenamento em disco na RAM.</span><span class="sxs-lookup"><span data-stu-id="be1ee-121">Having more RAM simply increases performance, since the VM can keep more disk storage in RAM.</span></span> <span data-ttu-id="be1ee-122">A máquina virtual que você selecionar deve ter um disco grande o suficiente para armazenar os dados que você deseja na VM.</span><span class="sxs-lookup"><span data-stu-id="be1ee-122">The VM you select should have a disk large enough to store the data that you want on the VM.</span></span> <span data-ttu-id="be1ee-123">Da mesma forma, a VM deve ter RAM suficiente para fornecer o desempenho desejado.</span><span class="sxs-lookup"><span data-stu-id="be1ee-123">Similarly, the VM should have enough RAM to provide you with the performance you desire.</span></span> <span data-ttu-id="be1ee-124">Se os dados do serviço crescerem com o tempo, você poderá adicionar mais VMs ao cluster e particionar os dados em todas as VMs.</span><span class="sxs-lookup"><span data-stu-id="be1ee-124">If your service's data grows over time, you can add more VMs to the cluster and partition the data across all the VMs.</span></span>

## <a name="determine-how-many-nodes-you-need"></a><span data-ttu-id="be1ee-125">Determinar quantos nós são necessários</span><span class="sxs-lookup"><span data-stu-id="be1ee-125">Determine how many nodes you need</span></span>
<span data-ttu-id="be1ee-126">O particionamento do serviço permite que você escale horizontalmente os dados do serviço.</span><span class="sxs-lookup"><span data-stu-id="be1ee-126">Partitioning your service allows you to scale out your service's data.</span></span> <span data-ttu-id="be1ee-127">Para obter mais informações sobre particionamento, consulte [Particionamento do Service Fabric](service-fabric-concepts-partitioning.md).</span><span class="sxs-lookup"><span data-stu-id="be1ee-127">For more information on partitioning, see [Partitioning Service Fabric](service-fabric-concepts-partitioning.md).</span></span> <span data-ttu-id="be1ee-128">Cada partição deve se ajustar a uma única VM, mas várias partições (pequenas) podem ser colocadas em uma única VM.</span><span class="sxs-lookup"><span data-stu-id="be1ee-128">Each partition must fit within a single VM, but multiple (small) partitions can be placed on a single VM.</span></span> <span data-ttu-id="be1ee-129">Portanto, ter mais partições pequenas fornece maior flexibilidade do que ter poucas partições maiores.</span><span class="sxs-lookup"><span data-stu-id="be1ee-129">So, having more small partitions gives you greater flexibility than having a few larger partitions.</span></span> <span data-ttu-id="be1ee-130">A desvantagem é que ter muitas partições aumenta a sobrecarga do Service Fabric e você não pode executar operações transacionadas entre partições.</span><span class="sxs-lookup"><span data-stu-id="be1ee-130">The trade-off is that having lots of partitions increases Service Fabric overhead and you cannot perform transacted operations across partitions.</span></span> <span data-ttu-id="be1ee-131">Também há a possibilidade demais tráfego de rede se o seu código de serviço precisar constantemente acessar partes dos dados que residem em partições diferentes.</span><span class="sxs-lookup"><span data-stu-id="be1ee-131">There is also more potential network traffic if your service code frequently needs to access pieces of data that live in different partitions.</span></span> <span data-ttu-id="be1ee-132">Ao projetar seu serviço, você deve considerar cuidadosamente esses prós e contras para chegar a uma estratégia de particionamento eficiente.</span><span class="sxs-lookup"><span data-stu-id="be1ee-132">When designing your service, you should carefully consider these pros and cons to arrive at an effective partitioning strategy.</span></span>

<span data-ttu-id="be1ee-133">Vamos supor que seu aplicativo tem um único serviço com estado, com um tamanho de armazenamento que você espera aumentar para determinado tamanho de BD em GB em um ano.</span><span class="sxs-lookup"><span data-stu-id="be1ee-133">Let's assume your application has a single stateful service that has a store size that you expect to grow to DB_Size GB in a year.</span></span> <span data-ttu-id="be1ee-134">Você está disposto a adicionar mais aplicativos (e partições) conforme for crescendo depois desse ano.</span><span class="sxs-lookup"><span data-stu-id="be1ee-134">You are willing to add more applications (and partitions) as you experience growth beyond that year.</span></span>  <span data-ttu-id="be1ee-135">O RF (fator de replicação), que determina o número de réplicas para o serviço afeta o tamanho de BD total.</span><span class="sxs-lookup"><span data-stu-id="be1ee-135">The replication factor (RF), which determines the number of replicas for your service impacts the total DB_Size.</span></span> <span data-ttu-id="be1ee-136">O tamanho de BD total em todas as réplicas é o fator de replicação multiplicado pelo tamanho de BD.</span><span class="sxs-lookup"><span data-stu-id="be1ee-136">The total DB_Size across all replicas is the Replication Factor multiplied by DB_Size.</span></span>  <span data-ttu-id="be1ee-137">Tamanho do nó representa a RAM/espaço em disco por nó que você deseja usar para seu serviço.</span><span class="sxs-lookup"><span data-stu-id="be1ee-137">Node_Size represents the disk space/RAM per node you want to use for your service.</span></span> <span data-ttu-id="be1ee-138">Para melhor desempenho, o tamanho de BD deve caber na memória no cluster e um tamanho do nó ao redor da RAM da VM deve ser escolhido.</span><span class="sxs-lookup"><span data-stu-id="be1ee-138">For best performance, the DB_Size should fit into memory across the cluster, and a Node_Size that is around the RAM of the VM should be chosen.</span></span> <span data-ttu-id="be1ee-139">Ao alocar um tamanho de nó maior que a capacidade de RAM, você dependerá da paginação fornecida pelo tempo de execução do Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="be1ee-139">By allocating a Node_Size that is larger than the RAM capacity, you are relying on the paging provided by the Service Fabric runtime.</span></span> <span data-ttu-id="be1ee-140">Assim, o desempenho pode não ser ideal se seus dados inteiros são considerados dinâmicos (desde então, os dados são paginados como entrada/saída).</span><span class="sxs-lookup"><span data-stu-id="be1ee-140">Thus, your performance may not be optimal if your entire data is considered to be hot (since then the data is paged in/out).</span></span> <span data-ttu-id="be1ee-141">No entanto, para muitos serviços em que apenas uma fração dos dados é dinâmica, é mais econômico.</span><span class="sxs-lookup"><span data-stu-id="be1ee-141">However, for many services where only a fraction of the data is hot, it is more cost-effective.</span></span>

<span data-ttu-id="be1ee-142">O número de nós exigidos para obter o desempenho máximo pode ser calculado da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="be1ee-142">The number of nodes required for maximum performance can be computed as follows:</span></span>

```
Number of Nodes = (DB_Size * RF)/Node_Size

```


## <a name="account-for-growth"></a><span data-ttu-id="be1ee-143">Pense no crescimento</span><span class="sxs-lookup"><span data-stu-id="be1ee-143">Account for growth</span></span>
<span data-ttu-id="be1ee-144">Pode ser uma boa ideia calcular o número de nós com base no tamanho de BD que você espera atingir com seu serviço, além do tamanho de BD inicial.</span><span class="sxs-lookup"><span data-stu-id="be1ee-144">You may want to compute the number of nodes based on the DB_Size that you expect your service to grow to, in addition to the DB_Size that you began with.</span></span> <span data-ttu-id="be1ee-145">Em seguida, aumente o número de nós conforme seu serviço dor crescendo para não provisionar excessivamente o número de nós.</span><span class="sxs-lookup"><span data-stu-id="be1ee-145">Then, grow the number of nodes as your service grows so that you are not over-provisioning the number of nodes.</span></span> <span data-ttu-id="be1ee-146">Porém, o número de partições deve ter base no número de nós que são necessários durante a execução do seu serviço no crescimento máximo.</span><span class="sxs-lookup"><span data-stu-id="be1ee-146">But the number of partitions should be based on the number of nodes that are needed when you're running your service at maximum growth.</span></span>

<span data-ttu-id="be1ee-147">É bom ter algumas máquinas adicionais disponíveis a qualquer momento, para que você possa manipular picos inesperados ou falha (por exemplo, se algumas VMs ficarem inativas).</span><span class="sxs-lookup"><span data-stu-id="be1ee-147">It is good to have some extra machines available at any time so that you can handle any unexpected spikes or failure (for example, if a few VMs go down).</span></span>  <span data-ttu-id="be1ee-148">Embora a capacidade extra deva ser determinada usando seus picos esperados, um bom ponto de partida seria reservar algumas VMs adicionais (5 a 10% extra).</span><span class="sxs-lookup"><span data-stu-id="be1ee-148">While the extra capacity should be determined by using your expected spikes, a starting point is to reserve a few extra VMs (5-10 percent extra).</span></span>

<span data-ttu-id="be1ee-149">O ponto anterior pressupõe um único serviço com estado.</span><span class="sxs-lookup"><span data-stu-id="be1ee-149">The preceding assumes a single stateful service.</span></span> <span data-ttu-id="be1ee-150">Se você tiver mais de um serviço com estado, precisará adicionar o tamanho de BD associado aos outros serviços na equação.</span><span class="sxs-lookup"><span data-stu-id="be1ee-150">If you have more than one stateful service, you have to add the DB_Size associated with the other services into the equation.</span></span> <span data-ttu-id="be1ee-151">Como alternativa, você pode calcular o número de nós separadamente para cada serviço com estado.</span><span class="sxs-lookup"><span data-stu-id="be1ee-151">Alternatively, you can compute the number of nodes separately for each stateful service.</span></span>  <span data-ttu-id="be1ee-152">O serviço pode ter réplicas ou partições que não são equilibradas.</span><span class="sxs-lookup"><span data-stu-id="be1ee-152">Your service may have replicas or partitions that aren't balanced.</span></span> <span data-ttu-id="be1ee-153">Tenha em mente que as partições também podem ter mais dados do que outras.</span><span class="sxs-lookup"><span data-stu-id="be1ee-153">Keep in mind that partitions may also have more data than others.</span></span> <span data-ttu-id="be1ee-154">Para obter mais informações sobre particionamento, consulte [Particionamento de artigo nas práticas recomendadas](service-fabric-concepts-partitioning.md).</span><span class="sxs-lookup"><span data-stu-id="be1ee-154">For more information on partitioning, see [partitioning article on best practices](service-fabric-concepts-partitioning.md).</span></span> <span data-ttu-id="be1ee-155">No entanto, a equação anterior independe do número de partições ou réplicas, pois o Service Fabric garante que as réplicas sejam distribuídas entre os nós de uma forma otimizada.</span><span class="sxs-lookup"><span data-stu-id="be1ee-155">However, the preceding equation is partition and replica agnostic, because Service Fabric ensures that the replicas are spread out among the nodes in an optimized manner.</span></span>

## <a name="use-a-spreadsheet-for-cost-calculation"></a><span data-ttu-id="be1ee-156">Use uma planilha para calcular o custo</span><span class="sxs-lookup"><span data-stu-id="be1ee-156">Use a spreadsheet for cost calculation</span></span>
<span data-ttu-id="be1ee-157">Agora, vamos colocar alguns números reais na fórmula.</span><span class="sxs-lookup"><span data-stu-id="be1ee-157">Now let's put some real numbers in the formula.</span></span> <span data-ttu-id="be1ee-158">Uma [planilha de exemplo](https://servicefabricsdkstorage.blob.core.windows.net/publicrelease/SF%20VM%20Cost%20calculator-NEW.xlsx) mostra como planejar a capacidade de um aplicativo que contém três tipos de objetos de dados.</span><span class="sxs-lookup"><span data-stu-id="be1ee-158">An [example spreadsheet](https://servicefabricsdkstorage.blob.core.windows.net/publicrelease/SF%20VM%20Cost%20calculator-NEW.xlsx) shows how to plan the capacity for an application that contains three types of data objects.</span></span> <span data-ttu-id="be1ee-159">Para cada objeto, podemos supor seu tamanho e quantos objetos são esperados.</span><span class="sxs-lookup"><span data-stu-id="be1ee-159">For each object, we approximate its size and how many objects we expect to have.</span></span> <span data-ttu-id="be1ee-160">Também selecionamos quantas réplicas queremos de cada tipo de objeto.</span><span class="sxs-lookup"><span data-stu-id="be1ee-160">We also select how many replicas we want of each object type.</span></span> <span data-ttu-id="be1ee-161">A planilha calcula a quantidade total de memória a ser armazenada no cluster.</span><span class="sxs-lookup"><span data-stu-id="be1ee-161">The spreadsheet calculates the total amount of memory to be stored in the cluster.</span></span>

<span data-ttu-id="be1ee-162">Em seguida, inserimos um tamanho de VM e um custo mensal.</span><span class="sxs-lookup"><span data-stu-id="be1ee-162">Then we enter a VM size and monthly cost.</span></span> <span data-ttu-id="be1ee-163">Com base no tamanho da VM, a planilha informa o número mínimo de partições que você deve usar para dividir seus dados a fim de ajustar fisicamente nos nós.</span><span class="sxs-lookup"><span data-stu-id="be1ee-163">Based on the VM size, the spreadsheet tells you the minimum number of partitions you must use to split your data to physically fit on the nodes.</span></span> <span data-ttu-id="be1ee-164">Talvez você queira que um número maior de partições acomode as necessidades de tráfego de computação e de rede específico de seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="be1ee-164">You may desire a larger number of partitions to accommodate your application's specific computation and network traffic needs.</span></span> <span data-ttu-id="be1ee-165">A planilha mostra que o número de partições que estão gerenciando objetos de perfil de usuário aumentou de uma para seis.</span><span class="sxs-lookup"><span data-stu-id="be1ee-165">The spreadsheet shows the number of partitions that are managing the user profile objects has increased from one to six.</span></span>

<span data-ttu-id="be1ee-166">Agora, com base em todas essas informações, a planilha mostra que você pode obter fisicamente todos os dados com as partições e réplicas desejadas em um cluster com 26 nós.</span><span class="sxs-lookup"><span data-stu-id="be1ee-166">Now, based on all this information, the spreadsheet shows that you could physically get all the data with the desired partitions and replicas on a 26-node cluster.</span></span> <span data-ttu-id="be1ee-167">No entanto, esse cluster estaria densamente compactado e, por isso, convém adicionar alguns nós para acomodar atualizações e falhas de nó.</span><span class="sxs-lookup"><span data-stu-id="be1ee-167">However, this cluster would be densely packed, so you may want some additional nodes to accommodate node failures and upgrades.</span></span> <span data-ttu-id="be1ee-168">A planilha também mostra que ter mais de 57 nós não representa um valor adicional, pois você teria nós vazios.</span><span class="sxs-lookup"><span data-stu-id="be1ee-168">The spreadsheet also shows that having more than 57 nodes provides no additional value because you would have empty nodes.</span></span> <span data-ttu-id="be1ee-169">Novamente, convém ultrapassar os 57 nós a fim de acomodar falhas de nós e atualizações.</span><span class="sxs-lookup"><span data-stu-id="be1ee-169">Again, you may want to go above 57 nodes anyway to accommodate node failures and upgrades.</span></span> <span data-ttu-id="be1ee-170">É possível ajustar a planilha a fim de atender às necessidades específicas de seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="be1ee-170">You can tweak the spreadsheet to match your application's specific needs.</span></span>   

![Planilha para cálculo de custo][Image1]

## <a name="next-steps"></a><span data-ttu-id="be1ee-172">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="be1ee-172">Next steps</span></span>
<span data-ttu-id="be1ee-173">Confira [Particionando serviços do Service Fabric][10] para saber mais sobre como particionar o serviço.</span><span class="sxs-lookup"><span data-stu-id="be1ee-173">Check out [Partitioning Service Fabric services][10] to learn more about partitioning your service.</span></span>

<!--Image references-->
[Image1]: ./media/SF-Cost.png

<!--Link references--In actual articles, you only need a single period before the slash-->
[10]: service-fabric-concepts-partitioning.md
