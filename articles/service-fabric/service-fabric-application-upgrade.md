---
title: "Atualização de aplicativos do Service Fabric | Microsoft Docs"
description: "Este artigo fornece uma introdução à atualização de um aplicativo do Service Fabric, incluindo a escolha de modos de atualização e execução de verificações de integridade."
services: service-fabric
documentationcenter: .net
author: mani-ramaswamy
manager: timlt
editor: 
ms.assetid: 803c9c63-373a-4d6a-8ef2-ea97e16e88dd
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 8/9/2017
ms.author: subramar
ms.openlocfilehash: 4c2752bee8e9a859b23dbf47662d15798b551bb5
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/18/2017
---
# <a name="service-fabric-application-upgrade"></a><span data-ttu-id="9737d-103">Atualização de aplicativos do Service Fabric</span><span class="sxs-lookup"><span data-stu-id="9737d-103">Service Fabric application upgrade</span></span>
<span data-ttu-id="9737d-104">Um aplicativo do Azure Service Fabric é uma coleção de serviços.</span><span class="sxs-lookup"><span data-stu-id="9737d-104">An Azure Service Fabric application is a collection of services.</span></span> <span data-ttu-id="9737d-105">Durante uma atualização, a Malha do Serviço compara o novo [manifesto do aplicativo](service-fabric-application-model.md#describe-an-application) com a versão anterior e determina quais serviços as atualizações do aplicativo exigem.</span><span class="sxs-lookup"><span data-stu-id="9737d-105">During an upgrade, Service Fabric compares the new [application manifest](service-fabric-application-model.md#describe-an-application) with the previous version and determines which services in the application require updates.</span></span> <span data-ttu-id="9737d-106">O Service Fabric compara os números de versão nos manifestos de serviço com os números de versão na versão anterior.</span><span class="sxs-lookup"><span data-stu-id="9737d-106">Service Fabric compares the version numbers in the service manifests with the version numbers in the previous version.</span></span> <span data-ttu-id="9737d-107">Se um serviço não foi alterado, ele não foi atualizado.</span><span class="sxs-lookup"><span data-stu-id="9737d-107">If a service has not changed, that service is not upgraded.</span></span>

## <a name="rolling-upgrades-overview"></a><span data-ttu-id="9737d-108">Visão geral das atualizações sem interrupção</span><span class="sxs-lookup"><span data-stu-id="9737d-108">Rolling upgrades overview</span></span>
<span data-ttu-id="9737d-109">Em uma atualização do aplicativo sem interrupção, a atualização é executada em estágios.</span><span class="sxs-lookup"><span data-stu-id="9737d-109">In a rolling application upgrade, the upgrade is performed in stages.</span></span> <span data-ttu-id="9737d-110">Em cada estágio, a atualização é aplicada a um subconjunto de nós no cluster, chamado de domínio de atualização.</span><span class="sxs-lookup"><span data-stu-id="9737d-110">At each stage, the upgrade is applied to a subset of nodes in the cluster, called an update domain.</span></span> <span data-ttu-id="9737d-111">Como resultado, o aplicativo permanece disponível durante a atualização.</span><span class="sxs-lookup"><span data-stu-id="9737d-111">As a result, the application remains available throughout the upgrade.</span></span> <span data-ttu-id="9737d-112">Durante a atualização, o cluster pode conter uma combinação de versões antigas e novas.</span><span class="sxs-lookup"><span data-stu-id="9737d-112">During the upgrade, the cluster may contain a mix of the old and new versions.</span></span>

<span data-ttu-id="9737d-113">Por esse motivo, as duas versões devem ser compatíveis uma com a outra.</span><span class="sxs-lookup"><span data-stu-id="9737d-113">For that reason, the two versions must be forward and backward compatible.</span></span> <span data-ttu-id="9737d-114">Se não forem compatíveis, o administrador do aplicativo é responsável por realizar uma atualização de várias fases para manter a disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="9737d-114">If they are not compatible, the application administrator is responsible for staging a multiple-phase upgrade to maintain availability.</span></span> <span data-ttu-id="9737d-115">Em uma atualização multifásica, a primeira etapa é atualizar para uma versão intermediária do aplicativo que é compatível com a versão anterior.</span><span class="sxs-lookup"><span data-stu-id="9737d-115">In a multiple-phase upgrade, the first step is upgrading to an intermediate version of the application that is compatible with the previous version.</span></span> <span data-ttu-id="9737d-116">A segunda etapa é atualizar a versão final que quebra a compatibilidade com a versão anterior à atualização, mas é compatível com a versão intermediária.</span><span class="sxs-lookup"><span data-stu-id="9737d-116">The second step is to upgrade the final version that breaks compatibility with the pre-update version, but is compatible with the intermediate version.</span></span>

<span data-ttu-id="9737d-117">Os domínios de atualização ficam especificados no manifesto do cluster quando este é configurado.</span><span class="sxs-lookup"><span data-stu-id="9737d-117">Update domains are specified in the cluster manifest when you configure the cluster.</span></span> <span data-ttu-id="9737d-118">Os domínios de atualização não recebem atualizações em uma ordem específica.</span><span class="sxs-lookup"><span data-stu-id="9737d-118">Update domains do not receive updates in a particular order.</span></span> <span data-ttu-id="9737d-119">Um domínio de atualização é uma unidade lógica de implantação para um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="9737d-119">An update domain is a logical unit of deployment for an application.</span></span> <span data-ttu-id="9737d-120">Os domínios de atualização permitem que os serviços permaneçam com alta disponibilidade durante uma atualização.</span><span class="sxs-lookup"><span data-stu-id="9737d-120">Update domains allow the services to remain at high availability during an upgrade.</span></span>

<span data-ttu-id="9737d-121">Atualizações com interrupção são possíveis se a atualização for aplicada a todos os nós no cluster, que é o caso quando o aplicativo tem somente um domínio de atualização.</span><span class="sxs-lookup"><span data-stu-id="9737d-121">Non-rolling upgrades are possible if the upgrade is applied to all nodes in the cluster, which is the case when the application has only one update domain.</span></span> <span data-ttu-id="9737d-122">Essa abordagem não é recomendável porque o serviço ficaria paralisado e não estaria disponível no momento da atualização.</span><span class="sxs-lookup"><span data-stu-id="9737d-122">This approach is not recommended, since the service goes down and isn't available at the time of upgrade.</span></span> <span data-ttu-id="9737d-123">Além disso, o Azure não fornece qualquer garantia quando um cluster é configurado com apenas um domínio de atualização.</span><span class="sxs-lookup"><span data-stu-id="9737d-123">Additionally, Azure doesn't provide any guarantees when a cluster is set up with only one update domain.</span></span>

## <a name="health-checks-during-upgrades"></a><span data-ttu-id="9737d-124">Verificações de integridade durante atualizações</span><span class="sxs-lookup"><span data-stu-id="9737d-124">Health checks during upgrades</span></span>
<span data-ttu-id="9737d-125">Para uma atualização, as políticas de integridade precisam ser configuradas (ou valores padrão podem ser usados).</span><span class="sxs-lookup"><span data-stu-id="9737d-125">For an upgrade, health policies have to be set (or default values may be used).</span></span> <span data-ttu-id="9737d-126">Uma atualização é considerada bem-sucedida quando todos os domínios de atualização são atualizados dentro do tempo limite especificado e quando todos os domínios de atualização são considerados íntegros.</span><span class="sxs-lookup"><span data-stu-id="9737d-126">An upgrade is termed successful when all update domains are upgraded within the specified time-outs, and when all update domains are deemed healthy.</span></span>  <span data-ttu-id="9737d-127">Um domínio de atualização íntegro significa que o domínio de atualização foi aprovado em todas as verificações de integridade especificadas na política de integridade.</span><span class="sxs-lookup"><span data-stu-id="9737d-127">A healthy update domain means that the update domain passed all the health checks specified in the health policy.</span></span> <span data-ttu-id="9737d-128">Por exemplo, uma política de integridade pode obrigar que todos os serviços em uma instância do aplicativo estejam *íntegros*, de acordo com a definição de integridade do Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="9737d-128">For example, a health policy may mandate that all services within an application instance must be *healthy*, as health is defined by Service Fabric.</span></span>

<span data-ttu-id="9737d-129">As políticas e verificações de integridade durante a atualização feita pelo Service Fabric são independentes do serviço e do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="9737d-129">Health policies and checks during upgrade by Service Fabric are service and application agnostic.</span></span> <span data-ttu-id="9737d-130">Ou seja, nenhum teste específico de serviço é realizado.</span><span class="sxs-lookup"><span data-stu-id="9737d-130">That is, no service-specific tests are done.</span></span>  <span data-ttu-id="9737d-131">Por exemplo, o serviço pode ter um requisito de taxa de transferência, mas o Service Fabric não tem as informações para verificar a taxa de transferência.</span><span class="sxs-lookup"><span data-stu-id="9737d-131">For example, your service might have a throughput requirement, but Service Fabric does not have the information to check throughput.</span></span> <span data-ttu-id="9737d-132">Confira os [artigos sobre integridade](service-fabric-health-introduction.md) para as verificações que serão executadas.</span><span class="sxs-lookup"><span data-stu-id="9737d-132">Refer to the [health articles](service-fabric-health-introduction.md) for the checks that are performed.</span></span> <span data-ttu-id="9737d-133">As verificações que ocorrem durante uma atualização incluem testes para ver se o pacote de aplicativos foi copiado corretamente, se a instância foi iniciada e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="9737d-133">The checks that happen during an upgrade include tests for whether the application package was copied correctly, whether the instance was started, and so on.</span></span>

<span data-ttu-id="9737d-134">A integridade do aplicativo é uma agregação das entidades filho do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="9737d-134">The application health is an aggregation of the child entities of the application.</span></span> <span data-ttu-id="9737d-135">Em resumo, o Service Fabric avalia a integridade do aplicativo por meio da integridade reportada no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="9737d-135">In short, Service Fabric evaluates the health of the application through the health that is reported on the application.</span></span> <span data-ttu-id="9737d-136">Ele também avalia a integridade de todos os serviços do aplicativo dessa maneira.</span><span class="sxs-lookup"><span data-stu-id="9737d-136">It also evaluates the health of all the services for the application this way.</span></span> <span data-ttu-id="9737d-137">O Service Fabric ainda avalia a integridade dos serviços de aplicativo agregando a integridade de seus filhos, como a réplica do serviço.</span><span class="sxs-lookup"><span data-stu-id="9737d-137">Service Fabric further evaluates the health of the application services by aggregating the health of their children, such as the service replica.</span></span> <span data-ttu-id="9737d-138">Quando a política de integridade do aplicativo for atendida, a atualização poderá continuar.</span><span class="sxs-lookup"><span data-stu-id="9737d-138">Once the application health policy is satisfied, the upgrade can proceed.</span></span> <span data-ttu-id="9737d-139">Se a política de integridade for violada, a atualização do aplicativo falhará.</span><span class="sxs-lookup"><span data-stu-id="9737d-139">If the health policy is violated, the application upgrade fails.</span></span>

## <a name="upgrade-modes"></a><span data-ttu-id="9737d-140">Modos de atualização</span><span class="sxs-lookup"><span data-stu-id="9737d-140">Upgrade modes</span></span>
<span data-ttu-id="9737d-141">O modo recomendado de atualização do aplicativo é o modo monitorado, que é o comumente usado.</span><span class="sxs-lookup"><span data-stu-id="9737d-141">The mode that we recommend for application upgrade is the monitored mode, which is the commonly used mode.</span></span> <span data-ttu-id="9737d-142">O modo monitorado executa a atualização em um domínio de atualização, e se todas as verificações de integridade forem aprovadas (pela política especificada), ele passa para o próximo domínio de atualização automaticamente.</span><span class="sxs-lookup"><span data-stu-id="9737d-142">Monitored mode performs the upgrade on one update domain, and if all health checks pass (per the policy specified), moves on to the next update domain automatically.</span></span>  <span data-ttu-id="9737d-143">Se as verificações de integridade falharem e/ou o tempo limite for atingido, a atualização será revertida para o domínio de atualização ou o modo será alterado para manual não monitorado.</span><span class="sxs-lookup"><span data-stu-id="9737d-143">If health checks fail and/or time-outs are reached, the upgrade is either rolled back for the update domain, or the mode is changed to unmonitored manual.</span></span> <span data-ttu-id="9737d-144">Você pode configurar a atualização para escolher um desses dois modos para atualizações que falharam.</span><span class="sxs-lookup"><span data-stu-id="9737d-144">You can configure the upgrade to choose one of those two modes for failed upgrades.</span></span> 

<span data-ttu-id="9737d-145">O manual não monitorado precisaria de intervenção manual após cada atualização em um domínio de atualização, a fim de disparar a atualização no domínio de atualização seguinte.</span><span class="sxs-lookup"><span data-stu-id="9737d-145">Unmonitored manual mode needs manual intervention after every upgrade on an update domain, to kick off the upgrade on the next update domain.</span></span> <span data-ttu-id="9737d-146">Nenhuma verificação de integridade do Service Fabric é executada.</span><span class="sxs-lookup"><span data-stu-id="9737d-146">No Service Fabric health checks are performed.</span></span> <span data-ttu-id="9737d-147">O administrador executa as verificações de integridade ou de status antes de iniciar a atualização no próximo domínio de atualização.</span><span class="sxs-lookup"><span data-stu-id="9737d-147">The administrator performs the health or status checks before starting the upgrade in the next update domain.</span></span>

## <a name="upgrade-default-services"></a><span data-ttu-id="9737d-148">Fazer upgrade dos serviços padrão</span><span class="sxs-lookup"><span data-stu-id="9737d-148">Upgrade default services</span></span>
<span data-ttu-id="9737d-149">Os serviços padrão no aplicativo Service Fabric podem ser atualizados durante o processo de upgrade de um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="9737d-149">Default services within Service Fabric application can be upgraded during the upgrade process of an application.</span></span> <span data-ttu-id="9737d-150">Os serviços padrão são definidos no [manifesto do aplicativo](service-fabric-application-model.md#describe-an-application).</span><span class="sxs-lookup"><span data-stu-id="9737d-150">Default services are defined in the [application manifest](service-fabric-application-model.md#describe-an-application).</span></span> <span data-ttu-id="9737d-151">As regras padrão de upgrade dos serviços padrão são:</span><span class="sxs-lookup"><span data-stu-id="9737d-151">The standard rules of upgrading default services are:</span></span>

1. <span data-ttu-id="9737d-152">Os serviços padrão no novo [manifesto do aplicativo](service-fabric-application-model.md#describe-an-application) que não existem no cluster são criados.</span><span class="sxs-lookup"><span data-stu-id="9737d-152">Default services in the new [application manifest](service-fabric-application-model.md#describe-an-application) that do not exist in the cluster are created.</span></span>
> [!TIP]
> <span data-ttu-id="9737d-153">[EnableDefaultServicesUpgrade](service-fabric-cluster-fabric-settings.md#fabric-settings-that-you-can-customize) precisa ser definido como true para habilitar as regras a seguir.</span><span class="sxs-lookup"><span data-stu-id="9737d-153">[EnableDefaultServicesUpgrade](service-fabric-cluster-fabric-settings.md#fabric-settings-that-you-can-customize) needs to be set to true to enable the following rules.</span></span> <span data-ttu-id="9737d-154">Esse recurso é compatível com a v5.5.</span><span class="sxs-lookup"><span data-stu-id="9737d-154">This feature is supported from v5.5.</span></span>

2. <span data-ttu-id="9737d-155">Os serviços padrão existentes no [manifesto do aplicativo](service-fabric-application-model.md#describe-an-application) anterior e na nova versão são atualizados.</span><span class="sxs-lookup"><span data-stu-id="9737d-155">Default services existing in both previous [application manifest](service-fabric-application-model.md#describe-an-application) and new version are updated.</span></span> <span data-ttu-id="9737d-156">As descrições de serviço na nova versão substituem aquelas que já estão no cluster.</span><span class="sxs-lookup"><span data-stu-id="9737d-156">Service descriptions in the new version would overwrite those already in the cluster.</span></span> <span data-ttu-id="9737d-157">A atualização do aplicativo é revertida automaticamente na falha de atualização do serviço padrão.</span><span class="sxs-lookup"><span data-stu-id="9737d-157">Application upgrade would rollback automatically upon updating default service failure.</span></span>
3. <span data-ttu-id="9737d-158">Os serviços padrão no [manifesto do aplicativo](service-fabric-application-model.md#describe-an-application) anterior, mas não na nova versão, são excluídos.</span><span class="sxs-lookup"><span data-stu-id="9737d-158">Default services in the previous [application manifest](service-fabric-application-model.md#describe-an-application) but not in the new version are deleted.</span></span> <span data-ttu-id="9737d-159">**Observe que essa exclusão de serviços padrão não pode ser revertida.**</span><span class="sxs-lookup"><span data-stu-id="9737d-159">**Note that this deleting default services can not be reverted.**</span></span>

<span data-ttu-id="9737d-160">Caso o upgrade de um aplicativo seja revertido, os serviços padrão serão revertidos para o status antes do início do upgrade.</span><span class="sxs-lookup"><span data-stu-id="9737d-160">In case of an application upgrade is rolled back, default services are reverted to the status before upgrade started.</span></span> <span data-ttu-id="9737d-161">Mas os serviços excluídos nunca poderão ser criados.</span><span class="sxs-lookup"><span data-stu-id="9737d-161">But deleted services can never be created.</span></span>

## <a name="application-upgrade-flowchart"></a><span data-ttu-id="9737d-162">Fluxograma de atualização de aplicativo</span><span class="sxs-lookup"><span data-stu-id="9737d-162">Application upgrade flowchart</span></span>
<span data-ttu-id="9737d-163">O fluxograma após este parágrafo pode ajudar na compreensão do processo de atualização de um aplicativo do Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="9737d-163">The flowchart following this paragraph can help you understand the upgrade process of a Service Fabric application.</span></span> <span data-ttu-id="9737d-164">Mais especificamente, o fluxo descreve como os tempos limite, incluindo *HealthCheckStableDuration*, *HealthCheckRetryTimeout* e *UpgradeHealthCheckInterval*, ajudam a controlar quando a atualização em um domínio de atualização é considerada um êxito ou falha.</span><span class="sxs-lookup"><span data-stu-id="9737d-164">In particular, the flow describes how the time-outs, including *HealthCheckStableDuration*, *HealthCheckRetryTimeout*, and *UpgradeHealthCheckInterval*, help control when the upgrade in one update domain is considered a success or a failure.</span></span>

![O processo de atualização de um aplicativo a Malha do Serviço][image]

## <a name="next-steps"></a><span data-ttu-id="9737d-166">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="9737d-166">Next steps</span></span>
<span data-ttu-id="9737d-167">[Atualização do aplicativo usando o Visual Studio](service-fabric-application-upgrade-tutorial.md) orienta você durante a atualização de aplicativo usando o Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="9737d-167">[Upgrading your Application Using Visual Studio](service-fabric-application-upgrade-tutorial.md) walks you through an application upgrade using Visual Studio.</span></span>

<span data-ttu-id="9737d-168">[Atualização do aplicativo usando o PowerShell](service-fabric-application-upgrade-tutorial-powershell.md) orienta você uma atualização de aplicativo usando o PowerShell.</span><span class="sxs-lookup"><span data-stu-id="9737d-168">[Upgrading your Application Using Powershell](service-fabric-application-upgrade-tutorial-powershell.md) walks you through an application upgrade using PowerShell.</span></span>

<span data-ttu-id="9737d-169">Controle como seu aplicativo é atualizado usando [Parâmetros de Atualização](service-fabric-application-upgrade-parameters.md).</span><span class="sxs-lookup"><span data-stu-id="9737d-169">Control how your application upgrades by using [Upgrade Parameters](service-fabric-application-upgrade-parameters.md).</span></span>

<span data-ttu-id="9737d-170">Torne suas atualizações de aplicativo compatíveis aprendendo a usar a [Serialização de Dados](service-fabric-application-upgrade-data-serialization.md).</span><span class="sxs-lookup"><span data-stu-id="9737d-170">Make your application upgrades compatible by learning how to use [Data Serialization](service-fabric-application-upgrade-data-serialization.md).</span></span>

<span data-ttu-id="9737d-171">Saiba como usar a funcionalidade avançada ao atualizar seu aplicativo consultando os [Tópicos avançados](service-fabric-application-upgrade-advanced.md).</span><span class="sxs-lookup"><span data-stu-id="9737d-171">Learn how to use advanced functionality while upgrading your application by referring to [Advanced Topics](service-fabric-application-upgrade-advanced.md).</span></span>

<span data-ttu-id="9737d-172">Corrija problemas comuns em atualizações de aplicativo consultando as etapas em [Solução de problemas de atualizações de aplicativo](service-fabric-application-upgrade-troubleshooting.md).</span><span class="sxs-lookup"><span data-stu-id="9737d-172">Fix common problems in application upgrades by referring to the steps in [Troubleshooting Application Upgrades](service-fabric-application-upgrade-troubleshooting.md).</span></span>

[image]: media/service-fabric-application-upgrade/service-fabric-application-upgrade-flowchart.png
