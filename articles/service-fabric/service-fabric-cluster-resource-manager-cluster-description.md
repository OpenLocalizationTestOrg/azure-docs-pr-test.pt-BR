---
title: "Descrição de cluster do Gerenciador de Recursos de Cluster | Microsoft Docs"
description: "Descrever um cluster do Service Fabric especificando domínios de falha, domínios de atualização, propriedades de nó e capacidades de nó para o Gerenciador de Recursos de Cluster."
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: 55f8ab37-9399-4c9a-9e6c-d2d859de6766
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: e517eda4d3ff7ad81998003688c3cca78f76e179
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/29/2017
---
# <a name="describing-a-service-fabric-cluster"></a><span data-ttu-id="534de-103">Descrevendo um cluster do Service Fabric</span><span class="sxs-lookup"><span data-stu-id="534de-103">Describing a service fabric cluster</span></span>
<span data-ttu-id="534de-104">O Gerenciador de Recursos de Cluster do Service Fabric fornece vários mecanismos para descrever um cluster.</span><span class="sxs-lookup"><span data-stu-id="534de-104">The Service Fabric Cluster Resource Manager provides several mechanisms for describing a cluster.</span></span> <span data-ttu-id="534de-105">Durante o tempo de execução, o Cluster Resource Manager usa essas informações para garantir a alta disponibilidade dos serviços executados no cluster.</span><span class="sxs-lookup"><span data-stu-id="534de-105">During runtime, the Cluster Resource Manager uses this information to ensure high availability of the services running in the cluster.</span></span> <span data-ttu-id="534de-106">Ao aplicar essas regras importantes, ele também tenta otimizar o consumo de recursos dentro do cluster.</span><span class="sxs-lookup"><span data-stu-id="534de-106">While enforcing these important rules, it also attempts to optimize the resource consumption within the cluster.</span></span>

## <a name="key-concepts"></a><span data-ttu-id="534de-107">Principais conceitos</span><span class="sxs-lookup"><span data-stu-id="534de-107">Key concepts</span></span>
<span data-ttu-id="534de-108">Os recursos do Gerenciador de Recursos de Cluster oferecem suporte a vários recursos que descrevem um cluster:</span><span class="sxs-lookup"><span data-stu-id="534de-108">The Cluster Resource Manager supports several features that describe a cluster:</span></span>

* <span data-ttu-id="534de-109">Domínios de falha</span><span class="sxs-lookup"><span data-stu-id="534de-109">Fault Domains</span></span>
* <span data-ttu-id="534de-110">Domínios de atualização</span><span class="sxs-lookup"><span data-stu-id="534de-110">Upgrade Domains</span></span>
* <span data-ttu-id="534de-111">Propriedades de nó</span><span class="sxs-lookup"><span data-stu-id="534de-111">Node Properties</span></span>
* <span data-ttu-id="534de-112">Capacidades de nó</span><span class="sxs-lookup"><span data-stu-id="534de-112">Node Capacities</span></span>

## <a name="fault-domains"></a><span data-ttu-id="534de-113">Domínios de falha</span><span class="sxs-lookup"><span data-stu-id="534de-113">Fault domains</span></span>
<span data-ttu-id="534de-114">Um domínio de falha é qualquer área da falha coordenada.</span><span class="sxs-lookup"><span data-stu-id="534de-114">A Fault Domain is any area of coordinated failure.</span></span> <span data-ttu-id="534de-115">Um único computador é um domínio de falha (já que ele pode falhar sozinho por vários motivos diferentes, desde falhas de fornecimento de energia até falhas de unidade devido a firmware NIC inválido).</span><span class="sxs-lookup"><span data-stu-id="534de-115">A single machine is a Fault Domain (since it can fail on its own for various reasons, from power supply failures to drive failures to bad NIC firmware).</span></span> <span data-ttu-id="534de-116">Computadores conectados ao mesmo comutador Ethernet estão no mesmo domínio de falha, assim como computadores que compartilham uma única fonte de alimentação ou em um único local.</span><span class="sxs-lookup"><span data-stu-id="534de-116">Machines connected to the same Ethernet switch are in the same Fault Domain, as are machines sharing a single source of power or in a single location.</span></span> <span data-ttu-id="534de-117">Uma vez que é natural que essas falhas de hardware se sobreponham, os domínios de falha são hierárquicos por natureza e são representados como URIs no Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="534de-117">Since it's natural for hardware faults to overlap, Fault Domains are inherently hierarchal and are represented as URIs in Service Fabric.</span></span>

<span data-ttu-id="534de-118">É importante que os domínios de falha sejam definidos corretamente uma vez que o Service Fabric usa essas informações para posicionar os serviços com segurança.</span><span class="sxs-lookup"><span data-stu-id="534de-118">It is important that Fault Domains are set up correctly since Service Fabric uses this information to safely place services.</span></span> <span data-ttu-id="534de-119">O Service Fabric não quer posicionar os serviços de modo que a perda de um domínio de falha (causada pela falha de algum componente) faça com que os serviços fiquem inativos.</span><span class="sxs-lookup"><span data-stu-id="534de-119">Service Fabric doesn't want to place services such that the loss of a Fault Domain (caused by the failure of some component) causes a service to go down.</span></span> <span data-ttu-id="534de-120">No ambiente do Azure, o Service Fabric usa as informações do domínio de falha fornecidas pelo ambiente para configurar corretamente os nós no cluster em seu nome.</span><span class="sxs-lookup"><span data-stu-id="534de-120">In the Azure environment Service Fabric uses the Fault Domain information provided by the environment to correctly configure the nodes in the cluster on your behalf.</span></span> <span data-ttu-id="534de-121">Para o Service Fabric Autônomo, os Domínios de Falha são definidos no momento em que o cluster é configurado</span><span class="sxs-lookup"><span data-stu-id="534de-121">For Service Fabric Standalone, Fault Domains are defined at the time that the cluster is set up</span></span> 

> [!WARNING]
> <span data-ttu-id="534de-122">É importante que as informações de domínio de falha fornecidas ao Service Fabric sejam precisas.</span><span class="sxs-lookup"><span data-stu-id="534de-122">It is important that the Fault Domain information provided to Service Fabric is accurate.</span></span> <span data-ttu-id="534de-123">Por exemplo, digamos que nós do cluster do Service Fabric estejam em execução dentro de dez máquinas virtuais que são executadas em cinco hosts físicos.</span><span class="sxs-lookup"><span data-stu-id="534de-123">For example, let's say that your Service Fabric cluster's nodes are running inside 10 virtual machines, running on five physical hosts.</span></span> <span data-ttu-id="534de-124">Nesse caso, mesmo que haja dez máquinas virtuais, há apenas cinco domínios de falha (de nível superior) diferentes.</span><span class="sxs-lookup"><span data-stu-id="534de-124">In this case, even though there are 10 virtual machines, there's only 5 different (top level) fault domains.</span></span> <span data-ttu-id="534de-125">Compartilhar o mesmo host físico faz com que as VMs compartilhem o mesmo domínio de falha raiz, uma vez que as VMs apresentarão falhas coordenadas se seu host físico falhar.</span><span class="sxs-lookup"><span data-stu-id="534de-125">Sharing the same physical host causes VMs to share the same root fault domain, since the VMs experience coordinated failure if their physical host fails.</span></span>  
>
> <span data-ttu-id="534de-126">O Service Fabric espera que o domínio de falha de um nó não seja alterado.</span><span class="sxs-lookup"><span data-stu-id="534de-126">Since Service Fabric expects the Fault Domain of a node not to change.</span></span> <span data-ttu-id="534de-127">Outros mecanismos para garantir a alta disponibilidade das VMs, como [HA-VMs](https://technet.microsoft.com/en-us/library/cc967323.aspx), usam a migração transparente de VMs de um host para outro.</span><span class="sxs-lookup"><span data-stu-id="534de-127">Other mechanisms of ensuring high availability of the VMs, such as [HA-VMs](https://technet.microsoft.com/en-us/library/cc967323.aspx), use transparent migration of VMs from one host to another.</span></span> <span data-ttu-id="534de-128">Esses mecanismos não reconfiguram ou notificam o código em execução dentro da VM.</span><span class="sxs-lookup"><span data-stu-id="534de-128">These mechanisms do not reconfigure or notify the running code inside the VM.</span></span> <span data-ttu-id="534de-129">Sendo assim, eles **não têm suporte** como ambientes para executar clusters do Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="534de-129">As such, they are **not supported** as environments for running Service Fabric clusters.</span></span> <span data-ttu-id="534de-130">O Service Fabric deve ser a única tecnologia de alta disponibilidade empregada.</span><span class="sxs-lookup"><span data-stu-id="534de-130">Service Fabric should be the only high-availability technology employed.</span></span> <span data-ttu-id="534de-131">Mecanismos como migração dinâmica de VMs e SANs, entre outros, não são necessários.</span><span class="sxs-lookup"><span data-stu-id="534de-131">Mechanisms like live VM migration, SANs, or others are not necessary.</span></span> <span data-ttu-id="534de-132">Se usados em conjunto com o Service Fabric, esses mecanismos _reduzem_ a confiabilidade e a disponibilidade dos aplicativos, pois eles introduzem complexidade adicional, adicionam fontes de falha centralizadas e utilizam estratégias de disponibilidade e confiabilidade que entram em conflito com aquelas em vigor no Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="534de-132">If used in conjunction with Service Fabric, these mechanisms _reduce_ application availability and reliability because they introduce additional complexity, add centralized sources of failure, and utilize reliability and availability strategies that conflict with those in Service Fabric.</span></span> 
>
>

<span data-ttu-id="534de-133">Na imagem abaixo, colorimos todas as entidades que contribuem para os domínios de falha e listamos todos os diferentes domínios de falha resultantes.</span><span class="sxs-lookup"><span data-stu-id="534de-133">In the graphic below we color all the entities that contribute to Fault Domains and list all the different Fault Domains that result.</span></span> <span data-ttu-id="534de-134">Neste exemplo, temos datacenters (“DC”), racks (“R”) e folhas (“B”).</span><span class="sxs-lookup"><span data-stu-id="534de-134">In this example, we have datacenters ("DC"), racks ("R"), and blades ("B").</span></span> <span data-ttu-id="534de-135">Em termos conceituais, se cada folha contém mais de uma máquina virtual, pode haver outra camada na hierarquia de domínios de falha.</span><span class="sxs-lookup"><span data-stu-id="534de-135">Conceivably, if each blade holds more than one virtual machine, there could be another layer in the Fault Domain hierarchy.</span></span>

<span data-ttu-id="534de-136"><center>
![Nós organizados por meio de domínios de falha][Image1]
</center></span><span class="sxs-lookup"><span data-stu-id="534de-136"><center>
![Nodes organized via Fault Domains][Image1]
</center></span></span>

<span data-ttu-id="534de-137">Durante o tempo de execução, o Gerenciador de Recursos de Cluster do Service Fabric leva em consideração os domínios de falha no cluster e planeja layouts.</span><span class="sxs-lookup"><span data-stu-id="534de-137">During runtime, the Service Fabric Cluster Resource Manager considers the Fault Domains in the cluster and plans layouts.</span></span> <span data-ttu-id="534de-138">As réplicas com estado ou instâncias sem estado de um determinado serviço são distribuídas para que fiquem em domínios de falha separados.</span><span class="sxs-lookup"><span data-stu-id="534de-138">The stateful replicas or stateless instances for a given service are distributed so they are in separate Fault Domains.</span></span> <span data-ttu-id="534de-139">Distribuir o serviço entre domínios de falha garante que a disponibilidade do serviço não seja comprometida quando um domínio de falha falhar em qualquer nível da hierarquia.</span><span class="sxs-lookup"><span data-stu-id="534de-139">Distributing the service across fault domains ensures the availability of the service is not compromised when a Fault Domain fails at any level of the hierarchy.</span></span>

<span data-ttu-id="534de-140">O Cluster Resource Manager do Service Fabric não se importa com quantas camadas existem na hierarquia de domínio de falha.</span><span class="sxs-lookup"><span data-stu-id="534de-140">Service Fabric’s Cluster Resource Manager doesn’t care how many layers there are in the Fault Domain hierarchy.</span></span> <span data-ttu-id="534de-141">No entanto, ele tenta assegurar que a perda de qualquer parte da hierarquia não afete os serviços em execução nela.</span><span class="sxs-lookup"><span data-stu-id="534de-141">However, it tries to ensure that the loss of any one portion of the hierarchy doesn’t impact services running in it.</span></span> 

<span data-ttu-id="534de-142">É melhor se houver o mesmo número de nós em cada nível de profundidade na hierarquia de domínio de falha.</span><span class="sxs-lookup"><span data-stu-id="534de-142">It is best if there are the same number of nodes at each level of depth in the Fault Domain hierarchy.</span></span> <span data-ttu-id="534de-143">Se a "árvore" de domínios de falha estiver desequilibrada em seu cluster, será mais difícil para o Gerenciador de Recursos de Cluster calcular a melhor alocação dos serviços.</span><span class="sxs-lookup"><span data-stu-id="534de-143">If the “tree” of Fault Domains is unbalanced in your cluster, it makes it harder for the Cluster Resource Manager to figure out the best allocation of services.</span></span> <span data-ttu-id="534de-144">Layouts de domínios de falha desequilibrados significam que a perda de alguns domínios afeta a disponibilidade de serviços mais do que outros domínios.</span><span class="sxs-lookup"><span data-stu-id="534de-144">Imbalanced Fault Domains layouts mean that the loss of some domains impact the availability of services more than other domains.</span></span> <span data-ttu-id="534de-145">Como resultado, o Gerenciador de Recursos de Cluster fica dividido entre dois objetivos: ele quer usar os computadores nesse domínio “pesado” colocando serviços neles e quer posicionar serviços em outros domínios de forma que a perda de um domínio não cause problemas.</span><span class="sxs-lookup"><span data-stu-id="534de-145">As a result, the Cluster Resource Manager is torn between two goals: It wants to use the machines in that “heavy” domain by placing services on them, and it wants to place services in other domains so that the loss of a domain doesn’t cause problems.</span></span> 

<span data-ttu-id="534de-146">Qual é a aparência de um domínio desequilibrado?</span><span class="sxs-lookup"><span data-stu-id="534de-146">What do imbalanced domains look like?</span></span> <span data-ttu-id="534de-147">No diagrama abaixo, mostramos dois layouts de cluster diferentes.</span><span class="sxs-lookup"><span data-stu-id="534de-147">In the diagram below, we show two different cluster layouts.</span></span> <span data-ttu-id="534de-148">No primeiro exemplo, os nós estão distribuídos uniformemente entre os domínios de falha.</span><span class="sxs-lookup"><span data-stu-id="534de-148">In the first example, the nodes are distributed evenly across the Fault Domains.</span></span> <span data-ttu-id="534de-149">No segundo exemplo, um domínio de falha tem muito mais nós do que o outro.</span><span class="sxs-lookup"><span data-stu-id="534de-149">In the second example, one Fault Domain has many more nodes than the other Fault Domains.</span></span> 

<span data-ttu-id="534de-150"><center>
![Dois layouts de cluster diferentes][Image2]
</center></span><span class="sxs-lookup"><span data-stu-id="534de-150"><center>
![Two different cluster layouts][Image2]
</center></span></span>

<span data-ttu-id="534de-151">No Azure, a escolha de qual domínio de falha contém um nó é gerenciada por você.</span><span class="sxs-lookup"><span data-stu-id="534de-151">In Azure, the choice of which Fault Domain contains a node is managed for you.</span></span> <span data-ttu-id="534de-152">No entanto, dependendo do número de nós provisionados, você ainda pode ficar com domínios de falha com mais nós do que outros.</span><span class="sxs-lookup"><span data-stu-id="534de-152">However, depending on the number of nodes that you provision you can still end up with Fault Domains with more nodes in them than others.</span></span> <span data-ttu-id="534de-153">Por exemplo, digamos que você tenha cinco domínios de falha no cluster, mas provisione sete nós para um determinado NodeType.</span><span class="sxs-lookup"><span data-stu-id="534de-153">For example, say you have five Fault Domains in the cluster but provision seven nodes for a given NodeType.</span></span> <span data-ttu-id="534de-154">Nesse caso, os dois primeiros domínios de falha ficam com mais nós.</span><span class="sxs-lookup"><span data-stu-id="534de-154">In this case, the first two Fault Domains end up with more nodes.</span></span> <span data-ttu-id="534de-155">Se você continuar a implantar mais NodeTypes com apenas algumas instâncias, o problema piorará.</span><span class="sxs-lookup"><span data-stu-id="534de-155">If you continue to deploy more NodeTypes with only a couple instances, the problem gets worse.</span></span> <span data-ttu-id="534de-156">Por esse motivo, recomenda-se que o número de nós em cada tipo de nó seja um múltiplo do número de domínios de falha.</span><span class="sxs-lookup"><span data-stu-id="534de-156">For this reason it's recommended that the number of nodes in each node type is a multiple of the number of Fault Domains.</span></span>

## <a name="upgrade-domains"></a><span data-ttu-id="534de-157">Domínios de atualização</span><span class="sxs-lookup"><span data-stu-id="534de-157">Upgrade domains</span></span>
<span data-ttu-id="534de-158">Domínios de atualização são outro recurso que ajuda o Gerenciador de Recursos de Cluster do Service Fabric a entender o layout do cluster.</span><span class="sxs-lookup"><span data-stu-id="534de-158">Upgrade Domains are another feature that helps the Service Fabric Cluster Resource Manager understand the layout of the cluster.</span></span> <span data-ttu-id="534de-159">Os domínios de atualização definem conjuntos de nós que são atualizados ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="534de-159">Upgrade Domains define sets of nodes that are upgraded at the same time.</span></span> <span data-ttu-id="534de-160">Domínios de atualização ajudam o Gerenciador de Recursos de Cluster a entender e coordenar operações de gerenciamento, como atualizações.</span><span class="sxs-lookup"><span data-stu-id="534de-160">Upgrade Domains help the Cluster Resource Manager understand and orchestrate management operations like upgrades.</span></span>

<span data-ttu-id="534de-161">Os Domínios de Atualização são muito semelhantes aos Domínios de Falha, mas com algumas diferenças importantes.</span><span class="sxs-lookup"><span data-stu-id="534de-161">Upgrade Domains are a lot like Fault Domains, but with a couple key differences.</span></span> <span data-ttu-id="534de-162">Primeiro, as áreas de falhas de hardware coordenadas definem os domínios de falha.</span><span class="sxs-lookup"><span data-stu-id="534de-162">First, areas of coordinated hardware failures define Fault Domains.</span></span> <span data-ttu-id="534de-163">Os domínios de atualização, por outro lado, são definidos pela política.</span><span class="sxs-lookup"><span data-stu-id="534de-163">Upgrade Domains, on the other hand, are defined by policy.</span></span> <span data-ttu-id="534de-164">Você pode decidir quantos domínios deseja, em vez disso ser determinado pelo ambiente.</span><span class="sxs-lookup"><span data-stu-id="534de-164">You get to decide how many you want, rather than it being dictated by the environment.</span></span> <span data-ttu-id="534de-165">Você pode ter tantos domínios de atualização quantos forem o número de nós.</span><span class="sxs-lookup"><span data-stu-id="534de-165">You could have as many Upgrade Domains as you do nodes.</span></span> <span data-ttu-id="534de-166">Outra diferença entre domínios de falha e domínios de atualização é que os domínios de atualização não são hierárquicos.</span><span class="sxs-lookup"><span data-stu-id="534de-166">Another difference between Fault Domains and Upgrade Domains is that Upgrade Domains are not hierarchical.</span></span> <span data-ttu-id="534de-167">Em vez disso, eles são mais parecidos com uma marca simples.</span><span class="sxs-lookup"><span data-stu-id="534de-167">Instead, they are more like a simple tag.</span></span> 

<span data-ttu-id="534de-168">O diagrama a seguir mostra que três domínios de atualização são distribuídos em três domínios de falha.</span><span class="sxs-lookup"><span data-stu-id="534de-168">The following diagram shows three Upgrade Domains are striped across three Fault Domains.</span></span> <span data-ttu-id="534de-169">Ele também mostra um possível posicionamento para três réplicas diferentes de um serviço com estado, em que cada um fica em domínios de atualização e de falha diferentes.</span><span class="sxs-lookup"><span data-stu-id="534de-169">It also shows one possible placement for three different replicas of a stateful service, where each ends up in different Fault and Upgrade Domains.</span></span> <span data-ttu-id="534de-170">Esse posicionamento permite perder um domínio de falha durante uma atualização de serviço e ainda ter uma cópia dos códigos e dos dados.</span><span class="sxs-lookup"><span data-stu-id="534de-170">This placement allows the loss of a Fault Domain while in the middle of a service upgrade and still have one copy of the code and data.</span></span>  

<span data-ttu-id="534de-171"><center>
![Posicionamento com domínios de falha e atualização][Image3]
</center></span><span class="sxs-lookup"><span data-stu-id="534de-171"><center>
![Placement With Fault and Upgrade Domains][Image3]
</center></span></span>

<span data-ttu-id="534de-172">Há prós e contras em relação a ter um grande número de domínios de atualização.</span><span class="sxs-lookup"><span data-stu-id="534de-172">There are pros and cons to having large numbers of Upgrade Domains.</span></span> <span data-ttu-id="534de-173">Ter mais domínios de atualização significa que cada etapa da atualização é mais granular e, assim, afeta um número menor de nós ou serviços.</span><span class="sxs-lookup"><span data-stu-id="534de-173">More Upgrade Domains means each step of the upgrade is more granular and therefore affects a smaller number of nodes or services.</span></span> <span data-ttu-id="534de-174">Como resultado, menos serviços precisam ser movidos de cada vez, introduzindo menos variação no sistema.</span><span class="sxs-lookup"><span data-stu-id="534de-174">As a result, fewer services have to move at a time, introducing less churn into the system.</span></span> <span data-ttu-id="534de-175">Isso tende a aumentar a confiabilidade, uma vez que uma parte menor do serviço é afetada por qualquer problema introduzido durante a atualização.</span><span class="sxs-lookup"><span data-stu-id="534de-175">This tends to improve reliability, since less of the service is impacted by any issue introduced during the upgrade.</span></span> <span data-ttu-id="534de-176">Ter mais domínios de atualização também significa que você precisa de menos buffer disponível em outros nós para lidar com o impacto da atualização.</span><span class="sxs-lookup"><span data-stu-id="534de-176">More Upgrade Domains also means that you need less available buffer on other nodes to handle the impact of the upgrade.</span></span> <span data-ttu-id="534de-177">Por exemplo, se você tiver cinco domínios de atualização, os nós em cada um estarão lidando com aproximadamente 20% do tráfego.</span><span class="sxs-lookup"><span data-stu-id="534de-177">For example, if you have five Upgrade Domains, the nodes in each are handling roughly 20% of your traffic.</span></span> <span data-ttu-id="534de-178">Se você precisar desativar esse domínio de atualização para uma atualização, essa carga normalmente precisará ir para algum lugar.</span><span class="sxs-lookup"><span data-stu-id="534de-178">If you need to take down that Upgrade Domain for an upgrade, that load usually needs to go somewhere.</span></span> <span data-ttu-id="534de-179">Como você tem quatro domínios de atualização restantes, cada um deles deve ter espaço para cerca de 5% do tráfego total.</span><span class="sxs-lookup"><span data-stu-id="534de-179">Since you have four remaining Upgrade Domains, each must have room for about 5% of the total traffic.</span></span> <span data-ttu-id="534de-180">Ter mais domínios de atualização significa que você precisa de menos buffer nos nós do cluster.</span><span class="sxs-lookup"><span data-stu-id="534de-180">More Upgrade Domains means you need less buffer on the nodes in the cluster.</span></span> <span data-ttu-id="534de-181">Por exemplo, imagine que você tivesse 10 domínios de atualização.</span><span class="sxs-lookup"><span data-stu-id="534de-181">For example, consider if you had 10 Upgrade Domains instead.</span></span> <span data-ttu-id="534de-182">Nesse caso, cada um deles lidaria com apenas cerca de 10% do tráfego total.</span><span class="sxs-lookup"><span data-stu-id="534de-182">In that case, each UD would only be handling about 10% of the total traffic.</span></span> <span data-ttu-id="534de-183">Quando uma atualização percorresse o cluster, cada domínio só precisaria ter espaço para aproximadamente 1,1% do tráfego total.</span><span class="sxs-lookup"><span data-stu-id="534de-183">When an upgrade steps through the cluster, each domain would only need to have room for about 1.1% of the total traffic.</span></span> <span data-ttu-id="534de-184">Ter mais domínios de atualização geralmente permite que você execute seus nós com um nível maior de utilização, uma vez que você precisa ter uma capacidade menor reservada.</span><span class="sxs-lookup"><span data-stu-id="534de-184">More Upgrade Domains generally allow you to run your nodes at higher utilization, since you need less reserved capacity.</span></span> <span data-ttu-id="534de-185">O mesmo vale para domínios de falha.</span><span class="sxs-lookup"><span data-stu-id="534de-185">The same is true for Fault Domains.</span></span>  

<span data-ttu-id="534de-186">A desvantagem de ter vários domínios de atualização é que as atualizações tendem a levar mais tempo.</span><span class="sxs-lookup"><span data-stu-id="534de-186">The downside of having many Upgrade Domains is that upgrades tend to take longer.</span></span> <span data-ttu-id="534de-187">O Service Fabric espera por um curto período após um domínio de atualização ser concluído e executa verificações antes de começar a atualizar o domínio seguinte.</span><span class="sxs-lookup"><span data-stu-id="534de-187">Service Fabric waits a short period of time after an Upgrade Domain is completed and performs checks before starting to upgrade the next one.</span></span> <span data-ttu-id="534de-188">Esses atrasos permitem detectar problemas introduzidos pela atualização antes que ela continue.</span><span class="sxs-lookup"><span data-stu-id="534de-188">These delays enable detecting issues introduced by the upgrade before the upgrade proceeds.</span></span> <span data-ttu-id="534de-189">Essa compensação é aceitável, pois isso evita que alterações incorretas afetem grande parte do serviço de uma só vez.</span><span class="sxs-lookup"><span data-stu-id="534de-189">The tradeoff is acceptable because it prevents bad changes from affecting too much of the service at a time.</span></span>

<span data-ttu-id="534de-190">Ter um número muito reduzido de domínios de atualização tem muitos efeitos negativos – enquanto cada domínio de atualização individual fica inoperante e é atualizado, uma grande parte de sua capacidade geral fica indisponível.</span><span class="sxs-lookup"><span data-stu-id="534de-190">Too few Upgrade Domains has many negative side effects – while each individual Upgrade Domain is down and being upgraded a large portion of your overall capacity is unavailable.</span></span> <span data-ttu-id="534de-191">Por exemplo, se tiver apenas três domínios de atualização, você desativará cerca de um terço de sua capacidade geral de serviço ou de cluster de uma vez.</span><span class="sxs-lookup"><span data-stu-id="534de-191">For example, if you only have three Upgrade Domains you are taking down about 1/3 of your overall service or cluster capacity at a time.</span></span> <span data-ttu-id="534de-192">Ter uma parte tão grande do seu serviço inoperante ao mesmo tempo não é desejável, uma vez que é necessário ter capacidade suficiente no restante do cluster para lidar com a carga de trabalho.</span><span class="sxs-lookup"><span data-stu-id="534de-192">Having so much of your service down at once isn’t desirable since you have to have enough capacity in the rest of your cluster to handle the workload.</span></span> <span data-ttu-id="534de-193">Manter esse buffer significa que, durante a operação normal, esses nós ficam menos carregados do que ficariam em caso contrário.</span><span class="sxs-lookup"><span data-stu-id="534de-193">Maintaining that buffer means that during normal operation those nodes are less loaded than they would be otherwise.</span></span> <span data-ttu-id="534de-194">Isso aumenta o custo de execução de seu serviço.</span><span class="sxs-lookup"><span data-stu-id="534de-194">This increases the cost of running your service.</span></span>

<span data-ttu-id="534de-195">Não há um limite real para o número total de domínios de falha ou de atualização em um ambiente nem restrições sobre como eles se sobrepõem.</span><span class="sxs-lookup"><span data-stu-id="534de-195">There’s no real limit to the total number of fault or Upgrade Domains in an environment, or constraints on how they overlap.</span></span> <span data-ttu-id="534de-196">Dito isso, há vários padrões comuns:</span><span class="sxs-lookup"><span data-stu-id="534de-196">That said, there are several common patterns:</span></span>

- <span data-ttu-id="534de-197">Domínios de falha e domínios de atualização mapeados 1:1</span><span class="sxs-lookup"><span data-stu-id="534de-197">Fault Domains and Upgrade Domains mapped 1:1</span></span>
- <span data-ttu-id="534de-198">Um domínio de atualização por nó (instância de sistema operacional física ou virtual)</span><span class="sxs-lookup"><span data-stu-id="534de-198">One Upgrade Domain per Node (physical or virtual OS instance)</span></span>
- <span data-ttu-id="534de-199">Um modelo "distribuído" ou de "matriz" em que os domínios de falha e os domínios de atualização formam uma matriz em que os computadores geralmente são executados diagonalmente</span><span class="sxs-lookup"><span data-stu-id="534de-199">A “striped” or “matrix” model where the Fault Domains and Upgrade Domains form a matrix with machines usually running down the diagonals</span></span>

<span data-ttu-id="534de-200"><center>
![Layouts de domínios de falha e de atualização][Image4]
</center></span><span class="sxs-lookup"><span data-stu-id="534de-200"><center>
![Fault and Upgrade Domain Layouts][Image4]
</center></span></span>

<span data-ttu-id="534de-201">Não existe uma solução ideal sobre qual layout deve ser escolhido. Cada um deles tem prós e contras.</span><span class="sxs-lookup"><span data-stu-id="534de-201">There’s no best answer which layout to choose, each has some pros and cons.</span></span> <span data-ttu-id="534de-202">Por exemplo, o modelo de 1FD:1UD é simples de configurar.</span><span class="sxs-lookup"><span data-stu-id="534de-202">For example, the 1FD:1UD model is simple to set up.</span></span> <span data-ttu-id="534de-203">O modelo de um domínio de atualização por nó é mais parecido com o modelo a que a maioria das pessoas estão acostumadas.</span><span class="sxs-lookup"><span data-stu-id="534de-203">The 1 Upgrade Domain per Node model is most like what people are used to.</span></span> <span data-ttu-id="534de-204">Durante atualizações, cada nó é atualizado de forma independente.</span><span class="sxs-lookup"><span data-stu-id="534de-204">During upgrades each node is updated independently.</span></span> <span data-ttu-id="534de-205">Isso é semelhante à forma como pequenos conjuntos de computadores eram atualizados manualmente no passado.</span><span class="sxs-lookup"><span data-stu-id="534de-205">This is similar to how small sets of machines were upgraded manually in the past.</span></span> 

<span data-ttu-id="534de-206">O modelo mais comum é a matriz de FD/UD, em que os FDs e os UDs formam uma tabela e os nós são posicionados começando ao longo da diagonal.</span><span class="sxs-lookup"><span data-stu-id="534de-206">The most common model is the FD/UD matrix, where the FDs and UDs form a table and nodes are placed starting along the diagonal.</span></span> <span data-ttu-id="534de-207">Esse é o modelo usado por padrão nos clusters do Service Fabric no Azure.</span><span class="sxs-lookup"><span data-stu-id="534de-207">This is the model used by default in Service Fabric clusters in Azure.</span></span> <span data-ttu-id="534de-208">Para clusters com muitos nós, tudo acaba ficando parecido com o padrão de matriz denso acima.</span><span class="sxs-lookup"><span data-stu-id="534de-208">For clusters with many nodes everything ends up looking like the dense matrix pattern above.</span></span>

## <a name="fault-and-upgrade-domain-constraints-and-resulting-behavior"></a><span data-ttu-id="534de-209">Restrições de domínio de falha e de atualização e o comportamento resultante</span><span class="sxs-lookup"><span data-stu-id="534de-209">Fault and Upgrade Domain constraints and resulting behavior</span></span>
<span data-ttu-id="534de-210">O Cluster Resource Manager trata o desejo de manter um serviço balanceado entre domínios de falha e de atualização como uma restrição.</span><span class="sxs-lookup"><span data-stu-id="534de-210">The Cluster Resource Manager treats the desire to keep a service balanced across fault and Upgrade Domains as a constraint.</span></span> <span data-ttu-id="534de-211">Você pode encontrar mais informações sobre restrições [neste artigo](service-fabric-cluster-resource-manager-management-integration.md).</span><span class="sxs-lookup"><span data-stu-id="534de-211">You can find out more about constraints in [this article](service-fabric-cluster-resource-manager-management-integration.md).</span></span> <span data-ttu-id="534de-212">O estado das restrições do domínio de falha e de atualização: “para uma partição de serviço específica, nunca deverá haver uma diferença *maior que um* no número de objetos de serviço (instâncias de serviço sem estado ou réplicas de serviço com estado) entre dois domínios”.</span><span class="sxs-lookup"><span data-stu-id="534de-212">The Fault and Upgrade Domain constraints state: "For a given service partition there should never be a difference *greater than one* in the number of service objects (stateless service instances or stateful service replicas) between two domains."</span></span> <span data-ttu-id="534de-213">Isso impede determinados movimentos ou disposições que violam essa restrição.</span><span class="sxs-lookup"><span data-stu-id="534de-213">This prevents certain moves or arrangements that violate this constraint.</span></span>

<span data-ttu-id="534de-214">Vejamos um exemplo.</span><span class="sxs-lookup"><span data-stu-id="534de-214">Let's look at one example.</span></span> <span data-ttu-id="534de-215">Digamos que temos um cluster com seis nós, configurados com cinco domínios de falha e cinco domínios de atualização.</span><span class="sxs-lookup"><span data-stu-id="534de-215">Let's say that we have a cluster with six nodes, configured with five Fault Domains and five Upgrade Domains.</span></span>

|  | <span data-ttu-id="534de-216">FD0</span><span class="sxs-lookup"><span data-stu-id="534de-216">FD0</span></span> | <span data-ttu-id="534de-217">FD1</span><span class="sxs-lookup"><span data-stu-id="534de-217">FD1</span></span> | <span data-ttu-id="534de-218">FD2</span><span class="sxs-lookup"><span data-stu-id="534de-218">FD2</span></span> | <span data-ttu-id="534de-219">FD3</span><span class="sxs-lookup"><span data-stu-id="534de-219">FD3</span></span> | <span data-ttu-id="534de-220">FD4</span><span class="sxs-lookup"><span data-stu-id="534de-220">FD4</span></span> |
| --- |:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="534de-221">**UD0**</span><span class="sxs-lookup"><span data-stu-id="534de-221">**UD0**</span></span> |<span data-ttu-id="534de-222">N1</span><span class="sxs-lookup"><span data-stu-id="534de-222">N1</span></span> | | | | |
| <span data-ttu-id="534de-223">**UD1**</span><span class="sxs-lookup"><span data-stu-id="534de-223">**UD1**</span></span> |<span data-ttu-id="534de-224">N6</span><span class="sxs-lookup"><span data-stu-id="534de-224">N6</span></span> |<span data-ttu-id="534de-225">N2</span><span class="sxs-lookup"><span data-stu-id="534de-225">N2</span></span> | | | |
| <span data-ttu-id="534de-226">**UD2**</span><span class="sxs-lookup"><span data-stu-id="534de-226">**UD2**</span></span> | | |<span data-ttu-id="534de-227">N3</span><span class="sxs-lookup"><span data-stu-id="534de-227">N3</span></span> | | |
| <span data-ttu-id="534de-228">**UD3**</span><span class="sxs-lookup"><span data-stu-id="534de-228">**UD3**</span></span> | | | |<span data-ttu-id="534de-229">N4</span><span class="sxs-lookup"><span data-stu-id="534de-229">N4</span></span> | |
| <span data-ttu-id="534de-230">**UD4**</span><span class="sxs-lookup"><span data-stu-id="534de-230">**UD4**</span></span> | | | | |<span data-ttu-id="534de-231">N5</span><span class="sxs-lookup"><span data-stu-id="534de-231">N5</span></span> |

<span data-ttu-id="534de-232">Agora, digamos que nós criemos um serviço com um TargetReplicaSetSize (ou, para um serviço sem estado, um InstanceCount) igual a cinco.</span><span class="sxs-lookup"><span data-stu-id="534de-232">Now let's say that we create a service with a TargetReplicaSetSize (or, for a stateless service an InstanceCount) of five.</span></span> <span data-ttu-id="534de-233">As réplicas recaem sobre N1 a N5.</span><span class="sxs-lookup"><span data-stu-id="534de-233">The replicas land on N1-N5.</span></span> <span data-ttu-id="534de-234">Na verdade, N6 nunca será usado, independentemente de quantos serviços como este você criar.</span><span class="sxs-lookup"><span data-stu-id="534de-234">In fact, N6 is never used no matter how many services like this you create.</span></span> <span data-ttu-id="534de-235">Mas por quê?</span><span class="sxs-lookup"><span data-stu-id="534de-235">But why?</span></span> <span data-ttu-id="534de-236">Vamos observar a diferença entre o layout atual e o que aconteceria se N6 fosse escolhido.</span><span class="sxs-lookup"><span data-stu-id="534de-236">Let's look at the difference between the current layout and what would happen if N6 is chosen.</span></span>

<span data-ttu-id="534de-237">Aqui está o nosso layout e o número total de réplicas por domínio de falha e de atualização:</span><span class="sxs-lookup"><span data-stu-id="534de-237">Here's the layout we got and the total number of replicas per Fault and Upgrade Domain:</span></span>

|  | <span data-ttu-id="534de-238">FD0</span><span class="sxs-lookup"><span data-stu-id="534de-238">FD0</span></span> | <span data-ttu-id="534de-239">FD1</span><span class="sxs-lookup"><span data-stu-id="534de-239">FD1</span></span> | <span data-ttu-id="534de-240">FD2</span><span class="sxs-lookup"><span data-stu-id="534de-240">FD2</span></span> | <span data-ttu-id="534de-241">FD3</span><span class="sxs-lookup"><span data-stu-id="534de-241">FD3</span></span> | <span data-ttu-id="534de-242">FD4</span><span class="sxs-lookup"><span data-stu-id="534de-242">FD4</span></span> | <span data-ttu-id="534de-243">UDTotal</span><span class="sxs-lookup"><span data-stu-id="534de-243">UDTotal</span></span> |
| --- |:---:|:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="534de-244">**UD0**</span><span class="sxs-lookup"><span data-stu-id="534de-244">**UD0**</span></span> |<span data-ttu-id="534de-245">R1</span><span class="sxs-lookup"><span data-stu-id="534de-245">R1</span></span> | | | | |<span data-ttu-id="534de-246">1</span><span class="sxs-lookup"><span data-stu-id="534de-246">1</span></span> |
| <span data-ttu-id="534de-247">**UD1**</span><span class="sxs-lookup"><span data-stu-id="534de-247">**UD1**</span></span> | |<span data-ttu-id="534de-248">R2</span><span class="sxs-lookup"><span data-stu-id="534de-248">R2</span></span> | | | |<span data-ttu-id="534de-249">1</span><span class="sxs-lookup"><span data-stu-id="534de-249">1</span></span> |
| <span data-ttu-id="534de-250">**UD2**</span><span class="sxs-lookup"><span data-stu-id="534de-250">**UD2**</span></span> | | |<span data-ttu-id="534de-251">R3</span><span class="sxs-lookup"><span data-stu-id="534de-251">R3</span></span> | | |<span data-ttu-id="534de-252">1</span><span class="sxs-lookup"><span data-stu-id="534de-252">1</span></span> |
| <span data-ttu-id="534de-253">**UD3**</span><span class="sxs-lookup"><span data-stu-id="534de-253">**UD3**</span></span> | | | |<span data-ttu-id="534de-254">R4</span><span class="sxs-lookup"><span data-stu-id="534de-254">R4</span></span> | |<span data-ttu-id="534de-255">1</span><span class="sxs-lookup"><span data-stu-id="534de-255">1</span></span> |
| <span data-ttu-id="534de-256">**UD4**</span><span class="sxs-lookup"><span data-stu-id="534de-256">**UD4**</span></span> | | | | |<span data-ttu-id="534de-257">R5</span><span class="sxs-lookup"><span data-stu-id="534de-257">R5</span></span> |<span data-ttu-id="534de-258">1</span><span class="sxs-lookup"><span data-stu-id="534de-258">1</span></span> |
| <span data-ttu-id="534de-259">**FDTotal**</span><span class="sxs-lookup"><span data-stu-id="534de-259">**FDTotal**</span></span> |<span data-ttu-id="534de-260">1</span><span class="sxs-lookup"><span data-stu-id="534de-260">1</span></span> |<span data-ttu-id="534de-261">1</span><span class="sxs-lookup"><span data-stu-id="534de-261">1</span></span> |<span data-ttu-id="534de-262">1</span><span class="sxs-lookup"><span data-stu-id="534de-262">1</span></span> |<span data-ttu-id="534de-263">1</span><span class="sxs-lookup"><span data-stu-id="534de-263">1</span></span> |<span data-ttu-id="534de-264">1</span><span class="sxs-lookup"><span data-stu-id="534de-264">1</span></span> |- |

<span data-ttu-id="534de-265">Este layout é balanceado em termos de nós por domínio de falha e domínio de atualização.</span><span class="sxs-lookup"><span data-stu-id="534de-265">This layout is balanced in terms of nodes per Fault Domain and Upgrade Domain.</span></span> <span data-ttu-id="534de-266">Ele também é balanceado em termos de número de réplicas por domínio de falha e de atualização.</span><span class="sxs-lookup"><span data-stu-id="534de-266">It is also balanced in terms of the number of replicas per Fault and Upgrade Domain.</span></span> <span data-ttu-id="534de-267">Cada domínio possui o mesmo número de nós e o mesmo número de réplicas.</span><span class="sxs-lookup"><span data-stu-id="534de-267">Each domain has the same number of nodes and the same number of replicas.</span></span>

<span data-ttu-id="534de-268">Agora, vamos ver o que aconteceria se tivéssemos usado N6 em vez de N2.</span><span class="sxs-lookup"><span data-stu-id="534de-268">Now, let's look at what would happen if we'd used N6 instead of N2.</span></span> <span data-ttu-id="534de-269">Como as réplicas seriam distribuídas?</span><span class="sxs-lookup"><span data-stu-id="534de-269">How would the replicas be distributed then?</span></span>

|  | <span data-ttu-id="534de-270">FD0</span><span class="sxs-lookup"><span data-stu-id="534de-270">FD0</span></span> | <span data-ttu-id="534de-271">FD1</span><span class="sxs-lookup"><span data-stu-id="534de-271">FD1</span></span> | <span data-ttu-id="534de-272">FD2</span><span class="sxs-lookup"><span data-stu-id="534de-272">FD2</span></span> | <span data-ttu-id="534de-273">FD3</span><span class="sxs-lookup"><span data-stu-id="534de-273">FD3</span></span> | <span data-ttu-id="534de-274">FD4</span><span class="sxs-lookup"><span data-stu-id="534de-274">FD4</span></span> | <span data-ttu-id="534de-275">UDTotal</span><span class="sxs-lookup"><span data-stu-id="534de-275">UDTotal</span></span> |
| --- |:---:|:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="534de-276">**UD0**</span><span class="sxs-lookup"><span data-stu-id="534de-276">**UD0**</span></span> |<span data-ttu-id="534de-277">R1</span><span class="sxs-lookup"><span data-stu-id="534de-277">R1</span></span> | | | | |<span data-ttu-id="534de-278">1</span><span class="sxs-lookup"><span data-stu-id="534de-278">1</span></span> |
| <span data-ttu-id="534de-279">**UD1**</span><span class="sxs-lookup"><span data-stu-id="534de-279">**UD1**</span></span> |<span data-ttu-id="534de-280">R5</span><span class="sxs-lookup"><span data-stu-id="534de-280">R5</span></span> | | | | |<span data-ttu-id="534de-281">1</span><span class="sxs-lookup"><span data-stu-id="534de-281">1</span></span> |
| <span data-ttu-id="534de-282">**UD2**</span><span class="sxs-lookup"><span data-stu-id="534de-282">**UD2**</span></span> | | |<span data-ttu-id="534de-283">R2</span><span class="sxs-lookup"><span data-stu-id="534de-283">R2</span></span> | | |<span data-ttu-id="534de-284">1</span><span class="sxs-lookup"><span data-stu-id="534de-284">1</span></span> |
| <span data-ttu-id="534de-285">**UD3**</span><span class="sxs-lookup"><span data-stu-id="534de-285">**UD3**</span></span> | | | |<span data-ttu-id="534de-286">R3</span><span class="sxs-lookup"><span data-stu-id="534de-286">R3</span></span> | |<span data-ttu-id="534de-287">1</span><span class="sxs-lookup"><span data-stu-id="534de-287">1</span></span> |
| <span data-ttu-id="534de-288">**UD4**</span><span class="sxs-lookup"><span data-stu-id="534de-288">**UD4**</span></span> | | | | |<span data-ttu-id="534de-289">R4</span><span class="sxs-lookup"><span data-stu-id="534de-289">R4</span></span> |<span data-ttu-id="534de-290">1</span><span class="sxs-lookup"><span data-stu-id="534de-290">1</span></span> |
| <span data-ttu-id="534de-291">**FDTotal**</span><span class="sxs-lookup"><span data-stu-id="534de-291">**FDTotal**</span></span> |<span data-ttu-id="534de-292">2</span><span class="sxs-lookup"><span data-stu-id="534de-292">2</span></span> |<span data-ttu-id="534de-293">0</span><span class="sxs-lookup"><span data-stu-id="534de-293">0</span></span> |<span data-ttu-id="534de-294">1</span><span class="sxs-lookup"><span data-stu-id="534de-294">1</span></span> |<span data-ttu-id="534de-295">1</span><span class="sxs-lookup"><span data-stu-id="534de-295">1</span></span> |<span data-ttu-id="534de-296">1</span><span class="sxs-lookup"><span data-stu-id="534de-296">1</span></span> |- |

<span data-ttu-id="534de-297">Esse layout viola nossa definição para a restrição de domínio de falha.</span><span class="sxs-lookup"><span data-stu-id="534de-297">This layout violates our definition for the Fault Domain constraint.</span></span> <span data-ttu-id="534de-298">FD0 tem duas réplicas, enquanto FD1 tem zero, tornando a diferença entre FD0 e FD1 um total de dois.</span><span class="sxs-lookup"><span data-stu-id="534de-298">FD0 has two replicas, while FD1 has zero, making the difference between FD0 and FD1 a total of two.</span></span> <span data-ttu-id="534de-299">O Cluster Resource Manager não permite essa disposição.</span><span class="sxs-lookup"><span data-stu-id="534de-299">The Cluster Resource Manager does not allow this arrangement.</span></span> <span data-ttu-id="534de-300">Da mesma forma, se escolhêssemos N2 e N6 (em vez de N1 e N2), teríamos:</span><span class="sxs-lookup"><span data-stu-id="534de-300">Similarly if we picked N2 and N6 (instead of N1 and N2) we'd get:</span></span>

|  | <span data-ttu-id="534de-301">FD0</span><span class="sxs-lookup"><span data-stu-id="534de-301">FD0</span></span> | <span data-ttu-id="534de-302">FD1</span><span class="sxs-lookup"><span data-stu-id="534de-302">FD1</span></span> | <span data-ttu-id="534de-303">FD2</span><span class="sxs-lookup"><span data-stu-id="534de-303">FD2</span></span> | <span data-ttu-id="534de-304">FD3</span><span class="sxs-lookup"><span data-stu-id="534de-304">FD3</span></span> | <span data-ttu-id="534de-305">FD4</span><span class="sxs-lookup"><span data-stu-id="534de-305">FD4</span></span> | <span data-ttu-id="534de-306">UDTotal</span><span class="sxs-lookup"><span data-stu-id="534de-306">UDTotal</span></span> |
| --- |:---:|:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="534de-307">**UD0**</span><span class="sxs-lookup"><span data-stu-id="534de-307">**UD0**</span></span> | | | | | |<span data-ttu-id="534de-308">0</span><span class="sxs-lookup"><span data-stu-id="534de-308">0</span></span> |
| <span data-ttu-id="534de-309">**UD1**</span><span class="sxs-lookup"><span data-stu-id="534de-309">**UD1**</span></span> |<span data-ttu-id="534de-310">R5</span><span class="sxs-lookup"><span data-stu-id="534de-310">R5</span></span> |<span data-ttu-id="534de-311">R1</span><span class="sxs-lookup"><span data-stu-id="534de-311">R1</span></span> | | | |<span data-ttu-id="534de-312">2</span><span class="sxs-lookup"><span data-stu-id="534de-312">2</span></span> |
| <span data-ttu-id="534de-313">**UD2**</span><span class="sxs-lookup"><span data-stu-id="534de-313">**UD2**</span></span> | | |<span data-ttu-id="534de-314">R2</span><span class="sxs-lookup"><span data-stu-id="534de-314">R2</span></span> | | |<span data-ttu-id="534de-315">1</span><span class="sxs-lookup"><span data-stu-id="534de-315">1</span></span> |
| <span data-ttu-id="534de-316">**UD3**</span><span class="sxs-lookup"><span data-stu-id="534de-316">**UD3**</span></span> | | | |<span data-ttu-id="534de-317">R3</span><span class="sxs-lookup"><span data-stu-id="534de-317">R3</span></span> | |<span data-ttu-id="534de-318">1</span><span class="sxs-lookup"><span data-stu-id="534de-318">1</span></span> |
| <span data-ttu-id="534de-319">**UD4**</span><span class="sxs-lookup"><span data-stu-id="534de-319">**UD4**</span></span> | | | | |<span data-ttu-id="534de-320">R4</span><span class="sxs-lookup"><span data-stu-id="534de-320">R4</span></span> |<span data-ttu-id="534de-321">1</span><span class="sxs-lookup"><span data-stu-id="534de-321">1</span></span> |
| <span data-ttu-id="534de-322">**FDTotal**</span><span class="sxs-lookup"><span data-stu-id="534de-322">**FDTotal**</span></span> |<span data-ttu-id="534de-323">1</span><span class="sxs-lookup"><span data-stu-id="534de-323">1</span></span> |<span data-ttu-id="534de-324">1</span><span class="sxs-lookup"><span data-stu-id="534de-324">1</span></span> |<span data-ttu-id="534de-325">1</span><span class="sxs-lookup"><span data-stu-id="534de-325">1</span></span> |<span data-ttu-id="534de-326">1</span><span class="sxs-lookup"><span data-stu-id="534de-326">1</span></span> |<span data-ttu-id="534de-327">1</span><span class="sxs-lookup"><span data-stu-id="534de-327">1</span></span> |- |

<span data-ttu-id="534de-328">Este layout é equilibrado em termos de domínios de falha.</span><span class="sxs-lookup"><span data-stu-id="534de-328">This layout is balanced in terms of Fault Domains.</span></span> <span data-ttu-id="534de-329">No entanto, agora ele está violando a restrição de domínio de atualização.</span><span class="sxs-lookup"><span data-stu-id="534de-329">However, now it's violating the Upgrade Domain constraint.</span></span> <span data-ttu-id="534de-330">Isso acontece porque UD0 tem zero réplicas, enquanto UD1 tem cinco.</span><span class="sxs-lookup"><span data-stu-id="534de-330">This is because UD0 has zero replicas while UD1 has two.</span></span> <span data-ttu-id="534de-331">Sendo assim, este layout também é inválido e não será escolhido pelo Gerenciador de Recursos de Cluster.</span><span class="sxs-lookup"><span data-stu-id="534de-331">Therefore, this layout is also invalid and won't be picked by the Cluster Resource Manager.</span></span> 

## <a name="configuring-fault-and-upgrade-domains"></a><span data-ttu-id="534de-332">Configurando domínios de falha e atualização</span><span class="sxs-lookup"><span data-stu-id="534de-332">Configuring fault and Upgrade Domains</span></span>
<span data-ttu-id="534de-333">A definição de domínios de falha e domínios de atualização é feita automaticamente em implantações hospedadas do Azure Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="534de-333">Defining Fault Domains and Upgrade Domains is done automatically in Azure hosted Service Fabric deployments.</span></span> <span data-ttu-id="534de-334">O Service Fabric seleciona e usa as informações de ambiente do Azure.</span><span class="sxs-lookup"><span data-stu-id="534de-334">Service Fabric picks up and uses the environment information from Azure.</span></span>

<span data-ttu-id="534de-335">Se estiver criando seu próprio cluster (ou desejar executar uma topologia específica no desenvolvimento), você mesmo poderá fornecer as informações de domínio de falha e de domínio de atualização.</span><span class="sxs-lookup"><span data-stu-id="534de-335">If you’re creating your own cluster (or want to run a particular topology in development), you can provide the Fault Domain and Upgrade Domain information yourself.</span></span> <span data-ttu-id="534de-336">Neste exemplo, definimos um cluster de desenvolvimento local de nove nós que abrange três "datacenters" (cada um com três racks).</span><span class="sxs-lookup"><span data-stu-id="534de-336">In this example, we define a nine node local development cluster that spans three “datacenters” (each with three racks).</span></span> <span data-ttu-id="534de-337">Este cluster também tem três domínios de atualização distribuídos entre esses três datacenters.</span><span class="sxs-lookup"><span data-stu-id="534de-337">This cluster also has three Upgrade Domains striped across those three datacenters.</span></span> <span data-ttu-id="534de-338">Veja um exemplo da configuração abaixo:</span><span class="sxs-lookup"><span data-stu-id="534de-338">An example of the configuration is below:</span></span> 

<span data-ttu-id="534de-339">ClusterManifest.xml</span><span class="sxs-lookup"><span data-stu-id="534de-339">ClusterManifest.xml</span></span>

```xml
  <Infrastructure>
    <!-- IsScaleMin indicates that this cluster runs on one-box /one single server -->
    <WindowsServer IsScaleMin="true">
      <NodeList>
        <Node NodeName="Node01" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType01" FaultDomain="fd:/DC01/Rack01" UpgradeDomain="UpgradeDomain1" IsSeedNode="true" />
        <Node NodeName="Node02" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType02" FaultDomain="fd:/DC01/Rack02" UpgradeDomain="UpgradeDomain2" IsSeedNode="true" />
        <Node NodeName="Node03" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType03" FaultDomain="fd:/DC01/Rack03" UpgradeDomain="UpgradeDomain3" IsSeedNode="true" />
        <Node NodeName="Node04" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType04" FaultDomain="fd:/DC02/Rack01" UpgradeDomain="UpgradeDomain1" IsSeedNode="true" />
        <Node NodeName="Node05" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType05" FaultDomain="fd:/DC02/Rack02" UpgradeDomain="UpgradeDomain2" IsSeedNode="true" />
        <Node NodeName="Node06" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType06" FaultDomain="fd:/DC02/Rack03" UpgradeDomain="UpgradeDomain3" IsSeedNode="true" />
        <Node NodeName="Node07" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType07" FaultDomain="fd:/DC03/Rack01" UpgradeDomain="UpgradeDomain1" IsSeedNode="true" />
        <Node NodeName="Node08" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType08" FaultDomain="fd:/DC03/Rack02" UpgradeDomain="UpgradeDomain2" IsSeedNode="true" />
        <Node NodeName="Node09" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType09" FaultDomain="fd:/DC03/Rack03" UpgradeDomain="UpgradeDomain3" IsSeedNode="true" />
      </NodeList>
    </WindowsServer>
  </Infrastructure>
```

<span data-ttu-id="534de-340">por meio de ClusterConfig.json para implantações autônomas</span><span class="sxs-lookup"><span data-stu-id="534de-340">via ClusterConfig.json for Standalone deployments</span></span>

```json
"nodes": [
  {
    "nodeName": "vm1",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc1/r0",
    "upgradeDomain": "UD1"
  },
  {
    "nodeName": "vm2",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc1/r0",
    "upgradeDomain": "UD2"
  },
  {
    "nodeName": "vm3",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc1/r0",
    "upgradeDomain": "UD3"
  },
  {
    "nodeName": "vm4",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc2/r0",
    "upgradeDomain": "UD1"
  },
  {
    "nodeName": "vm5",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc2/r0",
    "upgradeDomain": "UD2"
  },
  {
    "nodeName": "vm6",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc2/r0",
    "upgradeDomain": "UD3"
  },
  {
    "nodeName": "vm7",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc3/r0",
    "upgradeDomain": "UD1"
  },
  {
    "nodeName": "vm8",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc3/r0",
    "upgradeDomain": "UD2"
  },
  {
    "nodeName": "vm9",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc3/r0",
    "upgradeDomain": "UD3"
  }
],
```

> [!NOTE]
> <span data-ttu-id="534de-341">Ao definir clusters por meio do Azure Resource Manager, domínios de falha e domínios de atualização são atribuídos pelo Azure.</span><span class="sxs-lookup"><span data-stu-id="534de-341">When defining clusters via Azure Resource Manager, Fault Domains and Upgrade Domains are assigned by Azure.</span></span> <span data-ttu-id="534de-342">Portanto, a definição dos tipos de nó e conjuntos de dimensionamento de máquinas virtuais em seu modelo do Azure Resource Manager não inclui informações de domínio de atualização ou domínio de falha.</span><span class="sxs-lookup"><span data-stu-id="534de-342">Therefore, the definition of your Node Types and Virtual Machine Scale Sets in your Azure Resource Manager template does not include Fault Domain or Upgrade Domain information.</span></span>
>

## <a name="node-properties-and-placement-constraints"></a><span data-ttu-id="534de-343">Restrições de posicionamento e propriedades do nó</span><span class="sxs-lookup"><span data-stu-id="534de-343">Node properties and placement constraints</span></span>
<span data-ttu-id="534de-344">Às vezes (na verdade, na maioria das vezes), convém assegurar que determinadas cargas de trabalho sejam executadas apenas em alguns tipos de nós no cluster.</span><span class="sxs-lookup"><span data-stu-id="534de-344">Sometimes (in fact, most of the time) you’re going to want to ensure that certain workloads run only on certain types of nodes in the cluster.</span></span> <span data-ttu-id="534de-345">Por exemplo, algumas cargas de trabalho podem exigir GPUs ou SSDs, enquanto outras, não.</span><span class="sxs-lookup"><span data-stu-id="534de-345">For example, some workload may require GPUs or SSDs while others may not.</span></span> <span data-ttu-id="534de-346">Um ótimo exemplo de direcionamento de hardware para cargas de trabalho específicas é praticamente toda arquitetura de n camadas por aí.</span><span class="sxs-lookup"><span data-stu-id="534de-346">A great example of targeting hardware to particular workloads is almost every n-tier architecture out there.</span></span> <span data-ttu-id="534de-347">Determinados computadores servem como o lado de serviço de front-end ou API do aplicativo e, portanto, são expostos aos clientes ou à Internet.</span><span class="sxs-lookup"><span data-stu-id="534de-347">Certain machines serve as the front end or API serving side of the application and are exposed to the clients or the internet.</span></span> <span data-ttu-id="534de-348">Diferentes computadores, normalmente com recursos de hardware diferentes, lidam com o trabalho das camadas de computação ou armazenamento.</span><span class="sxs-lookup"><span data-stu-id="534de-348">Different machines, often with different hardware resources, handle the work of the compute or storage layers.</span></span> <span data-ttu-id="534de-349">Normalmente, eles _não_ são expostos diretamente a clientes ou à Internet.</span><span class="sxs-lookup"><span data-stu-id="534de-349">These are usually _not_ directly exposed to clients or the internet.</span></span> <span data-ttu-id="534de-350">O Service Fabric espera que haja casos em que cargas de trabalho específicas precisem ser executadas em configurações de hardware específicas.</span><span class="sxs-lookup"><span data-stu-id="534de-350">Service Fabric expects that there are cases where particular workloads need to run on particular hardware configurations.</span></span> <span data-ttu-id="534de-351">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="534de-351">For example:</span></span>

* <span data-ttu-id="534de-352">um aplicativo de n camadas existente foi "transferido e posicionado" em um ambiente do Service Fabric</span><span class="sxs-lookup"><span data-stu-id="534de-352">an existing n-tier application has been “lifted and shifted” into a Service Fabric environment</span></span>
* <span data-ttu-id="534de-353">uma carga de trabalho deseja ser executada em um hardware específico por motivos de desempenho, escala ou isolamento de segurança</span><span class="sxs-lookup"><span data-stu-id="534de-353">a workload wants to run on specific hardware for performance, scale, or security isolation reasons</span></span>
* <span data-ttu-id="534de-354">Uma carga de trabalho deve ser isolada de outras cargas de trabalho por motivos de política ou consumo de recursos</span><span class="sxs-lookup"><span data-stu-id="534de-354">A workload should be isolated from other workloads for policy or resource consumption reasons</span></span>

<span data-ttu-id="534de-355">Para dar suporte a esses tipos de configurações, o Service Fabric tem uma noção avançada das marcas que podem ser aplicadas aos nós.</span><span class="sxs-lookup"><span data-stu-id="534de-355">To support these sorts of configurations, Service Fabric has a first class notion of tags that can be applied to nodes.</span></span> <span data-ttu-id="534de-356">Essas marcas são chamadas de **propriedades de nó**.</span><span class="sxs-lookup"><span data-stu-id="534de-356">These tags are called **node properties**.</span></span> <span data-ttu-id="534de-357">**Restrições de posicionamento** são as instruções anexadas a serviços individuais que selecionam uma ou mais propriedades de nó.</span><span class="sxs-lookup"><span data-stu-id="534de-357">**Placement constraints** are the statements attached to individual services that select for one or more node properties.</span></span> <span data-ttu-id="534de-358">Restrições de posicionamento definem onde os serviços devem ser executados.</span><span class="sxs-lookup"><span data-stu-id="534de-358">Placement constraints define where services should run.</span></span> <span data-ttu-id="534de-359">O conjunto de restrições é extensível, qualquer par chave-valor pode funcionar.</span><span class="sxs-lookup"><span data-stu-id="534de-359">The set of constraints is extensible - any key/value pair can work.</span></span> 

<span data-ttu-id="534de-360"><center>
![Cargas de trabalho diferentes do layout do cluster][Image5]
</center></span><span class="sxs-lookup"><span data-stu-id="534de-360"><center>
![Cluster Layout Different Workloads][Image5]
</center></span></span>

### <a name="built-in-node-properties"></a><span data-ttu-id="534de-361">Propriedades de nó internas</span><span class="sxs-lookup"><span data-stu-id="534de-361">Built in node properties</span></span>
<span data-ttu-id="534de-362">O Service Fabric define algumas propriedades de nó padrão que podem ser usadas automaticamente sem que o usuário precise defini-las.</span><span class="sxs-lookup"><span data-stu-id="534de-362">Service Fabric defines some default node properties that can be used automatically without the user having to define them.</span></span> <span data-ttu-id="534de-363">As propriedades padrão definidas em cada nó são **NodeType** e **NodeName**.</span><span class="sxs-lookup"><span data-stu-id="534de-363">The default properties defined at each node are the **NodeType** and the **NodeName**.</span></span> <span data-ttu-id="534de-364">Por exemplo, você poderia escrever uma restrição de posicionamento como `"(NodeType == NodeType03)"`.</span><span class="sxs-lookup"><span data-stu-id="534de-364">So for example you could write a placement constraint as `"(NodeType == NodeType03)"`.</span></span> <span data-ttu-id="534de-365">Em geral, descobrimos que NodeType é uma das propriedades mais comumente usadas.</span><span class="sxs-lookup"><span data-stu-id="534de-365">Generally we have found NodeType to be one of the most commonly used properties.</span></span> <span data-ttu-id="534de-366">Ela é útil porque corresponde individualmente a um tipo de um computador.</span><span class="sxs-lookup"><span data-stu-id="534de-366">It is useful since it corresponds 1:1 with a type of a machine.</span></span> <span data-ttu-id="534de-367">Cada tipo de computador corresponde a um tipo de carga de trabalho em um aplicativo de n camadas tradicional.</span><span class="sxs-lookup"><span data-stu-id="534de-367">Each type of machine corresponds to a type of workload in a traditional n-tier application.</span></span>

<span data-ttu-id="534de-368"><center>
![Restrições de posicionamento e propriedades do nó][Image6]
</center></span><span class="sxs-lookup"><span data-stu-id="534de-368"><center>
![Placement Constraints and Node Properties][Image6]
</center></span></span>

## <a name="placement-constraint-and-node-property-syntax"></a><span data-ttu-id="534de-369">Sintaxe de restrição de posicionamento e propriedades do nó</span><span class="sxs-lookup"><span data-stu-id="534de-369">Placement Constraint and Node Property Syntax</span></span> 
<span data-ttu-id="534de-370">O valor especificado na propriedade do nó pode ser uma cadeia de caracteres, bool ou signed long.</span><span class="sxs-lookup"><span data-stu-id="534de-370">The value specified in the node property can be a string, bool, or signed long.</span></span> <span data-ttu-id="534de-371">A instrução no serviço é chamada de uma *restrição* de posicionamento, uma vez que ela restringe onde o serviço pode ser executado no cluster.</span><span class="sxs-lookup"><span data-stu-id="534de-371">The statement at the service is called a placement *constraint* since it constrains where the service can run in the cluster.</span></span> <span data-ttu-id="534de-372">A restrição pode ser qualquer instrução booliana que opera sobre as diferentes propriedades de nó no cluster.</span><span class="sxs-lookup"><span data-stu-id="534de-372">The constraint can be any Boolean statement that operates on the different node properties in the cluster.</span></span> <span data-ttu-id="534de-373">Os seletores válidos nessas instruções boolianas são:</span><span class="sxs-lookup"><span data-stu-id="534de-373">The valid selectors in these boolean statements are:</span></span>

1) <span data-ttu-id="534de-374">verificações condicionais para a criação de instruções</span><span class="sxs-lookup"><span data-stu-id="534de-374">conditional checks for creating particular statements</span></span>

| <span data-ttu-id="534de-375">Instrução</span><span class="sxs-lookup"><span data-stu-id="534de-375">Statement</span></span> | <span data-ttu-id="534de-376">Sintaxe</span><span class="sxs-lookup"><span data-stu-id="534de-376">Syntax</span></span> |
| --- |:---:|
| <span data-ttu-id="534de-377">"igual a"</span><span class="sxs-lookup"><span data-stu-id="534de-377">"equal to"</span></span> | <span data-ttu-id="534de-378">"=="</span><span class="sxs-lookup"><span data-stu-id="534de-378">"=="</span></span> |
| <span data-ttu-id="534de-379">"diferente de"</span><span class="sxs-lookup"><span data-stu-id="534de-379">"not equal to"</span></span> | <span data-ttu-id="534de-380">"!="</span><span class="sxs-lookup"><span data-stu-id="534de-380">"!="</span></span> |
| <span data-ttu-id="534de-381">"maior que"</span><span class="sxs-lookup"><span data-stu-id="534de-381">"greater than"</span></span> | <span data-ttu-id="534de-382">">"</span><span class="sxs-lookup"><span data-stu-id="534de-382">">"</span></span> |
| <span data-ttu-id="534de-383">"maior ou igual a"</span><span class="sxs-lookup"><span data-stu-id="534de-383">"greater than or equal to"</span></span> | <span data-ttu-id="534de-384">">="</span><span class="sxs-lookup"><span data-stu-id="534de-384">">="</span></span> |
| <span data-ttu-id="534de-385">"menor que"</span><span class="sxs-lookup"><span data-stu-id="534de-385">"less than"</span></span> | <span data-ttu-id="534de-386">"<"</span><span class="sxs-lookup"><span data-stu-id="534de-386">"<"</span></span> |
| <span data-ttu-id="534de-387">"menor ou igual a"</span><span class="sxs-lookup"><span data-stu-id="534de-387">"less than or equal to"</span></span> | <span data-ttu-id="534de-388">"<="</span><span class="sxs-lookup"><span data-stu-id="534de-388">"<="</span></span> |

2) <span data-ttu-id="534de-389">instruções boolianas para operações de agrupamento e lógicas</span><span class="sxs-lookup"><span data-stu-id="534de-389">boolean statements for grouping and logical operations</span></span>

| <span data-ttu-id="534de-390">Instrução</span><span class="sxs-lookup"><span data-stu-id="534de-390">Statement</span></span> | <span data-ttu-id="534de-391">Sintaxe</span><span class="sxs-lookup"><span data-stu-id="534de-391">Syntax</span></span> |
| --- |:---:|
| <span data-ttu-id="534de-392">"e"</span><span class="sxs-lookup"><span data-stu-id="534de-392">"and"</span></span> | <span data-ttu-id="534de-393">"&&"</span><span class="sxs-lookup"><span data-stu-id="534de-393">"&&"</span></span> |
| <span data-ttu-id="534de-394">"ou"</span><span class="sxs-lookup"><span data-stu-id="534de-394">"or"</span></span> | <span data-ttu-id="534de-395">"&#124;&#124;"</span><span class="sxs-lookup"><span data-stu-id="534de-395">"&#124;&#124;"</span></span> |
| <span data-ttu-id="534de-396">"não"</span><span class="sxs-lookup"><span data-stu-id="534de-396">"not"</span></span> | <span data-ttu-id="534de-397">"!"</span><span class="sxs-lookup"><span data-stu-id="534de-397">"!"</span></span> |
| <span data-ttu-id="534de-398">"agrupar como instrução única"</span><span class="sxs-lookup"><span data-stu-id="534de-398">"group as single statement"</span></span> | <span data-ttu-id="534de-399">"()"</span><span class="sxs-lookup"><span data-stu-id="534de-399">"()"</span></span> |

<span data-ttu-id="534de-400">Aqui estão alguns exemplos de instruções de restrição básicas.</span><span class="sxs-lookup"><span data-stu-id="534de-400">Here are some examples of basic constraint statements.</span></span>

  * `"Value >= 5"`
  * `"NodeColor != green"`
  * `"((OneProperty < 100) || ((AnotherProperty == false) && (OneProperty >= 100)))"`

<span data-ttu-id="534de-401">O serviço pode ser posicionado somente em nós em que a instrução de restrição de posicionamento geral é avaliada como "True".</span><span class="sxs-lookup"><span data-stu-id="534de-401">Only nodes where the overall placement constraint statement evaluates to “True” can have the service placed on it.</span></span> <span data-ttu-id="534de-402">Os nós que não têm uma propriedade definida não correspondem a nenhuma restrição de posicionamento que contém essa propriedade.</span><span class="sxs-lookup"><span data-stu-id="534de-402">Nodes that do not have a property defined do not match any placement constraint containing that property.</span></span>

<span data-ttu-id="534de-403">Vamos supor que as seguintes propriedades de nó foram definidas para um tipo de nó específico:</span><span class="sxs-lookup"><span data-stu-id="534de-403">Let’s say that the following node properties were defined for a given node type:</span></span>

<span data-ttu-id="534de-404">ClusterManifest.xml</span><span class="sxs-lookup"><span data-stu-id="534de-404">ClusterManifest.xml</span></span>

```xml
    <NodeType Name="NodeType01">
      <PlacementProperties>
        <Property Name="HasSSD" Value="true"/>
        <Property Name="NodeColor" Value="green"/>
        <Property Name="SomeProperty" Value="5"/>
      </PlacementProperties>
    </NodeType>
```

<span data-ttu-id="534de-405">via ClusterConfig.json para implantações Autônomas ou Template.json para clusters hospedados pelo Azure.</span><span class="sxs-lookup"><span data-stu-id="534de-405">via ClusterConfig.json for Standalone deployments or Template.json for Azure hosted clusters.</span></span> 

> [!NOTE]
> <span data-ttu-id="534de-406">Em seu modelo do Azure Resource Manager, o tipo de nó costuma ser parametrizado.</span><span class="sxs-lookup"><span data-stu-id="534de-406">In your Azure Resource Manager template the node type is usually parameterized.</span></span> <span data-ttu-id="534de-407">Ele seria semelhante a "[parameters('vmNodeType1Name')]", em vez de "NodeType01".</span><span class="sxs-lookup"><span data-stu-id="534de-407">It would look like "[parameters('vmNodeType1Name')]" rather than "NodeType01".</span></span>
>

```json
"nodeTypes": [
    {
        "name": "NodeType01",
        "placementProperties": {
            "HasSSD": "true",
            "NodeColor": "green",
            "SomeProperty": "5"
        },
    }
],
```

<span data-ttu-id="534de-408">Você pode criar *restrições* de posicionamento de serviço para um serviço da seguinte forma:</span><span class="sxs-lookup"><span data-stu-id="534de-408">You can create service placement *constraints* for a service like as follows:</span></span>

<span data-ttu-id="534de-409">C#</span><span class="sxs-lookup"><span data-stu-id="534de-409">C#</span></span>

```csharp
FabricClient fabricClient = new FabricClient();
StatefulServiceDescription serviceDescription = new StatefulServiceDescription();
serviceDescription.PlacementConstraints = "(HasSSD == true && SomeProperty >= 4)";
// add other required servicedescription fields
//...
await fabricClient.ServiceManager.CreateServiceAsync(serviceDescription);
```

<span data-ttu-id="534de-410">Powershell:</span><span class="sxs-lookup"><span data-stu-id="534de-410">Powershell:</span></span>

```posh
New-ServiceFabricService -ApplicationName $applicationName -ServiceName $serviceName -ServiceTypeName $serviceType -Stateful -MinReplicaSetSize 3 -TargetReplicaSetSize 3 -PartitionSchemeSingleton -PlacementConstraint "HasSSD == true && SomeProperty >= 4"
```

<span data-ttu-id="534de-411">Se todos os nós de NodeType01 forem válidos, você também poderá selecionar esse tipo de nó com a restrição "(NodeType == NodeType01)".</span><span class="sxs-lookup"><span data-stu-id="534de-411">If all nodes of NodeType01 are valid, you can also select that node type with the constraint "(NodeType == NodeType01)".</span></span>

<span data-ttu-id="534de-412">Uma das vantagens das restrições de posicionamento de um serviço é que elas podem ser atualizadas dinamicamente durante o tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="534de-412">One of the cool things about a service’s placement constraints is that they can be updated dynamically during runtime.</span></span> <span data-ttu-id="534de-413">Então, se necessário, você poderá mover um serviço pelo cluster, adicionar e remover requisitos, etc. O Service Fabric se encarrega de garantir que o serviço permaneça ativo e disponível mesmo quando esses tipos de alterações forem feitas.</span><span class="sxs-lookup"><span data-stu-id="534de-413">So if you need to, you can move a service around in the cluster, add and remove requirements, etc. Service Fabric takes care of ensuring that the service stays up and available even when these types of changes are made.</span></span>

<span data-ttu-id="534de-414">C#:</span><span class="sxs-lookup"><span data-stu-id="534de-414">C#:</span></span>

```csharp
StatefulServiceUpdateDescription updateDescription = new StatefulServiceUpdateDescription();
updateDescription.PlacementConstraints = "NodeType == NodeType01";
await fabricClient.ServiceManager.UpdateServiceAsync(new Uri("fabric:/app/service"), updateDescription);
```

<span data-ttu-id="534de-415">Powershell:</span><span class="sxs-lookup"><span data-stu-id="534de-415">Powershell:</span></span>

```posh
Update-ServiceFabricService -Stateful -ServiceName $serviceName -PlacementConstraints "NodeType == NodeType01"
```

<span data-ttu-id="534de-416">Restrições de posicionamento são especificadas para cada instância de serviço nomeada diferente.</span><span class="sxs-lookup"><span data-stu-id="534de-416">Placement constraints are specified for every different named service instance.</span></span> <span data-ttu-id="534de-417">As atualizações sempre assumem o lugar (substituem) do que foi especificado anteriormente.</span><span class="sxs-lookup"><span data-stu-id="534de-417">Updates always take the place of (overwrite) what was previously specified.</span></span>

<span data-ttu-id="534de-418">A definição do cluster define as propriedades em um nó.</span><span class="sxs-lookup"><span data-stu-id="534de-418">The cluster definition defines the properties on a node.</span></span> <span data-ttu-id="534de-419">Alterar as propriedades de um nó requer uma atualização de configuração do cluster.</span><span class="sxs-lookup"><span data-stu-id="534de-419">Changing a node's properties requires a cluster configuration upgrade.</span></span> <span data-ttu-id="534de-420">Atualizar as propriedades de um nó requer que cada nó afetado seja reiniciado para informar suas novas propriedades.</span><span class="sxs-lookup"><span data-stu-id="534de-420">Upgrading a node's properties requires each affected node to restart to report its new properties.</span></span> <span data-ttu-id="534de-421">Essas atualizações sem interrupção são gerenciadas pelo Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="534de-421">These rolling upgrades are managed by Service Fabric.</span></span>

## <a name="describing-and-managing-cluster-resources"></a><span data-ttu-id="534de-422">Descrever e gerenciar Recursos de Cluster</span><span class="sxs-lookup"><span data-stu-id="534de-422">Describing and Managing Cluster Resources</span></span>
<span data-ttu-id="534de-423">Um dos trabalhos mais importantes de qualquer orquestrador é ajudar a gerenciar o consumo de recursos no cluster.</span><span class="sxs-lookup"><span data-stu-id="534de-423">One of the most important jobs of any orchestrator is to help manage resource consumption in the cluster.</span></span> <span data-ttu-id="534de-424">Gerenciar recursos de cluster pode significar algumas coisas diferentes.</span><span class="sxs-lookup"><span data-stu-id="534de-424">Managing cluster resources can mean a couple of different things.</span></span> <span data-ttu-id="534de-425">Primeiro, é necessário garantir que os computadores não sejam sobrecarregados.</span><span class="sxs-lookup"><span data-stu-id="534de-425">First, there's ensuring that machines are not overloaded.</span></span> <span data-ttu-id="534de-426">Isso significa garantir que eles não executem mais serviços do que conseguem tratar.</span><span class="sxs-lookup"><span data-stu-id="534de-426">This means making sure that machines aren't running more services than they can handle.</span></span> <span data-ttu-id="534de-427">Segundo, há o balanceamento e a otimização, que são fundamentais para executar serviços com eficiência.</span><span class="sxs-lookup"><span data-stu-id="534de-427">Second, there's balancing and optimization which is critical to running services efficiently.</span></span> <span data-ttu-id="534de-428">Ofertas de serviço com bom custo-benefício ou sensíveis ao desempenho não podem permitir que alguns nós fiquem frios enquanto outros ficam quentes.</span><span class="sxs-lookup"><span data-stu-id="534de-428">Cost effective or performance sensitive service offerings can't allow some nodes to be hot while others are cold.</span></span> <span data-ttu-id="534de-429">Os nós quentes levam a contenção de recursos e a um mau desempenho, e os nós frios representam recursos desperdiçados e aumento de custos.</span><span class="sxs-lookup"><span data-stu-id="534de-429">Hot nodes lead to resource contention and poor performance, and cold nodes represent wasted resources and increased costs.</span></span> 

<span data-ttu-id="534de-430">O Service Fabric representa recursos como `Metrics`.</span><span class="sxs-lookup"><span data-stu-id="534de-430">Service Fabric represents resources as `Metrics`.</span></span> <span data-ttu-id="534de-431">As métricas são qualquer recurso lógico ou físico que você queira descrever para o Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="534de-431">Metrics are any logical or physical resource that you want to describe to Service Fabric.</span></span> <span data-ttu-id="534de-432">Exemplos de métricas são itens como "WorkQueueDepth" ou "MemoryInMb".</span><span class="sxs-lookup"><span data-stu-id="534de-432">Examples of metrics are things like “WorkQueueDepth” or “MemoryInMb”.</span></span> <span data-ttu-id="534de-433">Para obter informações sobre os recursos físicos que o Service Fabric é capaz de controlar nos nós, consulte [governança de recursos](service-fabric-resource-governance.md).</span><span class="sxs-lookup"><span data-stu-id="534de-433">For information about the physical resources that Service Fabric can govern on nodes, see [resource governance](service-fabric-resource-governance.md).</span></span> <span data-ttu-id="534de-434">Para obter informações sobre como configurar métricas personalizadas e seus usos, consulte [este artigo](service-fabric-cluster-resource-manager-metrics.md)</span><span class="sxs-lookup"><span data-stu-id="534de-434">For information on configuring custom metrics and their uses, see [this article](service-fabric-cluster-resource-manager-metrics.md)</span></span>

<span data-ttu-id="534de-435">As métricas são diferentes das restrições de posicionamento e das propriedades de nó.</span><span class="sxs-lookup"><span data-stu-id="534de-435">Metrics are different from placements constraints and node properties.</span></span> <span data-ttu-id="534de-436">Propriedades do nó são descritores estáticos dos nós propriamente ditos.</span><span class="sxs-lookup"><span data-stu-id="534de-436">Node properties are static descriptors of the nodes themselves.</span></span> <span data-ttu-id="534de-437">As métricas descrevem os recursos que os nós têm e que os serviços consomem quando são executados em um nó.</span><span class="sxs-lookup"><span data-stu-id="534de-437">Metrics describe resources that nodes have and that services consume when they are run on a node.</span></span> <span data-ttu-id="534de-438">Uma propriedade do nó pode ser "HasSSD" e pode ser definida como true ou false.</span><span class="sxs-lookup"><span data-stu-id="534de-438">A node property could be "HasSSD" and could be set to true or false.</span></span> <span data-ttu-id="534de-439">A quantidade de espaço disponível no SSD e quanto dele é consumido pelos serviços seria uma métrica como "DriveSpaceInMb".</span><span class="sxs-lookup"><span data-stu-id="534de-439">The amount of space available on that SSD and how much is consumed by services would be a metric like “DriveSpaceInMb”.</span></span> 

<span data-ttu-id="534de-440">É importante observar que assim como as restrições de posicionamento e as propriedades de nó, o Cluster Resource Manager do Service Fabric não entende o que os nomes das métricas significam.</span><span class="sxs-lookup"><span data-stu-id="534de-440">It is important to note that just like for placement constraints and node properties, the Service Fabric Cluster Resource Manager doesn't understand what the names of the metrics mean.</span></span> <span data-ttu-id="534de-441">Os nomes de métrica são apenas cadeias de caracteres.</span><span class="sxs-lookup"><span data-stu-id="534de-441">Metric names are just strings.</span></span> <span data-ttu-id="534de-442">É uma boa prática declarar as unidades como parte dos nomes de métrica que você criar quando puderem ser ambíguos.</span><span class="sxs-lookup"><span data-stu-id="534de-442">It is a good practice to declare units as a part of the metric names that you create when it could be ambiguous.</span></span>

## <a name="capacity"></a><span data-ttu-id="534de-443">Capacity</span><span class="sxs-lookup"><span data-stu-id="534de-443">Capacity</span></span>
<span data-ttu-id="534de-444">Se você desativasse todo o *balanceamento* de recursos, o Gerenciador de Recursos de Cluster do Service Fabric ainda garantiria que nenhum nó ficasse acima de sua capacidade.</span><span class="sxs-lookup"><span data-stu-id="534de-444">If you turned off all resource *balancing*, Service Fabric’s Cluster Resource Manager would still ensure that no node ended up over its capacity.</span></span> <span data-ttu-id="534de-445">É possível gerenciar saturações de capacidade, a menos que o cluster esteja muito cheio ou que a carga de trabalho seja maior do que qualquer nó.</span><span class="sxs-lookup"><span data-stu-id="534de-445">Managing capacity overruns is possible unless the cluster is too full or the workload is larger than any node.</span></span> <span data-ttu-id="534de-446">A capacidade é outra *restrição* que usa o Cluster Resource Manager para entender o quanto um nó tem de um recurso.</span><span class="sxs-lookup"><span data-stu-id="534de-446">Capacity is another *constraint* that the Cluster Resource Manager uses to understand how much of a resource a node has.</span></span> <span data-ttu-id="534de-447">A capacidade restante também é rastreada para o cluster como um todo.</span><span class="sxs-lookup"><span data-stu-id="534de-447">Remaining capacity is also tracked for the cluster as a whole.</span></span> <span data-ttu-id="534de-448">A capacidade e o consumo no nível de serviço são expressos em termos de métricas.</span><span class="sxs-lookup"><span data-stu-id="534de-448">Both the capacity and the consumption at the service level are expressed in terms of metrics.</span></span> <span data-ttu-id="534de-449">Então, por exemplo, a métrica poderia ser "ClientConnections" e um determinado nó poderia ter uma capacidade de "ClientConnections" igual a 32768.</span><span class="sxs-lookup"><span data-stu-id="534de-449">So for example, the metric might be "ClientConnections" and a given Node may have a capacity for "ClientConnections" of 32768.</span></span> <span data-ttu-id="534de-450">Outros nós podem ter outros limites; algum serviço em execução nesse nó pode informar que atualmente está consumindo 32256 da métrica "ClientConnections".</span><span class="sxs-lookup"><span data-stu-id="534de-450">Other nodes can have other limits Some service running on that node can say it is currently consuming 32256 of the metric "ClientConnections".</span></span>

<span data-ttu-id="534de-451">No tempo de execução, o Gerenciador de Recursos de Cluster acompanha a capacidade restante no cluster e nos nós.</span><span class="sxs-lookup"><span data-stu-id="534de-451">During runtime, the Cluster Resource Manager tracks remaining capacity in the cluster and on nodes.</span></span> <span data-ttu-id="534de-452">Para acompanhar a capacidade, o Gerenciador de Recursos de Cluster subtrai o uso de cada serviço da capacidade do nó em que o serviço é executado.</span><span class="sxs-lookup"><span data-stu-id="534de-452">In order to track capacity the Cluster Resource Manager subtracts each service's usage from node's capacity where the service runs.</span></span> <span data-ttu-id="534de-453">Com essas informações, o Cluster Resource Manager do Service Fabric pode descobrir onde inserir ou mover réplicas para que os nós não ultrapassem a capacidade.</span><span class="sxs-lookup"><span data-stu-id="534de-453">With this information, the Service Fabric Cluster Resource Manager can figure out where to place or move replicas so that nodes don’t go over capacity.</span></span>

<span data-ttu-id="534de-454"><center>
![Capacidade e nós de cluster][Image7]
</center></span><span class="sxs-lookup"><span data-stu-id="534de-454"><center>
![Cluster nodes and capacity][Image7]
</center></span></span>

<span data-ttu-id="534de-455">C#:</span><span class="sxs-lookup"><span data-stu-id="534de-455">C#:</span></span>

```csharp
StatefulServiceDescription serviceDescription = new StatefulServiceDescription();
ServiceLoadMetricDescription metric = new ServiceLoadMetricDescription();
metric.Name = "ClientConnections";
metric.PrimaryDefaultLoad = 1024;
metric.SecondaryDefaultLoad = 0;
metric.Weight = ServiceLoadMetricWeight.High;
serviceDescription.Metrics.Add(metric);
await fabricClient.ServiceManager.CreateServiceAsync(serviceDescription);
```

<span data-ttu-id="534de-456">Powershell:</span><span class="sxs-lookup"><span data-stu-id="534de-456">Powershell:</span></span>

```posh
New-ServiceFabricService -ApplicationName $applicationName -ServiceName $serviceName -ServiceTypeName $serviceTypeName –Stateful -MinReplicaSetSize 3 -TargetReplicaSetSize 3 -PartitionSchemeSingleton –Metric @("ClientConnections,High,1024,0)
```

<span data-ttu-id="534de-457">Você pode ver as capacidades definidas no manifesto do cluster:</span><span class="sxs-lookup"><span data-stu-id="534de-457">You can see capacities defined in the cluster manifest:</span></span>

<span data-ttu-id="534de-458">ClusterManifest.xml</span><span class="sxs-lookup"><span data-stu-id="534de-458">ClusterManifest.xml</span></span>

```xml
    <NodeType Name="NodeType03">
      <Capacities>
        <Capacity Name="ClientConnections" Value="65536"/>
      </Capacities>
    </NodeType>
```

<span data-ttu-id="534de-459">via ClusterConfig.json para implantações Autônomas ou Template.json para clusters hospedados pelo Azure.</span><span class="sxs-lookup"><span data-stu-id="534de-459">via ClusterConfig.json for Standalone deployments or Template.json for Azure hosted clusters.</span></span> 

```json
"nodeTypes": [
    {
        "name": "NodeType03",
        "capacities": {
            "ClientConnections": "65536",
        }
    }
],
```

<span data-ttu-id="534de-460">Normalmente, a carga de um serviço é alterada dinamicamente.</span><span class="sxs-lookup"><span data-stu-id="534de-460">Commonly a service’s load changes dynamically.</span></span> <span data-ttu-id="534de-461">Digamos que a carga de uma réplica de "ClientConnections" tenha sido alterada de 1024 para 2048, mas o nó em que ela estava em execução tivesse uma apenas uma capacidade de 512 restante para essa métrica.</span><span class="sxs-lookup"><span data-stu-id="534de-461">Say that a replica's load of "ClientConnections" changed from 1024 to 2048, but the node it was running on then only had 512 capacity remaining for that metric.</span></span> <span data-ttu-id="534de-462">Agora essa réplica ou posicionamento da instância é inválido, pois não há espaço suficiente no nó.</span><span class="sxs-lookup"><span data-stu-id="534de-462">Now that replica or instance's placement is invalid, since there's not enough room on that node.</span></span> <span data-ttu-id="534de-463">O Gerenciador de Recursos de Cluster precisa entrar em ação e colocar o nó abaixo da capacidade novamente.</span><span class="sxs-lookup"><span data-stu-id="534de-463">The Cluster Resource Manager has to kick in and get the node back below capacity.</span></span> <span data-ttu-id="534de-464">Ele reduz a carga do nó que está acima da capacidade movendo uma ou mais réplicas ou instâncias daquele nó para outros nós.</span><span class="sxs-lookup"><span data-stu-id="534de-464">It reduces load on the node that is over capacity by moving one or more of the replicas or instances from that node to other nodes.</span></span> <span data-ttu-id="534de-465">Ao mover réplicas, o Cluster Resource Manager tenta minimizar o custo dessas movimentações.</span><span class="sxs-lookup"><span data-stu-id="534de-465">When moving replicas, the Cluster Resource Manager tries to minimize the cost of those movements.</span></span> <span data-ttu-id="534de-466">O custo da movimentação é abordado [neste artigo](service-fabric-cluster-resource-manager-movement-cost.md) e mais informações sobre as regras e estratégias de rebalanceamento do Gerenciador de Recursos de Cluster são fornecidas [aqui](service-fabric-cluster-resource-manager-metrics.md).</span><span class="sxs-lookup"><span data-stu-id="534de-466">Movement cost is discussed in [this article](service-fabric-cluster-resource-manager-movement-cost.md) and more about the Cluster Resource Manager's rebalancing strategies and rules is described [here](service-fabric-cluster-resource-manager-metrics.md).</span></span>

## <a name="cluster-capacity"></a><span data-ttu-id="534de-467">Capacidade do cluster</span><span class="sxs-lookup"><span data-stu-id="534de-467">Cluster capacity</span></span>
<span data-ttu-id="534de-468">Então, como o Gerenciador de Recursos de Cluster do Service Fabric impede o cluster geral de ficar muito cheio?</span><span class="sxs-lookup"><span data-stu-id="534de-468">So how does the Service Fabric Cluster Resource Manager keep the overall cluster from being too full?</span></span> <span data-ttu-id="534de-469">Bem, com a carga dinâmica, não há muito que ele possa fazer.</span><span class="sxs-lookup"><span data-stu-id="534de-469">Well, with dynamic load there’s not a lot it can do.</span></span> <span data-ttu-id="534de-470">Os serviços podem ter seu pico de carga independentemente das ações executadas pelo Cluster Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="534de-470">Services can have their load spike independently of actions taken by the Cluster Resource Manager.</span></span> <span data-ttu-id="534de-471">Como resultado, o cluster com bastante reserva dinâmica hoje pode não ter espaço suficiente quando você ficar famoso amanhã.</span><span class="sxs-lookup"><span data-stu-id="534de-471">As a result, your cluster with plenty of headroom today may be underpowered when you become famous tomorrow.</span></span> <span data-ttu-id="534de-472">Dito isso, há alguns controles embutidos para evitar problemas.</span><span class="sxs-lookup"><span data-stu-id="534de-472">That said, there are some controls that are baked in to prevent problems.</span></span> <span data-ttu-id="534de-473">A primeira coisa a fazer é evitar a criação de novas cargas de trabalho que fariam com que o cluster ficasse cheio.</span><span class="sxs-lookup"><span data-stu-id="534de-473">The first thing we can do is prevent the creation of new workloads that would cause the cluster to become full.</span></span>

<span data-ttu-id="534de-474">Digamos que você crie um serviço sem estado e que haja alguma carga associada a ele.</span><span class="sxs-lookup"><span data-stu-id="534de-474">Say that you create a stateless service and it has some load associated with it.</span></span> <span data-ttu-id="534de-475">Digamos que o serviço se preocupa com a métrica "DiskSpaceInMb".</span><span class="sxs-lookup"><span data-stu-id="534de-475">Let’s say that the service cares about the "DiskSpaceInMb" metric.</span></span> <span data-ttu-id="534de-476">Digamos também que ele consumirá cinco unidades de "DiskSpaceInMb" para cada instância do serviço.</span><span class="sxs-lookup"><span data-stu-id="534de-476">Let's also say that it is going to consume five units of "DiskSpaceInMb" for every instance of the service.</span></span> <span data-ttu-id="534de-477">Você deseja criar três instâncias do serviço.</span><span class="sxs-lookup"><span data-stu-id="534de-477">You want to create three instances of the service.</span></span> <span data-ttu-id="534de-478">Ótimo!</span><span class="sxs-lookup"><span data-stu-id="534de-478">Great!</span></span> <span data-ttu-id="534de-479">Isso significa que é preciso que 15 unidades de "DiskSpaceInMb" estejam presentes no cluster para podermos criar essas instâncias de serviço.</span><span class="sxs-lookup"><span data-stu-id="534de-479">So that means that we need 15 units of "DiskSpaceInMb" to be present in the cluster in order for us to even be able to create these service instances.</span></span> <span data-ttu-id="534de-480">O Gerenciador de Recursos de Cluster calcula continuamente a capacidade e o consumo de cada métrica para que possa determinar a capacidade restante no cluster.</span><span class="sxs-lookup"><span data-stu-id="534de-480">The Cluster Resource Manager continually calculates the capacity and consumption of each metric so it can determine the remaining capacity in the cluster.</span></span> <span data-ttu-id="534de-481">Se não houver espaço suficiente, o Gerenciador de Recursos de Cluster rejeitará a chamada de criação de serviço.</span><span class="sxs-lookup"><span data-stu-id="534de-481">If there isn't enough space, the Cluster Resource Manager rejects the create service call.</span></span>

<span data-ttu-id="534de-482">Uma vez que o requisito é apenas que haja 15 unidades disponíveis, esse espaço poderia ser alocado de várias maneiras diferentes.</span><span class="sxs-lookup"><span data-stu-id="534de-482">Since the requirement is only that there be 15 units available, this space could be allocated many different ways.</span></span> <span data-ttu-id="534de-483">Por exemplo, poderia haver uma unidade restante de capacidade em 15 nós diferentes ou três unidades restantes de capacidade em cinco nós diferente.</span><span class="sxs-lookup"><span data-stu-id="534de-483">For example, there could be one remaining unit of capacity on 15 different nodes, or three remaining units of capacity on five different nodes.</span></span> <span data-ttu-id="534de-484">Se o Gerenciador de Recursos de Cluster puder reorganizar as coisas para que haja cinco unidades disponíveis em três nós, ele posicionará o serviço.</span><span class="sxs-lookup"><span data-stu-id="534de-484">If the Cluster Resource Manager can rearrange things so there's five units available on three nodes, it places the service.</span></span> <span data-ttu-id="534de-485">Normalmente, é possível reorganizar o cluster, a menos que ele esteja quase cheio ou que os serviços existentes não possam ser consolidados por alguma razão.</span><span class="sxs-lookup"><span data-stu-id="534de-485">Rearranging the cluster is usually possible unless the cluster is almost full or the existing services can't be consolidated for some reason.</span></span>

## <a name="buffered-capacity"></a><span data-ttu-id="534de-486">Capacidade de buffer</span><span class="sxs-lookup"><span data-stu-id="534de-486">Buffered Capacity</span></span>
<span data-ttu-id="534de-487">A capacidade em buffer é outro recurso do Gerenciador de Recursos de Cluster.</span><span class="sxs-lookup"><span data-stu-id="534de-487">Buffered capacity is another feature of the Cluster Resource Manager.</span></span> <span data-ttu-id="534de-488">Ela permite reservar uma parte da capacidade total do nó.</span><span class="sxs-lookup"><span data-stu-id="534de-488">It allows reservation of some portion of the overall node capacity.</span></span> <span data-ttu-id="534de-489">Esse buffer de capacidade só é usado para posicionar serviços durante atualizações e falhas do nó.</span><span class="sxs-lookup"><span data-stu-id="534de-489">This capacity buffer is only used to place services during upgrades and node failures.</span></span> <span data-ttu-id="534de-490">A capacidade em buffer é especificada globalmente por métrica para todos os nós.</span><span class="sxs-lookup"><span data-stu-id="534de-490">Buffered Capacity is specified globally per metric for all nodes.</span></span> <span data-ttu-id="534de-491">O valor que você escolher para a capacidade reservada é uma função do número de domínios de falha e de atualização no cluster.</span><span class="sxs-lookup"><span data-stu-id="534de-491">The value you pick for the reserved capacity is a function of the number of Fault and Upgrade Domains you have in the cluster.</span></span> <span data-ttu-id="534de-492">Mais domínios de falha e de atualização significa que você pode escolher um número menor para a capacidade em buffer.</span><span class="sxs-lookup"><span data-stu-id="534de-492">More Fault and Upgrade Domains means that you can pick a lower number for your buffered capacity.</span></span> <span data-ttu-id="534de-493">Se você tiver mais domínios, poderá esperar que quantidades menores de cluster fiquem indisponíveis durante atualizações e falhas.</span><span class="sxs-lookup"><span data-stu-id="534de-493">If you have more domains, you can expect smaller amounts of your cluster to be unavailable during upgrades and failures.</span></span> <span data-ttu-id="534de-494">Especificar a capacidade em buffer só fará sentido se você também tiver especificado a capacidade do nó para uma métrica.</span><span class="sxs-lookup"><span data-stu-id="534de-494">Specifying Buffered Capacity only makes sense if you have also specified the node capacity for a metric.</span></span>

<span data-ttu-id="534de-495">Aqui está um exemplo de como especificar a capacidade do buffer:</span><span class="sxs-lookup"><span data-stu-id="534de-495">Here's an example of how to specify buffered capacity:</span></span>

<span data-ttu-id="534de-496">ClusterManifest.xml</span><span class="sxs-lookup"><span data-stu-id="534de-496">ClusterManifest.xml</span></span>

```xml
        <Section Name="NodeBufferPercentage">
            <Parameter Name="SomeMetric" Value="0.15" />
            <Parameter Name="SomeOtherMetric" Value="0.20" />
        </Section>
```

<span data-ttu-id="534de-497">via ClusterConfig.json para implantações Autônomas ou Template.json para clusters hospedados pelo Azure:</span><span class="sxs-lookup"><span data-stu-id="534de-497">via ClusterConfig.json for Standalone deployments or Template.json for Azure hosted clusters:</span></span>

```json
"fabricSettings": [
  {
    "name": "NodeBufferPercentage",
    "parameters": [
      {
          "name": "SomeMetric",
          "value": "0.15"
      },
      {
          "name": "SomeOtherMetric",
          "value": "0.20"
      }
    ]
  }
]
```

<span data-ttu-id="534de-498">A criação de novos serviços falha quando o cluster está sem capacidade em buffer para uma métrica.</span><span class="sxs-lookup"><span data-stu-id="534de-498">The creation of new services fails when the cluster is out of buffered capacity for a metric.</span></span> <span data-ttu-id="534de-499">Impedir a criação de novos serviços para preservar o buffer garante que atualizações e falhas não façam com que os nós ultrapassem a capacidade.</span><span class="sxs-lookup"><span data-stu-id="534de-499">Preventing the creation of new services to preserve the buffer ensures that upgrades and failures don’t cause nodes to go over capacity.</span></span> <span data-ttu-id="534de-500">A capacidade em buffer é opcional, mas é recomendada em qualquer cluster que define uma capacidade para uma métrica.</span><span class="sxs-lookup"><span data-stu-id="534de-500">Buffered capacity is optional but is recommended in any cluster that defines a capacity for a metric.</span></span>

<span data-ttu-id="534de-501">O Gerenciador de Recursos de Cluster expõe essas informações de carga.</span><span class="sxs-lookup"><span data-stu-id="534de-501">The Cluster Resource Manager exposes this load information.</span></span> <span data-ttu-id="534de-502">Para cada métrica, as informações incluem:</span><span class="sxs-lookup"><span data-stu-id="534de-502">For each metric, this information includes:</span></span> 
  - <span data-ttu-id="534de-503">as configurações de capacidade em buffer</span><span class="sxs-lookup"><span data-stu-id="534de-503">the buffered capacity settings</span></span>
  - <span data-ttu-id="534de-504">a capacidade total</span><span class="sxs-lookup"><span data-stu-id="534de-504">the total capacity</span></span>
  - <span data-ttu-id="534de-505">o consumo atual</span><span class="sxs-lookup"><span data-stu-id="534de-505">the current consumption</span></span>
  - <span data-ttu-id="534de-506">se cada métrica é considerada balanceada ou não</span><span class="sxs-lookup"><span data-stu-id="534de-506">whether each metric is considered balanced or not</span></span>
  - <span data-ttu-id="534de-507">estatísticas sobre o desvio padrão</span><span class="sxs-lookup"><span data-stu-id="534de-507">statistics about the standard deviation</span></span>
  - <span data-ttu-id="534de-508">os nós que têm mais e menos carga</span><span class="sxs-lookup"><span data-stu-id="534de-508">the nodes which have the most and least load</span></span>  
  
<span data-ttu-id="534de-509">Abaixo, vemos um exemplo dessa saída:</span><span class="sxs-lookup"><span data-stu-id="534de-509">Below we see an example of that output:</span></span>

```posh
PS C:\Users\user> Get-ServiceFabricClusterLoadInformation
LastBalancingStartTimeUtc : 9/1/2016 12:54:59 AM
LastBalancingEndTimeUtc   : 9/1/2016 12:54:59 AM
LoadMetricInformation     :
                            LoadMetricName        : Metric1
                            IsBalancedBefore      : False
                            IsBalancedAfter       : False
                            DeviationBefore       : 0.192450089729875
                            DeviationAfter        : 0.192450089729875
                            BalancingThreshold    : 1
                            Action                : NoActionNeeded
                            ActivityThreshold     : 0
                            ClusterCapacity       : 189
                            ClusterLoad           : 45
                            ClusterRemainingCapacity : 144
                            NodeBufferPercentage  : 10
                            ClusterBufferedCapacity : 170
                            ClusterRemainingBufferedCapacity : 125
                            ClusterCapacityViolation : False
                            MinNodeLoadValue      : 0
                            MinNodeLoadNodeId     : 3ea71e8e01f4b0999b121abcbf27d74d
                            MaxNodeLoadValue      : 15
                            MaxNodeLoadNodeId     : 2cc648b6770be1bc9824fa995d5b68b1
```

## <a name="next-steps"></a><span data-ttu-id="534de-510">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="534de-510">Next steps</span></span>
* <span data-ttu-id="534de-511">Para obter informações sobre arquitetura e o fluxo de informações no Cluster Resource Manager, confira [este artigo ](service-fabric-cluster-resource-manager-architecture.md)</span><span class="sxs-lookup"><span data-stu-id="534de-511">For information on the architecture and information flow within the Cluster Resource Manager, check out [this article ](service-fabric-cluster-resource-manager-architecture.md)</span></span>
* <span data-ttu-id="534de-512">Definir as Métricas de Desfragmentação é uma forma de consolidar a carga em nós, em vez de distribuí-la. Para saber como configurar a desfragmentação, leia [este artigo](service-fabric-cluster-resource-manager-defragmentation-metrics.md)</span><span class="sxs-lookup"><span data-stu-id="534de-512">Defining Defragmentation Metrics is one way to consolidate load on nodes instead of spreading it out. To learn how to configure defragmentation, refer to [this article](service-fabric-cluster-resource-manager-defragmentation-metrics.md)</span></span>
* <span data-ttu-id="534de-513">Comece do princípio e [veja uma introdução ao Resource Manager de Cluster do Service Fabric](service-fabric-cluster-resource-manager-introduction.md)</span><span class="sxs-lookup"><span data-stu-id="534de-513">Start from the beginning and [get an Introduction to the Service Fabric Cluster Resource Manager](service-fabric-cluster-resource-manager-introduction.md)</span></span>
* <span data-ttu-id="534de-514">Para descobrir como o Gerenciador de Recursos de Cluster gerencia e balanceia carga no cluster, confira o artigo sobre [como balancear carga](service-fabric-cluster-resource-manager-balancing.md)</span><span class="sxs-lookup"><span data-stu-id="534de-514">To find out about how the Cluster Resource Manager manages and balances load in the cluster, check out the article on [balancing load](service-fabric-cluster-resource-manager-balancing.md)</span></span>

[Image1]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-fault-domains.png
[Image2]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-uneven-fault-domain-layout.png
[Image3]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-fault-and-upgrade-domains-with-placement.png
[Image4]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-fault-and-upgrade-domain-layout-strategies.png
[Image5]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-layout-different-workloads.png
[Image6]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-placement-constraints-node-properties.png
[Image7]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-nodes-and-capacity.png
