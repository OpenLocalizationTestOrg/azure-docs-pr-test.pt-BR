---
title: "Considerações de segurança para o Proxy de Aplicativo do Azure AD | Microsoft Docs"
description: "Aborda considerações de segurança para usar o Proxy de Aplicativo do Azure AD"
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/03/2017
ms.author: kgremban
ms.reviewer: harshja
ms.custom: it-pro
ms.openlocfilehash: c6ead651133eb17fd55f7567cdb14dc3bcd64245
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/18/2017
---
# <a name="security-considerations-for-accessing-apps-remotely-with-azure-ad-application-proxy"></a><span data-ttu-id="99ee8-103">Considerações de segurança para acessar aplicativos remotamente com o Proxy de Aplicativo do Azure AD</span><span class="sxs-lookup"><span data-stu-id="99ee8-103">Security considerations for accessing apps remotely with Azure AD Application Proxy</span></span>

<span data-ttu-id="99ee8-104">Este artigo explica como o Proxy de Aplicativo do Azure Active Directory fornece um serviço seguro para publicar e acessar aplicativos remotamente.</span><span class="sxs-lookup"><span data-stu-id="99ee8-104">This article explains how Azure Active Directory Application Proxy provides a secure service for publishing and accessing your applications remotely.</span></span>

<span data-ttu-id="99ee8-105">O diagrama a seguir mostra como o Azure AD permite acesso remoto seguro aos aplicativos locais.</span><span class="sxs-lookup"><span data-stu-id="99ee8-105">The following diagram shows how Azure AD enables secure remote access to your on-premises applications.</span></span>

 ![Diagrama de acesso remoto por meio do Proxy de Aplicativo do Azure AD](./media/application-proxy-security-considerations/secure-remote-access.png)

## <a name="security-benefits"></a><span data-ttu-id="99ee8-107">Benefícios de segurança</span><span class="sxs-lookup"><span data-stu-id="99ee8-107">Security benefits</span></span>

<span data-ttu-id="99ee8-108">O Proxy de Aplicativo do Azure AD oferece os seguintes benefícios de segurança:</span><span class="sxs-lookup"><span data-stu-id="99ee8-108">Azure AD Application Proxy offers the following security benefits:</span></span>

### <a name="authenticated-access"></a><span data-ttu-id="99ee8-109">Acesso autenticado</span><span class="sxs-lookup"><span data-stu-id="99ee8-109">Authenticated access</span></span> 

<span data-ttu-id="99ee8-110">Se você optar por usar a pré-autenticação do Azure Active Directory, somente conexões autenticadas podem acessar sua rede.</span><span class="sxs-lookup"><span data-stu-id="99ee8-110">If you choose to use Azure Active Directory preauthentication, then only authenticated connections can access your network.</span></span>

<span data-ttu-id="99ee8-111">Proxy de Aplicativo do Azure AD depende do Azure AD serviço de token de segurança (STS) para todas as autenticações.</span><span class="sxs-lookup"><span data-stu-id="99ee8-111">Azure AD Application Proxy relies on the Azure AD security token service (STS) for all authentication.</span></span>  <span data-ttu-id="99ee8-112">A pré-autenticação, por sua própria natureza, bloqueia um número significativo de ataques anônimos, pois somente identidades autenticadas podem acessar o aplicativo de back-end.</span><span class="sxs-lookup"><span data-stu-id="99ee8-112">Preauthentication, by its very nature, blocks a significant number of anonymous attacks, because only authenticated identities can access the back-end application.</span></span>

<span data-ttu-id="99ee8-113">Se você escolher Passagem como seu método de pré-autenticação, não terá esse benefício.</span><span class="sxs-lookup"><span data-stu-id="99ee8-113">If you choose Passthrough as your preauthentication method, you don't get this benefit.</span></span> 

### <a name="conditional-access"></a><span data-ttu-id="99ee8-114">Acesso condicional</span><span class="sxs-lookup"><span data-stu-id="99ee8-114">Conditional access</span></span>

<span data-ttu-id="99ee8-115">Aplique controles de política mais rígidos antes que as conexões com sua rede sejam estabelecidas.</span><span class="sxs-lookup"><span data-stu-id="99ee8-115">Apply richer policy controls before connections to your network are established.</span></span>

<span data-ttu-id="99ee8-116">Com [acesso condicional](active-directory-conditional-access-azuread-connected-apps.md), você pode definir restrições em relação ao que o tráfego pode acessar nos seus aplicativos de back-end.</span><span class="sxs-lookup"><span data-stu-id="99ee8-116">With [conditional access](active-directory-conditional-access-azuread-connected-apps.md), you can define restrictions on what traffic is allowed to access your back-end applications.</span></span> <span data-ttu-id="99ee8-117">É possível criar políticas que restrinjam entradas com base no local, na força da autenticação e no perfil de risco do usuário.</span><span class="sxs-lookup"><span data-stu-id="99ee8-117">You can create policies that restrict sign-ins based on location, strength of authentication, and user risk profile.</span></span>

<span data-ttu-id="99ee8-118">Você também pode usar o acesso condicional para configurar políticas de Autenticação Multifator, adicionando outra camada de segurança para suas autenticações de usuário.</span><span class="sxs-lookup"><span data-stu-id="99ee8-118">You can also use conditional access to configure Multi-Factor Authentication policies, adding another layer of security to your user authentications.</span></span> 

### <a name="traffic-termination"></a><span data-ttu-id="99ee8-119">Encerramento de tráfego</span><span class="sxs-lookup"><span data-stu-id="99ee8-119">Traffic termination</span></span>

<span data-ttu-id="99ee8-120">Todo o tráfego é encerrado na nuvem.</span><span class="sxs-lookup"><span data-stu-id="99ee8-120">All traffic is terminated in the cloud.</span></span>

<span data-ttu-id="99ee8-121">Como o Proxy de Aplicativo do Azure AD é um proxy reverso, todo o tráfego para os aplicativos de back-end é encerrado no serviço.</span><span class="sxs-lookup"><span data-stu-id="99ee8-121">Because Azure AD Application Proxy is a reverse-proxy, all traffic to back-end applications is terminated at the service.</span></span> <span data-ttu-id="99ee8-122">A sessão pode obter restabelecida apenas com o servidor de back-end, o que significa que seus servidores back-end não são expostos para o tráfego HTTP direto.</span><span class="sxs-lookup"><span data-stu-id="99ee8-122">The session can get reestablished only with the back-end server, which means that your back-end servers are not exposed to direct HTTP traffic.</span></span> <span data-ttu-id="99ee8-123">Essa configuração significa que você terá uma proteção melhor contra ataques direcionados.</span><span class="sxs-lookup"><span data-stu-id="99ee8-123">This configuration means that you are better protected from targeted attacks.</span></span>

### <a name="all-access-is-outbound"></a><span data-ttu-id="99ee8-124">Todo o acesso é de saída</span><span class="sxs-lookup"><span data-stu-id="99ee8-124">All access is outbound</span></span> 

<span data-ttu-id="99ee8-125">Não é necessário abrir as conexões de entrada para a rede corporativa.</span><span class="sxs-lookup"><span data-stu-id="99ee8-125">You don't need to open inbound connections to the corporate network.</span></span>

<span data-ttu-id="99ee8-126">Os Conectores do Proxy de Aplicativo utilizam apenas conexões de saída para o serviço de Proxy de Aplicativo do Azure AD, o que significa que não há necessidade de abrir portas de firewall para conexões de entrada.</span><span class="sxs-lookup"><span data-stu-id="99ee8-126">Application Proxy connectors only use outbound connections to the Azure AD Application Proxy service, which means that there is no need to open firewall ports for incoming connections.</span></span> <span data-ttu-id="99ee8-127">As abordagens tradicionais exigiam uma rede de perímetro (também conhecida como *DMZ*, *zona desmilitarizada*, ou *sub-rede filtrada*) e permitiam acesso a conexões não autenticadas na borda da rede.</span><span class="sxs-lookup"><span data-stu-id="99ee8-127">Traditional proxies required a perimeter network (also known as *DMZ*, *demilitarized zone*, or *screened subnet*) and allowed access to unauthenticated connections at the network edge.</span></span> <span data-ttu-id="99ee8-128">Esse cenário exigiu muitos investimentos adicionais em produtos de firewall de aplicativo Web para analisar o tráfego e oferecer proteções extras ao ambiente.</span><span class="sxs-lookup"><span data-stu-id="99ee8-128">This scenario required many additional investments in web application firewall products to analyze traffic and offer addition protections to the environment.</span></span> <span data-ttu-id="99ee8-129">Com o Proxy de Aplicativo, você não precisa de uma rede de perímetro porque todas as conexões são de saída e ocorrem por um canal seguro.</span><span class="sxs-lookup"><span data-stu-id="99ee8-129">With Application Proxy, you don't need a perimeter network because all connections are outbound and take place over a secure channel.</span></span>

<span data-ttu-id="99ee8-130">Para saber mais sobre conectores, veja [Noções básicas sobre conectores de proxy de aplicativo do Azure AD](application-proxy-understand-connectors.md).</span><span class="sxs-lookup"><span data-stu-id="99ee8-130">For more information about connectors, see [Understand Azure AD Application Proxy connectors](application-proxy-understand-connectors.md).</span></span>

### <a name="cloud-scale-analytics-and-machine-learning"></a><span data-ttu-id="99ee8-131">Machine learning e análise em escala de nuvem</span><span class="sxs-lookup"><span data-stu-id="99ee8-131">Cloud-scale analytics and machine learning</span></span> 

<span data-ttu-id="99ee8-132">Obtenha proteção de segurança de ponta.</span><span class="sxs-lookup"><span data-stu-id="99ee8-132">Get cutting-edge security protection.</span></span>

<span data-ttu-id="99ee8-133">Porque ele é parte do Azure Active Directory, o Proxy de Aplicativo pode aproveitar o [Azure AD Identity Protection](active-directory-identityprotection.md) com inteligência com base em aprendizado de máquina e dados do Microsoft Security Response Center e da Digital Crimes Unit.</span><span class="sxs-lookup"><span data-stu-id="99ee8-133">Because it's part of Azure Active Directory, Application Proxy can leverage [Azure AD Identity Protection](active-directory-identityprotection.md), with machine learning-driven intelligence and data from the Microsoft Security Response Center and Digital Crimes Unit.</span></span> <span data-ttu-id="99ee8-134">Juntos, identificamos proativamente contas comprometidas e oferecemos proteção em tempo real em conexões de alto risco. Levamos em consideração vários fatores, como acesso de dispositivos infectados por meio de redes que mantêm o anonimato, bem como de locais atípicos e improváveis.</span><span class="sxs-lookup"><span data-stu-id="99ee8-134">Together we proactively identify compromised accounts and offer real-time protection from high-risk sign-ins. We take into account numerous factors, such as access from infected devices, through anonymizing networks, and from atypical and unlikely locations.</span></span>

<span data-ttu-id="99ee8-135">Muitos desses relatórios e eventos já estão disponíveis por meio de uma API para integração com as informações de segurança e sistemas de gerenciamento (SIEM) do evento.</span><span class="sxs-lookup"><span data-stu-id="99ee8-135">Many of these reports and events are already available through an API for integration with your security information and event management (SIEM) systems.</span></span>

### <a name="remote-access-as-a-service"></a><span data-ttu-id="99ee8-136">Acesso remoto como serviço</span><span class="sxs-lookup"><span data-stu-id="99ee8-136">Remote access as a service</span></span>

<span data-ttu-id="99ee8-137">Você não precisa se preocupar com a manutenção e a aplicação de patches em servidores locais.</span><span class="sxs-lookup"><span data-stu-id="99ee8-137">You don’t have to worry about maintaining and patching on-premises servers.</span></span>

<span data-ttu-id="99ee8-138">A não aplicação de patches no software ainda é responsável por um grande número de ataques.</span><span class="sxs-lookup"><span data-stu-id="99ee8-138">Unpatched software still accounts for a large number of attacks.</span></span> <span data-ttu-id="99ee8-139">O Proxy de Aplicativo do Azure AD é um serviço em escala de Internet da Microsoft. Sendo assim, você sempre obterá os patches e as atualizações de segurança mais recentes.</span><span class="sxs-lookup"><span data-stu-id="99ee8-139">Azure AD Application Proxy is an Internet-scale service that Microsoft owns, so you always get the latest security patches and upgrades.</span></span>

<span data-ttu-id="99ee8-140">Para melhorar a segurança dos aplicativos publicados pelo Proxy de Aplicativo do Azure AD, bloquearemos robôs do rastreador da Web de indexação e o arquivamento de seus aplicativos.</span><span class="sxs-lookup"><span data-stu-id="99ee8-140">To improve the security of applications published by Azure AD Application Proxy, we block web crawler robots from indexing and archiving your applications.</span></span> <span data-ttu-id="99ee8-141">Cada vez que um robô rastreador da Web tentar recuperar as configurações de robôs para um aplicativo publicado, o Proxy de Aplicativo responderá com um arquivo robots.txt que inclui `User-agent: * Disallow: /`.</span><span class="sxs-lookup"><span data-stu-id="99ee8-141">Each time a web crawler robot tries to retrieve the robot's settings for a published app, Application Proxy replies with a robots.txt file that includes `User-agent: * Disallow: /`.</span></span>

## <a name="under-the-hood"></a><span data-ttu-id="99ee8-142">Nos bastidores</span><span class="sxs-lookup"><span data-stu-id="99ee8-142">Under the hood</span></span>

<span data-ttu-id="99ee8-143">O Proxy de Aplicativo do Azure AD consiste em duas partes:</span><span class="sxs-lookup"><span data-stu-id="99ee8-143">Azure AD Application Proxy consists of two parts:</span></span>

* <span data-ttu-id="99ee8-144">O serviço baseado em nuvem: este serviço é executado no Azure e é onde as conexões de cliente/usuário externo são feitas.</span><span class="sxs-lookup"><span data-stu-id="99ee8-144">The cloud-based service: This service runs in Azure, and is where the external client/user connections are made.</span></span>
* <span data-ttu-id="99ee8-145">[O conector local](application-proxy-understand-connectors.md): componente local, o conector escuta solicitações das conexões de serviço e identificadores de Proxy de Aplicativo do Azure AD para aplicativos internos.</span><span class="sxs-lookup"><span data-stu-id="99ee8-145">[The on-premises connector](application-proxy-understand-connectors.md): An on-premises component, the connector listens for requests from the Azure AD Application Proxy service and handles connections to the internal applications.</span></span> 

<span data-ttu-id="99ee8-146">Um fluxo entre o conector e o serviço de Proxy de Aplicativo é estabelecido quando:</span><span class="sxs-lookup"><span data-stu-id="99ee8-146">A flow between the connector and the Application Proxy service is established when:</span></span>

* <span data-ttu-id="99ee8-147">O conector é configurado pela primeira vez.</span><span class="sxs-lookup"><span data-stu-id="99ee8-147">The connector is first set up.</span></span>
* <span data-ttu-id="99ee8-148">O conector extrai informações de configuração do serviço de Proxy de Aplicativo.</span><span class="sxs-lookup"><span data-stu-id="99ee8-148">The connector pulls configuration information from the Application Proxy service.</span></span>
* <span data-ttu-id="99ee8-149">Um usuário acessa um aplicativo publicado.</span><span class="sxs-lookup"><span data-stu-id="99ee8-149">A user accesses a published application.</span></span>

>[!NOTE]
><span data-ttu-id="99ee8-150">Todas as comunicações ocorrem por SSL e sempre originam-se no conector para o serviço de Proxy de Aplicativo.</span><span class="sxs-lookup"><span data-stu-id="99ee8-150">All communications occur over SSL, and they always originate at the connector to the Application Proxy service.</span></span> <span data-ttu-id="99ee8-151">O serviço é apenas de saída.</span><span class="sxs-lookup"><span data-stu-id="99ee8-151">The service is outbound only.</span></span>

<span data-ttu-id="99ee8-152">O conector usa um certificado de cliente para autenticar o serviço de Proxy de Aplicativo para quase todas as chamadas.</span><span class="sxs-lookup"><span data-stu-id="99ee8-152">The connector uses a client certificate to authenticate to the Application Proxy service for nearly all calls.</span></span> <span data-ttu-id="99ee8-153">A única exceção deste processo é a etapa de configuração inicial em que o certificado de cliente é estabelecido.</span><span class="sxs-lookup"><span data-stu-id="99ee8-153">The only exception to this process is the initial setup step, where the client certificate is established.</span></span>

### <a name="installing-the-connector"></a><span data-ttu-id="99ee8-154">Instalação do conector</span><span class="sxs-lookup"><span data-stu-id="99ee8-154">Installing the connector</span></span>

<span data-ttu-id="99ee8-155">Quando o conector é configurado pela primeira vez, ocorrem os seguintes eventos de fluxo:</span><span class="sxs-lookup"><span data-stu-id="99ee8-155">When the connector is first set up, the following flow events take place:</span></span>

1. <span data-ttu-id="99ee8-156">O registro do conector para o serviço ocorre como parte da instalação do conector.</span><span class="sxs-lookup"><span data-stu-id="99ee8-156">The connector registration to the service happens as part of the installation of the connector.</span></span> <span data-ttu-id="99ee8-157">Os usuários são solicitados a digitar suas credenciais de administrador do Azure AD.</span><span class="sxs-lookup"><span data-stu-id="99ee8-157">Users are prompted to enter their Azure AD admin credentials.</span></span> <span data-ttu-id="99ee8-158">O token adquirido dessa autenticação é então apresentado ao serviço de Proxy de Aplicativo do Azure AD.</span><span class="sxs-lookup"><span data-stu-id="99ee8-158">The token acquired from this authentication is then presented to the Azure AD Application Proxy service.</span></span>
2. <span data-ttu-id="99ee8-159">O serviço de Proxy de Aplicativo avalia o token.</span><span class="sxs-lookup"><span data-stu-id="99ee8-159">The Application Proxy service evaluates the token.</span></span> <span data-ttu-id="99ee8-160">Isso garante que o usuário é um administrador da empresa no locatário para o qual o token foi emitido.</span><span class="sxs-lookup"><span data-stu-id="99ee8-160">It ensures that the user is a company administrator within the tenant that the token was issued for.</span></span> <span data-ttu-id="99ee8-161">Se o usuário não for um administrador, o processo será encerrado.</span><span class="sxs-lookup"><span data-stu-id="99ee8-161">If the user is not an administrator, the process is terminated.</span></span>
3. <span data-ttu-id="99ee8-162">O conector gera uma solicitação de certificado de cliente e a passa, juntamente com o token, para o serviço de Proxy de Aplicativo.</span><span class="sxs-lookup"><span data-stu-id="99ee8-162">The connector generates a client certificate request and passes it, along with the token, to the Application Proxy service.</span></span> <span data-ttu-id="99ee8-163">O serviço, por sua vez, verifica o token e faz a solicitação do certificado de cliente.</span><span class="sxs-lookup"><span data-stu-id="99ee8-163">The service in turn verifies the token and signs the client certificate request.</span></span>
4. <span data-ttu-id="99ee8-164">O conector usa o certificado de cliente para comunicação futura com o serviço de Proxy de Aplicativo.</span><span class="sxs-lookup"><span data-stu-id="99ee8-164">The connector uses the client certificate for future communication with the Application Proxy service.</span></span>
5. <span data-ttu-id="99ee8-165">O conector realiza uma extração inicial dos dados de configuração do sistema do serviço usando o respectivo certificado de cliente e está pronto para receber solicitações.</span><span class="sxs-lookup"><span data-stu-id="99ee8-165">The connector performs an initial pull of the system configuration data from the service using its client certificate, and it is now ready to take requests.</span></span>

### <a name="updating-the-configuration-settings"></a><span data-ttu-id="99ee8-166">Atualização das definições da configuração</span><span class="sxs-lookup"><span data-stu-id="99ee8-166">Updating the configuration settings</span></span>

<span data-ttu-id="99ee8-167">Sempre que o serviço de Proxy de Aplicativo atualiza as definições de configuração, ocorrem os seguintes eventos de fluxo:</span><span class="sxs-lookup"><span data-stu-id="99ee8-167">Whenever the Application Proxy service updates the configuration settings, the following flow events take place:</span></span>

1. <span data-ttu-id="99ee8-168">O conector se conecta ao ponto de extremidade de configuração no serviço de Proxy de Aplicativo usando seu certificado de cliente.</span><span class="sxs-lookup"><span data-stu-id="99ee8-168">The connector connects to the configuration endpoint within the Application Proxy service by using its client certificate.</span></span>
2. <span data-ttu-id="99ee8-169">Depois que o certificado de cliente tiver sido validado, o serviço de Proxy de Aplicativo retorna dados de configuração ao conector (por exemplo, o grupo de conectores do qual esse conector deve fazer parte).</span><span class="sxs-lookup"><span data-stu-id="99ee8-169">After the client certificate has been validated, the Application Proxy service returns configuration data to the connector (for example, the connector group that the connector should be part of).</span></span>
3. <span data-ttu-id="99ee8-170">Se o certificado atual tiver mais de 180 dias, o conector gerará uma nova solicitação de certificado, que atualiza efetivamente o certificado de cliente a cada 180 dias.</span><span class="sxs-lookup"><span data-stu-id="99ee8-170">If the current certificate is more than 180 days old, the connector generates a new certificate request, which effectively updates the client certificate every 180 days.</span></span>

### <a name="accessing-published-applications"></a><span data-ttu-id="99ee8-171">Acesso a aplicativos publicados</span><span class="sxs-lookup"><span data-stu-id="99ee8-171">Accessing published applications</span></span>

<span data-ttu-id="99ee8-172">Quando os usuários acessam um aplicativo publicado, os seguintes eventos ocorrem entre o serviço de Proxy de Aplicativo e o conector de Proxy de Aplicativo:</span><span class="sxs-lookup"><span data-stu-id="99ee8-172">When users access a published application, the following events take place between the Application Proxy service and the Application Proxy connector:</span></span>

1. [<span data-ttu-id="99ee8-173">O serviço autentica o usuário para o aplicativo</span><span class="sxs-lookup"><span data-stu-id="99ee8-173">The service authenticates the user for the app</span></span>](#the-service-checks-the-configuration-settings-for-the-app)
2. [<span data-ttu-id="99ee8-174">O serviço faz uma solicitação na fila do conector</span><span class="sxs-lookup"><span data-stu-id="99ee8-174">The service places a request in the connector queue</span></span>](#The-service-places-a-request-in-the-connector-queue)
3. [<span data-ttu-id="99ee8-175">Um conector processa a solicitação da fila</span><span class="sxs-lookup"><span data-stu-id="99ee8-175">A connector processes the request from the queue</span></span>](#the-connector-receives-the-request-from-the-queue)
4. [<span data-ttu-id="99ee8-176">O conector aguarda uma resposta</span><span class="sxs-lookup"><span data-stu-id="99ee8-176">The connector waits for a response</span></span>](#the-connector-waits-for-a-response)
5. [<span data-ttu-id="99ee8-177">O serviço transmite dados para o usuário</span><span class="sxs-lookup"><span data-stu-id="99ee8-177">The service streams data to the user</span></span>](#the-service-streams-data-to-the-user)

<span data-ttu-id="99ee8-178">Para saber mais sobre o que acontece em cada uma dessas etapas, continue lendo.</span><span class="sxs-lookup"><span data-stu-id="99ee8-178">To learn more about what takes place in each of these steps, keep reading.</span></span>


#### <a name="1-the-service-authenticates-the-user-for-the-app"></a><span data-ttu-id="99ee8-179">1. O serviço autentica o usuário para o aplicativo</span><span class="sxs-lookup"><span data-stu-id="99ee8-179">1. The service authenticates the user for the app</span></span>

<span data-ttu-id="99ee8-180">Se você configurou o aplicativo para usar Passagem como seu método de pré-autenticação, as etapas nesta seção são ignoradas.</span><span class="sxs-lookup"><span data-stu-id="99ee8-180">If you configured the app to use Passthrough as its preauthentication method, the steps in this section are skipped.</span></span>

<span data-ttu-id="99ee8-181">Se você configurou o aplicativo para pré-autenticar com o Azure AD, os usuários são redirecionados para o STS do Azure AD para autenticar e as seguintes etapas são executadas:</span><span class="sxs-lookup"><span data-stu-id="99ee8-181">If you configured the app to preauthenticate with Azure AD, users are redirected to the Azure AD STS to authenticate, and the following steps take place:</span></span>

1. <span data-ttu-id="99ee8-182">O Proxy de Aplicativo verifica todos os requisitos da política de acesso condicional para o aplicativo específico.</span><span class="sxs-lookup"><span data-stu-id="99ee8-182">Application Proxy checks for any conditional access policy requirements for the specific application.</span></span> <span data-ttu-id="99ee8-183">Esta etapa garante que o usuário foi atribuído ao aplicativo.</span><span class="sxs-lookup"><span data-stu-id="99ee8-183">This step ensures that the user has been assigned to the application.</span></span> <span data-ttu-id="99ee8-184">Se uma verificação em duas etapas for necessária, a sequência de autenticação solicitará ao usuário um segundo método de autenticação.</span><span class="sxs-lookup"><span data-stu-id="99ee8-184">If two-step verification is required, the authentication sequence prompts the user for a second authentication method.</span></span>

2. <span data-ttu-id="99ee8-185">Depois de realizadas todas as verificações, o STS do Azure AD emite um token assinado para o aplicativo e redireciona o usuário de volta ao serviço de Proxy de Aplicativo.</span><span class="sxs-lookup"><span data-stu-id="99ee8-185">After all checks have passed, the Azure AD STS issues a signed token for the application and redirects the user back to the Application Proxy service.</span></span>

3. <span data-ttu-id="99ee8-186">O Proxy de Aplicativo verifica se o token foi emitido para corrigir o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="99ee8-186">Application Proxy verifies that the token was issued to correct the application.</span></span> <span data-ttu-id="99ee8-187">Ele também faz outras verificações, como ao garantir que o token foi assinado pelo Azure AD, e que ainda está dentro da janela de validade.</span><span class="sxs-lookup"><span data-stu-id="99ee8-187">It performs other checks also, such as ensuring that the token was signed by Azure AD, and that it is still within the valid window.</span></span>

4. <span data-ttu-id="99ee8-188">O Proxy de Aplicativo define um cookie de autenticação criptografado para indicar que a autenticação para o aplicativo ocorreu.</span><span class="sxs-lookup"><span data-stu-id="99ee8-188">Application Proxy sets an encrypted authentication cookie to indicate that authentication to the application has occurred.</span></span> <span data-ttu-id="99ee8-189">Esse cookie inclui um carimbo de data/hora de expiração com base no token do Azure AD e outros dados, como o nome do usuário na qual se baseia a autenticação.</span><span class="sxs-lookup"><span data-stu-id="99ee8-189">The cookie includes an expiration timestamp that's based on the token from Azure AD and other data, such as the user name that the authentication is based on.</span></span> <span data-ttu-id="99ee8-190">O cookie é criptografado com uma chave privada conhecida apenas pelo serviço de Proxy de Aplicativo.</span><span class="sxs-lookup"><span data-stu-id="99ee8-190">The cookie is encrypted with a private key known only to the Application Proxy service.</span></span>

5. <span data-ttu-id="99ee8-191">O Proxy de Aplicativo redireciona o usuário de volta para a URL originalmente solicitada.</span><span class="sxs-lookup"><span data-stu-id="99ee8-191">Application Proxy redirects the user back to the originally requested URL.</span></span>

<span data-ttu-id="99ee8-192">Se qualquer parte das etapas da pré-autenticação falhar, a solicitação do usuário será negada e o usuário verá uma mensagem indicando a origem do problema.</span><span class="sxs-lookup"><span data-stu-id="99ee8-192">If any part of the preauthentication steps fails, the user’s request is denied, and the user is shown a message indicating the source of the problem.</span></span>


#### <a name="2-the-service-places-a-request-in-the-connector-queue"></a><span data-ttu-id="99ee8-193">2. O serviço faz uma solicitação na fila do conector</span><span class="sxs-lookup"><span data-stu-id="99ee8-193">2. The service places a request in the connector queue</span></span>

<span data-ttu-id="99ee8-194">Os conectores mantêm uma conexão de saída aberta ao serviço de Proxy de Aplicativo.</span><span class="sxs-lookup"><span data-stu-id="99ee8-194">Connectors keep an outbound connection open to the Application Proxy service.</span></span> <span data-ttu-id="99ee8-195">Quando uma solicitação chega, o serviço enfileira a solicitação em uma das conexões abertas para escolha do conector.</span><span class="sxs-lookup"><span data-stu-id="99ee8-195">When a request comes in, the service queues up the request on one of the open connections for the connector to pick up.</span></span>

<span data-ttu-id="99ee8-196">A solicitação inclui itens do aplicativo, como os cabeçalhos da solicitação, os dados do cookie criptografado, o usuário que faz a solicitação e a ID de solicitação.</span><span class="sxs-lookup"><span data-stu-id="99ee8-196">The request includes items from the application, such as the request headers, data from the encrypted cookie, the user making the request, and the request ID.</span></span> <span data-ttu-id="99ee8-197">Embora os dados do cookie criptografado sejam enviados com a solicitação, o cookie de autenticação não é.</span><span class="sxs-lookup"><span data-stu-id="99ee8-197">Although data from the encrypted cookie is sent with the request, the authentication cookie itself is not.</span></span>

#### <a name="3-the-connector-processes-the-request-from-the-queue"></a><span data-ttu-id="99ee8-198">3. O conector processa a solicitação da fila.</span><span class="sxs-lookup"><span data-stu-id="99ee8-198">3. The connector processes the request from the queue.</span></span> 

<span data-ttu-id="99ee8-199">Com base na solicitação, o Proxy de Aplicativo executa uma das seguintes ações:</span><span class="sxs-lookup"><span data-stu-id="99ee8-199">Based on the request, Application Proxy performs one of the following actions:</span></span>

* <span data-ttu-id="99ee8-200">Se a solicitação for uma operação simples (por exemplo, não há dados no corpo como acontece com uma solicitação *GET* RESTful), o conector fará uma conexão com o recurso interno de destino e aguardará uma resposta.</span><span class="sxs-lookup"><span data-stu-id="99ee8-200">If the request is a simple operation (for example, there is no data within the body as is with a RESTful *GET* request), the connector makes a connection to the target internal resource and then waits for a response.</span></span>

* <span data-ttu-id="99ee8-201">Se a solicitação tiver dados associados a ela no corpo, por exemplo, uma operação *POST* RESTful, o conector fará uma conexão de saída usando o certificado de cliente com a instância do Proxy de Aplicativo.</span><span class="sxs-lookup"><span data-stu-id="99ee8-201">If the request has data associated with it in the body (for example, a RESTful *POST* operation), the connector makes an outbound connection by using the client certificate to the Application Proxy instance.</span></span> <span data-ttu-id="99ee8-202">Ele faz essa conexão para solicitar os dados e abrir uma conexão com o recurso interno.</span><span class="sxs-lookup"><span data-stu-id="99ee8-202">It makes this connection to request the data and open a connection to the internal resource.</span></span> <span data-ttu-id="99ee8-203">No recebimento da solicitação do conector, o serviço de Proxy de Aplicativo começa aceitando o conteúdo do usuário e encaminha os dados ao conector.</span><span class="sxs-lookup"><span data-stu-id="99ee8-203">After it receives the request from the connector, the Application Proxy service begins accepting content from the user and forwards data to the connector.</span></span> <span data-ttu-id="99ee8-204">O conector, por sua vez, encaminha os dados para o recurso interno.</span><span class="sxs-lookup"><span data-stu-id="99ee8-204">The connector, in turn, forwards the data to the internal resource.</span></span>

#### <a name="4-the-connector-waits-for-a-response"></a><span data-ttu-id="99ee8-205">4. O conector aguarda uma resposta.</span><span class="sxs-lookup"><span data-stu-id="99ee8-205">4. The connector waits for a response.</span></span>

<span data-ttu-id="99ee8-206">Depois de concluída a solicitação/transmissão de todo o conteúdo ao back-end, o conector espera uma resposta.</span><span class="sxs-lookup"><span data-stu-id="99ee8-206">After the request and transmission of all content to the back end is complete, the connector waits for a response.</span></span>

<span data-ttu-id="99ee8-207">Depois de receber a resposta, o conector faz uma conexão de saída com o serviço de Proxy de Aplicativo para retornar os detalhes do cabeçalho e iniciar a transmissão dos dados de retorno.</span><span class="sxs-lookup"><span data-stu-id="99ee8-207">After it receives a response, the connector makes an outbound connection to the Application Proxy service, to return the header details and begin streaming the return data.</span></span>

#### <a name="5-the-service-streams-data-to-the-user"></a><span data-ttu-id="99ee8-208">5. O serviço transmite dados para o usuário.</span><span class="sxs-lookup"><span data-stu-id="99ee8-208">5. The service streams data to the user.</span></span> 

<span data-ttu-id="99ee8-209">Algum processamento do aplicativo pode ocorrer aqui.</span><span class="sxs-lookup"><span data-stu-id="99ee8-209">Some processing of the application may occur here.</span></span> <span data-ttu-id="99ee8-210">Se você configurou o Proxy de Aplicativo para converter cabeçalhos ou URLs em seu aplicativo, esse processamento ocorre conforme necessário durante esta etapa.</span><span class="sxs-lookup"><span data-stu-id="99ee8-210">If you configured Application Proxy to translate headers or URLs in your application, that processing happens as needed during this step.</span></span>


## <a name="next-steps"></a><span data-ttu-id="99ee8-211">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="99ee8-211">Next steps</span></span>

[<span data-ttu-id="99ee8-212">Considerações de topologia de rede ao usar o Proxy de Aplicativo do Azure AD</span><span class="sxs-lookup"><span data-stu-id="99ee8-212">Network topology considerations when using Azure AD Application Proxy</span></span>](application-proxy-network-topology-considerations.md)

[<span data-ttu-id="99ee8-213">Noções básicas sobre conectores de Proxy de Aplicativo do Azure AD</span><span class="sxs-lookup"><span data-stu-id="99ee8-213">Understand Azure AD Application Proxy connectors</span></span>](application-proxy-understand-connectors.md)
