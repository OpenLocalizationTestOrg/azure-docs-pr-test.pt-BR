---
title: "renovação de aaaCertificate para os usuários do Office 365 e o Azure AD | Microsoft Docs"
description: "Este artigo explica tooOffice 365 usuários como tooresolve problemas de emails que notificação-lo sobre como renovar um certificado."
services: active-directory
documentationcenter: 
author: billmath
manager: femila
editor: curtand
ms.assetid: 543b7dc1-ccc9-407f-85a1-a9944c0ba1be
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/12/2017
ms.author: billmath
ms.openlocfilehash: b9b309e06949dc5488cd628650be413f366ed347
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="renew-federation-certificates-for-office-365-and-azure-active-directory"></a><span data-ttu-id="0583a-103">Renovar certificados de federação para o Office 365 e o Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="0583a-103">Renew federation certificates for Office 365 and Azure Active Directory</span></span>
## <a name="overview"></a><span data-ttu-id="0583a-104">Visão geral</span><span class="sxs-lookup"><span data-stu-id="0583a-104">Overview</span></span>
<span data-ttu-id="0583a-105">Para federação bem-sucedida entre o Azure Active Directory (AD do Azure) e os serviços de Federação do Active Directory (AD FS), certificados de saudação usados por tooAzure de tokens de segurança do AD FS toosign AD devem corresponder a que está configurado no AD do Azure.</span><span class="sxs-lookup"><span data-stu-id="0583a-105">For successful federation between Azure Active Directory (Azure AD) and Active Directory Federation Services (AD FS), hello certificates used by AD FS toosign security tokens tooAzure AD should match what is configured in Azure AD.</span></span> <span data-ttu-id="0583a-106">Qualquer incompatibilidade pode levar toobroken confiança.</span><span class="sxs-lookup"><span data-stu-id="0583a-106">Any mismatch can lead toobroken trust.</span></span> <span data-ttu-id="0583a-107">O Azure AD garante que essas informações sejam mantidas em sincronia quando você implanta o AD FS e o Proxy de Aplicativo Web (para acesso à extranet).</span><span class="sxs-lookup"><span data-stu-id="0583a-107">Azure AD ensures that this information is kept in sync when you deploy AD FS and Web Application Proxy (for extranet access).</span></span>

<span data-ttu-id="0583a-108">Este artigo fornece a você informações adicionais toomanage seu certificados de assinatura de token e mantê-los em sincronia com o AD do Azure, em Olá casos a seguir:</span><span class="sxs-lookup"><span data-stu-id="0583a-108">This article provides you additional information toomanage your token signing certificates and keep them in sync with Azure AD, in hello following cases:</span></span>

* <span data-ttu-id="0583a-109">Você não está implantando Olá Proxy de aplicativo Web e, portanto, não estão disponível no Olá extranet de metadados de Federação Olá.</span><span class="sxs-lookup"><span data-stu-id="0583a-109">You are not deploying hello Web Application Proxy, and therefore hello federation metadata is not available in hello extranet.</span></span>
* <span data-ttu-id="0583a-110">Você não estiver usando a configuração padrão de saudação do AD FS para certificados de assinatura de token.</span><span class="sxs-lookup"><span data-stu-id="0583a-110">You are not using hello default configuration of AD FS for token signing certificates.</span></span>
* <span data-ttu-id="0583a-111">Você está usando um provedor de identidade de terceiros.</span><span class="sxs-lookup"><span data-stu-id="0583a-111">You are using a third-party identity provider.</span></span>

## <a name="default-configuration-of-ad-fs-for-token-signing-certificates"></a><span data-ttu-id="0583a-112">Configuração padrão do AD FS para certificados de assinatura de token</span><span class="sxs-lookup"><span data-stu-id="0583a-112">Default configuration of AD FS for token signing certificates</span></span>
<span data-ttu-id="0583a-113">assinatura de token Hello e certificados de descriptografia de token são normalmente os certificados autoassinados e são bons para um ano.</span><span class="sxs-lookup"><span data-stu-id="0583a-113">hello token signing and token decrypting certificates are usually self-signed certificates, and are good for one year.</span></span> <span data-ttu-id="0583a-114">Por padrão, o AD FS inclui um processo de renovação automática chamado **AutoCertificateRollover**.</span><span class="sxs-lookup"><span data-stu-id="0583a-114">By default, AD FS includes an auto-renewal process called **AutoCertificateRollover**.</span></span> <span data-ttu-id="0583a-115">Se você estiver usando o AD FS 2.0 ou posterior, o Office 365 e o Azure AD atualizarão automaticamente o certificado antes que ele expire.</span><span class="sxs-lookup"><span data-stu-id="0583a-115">If you are using AD FS 2.0 or later, Office 365 and Azure AD automatically update your certificate before it expires.</span></span>

### <a name="renewal-notification-from-hello-office-365-portal-or-an-email"></a><span data-ttu-id="0583a-116">Notificação de renovação do portal do Office 365 de saudação ou um email</span><span class="sxs-lookup"><span data-stu-id="0583a-116">Renewal notification from hello Office 365 portal or an email</span></span>
> [!NOTE]
> <span data-ttu-id="0583a-117">Se você recebeu um email ou uma notificação portal solicitando que você toorenew seu certificado para o Office, consulte [Gerenciando alterações tootoken certificados de assinatura](#managecerts) toocheck se você precisar tootake qualquer ação.</span><span class="sxs-lookup"><span data-stu-id="0583a-117">If you received an email or a portal notification asking you toorenew your certificate for Office, see [Managing changes tootoken signing certificates](#managecerts) toocheck if you need tootake any action.</span></span> <span data-ttu-id="0583a-118">A Microsoft está ciente de um possível problema que pode levar toonotifications para renovação de certificados que estão sendo enviada, mesmo quando nenhuma ação é necessária.</span><span class="sxs-lookup"><span data-stu-id="0583a-118">Microsoft is aware of a possible issue that can lead toonotifications for certificate renewal being sent, even when no action is required.</span></span>
>
>

<span data-ttu-id="0583a-119">AD do Azure tentativas de metadados de Federação toomonitor hello e atualização Olá token certificados de assinatura, conforme indicado por esses metadados.</span><span class="sxs-lookup"><span data-stu-id="0583a-119">Azure AD attempts toomonitor hello federation metadata, and update hello token signing certificates as indicated by this metadata.</span></span> <span data-ttu-id="0583a-120">30 dias antes da expiração de saudação do token Olá certificados de assinatura, o AD do Azure verifica se novos certificados disponíveis consultando metadados de Federação hello.</span><span class="sxs-lookup"><span data-stu-id="0583a-120">30 days before hello expiration of hello token signing certificates, Azure AD checks if new certificates are available by polling hello federation metadata.</span></span>

* <span data-ttu-id="0583a-121">Se ele pode sondar Olá metadados de Federação e recuperar certificados novos Olá com êxito, nenhuma notificação por email ou o aviso no portal do Office 365 de saudação é emitido toohello usuário.</span><span class="sxs-lookup"><span data-stu-id="0583a-121">If it can successfully poll hello federation metadata and retrieve hello new certificates, no email notification or warning in hello Office 365 portal is issued toohello user.</span></span>
* <span data-ttu-id="0583a-122">Se não for possível recuperar certificados de assinatura do token novo hello, ou porque os metadados de Federação Olá não estão acessível ou substituição automática de certificado não estiver habilitada, Azure AD emite uma notificação por email e um aviso no portal do Office 365 de saudação.</span><span class="sxs-lookup"><span data-stu-id="0583a-122">If it cannot retrieve hello new token signing certificates, either because hello federation metadata is not reachable or automatic certificate rollover is not enabled, Azure AD issues an email notification and a warning in hello Office 365 portal.</span></span>

![Notificação do portal do Office 365](./media/active-directory-aadconnect-o365-certs/notification.png)

> [!IMPORTANT]
> <span data-ttu-id="0583a-124">Se você estiver usando o AD FS, continuidade de negócios tooensure, verifique se os servidores possuem Olá atualizações a seguir para que não ocorram falhas de autenticação para problemas conhecidos.</span><span class="sxs-lookup"><span data-stu-id="0583a-124">If you are using AD FS, tooensure business continuity, please verify that your servers have hello following updates so that authentication failures for known issues do not occur.</span></span> <span data-ttu-id="0583a-125">Isso reduz os problemas conhecidos de servidor de proxy do AD FS para essa renovação e períodos futuros de renovação:</span><span class="sxs-lookup"><span data-stu-id="0583a-125">This mitigates known AD FS proxy server issues for this renewal and future renewal periods:</span></span>
>
> <span data-ttu-id="0583a-126">Server 2012 R2 - [Pacote cumulativo de atualizações do Windows Server de maio de 2014](http://support.microsoft.com/kb/2955164)</span><span class="sxs-lookup"><span data-stu-id="0583a-126">Server 2012 R2 - [Windows Server May 2014 rollup](http://support.microsoft.com/kb/2955164)</span></span>
>
> <span data-ttu-id="0583a-127">Server 2008 R2 e 2012 - [falha de autenticação por meio do proxy no Windows Server 2008 ou no Windows 2012 R2 SP1](http://support.microsoft.com/kb/3094446)</span><span class="sxs-lookup"><span data-stu-id="0583a-127">Server 2008 R2 and 2012 - [Authentication through proxy fails in Windows Server 2012 or Windows 2008 R2 SP1](http://support.microsoft.com/kb/3094446)</span></span>
>
>

## <span data-ttu-id="0583a-128">Verifique se os certificados de saudação necessário toobe atualizado<a name="managecerts"></a></span><span class="sxs-lookup"><span data-stu-id="0583a-128">Check if hello certificates need toobe updated <a name="managecerts"></a></span></span>
### <a name="step-1-check-hello-autocertificaterollover-state"></a><span data-ttu-id="0583a-129">Etapa 1: Verificar o estado de AutoCertificateRollover Olá</span><span class="sxs-lookup"><span data-stu-id="0583a-129">Step 1: Check hello AutoCertificateRollover state</span></span>
<span data-ttu-id="0583a-130">No servidor do AD FS, abra o PowerShell.</span><span class="sxs-lookup"><span data-stu-id="0583a-130">On your AD FS server, open PowerShell.</span></span> <span data-ttu-id="0583a-131">Verifique se o valor de AutoCertificateRollover Olá é definida tooTrue.</span><span class="sxs-lookup"><span data-stu-id="0583a-131">Check that hello AutoCertificateRollover value is set tooTrue.</span></span>

    Get-Adfsproperties

![AutoCertificateRollover](./media/active-directory-aadconnect-o365-certs/autocertrollover.png)

>[!NOTE] 
><span data-ttu-id="0583a-133">Se você estiver usando o AD FS 2.0, primeiro execute Add-Pssnapin Microsoft.Adfs.Powershell.</span><span class="sxs-lookup"><span data-stu-id="0583a-133">If you are using AD FS 2.0, first run Add-Pssnapin Microsoft.Adfs.Powershell.</span></span>

### <a name="step-2-confirm-that-ad-fs-and-azure-ad-are-in-sync"></a><span data-ttu-id="0583a-134">Etapa 2: confirmar se o AD FS e o Azure AD estão em sincronia</span><span class="sxs-lookup"><span data-stu-id="0583a-134">Step 2: Confirm that AD FS and Azure AD are in sync</span></span>
<span data-ttu-id="0583a-135">No servidor do AD FS, abra o prompt do PowerShell do Azure AD hello e conecte tooAzure AD.</span><span class="sxs-lookup"><span data-stu-id="0583a-135">On your AD FS server, open hello Azure AD PowerShell prompt, and connect tooAzure AD.</span></span>

> [!NOTE]
> <span data-ttu-id="0583a-136">Você pode baixar o PowerShell do Azure AD [aqui](https://technet.microsoft.com/library/jj151815.aspx).</span><span class="sxs-lookup"><span data-stu-id="0583a-136">You can download Azure AD PowerShell [here](https://technet.microsoft.com/library/jj151815.aspx).</span></span>
>
>

    Connect-MsolService

<span data-ttu-id="0583a-137">Verificar certificados Olá configurado no AD FS e propriedades de confiança do AD do Azure para Olá o domínio especificaram.</span><span class="sxs-lookup"><span data-stu-id="0583a-137">Check hello certificates configured in AD FS and Azure AD trust properties for hello specified domain.</span></span>

    Get-MsolFederationProperty -DomainName <domain.name> | FL Source, TokenSigningCertificate

![Get-MsolFederationProperty](./media/active-directory-aadconnect-o365-certs/certsync.png)

<span data-ttu-id="0583a-139">Se as impressões digitais de saudação no hello saídas de correspondência, seus certificados são sincronizados com o Azure AD.</span><span class="sxs-lookup"><span data-stu-id="0583a-139">If hello thumbprints in both hello outputs match, your certificates are in sync with Azure AD.</span></span>

### <a name="step-3-check-if-your-certificate-is-about-tooexpire"></a><span data-ttu-id="0583a-140">Etapa 3: Verificar se o certificado está prestes a tooexpire</span><span class="sxs-lookup"><span data-stu-id="0583a-140">Step 3: Check if your certificate is about tooexpire</span></span>
<span data-ttu-id="0583a-141">Na saída de saudação do Get-MsolFederationProperty ou Get-AdfsCertificate, verifique se a data Olá em "Não depois."</span><span class="sxs-lookup"><span data-stu-id="0583a-141">In hello output of either Get-MsolFederationProperty or Get-AdfsCertificate, check for hello date under "Not After."</span></span> <span data-ttu-id="0583a-142">Se a data de saudação é menos de 30 dias imediatamente, você deve tomar uma ação.</span><span class="sxs-lookup"><span data-stu-id="0583a-142">If hello date is less than 30 days away, you should take action.</span></span>

| <span data-ttu-id="0583a-143">AutoCertificateRollover</span><span class="sxs-lookup"><span data-stu-id="0583a-143">AutoCertificateRollover</span></span> | <span data-ttu-id="0583a-144">Certificados em sincronia com o Azure AD</span><span class="sxs-lookup"><span data-stu-id="0583a-144">Certificates in sync with Azure AD</span></span> | <span data-ttu-id="0583a-145">Os metadados de federação do AD FS estão acessíveis publicamente</span><span class="sxs-lookup"><span data-stu-id="0583a-145">Federation metadata is publicly accessible</span></span> | <span data-ttu-id="0583a-146">Validade</span><span class="sxs-lookup"><span data-stu-id="0583a-146">Validity</span></span> | <span data-ttu-id="0583a-147">Ação</span><span class="sxs-lookup"><span data-stu-id="0583a-147">Action</span></span> |
|:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="0583a-148">Sim</span><span class="sxs-lookup"><span data-stu-id="0583a-148">Yes</span></span> |<span data-ttu-id="0583a-149">Sim</span><span class="sxs-lookup"><span data-stu-id="0583a-149">Yes</span></span> |<span data-ttu-id="0583a-150">Sim</span><span class="sxs-lookup"><span data-stu-id="0583a-150">Yes</span></span> |- |<span data-ttu-id="0583a-151">Nenhuma ação necessária.</span><span class="sxs-lookup"><span data-stu-id="0583a-151">No action needed.</span></span> <span data-ttu-id="0583a-152">Confira [Renovar o certificado de assinatura de token automaticamente](#autorenew).</span><span class="sxs-lookup"><span data-stu-id="0583a-152">See [Renew token signing certificate automatically](#autorenew).</span></span> |
| <span data-ttu-id="0583a-153">Sim</span><span class="sxs-lookup"><span data-stu-id="0583a-153">Yes</span></span> |<span data-ttu-id="0583a-154">Não</span><span class="sxs-lookup"><span data-stu-id="0583a-154">No</span></span> |- |<span data-ttu-id="0583a-155">Menos de 15 dias</span><span class="sxs-lookup"><span data-stu-id="0583a-155">Less than 15 days</span></span> |<span data-ttu-id="0583a-156">Renovar imediatamente.</span><span class="sxs-lookup"><span data-stu-id="0583a-156">Renew immediately.</span></span> <span data-ttu-id="0583a-157">Confira [Renovar manualmente o certificado de assinatura de token ](#manualrenew).</span><span class="sxs-lookup"><span data-stu-id="0583a-157">See [Renew token signing certificate manually](#manualrenew).</span></span> |
| <span data-ttu-id="0583a-158">Não</span><span class="sxs-lookup"><span data-stu-id="0583a-158">No</span></span> |- |- |<span data-ttu-id="0583a-159">Menos de 30 dias</span><span class="sxs-lookup"><span data-stu-id="0583a-159">Less than 30 days</span></span> |<span data-ttu-id="0583a-160">Renovar imediatamente.</span><span class="sxs-lookup"><span data-stu-id="0583a-160">Renew immediately.</span></span> <span data-ttu-id="0583a-161">Confira [Renovar manualmente o certificado de assinatura de token ](#manualrenew).</span><span class="sxs-lookup"><span data-stu-id="0583a-161">See [Renew token signing certificate manually](#manualrenew).</span></span> |

<span data-ttu-id="0583a-162">\[-] Não importa</span><span class="sxs-lookup"><span data-stu-id="0583a-162">\[-]  Does not matter</span></span>

## <span data-ttu-id="0583a-163">Renove automaticamente o certificado de assinatura de token de saudação (recomendado)<a name="autorenew"></a></span><span class="sxs-lookup"><span data-stu-id="0583a-163">Renew hello token signing certificate automatically (recommended) <a name="autorenew"></a></span></span>
<span data-ttu-id="0583a-164">Você não precisa tooperform todas as etapas manuais se as seguinte Olá forem verdadeiras:</span><span class="sxs-lookup"><span data-stu-id="0583a-164">You don't need tooperform any manual steps if both of hello following are true:</span></span>

* <span data-ttu-id="0583a-165">Você implantou o Proxy de aplicativo Web, permitindo acesso toohello metadados de federação de saudação à extranet.</span><span class="sxs-lookup"><span data-stu-id="0583a-165">You have deployed Web Application Proxy, which can enable access toohello federation metadata from hello extranet.</span></span>
* <span data-ttu-id="0583a-166">Você está usando a configuração padrão de saudação do AD FS (AutoCertificateRollover está habilitado).</span><span class="sxs-lookup"><span data-stu-id="0583a-166">You are using hello AD FS default configuration (AutoCertificateRollover is enabled).</span></span>

<span data-ttu-id="0583a-167">Verifique a saudação tooconfirm que Olá certificado a seguir pode ser atualizada automaticamente.</span><span class="sxs-lookup"><span data-stu-id="0583a-167">Check hello following tooconfirm that hello certificate can be automatically updated.</span></span>

<span data-ttu-id="0583a-168">**1. Olá propriedade do AD FS AutoCertificateRollover deve ser definido como tooTrue.**</span><span class="sxs-lookup"><span data-stu-id="0583a-168">**1. hello AD FS property AutoCertificateRollover must be set tooTrue.**</span></span> <span data-ttu-id="0583a-169">Isso indica que o AD FS gerará automaticamente novo token de assinatura e certificados de descriptografia de token, antes de saudação antigo aqueles expirarem.</span><span class="sxs-lookup"><span data-stu-id="0583a-169">This indicates that AD FS will automatically generate new token signing and token decryption certificates, before hello old ones expire.</span></span>

<span data-ttu-id="0583a-170">**2. metadados de Federação Olá AD FS são publicamente acessível.**</span><span class="sxs-lookup"><span data-stu-id="0583a-170">**2. hello AD FS federation metadata is publicly accessible.**</span></span> <span data-ttu-id="0583a-171">Verifique se os metadados de Federação estão publicamente acessível navegando toohello seguindo a URL de um computador na Olá internet pública (fora da rede corporativa da saudação):</span><span class="sxs-lookup"><span data-stu-id="0583a-171">Check that your federation metadata is publicly accessible by navigating toohello following URL from a computer on hello public internet (off of hello corporate network):</span></span>

<span data-ttu-id="0583a-172">https://(your_FS_name)/federationmetadata/2007-06/federationmetadata.xml</span><span class="sxs-lookup"><span data-stu-id="0583a-172">https://(your_FS_name)/federationmetadata/2007-06/federationmetadata.xml</span></span>

<span data-ttu-id="0583a-173">onde `(your_FS_name) `é substituído pelo nome de host do hello federação serviço sua organização usa, por exemplo, fs.contoso.com.  Se você for capaz de tooverify dessas configurações com êxito, você não tem toodo qualquer outra coisa.</span><span class="sxs-lookup"><span data-stu-id="0583a-173">where `(your_FS_name) `is replaced with hello federation service host name your organization uses, such as fs.contoso.com.  If you are able tooverify both of these settings successfully, you do not have toodo anything else.</span></span>  

<span data-ttu-id="0583a-174">Exemplo: https://fs.contoso.com/federationmetadata/2007-06/federationmetadata.xml</span><span class="sxs-lookup"><span data-stu-id="0583a-174">Example: https://fs.contoso.com/federationmetadata/2007-06/federationmetadata.xml</span></span>

## <span data-ttu-id="0583a-175">Renovar manualmente o certificado de assinatura de token de saudação<a name="manualrenew"></a></span><span class="sxs-lookup"><span data-stu-id="0583a-175">Renew hello token signing certificate manually <a name="manualrenew"></a></span></span>
<span data-ttu-id="0583a-176">Você pode escolher toorenew certificados de assinatura de token Olá manualmente.</span><span class="sxs-lookup"><span data-stu-id="0583a-176">You may choose toorenew hello token signing certificates manually.</span></span> <span data-ttu-id="0583a-177">Por exemplo, hello cenários a seguir podem funcionar melhor para a renovação manual:</span><span class="sxs-lookup"><span data-stu-id="0583a-177">For example, hello following scenarios might work better for manual renewal:</span></span>

* <span data-ttu-id="0583a-178">Os certificados de assinatura de token não são certificados autoassinados.</span><span class="sxs-lookup"><span data-stu-id="0583a-178">Token signing certificates are not self-signed certificates.</span></span> <span data-ttu-id="0583a-179">motivo mais comum de saudação para isso é que sua organização gerencia certificados do AD FS registrados de uma autoridade de certificação organizacional.</span><span class="sxs-lookup"><span data-stu-id="0583a-179">hello most common reason for this is that your organization manages AD FS certificates enrolled from an organizational certificate authority.</span></span>
* <span data-ttu-id="0583a-180">Segurança de rede não permite toobe de metadados de federação de saudação publicamente disponível.</span><span class="sxs-lookup"><span data-stu-id="0583a-180">Network security does not allow hello federation metadata toobe publicly available.</span></span>

<span data-ttu-id="0583a-181">Nesses cenários, toda vez que você atualizar o token Olá certificados de assinatura, você deve também atualizar seu domínio do Office 365 usando o comando do PowerShell hello, Update-MsolFederatedDomain.</span><span class="sxs-lookup"><span data-stu-id="0583a-181">In these scenarios, every time you update hello token signing certificates, you must also update your Office 365 domain by using hello PowerShell command, Update-MsolFederatedDomain.</span></span>

### <a name="step-1-ensure-that-ad-fs-has-new-token-signing-certificates"></a><span data-ttu-id="0583a-182">Etapa 1: verifique se o AD FS tem novos certificados de assinatura de token</span><span class="sxs-lookup"><span data-stu-id="0583a-182">Step 1: Ensure that AD FS has new token signing certificates</span></span>
<span data-ttu-id="0583a-183">**Configuração não padrão**</span><span class="sxs-lookup"><span data-stu-id="0583a-183">**Non-default configuration**</span></span>

<span data-ttu-id="0583a-184">Se você estiver usando uma configuração não padrão do AD FS (onde **AutoCertificateRollover** está definido muito**False**), você provavelmente está usando certificados personalizados (não autoassinados).</span><span class="sxs-lookup"><span data-stu-id="0583a-184">If you are using a non-default configuration of AD FS (where **AutoCertificateRollover** is set too**False**), you are probably using custom certificates (not self-signed).</span></span> <span data-ttu-id="0583a-185">Para obter mais informações sobre como os certificados de autenticação token do toorenew Olá AD FS, consulte [orientação para os clientes usando o AD FS não certificados autoassinados](https://msdn.microsoft.com/library/azure/JJ933264.aspx#BKMK_NotADFSCert).</span><span class="sxs-lookup"><span data-stu-id="0583a-185">For more information about how toorenew hello AD FS token signing certificates, see [Guidance for customers not using AD FS self-signed certificates](https://msdn.microsoft.com/library/azure/JJ933264.aspx#BKMK_NotADFSCert).</span></span>

<span data-ttu-id="0583a-186">**Os metadados de federação não estão disponíveis publicamente**</span><span class="sxs-lookup"><span data-stu-id="0583a-186">**Federation metadata is not publicly available**</span></span>

<span data-ttu-id="0583a-187">Olá por outro lado, se **AutoCertificateRollover** está definido muito**True**, mas seus metadados de Federação não estão acessível publicamente, primeiro certifique-se de que os novos certificados de assinatura de token foram gerados pelo AD FS.</span><span class="sxs-lookup"><span data-stu-id="0583a-187">On hello other hand, if **AutoCertificateRollover** is set too**True**, but your federation metadata is not publicly accessible, first make sure that new token signing certificates have been generated by AD FS.</span></span> <span data-ttu-id="0583a-188">Confirme que você tem o novo token assinando certificados Olá colocar as etapas a seguir:</span><span class="sxs-lookup"><span data-stu-id="0583a-188">Confirm you have new token signing certificates by taking hello following steps:</span></span>

1. <span data-ttu-id="0583a-189">Verifique se que você está conectado no servidor do toohello primário AD FS.</span><span class="sxs-lookup"><span data-stu-id="0583a-189">Verify that you are logged on toohello primary AD FS server.</span></span>
2. <span data-ttu-id="0583a-190">Verifique se os certificados de assinatura atual Olá no AD FS, abrindo uma janela de comando do PowerShell e executando Olá comando a seguir:</span><span class="sxs-lookup"><span data-stu-id="0583a-190">Check hello current signing certificates in AD FS by opening a PowerShell command window, and running hello following command:</span></span>

    <span data-ttu-id="0583a-191">PS C:\>Get-ADFSCertificate –CertificateType token-signing</span><span class="sxs-lookup"><span data-stu-id="0583a-191">PS C:\>Get-ADFSCertificate –CertificateType token-signing</span></span>

   > [!NOTE]
   > <span data-ttu-id="0583a-192">Se estiver usando o AD FS 2.0, você deverá executar Add-Pssnapin Microsoft.Adfs.Powershell primeiro.</span><span class="sxs-lookup"><span data-stu-id="0583a-192">If you are using AD FS 2.0, you should run Add-Pssnapin Microsoft.Adfs.Powershell first.</span></span>
   >
   >
3. <span data-ttu-id="0583a-193">Examine a saída do comando Olá em todos os certificados listados.</span><span class="sxs-lookup"><span data-stu-id="0583a-193">Look at hello command output at any certificates listed.</span></span> <span data-ttu-id="0583a-194">Se o AD FS gerou um novo certificado, você deverá ver dois certificados na saída de hello: uma para a qual Olá **IsPrimary** valor é **True** e hello **NotAfter** data é dentro de 5 dias e um para o qual **IsPrimary** é **False** e **NotAfter** é cerca de um ano em Olá futuras.</span><span class="sxs-lookup"><span data-stu-id="0583a-194">If AD FS has generated a new certificate, you should see two certificates in hello output: one for which hello **IsPrimary** value is **True** and hello **NotAfter** date is within 5 days, and one for which **IsPrimary** is **False** and **NotAfter** is about a year in hello future.</span></span>
4. <span data-ttu-id="0583a-195">Se você apenas ver um certificado e Olá **NotAfter** data é de 5 dias, você precisa toogenerate um novo certificado.</span><span class="sxs-lookup"><span data-stu-id="0583a-195">If you only see one certificate, and hello **NotAfter** date is within 5 days, you need toogenerate a new certificate.</span></span>
5. <span data-ttu-id="0583a-196">toogenerate um novo certificado, execute Olá comando em um prompt de comando do PowerShell a seguir: `PS C:\>Update-ADFSCertificate –CertificateType token-signing`.</span><span class="sxs-lookup"><span data-stu-id="0583a-196">toogenerate a new certificate, execute hello following command at a PowerShell command prompt: `PS C:\>Update-ADFSCertificate –CertificateType token-signing`.</span></span>
6. <span data-ttu-id="0583a-197">Verificar atualização Olá executando Olá novamente comandos a seguir: PS c\>Get-ADFSCertificate – CertificateType autenticação de tokens</span><span class="sxs-lookup"><span data-stu-id="0583a-197">Verify hello update by running hello following command again: PS C:\>Get-ADFSCertificate –CertificateType token-signing</span></span>

<span data-ttu-id="0583a-198">Dois certificados deverão ser listados agora, um dos quais tem uma **NotAfter** data de aproximadamente um ano Olá futuro e para quais Olá **IsPrimary** valor é **False**.</span><span class="sxs-lookup"><span data-stu-id="0583a-198">Two certificates should be listed now, one of which has a **NotAfter** date of approximately one year in hello future, and for which hello **IsPrimary** value is **False**.</span></span>

### <a name="step-2-update-hello-new-token-signing-certificates-for-hello-office-365-trust"></a><span data-ttu-id="0583a-199">Etapa 2: Atualizar novo token de saudação assinando certificados de confiança Olá Office 365</span><span class="sxs-lookup"><span data-stu-id="0583a-199">Step 2: Update hello new token signing certificates for hello Office 365 trust</span></span>
<span data-ttu-id="0583a-200">Atualize o Office 365 com hello novo token de assinatura certificados toobe usada para a relação de confiança hello, da seguinte maneira.</span><span class="sxs-lookup"><span data-stu-id="0583a-200">Update Office 365 with hello new token signing certificates toobe used for hello trust, as follows.</span></span>

1. <span data-ttu-id="0583a-201">Abra Olá Microsoft Azure módulo Active Directory para Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="0583a-201">Open hello Microsoft Azure Active Directory Module for Windows PowerShell.</span></span>
2. <span data-ttu-id="0583a-202">Execute $cred = Get-Credential.</span><span class="sxs-lookup"><span data-stu-id="0583a-202">Run $cred=Get-Credential.</span></span> <span data-ttu-id="0583a-203">Quando este cmdlet solicitar credenciais, digite as credenciais da conta de administrador de serviços de nuvem.</span><span class="sxs-lookup"><span data-stu-id="0583a-203">When this cmdlet prompts you for credentials, type your cloud service administrator account credentials.</span></span>
3. <span data-ttu-id="0583a-204">Execute Connect-MsolService –Credential $cred. Esse cmdlet conecta toohello serviço de nuvem.</span><span class="sxs-lookup"><span data-stu-id="0583a-204">Run Connect-MsolService –Credential $cred. This cmdlet connects you toohello cloud service.</span></span> <span data-ttu-id="0583a-205">Criar um contexto que conecta o serviço de nuvem toohello é necessária antes de executar qualquer um dos cmdlets adicionais de saudação instalados pela ferramenta de saudação.</span><span class="sxs-lookup"><span data-stu-id="0583a-205">Creating a context that connects you toohello cloud service is required before running any of hello additional cmdlets installed by hello tool.</span></span>
4. <span data-ttu-id="0583a-206">Se você estiver executando esses comandos em um computador que não seja o servidor de Federação primário saudação do AD FS, execute Set-MSOLAdfscontext-computador <AD FS primary server>, onde <AD FS primary server> é o nome FQDN interno de saudação do servidor do hello primário AD FS.</span><span class="sxs-lookup"><span data-stu-id="0583a-206">If you are running these commands on a computer that is not hello AD FS primary federation server, run Set-MSOLAdfscontext -Computer <AD FS primary server>, where <AD FS primary server> is hello internal FQDN name of hello primary AD FS server.</span></span> <span data-ttu-id="0583a-207">Esse cmdlet cria um contexto que conecta você tooAD FS.</span><span class="sxs-lookup"><span data-stu-id="0583a-207">This cmdlet creates a context that connects you tooAD FS.</span></span>
5. <span data-ttu-id="0583a-208">Execute Update-MSOLFederatedDomain –DomainName <domain>.</span><span class="sxs-lookup"><span data-stu-id="0583a-208">Run Update-MSOLFederatedDomain –DomainName <domain>.</span></span> <span data-ttu-id="0583a-209">Esse cmdlet atualiza as configurações de saudação do AD FS para o serviço de nuvem Olá e configura Olá a relação de confiança entre hello dois.</span><span class="sxs-lookup"><span data-stu-id="0583a-209">This cmdlet updates hello settings from AD FS into hello cloud service, and configures hello trust relationship between hello two.</span></span>

> [!NOTE]
> <span data-ttu-id="0583a-210">Se você precisar toosupport vários domínios de nível superior, como contoso.com e fabrikam.com, você deve usar o hello **SupportMultipleDomain** com qualquer cmdlet.</span><span class="sxs-lookup"><span data-stu-id="0583a-210">If you need toosupport multiple top-level domains, such as contoso.com and fabrikam.com, you must use hello **SupportMultipleDomain** switch with any cmdlets.</span></span> <span data-ttu-id="0583a-211">Para obter mais informações, veja [Suporte para vários domínios de nível superior](active-directory-aadconnect-multiple-domains.md).</span><span class="sxs-lookup"><span data-stu-id="0583a-211">For more information, see [Support for Multiple Top Level Domains](active-directory-aadconnect-multiple-domains.md).</span></span>
>
>

## <span data-ttu-id="0583a-212">Reparar a relação de confiança do Azure AD usando o Azure AD Connect <a name="connectrenew"></a></span><span class="sxs-lookup"><span data-stu-id="0583a-212">Repair Azure AD trust by using Azure AD Connect <a name="connectrenew"></a></span></span>
<span data-ttu-id="0583a-213">Se você tiver configurado seu farm do AD FS e a confiança do AD do Azure usando o Azure AD Connect, você pode usar toodetect do Azure AD Connect se você precisar tootake qualquer ação para seu certificados de assinatura de token.</span><span class="sxs-lookup"><span data-stu-id="0583a-213">If you configured your AD FS farm and Azure AD trust by using Azure AD Connect, you can use Azure AD Connect toodetect if you need tootake any action for your token signing certificates.</span></span> <span data-ttu-id="0583a-214">Se você precisar de certificados de saudação toorenew, você pode usar do Azure AD Connect toodo assim.</span><span class="sxs-lookup"><span data-stu-id="0583a-214">If you need toorenew hello certificates, you can use Azure AD Connect toodo so.</span></span>

<span data-ttu-id="0583a-215">Para obter mais informações, consulte [reparar confiança Olá](active-directory-aadconnect-federation-management.md).</span><span class="sxs-lookup"><span data-stu-id="0583a-215">For more information, see [Repairing hello trust](active-directory-aadconnect-federation-management.md).</span></span>
