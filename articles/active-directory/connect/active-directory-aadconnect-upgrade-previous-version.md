---
title: "Azure AD Connect: atualizar de uma versão anterior | Microsoft Docs"
description: "Explica os diferentes métodos para atualizar para a versão mais recente do Azure Active Directory Connect, incluindo a atualização in-loco e a migração swing."
services: active-directory
documentationcenter: 
author: AndKjell
manager: femila
editor: 
ms.assetid: 31f084d8-2b89-478c-9079-76cf92e6618f
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: Identity
ms.date: 07/12/2017
ms.author: billmath
ms.openlocfilehash: 52fd9375c71c42feaf87f4a0f4220e1cb3889e63
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/03/2017
---
# <a name="azure-ad-connect-upgrade-from-a-previous-version-to-the-latest"></a><span data-ttu-id="86dbc-103">Azure AD Connect: atualização de uma versão anterior para a mais recente</span><span class="sxs-lookup"><span data-stu-id="86dbc-103">Azure AD Connect: Upgrade from a previous version to the latest</span></span>
<span data-ttu-id="86dbc-104">Este tópico descreve os diferentes métodos que você pode usar para atualizar sua instalação do Azure Active Directory (Azure AD) Connect para a versão mais recente.</span><span class="sxs-lookup"><span data-stu-id="86dbc-104">This topic describes the different methods that you can use to upgrade your Azure Active Directory (Azure AD) Connect installation to the latest release.</span></span> <span data-ttu-id="86dbc-105">Recomendamos que você se mantenha atualizado com as versões do Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="86dbc-105">We recommend that you keep yourself current with the releases of Azure AD Connect.</span></span> <span data-ttu-id="86dbc-106">Também é possível usar as etapas descritas na seção [migração Swing](#swing-migration) ao fazer uma alteração significativa na configuração.</span><span class="sxs-lookup"><span data-stu-id="86dbc-106">You also use the steps in the [Swing migration](#swing-migration) section when you make a substantial configuration change.</span></span>

<span data-ttu-id="86dbc-107">Se você quiser atualizar do DirSync, confira [Atualizar da ferramenta de sincronização do Azure AD (DirSync)](active-directory-aadconnect-dirsync-upgrade-get-started.md).</span><span class="sxs-lookup"><span data-stu-id="86dbc-107">If you want to upgrade from DirSync, see [Upgrade from Azure AD sync tool (DirSync)](active-directory-aadconnect-dirsync-upgrade-get-started.md) instead.</span></span>

<span data-ttu-id="86dbc-108">Há algumas estratégias diferentes que podem ser usadas para atualizar o Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="86dbc-108">There are a few different strategies that you can use to upgrade Azure AD Connect.</span></span>

| <span data-ttu-id="86dbc-109">Método</span><span class="sxs-lookup"><span data-stu-id="86dbc-109">Method</span></span> | <span data-ttu-id="86dbc-110">Descrição</span><span class="sxs-lookup"><span data-stu-id="86dbc-110">Description</span></span> |
| --- | --- |
| [<span data-ttu-id="86dbc-111">Atualização automática</span><span class="sxs-lookup"><span data-stu-id="86dbc-111">Automatic upgrade</span></span>](active-directory-aadconnect-feature-automatic-upgrade.md) |<span data-ttu-id="86dbc-112">Para clientes com uma instalação expressa, esse é o método mais simples.</span><span class="sxs-lookup"><span data-stu-id="86dbc-112">This is the easiest method for customers with an express installation.</span></span> |
| [<span data-ttu-id="86dbc-113">Atualização in-loco</span><span class="sxs-lookup"><span data-stu-id="86dbc-113">In-place upgrade</span></span>](#in-place-upgrade) |<span data-ttu-id="86dbc-114">Se você tiver apenas um servidor, é possível atualizar a instalação in-loco no mesmo servidor.</span><span class="sxs-lookup"><span data-stu-id="86dbc-114">If you have a single server, you can upgrade the installation in-place on the same server.</span></span> |
| [<span data-ttu-id="86dbc-115">Migração swing</span><span class="sxs-lookup"><span data-stu-id="86dbc-115">Swing migration</span></span>](#swing-migration) |<span data-ttu-id="86dbc-116">Com dois servidores, é possível preparar um dos servidores com a nova versão ou configuração e alterar o servidor ativo quando você estiver pronto.</span><span class="sxs-lookup"><span data-stu-id="86dbc-116">With two servers, you can prepare one of the servers with the new release or configuration, and change the active server when you're ready.</span></span> |

<span data-ttu-id="86dbc-117">Para informações sobre permissões, consulte as [permissões necessárias para uma atualização](active-directory-aadconnect-accounts-permissions.md#upgrade).</span><span class="sxs-lookup"><span data-stu-id="86dbc-117">For permissions information, see the [permissions required for an upgrade](active-directory-aadconnect-accounts-permissions.md#upgrade).</span></span>

> [!NOTE]
> <span data-ttu-id="86dbc-118">Depois que você tiver ativado o novo servidor do Azure AD Connect para iniciar a sincronização de alterações para o Azure AD, não deverá reverter usando o DirSync ou o Azure AD Sync.</span><span class="sxs-lookup"><span data-stu-id="86dbc-118">After you've enabled your new Azure AD Connect server to start synchronizing changes to Azure AD, you must not roll back to using DirSync or Azure AD Sync.</span></span> <span data-ttu-id="86dbc-119">Fazer downgrade do Azure AD Connect para clientes herdados, incluindo o DirSync e o Azure AD Sync, não tem suporte e pode levar a problemas como a perda de dados no Azure AD.</span><span class="sxs-lookup"><span data-stu-id="86dbc-119">Downgrading from Azure AD Connect to legacy clients, including DirSync and Azure AD Sync, isn't supported and can lead to issues such as data loss in Azure AD.</span></span>

## <a name="in-place-upgrade"></a><span data-ttu-id="86dbc-120">Atualização in-loco</span><span class="sxs-lookup"><span data-stu-id="86dbc-120">In-place upgrade</span></span>
<span data-ttu-id="86dbc-121">Uma atualização in-loco funciona para mudar do Azure AD Sync ou do Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="86dbc-121">An in-place upgrade works for moving from Azure AD Sync or Azure AD Connect.</span></span> <span data-ttu-id="86dbc-122">Ele não funcionará para a migração do DirSync ou para uma solução com o FIM (Forefront Identity Manager) + Azure AD Connector.</span><span class="sxs-lookup"><span data-stu-id="86dbc-122">It doesn't work for moving from DirSync or for a solution with Forefront Identity Manager (FIM) + Azure AD Connector.</span></span>

<span data-ttu-id="86dbc-123">Esse será o método preferencial quando você tiver um único servidor e menos de cerca de 100.000 objetos.</span><span class="sxs-lookup"><span data-stu-id="86dbc-123">This method is preferred when you have a single server and less than about 100,000 objects.</span></span> <span data-ttu-id="86dbc-124">Se houver várias alterações nas regras de sincronização prontas para uso, uma importação completa e uma sincronização completa ocorrerão após a atualização.</span><span class="sxs-lookup"><span data-stu-id="86dbc-124">If there are any changes to the out-of-box sync rules, a full import and full synchronization occur after the upgrade.</span></span> <span data-ttu-id="86dbc-125">Esse método assegura que a nova configuração seja aplicada a todos os objetos existentes no sistema.</span><span class="sxs-lookup"><span data-stu-id="86dbc-125">This method ensures that the new configuration is applied to all existing objects in the system.</span></span> <span data-ttu-id="86dbc-126">Essa execução pode levar algumas horas, dependendo do número de objetos no escopo do mecanismo de sincronização.</span><span class="sxs-lookup"><span data-stu-id="86dbc-126">This run might take a few hours, depending on the number of objects that are in scope of the sync engine.</span></span> <span data-ttu-id="86dbc-127">O agendador da sincronização delta normal (que, por padrão, sincroniza a cada 30 minutos), será suspensa, mas a sincronização de senha continuará.</span><span class="sxs-lookup"><span data-stu-id="86dbc-127">The normal delta synchronization scheduler (which synchronizes every 30 minutes by default) is suspended, but password synchronization continues.</span></span> <span data-ttu-id="86dbc-128">Você pode considerar fazer a atualização in-loco durante um final de semana.</span><span class="sxs-lookup"><span data-stu-id="86dbc-128">You might consider doing the in-place upgrade during a weekend.</span></span> <span data-ttu-id="86dbc-129">Se não houver nenhuma alteração na configuração pronta para uso com a nova versão do Azure AD Connect, uma importação/sincronização delta normal será iniciada em vez disso.</span><span class="sxs-lookup"><span data-stu-id="86dbc-129">If there are no changes to the out-of-box configuration with the new Azure AD Connect release, then a normal delta import/sync starts instead.</span></span>  
![Atualização in-loco](./media/active-directory-aadconnect-upgrade-previous-version/inplaceupgrade.png)

<span data-ttu-id="86dbc-131">Se você tiver feito alterações nas regras de sincronização prontas, essas regras serão definidas para a configuração padrão na atualização.</span><span class="sxs-lookup"><span data-stu-id="86dbc-131">If you've made changes to the out-of-box synchronization rules, then these rules are set back to the default configuration on upgrade.</span></span> <span data-ttu-id="86dbc-132">Para certificar-se de que sua configuração seja mantida entre as atualizações, verifique se as alterações foram feitas como descrito em [Práticas recomendadas para alterar a configuração padrão](active-directory-aadconnectsync-best-practices-changing-default-configuration.md).</span><span class="sxs-lookup"><span data-stu-id="86dbc-132">To make sure that your configuration is kept between upgrades, make sure that you make changes as they're described in [Best practices for changing the default configuration](active-directory-aadconnectsync-best-practices-changing-default-configuration.md).</span></span>

<span data-ttu-id="86dbc-133">Durante a atualização in-loco, poderá haver alterações introduzidas que exijam que atividades de sincronização específicas (incluindo as etapas de importação completa e sincronização completa) sejam executadas após a conclusão da atualização.</span><span class="sxs-lookup"><span data-stu-id="86dbc-133">During in-place upgrade, there may be changes introduced that require specific synchronization activities (including Full Import step and Full Synchronization step) to be executed after upgrade completes.</span></span> <span data-ttu-id="86dbc-134">Para adiar tais atividades, consulte a seção [Como adiar a sincronização completa após a atualização](#how-to-defer-full-synchronization-after-upgrade).</span><span class="sxs-lookup"><span data-stu-id="86dbc-134">To defer such activities, refer to section [How to defer full synchronization after upgrade](#how-to-defer-full-synchronization-after-upgrade).</span></span>

## <a name="swing-migration"></a><span data-ttu-id="86dbc-135">Migração swing</span><span class="sxs-lookup"><span data-stu-id="86dbc-135">Swing migration</span></span>
<span data-ttu-id="86dbc-136">Se você tiver uma implantação complexa ou muitos objetos, talvez seja impossível fazer uma atualização in-loco do sistema dinâmico.</span><span class="sxs-lookup"><span data-stu-id="86dbc-136">If you have a complex deployment or many objects, it might be impractical to do an in-place upgrade on the live system.</span></span> <span data-ttu-id="86dbc-137">Para alguns clientes, o processo poderá levar vários dias e, durante esse tempo, nenhuma alteração delta será processada.</span><span class="sxs-lookup"><span data-stu-id="86dbc-137">For some customers, this process might take multiple days--and during this time, no delta changes are processed.</span></span> <span data-ttu-id="86dbc-138">Você também pode usar esse método quando planejar fazer alterações significativas em sua configuração e quiser experimentá-las antes de enviá-las por push para a nuvem.</span><span class="sxs-lookup"><span data-stu-id="86dbc-138">You can also use this method when you plan to make substantial changes to your configuration and you want to try them out before they're pushed to the cloud.</span></span>

<span data-ttu-id="86dbc-139">O método recomendado para estes cenários é usar uma migração swing.</span><span class="sxs-lookup"><span data-stu-id="86dbc-139">The recommended method for these scenarios is to use a swing migration.</span></span> <span data-ttu-id="86dbc-140">Você precisa de (pelo menos) dois servidores, um servidor ativo e um de preparo.</span><span class="sxs-lookup"><span data-stu-id="86dbc-140">You need (at least) two servers--one active server and one staging server.</span></span> <span data-ttu-id="86dbc-141">O servidor ativo (exibido com linhas azuis sólidas na imagem abaixo) será responsável pela carga de produção ativa.</span><span class="sxs-lookup"><span data-stu-id="86dbc-141">The active server (shown with solid blue lines in the following picture) is responsible for the active production load.</span></span> <span data-ttu-id="86dbc-142">O servidor de preparo (mostrado com linhas tracejadas roxas) está preparado com a nova versão ou configuração.</span><span class="sxs-lookup"><span data-stu-id="86dbc-142">The staging server (shown with dashed purple lines) is prepared with the new release or configuration.</span></span> <span data-ttu-id="86dbc-143">Quando estiver totalmente pronto, esse servidor ficará ativo.</span><span class="sxs-lookup"><span data-stu-id="86dbc-143">When it's fully ready, this server is made active.</span></span> <span data-ttu-id="86dbc-144">O servidor ativo anterior, agora com a versão ou configuração antiga instalada, se tornará o servidor de preparo e será atualizado.</span><span class="sxs-lookup"><span data-stu-id="86dbc-144">The previous active server, which now has the old version or configuration installed, is made into the staging server and is upgraded.</span></span>

<span data-ttu-id="86dbc-145">Os dois servidores podem usar versões diferentes.</span><span class="sxs-lookup"><span data-stu-id="86dbc-145">The two servers can use different versions.</span></span> <span data-ttu-id="86dbc-146">Por exemplo, o servidor ativo que você planeja desativar pode usar o Azure AD Sync e o novo servidor de preparo pode usar o Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="86dbc-146">For example, the active server that you plan to decommission can use Azure AD Sync, and the new staging server can use Azure AD Connect.</span></span> <span data-ttu-id="86dbc-147">Se você usar a migração swing para desenvolver uma nova configuração, será uma boa ideia ter as mesmas versões nos dois servidores.</span><span class="sxs-lookup"><span data-stu-id="86dbc-147">If you use swing migration to develop a new configuration, it's a good idea to have the same versions on the two servers.</span></span>  
![Servidor de preparo](./media/active-directory-aadconnect-upgrade-previous-version/stagingserver1.png)

> [!NOTE]
> <span data-ttu-id="86dbc-149">Alguns clientes preferem ter três ou quatro servidores para este cenário.</span><span class="sxs-lookup"><span data-stu-id="86dbc-149">Some customers prefer to have three or four servers for this scenario.</span></span> <span data-ttu-id="86dbc-150">Quando o servidor de preparo é atualizado, você não tem um servidor de backup para a [recuperação de desastres](active-directory-aadconnectsync-operations.md#disaster-recovery).</span><span class="sxs-lookup"><span data-stu-id="86dbc-150">When the staging server is upgraded, you don't have a backup server for [disaster recovery](active-directory-aadconnectsync-operations.md#disaster-recovery).</span></span> <span data-ttu-id="86dbc-151">Com três ou quatro servidores, pode ser preparar um conjunto de servidores principais/em espera com a nova versão, garantindo que sempre haverá um servidor de preparo pronto para assumir o controle.</span><span class="sxs-lookup"><span data-stu-id="86dbc-151">With three or four servers, you can prepare one set of primary/standby servers with the new version, which ensures that there is always a staging server that's ready to take over.</span></span>

<span data-ttu-id="86dbc-152">Estas etapas também funcionam para mudar do Azure AD Sync ou de uma solução com o FIM + Azure AD Connector.</span><span class="sxs-lookup"><span data-stu-id="86dbc-152">These steps also work to move from Azure AD Sync or a solution with FIM + Azure AD Connector.</span></span> <span data-ttu-id="86dbc-153">Estas etapas não funcionam para o DirSync, mas o mesmo método de migração swing (também chamado de implantação paralela) com as etapas para o DirSync pode ser encontrado em [Atualizar a sincronização do Azure Active Directory (DirSync)](active-directory-aadconnect-dirsync-upgrade-get-started.md).</span><span class="sxs-lookup"><span data-stu-id="86dbc-153">These steps don't work for DirSync, but the same swing migration method (also called parallel deployment) with steps for DirSync is in [Upgrade Azure Active Directory sync (DirSync)](active-directory-aadconnect-dirsync-upgrade-get-started.md).</span></span>

### <a name="use-a-swing-migration-to-upgrade"></a><span data-ttu-id="86dbc-154">Usar uma migração swing para atualizar</span><span class="sxs-lookup"><span data-stu-id="86dbc-154">Use a swing migration to upgrade</span></span>
1. <span data-ttu-id="86dbc-155">Se você usar o Azure AD Connect nos dois servidores e planejar fazer apenas uma alteração de configuração, certifique-se de que o servidor ativo e o servidor de preparo estejam usando a mesma versão.</span><span class="sxs-lookup"><span data-stu-id="86dbc-155">If you use Azure AD Connect on both servers and plan to only make a configuration change, make sure that your active server and staging server are both using the same version.</span></span> <span data-ttu-id="86dbc-156">Isso facilita a comparação de diferenças mais tarde.</span><span class="sxs-lookup"><span data-stu-id="86dbc-156">That makes it easier to compare differences later.</span></span> <span data-ttu-id="86dbc-157">Se você estiver atualizando do Azure AD Sync, esses servidores terão versões diferentes.</span><span class="sxs-lookup"><span data-stu-id="86dbc-157">If you're upgrading from Azure AD Sync, then these servers have different versions.</span></span> <span data-ttu-id="86dbc-158">Se você estiver atualizando de uma versão anterior do Azure AD Connect, é uma boa ideia começar com os dois servidores usando a mesma versão, mas isso não é obrigatório.</span><span class="sxs-lookup"><span data-stu-id="86dbc-158">If you're upgrading from an older version of Azure AD Connect, it's a good idea to start with the two servers that are using the same version, but it's not required.</span></span>
2. <span data-ttu-id="86dbc-159">Se você tiver feito alguma configuração personalizada e o servidor de preparo não a tiver, siga as etapas em [Mover a configuração personalizada do servidor ativo para o de preparo](#move-custom-configuration-from-active-to-staging-server).</span><span class="sxs-lookup"><span data-stu-id="86dbc-159">If you've made a custom configuration and your staging server doesn't have it, follow the steps under [Move a custom configuration from the active server to the staging server](#move-custom-configuration-from-active-to-staging-server).</span></span>
3. <span data-ttu-id="86dbc-160">Se estiver atualizando de uma versão anterior do Azure AD Connect, atualize o servidor de preparo para a versão mais recente.</span><span class="sxs-lookup"><span data-stu-id="86dbc-160">If you're upgrading from an earlier release of Azure AD Connect, upgrade the staging server to the latest version.</span></span> <span data-ttu-id="86dbc-161">Se estiver movendo do Azure AD Sync, instale o Azure AD Connect em seu servidor de preparo.</span><span class="sxs-lookup"><span data-stu-id="86dbc-161">If you're moving from Azure AD Sync, then install Azure AD Connect on your staging server.</span></span>
4. <span data-ttu-id="86dbc-162">Permita que o mecanismo de sincronização execute a importação completa e a sincronização completa em seu servidor de preparo.</span><span class="sxs-lookup"><span data-stu-id="86dbc-162">Let the sync engine run full import and full synchronization on your staging server.</span></span>
5. <span data-ttu-id="86dbc-163">Verifique se a nova configuração não causou alterações inesperadas usando as etapas descritas em “Verificar” em [Verificar a configuração de um servidor](active-directory-aadconnectsync-operations.md#verify-the-configuration-of-a-server).</span><span class="sxs-lookup"><span data-stu-id="86dbc-163">Verify that the new configuration didn't cause any unexpected changes by using the steps under "Verify" in [Verify the configuration of a server](active-directory-aadconnectsync-operations.md#verify-the-configuration-of-a-server).</span></span> <span data-ttu-id="86dbc-164">Se algo não acontecer conforme o esperado, siga as etapas para corrigir, executar a importação e a sincronização e verificar os dados até que eles fiquem corretos.</span><span class="sxs-lookup"><span data-stu-id="86dbc-164">If something isn't as expected, correct it, run the import and sync, and verify the data until it looks good, by following the steps.</span></span>
6. <span data-ttu-id="86dbc-165">Altere o servidor de preparo para que ele passe a ser o servidor ativo.</span><span class="sxs-lookup"><span data-stu-id="86dbc-165">Switch the staging server to be the active server.</span></span> <span data-ttu-id="86dbc-166">Esta é a etapa final de “Alterar o servidor ativo” em [Verificar a configuração de um servidor](active-directory-aadconnectsync-operations.md#verify-the-configuration-of-a-server).</span><span class="sxs-lookup"><span data-stu-id="86dbc-166">This is the final step "Switch active server" in [Verify the configuration of a server](active-directory-aadconnectsync-operations.md#verify-the-configuration-of-a-server).</span></span>
7. <span data-ttu-id="86dbc-167">Se estiver atualizando do Azure AD Connect, atualize o servidor que está no modo de preparo para a versão mais recente.</span><span class="sxs-lookup"><span data-stu-id="86dbc-167">If you're upgrading Azure AD Connect, upgrade the server that's now in staging mode to the latest release.</span></span> <span data-ttu-id="86dbc-168">Siga as mesmas etapas anteriores para atualizar os dados e a configuração.</span><span class="sxs-lookup"><span data-stu-id="86dbc-168">Follow the same steps as before to get the data and configuration upgraded.</span></span> <span data-ttu-id="86dbc-169">Se estiver atualizando do Azure AD Sync, agora você poderá desativar e encerrar o servidor antigo.</span><span class="sxs-lookup"><span data-stu-id="86dbc-169">If you upgraded from Azure AD Sync, you can now turn off and decommission your old server.</span></span>

### <a name="move-a-custom-configuration-from-the-active-server-to-the-staging-server"></a><span data-ttu-id="86dbc-170">Mover uma configuração personalizada do servidor ativo para o servidor de preparo</span><span class="sxs-lookup"><span data-stu-id="86dbc-170">Move a custom configuration from the active server to the staging server</span></span>
<span data-ttu-id="86dbc-171">Se você tiver feito alterações de configuração no servidor ativo, precisará garantir que as mesmas alterações sejam aplicadas ao servidor de preparo.</span><span class="sxs-lookup"><span data-stu-id="86dbc-171">If you've made configuration changes to the active server, you need to make sure that the same changes are applied to the staging server.</span></span> <span data-ttu-id="86dbc-172">Para ajudar com essa mudança, você pode usar o [Documentador de configuração do Azure AD Connect](https://github.com/Microsoft/AADConnectConfigDocumenter).</span><span class="sxs-lookup"><span data-stu-id="86dbc-172">To help with this move, you can use the [Azure AD Connect configuration documenter](https://github.com/Microsoft/AADConnectConfigDocumenter).</span></span>

<span data-ttu-id="86dbc-173">Você pode mover as regras de sincronização personalizadas que você criou usando o PowerShell.</span><span class="sxs-lookup"><span data-stu-id="86dbc-173">You can move the custom sync rules that you've created by using PowerShell.</span></span> <span data-ttu-id="86dbc-174">Você deve aplicar outras alterações da mesma maneira em ambos os sistemas, mas não será possível migrar as alterações.</span><span class="sxs-lookup"><span data-stu-id="86dbc-174">You must apply other changes the same way on both systems, and you can't migrate the changes.</span></span> <span data-ttu-id="86dbc-175">O [documentador de configuração](https://github.com/Microsoft/AADConnectConfigDocumenter) pode ajudá-lo a comparar os dois sistemas para certificar-se de que eles são idênticos.</span><span class="sxs-lookup"><span data-stu-id="86dbc-175">The [configuration documenter](https://github.com/Microsoft/AADConnectConfigDocumenter) can help you comparing the two systems to make sure they are identical.</span></span> <span data-ttu-id="86dbc-176">A ferramenta também pode ajudar a automatizar as etapas desta seção.</span><span class="sxs-lookup"><span data-stu-id="86dbc-176">The tool can also help in automating the steps found in this section.</span></span>

<span data-ttu-id="86dbc-177">Você precisa configurar os seguintes itens da mesma maneira em ambos os servidores:</span><span class="sxs-lookup"><span data-stu-id="86dbc-177">You need to configure the following things the same way on both servers:</span></span>

* <span data-ttu-id="86dbc-178">A conexão às mesmas florestas</span><span class="sxs-lookup"><span data-stu-id="86dbc-178">Connection to the same forests</span></span>
* <span data-ttu-id="86dbc-179">Qualquer filtragem de domínio e de unidade organizacional</span><span class="sxs-lookup"><span data-stu-id="86dbc-179">Any domain and OU filtering</span></span>
* <span data-ttu-id="86dbc-180">Os mesmos recursos opcionais, como a sincronização de senha e o write-back de senha</span><span class="sxs-lookup"><span data-stu-id="86dbc-180">The same optional features, such as password sync and password writeback</span></span>

<span data-ttu-id="86dbc-181">**Mover regras de sincronização personalizadas**</span><span class="sxs-lookup"><span data-stu-id="86dbc-181">**Move custom synchronization rules**</span></span>  
<span data-ttu-id="86dbc-182">Para mover regras de sincronização personalizadas, faça o seguinte:</span><span class="sxs-lookup"><span data-stu-id="86dbc-182">To move custom synchronization rules, do the following:</span></span>

1. <span data-ttu-id="86dbc-183">Abra o **Editor de Regras de Sincronização** em seu servidor ativo.</span><span class="sxs-lookup"><span data-stu-id="86dbc-183">Open **Synchronization Rules Editor** on your active server.</span></span>
2. <span data-ttu-id="86dbc-184">Selecione uma regra personalizada.</span><span class="sxs-lookup"><span data-stu-id="86dbc-184">Select a custom rule.</span></span> <span data-ttu-id="86dbc-185">Clique em **Exportar**.</span><span class="sxs-lookup"><span data-stu-id="86dbc-185">Click **Export**.</span></span> <span data-ttu-id="86dbc-186">Isso abre uma janela do Bloco de Notas.</span><span class="sxs-lookup"><span data-stu-id="86dbc-186">This brings up a Notepad window.</span></span> <span data-ttu-id="86dbc-187">Salve o arquivo temporário com uma extensão PS1.</span><span class="sxs-lookup"><span data-stu-id="86dbc-187">Save the temporary file with a PS1 extension.</span></span> <span data-ttu-id="86dbc-188">Isso o transforma em um script do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="86dbc-188">This makes it a PowerShell script.</span></span> <span data-ttu-id="86dbc-189">Copie o arquivo PS1 para o servidor de preparo.</span><span class="sxs-lookup"><span data-stu-id="86dbc-189">Copy the PS1 file to the staging server.</span></span>  
   <span data-ttu-id="86dbc-190">![Exportação da regra de sincronização](./media/active-directory-aadconnect-upgrade-previous-version/exportrule.png)</span><span class="sxs-lookup"><span data-stu-id="86dbc-190">![Sync rule export](./media/active-directory-aadconnect-upgrade-previous-version/exportrule.png)</span></span>
3. <span data-ttu-id="86dbc-191">O GUID do Conector é diferente no servidor de preparo e deve ser alterado.</span><span class="sxs-lookup"><span data-stu-id="86dbc-191">The Connector GUID is different on the staging server, and you must change it.</span></span> <span data-ttu-id="86dbc-192">Para obter o GUID, inicie o **Editor de Regras de Sincronização**, escolha uma das regras prontas que representam o mesmo sistema conectado e clique em **Exportar**.</span><span class="sxs-lookup"><span data-stu-id="86dbc-192">To get the GUID, start **Synchronization Rules Editor**, select one of the out-of-box rules that represent the same connected system, and click **Export**.</span></span> <span data-ttu-id="86dbc-193">Substitua o GUID em seu arquivo PS1 com o GUID do servidor de preparo.</span><span class="sxs-lookup"><span data-stu-id="86dbc-193">Replace the GUID in your PS1 file with the GUID from the staging server.</span></span>
4. <span data-ttu-id="86dbc-194">Em um prompt do PowerShell, execute o arquivo PS1.</span><span class="sxs-lookup"><span data-stu-id="86dbc-194">In a PowerShell prompt, run the PS1 file.</span></span> <span data-ttu-id="86dbc-195">Isso cria a regra de sincronização personalizada no servidor de preparo.</span><span class="sxs-lookup"><span data-stu-id="86dbc-195">This creates the custom synchronization rule on the staging server.</span></span>
5. <span data-ttu-id="86dbc-196">Repita essa etapa para todas as regras personalizadas.</span><span class="sxs-lookup"><span data-stu-id="86dbc-196">Repeat this for all your custom rules.</span></span>

## <a name="how-to-defer-full-synchronization-after-upgrade"></a><span data-ttu-id="86dbc-197">Como adiar a sincronização completa após a atualização</span><span class="sxs-lookup"><span data-stu-id="86dbc-197">How to defer full synchronization after upgrade</span></span>
<span data-ttu-id="86dbc-198">Durante a atualização in-loco, poderá haver alterações introduzidas que exijam que atividades de sincronização específicas (incluindo as etapas de importação completa e sincronização completa) sejam executadas.</span><span class="sxs-lookup"><span data-stu-id="86dbc-198">During in-place upgrade, there may be changes introduced that require specific synchronization activities (including Full Import step and Full Synchronization step) to be executed.</span></span> <span data-ttu-id="86dbc-199">Por exemplo, as alterações de esquema do conector exigem a etapa de **importação completa** e as alterações de regra de sincronização integradas exigem que a etapa **sincronização completa** seja executada nos conectores afetados.</span><span class="sxs-lookup"><span data-stu-id="86dbc-199">For example, connector schema changes require **full import** step and out-of-box synchronization rule changes require **full synchronization** step to be executed on affected connectors.</span></span> <span data-ttu-id="86dbc-200">Durante a atualização, o Azure AD Connect determina quais atividades de sincronização são necessárias e registra-as como *substituições*.</span><span class="sxs-lookup"><span data-stu-id="86dbc-200">During upgrade, Azure AD Connect determines what synchronization activities are required and records them as *overrides*.</span></span> <span data-ttu-id="86dbc-201">No ciclo de sincronização seguinte, o agendador de sincronização seleciona essas substituições e executa-as.</span><span class="sxs-lookup"><span data-stu-id="86dbc-201">In the following synchronization cycle, the synchronization scheduler picks up these overrides and executes them.</span></span> <span data-ttu-id="86dbc-202">Quando uma substituição é executada com êxito, ela é removida.</span><span class="sxs-lookup"><span data-stu-id="86dbc-202">Once an override is successfully executed, it is removed.</span></span>

<span data-ttu-id="86dbc-203">Pode haver situações em que você não deseja que essas substituições ocorram imediatamente após a atualização.</span><span class="sxs-lookup"><span data-stu-id="86dbc-203">There may be situations where you do not want these overrides to take place immediately after upgrade.</span></span> <span data-ttu-id="86dbc-204">Por exemplo, você tem vários objetos sincronizados e deseja que essas etapas de sincronização ocorram depois do horário comercial.</span><span class="sxs-lookup"><span data-stu-id="86dbc-204">For example, you have numerous synchronized objects and you would like these synchronization steps to occur after business hours.</span></span> <span data-ttu-id="86dbc-205">Para remover essas substituições:</span><span class="sxs-lookup"><span data-stu-id="86dbc-205">To remove these overrides:</span></span>

1. <span data-ttu-id="86dbc-206">Durante a atualização, **desmarque** a opção **Iniciar o processo de sincronização ao concluir a configuração**.</span><span class="sxs-lookup"><span data-stu-id="86dbc-206">During upgrade, **uncheck** the option **Start the synchronization process when configuration completes**.</span></span> <span data-ttu-id="86dbc-207">Isso desabilita o agendador de sincronização e impede que o ciclo de sincronização ocorra automaticamente antes que as substituições sejam removidas.</span><span class="sxs-lookup"><span data-stu-id="86dbc-207">This disables the synchronization scheduler and prevents synchronization cycle from taking place automatically before the overrides are removed.</span></span>

   ![DisableFullSyncAfterUpgrade](./media/active-directory-aadconnect-upgrade-previous-version/disablefullsync01.png)

2. <span data-ttu-id="86dbc-209">Após a conclusão da atualização, execute o seguinte cmdlet para descobrir quais substituições foram adicionadas: `Get-ADSyncSchedulerConnectorOverride | fl`</span><span class="sxs-lookup"><span data-stu-id="86dbc-209">After upgrade completes, run the following cmdlet to find out what overrides have been added: `Get-ADSyncSchedulerConnectorOverride | fl`</span></span>

   >[!NOTE]
   > <span data-ttu-id="86dbc-210">As substituições são específicas do conector.</span><span class="sxs-lookup"><span data-stu-id="86dbc-210">The overrides are connector-specific.</span></span> <span data-ttu-id="86dbc-211">No exemplo a seguir, as etapas de importação completa e de sincronização completa foram adicionadas ao AD Connector local e no Azure AD Connector.</span><span class="sxs-lookup"><span data-stu-id="86dbc-211">In the following example, Full Import step and Full Synchronization step have been added to both the on-premises AD Connector and Azure AD Connector.</span></span>

   ![DisableFullSyncAfterUpgrade](./media/active-directory-aadconnect-upgrade-previous-version/disablefullsync02.png)

3. <span data-ttu-id="86dbc-213">Anote as substituições existentes que foram adicionadas.</span><span class="sxs-lookup"><span data-stu-id="86dbc-213">Note down the existing overrides that have been added.</span></span>
   
4. <span data-ttu-id="86dbc-214">Para remover as substituições da importação completa e da sincronização completa em um conector qualquer, execute o seguinte cmdlet: `Set-ADSyncSchedulerConnectorOverride -ConnectorIdentifier <Guid-of-ConnectorIdentifier> -FullImportRequired $false -FullSyncRequired $false`</span><span class="sxs-lookup"><span data-stu-id="86dbc-214">To remove the overrides for both full import and full synchronization on an arbitrary connector, run the following cmdlet: `Set-ADSyncSchedulerConnectorOverride -ConnectorIdentifier <Guid-of-ConnectorIdentifier> -FullImportRequired $false -FullSyncRequired $false`</span></span>

   <span data-ttu-id="86dbc-215">Para remover as substituições de todos os conectores, execute o seguinte script do PowerShell:</span><span class="sxs-lookup"><span data-stu-id="86dbc-215">To remove the overrides on all connectors, execute the following PowerShell script:</span></span>

   ```
   foreach ($connectorOverride in Get-ADSyncSchedulerConnectorOverride)
   {
       Set-ADSyncSchedulerConnectorOverride -ConnectorIdentifier $connectorOverride.ConnectorIdentifier.Guid -FullSyncRequired $false -FullImportRequired $false
   }
   ```

5. <span data-ttu-id="86dbc-216">Para retomar o agendador, execute o seguinte cmdlet: `Set-ADSyncScheduler -SyncCycleEnabled $true`</span><span class="sxs-lookup"><span data-stu-id="86dbc-216">To resume the scheduler, run the following cmdlet: `Set-ADSyncScheduler -SyncCycleEnabled $true`</span></span>

   >[!IMPORTANT]
   > <span data-ttu-id="86dbc-217">Lembre-se de executar as etapas de sincronização necessárias assim que possível.</span><span class="sxs-lookup"><span data-stu-id="86dbc-217">Remember to execute the required synchronization steps at your earliest convenience.</span></span> <span data-ttu-id="86dbc-218">Você pode executar essas etapas manualmente usando o Synchronization Service Manager ou adicionar as substituições novamente usando o cmdlet Set-ADSyncSchedulerConnectorOverride.</span><span class="sxs-lookup"><span data-stu-id="86dbc-218">You can either manually execute these steps using the Synchronization Service Manager or add the overrides back using the Set-ADSyncSchedulerConnectorOverride cmdlet.</span></span>

<span data-ttu-id="86dbc-219">Para adicionar as substituições para a importação completa e para a sincronização completa em um conector qualquer, execute o seguinte cmdlet: `Set-ADSyncSchedulerConnectorOverride -ConnectorIdentifier <Guid> -FullImportRequired $true -FullSyncRequired $true`</span><span class="sxs-lookup"><span data-stu-id="86dbc-219">To add the overrides for both full import and full synchronization on an arbitrary connector, run the following cmdlet:  `Set-ADSyncSchedulerConnectorOverride -ConnectorIdentifier <Guid> -FullImportRequired $true -FullSyncRequired $true`</span></span>

## <a name="next-steps"></a><span data-ttu-id="86dbc-220">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="86dbc-220">Next steps</span></span>
<span data-ttu-id="86dbc-221">Saiba mais sobre [como integrar suas identidades locais ao Azure Active Directory](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="86dbc-221">Learn more about [integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span></span>
