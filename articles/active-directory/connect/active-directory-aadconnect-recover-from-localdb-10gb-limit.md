---
title: 'Azure AD Connect: Como recuperar LocalDB problema de limite de 10 GB | Microsoft Docs'
description: "Este tópico descreve como recuperar o serviço de sincronização do Azure do AD Connect quando encontra LocalDB 10GB limitar o problema."
services: active-directory
documentationcenter: 
author: cychua
manager: femila
editor: 
ms.assetid: 41d081af-ed89-4e17-be34-14f7e80ae358
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/17/2017
ms.author: billmath
ms.openlocfilehash: 08e682c51b12d4506019d2f6b68e1eae0798b990
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/03/2017
---
# <a name="azure-ad-connect-how-to-recover-from-localdb-10-gb-limit"></a><span data-ttu-id="a7a45-103">Azure AD Connect: Como se recuperar de um limite de 10 GB do LocalDB</span><span class="sxs-lookup"><span data-stu-id="a7a45-103">Azure AD Connect: How to recover from LocalDB 10-GB limit</span></span>
<span data-ttu-id="a7a45-104">O Azure AD Connect requer um banco de dados do SQL Server para armazenar dados de identidade.</span><span class="sxs-lookup"><span data-stu-id="a7a45-104">Azure AD Connect requires a SQL Server database to store identity data.</span></span> <span data-ttu-id="a7a45-105">Você pode usar o padrão que do SQL Server 2012 Express LocalDB instalado com o Azure AD Connect ou usar seu próprio SQL completo.</span><span class="sxs-lookup"><span data-stu-id="a7a45-105">You can either use the default SQL Server 2012 Express LocalDB installed with Azure AD Connect or use your own full SQL.</span></span> <span data-ttu-id="a7a45-106">O SQL Server Express impõe um limite de tamanho de 10 GB.</span><span class="sxs-lookup"><span data-stu-id="a7a45-106">SQL Server Express imposes a 10-GB size limit.</span></span> <span data-ttu-id="a7a45-107">Ao usar o LocalDB e esse limite for atingido, o serviço de sincronização do Azure do AD Connect não pode iniciar ou sincronizar corretamente.</span><span class="sxs-lookup"><span data-stu-id="a7a45-107">When using LocalDB and this limit is reached, Azure AD Connect Synchronization Service can no longer start or synchronize properly.</span></span> <span data-ttu-id="a7a45-108">Este artigo fornece as etapas de recuperação.</span><span class="sxs-lookup"><span data-stu-id="a7a45-108">This article provides the recovery steps.</span></span>

## <a name="symptoms"></a><span data-ttu-id="a7a45-109">Sintomas</span><span class="sxs-lookup"><span data-stu-id="a7a45-109">Symptoms</span></span>
<span data-ttu-id="a7a45-110">Há dois sintomas comuns:</span><span class="sxs-lookup"><span data-stu-id="a7a45-110">There are two common symptoms:</span></span>

* <span data-ttu-id="a7a45-111">O Serviço de sincronização do Azure do AD Connect **está em execução**, mas não consegue sincronizar com o erro *"stopped-database-disk-full"*.</span><span class="sxs-lookup"><span data-stu-id="a7a45-111">Azure AD Connect Synchronization Service **is running** but fails to synchronize with *“stopped-database-disk-full”* error.</span></span>

* <span data-ttu-id="a7a45-112">Serviço de sincronização do Azure do AD Connect **não pode iniciar**.</span><span class="sxs-lookup"><span data-stu-id="a7a45-112">Azure AD Connect Synchronization Service **is unable to start**.</span></span> <span data-ttu-id="a7a45-113">Quando você tentar iniciar o serviço, ele falha com o evento 6323 e mensagem de erro *"o servidor encontrou um erro porque o SQL Server está sem espaço em disco“.*</span><span class="sxs-lookup"><span data-stu-id="a7a45-113">When you attempt to start the service, it fails with event 6323 and error message *"The server encountered an error because SQL Server is out of disk space."*</span></span>

## <a name="short-term-recovery-steps"></a><span data-ttu-id="a7a45-114">Etapas de recuperação de curto prazo</span><span class="sxs-lookup"><span data-stu-id="a7a45-114">Short-term recovery steps</span></span>
<span data-ttu-id="a7a45-115">Esta seção fornece as etapas para recuperar o espaço de banco de dados necessário para o serviço do Azure AD Connect sincronização retomar a operação.</span><span class="sxs-lookup"><span data-stu-id="a7a45-115">This section provides the steps to reclaim DB space required for Azure AD Connect Synchronization Service to resume operation.</span></span> <span data-ttu-id="a7a45-116">As etapas são as seguintes:</span><span class="sxs-lookup"><span data-stu-id="a7a45-116">The steps include:</span></span>
1. [<span data-ttu-id="a7a45-117">Determinar o status do Serviço de Sincronização</span><span class="sxs-lookup"><span data-stu-id="a7a45-117">Determine the Synchronization Service status</span></span>](#determine-the-synchronization-service-status)
2. [<span data-ttu-id="a7a45-118">Reduzir o banco de dados</span><span class="sxs-lookup"><span data-stu-id="a7a45-118">Shrink the database</span></span>](#shrink-the-database)
3. [<span data-ttu-id="a7a45-119">Excluir dados de histórico de execução</span><span class="sxs-lookup"><span data-stu-id="a7a45-119">Delete run history data</span></span>](#delete-run-history-data)
4. [<span data-ttu-id="a7a45-120">Reduzir o período de retenção de dados de histórico de execução</span><span class="sxs-lookup"><span data-stu-id="a7a45-120">Shorten retention period for run history data</span></span>](#shorten-retention-period-for-run-history-data)

### <a name="determine-the-synchronization-service-status"></a><span data-ttu-id="a7a45-121">Determinar o status do serviço de sincronização</span><span class="sxs-lookup"><span data-stu-id="a7a45-121">Determine the Synchronization Service status</span></span>
<span data-ttu-id="a7a45-122">Primeiro, determine se o serviço de sincronização ainda está executando ou não:</span><span class="sxs-lookup"><span data-stu-id="a7a45-122">First, determine whether the Synchronization Service is still running or not:</span></span>

1. <span data-ttu-id="a7a45-123">Faça logon no seu servidor do Azure AD Connect como administrador.</span><span class="sxs-lookup"><span data-stu-id="a7a45-123">Log in to your Azure AD Connect server as administrator.</span></span>

2. <span data-ttu-id="a7a45-124">Vá para **Service Control Manager**.</span><span class="sxs-lookup"><span data-stu-id="a7a45-124">Go to **Service Control Manager**.</span></span>

3. <span data-ttu-id="a7a45-125">Verifique o status do **Microsoft Azure AD Sync**.</span><span class="sxs-lookup"><span data-stu-id="a7a45-125">Check the status of **Microsoft Azure AD Sync**.</span></span>


4. <span data-ttu-id="a7a45-126">Se estiver em execução, não parar ou reiniciar o serviço.</span><span class="sxs-lookup"><span data-stu-id="a7a45-126">If it is running, do not stop or restart the service.</span></span> <span data-ttu-id="a7a45-127">Ignorar [reduzir o banco de dados](#shrink-the-database) etapa e vá para [excluir dados de histórico de executar](#delete-run-history-data) etapa.</span><span class="sxs-lookup"><span data-stu-id="a7a45-127">Skip [Shrink the database](#shrink-the-database) step and go to [Delete run history data](#delete-run-history-data) step.</span></span>

5. <span data-ttu-id="a7a45-128">Se não estiver em execução, tente iniciar o serviço.</span><span class="sxs-lookup"><span data-stu-id="a7a45-128">If it is not running, try to start the service.</span></span> <span data-ttu-id="a7a45-129">Se o serviço foi iniciado com êxito, ignore [reduzir o banco de dados](#shrink-the-database) etapa e vá para [excluir dados de histórico de executar](#delete-run-history-data) etapa.</span><span class="sxs-lookup"><span data-stu-id="a7a45-129">If the service starts successfully, skip [Shrink the database](#shrink-the-database) step and go to [Delete run history data](#delete-run-history-data) step.</span></span> <span data-ttu-id="a7a45-130">Caso contrário, prossiga com a etapa [Reduzir o banco de dados](#shrink-the-database).</span><span class="sxs-lookup"><span data-stu-id="a7a45-130">Otherwise, continue with [Shrink the database](#shrink-the-database) step.</span></span>

### <a name="shrink-the-database"></a><span data-ttu-id="a7a45-131">Reduzir o banco de dados</span><span class="sxs-lookup"><span data-stu-id="a7a45-131">Shrink the database</span></span>
<span data-ttu-id="a7a45-132">Use a operação de redução para liberar espaço de banco de dados para iniciar o serviço de sincronização.</span><span class="sxs-lookup"><span data-stu-id="a7a45-132">Use the Shrink operation to free up enough DB space to start the Synchronization Service.</span></span> <span data-ttu-id="a7a45-133">Ele libera espaço de banco de dados, removendo os espaços em branco no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="a7a45-133">It frees up DB space by removing whitespaces in the database.</span></span> <span data-ttu-id="a7a45-134">Essa etapa é melhor esforço, como não há garantia de que você sempre pode recuperar espaço.</span><span class="sxs-lookup"><span data-stu-id="a7a45-134">This step is best-effort as it is not guaranteed that you can always recover space.</span></span> <span data-ttu-id="a7a45-135">Para saber mais sobre a operação de redução, leia este artigo [reduzir um banco de dados](https://msdn.microsoft.com/library/ms189035.aspx).</span><span class="sxs-lookup"><span data-stu-id="a7a45-135">To learn more about Shrink operation, read this article [Shrink a database](https://msdn.microsoft.com/library/ms189035.aspx).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a7a45-136">Ignore esta etapa se você pode obter o serviço de sincronização para execução.</span><span class="sxs-lookup"><span data-stu-id="a7a45-136">Skip this step if you can get the Synchronization Service to run.</span></span> <span data-ttu-id="a7a45-137">Não é recomendável para reduzir o banco de dados SQL que pode levar a mau desempenho devido à maior fragmentação.</span><span class="sxs-lookup"><span data-stu-id="a7a45-137">It is not recommended to shrink the SQL DB as it can lead to poor performance due to increased fragmentation.</span></span>

<span data-ttu-id="a7a45-138">O nome do banco de dados criado para o Azure AD Connect é **ADSync**.</span><span class="sxs-lookup"><span data-stu-id="a7a45-138">The name of the database created for Azure AD Connect is **ADSync**.</span></span> <span data-ttu-id="a7a45-139">Para executar uma operação de redução, você deve fazer em como o administrador do sistema ou DBO do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="a7a45-139">To perform a Shrink operation, you must log in either as the sysadmin or DBO of the database.</span></span> <span data-ttu-id="a7a45-140">Durante a instalação do Azure AD Connect, as contas a seguir são concedidas direitos de sysadmin:</span><span class="sxs-lookup"><span data-stu-id="a7a45-140">During Azure AD Connect installation, the following accounts are granted sysadmin rights:</span></span>
* <span data-ttu-id="a7a45-141">Administradores Locais</span><span class="sxs-lookup"><span data-stu-id="a7a45-141">Local Administrators</span></span>
* <span data-ttu-id="a7a45-142">A conta de usuário que foi usada para executar a instalação do Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="a7a45-142">The user account that was used to run Azure AD Connect installation.</span></span>
* <span data-ttu-id="a7a45-143">A conta de serviço de sincronização que é usada como o contexto operacional do serviço de sincronização do Azure do AD Connect.</span><span class="sxs-lookup"><span data-stu-id="a7a45-143">The Sync Service account that is used as the operating context of Azure AD Connect Synchronization Service.</span></span>
* <span data-ttu-id="a7a45-144">O grupo local ADSyncAdmins criado durante a instalação.</span><span class="sxs-lookup"><span data-stu-id="a7a45-144">The local group ADSyncAdmins that was created during installation.</span></span>

1. <span data-ttu-id="a7a45-145">O banco de dados por meio da cópia de backup **ADSync.mdf** e **ADSync_log.ldf** arquivos localizados em `%ProgramFiles%\program files\Microsoft Azure AD Sync\Data` para um local seguro.</span><span class="sxs-lookup"><span data-stu-id="a7a45-145">Back up the database by copying **ADSync.mdf** and **ADSync_log.ldf** files located under `%ProgramFiles%\program files\Microsoft Azure AD Sync\Data` to a safe location.</span></span>

2. <span data-ttu-id="a7a45-146">Inicie uma nova sessão do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a7a45-146">Start a new PowerShell session.</span></span>

3. <span data-ttu-id="a7a45-147">Navegue até a pasta `%ProgramFiles%\Program Files\Microsoft SQL Server\110\Tools\Binn`.</span><span class="sxs-lookup"><span data-stu-id="a7a45-147">Navigate to folder `%ProgramFiles%\Program Files\Microsoft SQL Server\110\Tools\Binn`.</span></span>

4. <span data-ttu-id="a7a45-148">Iniciar **sqlcmd** utilitário executando o comando `./SQLCMD.EXE -S “(localdb)\.\ADSync” -U <Username> -P <Password>`, usando a credencial de um administrador do sistema ou o DBO do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="a7a45-148">Start **sqlcmd** utility by running the command `./SQLCMD.EXE -S “(localdb)\.\ADSync” -U <Username> -P <Password>`, using the credential of a sysadmin or the database DBO.</span></span>

5. <span data-ttu-id="a7a45-149">Para reduzir o banco de dados, no prompt do sqlcmd (1>), digite `DBCC Shrinkdatabase(ADSync,1);`, seguido por `GO` na próxima linha.</span><span class="sxs-lookup"><span data-stu-id="a7a45-149">To shrink the database, at the sqlcmd prompt (1>), enter `DBCC Shrinkdatabase(ADSync,1);`, followed by `GO` in the next line.</span></span>

6. <span data-ttu-id="a7a45-150">Se a operação for bem-sucedida, tente iniciar o serviço de sincronização novamente.</span><span class="sxs-lookup"><span data-stu-id="a7a45-150">If the operation is successful, try to start the Synchronization Service again.</span></span> <span data-ttu-id="a7a45-151">Se você puder iniciar o serviço de sincronização, vá para [excluir dados de histórico de executar](#delete-run-history-data) etapa.</span><span class="sxs-lookup"><span data-stu-id="a7a45-151">If you can start the Synchronization Service, go to [Delete run history data](#delete-run-history-data) step.</span></span> <span data-ttu-id="a7a45-152">Caso contrário, contate o Suporte.</span><span class="sxs-lookup"><span data-stu-id="a7a45-152">If not, contact Support.</span></span>

### <a name="delete-run-history-data"></a><span data-ttu-id="a7a45-153">Excluir dados de histórico de execução</span><span class="sxs-lookup"><span data-stu-id="a7a45-153">Delete run history data</span></span>
<span data-ttu-id="a7a45-154">Por padrão, Azure AD Connect retém a dias sete de dados de histórico de execução.</span><span class="sxs-lookup"><span data-stu-id="a7a45-154">By default, Azure AD Connect retains up to seven days’ worth of run history data.</span></span> <span data-ttu-id="a7a45-155">Nesta etapa, podemos excluir os dados de histórico de execução para recuperar espaço de banco de dados para que o serviço de sincronização do Azure do AD Connect pode começar a sincronizar novamente.</span><span class="sxs-lookup"><span data-stu-id="a7a45-155">In this step, we delete the run history data to reclaim DB space so that Azure AD Connect Synchronization Service can start syncing again.</span></span>

1.  <span data-ttu-id="a7a45-156">Inicie o **Gerenciador de Serviço de Sincronização** indo para INICIAR → Serviço de Sincronização.</span><span class="sxs-lookup"><span data-stu-id="a7a45-156">Start **Synchronization Service Manager** by going to START → Synchronization Service.</span></span>

2.  <span data-ttu-id="a7a45-157">Vá para a guia **Operações**.</span><span class="sxs-lookup"><span data-stu-id="a7a45-157">Go to the **Operations** tab.</span></span>

3.  <span data-ttu-id="a7a45-158">Em **Ações**, selecione **Limpar Execuções**…</span><span class="sxs-lookup"><span data-stu-id="a7a45-158">Under **Actions**, select **Clear Runs**…</span></span>

4.  <span data-ttu-id="a7a45-159">Você pode escolher a opção **Limpar todas as execuções** ou **Limpar execuções antes de... <date>**.</span><span class="sxs-lookup"><span data-stu-id="a7a45-159">You can either choose **Clear all runs** or **Clear runs before… <date>** option.</span></span> <span data-ttu-id="a7a45-160">É recomendável que você comece desmarcando os dados de histórico de execução com mais de dois dias.</span><span class="sxs-lookup"><span data-stu-id="a7a45-160">It is recommended that you start by clearing run history data that are older than two days.</span></span> <span data-ttu-id="a7a45-161">Se você continuar a executar o problema de tamanho do banco de dados, escolha o **limpar todas as execuções** opção.</span><span class="sxs-lookup"><span data-stu-id="a7a45-161">If you continue to run into DB size issue, then choose the **Clear all runs** option.</span></span>

### <a name="shorten-retention-period-for-run-history-data"></a><span data-ttu-id="a7a45-162">Reduzir o período de retenção de dados de histórico de execução</span><span class="sxs-lookup"><span data-stu-id="a7a45-162">Shorten retention period for run history data</span></span>
<span data-ttu-id="a7a45-163">Esta etapa é reduzir a probabilidade de executando o problema de limite de 10 GB após vários ciclos de sincronização.</span><span class="sxs-lookup"><span data-stu-id="a7a45-163">This step is to reduce the likelihood of running into the 10-GB limit issue after multiple sync cycles.</span></span>

1. <span data-ttu-id="a7a45-164">Abra uma nova sessão do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a7a45-164">Open a new PowerShell session.</span></span>

2. <span data-ttu-id="a7a45-165">Execute `Get-ADSyncScheduler` e anote a propriedade PurgeRunHistoryInterval, que especifica o período de retenção atual.</span><span class="sxs-lookup"><span data-stu-id="a7a45-165">Run `Get-ADSyncScheduler` and take note of the PurgeRunHistoryInterval property, which specifies the current retention period.</span></span>

3. <span data-ttu-id="a7a45-166">Execute `Set-ADSyncScheduler -PurgeRunHistoryInterval 2.00:00:00` para definir o período de retenção como dois dias.</span><span class="sxs-lookup"><span data-stu-id="a7a45-166">Run `Set-ADSyncScheduler -PurgeRunHistoryInterval 2.00:00:00` to set the retention period to two days.</span></span> <span data-ttu-id="a7a45-167">Ajuste o período de retenção, como apropriado.</span><span class="sxs-lookup"><span data-stu-id="a7a45-167">Adjust the retention period as appropriate.</span></span>

## <a name="long-term-solution--migrate-to-full-sql"></a><span data-ttu-id="a7a45-168">Solução de longo prazo – migrar para o SQL completo</span><span class="sxs-lookup"><span data-stu-id="a7a45-168">Long-term solution – Migrate to full SQL</span></span>
<span data-ttu-id="a7a45-169">Em geral, o problema é indicativo de que o tamanho do banco de dados de 10 GB não é mais suficiente para o Azure AD Connect sincronizar seu Active Directory local ao Azure AD.</span><span class="sxs-lookup"><span data-stu-id="a7a45-169">In general, the issue is indicative that 10-GB database size is no longer sufficient for Azure AD Connect to synchronize your on-premises Active Directory to Azure AD.</span></span> <span data-ttu-id="a7a45-170">É recomendável que você troque pelo uso da versão completa do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="a7a45-170">It is recommended that you switch to using the full version of SQL server.</span></span> <span data-ttu-id="a7a45-171">Você não pode substituir o LocalDB de uma implantação existente do Azure AD Connect diretamente com o banco de dados da versão completa do SQL.</span><span class="sxs-lookup"><span data-stu-id="a7a45-171">You cannot directly replace the LocalDB of an existing Azure AD Connect deployment with the database of the full version of SQL.</span></span> <span data-ttu-id="a7a45-172">Em vez disso, você deve implantar um novo servidor do Azure AD Connect com a versão completa do SQL.</span><span class="sxs-lookup"><span data-stu-id="a7a45-172">Instead, you must deploy a new Azure AD Connect server with the full version of SQL.</span></span> <span data-ttu-id="a7a45-173">É recomendável que você faça uma migração swing, onde o novo servidor do Azure AD Connect (com o banco de dados SQL) é implantado como um servidor de preparo, ao lado do servidor do Azure AD Connect existente (com o LocalDB).</span><span class="sxs-lookup"><span data-stu-id="a7a45-173">It is recommended that you do a swing migration where the new Azure AD Connect server (with SQL DB) is deployed as a staging server, next to the existing Azure AD Connect server (with LocalDB).</span></span> 
* <span data-ttu-id="a7a45-174">Para obter instruções sobre como configurar o remote SQL com o Azure AD Connect, consulte o artigo [instalação personalizada do Azure AD Connect](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-get-started-custom).</span><span class="sxs-lookup"><span data-stu-id="a7a45-174">For instruction on how to configure remote SQL with Azure AD Connect, refer to article [Custom installation of Azure AD Connect](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-get-started-custom).</span></span>
* <span data-ttu-id="a7a45-175">Para obter instruções sobre a migração swing para atualização do Azure AD Connect, veja o artigo [Azure AD Connect: Atualização de uma versão anterior para a versão mais recente](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-upgrade-previous-version#swing-migration).</span><span class="sxs-lookup"><span data-stu-id="a7a45-175">For instructions on swing migration for Azure AD Connect upgrade, refer to article [Azure AD Connect: Upgrade from a previous version to the latest](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-upgrade-previous-version#swing-migration).</span></span>

## <a name="next-steps"></a><span data-ttu-id="a7a45-176">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="a7a45-176">Next steps</span></span>
<span data-ttu-id="a7a45-177">Saiba mais sobre [Como integrar suas identidades locais ao Active Directory do Azure](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="a7a45-177">Learn more about [Integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span></span>
