---
title: "Conexão do AD do Azure: Como limitar toorecover do LocalDB 10GB problema | Microsoft Docs"
description: "Este tópico descreve como toorecover sincronização do Azure do AD Connect de serviço quando ele encontra LocalDB 10GB limitar o problema."
services: active-directory
documentationcenter: 
author: cychua
manager: femila
editor: 
ms.assetid: 41d081af-ed89-4e17-be34-14f7e80ae358
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/17/2017
ms.author: billmath
ms.openlocfilehash: 7b8ce6e19b68837639017bb0315eda4b924d525a
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="azure-ad-connect-how-toorecover-from-localdb-10-gb-limit"></a><span data-ttu-id="ccc61-103">Conexão do AD do Azure: Como toorecover do limite de 10 GB do LocalDB</span><span class="sxs-lookup"><span data-stu-id="ccc61-103">Azure AD Connect: How toorecover from LocalDB 10-GB limit</span></span>
<span data-ttu-id="ccc61-104">Conexão do AD do Azure requer um dados de identidade de toostore de banco de dados do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="ccc61-104">Azure AD Connect requires a SQL Server database toostore identity data.</span></span> <span data-ttu-id="ccc61-105">Você pode usar saudação padrão do que SQL Server 2012 Express LocalDB é instalado com o Azure AD Connect ou usar seu próprio SQL completo.</span><span class="sxs-lookup"><span data-stu-id="ccc61-105">You can either use hello default SQL Server 2012 Express LocalDB installed with Azure AD Connect or use your own full SQL.</span></span> <span data-ttu-id="ccc61-106">O SQL Server Express impõe um limite de tamanho de 10 GB.</span><span class="sxs-lookup"><span data-stu-id="ccc61-106">SQL Server Express imposes a 10-GB size limit.</span></span> <span data-ttu-id="ccc61-107">Ao usar o LocalDB e esse limite for atingido, o serviço de sincronização do Azure do AD Connect não pode iniciar ou sincronizar corretamente.</span><span class="sxs-lookup"><span data-stu-id="ccc61-107">When using LocalDB and this limit is reached, Azure AD Connect Synchronization Service can no longer start or synchronize properly.</span></span> <span data-ttu-id="ccc61-108">Este artigo fornece as etapas de recuperação de saudação.</span><span class="sxs-lookup"><span data-stu-id="ccc61-108">This article provides hello recovery steps.</span></span>

## <a name="symptoms"></a><span data-ttu-id="ccc61-109">Sintomas</span><span class="sxs-lookup"><span data-stu-id="ccc61-109">Symptoms</span></span>
<span data-ttu-id="ccc61-110">Há dois sintomas comuns:</span><span class="sxs-lookup"><span data-stu-id="ccc61-110">There are two common symptoms:</span></span>

* <span data-ttu-id="ccc61-111">Serviço de sincronização se conectar do Azure AD **está em execução** , mas falha toosynchronize com *"parado-banco de dados-disco cheio"* erro.</span><span class="sxs-lookup"><span data-stu-id="ccc61-111">Azure AD Connect Synchronization Service **is running** but fails toosynchronize with *“stopped-database-disk-full”* error.</span></span>

* <span data-ttu-id="ccc61-112">Serviço de sincronização se conectar do Azure AD **é toostart não é possível**.</span><span class="sxs-lookup"><span data-stu-id="ccc61-112">Azure AD Connect Synchronization Service **is unable toostart**.</span></span> <span data-ttu-id="ccc61-113">Quando você tenta toostart serviço de hello, falhar com a mensagem de erro e de evento 6323 *"servidor de saudação encontrou um erro porque o SQL Server está sem espaço em disco."*</span><span class="sxs-lookup"><span data-stu-id="ccc61-113">When you attempt toostart hello service, it fails with event 6323 and error message *"hello server encountered an error because SQL Server is out of disk space."*</span></span>

## <a name="short-term-recovery-steps"></a><span data-ttu-id="ccc61-114">Etapas de recuperação de curto prazo</span><span class="sxs-lookup"><span data-stu-id="ccc61-114">Short-term recovery steps</span></span>
<span data-ttu-id="ccc61-115">Esta seção fornece espaço em tooreclaim DB Olá etapas necessário para a operação do serviço de sincronização se conectar do Azure AD tooresume.</span><span class="sxs-lookup"><span data-stu-id="ccc61-115">This section provides hello steps tooreclaim DB space required for Azure AD Connect Synchronization Service tooresume operation.</span></span> <span data-ttu-id="ccc61-116">Olá etapas incluem:</span><span class="sxs-lookup"><span data-stu-id="ccc61-116">hello steps include:</span></span>
1. [<span data-ttu-id="ccc61-117">Determinar o status do serviço de sincronização Olá</span><span class="sxs-lookup"><span data-stu-id="ccc61-117">Determine hello Synchronization Service status</span></span>](#determine-the-synchronization-service-status)
2. [<span data-ttu-id="ccc61-118">Reduzir Olá banco de dados</span><span class="sxs-lookup"><span data-stu-id="ccc61-118">Shrink hello database</span></span>](#shrink-the-database)
3. [<span data-ttu-id="ccc61-119">Excluir dados de histórico de execução</span><span class="sxs-lookup"><span data-stu-id="ccc61-119">Delete run history data</span></span>](#delete-run-history-data)
4. [<span data-ttu-id="ccc61-120">Reduzir o período de retenção de dados de histórico de execução</span><span class="sxs-lookup"><span data-stu-id="ccc61-120">Shorten retention period for run history data</span></span>](#shorten-retention-period-for-run-history-data)

### <a name="determine-hello-synchronization-service-status"></a><span data-ttu-id="ccc61-121">Determinar o status do serviço de sincronização Olá</span><span class="sxs-lookup"><span data-stu-id="ccc61-121">Determine hello Synchronization Service status</span></span>
<span data-ttu-id="ccc61-122">Primeiro, determine se Olá serviço de sincronização ainda está executando ou não:</span><span class="sxs-lookup"><span data-stu-id="ccc61-122">First, determine whether hello Synchronization Service is still running or not:</span></span>

1. <span data-ttu-id="ccc61-123">Faça logon tooyour servidor da conexão do AD do Azure como administrador.</span><span class="sxs-lookup"><span data-stu-id="ccc61-123">Log in tooyour Azure AD Connect server as administrator.</span></span>

2. <span data-ttu-id="ccc61-124">Vá muito**Service Control Manager**.</span><span class="sxs-lookup"><span data-stu-id="ccc61-124">Go too**Service Control Manager**.</span></span>

3. <span data-ttu-id="ccc61-125">Verificar status de saudação do **Microsoft Azure AD Sync**.</span><span class="sxs-lookup"><span data-stu-id="ccc61-125">Check hello status of **Microsoft Azure AD Sync**.</span></span>


4. <span data-ttu-id="ccc61-126">Se ele estiver em execução, não interromper ou reiniciar o serviço de saudação.</span><span class="sxs-lookup"><span data-stu-id="ccc61-126">If it is running, do not stop or restart hello service.</span></span> <span data-ttu-id="ccc61-127">Ignorar [banco de dados de saudação redução](#shrink-the-database) etapa e vá muito[excluir dados de histórico de execução](#delete-run-history-data) etapa.</span><span class="sxs-lookup"><span data-stu-id="ccc61-127">Skip [Shrink hello database](#shrink-the-database) step and go too[Delete run history data](#delete-run-history-data) step.</span></span>

5. <span data-ttu-id="ccc61-128">Se não estiver em execução, tente toostart serviço de saudação.</span><span class="sxs-lookup"><span data-stu-id="ccc61-128">If it is not running, try toostart hello service.</span></span> <span data-ttu-id="ccc61-129">Se o serviço de saudação é iniciado com êxito, ignore [banco de dados de saudação redução](#shrink-the-database) etapa e vá muito[excluir dados de histórico de execução](#delete-run-history-data) etapa.</span><span class="sxs-lookup"><span data-stu-id="ccc61-129">If hello service starts successfully, skip [Shrink hello database](#shrink-the-database) step and go too[Delete run history data](#delete-run-history-data) step.</span></span> <span data-ttu-id="ccc61-130">Caso contrário, prossiga com [banco de dados de saudação redução](#shrink-the-database) etapa.</span><span class="sxs-lookup"><span data-stu-id="ccc61-130">Otherwise, continue with [Shrink hello database](#shrink-the-database) step.</span></span>

### <a name="shrink-hello-database"></a><span data-ttu-id="ccc61-131">Reduzir Olá banco de dados</span><span class="sxs-lookup"><span data-stu-id="ccc61-131">Shrink hello database</span></span>
<span data-ttu-id="ccc61-132">Use toofree de operação de redução Olá backup suficiente Olá de toostart de espaço do banco de dados serviço de sincronização.</span><span class="sxs-lookup"><span data-stu-id="ccc61-132">Use hello Shrink operation toofree up enough DB space toostart hello Synchronization Service.</span></span> <span data-ttu-id="ccc61-133">Ele libera o espaço de banco de dados ao remover espaços em branco no banco de dados de saudação.</span><span class="sxs-lookup"><span data-stu-id="ccc61-133">It frees up DB space by removing whitespaces in hello database.</span></span> <span data-ttu-id="ccc61-134">Essa etapa é melhor esforço, como não há garantia de que você sempre pode recuperar espaço.</span><span class="sxs-lookup"><span data-stu-id="ccc61-134">This step is best-effort as it is not guaranteed that you can always recover space.</span></span> <span data-ttu-id="ccc61-135">toolearn mais sobre a operação de redução, leia este artigo [reduzir um banco de dados](https://msdn.microsoft.com/library/ms189035.aspx).</span><span class="sxs-lookup"><span data-stu-id="ccc61-135">toolearn more about Shrink operation, read this article [Shrink a database](https://msdn.microsoft.com/library/ms189035.aspx).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="ccc61-136">Ignore esta etapa se você pode obter Olá toorun de serviço de sincronização.</span><span class="sxs-lookup"><span data-stu-id="ccc61-136">Skip this step if you can get hello Synchronization Service toorun.</span></span> <span data-ttu-id="ccc61-137">Olá tooshrink banco de dados SQL não é recomendável porque ele pode levar toopoor desempenho devido a fragmentação tooincreased.</span><span class="sxs-lookup"><span data-stu-id="ccc61-137">It is not recommended tooshrink hello SQL DB as it can lead toopoor performance due tooincreased fragmentation.</span></span>

<span data-ttu-id="ccc61-138">nome de saudação do banco de dados de saudação criado para o Azure AD Connect é **ADSync**.</span><span class="sxs-lookup"><span data-stu-id="ccc61-138">hello name of hello database created for Azure AD Connect is **ADSync**.</span></span> <span data-ttu-id="ccc61-139">tooperform uma operação de redução, faça logon no como Olá sysadmin ou DBO do banco de dados de saudação.</span><span class="sxs-lookup"><span data-stu-id="ccc61-139">tooperform a Shrink operation, you must log in either as hello sysadmin or DBO of hello database.</span></span> <span data-ttu-id="ccc61-140">Durante a instalação do Azure AD Connect, Olá contas a seguir é concedido direitos de administrador do sistema:</span><span class="sxs-lookup"><span data-stu-id="ccc61-140">During Azure AD Connect installation, hello following accounts are granted sysadmin rights:</span></span>
* <span data-ttu-id="ccc61-141">Administradores Locais</span><span class="sxs-lookup"><span data-stu-id="ccc61-141">Local Administrators</span></span>
* <span data-ttu-id="ccc61-142">conta de usuário de saudação que foi usado toorun AD do Azure Connect instalação.</span><span class="sxs-lookup"><span data-stu-id="ccc61-142">hello user account that was used toorun Azure AD Connect installation.</span></span>
* <span data-ttu-id="ccc61-143">Olá conta de serviço de sincronização que é usada como Olá operacional contexto do serviço de sincronização se conectar do Azure AD.</span><span class="sxs-lookup"><span data-stu-id="ccc61-143">hello Sync Service account that is used as hello operating context of Azure AD Connect Synchronization Service.</span></span>
* <span data-ttu-id="ccc61-144">Olá grupo ADSyncAdmins que foi criado durante a instalação.</span><span class="sxs-lookup"><span data-stu-id="ccc61-144">hello local group ADSyncAdmins that was created during installation.</span></span>

1. <span data-ttu-id="ccc61-145">Saudação de banco de dados por meio da cópia de backup **ADSync.mdf** e **ADSync_log.ldf** arquivos localizados em `%ProgramFiles%\program files\Microsoft Azure AD Sync\Data` local seguro tooa.</span><span class="sxs-lookup"><span data-stu-id="ccc61-145">Back up hello database by copying **ADSync.mdf** and **ADSync_log.ldf** files located under `%ProgramFiles%\program files\Microsoft Azure AD Sync\Data` tooa safe location.</span></span>

2. <span data-ttu-id="ccc61-146">Inicie uma nova sessão do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ccc61-146">Start a new PowerShell session.</span></span>

3. <span data-ttu-id="ccc61-147">Navegue toofolder `%ProgramFiles%\Program Files\Microsoft SQL Server\110\Tools\Binn`.</span><span class="sxs-lookup"><span data-stu-id="ccc61-147">Navigate toofolder `%ProgramFiles%\Program Files\Microsoft SQL Server\110\Tools\Binn`.</span></span>

4. <span data-ttu-id="ccc61-148">Iniciar **sqlcmd** utilitário executando o comando Olá `./SQLCMD.EXE -S “(localdb)\.\ADSync” -U <Username> -P <Password>`, usando a credencial de saudação do sysadmin ou Olá DBO do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="ccc61-148">Start **sqlcmd** utility by running hello command `./SQLCMD.EXE -S “(localdb)\.\ADSync” -U <Username> -P <Password>`, using hello credential of a sysadmin or hello database DBO.</span></span>

5. <span data-ttu-id="ccc61-149">tooshrink Olá banco de dados, no prompt de sqlcmd hello (1 >), digite `DBCC Shrinkdatabase(ADSync,1);`, seguido por `GO` na próxima linha de saudação.</span><span class="sxs-lookup"><span data-stu-id="ccc61-149">tooshrink hello database, at hello sqlcmd prompt (1>), enter `DBCC Shrinkdatabase(ADSync,1);`, followed by `GO` in hello next line.</span></span>

6. <span data-ttu-id="ccc61-150">Se Olá operação for bem-sucedida, tente toostart Olá serviço de sincronização novamente.</span><span class="sxs-lookup"><span data-stu-id="ccc61-150">If hello operation is successful, try toostart hello Synchronization Service again.</span></span> <span data-ttu-id="ccc61-151">Se você puder iniciar Olá serviço de sincronização, vá muito[excluir dados de histórico de execução](#delete-run-history-data) etapa.</span><span class="sxs-lookup"><span data-stu-id="ccc61-151">If you can start hello Synchronization Service, go too[Delete run history data](#delete-run-history-data) step.</span></span> <span data-ttu-id="ccc61-152">Caso contrário, contate o Suporte.</span><span class="sxs-lookup"><span data-stu-id="ccc61-152">If not, contact Support.</span></span>

### <a name="delete-run-history-data"></a><span data-ttu-id="ccc61-153">Excluir dados de histórico de execução</span><span class="sxs-lookup"><span data-stu-id="ccc61-153">Delete run history data</span></span>
<span data-ttu-id="ccc61-154">Por padrão, o Azure AD Connect retém o tooseven dias de dados de histórico de execução.</span><span class="sxs-lookup"><span data-stu-id="ccc61-154">By default, Azure AD Connect retains up tooseven days’ worth of run history data.</span></span> <span data-ttu-id="ccc61-155">Nesta etapa, excluímos Olá espaço de tooreclaim banco de dados de dados de histórico de execução para que o serviço de sincronização se conectar do Azure AD pode começar a sincronizar novamente.</span><span class="sxs-lookup"><span data-stu-id="ccc61-155">In this step, we delete hello run history data tooreclaim DB space so that Azure AD Connect Synchronization Service can start syncing again.</span></span>

1.  <span data-ttu-id="ccc61-156">Iniciar **Synchronization Service Manager** pelo vai tooSTART → serviço de sincronização.</span><span class="sxs-lookup"><span data-stu-id="ccc61-156">Start **Synchronization Service Manager** by going tooSTART → Synchronization Service.</span></span>

2.  <span data-ttu-id="ccc61-157">Vá toohello **operações** guia.</span><span class="sxs-lookup"><span data-stu-id="ccc61-157">Go toohello **Operations** tab.</span></span>

3.  <span data-ttu-id="ccc61-158">Em **Ações**, selecione **Limpar Execuções**…</span><span class="sxs-lookup"><span data-stu-id="ccc61-158">Under **Actions**, select **Clear Runs**…</span></span>

4.  <span data-ttu-id="ccc61-159">Você pode escolher a opção **Limpar todas as execuções** ou **Limpar execuções antes de... <date>**.</span><span class="sxs-lookup"><span data-stu-id="ccc61-159">You can either choose **Clear all runs** or **Clear runs before… <date>** option.</span></span> <span data-ttu-id="ccc61-160">É recomendável que você comece desmarcando os dados de histórico de execução com mais de dois dias.</span><span class="sxs-lookup"><span data-stu-id="ccc61-160">It is recommended that you start by clearing run history data that are older than two days.</span></span> <span data-ttu-id="ccc61-161">Se você continuar toorun problema de tamanho do banco de dados, em seguida, escolha Olá **limpar todas as execuções** opção.</span><span class="sxs-lookup"><span data-stu-id="ccc61-161">If you continue toorun into DB size issue, then choose hello **Clear all runs** option.</span></span>

### <a name="shorten-retention-period-for-run-history-data"></a><span data-ttu-id="ccc61-162">Reduzir o período de retenção de dados de histórico de execução</span><span class="sxs-lookup"><span data-stu-id="ccc61-162">Shorten retention period for run history data</span></span>
<span data-ttu-id="ccc61-163">Esta etapa é a probabilidade de saudação do tooreduce em execução em um problema de limite de 10 GB de saudação após vários ciclos de sincronização.</span><span class="sxs-lookup"><span data-stu-id="ccc61-163">This step is tooreduce hello likelihood of running into hello 10-GB limit issue after multiple sync cycles.</span></span>

1. <span data-ttu-id="ccc61-164">Abra uma nova sessão do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ccc61-164">Open a new PowerShell session.</span></span>

2. <span data-ttu-id="ccc61-165">Execute `Get-ADSyncScheduler` e anote Olá propriedade PurgeRunHistoryInterval, que especifica o período de retenção atual hello.</span><span class="sxs-lookup"><span data-stu-id="ccc61-165">Run `Get-ADSyncScheduler` and take note of hello PurgeRunHistoryInterval property, which specifies hello current retention period.</span></span>

3. <span data-ttu-id="ccc61-166">Executar `Set-ADSyncScheduler -PurgeRunHistoryInterval 2.00:00:00` tooset Olá retenção tootwo período em dias.</span><span class="sxs-lookup"><span data-stu-id="ccc61-166">Run `Set-ADSyncScheduler -PurgeRunHistoryInterval 2.00:00:00` tooset hello retention period tootwo days.</span></span> <span data-ttu-id="ccc61-167">Ajuste o período de retenção de saudação conforme apropriado.</span><span class="sxs-lookup"><span data-stu-id="ccc61-167">Adjust hello retention period as appropriate.</span></span>

## <a name="long-term-solution--migrate-toofull-sql"></a><span data-ttu-id="ccc61-168">Solução de longo prazo – migrar toofull SQL</span><span class="sxs-lookup"><span data-stu-id="ccc61-168">Long-term solution – Migrate toofull SQL</span></span>
<span data-ttu-id="ccc61-169">Em geral, problema de saudação é uma indicação de que o tamanho do banco de dados de 10 GB não é suficiente para toosynchronize do Azure AD Connect seu tooAzure do Active Directory local AD.</span><span class="sxs-lookup"><span data-stu-id="ccc61-169">In general, hello issue is indicative that 10-GB database size is no longer sufficient for Azure AD Connect toosynchronize your on-premises Active Directory tooAzure AD.</span></span> <span data-ttu-id="ccc61-170">É recomendável que você mude a versão completa do toousing saudação do SQL server.</span><span class="sxs-lookup"><span data-stu-id="ccc61-170">It is recommended that you switch toousing hello full version of SQL server.</span></span> <span data-ttu-id="ccc61-171">Diretamente, você não pode substituir Olá LocalDB de uma implantação existente do Azure AD Connect com banco de dados de saudação da versão completa de saudação do SQL.</span><span class="sxs-lookup"><span data-stu-id="ccc61-171">You cannot directly replace hello LocalDB of an existing Azure AD Connect deployment with hello database of hello full version of SQL.</span></span> <span data-ttu-id="ccc61-172">Em vez disso, você deve implantar um novo servidor do Azure AD Connect com a versão completa de saudação do SQL.</span><span class="sxs-lookup"><span data-stu-id="ccc61-172">Instead, you must deploy a new Azure AD Connect server with hello full version of SQL.</span></span> <span data-ttu-id="ccc61-173">É recomendável que você execute uma migração de giro onde o novo servidor de conexão do AD do Azure Olá, (com o banco de dados SQL) é implantado como um servidor de preparo, o próximo toohello existente do Azure AD Connect servidor (com LocalDB).</span><span class="sxs-lookup"><span data-stu-id="ccc61-173">It is recommended that you do a swing migration where hello new Azure AD Connect server (with SQL DB) is deployed as a staging server, next toohello existing Azure AD Connect server (with LocalDB).</span></span> 
* <span data-ttu-id="ccc61-174">Para obter instruções sobre como tooconfigure SQL remoto com o Azure AD Connect, consulte tooarticle [instalação personalizada do Azure AD Connect](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-get-started-custom).</span><span class="sxs-lookup"><span data-stu-id="ccc61-174">For instruction on how tooconfigure remote SQL with Azure AD Connect, refer tooarticle [Custom installation of Azure AD Connect](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-get-started-custom).</span></span>
* <span data-ttu-id="ccc61-175">Para obter instruções sobre a migração de movimento para a atualização do Azure AD Connect, consulte tooarticle [do Azure AD Connect: atualização do toohello versão anterior mais recente](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-upgrade-previous-version#swing-migration).</span><span class="sxs-lookup"><span data-stu-id="ccc61-175">For instructions on swing migration for Azure AD Connect upgrade, refer tooarticle [Azure AD Connect: Upgrade from a previous version toohello latest](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-upgrade-previous-version#swing-migration).</span></span>

## <a name="next-steps"></a><span data-ttu-id="ccc61-176">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="ccc61-176">Next steps</span></span>
<span data-ttu-id="ccc61-177">Saiba mais sobre [Como integrar suas identidades locais ao Active Directory do Azure](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="ccc61-177">Learn more about [Integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span></span>
