---
title: "aaaHow toobuild um aplicativo que possa entrar em qualquer usuário do AD do Azure | Microsoft Docs"
description: "Instruções passo a passo para a criação de um aplicativo que pode conectar um usuário de qualquer locatário do Azure Active Directory, também conhecido como aplicativo multilocatário."
services: active-directory
documentationcenter: 
author: dstrockis
manager: mbaldwin
editor: 
ms.assetid: 35af95cb-ced3-46ad-b01d-5d2f6fd064a3
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 04/26/2017
ms.author: dastrock
ms.custom: aaddev
ms.openlocfilehash: 123ea8125fa3c308ce0f124cc58e85ec28d476d5
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="how-toosign-in-any-azure-active-directory-ad-user-using-hello-multi-tenant-application-pattern"></a><span data-ttu-id="47e88-103">Como toosign em qualquer usuário do Azure AD (Active Directory) usando Olá padrão de aplicativo multilocatário</span><span class="sxs-lookup"><span data-stu-id="47e88-103">How toosign in any Azure Active Directory (AD) user using hello multi-tenant application pattern</span></span>
<span data-ttu-id="47e88-104">Se você oferecer um Software como um toomany do aplicativo de serviço organizações, você pode configurar seu aplicativo tooaccept entradas de qualquer locatário do AD do Azure.</span><span class="sxs-lookup"><span data-stu-id="47e88-104">If you offer a Software as a Service application toomany organizations, you can configure your application tooaccept sign-ins from any Azure AD tenant.</span></span>  <span data-ttu-id="47e88-105">No Azure AD, isso é chamado de tornar seu aplicativo multilocatário.</span><span class="sxs-lookup"><span data-stu-id="47e88-105">In Azure AD this is called making your application multi-tenant.</span></span>  <span data-ttu-id="47e88-106">Os usuários em qualquer locatário do AD do Azure será capaz de toosign no aplicativo tooyour após consentimento toouse sua conta com seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="47e88-106">Users in any Azure AD tenant will be able toosign in tooyour application after consenting toouse their account with your application.</span></span>  

<span data-ttu-id="47e88-107">Se você tiver um aplicativo que tem seu próprio sistema de contas ou que dá suporte a outros tipos de conexão por meio de outros provedores de nuvem, a adição da conexão do Azure AD em qualquer locatário será simples.</span><span class="sxs-lookup"><span data-stu-id="47e88-107">If you have an existing application that has its own account system, or supports other kinds of sign-in from other cloud providers, adding Azure AD sign-in from any tenant is simple.</span></span> <span data-ttu-id="47e88-108">Basta registrar o aplicativo, adicionar o código de conexão pelo OAuth2, OpenID Connect ou SAML e colocar um botão “Entrar com a Microsoft” em seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="47e88-108">Just register your app, add sign-in code via OAuth2, OpenID Connect, or SAML, and put a "Sign In with Microsoft" button on your application.</span></span> <span data-ttu-id="47e88-109">Clique em Olá botão toolearn mais sobre a marcação de seu aplicativo a seguir.</span><span class="sxs-lookup"><span data-stu-id="47e88-109">Click hello following button toolearn more about branding your application.</span></span>

<span data-ttu-id="47e88-110">[![Sign in button][AAD-Sign-In]][AAD-App-Branding]</span><span class="sxs-lookup"><span data-stu-id="47e88-110">[![Sign in button][AAD-Sign-In]][AAD-App-Branding]</span></span>

<span data-ttu-id="47e88-111">Este artigo pressupõe que você já está familiarizado com a criação de um aplicativo de locatário único do Azure AD.</span><span class="sxs-lookup"><span data-stu-id="47e88-111">This article assumes you’re already familiar with building a single tenant application for Azure AD.</span></span>  <span data-ttu-id="47e88-112">Se você não tiver, head backup toohello [home page de guia do desenvolvedor] [ AAD-Dev-Guide] e use um dos nossos inícios rápidos!</span><span class="sxs-lookup"><span data-stu-id="47e88-112">If you’re not, head back up toohello [developer guide homepage][AAD-Dev-Guide] and try one of our quick starts!</span></span>

<span data-ttu-id="47e88-113">Há quatro tooconvert de etapas simples de seu aplicativo em um aplicativo de vários locatários do AD do Azure:</span><span class="sxs-lookup"><span data-stu-id="47e88-113">There are four simple steps tooconvert your application into an Azure AD multi-tenant app:</span></span>

1. <span data-ttu-id="47e88-114">Atualizar seu aplicativo registro toobe multilocatário</span><span class="sxs-lookup"><span data-stu-id="47e88-114">Update your application registration toobe multi-tenant</span></span>
2. <span data-ttu-id="47e88-115">Atualizar o /common do código toosend solicitações toohello ponto de extremidade</span><span class="sxs-lookup"><span data-stu-id="47e88-115">Update your code toosend requests toohello /common endpoint</span></span> 
3. <span data-ttu-id="47e88-116">Atualizar seu código toohandle vários valores de emissor</span><span class="sxs-lookup"><span data-stu-id="47e88-116">Update your code toohandle multiple issuer values</span></span>
4. <span data-ttu-id="47e88-117">Entender o consentimento do usuário e administrador e fazer as alterações de código apropriadas</span><span class="sxs-lookup"><span data-stu-id="47e88-117">Understand user and admin consent and make appropriate code changes</span></span>

<span data-ttu-id="47e88-118">Vamos examinar cada etapa detalhadamente.</span><span class="sxs-lookup"><span data-stu-id="47e88-118">Let’s look at each step in detail.</span></span> <span data-ttu-id="47e88-119">Você também pode ir direto muito[esta lista de exemplos de multilocatários][AAD-Samples-MT].</span><span class="sxs-lookup"><span data-stu-id="47e88-119">You can also jump straight too[this list of multi-tenant samples][AAD-Samples-MT].</span></span>

## <a name="update-registration-toobe-multi-tenant"></a><span data-ttu-id="47e88-120">Atualizar registro toobe vários locatário</span><span class="sxs-lookup"><span data-stu-id="47e88-120">Update registration toobe multi-tenant</span></span>
<span data-ttu-id="47e88-121">Por padrão, os registros de API/aplicativo Web no Azure AD são de locatário único.</span><span class="sxs-lookup"><span data-stu-id="47e88-121">By default, web app/API registrations in Azure AD are single tenant.</span></span>  <span data-ttu-id="47e88-122">Você pode tornar seu registro multilocatário Localizando comutador hello "várias com locatários" na página de propriedades de saudação de seu registro de aplicativo hello [portal do Azure] [ AZURE-portal] e configurá-lo muito "Sim".</span><span class="sxs-lookup"><span data-stu-id="47e88-122">You can make your registration multi-tenant by finding hello “Multi-Tenanted” switch on hello properties page of your application registration in hello [Azure portal][AZURE-portal] and setting it too“Yes”.</span></span>

<span data-ttu-id="47e88-123">Observe também, antes de um aplicativo multilocatário, Azure AD requer Olá URI de ID do aplicativo de saudação aplicativo toobe globalmente exclusivo.</span><span class="sxs-lookup"><span data-stu-id="47e88-123">Also note, before an application can be made multi-tenant, Azure AD requires hello App ID URI of hello application toobe globally unique.</span></span> <span data-ttu-id="47e88-124">Olá URI da ID do aplicativo é uma das maneiras de saudação que um aplicativo é identificado nas mensagens de protocolo.</span><span class="sxs-lookup"><span data-stu-id="47e88-124">hello App ID URI is one of hello ways an application is identified in protocol messages.</span></span>  <span data-ttu-id="47e88-125">Para um aplicativo de locatário único, é suficiente para toobe de URI de ID de aplicativo hello exclusivo dentro desse locatário.</span><span class="sxs-lookup"><span data-stu-id="47e88-125">For a single tenant application, it is sufficient for hello App ID URI toobe unique within that tenant.</span></span>  <span data-ttu-id="47e88-126">Para um aplicativo multilocatário, ele deve ser globalmente exclusivo para que o AD do Azure pode localizar o aplicativo hello em todos os locatários.</span><span class="sxs-lookup"><span data-stu-id="47e88-126">For a multi-tenant application, it must be globally unique so Azure AD can find hello application across all tenants.</span></span>  <span data-ttu-id="47e88-127">A exclusividade global é imposta exigindo Olá URI de ID de aplicativo toohave um nome de host que corresponda a um domínio verificado do locatário do AD do Azure hello.</span><span class="sxs-lookup"><span data-stu-id="47e88-127">Global uniqueness is enforced by requiring hello App ID URI toohave a host name that matches a verified domain of hello Azure AD tenant.</span></span>  <span data-ttu-id="47e88-128">Por exemplo, se o nome de saudação do seu locatário foi contoso.onmicrosoft.com e válido URI da ID do aplicativo seria `https://contoso.onmicrosoft.com/myapp`.</span><span class="sxs-lookup"><span data-stu-id="47e88-128">For example, if hello name of your tenant was contoso.onmicrosoft.com then a valid App ID URI would be `https://contoso.onmicrosoft.com/myapp`.</span></span>  <span data-ttu-id="47e88-129">Se seu locatário tivesse um domínio verificado de `contoso.com`, então um URI da ID do Aplicativo também seria `https://contoso.com/myapp`.</span><span class="sxs-lookup"><span data-stu-id="47e88-129">If your tenant had a verified domain of `contoso.com`, then a valid App ID URI would also be `https://contoso.com/myapp`.</span></span>  <span data-ttu-id="47e88-130">Haverá falha na configuração de um aplicativo como multilocatário se Olá URI da ID do aplicativo não seguir esse padrão.</span><span class="sxs-lookup"><span data-stu-id="47e88-130">Setting an application as multi-tenant will fail if hello App ID URI doesn’t follow this pattern.</span></span>

<span data-ttu-id="47e88-131">Registros de cliente nativos são multilocatários por padrão.</span><span class="sxs-lookup"><span data-stu-id="47e88-131">Native client registrations are multi-tenant by default.</span></span>  <span data-ttu-id="47e88-132">Você não precisa tootake toomake qualquer ação um multi-locatário de de registro do aplicativo cliente nativo.</span><span class="sxs-lookup"><span data-stu-id="47e88-132">You don’t need tootake any action toomake a native client application registration multi-tenant.</span></span>

## <a name="update-your-code-toosend-requests-toocommon"></a><span data-ttu-id="47e88-133">Atualizar seu código toosend solicitações muito comum /</span><span class="sxs-lookup"><span data-stu-id="47e88-133">Update your code toosend requests too/common</span></span>
<span data-ttu-id="47e88-134">Em um aplicativo de locatário único, solicitações de entrada são enviadas entrar no ponto de extremidade do locatário toohello.</span><span class="sxs-lookup"><span data-stu-id="47e88-134">In a single tenant application, sign-in requests are sent toohello tenant’s sign-in endpoint.</span></span> <span data-ttu-id="47e88-135">Por exemplo, para contoso.onmicrosoft.com ponto de extremidade Olá seria:</span><span class="sxs-lookup"><span data-stu-id="47e88-135">For example, for contoso.onmicrosoft.com hello endpoint would be:</span></span>

    https://login.microsoftonline.com/contoso.onmicrosoft.com

<span data-ttu-id="47e88-136">Solicitações enviadas de ponto de extremidade do locatário tooa pode entrar em usuários (ou convidados) que tooapplications de locatário no locatário.</span><span class="sxs-lookup"><span data-stu-id="47e88-136">Requests sent tooa tenant’s endpoint can sign in users (or guests) in that tenant tooapplications in that tenant.</span></span>  <span data-ttu-id="47e88-137">Com um aplicativo multilocatário, o aplicativo hello não sabe com antecedência que o usuário de saudação do locatário é, portanto não é possível enviar solicitações de ponto de extremidade do locatário tooa.</span><span class="sxs-lookup"><span data-stu-id="47e88-137">With a multi-tenant application, hello application doesn’t know up front what tenant hello user is from, so you can’t send requests tooa tenant’s endpoint.</span></span>  <span data-ttu-id="47e88-138">Em vez disso, solicitações são enviadas de ponto de extremidade de tooan multiplexes entre locatários tudo do Azure AD:</span><span class="sxs-lookup"><span data-stu-id="47e88-138">Instead, requests are sent tooan endpoint that multiplexes across all Azure AD tenants:</span></span>

    https://login.microsoftonline.com/common

<span data-ttu-id="47e88-139">Quando o AD do Azure recebe uma solicitação de saudação/ponto de extremidade comum, ele entra usuário hello e como uma consequência descobre qual usuário de saudação do locatário é de.</span><span class="sxs-lookup"><span data-stu-id="47e88-139">When Azure AD receives a request on hello /common endpoint, it signs hello user in and as a consequence discovers which tenant hello user is from.</span></span>  <span data-ttu-id="47e88-140">Olá/ponto de extremidade comum funciona com todos os protocolos de autenticação Olá suportados pelo AD do Azure: OAuth 2.0, OpenID Connect, SAML 2.0 e WS-Federation.</span><span class="sxs-lookup"><span data-stu-id="47e88-140">hello /common endpoint works with all of hello authentication protocols supported by Azure AD:  OpenID Connect, OAuth 2.0, SAML 2.0, and WS-Federation.</span></span>

<span data-ttu-id="47e88-141">Olá resposta de logon toohello aplicativo contém um token que representa o usuário hello.</span><span class="sxs-lookup"><span data-stu-id="47e88-141">hello sign-in response toohello application then contains a token representing hello user.</span></span>  <span data-ttu-id="47e88-142">valor do emissor Olá no token Olá informa um aplicativo que o usuário de saudação do locatário é de.</span><span class="sxs-lookup"><span data-stu-id="47e88-142">hello issuer value in hello token tells an application what tenant hello user is from.</span></span>  <span data-ttu-id="47e88-143">Quando uma resposta retorna do hello/ponto de extremidade comum, valor de emissor Olá no token Olá corresponderá locatário toohello do usuário.</span><span class="sxs-lookup"><span data-stu-id="47e88-143">When a response returns from hello /common endpoint, hello issuer value in hello token will correspond toohello user’s tenant.</span></span>  <span data-ttu-id="47e88-144">É importante toonote Olá/ponto de extremidade comum não é um locatário e não é um emissor, é apenas um multiplexador.</span><span class="sxs-lookup"><span data-stu-id="47e88-144">It’s important toonote hello /common endpoint is not a tenant and is not an issuer, it’s just a multiplexer.</span></span>  <span data-ttu-id="47e88-145">Ao usar /common, lógica de saudação nos tokens de toovalidate seu aplicativo precisa tootake toobe atualizado isso em conta.</span><span class="sxs-lookup"><span data-stu-id="47e88-145">When using /common, hello logic in your application toovalidate tokens needs toobe updated tootake this into account.</span></span> 

<span data-ttu-id="47e88-146">Como aplicativos multilocatários mencionados acima também devem fornecer uma experiência de entrada consistente para os usuários, o seguinte Olá diretrizes da marca de aplicativo do AD do Azure.</span><span class="sxs-lookup"><span data-stu-id="47e88-146">As mentioned earlier, multi-tenant applications should also provide a consistent sign-in experience for users, following hello Azure AD application branding guidelines.</span></span> <span data-ttu-id="47e88-147">Clique em Olá botão toolearn mais sobre a marcação de seu aplicativo a seguir.</span><span class="sxs-lookup"><span data-stu-id="47e88-147">Click hello following button toolearn more about branding your application.</span></span>

<span data-ttu-id="47e88-148">[![Sign in button][AAD-Sign-In]][AAD-App-Branding]</span><span class="sxs-lookup"><span data-stu-id="47e88-148">[![Sign in button][AAD-Sign-In]][AAD-App-Branding]</span></span>

<span data-ttu-id="47e88-149">Vamos dar uma olhada no uso de saudação do hello /common ponto de extremidade e a implementação de código mais detalhadamente.</span><span class="sxs-lookup"><span data-stu-id="47e88-149">Let’s take a look at hello use of hello /common endpoint and your code implementation in more detail.</span></span>

## <a name="update-your-code-toohandle-multiple-issuer-values"></a><span data-ttu-id="47e88-150">Atualizar seu código toohandle vários valores de emissor</span><span class="sxs-lookup"><span data-stu-id="47e88-150">Update your code toohandle multiple issuer values</span></span>
<span data-ttu-id="47e88-151">Os aplicativos Web e as APIs Web recebem e validam os tokens do Azure AD.</span><span class="sxs-lookup"><span data-stu-id="47e88-151">Web applications and web APIs receive and validate tokens from Azure AD.</span></span>  

> [!NOTE]
> <span data-ttu-id="47e88-152">Enquanto os aplicativos cliente nativos solicitar e recebem tokens do AD do Azure, eles fazem toosend caso eles tooAPIs, onde eles são validados.</span><span class="sxs-lookup"><span data-stu-id="47e88-152">While native client applications request and receive tokens from Azure AD, they do so toosend them tooAPIs, where they are validated.</span></span>  <span data-ttu-id="47e88-153">Os aplicativos nativos não validam os tokens e devem tratá-los como opacos.</span><span class="sxs-lookup"><span data-stu-id="47e88-153">Native applications do not validate tokens and must treat them as opaque.</span></span>
> 
> 

<span data-ttu-id="47e88-154">Vamos examinar como um aplicativo valida os tokens que ele recebe do Azure AD.</span><span class="sxs-lookup"><span data-stu-id="47e88-154">Let’s look at how an application validates tokens it receives from Azure AD.</span></span>  <span data-ttu-id="47e88-155">Um aplicativo de locatário único normalmente terá um valor de ponto de extremidade como:</span><span class="sxs-lookup"><span data-stu-id="47e88-155">A single tenant application will normally take an endpoint value like:</span></span>

    https://login.microsoftonline.com/contoso.onmicrosoft.com

<span data-ttu-id="47e88-156">e usá-lo tooconstruct como uma URL de metadados (nesse caso, OpenID Connect):</span><span class="sxs-lookup"><span data-stu-id="47e88-156">and use it tooconstruct a metadata URL (in this case, OpenID Connect) like:</span></span>

    https://login.microsoftonline.com/contoso.onmicrosoft.com/.well-known/openid-configuration

<span data-ttu-id="47e88-157">toodownload duas informações fundamentais que são tokens toovalidate usada: de assinatura de locatário Olá chaves e o valor de emissor.</span><span class="sxs-lookup"><span data-stu-id="47e88-157">toodownload two critical pieces of information that are used toovalidate tokens:  hello tenant’s signing keys and issuer value.</span></span>  <span data-ttu-id="47e88-158">Cada locatário do AD do Azure tem um valor exclusivo do emissor do formulário de saudação:</span><span class="sxs-lookup"><span data-stu-id="47e88-158">Each Azure AD tenant has a unique issuer value of hello form:</span></span>

    https://sts.windows.net/31537af4-6d77-4bb9-a681-d2394888ea26/

<span data-ttu-id="47e88-159">onde o valor GUID de Olá é versão de renomeação segura de saudação da ID de locatário de saudação do locatário hello.</span><span class="sxs-lookup"><span data-stu-id="47e88-159">where hello GUID value is hello rename-safe version of hello tenant ID of hello tenant.</span></span>  <span data-ttu-id="47e88-160">Se você clicar em Olá precede o link de metadados para `contoso.onmicrosoft.com`, você pode ver esse valor de emissor documento hello.</span><span class="sxs-lookup"><span data-stu-id="47e88-160">If you click on hello preceding metadata link for `contoso.onmicrosoft.com`, you can see this issuer value in hello document.</span></span>

<span data-ttu-id="47e88-161">Quando um aplicativo de locatário único valida um token, ele verifica a assinatura de saudação do token Olá contra Olá chaves de documento de metadados de saudação de assinatura.</span><span class="sxs-lookup"><span data-stu-id="47e88-161">When a single tenant application validates a token, it checks hello signature of hello token against hello signing keys from hello metadata document.</span></span> <span data-ttu-id="47e88-162">Isso permite que ele toomake se que o valor de emissor Olá no hello corresponde ao token Olá um que foi encontrado no documento de metadados de saudação.</span><span class="sxs-lookup"><span data-stu-id="47e88-162">This allows it toomake sure hello issuer value in hello token matches hello one that was found in hello metadata document.</span></span>

<span data-ttu-id="47e88-163">Desde Olá/comum o ponto de extremidade não corresponde a tooa locatário e não um emissor, ao examinar o valor de emissor Olá nos metadados de saudação para comum tem uma URL de modelo em vez de um valor real:</span><span class="sxs-lookup"><span data-stu-id="47e88-163">Since hello /common endpoint doesn’t correspond tooa tenant and isn’t an issuer, when you examine hello issuer value in hello metadata for /common it has a templated URL instead of an actual value:</span></span>

    https://sts.windows.net/{tenantid}/

<span data-ttu-id="47e88-164">Portanto, um aplicativo multilocatário não é possível validar tokens apenas por correspondência do valor de emissor Olá nos metadados de saudação com hello `issuer` valor no token de saudação.</span><span class="sxs-lookup"><span data-stu-id="47e88-164">Therefore, a multi-tenant application can’t validate tokens just by matching hello issuer value in hello metadata with hello `issuer` value in hello token.</span></span>  <span data-ttu-id="47e88-165">Um aplicativo multilocatário necessidades lógica toodecide quais valores de emissor são válidas e que são não, com base no locatário Olá parte de identificação do valor de emissor hello.</span><span class="sxs-lookup"><span data-stu-id="47e88-165">A multi-tenant application needs logic toodecide which issuer values are valid and which are not, based on hello tenant ID portion of hello issuer value.</span></span>  

<span data-ttu-id="47e88-166">Por exemplo, se um aplicativo multilocatário só permite entrar de locatários específicos que se inscreveram para seu serviço, em seguida, ele deve verificar valor do emissor hello ou hello `tid` valor de declaração na toomake de token de saudação se esse locatário está em sua lista de assinantes.</span><span class="sxs-lookup"><span data-stu-id="47e88-166">For example, if a multi-tenant application only allows sign-in from specific tenants who have signed up for their service, then it must check either hello issuer value or hello `tid` claim value in hello token toomake sure that tenant is in their list of subscribers.</span></span>  <span data-ttu-id="47e88-167">Se um aplicativo multilocatário apenas lida com indivíduos e não faz qualquer decisões de acesso com base em locatários, ele pode ignorar o valor de emissor Olá completamente.</span><span class="sxs-lookup"><span data-stu-id="47e88-167">If a multi-tenant application only deals with individuals and doesn’t make any access decisions based on tenants, then it can ignore hello issuer value altogether.</span></span>

<span data-ttu-id="47e88-168">Exemplos de multilocatário Olá no hello [conteúdo relacionado](#related-content) seção Olá final deste artigo, a validação do emissor é desabilitado tooenable qualquer toosign de locatário do AD do Azure no.</span><span class="sxs-lookup"><span data-stu-id="47e88-168">In hello multi-tenant samples in hello [Related Content](#related-content) section at hello end of this article, issuer validation is disabled tooenable any Azure AD tenant toosign in.</span></span>

<span data-ttu-id="47e88-169">Agora vamos dar uma olhada na experiência do usuário Olá para usuários que estão se conectando aplicativos toomulti locatários.</span><span class="sxs-lookup"><span data-stu-id="47e88-169">Now let’s look at hello user experience for users that are signing in toomulti-tenant applications.</span></span>

## <a name="understanding-user-and-admin-consent"></a><span data-ttu-id="47e88-170">Entendendo o consentimento do usuário e do administrador</span><span class="sxs-lookup"><span data-stu-id="47e88-170">Understanding user and admin consent</span></span>
<span data-ttu-id="47e88-171">Para toosign um usuário no aplicativo tooan no AD do Azure, o aplicativo hello deve ser representado no locatário saudação do usuário.</span><span class="sxs-lookup"><span data-stu-id="47e88-171">For a user toosign in tooan application in Azure AD, hello application must be represented in hello user’s tenant.</span></span>  <span data-ttu-id="47e88-172">Isso permite a organização Olá toodo coisas como aplicar políticas exclusivas quando os usuários do seu locatário entrar no aplicativo toohello.</span><span class="sxs-lookup"><span data-stu-id="47e88-172">This allows hello organization toodo things like apply unique policies when users from their tenant sign in toohello application.</span></span>  <span data-ttu-id="47e88-173">Para um aplicativo de locatário único, o registro é simple; ele tem Olá que acontece quando você registrar o aplicativo hello no hello [portal do Azure][AZURE-portal].</span><span class="sxs-lookup"><span data-stu-id="47e88-173">For a single tenant application, this registration is simple; it’s hello one that happens when you register hello application in hello [Azure portal][AZURE-portal].</span></span>

<span data-ttu-id="47e88-174">Para um aplicativo multilocatário, registro de saudação inicial para o aplicativo hello reside no locatário do AD do Azure Olá usado pelo desenvolvedor de saudação.</span><span class="sxs-lookup"><span data-stu-id="47e88-174">For a multi-tenant application, hello initial registration for hello application lives in hello Azure AD tenant used by hello developer.</span></span>  <span data-ttu-id="47e88-175">Quando um usuário de um locatário diferente entra no aplicativo toohello para Olá a primeira vez, o AD do Azure-los pergunta tooconsent toohello permissões solicitadas pelo aplicativo hello.</span><span class="sxs-lookup"><span data-stu-id="47e88-175">When a user from a different tenant signs in toohello application for hello first time, Azure AD asks them tooconsent toohello permissions requested by hello application.</span></span>  <span data-ttu-id="47e88-176">Se eles consentimento, chamado de uma representação de um aplicativo hello um *entidade de serviço* é criado no hello locatário do usuário e entrar pode continuar.</span><span class="sxs-lookup"><span data-stu-id="47e88-176">If they consent, then a representation of hello application called a *service principal* is created in hello user’s tenant, and sign-in can continue.</span></span> <span data-ttu-id="47e88-177">Uma delegação também é criada no diretório de saudação que registra o aplicativo de toohello de consentimento do usuário hello.</span><span class="sxs-lookup"><span data-stu-id="47e88-177">A delegation is also created in hello directory that records hello user’s consent toohello application.</span></span> <span data-ttu-id="47e88-178">Consulte [objetos Application e entidade de serviço] [ AAD-App-SP-Objects] para obter detalhes sobre objetos Application e ServicePrincipal do aplicativo hello e como elas se relacionam tooeach outros.</span><span class="sxs-lookup"><span data-stu-id="47e88-178">See [Application Objects and Service Principal Objects][AAD-App-SP-Objects] for details on hello application's Application and ServicePrincipal objects, and how they relate tooeach other.</span></span>

![Aplicativo de camada toosingle de consentimento][Consent-Single-Tier] 

<span data-ttu-id="47e88-180">Essa experiência de consentimento é afetada por permissões de saudação solicitadas pelo aplicativo hello.</span><span class="sxs-lookup"><span data-stu-id="47e88-180">This consent experience is affected by hello permissions requested by hello application.</span></span>  <span data-ttu-id="47e88-181">O Azure AD dá suporte a dois tipos de permissões, somente do aplicativo e delegadas:</span><span class="sxs-lookup"><span data-stu-id="47e88-181">Azure AD supports two kinds of permissions, app-only and delegated:</span></span>

* <span data-ttu-id="47e88-182">Uma permissão delegado concede um tooact de capacidade de saudação do aplicativo como um usuário conectado para um subconjunto de usuário de saudação do hello coisas pode fazer.</span><span class="sxs-lookup"><span data-stu-id="47e88-182">A delegated permission grants an application hello ability tooact as a signed in user for a subset of hello things hello user can do.</span></span>  <span data-ttu-id="47e88-183">Por exemplo, você pode conceder a um aplicativo Olá permissão delegado tooread Olá assinado no calendário do usuário.</span><span class="sxs-lookup"><span data-stu-id="47e88-183">For example, you can grant an application hello delegated permission tooread hello signed in user’s calendar.</span></span>
* <span data-ttu-id="47e88-184">Uma permissão somente de aplicativo é concedida diretamente toohello identidade de aplicativo hello.</span><span class="sxs-lookup"><span data-stu-id="47e88-184">An app-only permission is granted directly toohello identity of hello application.</span></span>  <span data-ttu-id="47e88-185">Por exemplo, você pode conceder a uma lista de saudação do aplicativo hello permissão somente para aplicativo tooread de usuários em um locatário, independentemente de quem está conectada no aplicativo toohello.</span><span class="sxs-lookup"><span data-stu-id="47e88-185">For example, you can grant an application hello app-only permission tooread hello list of users in a tenant, regardless of who is signed in toohello application.</span></span>

<span data-ttu-id="47e88-186">Algumas permissões podem ser consentido tooby um usuário normal, enquanto outros exigem o consentimento do administrador de locatários.</span><span class="sxs-lookup"><span data-stu-id="47e88-186">Some permissions can be consented tooby a regular user, while others require a tenant administrator’s consent.</span></span> 

### <a name="admin-consent"></a><span data-ttu-id="47e88-187">Consentimento do administrador</span><span class="sxs-lookup"><span data-stu-id="47e88-187">Admin consent</span></span>
<span data-ttu-id="47e88-188">As permissões somente do aplicativo sempre exigem o consentimento do administrador de locatários.</span><span class="sxs-lookup"><span data-stu-id="47e88-188">App-only permissions always require a tenant administrator’s consent.</span></span>  <span data-ttu-id="47e88-189">Se seu aplicativo solicita uma permissão somente de aplicativo e um usuário tenta toosign no aplicativo toohello, uma mensagem de erro será exibida informando que o usuário de saudação não for capaz de tooconsent.</span><span class="sxs-lookup"><span data-stu-id="47e88-189">If your application requests an app-only permission and a user tries toosign in toohello application, an error message will be displayed saying hello user isn’t able tooconsent.</span></span>

<span data-ttu-id="47e88-190">Algumas permissões delegadas também exigem o consentimento do administrador de locatários.</span><span class="sxs-lookup"><span data-stu-id="47e88-190">Certain delegated permissions also require a tenant administrator’s consent.</span></span>  <span data-ttu-id="47e88-191">Por exemplo, Olá capacidade toowrite back tooAzure AD como Olá usuário conectado requer o consentimento do administrador de locatários.</span><span class="sxs-lookup"><span data-stu-id="47e88-191">For example, hello ability toowrite back tooAzure AD as hello signed in user requires a tenant administrator’s consent.</span></span>  <span data-ttu-id="47e88-192">Como as permissões somente de aplicativo, se um usuário comum tentar toosign no aplicativo tooan que solicita uma permissão delegada que requer o consentimento do administrador, o aplicativo receberá um erro.</span><span class="sxs-lookup"><span data-stu-id="47e88-192">Like app-only permissions, if an ordinary user tries toosign in tooan application that requests a delegated permission that requires administrator consent, your application will receive an error.</span></span>  <span data-ttu-id="47e88-193">Se ou não requer uma permissão de consentimento do administrador é determinado pelo desenvolvedor de saudação que publicou o recurso Olá e pode ser encontrados na documentação de saudação do recurso de saudação.</span><span class="sxs-lookup"><span data-stu-id="47e88-193">Whether or not a permission requires admin consent is determined by hello developer that published hello resource, and can be found in hello documentation for hello resource.</span></span>  <span data-ttu-id="47e88-194">Links tootopics que descreve as permissões disponíveis Olá hello Azure AD Graph API e do Microsoft Graph API são em Olá [relacionados conteúdo](#related-content) deste artigo.</span><span class="sxs-lookup"><span data-stu-id="47e88-194">Links tootopics describing hello available permissions for hello Azure AD Graph API and Microsoft Graph API are in hello [Related Content](#related-content) section of this article.</span></span>

<span data-ttu-id="47e88-195">Se seu aplicativo usa permissões que exigem o consentimento do administrador, você precisa toohave um gesto como um botão ou link onde Olá administrador pode iniciar a ação de saudação.</span><span class="sxs-lookup"><span data-stu-id="47e88-195">If your application uses permissions that require admin consent, you need toohave a gesture such as a button or link where hello admin can initiate hello action.</span></span>  <span data-ttu-id="47e88-196">solicitação Olá seu aplicativo envia para esta ação é uma solicitação de autorização OAuth2/OpenID Connect normal, mas que também inclui Olá `prompt=admin_consent` parâmetro de cadeia de caracteres de consulta.</span><span class="sxs-lookup"><span data-stu-id="47e88-196">hello request your application sends for this action is a usual OAuth2/OpenID Connect authorization request, but that also includes hello `prompt=admin_consent` query string parameter.</span></span>  <span data-ttu-id="47e88-197">Uma vez Olá administrador consentiu e entidade de serviço Olá é criada no locatário saudação do cliente, as solicitações de logon subsequentes não necessário Olá `prompt=admin_consent` parâmetro.</span><span class="sxs-lookup"><span data-stu-id="47e88-197">Once hello admin has consented and hello service principal is created in hello customer’s tenant, subsequent sign-in requests do not need hello `prompt=admin_consent` parameter.</span></span> <span data-ttu-id="47e88-198">Como administrador de saudação decidiu Olá solicitadas permissões são aceitáveis, nenhum outro usuário no locatário Olá deverá consentimento desse ponto em diante.</span><span class="sxs-lookup"><span data-stu-id="47e88-198">Since hello administrator has decided hello requested permissions are acceptable, no other users in hello tenant will be prompted for consent from that point forward.</span></span>

<span data-ttu-id="47e88-199">Olá `prompt=admin_consent` parâmetro também pode ser usado por aplicativos que exigem permissões que não exigem o consentimento do administrador.</span><span class="sxs-lookup"><span data-stu-id="47e88-199">hello `prompt=admin_consent` parameter can also be used by applications that request permissions that do not require admin consent.</span></span> <span data-ttu-id="47e88-200">Isso é feito quando um aplicativo hello requer uma experiência em administração de locatário hello "se inscreve" um tempo e não a outros usuários são solicitados a dar consentimento desse ponto em.</span><span class="sxs-lookup"><span data-stu-id="47e88-200">This is done when hello applicaton requires an experience where hello tenant admin “signs up” one time, and no other users are prompted for consent from that point on.</span></span>

<span data-ttu-id="47e88-201">Se um aplicativo requer o consentimento do administrador, e um administrador faz logon no, mas hello `prompt=admin_consent` parâmetro não for enviado, Olá administrador será consentimento com êxito aplicativo toohello **somente para sua conta de usuário**.</span><span class="sxs-lookup"><span data-stu-id="47e88-201">If an application requires admin consent, and an admin signs in but hello `prompt=admin_consent` parameter is not sent, hello admin will successfully consent toohello application **only for their user account**.</span></span>  <span data-ttu-id="47e88-202">Usuários regulares ainda não será capaz de toosign no e consentimento toohello aplicativo.</span><span class="sxs-lookup"><span data-stu-id="47e88-202">Regular users will still not be able toosign in and consent toohello application.</span></span>  <span data-ttu-id="47e88-203">Isso é útil se você quiser toogive Olá locatário administrador Olá capacidade tooexplore seu aplicativo antes de permitir acesso a outros usuários.</span><span class="sxs-lookup"><span data-stu-id="47e88-203">This is useful if you want toogive hello tenant administrator hello ability tooexplore your application before allowing other users access.</span></span>

<span data-ttu-id="47e88-204">Um administrador de locatários pode desabilitar a capacidade de saudação para usuários regulares tooconsent tooapplications.</span><span class="sxs-lookup"><span data-stu-id="47e88-204">A tenant administrator can disable hello ability for regular users tooconsent tooapplications.</span></span>  <span data-ttu-id="47e88-205">Se esse recurso estiver desabilitado, consentimento do administrador é sempre necessário para Olá aplicativo toobe configurado no locatário hello.</span><span class="sxs-lookup"><span data-stu-id="47e88-205">If this capability is disabled, admin consent is always required for hello application toobe set up in hello tenant.</span></span>  <span data-ttu-id="47e88-206">Se você quiser tootest seu aplicativo com consentimento do usuário regular desabilitado, você pode encontrar opção de configuração de saudação no locatário de saudação do AD do Azure a seção de configuração de saudação [portal do Azure][AZURE-portal].</span><span class="sxs-lookup"><span data-stu-id="47e88-206">If you want tootest your application with regular user consent disabled, you can find hello configuration switch in hello Azure AD tenant configuration section of hello [Azure portal][AZURE-portal].</span></span>

> [!NOTE]
> <span data-ttu-id="47e88-207">Alguns aplicativos querem uma experiência de onde os usuários regulares estão tooconsent capaz inicialmente e aplicativo de hello posterior pode envolver administrador hello e solicitar permissões que exigem o consentimento do administrador.</span><span class="sxs-lookup"><span data-stu-id="47e88-207">Some applications want an experience where regular users are able tooconsent initially, and later hello application can involve hello administrator and request permissions that require admin consent.</span></span>  <span data-ttu-id="47e88-208">Não há nenhuma maneira toodo isso com o registro de um único aplicativo no AD do Azure hoje.</span><span class="sxs-lookup"><span data-stu-id="47e88-208">There is no way toodo this with a single application registration in Azure AD today.</span></span>  <span data-ttu-id="47e88-209">ponto de extremidade de v2 Olá futuros do AD do Azure permitirá que aplicativos toorequest permissões em tempo de execução, em vez de em tempo de registro, que permitirão a esse cenário.</span><span class="sxs-lookup"><span data-stu-id="47e88-209">hello upcoming Azure AD v2 endpoint will allow applications toorequest permissions at runtime, instead of at registration time, which will enable this scenario.</span></span>  <span data-ttu-id="47e88-210">Para obter mais informações, consulte Olá [guia do desenvolvedor do modelo de aplicativo do AD do Azure v2][AAD-V2-Dev-Guide].</span><span class="sxs-lookup"><span data-stu-id="47e88-210">For more information, see hello [Azure AD App Model v2 Developer Guide][AAD-V2-Dev-Guide].</span></span>
> 
> 

### <a name="consent-and-multi-tier-applications"></a><span data-ttu-id="47e88-211">Aplicativos de várias camadas e consentimento</span><span class="sxs-lookup"><span data-stu-id="47e88-211">Consent and multi-tier applications</span></span>
<span data-ttu-id="47e88-212">Seu aplicativo pode ter várias camadas, cada uma representada por seu próprio registro no Azure AD.</span><span class="sxs-lookup"><span data-stu-id="47e88-212">Your application may have multiple tiers, each represented by its own registration in Azure AD.</span></span>  <span data-ttu-id="47e88-213">Por exemplo, um aplicativo nativo que chama uma API Web ou um aplicativo Web que chama uma API Web.</span><span class="sxs-lookup"><span data-stu-id="47e88-213">For example, a native application that calls a web API, or a web application that calls a web API.</span></span>  <span data-ttu-id="47e88-214">Em ambos os casos, o cliente de hello (aplicativo nativo ou aplicativo web) solicita recursos de saudação permissões toocall (API da web).</span><span class="sxs-lookup"><span data-stu-id="47e88-214">In both of these cases, hello client (native app or web app) requests permissions toocall hello resource (web API).</span></span>  <span data-ttu-id="47e88-215">Para Olá cliente toobe consentido com êxito no locatário do cliente, todos os toowhich de recursos, ele solicita permissões já deve existir no locatário saudação do cliente.</span><span class="sxs-lookup"><span data-stu-id="47e88-215">For hello client toobe successfully consented into a customer’s tenant, all resources toowhich it requests permissions must already exist in hello customer’s tenant.</span></span>  <span data-ttu-id="47e88-216">Se essa condição não for atendida, AD do Azure retornará um erro que Olá recurso deve ser adicionado pela primeira vez.</span><span class="sxs-lookup"><span data-stu-id="47e88-216">If this condition isn’t met, Azure AD will return an error that hello resource must be added first.</span></span>

<span data-ttu-id="47e88-217">**Várias camadas em um único locatário**</span><span class="sxs-lookup"><span data-stu-id="47e88-217">**Multiple tiers in a single tenant**</span></span>

<span data-ttu-id="47e88-218">Isso poderá ser um problema se seu aplicativo lógico consistir em dois ou mais registros de aplicativo, por exemplo, um cliente e um recurso separados.</span><span class="sxs-lookup"><span data-stu-id="47e88-218">This can be a problem if your logical application consists of two or more application registrations, for example a separate client and resource.</span></span>  <span data-ttu-id="47e88-219">Como obter recursos de saudação em locatário do cliente Olá primeiro?</span><span class="sxs-lookup"><span data-stu-id="47e88-219">How do you get hello resource into hello customer tenant first?</span></span>  <span data-ttu-id="47e88-220">AD do Azure abrange nesse caso, permitindo que o cliente e recurso toobe consentido em uma única etapa.</span><span class="sxs-lookup"><span data-stu-id="47e88-220">Azure AD covers this case by enabling client and resource toobe consented in a single step.</span></span> <span data-ttu-id="47e88-221">usuário Olá vê Olá soma total de permissões Olá solicitada pelo cliente hello e recursos na página de consentimento hello.</span><span class="sxs-lookup"><span data-stu-id="47e88-221">hello user sees hello sum total of hello permissions requested by both hello client and resource on hello consent page.</span></span>  <span data-ttu-id="47e88-222">tooenable esse comportamento, registro de aplicativo do recurso Olá deve incluir a ID do aplicativo do cliente hello como um `knownClientApplications` em seu manifesto de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="47e88-222">tooenable this behavior, hello resource’s application registration must include hello client’s App ID as a `knownClientApplications` in its application manifest.</span></span>  <span data-ttu-id="47e88-223">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="47e88-223">For example:</span></span>

    knownClientApplications": ["94da0930-763f-45c7-8d26-04d5938baab2"]

<span data-ttu-id="47e88-224">Essa propriedade pode ser atualizada por meio do recurso de saudação [manifesto do aplicativo][AAD-App-Manifest].</span><span class="sxs-lookup"><span data-stu-id="47e88-224">This property can be updated via hello resource [application’s manifest][AAD-App-Manifest].</span></span> <span data-ttu-id="47e88-225">Isso é demonstrado nos clientes nativos multicamados chamando a API da web de exemplo em Olá [relacionados conteúdo](#related-content) seção Olá final deste artigo.</span><span class="sxs-lookup"><span data-stu-id="47e88-225">This is demonstrated in a multi-tier native client calling web API sample in hello [Related Content](#related-content) section at hello end of this article.</span></span> <span data-ttu-id="47e88-226">Olá diagrama a seguir fornece uma visão geral de consentimento para um aplicativo de várias camado registrado em um único locatário:</span><span class="sxs-lookup"><span data-stu-id="47e88-226">hello following diagram provides an overview of consent for a multi-tier app registered in a single tenant :</span></span>

![Aplicativo de cliente conhecidos toomulti da camada de consentimento][Consent-Multi-Tier-Known-Client] 

<span data-ttu-id="47e88-228">**Várias camadas em vários locatários**</span><span class="sxs-lookup"><span data-stu-id="47e88-228">**Multiple tiers in multiple tenants**</span></span>

<span data-ttu-id="47e88-229">Um caso semelhante acontece se níveis diferentes de saudação de um aplicativo são registrados em diferentes locatários.</span><span class="sxs-lookup"><span data-stu-id="47e88-229">A similar case happens if hello different tiers of an application are registered in different tenants.</span></span>  <span data-ttu-id="47e88-230">Por exemplo, considere o caso de saudação da criação de um aplicativo cliente nativo que chama Olá API do Office 365 Exchange Online.</span><span class="sxs-lookup"><span data-stu-id="47e88-230">For example, consider hello case of building a native client application that calls hello Office 365 Exchange Online API.</span></span>  <span data-ttu-id="47e88-231">toodevelop Olá nativo aplicativo e posterior para Olá aplicativo nativo toorun no locatário do cliente, o principal do serviço Exchange Online Olá deve estar presente.</span><span class="sxs-lookup"><span data-stu-id="47e88-231">toodevelop hello native application, and later for hello native application toorun in a customer’s tenant, hello Exchange Online service principal must be present.</span></span>  <span data-ttu-id="47e88-232">Nesse caso, hello desenvolvedor e o cliente devem adquirir o Exchange Online para toobe principal do serviço Olá criado em seus locatários.</span><span class="sxs-lookup"><span data-stu-id="47e88-232">In this case, hello developer and customer must purchase Exchange Online for hello service principal toobe created in their tenants.</span></span>  

<span data-ttu-id="47e88-233">No caso de saudação de uma API criado por uma organização diferente da Microsoft, o desenvolvedor de saudação do hello API precisa tooprovide uma maneira para seu aplicativo de saudação tooconsent clientes em locatários de seus clientes.</span><span class="sxs-lookup"><span data-stu-id="47e88-233">In hello case of an API built by an organization other than Microsoft, hello developer of hello API needs tooprovide a way for their customers tooconsent hello application into their customers' tenants.</span></span> <span data-ttu-id="47e88-234">Olá recomendado é de design para Olá 3ª parte desenvolvedor toobuild Olá API, de modo que ele também pode funcionar como um tooimplement de cliente web inscrição:</span><span class="sxs-lookup"><span data-stu-id="47e88-234">hello recommended design is for hello 3rd party developer toobuild hello API such that it can also function as a web client tooimplement sign-up :</span></span>

1. <span data-ttu-id="47e88-235">Siga Olá Olá de tooensure seções anterior API implementa os requisitos de registro/código de aplicativo multilocatário Olá</span><span class="sxs-lookup"><span data-stu-id="47e88-235">Follow hello earlier sections tooensure hello API implements hello multi-tenant application registration/code requirements</span></span>
2. <span data-ttu-id="47e88-236">Além de funções/escopos tooexposing Olá da API, certifique-se de registro de saudação inclui hello "entrar e ler o perfil de usuário" permissão de AD do Azure (fornecido por padrão)</span><span class="sxs-lookup"><span data-stu-id="47e88-236">In addition tooexposing hello API's scopes/roles, ensure hello registration includes hello "Sign in and read user profile" Azure AD permission (provided by default)</span></span>
3. <span data-ttu-id="47e88-237">Implementar uma página de entrada-em/entrada o no cliente de web hello, seguir Olá [consentimento do administrador](#admin-consent) orientação discutido anteriormente</span><span class="sxs-lookup"><span data-stu-id="47e88-237">Implement a sign-in/sign-up page in hello web client, following hello [admin consent](#admin-consent) guidance discussed earlier</span></span> 
4. <span data-ttu-id="47e88-238">Depois que o aplicativo toohello de consentimento do usuário de hello, hello links de delegação de principal e o consentimento de serviço são criados em seu locatário e aplicativo nativo hello pode obter tokens para Olá API</span><span class="sxs-lookup"><span data-stu-id="47e88-238">Once hello user consents toohello application, hello service principal and consent delegation links are created in their tenant, and hello native application can get tokens for hello API</span></span>

<span data-ttu-id="47e88-239">Olá diagrama a seguir fornece uma visão geral de consentimento para um aplicativo de várias camado registrado no locatários diferentes:</span><span class="sxs-lookup"><span data-stu-id="47e88-239">hello following diagram provides an overview of consent for a multi-tier app registered in different tenants:</span></span>

![Consentimento de aplicativo de várias partes da camada toomulti][Consent-Multi-Tier-Multi-Party] 

### <a name="revoking-consent"></a><span data-ttu-id="47e88-241">Revogando o consentimento</span><span class="sxs-lookup"><span data-stu-id="47e88-241">Revoking Consent</span></span>
<span data-ttu-id="47e88-242">Os usuários e administradores podem revogar consentimento tooyour aplicativo a qualquer momento:</span><span class="sxs-lookup"><span data-stu-id="47e88-242">Users and administrators can revoke consent tooyour application at any time:</span></span>

* <span data-ttu-id="47e88-243">Os usuários revogar acesso tooindividual aplicativos por removê-los do seu [aplicativos de painel de acesso] [ AAD-Access-Panel] lista.</span><span class="sxs-lookup"><span data-stu-id="47e88-243">Users revoke access tooindividual applications by removing them from their [Access Panel Applications][AAD-Access-Panel] list.</span></span>
* <span data-ttu-id="47e88-244">Os administradores revogar acesso tooapplications removê-los do AD do Azure usando a seção de gerenciamento de saudação do AD do Azure de saudação [portal do Azure][AZURE-portal].</span><span class="sxs-lookup"><span data-stu-id="47e88-244">Administrators revoke access tooapplications by removing them from Azure AD using hello Azure AD management section of hello [Azure portal][AZURE-portal].</span></span>

<span data-ttu-id="47e88-245">Se um administrador consentir aplicativos tooan para todos os usuários em um locatário, os usuários não é possível revogar o acesso individualmente.</span><span class="sxs-lookup"><span data-stu-id="47e88-245">If an administrator consents tooan application for all users in a tenant, users cannot revoke access individually.</span></span>  <span data-ttu-id="47e88-246">Somente administrador Olá pode revogar o acesso e apenas para Olá aplicativo inteiro.</span><span class="sxs-lookup"><span data-stu-id="47e88-246">Only hello administrator can revoke access, and only for hello whole application.</span></span>

### <a name="consent-and-protocol-support"></a><span data-ttu-id="47e88-247">Suporte a protocolo e consentimento</span><span class="sxs-lookup"><span data-stu-id="47e88-247">Consent and Protocol Support</span></span>
<span data-ttu-id="47e88-248">Há suporte para o consentimento no AD do Azure por meio de saudação OAuth, OpenID Connect, WS-Federation e SAML protocolos.</span><span class="sxs-lookup"><span data-stu-id="47e88-248">Consent is supported in Azure AD via hello OAuth, OpenID Connect, WS-Federation, and SAML protocols.</span></span>  <span data-ttu-id="47e88-249">Olá protocolos SAML e WS-Federation não oferecem suporte a saudação `prompt=admin_consent` parâmetro, portanto, só é possível por meio de OpenID Connect e OAuth consentimento do administrador.</span><span class="sxs-lookup"><span data-stu-id="47e88-249">hello SAML and WS-Federation protocols do not support hello `prompt=admin_consent` parameter, so admin consent is only possible via OAuth and OpenID Connect.</span></span>

## <a name="multi-tenant-applications-and-caching-access-tokens"></a><span data-ttu-id="47e88-250">Aplicativos multilocatários e caching de tokens de acesso</span><span class="sxs-lookup"><span data-stu-id="47e88-250">Multi-Tenant Applications and Caching Access Tokens</span></span>
<span data-ttu-id="47e88-251">Aplicativos de multilocação também podem obter tokens de acesso toocall APIs que são protegidos pelo AD do Azure.</span><span class="sxs-lookup"><span data-stu-id="47e88-251">Multi-tenant applications can also get access tokens toocall APIs that are protected by Azure AD.</span></span>  <span data-ttu-id="47e88-252">Um erro comum ao usar o hello biblioteca de autenticação do Active Directory (ADAL) com um aplicativo multilocatário, é tooinitially solicitação um token para um usuário usando /common, recebeu uma resposta e solicitar um token subsequente para o mesmo usuário também usando /common.</span><span class="sxs-lookup"><span data-stu-id="47e88-252">A common error when using hello Active Directory Authentication Library (ADAL) with a multi-tenant application, is tooinitially request a token for a user using /common, receive a response, then request a subsequent token for that same user also using /common.</span></span>  <span data-ttu-id="47e88-253">Desde que a resposta de saudação do AD do Azure vêm de um locatário não/comum, ADAL armazena em cache o token hello como sendo de locatário de saudação.</span><span class="sxs-lookup"><span data-stu-id="47e88-253">Since hello response from Azure AD comes from a tenant, not /common, ADAL caches hello token as being from hello tenant.</span></span> <span data-ttu-id="47e88-254">Olá subsequente chamar tooget muito comum/um token de acesso para entrada de cache de saudação do hello usuário erros e usuário Olá é toosign solicitada em novamente.</span><span class="sxs-lookup"><span data-stu-id="47e88-254">hello subsequent call too/common tooget an access token for hello user misses hello cache entry, and hello user is prompted toosign in again.</span></span>  <span data-ttu-id="47e88-255">tooavoid cache de saudação ausentes, fazer subsequentes se chamadas para um usuário já conectado são feitas ponto de extremidade do locatário toohello.</span><span class="sxs-lookup"><span data-stu-id="47e88-255">tooavoid missing hello cache, make sure subsequent calls for an already signed in user are made toohello tenant’s endpoint.</span></span>

## <a name="next-steps"></a><span data-ttu-id="47e88-256">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="47e88-256">Next steps</span></span>
<span data-ttu-id="47e88-257">Neste artigo, você aprendeu como toobuild um aplicativo que pode entrar em um usuário de qualquer locatário do Active Directory do Azure.</span><span class="sxs-lookup"><span data-stu-id="47e88-257">In this article, you learned how toobuild an application that can sign in a user from any Azure Active Directory tenant.</span></span> <span data-ttu-id="47e88-258">Depois de habilitar o logon único entre o aplicativo e o Active Directory do Azure, você também pode atualizar seu aplicativo tooaccess APIs expostas pelos recursos da Microsoft, como o Office 365.</span><span class="sxs-lookup"><span data-stu-id="47e88-258">After enabling Single Sign-On between your app and Azure Active Directory, you can also update your application tooaccess APIs exposed by Microsoft resources, like Office 365.</span></span> <span data-ttu-id="47e88-259">Então você pode oferecer uma experiência personalizada em seu aplicativo, por exemplo mostrando informações contextuais toohello usuários, como a imagem do seu perfil ou seu próximo compromisso no calendário.</span><span class="sxs-lookup"><span data-stu-id="47e88-259">So you can offer a personalized experience in your application, for example showing contextual information toohello users, like their profile picture or their next calendar appointment.</span></span> <span data-ttu-id="47e88-260">toolearn mais sobre como tornar API chama tooAzure do Active Directory e serviços do Office 365 como o Exchange, SharePoint, OneDrive, OneNote, Planner, Excel e muito mais, visite: [Microsoft Graph API][MSFT-Graph-overview].</span><span class="sxs-lookup"><span data-stu-id="47e88-260">toolearn more about making API calls tooAzure Active Directory and Office 365 services like Exchange, SharePoint, OneDrive, OneNote, Planner, Excel and more, visit: [Microsoft Graph API][MSFT-Graph-overview].</span></span>


## <a name="related-content"></a><span data-ttu-id="47e88-261">Conteúdo relacionado</span><span class="sxs-lookup"><span data-stu-id="47e88-261">Related content</span></span>
* <span data-ttu-id="47e88-262">[Exemplos de aplicativos multilocatários][AAD-Samples-MT]</span><span class="sxs-lookup"><span data-stu-id="47e88-262">[Multi-tenant application samples][AAD-Samples-MT]</span></span>
* <span data-ttu-id="47e88-263">[Diretrizes de identidade visual para aplicativos][AAD-App-Branding]</span><span class="sxs-lookup"><span data-stu-id="47e88-263">[Branding Guidelines for Applications][AAD-App-Branding]</span></span>
* <span data-ttu-id="47e88-264">[Guia do Desenvolvedor do Azure AD][AAD-Dev-Guide]</span><span class="sxs-lookup"><span data-stu-id="47e88-264">[Azure AD Developer's Guide][AAD-Dev-Guide]</span></span>
* <span data-ttu-id="47e88-265">[Objetos de Aplicativo e de Entidade de Serviço][AAD-App-SP-Objects]</span><span class="sxs-lookup"><span data-stu-id="47e88-265">[Application Objects and Service Principal Objects][AAD-App-SP-Objects]</span></span>
* <span data-ttu-id="47e88-266">[Integrando aplicativos com o Azure Active Directory][AAD-Integrating-Apps]</span><span class="sxs-lookup"><span data-stu-id="47e88-266">[Integrating Applications with Azure Active Directory][AAD-Integrating-Apps]</span></span>
* <span data-ttu-id="47e88-267">[Visão geral da estrutura de consentimento de saudação][AAD-Consent-Overview]</span><span class="sxs-lookup"><span data-stu-id="47e88-267">[Overview of hello Consent Framework][AAD-Consent-Overview]</span></span>
* <span data-ttu-id="47e88-268">[Escopos de permissão da API do Microsoft Graph][MSFT-Graph-permision-scopes]</span><span class="sxs-lookup"><span data-stu-id="47e88-268">[Microsoft Graph API Permission Scopes][MSFT-Graph-permision-scopes]</span></span>
* <span data-ttu-id="47e88-269">[Escopos de permissão da API do Graph do Azure AD][AAD-Graph-Perm-Scopes]</span><span class="sxs-lookup"><span data-stu-id="47e88-269">[Azure AD Graph API Permission Scopes][AAD-Graph-Perm-Scopes]</span></span>

<span data-ttu-id="47e88-270">Use Olá comentários de tooprovide seção comentários a seguir e ajudar a refinar e formatar o nosso conteúdo.</span><span class="sxs-lookup"><span data-stu-id="47e88-270">Please use hello following comments section tooprovide feedback and help us refine and shape our content.</span></span>

<!--Reference style links IN USE -->
[AAD-Access-Panel]:  https://myapps.microsoft.com
[AAD-App-Branding]: ./active-directory-branding-guidelines.md
[AAD-App-Manifest]: ./active-directory-application-manifest.md
[AAD-App-SP-Objects]: ./active-directory-application-objects.md
[AAD-Auth-Scenarios]: ./active-directory-authentication-scenarios.md
[AAD-Consent-Overview]: ./active-directory-integrating-applications.md#overview-of-the-consent-framework
[AAD-Dev-Guide]: ./active-directory-developers-guide.md
[AAD-Graph-Overview]: https://azure.microsoft.com/en-us/documentation/articles/active-directory-graph-api/
[AAD-Graph-Perm-Scopes]: https://msdn.microsoft.com/library/azure/ad/graph/howto/azure-ad-graph-api-permission-scopes
[AAD-Integrating-Apps]: ./active-directory-integrating-applications.md
[AAD-Samples-MT]: https://azure.microsoft.com/documentation/samples/?service=active-directory&term=multitenant
[AAD-Why-To-Integrate]: ./active-directory-how-to-integrate.md
[AZURE-portal]: https://portal.azure.com
[MSFT-Graph-overview]: https://graph.microsoft.io/en-us/docs/overview/overview
[MSFT-Graph-permision-scopes]: https://graph.microsoft.io/en-us/docs/authorization/permission_scopes

<!--Image references-->
[AAD-Sign-In]: ./media/active-directory-devhowto-multi-tenant-overview/sign-in-with-microsoft-light.png
[Consent-Single-Tier]: ./media/active-directory-devhowto-multi-tenant-overview/consent-flow-single-tier.png
[Consent-Multi-Tier-Known-Client]: ./media/active-directory-devhowto-multi-tenant-overview/consent-flow-multi-tier-known-clients.png
[Consent-Multi-Tier-Multi-Party]: ./media/active-directory-devhowto-multi-tenant-overview/consent-flow-multi-tier-multi-party.png

<!--Reference style links -->
[AAD-App-Manifest]: ./active-directory-application-manifest.md
[AAD-App-SP-Objects]: ./active-directory-application-objects.md
[AAD-Auth-Scenarios]: ./active-directory-authentication-scenarios.md
[AAD-Integrating-Apps]: ./active-directory-integrating-applications.md
[AAD-Dev-Guide]: ./active-directory-developers-guide.md
[AAD-Graph-Perm-Scopes]: https://msdn.microsoft.com/library/azure/ad/graph/howto/azure-ad-graph-api-permission-scopes
[AAD-Graph-App-Entity]: https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#application-entity
[AAD-Graph-Sp-Entity]: https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#serviceprincipal-entity
[AAD-Graph-User-Entity]: https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#user-entity
[AAD-How-To-Integrate]: ./active-directory-how-to-integrate.md
[AAD-Security-Token-Claims]: ./active-directory-authentication-scenarios/#claims-in-azure-ad-security-tokens
[AAD-Tokens-Claims]: ./active-directory-token-and-claims.md
[AAD-V2-Dev-Guide]: ../active-directory-appmodel-v2-overview.md
[AZURE-portal]: https://portal.azure.com
[Duyshant-Role-Blog]: http://www.dushyantgill.com/blog/2014/12/10/roles-based-access-control-in-cloud-applications-using-azure-ad/
[JWT]: https://tools.ietf.org/html/draft-ietf-oauth-json-web-token-32
[O365-Perm-Ref]: https://msdn.microsoft.com/en-us/office/office365/howto/application-manifest
[OAuth2-Access-Token-Scopes]: https://tools.ietf.org/html/rfc6749#section-3.3
[OAuth2-AuthZ-Code-Grant-Flow]: https://msdn.microsoft.com/library/azure/dn645542.aspx
[OAuth2-AuthZ-Grant-Types]: https://tools.ietf.org/html/rfc6749#section-1.3 
[OAuth2-Client-Types]: https://tools.ietf.org/html/rfc6749#section-2.1
[OAuth2-Role-Def]: https://tools.ietf.org/html/rfc6749#page-6
[OpenIDConnect]: http://openid.net/specs/openid-connect-core-1_0.html
[OpenIDConnect-ID-Token]: http://openid.net/specs/openid-connect-core-1_0.html#IDToken














