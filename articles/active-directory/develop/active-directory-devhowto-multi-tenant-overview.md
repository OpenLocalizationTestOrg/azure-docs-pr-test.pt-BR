---
title: "Como criar um aplicativo que pode conectar qualquer usuário do Azure AD | Microsoft Docs"
description: "Instruções passo a passo para a criação de um aplicativo que pode conectar um usuário de qualquer locatário do Azure Active Directory, também conhecido como aplicativo multilocatário."
services: active-directory
documentationcenter: 
author: dstrockis
manager: mbaldwin
editor: 
ms.assetid: 35af95cb-ced3-46ad-b01d-5d2f6fd064a3
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 04/26/2017
ms.author: dastrock
ms.custom: aaddev
ms.openlocfilehash: f1c79fa7e3b0e160487b5941741f6a6c677c6b81
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="how-to-sign-in-any-azure-active-directory-ad-user-using-the-multi-tenant-application-pattern"></a><span data-ttu-id="88808-103">Como entrar em qualquer usuário do Azure AD (Active Directory) usando o padrão de aplicativo multilocatário</span><span class="sxs-lookup"><span data-stu-id="88808-103">How to sign in any Azure Active Directory (AD) user using the multi-tenant application pattern</span></span>
<span data-ttu-id="88808-104">Se você oferecer um aplicativo Software como Serviço para muitas organizações, poderá configurar seu aplicativo para aceitar entradas de qualquer locatário do Azure AD.</span><span class="sxs-lookup"><span data-stu-id="88808-104">If you offer a Software as a Service application to many organizations, you can configure your application to accept sign-ins from any Azure AD tenant.</span></span>  <span data-ttu-id="88808-105">No Azure AD, isso é chamado de tornar seu aplicativo multilocatário.</span><span class="sxs-lookup"><span data-stu-id="88808-105">In Azure AD this is called making your application multi-tenant.</span></span>  <span data-ttu-id="88808-106">Os usuários em qualquer locatário do Azure AD poderão entrar em seu aplicativo após o consentimento para usar sua conta com o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="88808-106">Users in any Azure AD tenant will be able to sign in to your application after consenting to use their account with your application.</span></span>  

<span data-ttu-id="88808-107">Se você tiver um aplicativo que tem seu próprio sistema de contas ou que dá suporte a outros tipos de conexão por meio de outros provedores de nuvem, a adição da conexão do Azure AD em qualquer locatário será simples.</span><span class="sxs-lookup"><span data-stu-id="88808-107">If you have an existing application that has its own account system, or supports other kinds of sign-in from other cloud providers, adding Azure AD sign-in from any tenant is simple.</span></span> <span data-ttu-id="88808-108">Basta registrar o aplicativo, adicionar o código de conexão pelo OAuth2, OpenID Connect ou SAML e colocar um botão “Entrar com a Microsoft” em seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="88808-108">Just register your app, add sign-in code via OAuth2, OpenID Connect, or SAML, and put a "Sign In with Microsoft" button on your application.</span></span> <span data-ttu-id="88808-109">Clique no botão a seguir para saber mais sobre a identidade visual de seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="88808-109">Click the following button to learn more about branding your application.</span></span>

<span data-ttu-id="88808-110">[![Sign in button][AAD-Sign-In]][AAD-App-Branding]</span><span class="sxs-lookup"><span data-stu-id="88808-110">[![Sign in button][AAD-Sign-In]][AAD-App-Branding]</span></span>

<span data-ttu-id="88808-111">Este artigo pressupõe que você já está familiarizado com a criação de um aplicativo de locatário único do Azure AD.</span><span class="sxs-lookup"><span data-stu-id="88808-111">This article assumes you’re already familiar with building a single tenant application for Azure AD.</span></span>  <span data-ttu-id="88808-112">Se não estiver, retorne à [home page do guia do desenvolvedor][AAD-Dev-Guide] e experimente um de nossos inícios rápidos!</span><span class="sxs-lookup"><span data-stu-id="88808-112">If you’re not, head back up to the [developer guide homepage][AAD-Dev-Guide] and try one of our quick starts!</span></span>

<span data-ttu-id="88808-113">Há quatro etapas simples para converter seu aplicativo em um aplicativo multilocatário do Azure AD:</span><span class="sxs-lookup"><span data-stu-id="88808-113">There are four simple steps to convert your application into an Azure AD multi-tenant app:</span></span>

1. <span data-ttu-id="88808-114">Atualizar seu registro de aplicativo para ser multilocatário</span><span class="sxs-lookup"><span data-stu-id="88808-114">Update your application registration to be multi-tenant</span></span>
2. <span data-ttu-id="88808-115">Atualizar seu código para enviar solicitações para o ponto de extremidade /common</span><span class="sxs-lookup"><span data-stu-id="88808-115">Update your code to send requests to the /common endpoint</span></span> 
3. <span data-ttu-id="88808-116">Atualizar seu código para lidar com vários valores de emissor</span><span class="sxs-lookup"><span data-stu-id="88808-116">Update your code to handle multiple issuer values</span></span>
4. <span data-ttu-id="88808-117">Entender o consentimento do usuário e administrador e fazer as alterações de código apropriadas</span><span class="sxs-lookup"><span data-stu-id="88808-117">Understand user and admin consent and make appropriate code changes</span></span>

<span data-ttu-id="88808-118">Vamos examinar cada etapa detalhadamente.</span><span class="sxs-lookup"><span data-stu-id="88808-118">Let’s look at each step in detail.</span></span> <span data-ttu-id="88808-119">Você também pode ir diretamente para [esta lista de exemplos de multilocatário][AAD-Samples-MT].</span><span class="sxs-lookup"><span data-stu-id="88808-119">You can also jump straight to [this list of multi-tenant samples][AAD-Samples-MT].</span></span>

## <a name="update-registration-to-be-multi-tenant"></a><span data-ttu-id="88808-120">Atualizar o registro para ser multilocatário</span><span class="sxs-lookup"><span data-stu-id="88808-120">Update registration to be multi-tenant</span></span>
<span data-ttu-id="88808-121">Por padrão, os registros de API/aplicativo Web no Azure AD são de locatário único.</span><span class="sxs-lookup"><span data-stu-id="88808-121">By default, web app/API registrations in Azure AD are single tenant.</span></span>  <span data-ttu-id="88808-122">Você pode tornar o registro multilocatário localizando a opção “Multilocatário” na página de configuração do registro do aplicativo no [portal do Azure][AZURE-portal] e configurando-a como “Sim”.</span><span class="sxs-lookup"><span data-stu-id="88808-122">You can make your registration multi-tenant by finding the “Multi-Tenanted” switch on the properties page of your application registration in the [Azure portal][AZURE-portal] and setting it to “Yes”.</span></span>

<span data-ttu-id="88808-123">Observe também que antes de um aplicativo poder ser definido como multilocatário, o Azure AD requer que o URI da ID do Aplicativo seja globalmente exclusivo.</span><span class="sxs-lookup"><span data-stu-id="88808-123">Also note, before an application can be made multi-tenant, Azure AD requires the App ID URI of the application to be globally unique.</span></span> <span data-ttu-id="88808-124">O URI da ID do Aplicativo é uma das maneiras que um aplicativo é identificado em mensagens de protocolo.</span><span class="sxs-lookup"><span data-stu-id="88808-124">The App ID URI is one of the ways an application is identified in protocol messages.</span></span>  <span data-ttu-id="88808-125">Para um aplicativo de locatário único, é suficiente que o URI da ID do Aplicativo seja exclusivo nesse locatário.</span><span class="sxs-lookup"><span data-stu-id="88808-125">For a single tenant application, it is sufficient for the App ID URI to be unique within that tenant.</span></span>  <span data-ttu-id="88808-126">Para um aplicativo multilocatário, ele deve ser globalmente exclusivo para que o Azure AD possa localizar os aplicativos em todos os locatários.</span><span class="sxs-lookup"><span data-stu-id="88808-126">For a multi-tenant application, it must be globally unique so Azure AD can find the application across all tenants.</span></span>  <span data-ttu-id="88808-127">A exclusividade global é imposta exigindo o URI da ID do Aplicativo com um nome de host que corresponda a um domínio verificado do locatário do Azure AD.</span><span class="sxs-lookup"><span data-stu-id="88808-127">Global uniqueness is enforced by requiring the App ID URI to have a host name that matches a verified domain of the Azure AD tenant.</span></span>  <span data-ttu-id="88808-128">Por exemplo, se o nome do seu locatário fosse contoso.onmicrosoft.com, um URI da ID do Aplicativo válido seria `https://contoso.onmicrosoft.com/myapp`.</span><span class="sxs-lookup"><span data-stu-id="88808-128">For example, if the name of your tenant was contoso.onmicrosoft.com then a valid App ID URI would be `https://contoso.onmicrosoft.com/myapp`.</span></span>  <span data-ttu-id="88808-129">Se seu locatário tivesse um domínio verificado de `contoso.com`, então um URI da ID do Aplicativo também seria `https://contoso.com/myapp`.</span><span class="sxs-lookup"><span data-stu-id="88808-129">If your tenant had a verified domain of `contoso.com`, then a valid App ID URI would also be `https://contoso.com/myapp`.</span></span>  <span data-ttu-id="88808-130">A configuração de um aplicativo como multilocatário falhará se o URI da ID do Aplicativo não seguir esse padrão.</span><span class="sxs-lookup"><span data-stu-id="88808-130">Setting an application as multi-tenant will fail if the App ID URI doesn’t follow this pattern.</span></span>

<span data-ttu-id="88808-131">Registros de cliente nativos são multilocatários por padrão.</span><span class="sxs-lookup"><span data-stu-id="88808-131">Native client registrations are multi-tenant by default.</span></span>  <span data-ttu-id="88808-132">Você não precisa realizar nenhuma ação para tornar um registro de aplicativo cliente nativo multilocatário.</span><span class="sxs-lookup"><span data-stu-id="88808-132">You don’t need to take any action to make a native client application registration multi-tenant.</span></span>

## <a name="update-your-code-to-send-requests-to-common"></a><span data-ttu-id="88808-133">Atualizar seu código para enviar solicitações para /common</span><span class="sxs-lookup"><span data-stu-id="88808-133">Update your code to send requests to /common</span></span>
<span data-ttu-id="88808-134">Em um aplicativo de locatário único, as solicitações de conexão são enviadas para o ponto de extremidade de conexão do locatário.</span><span class="sxs-lookup"><span data-stu-id="88808-134">In a single tenant application, sign-in requests are sent to the tenant’s sign-in endpoint.</span></span> <span data-ttu-id="88808-135">Por exemplo, para contoso.onmicrosoft.com o ponto de extremidade seria:</span><span class="sxs-lookup"><span data-stu-id="88808-135">For example, for contoso.onmicrosoft.com the endpoint would be:</span></span>

    https://login.microsoftonline.com/contoso.onmicrosoft.com

<span data-ttu-id="88808-136">Solicitações enviadas para o ponto de extremidade de um locatário podem realizar a entrada de usuários (ou convidados) naquele locatário para aplicativos nele.</span><span class="sxs-lookup"><span data-stu-id="88808-136">Requests sent to a tenant’s endpoint can sign in users (or guests) in that tenant to applications in that tenant.</span></span>  <span data-ttu-id="88808-137">Com um aplicativo multilocatário, o aplicativo não sabe com antecedência de qual locatário o usuário é, portanto, você não pode enviar solicitações para o ponto de extremidade de um locatário.</span><span class="sxs-lookup"><span data-stu-id="88808-137">With a multi-tenant application, the application doesn’t know up front what tenant the user is from, so you can’t send requests to a tenant’s endpoint.</span></span>  <span data-ttu-id="88808-138">Em vez disso, as solicitações são enviadas para um ponto de extremidade que multiplexa entre todos os locatários do Azure AD:</span><span class="sxs-lookup"><span data-stu-id="88808-138">Instead, requests are sent to an endpoint that multiplexes across all Azure AD tenants:</span></span>

    https://login.microsoftonline.com/common

<span data-ttu-id="88808-139">Quando o Azure AD recebe uma solicitação no ponto de extremidade /common, ele realiza a entrada do usuário e como consequência descobre de qual locatário o usuário é.</span><span class="sxs-lookup"><span data-stu-id="88808-139">When Azure AD receives a request on the /common endpoint, it signs the user in and as a consequence discovers which tenant the user is from.</span></span>  <span data-ttu-id="88808-140">O ponto de extremidade /common funciona com todos os protocolos de autenticação com suporte pelo Azure AD: OpenID Connect, OAuth 2.0, SAML 2.0 e WS-Federation.</span><span class="sxs-lookup"><span data-stu-id="88808-140">The /common endpoint works with all of the authentication protocols supported by Azure AD:  OpenID Connect, OAuth 2.0, SAML 2.0, and WS-Federation.</span></span>

<span data-ttu-id="88808-141">Em seguida, a resposta de conexão para o aplicativo conterá um token que representa o usuário.</span><span class="sxs-lookup"><span data-stu-id="88808-141">The sign-in response to the application then contains a token representing the user.</span></span>  <span data-ttu-id="88808-142">O valor do emissor no token diz a um aplicativo de qual locatário o usuário é.</span><span class="sxs-lookup"><span data-stu-id="88808-142">The issuer value in the token tells an application what tenant the user is from.</span></span>  <span data-ttu-id="88808-143">Quando uma resposta retorna do ponto de extremidade /common, o valor do emissor no token corresponderá ao locatário do usuário.</span><span class="sxs-lookup"><span data-stu-id="88808-143">When a response returns from the /common endpoint, the issuer value in the token will correspond to the user’s tenant.</span></span>  <span data-ttu-id="88808-144">É importante observar que o ponto de extremidade /common não é um locatário e não é um emissor, ele é apenas um multiplexador.</span><span class="sxs-lookup"><span data-stu-id="88808-144">It’s important to note the /common endpoint is not a tenant and is not an issuer, it’s just a multiplexer.</span></span>  <span data-ttu-id="88808-145">Ao usar /common, a lógica em seu aplicativo para validar tokens precisa ser atualizada para considerar isso.</span><span class="sxs-lookup"><span data-stu-id="88808-145">When using /common, the logic in your application to validate tokens needs to be updated to take this into account.</span></span> 

<span data-ttu-id="88808-146">Como mencionado anteriormente, os aplicativos multilocatário também devem fornecer uma experiência de entrada consistente para usuários, seguindo as diretrizes de identidade visual do aplicativo do Azure AD.</span><span class="sxs-lookup"><span data-stu-id="88808-146">As mentioned earlier, multi-tenant applications should also provide a consistent sign-in experience for users, following the Azure AD application branding guidelines.</span></span> <span data-ttu-id="88808-147">Clique no botão a seguir para saber mais sobre a identidade visual de seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="88808-147">Click the following button to learn more about branding your application.</span></span>

<span data-ttu-id="88808-148">[![Sign in button][AAD-Sign-In]][AAD-App-Branding]</span><span class="sxs-lookup"><span data-stu-id="88808-148">[![Sign in button][AAD-Sign-In]][AAD-App-Branding]</span></span>

<span data-ttu-id="88808-149">Vamos examinar o uso do ponto de extremidade /common e a sua implementação de código em mais detalhes.</span><span class="sxs-lookup"><span data-stu-id="88808-149">Let’s take a look at the use of the /common endpoint and your code implementation in more detail.</span></span>

## <a name="update-your-code-to-handle-multiple-issuer-values"></a><span data-ttu-id="88808-150">Atualizar seu código para lidar com vários valores de emissor</span><span class="sxs-lookup"><span data-stu-id="88808-150">Update your code to handle multiple issuer values</span></span>
<span data-ttu-id="88808-151">Os aplicativos Web e as APIs Web recebem e validam os tokens do Azure AD.</span><span class="sxs-lookup"><span data-stu-id="88808-151">Web applications and web APIs receive and validate tokens from Azure AD.</span></span>  

> [!NOTE]
> <span data-ttu-id="88808-152">Embora os aplicativos cliente nativos solicitem e recebam tokens do Azure AD, eles fazem isso para enviá-los para APIs, nas quais eles são validados.</span><span class="sxs-lookup"><span data-stu-id="88808-152">While native client applications request and receive tokens from Azure AD, they do so to send them to APIs, where they are validated.</span></span>  <span data-ttu-id="88808-153">Os aplicativos nativos não validam os tokens e devem tratá-los como opacos.</span><span class="sxs-lookup"><span data-stu-id="88808-153">Native applications do not validate tokens and must treat them as opaque.</span></span>
> 
> 

<span data-ttu-id="88808-154">Vamos examinar como um aplicativo valida os tokens que ele recebe do Azure AD.</span><span class="sxs-lookup"><span data-stu-id="88808-154">Let’s look at how an application validates tokens it receives from Azure AD.</span></span>  <span data-ttu-id="88808-155">Um aplicativo de locatário único normalmente terá um valor de ponto de extremidade como:</span><span class="sxs-lookup"><span data-stu-id="88808-155">A single tenant application will normally take an endpoint value like:</span></span>

    https://login.microsoftonline.com/contoso.onmicrosoft.com

<span data-ttu-id="88808-156">e o usará para criar uma URL de metadados (nesse caso, OpenID Connect) como:</span><span class="sxs-lookup"><span data-stu-id="88808-156">and use it to construct a metadata URL (in this case, OpenID Connect) like:</span></span>

    https://login.microsoftonline.com/contoso.onmicrosoft.com/.well-known/openid-configuration

<span data-ttu-id="88808-157">para baixar duas partes críticas de informações que são usadas para validar tokens: as chaves de assinatura do locatário e o valor de emissor.</span><span class="sxs-lookup"><span data-stu-id="88808-157">to download two critical pieces of information that are used to validate tokens:  the tenant’s signing keys and issuer value.</span></span>  <span data-ttu-id="88808-158">Cada locatário do Azure AD tem um valor de emissor exclusivo do formato:</span><span class="sxs-lookup"><span data-stu-id="88808-158">Each Azure AD tenant has a unique issuer value of the form:</span></span>

    https://sts.windows.net/31537af4-6d77-4bb9-a681-d2394888ea26/

<span data-ttu-id="88808-159">em que o valor de GUID é a versão à prova de renomeação da ID de locatário.</span><span class="sxs-lookup"><span data-stu-id="88808-159">where the GUID value is the rename-safe version of the tenant ID of the tenant.</span></span>  <span data-ttu-id="88808-160">Se você clicar no link de metadados anterior para `contoso.onmicrosoft.com`, poderá ver esse valor de emissor no documento.</span><span class="sxs-lookup"><span data-stu-id="88808-160">If you click on the preceding metadata link for `contoso.onmicrosoft.com`, you can see this issuer value in the document.</span></span>

<span data-ttu-id="88808-161">Quando um aplicativo de locatário único valida um token, ele verifica a assinatura do token em relação às chaves de autenticação do documento de metadados.</span><span class="sxs-lookup"><span data-stu-id="88808-161">When a single tenant application validates a token, it checks the signature of the token against the signing keys from the metadata document.</span></span> <span data-ttu-id="88808-162">Isso permite garantir que o valor do emissor no token corresponde ao que foi encontrado no documento de metadados.</span><span class="sxs-lookup"><span data-stu-id="88808-162">This allows it to make sure the issuer value in the token matches the one that was found in the metadata document.</span></span>

<span data-ttu-id="88808-163">Como o ponto de extremidade /common não corresponde a um locatário e não é um emissor, ao examinar o valor do emissor nos metadados para /common, ele tem uma URL de modelo em vez de um valor real:</span><span class="sxs-lookup"><span data-stu-id="88808-163">Since the /common endpoint doesn’t correspond to a tenant and isn’t an issuer, when you examine the issuer value in the metadata for /common it has a templated URL instead of an actual value:</span></span>

    https://sts.windows.net/{tenantid}/

<span data-ttu-id="88808-164">Portanto, um aplicativo multilocatário não pode validar tokens apenas combinando o valor do emissor nos metadados com o valor `issuer` no token.</span><span class="sxs-lookup"><span data-stu-id="88808-164">Therefore, a multi-tenant application can’t validate tokens just by matching the issuer value in the metadata with the `issuer` value in the token.</span></span>  <span data-ttu-id="88808-165">Um aplicativo multilocatário precisa de lógica para decidir quais valores de emissor são válidos e quais não são com base na parte da ID do locatário do valor do emissor.</span><span class="sxs-lookup"><span data-stu-id="88808-165">A multi-tenant application needs logic to decide which issuer values are valid and which are not, based on the tenant ID portion of the issuer value.</span></span>  

<span data-ttu-id="88808-166">Por exemplo, se um aplicativo multilocatário permite apenas a conexão em locatários específicos que se inscreveram para seu serviço, ele deve verificar o valor do emissor ou o valor da declaração `tid` no token para ter certeza de que o locatário está em sua lista de assinantes.</span><span class="sxs-lookup"><span data-stu-id="88808-166">For example, if a multi-tenant application only allows sign-in from specific tenants who have signed up for their service, then it must check either the issuer value or the `tid` claim value in the token to make sure that tenant is in their list of subscribers.</span></span>  <span data-ttu-id="88808-167">Se um aplicativo multilocatário lida apenas com pessoas e não toma nenhuma decisão de acesso com base em locatários, ele pode ignorar o valor de emissor completamente.</span><span class="sxs-lookup"><span data-stu-id="88808-167">If a multi-tenant application only deals with individuals and doesn’t make any access decisions based on tenants, then it can ignore the issuer value altogether.</span></span>

<span data-ttu-id="88808-168">Nas amostras de multilocatário da seção [Conteúdo relacionado](#related-content) ao final desse artigo, a validação do emissor está desabilitada para permitir a conexão de qualquer locatário do Azure AD.</span><span class="sxs-lookup"><span data-stu-id="88808-168">In the multi-tenant samples in the [Related Content](#related-content) section at the end of this article, issuer validation is disabled to enable any Azure AD tenant to sign in.</span></span>

<span data-ttu-id="88808-169">Agora vamos examinar a experiência do usuário para usuários que estão entrando em aplicativos multilocatários.</span><span class="sxs-lookup"><span data-stu-id="88808-169">Now let’s look at the user experience for users that are signing in to multi-tenant applications.</span></span>

## <a name="understanding-user-and-admin-consent"></a><span data-ttu-id="88808-170">Entendendo o consentimento do usuário e do administrador</span><span class="sxs-lookup"><span data-stu-id="88808-170">Understanding user and admin consent</span></span>
<span data-ttu-id="88808-171">Para um usuário entrar em um aplicativo no Azure AD, o aplicativo deve estar representado no locatário do usuário.</span><span class="sxs-lookup"><span data-stu-id="88808-171">For a user to sign in to an application in Azure AD, the application must be represented in the user’s tenant.</span></span>  <span data-ttu-id="88808-172">Isso permite que a organização realize ações como aplicar políticas exclusivas quando usuários de seu locatário entrarem no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="88808-172">This allows the organization to do things like apply unique policies when users from their tenant sign in to the application.</span></span>  <span data-ttu-id="88808-173">Para um aplicativo de locatário único, esse registro é simples; é aquele feito quando você registra o aplicativo no [portal do Azure][AZURE-portal].</span><span class="sxs-lookup"><span data-stu-id="88808-173">For a single tenant application, this registration is simple; it’s the one that happens when you register the application in the [Azure portal][AZURE-portal].</span></span>

<span data-ttu-id="88808-174">Para um aplicativo multilocatário, o registro inicial para o aplicativo reside no locatário do Azure AD usado pelo desenvolvedor.</span><span class="sxs-lookup"><span data-stu-id="88808-174">For a multi-tenant application, the initial registration for the application lives in the Azure AD tenant used by the developer.</span></span>  <span data-ttu-id="88808-175">Quando um usuário de um locatário diferente entra no aplicativo pela primeira vez, o Azure AD solicita que ele consinta com as permissões solicitadas pelo aplicativo.</span><span class="sxs-lookup"><span data-stu-id="88808-175">When a user from a different tenant signs in to the application for the first time, Azure AD asks them to consent to the permissions requested by the application.</span></span>  <span data-ttu-id="88808-176">Se ele fornecer o consentimento, uma representação do aplicativo chamada uma *entidade de serviço* será criada no locatário do usuário e o processo de conexão poderá continuar.</span><span class="sxs-lookup"><span data-stu-id="88808-176">If they consent, then a representation of the application called a *service principal* is created in the user’s tenant, and sign-in can continue.</span></span> <span data-ttu-id="88808-177">Uma delegação também é criada no diretório que registra o consentimento do usuário para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="88808-177">A delegation is also created in the directory that records the user’s consent to the application.</span></span> <span data-ttu-id="88808-178">Consulte [Objetos de aplicativo e de entidade de serviço][AAD-App-SP-Objects] para obter detalhes sobre objetos Application e ServicePrincipal do aplicativo e como eles se relacionam entre si.</span><span class="sxs-lookup"><span data-stu-id="88808-178">See [Application Objects and Service Principal Objects][AAD-App-SP-Objects] for details on the application's Application and ServicePrincipal objects, and how they relate to each other.</span></span>

![Consentimento ao aplicativo de camada única][Consent-Single-Tier] 

<span data-ttu-id="88808-180">Essa experiência de consentimento é afetada pelas permissões solicitadas pelo aplicativo.</span><span class="sxs-lookup"><span data-stu-id="88808-180">This consent experience is affected by the permissions requested by the application.</span></span>  <span data-ttu-id="88808-181">O Azure AD dá suporte a dois tipos de permissões, somente do aplicativo e delegadas:</span><span class="sxs-lookup"><span data-stu-id="88808-181">Azure AD supports two kinds of permissions, app-only and delegated:</span></span>

* <span data-ttu-id="88808-182">Uma permissão delegada concede a um aplicativo a capacidade de atuar como um usuário conectado para um subconjunto das ações que o usuário pode realizar.</span><span class="sxs-lookup"><span data-stu-id="88808-182">A delegated permission grants an application the ability to act as a signed in user for a subset of the things the user can do.</span></span>  <span data-ttu-id="88808-183">Por exemplo, você pode conceder a um aplicativo a permissão delegada para ler o calendário do usuário conectado.</span><span class="sxs-lookup"><span data-stu-id="88808-183">For example, you can grant an application the delegated permission to read the signed in user’s calendar.</span></span>
* <span data-ttu-id="88808-184">Uma permissão somente do aplicativo é concedida diretamente à identidade do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="88808-184">An app-only permission is granted directly to the identity of the application.</span></span>  <span data-ttu-id="88808-185">Por exemplo, você pode conceder a permissão somente do aplicativo a um aplicativo para ler a lista de usuários em um locatário, independentemente de quem estiver conectado ao aplicativo.</span><span class="sxs-lookup"><span data-stu-id="88808-185">For example, you can grant an application the app-only permission to read the list of users in a tenant, regardless of who is signed in to the application.</span></span>

<span data-ttu-id="88808-186">Algumas permissões podem ser consentidas por um usuário normal, enquanto outras exigem o consentimento de um administrador de locatários.</span><span class="sxs-lookup"><span data-stu-id="88808-186">Some permissions can be consented to by a regular user, while others require a tenant administrator’s consent.</span></span> 

### <a name="admin-consent"></a><span data-ttu-id="88808-187">Consentimento do administrador</span><span class="sxs-lookup"><span data-stu-id="88808-187">Admin consent</span></span>
<span data-ttu-id="88808-188">As permissões somente do aplicativo sempre exigem o consentimento do administrador de locatários.</span><span class="sxs-lookup"><span data-stu-id="88808-188">App-only permissions always require a tenant administrator’s consent.</span></span>  <span data-ttu-id="88808-189">Se o aplicativo solicitar uma permissão somente do aplicativo e um usuário tentar entrar no aplicativo, uma mensagem de erro será exibida informando que o usuário não pode fornecer o consentimento.</span><span class="sxs-lookup"><span data-stu-id="88808-189">If your application requests an app-only permission and a user tries to sign in to the application, an error message will be displayed saying the user isn’t able to consent.</span></span>

<span data-ttu-id="88808-190">Algumas permissões delegadas também exigem o consentimento do administrador de locatários.</span><span class="sxs-lookup"><span data-stu-id="88808-190">Certain delegated permissions also require a tenant administrator’s consent.</span></span>  <span data-ttu-id="88808-191">Por exemplo, a capacidade de gravar no Azure AD como o usuário conectado requer o consentimento de um administrador de locatários.</span><span class="sxs-lookup"><span data-stu-id="88808-191">For example, the ability to write back to Azure AD as the signed in user requires a tenant administrator’s consent.</span></span>  <span data-ttu-id="88808-192">Semelhante às permissões somente do aplicativo, se um usuário comum tentar entrar em um aplicativo que solicita uma permissão delegada que exige o consentimento do administrador, seu aplicativo receberá um erro.</span><span class="sxs-lookup"><span data-stu-id="88808-192">Like app-only permissions, if an ordinary user tries to sign in to an application that requests a delegated permission that requires administrator consent, your application will receive an error.</span></span>  <span data-ttu-id="88808-193">Se uma permissão exige ou não o consentimento do administrador é determinado pelo desenvolvedor que publicou o recurso e pode ser encontrado na documentação do recurso.</span><span class="sxs-lookup"><span data-stu-id="88808-193">Whether or not a permission requires admin consent is determined by the developer that published the resource, and can be found in the documentation for the resource.</span></span>  <span data-ttu-id="88808-194">Os links para tópicos que descrevem as permissões disponíveis para a API do Azure AD Graph e a API do Microsoft Graph estão na seção [Conteúdo relacionado](#related-content) desse artigo.</span><span class="sxs-lookup"><span data-stu-id="88808-194">Links to topics describing the available permissions for the Azure AD Graph API and Microsoft Graph API are in the [Related Content](#related-content) section of this article.</span></span>

<span data-ttu-id="88808-195">Se o aplicativo usar permissões que exigem o consentimento do administrador, você precisará ter um gesto como um botão ou link, em que o administrador pode iniciar a ação.</span><span class="sxs-lookup"><span data-stu-id="88808-195">If your application uses permissions that require admin consent, you need to have a gesture such as a button or link where the admin can initiate the action.</span></span>  <span data-ttu-id="88808-196">A solicitação que seu aplicativo envia para essa ação é uma solicitação de autorização do OAuth2/OpenID Connect normal, mas ela também inclui o parâmetro de cadeia de caracteres de consulta `prompt=admin_consent` .</span><span class="sxs-lookup"><span data-stu-id="88808-196">The request your application sends for this action is a usual OAuth2/OpenID Connect authorization request, but that also includes the `prompt=admin_consent` query string parameter.</span></span>  <span data-ttu-id="88808-197">Depois que o administrador fornecer seu consentimento e a entidade de serviço for criada no locatário do cliente, as próximas solicitações de conexão não precisarão do parâmetro `prompt=admin_consent`.</span><span class="sxs-lookup"><span data-stu-id="88808-197">Once the admin has consented and the service principal is created in the customer’s tenant, subsequent sign-in requests do not need the `prompt=admin_consent` parameter.</span></span> <span data-ttu-id="88808-198">Uma vez que o administrador tenha decidido que as permissões solicitadas são aceitáveis, nenhum outro usuário no locatário será solicitado quanto ao consentimento daquele ponto em diante.</span><span class="sxs-lookup"><span data-stu-id="88808-198">Since the administrator has decided the requested permissions are acceptable, no other users in the tenant will be prompted for consent from that point forward.</span></span>

<span data-ttu-id="88808-199">O parâmetro `prompt=admin_consent` também pode ser usado por aplicativos que exigem permissões que não necessitam do consentimento do administrador.</span><span class="sxs-lookup"><span data-stu-id="88808-199">The `prompt=admin_consent` parameter can also be used by applications that request permissions that do not require admin consent.</span></span> <span data-ttu-id="88808-200">Isso é feito quando o aplicativo exige uma experiência na qual o administrador de locatários “se inscreve” uma vez e não é solicitado o consentimento de nenhum outro usuário a partir daí.</span><span class="sxs-lookup"><span data-stu-id="88808-200">This is done when the applicaton requires an experience where the tenant admin “signs up” one time, and no other users are prompted for consent from that point on.</span></span>

<span data-ttu-id="88808-201">Se um aplicativo exigir o consentimento do administrador e um administrador fizer logon, mas o parâmetro `prompt=admin_consent` não for enviado, o administrador fornecerá consentimento ao aplicativo **somente para sua conta de usuário**.</span><span class="sxs-lookup"><span data-stu-id="88808-201">If an application requires admin consent, and an admin signs in but the `prompt=admin_consent` parameter is not sent, the admin will successfully consent to the application **only for their user account**.</span></span>  <span data-ttu-id="88808-202">Os usuários normais ainda não poderão fazer entrar e consentir o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="88808-202">Regular users will still not be able to sign in and consent to the application.</span></span>  <span data-ttu-id="88808-203">Isso será útil se você quiser conceder ao administrador de locatários a capacidade de explorar seu aplicativo antes de permitir o acesso de outros usuários.</span><span class="sxs-lookup"><span data-stu-id="88808-203">This is useful if you want to give the tenant administrator the ability to explore your application before allowing other users access.</span></span>

<span data-ttu-id="88808-204">Um administrador de locatários pode desabilitar a capacidade dos usuários regulares consentirem aplicativos.</span><span class="sxs-lookup"><span data-stu-id="88808-204">A tenant administrator can disable the ability for regular users to consent to applications.</span></span>  <span data-ttu-id="88808-205">Se essa funcionalidade estiver desabilitada, o consentimento do administrador sempre será necessário para o aplicativo a ser configurado no locatário.</span><span class="sxs-lookup"><span data-stu-id="88808-205">If this capability is disabled, admin consent is always required for the application to be set up in the tenant.</span></span>  <span data-ttu-id="88808-206">Se você quiser testar seu aplicativo com o consentimento do usuário normal desabilitado, encontrará a opção de configuração na seção de configuração do locatário do Azure AD do [portal do Azure][AZURE-portal].</span><span class="sxs-lookup"><span data-stu-id="88808-206">If you want to test your application with regular user consent disabled, you can find the configuration switch in the Azure AD tenant configuration section of the [Azure portal][AZURE-portal].</span></span>

> [!NOTE]
> <span data-ttu-id="88808-207">Alguns aplicativos desejam uma experiência em que os usuários normais podem consentir inicialmente e posteriormente o aplicativo pode envolver o administrador e solicitar permissões que exigem o consentimento do administrador.</span><span class="sxs-lookup"><span data-stu-id="88808-207">Some applications want an experience where regular users are able to consent initially, and later the application can involve the administrator and request permissions that require admin consent.</span></span>  <span data-ttu-id="88808-208">Não é possível fazer isso com um registro de aplicativo único no Azure AD atualmente.</span><span class="sxs-lookup"><span data-stu-id="88808-208">There is no way to do this with a single application registration in Azure AD today.</span></span>  <span data-ttu-id="88808-209">O próximo ponto de extremidade do Azure AD v2 permitirá que os aplicativos solicitem permissões no tempo de execução em vez de no momento do registro, o que permitirá esse cenário.</span><span class="sxs-lookup"><span data-stu-id="88808-209">The upcoming Azure AD v2 endpoint will allow applications to request permissions at runtime, instead of at registration time, which will enable this scenario.</span></span>  <span data-ttu-id="88808-210">Para saber mais, consulte o [Guia do desenvolvedor do modelo de aplicativo do Azure AD v2][AAD-V2-Dev-Guide].</span><span class="sxs-lookup"><span data-stu-id="88808-210">For more information, see the [Azure AD App Model v2 Developer Guide][AAD-V2-Dev-Guide].</span></span>
> 
> 

### <a name="consent-and-multi-tier-applications"></a><span data-ttu-id="88808-211">Aplicativos de várias camadas e consentimento</span><span class="sxs-lookup"><span data-stu-id="88808-211">Consent and multi-tier applications</span></span>
<span data-ttu-id="88808-212">Seu aplicativo pode ter várias camadas, cada uma representada por seu próprio registro no Azure AD.</span><span class="sxs-lookup"><span data-stu-id="88808-212">Your application may have multiple tiers, each represented by its own registration in Azure AD.</span></span>  <span data-ttu-id="88808-213">Por exemplo, um aplicativo nativo que chama uma API Web ou um aplicativo Web que chama uma API Web.</span><span class="sxs-lookup"><span data-stu-id="88808-213">For example, a native application that calls a web API, or a web application that calls a web API.</span></span>  <span data-ttu-id="88808-214">Em ambos os casos, o cliente (aplicativo nativo ou aplicativo Web) solicita permissões para chamar o recurso (API Web).</span><span class="sxs-lookup"><span data-stu-id="88808-214">In both of these cases, the client (native app or web app) requests permissions to call the resource (web API).</span></span>  <span data-ttu-id="88808-215">Para o cliente ter o consentimento com êxito em um locatário do cliente, todos os recursos aos quais ele solicita permissões já devem existir no locatário do cliente.</span><span class="sxs-lookup"><span data-stu-id="88808-215">For the client to be successfully consented into a customer’s tenant, all resources to which it requests permissions must already exist in the customer’s tenant.</span></span>  <span data-ttu-id="88808-216">Se essa condição não for atendida, o Azure AD retornará um erro de que o recurso deve ser adicionado primeiro.</span><span class="sxs-lookup"><span data-stu-id="88808-216">If this condition isn’t met, Azure AD will return an error that the resource must be added first.</span></span>

<span data-ttu-id="88808-217">**Várias camadas em um único locatário**</span><span class="sxs-lookup"><span data-stu-id="88808-217">**Multiple tiers in a single tenant**</span></span>

<span data-ttu-id="88808-218">Isso poderá ser um problema se seu aplicativo lógico consistir em dois ou mais registros de aplicativo, por exemplo, um cliente e um recurso separados.</span><span class="sxs-lookup"><span data-stu-id="88808-218">This can be a problem if your logical application consists of two or more application registrations, for example a separate client and resource.</span></span>  <span data-ttu-id="88808-219">Como você obtém o recurso no locatário do cliente primeiro?</span><span class="sxs-lookup"><span data-stu-id="88808-219">How do you get the resource into the customer tenant first?</span></span>  <span data-ttu-id="88808-220">O Azure AD abrange neste caso permitindo que o cliente e o recurso recebam o consentimento em uma única etapa.</span><span class="sxs-lookup"><span data-stu-id="88808-220">Azure AD covers this case by enabling client and resource to be consented in a single step.</span></span> <span data-ttu-id="88808-221">O usuário vê a soma total das permissões solicitadas pelo cliente e pelo recurso na página de consentimento.</span><span class="sxs-lookup"><span data-stu-id="88808-221">The user sees the sum total of the permissions requested by both the client and resource on the consent page.</span></span>  <span data-ttu-id="88808-222">Para permitir esse comportamento, o registro do aplicativo do recurso deve incluir a ID do aplicativo do cliente como um `knownClientApplications` no manifesto do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="88808-222">To enable this behavior, the resource’s application registration must include the client’s App ID as a `knownClientApplications` in its application manifest.</span></span>  <span data-ttu-id="88808-223">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="88808-223">For example:</span></span>

    knownClientApplications": ["94da0930-763f-45c7-8d26-04d5938baab2"]

<span data-ttu-id="88808-224">Essa propriedade pode ser atualizada por meio do [manifesto do aplicativo][AAD-App-Manifest] do recurso.</span><span class="sxs-lookup"><span data-stu-id="88808-224">This property can be updated via the resource [application’s manifest][AAD-App-Manifest].</span></span> <span data-ttu-id="88808-225">Isso é demonstrado em uma amostra de chamada de cliente nativo de várias à API Web na seção [Conteúdo relacionado](#related-content) ao final deste artigo.</span><span class="sxs-lookup"><span data-stu-id="88808-225">This is demonstrated in a multi-tier native client calling web API sample in the [Related Content](#related-content) section at the end of this article.</span></span> <span data-ttu-id="88808-226">O seguinte diagrama fornece uma visão geral de consentimento para um aplicativo de várias camadas registrado em um único locatário:</span><span class="sxs-lookup"><span data-stu-id="88808-226">The following diagram provides an overview of consent for a multi-tier app registered in a single tenant :</span></span>

![Consentimento ao aplicativo cliente conhecido de várias camadas][Consent-Multi-Tier-Known-Client] 

<span data-ttu-id="88808-228">**Várias camadas em vários locatários**</span><span class="sxs-lookup"><span data-stu-id="88808-228">**Multiple tiers in multiple tenants**</span></span>

<span data-ttu-id="88808-229">Um caso semelhante acontecerá se as diferentes camadas de um aplicativo forem registradas em locatários diferentes.</span><span class="sxs-lookup"><span data-stu-id="88808-229">A similar case happens if the different tiers of an application are registered in different tenants.</span></span>  <span data-ttu-id="88808-230">Por exemplo, considere o caso da criação de um aplicativo cliente nativo que chama a API do Office 365 Exchange Online.</span><span class="sxs-lookup"><span data-stu-id="88808-230">For example, consider the case of building a native client application that calls the Office 365 Exchange Online API.</span></span>  <span data-ttu-id="88808-231">Para desenvolver o aplicativo e posteriormente para o aplicativo nativo ser executado no locatário de um cliente, a entidade de serviço do Exchange Online deve estar presente.</span><span class="sxs-lookup"><span data-stu-id="88808-231">To develop the native application, and later for the native application to run in a customer’s tenant, the Exchange Online service principal must be present.</span></span>  <span data-ttu-id="88808-232">Nesse caso, o desenvolvedor e o cliente devem adquirir o Exchange Online para que a entidade de serviço seja criada em seus locatários.</span><span class="sxs-lookup"><span data-stu-id="88808-232">In this case, the developer and customer must purchase Exchange Online for the service principal to be created in their tenants.</span></span>  

<span data-ttu-id="88808-233">No caso de uma API criada por uma organização que não seja a Microsoft, o desenvolvedor da API precisa fornecer uma maneira para seus clientes fornecerem consentimento para o aplicativo nos locatários de seus clientes.</span><span class="sxs-lookup"><span data-stu-id="88808-233">In the case of an API built by an organization other than Microsoft, the developer of the API needs to provide a way for their customers to consent the application into their customers' tenants.</span></span> <span data-ttu-id="88808-234">O design recomendado é que o desenvolvedor de terceiros crie a API, de forma que ele também possa funcionar como um cliente Web para implementar a inscrição:</span><span class="sxs-lookup"><span data-stu-id="88808-234">The recommended design is for the 3rd party developer to build the API such that it can also function as a web client to implement sign-up :</span></span>

1. <span data-ttu-id="88808-235">Siga as seções anteriores para garantir que a API implementa os requisitos de código/registro do aplicativo multilocatário</span><span class="sxs-lookup"><span data-stu-id="88808-235">Follow the earlier sections to ensure the API implements the multi-tenant application registration/code requirements</span></span>
2. <span data-ttu-id="88808-236">Além de expor os escopos e as funções da API, garanta que o registro inclui a permissão “Entrar e ler o perfil de usuário” do Azure AD (fornecido por padrão)</span><span class="sxs-lookup"><span data-stu-id="88808-236">In addition to exposing the API's scopes/roles, ensure the registration includes the "Sign in and read user profile" Azure AD permission (provided by default)</span></span>
3. <span data-ttu-id="88808-237">Implemente uma página de conexão/inscrição no cliente Web seguindo as diretrizes de [consentimento do administrador](#admin-consent) abordadas anteriormente</span><span class="sxs-lookup"><span data-stu-id="88808-237">Implement a sign-in/sign-up page in the web client, following the [admin consent](#admin-consent) guidance discussed earlier</span></span> 
4. <span data-ttu-id="88808-238">Depois que o usuário fornecer consentimento para o aplicativo, a entidade de serviço e os links de delegação de consentimento serão criados em seu locatário e o aplicativo nativo poderá obter tokens para a API</span><span class="sxs-lookup"><span data-stu-id="88808-238">Once the user consents to the application, the service principal and consent delegation links are created in their tenant, and the native application can get tokens for the API</span></span>

<span data-ttu-id="88808-239">O seguinte diagrama fornece uma visão geral de consentimento para um aplicativo de várias camadas registrado em diferentes locatários:</span><span class="sxs-lookup"><span data-stu-id="88808-239">The following diagram provides an overview of consent for a multi-tier app registered in different tenants:</span></span>

![Consentimento ao aplicativo de vários fornecedores de várias camadas][Consent-Multi-Tier-Multi-Party] 

### <a name="revoking-consent"></a><span data-ttu-id="88808-241">Revogando o consentimento</span><span class="sxs-lookup"><span data-stu-id="88808-241">Revoking Consent</span></span>
<span data-ttu-id="88808-242">Os usuários e administradores podem revogar o consentimento para seu aplicativo a qualquer momento:</span><span class="sxs-lookup"><span data-stu-id="88808-242">Users and administrators can revoke consent to your application at any time:</span></span>

* <span data-ttu-id="88808-243">Os usuários revogam o acesso a aplicativos individuais removendo-os da lista de [Aplicativos do Painel de Acesso][AAD-Access-Panel].</span><span class="sxs-lookup"><span data-stu-id="88808-243">Users revoke access to individual applications by removing them from their [Access Panel Applications][AAD-Access-Panel] list.</span></span>
* <span data-ttu-id="88808-244">Os administradores revogam o acesso a aplicativos removendo-os do Azure AD usando a seção de gerenciamento do Azure AD do [portal do Azure][AZURE-portal].</span><span class="sxs-lookup"><span data-stu-id="88808-244">Administrators revoke access to applications by removing them from Azure AD using the Azure AD management section of the [Azure portal][AZURE-portal].</span></span>

<span data-ttu-id="88808-245">Se um administrador der o consentimento a um aplicativo para todos os usuários em um locatário, os usuários não poderão revogar o acesso individualmente.</span><span class="sxs-lookup"><span data-stu-id="88808-245">If an administrator consents to an application for all users in a tenant, users cannot revoke access individually.</span></span>  <span data-ttu-id="88808-246">Somente o administrador pode revogar o acesso e somente para o aplicativo inteiro.</span><span class="sxs-lookup"><span data-stu-id="88808-246">Only the administrator can revoke access, and only for the whole application.</span></span>

### <a name="consent-and-protocol-support"></a><span data-ttu-id="88808-247">Suporte a protocolo e consentimento</span><span class="sxs-lookup"><span data-stu-id="88808-247">Consent and Protocol Support</span></span>
<span data-ttu-id="88808-248">O consentimento tem suporte no Azure AD por meio dos protocolos OAuth, OpenID Connect, Web Services Federation e SAML.</span><span class="sxs-lookup"><span data-stu-id="88808-248">Consent is supported in Azure AD via the OAuth, OpenID Connect, WS-Federation, and SAML protocols.</span></span>  <span data-ttu-id="88808-249">Os protocolos SAML e WS-Federation não dão suporte ao parâmetro `prompt=admin_consent` , portanto, o consentimento do administrador é possível apenas por meio do OAuth e do OpenID Connect.</span><span class="sxs-lookup"><span data-stu-id="88808-249">The SAML and WS-Federation protocols do not support the `prompt=admin_consent` parameter, so admin consent is only possible via OAuth and OpenID Connect.</span></span>

## <a name="multi-tenant-applications-and-caching-access-tokens"></a><span data-ttu-id="88808-250">Aplicativos multilocatários e caching de tokens de acesso</span><span class="sxs-lookup"><span data-stu-id="88808-250">Multi-Tenant Applications and Caching Access Tokens</span></span>
<span data-ttu-id="88808-251">Os aplicativos multilocatários também podem obter tokens de acesso para chamar APIs que são protegidas pelo Azure AD.</span><span class="sxs-lookup"><span data-stu-id="88808-251">Multi-tenant applications can also get access tokens to call APIs that are protected by Azure AD.</span></span>  <span data-ttu-id="88808-252">Um erro comum ao usar a ADAL (Biblioteca de Autenticação do Active Directory) com um aplicativo multilocatário é solicitar inicialmente um token para um usuário usando /common, receber uma resposta e, depois, solicitar um próximo token para o mesmo usuário também usando /common.</span><span class="sxs-lookup"><span data-stu-id="88808-252">A common error when using the Active Directory Authentication Library (ADAL) with a multi-tenant application, is to initially request a token for a user using /common, receive a response, then request a subsequent token for that same user also using /common.</span></span>  <span data-ttu-id="88808-253">Uma vez que a resposta do Azure AD vem de um locatário, não de /common, a ADAL armazena em cache o token como sendo do locatário.</span><span class="sxs-lookup"><span data-stu-id="88808-253">Since the response from Azure AD comes from a tenant, not /common, ADAL caches the token as being from the tenant.</span></span> <span data-ttu-id="88808-254">A chamada subsequente para /common para obter um token de acesso para o usuário perde a entrada de cache e o usuário é solicitado a entrar novamente.</span><span class="sxs-lookup"><span data-stu-id="88808-254">The subsequent call to /common to get an access token for the user misses the cache entry, and the user is prompted to sign in again.</span></span>  <span data-ttu-id="88808-255">Para evitar a perda de cache, certifique-se de que as chamadas subsequentes para um usuário já conectado sejam feitas para o ponto de extremidade do locatário.</span><span class="sxs-lookup"><span data-stu-id="88808-255">To avoid missing the cache, make sure subsequent calls for an already signed in user are made to the tenant’s endpoint.</span></span>

## <a name="next-steps"></a><span data-ttu-id="88808-256">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="88808-256">Next steps</span></span>
<span data-ttu-id="88808-257">Neste artigo, você aprendeu a criar um aplicativo que pode conectar um usuário por meio de qualquer locatário do Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="88808-257">In this article, you learned how to build an application that can sign in a user from any Azure Active Directory tenant.</span></span> <span data-ttu-id="88808-258">Depois de habilitar o Logon Único entre o aplicativo e o Azure Active Directory, você também pode atualizar o aplicativo para acessar as APIs expostas por recursos da Microsoft, como o Office 365.</span><span class="sxs-lookup"><span data-stu-id="88808-258">After enabling Single Sign-On between your app and Azure Active Directory, you can also update your application to access APIs exposed by Microsoft resources, like Office 365.</span></span> <span data-ttu-id="88808-259">Portanto, é possível oferecer uma experiência personalizada no aplicativo, por exemplo, mostrando informações contextuais para os usuários, como suas imagens de perfil ou seus próximos compromissos no calendário.</span><span class="sxs-lookup"><span data-stu-id="88808-259">So you can offer a personalized experience in your application, for example showing contextual information to the users, like their profile picture or their next calendar appointment.</span></span> <span data-ttu-id="88808-260">Para saber mais sobre como fazer chamadas à API para serviços do Azure Active Directory e do Office 365, como o Exchange, SharePoint, OneDrive, OneNote, Planner, Excel e muitos outros, acesse [API do Microsoft Graph][MSFT-Graph-overview].</span><span class="sxs-lookup"><span data-stu-id="88808-260">To learn more about making API calls to Azure Active Directory and Office 365 services like Exchange, SharePoint, OneDrive, OneNote, Planner, Excel and more, visit: [Microsoft Graph API][MSFT-Graph-overview].</span></span>


## <a name="related-content"></a><span data-ttu-id="88808-261">Conteúdo relacionado</span><span class="sxs-lookup"><span data-stu-id="88808-261">Related content</span></span>
* <span data-ttu-id="88808-262">[Exemplos de aplicativos multilocatários][AAD-Samples-MT]</span><span class="sxs-lookup"><span data-stu-id="88808-262">[Multi-tenant application samples][AAD-Samples-MT]</span></span>
* <span data-ttu-id="88808-263">[Diretrizes de identidade visual para aplicativos][AAD-App-Branding]</span><span class="sxs-lookup"><span data-stu-id="88808-263">[Branding Guidelines for Applications][AAD-App-Branding]</span></span>
* <span data-ttu-id="88808-264">[Guia do Desenvolvedor do Azure AD][AAD-Dev-Guide]</span><span class="sxs-lookup"><span data-stu-id="88808-264">[Azure AD Developer's Guide][AAD-Dev-Guide]</span></span>
* <span data-ttu-id="88808-265">[Objetos de Aplicativo e de Entidade de Serviço][AAD-App-SP-Objects]</span><span class="sxs-lookup"><span data-stu-id="88808-265">[Application Objects and Service Principal Objects][AAD-App-SP-Objects]</span></span>
* <span data-ttu-id="88808-266">[Integrando aplicativos com o Azure Active Directory][AAD-Integrating-Apps]</span><span class="sxs-lookup"><span data-stu-id="88808-266">[Integrating Applications with Azure Active Directory][AAD-Integrating-Apps]</span></span>
* <span data-ttu-id="88808-267">[Visão geral da estrutura de consentimento][AAD-Consent-Overview]</span><span class="sxs-lookup"><span data-stu-id="88808-267">[Overview of the Consent Framework][AAD-Consent-Overview]</span></span>
* <span data-ttu-id="88808-268">[Escopos de permissão da API do Microsoft Graph][MSFT-Graph-permision-scopes]</span><span class="sxs-lookup"><span data-stu-id="88808-268">[Microsoft Graph API Permission Scopes][MSFT-Graph-permision-scopes]</span></span>
* <span data-ttu-id="88808-269">[Escopos de permissão da API do Graph do Azure AD][AAD-Graph-Perm-Scopes]</span><span class="sxs-lookup"><span data-stu-id="88808-269">[Azure AD Graph API Permission Scopes][AAD-Graph-Perm-Scopes]</span></span>

<span data-ttu-id="88808-270">Use a seção de comentários a seguir para fornecer seus comentários e nos ajudar a aprimorar e adaptar nosso conteúdo.</span><span class="sxs-lookup"><span data-stu-id="88808-270">Please use the following comments section to provide feedback and help us refine and shape our content.</span></span>

<!--Reference style links IN USE -->
[AAD-Access-Panel]:  https://myapps.microsoft.com
[AAD-App-Branding]: ./active-directory-branding-guidelines.md
[AAD-App-Manifest]: ./active-directory-application-manifest.md
[AAD-App-SP-Objects]: ./active-directory-application-objects.md
[AAD-Auth-Scenarios]: ./active-directory-authentication-scenarios.md
[AAD-Consent-Overview]: ./active-directory-integrating-applications.md#overview-of-the-consent-framework
[AAD-Dev-Guide]: ./active-directory-developers-guide.md
[AAD-Graph-Overview]: https://azure.microsoft.com/en-us/documentation/articles/active-directory-graph-api/
[AAD-Graph-Perm-Scopes]: https://msdn.microsoft.com/library/azure/ad/graph/howto/azure-ad-graph-api-permission-scopes
[AAD-Integrating-Apps]: ./active-directory-integrating-applications.md
[AAD-Samples-MT]: https://azure.microsoft.com/documentation/samples/?service=active-directory&term=multitenant
[AAD-Why-To-Integrate]: ./active-directory-how-to-integrate.md
[AZURE-portal]: https://portal.azure.com
[MSFT-Graph-overview]: https://graph.microsoft.io/en-us/docs/overview/overview
[MSFT-Graph-permision-scopes]: https://graph.microsoft.io/en-us/docs/authorization/permission_scopes

<!--Image references-->
[AAD-Sign-In]: ./media/active-directory-devhowto-multi-tenant-overview/sign-in-with-microsoft-light.png
[Consent-Single-Tier]: ./media/active-directory-devhowto-multi-tenant-overview/consent-flow-single-tier.png
[Consent-Multi-Tier-Known-Client]: ./media/active-directory-devhowto-multi-tenant-overview/consent-flow-multi-tier-known-clients.png
[Consent-Multi-Tier-Multi-Party]: ./media/active-directory-devhowto-multi-tenant-overview/consent-flow-multi-tier-multi-party.png

<!--Reference style links -->
[AAD-App-Manifest]: ./active-directory-application-manifest.md
[AAD-App-SP-Objects]: ./active-directory-application-objects.md
[AAD-Auth-Scenarios]: ./active-directory-authentication-scenarios.md
[AAD-Integrating-Apps]: ./active-directory-integrating-applications.md
[AAD-Dev-Guide]: ./active-directory-developers-guide.md
[AAD-Graph-Perm-Scopes]: https://msdn.microsoft.com/library/azure/ad/graph/howto/azure-ad-graph-api-permission-scopes
[AAD-Graph-App-Entity]: https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#application-entity
[AAD-Graph-Sp-Entity]: https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#serviceprincipal-entity
[AAD-Graph-User-Entity]: https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#user-entity
[AAD-How-To-Integrate]: ./active-directory-how-to-integrate.md
[AAD-Security-Token-Claims]: ./active-directory-authentication-scenarios/#claims-in-azure-ad-security-tokens
[AAD-Tokens-Claims]: ./active-directory-token-and-claims.md
[AAD-V2-Dev-Guide]: ../active-directory-appmodel-v2-overview.md
[AZURE-portal]: https://portal.azure.com
[Duyshant-Role-Blog]: http://www.dushyantgill.com/blog/2014/12/10/roles-based-access-control-in-cloud-applications-using-azure-ad/
[JWT]: https://tools.ietf.org/html/draft-ietf-oauth-json-web-token-32
[O365-Perm-Ref]: https://msdn.microsoft.com/en-us/office/office365/howto/application-manifest
[OAuth2-Access-Token-Scopes]: https://tools.ietf.org/html/rfc6749#section-3.3
[OAuth2-AuthZ-Code-Grant-Flow]: https://msdn.microsoft.com/library/azure/dn645542.aspx
[OAuth2-AuthZ-Grant-Types]: https://tools.ietf.org/html/rfc6749#section-1.3 
[OAuth2-Client-Types]: https://tools.ietf.org/html/rfc6749#section-2.1
[OAuth2-Role-Def]: https://tools.ietf.org/html/rfc6749#page-6
[OpenIDConnect]: http://openid.net/specs/openid-connect-core-1_0.html
[OpenIDConnect-ID-Token]: http://openid.net/specs/openid-connect-core-1_0.html#IDToken














