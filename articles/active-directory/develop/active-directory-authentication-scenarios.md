---
title: "Cenários de autenticação do Azure AD | Microsoft Docs"
description: "Uma visão geral dos cinco cenários mais comuns de autenticação para o Azure Active Directory (AAD)"
services: active-directory
documentationcenter: dev-center-name
author: skwan
manager: mbaldwin
editor: 
ms.assetid: 0c84e7d0-16aa-4897-82f2-f53c6c990fd9
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 04/27/2017
ms.author: skwan
ms.custom: aaddev
ms.openlocfilehash: 2f9410bdaa037f1839cf7c12c3532b51be669ed5
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/18/2017
---
# <a name="authentication-scenarios-for-azure-ad"></a><span data-ttu-id="5ef5c-103">Cenários de autenticação do AD do Azure</span><span class="sxs-lookup"><span data-stu-id="5ef5c-103">Authentication Scenarios for Azure AD</span></span>
<span data-ttu-id="5ef5c-104">O Azure Active Directory (Azure AD) simplifica a autenticação para os desenvolvedores fornecendo identidade como serviço, com suporte para protocolos padrão da indústria, como OAuth 2.0 e OpenID Connect, bem como bibliotecas de código aberto para plataformas diferentes para ajudá-lo a começar a codificar rapidamente.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-104">Azure Active Directory (Azure AD) simplifies authentication for developers by providing identity as a service, with support for industry-standard protocols such as OAuth 2.0 and OpenID Connect, as well as open source libraries for different platforms to help you start coding quickly.</span></span> <span data-ttu-id="5ef5c-105">Este documento ajudará a compreender as vários cenários aos quais o Azure AD oferece suporte e mostrará como começar.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-105">This document will help you understand the various scenarios Azure AD supports and will show you how to get started.</span></span> <span data-ttu-id="5ef5c-106">Ele é dividido nas seguintes seções:</span><span class="sxs-lookup"><span data-stu-id="5ef5c-106">It’s divided into the following sections:</span></span>

* [<span data-ttu-id="5ef5c-107">Noções básicas de autenticação no Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-107">Basics of Authentication in Azure AD</span></span>](#basics-of-authentication-in-azure-ad)
* [<span data-ttu-id="5ef5c-108">Declarações em tokens de segurança do Azure AD</span><span class="sxs-lookup"><span data-stu-id="5ef5c-108">Claims in Azure AD Security Tokens</span></span>](#claims-in-azure-ad-security-tokens)
* [<span data-ttu-id="5ef5c-109">Noções básicas de registrar um aplicativo no Azure AD</span><span class="sxs-lookup"><span data-stu-id="5ef5c-109">Basics of Registering an Application in Azure AD</span></span>](#basics-of-registering-an-application-in-azure-ad)
* [<span data-ttu-id="5ef5c-110">Cenários e tipos de aplicativos</span><span class="sxs-lookup"><span data-stu-id="5ef5c-110">Application Types and Scenarios</span></span>](#application-types-and-scenarios)
  
  * [<span data-ttu-id="5ef5c-111">Navegador da Web para o aplicativo Web</span><span class="sxs-lookup"><span data-stu-id="5ef5c-111">Web Browser to Web Application</span></span>](#web-browser-to-web-application)
  * [<span data-ttu-id="5ef5c-112">SPA (Aplicativo de Página Única)</span><span class="sxs-lookup"><span data-stu-id="5ef5c-112">Single Page Application (SPA)</span></span>](#single-page-application-spa)
  * [<span data-ttu-id="5ef5c-113">Aplicativo nativo para API da Web</span><span class="sxs-lookup"><span data-stu-id="5ef5c-113">Native Application to Web API</span></span>](#native-application-to-web-api)
  * [<span data-ttu-id="5ef5c-114">Aplicativo Web para API da Web</span><span class="sxs-lookup"><span data-stu-id="5ef5c-114">Web Application to Web API</span></span>](#web-application-to-web-api)
  * [<span data-ttu-id="5ef5c-115">Servidor ou aplicativo Daemon para API da Web</span><span class="sxs-lookup"><span data-stu-id="5ef5c-115">Daemon or Server Application to Web API</span></span>](#daemon-or-server-application-to-web-api)

## <a name="basics-of-authentication-in-azure-ad"></a><span data-ttu-id="5ef5c-116">Noções básicas de autenticação no Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-116">Basics of Authentication in Azure AD</span></span>
<span data-ttu-id="5ef5c-117">Se você não estiver familiarizado com os conceitos básicos de autenticação no Azure AD, leia esta seção.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-117">If you are unfamiliar with basic concepts of authentication in Azure AD, read this section.</span></span> <span data-ttu-id="5ef5c-118">Caso contrário, convém pular para [Cenários e tipos de aplicativos](#application-types-and-scenarios).</span><span class="sxs-lookup"><span data-stu-id="5ef5c-118">Otherwise, you may want to skip down to [Application Types and Scenarios](#application-types-and-scenarios).</span></span>

<span data-ttu-id="5ef5c-119">Vamos considerar o cenário mais básico, em que a identidade é necessária: um usuário em um navegador da Web precisa autenticar um aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-119">Let’s consider the most basic scenario where identity is required: a user in a web browser needs to authenticate to a web application.</span></span> <span data-ttu-id="5ef5c-120">Esse cenário é descrito mais detalhadamente na seção [Navegador da Web para o aplicativo Web](#web-browser-to-web-application) , no entanto, é útil, como um ponto de partida, ilustrar os recursos do Azure AD e conceitualizar como o cenário funciona.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-120">This scenario is described in greater detail in the [Web Browser to Web Application](#web-browser-to-web-application) section, but it’s a useful starting point to illustrate the capabilities of Azure AD and conceptualize how the scenario works.</span></span> <span data-ttu-id="5ef5c-121">Considere o diagrama a seguir para esse cenário:</span><span class="sxs-lookup"><span data-stu-id="5ef5c-121">Consider the following diagram for this scenario:</span></span>

![Visão geral de logon no aplicativo Web](./media/active-directory-authentication-scenarios/basics_of_auth_in_aad.png)

<span data-ttu-id="5ef5c-123">Com o diagrama acima em mente, aqui está o que você precisa saber sobre seus vários componentes:</span><span class="sxs-lookup"><span data-stu-id="5ef5c-123">With the diagram above in mind, here’s what you need to know about its various components:</span></span>

* <span data-ttu-id="5ef5c-124">O Azure AD é o provedor de identidade, responsável por verificar a identidade dos usuários e aplicativos existentes no diretório de uma organização e, por fim, emitir tokens de segurança após a autenticação bem-sucedida desses usuários e aplicativos.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-124">Azure AD is the identity provider, responsible for verifying the identity of users and applications that exist in an organization’s directory, and ultimately issuing security tokens upon successful authentication of those users and applications.</span></span>
* <span data-ttu-id="5ef5c-125">Um aplicativo que deseja terceirizar a autenticação para o Azure AD deve ser registrado no Azure AD, que registra e identifica exclusivamente o aplicativo no diretório.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-125">An application that wants to outsource authentication to Azure AD must be registered in Azure AD, which registers and uniquely identifies the app in the directory.</span></span>
* <span data-ttu-id="5ef5c-126">Os desenvolvedores podem usar as bibliotecas de autenticação de código aberto do Azure AD para facilitar a autenticação, manipulando os detalhes de protocolo por você.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-126">Developers can use the open source Azure AD authentication libraries to make authentication easy by handling the protocol details for you.</span></span> <span data-ttu-id="5ef5c-127">Consulte [Bibliotecas de autenticação do Azure Active Directory](active-directory-authentication-libraries.md) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-127">See [Azure Active Directory Authentication Libraries](active-directory-authentication-libraries.md) for more information.</span></span>

<span data-ttu-id="5ef5c-128">• Depois que um usuário foi autenticado, o aplicativo deve validar o token de segurança do usuário para garantir que a autenticação tenha sido bem-sucedida para as partes planejadas.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-128">• Once a user has been authenticated, the application must validate the user’s security token to ensure that authentication was successful for the intended parties.</span></span> <span data-ttu-id="5ef5c-129">Os desenvolvedores podem usar as bibliotecas de autenticação fornecidas para manipular a validação de qualquer token do Azure AD, incluindo o JSON Web Tokens (JWT) ou SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-129">Developers can use the provided authentication libraries to handle validation of any token from Azure AD, including JSON Web Tokens (JWT) or SAML 2.0.</span></span> <span data-ttu-id="5ef5c-130">Se você quiser executar a validação manualmente, veja a documentação [Manipulador de token JWT](https://msdn.microsoft.com/library/dn205065.aspx) .</span><span class="sxs-lookup"><span data-stu-id="5ef5c-130">If you want to perform validation manually, see the [JWT Token Handler](https://msdn.microsoft.com/library/dn205065.aspx) documentation.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="5ef5c-131">O Azure AD usa criptografia de chave pública para assinar tokens e verificar se eles são válidos.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-131">Azure AD uses public key cryptography to sign tokens and verify that they are valid.</span></span> <span data-ttu-id="5ef5c-132">Consulte [Informações importantes sobre substituição de chave de assinatura no Azure AD](active-directory-signing-key-rollover.md) para obter mais informações sobre a lógica necessária que você deve ter em seu aplicativo para garantir que ele esteja sempre atualizado com as últimas chaves.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-132">See [Important Information About Signing Key Rollover in Azure AD](active-directory-signing-key-rollover.md) for more information on the necessary logic you must have in your application to ensure it’s always updated with the latest keys.</span></span>
> 
> 

<span data-ttu-id="5ef5c-133">• O fluxo de solicitações e respostas para o processo de autenticação é determinado pelo protocolo de autenticação que foi usado, como OAuth 2.0, OpenID Connect, WS-Federation ou SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-133">• The flow of requests and responses for the authentication process is determined by the authentication protocol that was used, such as OAuth 2.0, OpenID Connect, WS-Federation, or SAML 2.0.</span></span> <span data-ttu-id="5ef5c-134">Esses protocolos são discutidos em mais detalhes no tópico [Protocolos de autenticação do Azure Active Directory](active-directory-authentication-protocols.md) e nas seções a seguir.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-134">These protocols are discussed in more detail in the [Azure Active Directory Authentication Protocols](active-directory-authentication-protocols.md) topic and in the sections below.</span></span>

> [!NOTE]
> <span data-ttu-id="5ef5c-135">O Azure AD oferece suporte aos padrões OAuth 2.0 e OpenID Connect que fazem uso extensivo de tokens de portador, incluindo tokens de portador representados como JWTs.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-135">Azure AD supports the OAuth 2.0 and OpenID Connect standards that make extensive use of bearer tokens, including bearer tokens represented as JWTs.</span></span> <span data-ttu-id="5ef5c-136">Um token de portador é um token de segurança leve que concede ao "portador" acesso a um recurso protegido.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-136">A bearer token is a lightweight security token that grants the “bearer” access to a protected resource.</span></span> <span data-ttu-id="5ef5c-137">Nesse sentido, o "portador" é qualquer parte que possa apresentar o token.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-137">In this sense, the “bearer” is any party that can present the token.</span></span> <span data-ttu-id="5ef5c-138">Embora uma parte deva primeiro se autenticar no Azure AD para receber o token de portador, se as medidas necessárias não forem tomadas para proteger o token durante a transmissão e o armazenamento, ele pode ser interceptado e usado por uma parte não planejada.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-138">Though a party must first authenticate with Azure AD to receive the bearer token, if the required steps are not taken to secure the token in transmission and storage, it can be intercepted and used by an unintended party.</span></span> <span data-ttu-id="5ef5c-139">Embora alguns tokens de segurança tenham um mecanismo interno para impedir que partes não autorizadas os utilizem, tokens de portador não possuem esse mecanismo e devem ser transportados em um canal seguro, como segurança da camada de transporte (HTTPS).</span><span class="sxs-lookup"><span data-stu-id="5ef5c-139">While some security tokens have a built-in mechanism for preventing unauthorized parties from using them, bearer tokens do not have this mechanism and must be transported in a secure channel such as transport layer security (HTTPS).</span></span> <span data-ttu-id="5ef5c-140">Se um token de portador for transmitido livremente, um ataque por parte de intermediários pode ser usado por uma parte mal-intencionada para adquirir o token e usá-lo para um acesso não autorizado a um recurso protegido.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-140">If a bearer token is transmitted in the clear, a man-in the middle attack can be used by a malicious party to acquire the token and use it for an unauthorized access to a protected resource.</span></span> <span data-ttu-id="5ef5c-141">Os mesmos princípios de segurança se aplicam ao armazenar ou manter em cache tokens de portador para uso posterior.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-141">The same security principles apply when storing or caching bearer tokens for later use.</span></span> <span data-ttu-id="5ef5c-142">Sempre certifique-se de que seu aplicativo transmita e armazene tokens de portador de maneira segura.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-142">Always ensure that your application transmits and stores bearer tokens in a secure manner.</span></span> <span data-ttu-id="5ef5c-143">Para obter mais considerações de segurança sobre tokens de portador, consulte [RFC 6750 seção 5](http://tools.ietf.org/html/rfc6750).</span><span class="sxs-lookup"><span data-stu-id="5ef5c-143">For more security considerations on bearer tokens, see [RFC 6750 Section 5](http://tools.ietf.org/html/rfc6750).</span></span>
> 
> 

<span data-ttu-id="5ef5c-144">Agora que você tem uma visão geral dos conceitos básicos, leia as seções a seguir para entender como funciona o provisionamento no Azure AD e os cenários comuns aos quais o Azure AD oferece suporte.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-144">Now that you have an overview of the basics, read the sections below to understand how provisioning works in Azure AD and the common scenarios Azure AD supports.</span></span>

## <a name="claims-in-azure-ad-security-tokens"></a><span data-ttu-id="5ef5c-145">Declarações em tokens de segurança do Azure AD</span><span class="sxs-lookup"><span data-stu-id="5ef5c-145">Claims in Azure AD Security Tokens</span></span>
<span data-ttu-id="5ef5c-146">Tokens de segurança emitidos pelo Azure AD contêm declarações ou asserções de informações sobre a entidade que foi autenticada.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-146">Security tokens issued by Azure AD contain claims, or assertions of information about the subject that has been authenticated.</span></span> <span data-ttu-id="5ef5c-147">Essas declarações podem ser usadas pelo aplicativo para várias tarefas.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-147">These claims can be used by the application for various tasks.</span></span> <span data-ttu-id="5ef5c-148">Por exemplo, elas podem ser usadas para validar o token, identificar o locatário de diretório da entidade, exibir informações do usuário, determinar a autorização da entidade e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-148">For example, they can be used to validate the token, identify the subject's directory tenant, display user information, determine the subject's authorization, and so on.</span></span> <span data-ttu-id="5ef5c-149">As declarações presentes em qualquer token de segurança variam de acordo com o tipo de token, o tipo de credencial usada para autenticar o usuário e a configuração do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-149">The claims present in any given security token are dependent upon the type of token, the type of credential used to authenticate the user, and the application configuration.</span></span> <span data-ttu-id="5ef5c-150">Uma breve descrição de cada tipo de declaração emitida pelo Azure AD é fornecida na tabela a seguir.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-150">A brief description of each type of claim emitted by Azure AD is provided in the table below.</span></span> <span data-ttu-id="5ef5c-151">Para obter mais informações, consulte [Tipos de token e de declaração suportados](active-directory-token-and-claims.md).</span><span class="sxs-lookup"><span data-stu-id="5ef5c-151">For more information, refer to [Supported Token and Claim Types](active-directory-token-and-claims.md).</span></span>

| <span data-ttu-id="5ef5c-152">Declaração</span><span class="sxs-lookup"><span data-stu-id="5ef5c-152">Claim</span></span> | <span data-ttu-id="5ef5c-153">Descrição</span><span class="sxs-lookup"><span data-stu-id="5ef5c-153">Description</span></span> |
| --- | --- |
| <span data-ttu-id="5ef5c-154">ID do aplicativo</span><span class="sxs-lookup"><span data-stu-id="5ef5c-154">Application ID</span></span> |<span data-ttu-id="5ef5c-155">Identifica o aplicativo que está usando o token.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-155">Identifies the application that is using the token.</span></span> |
| <span data-ttu-id="5ef5c-156">Público-alvo</span><span class="sxs-lookup"><span data-stu-id="5ef5c-156">Audience</span></span> |<span data-ttu-id="5ef5c-157">Identifica o recurso de destinatário ao qual o token é destinado.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-157">Identifies the recipient resource the token is intended for.</span></span> |
| <span data-ttu-id="5ef5c-158">Referência de classe de contexto de autenticação de aplicativo</span><span class="sxs-lookup"><span data-stu-id="5ef5c-158">Application Authentication Context Class Reference</span></span> |<span data-ttu-id="5ef5c-159">Indica como o cliente foi autenticado (cliente público versus cliente confidencial).</span><span class="sxs-lookup"><span data-stu-id="5ef5c-159">Indicates how the client was authenticated (public client vs. confidential client).</span></span> |
| <span data-ttu-id="5ef5c-160">Instante da autenticação</span><span class="sxs-lookup"><span data-stu-id="5ef5c-160">Authentication Instant</span></span> |<span data-ttu-id="5ef5c-161">Registra a data e o horário em que ocorreu a autenticação.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-161">Records the date and time when the authentication occurred.</span></span> |
| <span data-ttu-id="5ef5c-162">Método de autenticação</span><span class="sxs-lookup"><span data-stu-id="5ef5c-162">Authentication Method</span></span> |<span data-ttu-id="5ef5c-163">Indica como a entidade do token foi autenticada (senha, certificado, etc.).</span><span class="sxs-lookup"><span data-stu-id="5ef5c-163">Indicates how the subject of the token was authenticated (password, certificate, etc.).</span></span> |
| <span data-ttu-id="5ef5c-164">Nome</span><span class="sxs-lookup"><span data-stu-id="5ef5c-164">First Name</span></span> |<span data-ttu-id="5ef5c-165">Apresenta o nome fornecido do usuário conforme definido no Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-165">Provides the given name of the user as set in Azure AD.</span></span> |
| <span data-ttu-id="5ef5c-166">Grupos</span><span class="sxs-lookup"><span data-stu-id="5ef5c-166">Groups</span></span> |<span data-ttu-id="5ef5c-167">Contém as IDs de objeto dos grupos em que o usuário é membro.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-167">Contains object Ids of Azure AD groups the user is a member of.</span></span> |
| <span data-ttu-id="5ef5c-168">Provedor de identidade</span><span class="sxs-lookup"><span data-stu-id="5ef5c-168">Identity Provider</span></span> |<span data-ttu-id="5ef5c-169">Registra o provedor de identidade que autenticou a entidade do token.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-169">Records the identity provider that authenticated the subject of the token.</span></span> |
| <span data-ttu-id="5ef5c-170">Emitido em</span><span class="sxs-lookup"><span data-stu-id="5ef5c-170">Issued At</span></span> |<span data-ttu-id="5ef5c-171">Registra o horário em que o token foi emitido, geralmente usado para atualização de token.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-171">Records the time at which the token was issued, often used for token freshness.</span></span> |
| <span data-ttu-id="5ef5c-172">Emissor</span><span class="sxs-lookup"><span data-stu-id="5ef5c-172">Issuer</span></span> |<span data-ttu-id="5ef5c-173">Identifica o STS que emitiu o token, bem como o locatário do Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-173">Identifies the STS that emitted the token as well as the Azure AD tenant.</span></span> |
| <span data-ttu-id="5ef5c-174">Sobrenome</span><span class="sxs-lookup"><span data-stu-id="5ef5c-174">Last Name</span></span> |<span data-ttu-id="5ef5c-175">Apresenta o sobrenome fornecido do usuário conforme definido no Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-175">Provides the surname of the user as set in Azure AD.</span></span> |
| <span data-ttu-id="5ef5c-176">Nome</span><span class="sxs-lookup"><span data-stu-id="5ef5c-176">Name</span></span> |<span data-ttu-id="5ef5c-177">Fornece um valor legível que identifica a entidade do token.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-177">Provides a human readable value that identifies the subject of the token.</span></span> |
| <span data-ttu-id="5ef5c-178">ID do objeto</span><span class="sxs-lookup"><span data-stu-id="5ef5c-178">Object Id</span></span> |<span data-ttu-id="5ef5c-179">Contém um identificador exclusivo e imutável da entidade no Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-179">Contains an immutable, unique identifier of the subject in Azure AD.</span></span> |
| <span data-ttu-id="5ef5c-180">Funções</span><span class="sxs-lookup"><span data-stu-id="5ef5c-180">Roles</span></span> |<span data-ttu-id="5ef5c-181">Contém os nomes amigáveis de funções de aplicativo do Azure AD que o usuário recebeu.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-181">Contains friendly names of Azure AD Application Roles that the user has been granted.</span></span> |
| <span data-ttu-id="5ef5c-182">Escopo</span><span class="sxs-lookup"><span data-stu-id="5ef5c-182">Scope</span></span> |<span data-ttu-id="5ef5c-183">Indica as permissões concedidas ao aplicativo cliente.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-183">Indicates the permissions granted to the client application.</span></span> |
| <span data-ttu-id="5ef5c-184">Subject</span><span class="sxs-lookup"><span data-stu-id="5ef5c-184">Subject</span></span> |<span data-ttu-id="5ef5c-185">Indica a entidade de segurança sobre a qual o token declara informações.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-185">Indicates the principal about which the token asserts information.</span></span> |
| <span data-ttu-id="5ef5c-186">ID do locatário</span><span class="sxs-lookup"><span data-stu-id="5ef5c-186">Tenant Id</span></span> |<span data-ttu-id="5ef5c-187">Contém um identificador exclusivo e imutável do locatário do diretório que emitiu o token.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-187">Contains an immutable, unique identifier of the directory tenant that issued the token.</span></span> |
| <span data-ttu-id="5ef5c-188">Vida útil do token</span><span class="sxs-lookup"><span data-stu-id="5ef5c-188">Token Lifetime</span></span> |<span data-ttu-id="5ef5c-189">Define o intervalo de tempo no qual um token é válido.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-189">Defines the time interval within which a token is valid.</span></span> |
| <span data-ttu-id="5ef5c-190">Nome principal do usuário</span><span class="sxs-lookup"><span data-stu-id="5ef5c-190">User Principal Name</span></span> |<span data-ttu-id="5ef5c-191">Contém o nome principal de usuário da entidade.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-191">Contains the user principal name of the subject.</span></span> |
| <span data-ttu-id="5ef5c-192">Versão</span><span class="sxs-lookup"><span data-stu-id="5ef5c-192">Version</span></span> |<span data-ttu-id="5ef5c-193">Contém o número de versão do token.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-193">Contains the version number of the token.</span></span> |

## <a name="basics-of-registering-an-application-in-azure-ad"></a><span data-ttu-id="5ef5c-194">Noções básicas de registrar um aplicativo no Azure AD</span><span class="sxs-lookup"><span data-stu-id="5ef5c-194">Basics of Registering an Application in Azure AD</span></span>
<span data-ttu-id="5ef5c-195">Qualquer aplicativo que terceirize a autenticação ao Azure AD deve ser registrado em um diretório.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-195">Any application that outsources authentication to Azure AD must be registered in a directory.</span></span> <span data-ttu-id="5ef5c-196">Esta etapa envolve comunicar o Azure AD sobre seu aplicativo, incluindo a URL da sua localização, a URL para enviar respostas após a autenticação, o URI para identificar seu aplicativo e mais.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-196">This step involves telling Azure AD about your application, including the URL where it’s located, the URL to send replies after authentication, the URI to identify your application, and more.</span></span> <span data-ttu-id="5ef5c-197">Essas informações são necessárias por alguns motivos:</span><span class="sxs-lookup"><span data-stu-id="5ef5c-197">This information is required for a few key reasons:</span></span>

* <span data-ttu-id="5ef5c-198">O Azure AD precisa de coordenadas para se comunicar com o aplicativo ao lidar com tokens de logon ou troca.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-198">Azure AD needs coordinates to communicate with the application when handling sign-on or exchanging tokens.</span></span> <span data-ttu-id="5ef5c-199">Elas incluem as seguintes:</span><span class="sxs-lookup"><span data-stu-id="5ef5c-199">These include the following:</span></span>
  
  * <span data-ttu-id="5ef5c-200">URI de ID do aplicativo: O identificador de um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-200">Application ID URI: The identifier for an application.</span></span> <span data-ttu-id="5ef5c-201">Esse valor é enviado ao Azure AD durante a autenticação para indicar para qual aplicativo o chamador deseja ter um token.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-201">This value is sent to Azure AD during authentication to indicate which application the caller wants a token for.</span></span> <span data-ttu-id="5ef5c-202">Além disso, esse valor é incluído no token para que o aplicativo saiba que ele era o destino pretendido.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-202">Additionally, this value is included in the token so that the application knows it was the intended target.</span></span>
  * <span data-ttu-id="5ef5c-203">URL de resposta e URI de redirecionamento: no caso de uma API da Web ou aplicativo Web, a URL de resposta é o local ao qual o Azure AD enviará a resposta de autenticação, incluindo um token caso a autenticação seja bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-203">Reply URL and Redirect URI: In the case of a web API or web application, the Reply URL is the location to which Azure AD will send the authentication response, including a token if authentication was successful.</span></span> <span data-ttu-id="5ef5c-204">No caso de um aplicativo nativo, o URI de redirecionamento é um identificador exclusivo para o qual o Azure AD redirecionará o usuário-agente em uma solicitação do OAuth 2.0.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-204">In the case of a native application, the Redirect URI is a unique identifier to which Azure AD will redirect the user-agent in an OAuth 2.0 request.</span></span>
  * <span data-ttu-id="5ef5c-205">ID do Aplicativo: a ID de um aplicativo, que é gerada pelo Azure AD quando o aplicativo é registrado.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-205">Application ID: The ID for an application, which is generated by Azure AD when the application is registered.</span></span> <span data-ttu-id="5ef5c-206">Ao solicitar um código de autorização ou token, a ID do Aplicativo e a chave são enviadas ao Azure AD durante a autenticação.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-206">When requesting an authorization code or token, the Application ID and key are sent to Azure AD during authentication.</span></span>
  * <span data-ttu-id="5ef5c-207">Chave: a chave enviada com uma ID de Aplicativo durante a autenticação no Azure AD para chamar uma API da Web.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-207">Key: The key that is sent along with a Application ID when authenticating to Azure AD to call a web API.</span></span>
* <span data-ttu-id="5ef5c-208">O Azure AD precisa garantir que o aplicativo tem as permissões necessárias para acessar os dados do diretório, outros aplicativos em sua organização e assim por diante</span><span class="sxs-lookup"><span data-stu-id="5ef5c-208">Azure AD needs to ensure the application has the required permissions to access your directory data, other applications in your organization, and so on</span></span>

<span data-ttu-id="5ef5c-209">O provisionamento fica mais claro quando você entende que há duas categorias de aplicativos que podem ser desenvolvidos e integrados no Azure AD:</span><span class="sxs-lookup"><span data-stu-id="5ef5c-209">Provisioning becomes clearer when you understand that there are two categories of applications that can be developed and integrated with Azure AD:</span></span>

* <span data-ttu-id="5ef5c-210">Aplicativo de locatário único: um aplicativo de locatário único destina-se ao uso em uma organização.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-210">Single tenant application: A single tenant application is intended for use in one organization.</span></span> <span data-ttu-id="5ef5c-211">Eles normalmente são aplicativos de linha de negócios (LoB) escritos por um desenvolvedor empresarial.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-211">These are typically line-of-business (LoB) applications written by an enterprise developer.</span></span> <span data-ttu-id="5ef5c-212">Um aplicativo de locatário único só precisa ser acessado por usuários em um diretório e, como resultado, ele só precisa ser provisionado em um diretório.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-212">A single tenant application only needs to be accessed by users in one directory, and as a result, it only needs to be provisioned in one directory.</span></span> <span data-ttu-id="5ef5c-213">Esses aplicativos geralmente são registrados por um desenvolvedor na organização.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-213">These applications are typically registered by a developer in the organization.</span></span>
* <span data-ttu-id="5ef5c-214">Aplicativos multilocatários: um aplicativo multilocatário é destinado para uso em muitas organizações, não apenas em uma organização.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-214">Multi-tenant application: A multi-tenant application is intended for use in many organizations, not just one organization.</span></span> <span data-ttu-id="5ef5c-215">Esses são normalmente aplicativos de software como serviço (SaaS) escritos por um fornecedor de software independente (ISV).</span><span class="sxs-lookup"><span data-stu-id="5ef5c-215">These are typically software-as-a-service (SaaS) applications written by an independent software vendor (ISV).</span></span> <span data-ttu-id="5ef5c-216">Aplicativos multilocatários precisam ser provisionados em cada diretório em que serão usados, o que requer o consentimento do usuário ou administrador para registrá-los.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-216">Multi-tenant applications need to be provisioned in each directory where they will be used, which requires user or administrator consent to register them.</span></span> <span data-ttu-id="5ef5c-217">Esse processo de consentimento é iniciado quando um aplicativo tiver sido registrado no diretório e receber acesso à Graph API ou talvez a outra API da Web.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-217">This consent process starts when an application has been registered in the directory and is given access to the Graph API or perhaps another web API.</span></span> <span data-ttu-id="5ef5c-218">Quando um usuário ou administrador de uma organização diferente se inscreve para usar o aplicativo, é apresentada uma caixa de diálogo que exibe as permissões exigidas pelo aplicativo.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-218">When a user or administrator from a different organization signs up to use the application, they are presented with a dialog that displays the permissions the application requires.</span></span> <span data-ttu-id="5ef5c-219">O usuário ou administrador pode então dar consentimento para o aplicativo, que fornece ao aplicativo acesso aos dados declarados e, por fim, registra o aplicativo em seu diretório.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-219">The user or administrator can then consent to the application, which gives the application access to the stated data, and finally registers the application in their directory.</span></span> <span data-ttu-id="5ef5c-220">Para obter mais informações, consulte [Visão geral da estrutura de consentimento](active-directory-integrating-applications.md#overview-of-the-consent-framework).</span><span class="sxs-lookup"><span data-stu-id="5ef5c-220">For more information, see [Overview of the Consent Framework](active-directory-integrating-applications.md#overview-of-the-consent-framework).</span></span>

<span data-ttu-id="5ef5c-221">Surgem algumas considerações adicionais ao desenvolver um aplicativo multilocatário em vez de um aplicativo de locatário único.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-221">Some additional considerations arise when developing a multi-tenant application instead of a single tenant application.</span></span> <span data-ttu-id="5ef5c-222">Por exemplo, se você estiver disponibilizando seu aplicativo a usuários em vários diretórios, você precisa de um mecanismo para determinar em qual locatário eles estão.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-222">For example, if you are making your application available to users in multiple directories, you need a mechanism to determine which tenant they’re in.</span></span> <span data-ttu-id="5ef5c-223">Um aplicativo de locatário único só precisa procurar em seu próprio diretório por um usuário, enquanto que um aplicativo multilocatário precisa identificar um usuário específico em todos os diretórios no Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-223">A single tenant application only needs to look in its own directory for a user, while a multi-tenant application needs to identify a specific user from all the directories in Azure AD.</span></span> <span data-ttu-id="5ef5c-224">Para realizar essa tarefa, o Azure AD fornece um ponto de extremidade de autenticação comum em que qualquer aplicativo multilocatário pode direcionar solicitações de entrada, em vez de um ponto de extremidade específico de locatário.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-224">To accomplish this task, Azure AD provides a common authentication endpoint where any multi-tenant application can direct sign-in requests, instead of a tenant-specific endpoint.</span></span> <span data-ttu-id="5ef5c-225">Esse ponto de extremidade é https://login.microsoftonline.com/common para todos os diretórios no Azure AD, ao passo que um ponto de extremidade específico do locatário pode ser https://login.microsoftonline.com/contoso.onmicrosoft.com. O ponto de extremidade comum deve ser considerado com especial importância ao desenvolver seu aplicativo, pois você precisará da lógica necessária para lidar com vários locatários durante o login, logout e validação de token.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-225">This endpoint is https://login.microsoftonline.com/common for all directories in Azure AD, whereas a tenant-specific endpoint might be https://login.microsoftonline.com/contoso.onmicrosoft.com. The common endpoint is especially important to consider when developing your application because you’ll need the necessary logic to handle multiple tenants during sign-in, sign-out, and token validation.</span></span>

<span data-ttu-id="5ef5c-226">Se você está desenvolvendo atualmente um aplicativo de locatário único, mas deseja disponibilizá-lo para muitas organizações, você pode facilmente fazer alterações no aplicativo e em sua configuração no Azure AD para habilitá-lo a multilocatários.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-226">If you are currently developing a single tenant application but want to make it available to many organizations, you can easily make changes to the application and its configuration in Azure AD to make it multi-tenant capable.</span></span> <span data-ttu-id="5ef5c-227">Além disso, o Azure AD usa a mesma chave de assinatura para todos os tokens em todos os diretórios, independentemente de você estar fornecendo autenticação em um aplicativo de locatário único ou multilocatário.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-227">In addition, Azure AD uses the same signing key for all tokens in all directories, whether you are providing authentication in a single tenant or multi-tenant application.</span></span>

<span data-ttu-id="5ef5c-228">Cada cenário listado neste documento inclui uma subseção que descreve seus requisitos de provisionamento.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-228">Each scenario listed in this document includes a sub-section that describes its provisioning requirements.</span></span> <span data-ttu-id="5ef5c-229">Para obter informações mais detalhadas sobre o provisionamento de um aplicativo no AD do Azure e sobre as diferenças entre aplicativos de locatário único e multilocatário, confira [Integrando aplicativos com o Active Directory do Azure](active-directory-integrating-applications.md) .</span><span class="sxs-lookup"><span data-stu-id="5ef5c-229">For more in-depth information about provisioning an application in Azure AD and the differences between single and multi-tenant applications, see [Integrating Applications with Azure Active Directory](active-directory-integrating-applications.md) for more information.</span></span> <span data-ttu-id="5ef5c-230">Continue lendo para entender os cenários comuns de aplicativos no Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-230">Continue reading to understand the common application scenarios in Azure AD.</span></span>

## <a name="application-types-and-scenarios"></a><span data-ttu-id="5ef5c-231">Cenários e tipos de aplicativos</span><span class="sxs-lookup"><span data-stu-id="5ef5c-231">Application Types and Scenarios</span></span>
<span data-ttu-id="5ef5c-232">Cada um dos cenários descritos neste documento pode ser desenvolvido usando várias linguagens e plataformas.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-232">Each of the scenarios described in this document can be developed using various languages and platforms.</span></span> <span data-ttu-id="5ef5c-233">Todos eles contam com exemplos de código completos que estão disponíveis em nosso [guia Exemplos de Código](active-directory-code-samples.md) ou diretamente nos [repositórios de exemplo do GitHub](https://github.com/Azure-Samples?utf8=%E2%9C%93&query=active-directory) correspondentes.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-233">They are all backed by complete code samples which are available in our [Code Samples guide](active-directory-code-samples.md), or directly from the corresponding [GitHub sample repositories](https://github.com/Azure-Samples?utf8=%E2%9C%93&query=active-directory).</span></span> <span data-ttu-id="5ef5c-234">Além disso, se seu aplicativo precisar de uma parte ou segmento específico de um cenário de ponta a ponta, na maioria dos casos, essa funcionalidade pode ser adicionada independentemente.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-234">In addition, if your application needs a specific piece or segment of an end-to-end scenario, in most cases that functionality can be added independently.</span></span> <span data-ttu-id="5ef5c-235">Por exemplo, se você tiver um aplicativo nativo que chama uma API da Web, você pode adicionar facilmente um aplicativo Web que também chama a API da Web.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-235">For example, if you have a native application that calls a web API, you can easily add a web application that also calls the web API.</span></span> <span data-ttu-id="5ef5c-236">O diagrama a seguir ilustra esses cenários e tipos de aplicativos e como os diferentes componentes podem ser adicionados:</span><span class="sxs-lookup"><span data-stu-id="5ef5c-236">The following diagram illustrates these scenarios and application types, and how different components can be added:</span></span>

![Cenários e tipos de aplicativos](./media/active-directory-authentication-scenarios/application_types_and_scenarios.png)

<span data-ttu-id="5ef5c-238">Estes são os cinco cenários de aplicativo principais suportados pelo Azure AD:</span><span class="sxs-lookup"><span data-stu-id="5ef5c-238">These are the five primary application scenarios supported by Azure AD:</span></span>

* <span data-ttu-id="5ef5c-239">[Navegador da Web para aplicativo Web](#web-browser-to-web-application): um usuário precisa entrar em um aplicativo Web protegido pelo Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-239">[Web Browser to Web Application](#web-browser-to-web-application): A user needs to sign in to a web application that is secured by Azure AD.</span></span>
* <span data-ttu-id="5ef5c-240">[SPA (Aplicativo de Página Única)](#single-page-application-spa): um usuário precisa entrar em um aplicativo de página única protegida pelo Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-240">[Single Page Application (SPA)](#single-page-application-spa): A user needs to sign in to a single page application that is secured by Azure AD.</span></span>
* <span data-ttu-id="5ef5c-241">[Aplicativo nativo para API da Web](#native-application-to-web-api): um aplicativo nativo que é executado em um telefone, tablet ou PC precisa autenticar um usuário para obter recursos de uma API da Web que é protegida pelo Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-241">[Native Application to Web API](#native-application-to-web-api): A native application that runs on a phone, tablet, or PC needs to authenticate a user to get resources from a web API that is secured by Azure AD.</span></span>
* <span data-ttu-id="5ef5c-242">[Aplicativo Web para API da Web](#web-application-to-web-api): um aplicativo Web precisa obter recursos de uma API da Web protegida pelo Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-242">[Web Application to Web API](#web-application-to-web-api): A web application needs to get resources from a web API secured by Azure AD.</span></span>
* <span data-ttu-id="5ef5c-243">[Aplicativo daemon ou de servidor para API da Web](#daemon-or-server-application-to-web-api): um aplicativo daemon ou um aplicativo de servidor sem interface do usuário da Web precisa obter recursos de uma API da Web protegida pelo Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-243">[Daemon or Server Application to Web API](#daemon-or-server-application-to-web-api): A daemon application or a server application with no web user interface needs to get resources from a web API secured by Azure AD.</span></span>

### <a name="web-browser-to-web-application"></a><span data-ttu-id="5ef5c-244">Navegador da Web para o aplicativo Web</span><span class="sxs-lookup"><span data-stu-id="5ef5c-244">Web Browser to Web Application</span></span>
<span data-ttu-id="5ef5c-245">Esta seção descreve um aplicativo que autentica um usuário em um navegador da Web para um aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-245">This section describes an application that authenticates a user in a web browser to a web application.</span></span> <span data-ttu-id="5ef5c-246">Nesse cenário, o aplicativo Web direciona o navegador do usuário para que ele entre no Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-246">In this scenario, the web application directs the user’s browser to sign them in to Azure AD.</span></span> <span data-ttu-id="5ef5c-247">O Azure AD retorna uma resposta de logon por meio do navegador do usuário, que contém declarações sobre o usuário em um token de segurança.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-247">Azure AD returns a sign-in response through the user’s browser, which contains claims about the user in a security token.</span></span> <span data-ttu-id="5ef5c-248">Este cenário oferece suporte ao logon usando os protocolos WS-Federation, SAML 2.0 e OpenID Connect.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-248">This scenario supports sign-on using the WS-Federation, SAML 2.0, and OpenID Connect protocols.</span></span>

#### <a name="diagram"></a><span data-ttu-id="5ef5c-249">Diagrama</span><span class="sxs-lookup"><span data-stu-id="5ef5c-249">Diagram</span></span>
![Fluxo de autenticação do navegador para aplicativo Web](./media/active-directory-authentication-scenarios/web_browser_to_web_api.png)

#### <a name="description-of-protocol-flow"></a><span data-ttu-id="5ef5c-251">Descrição do fluxo de protocolo</span><span class="sxs-lookup"><span data-stu-id="5ef5c-251">Description of Protocol Flow</span></span>
1. <span data-ttu-id="5ef5c-252">Quando um usuário visita o aplicativo e precisa fazer logon, eles são redirecionados por meio de uma solicitação de logon para o ponto de extremidade de autenticação no Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-252">When a user visits the application and needs to sign in, they are redirected via a sign-in request to the authentication endpoint in Azure AD.</span></span>
2. <span data-ttu-id="5ef5c-253">O usuário faz logon na página de logon.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-253">The user signs in on the sign-in page.</span></span>
3. <span data-ttu-id="5ef5c-254">Se a autenticação for bem-sucedida, o Azure AD criará um token de autenticação e retornará uma resposta de conexão para a URL de Resposta do aplicativo que foi configurada no Portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-254">If authentication is successful, Azure AD creates an authentication token and returns a sign-in response to the application’s Reply URL that was configured in the Azure Portal.</span></span> <span data-ttu-id="5ef5c-255">Para um aplicativo de produção, essa URL de resposta deve ser HTTPS.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-255">For a production application, this Reply URL should be HTTPS.</span></span> <span data-ttu-id="5ef5c-256">O token retornado inclui declarações sobre o usuário e o Azure AD que são exigidas pelo aplicativo para validar o token.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-256">The returned token includes claims about the user and Azure AD that are required by the application to validate the token.</span></span>
4. <span data-ttu-id="5ef5c-257">O aplicativo valida o token usando uma chave de assinatura pública e informações do emissor disponíveis no documento de metadados de federação para o Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-257">The application validates the token by using a public signing key and issuer information available at the federation metadata document for Azure AD.</span></span> <span data-ttu-id="5ef5c-258">Depois que o aplicativo valida o token, o Azure AD inicia uma nova sessão com o usuário.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-258">After the application validates the token, Azure AD starts a new session with the user.</span></span> <span data-ttu-id="5ef5c-259">Esta sessão permite que o usuário acesse o aplicativo até expirar.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-259">This session allows the user to access the application until it expires.</span></span>

#### <a name="code-samples"></a><span data-ttu-id="5ef5c-260">Exemplos de código</span><span class="sxs-lookup"><span data-stu-id="5ef5c-260">Code Samples</span></span>
<span data-ttu-id="5ef5c-261">Consulte os exemplos de código do navegador da Web para cenários de aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-261">See the code samples for Web Browser to Web Application scenarios.</span></span> <span data-ttu-id="5ef5c-262">Além disso, volte com frequência, adicionamos novos exemplos o tempo todo.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-262">And, check back frequently -- we add new samples all the time.</span></span> <span data-ttu-id="5ef5c-263">[Navegador da Web para aplicativo Web](active-directory-code-samples.md#web-browser-to-web-application).</span><span class="sxs-lookup"><span data-stu-id="5ef5c-263">[Web Browser to Web Application](active-directory-code-samples.md#web-browser-to-web-application).</span></span>

#### <a name="registering"></a><span data-ttu-id="5ef5c-264">Registro</span><span class="sxs-lookup"><span data-stu-id="5ef5c-264">Registering</span></span>
* <span data-ttu-id="5ef5c-265">Locatário Único: se você estiver criando um aplicativo apenas para a sua organização, ele deverá ser registrado no diretório da sua empresa usando o Portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-265">Single Tenant: If you are building an application just for your organization, it must be registered in your company’s directory by using the Azure Portal.</span></span>
* <span data-ttu-id="5ef5c-266">Multilocatário: Se você estiver criando um aplicativo que pode ser usado por usuários fora da sua organização, ele deve ser registrado no diretório da sua empresa, mas também deve ser registrado no diretório de cada organização que usará o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-266">Multi-Tenant: If you are building an application that can be used by users outside your organization, it must be registered in your company’s directory, but also must be registered in each organization’s directory that will be using the application.</span></span> <span data-ttu-id="5ef5c-267">Para disponibilizar seu aplicativo em seu diretório, você pode incluir um processo de inscrição para os clientes que os permita ter autorização para seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-267">To make your application available in their directory, you can include a sign-up process for your customers that enables them to consent to your application.</span></span> <span data-ttu-id="5ef5c-268">Ao se inscreverem para seu aplicativo, uma caixa de diálogo será apresentada, mostrando as permissões exigidas pelo aplicativo e, em seguida, a opção de consentimento.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-268">When they sign up for your application, they will be presented with a dialog that shows the permissions the application requires, and then the option to consent.</span></span> <span data-ttu-id="5ef5c-269">Dependendo das permissões necessárias, um administrador na outra organização talvez precise dar consentimento.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-269">Depending on the required permissions, an administrator in the other organization may be required to give consent.</span></span> <span data-ttu-id="5ef5c-270">Quando o usuário ou administrador der seu consentimento, o aplicativo é registrado em seu diretório.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-270">When the user or administrator consents, the application is registered in their directory.</span></span> <span data-ttu-id="5ef5c-271">Para saber mais, confira [Integrando aplicativos com o Active Directory do Azure](active-directory-integrating-applications.md).</span><span class="sxs-lookup"><span data-stu-id="5ef5c-271">For more information, see [Integrating Applications with Azure Active Directory](active-directory-integrating-applications.md).</span></span>

#### <a name="token-expiration"></a><span data-ttu-id="5ef5c-272">Expiração do token</span><span class="sxs-lookup"><span data-stu-id="5ef5c-272">Token Expiration</span></span>
<span data-ttu-id="5ef5c-273">A sessão do usuário expira quando a vida útil do token emitido pelo Azure AD expira.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-273">The user’s session expires when the lifetime of the token issued by Azure AD expires.</span></span> <span data-ttu-id="5ef5c-274">Seu aplicativo pode encurtar esse período de tempo, se desejado, por exemplo, desconectando usuários com base em um período de inatividade.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-274">Your application can shorten this time period if desired, such as signing out users based on a period of inactivity.</span></span> <span data-ttu-id="5ef5c-275">Quando a sessão expirar, o usuário deverá fazer logon novamente.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-275">When the session expires, the user will be prompted to sign in again.</span></span>

### <a name="single-page-application-spa"></a><span data-ttu-id="5ef5c-276">SPA (Aplicativo de Página Única)</span><span class="sxs-lookup"><span data-stu-id="5ef5c-276">Single Page Application (SPA)</span></span>
<span data-ttu-id="5ef5c-277">Esta seção descreve a autenticação para um Aplicativo de Página Única que usa o Azure AD e a concessão de autorização implícita de OAuth 2.0 para proteger o back-end de sua API da Web.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-277">This section describes authentication for a Single Page Application, that uses Azure AD and the OAuth 2.0 implicit authorization grant to secure its web API back end.</span></span> <span data-ttu-id="5ef5c-278">Aplicativos de Página Única normalmente são estruturados como uma camada de apresentação de JavaScript (front-end) que é executada no navegador e um back-end de API da Web que é executado em um servidor e implementa a lógica comercial do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-278">Single Page Applications are typically structured as a JavaScript presentation layer (front end) that runs in the browser and a Web API back end that runs on a server and implements the application’s business logic.</span></span> <span data-ttu-id="5ef5c-279">Para saber mais sobre a concessão de autorização implícita e ajudá-lo a decidir se ela é adequada para seu cenário de aplicativo, consulte [Noções básicas sobre o fluxo de concessão implícita de OAuth2 no Azure Active Directory](active-directory-dev-understanding-oauth2-implicit-grant.md).</span><span class="sxs-lookup"><span data-stu-id="5ef5c-279">To learn more about the implicit authorization grant, and help you decide whether it's right for your application scenario, see [Understanding the OAuth2 implicit grant flow in Azure Active Directory](active-directory-dev-understanding-oauth2-implicit-grant.md).</span></span>

<span data-ttu-id="5ef5c-280">Nesse cenário, quando o usuário faz logon, o front-end de JavaScript usa a [Biblioteca de Autenticação do Active Directory para JavaScript (ADAL. JS)](https://github.com/AzureAD/azure-activedirectory-library-for-js/tree/dev) e a concessão de autorização implícita para obter um token de ID (id_token) do Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-280">In this scenario, when the user signs in, the JavaScript front end uses [Active Directory Authentication Library for JavaScript (ADAL.JS)](https://github.com/AzureAD/azure-activedirectory-library-for-js/tree/dev) and the implicit authorization grant to obtain an ID token (id_token) from Azure AD.</span></span> <span data-ttu-id="5ef5c-281">O token é armazenado em cache e o cliente o anexa à solicitação como o token de portador ao fazer chamadas paro o back-end de sua API da Web, que é protegido usando o middleware OWIN.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-281">The token is cached and the client attaches it to the request as the bearer token when making calls to its Web API back end, which is secured using the OWIN middleware.</span></span> 

#### <a name="diagram"></a><span data-ttu-id="5ef5c-282">Diagrama</span><span class="sxs-lookup"><span data-stu-id="5ef5c-282">Diagram</span></span>
![Diagrama de Aplicativo de Página Única](./media/active-directory-authentication-scenarios/single_page_app.png)

#### <a name="description-of-protocol-flow"></a><span data-ttu-id="5ef5c-284">Descrição do fluxo de protocolo</span><span class="sxs-lookup"><span data-stu-id="5ef5c-284">Description of Protocol Flow</span></span>
1. <span data-ttu-id="5ef5c-285">O usuário navega até o aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-285">The user navigates to the web application.</span></span>
2. <span data-ttu-id="5ef5c-286">O aplicativo retorna o front-end de JavaScript (camada de apresentação) para o navegador.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-286">The application returns the JavaScript front end (presentation layer) to the browser.</span></span>
3. <span data-ttu-id="5ef5c-287">O usuário inicia o logon, por exemplo, clicando em um link de logon.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-287">The user initiates sign in, for example by clicking a sign in link.</span></span> <span data-ttu-id="5ef5c-288">O navegador envia um GET ao ponto de extremidade de autorização do Azure AD para solicitar um token de ID.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-288">The browser sends a GET to the Azure AD authorization endpoint to request an ID token.</span></span> <span data-ttu-id="5ef5c-289">Essa solicitação inclui a ID do aplicativo e a URL de resposta nos parâmetros de consulta.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-289">This request includes the application ID and reply URL in the query parameters.</span></span>
4. <span data-ttu-id="5ef5c-290">O Azure AD valida a URL de Resposta em relação à URL de Resposta registrada que foi configurada no Portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-290">Azure AD validates the Reply URL against the registered Reply URL that was configured in the Azure Portal.</span></span>
5. <span data-ttu-id="5ef5c-291">O usuário faz logon na página de logon.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-291">The user signs in on the sign-in page.</span></span>
6. <span data-ttu-id="5ef5c-292">Se a autenticação for bem-sucedida, o Azure AD cria um token de ID e o retorna como um fragmento de URL (#) à URL de resposta do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-292">If authentication is successful, Azure AD creates an ID token and returns it as a URL fragment (#) to the application’s Reply URL.</span></span> <span data-ttu-id="5ef5c-293">Para um aplicativo de produção, essa URL de resposta deve ser HTTPS.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-293">For a production application, this Reply URL should be HTTPS.</span></span> <span data-ttu-id="5ef5c-294">O token retornado inclui declarações sobre o usuário e o Azure AD que são exigidas pelo aplicativo para validar o token.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-294">The returned token includes claims about the user and Azure AD that are required by the application to validate the token.</span></span>
7. <span data-ttu-id="5ef5c-295">O código de cliente do JavaScript em execução no navegador extrai o token da resposta para usá-lo para proteger chamadas ao back-end da API da Web do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-295">The JavaScript client code running in the browser extracts the token from the response to use in securing calls to the application’s web API back end.</span></span>
8. <span data-ttu-id="5ef5c-296">O navegador chama o back-end da API da Web do aplicativo com o token de acesso no cabeçalho de autorização.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-296">The browser calls the application’s web API back end with the access token in the authorization header.</span></span>

#### <a name="code-samples"></a><span data-ttu-id="5ef5c-297">Exemplos de código</span><span class="sxs-lookup"><span data-stu-id="5ef5c-297">Code Samples</span></span>
<span data-ttu-id="5ef5c-298">Consulte os exemplos de código para cenários de Aplicativo de Página Única (SPA).</span><span class="sxs-lookup"><span data-stu-id="5ef5c-298">See the code samples for Single Page Application (SPA) scenarios.</span></span> <span data-ttu-id="5ef5c-299">Certifique-se de voltar com frequência, adicionamos novos exemplos o tempo todo.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-299">Be sure to check back frequently -- we add new samples all the time.</span></span> <span data-ttu-id="5ef5c-300">[SPA (Aplicativo de Página Única)](active-directory-code-samples.md#single-page-application-spa).</span><span class="sxs-lookup"><span data-stu-id="5ef5c-300">[Single Page Application (SPA)](active-directory-code-samples.md#single-page-application-spa).</span></span>

#### <a name="registering"></a><span data-ttu-id="5ef5c-301">Registro</span><span class="sxs-lookup"><span data-stu-id="5ef5c-301">Registering</span></span>
* <span data-ttu-id="5ef5c-302">Locatário Único: se você estiver criando um aplicativo apenas para a sua organização, ele deverá ser registrado no diretório da sua empresa usando o Portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-302">Single Tenant: If you are building an application just for your organization, it must be registered in your company’s directory by using the Azure Portal.</span></span>
* <span data-ttu-id="5ef5c-303">Multilocatário: Se você estiver criando um aplicativo que pode ser usado por usuários fora da sua organização, ele deve ser registrado no diretório da sua empresa, mas também deve ser registrado no diretório de cada organização que usará o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-303">Multi-Tenant: If you are building an application that can be used by users outside your organization, it must be registered in your company’s directory, but also must be registered in each organization’s directory that will be using the application.</span></span> <span data-ttu-id="5ef5c-304">Para disponibilizar seu aplicativo em seu diretório, você pode incluir um processo de inscrição para os clientes que os permita ter autorização para seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-304">To make your application available in their directory, you can include a sign-up process for your customers that enables them to consent to your application.</span></span> <span data-ttu-id="5ef5c-305">Ao se inscreverem para seu aplicativo, uma caixa de diálogo será apresentada, mostrando as permissões exigidas pelo aplicativo e, em seguida, a opção de consentimento.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-305">When they sign up for your application, they will be presented with a dialog that shows the permissions the application requires, and then the option to consent.</span></span> <span data-ttu-id="5ef5c-306">Dependendo das permissões necessárias, um administrador na outra organização talvez precise dar consentimento.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-306">Depending on the required permissions, an administrator in the other organization may be required to give consent.</span></span> <span data-ttu-id="5ef5c-307">Quando o usuário ou administrador der seu consentimento, o aplicativo é registrado em seu diretório.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-307">When the user or administrator consents, the application is registered in their directory.</span></span> <span data-ttu-id="5ef5c-308">Para saber mais, confira [Integrando aplicativos com o Active Directory do Azure](active-directory-integrating-applications.md).</span><span class="sxs-lookup"><span data-stu-id="5ef5c-308">For more information, see [Integrating Applications with Azure Active Directory](active-directory-integrating-applications.md).</span></span>

<span data-ttu-id="5ef5c-309">Depois de registrar o aplicativo, ele deve ser configurado para usar o protocolo OAuth 2.0 de concessão implícita.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-309">After registering the application, it must be configured to use OAuth 2.0 Implicit Grant protocol.</span></span> <span data-ttu-id="5ef5c-310">Por padrão, esse protocolo é desabilitado para aplicativos.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-310">By default, this protocol is disabled for applications.</span></span> <span data-ttu-id="5ef5c-311">Para habilitar o protocolo de Concessão Implícita OAuth2 para seu aplicativo, edite seu manifesto do aplicativo no Portal do Azure e defina o valor de "oauth2AllowImplicitFlow" como true.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-311">To enable the OAuth2 Implicit Grant protocol for your application, edit its application manifest from the Azure Portal and set the “oauth2AllowImplicitFlow” value to true.</span></span> <span data-ttu-id="5ef5c-312">Para obter instruções detalhadas, consulte [Habilitar a concessão implícita do OAuth 2.0 para aplicativos de página única](active-directory-integrating-applications.md).</span><span class="sxs-lookup"><span data-stu-id="5ef5c-312">For detailed instructions, see [Enabling OAuth 2.0 Implicit Grant for Single Page Applications](active-directory-integrating-applications.md).</span></span>

#### <a name="token-expiration"></a><span data-ttu-id="5ef5c-313">Expiração do token</span><span class="sxs-lookup"><span data-stu-id="5ef5c-313">Token Expiration</span></span>
<span data-ttu-id="5ef5c-314">Quando você usa ADAL.js para gerenciar a autenticação com o Azure AD, você aproveita vários recursos que facilitam a atualização de um token expirado, bem como a obtenção de tokens para recursos de API da Web adicionais que podem ser chamados pelo aplicativo.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-314">When you use ADAL.js to manage authentication with Azure AD, you benefit from several features that facilitate refreshing an expired token as well as getting tokens for additional web API resources that may be called by the application.</span></span> <span data-ttu-id="5ef5c-315">Quando o usuário é autenticado com sucesso no Azure AD, é estabelecida uma sessão protegida por um cookie para o usuário entre o navegador e o Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-315">When the user successfully authenticates with Azure AD, a session secured by a cookie is established for the user between the browser and Azure AD.</span></span> <span data-ttu-id="5ef5c-316">É importante observar que a sessão existe entre o usuário e o Azure AD e não entre o usuário e o aplicativo Web em execução no servidor.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-316">It’s important to note that the session exists between the user and Azure AD and not between the user and the web application running on the server.</span></span> <span data-ttu-id="5ef5c-317">Quando um token expira, o ADAL.js usa essa sessão para obter silenciosamente outro token.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-317">When a token expires, ADAL.js uses this session to silently obtain another token.</span></span> <span data-ttu-id="5ef5c-318">Ele faz isso usando um iFrame oculto para enviar e receber a solicitação usando o protocolo de concessão implícita do OAuth.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-318">It does this by using a hidden iFrame to send and receive the request using the OAuth Implicit Grant protocol.</span></span> <span data-ttu-id="5ef5c-319">O ADAL.js também pode usar o mesmo mecanismo para obter silenciosamente os tokens de acesso do Azure AD para outros recursos da API da Web que o aplicativo chama, contanto que esses recursos ofereçam suporte a CORS (compartilhamento de recursos entre origens), que eles estejam registrados no diretório do usuário e que qualquer consentimento necessário tenha sido fornecido pelo usuário durante o logon.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-319">ADAL.js can also use this same mechanism to silently obtain access tokens from Azure AD for other web API resources that the application calls as long as these resources support cross-origin resource sharing (CORS), are registered in the user’s directory, and any required consent was given by the user during sign-in.</span></span>

### <a name="native-application-to-web-api"></a><span data-ttu-id="5ef5c-320">Aplicativo nativo para API da Web</span><span class="sxs-lookup"><span data-stu-id="5ef5c-320">Native Application to Web API</span></span>
<span data-ttu-id="5ef5c-321">Esta seção descreve um aplicativo nativo que chama uma API da Web em nome de um usuário.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-321">This section describes a native application that calls a web API on behalf of a user.</span></span> <span data-ttu-id="5ef5c-322">Este cenário se baseia no tipo de concessão de código de autorização OAuth 2.0 com um cliente público, conforme descrito na seção 4.1 da [especificação do OAuth 2.0](http://tools.ietf.org/html/rfc6749).</span><span class="sxs-lookup"><span data-stu-id="5ef5c-322">This scenario is built on the OAuth 2.0 authorization code grant type with a public client, as described in section 4.1 of the [OAuth 2.0 specification](http://tools.ietf.org/html/rfc6749).</span></span> <span data-ttu-id="5ef5c-323">O aplicativo nativo obtém um token de acesso para o usuário usando o protocolo OAuth 2.0.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-323">The native application obtains an access token for the user by using the OAuth 2.0 protocol.</span></span> <span data-ttu-id="5ef5c-324">Esse token de acesso é enviado na solicitação para a API da Web, que autoriza o usuário e retorna o recurso desejado.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-324">This access token is then sent in the request to the web API, which authorizes the user and returns the desired resource.</span></span>

#### <a name="diagram"></a><span data-ttu-id="5ef5c-325">Diagrama</span><span class="sxs-lookup"><span data-stu-id="5ef5c-325">Diagram</span></span>
![Diagrama de aplicativo nativo para API da Web](./media/active-directory-authentication-scenarios/native_app_to_web_api.png)

#### <a name="authentication-flow-for-native-application-to-api"></a><span data-ttu-id="5ef5c-327">Fluxo de autenticação do aplicativo nativo para API</span><span class="sxs-lookup"><span data-stu-id="5ef5c-327">Authentication flow for native application to API</span></span>
#### <a name="description-of-protocol-flow"></a><span data-ttu-id="5ef5c-328">Descrição do fluxo de protocolo</span><span class="sxs-lookup"><span data-stu-id="5ef5c-328">Description of Protocol Flow</span></span>
<span data-ttu-id="5ef5c-329">Se você estiver usando as bibliotecas de autenticação do AD, a maioria dos detalhes do protocolo descritos abaixo será manipulada para você, como o pop-up do navegador, o armazenamento em cache do token e a manipulação de tokens de atualização.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-329">If you are using the AD Authentication Libraries, most of the protocol details described below are handled for you, such as the browser pop-up, token caching, and handling of refresh tokens.</span></span>

1. <span data-ttu-id="5ef5c-330">Usando um pop-up de navegador, o aplicativo nativo faz uma solicitação para o ponto de extremidade de autorização no Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-330">Using a browser pop-up, the native application makes a request to the authorization endpoint in Azure AD.</span></span> <span data-ttu-id="5ef5c-331">Essa solicitação inclui a ID do Aplicativo e o URI de redirecionamento do aplicativo nativo, conforme mostrado no Portal do Azure, e o URI de ID do aplicativo para a API da Web.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-331">This request includes the Application ID and the redirect URI of the native application as shown in the Azure Portal, and the application ID URI for the web API.</span></span> <span data-ttu-id="5ef5c-332">Se o usuário ainda não tiver feito logon, ele será solicitado a fazer logon novamente</span><span class="sxs-lookup"><span data-stu-id="5ef5c-332">If the user hasn’t already signed in, they are prompted to sign in again</span></span>
2. <span data-ttu-id="5ef5c-333">O Azure AD autentica o usuário.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-333">Azure AD authenticates the user.</span></span> <span data-ttu-id="5ef5c-334">Se for um aplicativo multilocatário e for necessário um consentimento para usar o aplicativo, o usuário deverá consentir, caso ainda não tenha feito isso.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-334">If it is a multi-tenant application and consent is required to use the application, the user will be required to consent if they haven’t already done so.</span></span> <span data-ttu-id="5ef5c-335">Depois de conceder autorização e após a autenticação bem-sucedida, o Azure AD emite uma resposta de código de autorização para o URI de redirecionamento do aplicativo cliente.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-335">After granting consent and upon successful authentication, Azure AD issues an authorization code response back to the client application’s redirect URI.</span></span>
3. <span data-ttu-id="5ef5c-336">Quando o Azure AD emite uma resposta de código de autorização para o URI de redirecionamento, o aplicativo cliente interrompe a interação com o navegador e extrai o código de autorização da resposta.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-336">When Azure AD issues an authorization code response back to the redirect URI, the client application stops browser interaction and extracts the authorization code from the response.</span></span> <span data-ttu-id="5ef5c-337">Usando esse código de autorização, o aplicativo cliente envia uma solicitação ao ponto de extremidade do token do Azure AD que inclui o código de autorização, detalhes sobre o aplicativo cliente (ID do Aplicativo e o URI de redirecionamento) e o recurso desejado (URI de ID do aplicativo para a API da Web).</span><span class="sxs-lookup"><span data-stu-id="5ef5c-337">Using this authorization code, the client application sends a request to Azure AD’s token endpoint that includes the authorization code, details about the client application (Application ID and redirect URI), and the desired resource (application ID URI for the web API).</span></span>
4. <span data-ttu-id="5ef5c-338">O código de autorização e informações sobre o aplicativo cliente e a API da Web são validados pelo Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-338">The authorization code and information about the client application and web API are validated by Azure AD.</span></span> <span data-ttu-id="5ef5c-339">Após a validação bem-sucedida, o Azure AD retorna dois tokens: um token de acesso JWT e um token de atualização JWT.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-339">Upon successful validation, Azure AD returns two tokens: a JWT access token and a JWT refresh token.</span></span> <span data-ttu-id="5ef5c-340">Além disso, o Azure AD retorna informações básicas sobre o usuário, como seu nome de exibição e ID do locatário.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-340">In addition, Azure AD returns basic information about the user, such as their display name and tenant ID.</span></span>
5. <span data-ttu-id="5ef5c-341">Via HTTPS, o aplicativo cliente usa o token de acesso JWT retornado para adicionar a cadeia de caracteres JWT com uma designação de "Portador" no cabeçalho de autorização da solicitação à API da Web.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-341">Over HTTPS, the client application uses the returned JWT access token to add the JWT string with a “Bearer” designation in the Authorization header of the request to the web API.</span></span> <span data-ttu-id="5ef5c-342">A API da Web, em seguida, valida o token JWT e, se a validação for bem-sucedida, retorna o recurso desejado.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-342">The web API then validates the JWT token, and if validation is successful, returns the desired resource.</span></span>
6. <span data-ttu-id="5ef5c-343">Quando o token de acesso expira, o aplicativo cliente recebe um erro que indica que o usuário precisa se autenticar novamente.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-343">When the access token expires, the client application will receive an error that indicates the user needs to authenticate again.</span></span> <span data-ttu-id="5ef5c-344">Se o aplicativo tiver um token de atualização válido, ele pode ser usado para adquirir um novo token de acesso sem que um novo logon do usuário seja solicitado.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-344">If the application has a valid refresh token, it can be used to acquire a new access token without prompting the user to sign in again.</span></span> <span data-ttu-id="5ef5c-345">Se o token de atualização expirar, o aplicativo precisará autenticar interativamente o usuário novamente.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-345">If the refresh token expires, the application will need to interactively authenticate the user once again.</span></span>

> [!NOTE]
> <span data-ttu-id="5ef5c-346">O token de atualização emitido pelo Azure AD pode ser usado para acessar vários recursos.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-346">The refresh token issued by Azure AD can be used to access multiple resources.</span></span> <span data-ttu-id="5ef5c-347">Por exemplo, se você tiver um aplicativo cliente que tenha permissão para chamar duas APIs da Web, o token de atualização pode ser usado para obter um token de acesso para a outra API da Web também.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-347">For example, if you have a client application that has permission to call two web APIs, the refresh token can be used to get an access token to the other web API as well.</span></span>
> 
> 

#### <a name="code-samples"></a><span data-ttu-id="5ef5c-348">Exemplos de código</span><span class="sxs-lookup"><span data-stu-id="5ef5c-348">Code Samples</span></span>
<span data-ttu-id="5ef5c-349">Consulte os exemplos de código para os cenários de aplicativo nativo para API da Web.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-349">See the code samples for Native Application to Web API scenarios.</span></span> <span data-ttu-id="5ef5c-350">Além disso, volte com frequência, adicionamos novos exemplos o tempo todo.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-350">And, check back frequently -- we add new samples all the time.</span></span> <span data-ttu-id="5ef5c-351">[Aplicativo nativo para API da Web](active-directory-code-samples.md#native-application-to-web-api)</span><span class="sxs-lookup"><span data-stu-id="5ef5c-351">[Native Application to Web API](active-directory-code-samples.md#native-application-to-web-api).</span></span>

#### <a name="registering"></a><span data-ttu-id="5ef5c-352">Registro</span><span class="sxs-lookup"><span data-stu-id="5ef5c-352">Registering</span></span>
* <span data-ttu-id="5ef5c-353">Locatário único: O aplicativo nativo e a API da Web devem ser registrados no mesmo diretório no Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-353">Single Tenant: Both the native application and the web API must be registered in the same directory in Azure AD.</span></span> <span data-ttu-id="5ef5c-354">A API da Web pode ser configurada para expor um conjunto de permissões, que são usadas para limitar o acesso do aplicativo nativo a seus recursos.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-354">The web API can be configured to expose a set of permissions, which are used to limit the native application’s access to its resources.</span></span> <span data-ttu-id="5ef5c-355">O aplicativo cliente seleciona as permissões desejadas no menu suspenso "Permissões para Outros Aplicativos" no Portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-355">The client application then selects the desired permissions from the “Permissions to Other Applications” drop-down menu in the Azure Portal.</span></span>
* <span data-ttu-id="5ef5c-356">Multilocatário: Primeiro, o aplicativo nativo registrado apenas no diretório do desenvolvedor ou do editor.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-356">Multi-Tenant: First, the native application only ever registered in the developer or publisher’s directory.</span></span> <span data-ttu-id="5ef5c-357">Em segundo lugar, o aplicativo nativo é configurado para indicar as permissões necessárias para que seja funcional.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-357">Second, the native application is configured to indicate the permissions it requires to be functional.</span></span> <span data-ttu-id="5ef5c-358">Essa lista de permissões necessárias é mostrada em uma caixa de diálogo quando um usuário ou administrador no diretório de destino dá consentimento para o aplicativo, o que o torna disponível para sua organização.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-358">This list of required permissions is shown in a dialog when a user or administrator in the destination directory gives consent to the application, which makes it available to their organization.</span></span> <span data-ttu-id="5ef5c-359">Alguns aplicativos exigem apenas permissões de nível de usuário, que qualquer usuário na organização pode conceder.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-359">Some applications require just user-level permissions, which any user in the organization can consent to.</span></span> <span data-ttu-id="5ef5c-360">Outros aplicativos exigem permissões de nível administrativo, que um usuário na organização não pode conceder.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-360">Other applications require administrator-level permissions, which a user in the organization cannot consent to.</span></span> <span data-ttu-id="5ef5c-361">Somente um administrador do diretório pode dar consentimento para aplicativos que exigem esse nível de permissões.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-361">Only a directory administrator can give consent to applications that require this level of permissions.</span></span> <span data-ttu-id="5ef5c-362">Quando o usuário ou administrador concede sua permissão, somente a API da Web é registrada no diretório.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-362">When the user or administrator consents, only the web API is registered in their directory.</span></span> <span data-ttu-id="5ef5c-363">Para saber mais, confira [Integrando aplicativos com o Active Directory do Azure](active-directory-integrating-applications.md).</span><span class="sxs-lookup"><span data-stu-id="5ef5c-363">For more information, see [Integrating Applications with Azure Active Directory](active-directory-integrating-applications.md).</span></span>

#### <a name="token-expiration"></a><span data-ttu-id="5ef5c-364">Expiração do token</span><span class="sxs-lookup"><span data-stu-id="5ef5c-364">Token Expiration</span></span>
<span data-ttu-id="5ef5c-365">Quando o aplicativo nativo usa seu código de autorização para obter um token de acesso JWT, ele também recebe um token de atualização JWT.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-365">When the native application uses its authorization code to get a JWT access token, it also receives a JWT refresh token.</span></span> <span data-ttu-id="5ef5c-366">Quando o token de acesso expira, o token de atualização pode ser usado para autenticar o usuário novamente sem a necessidade de fazer logon novamente.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-366">When the access token expires, the refresh token can be used to re-authenticate the user without requiring them to sign in again.</span></span> <span data-ttu-id="5ef5c-367">Esse token de atualização é usado para autenticar o usuário, o que resulta em um novo token de acesso e token de atualização.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-367">This refresh token is then used to authenticate the user, which results in a new access token and refresh token.</span></span>

### <a name="web-application-to-web-api"></a><span data-ttu-id="5ef5c-368">Aplicativo Web para API da Web</span><span class="sxs-lookup"><span data-stu-id="5ef5c-368">Web Application to Web API</span></span>
<span data-ttu-id="5ef5c-369">Esta seção descreve um aplicativo Web que precisa obter recursos de uma API da Web.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-369">This section describes a web application that needs to get resources from a web API.</span></span> <span data-ttu-id="5ef5c-370">Nesse cenário, há dois tipos de identidade que o aplicativo Web pode usar para autenticar e chamar a API da Web: uma identidade de aplicativo ou uma identidade de usuário delegada.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-370">In this scenario, there are two identity types that the web application can use to authenticate and call the web API: an application identity, or a delegated user identity.</span></span>

<span data-ttu-id="5ef5c-371">*Identidade de aplicativo:* esse cenário usa a concessão de credenciais do cliente OAuth 2.0 para se autenticar como o aplicativo e acessar a API da Web.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-371">*Application identity:* This scenario uses OAuth 2.0 client credentials grant to authenticate as the application and access the web API.</span></span> <span data-ttu-id="5ef5c-372">Ao usar uma identidade de aplicativo, a API da Web só pode detectar que o aplicativo Web a está chamando, uma vez que a API Web não recebe nenhuma informação sobre o usuário.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-372">When using an application identity, the web API can only detect that the web application is calling it, as the web API does not receive any information about the user.</span></span> <span data-ttu-id="5ef5c-373">Se o aplicativo receber informações sobre o usuário, ele será enviado por meio do protocolo do aplicativo e ele não será assinado pelo Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-373">If the application receives information about the user, it will be sent via the application protocol, and it is not signed by Azure AD.</span></span> <span data-ttu-id="5ef5c-374">A API da Web confia que o aplicativo Web autenticou o usuário.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-374">The web API trusts that the web application authenticated the user.</span></span> <span data-ttu-id="5ef5c-375">Por esse motivo, esse padrão é chamado de subsistema confiável.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-375">For this reason, this pattern is called a trusted subsystem.</span></span>

<span data-ttu-id="5ef5c-376">*Identidade de usuário delegado:* o cenário pode ser realizado de duas maneiras, OpenID Connect e concessão de código de autorização OAuth 2.0 com um cliente confidencial.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-376">*Delegated user identity:* This scenario can be accomplished in two ways: OpenID Connect, and OAuth 2.0 authorization code grant with a confidential client.</span></span> <span data-ttu-id="5ef5c-377">O aplicativo Web obtém um token de acesso para o usuário, o que prova para a API da Web que o usuário foi autenticado com êxito para o aplicativo Web e que o aplicativo Web foi capaz de obter uma identidade de usuário delegado para chamar a API da Web.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-377">The web application obtains an access token for the user, which proves to the web API that the user successfully authenticated to the web application and that the web application was able to obtain a delegated user identity to call the web API.</span></span> <span data-ttu-id="5ef5c-378">Esse token de acesso é enviado na solicitação para a API da Web, que autoriza o usuário e retorna o recurso desejado.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-378">This access token is sent in the request to the web API, which authorizes the user and returns the desired resource.</span></span>

#### <a name="diagram"></a><span data-ttu-id="5ef5c-379">Diagrama</span><span class="sxs-lookup"><span data-stu-id="5ef5c-379">Diagram</span></span>
![Diagrama de aplicativo Web para API da Web](./media/active-directory-authentication-scenarios/web_app_to_web_api.png)

#### <a name="description-of-protocol-flow"></a><span data-ttu-id="5ef5c-381">Descrição do fluxo de protocolo</span><span class="sxs-lookup"><span data-stu-id="5ef5c-381">Description of Protocol Flow</span></span>
<span data-ttu-id="5ef5c-382">A identidade do aplicativo e os tipos de identidade do usuário delegado são discutidos no fluxo abaixo.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-382">Both the application identity and delegated user identity types are discussed in the flow below.</span></span> <span data-ttu-id="5ef5c-383">A principal diferença entre eles é que a identidade de usuário delegado deve primeiramente adquirir um código de autorização antes que o usuário possa fazer login e acessar a API da Web.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-383">The key difference between them is that the delegated user identity must first acquire an authorization code before the user can sign-in and gain access to the web API.</span></span>

##### <a name="application-identity-with-oauth-20-client-credentials-grant"></a><span data-ttu-id="5ef5c-384">Identidade do aplicativo com concessão de credenciais do cliente OAuth 2.0</span><span class="sxs-lookup"><span data-stu-id="5ef5c-384">Application Identity with OAuth 2.0 Client Credentials Grant</span></span>
1. <span data-ttu-id="5ef5c-385">Um usuário está conectado ao AD do Azure no aplicativo Web (veja a seção [Navegador da Web para aplicativo Web](#web-browser-to-web-application) acima).</span><span class="sxs-lookup"><span data-stu-id="5ef5c-385">A user is signed in to Azure AD in the web application (see the [Web Browser to Web Application](#web-browser-to-web-application) above).</span></span>
2. <span data-ttu-id="5ef5c-386">O aplicativo Web precisa adquirir um token de acesso para que ele possa autenticar a API da Web e recuperar o recurso desejado.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-386">The web application needs to acquire an access token so that it can authenticate to the web API and retrieve the desired resource.</span></span> <span data-ttu-id="5ef5c-387">Ele faz uma solicitação ao ponto de extremidade do token do Azure AD, fornecendo a credencial, a ID do Aplicativo e o URI de ID do aplicativo da API da Web.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-387">It makes a request to Azure AD’s token endpoint, providing the credential, Application ID, and web API’s application ID URI.</span></span>
3. <span data-ttu-id="5ef5c-388">O Azure AD autentica o aplicativo e retorna um token de acesso JWT que é usado para chamar a API da Web.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-388">Azure AD authenticates the application and returns a JWT access token that is used to call the web API.</span></span>
4. <span data-ttu-id="5ef5c-389">Via HTTPS, o aplicativo Web usa o token de acesso JWT retornado para adicionar a cadeia de caracteres JWT com uma designação de "Portador" no cabeçalho de autorização da solicitação à API da Web.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-389">Over HTTPS, the web application uses the returned JWT access token to add the JWT string with a “Bearer” designation in the Authorization header of the request to the web API.</span></span> <span data-ttu-id="5ef5c-390">A API da Web, em seguida, valida o token JWT e, se a validação for bem-sucedida, retorna o recurso desejado.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-390">The web API then validates the JWT token, and if validation is successful, returns the desired resource.</span></span>

##### <a name="delegated-user-identity-with-openid-connect"></a><span data-ttu-id="5ef5c-391">Identidade de usuário delegado com OpenID Connect</span><span class="sxs-lookup"><span data-stu-id="5ef5c-391">Delegated User Identity with OpenID Connect</span></span>
1. <span data-ttu-id="5ef5c-392">Um usuário está conectado a um aplicativo Web usando o AD do Azure (veja a seção [Navegador da Web para aplicativo Web](#web-browser-to-web-application) acima).</span><span class="sxs-lookup"><span data-stu-id="5ef5c-392">A user is signed in to a web application using Azure AD (see the [Web Browser to Web Application](#web-browser-to-web-application) section above).</span></span> <span data-ttu-id="5ef5c-393">Se o usuário do aplicativo Web ainda não tiver consentido para permitir que o aplicativo Web chame a API da Web em seu nome, o usuário precisará de consentimento.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-393">If the user of the web application has not yet consented to allowing the web application to call the web API on its behalf, the user will need to consent.</span></span> <span data-ttu-id="5ef5c-394">O aplicativo exibirá as permissões que ele exige e se qualquer uma dessas permissões for de nível administrativo, um usuário normal no diretório não poderá conceder a permissão.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-394">The application will display the permissions it requires, and if any of these are administrator-level permissions, a normal user in the directory will not be able to consent.</span></span> <span data-ttu-id="5ef5c-395">Esse processo de consentimento só se aplica a aplicativos multilocatários, não a aplicativos de locatário único, uma vez que o aplicativo já terá as permissões necessárias.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-395">This consent process only applies to multi-tenant applications, not single tenant applications, as the application will already have the necessary permissions.</span></span> <span data-ttu-id="5ef5c-396">Quando o usuário tiver feito login, o aplicativo terá recebido um token de ID com informações sobre o usuário, bem como um código de autorização.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-396">When the user signed in, the web application received an ID token with information about the user, as well as an authorization code.</span></span>
2. <span data-ttu-id="5ef5c-397">Usando o código de autorização emitido pelo Azure AD, o aplicativo Web envia uma solicitação ao ponto de extremidade do token do Azure AD que inclui o código de autorização, detalhes sobre o aplicativo cliente (ID do Aplicativo e o URI de redirecionamento) e o recurso desejado (URI de ID do aplicativo para a API da Web).</span><span class="sxs-lookup"><span data-stu-id="5ef5c-397">Using the authorization code issued by Azure AD, the web application sends a request to Azure AD’s token endpoint that includes the authorization code, details about the client application (Application ID and redirect URI), and the desired resource (application ID URI for the web API).</span></span>
3. <span data-ttu-id="5ef5c-398">O código de autorização e informações sobre o aplicativo Web e a API da Web são validados pelo Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-398">The authorization code and information about the web application and web API are validated by Azure AD.</span></span> <span data-ttu-id="5ef5c-399">Após a validação bem-sucedida, o Azure AD retorna dois tokens: um token de acesso JWT e um token de atualização JWT.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-399">Upon successful validation, Azure AD returns two tokens: a JWT access token and a JWT refresh token.</span></span>
4. <span data-ttu-id="5ef5c-400">Via HTTPS, o aplicativo Web usa o token de acesso JWT retornado para adicionar a cadeia de caracteres JWT com uma designação de "Portador" no cabeçalho de autorização da solicitação à API da Web.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-400">Over HTTPS, the web application uses the returned JWT access token to add the JWT string with a “Bearer” designation in the Authorization header of the request to the web API.</span></span> <span data-ttu-id="5ef5c-401">A API da Web, em seguida, valida o token JWT e, se a validação for bem-sucedida, retorna o recurso desejado.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-401">The web API then validates the JWT token, and if validation is successful, returns the desired resource.</span></span>

##### <a name="delegated-user-identity-with-oauth-20-authorization-code-grant"></a><span data-ttu-id="5ef5c-402">Identidade de usuário delegado com concessão de código de autorização do OAuth 2.0</span><span class="sxs-lookup"><span data-stu-id="5ef5c-402">Delegated User Identity with OAuth 2.0 Authorization Code Grant</span></span>
1. <span data-ttu-id="5ef5c-403">Um usuário já está conectado a um aplicativo web, cujo mecanismo de autenticação é independente do Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-403">A user is already signed in to a web application, whose authentication mechanism is independent of Azure AD.</span></span>
2. <span data-ttu-id="5ef5c-404">O aplicativo Web requer um código de autorização para adquirir um token de acesso, por isso, ele emite uma solicitação por meio do navegador ao ponto de extremidade de autorização do Azure AD, fornecendo a ID do Aplicativo e o URI de redirecionamento para o aplicativo Web após uma autenticação bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-404">The web application requires an authorization code to acquire an access token, so it issues a request through the browser to Azure AD’s authorization endpoint, providing the Application ID and redirect URI for the web application after successful authentication.</span></span> <span data-ttu-id="5ef5c-405">O usuário faz login no Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-405">The user signs in to Azure AD.</span></span>
3. <span data-ttu-id="5ef5c-406">Se o usuário do aplicativo Web ainda não tiver consentido para permitir que o aplicativo Web chame a API da Web em seu nome, o usuário precisará de consentimento.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-406">If the user of the web application has not yet consented to allowing the web application to call the web API on its behalf, the user will need to consent.</span></span> <span data-ttu-id="5ef5c-407">O aplicativo exibirá as permissões que ele exige e se qualquer uma dessas permissões for de nível administrativo, um usuário normal no diretório não poderá conceder a permissão.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-407">The application will display the permissions it requires, and if any of these are administrator-level permissions, a normal user in the directory will not be able to consent.</span></span> <span data-ttu-id="5ef5c-408">Esse consentimento se aplica ao aplicativo de único locatário e multilocatário.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-408">This consent applies to both single and multi-tenant application.</span></span>  <span data-ttu-id="5ef5c-409">No caso de único locatário, um administrador pode executar o consentimento de administrador para consentir em nome de seus usuários.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-409">In the single tenant case, an admin can perform admin consent to consent on behalf of their users.</span></span>  <span data-ttu-id="5ef5c-410">Isso pode ser feito usando o botão `Grant Permissions` no [portal do Azure](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="5ef5c-410">This can be done using the `Grant Permissions` button in the [Azure Portal](https://portal.azure.com).</span></span> 
4. <span data-ttu-id="5ef5c-411">Depois que o usuário tiver concedido permissão, o aplicativo Web recebe o código de autorização de que precisa para adquirir um token de acesso.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-411">After the user has consented, the web application receives the authorization code that it needs to acquire an access token.</span></span>
5. <span data-ttu-id="5ef5c-412">Usando o código de autorização emitido pelo Azure AD, o aplicativo Web envia uma solicitação ao ponto de extremidade do token do Azure AD que inclui o código de autorização, detalhes sobre o aplicativo cliente (ID do Aplicativo e o URI de redirecionamento) e o recurso desejado (URI de ID do aplicativo para a API da Web).</span><span class="sxs-lookup"><span data-stu-id="5ef5c-412">Using the authorization code issued by Azure AD, the web application sends a request to Azure AD’s token endpoint that includes the authorization code, details about the client application (Application ID and redirect URI), and the desired resource (application ID URI for the web API).</span></span>
6. <span data-ttu-id="5ef5c-413">O código de autorização e informações sobre o aplicativo Web e a API da Web são validados pelo Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-413">The authorization code and information about the web application and web API are validated by Azure AD.</span></span> <span data-ttu-id="5ef5c-414">Após a validação bem-sucedida, o Azure AD retorna dois tokens: um token de acesso JWT e um token de atualização JWT.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-414">Upon successful validation, Azure AD returns two tokens: a JWT access token and a JWT refresh token.</span></span>
7. <span data-ttu-id="5ef5c-415">Via HTTPS, o aplicativo Web usa o token de acesso JWT retornado para adicionar a cadeia de caracteres JWT com uma designação de "Portador" no cabeçalho de autorização da solicitação à API da Web.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-415">Over HTTPS, the web application uses the returned JWT access token to add the JWT string with a “Bearer” designation in the Authorization header of the request to the web API.</span></span> <span data-ttu-id="5ef5c-416">A API da Web, em seguida, valida o token JWT e, se a validação for bem-sucedida, retorna o recurso desejado.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-416">The web API then validates the JWT token, and if validation is successful, returns the desired resource.</span></span>

#### <a name="code-samples"></a><span data-ttu-id="5ef5c-417">Exemplos de código</span><span class="sxs-lookup"><span data-stu-id="5ef5c-417">Code Samples</span></span>
<span data-ttu-id="5ef5c-418">Consulte os exemplos de código para os cenários de aplicativo Web para API da Web.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-418">See the code samples for Web Application to Web API scenarios.</span></span> <span data-ttu-id="5ef5c-419">Além disso, volte com frequência, adicionamos novos exemplos o tempo todo.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-419">And, check back frequently -- we add new samples all the time.</span></span> <span data-ttu-id="5ef5c-420">[Aplicativo Web para API da Web](active-directory-code-samples.md#web-application-to-web-api).</span><span class="sxs-lookup"><span data-stu-id="5ef5c-420">Web [Application to Web API](active-directory-code-samples.md#web-application-to-web-api).</span></span>

#### <a name="registering"></a><span data-ttu-id="5ef5c-421">Registro</span><span class="sxs-lookup"><span data-stu-id="5ef5c-421">Registering</span></span>
* <span data-ttu-id="5ef5c-422">Locatário único: para a identidade do aplicativo e casos de identidade de usuário delegado, o aplicativo Web e a API da Web devem ser registrados no mesmo diretório no Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-422">Single Tenant: For both the application identity and delegated user identity cases, the web application and the web API must be registered in the same directory in Azure AD.</span></span> <span data-ttu-id="5ef5c-423">A API da Web pode ser configurada para expor um conjunto de permissões, que são usadas para limitar o acesso do aplicativo Web a seus recursos.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-423">The web API can be configured to expose a set of permissions, which are used to limit the web application’s access to its resources.</span></span> <span data-ttu-id="5ef5c-424">Se um tipo de identidade de usuário delegado estiver sendo usado, o aplicativo Web precisará selecionar as permissões desejadas no menu suspenso "Permissões para Outros Aplicativos" no Portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-424">If a delegated user identity type is being used, the web application needs to select the desired permissions from the “Permissions to Other Applications” drop-down menu in the Azure Portal.</span></span> <span data-ttu-id="5ef5c-425">Essa etapa não será necessária se o tipo de identidade de aplicativo estiver sendo usado.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-425">This step is not required if the application identity type is being used.</span></span>
* <span data-ttu-id="5ef5c-426">Multilocatário: Primeiro, o aplicativo Web é configurado para indicar as permissões necessárias para que seja funcional.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-426">Multi-Tenant: First, the web application is configured to indicate the permissions it requires to be functional.</span></span> <span data-ttu-id="5ef5c-427">Essa lista de permissões necessárias é mostrada em uma caixa de diálogo quando um usuário ou administrador no diretório de destino dá consentimento para o aplicativo, o que o torna disponível para sua organização.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-427">This list of required permissions is shown in a dialog when a user or administrator in the destination directory gives consent to the application, which makes it available to their organization.</span></span> <span data-ttu-id="5ef5c-428">Alguns aplicativos exigem apenas permissões de nível de usuário, que qualquer usuário na organização pode conceder.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-428">Some applications require just user-level permissions, which any user in the organization can consent to.</span></span> <span data-ttu-id="5ef5c-429">Outros aplicativos exigem permissões de nível administrativo, que um usuário na organização não pode conceder.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-429">Other applications require administrator-level permissions, which a user in the organization cannot consent to.</span></span> <span data-ttu-id="5ef5c-430">Somente um administrador do diretório pode dar consentimento para aplicativos que exigem esse nível de permissões.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-430">Only a directory administrator can give consent to applications that require this level of permissions.</span></span> <span data-ttu-id="5ef5c-431">Quando o usuário ou administrador conceder sua permissão, o aplicativo Web e a API da Web são registrados em seu diretório.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-431">When the user or administrator consents, the web application and the web API are both registered in their directory.</span></span>

#### <a name="token-expiration"></a><span data-ttu-id="5ef5c-432">Expiração do token</span><span class="sxs-lookup"><span data-stu-id="5ef5c-432">Token Expiration</span></span>
<span data-ttu-id="5ef5c-433">Quando o aplicativo Web usa seu código de autorização para obter um token de acesso JWT, ele também recebe um token de atualização JWT.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-433">When the web application uses its authorization code to get a JWT access token, it also receives a JWT refresh token.</span></span> <span data-ttu-id="5ef5c-434">Quando o token de acesso expira, o token de atualização pode ser usado para autenticar o usuário novamente sem a necessidade de fazer logon novamente.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-434">When the access token expires, the refresh token can be used to re-authenticate the user without requiring them to sign in again.</span></span> <span data-ttu-id="5ef5c-435">Esse token de atualização é usado para autenticar o usuário, o que resulta em um novo token de acesso e token de atualização.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-435">This refresh token is then used to authenticate the user, which results in a new access token and refresh token.</span></span>

### <a name="daemon-or-server-application-to-web-api"></a><span data-ttu-id="5ef5c-436">Servidor ou aplicativo Daemon para API da Web</span><span class="sxs-lookup"><span data-stu-id="5ef5c-436">Daemon or Server Application to Web API</span></span>
<span data-ttu-id="5ef5c-437">Esta seção descreve um aplicativo daemon ou de servidor que precisa obter recursos de uma API da Web.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-437">This section describes a daemon or server application that needs to get resources from a web API.</span></span> <span data-ttu-id="5ef5c-438">Há dois sub-cenários que se aplicam a esta seção: um daemon que precisa chamar uma API da Web, baseado no tipo de concessão de credenciais de cliente OAuth 2.0; e um aplicativo de servidor (por exemplo, uma API da Web) que precisa chamar uma API da Web, baseada na especificação de rascunho OAuth 2.0 On-Behalf-Of.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-438">There are two sub-scenarios that apply to this section: A daemon that needs to call a web API, built on OAuth 2.0 client credentials grant type; and a server application (such as a web API) that needs to call a web API, built on OAuth 2.0 On-Behalf-Of draft specification.</span></span>

<span data-ttu-id="5ef5c-439">Para o cenário em que um aplicativo daemon precisa chamar uma API da Web, é importante entender algumas coisas.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-439">For the scenario when a daemon application needs to call a web API, it’s important to understand a few things.</span></span> <span data-ttu-id="5ef5c-440">Primeiro, a interação do usuário não é possível com um aplicativo daemon, que requer que o aplicativo tenha sua própria identidade.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-440">First, user interaction is not possible with a daemon application, which requires the application to have its own identity.</span></span> <span data-ttu-id="5ef5c-441">Um exemplo de um aplicativo daemon é um trabalho em lotes ou um serviço de sistema operacional sendo executado em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-441">An example of a daemon application is a batch job, or an operating system service running in the background.</span></span> <span data-ttu-id="5ef5c-442">Esse tipo de aplicativo solicita um token de acesso usando sua identidade de aplicativo e apresentando sua ID de Aplicativo, credenciais (senha ou certificado) e URI de ID do aplicativo para o Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-442">This type of application requests an access token by using its application identity and presenting its Application ID, credential (password or certificate), and application ID URI to Azure AD.</span></span> <span data-ttu-id="5ef5c-443">Após a autenticação bem-sucedida, o daemon recebe um token de acesso do Azure AD, que é usado para chamar a API da Web.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-443">After successful authentication, the daemon receives an access token from Azure AD, which is then used to call the web API.</span></span>

<span data-ttu-id="5ef5c-444">Para o cenário em que um aplicativo de servidor precisa chamar uma API da Web, é útil usar um exemplo.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-444">For the scenario when a server application needs to call a web API, it’s helpful to use an example.</span></span> <span data-ttu-id="5ef5c-445">Imagine que um usuário tenha se autenticado em um aplicativo nativo e que esse aplicativo nativo precisa chamar uma API da Web.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-445">Imagine that a user has authenticated on a native application, and this native application needs to call a web API.</span></span> <span data-ttu-id="5ef5c-446">O Azure AD emite um token de acesso JWT para chamar a API da Web.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-446">Azure AD issues a JWT access token to call the web API.</span></span> <span data-ttu-id="5ef5c-447">Se a API da Web precisar chamar outra API da Web de downstream, ele pode usar o fluxo on-behalf-of para delegar a identidade do usuário e se autenticar à API da Web de segunda camada.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-447">If the web API needs to call another downstream web API, it can use the on-behalf-of flow to delegate the user’s identity and authenticate to the second-tier web API.</span></span>

#### <a name="diagram"></a><span data-ttu-id="5ef5c-448">Diagrama</span><span class="sxs-lookup"><span data-stu-id="5ef5c-448">Diagram</span></span>
![Aplicativo Daemon ou de servidor para diagrama da API da Web](./media/active-directory-authentication-scenarios/daemon_server_app_to_web_api.png)

#### <a name="description-of-protocol-flow"></a><span data-ttu-id="5ef5c-450">Descrição do fluxo de protocolo</span><span class="sxs-lookup"><span data-stu-id="5ef5c-450">Description of Protocol Flow</span></span>
##### <a name="application-identity-with-oauth-20-client-credentials-grant"></a><span data-ttu-id="5ef5c-451">Identidade do aplicativo com concessão de credenciais do cliente OAuth 2.0</span><span class="sxs-lookup"><span data-stu-id="5ef5c-451">Application Identity with OAuth 2.0 Client Credentials Grant</span></span>
1. <span data-ttu-id="5ef5c-452">Primeiro, o aplicativo de servidor precisa se autenticar no Azure AD ele mesmo, sem qualquer interação humana, como uma caixa de diálogo de logon interativa.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-452">First, the server application needs to authenticate with Azure AD as itself, without any human interaction such as an interactive sign-on dialog.</span></span> <span data-ttu-id="5ef5c-453">Ele faz uma solicitação ao ponto de extremidade do token do Azure AD, fornecendo a credencial, a ID do Aplicativo e o URI de ID do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-453">It makes a request to Azure AD’s token endpoint, providing the credential, Application ID, and application ID URI.</span></span>
2. <span data-ttu-id="5ef5c-454">O Azure AD autentica o aplicativo e retorna um token de acesso JWT que é usado para chamar a API da Web.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-454">Azure AD authenticates the application and returns a JWT access token that is used to call the web API.</span></span>
3. <span data-ttu-id="5ef5c-455">Via HTTPS, o aplicativo Web usa o token de acesso JWT retornado para adicionar a cadeia de caracteres JWT com uma designação de "Portador" no cabeçalho de autorização da solicitação à API da Web.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-455">Over HTTPS, the web application uses the returned JWT access token to add the JWT string with a “Bearer” designation in the Authorization header of the request to the web API.</span></span> <span data-ttu-id="5ef5c-456">A API da Web, em seguida, valida o token JWT e, se a validação for bem-sucedida, retorna o recurso desejado.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-456">The web API then validates the JWT token, and if validation is successful, returns the desired resource.</span></span>

##### <a name="delegated-user-identity-with-oauth-20-on-behalf-of-draft-specification"></a><span data-ttu-id="5ef5c-457">Identidade de usuário delegado com a especificação de rascunho do OAuth 2.0 On-Behalf-Of</span><span class="sxs-lookup"><span data-stu-id="5ef5c-457">Delegated User Identity with OAuth 2.0 On-Behalf-Of Draft Specification</span></span>
<span data-ttu-id="5ef5c-458">O fluxo discutido abaixo pressupõe que um usuário tenha sido autenticado em outro aplicativo (como um aplicativo nativo) e sua identidade de usuário tiver sido usada para adquirir um token de acesso à API da Web de primeira camada.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-458">The flow discussed below assumes that a user has been authenticated on another application (such as a native application), and their user identity has been used to acquire an access token to the first-tier web API.</span></span>

1. <span data-ttu-id="5ef5c-459">O aplicativo nativo envia o token de acesso à API da Web de primeira camada.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-459">The native application sends the access token to the first-tier web API.</span></span>
2. <span data-ttu-id="5ef5c-460">A API da Web de primeira camada envia uma solicitação ao ponto de extremidade do token do Azure AD, fornecendo sua ID de Aplicativo e as credenciais, bem como o token de acesso do usuário.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-460">The first-tier web API sends a request to Azure AD’s token endpoint, providing its Application ID and credentials, as well as the user’s access token.</span></span> <span data-ttu-id="5ef5c-461">Além disso, a solicitação é enviada com um parâmetro on_behalf_of que indica que a API da Web está solicitando novos tokens para chamar uma API da Web downstream em nome do usuário original.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-461">In addition, the request is sent with an on_behalf_of parameter that indicates the web API is requesting new tokens to call a downstream web API on behalf of the original user.</span></span>
3. <span data-ttu-id="5ef5c-462">O Azure AD verifica se a API da Web de primeira camada tem permissões para acessar a API da Web de segunda camada e valida a solicitação, retornando um token de acesso JWT e um token de atualização JWT para a API da Web de primeira camada.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-462">Azure AD verifies that the first-tier web API has permissions to access the second-tier web API and validates the request, returning a JWT access token and a JWT refresh token to the first-tier web API.</span></span>
4. <span data-ttu-id="5ef5c-463">Via HTTPS, a API da Web de primeira camada chama a API da Web de segunda camada, acrescentando a cadeia de caracteres do token no cabeçalho de autorização na solicitação.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-463">Over HTTPS, the first-tier web API then calls the second-tier web API by appending the token string in the Authorization header in the request.</span></span> <span data-ttu-id="5ef5c-464">A API da Web de primeira camada pode continuar a chamar a API da Web de segunda camada, desde que o token de acesso e os tokens de atualização sejam válidos.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-464">The first-tier web API can continue to call the second-tier web API as long as the access token and refresh tokens are valid.</span></span>

#### <a name="code-samples"></a><span data-ttu-id="5ef5c-465">Exemplos de código</span><span class="sxs-lookup"><span data-stu-id="5ef5c-465">Code Samples</span></span>
<span data-ttu-id="5ef5c-466">Consulte os exemplos de código para os cenários de aplicativo daemon ou de servidor para API da Web.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-466">See the code samples for Daemon or Server Application to Web API scenarios.</span></span> <span data-ttu-id="5ef5c-467">Além disso, volte com frequência, adicionamos novos exemplos o tempo todo.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-467">And, check back frequently -- we add new samples all the time.</span></span> [<span data-ttu-id="5ef5c-468">Aplicativo daemon ou de servidor para API da Web</span><span class="sxs-lookup"><span data-stu-id="5ef5c-468">Server or Daemon Application to Web API</span></span>](active-directory-code-samples.md#server-or-daemon-application-to-web-api)

#### <a name="registering"></a><span data-ttu-id="5ef5c-469">Registro</span><span class="sxs-lookup"><span data-stu-id="5ef5c-469">Registering</span></span>
* <span data-ttu-id="5ef5c-470">Locatário único: para a identidade do aplicativo e casos de identidade de usuário delegado, o aplicativo daemon ou de servidor deve ser registrado no mesmo diretório no Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-470">Single Tenant: For both the application identity and delegated user identity cases, the daemon or server application must be registered in the same directory in Azure AD.</span></span> <span data-ttu-id="5ef5c-471">A API da Web pode ser configurada para expor um conjunto de permissões, que são usadas para limitar o acesso do daemon ou do servidor a seus recursos.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-471">The web API can be configured to expose a set of permissions, which are used to limit the daemon or server’s access to its resources.</span></span> <span data-ttu-id="5ef5c-472">Se um tipo de identidade de usuário delegado estiver sendo usado, o aplicativo de servidor precisará selecionar as permissões desejadas no menu suspenso "Permissões para Outros Aplicativos" no Portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-472">If a delegated user identity type is being used, the server application needs to select the desired permissions from the “Permissions to Other Applications” drop-down menu in the Azure Portal.</span></span> <span data-ttu-id="5ef5c-473">Essa etapa não será necessária se o tipo de identidade de aplicativo estiver sendo usado.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-473">This step is not required if the application identity type is being used.</span></span>
* <span data-ttu-id="5ef5c-474">Multilocatário: Primeiro, o aplicativo deamon ou de servidor é configurado para indicar as permissões necessárias para que seja funcional.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-474">Multi-Tenant: First, the daemon or server application is configured to indicate the permissions it requires to be functional.</span></span> <span data-ttu-id="5ef5c-475">Essa lista de permissões necessárias é mostrada em uma caixa de diálogo quando um usuário ou administrador no diretório de destino dá consentimento para o aplicativo, o que o torna disponível para sua organização.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-475">This list of required permissions is shown in a dialog when a user or administrator in the destination directory gives consent to the application, which makes it available to their organization.</span></span> <span data-ttu-id="5ef5c-476">Alguns aplicativos exigem apenas permissões de nível de usuário, que qualquer usuário na organização pode conceder.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-476">Some applications require just user-level permissions, which any user in the organization can consent to.</span></span> <span data-ttu-id="5ef5c-477">Outros aplicativos exigem permissões de nível administrativo, que um usuário na organização não pode conceder.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-477">Other applications require administrator-level permissions, which a user in the organization cannot consent to.</span></span> <span data-ttu-id="5ef5c-478">Somente um administrador do diretório pode dar consentimento para aplicativos que exigem esse nível de permissões.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-478">Only a directory administrator can give consent to applications that require this level of permissions.</span></span> <span data-ttu-id="5ef5c-479">Quando o usuário ou administrador concede permissão, ambas as APIs Web são registradas no diretório delas.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-479">When the user or administrator consents, both of the web APIs are registered in their directory.</span></span>

#### <a name="token-expiration"></a><span data-ttu-id="5ef5c-480">Expiração do token</span><span class="sxs-lookup"><span data-stu-id="5ef5c-480">Token Expiration</span></span>
<span data-ttu-id="5ef5c-481">Quando o primeiro aplicativo usa seu código de autorização para obter um token de acesso JWT, ele também recebe um token de atualização JWT.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-481">When the first application uses its authorization code to get a JWT access token, it also receives a JWT refresh token.</span></span> <span data-ttu-id="5ef5c-482">Quando o token de acesso expira, o token de atualização pode ser usado para autenticar o usuário novamente sem solicitar credenciais.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-482">When the access token expires, the refresh token can be used to re-authenticate the user without prompting for credentials.</span></span> <span data-ttu-id="5ef5c-483">Esse token de atualização é usado para autenticar o usuário, o que resulta em um novo token de acesso e token de atualização.</span><span class="sxs-lookup"><span data-stu-id="5ef5c-483">This refresh token is then used to authenticate the user, which results in a new access token and refresh token.</span></span>

## <a name="see-also"></a><span data-ttu-id="5ef5c-484">Consulte também</span><span class="sxs-lookup"><span data-stu-id="5ef5c-484">See Also</span></span>
[<span data-ttu-id="5ef5c-485">Guia do desenvolvedor do Active Directory do Azure</span><span class="sxs-lookup"><span data-stu-id="5ef5c-485">Azure Active Directory Developer's Guide</span></span>](active-directory-developers-guide.md)

[<span data-ttu-id="5ef5c-486">Exemplos de código do Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="5ef5c-486">Azure Active Directory Code Samples</span></span>](active-directory-code-samples.md)

[<span data-ttu-id="5ef5c-487">Informações importantes sobre a substituição da chave de assinatura no Azure AD</span><span class="sxs-lookup"><span data-stu-id="5ef5c-487">Important Information About Signing Key Rollover in Azure AD</span></span>](active-directory-signing-key-rollover.md)

[<span data-ttu-id="5ef5c-488">OAuth 2.0 no Azure AD</span><span class="sxs-lookup"><span data-stu-id="5ef5c-488">OAuth 2.0 in Azure AD</span></span>](https://msdn.microsoft.com/library/azure/dn645545.aspx)

