---
title: "Escopos, permissões e consentimento do Azure Active Directory v2.0 | Microsoft Docs"
description: "Uma descrição da autorização no ponto de extremidade v2.0 do Azure AD, incluindo escopos, permissões e consentimento."
services: active-directory
documentationcenter: 
author: dstrockis
manager: mbaldwin
editor: 
ms.assetid: 8f98cbf0-a71d-4e34-babf-e644ad9ff423
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/07/2017
ms.author: dastrock
ms.custom: aaddev
ms.openlocfilehash: 04869a7627ecb3e6a0d11733fae7da2ecb04ed51
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="scopes-permissions-and-consent-in-the-azure-active-directory-v20-endpoint"></a><span data-ttu-id="69dd6-103">Escopos, permissões e consentimento no ponto de extremidade v2.0 do Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="69dd6-103">Scopes, permissions, and consent in the Azure Active Directory v2.0 endpoint</span></span>
<span data-ttu-id="69dd6-104">Os aplicativos que se integram ao Azure AD (Azure Active Directory) seguem um modelo de autorização que fornece aos usuários controle sobre como um aplicativo pode acessar seus dados.</span><span class="sxs-lookup"><span data-stu-id="69dd6-104">Apps that integrate with Azure Active Directory (Azure AD) follow an authorization model that gives users control over how an app can access their data.</span></span> <span data-ttu-id="69dd6-105">A implementação v2.0 desse modelo de autorização foi atualizada e altera a maneira como um aplicativo deve interagir com o Azure AD.</span><span class="sxs-lookup"><span data-stu-id="69dd6-105">The v2.0 implementation of the authorization model has been updated, and it changes how an app must interact with Azure AD.</span></span> <span data-ttu-id="69dd6-106">Este artigo aborda os conceitos básicos deste modelo de autorização, incluindo escopos, permissões e consentimento.</span><span class="sxs-lookup"><span data-stu-id="69dd6-106">This article covers the basic concepts of this authorization model, including scopes, permissions, and consent.</span></span>

> [!NOTE]
> <span data-ttu-id="69dd6-107">O ponto de extremidade v2.0 não dá suporte a todos os cenários e recursos do Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="69dd6-107">The v2.0 endpoint does not support all Azure Active Directory scenarios and features.</span></span> <span data-ttu-id="69dd6-108">Para determinar se você deve usar o ponto de extremidade v2.0, leia sobre as [limitações da v2.0](active-directory-v2-limitations.md).</span><span class="sxs-lookup"><span data-stu-id="69dd6-108">To determine whether you should use the v2.0 endpoint, read about [v2.0 limitations](active-directory-v2-limitations.md).</span></span>
>
>

## <a name="scopes-and-permissions"></a><span data-ttu-id="69dd6-109">Permissões e escopos</span><span class="sxs-lookup"><span data-stu-id="69dd6-109">Scopes and permissions</span></span>
<span data-ttu-id="69dd6-110">O Azure AD implementa o protocolo de autorização [OAuth 2.0](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="69dd6-110">Azure AD implements the [OAuth 2.0](active-directory-v2-protocols.md) authorization protocol.</span></span> <span data-ttu-id="69dd6-111">O OAuth 2.0 é um método pelo qual um aplicativo de terceiros pode acessar recursos hospedados na Web em nome do usuário.</span><span class="sxs-lookup"><span data-stu-id="69dd6-111">OAuth 2.0 is a method through which a third-party app can access web-hosted resources on behalf of a user.</span></span> <span data-ttu-id="69dd6-112">Qualquer recurso hospedado na Web que se integre ao Azure AD terá um identificador de recurso, ou *URI de ID de Aplicativo*.</span><span class="sxs-lookup"><span data-stu-id="69dd6-112">Any web-hosted resource that integrates with Azure AD has a resource identifier, or *Application ID URI*.</span></span> <span data-ttu-id="69dd6-113">Por exemplo, alguns dos recursos hospedados na Web da Microsoft incluem:</span><span class="sxs-lookup"><span data-stu-id="69dd6-113">For example, some of Microsoft's web-hosted resources include:</span></span>

* <span data-ttu-id="69dd6-114">A API de Email Unificado do Office 365: `https://outlook.office.com`</span><span class="sxs-lookup"><span data-stu-id="69dd6-114">The Office 365 Unified Mail API: `https://outlook.office.com`</span></span>
* <span data-ttu-id="69dd6-115">A Graph API do AD do Azure: `https://graph.windows.net`</span><span class="sxs-lookup"><span data-stu-id="69dd6-115">The Azure AD Graph API: `https://graph.windows.net`</span></span>
* <span data-ttu-id="69dd6-116">Microsoft Graph: `https://graph.microsoft.com`</span><span class="sxs-lookup"><span data-stu-id="69dd6-116">Microsoft Graph: `https://graph.microsoft.com`</span></span>

<span data-ttu-id="69dd6-117">Isso se aplica a todos os recursos de terceiros que se integraram ao Azure AD.</span><span class="sxs-lookup"><span data-stu-id="69dd6-117">The same is true for any third-party resources that have integrated with Azure AD.</span></span> <span data-ttu-id="69dd6-118">Qualquer um desses recursos também pode definir um conjunto de permissões que pode ser usado para dividir a funcionalidade desse recurso em partes menores.</span><span class="sxs-lookup"><span data-stu-id="69dd6-118">Any of these resources also can define a set of permissions that can be used to divide the functionality of that resource into smaller chunks.</span></span> <span data-ttu-id="69dd6-119">Por exemplo, o [Microsoft Graph](https://graph.microsoft.io) definiu permissões para realizar as seguintes tarefas, entre outras:</span><span class="sxs-lookup"><span data-stu-id="69dd6-119">As an example, [Microsoft Graph](https://graph.microsoft.io) has defined permissions to do the following tasks, among others:</span></span>

* <span data-ttu-id="69dd6-120">Ler o calendário de um usuário</span><span class="sxs-lookup"><span data-stu-id="69dd6-120">Read a user's calendar</span></span>
* <span data-ttu-id="69dd6-121">Escrever no calendário de um usuário</span><span class="sxs-lookup"><span data-stu-id="69dd6-121">Write to a user's calendar</span></span>
* <span data-ttu-id="69dd6-122">Enviar email como um usuário</span><span class="sxs-lookup"><span data-stu-id="69dd6-122">Send mail as a user</span></span>

<span data-ttu-id="69dd6-123">Definindo esses tipos de permissões, o recurso tem controle refinado sobre seus dados e como os dados são expostos.</span><span class="sxs-lookup"><span data-stu-id="69dd6-123">By defining these types of permissions, the resource has fine-grained control over its data and how the data is exposed.</span></span> <span data-ttu-id="69dd6-124">Um aplicativo de terceiros pode solicitar essas permissões de um usuário do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="69dd6-124">A third-party app can request these permissions from an app user.</span></span> <span data-ttu-id="69dd6-125">O usuário do aplicativo deverá aprovar as permissões para que o aplicativo possa agir em nome do usuário.</span><span class="sxs-lookup"><span data-stu-id="69dd6-125">The app user must approve the permissions before the app can act on the user's behalf.</span></span> <span data-ttu-id="69dd6-126">Ao dividir a funcionalidade do recurso em conjuntos menores de permissão, os aplicativos de terceiros podem ser criados para solicitar apenas as permissões específicas que eles precisam para realizar suas funções.</span><span class="sxs-lookup"><span data-stu-id="69dd6-126">By chunking the resource's functionality into smaller permission sets, third-party apps can be built to request only the specific permissions that they need to perform their function.</span></span> <span data-ttu-id="69dd6-127">Agora, os usuários do aplicativo saber exatamente como um aplicativo usará seus dados, de modo que eles se sentem mais seguros de que o aplicativo não está se comportando com más intenções.</span><span class="sxs-lookup"><span data-stu-id="69dd6-127">App users can know exactly how an app will use their data, and they can be more confident that the app is not behaving with malicious intent.</span></span>

<span data-ttu-id="69dd6-128">No Azure AD e no OAuth, esses tipos de permissões são chamados de *escopos*.</span><span class="sxs-lookup"><span data-stu-id="69dd6-128">In Azure AD and OAuth, these types of permissions are called *scopes*.</span></span> <span data-ttu-id="69dd6-129">Eles também são chamados de *oAuth2Permissions*.</span><span class="sxs-lookup"><span data-stu-id="69dd6-129">They also sometimes are referred to as *oAuth2Permissions*.</span></span> <span data-ttu-id="69dd6-130">Um escopo é representado no AD do Azure como um valor de cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="69dd6-130">A scope is represented in Azure AD as a string value.</span></span> <span data-ttu-id="69dd6-131">Continuando com o exemplo do Microsoft Graph,o valor do escopo para cada permissão é:</span><span class="sxs-lookup"><span data-stu-id="69dd6-131">Continuing with the Microsoft Graph example, the scope value for each permission is:</span></span>

* <span data-ttu-id="69dd6-132">Ler o calendário de um usuário usando o `Calendar.Read`</span><span class="sxs-lookup"><span data-stu-id="69dd6-132">Read a user's calendar by using `Calendar.Read`</span></span>
* <span data-ttu-id="69dd6-133">Escrever no calendário de um usuário usando o `Mail.ReadWrite`</span><span class="sxs-lookup"><span data-stu-id="69dd6-133">Write to a user's calendar by using `Mail.ReadWrite`</span></span>
* <span data-ttu-id="69dd6-134">Enviar email como um usuário usando `Mail.Send`</span><span class="sxs-lookup"><span data-stu-id="69dd6-134">Send mail as a user using by `Mail.Send`</span></span>

<span data-ttu-id="69dd6-135">Um aplicativo pode solicitar essas permissões especificando os escopos em solicitações para o ponto de extremidade v2.0.</span><span class="sxs-lookup"><span data-stu-id="69dd6-135">An app can request these permissions by specifying the scopes in requests to the v2.0 endpoint.</span></span>

## <a name="openid-connect-scopes"></a><span data-ttu-id="69dd6-136">Escopos do OpenID Connect</span><span class="sxs-lookup"><span data-stu-id="69dd6-136">OpenID Connect scopes</span></span>
<span data-ttu-id="69dd6-137">A implementação v2.0 do OpenID Connect tem alguns escopos bem definidos que não se aplicam a nenhum recurso específico: `openid`, `email`, `profile` e `offline_access`.</span><span class="sxs-lookup"><span data-stu-id="69dd6-137">The v2.0 implementation of OpenID Connect has a few well-defined scopes that do not apply to a specific resource: `openid`, `email`, `profile`, and `offline_access`.</span></span>

### <a name="openid"></a><span data-ttu-id="69dd6-138">openid</span><span class="sxs-lookup"><span data-stu-id="69dd6-138">openid</span></span>
<span data-ttu-id="69dd6-139">Se um aplicativo fizer conexão usando o [OpenID Connect](active-directory-v2-protocols.md), ele deverá solicitar o escopo `openid`.</span><span class="sxs-lookup"><span data-stu-id="69dd6-139">If an app performs sign-in by using [OpenID Connect](active-directory-v2-protocols.md), it must request the `openid` scope.</span></span> <span data-ttu-id="69dd6-140">O escopo `openid` aparecerá na página de consentimento da conta corporativa como a permissão "Conectar você" e na página de consentimento da conta pessoal da Microsoft como a permissão "Exibir seu perfil e se conectar a aplicativos e serviços usando sua conta da Microsoft".</span><span class="sxs-lookup"><span data-stu-id="69dd6-140">The `openid` scope shows on the work account consent page as the "Sign you in" permission, and on the personal Microsoft account consent page as the "View your profile and connect to apps and services using your Microsoft account" permission.</span></span> <span data-ttu-id="69dd6-141">Com essa permissão, um aplicativo pode receber um identificador exclusivo para o usuário na forma da declaração `sub`.</span><span class="sxs-lookup"><span data-stu-id="69dd6-141">With this permission, an app can receive a unique identifier for the user in the form of the `sub` claim.</span></span> <span data-ttu-id="69dd6-142">Ele também fornece ao aplicativo acesso ao ponto de extremidade UserInfo.</span><span class="sxs-lookup"><span data-stu-id="69dd6-142">It also gives the app access to the UserInfo endpoint.</span></span> <span data-ttu-id="69dd6-143">O escopo `openid` também pode ser usado no ponto de extremidade v2.0 para adquirir tokens de ID, que podem ser usados para proteger chamadas HTTP entre diferentes componentes de um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="69dd6-143">The `openid` scope can be used at the v2.0 token endpoint to acquire ID tokens, which can be used to secure HTTP calls between different components of an app.</span></span>

### <a name="email"></a><span data-ttu-id="69dd6-144">email</span><span class="sxs-lookup"><span data-stu-id="69dd6-144">email</span></span>
<span data-ttu-id="69dd6-145">O escopo do `email` pode ser usado com o escopo do `openid` e com muitos outros.</span><span class="sxs-lookup"><span data-stu-id="69dd6-145">The `email` scope can be used with the `openid` scope and any others.</span></span> <span data-ttu-id="69dd6-146">Ele concede ao aplicativo acesso ao endereço de email principal do usuário na forma da declaração `email` .</span><span class="sxs-lookup"><span data-stu-id="69dd6-146">It gives the app access to the user's primary email address in the form of the `email` claim.</span></span> <span data-ttu-id="69dd6-147">A declaração `email` só será incluída nos tokens se um endereço de email estiver associado à conta de usuário, o que nem sempre é o caso.</span><span class="sxs-lookup"><span data-stu-id="69dd6-147">The `email` claim is included in a token only if an email address is associated with the user account, which is not always the case.</span></span> <span data-ttu-id="69dd6-148">Se estiver usando o escopo de `email`, seu aplicativo deverá estar preparado para lidar com casos em que a declaração `email` não existe no token.</span><span class="sxs-lookup"><span data-stu-id="69dd6-148">If it uses the `email` scope, your app should be prepared to handle a case in which the `email` claim does not exist in the token.</span></span>

### <a name="profile"></a><span data-ttu-id="69dd6-149">Perfil</span><span class="sxs-lookup"><span data-stu-id="69dd6-149">profile</span></span>
<span data-ttu-id="69dd6-150">O escopo do `profile` pode ser usado com o escopo do `openid` e com muitos outros.</span><span class="sxs-lookup"><span data-stu-id="69dd6-150">The `profile` scope can be used with the `openid` scope and any others.</span></span> <span data-ttu-id="69dd6-151">Ele fornece o acesso de aplicativo a uma quantidade substancial de informações sobre o usuário.</span><span class="sxs-lookup"><span data-stu-id="69dd6-151">It gives the app access to a substantial amount of information about the user.</span></span> <span data-ttu-id="69dd6-152">As informações que ele pode acessar incluem, mas sem limitação, o nome, sobrenome, nome de usuário preferido e ID de objeto.</span><span class="sxs-lookup"><span data-stu-id="69dd6-152">The information it can access includes, but is not limited to, the user's given name, surname, preferred username, and object ID.</span></span> <span data-ttu-id="69dd6-153">Para obter uma lista completa de declarações de perfil disponíveis no parâmetro id_tokens para um usuário específico, veja a [referência de tokens v2.0](active-directory-v2-tokens.md).</span><span class="sxs-lookup"><span data-stu-id="69dd6-153">For a complete list of the profile claims available in the id_tokens parameter for a specific user, see the [v2.0 tokens reference](active-directory-v2-tokens.md).</span></span>

### <a name="offlineaccess"></a><span data-ttu-id="69dd6-154">offline_access</span><span class="sxs-lookup"><span data-stu-id="69dd6-154">offline_access</span></span>
<span data-ttu-id="69dd6-155">O [escopo do `offline_access`](http://openid.net/specs/openid-connect-core-1_0.html#OfflineAccess) concede ao seu aplicativo acesso a recursos em nome do usuário por um longo período.</span><span class="sxs-lookup"><span data-stu-id="69dd6-155">The [`offline_access` scope](http://openid.net/specs/openid-connect-core-1_0.html#OfflineAccess) gives your app access to resources on behalf of the user for an extended time.</span></span> <span data-ttu-id="69dd6-156">Na página de consentimento de conta corporativa, esse escopo aparecerá como a permissão "Acessar dados a qualquer momento".</span><span class="sxs-lookup"><span data-stu-id="69dd6-156">On the work account consent page, this scope appears as the "Access your data anytime" permission.</span></span> <span data-ttu-id="69dd6-157">Na página de consentimento de conta pessoal da Microsoft, ele aparecerá como a permissão "Acessar dados a qualquer momento".</span><span class="sxs-lookup"><span data-stu-id="69dd6-157">On the personal Microsoft account consent page, it appears as the "Access your info anytime" permission.</span></span> <span data-ttu-id="69dd6-158">Quando um usuário aprovar o escopo `offline_access`, seu aplicativo poderá receber tokens de atualização do ponto de extremidade do token v2.0.</span><span class="sxs-lookup"><span data-stu-id="69dd6-158">When a user approves the `offline_access` scope, your app can receive refresh tokens from the v2.0 token endpoint.</span></span> <span data-ttu-id="69dd6-159">Os tokens de atualização têm uma vida longa.</span><span class="sxs-lookup"><span data-stu-id="69dd6-159">Refresh tokens are long-lived.</span></span> <span data-ttu-id="69dd6-160">Seu aplicativo pode obter novos tokens de acesso quando os mais antigos expirarem.</span><span class="sxs-lookup"><span data-stu-id="69dd6-160">Your app can get new access tokens as older ones expire.</span></span>

<span data-ttu-id="69dd6-161">Se o aplicativo não solicitar o escopo `offline_access`, ele não receberá tokens de atualização.</span><span class="sxs-lookup"><span data-stu-id="69dd6-161">If your app does not request the `offline_access` scope, it won't receive refresh tokens.</span></span> <span data-ttu-id="69dd6-162">Isso significa que, ao resgatar um código de autorização no [fluxo de código de autorização do OAuth 2.0](active-directory-v2-protocols.md), você só receberá de volta um token de acesso do ponto de extremidade `/token`.</span><span class="sxs-lookup"><span data-stu-id="69dd6-162">This means that when you redeem an authorization code in the [OAuth 2.0 authorization code flow](active-directory-v2-protocols.md), you'll receive only an access token from the `/token` endpoint.</span></span> <span data-ttu-id="69dd6-163">O token de acesso é válido por um curto período.</span><span class="sxs-lookup"><span data-stu-id="69dd6-163">The access token is valid for a short time.</span></span> <span data-ttu-id="69dd6-164">Geralmente, o token de acesso expira em uma hora.</span><span class="sxs-lookup"><span data-stu-id="69dd6-164">The access token usually expires in one hour.</span></span> <span data-ttu-id="69dd6-165">Nesse ponto, seu aplicativo precisa redirecionar o usuário novamente para o ponto de extremidade `/authorize` para obter um novo código de autorização.</span><span class="sxs-lookup"><span data-stu-id="69dd6-165">At that point, your app needs to redirect the user back to the `/authorize` endpoint to get a new authorization code.</span></span> <span data-ttu-id="69dd6-166">Durante esse redirecionamento, dependendo do tipo de aplicativo, o usuário poderá ou não precisar inserir suas credenciais novamente ou consentir de novo as permissões.</span><span class="sxs-lookup"><span data-stu-id="69dd6-166">During this redirect, depending on the type of app, the user might need to enter their credentials again or consent again to permissions.</span></span>

<span data-ttu-id="69dd6-167">Para saber mais sobre como obter e usar tokens de atualização, veja a [referência do protocolo v2.0](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="69dd6-167">For more information about how to get and use refresh tokens, see the [v2.0 protocol reference](active-directory-v2-protocols.md).</span></span>

## <a name="requesting-individual-user-consent"></a><span data-ttu-id="69dd6-168">Solicitando consentimento de usuário individual</span><span class="sxs-lookup"><span data-stu-id="69dd6-168">Requesting individual user consent</span></span>
<span data-ttu-id="69dd6-169">Em uma solicitação de autorização do [OpenID Connect ou OAuth 2.0](active-directory-v2-protocols.md), um aplicativo pode solicitar as permissões de que precisa usando o parâmetro de consulta `scope`.</span><span class="sxs-lookup"><span data-stu-id="69dd6-169">In an [OpenID Connect or OAuth 2.0](active-directory-v2-protocols.md) authorization request, an app can request the permissions it needs by using the `scope` query parameter.</span></span> <span data-ttu-id="69dd6-170">Por exemplo, quando um usuário entra em um aplicativo, o aplicativo envia uma solicitação como o exemplo a seguir (com quebras de linha adicionadas para legibilidade):</span><span class="sxs-lookup"><span data-stu-id="69dd6-170">For example, when a user signs in to an app, the app sends a request like the following example (with line breaks added for legibility):</span></span>

```
GET https://login.microsoftonline.com/common/oauth2/v2.0/authorize?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&response_type=code
&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F
&response_mode=query
&scope=
https%3A%2F%2Fgraph.microsoft.com%2Fcalendar.read%20
https%3A%2F%2Fgraph.microsoft.com%2Fmail.send
&state=12345
```

<span data-ttu-id="69dd6-171">O parâmetro `scope` é uma lista de escopos separados por espaço que o aplicativo está solicitando.</span><span class="sxs-lookup"><span data-stu-id="69dd6-171">The `scope` parameter is a space-separated list of scopes that the app is requesting.</span></span> <span data-ttu-id="69dd6-172">Cada escopo é indicado acrescentando o valor de escopo para o identificador do recurso (URI da ID de Aplicativo).</span><span class="sxs-lookup"><span data-stu-id="69dd6-172">Each scope is indicated by appending the scope value to the resource's identifier (the Application ID URI).</span></span> <span data-ttu-id="69dd6-173">No exemplo de solicitação, o aplicativo precisa de permissão para ler o calendário e enviar emails como o usuário.</span><span class="sxs-lookup"><span data-stu-id="69dd6-173">In the request example, the app needs permission to read the user's calendar and send mail as the user.</span></span>

<span data-ttu-id="69dd6-174">Depois que o usuário insere suas credenciais, o ponto de extremidade v2.0 verifica se há um registro correspondente do *consentimento de usuário*.</span><span class="sxs-lookup"><span data-stu-id="69dd6-174">After the user enters their credentials, the v2.0 endpoint checks for a matching record of *user consent*.</span></span> <span data-ttu-id="69dd6-175">Se o usuário não tiver consentido nenhuma das permissões solicitadas no passado, o ponto de extremidade v2.0 pedirá que o usuário as conceda.</span><span class="sxs-lookup"><span data-stu-id="69dd6-175">If the user has not consented to any of the requested permissions in the past, the v2.0 endpoint asks the user to grant the requested permissions.</span></span>

![Consentimento de conta de trabalho](../../media/active-directory-v2-flows/work_account_consent.png)

<span data-ttu-id="69dd6-177">Quando o usuário aprovar a permissão, o consentimento será registrado para que o usuário não tenha que consentir novamente em conexões subsequentes à conta.</span><span class="sxs-lookup"><span data-stu-id="69dd6-177">When the user approves the permission, the consent is recorded so that the user doesn't have to consent again on subsequent account sign-ins.</span></span>

## <a name="requesting-consent-for-an-entire-tenant"></a><span data-ttu-id="69dd6-178">Solicitando consentimento para um locatário inteiro</span><span class="sxs-lookup"><span data-stu-id="69dd6-178">Requesting consent for an entire tenant</span></span>
<span data-ttu-id="69dd6-179">Geralmente, quando uma organização adquire uma assinatura para um aplicativo ou uma licença, a organização deseja configurar totalmente o aplicativo para seus funcionários.</span><span class="sxs-lookup"><span data-stu-id="69dd6-179">Often, when an organization purchases a license or subscription for an application, the organization wants to fully provision the application for its employees.</span></span> <span data-ttu-id="69dd6-180">Como parte desse processo, um administrador pode autorizar que o aplicativo atue em nome de todos os funcionários.</span><span class="sxs-lookup"><span data-stu-id="69dd6-180">As part of this process, an administrator can grant consent for the application to act on behalf of any employee.</span></span> <span data-ttu-id="69dd6-181">Se o administrador concede permissão para o locatário inteiro, os funcionários da empresa não verá uma página de consentimento para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="69dd6-181">If the admin grants consent for the entire tenant, the organization's employees won't see a consent page for the application.</span></span>

<span data-ttu-id="69dd6-182">Para solicitar consentimento para todos os usuários em um locatário, seu aplicativo pode usar o ponto de extremidade de consentimento de administrador.</span><span class="sxs-lookup"><span data-stu-id="69dd6-182">To request consent for all users in a tenant, your app can use the admin consent endpoint.</span></span>

## <a name="admin-restricted-scopes"></a><span data-ttu-id="69dd6-183">Escopos restritos ao administrador</span><span class="sxs-lookup"><span data-stu-id="69dd6-183">Admin-restricted scopes</span></span>
<span data-ttu-id="69dd6-184">Algumas permissões de alto privilégio no ecossistema da Microsoft podem ser definidas como *restritas ao administrador*.</span><span class="sxs-lookup"><span data-stu-id="69dd6-184">Some high-privilege permissions in the Microsoft ecosystem can be set to *admin-restricted*.</span></span> <span data-ttu-id="69dd6-185">Exemplos desses tipos de escopos incluem as seguintes permissões:</span><span class="sxs-lookup"><span data-stu-id="69dd6-185">Examples of these kinds of scopes include the following permissions:</span></span>

* <span data-ttu-id="69dd6-186">Ler dados do diretório da organização usando `Directory.Read`</span><span class="sxs-lookup"><span data-stu-id="69dd6-186">Read an organization's directory data by using `Directory.Read`</span></span>
* <span data-ttu-id="69dd6-187">Gravar dados no diretório da organização usando o `Directory.ReadWrite`</span><span class="sxs-lookup"><span data-stu-id="69dd6-187">Write data to an organization's directory by using `Directory.ReadWrite`</span></span>
* <span data-ttu-id="69dd6-188">Ler grupos de segurança no diretório da organização usando o `Groups.Read.All`</span><span class="sxs-lookup"><span data-stu-id="69dd6-188">Read security groups in an organization's directory by using `Groups.Read.All`</span></span>

<span data-ttu-id="69dd6-189">Embora um usuário consumidor possa conceder acesso de aplicativo para esse tipo de dados, os usuários organizacionais são impedidos de conceder acesso ao mesmo conjunto de dados confidenciais da empresa.</span><span class="sxs-lookup"><span data-stu-id="69dd6-189">Although a consumer user might grant an application access to this kind of data, organizational users are restricted from granting access to the same set of sensitive company data.</span></span> <span data-ttu-id="69dd6-190">Se seu aplicativo solicita acesso a uma dessas permissões de um usuário organizacional, o usuário receberá uma mensagem de erro que diz que não está autorizado a consentir com as permissões de seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="69dd6-190">If your application requests access to one of these permissions from an organizational user, the user receives an error message that says they are not authorized to consent to your app's permissions.</span></span>

<span data-ttu-id="69dd6-191">Se seu aplicativo requer acesso a escopos restritos a administradores para as organizações, você deve solicitá-los diretamente de um administrador da empresa também usando o ponto de extremidade de consentimento do administrador descrito a seguir.</span><span class="sxs-lookup"><span data-stu-id="69dd6-191">If your app requires access to admin-restricted scopes for organizations, you should request them directly from a company administrator, also by using the admin consent endpoint, described next.</span></span>

<span data-ttu-id="69dd6-192">Quando um administrador concede essas permissões pelo ponto de extremidade de consentimento do administrador, a permissão é concedida para todos os usuários no locatário.</span><span class="sxs-lookup"><span data-stu-id="69dd6-192">When an administrator grants these permissions via the admin consent endpoint, consent is granted for all users in the tenant.</span></span>

## <a name="using-the-admin-consent-endpoint"></a><span data-ttu-id="69dd6-193">Usando o ponto de extremidade de consentimento do administrador</span><span class="sxs-lookup"><span data-stu-id="69dd6-193">Using the admin consent endpoint</span></span>
<span data-ttu-id="69dd6-194">Se você seguir estas etapas, seu aplicativo poderá obter permissões para todos os usuários em um locatário, incluindo escopos restringidos pelo administrador.</span><span class="sxs-lookup"><span data-stu-id="69dd6-194">If you follow these steps, your app can gather permissions for all users in a tenant, including admin-restricted scopes.</span></span> <span data-ttu-id="69dd6-195">Para obter um exemplo de código que implementa as etapas, veja o [exemplo de escopos restritos ao administrador](https://github.com/Azure-Samples/active-directory-dotnet-admin-restricted-scopes-v2).</span><span class="sxs-lookup"><span data-stu-id="69dd6-195">To see a code sample that implements the steps, see the [admin-restricted scopes sample](https://github.com/Azure-Samples/active-directory-dotnet-admin-restricted-scopes-v2).</span></span>

### <a name="request-the-permissions-in-the-app-registration-portal"></a><span data-ttu-id="69dd6-196">Solicitar as permissões no portal de registro do aplicativo</span><span class="sxs-lookup"><span data-stu-id="69dd6-196">Request the permissions in the app registration portal</span></span>
1. <span data-ttu-id="69dd6-197">Vá para seu aplicativo no [Portal de Registro de Aplicativo](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) ou [crie um aplicativo](active-directory-v2-app-registration.md) se ainda não tiver feito isso.</span><span class="sxs-lookup"><span data-stu-id="69dd6-197">Go to your application in the [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList), or [create an app](active-directory-v2-app-registration.md) if you haven't already.</span></span>
2. <span data-ttu-id="69dd6-198">Localize a seção **Permissões do Microsoft Graph** e adicione as permissões que seu aplicativo requer.</span><span class="sxs-lookup"><span data-stu-id="69dd6-198">Locate the **Microsoft Graph Permissions** section, and then add the permissions that your app requires.</span></span>
3. <span data-ttu-id="69dd6-199">**Salve** o registro do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="69dd6-199">Make sure you **Save** the app registration.</span></span>

### <a name="recommended-sign-the-user-in-to-your-app"></a><span data-ttu-id="69dd6-200">Recomendado: conectar o usuário ao aplicativo</span><span class="sxs-lookup"><span data-stu-id="69dd6-200">Recommended: Sign the user in to your app</span></span>
<span data-ttu-id="69dd6-201">Normalmente, quando você cria um aplicativo que usa o ponto de extremidade de consentimento do administrador, o aplicativo precisa de uma página ou de um modo de exibição em que o administrador possa aprovar as permissões do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="69dd6-201">Typically, when you build an application that uses the admin consent endpoint, the app needs a page or view in which the admin can approve the app's permissions.</span></span> <span data-ttu-id="69dd6-202">Essa página pode ser parte do fluxo de inscrição no aplicativo, parte das configurações do aplicativo ou um fluxo dedicado de "conexão".</span><span class="sxs-lookup"><span data-stu-id="69dd6-202">This page can be part of the app's sign-up flow, part of the app's settings, or it can be a dedicated "connect" flow.</span></span> <span data-ttu-id="69dd6-203">Em muitos casos, faz sentido que o aplicativo somente mostre o modo de exibição "conectar" depois que o usuário entra com uma conta corporativa ou de estudante da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="69dd6-203">In many cases, it makes sense for the app to show this "connect" view only after a user has signed in with a work or school Microsoft account.</span></span>

<span data-ttu-id="69dd6-204">Quando o usuário entra em seu aplicativo, você pode identificar a organização à qual o administrador pertence antes de pedir a ele que aprove as permissões necessárias.</span><span class="sxs-lookup"><span data-stu-id="69dd6-204">When you sign the user in to your app, you can identify the organization to which the admin belongs before asking them to approve the necessary permissions.</span></span> <span data-ttu-id="69dd6-205">Embora não seja estritamente necessário, isso pode ajudá-lo a criar uma experiência mais intuitiva para os usuários empresariais.</span><span class="sxs-lookup"><span data-stu-id="69dd6-205">Although not strictly necessary, it can help you create a more intuitive experience for your organizational users.</span></span> <span data-ttu-id="69dd6-206">Para conectar o usuário, siga nossos [tutoriais de protocolo v2.0](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="69dd6-206">To sign the user in, follow our [v2.0 protocol tutorials](active-directory-v2-protocols.md).</span></span>

### <a name="request-the-permissions-from-a-directory-admin"></a><span data-ttu-id="69dd6-207">Solicitar permissões de um administrador de diretório</span><span class="sxs-lookup"><span data-stu-id="69dd6-207">Request the permissions from a directory admin</span></span>
<span data-ttu-id="69dd6-208">Quando você estiver pronto para solicitar permissões de administrador da empresa, redirecione o usuário para o *ponto de extremidade de consentimento do administrador* v2.0.</span><span class="sxs-lookup"><span data-stu-id="69dd6-208">When you're ready to request permissions from your organization's admin, you can redirect the user to the v2.0 *admin consent endpoint*.</span></span>

```
// Line breaks are for legibility only.

GET https://login.microsoftonline.com/{tenant}/adminconsent?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&state=12345
&redirect_uri=http://localhost/myapp/permissions
```

```
// Pro tip: Try pasting the below request in a browser!
```

```
https://login.microsoftonline.com/common/adminconsent?client_id=6731de76-14a6-49ae-97bc-6eba6914391e&state=12345&redirect_uri=http://localhost/myapp/permissions
```

| <span data-ttu-id="69dd6-209">Parâmetro</span><span class="sxs-lookup"><span data-stu-id="69dd6-209">Parameter</span></span> | <span data-ttu-id="69dd6-210">Condição</span><span class="sxs-lookup"><span data-stu-id="69dd6-210">Condition</span></span> | <span data-ttu-id="69dd6-211">Descrição</span><span class="sxs-lookup"><span data-stu-id="69dd6-211">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="69dd6-212">locatário</span><span class="sxs-lookup"><span data-stu-id="69dd6-212">tenant</span></span> |<span data-ttu-id="69dd6-213">Obrigatório</span><span class="sxs-lookup"><span data-stu-id="69dd6-213">Required</span></span> |<span data-ttu-id="69dd6-214">O locatário do diretório para o qual você deseja solicitar permissão.</span><span class="sxs-lookup"><span data-stu-id="69dd6-214">The directory tenant that you want to request permission from.</span></span> <span data-ttu-id="69dd6-215">Pode ser fornecido no formato de nome amigável ou de GUID.</span><span class="sxs-lookup"><span data-stu-id="69dd6-215">Can be provided in GUID or friendly name format.</span></span> |
| <span data-ttu-id="69dd6-216">client_id</span><span class="sxs-lookup"><span data-stu-id="69dd6-216">client_id</span></span> |<span data-ttu-id="69dd6-217">Obrigatório</span><span class="sxs-lookup"><span data-stu-id="69dd6-217">Required</span></span> |<span data-ttu-id="69dd6-218">A ID de aplicativo do [Portal de Registro de Aplicativo](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) atribuída ao seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="69dd6-218">The Application ID that the [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) assigned to your app.</span></span> |
| <span data-ttu-id="69dd6-219">redirect_uri</span><span class="sxs-lookup"><span data-stu-id="69dd6-219">redirect_uri</span></span> |<span data-ttu-id="69dd6-220">Obrigatório</span><span class="sxs-lookup"><span data-stu-id="69dd6-220">Required</span></span> |<span data-ttu-id="69dd6-221">O URI de redirecionamento onde você deseja que a resposta seja enviada para ser tratada pelo aplicativo.</span><span class="sxs-lookup"><span data-stu-id="69dd6-221">The redirect URI where you want the response to be sent for your app to handle.</span></span> <span data-ttu-id="69dd6-222">Ela deve corresponder exatamente a um redirecionamento de URIs que você registrou no portal de registro de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="69dd6-222">It must exactly match one of the redirect URIs that you registered in the app registration portal.</span></span> |
| <span data-ttu-id="69dd6-223">state</span><span class="sxs-lookup"><span data-stu-id="69dd6-223">state</span></span> |<span data-ttu-id="69dd6-224">Recomendadas</span><span class="sxs-lookup"><span data-stu-id="69dd6-224">Recommended</span></span> |<span data-ttu-id="69dd6-225">Um valor incluído na solicitação também será retornado na resposta do token.</span><span class="sxs-lookup"><span data-stu-id="69dd6-225">A value included in the request that will also be returned in the token response.</span></span> <span data-ttu-id="69dd6-226">Pode ser uma cadeia de caracteres de qualquer conteúdo desejado.</span><span class="sxs-lookup"><span data-stu-id="69dd6-226">It can be a string of any content you want.</span></span> <span data-ttu-id="69dd6-227">Use o estado para codificar as informações sobre o estado do usuário no aplicativo antes da solicitação de autenticação ocorrida, como a página ou exibição em que ele estava.</span><span class="sxs-lookup"><span data-stu-id="69dd6-227">Use the state to encode information about the user's state in the app before the authentication request occurred, such as the page or view they were on.</span></span> |

<span data-ttu-id="69dd6-228">Neste ponto, o Azure AD requer um administrador de locatários para entrar e concluir a solicitação.</span><span class="sxs-lookup"><span data-stu-id="69dd6-228">At this point, Azure AD requires a tenant administrator to sign in to complete the request.</span></span> <span data-ttu-id="69dd6-229">O administrador deverá aprovar todas as permissões que você solicitou para o aplicativo no portal de registro de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="69dd6-229">The administrator is asked to approve all the permissions that you have requested for your app in the app registration portal.</span></span>

#### <a name="successful-response"></a><span data-ttu-id="69dd6-230">Resposta bem-sucedida</span><span class="sxs-lookup"><span data-stu-id="69dd6-230">Successful response</span></span>
<span data-ttu-id="69dd6-231">Se o administrador aprovar as permissões para o seu aplicativo, a resposta bem-sucedida será:</span><span class="sxs-lookup"><span data-stu-id="69dd6-231">If the admin approves the permissions for your app, the successful response looks like this:</span></span>

```
GET http://localhost/myapp/permissions?tenant=a8990e1f-ff32-408a-9f8e-78d3b9139b95&state=state=12345&admin_consent=True
```

| <span data-ttu-id="69dd6-232">Parâmetro</span><span class="sxs-lookup"><span data-stu-id="69dd6-232">Parameter</span></span> | <span data-ttu-id="69dd6-233">Descrição</span><span class="sxs-lookup"><span data-stu-id="69dd6-233">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="69dd6-234">locatário</span><span class="sxs-lookup"><span data-stu-id="69dd6-234">tenant</span></span> |<span data-ttu-id="69dd6-235">O locatário do diretório que concedeu as permissões solicitadas, no formato de GUID.</span><span class="sxs-lookup"><span data-stu-id="69dd6-235">The directory tenant that granted your application the permissions it requested, in GUID format.</span></span> |
| <span data-ttu-id="69dd6-236">state</span><span class="sxs-lookup"><span data-stu-id="69dd6-236">state</span></span> |<span data-ttu-id="69dd6-237">Um valor incluído na solicitação também será retornado na resposta do token.</span><span class="sxs-lookup"><span data-stu-id="69dd6-237">A value included in the request that also will be returned in the token response.</span></span> <span data-ttu-id="69dd6-238">Pode ser uma cadeia de caracteres de qualquer conteúdo desejado.</span><span class="sxs-lookup"><span data-stu-id="69dd6-238">It can be a string of any content you want.</span></span> <span data-ttu-id="69dd6-239">O estado é usado para codificar as informações sobre o estado do usuário no aplicativo antes da solicitação de autenticação ocorrida, como a página ou exibição em que ele estava.</span><span class="sxs-lookup"><span data-stu-id="69dd6-239">The state is used to encode information about the user's state in the app before the authentication request occurred, such as the page or view they were on.</span></span> |
| <span data-ttu-id="69dd6-240">admin_consent</span><span class="sxs-lookup"><span data-stu-id="69dd6-240">admin_consent</span></span> |<span data-ttu-id="69dd6-241">Será definido como **true**.</span><span class="sxs-lookup"><span data-stu-id="69dd6-241">Will be set to **true**.</span></span> |

#### <a name="error-response"></a><span data-ttu-id="69dd6-242">Resposta de erro</span><span class="sxs-lookup"><span data-stu-id="69dd6-242">Error response</span></span>
<span data-ttu-id="69dd6-243">Se o administrador não aprovar as permissões para o seu aplicativo, a resposta de falha será:</span><span class="sxs-lookup"><span data-stu-id="69dd6-243">If the admin does not approve the permissions for your app, the failed response looks like this:</span></span>

```
GET http://localhost/myapp/permissions?error=permission_denied&error_description=The+admin+canceled+the+request
```

| <span data-ttu-id="69dd6-244">Parâmetro</span><span class="sxs-lookup"><span data-stu-id="69dd6-244">Parameter</span></span> | <span data-ttu-id="69dd6-245">Descrição</span><span class="sxs-lookup"><span data-stu-id="69dd6-245">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="69dd6-246">error</span><span class="sxs-lookup"><span data-stu-id="69dd6-246">error</span></span> |<span data-ttu-id="69dd6-247">Uma cadeia de caracteres de códigos de erro que pode ser usada para classificar tipos de erro que ocorrem e pode ser usada para responder aos erros.</span><span class="sxs-lookup"><span data-stu-id="69dd6-247">An error code string that can be used to classify types of errors that occur, and can be used to react to errors.</span></span> |
| <span data-ttu-id="69dd6-248">error_description</span><span class="sxs-lookup"><span data-stu-id="69dd6-248">error_description</span></span> |<span data-ttu-id="69dd6-249">Uma mensagem de erro específica que pode ajudar um desenvolvedor a identificar a causa raiz de um erro.</span><span class="sxs-lookup"><span data-stu-id="69dd6-249">A specific error message that can help a developer identify the root cause of an error.</span></span> |

<span data-ttu-id="69dd6-250">Depois de receber uma resposta bem-sucedida do ponto de extremidade de consentimento do administrador, o aplicativo terá as permissões solicitadas por ele.</span><span class="sxs-lookup"><span data-stu-id="69dd6-250">After you've received a successful response from the admin consent endpoint, your app has gained the permissions it requested.</span></span> <span data-ttu-id="69dd6-251">Em seguida, você pode solicitar um token para o recurso desejado.</span><span class="sxs-lookup"><span data-stu-id="69dd6-251">Next, you can request a token for the resource you want.</span></span>

## <a name="using-permissions"></a><span data-ttu-id="69dd6-252">Usando permissões</span><span class="sxs-lookup"><span data-stu-id="69dd6-252">Using permissions</span></span>
<span data-ttu-id="69dd6-253">Depois que o usuário consente permissões para o aplicativo, este pode adquirir tokens de acesso que representam a permissão do seu aplicativo para acessar um recurso em alguma capacidade.</span><span class="sxs-lookup"><span data-stu-id="69dd6-253">After the user consents to permissions for your app, your app can acquire access tokens that represent your app's permission to access a resource in some capacity.</span></span> <span data-ttu-id="69dd6-254">Um token de acesso só pode ser usado para um único recurso, mas codificada dentro do token de acesso estará cada permissão que o aplicativo recebeu para esse recurso.</span><span class="sxs-lookup"><span data-stu-id="69dd6-254">An access token can be used only for a single resource, but encoded inside the access token is every permission that your app has been granted for that resource.</span></span> <span data-ttu-id="69dd6-255">Para adquirir um token de acesso, o aplicativo poderá fazer uma solicitação ao ponto de extremidade do token v2.0 como esta:</span><span class="sxs-lookup"><span data-stu-id="69dd6-255">To acquire an access token, your app can make a request to the v2.0 token endpoint, like this:</span></span>

```
POST common/oauth2/v2.0/token HTTP/1.1
Host: https://login.microsoftonline.com
Content-Type: application/json

{
    "grant_type": "authorization_code",
    "client_id": "6731de76-14a6-49ae-97bc-6eba6914391e",
    "scope": "https://outlook.office.com/mail.read https://outlook.office.com/mail.send",
    "code": "AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq..."
    "redirect_uri": "https://localhost/myapp",
    "client_secret": "zc53fwe80980293klaj9823"  // NOTE: Only required for web apps
}
```

<span data-ttu-id="69dd6-256">Você pode usar o token de acesso resultante em solicitações HTTP para o recurso.</span><span class="sxs-lookup"><span data-stu-id="69dd6-256">You can use the resulting access token in HTTP requests to the resource.</span></span> <span data-ttu-id="69dd6-257">Ele confiável indica ao recurso que seu aplicativo tem a permissão apropriada para executar uma tarefa específica.</span><span class="sxs-lookup"><span data-stu-id="69dd6-257">It reliably indicates to the resource that your app has the proper permission to perform a specific task.</span></span>  

<span data-ttu-id="69dd6-258">Para saber mais sobre o protocolo OAuth 2.0 e como obter tokens de acesso, consulte a [referência do protocolo do ponto de extremidade v2.0](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="69dd6-258">For more information about the OAuth 2.0 protocol and how to get access tokens, see the [v2.0 endpoint protocol reference](active-directory-v2-protocols.md).</span></span>
