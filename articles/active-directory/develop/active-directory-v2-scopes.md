---
title: "aaaAzure do Active Directory v 2.0 escopos, permissões e consentimento | Microsoft Docs"
description: "Uma descrição de autorização no ponto de extremidade v 2.0 de saudação do AD do Azure, incluindo escopos, permissões e consentimento."
services: active-directory
documentationcenter: 
author: dstrockis
manager: mbaldwin
editor: 
ms.assetid: 8f98cbf0-a71d-4e34-babf-e644ad9ff423
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/07/2017
ms.author: dastrock
ms.custom: aaddev
ms.openlocfilehash: 5721d368c435868bfb4ae91cff7fbb9bc4a79b66
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="scopes-permissions-and-consent-in-hello-azure-active-directory-v20-endpoint"></a><span data-ttu-id="a2e40-103">Escopos de permissões e consentimento no ponto de extremidade do hello Active Directory do Azure v 2.0</span><span class="sxs-lookup"><span data-stu-id="a2e40-103">Scopes, permissions, and consent in hello Azure Active Directory v2.0 endpoint</span></span>
<span data-ttu-id="a2e40-104">Os aplicativos que se integram ao Azure AD (Azure Active Directory) seguem um modelo de autorização que fornece aos usuários controle sobre como um aplicativo pode acessar seus dados.</span><span class="sxs-lookup"><span data-stu-id="a2e40-104">Apps that integrate with Azure Active Directory (Azure AD) follow an authorization model that gives users control over how an app can access their data.</span></span> <span data-ttu-id="a2e40-105">implementação de v 2.0 de saudação do modelo de autorização Olá foi atualizada e muda como um aplicativo deve interagir com o Azure AD.</span><span class="sxs-lookup"><span data-stu-id="a2e40-105">hello v2.0 implementation of hello authorization model has been updated, and it changes how an app must interact with Azure AD.</span></span> <span data-ttu-id="a2e40-106">Este artigo aborda os conceitos básicos de saudação desse modelo de autorização, incluindo escopos, permissões e consentimento.</span><span class="sxs-lookup"><span data-stu-id="a2e40-106">This article covers hello basic concepts of this authorization model, including scopes, permissions, and consent.</span></span>

> [!NOTE]
> <span data-ttu-id="a2e40-107">o ponto de extremidade do Hello v 2.0 não oferece suporte a todos os recursos e cenários de Active Directory do Azure.</span><span class="sxs-lookup"><span data-stu-id="a2e40-107">hello v2.0 endpoint does not support all Azure Active Directory scenarios and features.</span></span> <span data-ttu-id="a2e40-108">toodetermine se você deve usar o ponto de extremidade de v 2.0 hello, leia sobre [limitações v 2.0](active-directory-v2-limitations.md).</span><span class="sxs-lookup"><span data-stu-id="a2e40-108">toodetermine whether you should use hello v2.0 endpoint, read about [v2.0 limitations](active-directory-v2-limitations.md).</span></span>
>
>

## <a name="scopes-and-permissions"></a><span data-ttu-id="a2e40-109">Permissões e escopos</span><span class="sxs-lookup"><span data-stu-id="a2e40-109">Scopes and permissions</span></span>
<span data-ttu-id="a2e40-110">O AD do Azure implementa Olá [OAuth 2.0](active-directory-v2-protocols.md) protocolo de autorização.</span><span class="sxs-lookup"><span data-stu-id="a2e40-110">Azure AD implements hello [OAuth 2.0](active-directory-v2-protocols.md) authorization protocol.</span></span> <span data-ttu-id="a2e40-111">O OAuth 2.0 é um método pelo qual um aplicativo de terceiros pode acessar recursos hospedados na Web em nome do usuário.</span><span class="sxs-lookup"><span data-stu-id="a2e40-111">OAuth 2.0 is a method through which a third-party app can access web-hosted resources on behalf of a user.</span></span> <span data-ttu-id="a2e40-112">Qualquer recurso hospedado na Web que se integre ao Azure AD terá um identificador de recurso, ou *URI de ID de Aplicativo*.</span><span class="sxs-lookup"><span data-stu-id="a2e40-112">Any web-hosted resource that integrates with Azure AD has a resource identifier, or *Application ID URI*.</span></span> <span data-ttu-id="a2e40-113">Por exemplo, alguns dos recursos hospedados na Web da Microsoft incluem:</span><span class="sxs-lookup"><span data-stu-id="a2e40-113">For example, some of Microsoft's web-hosted resources include:</span></span>

* <span data-ttu-id="a2e40-114">Olá API do Office 365 Unificação de mensagens:`https://outlook.office.com`</span><span class="sxs-lookup"><span data-stu-id="a2e40-114">hello Office 365 Unified Mail API: `https://outlook.office.com`</span></span>
* <span data-ttu-id="a2e40-115">Olá API do Azure AD Graph:`https://graph.windows.net`</span><span class="sxs-lookup"><span data-stu-id="a2e40-115">hello Azure AD Graph API: `https://graph.windows.net`</span></span>
* <span data-ttu-id="a2e40-116">Microsoft Graph: `https://graph.microsoft.com`</span><span class="sxs-lookup"><span data-stu-id="a2e40-116">Microsoft Graph: `https://graph.microsoft.com`</span></span>

<span data-ttu-id="a2e40-117">Olá que mesmo é verdadeiro para todos os recursos de terceiros que foram integrados ao AD do Azure.</span><span class="sxs-lookup"><span data-stu-id="a2e40-117">hello same is true for any third-party resources that have integrated with Azure AD.</span></span> <span data-ttu-id="a2e40-118">Além disso, qualquer um desses recursos pode definir um conjunto de permissões que podem ser usados toodivide a funcionalidade de saudação do recurso em partes menores.</span><span class="sxs-lookup"><span data-stu-id="a2e40-118">Any of these resources also can define a set of permissions that can be used toodivide hello functionality of that resource into smaller chunks.</span></span> <span data-ttu-id="a2e40-119">Por exemplo, [Microsoft Graph](https://graph.microsoft.io) definiu Olá de toodo permissões seguintes tarefas, entre outros:</span><span class="sxs-lookup"><span data-stu-id="a2e40-119">As an example, [Microsoft Graph](https://graph.microsoft.io) has defined permissions toodo hello following tasks, among others:</span></span>

* <span data-ttu-id="a2e40-120">Ler o calendário de um usuário</span><span class="sxs-lookup"><span data-stu-id="a2e40-120">Read a user's calendar</span></span>
* <span data-ttu-id="a2e40-121">Gravação tooa calendário de usuário</span><span class="sxs-lookup"><span data-stu-id="a2e40-121">Write tooa user's calendar</span></span>
* <span data-ttu-id="a2e40-122">Enviar email como um usuário</span><span class="sxs-lookup"><span data-stu-id="a2e40-122">Send mail as a user</span></span>

<span data-ttu-id="a2e40-123">Ao definir esses tipos de permissões, o recurso de saudação tem controle refinado sobre seus dados e como os dados de saudação são expostos.</span><span class="sxs-lookup"><span data-stu-id="a2e40-123">By defining these types of permissions, hello resource has fine-grained control over its data and how hello data is exposed.</span></span> <span data-ttu-id="a2e40-124">Um aplicativo de terceiros pode solicitar essas permissões de um usuário do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a2e40-124">A third-party app can request these permissions from an app user.</span></span> <span data-ttu-id="a2e40-125">usuário do aplicativo Hello deve aprovar permissões Olá antes que o aplicativo hello pode agir em nome do usuário hello.</span><span class="sxs-lookup"><span data-stu-id="a2e40-125">hello app user must approve hello permissions before hello app can act on hello user's behalf.</span></span> <span data-ttu-id="a2e40-126">A funcionalidade do recurso de saudação em conjuntos menores de agrupamento, aplicativos de terceiros podem ser criados toorequest somente Olá permissões específicas que precisam tooperform sua função.</span><span class="sxs-lookup"><span data-stu-id="a2e40-126">By chunking hello resource's functionality into smaller permission sets, third-party apps can be built toorequest only hello specific permissions that they need tooperform their function.</span></span> <span data-ttu-id="a2e40-127">Os usuários do aplicativo podem saber exatamente como um aplicativo usará seus dados e podem ser mais seguro que o aplicativo hello não está se comportando mal-intencionadas.</span><span class="sxs-lookup"><span data-stu-id="a2e40-127">App users can know exactly how an app will use their data, and they can be more confident that hello app is not behaving with malicious intent.</span></span>

<span data-ttu-id="a2e40-128">No Azure AD e no OAuth, esses tipos de permissões são chamados de *escopos*.</span><span class="sxs-lookup"><span data-stu-id="a2e40-128">In Azure AD and OAuth, these types of permissions are called *scopes*.</span></span> <span data-ttu-id="a2e40-129">Às vezes também forem chamados tooas *oAuth2Permissions*.</span><span class="sxs-lookup"><span data-stu-id="a2e40-129">They also sometimes are referred tooas *oAuth2Permissions*.</span></span> <span data-ttu-id="a2e40-130">Um escopo é representado no AD do Azure como um valor de cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="a2e40-130">A scope is represented in Azure AD as a string value.</span></span> <span data-ttu-id="a2e40-131">Continuando com o exemplo do Microsoft Graph hello, valor de escopo de saudação para cada permissão é:</span><span class="sxs-lookup"><span data-stu-id="a2e40-131">Continuing with hello Microsoft Graph example, hello scope value for each permission is:</span></span>

* <span data-ttu-id="a2e40-132">Ler o calendário de um usuário usando o `Calendar.Read`</span><span class="sxs-lookup"><span data-stu-id="a2e40-132">Read a user's calendar by using `Calendar.Read`</span></span>
* <span data-ttu-id="a2e40-133">Gravar tooa calendário de usuário usando`Mail.ReadWrite`</span><span class="sxs-lookup"><span data-stu-id="a2e40-133">Write tooa user's calendar by using `Mail.ReadWrite`</span></span>
* <span data-ttu-id="a2e40-134">Enviar email como um usuário usando `Mail.Send`</span><span class="sxs-lookup"><span data-stu-id="a2e40-134">Send mail as a user using by `Mail.Send`</span></span>

<span data-ttu-id="a2e40-135">Um aplicativo pode solicitar essas permissões, especificando escopos Olá no ponto de extremidade solicitações toohello v 2.0.</span><span class="sxs-lookup"><span data-stu-id="a2e40-135">An app can request these permissions by specifying hello scopes in requests toohello v2.0 endpoint.</span></span>

## <a name="openid-connect-scopes"></a><span data-ttu-id="a2e40-136">Escopos do OpenID Connect</span><span class="sxs-lookup"><span data-stu-id="a2e40-136">OpenID Connect scopes</span></span>
<span data-ttu-id="a2e40-137">Olá v 2.0 implementação OpenID Connect tem alguns escopos bem definidos que não se aplicam a recursos específicos de tooa: `openid`, `email`, `profile`, e `offline_access`.</span><span class="sxs-lookup"><span data-stu-id="a2e40-137">hello v2.0 implementation of OpenID Connect has a few well-defined scopes that do not apply tooa specific resource: `openid`, `email`, `profile`, and `offline_access`.</span></span>

### <a name="openid"></a><span data-ttu-id="a2e40-138">openid</span><span class="sxs-lookup"><span data-stu-id="a2e40-138">openid</span></span>
<span data-ttu-id="a2e40-139">Se um aplicativo executa entrar usando [OpenID Connect](active-directory-v2-protocols.md), ele deve solicitar Olá `openid` escopo.</span><span class="sxs-lookup"><span data-stu-id="a2e40-139">If an app performs sign-in by using [OpenID Connect](active-directory-v2-protocols.md), it must request hello `openid` scope.</span></span> <span data-ttu-id="a2e40-140">Olá `openid` mostra como escopo na conta de trabalho Olá página de consentimento como hello "Entrar" permissão e na conta pessoal da Microsoft hello página de consentimento como Olá permissão "Exibir seu perfil e conectar tooapps e serviços usando sua conta da Microsoft".</span><span class="sxs-lookup"><span data-stu-id="a2e40-140">hello `openid` scope shows on hello work account consent page as hello "Sign you in" permission, and on hello personal Microsoft account consent page as hello "View your profile and connect tooapps and services using your Microsoft account" permission.</span></span> <span data-ttu-id="a2e40-141">Com essa permissão, um aplicativo pode receber um identificador exclusivo para o usuário Olá na forma de saudação de saudação `sub` de declaração.</span><span class="sxs-lookup"><span data-stu-id="a2e40-141">With this permission, an app can receive a unique identifier for hello user in hello form of hello `sub` claim.</span></span> <span data-ttu-id="a2e40-142">Ele também fornece o ponto de extremidade do hello aplicativo acesso toohello UserInfo.</span><span class="sxs-lookup"><span data-stu-id="a2e40-142">It also gives hello app access toohello UserInfo endpoint.</span></span> <span data-ttu-id="a2e40-143">Olá `openid` escopo pode ser usado em Olá v 2.0 ponto de extremidade token tooacquire ID tokens, que podem ser usado toosecure HTTP chamadas entre diferentes componentes de um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a2e40-143">hello `openid` scope can be used at hello v2.0 token endpoint tooacquire ID tokens, which can be used toosecure HTTP calls between different components of an app.</span></span>

### <a name="email"></a><span data-ttu-id="a2e40-144">email</span><span class="sxs-lookup"><span data-stu-id="a2e40-144">email</span></span>
<span data-ttu-id="a2e40-145">Olá `email` escopo pode ser usado com hello `openid` escopo e outras.</span><span class="sxs-lookup"><span data-stu-id="a2e40-145">hello `email` scope can be used with hello `openid` scope and any others.</span></span> <span data-ttu-id="a2e40-146">Ele fornece o endereço de email principal do usuário do toohello acesso aplicativo hello na forma de saudação de saudação `email` de declaração.</span><span class="sxs-lookup"><span data-stu-id="a2e40-146">It gives hello app access toohello user's primary email address in hello form of hello `email` claim.</span></span> <span data-ttu-id="a2e40-147">Olá `email` declaração é incluída em um token somente se um endereço de email está associado à conta de usuário de saudação, que não é sempre o caso de saudação.</span><span class="sxs-lookup"><span data-stu-id="a2e40-147">hello `email` claim is included in a token only if an email address is associated with hello user account, which is not always hello case.</span></span> <span data-ttu-id="a2e40-148">Se usar Olá `email` escopo, seu aplicativo deve ser preparado toohandle um caso no qual Olá `email` declaração não existe no token de saudação.</span><span class="sxs-lookup"><span data-stu-id="a2e40-148">If it uses hello `email` scope, your app should be prepared toohandle a case in which hello `email` claim does not exist in hello token.</span></span>

### <a name="profile"></a><span data-ttu-id="a2e40-149">Perfil</span><span class="sxs-lookup"><span data-stu-id="a2e40-149">profile</span></span>
<span data-ttu-id="a2e40-150">Olá `profile` escopo pode ser usado com hello `openid` escopo e outras.</span><span class="sxs-lookup"><span data-stu-id="a2e40-150">hello `profile` scope can be used with hello `openid` scope and any others.</span></span> <span data-ttu-id="a2e40-151">Ele fornece Olá aplicativo acesso tooa quantidade significativa de informações sobre o usuário hello.</span><span class="sxs-lookup"><span data-stu-id="a2e40-151">It gives hello app access tooa substantial amount of information about hello user.</span></span> <span data-ttu-id="a2e40-152">informações de saudação pode acessar incluem, mas não são limitadas para Olá preferencial do nome de usuário, sobrenome, nome do usuário e ID de objeto</span><span class="sxs-lookup"><span data-stu-id="a2e40-152">hello information it can access includes, but is not limited to, hello user's given name, surname, preferred username, and object ID.</span></span> <span data-ttu-id="a2e40-153">Para obter uma lista completa de saudação de declarações de perfil disponíveis no parâmetro de id_tokens Olá para um usuário específico, consulte Olá [v 2.0 tokens referência](active-directory-v2-tokens.md).</span><span class="sxs-lookup"><span data-stu-id="a2e40-153">For a complete list of hello profile claims available in hello id_tokens parameter for a specific user, see hello [v2.0 tokens reference](active-directory-v2-tokens.md).</span></span>

### <a name="offlineaccess"></a><span data-ttu-id="a2e40-154">offline_access</span><span class="sxs-lookup"><span data-stu-id="a2e40-154">offline_access</span></span>
<span data-ttu-id="a2e40-155">Olá [ `offline_access` escopo](http://openid.net/specs/openid-connect-core-1_0.html#OfflineAccess) fornece seu tooresources de acesso do aplicativo em nome de usuário de saudação por um longo período.</span><span class="sxs-lookup"><span data-stu-id="a2e40-155">hello [`offline_access` scope](http://openid.net/specs/openid-connect-core-1_0.html#OfflineAccess) gives your app access tooresources on behalf of hello user for an extended time.</span></span> <span data-ttu-id="a2e40-156">Na página de consentimento de conta de trabalho Olá, esse escopo é exibida como Olá permissão "Acessar seus dados a qualquer momento".</span><span class="sxs-lookup"><span data-stu-id="a2e40-156">On hello work account consent page, this scope appears as hello "Access your data anytime" permission.</span></span> <span data-ttu-id="a2e40-157">Em Olá pessoal consentimento página da conta Microsoft, ele é exibido como Olá permissão "Acessar suas informações a qualquer momento".</span><span class="sxs-lookup"><span data-stu-id="a2e40-157">On hello personal Microsoft account consent page, it appears as hello "Access your info anytime" permission.</span></span> <span data-ttu-id="a2e40-158">Quando um usuário aprova Olá `offline_access` escopo, seu aplicativo pode receber tokens de atualização do ponto de extremidade token Olá v 2.0.</span><span class="sxs-lookup"><span data-stu-id="a2e40-158">When a user approves hello `offline_access` scope, your app can receive refresh tokens from hello v2.0 token endpoint.</span></span> <span data-ttu-id="a2e40-159">Os tokens de atualização têm uma vida longa.</span><span class="sxs-lookup"><span data-stu-id="a2e40-159">Refresh tokens are long-lived.</span></span> <span data-ttu-id="a2e40-160">Seu aplicativo pode obter novos tokens de acesso quando os mais antigos expirarem.</span><span class="sxs-lookup"><span data-stu-id="a2e40-160">Your app can get new access tokens as older ones expire.</span></span>

<span data-ttu-id="a2e40-161">Se seu aplicativo não solicitar Olá `offline_access` escopo, ele não receberá atualizações de tokens.</span><span class="sxs-lookup"><span data-stu-id="a2e40-161">If your app does not request hello `offline_access` scope, it won't receive refresh tokens.</span></span> <span data-ttu-id="a2e40-162">Isso significa que quando você resgatar um código de autorização no hello [fluxo de código de autorização do OAuth 2.0](active-directory-v2-protocols.md), você receberá um token de acesso de saudação `/token` ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="a2e40-162">This means that when you redeem an authorization code in hello [OAuth 2.0 authorization code flow](active-directory-v2-protocols.md), you'll receive only an access token from hello `/token` endpoint.</span></span> <span data-ttu-id="a2e40-163">token de acesso de saudação é válido por um curto período.</span><span class="sxs-lookup"><span data-stu-id="a2e40-163">hello access token is valid for a short time.</span></span> <span data-ttu-id="a2e40-164">o token de acesso Olá geralmente expira em uma hora.</span><span class="sxs-lookup"><span data-stu-id="a2e40-164">hello access token usually expires in one hour.</span></span> <span data-ttu-id="a2e40-165">Nesse ponto, seu aplicativo precisa tooredirect Olá usuário back toohello `/authorize` tooget de ponto de extremidade um novo código de autorização.</span><span class="sxs-lookup"><span data-stu-id="a2e40-165">At that point, your app needs tooredirect hello user back toohello `/authorize` endpoint tooget a new authorization code.</span></span> <span data-ttu-id="a2e40-166">Durante esse redirecionamento, dependendo do tipo de saudação do aplicativo, usuário Olá pode precisar tooenter suas credenciais novamente ou consentimento novamente toopermissions.</span><span class="sxs-lookup"><span data-stu-id="a2e40-166">During this redirect, depending on hello type of app, hello user might need tooenter their credentials again or consent again toopermissions.</span></span>

<span data-ttu-id="a2e40-167">Para obter mais informações sobre como tooget e use tokens de atualização, consulte Olá [referência de protocolo v 2.0](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="a2e40-167">For more information about how tooget and use refresh tokens, see hello [v2.0 protocol reference](active-directory-v2-protocols.md).</span></span>

## <a name="requesting-individual-user-consent"></a><span data-ttu-id="a2e40-168">Solicitando consentimento de usuário individual</span><span class="sxs-lookup"><span data-stu-id="a2e40-168">Requesting individual user consent</span></span>
<span data-ttu-id="a2e40-169">Em um [OpenID Connect ou OAuth 2.0](active-directory-v2-protocols.md) solicitação de autorização, um aplicativo pode solicitar permissões de saudação precisa usando Olá `scope` parâmetro de consulta.</span><span class="sxs-lookup"><span data-stu-id="a2e40-169">In an [OpenID Connect or OAuth 2.0](active-directory-v2-protocols.md) authorization request, an app can request hello permissions it needs by using hello `scope` query parameter.</span></span> <span data-ttu-id="a2e40-170">Por exemplo, quando um usuário entra no aplicativo tooan, o aplicativo hello envia uma solicitação como Olá exemplo a seguir (com quebras de linha adicionadas para legibilidade):</span><span class="sxs-lookup"><span data-stu-id="a2e40-170">For example, when a user signs in tooan app, hello app sends a request like hello following example (with line breaks added for legibility):</span></span>

```
GET https://login.microsoftonline.com/common/oauth2/v2.0/authorize?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&response_type=code
&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F
&response_mode=query
&scope=
https%3A%2F%2Fgraph.microsoft.com%2Fcalendar.read%20
https%3A%2F%2Fgraph.microsoft.com%2Fmail.send
&state=12345
```

<span data-ttu-id="a2e40-171">Olá `scope` parâmetro é uma lista separada por espaços de escopos que Olá aplicativo está solicitando.</span><span class="sxs-lookup"><span data-stu-id="a2e40-171">hello `scope` parameter is a space-separated list of scopes that hello app is requesting.</span></span> <span data-ttu-id="a2e40-172">Cada escopo é indicado por acrescentar o identificador do recurso do toohello valor escopo hello (Olá URI da ID do aplicativo).</span><span class="sxs-lookup"><span data-stu-id="a2e40-172">Each scope is indicated by appending hello scope value toohello resource's identifier (hello Application ID URI).</span></span> <span data-ttu-id="a2e40-173">No exemplo de solicitação hello, aplicativo hello precisa de permissão tooread Olá calendário de usuário e enviar um email como usuário hello.</span><span class="sxs-lookup"><span data-stu-id="a2e40-173">In hello request example, hello app needs permission tooread hello user's calendar and send mail as hello user.</span></span>

<span data-ttu-id="a2e40-174">Depois que o usuário Olá insere suas credenciais, o ponto de extremidade do hello v 2.0 verifica um registro correspondente de *consentimento do usuário*.</span><span class="sxs-lookup"><span data-stu-id="a2e40-174">After hello user enters their credentials, hello v2.0 endpoint checks for a matching record of *user consent*.</span></span> <span data-ttu-id="a2e40-175">Se o usuário Olá não consentiu tooany de saudação solicitadas permissões no hello anterior, Olá usuário toogrant solicita que o ponto de extremidade do hello v 2.0 Olá solicitadas permissões.</span><span class="sxs-lookup"><span data-stu-id="a2e40-175">If hello user has not consented tooany of hello requested permissions in hello past, hello v2.0 endpoint asks hello user toogrant hello requested permissions.</span></span>

![Consentimento de conta de trabalho](../../media/active-directory-v2-flows/work_account_consent.png)

<span data-ttu-id="a2e40-177">Quando o usuário Olá aprova permissão hello, consentimento Olá é registrado para que hello usuário não tem tooconsent novamente em logons subsequentes de conta.</span><span class="sxs-lookup"><span data-stu-id="a2e40-177">When hello user approves hello permission, hello consent is recorded so that hello user doesn't have tooconsent again on subsequent account sign-ins.</span></span>

## <a name="requesting-consent-for-an-entire-tenant"></a><span data-ttu-id="a2e40-178">Solicitando consentimento para um locatário inteiro</span><span class="sxs-lookup"><span data-stu-id="a2e40-178">Requesting consent for an entire tenant</span></span>
<span data-ttu-id="a2e40-179">Geralmente, quando uma organização adquire uma licença ou assinatura de um aplicativo, Olá organização deseja que aplicativo de hello provisionar toofully para seus funcionários.</span><span class="sxs-lookup"><span data-stu-id="a2e40-179">Often, when an organization purchases a license or subscription for an application, hello organization wants toofully provision hello application for its employees.</span></span> <span data-ttu-id="a2e40-180">Como parte desse processo, um administrador pode conceder consentimento para Olá aplicativo tooact em nome de um funcionário.</span><span class="sxs-lookup"><span data-stu-id="a2e40-180">As part of this process, an administrator can grant consent for hello application tooact on behalf of any employee.</span></span> <span data-ttu-id="a2e40-181">Se Olá administrador concede permissão para o locatário todo hello, Olá funcionários não verão uma página de consentimento para o aplicativo hello.</span><span class="sxs-lookup"><span data-stu-id="a2e40-181">If hello admin grants consent for hello entire tenant, hello organization's employees won't see a consent page for hello application.</span></span>

<span data-ttu-id="a2e40-182">consentimento toorequest para todos os usuários em um locatário, seu aplicativo pode usar o ponto de extremidade do Olá administrador consentimento.</span><span class="sxs-lookup"><span data-stu-id="a2e40-182">toorequest consent for all users in a tenant, your app can use hello admin consent endpoint.</span></span>

## <a name="admin-restricted-scopes"></a><span data-ttu-id="a2e40-183">Escopos restritos ao administrador</span><span class="sxs-lookup"><span data-stu-id="a2e40-183">Admin-restricted scopes</span></span>
<span data-ttu-id="a2e40-184">Algumas permissões com alto privilégio no ecossistema do Microsoft hello podem ser definidas muito*restringido pelo administrador*.</span><span class="sxs-lookup"><span data-stu-id="a2e40-184">Some high-privilege permissions in hello Microsoft ecosystem can be set too*admin-restricted*.</span></span> <span data-ttu-id="a2e40-185">Exemplos desses tipos de escopos incluem hello as seguintes permissões:</span><span class="sxs-lookup"><span data-stu-id="a2e40-185">Examples of these kinds of scopes include hello following permissions:</span></span>

* <span data-ttu-id="a2e40-186">Ler dados do diretório da organização usando `Directory.Read`</span><span class="sxs-lookup"><span data-stu-id="a2e40-186">Read an organization's directory data by using `Directory.Read`</span></span>
* <span data-ttu-id="a2e40-187">Gravar o diretório da organização de tooan dados usando`Directory.ReadWrite`</span><span class="sxs-lookup"><span data-stu-id="a2e40-187">Write data tooan organization's directory by using `Directory.ReadWrite`</span></span>
* <span data-ttu-id="a2e40-188">Ler grupos de segurança no diretório da organização usando o `Groups.Read.All`</span><span class="sxs-lookup"><span data-stu-id="a2e40-188">Read security groups in an organization's directory by using `Groups.Read.All`</span></span>

<span data-ttu-id="a2e40-189">Embora um usuário de consumidor pode conceder um toothis de acesso do aplicativo, tipo de dados, os usuários organizacionais são impedidos de conceder acesso toohello mesmo conjunto de dados confidenciais da empresa.</span><span class="sxs-lookup"><span data-stu-id="a2e40-189">Although a consumer user might grant an application access toothis kind of data, organizational users are restricted from granting access toohello same set of sensitive company data.</span></span> <span data-ttu-id="a2e40-190">Se seu aplicativo solicita acesso tooone dessas permissões de um usuário organizacional, usuário Olá recebe uma mensagem de erro que diz que não são permissões do aplicativo de tooyour tooconsent autorizados.</span><span class="sxs-lookup"><span data-stu-id="a2e40-190">If your application requests access tooone of these permissions from an organizational user, hello user receives an error message that says they are not authorized tooconsent tooyour app's permissions.</span></span>

<span data-ttu-id="a2e40-191">Se seu aplicativo requer acesso restrito tooadmin escopos para as organizações, você deve solicitá-las diretamente de um administrador da empresa, também usando Olá consentimento do ponto de extremidade administrador, descrito a seguir.</span><span class="sxs-lookup"><span data-stu-id="a2e40-191">If your app requires access tooadmin-restricted scopes for organizations, you should request them directly from a company administrator, also by using hello admin consent endpoint, described next.</span></span>

<span data-ttu-id="a2e40-192">Quando um administrador concede que essas permissões Olá administrador por meio do ponto de extremidade de consentimento, consentimento é concedido para todos os usuários no locatário hello.</span><span class="sxs-lookup"><span data-stu-id="a2e40-192">When an administrator grants these permissions via hello admin consent endpoint, consent is granted for all users in hello tenant.</span></span>

## <a name="using-hello-admin-consent-endpoint"></a><span data-ttu-id="a2e40-193">Usando o ponto de extremidade de autorização do Olá administrador</span><span class="sxs-lookup"><span data-stu-id="a2e40-193">Using hello admin consent endpoint</span></span>
<span data-ttu-id="a2e40-194">Se você seguir estas etapas, seu aplicativo poderá obter permissões para todos os usuários em um locatário, incluindo escopos restringidos pelo administrador.</span><span class="sxs-lookup"><span data-stu-id="a2e40-194">If you follow these steps, your app can gather permissions for all users in a tenant, including admin-restricted scopes.</span></span> <span data-ttu-id="a2e40-195">toosee um exemplo de código que implementa etapas hello, consulte Olá [exemplo escopos restringido pelo administrador](https://github.com/Azure-Samples/active-directory-dotnet-admin-restricted-scopes-v2).</span><span class="sxs-lookup"><span data-stu-id="a2e40-195">toosee a code sample that implements hello steps, see hello [admin-restricted scopes sample](https://github.com/Azure-Samples/active-directory-dotnet-admin-restricted-scopes-v2).</span></span>

### <a name="request-hello-permissions-in-hello-app-registration-portal"></a><span data-ttu-id="a2e40-196">Solicitar permissões Olá no portal de registro de aplicativo hello</span><span class="sxs-lookup"><span data-stu-id="a2e40-196">Request hello permissions in hello app registration portal</span></span>
1. <span data-ttu-id="a2e40-197">Vá tooyour aplicativo hello [Portal de registro de aplicativo](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList), ou [criar um aplicativo](active-directory-v2-app-registration.md) se ainda não o fez.</span><span class="sxs-lookup"><span data-stu-id="a2e40-197">Go tooyour application in hello [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList), or [create an app](active-directory-v2-app-registration.md) if you haven't already.</span></span>
2. <span data-ttu-id="a2e40-198">Localizar Olá **Microsoft Graph permissões** seção e, em seguida, adicione permissões de saudação que seu aplicativo requer.</span><span class="sxs-lookup"><span data-stu-id="a2e40-198">Locate hello **Microsoft Graph Permissions** section, and then add hello permissions that your app requires.</span></span>
3. <span data-ttu-id="a2e40-199">Verifique se você **salvar** Olá o registro do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a2e40-199">Make sure you **Save** hello app registration.</span></span>

### <a name="recommended-sign-hello-user-in-tooyour-app"></a><span data-ttu-id="a2e40-200">Recomendado: Usuário de saudação entrar no aplicativo tooyour</span><span class="sxs-lookup"><span data-stu-id="a2e40-200">Recommended: Sign hello user in tooyour app</span></span>
<span data-ttu-id="a2e40-201">Normalmente, quando você cria um aplicativo que usa o ponto de extremidade de autorização de administrador hello, Olá aplicativo precisa de uma página ou exibição na qual Olá administrador pode aprovar permissões do aplicativo hello.</span><span class="sxs-lookup"><span data-stu-id="a2e40-201">Typically, when you build an application that uses hello admin consent endpoint, hello app needs a page or view in which hello admin can approve hello app's permissions.</span></span> <span data-ttu-id="a2e40-202">Esta página pode ser parte do fluxo de inscrição do aplicativo hello, parte de configurações do aplicativo hello, ou pode ser dedicado "conectar" fluxo.</span><span class="sxs-lookup"><span data-stu-id="a2e40-202">This page can be part of hello app's sign-up flow, part of hello app's settings, or it can be a dedicated "connect" flow.</span></span> <span data-ttu-id="a2e40-203">Em muitos casos, faz sentido para Olá aplicativo tooshow isso "conectar" modo de exibição somente depois que um usuário tiver se conectado com um trabalho ou escola conta da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="a2e40-203">In many cases, it makes sense for hello app tooshow this "connect" view only after a user has signed in with a work or school Microsoft account.</span></span>

<span data-ttu-id="a2e40-204">Quando você entrar usuário Olá no aplicativo tooyour, você pode identificar a organização Olá toowhich Olá administrador pertence antes solicitando que eles as permissões necessárias tooapprove hello.</span><span class="sxs-lookup"><span data-stu-id="a2e40-204">When you sign hello user in tooyour app, you can identify hello organization toowhich hello admin belongs before asking them tooapprove hello necessary permissions.</span></span> <span data-ttu-id="a2e40-205">Embora não seja estritamente necessário, isso pode ajudá-lo a criar uma experiência mais intuitiva para os usuários empresariais.</span><span class="sxs-lookup"><span data-stu-id="a2e40-205">Although not strictly necessary, it can help you create a more intuitive experience for your organizational users.</span></span> <span data-ttu-id="a2e40-206">usuário de saudação toosign in, siga nosso [tutoriais de protocolo v 2.0](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="a2e40-206">toosign hello user in, follow our [v2.0 protocol tutorials](active-directory-v2-protocols.md).</span></span>

### <a name="request-hello-permissions-from-a-directory-admin"></a><span data-ttu-id="a2e40-207">Saudação de solicitar permissões de um administrador de diretório</span><span class="sxs-lookup"><span data-stu-id="a2e40-207">Request hello permissions from a directory admin</span></span>
<span data-ttu-id="a2e40-208">Quando você estiver pronto toorequest permissões de administrador de sua organização, você pode redirecionar v 2.0 do hello usuário toohello *ponto de extremidade de autorização administrador*.</span><span class="sxs-lookup"><span data-stu-id="a2e40-208">When you're ready toorequest permissions from your organization's admin, you can redirect hello user toohello v2.0 *admin consent endpoint*.</span></span>

```
// Line breaks are for legibility only.

GET https://login.microsoftonline.com/{tenant}/adminconsent?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&state=12345
&redirect_uri=http://localhost/myapp/permissions
```

```
// Pro tip: Try pasting hello below request in a browser!
```

```
https://login.microsoftonline.com/common/adminconsent?client_id=6731de76-14a6-49ae-97bc-6eba6914391e&state=12345&redirect_uri=http://localhost/myapp/permissions
```

| <span data-ttu-id="a2e40-209">Parâmetro</span><span class="sxs-lookup"><span data-stu-id="a2e40-209">Parameter</span></span> | <span data-ttu-id="a2e40-210">Condição</span><span class="sxs-lookup"><span data-stu-id="a2e40-210">Condition</span></span> | <span data-ttu-id="a2e40-211">Descrição</span><span class="sxs-lookup"><span data-stu-id="a2e40-211">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="a2e40-212">locatário</span><span class="sxs-lookup"><span data-stu-id="a2e40-212">tenant</span></span> |<span data-ttu-id="a2e40-213">Obrigatório</span><span class="sxs-lookup"><span data-stu-id="a2e40-213">Required</span></span> |<span data-ttu-id="a2e40-214">locatário do diretório Olá que você deseja toorequest permissão do.</span><span class="sxs-lookup"><span data-stu-id="a2e40-214">hello directory tenant that you want toorequest permission from.</span></span> <span data-ttu-id="a2e40-215">Pode ser fornecido no formato de nome amigável ou de GUID.</span><span class="sxs-lookup"><span data-stu-id="a2e40-215">Can be provided in GUID or friendly name format.</span></span> |
| <span data-ttu-id="a2e40-216">client_id</span><span class="sxs-lookup"><span data-stu-id="a2e40-216">client_id</span></span> |<span data-ttu-id="a2e40-217">Obrigatório</span><span class="sxs-lookup"><span data-stu-id="a2e40-217">Required</span></span> |<span data-ttu-id="a2e40-218">Olá aplicativo ID que Olá [Portal de registro de aplicativo](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) atribuído tooyour aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a2e40-218">hello Application ID that hello [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) assigned tooyour app.</span></span> |
| <span data-ttu-id="a2e40-219">redirect_uri</span><span class="sxs-lookup"><span data-stu-id="a2e40-219">redirect_uri</span></span> |<span data-ttu-id="a2e40-220">Obrigatório</span><span class="sxs-lookup"><span data-stu-id="a2e40-220">Required</span></span> |<span data-ttu-id="a2e40-221">Olá redirecione o URI em que você deseja Olá resposta toobe enviado para seu aplicativo toohandle.</span><span class="sxs-lookup"><span data-stu-id="a2e40-221">hello redirect URI where you want hello response toobe sent for your app toohandle.</span></span> <span data-ttu-id="a2e40-222">Ele deve corresponder exatamente um redirecionamento Olá URIs que você registrou no portal de registro de aplicativo hello.</span><span class="sxs-lookup"><span data-stu-id="a2e40-222">It must exactly match one of hello redirect URIs that you registered in hello app registration portal.</span></span> |
| <span data-ttu-id="a2e40-223">state</span><span class="sxs-lookup"><span data-stu-id="a2e40-223">state</span></span> |<span data-ttu-id="a2e40-224">Recomendadas</span><span class="sxs-lookup"><span data-stu-id="a2e40-224">Recommended</span></span> |<span data-ttu-id="a2e40-225">Um valor incluído na solicitação de saudação que também será retornada na resposta de token hello.</span><span class="sxs-lookup"><span data-stu-id="a2e40-225">A value included in hello request that will also be returned in hello token response.</span></span> <span data-ttu-id="a2e40-226">Pode ser uma cadeia de caracteres de qualquer conteúdo desejado.</span><span class="sxs-lookup"><span data-stu-id="a2e40-226">It can be a string of any content you want.</span></span> <span data-ttu-id="a2e40-227">Use informações de tooencode de estado de saudação sobre o estado do usuário Olá no aplicativo hello antes de solicitação de autenticação hello, como exibição ou página Olá estivesse em.</span><span class="sxs-lookup"><span data-stu-id="a2e40-227">Use hello state tooencode information about hello user's state in hello app before hello authentication request occurred, such as hello page or view they were on.</span></span> |

<span data-ttu-id="a2e40-228">Neste ponto, AD do Azure requer um toosign do administrador de locatário na solicitação de saudação toocomplete.</span><span class="sxs-lookup"><span data-stu-id="a2e40-228">At this point, Azure AD requires a tenant administrator toosign in toocomplete hello request.</span></span> <span data-ttu-id="a2e40-229">administrador de saudação é solicitado tooapprove que todos Olá permissões solicitadas para seu aplicativo no portal de registro de aplicativo hello.</span><span class="sxs-lookup"><span data-stu-id="a2e40-229">hello administrator is asked tooapprove all hello permissions that you have requested for your app in hello app registration portal.</span></span>

#### <a name="successful-response"></a><span data-ttu-id="a2e40-230">Resposta bem-sucedida</span><span class="sxs-lookup"><span data-stu-id="a2e40-230">Successful response</span></span>
<span data-ttu-id="a2e40-231">Se Olá administrador aprovar permissões Olá para seu aplicativo, resposta bem-sucedida Olá terá esta aparência:</span><span class="sxs-lookup"><span data-stu-id="a2e40-231">If hello admin approves hello permissions for your app, hello successful response looks like this:</span></span>

```
GET http://localhost/myapp/permissions?tenant=a8990e1f-ff32-408a-9f8e-78d3b9139b95&state=state=12345&admin_consent=True
```

| <span data-ttu-id="a2e40-232">Parâmetro</span><span class="sxs-lookup"><span data-stu-id="a2e40-232">Parameter</span></span> | <span data-ttu-id="a2e40-233">Descrição</span><span class="sxs-lookup"><span data-stu-id="a2e40-233">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="a2e40-234">locatário</span><span class="sxs-lookup"><span data-stu-id="a2e40-234">tenant</span></span> |<span data-ttu-id="a2e40-235">locatário do diretório Olá concedidas as permissões do aplicativo hello solicitados, no formato GUID.</span><span class="sxs-lookup"><span data-stu-id="a2e40-235">hello directory tenant that granted your application hello permissions it requested, in GUID format.</span></span> |
| <span data-ttu-id="a2e40-236">state</span><span class="sxs-lookup"><span data-stu-id="a2e40-236">state</span></span> |<span data-ttu-id="a2e40-237">Um valor incluído na solicitação de saudação que também será retornada na resposta de token hello.</span><span class="sxs-lookup"><span data-stu-id="a2e40-237">A value included in hello request that also will be returned in hello token response.</span></span> <span data-ttu-id="a2e40-238">Pode ser uma cadeia de caracteres de qualquer conteúdo desejado.</span><span class="sxs-lookup"><span data-stu-id="a2e40-238">It can be a string of any content you want.</span></span> <span data-ttu-id="a2e40-239">estado de saudação é usado tooencode informações sobre o estado do usuário Olá no aplicativo hello antes de solicitação de autenticação hello, como página hello ou exibição que estavam no.</span><span class="sxs-lookup"><span data-stu-id="a2e40-239">hello state is used tooencode information about hello user's state in hello app before hello authentication request occurred, such as hello page or view they were on.</span></span> |
| <span data-ttu-id="a2e40-240">admin_consent</span><span class="sxs-lookup"><span data-stu-id="a2e40-240">admin_consent</span></span> |<span data-ttu-id="a2e40-241">Será definido muito**true**.</span><span class="sxs-lookup"><span data-stu-id="a2e40-241">Will be set too**true**.</span></span> |

#### <a name="error-response"></a><span data-ttu-id="a2e40-242">Resposta de erro</span><span class="sxs-lookup"><span data-stu-id="a2e40-242">Error response</span></span>
<span data-ttu-id="a2e40-243">Se Olá administrador aprove permissões Olá para seu aplicativo, Olá falha resposta esta aparência:</span><span class="sxs-lookup"><span data-stu-id="a2e40-243">If hello admin does not approve hello permissions for your app, hello failed response looks like this:</span></span>

```
GET http://localhost/myapp/permissions?error=permission_denied&error_description=The+admin+canceled+the+request
```

| <span data-ttu-id="a2e40-244">Parâmetro</span><span class="sxs-lookup"><span data-stu-id="a2e40-244">Parameter</span></span> | <span data-ttu-id="a2e40-245">Descrição</span><span class="sxs-lookup"><span data-stu-id="a2e40-245">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="a2e40-246">error</span><span class="sxs-lookup"><span data-stu-id="a2e40-246">error</span></span> |<span data-ttu-id="a2e40-247">Uma cadeia de código de erro que pode ser usados tooclassify tipos de erros que ocorrem e pode ser usado tooreact tooerrors.</span><span class="sxs-lookup"><span data-stu-id="a2e40-247">An error code string that can be used tooclassify types of errors that occur, and can be used tooreact tooerrors.</span></span> |
| <span data-ttu-id="a2e40-248">error_description</span><span class="sxs-lookup"><span data-stu-id="a2e40-248">error_description</span></span> |<span data-ttu-id="a2e40-249">Uma mensagem de erro específicas que um desenvolvedor pode ajudar a identificar a causa de saudação de um erro.</span><span class="sxs-lookup"><span data-stu-id="a2e40-249">A specific error message that can help a developer identify hello root cause of an error.</span></span> |

<span data-ttu-id="a2e40-250">Depois que você recebeu uma resposta bem-sucedida do ponto de extremidade de autorização de admin hello, seu aplicativo ganhou permissões Olá solicitada.</span><span class="sxs-lookup"><span data-stu-id="a2e40-250">After you've received a successful response from hello admin consent endpoint, your app has gained hello permissions it requested.</span></span> <span data-ttu-id="a2e40-251">Em seguida, você pode solicitar um token para o recurso de saudação desejado.</span><span class="sxs-lookup"><span data-stu-id="a2e40-251">Next, you can request a token for hello resource you want.</span></span>

## <a name="using-permissions"></a><span data-ttu-id="a2e40-252">Usando permissões</span><span class="sxs-lookup"><span data-stu-id="a2e40-252">Using permissions</span></span>
<span data-ttu-id="a2e40-253">Após o consentimento do usuário Olá toopermissions para seu aplicativo, seu aplicativo pode obter tokens de acesso que representam tooaccess de permissão do aplicativo um recurso em alguma capacidade.</span><span class="sxs-lookup"><span data-stu-id="a2e40-253">After hello user consents toopermissions for your app, your app can acquire access tokens that represent your app's permission tooaccess a resource in some capacity.</span></span> <span data-ttu-id="a2e40-254">Um token de acesso pode ser usado apenas para um único recurso, mas codificadas no token de acesso de saudação é cada permissão que seu aplicativo tenha sido concedido para esse recurso.</span><span class="sxs-lookup"><span data-stu-id="a2e40-254">An access token can be used only for a single resource, but encoded inside hello access token is every permission that your app has been granted for that resource.</span></span> <span data-ttu-id="a2e40-255">tooacquire um token de acesso, o aplicativo pode fazer um solicitação toohello v 2.0 token ponto de extremidade, como este:</span><span class="sxs-lookup"><span data-stu-id="a2e40-255">tooacquire an access token, your app can make a request toohello v2.0 token endpoint, like this:</span></span>

```
POST common/oauth2/v2.0/token HTTP/1.1
Host: https://login.microsoftonline.com
Content-Type: application/json

{
    "grant_type": "authorization_code",
    "client_id": "6731de76-14a6-49ae-97bc-6eba6914391e",
    "scope": "https://outlook.office.com/mail.read https://outlook.office.com/mail.send",
    "code": "AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq..."
    "redirect_uri": "https://localhost/myapp",
    "client_secret": "zc53fwe80980293klaj9823"  // NOTE: Only required for web apps
}
```

<span data-ttu-id="a2e40-256">Você pode usar o token de acesso resultante Olá no recurso de toohello de solicitações HTTP.</span><span class="sxs-lookup"><span data-stu-id="a2e40-256">You can use hello resulting access token in HTTP requests toohello resource.</span></span> <span data-ttu-id="a2e40-257">Ele indica confiável toohello recursos que seu aplicativo tenha Olá devida permissão tooperform uma tarefa específica.</span><span class="sxs-lookup"><span data-stu-id="a2e40-257">It reliably indicates toohello resource that your app has hello proper permission tooperform a specific task.</span></span>  

<span data-ttu-id="a2e40-258">Para obter mais informações sobre Olá OAuth 2.0 do protocolo e como tooget tokens de acesso, consulte Olá [referência de protocolo do ponto de extremidade v 2.0](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="a2e40-258">For more information about hello OAuth 2.0 protocol and how tooget access tokens, see hello [v2.0 endpoint protocol reference](active-directory-v2-protocols.md).</span></span>
