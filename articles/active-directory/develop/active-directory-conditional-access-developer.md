---
title: Diretrizes para acesso condicional do Azure Active Directory de aaaDeveloper | Microsoft Docs
description: "Diretrizes do desenvolvedor e cenários para acesso condicional do Azure AD"
services: active-directory
keywords: 
author: danieldobalian
manager: mbaldwin
editor: PatAltimore
ms.author: dadobali
ms.date: 07/19/2017
ms.assetid: 115bdab2-e1fd-4403-ac15-d4195e24ac95
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.openlocfilehash: 589393f5d084d64872b372d895dc889f300592bf
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="developer-guidance-for-azure-active-directory-conditional-access"></a><span data-ttu-id="55d28-103">Diretrizes do desenvolvedor para acesso condicional do Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="55d28-103">Developer Guidance for Azure Active Directory Conditional Access</span></span>

<span data-ttu-id="55d28-104">Azure AD (Active Directory) oferece toosecure de várias maneiras de seu aplicativo e proteger um serviço.</span><span class="sxs-lookup"><span data-stu-id="55d28-104">Azure Active Directory (AD) offers several ways toosecure your app and protect a service.</span></span>  <span data-ttu-id="55d28-105">Um desses recursos exclusivos é o acesso condicional.</span><span class="sxs-lookup"><span data-stu-id="55d28-105">One of these unique features is conditional access.</span></span>  <span data-ttu-id="55d28-106">Acesso condicional permite que os desenvolvedores e os serviços de tooprotect de clientes corporativos em várias maneiras, incluindo:</span><span class="sxs-lookup"><span data-stu-id="55d28-106">Conditional access enables developers and enterprise customers tooprotect services in a multitude of ways including:</span></span>

* <span data-ttu-id="55d28-107">Autenticação multifator</span><span class="sxs-lookup"><span data-stu-id="55d28-107">Multi-factor authentication</span></span>
* <span data-ttu-id="55d28-108">Permitindo que apenas o Intune registrados serviços específicos de tooaccess de dispositivos</span><span class="sxs-lookup"><span data-stu-id="55d28-108">Allowing only Intune enrolled devices tooaccess specific services</span></span>
* <span data-ttu-id="55d28-109">Restrição de locais de usuário e intervalos de IP</span><span class="sxs-lookup"><span data-stu-id="55d28-109">Restricting user locations and IP ranges</span></span>

<span data-ttu-id="55d28-110">Para obter mais informações sobre recursos completos de saudação do acesso condicional, consulte [acesso condicional no portal clássico do Azure de saudação](../active-directory-conditional-access.md).</span><span class="sxs-lookup"><span data-stu-id="55d28-110">For more information on hello full capabilities of conditional access, see [Conditional access in hello Azure classic portal](../active-directory-conditional-access.md).</span></span> 

<span data-ttu-id="55d28-111">Neste artigo, vamos nos concentrar no que acesso condicional significa toodevelopers criando aplicativos do AD do Azure.</span><span class="sxs-lookup"><span data-stu-id="55d28-111">In this article, we focus on what conditional access means toodevelopers building apps for Azure AD.</span></span>  <span data-ttu-id="55d28-112">O artigo pressupõe o conhecimento de aplicativos de [único locatário](active-directory-integrating-applications.md) e [multilocatário](active-directory-devhowto-multi-tenant-overview.md), além de [padrões comuns de autenticação](active-directory-authentication-scenarios.md).</span><span class="sxs-lookup"><span data-stu-id="55d28-112">It assumes knowledge of [single](active-directory-integrating-applications.md) and [multi-tenant](active-directory-devhowto-multi-tenant-overview.md) apps and [common authentication patterns](active-directory-authentication-scenarios.md).</span></span>

<span data-ttu-id="55d28-113">Nos aprofundaremos nas impacto de saudação de acessar os recursos que você não tem controle sobre o que podem ter políticas de acesso condicional aplicadas.</span><span class="sxs-lookup"><span data-stu-id="55d28-113">We'll dive into hello impact of accessing resources you don't have control over that may have conditional access policies applied.</span></span>  <span data-ttu-id="55d28-114">Além disso, exploraremos implicações de saudação do acesso condicional no hello em nome de fluxo, os aplicativos web, acessando Olá Microsoft Graph e chamar APIs.</span><span class="sxs-lookup"><span data-stu-id="55d28-114">Moreover, we explore hello implications of conditional access in hello on-behalf-of flow, web apps, accessing hello Microsoft Graph, and calling APIs.</span></span>

## <a name="how-does-conditional-access-impact-an-app"></a><span data-ttu-id="55d28-115">Como o acesso condicional afeta um aplicativo?</span><span class="sxs-lookup"><span data-stu-id="55d28-115">How does conditional access impact an app?</span></span>

### <a name="app-topologies-impacted"></a><span data-ttu-id="55d28-116">Topologias de aplicativo afetadas</span><span class="sxs-lookup"><span data-stu-id="55d28-116">App topologies impacted</span></span>

<span data-ttu-id="55d28-117">Na maioria dos casos, o acesso condicional não altera o comportamento do aplicativo ou requer alterações de desenvolvedor hello.</span><span class="sxs-lookup"><span data-stu-id="55d28-117">In most common cases, conditional access does not change an app's behavior or requires any changes from hello developer.</span></span>  <span data-ttu-id="55d28-118">Somente em determinados casos quando um aplicativo indiretamente ou silenciosamente solicita um token para um serviço, um aplicativo requer alterações no código toohandle condicional "desafios ao acesso".</span><span class="sxs-lookup"><span data-stu-id="55d28-118">Only in certain cases when an app indirectly or silently requests a token for a service, an app requires code changes toohandle conditional access "challenges".</span></span>  <span data-ttu-id="55d28-119">O que pode ser tão simples quanto executar uma solicitação de entrada interativa.</span><span class="sxs-lookup"><span data-stu-id="55d28-119">It may be as simple as performing an interactive sign-in request.</span></span> 

<span data-ttu-id="55d28-120">Especificamente, hello cenários a seguir exigem acesso condicional do código toohandle "desafios":</span><span class="sxs-lookup"><span data-stu-id="55d28-120">Specifically, hello following scenarios require code toohandle conditional access "challenges":</span></span> 

* <span data-ttu-id="55d28-121">Aplicativos que estão acessando Olá Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="55d28-121">Apps accessing hello Microsoft Graph</span></span>
* <span data-ttu-id="55d28-122">Aplicativos de execução de fluxo de saudação em nome de</span><span class="sxs-lookup"><span data-stu-id="55d28-122">Apps performing hello on-behalf-of flow</span></span>
* <span data-ttu-id="55d28-123">Aplicativos acessando vários serviços/recursos</span><span class="sxs-lookup"><span data-stu-id="55d28-123">Apps accessing multiple services/resources</span></span>
* <span data-ttu-id="55d28-124">Aplicativos de única página usando ADAL.js</span><span class="sxs-lookup"><span data-stu-id="55d28-124">Single page apps using ADAL.js</span></span>

<span data-ttu-id="55d28-125">Políticas de acesso condicional pode ser aplicado toohello aplicativo, mas também pode ser aplicado tooa web API seu aplicativo acessa.</span><span class="sxs-lookup"><span data-stu-id="55d28-125">Conditional access policies can be applied toohello app, but also can be applied tooa web API your app accesses.</span></span> <span data-ttu-id="55d28-126">Saiba mais sobre toolearn como tooconfigure uma política de acesso condicional, consulte [guia de Introdução ao acesso condicional do Azure Active Directory](../active-directory-conditional-access-azuread-connected-apps.md#configure-per-application-access-rules).</span><span class="sxs-lookup"><span data-stu-id="55d28-126">toolearn more about how tooconfigure a conditional access policy, please see [Getting started with Azure Active Directory Conditional Access](../active-directory-conditional-access-azuread-connected-apps.md#configure-per-application-access-rules).</span></span>

<span data-ttu-id="55d28-127">Dependendo do cenário de saudação, um cliente empresarial pode aplicar e remover as políticas de acesso condicional a qualquer momento.</span><span class="sxs-lookup"><span data-stu-id="55d28-127">Depending on hello scenario, an enterprise customer can apply and remove conditional access policies at any time.</span></span>  <span data-ttu-id="55d28-128">Para o funcionamento de toocontinue de seu aplicativo quando uma nova política é aplicada, é necessário o tratamento de desafio"tooimplement Olá".</span><span class="sxs-lookup"><span data-stu-id="55d28-128">In order for your app toocontinue functioning when a new policy is applied, you need tooimplement hello "challenge" handling.</span></span> <span data-ttu-id="55d28-129">Olá exemplos a seguir ilustra o tratamento de desafio.</span><span class="sxs-lookup"><span data-stu-id="55d28-129">hello following examples illustrate challenge handling.</span></span> 

### <a name="conditional-access-examples"></a><span data-ttu-id="55d28-130">Exemplos de acesso condicional</span><span class="sxs-lookup"><span data-stu-id="55d28-130">Conditional access examples</span></span>

<span data-ttu-id="55d28-131">Alguns cenários exigem alterações de código toohandle acesso condicional, enquanto outros funcionam como está.</span><span class="sxs-lookup"><span data-stu-id="55d28-131">Some scenarios require code changes toohandle conditional access whereas others work as is.</span></span>  <span data-ttu-id="55d28-132">Aqui estão alguns cenários usando a autenticação multifator do acesso condicional toodo que fornece informações sobre diferença hello.</span><span class="sxs-lookup"><span data-stu-id="55d28-132">Here are a few scenarios using conditional access toodo multi-factor authentication that gives some insight into hello difference.</span></span>

* <span data-ttu-id="55d28-133">Você está criando um aplicativo iOS de único locatário e aplica uma política de acesso condicional.</span><span class="sxs-lookup"><span data-stu-id="55d28-133">You are building a single-tenant iOS app and apply a conditional access policy.</span></span>  <span data-ttu-id="55d28-134">aplicativo Hello entra em um usuário e não solicitar acesso tooan API.</span><span class="sxs-lookup"><span data-stu-id="55d28-134">hello app signs in a user and doesn't request access tooan API.</span></span>  <span data-ttu-id="55d28-135">Quando Olá usuário faz logon, política de saudação é invocada automaticamente e usuário Olá precisa tooperform autenticação de multifator (MFA).</span><span class="sxs-lookup"><span data-stu-id="55d28-135">When hello user signs in, hello policy is automatically invoked and hello user needs tooperform multi-factor authentication (MFA).</span></span> 
* <span data-ttu-id="55d28-136">Você está criando um aplicativo web de vários locatários que usa Olá Microsoft Graph tooaccess Exchange, entre outros serviços.</span><span class="sxs-lookup"><span data-stu-id="55d28-136">You are building a multi-tenant web app that uses hello Microsoft Graph tooaccess Exchange, among other services.</span></span>  <span data-ttu-id="55d28-137">Um cliente empresarial que adota esse aplicativo define uma política no SharePoint Online.</span><span class="sxs-lookup"><span data-stu-id="55d28-137">An enterprise customer who adopts this app sets a policy on SharePoint Online.</span></span>  <span data-ttu-id="55d28-138">Quando o aplicativo da web de saudação solicita um token do MS Graph, uma política em qualquer Microsoft Service é aplicada (especificamente serviços que podem ser acessados por meio do gráfico).</span><span class="sxs-lookup"><span data-stu-id="55d28-138">When hello web app requests a token for MS Graph, a policy on any Microsoft Service is applied (specifically services that can be accessed through graph).</span></span>  <span data-ttu-id="55d28-139">Esse usuário final é solicitado a executar a MFA.</span><span class="sxs-lookup"><span data-stu-id="55d28-139">This end-user is prompted for MFA.</span></span> <span data-ttu-id="55d28-140">No caso de Olá, usuários finais de saudação é assinado com tokens válidos, um desafio"declarações" é retornado toohello web app.</span><span class="sxs-lookup"><span data-stu-id="55d28-140">In hello case, hello end-user is signed in with valid tokens, a claims "challenge" is returned toohello web app.</span></span>  
* <span data-ttu-id="55d28-141">Você está criando um aplicativo nativo que usa uma saudação de tooaccess do serviço de camada intermediária Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="55d28-141">You are building a native app that uses a middle tier service tooaccess hello Microsoft Graph.</span></span>  <span data-ttu-id="55d28-142">Um cliente empresarial na empresa hello usando este aplicativo aplica-se um tooExchange política Online.</span><span class="sxs-lookup"><span data-stu-id="55d28-142">An enterprise customer at hello company using this app applies a policy tooExchange Online.</span></span>  <span data-ttu-id="55d28-143">Quando um usuário final faz logon, o aplicativo nativo Olá solicitações de camada intermediária do acesso toohello e envia o token de saudação.</span><span class="sxs-lookup"><span data-stu-id="55d28-143">When an end-user signs in, hello native app requests access toohello middle tier and sends hello token.</span></span>  <span data-ttu-id="55d28-144">camada intermediária Olá executa em nome de fluxo toorequest acesso toohello MS Graph.</span><span class="sxs-lookup"><span data-stu-id="55d28-144">hello middle tier performs on-behalf-of flow toorequest access toohello MS Graph.</span></span>  <span data-ttu-id="55d28-145">Neste ponto, um desafio"declarações" é apresentado a camada intermediária toohello.</span><span class="sxs-lookup"><span data-stu-id="55d28-145">At this point, a claims "challenge" is presented toohello middle tier.</span></span> <span data-ttu-id="55d28-146">camada intermediária Olá envia Olá desafio toohello back aplicativo nativo, que deve toocomply com a política de acesso condicional hello.</span><span class="sxs-lookup"><span data-stu-id="55d28-146">hello middle tier sends hello challenge back toohello native app, which needs toocomply with hello conditional access policy.</span></span>

### <a name="complying-with-a-conditional-access-policy"></a><span data-ttu-id="55d28-147">Estabelecendo conformidade com uma política de acesso condicional</span><span class="sxs-lookup"><span data-stu-id="55d28-147">Complying with a conditional access policy</span></span>

<span data-ttu-id="55d28-148">Para várias topologias de aplicativo diferente, uma política de acesso condicional é avaliada quando a sessão de saudação for estabelecida.</span><span class="sxs-lookup"><span data-stu-id="55d28-148">For several different app topologies, a conditional access policy is evaluated when hello session is established.</span></span>  <span data-ttu-id="55d28-149">Como uma política de acesso condicional funciona com granularidade de saudação de aplicativos e serviços, no qual ele é chamado de ponto de saudação depende intensamente no cenário de saudação estiver tentando tooaccomplish.</span><span class="sxs-lookup"><span data-stu-id="55d28-149">As a conditional access policy operates on hello granularity of apps and services, hello point at which it is invoked depends heavily on hello scenario you're trying tooaccomplish.</span></span>

<span data-ttu-id="55d28-150">Quando o aplicativo tenta tooaccess um serviço com uma política de acesso condicional, ele pode encontrar um desafio de acesso condicional.</span><span class="sxs-lookup"><span data-stu-id="55d28-150">When your app attempts tooaccess a service with a conditional access policy, it may encounter a conditional access challenge.</span></span>  <span data-ttu-id="55d28-151">Esse desafio é codificado em Olá `claims` parâmetro que vem em uma resposta do AD do Azure ou Olá Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="55d28-151">This challenge is encoded in hello `claims` parameter that comes in a response from Azure AD or hello Microsoft Graph.</span></span>  <span data-ttu-id="55d28-152">Veja um exemplo desse parâmetro de desafio:</span><span class="sxs-lookup"><span data-stu-id="55d28-152">Here's an example of this challenge parameter:</span></span> 

```
claims={"access_token":{"polids":{"essential":true,"Values":["<GUID>"]}}}
```

<span data-ttu-id="55d28-153">Os desenvolvedores podem assumir esse desafio e acrescentá-lo para um novo tooAzure de solicitação AD.</span><span class="sxs-lookup"><span data-stu-id="55d28-153">Developers can take this challenge and append it onto a new request tooAzure AD.</span></span>  <span data-ttu-id="55d28-154">Passar esse estado solicita saudação do usuário final tooperform toocomply de necessária qualquer ação com a política de acesso condicional hello.</span><span class="sxs-lookup"><span data-stu-id="55d28-154">Passing this state prompts hello end-user tooperform any action necessary toocomply with hello conditional access policy.</span></span> <span data-ttu-id="55d28-155">Nos seguintes cenários de hello, detalhes específicos do erro hello e como tooextract Olá parâmetro são explicados.</span><span class="sxs-lookup"><span data-stu-id="55d28-155">In hello following scenarios, specifics of hello error and how tooextract hello parameter are explained.</span></span> 

## <a name="scenarios"></a><span data-ttu-id="55d28-156">Cenários</span><span class="sxs-lookup"><span data-stu-id="55d28-156">Scenarios</span></span>

### <a name="prerequisites"></a><span data-ttu-id="55d28-157">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="55d28-157">Prerequisites</span></span>

<span data-ttu-id="55d28-158">O acesso condicional do Azure AD é um recurso incluído no [Azure AD Premium](../active-directory-whatis.md#choose-an-edition).</span><span class="sxs-lookup"><span data-stu-id="55d28-158">Azure AD conditional access is a feature included in [Azure AD Premium](../active-directory-whatis.md#choose-an-edition).</span></span>  <span data-ttu-id="55d28-159">Você pode aprender mais sobre licenciamento requisitos Olá [relatório de uso não licenciado](../active-directory-conditional-access-unlicensed-usage-report.md).</span><span class="sxs-lookup"><span data-stu-id="55d28-159">You can learn more about licensing requirements in hello [unlicensed usage report](../active-directory-conditional-access-unlicensed-usage-report.md).</span></span>  <span data-ttu-id="55d28-160">Os desenvolvedores podem ingressar Olá [Microsoft Developer Network](https://msdn.microsoft.com/dn308572.aspx), que inclui toohello uma assinatura gratuita que inclui o Azure AD Premium Enterprise Mobility Suite.</span><span class="sxs-lookup"><span data-stu-id="55d28-160">Developers can join hello [Microsoft Developer Network](https://msdn.microsoft.com/dn308572.aspx), which includes a free subscription toohello Enterprise Mobility Suite which includes Azure AD Premium.</span></span>

### <a name="considerations-for-specific-scenarios"></a><span data-ttu-id="55d28-161">Considerações para cenários específicos</span><span class="sxs-lookup"><span data-stu-id="55d28-161">Considerations for specific scenarios</span></span>

<span data-ttu-id="55d28-162">Olá, somente as informações a seguir se aplica a esses cenários de acesso condicional:</span><span class="sxs-lookup"><span data-stu-id="55d28-162">hello following information only applies in these conditional access scenarios:</span></span>

* <span data-ttu-id="55d28-163">Aplicativos que estão acessando Olá Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="55d28-163">Apps accessing hello Microsoft Graph</span></span>
* <span data-ttu-id="55d28-164">Aplicativos de execução de fluxo de saudação em nome de</span><span class="sxs-lookup"><span data-stu-id="55d28-164">Apps performing hello on-behalf-of flow</span></span>
* <span data-ttu-id="55d28-165">Aplicativos acessando vários serviços/recursos</span><span class="sxs-lookup"><span data-stu-id="55d28-165">Apps accessing multiple services/resources</span></span>
* <span data-ttu-id="55d28-166">Aplicativos de única página usando ADAL.js</span><span class="sxs-lookup"><span data-stu-id="55d28-166">Single page apps using ADAL.js</span></span>

<span data-ttu-id="55d28-167">Em Olá seções a seguir, vamos comum cenários nos quais são mais complexos.</span><span class="sxs-lookup"><span data-stu-id="55d28-167">In hello following sections, we'll get into common scenarios in which are more complex.</span></span>  <span data-ttu-id="55d28-168">núcleo de saudação princípio operacional é acesso condicional políticas são avaliadas em tempo de Olá Olá token é solicitado para o serviço de saudação que tem uma política de acesso condicional aplicada, a menos que ele está sendo acessado por meio de saudação do Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="55d28-168">hello core operating principle is conditional access policies are evaluated at hello time hello token is requested for hello service that has a conditional access policy applied unless it's being accessed through hello Microsoft Graph.</span></span>

### <a name="scenario-app-accessing-hello-microsoft-graph"></a><span data-ttu-id="55d28-169">Cenário: Aplicativo acessando Olá Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="55d28-169">Scenario: App accessing hello Microsoft Graph</span></span>

<span data-ttu-id="55d28-170">Nesse cenário, vamos percorrer caso hello quando um aplicativo web solicita acesso toohello Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="55d28-170">In this scenario, we walk through hello case when a web app requests access toohello Microsoft Graph.</span></span> <span data-ttu-id="55d28-171">política de acesso condicional Olá nesse caso pode ser atribuída tooSharePoint, Exchange ou outro serviço que é acessado como uma carga de trabalho por meio de saudação do Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="55d28-171">hello conditional access policy in this case could be assigned tooSharePoint, Exchange, or some other service that is accessed as a workload through hello Microsoft Graph.</span></span>  <span data-ttu-id="55d28-172">Neste exemplo, vamos supor que haja uma política de acesso condicional no Sharepoint Online.</span><span class="sxs-lookup"><span data-stu-id="55d28-172">In this example, let's assume there's a conditional access policy on Sharepoint Online.</span></span>

![Acessando o diagrama de fluxo do Microsoft Graph saudação do aplicativo](media/active-directory-conditional-access-developer/app-accessing-microsoft-graph-scenario.png)

<span data-ttu-id="55d28-174">aplicativo Hello primeiro solicita autorização toohello Microsoft Graph que requer acesso a uma carga de trabalho downstream sem acesso condicional.</span><span class="sxs-lookup"><span data-stu-id="55d28-174">hello app first requests authorization toohello Microsoft Graph which requires accessing a downstream workload without conditional access.</span></span>  <span data-ttu-id="55d28-175">solicitação de saudação terá êxito sem invocar qualquer política e aplicativo hello recebe tokens do Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="55d28-175">hello request succeeds without invoking any policy and hello app receives tokens for Microsoft Graph.</span></span>  <span data-ttu-id="55d28-176">Neste ponto, aplicativo hello pode usar o token de acesso Olá em uma solicitação de portador para ponto de extremidade de saudação solicitado.</span><span class="sxs-lookup"><span data-stu-id="55d28-176">At this point, hello app may use hello access token in a bearer request for hello endpoint requested.</span></span> <span data-ttu-id="55d28-177">Agora, Olá aplicativo precisa tooaccess um ponto de extremidade do Sharepoint Online da Microsoft Graph, por exemplo:`https://graph.microsoft.com/v1.0/me/mySite`</span><span class="sxs-lookup"><span data-stu-id="55d28-177">Now, hello app needs tooaccess a Sharepoint Online endpoint of Microsoft Graph, for example: `https://graph.microsoft.com/v1.0/me/mySite`</span></span>

<span data-ttu-id="55d28-178">aplicativo Hello já tem um token válido para Olá Microsoft Graph, para executar nova solicitação de saudação sem ser emitido um novo token.</span><span class="sxs-lookup"><span data-stu-id="55d28-178">hello app already has a valid token for hello Microsoft Graph, so it can perform hello new request without being issued a new token.</span></span> <span data-ttu-id="55d28-179">Esta solicitação falhará e um desafio de declarações é emitido a partir do Microsoft Graph na forma de saudação de um HTTP 403 Proibido com um ```WWW-Authenticate``` desafio.</span><span class="sxs-lookup"><span data-stu-id="55d28-179">This request fails and a claims challenge is issued from Microsoft Graph in hello form of an HTTP 403 Forbidden with a ```WWW-Authenticate``` challenge.</span></span>
<span data-ttu-id="55d28-180">Aqui está um exemplo de resposta de saudação:</span><span class="sxs-lookup"><span data-stu-id="55d28-180">Here's an example of hello response:</span></span> 

```
HTTP 403; Forbidden 
error=insufficient_claims
www-authenticate="Bearer realm="", authorization_uri="https://login.windows.net/common/oauth2/authorize", client_id="<GUID>", error=insufficient_claims, claims={"access_token":{"polids":{"essential":true,"values":["<GUID>"]}}}"
```

<span data-ttu-id="55d28-181">Olá declarações desafio está dentro de saudação ```WWW-Authenticate``` cabeçalho, que pode ser analisado tooextract Olá declarações parâmetro para a próxima solicitação de saudação.</span><span class="sxs-lookup"><span data-stu-id="55d28-181">hello claims challenge is inside hello ```WWW-Authenticate``` header, which can be parsed tooextract hello claims parameter for hello next request.</span></span>  <span data-ttu-id="55d28-182">Quando estiver anexado toohello nova solicitação, AD do Azure sabe política de acesso condicional tooevaluate hello quando entrar no usuário hello e aplicativo hello agora está em conformidade com a política de acesso condicional hello.</span><span class="sxs-lookup"><span data-stu-id="55d28-182">Once it's appended toohello new request, Azure AD knows tooevaluate hello conditional access policy when signing in hello user and hello app is now in compliance with hello conditional access policy.</span></span>  <span data-ttu-id="55d28-183">Ponto de extremidade toohello de solicitação de saudação do Sharepoint Online de repetição é bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="55d28-183">Repeating hello request toohello Sharepoint Online endpoint succeeds.</span></span>

<span data-ttu-id="55d28-184">Para obter exemplos de código que demonstram como toohandle Olá declarações desafio, consulte toohello [exemplo de código de área de trabalho do .NET](https://github.com/Azure-Samples/active-directory-dotnet-native-desktop) ADAL .NET ou Olá [em nome de código de exemplo](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca) para .NET ADAL.</span><span class="sxs-lookup"><span data-stu-id="55d28-184">For code samples that demonstrate how toohandle hello claims challenge, refer toohello [.NET Desktop code sample](https://github.com/Azure-Samples/active-directory-dotnet-native-desktop) for ADAL .NET or hello [On-behalf-of code sample](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca) for ADAL .NET.</span></span>

### <a name="scenario-app-performing-hello-on-behalf-of-flow"></a><span data-ttu-id="55d28-185">Cenário: Aplicativo executar o fluxo de saudação em nome de</span><span class="sxs-lookup"><span data-stu-id="55d28-185">Scenario: App performing hello on-behalf-of flow</span></span>

<span data-ttu-id="55d28-186">Nesse cenário, vemos caso Olá no qual um aplicativo nativo chama uma API da serviços web.</span><span class="sxs-lookup"><span data-stu-id="55d28-186">In this scenario, we walk through hello case in which a native app calls a web service/API.</span></span>  <span data-ttu-id="55d28-187">Por sua vez, esse serviço faz [hello "em nome de" fluxo](active-directory-authentication-scenarios.md#application-types-and-scenarios) toocall um serviço de downstream.</span><span class="sxs-lookup"><span data-stu-id="55d28-187">In turn, this service does [hello "on-behalf-of" flow](active-directory-authentication-scenarios.md#application-types-and-scenarios) toocall a downstream service.</span></span>  <span data-ttu-id="55d28-188">Em nosso caso, estamos aplicou nosso serviço downstream do acesso condicional política toohello (Web API 2) e estiver usando um aplicativo nativo em vez de um aplicativo de servidor/daemon.</span><span class="sxs-lookup"><span data-stu-id="55d28-188">In our case, we've applied our conditional access policy toohello downstream service (Web API 2) and are using a native app rather than a server/daemon app.</span></span> 

![Olá em nome de diagrama de fluxo de execução do aplicativo](media/active-directory-conditional-access-developer/app-performing-on-behalf-of-scenario.png)

<span data-ttu-id="55d28-190">solicitação de token inicial Olá para API Web 1 não solicita informações do usuário final Olá para autenticação multifator como API Web 1 não pode atingir sempre Olá API de downstream.</span><span class="sxs-lookup"><span data-stu-id="55d28-190">hello initial token request for Web API 1 does not prompt hello end-user for multi-factor authentication as Web API 1 may not always hit hello downstream API.</span></span>  <span data-ttu-id="55d28-191">Depois que a API Web 1 tenta toorequest um usuário de token em nome de saudação para API Web 2, falha na solicitação de saudação como usuário Olá não foi assinada com autenticação multifator.</span><span class="sxs-lookup"><span data-stu-id="55d28-191">Once Web API 1 tries toorequest a token on-behalf-of hello user for Web API 2, hello request fails since hello user has not signed in with multi-factor authentication.</span></span>

<span data-ttu-id="55d28-192">O Azure AD retorna uma resposta HTTP com alguns dados interessantes:</span><span class="sxs-lookup"><span data-stu-id="55d28-192">Azure AD returns an HTTP response with some interesting data:</span></span> 

> [!NOTE]
> <span data-ttu-id="55d28-193">Neste exemplo é uma descrição de erro de autenticação multifator, mas não há uma ampla gama de `interaction_required` acesso possíveis de tooconditional pertencem.</span><span class="sxs-lookup"><span data-stu-id="55d28-193">In this instance it's a multi-factor authentication error description, but there's a wide range of `interaction_required` possible pertaining tooconditional access.</span></span>  

```
HTTP 400; Bad Request 
error=interaction_required
error_description=AADSTS50076: Due tooa configuration change made by your administrator, or because you moved tooa new location, you must use multi-factor authentication tooaccess '<Web API 2 App/Client ID>'.
claims={"access_token":{"polids":{"essential":true,"Values":["<GUID>"]}}}
```

<span data-ttu-id="55d28-194">Em nossa API Web 1, podemos captura erro Olá `error=interaction_required`e enviar Olá back `claims` aplicativo de área de trabalho de toohello de desafio.</span><span class="sxs-lookup"><span data-stu-id="55d28-194">In our Web API 1, we catch hello error `error=interaction_required`, and send back hello `claims` challenge toohello desktop app.</span></span>  <span data-ttu-id="55d28-195">Nesse ponto, pode fazer um novo aplicativo de área de trabalho Olá `acquireToken()` chamar e acrescentar Olá `claims`desafio como um parâmetro de cadeia de caracteres de consulta adicional.</span><span class="sxs-lookup"><span data-stu-id="55d28-195">At that point, hello desktop app can make a new `acquireToken()` call and append hello `claims`challenge as an extra query string parameter.</span></span>  <span data-ttu-id="55d28-196">Essa nova solicitação requer autenticação de multifator Olá usuário toodo e, em seguida, enviar esse novo token back tooWeb API 1 e a saudação completa em nome de fluxo.</span><span class="sxs-lookup"><span data-stu-id="55d28-196">This new request requires hello user toodo multi-factor authentication and then send this new token back tooWeb API 1 and complete hello on-behalf-of flow.</span></span>

<span data-ttu-id="55d28-197">tootry esse cenário, consulte nosso [exemplo de código do .NET](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca).</span><span class="sxs-lookup"><span data-stu-id="55d28-197">tootry out this scenario, see our [.NET code sample](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca).</span></span>  <span data-ttu-id="55d28-198">Ele demonstra como toopass Olá desafio de declarações do aplicativo nativo do API Web 1 toohello e construir uma nova solicitação de dentro do aplicativo de cliente hello.</span><span class="sxs-lookup"><span data-stu-id="55d28-198">It demonstrates how toopass hello claims challenge back from Web API 1 toohello native app and construct a new request inside hello client app.</span></span> 

### <a name="scenario-app-accessing-multiple-services"></a><span data-ttu-id="55d28-199">Cenário: aplicativo acessando vários serviços</span><span class="sxs-lookup"><span data-stu-id="55d28-199">Scenario: App accessing multiple services</span></span>

<span data-ttu-id="55d28-200">Nesse cenário, vemos caso Olá em que um aplicativo web acessa dois serviços um dos quais tem uma política de acesso condicional atribuída.</span><span class="sxs-lookup"><span data-stu-id="55d28-200">In this scenario, we walk through hello case in which a web app accesses two services one of which has a conditional access policy assigned.</span></span>  <span data-ttu-id="55d28-201">Dependendo de sua lógica de aplicativo, pode existir um caminho no qual seu aplicativo não exigir acesso tooboth web services.</span><span class="sxs-lookup"><span data-stu-id="55d28-201">Depending on your app logic, there may exist a path in which your app does not require access tooboth web services.</span></span>  <span data-ttu-id="55d28-202">Nesse cenário, em que você solicitar um token de ordem de saudação desempenha um papel importante na experiência do usuário final de saudação.</span><span class="sxs-lookup"><span data-stu-id="55d28-202">In this scenario, hello order in which you request a token plays an important role in hello end-user experience.</span></span>

<span data-ttu-id="55d28-203">Vamos supor que temos o serviço Web A e B, e o serviço Web B tem nossa política de acesso condicional aplicada.</span><span class="sxs-lookup"><span data-stu-id="55d28-203">Let's assume we have web service A and B and web service B has our conditional access policy applied.</span></span>  <span data-ttu-id="55d28-204">Durante a saudação inicial interativa de solicitações de autenticação requer o consentimento para ambos os serviços, a política de acesso condicional de saudação não é necessário em todos os casos.</span><span class="sxs-lookup"><span data-stu-id="55d28-204">While hello initial interactive auth request requires consent for both services, hello conditional access policy is not required in all cases.</span></span>  <span data-ttu-id="55d28-205">Se o aplicativo hello solicita um token para o serviço web B, diretiva Olá é invocada, e as solicitações subsequentes de serviço da web A também será bem-sucedida da seguinte maneira.</span><span class="sxs-lookup"><span data-stu-id="55d28-205">If hello app requests a token for web service B, then hello policy is invoked and subsequent requests for web service A also succeeds as follows.</span></span>

![Diagrama do fluxo de aplicativo acessando vários serviços](media/active-directory-conditional-access-developer/app-accessing-multiple-services-scenario.png)

<span data-ttu-id="55d28-207">Como alternativa, se o aplicativo hello inicialmente solicita um token para um de serviço da web, usuários finais de saudação não invocar política de acesso condicional hello.</span><span class="sxs-lookup"><span data-stu-id="55d28-207">Alternatively, if hello app initially requests a token for web service A, hello end-user does not invoke hello conditional access policy.</span></span>  <span data-ttu-id="55d28-208">Isso permite que o desenvolvedor do aplicativo hello experiência do toocontrol saudação do usuário final e não forçar toobe de política de acesso condicional Olá invocado em todos os casos.</span><span class="sxs-lookup"><span data-stu-id="55d28-208">This allows hello app developer toocontrol hello end-user experience and not force hello conditional access policy toobe invoked in all cases.</span></span> <span data-ttu-id="55d28-209">Olá difícil ocorre se o aplicativo hello subsequentemente solicita um token para o serviço web B. Neste ponto, usuários finais de saudação precisa toocomply com a política de acesso condicional hello.</span><span class="sxs-lookup"><span data-stu-id="55d28-209">hello tricky case is if hello app subsequently requests a token for web service B. At this point, hello end-user needs toocomply with hello conditional access policy.</span></span>  <span data-ttu-id="55d28-210">Quando o aplicativo hello tenta muito`acquireToken`, ele pode gerar hello (ilustrado no diagrama a seguir de saudação) de erro a seguir:</span><span class="sxs-lookup"><span data-stu-id="55d28-210">When hello app tries too`acquireToken`, it may generate hello following error (illustrated in hello following diagram):</span></span> 

```
HTTP 400; Bad Request
error=interaction_required
error_description=AADSTS50076: Due tooa configuration change made by your administrator, or because you moved tooa new location, you must use multi-factor authentication tooaccess '<Web API App/Client ID>'.
claims={"access_token":{"polids":{"essential":true,"Values":["<GUID>"]}}}
``` 

![Aplicativo acessando vários serviços que solicitam um novo token](media/active-directory-conditional-access-developer/app-accessing-multiple-services-new-token.png)

<span data-ttu-id="55d28-212">Se o aplicativo hello está usando a biblioteca ADAL hello, um token de saudação tooacquire falha será sempre repetido interativamente.</span><span class="sxs-lookup"><span data-stu-id="55d28-212">If hello app is using hello ADAL library, a failure tooacquire hello token is always retried interactively.</span></span>  <span data-ttu-id="55d28-213">Quando essa solicitação interativa ocorre, usuários finais de saudação tem Olá oportunidade toocomply com acesso condicional hello.</span><span class="sxs-lookup"><span data-stu-id="55d28-213">When this interactive request occurs, hello end-user has hello opportunity toocomply with hello conditional access.</span></span>  <span data-ttu-id="55d28-214">Isso é verdadeiro, a menos que seja de solicitação de saudação um `AcquireTokenSilentAsync` ou `PromptBehavior.Never` caso em que o aplicativo hello precisa tooperform interativo ```AcquireToken``` toogive Olá uso final Olá oportunidade toocomply com a política de saudação de solicitação.</span><span class="sxs-lookup"><span data-stu-id="55d28-214">This is true unless hello request is a `AcquireTokenSilentAsync` or `PromptBehavior.Never` in which case hello app needs tooperform an interactive ```AcquireToken``` request toogive hello end use hello opportunity toocomply with hello policy.</span></span> 

### <a name="scenario-single-page-app-spa-using-adaljs"></a><span data-ttu-id="55d28-215">Cenário: SPA (Aplicativo de Única Página) usando ADAL.js</span><span class="sxs-lookup"><span data-stu-id="55d28-215">Scenario: Single Page App (SPA) using ADAL.js</span></span>

<span data-ttu-id="55d28-216">Nesse cenário, percorremos caso hello quando temos um aplicativo de página única (SPA), usando o ADAL.js toocall um acesso condicional protegidos API da web.</span><span class="sxs-lookup"><span data-stu-id="55d28-216">In this scenario, we walk through hello case when we have a single page app (SPA), using ADAL.js toocall a conditional access protected web API.</span></span>  <span data-ttu-id="55d28-217">Essa é uma arquitetura simple, mas tem algumas nuances que precisam toobe levado em consideração ao desenvolver uma solução alternativa para o acesso condicional.</span><span class="sxs-lookup"><span data-stu-id="55d28-217">This is a simple architecture but has some nuances that need toobe taken into account when developing around conditional access.</span></span>

<span data-ttu-id="55d28-218">No ADAL.js, há algumas funções que obtêm tokens: `login()`, `acquireToken(...)`, `acquireTokenPopup(…)` e `acquireTokenRedirect(…)`.</span><span class="sxs-lookup"><span data-stu-id="55d28-218">In ADAL.js, there are a few functions that obtain tokens: `login()`, `acquireToken(...)`, `acquireTokenPopup(…)`, and `acquireTokenRedirect(…)`.</span></span> 

* <span data-ttu-id="55d28-219">`login()` obtém um token de ID por meio de uma solicitação de entrada interativa, mas não obtém tokens de acesso para qualquer serviço (incluindo uma API Web protegida por acesso condicional).</span><span class="sxs-lookup"><span data-stu-id="55d28-219">`login()` obtains an ID token through an interactive sign-in request but does not obtain access tokens for any service (including a conditional access protected web API).</span></span>  
* <span data-ttu-id="55d28-220">`acquireToken(…)`pode ser usado toosilently obter um token de acesso que significa que ele não mostrar interface do usuário em nenhuma circunstância.</span><span class="sxs-lookup"><span data-stu-id="55d28-220">`acquireToken(…)` can then be used toosilently obtain an access token meaning it does not show UI in any circumstance.</span></span>  
* <span data-ttu-id="55d28-221">`acquireTokenPopup(…)`e `acquireTokenRedirect(…)` são ambos usados toointeractively solicitar um token para um recurso que significa que eles sempre mostrarem a entrada da interface do usuário.</span><span class="sxs-lookup"><span data-stu-id="55d28-221">`acquireTokenPopup(…)` and `acquireTokenRedirect(…)` are both used toointeractively request a token for a resource meaning they always show sign-in UI.</span></span>

<span data-ttu-id="55d28-222">Quando um aplicativo precisa ter um toocall de token de acesso uma API da Web, ele tenta uma `acquireToken(…)`.</span><span class="sxs-lookup"><span data-stu-id="55d28-222">When an app needs an access token toocall a Web API, it attempts an `acquireToken(…)`.</span></span>  <span data-ttu-id="55d28-223">Se a sessão token Olá expirou ou é necessário toocomply com uma política de acesso condicional, Olá *acquireToken* função falhar e Olá aplicativo usa `acquireTokenPopup()` ou `acquireTokenRedirect()`.</span><span class="sxs-lookup"><span data-stu-id="55d28-223">If hello token session is expired or we need toocomply with a conditional access policy, then hello *acquireToken* function fails and hello app uses `acquireTokenPopup()` or `acquireTokenRedirect()`.</span></span>

![Diagrama do fluxo de aplicativo de única página usando ADAL](media/active-directory-conditional-access-developer/spa-using-adal-scenario.png)

<span data-ttu-id="55d28-225">Vamos examinar um exemplo com nosso cenário de acesso condicional.</span><span class="sxs-lookup"><span data-stu-id="55d28-225">Let's walk through an example with our conditional access scenario.</span></span>  <span data-ttu-id="55d28-226">usuário final de saudação apenas descarregou no site hello e não tem uma sessão.</span><span class="sxs-lookup"><span data-stu-id="55d28-226">hello end-user just landed on hello site and doesn’t have a session.</span></span>  <span data-ttu-id="55d28-227">Executamos uma chamada `login()`, obtemos um token de ID sem autenticação multifator.</span><span class="sxs-lookup"><span data-stu-id="55d28-227">We perform a `login()` call, get an ID token without multi-factor authentication.</span></span>  <span data-ttu-id="55d28-228">Em seguida, o usuário de saudação atinge um botão que requer Olá aplicativo toorequest dados de uma API da web.</span><span class="sxs-lookup"><span data-stu-id="55d28-228">Then hello user hits a button that requires hello app toorequest data from a web API.</span></span>  <span data-ttu-id="55d28-229">Olá aplicativo tenta toodo um `acquireToken()` chamada mas falha porque o usuário Olá não realizou ainda a autenticação multifator e precisa toocomply com a política de acesso condicional hello.</span><span class="sxs-lookup"><span data-stu-id="55d28-229">hello app tries toodo an `acquireToken()` call but fails since hello user has not performed multi-factor authentication yet and needs toocomply with hello conditional access policy.</span></span>

<span data-ttu-id="55d28-230">AD do Azure envia back Olá resposta HTTP a seguir:</span><span class="sxs-lookup"><span data-stu-id="55d28-230">Azure AD sends back hello following HTTP response:</span></span> 

```
HTTP 400; Bad Request 
error=interaction_required
error_description=AADSTS50076: Due tooa configuration change made by your administrator, or because you moved tooa new location, you must use multi-factor authentication tooaccess '<Web API App/Client ID>'.
```

<span data-ttu-id="55d28-231">Nosso aplicativo precisa Olá toocatch `error=interaction_required`.</span><span class="sxs-lookup"><span data-stu-id="55d28-231">Our app needs toocatch hello `error=interaction_required`.</span></span>  <span data-ttu-id="55d28-232">Olá aplicativo pode usar o `acquireTokenPopup()` ou `acquireTokenRedirect()` Olá no mesmo recurso.</span><span class="sxs-lookup"><span data-stu-id="55d28-232">hello application can then use either `acquireTokenPopup()` or `acquireTokenRedirect()` on hello same resource.</span></span>  <span data-ttu-id="55d28-233">usuário de saudação é forçado toodo uma autenticação multifator.</span><span class="sxs-lookup"><span data-stu-id="55d28-233">hello user is forced toodo a multi-factor authentication.</span></span> <span data-ttu-id="55d28-234">Depois que o usuário Olá conclui a autenticação multifator hello, aplicativo hello é emitido uma nova recurso do token de acesso para Olá solicitado.</span><span class="sxs-lookup"><span data-stu-id="55d28-234">After hello user completes hello multi-factor authentication, hello app is issued a fresh access token for hello requested resource.</span></span>

<span data-ttu-id="55d28-235">tootry esse cenário, consulte nosso [em nome de código de exemplo do SPA JS](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca).</span><span class="sxs-lookup"><span data-stu-id="55d28-235">tootry out this scenario, see our [JS SPA On-behalf-of code sample](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca).</span></span>  <span data-ttu-id="55d28-236">Este exemplo de código usa a política de acesso condicional hello e você registrou anteriormente com um toodemonstrate JS SPA neste cenário de API da web.</span><span class="sxs-lookup"><span data-stu-id="55d28-236">This code sample uses hello conditional access policy and web API you registered earlier with a JS SPA toodemonstrate this scenario.</span></span> <span data-ttu-id="55d28-237">Ele mostra como declarações de saudação do identificador tooproperly desafiam e obtém um token de acesso que pode ser usado para a API da Web.</span><span class="sxs-lookup"><span data-stu-id="55d28-237">It shows how tooproperly handle hello claims challenge and get an access token that can be used for your Web API.</span></span> <span data-ttu-id="55d28-238">Como alternativa, Olá de check-out geral [Angular.js exemplo de código](https://github.com/Azure-Samples/active-directory-angularjs-singlepageapp) para obter orientação sobre um SPA Angular</span><span class="sxs-lookup"><span data-stu-id="55d28-238">Alternatively, checkout hello general [Angular.js code sample](https://github.com/Azure-Samples/active-directory-angularjs-singlepageapp) for guidance on an Angular SPA</span></span>


## <a name="see-also"></a><span data-ttu-id="55d28-239">Consulte também</span><span class="sxs-lookup"><span data-stu-id="55d28-239">See also</span></span>

* <span data-ttu-id="55d28-240">toolearn mais sobre os recursos de hello, consulte [acesso condicional no AD do Azure](../active-directory-conditional-access.md).</span><span class="sxs-lookup"><span data-stu-id="55d28-240">toolearn more about hello capabilities, see [Conditional Access in Azure AD](../active-directory-conditional-access.md).</span></span>
* <span data-ttu-id="55d28-241">Para obter mais exemplos de código do Azure AD, confira o [repositório Github de exemplos de código](https://github.com/azure-samples?utf8=%E2%9C%93&q=active-directory).</span><span class="sxs-lookup"><span data-stu-id="55d28-241">For more Azure AD code samples, see [Github Repo of Code Samples](https://github.com/azure-samples?utf8=%E2%9C%93&q=active-directory).</span></span> 
* <span data-ttu-id="55d28-242">Para obter mais informações sobre Olá documentação de referência de saudação do SDK do ADAL e acesso, consulte [guia biblioteca](active-directory-authentication-libraries.md).</span><span class="sxs-lookup"><span data-stu-id="55d28-242">For more info on hello ADAL SDK's and access hello reference documentation, see [library guide](active-directory-authentication-libraries.md).</span></span>
* <span data-ttu-id="55d28-243">toolearn mais sobre cenários multilocatário, consulte [como toosign em usuários usando Olá multilocatário padrão](active-directory-devhowto-multi-tenant-overview.md).</span><span class="sxs-lookup"><span data-stu-id="55d28-243">toolearn more about multi-tenant scenarios, see [How toosign in users using hello multi-tenant pattern](active-directory-devhowto-multi-tenant-overview.md).</span></span>
