---
title: "Logon único com o Proxy de Aplicativo | Microsoft Docs"
description: "Aborda como fornecer o logon único usando o Proxy de Aplicativo Azure AD."
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: ded0d9c9-45f6-47d7-bd0f-3f7fd99ab621
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/25/2017
ms.author: kgremban
ms.reviewer: harshja
ms.custom: H1Hack27Feb2017, it-pro
ms.openlocfilehash: 149af1f68e574f78127a9c2de8a0e79ed8774d29
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/18/2017
---
# <a name="kerberos-constrained-delegation-for-single-sign-on-to-your-apps-with-application-proxy"></a><span data-ttu-id="e69ee-103">Delegação restrita de Kerberos para logon único em seus aplicativos com o Proxy de Aplicativo</span><span class="sxs-lookup"><span data-stu-id="e69ee-103">Kerberos Constrained Delegation for single sign-on to your apps with Application Proxy</span></span>

<span data-ttu-id="e69ee-104">Você pode fornecer o logon único para aplicativos locais, publicados por meio do Proxy do Aplicativo, que sejam protegidos com a Autenticação Integrada do Windows.</span><span class="sxs-lookup"><span data-stu-id="e69ee-104">You can provide single sign-on for on-premises applications published through Application Proxy that are secured with Integrated Windows Authentication.</span></span> <span data-ttu-id="e69ee-105">Esses aplicativos exigem um tíquete Kerberos para acessar.</span><span class="sxs-lookup"><span data-stu-id="e69ee-105">These applications require a Kerberos ticket for access.</span></span> <span data-ttu-id="e69ee-106">O Proxy do Aplicativo usa a KCD (Delegação restrita de Kerberos) para dar suporte a esses aplicativos.</span><span class="sxs-lookup"><span data-stu-id="e69ee-106">Application Proxy uses Kerberos Constrained Delegation (KCD) to support these applications.</span></span> 

<span data-ttu-id="e69ee-107">Você pode habilitar o logon único para seus aplicativos usando a IWA (Autenticação Integrada do Windows) concedendo permissão aos conectores do Proxy de Aplicativo no Active Directory para representar usuários.</span><span class="sxs-lookup"><span data-stu-id="e69ee-107">You can enable single sign-on to your applications using Integrated Windows Authentication (IWA) by giving Application Proxy connectors permission in Active Directory to impersonate users.</span></span> <span data-ttu-id="e69ee-108">Os conectores usam essa permissão para enviar e receber tokens em seu nome.</span><span class="sxs-lookup"><span data-stu-id="e69ee-108">The connectors use this permission to send and receive tokens on their behalf.</span></span>

## <a name="how-single-sign-on-with-kcd-works"></a><span data-ttu-id="e69ee-109">Como funciona o logon único com a KCD</span><span class="sxs-lookup"><span data-stu-id="e69ee-109">How single sign-on with KCD works</span></span>
<span data-ttu-id="e69ee-110">Este diagrama explica o fluxo de quando um usuário tenta acessar um aplicativo local que usa IWA.</span><span class="sxs-lookup"><span data-stu-id="e69ee-110">This diagram explains the flow when a user attempts to access an on-prem application that uses IWA.</span></span>

![Diagrama de fluxo de autenticação do Microsoft AAD](./media/active-directory-application-proxy-sso-using-kcd/AuthDiagram.png)

1. <span data-ttu-id="e69ee-112">O usuário insere a URL para acessar o aplicativo local por meio do Proxy de Aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e69ee-112">The user enters the URL to access the on-prem application through Application Proxy.</span></span>
2. <span data-ttu-id="e69ee-113">O Proxy de Aplicativo redireciona a solicitação para serviços de autenticação do AD do Azure para pré-autenticação.</span><span class="sxs-lookup"><span data-stu-id="e69ee-113">Application Proxy redirects the request to Azure AD authentication services to preauthenticate.</span></span> <span data-ttu-id="e69ee-114">Neste ponto, o AD do Azure se aplica a qualquer política de autenticação e autorização aplicável, tal como autenticação multifator.</span><span class="sxs-lookup"><span data-stu-id="e69ee-114">At this point, Azure AD applies any applicable authentication and authorization policies, such as multifactor authentication.</span></span> <span data-ttu-id="e69ee-115">Se o usuário for validado, o AD do Azure cria um token e o envia para o usuário.</span><span class="sxs-lookup"><span data-stu-id="e69ee-115">If the user is validated, Azure AD creates a token and sends it to the user.</span></span>
3. <span data-ttu-id="e69ee-116">O usuário passa o token para o Proxy de Aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e69ee-116">The user passes the token to Application Proxy.</span></span>
4. <span data-ttu-id="e69ee-117">O Proxy de Aplicativo valida o token e recupera o nome UPN (nome UPN), enviando em seguida a solicitação, o UPN e o SPN (Nome da Entidade de Serviço) para o Conector por meio de um canal de segurança duplamente autenticado.</span><span class="sxs-lookup"><span data-stu-id="e69ee-117">Application Proxy validates the token and retrieves the User Principal Name (UPN) from it, and then sends the request, the UPN, and the Service Principal Name (SPN) to the Connector through a dually authenticated secure channel.</span></span>
5. <span data-ttu-id="e69ee-118">O conector realiza a negociação do KCD (Delegação Restrita de Kerberos) com o AD local, representando o usuário para obter um token Kerberos para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e69ee-118">The Connector performs Kerberos Constrained Delegation (KCD) negotiation with the on-prem AD, impersonating the user to get a Kerberos token to the application.</span></span>
6. <span data-ttu-id="e69ee-119">O Active Directory envia o token Kerberos para o aplicativo para o Conector.</span><span class="sxs-lookup"><span data-stu-id="e69ee-119">Active Directory sends the Kerberos token for the application to the Connector.</span></span>
7. <span data-ttu-id="e69ee-120">O Conector envia a solicitação original para o servidor de aplicativos usando o token Kerberos recebido do AD.</span><span class="sxs-lookup"><span data-stu-id="e69ee-120">The Connector sends the original request to the application server, using the Kerberos token it received from AD.</span></span>
8. <span data-ttu-id="e69ee-121">O aplicativo envia a resposta para o Conector, que é retornada para o serviço de Proxy de Aplicativo e, finalmente, para o usuário.</span><span class="sxs-lookup"><span data-stu-id="e69ee-121">The application sends the response to the Connector, which is then returned to the Application Proxy service and finally to the user.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="e69ee-122">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="e69ee-122">Prerequisites</span></span>
<span data-ttu-id="e69ee-123">Antes de começar com o logon único para aplicativos da IWA, verifique se seu ambiente está preparado com as seguintes configurações e definições:</span><span class="sxs-lookup"><span data-stu-id="e69ee-123">Before you get started with single sign-on for IWA applications, make sure your environment is ready with the following settings and configurations:</span></span>

* <span data-ttu-id="e69ee-124">Seus aplicativos, como os aplicativos Web do SharePoint, são definidos para usar a Autenticação Integrada do Windows.</span><span class="sxs-lookup"><span data-stu-id="e69ee-124">Your apps, like SharePoint Web apps, are set to use Integrated Windows Authentication.</span></span> <span data-ttu-id="e69ee-125">Para sabe rmais, veja [Habilitar suporte para autenticação Kerberos](https://technet.microsoft.com/library/dd759186.aspx), ou para o SharePoint, consulte [Planejar a autenticação Kerberos no SharePoint 2013](https://technet.microsoft.com/library/ee806870.aspx).</span><span class="sxs-lookup"><span data-stu-id="e69ee-125">For more information, see [Enable Support for Kerberos Authentication](https://technet.microsoft.com/library/dd759186.aspx), or for SharePoint see [Plan for Kerberos authentication in SharePoint 2013](https://technet.microsoft.com/library/ee806870.aspx).</span></span>
* <span data-ttu-id="e69ee-126">Todos os seus aplicativos têm [nome da entidade de serviço](https://social.technet.microsoft.com/wiki/contents/articles/717.service-principal-names-spns-setspn-syntax-setspn-exe.aspx).</span><span class="sxs-lookup"><span data-stu-id="e69ee-126">All your apps have [Service Principal Names](https://social.technet.microsoft.com/wiki/contents/articles/717.service-principal-names-spns-setspn-syntax-setspn-exe.aspx).</span></span>
* <span data-ttu-id="e69ee-127">O servidor que executa o Conector e o servidor que executa o aplicativo que você está publicando são ingressados em domínio e fazem parte desse mesmo domínio ou em domínios confiáveis.</span><span class="sxs-lookup"><span data-stu-id="e69ee-127">The server running the Connector and the server running the app are domain joined and part of the same domain or trusting domains.</span></span> <span data-ttu-id="e69ee-128">Para obter mais informações sobre o ingresso no domínio, consulte [Ingressar um computador em um domínio](https://technet.microsoft.com/library/dd807102.aspx).</span><span class="sxs-lookup"><span data-stu-id="e69ee-128">For more information on domain join, see [Join a Computer to a Domain](https://technet.microsoft.com/library/dd807102.aspx).</span></span>
* <span data-ttu-id="e69ee-129">O servidor que executa o conector tem acesso de leitura ao atributo TokenGroupsGlobalAndUniversal para usuários.</span><span class="sxs-lookup"><span data-stu-id="e69ee-129">The server running the Connector has access to read the TokenGroupsGlobalAndUniversal attribute for users.</span></span> <span data-ttu-id="e69ee-130">Essa configuração padrão pode ter sido afetada pelo aumento das restrições de segurança que protegem o ambiente.</span><span class="sxs-lookup"><span data-stu-id="e69ee-130">This default setting might have been impacted by security hardening the environment.</span></span>

### <a name="configure-active-directory"></a><span data-ttu-id="e69ee-131">Configurar o Active Directory</span><span class="sxs-lookup"><span data-stu-id="e69ee-131">Configure Active Directory</span></span>
<span data-ttu-id="e69ee-132">A configuração do Active Directory varia, dependendo de se o conector do Proxy do Aplicativo e o servidor de aplicativos estão no mesmo domínio ou não.</span><span class="sxs-lookup"><span data-stu-id="e69ee-132">The Active Directory configuration varies, depending on whether your Application Proxy connector and the application server are in the same domain or not.</span></span>

#### <a name="connector-and-application-server-in-the-same-domain"></a><span data-ttu-id="e69ee-133">O conector e o servidor de aplicativos estão no mesmo domínio</span><span class="sxs-lookup"><span data-stu-id="e69ee-133">Connector and application server in the same domain</span></span>
1. <span data-ttu-id="e69ee-134">No Active Directory, vá para **Ferramentas** > **Usuários e Computadores**.</span><span class="sxs-lookup"><span data-stu-id="e69ee-134">In Active Directory, go to **Tools** > **Users and Computers**.</span></span>
2. <span data-ttu-id="e69ee-135">Selecione o servidor que executa o conector.</span><span class="sxs-lookup"><span data-stu-id="e69ee-135">Select the server running the connector.</span></span>
3. <span data-ttu-id="e69ee-136">Clique com o botão direito do mouse e selecione **Propriedades** > **Delegação**.</span><span class="sxs-lookup"><span data-stu-id="e69ee-136">Right-click and select **Properties** > **Delegation**.</span></span>
4. <span data-ttu-id="e69ee-137">Selecione **Confiar no computador para delegação apenas a serviços especificados**.</span><span class="sxs-lookup"><span data-stu-id="e69ee-137">Select **Trust this computer for delegation to specified services only**.</span></span> 
5. <span data-ttu-id="e69ee-138">Em **Serviços aos quais esta conta pode apresentar credenciais delegadas**, adicione o valor da identidade SPN do servidor de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="e69ee-138">Under **Services to which this account can present delegated credentials** add the value for the SPN identity of the application server.</span></span> <span data-ttu-id="e69ee-139">Isso permite que o Conector do Proxy de Aplicativo represente usuários no AD para os aplicativos definidos na lista.</span><span class="sxs-lookup"><span data-stu-id="e69ee-139">This enables the Application Proxy Connector to impersonate users in AD against the applications defined in the list.</span></span>

   ![Captura de tela da janela Propriedades do Conector SVR](./media/active-directory-application-proxy-sso-using-kcd/Properties.jpg)

#### <a name="connector-and-application-server-in-different-domains"></a><span data-ttu-id="e69ee-141">O conector e o servidor de aplicativos estão em domínios diferentes</span><span class="sxs-lookup"><span data-stu-id="e69ee-141">Connector and application server in different domains</span></span>
1. <span data-ttu-id="e69ee-142">Para obter uma lista de pré-requisitos para trabalhar com o KCD entre domínios, consulte [Delegação restrita de Kerberos nos domínios](https://technet.microsoft.com/library/hh831477.aspx).</span><span class="sxs-lookup"><span data-stu-id="e69ee-142">For a list of prerequisites for working with KCD across domains, see [Kerberos Constrained Delegation across domains](https://technet.microsoft.com/library/hh831477.aspx).</span></span>
2. <span data-ttu-id="e69ee-143">Use a propriedade `principalsallowedtodelegateto` no servidor do conector para habilitar o Proxy do Aplicativo a delegar para o servidor do conector.</span><span class="sxs-lookup"><span data-stu-id="e69ee-143">Use the `principalsallowedtodelegateto` property on the Connector server to enable the Application Proxy to delegate for the Connector server.</span></span> <span data-ttu-id="e69ee-144">O servidor de aplicativos é o `sharepointserviceaccount` e o servidor de delegação é o `connectormachineaccount`.</span><span class="sxs-lookup"><span data-stu-id="e69ee-144">The application server is `sharepointserviceaccount` and the delegating server is `connectormachineaccount`.</span></span> <span data-ttu-id="e69ee-145">Para o Windows 2012 R2, use esse código como um exemplo:</span><span class="sxs-lookup"><span data-stu-id="e69ee-145">For Windows 2012 R2, use this code as an example:</span></span>

        $connector= Get-ADComputer -Identity connectormachineaccount -server dc.connectordomain.com

        Set-ADComputer -Identity sharepointserviceaccount -PrincipalsAllowedToDelegateToAccount $connector

        Get-ADComputer sharepointserviceaccount -Properties PrincipalsAllowedToDelegateToAccount

<span data-ttu-id="e69ee-146">Sharepointserviceaccount pode ser a conta do computador do SPS ou uma conta de serviço sob a qual o pool de aplicativos do SPS está sendo executado.</span><span class="sxs-lookup"><span data-stu-id="e69ee-146">Sharepointserviceaccount can be the SPS machine account or a service account under which the SPS app pool is running.</span></span>

## <a name="configure-single-sign-on"></a><span data-ttu-id="e69ee-147">Configurar o logon único</span><span class="sxs-lookup"><span data-stu-id="e69ee-147">Configure single sign-on</span></span> 
1. <span data-ttu-id="e69ee-148">Publique seu aplicativo seguindo as instruções descritas em [Publicar aplicativos com o Proxy de Aplicativo](application-proxy-publish-azure-portal.md).</span><span class="sxs-lookup"><span data-stu-id="e69ee-148">Publish your application according to the instructions described in [Publish applications with Application Proxy](application-proxy-publish-azure-portal.md).</span></span> <span data-ttu-id="e69ee-149">Certifique-se de selecionar **Azure Active Directory** como o **Método de Pré-autenticação**.</span><span class="sxs-lookup"><span data-stu-id="e69ee-149">Make sure to select **Azure Active Directory** as the **Preauthentication Method**.</span></span>
2. <span data-ttu-id="e69ee-150">Depois que o aplicativo aparecer na lista de aplicativos empresariais, selecione-o e clique em **Logon único**.</span><span class="sxs-lookup"><span data-stu-id="e69ee-150">After your application appears in the list of enterprise applications, select it and click **Single sign-on**.</span></span>
3. <span data-ttu-id="e69ee-151">Defina o modo de logon único como **Autenticação Integrada do Windows**.</span><span class="sxs-lookup"><span data-stu-id="e69ee-151">Set the single sign-on mode to **Integrated Windows Authentication**.</span></span>  
4. <span data-ttu-id="e69ee-152">Insira o **SPN do Aplicativo Interno** do servidor de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="e69ee-152">Enter the **Internal Application SPN** of the application server.</span></span> <span data-ttu-id="e69ee-153">Neste exemplo, o SPN para nosso aplicativo publicado é http/www.contoso.com. Esse SPN precisa estar na lista de serviços aos quais o conector pode apresentar credenciais delegadas.</span><span class="sxs-lookup"><span data-stu-id="e69ee-153">In this example, the SPN for our published application is http/www.contoso.com. This SPN needs to be in the list of services to which the connector can present delegated credentials.</span></span> 
5. <span data-ttu-id="e69ee-154">Escolha a **Identidade de Logon Delegada** para que o conector use em nome de seus usuários.</span><span class="sxs-lookup"><span data-stu-id="e69ee-154">Choose the **Delegated Login Identity** for the connector to use on behalf of your users.</span></span> <span data-ttu-id="e69ee-155">Para obter mais informações, consulte [Trabalhando com identidades diferentes de nuvem e local](#Working-with-different-on-premises-and-cloud-identities)</span><span class="sxs-lookup"><span data-stu-id="e69ee-155">For more information, see [Working with different on-premises and cloud identities](#Working-with-different-on-premises-and-cloud-identities)</span></span>

   ![Configuração de Aplicativo Avançada](./media/active-directory-application-proxy-sso-using-kcd/cwap_auth2.png)  


## <a name="sso-for-non-windows-apps"></a><span data-ttu-id="e69ee-157">SSO para aplicativos não Windows</span><span class="sxs-lookup"><span data-stu-id="e69ee-157">SSO for non-Windows apps</span></span>
<span data-ttu-id="e69ee-158">O fluxo de delegação de Kerberos no Proxy de Aplicativo do AD do Azure é iniciado quando o AD do Azure autentica o usuário na nuvem.</span><span class="sxs-lookup"><span data-stu-id="e69ee-158">The Kerberos delegation flow in Azure AD Application Proxy starts when Azure AD authenticates the user in the cloud.</span></span> <span data-ttu-id="e69ee-159">Depois que a solicitação chega localmente, o conector do Proxy de Aplicativo Azure AD emite um tíquete do Kerberos em nome do usuário interagindo com o Active Directory local.</span><span class="sxs-lookup"><span data-stu-id="e69ee-159">Once the request arrives on-premises, the Azure AD Application Proxy connector issues a Kerberos ticket on behalf of the user by interacting with the local Active Directory.</span></span> <span data-ttu-id="e69ee-160">Esse processo é conhecido como KCD (delegação restrita do Kerberos).</span><span class="sxs-lookup"><span data-stu-id="e69ee-160">This process is referred to as Kerberos Constrained Delegation (KCD).</span></span> <span data-ttu-id="e69ee-161">Na próxima fase, uma solicitação é enviada ao aplicativo de back-end com esse tíquete Kerberos.</span><span class="sxs-lookup"><span data-stu-id="e69ee-161">In the next phase, a request is sent to the backend application with this Kerberos ticket.</span></span> <span data-ttu-id="e69ee-162">Há vários protocolos que definem como enviar essas solicitações.</span><span class="sxs-lookup"><span data-stu-id="e69ee-162">There are several protocols that define how to send such requests.</span></span> <span data-ttu-id="e69ee-163">A maioria dos servidores não Windows espera Negotiate/SPNego, que agora tem suporte no Proxy de Aplicativo do AD do Azure.</span><span class="sxs-lookup"><span data-stu-id="e69ee-163">Most non-Windows servers expect Negotiate/SPNego that is now supported on Azure AD Application Proxy.</span></span>

<span data-ttu-id="e69ee-164">Para obter mais informações sobre o Kerberos, consulte [Tudo o que você deseja saber sobre a delegação restrita de Kerberos (KCD)](https://blogs.technet.microsoft.com/applicationproxyblog/2015/09/21/all-you-want-to-know-about-kerberos-constrained-delegation-kcd).</span><span class="sxs-lookup"><span data-stu-id="e69ee-164">For more information about Kerberos, see [All you want to know about Kerberos Constrained Delegation (KCD)](https://blogs.technet.microsoft.com/applicationproxyblog/2015/09/21/all-you-want-to-know-about-kerberos-constrained-delegation-kcd).</span></span>

<span data-ttu-id="e69ee-165">Os aplicativos que não são do Windows normalmente utilizam nomes de usuário ou nomes de conta SAM em vez de endereços de email de domínio.</span><span class="sxs-lookup"><span data-stu-id="e69ee-165">Non-Windows apps typically user usernames or SAM account names instead of domain email addresses.</span></span> <span data-ttu-id="e69ee-166">Se essa situação se aplicar aos seus aplicativos, você precisará configurar o campo de identificação de logon delegada para conectar as identidades de nuvem às identidades de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e69ee-166">If that situation applies to your applications, you need to configure the delegated login identity field to connect your cloud identities to your application identities.</span></span> 

## <a name="working-with-different-on-premises-and-cloud-identities"></a><span data-ttu-id="e69ee-167">Trabalhando com identidades diferentes de nuvem e local</span><span class="sxs-lookup"><span data-stu-id="e69ee-167">Working with different on-premises and cloud identities</span></span>
<span data-ttu-id="e69ee-168">O Proxy do Aplicativo pressupõe que os usuários têm a mesma identidade na nuvem e localmente.</span><span class="sxs-lookup"><span data-stu-id="e69ee-168">Application Proxy assumes that users have exactly the same identity in the cloud and on-premises.</span></span> <span data-ttu-id="e69ee-169">Se esse não for o caso, você pode ainda poderá usar a KCD para o logon único.</span><span class="sxs-lookup"><span data-stu-id="e69ee-169">If that's not the case, you can can still use KCD for single sign-on.</span></span> <span data-ttu-id="e69ee-170">Configure uma **Identificação de logon delegada** para cada aplicativo a fim de especificar qual identidade deve ser usada ao realizar o logon único.</span><span class="sxs-lookup"><span data-stu-id="e69ee-170">Configure a **Delegated login identity** for each application to specify which identity should be used when performing single sign-on.</span></span>  

<span data-ttu-id="e69ee-171">Essa capacidade permite que muitas organizações com identidades diferentes localmente e na nuvem usem o SSO da nuvem para aplicativos locais, sem exigir que os usuários insiram senhas e nomes de usuários diferentes.</span><span class="sxs-lookup"><span data-stu-id="e69ee-171">This capability allows many organizations that have different on-premises and cloud identities to have SSO from the cloud to on-premises apps without requiring the users to enter different usernames and passwords.</span></span> <span data-ttu-id="e69ee-172">Isso inclui as organizações que:</span><span class="sxs-lookup"><span data-stu-id="e69ee-172">This includes organizations that:</span></span>

* <span data-ttu-id="e69ee-173">Têm vários domínios internamente (joe@us.contoso.com, joe@eu.contoso.com) e um único domínio na nuvem (joe@contoso.com).</span><span class="sxs-lookup"><span data-stu-id="e69ee-173">Have multiple domains internally (joe@us.contoso.com, joe@eu.contoso.com) and a single domain in the cloud (joe@contoso.com).</span></span>
* <span data-ttu-id="e69ee-174">Têm um nome de domínio não roteável internamente (joe@contoso.usa) e um nome legal na nuvem.</span><span class="sxs-lookup"><span data-stu-id="e69ee-174">Have non-routable domain name internally (joe@contoso.usa) and a legal one in the cloud.</span></span>
* <span data-ttu-id="e69ee-175">Não usem nomes de domínio internamente (joe)</span><span class="sxs-lookup"><span data-stu-id="e69ee-175">Do not use domain names internally (joe)</span></span>
* <span data-ttu-id="e69ee-176">Usem aliases diferentes no local e na nuvem.</span><span class="sxs-lookup"><span data-stu-id="e69ee-176">Use different aliases on-prem and in the cloud.</span></span> <span data-ttu-id="e69ee-177">Por exemplo, joe-johns@contoso.com versus joej@contoso.com</span><span class="sxs-lookup"><span data-stu-id="e69ee-177">For example, joe-johns@contoso.com vs. joej@contoso.com</span></span>  

<span data-ttu-id="e69ee-178">Com o Proxy de Aplicativo, você pode selecionar qual identidade deve ser usada para obter o tíquete Kerberos.</span><span class="sxs-lookup"><span data-stu-id="e69ee-178">With Application Proxy, you can select which identity to use to obtain the Kerberos ticket.</span></span> <span data-ttu-id="e69ee-179">Essa configuração é por aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e69ee-179">This setting is per application.</span></span> <span data-ttu-id="e69ee-180">Algumas dessas opções são adequadas para sistemas que não aceitam o formato de endereço de email, e outras são desenvolvidas para logon alternativo.</span><span class="sxs-lookup"><span data-stu-id="e69ee-180">Some of these options are suitable for systems that do not accept email address format, others are designed for alternative login.</span></span>

![Captura de tela de parâmetro de identidade de logon delegada](./media/active-directory-application-proxy-sso-using-kcd/app_proxy_sso_diff_id_upn.png)

<span data-ttu-id="e69ee-182">Se a identidade de logon delegada for usada, o valor não poderá ser exclusivo em todos os domínios ou florestas em sua organização.</span><span class="sxs-lookup"><span data-stu-id="e69ee-182">If delegated login identity is used, the value might not be unique across all the domains or forests in your organization.</span></span> <span data-ttu-id="e69ee-183">Você pode evitar esse problema publicando esses aplicativos duas vezes com dois grupos diferentes de Conectores.</span><span class="sxs-lookup"><span data-stu-id="e69ee-183">You can avoid this issue by publishing these applications twice using two different Connector groups.</span></span> <span data-ttu-id="e69ee-184">Como cada aplicativo tem um público de usuários diferente, é possível ingressar seus Conectores em um domínio diferente.</span><span class="sxs-lookup"><span data-stu-id="e69ee-184">Since each application has a different user audience, you can join its Connectors to a different domain.</span></span>

### <a name="configure-sso-for-different-identities"></a><span data-ttu-id="e69ee-185">Configurar o SSO para diferentes identidades</span><span class="sxs-lookup"><span data-stu-id="e69ee-185">Configure SSO for different identities</span></span>
1. <span data-ttu-id="e69ee-186">Defina as configurações do Azure AD Connect para que a identidade principal seja o endereço de email (email).</span><span class="sxs-lookup"><span data-stu-id="e69ee-186">Configure Azure AD Connect settings so the main identity is the email address (mail).</span></span> <span data-ttu-id="e69ee-187">Isso é feito como parte do processo de personalização, alterando o campo **Nome UPN** nas configurações de sincronização.</span><span class="sxs-lookup"><span data-stu-id="e69ee-187">This is done as part of the customize process, by changing the **User Principal Name** field in the sync settings.</span></span> <span data-ttu-id="e69ee-188">Essas configurações também determinam como os usuários fazem logon no Office365, em dispositivos Windows10 e outros aplicativos que usam o Azure AD como seu armazenamento de identidade.</span><span class="sxs-lookup"><span data-stu-id="e69ee-188">These settings also determine how users log in to Office365, Windows10 devices, and other applications that use Azure AD as their identity store.</span></span>  
   <span data-ttu-id="e69ee-189">![Identificando a captura de tela de usuários - lista suspensa Nome UPN](./media/active-directory-application-proxy-sso-using-kcd/app_proxy_sso_diff_id_connect_settings.png)</span><span class="sxs-lookup"><span data-stu-id="e69ee-189">![Identifying users screenshot - User Principal Name dropdown](./media/active-directory-application-proxy-sso-using-kcd/app_proxy_sso_diff_id_connect_settings.png)</span></span>  
2. <span data-ttu-id="e69ee-190">Nas definições de configuração de aplicativo para o aplicativo que você deseja modificar, selecione a **Identidade de Logon Delegada** a ser usada:</span><span class="sxs-lookup"><span data-stu-id="e69ee-190">In the Application Configuration settings for the application you would like to modify, select the **Delegated Login Identity** to be used:</span></span>

   * <span data-ttu-id="e69ee-191">Nome UPN (por exemplo, joe@contoso.com)</span><span class="sxs-lookup"><span data-stu-id="e69ee-191">User Principal Name (for example, joe@contoso.com)</span></span>
   * <span data-ttu-id="e69ee-192">Nome UPN alternativo (por exemplo, joed@contoso.local)</span><span class="sxs-lookup"><span data-stu-id="e69ee-192">Alternate User Principal Name (for example, joed@contoso.local)</span></span>
   * <span data-ttu-id="e69ee-193">Nome de usuário que faz parte do nome UPN (por exemplo, joe)</span><span class="sxs-lookup"><span data-stu-id="e69ee-193">Username part of User Principal Name (for example, joe)</span></span>
   * <span data-ttu-id="e69ee-194">Nome de usuário que faz parte do nome UPN alternativo (por exemplo, joed)</span><span class="sxs-lookup"><span data-stu-id="e69ee-194">Username part of Alternate User Principal Name (for example, joed)</span></span>
   * <span data-ttu-id="e69ee-195">Nome da conta SAM local (depende da configuração do controlador de domínio)</span><span class="sxs-lookup"><span data-stu-id="e69ee-195">On-premises SAM account name (depends on the domain controller configuration)</span></span>

### <a name="troubleshooting-sso-for-different-identities"></a><span data-ttu-id="e69ee-196">Solucionando problemas de SSO para diferentes identidades</span><span class="sxs-lookup"><span data-stu-id="e69ee-196">Troubleshooting SSO for different identities</span></span>
<span data-ttu-id="e69ee-197">Se houver um erro no processo de SSO, ele aparecerá no log de eventos do computador do conector, conforme explicado na [Solução de problemas](application-proxy-back-end-kerberos-constrained-delegation-how-to.md).</span><span class="sxs-lookup"><span data-stu-id="e69ee-197">If there is an error in the SSO process, it appears in the connector machine event log as explained in [Troubleshooting](application-proxy-back-end-kerberos-constrained-delegation-how-to.md).</span></span>
<span data-ttu-id="e69ee-198">Porém, em alguns casos, a solicitação será enviada com êxito para o aplicativo de back-end embora este aplicativo responderá em várias outras respostas HTTP.</span><span class="sxs-lookup"><span data-stu-id="e69ee-198">But, in some cases, the request is successfully sent to the backend application while this application replies in various other HTTP responses.</span></span> <span data-ttu-id="e69ee-199">Nesses casos, a solução de problemas deve começar examinando o número de evento 24029 no computador do conector, no log de eventos da sessão do Proxy do Aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e69ee-199">Troubleshooting these cases should start by examining event number 24029 on the connector machine in the Application Proxy session event log.</span></span> <span data-ttu-id="e69ee-200">A identidade do usuário que foi usada para delegação será exibida no campo "usuário" nos detalhes do evento.</span><span class="sxs-lookup"><span data-stu-id="e69ee-200">The user identity that was used for delegation appears in the “user” field within the event details.</span></span> <span data-ttu-id="e69ee-201">Para ativar o log de sessão, selecione **Mostrar logs analíticos e de depuração** no menu de exibição do visualizador de eventos.</span><span class="sxs-lookup"><span data-stu-id="e69ee-201">To turn on session log, select **Show analytic and debug logs** in the event viewer view menu.</span></span>

## <a name="next-steps"></a><span data-ttu-id="e69ee-202">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="e69ee-202">Next steps</span></span>

* [<span data-ttu-id="e69ee-203">Como configurar um aplicativo de Proxy de Aplicativo para usar a Delegação restrita de Kerberos</span><span class="sxs-lookup"><span data-stu-id="e69ee-203">How to configure an Application Proxy application to use Kerberos Constrained Delegation</span></span>](application-proxy-back-end-kerberos-constrained-delegation-how-to.md)
* [<span data-ttu-id="e69ee-204">Solucionar problemas que surgirem com o Proxy de Aplicativo</span><span class="sxs-lookup"><span data-stu-id="e69ee-204">Troubleshoot issues you're having with Application Proxy</span></span>](active-directory-application-proxy-troubleshoot.md)


<span data-ttu-id="e69ee-205">Para obter as últimas notícias e atualizações, confira o [blog do Proxy de Aplicativo](http://blogs.technet.com/b/applicationproxyblog/)</span><span class="sxs-lookup"><span data-stu-id="e69ee-205">For the latest news and updates, check out the [Application Proxy blog](http://blogs.technet.com/b/applicationproxyblog/)</span></span>

