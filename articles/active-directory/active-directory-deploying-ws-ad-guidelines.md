---
title: "Diretrizes para implantação do Active Directory do Windows Server em Máquinas Virtuais do Azure | Microsoft Docs"
description: "Se você sabe como implantar serviços de domínio do AD e serviços de federação do AD no local, saiba como eles funcionam em máquinas virtuais do Azure."
services: active-directory
documentationcenter: 
author: femila
manager: femila
editor: 
ms.assetid: 04df4c46-e6b6-4754-960a-57b823d617fa
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 07/26/2017
ms.author: femila
ms.openlocfilehash: 342d9e2787add3d04f1b744152e135db98848179
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/03/2017
---
# <a name="guidelines-for-deploying-windows-server-active-directory-on-azure-virtual-machines"></a><span data-ttu-id="ed6c7-103">Diretrizes para implantar o Active Directory do Windows Server em máquinas virtuais do Azure</span><span class="sxs-lookup"><span data-stu-id="ed6c7-103">Guidelines for deploying Windows Server Active Directory on Azure virtual machines</span></span>
<span data-ttu-id="ed6c7-104">Este artigo explica as diferenças importantes entre implantar o AD DS (Serviços de Domínio do Active Directory) do Windows Server e o AD FS (Serviços de Federação do Active Directory) no local e implantá-los em máquinas virtuais do Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-104">This article explains the important differences between deploying Windows Server Active Directory Domain Services (AD DS) and Active Directory Federation Services (AD FS) on-premises versus deploying them on Microsoft Azure virtual machines.</span></span>

## <a name="scope-and-audience"></a><span data-ttu-id="ed6c7-105">Escopo e público</span><span class="sxs-lookup"><span data-stu-id="ed6c7-105">Scope and audience</span></span>
<span data-ttu-id="ed6c7-106">O artigo destina-se àqueles que já têm experiência com implantação local do Active Directory.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-106">The article is intended for those already experienced with deploying Active Directory on-premises.</span></span> <span data-ttu-id="ed6c7-107">São abordadas as diferenças entre a implantação do Active Directory em máquinas virtuais do Microsoft Azure/redes virtuais do Azure e implantações tradicionais locais do Active Directory.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-107">It covers the differences between deploying Active Directory on Microsoft Azure virtual machines/Azure virtual networks and traditional on-premises Active Directory deployments.</span></span> <span data-ttu-id="ed6c7-108">As máquinas virtuais do Azure e redes virtuais do Azure fazem parte de uma oferta IaaS (Infraestrutura como Serviço) para as organizações aproveitarem os recursos de computação na nuvem.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-108">Azure virtual machines and Azure virtual networks are part of an Infrastructure-as-a-Service (IaaS) offering for organizations to leverage computing resources in the cloud.</span></span>

<span data-ttu-id="ed6c7-109">Para aqueles que não estão familiarizados com a implantação do AD, confira o [Guia de Implantação do AD DS](https://technet.microsoft.com/library/cc753963) ou [Planejar sua implantação do AD FS](https://technet.microsoft.com/library/dn151324.aspx), conforme apropriado.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-109">For those that are not familiar with AD deployment, see the [AD DS Deployment Guide](https://technet.microsoft.com/library/cc753963) or [Plan your AD FS deployment](https://technet.microsoft.com/library/dn151324.aspx) as appropriate.</span></span>

<span data-ttu-id="ed6c7-110">Este artigo pressupõe que o leitor está familiarizado com os seguintes conceitos:</span><span class="sxs-lookup"><span data-stu-id="ed6c7-110">This article assumes that the reader is familiar with the following concepts:</span></span>

* <span data-ttu-id="ed6c7-111">Gerenciamento e implantação do AD DS do Windows Server</span><span class="sxs-lookup"><span data-stu-id="ed6c7-111">Windows Server AD DS deployment and management</span></span>
* <span data-ttu-id="ed6c7-112">Implantação e configuração do DNS para dar suporte a uma infraestrutura do AD DS do Windows Server</span><span class="sxs-lookup"><span data-stu-id="ed6c7-112">Deployment and configuration of DNS to support a Windows Server AD DS infrastructure</span></span>
* <span data-ttu-id="ed6c7-113">Gerenciamento e implantação do AD FS do Windows Server</span><span class="sxs-lookup"><span data-stu-id="ed6c7-113">Windows Server AD FS deployment and management</span></span>
* <span data-ttu-id="ed6c7-114">Implantando, configurando e gerenciando aplicativos confiáveis (sites e serviços Web) que podem consumir tokens do AD FS do Windows Server</span><span class="sxs-lookup"><span data-stu-id="ed6c7-114">Deploying, configuring, and managing relying party applications (websites and web services) that can consume Windows Server AD FS tokens</span></span>
* <span data-ttu-id="ed6c7-115">Conceitos gerais de máquina virtual, por exemplo, como configurar uma máquina virtual, discos virtuais e redes virtuais</span><span class="sxs-lookup"><span data-stu-id="ed6c7-115">General virtual machine concepts, such as how to configure a virtual machine, virtual disks, and virtual networks</span></span>

<span data-ttu-id="ed6c7-116">Este artigo destaca os requisitos para um cenário de implantação híbrida no qual o AD DS ou o AD FS do Windows Server são implantados no local e parcialmente em máquinas virtuais do Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-116">This article highlights the requirements for a hybrid deployment scenario in which Windows Server AD DS or AD FS are partly deployed on-premises and partly deployed on Azure virtual machines.</span></span> <span data-ttu-id="ed6c7-117">O documento aborda primeiro as diferenças críticas entre a execução do AD DS e do AD FS do Windows Server em máquinas virtuais do Azure versus locais e pontos de decisão importantes que afetam o design e a implantação.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-117">The document first covers the critical differences between running Windows Server AD DS and AD FS on Azure virtual machines versus on-premises, and important decision points that affect design and deployment.</span></span> <span data-ttu-id="ed6c7-118">O restante do artigo explica como aplicar as diretrizes para vários cenários de implantação e para cada um dos pontos de decisão mais detalhadamente.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-118">The rest of the paper explains guidelines for each of the decision points in more detail, and how to apply the guidelines to various deployment scenarios.</span></span>

<span data-ttu-id="ed6c7-119">Este artigo não aborda a configuração do [Azure Active Directory](http://azure.microsoft.com/services/active-directory/), que é um serviço baseado em REST que fornece recursos de controle de acesso e gerenciamento de identidade para aplicativos em nuvem.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-119">This article does not discuss the configuration of [Azure Active Directory](http://azure.microsoft.com/services/active-directory/), which is a REST-based service that provides identity management and access control capabilities for cloud applications.</span></span> <span data-ttu-id="ed6c7-120">O Azure Active Directory (Azure AD) e o AD DS do Windows Server, no entanto, são projetados para funcionar juntos a fim de fornecer uma solução de gerenciamento de identidades e acesso para os ambientes híbridos de TI atuais e aplicativos modernos.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-120">Azure Active Directory (Azure AD) and Windows Server AD DS are, however, designed to work together to provide an identity and access management solution for today’s hybrid IT environments and modern applications.</span></span> <span data-ttu-id="ed6c7-121">Para ajudar a compreender as diferenças e as relações entre o AD DS do Windows Server e o Azure AD, considere o seguinte:</span><span class="sxs-lookup"><span data-stu-id="ed6c7-121">To help understand the differences and relationships between Windows Server AD DS and Azure AD, consider the following:</span></span>

1. <span data-ttu-id="ed6c7-122">Você pode executar o AD DS do Windows Server na nuvem em máquinas virtuais do Azure quando está usando o Azure a fim de estender seu datacenter local para a nuvem.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-122">You might run Windows Server AD DS in the cloud on Azure virtual machines when you are using Azure to extend your on-premises datacenter into the cloud.</span></span>
2. <span data-ttu-id="ed6c7-123">Você pode usar o Azure AD para fornecer aos usuários um logon único de aplicativos de Software hospedado como serviço (SaaS).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-123">You might use Azure AD to give your users single sign-on to Software-as-a-Service (SaaS) applications.</span></span> <span data-ttu-id="ed6c7-124">Por exemplo, o Microsoft Office 365 utiliza essa tecnologia, e aplicativos executados no Azure ou outras plataformas na nuvem também podem usá-lo.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-124">Microsoft Office 365 uses this technology, for example, and applications running on Azure or other cloud platforms can also use it.</span></span>
3. <span data-ttu-id="ed6c7-125">Você pode usar o AD do Azure (o Serviço de Controle de Acesso) para permitir que os usuários entrem usando identidades do Facebook, do Google, da Microsoft e de outros provedores de identidade para aplicativos hospedados na nuvem ou no local.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-125">You might use Azure AD (its Access Control Service) to let users sign in using identities from Facebook, Google, Microsoft, and other identity providers to applications that are hosted in the cloud or on-premises.</span></span>

<span data-ttu-id="ed6c7-126">Para saber mais sobre essas diferenças, confira [Identidade do Azure](fundamentals-identity.md).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-126">For more information about these differences, see [Azure Identity](fundamentals-identity.md).</span></span>

## <a name="related-resources"></a><span data-ttu-id="ed6c7-127">Recursos relacionados</span><span class="sxs-lookup"><span data-stu-id="ed6c7-127">Related resources</span></span>
<span data-ttu-id="ed6c7-128">Você pode baixar e executar a [Avaliação de Prontidão da Máquina Virtual do Azure](https://www.microsoft.com/download/details.aspx?id=40898).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-128">You may download and run the [Azure Virtual Machine Readiness Assessment](https://www.microsoft.com/download/details.aspx?id=40898).</span></span> <span data-ttu-id="ed6c7-129">A avaliação inspecionará o ambiente local e gerará um relatório personalizado automaticamente com base nas diretrizes encontradas neste tópico para ajudá-lo a migrar o ambiente para o Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-129">The assessment will automatically inspect your on-premises environment and generate a customized report based on the guidance found in this topic to help you migrate the environment to Azure.</span></span>

<span data-ttu-id="ed6c7-130">Recomendamos que você examine primeiro os tutoriais, guias e vídeos que abrangem os tópicos abaixo:</span><span class="sxs-lookup"><span data-stu-id="ed6c7-130">We recommend that you also first review the tutorials, guides, and videos that cover the following topics:</span></span>

* [<span data-ttu-id="ed6c7-131">Configurar uma rede virtual somente em nuvem no Portal do Azure</span><span class="sxs-lookup"><span data-stu-id="ed6c7-131">Configure a Cloud-Only Virtual Network in the Azure Portal</span></span>](../virtual-network/virtual-networks-create-vnet-arm-pportal.md)
* [<span data-ttu-id="ed6c7-132">Configurar uma VPN Site a Site no Portal do Azure</span><span class="sxs-lookup"><span data-stu-id="ed6c7-132">Configure a Site-to-Site VPN in the Azure Portal</span></span>](../vpn-gateway/vpn-gateway-site-to-site-create.md)
* [<span data-ttu-id="ed6c7-133">Instalar uma nova floresta do Active Directory em uma rede virtual do Azure</span><span class="sxs-lookup"><span data-stu-id="ed6c7-133">Install a new Active Directory forest on an Azure virtual network</span></span>](active-directory-new-forest-virtual-machine.md)
* [<span data-ttu-id="ed6c7-134">Instalar uma réplica do controlador de domínio do Active Directory no Azure</span><span class="sxs-lookup"><span data-stu-id="ed6c7-134">Install a replica Active Directory domain controller on Azure</span></span>](active-directory-install-replica-active-directory-domain-controller.md)
* [<span data-ttu-id="ed6c7-135">Microsoft Azure IaaS para profissionais de TI: (01) conceitos básicos de máquina virtual</span><span class="sxs-lookup"><span data-stu-id="ed6c7-135">Microsoft Azure IT Pro IaaS: (01) Virtual Machine Fundamentals</span></span>](https://channel9.msdn.com/Series/Windows-Azure-IT-Pro-IaaS/01)
* [<span data-ttu-id="ed6c7-136">Microsoft Azure IaaS para profissionais de TI: (05) Criando redes virtuais e conectividade entre instalações</span><span class="sxs-lookup"><span data-stu-id="ed6c7-136">Microsoft Azure IT Pro IaaS: (05) Creating Virtual Networks and Cross-Premises Connectivity</span></span>](https://channel9.msdn.com/Series/Windows-Azure-IT-Pro-IaaS/05)

## <a name="introduction"></a><span data-ttu-id="ed6c7-137">Introdução</span><span class="sxs-lookup"><span data-stu-id="ed6c7-137">Introduction</span></span>
<span data-ttu-id="ed6c7-138">Os requisitos fundamentais para a implantação do Active Directory do Windows Server em máquinas virtuais do Azure diferem muito pouco de implantá-lo em máquinas virtuais locais (e, até certo ponto, máquinas físicas).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-138">The fundamental requirements for deploying Windows Server Active Directory on Azure virtual machines differ very little from deploying it in on-premises virtual machines (and, to some extent, physical machines).</span></span> <span data-ttu-id="ed6c7-139">Por exemplo, no caso do AD DS do Windows Server, se os controladores de domínio que você implantar em máquinas virtuais do Azure forem réplicas em um domínio corporativo/floresta local, a implantação do Azure poderá ser tratada em grande parte da mesma maneira que qualquer outro site adicional do Active Directory do Windows Server.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-139">For example, in the case of Windows Server AD DS, if the domain controllers (DCs) that you deploy on Azure virtual machines are replicas in an existing on-premises corporate domain/forest, then the Azure deployment can largely be treated in the same way as you might treat any other additional Windows Server Active Directory site.</span></span> <span data-ttu-id="ed6c7-140">Isto é, as sub-redes devem ser definidas no AD DS do Windows Server, um site deve ser criado, as sub-redes devem ser vinculadas a esse site e conectadas a outros sites usando links de site apropriados.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-140">That is, subnets must be defined in Windows Server AD DS, a site created, the subnets linked to that site, and connected to other sites using appropriate site-links.</span></span> <span data-ttu-id="ed6c7-141">No entanto, existem algumas diferenças que são comuns a todas as implantações do Azure e algumas que variam de acordo com o cenário de implantação específico.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-141">There are, however, some differences that are common to all Azure deployments and some that vary according to the specific deployment scenario.</span></span> <span data-ttu-id="ed6c7-142">Duas diferenças fundamentais são demonstradas abaixo:</span><span class="sxs-lookup"><span data-stu-id="ed6c7-142">Two fundamental differences are outlined below:</span></span>

### <a name="azure-virtual-machines-may-need-connectivity-to-the-on-premises-corporate-network"></a><span data-ttu-id="ed6c7-143">As máquinas virtuais do Azure podem precisar de conectividade com a rede corporativa local.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-143">Azure virtual machines may need connectivity to the on-premises corporate network.</span></span>
<span data-ttu-id="ed6c7-144">A conexão de máquinas virtuais do Azure a uma rede corporativa local requer a rede virtual do Azure, que inclui um componente VPN (rede virtual privada) site a site ou ponto a site capaz de conectar perfeitamente às máquinas virtuais do Azure e às máquinas locais.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-144">Connecting Azure virtual machines back to an on-premises corporate network requires Azure virtual network, which includes a site-to-site or site-to-point virtual private network (VPN) component able to seamlessly connect Azure virtual machines and on-premises machines.</span></span> <span data-ttu-id="ed6c7-145">Esse componente VPN também pode permitir que computadores de membro de domínio local acessem um domínio do Active Directory do Windows Server cujos controladores de domínio estejam hospedados exclusivamente em máquinas virtuais do Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-145">This VPN component could also enable on-premises domain member computers to access a Windows Server Active Directory domain whose domain controllers are hosted exclusively on Azure virtual machines.</span></span> <span data-ttu-id="ed6c7-146">É importante observar, porém, que se a VPN falhar, a autenticação e outras operações que dependem do Active Directory do Windows Server também falharão.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-146">It is important to note, though, that if the VPN fails, authentication and other operations that depend on Windows Server Active Directory will also fail.</span></span> <span data-ttu-id="ed6c7-147">Embora os usuários possam conseguir entrar usando credenciais existentes armazenadas em cache, todas as tentativas de autenticação ponto a ponto ou cliente-servidor, para as quais tíquetes ainda precisam ser emitidos ou se tornaram obsoletos, falharão.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-147">While users may be able to sign in using existing cached credentials, all peer-to-peer or client-to-server authentication attempts for which tickets have yet to be issued or have become stale will fail.</span></span>

<span data-ttu-id="ed6c7-148">Confira [Rede Virtual](http://azure.microsoft.com/documentation/services/virtual-network/) para ver uma demonstração em vídeo e uma lista de tutoriais passo a passo, incluindo [Configurar uma VPN Site a Site no portal do Azure](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-148">See [Virtual Network](http://azure.microsoft.com/documentation/services/virtual-network/) for a demonstration video and a list of step-by-step tutorials, including [Configure a Site-to-Site VPN in the Azure portal](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span></span>

> [!NOTE]
> <span data-ttu-id="ed6c7-149">Você também pode implantar o Active Directory do Windows Server em uma rede virtual do Azure que não tenha conectividade com uma rede local.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-149">You can also deploy Windows Server Active Directory on an Azure virtual network that does not have connectivity with an on-premises network.</span></span> <span data-ttu-id="ed6c7-150">As diretrizes neste tópico, no entanto, supõem que uma rede virtual do Azure esteja sendo usada pois ela fornece recursos de endereçamento IP que são essenciais para o Windows Server.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-150">The guidelines in this topic, however, assume that an Azure virtual network is used because it provides IP addressing capabilities that are essential to Windows Server.</span></span>
> 
> 

### <a name="static-ip-addresses-must-be-configured-with-azure-powershell"></a><span data-ttu-id="ed6c7-151">Os endereços IP estáticos devem ser configurados com o Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-151">Static IP addresses must be configured with Azure PowerShell.</span></span>
<span data-ttu-id="ed6c7-152">Os endereços dinâmicos são alocados por padrão, mas usam o cmdlet Set-AzureStaticVNetIP para atribuir um endereço IP estático em vez disso.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-152">Dynamic addresses are allocated by default, but use the Set-AzureStaticVNetIP cmdlet to assign a static IP address instead.</span></span> <span data-ttu-id="ed6c7-153">Que define um endereço IP que será mantido por meio da recuperação de serviço e desligamento/reinício da VM.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-153">That sets a static IP address that will persist through service healing and VM shutdown/restart.</span></span> <span data-ttu-id="ed6c7-154">Para saber mais, confira [Endereço IP interno estático para máquinas virtuais](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-154">For more information, see [Static internal IP address for virtual machines](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/).</span></span>

## <span data-ttu-id="ed6c7-155"><a name="BKMK_Glossary"></a>Termos e definições</span><span class="sxs-lookup"><span data-stu-id="ed6c7-155"><a name="BKMK_Glossary"></a>Terms and definitions</span></span>
<span data-ttu-id="ed6c7-156">A seguir temos uma lista parcial dos termos de várias tecnologias do Azure que serão referenciados neste artigo.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-156">The following is a non-exhaustive list of terms for various Azure technologies which will be referenced in this article.</span></span>

* <span data-ttu-id="ed6c7-157">**Máquinas virtuais do azure**: a oferta IaaS no Azure que permite que os clientes implantem VMs que executam praticamente qualquer carga de trabalho tradicionalmente no servidor local.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-157">**Azure virtual machines**: The IaaS offering in Azure that allows customers to deploy VMs running nearly any traditionally on-premises server workload.</span></span>
* <span data-ttu-id="ed6c7-158">**Rede virtual do Azure**: o serviço de rede no Azure que permite que os clientes criem e gerenciem redes virtuais no Azure e as vinculem com segurança às suas próprias infraestruturas de rede locais usando uma VPN (rede virtual privada).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-158">**Azure virtual network**: The networking service in Azure that lets customers create and manage virtual networks in Azure and securely link them to their own on-premises networking infrastructure by using a virtual private network (VPN).</span></span>
* <span data-ttu-id="ed6c7-159">**Endereço IP virtual**: um endereço IP da Internet que não está associado a uma placa de interface de rede ou computador específico.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-159">**Virtual IP address**: An internet-facing IP address that is not bound to a specific computer or network interface card.</span></span> <span data-ttu-id="ed6c7-160">Os serviços de nuvem recebem um endereço IP virtual para receber o tráfego de rede que é redirecionado para uma VM do Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-160">Cloud services are assigned a virtual IP address for receiving network traffic which is redirected to an Azure VM.</span></span> <span data-ttu-id="ed6c7-161">Um endereço IP virtual é uma propriedade de um serviço de nuvem que pode conter uma ou mais máquinas virtuais do Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-161">A virtual IP address is a property of a cloud-service which can contain one or more Azure virtual machines.</span></span> <span data-ttu-id="ed6c7-162">Observe também que uma rede virtual do Azure pode conter um ou mais serviços de nuvem.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-162">Also note that an Azure virtual network can contain one or more cloud-services.</span></span> <span data-ttu-id="ed6c7-163">Os endereços IP virtuais fornecem recursos nativos de balanceamento de carga.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-163">Virtual IP addresses provide native load-balancing capabilities.</span></span>
* <span data-ttu-id="ed6c7-164">**Endereço IP dinâmico**: esse é o endereço IP que é interno apenas.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-164">**Dynamic IP address**: This is the IP address that is internal only.</span></span> <span data-ttu-id="ed6c7-165">Ele deve ser configurado como um endereço IP estático (usando o cmdlet Set-AzureStaticVNetIP) para VMs que hospedam as funções de servidor DNS/DC.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-165">It should be configured as a static IP address (by using the Set-AzureStaticVNetIP cmdlet) for VMs that host the DC/DNS server roles.</span></span>
* <span data-ttu-id="ed6c7-166">**Recuperação de serviço**: o processo no qual o Azure automaticamente retorna novamente um serviço para o estado em execução após detectar sua falha.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-166">**Service healing**: The process in which Azure automatically returns a service to a running state again after it detects that the service has failed.</span></span> <span data-ttu-id="ed6c7-167">A recuperação de serviço é um dos aspectos do Azure que oferece suporte à disponibilidade e resiliência.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-167">Service healing is one of the aspects of Azure that supports availability and resiliency.</span></span> <span data-ttu-id="ed6c7-168">Embora seja improvável, o resultado após um incidente de recuperação para um controlador de domínio em execução em uma máquina virtual de serviço é semelhante a uma reinicialização não planejada, mas tem alguns efeitos colaterais:</span><span class="sxs-lookup"><span data-stu-id="ed6c7-168">While unlikely, the result following a service healing incident for a DC running on a VM is similar to an unplanned reboot, but has a few side-effects:</span></span>
  
  * <span data-ttu-id="ed6c7-169">O adaptador de rede virtual na máquina virtual será alterado</span><span class="sxs-lookup"><span data-stu-id="ed6c7-169">The virtual network adapter in the VM will change</span></span>
  * <span data-ttu-id="ed6c7-170">O endereço MAC do adaptador de rede virtual será alterado</span><span class="sxs-lookup"><span data-stu-id="ed6c7-170">The MAC address of the virtual network adapter will change</span></span>
  * <span data-ttu-id="ed6c7-171">A ID de processador/CPU da VM será alterada</span><span class="sxs-lookup"><span data-stu-id="ed6c7-171">The Processor/CPU ID of the VM will change</span></span>
  * <span data-ttu-id="ed6c7-172">A configuração do IP do adaptador de rede virtual não será alterado desde que a VM esteja conectada a uma rede virtual e o endereço IP da VM seja estático.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-172">The IP configuration of the virtual network adapter will not change as long as the VM is attached to a virtual network and the VM’s IP address is static.</span></span>
  
  <span data-ttu-id="ed6c7-173">Nenhum desses comportamentos afetam o Active Directory do Windows Server porque ele não tem dependências em endereço MAC ou ID de processador/CPU. Além disso, todas as implantações do Active Directory do Windows Server no Azure são recomendadas para execução em uma rede virtual do Azure, conforme descrito acima.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-173">None of these behaviors affect Windows Server Active Directory because it has no dependency on the MAC address or Processor/CPU ID, and all Windows Server Active Directory deployments on Azure are recommended to be run on an Azure virtual network as outlined above.</span></span>

## <a name="is-it-safe-to-virtualize-windows-server-active-directory-domain-controllers"></a><span data-ttu-id="ed6c7-174">É seguro virtualizar os controladores de domínio do Active Directory do Windows Server?</span><span class="sxs-lookup"><span data-stu-id="ed6c7-174">Is it safe to virtualize Windows Server Active Directory domain controllers?</span></span>
<span data-ttu-id="ed6c7-175">A implantação de controladores de domínio do Active Directory do Windows Server em máquinas virtuais do Azure está sujeito às mesmas diretrizes da execução de controladores de domínio locais em uma máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-175">Deploying Windows Server Active Directory DCs on Azure virtual machines is subject to the same guidelines as running DCs on-premises in a virtual machine.</span></span> <span data-ttu-id="ed6c7-176">Executar controladores de domínio virtualizados é uma prática de segurança desde que sejam seguidas as diretrizes para fazer backup e restaurar controladores de domínio.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-176">Running virtualized DCs is a safe practice as long as guidelines for backing up and restoring DCs are followed.</span></span> <span data-ttu-id="ed6c7-177">Para saber mais sobre restrições e diretrizes para a execução de controladores de domínio virtualizados, confira [Executando Controladores de Domínio no Hyper-V](https://technet.microsoft.com/library/dd363553).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-177">For more information about constraints and guidelines for running virtualized DCs, see [Running Domain Controllers in Hyper-V](https://technet.microsoft.com/library/dd363553).</span></span>

<span data-ttu-id="ed6c7-178">Os hipervisores fornecem ou banalizam tecnologias que podem causar problemas para muitos sistemas distribuídos, incluindo o Active Directory do Windows Server.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-178">Hypervisors provide or trivialize technologies that can cause problems for many distributed systems, including Windows Server Active Directory.</span></span> <span data-ttu-id="ed6c7-179">Por exemplo, em um servidor físico, você pode clonar um disco ou usar métodos sem suporte para reverter o estado de um servidor, inclusive usar SANs e outros, mas fazer isso em um servidor físico é muito mais difícil do que restaurar um instantâneo de máquina virtual em um hipervisor.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-179">For example, on a physical server, you can clone a disk or use unsupported methods to roll back the state of a server, including using SANs and so on, but doing that on a physical server is much harder than restoring a virtual machine snapshot in a hypervisor.</span></span> <span data-ttu-id="ed6c7-180">O Azure oferece funcionalidades que podem resultar na mesma condição indesejável.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-180">Azure offers functionality that can result in the same undesirable condition.</span></span> <span data-ttu-id="ed6c7-181">Por exemplo, você não deve copiar arquivos VHD de controladores de domínio em vez de executar backups regulares porque restaurá-los pode resultar em uma situação semelhante ao uso dos recursos de restauração de instantâneo.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-181">For example, you should not copy VHD files of DCs instead of performing regular backups because restoring them can result in a similar situation to using snapshot restore features.</span></span>

<span data-ttu-id="ed6c7-182">Essas reversões apresentam bolhas de USN que podem levar a estados permanentemente divergentes entre controladores de domínio.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-182">Such rollbacks introduce USN bubbles that can lead to permanently divergent states between DCs.</span></span> <span data-ttu-id="ed6c7-183">Isso pode causar problemas como:</span><span class="sxs-lookup"><span data-stu-id="ed6c7-183">That can cause issues such as:</span></span>

* <span data-ttu-id="ed6c7-184">Objetos persistentes</span><span class="sxs-lookup"><span data-stu-id="ed6c7-184">Lingering objects</span></span>
* <span data-ttu-id="ed6c7-185">Senhas inconsistentes</span><span class="sxs-lookup"><span data-stu-id="ed6c7-185">Inconsistent passwords</span></span>
* <span data-ttu-id="ed6c7-186">Valores de atributo inconsistentes</span><span class="sxs-lookup"><span data-stu-id="ed6c7-186">Inconsistent attribute values</span></span>
* <span data-ttu-id="ed6c7-187">O esquema não corresponde se o mestre de esquema é revertido</span><span class="sxs-lookup"><span data-stu-id="ed6c7-187">Schema mismatches if the schema master is rolled back</span></span>

<span data-ttu-id="ed6c7-188">Para saber mais sobre como os controladores de domínio são afetados, confira [USN e Reversão do USN](https://technet.microsoft.com/library/virtual_active_directory_domain_controller_virtualization_hyperv.aspx#usn_and_usn_rollback).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-188">For more information about how DCs are impacted, see [USN and USN Rollback](https://technet.microsoft.com/library/virtual_active_directory_domain_controller_virtualization_hyperv.aspx#usn_and_usn_rollback).</span></span>

<span data-ttu-id="ed6c7-189">A partir do Windows Server 2012, [mais proteções adicionais são incorporadas ao AD DS](https://technet.microsoft.com/library/hh831734.aspx).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-189">Beginning with Windows Server 2012, [additional safeguards are built in to AD DS](https://technet.microsoft.com/library/hh831734.aspx).</span></span> <span data-ttu-id="ed6c7-190">Essas proteções ajudam a proteger os controladores de domínio virtualizados contra os problemas mencionados anteriormente, desde que a plataforma do hipervisor subjacente ofereça suporte a VM-GenerationID.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-190">These safeguards help protect virtualized domain controllers against the aforementioned problems, as long as the underlying hypervisor platform supports VM-GenerationID.</span></span> <span data-ttu-id="ed6c7-191">O Azure dá suporte a VM-GenerationID, o que significa que os controladores de domínio que executam o Windows Server 2012 ou posterior nas máquinas virtuais do Azure têm as proteções adicionais.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-191">Azure supports VM-GenerationID, which means that domain controllers that run Windows Server 2012 or later on Azure virtual machines have the additional safeguards.</span></span>

> [!NOTE]
> <span data-ttu-id="ed6c7-192">Você deve desligar e reiniciar uma VM que executa a função de controlador de domínio no Azure no sistema operacional convidado em vez de usar a opção **Desligar** no Portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-192">You should shut down and restart a VM that runs the domain controller role in Azure within the guest operating system instead of using the **Shut Down** option in the Azure porta.</span></span> <span data-ttu-id="ed6c7-193">Hoje em dia, o uso do portal para desligar uma VM faz com que a VM seja desalocada.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-193">Today, using the portal to shut down a VM causes the VM to be deallocated.</span></span> <span data-ttu-id="ed6c7-194">Uma VM desalocada tem a vantagem de não incorrer em encargos, mas também redefine a VM-GenerationID, o que não é desejável para um controlador de domínio.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-194">A deallocated VM has the advantage of not incurring charges, but it also resets the VM-GenerationID, which is undesirable for a DC.</span></span> <span data-ttu-id="ed6c7-195">Quando a VM-GenerationID é redefinida, a invocationID do banco de dados do AD DS também é redefinida, a pool RID é descartada e SYSVOL é marcado como não autoritativo.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-195">When the VM-GenerationID is reset, the invocationID of the AD DS database is also reset, the RID pool is discarded, and SYSVOL is marked as non-authoritative.</span></span> <span data-ttu-id="ed6c7-196">Para saber mais, confira [Introdução à Virtualização do AD DS (Active Directory Domain Services)](https://technet.microsoft.com/library/hh831734.aspx) e [Virtualização de DFSR com Segurança](http://blogs.technet.com/b/filecab/archive/2013/04/05/safely-virtualizing-dfsr.aspx).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-196">For more information, see [Introduction to Active Directory Domain Services (AD DS) Virtualization](https://technet.microsoft.com/library/hh831734.aspx) and [Safely Virtualizing DFSR](http://blogs.technet.com/b/filecab/archive/2013/04/05/safely-virtualizing-dfsr.aspx).</span></span>
> 
> 

## <a name="why-deploy-windows-server-ad-ds-on-azure-virtual-machines"></a><span data-ttu-id="ed6c7-197">Por que implantar o AD DS do Windows Server em Máquinas Virtuais do Azure?</span><span class="sxs-lookup"><span data-stu-id="ed6c7-197">Why deploy Windows Server AD DS on Azure Virtual Machines?</span></span>
<span data-ttu-id="ed6c7-198">Muitos cenários de implantação do AD DS do Windows Server são apropriados para implantação como máquinas virtuais no Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-198">Many Windows Server AD DS deployment scenarios are well-suited for deployment as VMs on Azure.</span></span> <span data-ttu-id="ed6c7-199">Por exemplo, suponha que você tenha uma empresa na Europa que precisa autenticar usuários em um local remoto na Ásia.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-199">For example, suppose you have a company in Europe that needs to authenticate users in a remote location in Asia.</span></span> <span data-ttu-id="ed6c7-200">A empresa não implantou controladores de domínio do Active Directory do Windows Server anteriormente na Ásia devido a custos para implantá-los e conhecimento limitado para gerenciar a pós-implantação de servidores.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-200">The company has not previously deployed Windows Server Active Directory DCs in Asia due to the cost to deploy them and limited expertise to manage the servers post-deployment.</span></span> <span data-ttu-id="ed6c7-201">Como resultado, as solicitações de autenticação da Ásia são atendidas pelos controladores de domínio na Europa com resultados de qualidade inferiores.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-201">As a result, authentication requests from Asia are serviced by DCs in Europe with suboptimal results.</span></span> <span data-ttu-id="ed6c7-202">Nesse caso, é possível implantar um controlador de domínio em uma máquina virtual que você especificou que deve ser executada no datacenter do Azure na Ásia.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-202">In this case, you can deploy a DC on a VM that you have specified must be run within the Azure datacenter in Asia.</span></span> <span data-ttu-id="ed6c7-203">A anexação do controlador de domínio a uma rede virtual do Azure que está conectada diretamente ao local remoto melhorará o desempenho da autenticação.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-203">Attaching that DC to an Azure virtual network that is connected directly to the remote location will improve authentication performance.</span></span>

<span data-ttu-id="ed6c7-204">O Azure também é adequado como um substituto para sites de DR (recuperação de desastres) dispendiosos.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-204">Azure is also well-suited as a substitute to otherwise costly disaster recovery (DR) sites.</span></span> <span data-ttu-id="ed6c7-205">O custo relativamente baixo de hospedar um pequeno número de controladores de domínio e uma única rede virtual no Azure representa uma alternativa atraente.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-205">The relatively low-cost of hosting a small number of domain controllers and a single virtual network on Azure represents an attractive alternative.</span></span>

<span data-ttu-id="ed6c7-206">Finalmente, talvez seja bom implantar um aplicativo de rede no Azure, como o SharePoint, que requer o Active Directory do Windows Server, mas não tem qualquer dependência na rede local ou no Active Directory corporativo do Windows Server.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-206">Finally, you may want to deploy a network application on Azure, such as SharePoint, that requires Windows Server Active Directory but has no dependency on the on-premises network or the corporate Windows Server Active Directory.</span></span> <span data-ttu-id="ed6c7-207">Nesse caso, implantar uma floresta isolada no Azure para atender aos requisitos do SharePoint Server é ideal.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-207">In this case, deploying an isolated forest on Azure to meet the SharePoint server’s requirements is optimal.</span></span> <span data-ttu-id="ed6c7-208">Repetimos, também há suporte para a implantação de aplicativos de rede que exigem conectividade com a rede local e o Active Directory corporativo.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-208">Again, deploying network applications that do require connectivity to the on-premises network and the corporate Active Directory is also supported.</span></span>

> [!NOTE]
> <span data-ttu-id="ed6c7-209">Como ele fornece uma conexão de camada 3, o componente VPN que fornece conectividade entre uma rede virtual do Azure e uma rede local também pode habilitar os servidores de membro que são executados no local para aproveitar os controladores de domínio executados como máquinas virtuais do Azure na rede virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-209">Since it provides a layer-3 connection, the VPN component that provides connectivity between an Azure virtual network and an on-premises network can also enable member servers that run on-premises to leverage DCs that run as Azure virtual machines on Azure virtual network.</span></span> <span data-ttu-id="ed6c7-210">Mas, se a VPN estiver disponível, a comunicação entre computadores locais e controladores de domínio baseados no Azure não funcionará, resultando em erros de autenticação e vários outros.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-210">But if the VPN is unavailable, communication between on-premises computers and Azure-based domain controllers will not function, resulting in authentication and various other errors.</span></span>  
> 
> 

## <a name="contrasts-between-deploying-windows-server-active-directory-domain-controllers-on-azure-virtual-machines-versus-on-premises"></a><span data-ttu-id="ed6c7-211">Contrastes entre a implantação de controladores de domínio do Active Directory do Windows Server em máquinas virtuais do Azure versus localmente</span><span class="sxs-lookup"><span data-stu-id="ed6c7-211">Contrasts between deploying Windows Server Active Directory domain controllers on Azure Virtual Machines versus on-premises</span></span>
* <span data-ttu-id="ed6c7-212">Para qualquer cenário de implantação do Active Directory do Windows Server que inclua mais de uma única VM, é necessário usar uma rede virtual do Azure para manter a consistência do endereço IP.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-212">For any Windows Server Active Directory deployment scenario that includes more than a single VM, it is necessary to use an Azure virtual network for IP address consistency.</span></span> <span data-ttu-id="ed6c7-213">Observe que este guia pressupõe que os controladores de domínio estejam sendo executados em uma rede virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-213">Note that this guide assumes that DCs are running on an Azure virtual network.</span></span>
* <span data-ttu-id="ed6c7-214">Como ocorre com os controladores de domínio locais, recomenda-se o uso de endereços IP estáticos.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-214">As with on-premises DCs, static IP addresses are recommended.</span></span> <span data-ttu-id="ed6c7-215">Um endereço IP estático só pode ser configurado usando o Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-215">A static IP address can only be configured by using Azure PowerShell.</span></span> <span data-ttu-id="ed6c7-216">Confira [Endereço IP estático interno para VMs](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/) para obter mais detalhes.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-216">See [Static internal IP address for VMs](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/) for more details.</span></span> <span data-ttu-id="ed6c7-217">Se você tiver sistemas de monitoramento ou outras soluções que verificam a configuração de endereço IP estático no sistema operacional convidado, poderá atribuir o mesmo endereço IP estático às propriedades do adaptador de rede da máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-217">If you have monitoring systems or other solutions that check for static IP address configuration within the guest operating system, you can assign the same static IP address to the network adapter properties of the VM.</span></span> <span data-ttu-id="ed6c7-218">No entanto, lembre-se de que o adaptador de rede será descartado se a VM passar por uma recuperação de serviço ou for desligada no portal e seu endereço for desalocado.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-218">But be aware that the network adapter will be discarded if the VM undergoes service healing or is shut down in the portal and has its address deallocated.</span></span> <span data-ttu-id="ed6c7-219">Nesse caso, o endereço IP estático no convidado precisará ser redefinido.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-219">In that case, the static IP address within the guest will need to be reset.</span></span>
* <span data-ttu-id="ed6c7-220">Implantar máquinas virtuais em uma rede virtual não implica (ou exige) conectividade com uma rede local. A rede virtual simplesmente habilita essa possibilidade.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-220">Deploying VMs on a virtual network does not imply (or require) connectivity back to an on-premises network; the virtual network merely enables that possibility.</span></span> <span data-ttu-id="ed6c7-221">Você deve criar uma rede virtual para comunicação privada entre o Azure e sua rede local.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-221">You must create a virtual network for private communication between Azure and your on-premises network.</span></span> <span data-ttu-id="ed6c7-222">Você precisa implantar um ponto de extremidade VPN na rede local.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-222">You need to deploy a VPN endpoint on the on-premises network.</span></span> <span data-ttu-id="ed6c7-223">A VPN é aberta a partir do Azure para a rede local.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-223">The VPN is opened from Azure to the on-premises network.</span></span> <span data-ttu-id="ed6c7-224">Para saber mais sobre como criar essa rede virtual, confira [Visão geral da Rede Virtual](../virtual-network/virtual-networks-overview.md) e [Configurar um VPN Site a Site no portal do Azure](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-224">For more information, see [Virtual Network Overview](../virtual-network/virtual-networks-overview.md) and [Configure a Site-to-Site VPN in the Azure Portal](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span></span>

> [!NOTE]
> <span data-ttu-id="ed6c7-225">Uma opção para [criar uma VPN ponto a site](../vpn-gateway/vpn-gateway-point-to-site-create.md) está disponível para conectar computadores individuais do Windows diretamente a uma rede virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-225">An option to [create a point-to-site VPN](../vpn-gateway/vpn-gateway-point-to-site-create.md) is available to connect individual Windows-based computers directly to an Azure virtual network.</span></span>
> 
> 

* <span data-ttu-id="ed6c7-226">Independentemente de criar uma rede virtual ou não, o Azure cobra pelo tráfego de saída, mas não pelo de entrada.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-226">Regardless of whether you create a virtual network or not, Azure charges for egress traffic but not ingress.</span></span> <span data-ttu-id="ed6c7-227">Várias opções de design do Active Directory do Windows Server podem afetar a quantidade de tráfego de saída gerada por uma implantação.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-227">Various Windows Server Active Directory design choices can affect how much egress traffic is generated by a deployment.</span></span> <span data-ttu-id="ed6c7-228">Por exemplo, a implantação de um RODC (controlador de domínio somente leitura) limita o tráfego de saída porque ele não replica a saída.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-228">For example, deploying a read-only domain controller (RODC) limits egress traffic because it does not replicate outbound.</span></span> <span data-ttu-id="ed6c7-229">Mas a decisão de implantar um RODC precisa ser avaliada em relação à necessidade de executar operações de gravação no controlador de domínio e a [compatibilidade](https://technet.microsoft.com/library/cc755190) dos aplicativos e serviços no site com RODCs.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-229">But the decision to deploy an RODC needs to be weighed against the need to perform write operations against the DC and the [compatibility](https://technet.microsoft.com/library/cc755190) that applications and services in the site have with RODCs.</span></span> <span data-ttu-id="ed6c7-230">Para saber mais sobre encargos de tráfego, confira [Visão geral de preços do Azure](http://azure.microsoft.com/pricing/).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-230">For more information about traffic charges, see [Azure pricing at-a-glance](http://azure.microsoft.com/pricing/).</span></span>
* <span data-ttu-id="ed6c7-231">Embora você tenha controle total sobre qual servidor de recursos usar para VMs locais, por exemplo, RAM, tamanho do disco e afins, no Azure, deverá escolher em uma lista de tamanhos de servidor predefinidos.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-231">While you have complete control over what server resources to use for VMs on-premises, such as RAM, disk size, and so on, on Azure you must select from a list of preconfigured server sizes.</span></span> <span data-ttu-id="ed6c7-232">Para um controlador de domínio, um disco de dados é necessário além do disco do sistema operacional para armazenar o banco de dados do Active Directory do Windows Server.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-232">For a DC, a data disk is needed in addition to the operating system disk in order to store the Windows Server Active Directory database.</span></span>

## <a name="can-you-deploy-windows-server-ad-fs-on-azure-virtual-machines"></a><span data-ttu-id="ed6c7-233">É possível implantar o AD FS do Windows Server em máquinas virtuais do Azure?</span><span class="sxs-lookup"><span data-stu-id="ed6c7-233">Can you deploy Windows Server AD FS on Azure virtual machines?</span></span>
<span data-ttu-id="ed6c7-234">Sim, você pode implantar o AD FS do Windows Server em máquinas virtuais do Azure e as [práticas recomendadas para implantação do AD FS](https://technet.microsoft.com/library/dn151324.aspx) local aplicam-se igualmente à implantação do AD FS no Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-234">Yes, you can deploy Windows Server AD FS on Azure virtual machines, and the [best practices for AD FS deployment](https://technet.microsoft.com/library/dn151324.aspx) on-premises apply equally to AD FS deployment on Azure.</span></span> <span data-ttu-id="ed6c7-235">Mas algumas das práticas recomendadas, como o balanceamento de carga e a alta disponibilidade, exigem tecnologias além das que o AD FS oferece.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-235">But some of the best practices such as load balancing and high availability require technologies beyond what AD FS offers itself.</span></span> <span data-ttu-id="ed6c7-236">Elas devem ser fornecidas pela infraestrutura subjacente.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-236">They must be provided by the underlying infrastructure.</span></span> <span data-ttu-id="ed6c7-237">Vamos examinar algumas dessas práticas recomendadas e ver como elas podem ser alcançadas usando VMs do Azure e uma rede virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-237">Let’s review some of those best practices and see how they can be achieved by using Azure VMs and an Azure virtual network.</span></span>

1. <span data-ttu-id="ed6c7-238">**Nunca exponha servidores STSs (serviço de token de segurança) diretamente na Internet.**</span><span class="sxs-lookup"><span data-stu-id="ed6c7-238">**Never expose security token service (STS) servers directly to the Internet.**</span></span>
   
    <span data-ttu-id="ed6c7-239">Isso é importante porque o STS emite tokens de segurança.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-239">This is important because the STS issues security tokens.</span></span> <span data-ttu-id="ed6c7-240">Como resultado, os servidores de STS, como servidores AD FS, devem ser tratados com o mesmo nível de proteção de um controlador de domínio.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-240">As a result, STS servers such as AD FS servers should be treated with the same level of protection as a domain controller.</span></span> <span data-ttu-id="ed6c7-241">Se um STS estiver comprometido, usuários mal-intencionados conseguirão emitir tokens de acesso que podem conter declarações de sua escolha para aplicativos confiáveis e outros servidores de STS em organizações confiáveis.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-241">If an STS is compromised, malicious users have the ability to issue access tokens potentially containing claims of their choosing to relying party applications and other STS servers in trusting organizations.</span></span>
2. <span data-ttu-id="ed6c7-242">**Implantar controladores de domínio do Active Directory para todos os domínios de usuário na mesma rede que os servidores do AD FS.**</span><span class="sxs-lookup"><span data-stu-id="ed6c7-242">**Deploy Active Directory domain controllers for all user domains in the same network as the AD FS servers.**</span></span>
   
    <span data-ttu-id="ed6c7-243">Os servidores AD FS usam Serviços de Domínio do Active Directory para autenticar usuários.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-243">AD FS servers use Active Directory Domain Services to authenticate users.</span></span> <span data-ttu-id="ed6c7-244">É recomendável implantar controladores de domínio na mesma rede que os servidores AD FS.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-244">It is recommended to deploy domain controllers on the same network as the AD FS servers.</span></span> <span data-ttu-id="ed6c7-245">Isso fornecerá continuidade de negócios no caso do link entre a rede do Azure e sua rede local ser interrompido e permitirá maior desempenho para logons e menor latência.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-245">This provides business continuity in case the link between the Azure network and your on-premises network is broken, and enables lower latency and increased performance for logins.</span></span>
3. <span data-ttu-id="ed6c7-246">**Implante vários nós do AD FS para alta disponibilidade e balanceamento de carga.**</span><span class="sxs-lookup"><span data-stu-id="ed6c7-246">**Deploy multiple AD FS nodes for high availability and balancing the load.**</span></span>
   
    <span data-ttu-id="ed6c7-247">Na maioria dos casos, a falha de um aplicativo que o AD FS permite é inaceitável porque os aplicativos que exigem tokens de segurança geralmente são de missão crítica.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-247">In most cases, the failure of an application that AD FS enables is unacceptable because the applications that require security tokens are often mission critical.</span></span> <span data-ttu-id="ed6c7-248">Como resultado, e como o AD FS agora reside no caminho crítico para acessar aplicativos de missão crítica, o serviço AD FS deve estar altamente disponível por meio de vários proxies do AD FS e servidores do AD FS.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-248">As a result, and because AD FS now resides in the critical path to accessing mission critical applications, the AD FS service must be highly available through multiple AD FS proxies and AD FS servers.</span></span> <span data-ttu-id="ed6c7-249">Para obter a distribuição de solicitações, os balanceadores de carga normalmente são implantados na frente de proxies do AD FS e de servidores do AD FS.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-249">To achieve distribution of requests, load balancers are typically deployed in front of both the AD FS Proxies and the AD FS servers.</span></span>
4. <span data-ttu-id="ed6c7-250">**Implante um ou mais nós de Proxy de Aplicativo Web para acessar a Internet.**</span><span class="sxs-lookup"><span data-stu-id="ed6c7-250">**Deploy one or more Web Application Proxy nodes for internet access.**</span></span>
   
    <span data-ttu-id="ed6c7-251">Quando os usuários precisam acessar aplicativos protegidos pelo serviço do AD FS, este precisa estar disponível na Internet.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-251">When users need to access applications protected by the AD FS service, the AD FS service needs to be available from the internet.</span></span> <span data-ttu-id="ed6c7-252">Isso é feito ao implantar o serviço de Proxy de Aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-252">This is achieved by deploying the Web Application Proxy service.</span></span> <span data-ttu-id="ed6c7-253">É altamente recomendável implantar mais de um nó para fins de alta disponibilidade e balanceamento de carga.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-253">It is strongly recommended to deploy more than one node for the purposes of high availability and load balancing.</span></span>
5. <span data-ttu-id="ed6c7-254">**Restringir o acesso aos recursos da rede internos a partir de nós de Proxy de Aplicativo Web.**</span><span class="sxs-lookup"><span data-stu-id="ed6c7-254">**Restrict access from the Web Application Proxy nodes to internal network resources.**</span></span>
   
    <span data-ttu-id="ed6c7-255">Para permitir que usuários externos acessem o AD FS a partir da Internet, você precisará implantar nós de Proxy de Aplicativo Web (ou Proxy do AD FS em versões anteriores do Windows Server).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-255">To allow external users to access AD FS from the internet, you need to deploy Web Application Proxy nodes (or AD FS Proxy in earlier versions of Windows Server).</span></span> <span data-ttu-id="ed6c7-256">Os nós de proxy de Aplicativo Web são diretamente expostos à Internet.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-256">The Web Application proxy nodes are directly exposed to the Internet.</span></span> <span data-ttu-id="ed6c7-257">Eles não têm que estar ingressados no domínio e só precisam acessar os servidores do AD FS em portas TCP 443 e 80.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-257">They are not required to be domain-joined and they only need access to the AD FS servers over TCP ports 443 and 80.</span></span> <span data-ttu-id="ed6c7-258">É altamente recomendável que a comunicação com todos os outros computadores (especialmente controladores de domínio) esteja bloqueada.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-258">It is strongly recommended that communication to all other computers (especially domain controllers) is blocked.</span></span>
   
    <span data-ttu-id="ed6c7-259">Isso é normalmente obtido no local por meio de uma DMZ.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-259">This is typically achieved on-premises by means of a DMZ.</span></span> <span data-ttu-id="ed6c7-260">Os firewalls usam um modo de lista branca de operação para restringir o DMZ à rede local (ou seja, somente o tráfego de endereços IP especificados e portas específicas é permitido e todos os outros tráfegos são bloqueados).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-260">Firewalls use a whitelist mode of operation to restrict traffic from the DMZ to the on-premises network (that is, only traffic from the specified IP addresses and over specified ports is allowed, and all other traffic is blocked).</span></span>

<span data-ttu-id="ed6c7-261">O diagrama a seguir mostra uma implantação tradicional do AD FS no local.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-261">The following diagram shows a traditional on-premises AD FS deployment.</span></span>

![Diagrama de uma implantação tradicional dos Serviços de Federação do Active Directory local](media/active-directory-deploying-ws-ad-guidelines/ADFS_onprem.png)

<span data-ttu-id="ed6c7-263">No entanto, como o Azure não fornece recurso de firewall completo nativo, outras opções devem ser usadas para restringir o tráfego.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-263">However, because Azure does not provide native, full-featured firewall capability, other options need to be used to restrict traffic.</span></span> <span data-ttu-id="ed6c7-264">A tabela a seguir mostra cada opção e suas vantagens e desvantagens.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-264">The following table shows each option and its advantages and disadvantages.</span></span>

| <span data-ttu-id="ed6c7-265">Opção</span><span class="sxs-lookup"><span data-stu-id="ed6c7-265">Option</span></span> | <span data-ttu-id="ed6c7-266">Vantagem</span><span class="sxs-lookup"><span data-stu-id="ed6c7-266">Advantage</span></span> | <span data-ttu-id="ed6c7-267">Desvantagem</span><span class="sxs-lookup"><span data-stu-id="ed6c7-267">Disadvantage</span></span> |
| --- | --- | --- |
| [<span data-ttu-id="ed6c7-268">ACLs da rede do Azure</span><span class="sxs-lookup"><span data-stu-id="ed6c7-268">Azure network ACLs</span></span>](../virtual-network/virtual-networks-acl.md) |<span data-ttu-id="ed6c7-269">Configuração inicial mais simples e com menor custo</span><span class="sxs-lookup"><span data-stu-id="ed6c7-269">Less costly and simpler initial configuration</span></span> |<span data-ttu-id="ed6c7-270">Configuração adicional de ACL de rede necessária se novas VMs são adicionadas à implantação</span><span class="sxs-lookup"><span data-stu-id="ed6c7-270">Additional network ACL configuration required if any new VMs are added to the deployment</span></span> |
| [<span data-ttu-id="ed6c7-271">Barracuda NG Firewall</span><span class="sxs-lookup"><span data-stu-id="ed6c7-271">Barracuda NG firewall</span></span>](https://www.barracuda.com/products/ngfirewall) |<span data-ttu-id="ed6c7-272">Modo de lista branca de operação e não requer configurações de ACL de rede</span><span class="sxs-lookup"><span data-stu-id="ed6c7-272">Whitelist mode of operation and it requires no network ACL configuration</span></span> |<span data-ttu-id="ed6c7-273">Aumento de custo e complexidade da configuração inicial</span><span class="sxs-lookup"><span data-stu-id="ed6c7-273">Increased cost and complexity for initial setup</span></span> |

<span data-ttu-id="ed6c7-274">As etapas de alto nível para implantar o AD FS neste caso são as seguintes:</span><span class="sxs-lookup"><span data-stu-id="ed6c7-274">The high-level steps to deploy AD FS in this case are as follows:</span></span>

1. <span data-ttu-id="ed6c7-275">Crie uma rede virtual com conectividade entre locais usando uma VPN ou a [ExpressRoute](http://azure.microsoft.com/services/expressroute/).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-275">Create a virtual network with cross-premises connectivity, using either a VPN or [ExpressRoute](http://azure.microsoft.com/services/expressroute/).</span></span>
2. <span data-ttu-id="ed6c7-276">Implante controladores de domínio em uma rede virtual.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-276">Deploy domain controllers on the virtual network.</span></span> <span data-ttu-id="ed6c7-277">Esta etapa é opcional, mas recomendada.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-277">This step is optional but recommended.</span></span>
3. <span data-ttu-id="ed6c7-278">Implante servidores do AD FS ingressados no domínio na rede virtual.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-278">Deploy domain-joined AD FS servers on the virtual network.</span></span>
4. <span data-ttu-id="ed6c7-279">Crie um [conjunto de balanceamento de carga interno](http://azure.microsoft.com/blog/internal-load-balancing/) que inclua os servidores do AD FS e utilize um novo endereço IP privado na rede virtual (um endereço IP dinâmico).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-279">Create an [internal load balanced set](http://azure.microsoft.com/blog/internal-load-balancing/) that includes the AD FS servers and uses a new private IP address within the virtual network (a dynamic IP address).</span></span>
   
   1. <span data-ttu-id="ed6c7-280">Atualize o DNS a fim de criar o FQDN para apontar para o endereço IP privado (dinâmico) do conjunto de balanceamento de carga interno.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-280">Update DNS to create the FQDN to point to the private (dynamic) IP address of the internal load balanced set.</span></span>
5. <span data-ttu-id="ed6c7-281">Crie um serviço de nuvem (ou uma rede virtual separada) para os nós de Proxy de Aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-281">Create a cloud service (or a separate virtual network) for the Web Application Proxy nodes.</span></span>
6. <span data-ttu-id="ed6c7-282">Implantar os nós de Proxy de Aplicativo Web no serviço de nuvem ou na rede virtual</span><span class="sxs-lookup"><span data-stu-id="ed6c7-282">Deploy the Web Application Proxy nodes in the cloud service or virtual network</span></span>
   
   1. <span data-ttu-id="ed6c7-283">Crie um conjunto de balanceamento de carga externo que inclua os nós de Proxy de Aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-283">Create an external load balanced set that includes the Web Application Proxy nodes.</span></span>
   2. <span data-ttu-id="ed6c7-284">Atualize o nome DNS externo (FQDN) para apontar para o endereço IP público do serviço de nuvem (endereço IP virtual).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-284">Update the external DNS name (FQDN) to point to the cloud service public IP address (the virtual IP address).</span></span>
   3. <span data-ttu-id="ed6c7-285">Configure os proxies do AD FS para usar o FQDN que corresponde ao conjunto de balanceamento de carga interno para os servidores do AD FS.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-285">Configure AD FS proxies to use the FQDN that corresponds to the internal load balanced set for the AD FS servers.</span></span>
   4. <span data-ttu-id="ed6c7-286">Atualize sites baseados em declarações para usar o FQDN externo para seu provedor de declarações.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-286">Update claims-based web sites to use the external FQDN for their claims provider.</span></span>
7. <span data-ttu-id="ed6c7-287">Restrinja o acesso entre o Proxy de Aplicativo da Web para qualquer computador na rede virtual do AD FS.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-287">Restrict access between Web Application Proxy to any machine in the AD FS virtual network.</span></span>

<span data-ttu-id="ed6c7-288">Para restringir o tráfego, o conjunto de balanceamento de carga do balanceador de carga interno do Azure precisa ser configurado somente em relação ao tráfego para as portas TCP 80 e 443 e todos os outros tráfegos para o endereço IP dinâmico interno do conjunto de balanceamento de carga são descartados.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-288">To restrict traffic, the load-balanced set for the Azure internal load balancer needs to be configured for only traffic to TCP ports 80 and 443, and all other traffic to the internal dynamic IP address of the load balanced set is dropped.</span></span>

![Diagrama de ACLs de Rede ADFS com TCP 443 + 80 permitido.](media/active-directory-deploying-ws-ad-guidelines/ADFS_ACLs.png)

<span data-ttu-id="ed6c7-290">O tráfego para os servidores do AD FS seria permitido apenas para as seguintes origens:</span><span class="sxs-lookup"><span data-stu-id="ed6c7-290">Traffic to the AD FS servers would be permitted only by the following sources:</span></span>

* <span data-ttu-id="ed6c7-291">O balanceador de carga interno do Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-291">The Azure internal load balancer.</span></span>
* <span data-ttu-id="ed6c7-292">O endereço IP de um administrador da rede local.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-292">The IP address of an administrator on the on-premises network.</span></span>

> [!WARNING]
> <span data-ttu-id="ed6c7-293">O design deve impedir que nós de Proxy de Aplicativo Web acessem todas as outras VMs na rede virtual do Azure ou todos os locais na rede local.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-293">The design must prevent Web Application Proxy nodes from reaching any other VMs in the Azure virtual network or any locations on the on-premises network.</span></span> <span data-ttu-id="ed6c7-294">Isso pode ser feito configurando regras de firewall no dispositivo local para conexões do ExpressRoute ou no dispositivo VPN para conexões VPN site a site.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-294">That can be done by configuring firewall rules in the on-premises appliance for Express Route connections or the VPN device for site-to-site VPN connections.</span></span>
> 
> 

<span data-ttu-id="ed6c7-295">Uma desvantagem dessa opção é a necessidade de configurar ACLs de rede para vários dispositivos, incluindo o balanceador de carga interno, os servidores do AD FS e outros servidores que são adicionados à rede virtual.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-295">A disadvantage to this option is the need to configure the network ACLs for multiple devices, including internal load balancer, the AD FS servers, and any other servers that get added to the virtual network.</span></span> <span data-ttu-id="ed6c7-296">Se qualquer dispositivo for adicionado à implantação sem configurar ACLs de rede para restringir o tráfego para ele, toda a implantação poderá ficar em risco.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-296">If any device is added to the deployment without configuring network ACLs to restrict traffic to it, the entire deployment can be at risk.</span></span> <span data-ttu-id="ed6c7-297">Se os endereços IP de nós de Proxy de Aplicativo Web nunca forem alterados, as ACLs de rede deverão ser redefinidas (o que significa que os proxies devem ser configurados para usar [endereços IP dinâmicos estáticos](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/)).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-297">If the IP addresses of the Web Application Proxy nodes ever change, the network ACLs must be reset (which means the proxies should be configured to use [static dynamic IP addresses](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/)).</span></span>

![ADFS no Azure com ACLS de rede.](media/active-directory-deploying-ws-ad-guidelines/ADFS_Azure.png)

<span data-ttu-id="ed6c7-299">Outra opção é usar o dispositivo [Barracuda NG Firewall](https://www.barracuda.com/products/ngfirewall) para controlar o tráfego entre servidores de proxy do AD FS e servidores do AD FS.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-299">Another option is to use the [Barracuda NG Firewall](https://www.barracuda.com/products/ngfirewall) appliance to control traffic between AD FS proxy servers and the AD FS servers.</span></span> <span data-ttu-id="ed6c7-300">Esta opção está em conformidade com as práticas recomendadas para segurança e alta disponibilidade e requer menos administração após a configuração inicial porque o dispositivo Barracuda NG Firewall oferece um modo de lista branca de administração do firewall e pode ser instalado diretamente em uma rede virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-300">This option complies with best practices for security and high availability, and requires less administration after the initial setup because the Barracuda NG Firewall appliance provides a whitelist mode of firewall administration and it can be installed directly on an Azure virtual network.</span></span> <span data-ttu-id="ed6c7-301">Isso elimina a necessidade de configurar ACLs de rede sempre que um novo servidor for adicionado à implantação.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-301">That eliminates the need to configure network ACLs any time a new server is added to the deployment.</span></span> <span data-ttu-id="ed6c7-302">Mas essa opção adiciona custo e complexidade à implantação inicial.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-302">But this option adds initial deployment complexity and cost.</span></span>

<span data-ttu-id="ed6c7-303">Nesse caso, duas redes virtuais são implantadas em vez de uma.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-303">In this case, two virtual networks are deployed instead of one.</span></span> <span data-ttu-id="ed6c7-304">Vamos chamá-las de VNet1 e VNet2.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-304">We'll call them VNet1 and VNet2.</span></span> <span data-ttu-id="ed6c7-305">VNet1 contém os proxies e VNet2 contém os STSs e a conexão de rede para a rede corporativa.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-305">VNet1 contains the proxies and VNet2 contains the STSs and the network connection back to the corporate network.</span></span> <span data-ttu-id="ed6c7-306">VNet1 é, portanto, fisicamente (embora virtualmente) isolada da VNet2 e, por sua vez, da rede corporativa.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-306">VNet1 is therefore physically (albeit virtually) isolated from VNet2 and, in turn, from the corporate network.</span></span> <span data-ttu-id="ed6c7-307">VNet1 é conectada a VNet2 usando uma tecnologia de túnel especial conhecida como TINA (Transport Independent Network Architecture).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-307">VNet1 is then connected to VNet2 using a special tunneling technology known as Transport Independent Network Architecture (TINA).</span></span> <span data-ttu-id="ed6c7-308">O túnel TINA é anexado a cada uma das redes virtuais usando um firewall Barracuda NG: um Barracuda em cada uma das redes virtuais.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-308">The TINA tunnel is attached to each of the virtual networks using a Barracuda NG firewall—one Barracuda on each of the virtual networks.</span></span>  <span data-ttu-id="ed6c7-309">Para alta disponibilidade, é recomendável que você implante dois Barracudas em cada rede virtual, sendo um ativo e outro passivo.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-309">For high-availability, it is recommended that you deploy two Barracudas on each virtual network; one active, the other passive.</span></span> <span data-ttu-id="ed6c7-310">Eles oferecem recursos de firewall extremamente avançados que nos permitem simular a operação de um DMZ local tradicional no Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-310">They offer extremely rich firewalling capabilities which allow us to mimic the operation of a traditional on-premises DMZ in Azure.</span></span>

![ADFS no Azure com firewall.](media/active-directory-deploying-ws-ad-guidelines/ADFS_Azure_firewall.png)

<span data-ttu-id="ed6c7-312">Para saber mais, confira [AD FS: estender um aplicativo front-end local com reconhecimento de declarações para a Internet](#BKMK_CloudOnlyFed).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-312">For more information, see [AD FS: Extend a claims-aware on-premises front-end application to the Internet](#BKMK_CloudOnlyFed).</span></span>

### <a name="an-alternative-to-ad-fs-deployment-if-the-goal-is-office-365-sso-alone"></a><span data-ttu-id="ed6c7-313">Uma alternativa para a implantação do AD FS se a meta for apenas o SSO do Office 365</span><span class="sxs-lookup"><span data-stu-id="ed6c7-313">An alternative to AD FS deployment if the goal is Office 365 SSO alone</span></span>
<span data-ttu-id="ed6c7-314">Há outra alternativa para implantar totalmente o AD FS se sua meta é apenas habilitar a entrada no Office 365.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-314">There is another alternative to deploying AD FS altogether if your goal is only to enable sign-in for Office 365.</span></span> <span data-ttu-id="ed6c7-315">Nesse caso, basta implantar o DirSync com sincronização de senha no local e obter o mesmo resultado final com o mínimo de complexidade de implantação porque essa abordagem não exige o AD FS ou o Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-315">In that case, you can simply deploy DirSync with password sync on-premises and achieve the same end-result with minimal deployment complexity because this approach does not require AD FS or Azure.</span></span>

<span data-ttu-id="ed6c7-316">A tabela a seguir compara como os processos de logon funcionam com e sem implantar o AD FS.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-316">The following table compares how the sign-in processes work with and without deploying AD FS.</span></span>

| <span data-ttu-id="ed6c7-317">Logon único do Office 365 usando o AD FS e DirSync</span><span class="sxs-lookup"><span data-stu-id="ed6c7-317">Office 365 single sign-on using AD FS and DirSync</span></span> | <span data-ttu-id="ed6c7-318">Mesmo logon do Office 365 usando DirSync + Sincronização de Senha</span><span class="sxs-lookup"><span data-stu-id="ed6c7-318">Office 365 same sign-on using DirSync + Password Sync</span></span> |
| --- | --- |
| <span data-ttu-id="ed6c7-319">1. O usuário faz logon em uma rede corporativa e é autenticado no Active Directory do Windows Server.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-319">1. The user logs on to a corporate network, and is authenticated to Windows Server Active Directory.</span></span> |<span data-ttu-id="ed6c7-320">1. O usuário faz logon em uma rede corporativa e é autenticado no Active Directory do Windows Server.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-320">1. The user logs on to a corporate network, and is authenticated to Windows Server Active Directory.</span></span> |
| <span data-ttu-id="ed6c7-321">2. O usuário tenta acessar o Office 365 (eu sou @contoso.com).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-321">2. The user tries to access Office 365 (I am @contoso.com).</span></span> |<span data-ttu-id="ed6c7-322">2. O usuário tenta acessar o Office 365 (eu sou @contoso.com).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-322">2. The user tries to access Office 365 (I am @contoso.com).</span></span> |
| <span data-ttu-id="ed6c7-323">3. O Office 365 redireciona o usuário para o Azure AD.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-323">3. Office 365 redirects the user to Azure AD.</span></span> |<span data-ttu-id="ed6c7-324">3. O Office 365 redireciona o usuário para o Azure AD.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-324">3. Office 365 redirects the user to Azure AD.</span></span> |
| <span data-ttu-id="ed6c7-325">4. Como o Azure AD não pode autenticar o usuário e entende que há uma relação de confiança com o AD FS local, ele redireciona o usuário para o AD FS.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-325">4. Since Azure AD can’t authenticate the user and understands there is a trust with AD FS on-premises, it redirects the user to AD FS.</span></span> |<span data-ttu-id="ed6c7-326">4. O Azure AD não pode aceitar tíquetes Kerberos diretamente e não existe qualquer relação de confiança para solicitar que o usuário insira credenciais.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-326">4. Azure AD can’t accept Kerberos tickets directly and no trust relationship exists so it requests that the user enter credentials.</span></span> |
| <span data-ttu-id="ed6c7-327">5. O usuário envia um tíquete Kerberos ao STS do AD FS.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-327">5. The user sends a Kerberos ticket to the AD FS STS.</span></span> |<span data-ttu-id="ed6c7-328">5. O usuário insere a mesma senha local e o Azure AD a valida com o nome de usuário e senha que foram sincronizados pelo DirSync.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-328">5. The user enters the same on-premises password, and Azure AD validates them against the user name and password that was synchronized by DirSync.</span></span> |
| <span data-ttu-id="ed6c7-329">6. O AD FS transforma o tíquete Kerberos para os formato/declaração de token necessário e redireciona o usuário para o Azure AD.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-329">6. AD FS transforms the Kerberos ticket to the required token format/claims and redirects the user to Azure AD.</span></span> |<span data-ttu-id="ed6c7-330">6. O Azure AD redireciona o usuário para o Office 365.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-330">6. Azure AD redirects the user to Office 365.</span></span> |
| <span data-ttu-id="ed6c7-331">7. O usuário autentica no AD do Azure (outra transformação ocorre).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-331">7. The user authenticates to Azure AD (another transformation occurs).</span></span> |<span data-ttu-id="ed6c7-332">7. O usuário pode entrar no Office 365 e no OWA usando o token do Azure AD.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-332">7. The user can sign in to Office 365 and OWA using the Azure AD token.</span></span> |
| <span data-ttu-id="ed6c7-333">8. O Azure AD redireciona o usuário para o Office 365.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-333">8. Azure AD redirects the user to Office 365.</span></span> | |
| <span data-ttu-id="ed6c7-334">9. O usuário é conectado silenciosamente ao Office 365.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-334">9. The user is silently signed on to Office 365.</span></span> | |

<span data-ttu-id="ed6c7-335">No Office 365 DirSync com cenário de sincronização de senha (sem AD FS), o logon único é substituído pelo "mesmo logon", em que “mesmo” significa que os usuários devem digitar novamente as mesmas credenciais locais ao acessar o Office 365.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-335">In the Office 365 with DirSync with password sync scenario (no AD FS), single sign-on is replaced by “same sign-on” where “same” simply means that users must re-enter their same on-premises credentials when accessing Office 365.</span></span> <span data-ttu-id="ed6c7-336">Observe que esses dados podem ser lembrados pelo navegador do usuário para ajudar a reduzir avisos subsequentes.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-336">Note that this data can be remembered by the user’s browser to help reduce subsequent prompts.</span></span>

### <a name="additional-food-for-thought"></a><span data-ttu-id="ed6c7-337">Ideias adicionais</span><span class="sxs-lookup"><span data-stu-id="ed6c7-337">Additional food for thought</span></span>
* <span data-ttu-id="ed6c7-338">Se você implantar um proxy do AD FS em uma máquina virtual do Azure, é necessário ter conectividade com os servidores do AD FS.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-338">If you deploy an AD FS proxy on an Azure virtual machine, connectivity to the AD FS servers is needed.</span></span> <span data-ttu-id="ed6c7-339">Se estiverem no local, é recomendável aproveitar a conectividade VPN site a site fornecida pela rede virtual para permitir que os nós de Proxy de Aplicativo Web se comuniquem com seus servidores do AD FS.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-339">If they are on-premises, it is recommended that you leverage the site-to-site VPN connectivity provided by the virtual network to allow the Web Application Proxy nodes to communicate with their AD FS servers.</span></span>
* <span data-ttu-id="ed6c7-340">Se você implantar um servidor do AD FS em uma máquina virtual do Azure, é necessário ter conectividade com os controladores de domínio do Active Directory do Windows Server, Repositórios de Atributos e bancos de dados de Configuração. Isso também pode exigir um ExpressRoute ou uma conexão VPN site a site entre a rede local e a rede virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-340">If you deploy an AD FS server on an Azure virtual machine, connectivity to Windows Server Active Directory domain controllers, Attribute Stores, and Configuration databases is necessary and may also require an ExpressRoute or a site-to-site VPN connection between the Azure virtual network and the on-premises network.</span></span>
* <span data-ttu-id="ed6c7-341">Os encargos são aplicados a todo o tráfego proveniente de máquinas virtuais do Azure (tráfego de saída).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-341">Charges are applied to all traffic from Azure virtual machines (egress traffic).</span></span> <span data-ttu-id="ed6c7-342">Se o custo é o fator determinante, é aconselhável implantar os nós de Proxy de Aplicativo Web no Azure, deixando os servidores AD FS locais.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-342">If cost is the driving factor, it is advisable to deploy the Web Application Proxy nodes on Azure, leaving the AD FS servers on-premises.</span></span> <span data-ttu-id="ed6c7-343">Se os servidores do AD FS também forem implantados em máquinas virtuais do Azure, custos adicionais serão incorridos para autenticar os usuários locais.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-343">If the AD FS servers are deployed on Azure virtual machines as well, additional costs will be incurred to authenticate on-premises users.</span></span> <span data-ttu-id="ed6c7-344">O tráfego de saída incorre em custo, independentemente de estar ou não atravessando o ExpressRoute ou a conexão VPN site a site.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-344">Egress traffic incurs a cost regardless of whether or not it is traversing the ExpressRoute or the VPN site-to-site connection.</span></span>
* <span data-ttu-id="ed6c7-345">Se você decidir usar os recursos nativos de balanceamento de carga para a alta disponibilidade dos servidores do AD FS do Azure, observe que o balanceamento de carga fornece investigações que são usadas para determinar a integridade das máquinas virtuais no serviço de nuvem.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-345">If you decide to use Azure’s native server load balancing capabilities for high availability of AD FS servers, note that load balancing provides probes that are used to determine the health of the virtual machines within the cloud service.</span></span> <span data-ttu-id="ed6c7-346">No caso das máquinas virtuais do Azure (em vez de funções de trabalho ou Web), uma investigação personalizada deve ser usada uma vez que o agente que responde às investigações padrão não está presente nas máquinas virtuais do Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-346">In the case of Azure virtual machines (as opposed to web or worker roles), a custom probe must be used since the agent that responds to the default probes is not present on Azure virtual machines.</span></span> <span data-ttu-id="ed6c7-347">Para simplificar, você pode usar uma investigação TCP personalizada. Isso requer apenas que uma conexão TCP (um segmento TCP SYN enviado e respondido com um segmento TCP SYN ACK) seja estabelecida com êxito para determinar a integridade da máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-347">For simplicity, you might use a custom TCP probe — this requires only that a TCP connection (a TCP SYN segment sent and responded to with a TCP SYN ACK segment) be successfully established to determine virtual machine health.</span></span> <span data-ttu-id="ed6c7-348">Você pode configurar a investigação personalizada para usar qualquer porta TCP na qual as máquinas virtuais estão ouvindo ativamente.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-348">You can configure the custom probe to use any TCP port to which your virtual machines are actively listening.</span></span>

> [!NOTE]
> <span data-ttu-id="ed6c7-349">Computadores que precisarem expor o mesmo conjunto de portas diretamente para a Internet (como a porta 80 e 443) não poderão compartilhar o mesmo serviço de nuvem.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-349">Machines that need to expose the same set of ports directly to the Internet (such as port 80 and 443) cannot share the same cloud service.</span></span> <span data-ttu-id="ed6c7-350">Portanto, recomenda-se criar um serviço de nuvem dedicado para seus servidores do AD FS do Windows Server a fim de evitar possíveis sobreposições entre requisitos de porta para um aplicativo e o AD FS do Windows Server.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-350">It is, therefore, recommended that you create a dedicated cloud service for your Windows Server AD FS servers in order to avoid potential overlaps between port requirements for an application and Windows Server AD FS.</span></span>
> 
> 

## <a name="deployment-scenarios"></a><span data-ttu-id="ed6c7-351">Cenários de implantação</span><span class="sxs-lookup"><span data-stu-id="ed6c7-351">Deployment scenarios</span></span>
<span data-ttu-id="ed6c7-352">A seção a seguir descreve os cenários comuns de implantação para chamar a atenção a considerações importantes que devem ser levadas em conta.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-352">The following section outlines commonplace deployment scenarios to draw attention to important considerations that must be taken into account.</span></span> <span data-ttu-id="ed6c7-353">Cada cenário tem links para obter mais detalhes sobre decisões e fatores a considerar.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-353">Each scenario has links to more details about the decisions and factors to consider.</span></span>

1. [<span data-ttu-id="ed6c7-354">AD DS: implantar um aplicativo com reconhecimento de AD DS sem a necessidade de conectividade à rede corporativa</span><span class="sxs-lookup"><span data-stu-id="ed6c7-354">AD DS: Deploy an AD DS-aware application with no requirement for corporate network connectivity</span></span>](#BKMK_CloudOnly)
   
    <span data-ttu-id="ed6c7-355">Por exemplo, um serviço do SharePoint da Internet é implantado em uma máquina virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-355">For example, an Internet-facing SharePoint service is deployed on an Azure virtual machine.</span></span> <span data-ttu-id="ed6c7-356">O aplicativo não tem dependências nos recursos da rede corporativa.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-356">The application has no dependencies on corporate-network resources.</span></span> <span data-ttu-id="ed6c7-357">O aplicativo requer o AD DS do Windows Server, mas não requer o AD DS do Windows Server corporativo.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-357">The application does require Windows Server AD DS but does NOT require the corporate Windows Server AD DS.</span></span>
2. [<span data-ttu-id="ed6c7-358">AD FS: estender um aplicativo front-end de reconhecimento de local para a Internet</span><span class="sxs-lookup"><span data-stu-id="ed6c7-358">AD FS: Extend a claims-aware on-premises front-end application to the Internet</span></span>](#BKMK_CloudOnlyFed)
   
    <span data-ttu-id="ed6c7-359">Por exemplo, um aplicativo com reconhecimento de declarações que foi implantado com êxito localmente e usado por usuários corporativos precisa poder ser acessado pela Internet.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-359">For example, a claims-aware application that has been successfully deployed on-premises and used by corporate users needs to become accessible from the Internet.</span></span> <span data-ttu-id="ed6c7-360">O aplicativo precisa ser acessado diretamente pela Internet por parceiros de negócios usando suas próprias identidades corporativas e por usuários corporativos existentes.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-360">The application needs to be accessed directly over the Internet both by business partners using their own corporate identities and by existing corporate users.</span></span>
3. [<span data-ttu-id="ed6c7-361">AD DS: implantar um aplicativo com reconhecimento do AD DS do Windows Server que exige conectividade com a rede corporativa</span><span class="sxs-lookup"><span data-stu-id="ed6c7-361">AD DS: Deploy a Windows Server AD DS-aware application that requires connectivity to the corporate network</span></span>](#BKMK_HybridExt)
   
    <span data-ttu-id="ed6c7-362">Por exemplo, um aplicativo com reconhecimento de LDAP que dá suporte à autenticação integrada do Windows e usa o AD DS do Windows Server como um repositório de dados de configuração e perfil do usuário é implantado em uma máquina virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-362">For example, an LDAP-aware application that supports Windows-integrated authentication and uses Windows Server AD DS as a repository for configuration and user-profile data is deployed on an Azure virtual machine.</span></span> <span data-ttu-id="ed6c7-363">É desejável que o aplicativo aproveite o AD DS do Windows Server corporativo existente e forneça logon único.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-363">It is desirable for the application to leverage the existing corporate Windows Server AD DS and provide single sign-on.</span></span> <span data-ttu-id="ed6c7-364">O aplicativo não reconhece declarações.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-364">The application is not claims-aware.</span></span>

### <span data-ttu-id="ed6c7-365"><a name="BKMK_CloudOnly"></a>1. AD DS: implantar um aplicativo com reconhecimento de AD DS sem precisar conectar-se à rede corporativa</span><span class="sxs-lookup"><span data-stu-id="ed6c7-365"><a name="BKMK_CloudOnly"></a>1. AD DS: Deploy an AD DS-aware application with no requirement for corporate network connectivity</span></span>
<span data-ttu-id="ed6c7-366">![Implantação do AD DS somente na nuvem](media/active-directory-deploying-ws-ad-guidelines/ADDS_cloud.png)
**Figura 1**</span><span class="sxs-lookup"><span data-stu-id="ed6c7-366">![Cloud-only AD DS deployment](media/active-directory-deploying-ws-ad-guidelines/ADDS_cloud.png)
**Figure 1**</span></span>

#### <a name="description"></a><span data-ttu-id="ed6c7-367">Descrição</span><span class="sxs-lookup"><span data-stu-id="ed6c7-367">Description</span></span>
<span data-ttu-id="ed6c7-368">O SharePoint é implantado em uma máquina virtual do Azure e o aplicativo não tem dependências nos recursos da rede corporativa.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-368">SharePoint is deployed on an Azure virtual machine and the application has no dependencies on corporate-network resources.</span></span> <span data-ttu-id="ed6c7-369">O aplicativo requer o AD DS do Windows Server, mas *não* requer o AD DS do Windows Server corporativo.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-369">The application does require Windows Server AD DS but does *not* require the corporate Windows Server AD DS.</span></span> <span data-ttu-id="ed6c7-370">Nenhuma confiança federada ou Kerberos é necessária porque os usuários são autoprovisionados pelo aplicativo no domínio do AD DS do Windows Server que também está hospedado na nuvem em máquinas virtuais do Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-370">No Kerberos or federated trusts are required because users are self-provisioned through the application into the Windows Server AD DS domain that is also hosted in the cloud on Azure virtual machines.</span></span>

#### <a name="scenario-considerations-and-how-technology-areas-apply-to-the-scenario"></a><span data-ttu-id="ed6c7-371">Considerações sobre cenário e como as áreas de tecnologia se aplicam ao cenário</span><span class="sxs-lookup"><span data-stu-id="ed6c7-371">Scenario considerations and how technology areas apply to the scenario</span></span>
* <span data-ttu-id="ed6c7-372">[Topologia de rede](#BKMK_NetworkTopology): criar uma rede virtual do Azure sem conectividade entre locais (também conhecida como conectividade site a site).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-372">[Network topology](#BKMK_NetworkTopology): Create an Azure virtual network without cross-premises connectivity (also known as site-to-site connectivity).</span></span>
* <span data-ttu-id="ed6c7-373">[Configuração de implantação do controlador de domínio](#BKMK_DeploymentConfig): implantar um novo controlador de domínio em uma nova floresta do Active Directory do Windows Server de domínio único.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-373">[DC deployment configuration](#BKMK_DeploymentConfig): Deploy a new domain controller into a new, single-domain, Windows Server Active Directory forest.</span></span> <span data-ttu-id="ed6c7-374">Isso deve ser implantado junto com o servidor DNS do Windows.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-374">This should be deployed along with the Windows DNS server.</span></span>
* <span data-ttu-id="ed6c7-375">[Topologia de site do Active Directory do Windows Server](#BKMK_ADSiteTopology): usar o site do Active Directory do Windows Server padrão (todos os computadores estarão em Default-First-Site-Name).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-375">[Windows Server Active Directory site topology](#BKMK_ADSiteTopology): Use the default Windows Server Active Directory site (all computers will be in Default-First-Site-Name).</span></span>
* <span data-ttu-id="ed6c7-376">[Endereçamento IP e DNS](#BKMK_IPAddressDNS):</span><span class="sxs-lookup"><span data-stu-id="ed6c7-376">[IP addressing and DNS](#BKMK_IPAddressDNS):</span></span>
  
  * <span data-ttu-id="ed6c7-377">Configurar um endereço IP estático para o controlador de domínio usando o cmdlet Set-AzureStaticVNetIP do Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-377">Set a static IP address for the DC by using the Set-AzureStaticVNetIP Azure PowerShell cmdlet.</span></span>
  * <span data-ttu-id="ed6c7-378">Instalar e configurar o DNS do Windows Server nos controladores de domínio do Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-378">Install and configure Windows Server DNS on the domain controller(s) on Azure.</span></span>
  * <span data-ttu-id="ed6c7-379">Configurar as propriedades de rede virtual com o nome e o endereço IP da máquina virtual que hospeda as funções de servidor DNS e controlador de domínio.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-379">Configure the virtual network properties with the name and IP address of the VM that hosts the DC and DNS server roles.</span></span>
* <span data-ttu-id="ed6c7-380">[Catálogo global](#BKMK_GC): o primeiro controlador de domínio da floresta deve ser um servidor de catálogo global.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-380">[Global Catalog](#BKMK_GC): The first DC in the forest must be a global catalog server.</span></span> <span data-ttu-id="ed6c7-381">Controladores de domínio adicionais também devem ser configurados como CGs porque em uma floresta de domínio único, o catálogo global não exige qualquer trabalho adicional do controlador de domínio.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-381">Additional DCs should also be configured as GCs because in a single domain forest, the global catalog does not require any additional work from the DC.</span></span>
* <span data-ttu-id="ed6c7-382">[Colocação do banco de dados do AD DS do Windows Server e SYSVOL](#BKMK_PlaceDB): adicionar um disco de dados a controladores de domínio em execução como VMs do Azure para armazenar o banco de dados, logs e SYSVOL do Active Directory do Windows Server.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-382">[Placement of the Windows Server AD DS database and SYSVOL](#BKMK_PlaceDB): Add a data disk to DCs running as Azure VMs in order to store the Windows Server Active Directory database, logs, and SYSVOL.</span></span>
* <span data-ttu-id="ed6c7-383">[Backup e restauração](#BKMK_BUR): determine onde você deseja armazenar os backups de estado do sistema.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-383">[Backup and Restore](#BKMK_BUR): Determine where you want to store system state backups.</span></span> <span data-ttu-id="ed6c7-384">Se necessário, adicione outro disco de dados à VM do controlador de domínio para armazenar backups.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-384">If necessary, add another data disk to the DC VM to store backups.</span></span>

### <span data-ttu-id="ed6c7-385"><a name="BKMK_CloudOnlyFed"></a>2 AD FS: estender um aplicativo front-end de reconhecimento de local para a Internet</span><span class="sxs-lookup"><span data-stu-id="ed6c7-385"><a name="BKMK_CloudOnlyFed"></a>2 AD FS: Extend a claims-aware on-premises front-end application to the Internet</span></span>
<span data-ttu-id="ed6c7-386">![Federação com conectividade entre locais](media/active-directory-deploying-ws-ad-guidelines/Federation_xprem.png)
**Figura 2**</span><span class="sxs-lookup"><span data-stu-id="ed6c7-386">![Federation with cross-premises connectivity](media/active-directory-deploying-ws-ad-guidelines/Federation_xprem.png)
**Figure 2**</span></span>

#### <a name="description"></a><span data-ttu-id="ed6c7-387">Descrição</span><span class="sxs-lookup"><span data-stu-id="ed6c7-387">Description</span></span>
<span data-ttu-id="ed6c7-388">Um aplicativo com reconhecimento de declarações implantado com êxito localmente e usado por usuários corporativos precisa poder ser acessado diretamente pela Internet.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-388">A claims-aware application that has been successfully deployed on-premises and used by corporate users needs to become accessible directly from the Internet.</span></span> <span data-ttu-id="ed6c7-389">O aplicativo serve como um front-end da Web para um banco de dados SQL em que ele armazena dados.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-389">The application serves as a web frontend to a SQL database in which it stores data.</span></span> <span data-ttu-id="ed6c7-390">Os servidores SQL usados pelo aplicativo também estão localizados na rede corporativa.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-390">The SQL servers used by the application are also located on the corporate network.</span></span> <span data-ttu-id="ed6c7-391">Dois STSs do AD FS do Windows Server e um balanceador de carga foram implantados localmente para fornecer acesso a usuários corporativos.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-391">Two Windows Server AD FS STSs and a load-balancer have been deployed on-premises to provide access to the corporate users.</span></span> <span data-ttu-id="ed6c7-392">Agora, o aplicativo precisa ser acessado diretamente pela Internet por parceiros de negócios usando suas próprias identidades corporativas e por usuários corporativos existentes.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-392">The application now needs to be additionally accessed directly over the Internet both by business partners using their own corporate identities and by existing corporate users.</span></span>

<span data-ttu-id="ed6c7-393">Na tentativa de simplificar e atender às necessidades de implantação e configuração dessa nova exigência, decidiu-se que dois front-ends adicionais da Web e dois servidores proxy do AD FS do Windows Server serão instalados em máquinas virtuais do Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-393">In an effort to simplify and meet the deployment and configuration needs of this new requirement, it is decided that two additional web frontends and two Windows Server AD FS proxy servers be installed on Azure virtual machines.</span></span> <span data-ttu-id="ed6c7-394">Todas as quatro máquinas virtuais serão expostas diretamente à Internet e terão conectividade à rede local usando o recurso de VPN site a site da rede virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-394">All four VMs will be exposed directly to the Internet and will be provided connectivity to the on-premises network using Azure Virtual Network’s site-to-site VPN capability.</span></span>

#### <a name="scenario-considerations-and-how-technology-areas-apply-to-the-scenario"></a><span data-ttu-id="ed6c7-395">Considerações sobre cenário e como as áreas de tecnologia se aplicam ao cenário</span><span class="sxs-lookup"><span data-stu-id="ed6c7-395">Scenario considerations and how technology areas apply to the scenario</span></span>
* <span data-ttu-id="ed6c7-396">[Topologia de rede](#BKMK_NetworkTopology): criar uma rede virtual do Azure e [configurar a conectividade entre locais](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-396">[Network topology](#BKMK_NetworkTopology): Create an Azure virtual network and [configure cross-premises connectivity](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span></span>
  
  > [!NOTE]
  > <span data-ttu-id="ed6c7-397">Para cada um dos certificados AD FS do Windows Server, verifique se a URL definida dentro do modelo de certificado e os certificados resultantes podem ser alcançados pelas instâncias do AD FS do Windows Server em execução no Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-397">For each of the Windows Server AD FS certificates, ensure that the URL defined within the certificate template and the resulting certificates can be reached by the Windows Server AD FS instances running on Azure.</span></span> <span data-ttu-id="ed6c7-398">Isso pode exigir conectividade entre locais para partes da sua infraestrutura de PKI.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-398">This may require cross-premises connectivity to parts of your PKI infrastructure.</span></span> <span data-ttu-id="ed6c7-399">Por exemplo, se o ponto de extremidade da CRL é baseado em LDAP e hospedado exclusivamente no local, a conectividade entre locais será necessária.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-399">For example if the CRL's endpoint is LDAP-based and hosted exclusively on-premises, then cross-premises connectivity will be required.</span></span> <span data-ttu-id="ed6c7-400">Se isso não for desejável, poderá ser necessário usar certificados emitidos por uma AC cujo CRL seja acessível pela Internet.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-400">If this is not desirable, it may be necessary to use certificates issued by a CA whose CRL is accessible over the Internet.</span></span>
  > 
  > 
* <span data-ttu-id="ed6c7-401">[Configuração de serviços de nuvem](#BKMK_CloudSvcConfig): verifique se você tem dois serviços de nuvem a fim de fornecer dois endereços IP virtuais com carga balanceada.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-401">[Cloud services configuration](#BKMK_CloudSvcConfig): Ensure you have two cloud services in order provide two load-balanced virtual IP addresses.</span></span> <span data-ttu-id="ed6c7-402">O endereço IP do primeiro serviço de nuvem será direcionado para as duas VMs de proxy do AD FS do Windows Server nas portas 80 e 443.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-402">The first cloud service’s virtual IP address will be directed to the two Windows Server AD FS proxy VMs on ports 80 and 443.</span></span> <span data-ttu-id="ed6c7-403">As VMs de proxy do AD FS do Windows Server serão configuradas para apontar para o endereço IP do balanceador de carga local que está à frente dos STSs do AD FS do Windows Server.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-403">The Windows Server AD FS proxy VMs will be configured to point to the IP address of the on-premises load-balancer that fronts the Windows Server AD FS STSs.</span></span> <span data-ttu-id="ed6c7-404">O endereço IP virtual do segundo serviço de nuvem será direcionado às duas VMs executando o front-end da Web novamente nas portas 80 e 443.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-404">The second cloud service’s virtual IP address will be directed to the two VMs running the web frontend again on ports 80 and 443.</span></span> <span data-ttu-id="ed6c7-405">Configure uma investigação personalizada para garantir que o balanceador de carga direcione somente o tráfego para as VMs de front-end Web e proxy do AD FS do Windows Server.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-405">Configure a custom probe to ensure the load-balancer only directs traffic to functioning Windows Server AD FS proxy and web frontend VMs.</span></span>
* <span data-ttu-id="ed6c7-406">[Configuração do servidor de federação](#BKMK_FedSrvConfig): configurar o AD FS do Windows Server como um STS (servidor de federação) para gerar tokens de segurança para a floresta do Active Directory do Windows Server criada na nuvem.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-406">[Federation server configuration](#BKMK_FedSrvConfig): Configure Windows Server AD FS as a federation server (STS) to generate security tokens for the Windows Server Active Directory forest created in the cloud.</span></span> <span data-ttu-id="ed6c7-407">Defina relações de confiança de provedor de declarações com os diferentes parceiros dos quais você deseja aceitar identidades e configure relações de confiança com terceira parte confiável nos diferentes aplicativos para os quais deseja gerar tokens.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-407">Set federation claims provider trust relationships with the different partners you wish to accept identities from, and configure relying party trust relationships with the different applications you want to generate tokens to.</span></span>
  
    <span data-ttu-id="ed6c7-408">Na maioria dos cenários, os servidores proxy do AD FS do Windows Server são implantados em um recurso de acesso à Internet para fins de segurança, ao passo que suas correspondentes de federação do AD FS do Windows Server permanecem isoladas da conectividade direta com a Internet.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-408">In most scenarios, Windows Server AD FS proxy servers are deployed in an Internet-facing capacity for security purposes while their Windows Server AD FS federation counterparts remain isolated from direct Internet connectivity.</span></span> <span data-ttu-id="ed6c7-409">Independentemente de seu cenário de implantação, você deve configurar seu serviço de nuvem com um endereço IP virtual que fornecerá um endereço IP e uma porta capazes de balancear a carga entre as duas instâncias STS do AD FS do Windows Server ou as instâncias de proxy.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-409">Regardless of your deployment scenario, you must configure your cloud service with a virtual IP address that will provide a publicly exposed IP address and port that is able to load-balance across either your two Windows Server AD FS STS instances or proxy instances.</span></span>
* <span data-ttu-id="ed6c7-410">[Configuração de alta disponibilidade do AD FS do Windows Server](#BKMK_ADFSHighAvail): é recomendável implantar um farm do AD FS do Windows Server com pelo menos dois servidores para failover e balanceamento de carga.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-410">[Windows Server AD FS high availability configuration](#BKMK_ADFSHighAvail): It is advisable to deploy a Windows Server AD FS farm with at least two servers for failover and load balancing.</span></span> <span data-ttu-id="ed6c7-411">É interessante considerar usar o WID (banco de dados interno do Windows) para dados de configuração do AD FS do Windows Server e usar o recurso de balanceamento de carga interno do Azure para distribuir solicitações de entrada entre os servidores no farm.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-411">You might want to consider using the Windows Internal Database (WID) for Windows Server AD FS configuration data, and use the internal load balancing capability of Azure to distribute incoming requests across the servers in the farm.</span></span>

<span data-ttu-id="ed6c7-412">Para saber mais, confira o [Guia de implantação do AD DS](https://technet.microsoft.com/library/cc753963).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-412">For more information, see the [AD DS Deployment Guide](https://technet.microsoft.com/library/cc753963).</span></span>

### <span data-ttu-id="ed6c7-413"><a name="BKMK_HybridExt"></a>3. AD DS: implantar um aplicativo com reconhecimento do AD DS do Windows Server que exige conectividade com a rede corporativa</span><span class="sxs-lookup"><span data-stu-id="ed6c7-413"><a name="BKMK_HybridExt"></a>3. AD DS: Deploy a Windows Server AD DS-aware application that requires connectivity to the corporate network</span></span>
<span data-ttu-id="ed6c7-414">![Implantação do AD DS entre instalações](media/active-directory-deploying-ws-ad-guidelines/ADDS_xprem.png)
**Figura 3**</span><span class="sxs-lookup"><span data-stu-id="ed6c7-414">![Cross-premises AD DS deployment](media/active-directory-deploying-ws-ad-guidelines/ADDS_xprem.png)
**Figure 3**</span></span>

#### <a name="description"></a><span data-ttu-id="ed6c7-415">Descrição</span><span class="sxs-lookup"><span data-stu-id="ed6c7-415">Description</span></span>
<span data-ttu-id="ed6c7-416">Um aplicativo com reconhecimento de LDAP é implantado em uma máquina virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-416">An LDAP-aware application is deployed on an Azure virtual machine.</span></span> <span data-ttu-id="ed6c7-417">Ele é compatível com a autenticação integrada do Windows e usa o AD DS do Windows Server como um repositório para dados de perfil de usuário e de configuração.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-417">It supports Windows-integrated authentication and uses Windows Server AD DS as a repository for configuration and user profile data.</span></span> <span data-ttu-id="ed6c7-418">O objetivo é que o aplicativo aproveite o AD DS existente do Windows Server corporativo e forneça logon único.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-418">The goal is for the application to leverage the existing corporate Windows Server AD DS and provide single sign-on.</span></span> <span data-ttu-id="ed6c7-419">O aplicativo não reconhece declarações.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-419">The application is not claims-aware.</span></span> <span data-ttu-id="ed6c7-420">Os usuários também precisam acessar o aplicativo diretamente da Internet.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-420">Users also need to access the application directly from the Internet.</span></span> <span data-ttu-id="ed6c7-421">Para otimizar o desempenho e o custo, ficou decidido que dois controladores de domínio adicionais que fazem parte do domínio corporativo seriam implantados juntamente com o aplicativo no Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-421">To optimize for performance and cost, it is decided that two additional domain controllers that are part of the corporate domain be deployed alongside the application on Azure.</span></span>

#### <a name="scenario-considerations-and-how-technology-areas-apply-to-the-scenario"></a><span data-ttu-id="ed6c7-422">Considerações sobre cenário e como as áreas de tecnologia se aplicam ao cenário</span><span class="sxs-lookup"><span data-stu-id="ed6c7-422">Scenario considerations and how technology areas apply to the scenario</span></span>
* <span data-ttu-id="ed6c7-423">[Topologia de rede](#BKMK_NetworkTopology): criar uma rede virtual do Azure com [conectividade entre locais](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-423">[Network topology](#BKMK_NetworkTopology): Create an Azure virtual network with [cross-premises connectivity](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span></span>
* <span data-ttu-id="ed6c7-424">[Método de instalação](#BKMK_InstallMethod): implantar controladores de domínio de réplica do domínio do Active Directory do Windows Server corporativo.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-424">[Installation method](#BKMK_InstallMethod): Deploy replica DCs from the corporate Windows Server Active Directory domain.</span></span> <span data-ttu-id="ed6c7-425">Para um controlador de domínio de réplica, você pode instalar o AD DS do Windows Server na VM e, opcionalmente, usar o recurso IFM (instalar da mídia) para reduzir a quantidade de dados que precisam ser replicados no novo controlador de domínio durante a instalação.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-425">For a replica DC, you can install Windows Server AD DS on the VM, and optionally use the Install From Media (IFM) feature to reduce the amount of data that needs to be replicated to the new DC during installation.</span></span> <span data-ttu-id="ed6c7-426">Para obter um tutorial, confira [Instalar um controlador de domínio do Active Directory de réplica no Azure](active-directory-install-replica-active-directory-domain-controller.md).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-426">For a tutorial, see [Install a replica Active Directory domain controller on Azure](active-directory-install-replica-active-directory-domain-controller.md).</span></span> <span data-ttu-id="ed6c7-427">Mesmo se você usar o IFM, pode ser mais eficiente criar o CD virtual no local e mover todo o VHD (disco rígido virtual) para a nuvem em vez de replicar o AD DS do Windows Server durante a instalação.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-427">Even if you use IFM, it may be more efficient to build the virtual DC on-premises and move the entire Virtual Hard Disk (VHD) to the cloud instead of replicating Windows Server AD DS during installation.</span></span> <span data-ttu-id="ed6c7-428">Para segurança, é recomendável que você exclua o VHD da rede local assim que tiver sido copiado para o Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-428">For safety, it is recommended that you delete the VHD from the on-premises network once it has been copied to Azure.</span></span>
* <span data-ttu-id="ed6c7-429">[Topologia do site do Active Directory do Windows Server](#BKMK_ADSiteTopology): criar um novo site do Azure em Serviços e Sites do Active Directory.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-429">[Windows Server Active Directory site topology](#BKMK_ADSiteTopology): Create a new Azure site in Active Directory Sites and Services.</span></span> <span data-ttu-id="ed6c7-430">Crie um objeto de sub-rede do Active Directory do Windows Server para representar a rede virtual do Azure e adicione a sub-rede ao site.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-430">Create a Windows Server Active Directory subnet object to represent the Azure virtual network and add the subnet to the site.</span></span> <span data-ttu-id="ed6c7-431">Crie um novo link de site que inclui o novo site do Azure e o site em que o ponto de extremidade VPN da rede virtual do Azure está localizado para controlar e otimizar o tráfego do Active Directory do Windows Server de e para o Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-431">Create a new site link that includes the new Azure site and the site in which the Azure virtual network VPN endpoint is located in order to control and optimize Windows Server Active Directory traffic to and from Azure.</span></span>
* <span data-ttu-id="ed6c7-432">[Endereçamento IP e DNS](#BKMK_IPAddressDNS):</span><span class="sxs-lookup"><span data-stu-id="ed6c7-432">[IP addressing and DNS](#BKMK_IPAddressDNS):</span></span>
  
  * <span data-ttu-id="ed6c7-433">Configurar um endereço IP estático para o controlador de domínio usando o cmdlet Set-AzureStaticVNetIP do Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-433">Set a static IP address for the DC by using the Set-AzureStaticVNetIP Azure PowerShell cmdlet.</span></span>
  * <span data-ttu-id="ed6c7-434">Instalar e configurar o DNS do Windows Server nos controladores de domínio do Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-434">Install and configure Windows Server DNS on the domain controller(s) on Azure.</span></span>
  * <span data-ttu-id="ed6c7-435">Configurar as propriedades de rede virtual com o nome e o endereço IP da máquina virtual que hospeda as funções de servidor DNS e controlador de domínio.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-435">Configure the virtual network properties with the name and IP address of the VM that hosts the DC and DNS server roles.</span></span>
* <span data-ttu-id="ed6c7-436">[Controladores de domínio distribuídos geograficamente](#BKMK_DistributedDCs): configure redes virtuais adicionais conforme a necessidade.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-436">[Geo-distributed DCs](#BKMK_DistributedDCs): Configure additional virtual networks as needed.</span></span> <span data-ttu-id="ed6c7-437">Se a topologia de site do Active Directory exige controladores de domínio nas geografias que correspondem a diferentes regiões do Azure, crie sites do Active Directory de forma adequada.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-437">If your Active Directory site topology requires DCs in geographies that correspond to different Azure regions, than you want to create Active Directory sites accordingly.</span></span>
* <span data-ttu-id="ed6c7-438">[Controladores de domínio somente leitura](#BKMK_RODC): você pode implantar um RODC no site do Azure, dependendo de seus requisitos para executar operações de gravação no controlador de domínio e da compatibilidade de aplicativos e serviços no site com RODCs.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-438">[Read-only DCs](#BKMK_RODC): You might deploy an RODC in the Azure site, depending on your requirements for performing write operations against the DC and the compatibility of applications and services in the site with RODCs.</span></span> <span data-ttu-id="ed6c7-439">Para saber mais sobre compatibilidade de aplicativos, confira o [Guia de compatibilidade de aplicativos de controladores de domínio somente leitura](https://technet.microsoft.com/library/cc755190).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-439">For more information about application compatibility, see the [Read-Only domain controllers application compatibility guide](https://technet.microsoft.com/library/cc755190).</span></span>
* <span data-ttu-id="ed6c7-440">[Catálogo Global](#BKMK_GC): os CGs são necessários para atender a solicitações de logon em florestas de vários domínios.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-440">[Global Catalog](#BKMK_GC): GCs are needed to service logon requests in multidomain forests.</span></span> <span data-ttu-id="ed6c7-441">Se você não implantar um CG no site do Azure, incorrerá em custos de tráfego de saída, já que as solicitações de autenticação causam consultas de CGs em outros sites.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-441">If you do not deploy a GC in the Azure site, you will incur egress traffic costs as authentication requests cause queries GCs in other sites.</span></span> <span data-ttu-id="ed6c7-442">Para minimizar esse tráfego, você pode habilitar o cache de associação ao grupo universal para o site do Azure em Serviços e Sites do Active Directory.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-442">To minimize that traffic, you can enable universal group membership caching for the Azure site in Active Directory Sites and Services.</span></span>
  
    <span data-ttu-id="ed6c7-443">Se você implantar um CG, configure links de site e os custos de links de site para que o CG no site do Azure não seja preferido como um controlador de domínio de origem por outros CGs que precisam replicar as mesmas partições de domínio parcial.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-443">If you deploy a GC, configure site links and site links costs so that the GC in the Azure site is not preferred as a source DC by other GCs that need to replicate the same partial domain partitions.</span></span>
* <span data-ttu-id="ed6c7-444">[Posicionamento do SYSVOL e do banco de dados do AD DS do Windows Server](#BKMK_PlaceDB): adicionar um disco de dados a controladores de domínio em execução em VMs do Azure para armazenar banco de dados, logs e SYSVOL do Active Directory do Windows Server.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-444">[Placement of the Windows Server AD DS database and SYSVOL](#BKMK_PlaceDB): Add a data disk to DCs running on Azure VMs in order to store the Windows Server Active Directory database, logs, and SYSVOL.</span></span>
* <span data-ttu-id="ed6c7-445">[Backup e restauração](#BKMK_BUR): determine onde você deseja armazenar os backups de estado do sistema.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-445">[Backup and Restore](#BKMK_BUR): Determine where you want to store system state backups.</span></span> <span data-ttu-id="ed6c7-446">Se necessário, adicione outro disco de dados à VM do controlador de domínio para armazenar backups.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-446">If necessary, add another data disk to the DC VM to store backups.</span></span>

## <a name="deployment-decisions-and-factors"></a><span data-ttu-id="ed6c7-447">Fatores e decisões de implantação</span><span class="sxs-lookup"><span data-stu-id="ed6c7-447">Deployment decisions and factors</span></span>
<span data-ttu-id="ed6c7-448">Essa tabela resume as áreas de tecnologia do Active Directory do Windows Server que são afetadas nos cenários anteriores e as decisões correspondentes a serem consideradas, com links para mais detalhes abaixo.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-448">This table summarizes the Windows Server Active Directory technology areas that are impacted in the preceding scenarios and the corresponding decisions to consider, with links to more detail below.</span></span> <span data-ttu-id="ed6c7-449">Algumas áreas de tecnologia podem não se aplicar a todos os cenários de implantação e algumas podem ser mais importantes para um cenário de implantação que outras.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-449">Some technology areas might not be applicable to every deployment scenario, and some technology areas might be more critical to a deployment scenario than other technology areas.</span></span>

<span data-ttu-id="ed6c7-450">Por exemplo, se você implantar uma controlador de domínio de réplica em uma rede virtual e sua floresta tiver apenas um domínio único, a escolha de implantar um servidor de catálogo global nesse caso não será essencial para o cenário de implantação porque ele não criará os requisitos adicionais de replicação.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-450">For example, if you deploy a replica DC on a virtual network and your forest has only a single domain, then choosing to deploy a global catalog server in that case will not be critical to the deployment scenario because it will not create any additional replication requirements.</span></span> <span data-ttu-id="ed6c7-451">Por outro lado, se a floresta tiver vários domínios, a decisão de implantar um catálogo global em uma rede virtual poderá afetar a largura de banda disponível, o desempenho, a autenticação, as pesquisas de diretório e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-451">On the other hand, if the forest has several domains, then the decision to deploy a global catalog on a virtual network could affect available bandwidth, performance, authentication, directory lookups, and so on.</span></span>

| <span data-ttu-id="ed6c7-452">Área de tecnologia do Active Directory do Windows Server</span><span class="sxs-lookup"><span data-stu-id="ed6c7-452">Windows Server Active Directory technology area</span></span> | <span data-ttu-id="ed6c7-453">Decisões</span><span class="sxs-lookup"><span data-stu-id="ed6c7-453">Decisions</span></span> | <span data-ttu-id="ed6c7-454">Fatores</span><span class="sxs-lookup"><span data-stu-id="ed6c7-454">Factors</span></span> |
| --- | --- | --- |
| [<span data-ttu-id="ed6c7-455">Topologia de rede</span><span class="sxs-lookup"><span data-stu-id="ed6c7-455">Network topology</span></span>](#BKMK_NetworkTopology) |<span data-ttu-id="ed6c7-456">Você cria uma rede virtual?</span><span class="sxs-lookup"><span data-stu-id="ed6c7-456">Do you create a virtual network?</span></span> |<li><span data-ttu-id="ed6c7-457">Requisitos para acessar os recursos da corporação</span><span class="sxs-lookup"><span data-stu-id="ed6c7-457">Requirements to access Corp resources</span></span></li> <li><span data-ttu-id="ed6c7-458">Autenticação</span><span class="sxs-lookup"><span data-stu-id="ed6c7-458">Authentication</span></span></li> <li><span data-ttu-id="ed6c7-459">Gerenciamento de Contas</span><span class="sxs-lookup"><span data-stu-id="ed6c7-459">Account management</span></span></li> |
| [<span data-ttu-id="ed6c7-460">Configuração de implantação do controlador de domínio</span><span class="sxs-lookup"><span data-stu-id="ed6c7-460">DC deployment configuration</span></span>](#BKMK_DeploymentConfig) |<li><span data-ttu-id="ed6c7-461">Implantar uma floresta separada sem nenhuma relações de confiança?</span><span class="sxs-lookup"><span data-stu-id="ed6c7-461">Deploy a separate forest without any trusts?</span></span></li> <li><span data-ttu-id="ed6c7-462">Implantar uma nova floresta com federação?</span><span class="sxs-lookup"><span data-stu-id="ed6c7-462">Deploy a new forest with federation?</span></span></li> <li><span data-ttu-id="ed6c7-463">Implantar uma nova floresta com a relação de confiança da floresta do Active Directory do Windows Server ou Kerberos?</span><span class="sxs-lookup"><span data-stu-id="ed6c7-463">Deploy a new forest with Windows Server Active Directory forest trust or Kerberos?</span></span></li> <li><span data-ttu-id="ed6c7-464">Estender a floresta da corporação implantando um controlador de domínio de réplica?</span><span class="sxs-lookup"><span data-stu-id="ed6c7-464">Extend Corp forest by deploying a replica DC?</span></span></li> <li><span data-ttu-id="ed6c7-465">Estender a floresta da corporação implantando um novo domínio filho ou árvore de domínio?</span><span class="sxs-lookup"><span data-stu-id="ed6c7-465">Extend Corp forest by deploying a new child domain or domain tree?</span></span></li> |<li><span data-ttu-id="ed6c7-466">Segurança</span><span class="sxs-lookup"><span data-stu-id="ed6c7-466">Security</span></span></li> <li><span data-ttu-id="ed6c7-467">Conformidade</span><span class="sxs-lookup"><span data-stu-id="ed6c7-467">Compliance</span></span></li> <li><span data-ttu-id="ed6c7-468">Custo</span><span class="sxs-lookup"><span data-stu-id="ed6c7-468">Cost</span></span></li> <li><span data-ttu-id="ed6c7-469">Resiliência e tolerância a falhas</span><span class="sxs-lookup"><span data-stu-id="ed6c7-469">Resiliency and fault-tolerance</span></span></li> <li><span data-ttu-id="ed6c7-470">Compatibilidade de aplicativos</span><span class="sxs-lookup"><span data-stu-id="ed6c7-470">Application compatibility</span></span></li> |
| [<span data-ttu-id="ed6c7-471">Topologia do site do Active Directory do Windows Server</span><span class="sxs-lookup"><span data-stu-id="ed6c7-471">Windows Server Active Directory site topology</span></span>](#BKMK_ADSiteTopology) |<span data-ttu-id="ed6c7-472">Como você configura sub-redes, sites e links de site com a rede virtual do Azure para otimizar o tráfego e minimizar os custos?</span><span class="sxs-lookup"><span data-stu-id="ed6c7-472">How do you configure subnets, sites, and site links with Azure Virtual Network to optimize traffic and minimize cost?</span></span> |<li><span data-ttu-id="ed6c7-473">Definições de sub-rede e site</span><span class="sxs-lookup"><span data-stu-id="ed6c7-473">Subnet and site definitions</span></span></li> <li><span data-ttu-id="ed6c7-474">Propriedades do link do site e notificação de alteração</span><span class="sxs-lookup"><span data-stu-id="ed6c7-474">Site link properties and change notification</span></span></li> <li><span data-ttu-id="ed6c7-475">Compactação de replicação</span><span class="sxs-lookup"><span data-stu-id="ed6c7-475">Replication compression</span></span></li> |
| [<span data-ttu-id="ed6c7-476">Endereçamento IP e DNS</span><span class="sxs-lookup"><span data-stu-id="ed6c7-476">IP addressing and DNS</span></span>](#BKMK_IPAddressDNS) |<span data-ttu-id="ed6c7-477">Como configurar endereços IP e resolução de nome?</span><span class="sxs-lookup"><span data-stu-id="ed6c7-477">How to configure IP addresses and name resolution?</span></span> |<li><span data-ttu-id="ed6c7-478">Use o cmdlet Set-AzureStaticVNetIP para atribuir um endereço IP estático</span><span class="sxs-lookup"><span data-stu-id="ed6c7-478">Use the Use the Set-AzureStaticVNetIP cmdlet to assign a static IP address</span></span></li> <li><span data-ttu-id="ed6c7-479">Instale o servidor Windows Server DNS e configure as propriedades de rede virtual com o nome e o endereço IP da máquina virtual que hospeda as funções de servidor DNS e controlador de domínio.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-479">Install Windows Server DNS server and configure the virtual network properties with the name and IP address of the VM that hosts the DC and DNS server roles</span></span></li> |
| [<span data-ttu-id="ed6c7-480">Controladores de domínio distribuídos geograficamente</span><span class="sxs-lookup"><span data-stu-id="ed6c7-480">Geo-distributed DCs</span></span>](#BKMK_DistributedDCs) |<span data-ttu-id="ed6c7-481">Como replicar controladores de domínio em redes virtuais separadas?</span><span class="sxs-lookup"><span data-stu-id="ed6c7-481">How to replicate to DCs on separate virtual networks?</span></span> |<span data-ttu-id="ed6c7-482">Se a topologia de site do Active Directory exige controladores de domínio nas geografias que correspondem a diferentes regiões do Azure, crie sites do Active Directory de forma adequada.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-482">If your Active Directory site topology requires DCs in geographies that corresponds to different Azure regions, than you want to create Active Directory sites accordingly.</span></span> <span data-ttu-id="ed6c7-483">[Configure a rede virtual para a conectividade de rede virtual](../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md) a fim de replicar entre controladores de domínio em redes virtuais separadas.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-483">[Configure virtual network to virtual network Connectivity](../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md) to replicate between domain controllers on separate virtual networks.</span></span> |
| [<span data-ttu-id="ed6c7-484">Controladores de domínio somente leitura</span><span class="sxs-lookup"><span data-stu-id="ed6c7-484">Read-only DCs</span></span>](#BKMK_RODC) |<span data-ttu-id="ed6c7-485">Usar controladores de domínio somente leitura ou graváveis?</span><span class="sxs-lookup"><span data-stu-id="ed6c7-485">Use read-only or writeable DCs?</span></span> |<li><span data-ttu-id="ed6c7-486">Filtrar atributos HBI/PII</span><span class="sxs-lookup"><span data-stu-id="ed6c7-486">Filter HBI/PII attributes</span></span></li> <li><span data-ttu-id="ed6c7-487">Filtrar segredos</span><span class="sxs-lookup"><span data-stu-id="ed6c7-487">Filter secrets</span></span></li> <li><span data-ttu-id="ed6c7-488">Limitar o tráfego de saída</span><span class="sxs-lookup"><span data-stu-id="ed6c7-488">Limit outbound traffic</span></span></li> |
| [<span data-ttu-id="ed6c7-489">Catálogo global</span><span class="sxs-lookup"><span data-stu-id="ed6c7-489">Global catalog</span></span>](#BKMK_GC) |<span data-ttu-id="ed6c7-490">Instalar o catálogo global?</span><span class="sxs-lookup"><span data-stu-id="ed6c7-490">Install global catalog?</span></span> |<li><span data-ttu-id="ed6c7-491">Para uma floresta de domínio único, verifique todos os GCs de DCs</span><span class="sxs-lookup"><span data-stu-id="ed6c7-491">For single-domain forest, make all DCs GCs</span></span></li> <li><span data-ttu-id="ed6c7-492">Para uma floresta de vários domínios, os GCs são necessários para autenticação</span><span class="sxs-lookup"><span data-stu-id="ed6c7-492">For multidomain forest, GCs are required for authentication</span></span></li> |
| [<span data-ttu-id="ed6c7-493">Método de instalação</span><span class="sxs-lookup"><span data-stu-id="ed6c7-493">Installation method</span></span>](#BKMK_InstallMethod) |<span data-ttu-id="ed6c7-494">Como instalar o controlador de domínio no Azure?</span><span class="sxs-lookup"><span data-stu-id="ed6c7-494">How to install DC in Azure?</span></span> |<span data-ttu-id="ed6c7-495">Você pode:</span><span class="sxs-lookup"><span data-stu-id="ed6c7-495">Either:</span></span> <li><span data-ttu-id="ed6c7-496">Instalar o AD DS usando o Windows PowerShell ou o Dcpromo</span><span class="sxs-lookup"><span data-stu-id="ed6c7-496">Install AD DS using Windows PowerShell or Dcpromo</span></span></li> <li><span data-ttu-id="ed6c7-497">Mover o VHD de um DC virtual local</span><span class="sxs-lookup"><span data-stu-id="ed6c7-497">Move VHD of an on-premises virtual DC</span></span></li> |
| [<span data-ttu-id="ed6c7-498">Posicionamento do SYSVOL e do banco de dados do AD DS do Windows Server</span><span class="sxs-lookup"><span data-stu-id="ed6c7-498">Placement of the Windows Server AD DS database and SYSVOL</span></span>](#BKMK_PlaceDB) |<span data-ttu-id="ed6c7-499">Onde armazenar o banco de dados, logs e SYSVOL do AD DS do Windows Server?</span><span class="sxs-lookup"><span data-stu-id="ed6c7-499">Where to store Windows Server AD DS database, logs, and SYSVOL?</span></span> |<span data-ttu-id="ed6c7-500">Altere os valores padrão de Dcpromo.exe.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-500">Change Dcpromo.exe default values.</span></span> <span data-ttu-id="ed6c7-501">Esses arquivos críticos do Active Directory *têm que* ser colocados em Discos de Dados do Azure, em vez de discos do Sistema Operacional que implementa o cache de gravação.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-501">These critical Active Directory files *must* be placed on Azure Data Disks instead of Operating System disks that implement write caching.</span></span> |
| [<span data-ttu-id="ed6c7-502">Backup e restauração</span><span class="sxs-lookup"><span data-stu-id="ed6c7-502">Backup and Restore</span></span>](#BKMK_BUR) |<span data-ttu-id="ed6c7-503">Como proteger e recuperar dados?</span><span class="sxs-lookup"><span data-stu-id="ed6c7-503">How to safeguard and recover data?</span></span> |<span data-ttu-id="ed6c7-504">Criar backups de estado do sistema</span><span class="sxs-lookup"><span data-stu-id="ed6c7-504">Create system state backups</span></span> |
| [<span data-ttu-id="ed6c7-505">Configuração do servidor de federação</span><span class="sxs-lookup"><span data-stu-id="ed6c7-505">Federation server configuration</span></span>](#BKMK_FedSrvConfig) |<li><span data-ttu-id="ed6c7-506">Implantar uma nova floresta com federação na nuvem?</span><span class="sxs-lookup"><span data-stu-id="ed6c7-506">Deploy a new forest with federation in the cloud?</span></span></li> <li><span data-ttu-id="ed6c7-507">Implantar o AD FS local e expor um proxy na nuvem?</span><span class="sxs-lookup"><span data-stu-id="ed6c7-507">Deploy AD FS on-premises and expose a proxy in the cloud?</span></span></li> |<li><span data-ttu-id="ed6c7-508">Segurança</span><span class="sxs-lookup"><span data-stu-id="ed6c7-508">Security</span></span></li> <li><span data-ttu-id="ed6c7-509">Conformidade</span><span class="sxs-lookup"><span data-stu-id="ed6c7-509">Compliance</span></span></li> <li><span data-ttu-id="ed6c7-510">Custo</span><span class="sxs-lookup"><span data-stu-id="ed6c7-510">Cost</span></span></li> <li><span data-ttu-id="ed6c7-511">Acesso a aplicativos por parceiros de negócios</span><span class="sxs-lookup"><span data-stu-id="ed6c7-511">Access to applications by business partners</span></span></li> |
| [<span data-ttu-id="ed6c7-512">Configuração de serviços de nuvem</span><span class="sxs-lookup"><span data-stu-id="ed6c7-512">Cloud services configuration</span></span>](#BKMK_CloudSvcConfig) |<span data-ttu-id="ed6c7-513">Um serviço de nuvem é implantado implicitamente na primeira vez em que você cria uma máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-513">A cloud service is implicitly deployed the first time you create a virtual machine.</span></span> <span data-ttu-id="ed6c7-514">Você precisa implantar serviços de nuvem adicionais?</span><span class="sxs-lookup"><span data-stu-id="ed6c7-514">Do you need to deploy additional cloud services?</span></span> |<li><span data-ttu-id="ed6c7-515">Uma ou mais máquinas virtuais exigem exposição direta à Internet?</span><span class="sxs-lookup"><span data-stu-id="ed6c7-515">Does a VM or VMs require direct exposure to the Internet?</span></span></li> <li> <span data-ttu-id="ed6c7-516">O serviço exige o balanceamento de carga?</span><span class="sxs-lookup"><span data-stu-id="ed6c7-516">Does the service require load-balancing?</span></span></li> |
| [<span data-ttu-id="ed6c7-517">Requisitos do servidor de federação para endereçamento IP público e privado (IP dinâmico versus IP virtual)</span><span class="sxs-lookup"><span data-stu-id="ed6c7-517">Federation server requirements for public and private IP addressing (dynamic IP vs. virtual IP)</span></span>](#BKMK_FedReqVIPDIP) |<li><span data-ttu-id="ed6c7-518">A instância do AD FS do Windows Server precisa ser acessada diretamente pela Internet?</span><span class="sxs-lookup"><span data-stu-id="ed6c7-518">Does the Windows Server AD FS instance need to be reached directly from the Internet?</span></span></li> <li><span data-ttu-id="ed6c7-519">O aplicativo que está sendo implantado na nuvem requer seu próprio endereço IP para a Internet e a porta?</span><span class="sxs-lookup"><span data-stu-id="ed6c7-519">Does the application being deployed in the cloud require its own Internet-facing IP address and port?</span></span></li> |<span data-ttu-id="ed6c7-520">Criar um serviço de nuvem para cada endereço IP virtual que é exigido pela sua implantação</span><span class="sxs-lookup"><span data-stu-id="ed6c7-520">Create one cloud-service for each virtual IP address that is required by your deployment</span></span> |
| [<span data-ttu-id="ed6c7-521">Configuração de alta disponibilidade do AD FS do Windows Server</span><span class="sxs-lookup"><span data-stu-id="ed6c7-521">Windows Server AD FS high availability configuration</span></span>](#BKMK_ADFSHighAvail) |<li><span data-ttu-id="ed6c7-522">Quantos nós em meu farm de servidores do AD FS do Windows Server?</span><span class="sxs-lookup"><span data-stu-id="ed6c7-522">How many nodes in my Windows Server AD FS server farm?</span></span></li> <li><span data-ttu-id="ed6c7-523">Quantos nós implantar em meu farm de proxy do AD FS do Windows Server?</span><span class="sxs-lookup"><span data-stu-id="ed6c7-523">How many nodes to deploy in my Windows Server AD FS proxy farm?</span></span></li> |<span data-ttu-id="ed6c7-524">Resiliência e tolerância a falhas</span><span class="sxs-lookup"><span data-stu-id="ed6c7-524">Resiliency and fault tolerance</span></span> |

### <span data-ttu-id="ed6c7-525"><a name="BKMK_NetworkTopology"></a>Topologia de rede</span><span class="sxs-lookup"><span data-stu-id="ed6c7-525"><a name="BKMK_NetworkTopology"></a>Network topology</span></span>
<span data-ttu-id="ed6c7-526">Para atender aos requisitos de consistência de endereço IP e de DNS do AD DS do Windows Server, primeiro é necessário criar uma [rede virtual do Azure](../virtual-network/virtual-networks-overview.md) e conectar as máquinas virtuais a ela.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-526">In order to meet the IP address consistency and DNS requirements of Windows Server AD DS, it is necessary to first create an [Azure virtual network](../virtual-network/virtual-networks-overview.md) and attach your virtual machines to it.</span></span> <span data-ttu-id="ed6c7-527">Durante a criação, você deve decidir se deseja opcionalmente estender a conectividade à rede corporativa local, que conecta de maneira transparente máquinas virtuais do Azure a computadores locais. Isso é obtido usando tecnologias de VPN tradicionais e exige que um ponto de extremidade VPN seja exposto na borda da rede corporativa.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-527">During its creation, you must decide whether to optionally extend connectivity to your on-premises corporate network, which transparently connects Azure virtual machines to on-premises machines — this is achieved using traditional VPN technologies and requires that a VPN endpoint be exposed on the edge of the corporate network.</span></span> <span data-ttu-id="ed6c7-528">Ou seja, a VPN é iniciada do Azure para a rede corporativa, e não o contrário.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-528">That is, the VPN is initiated from Azure to the corporate network, not vice-versa.</span></span>

<span data-ttu-id="ed6c7-529">Observe que encargos adicionais se aplicam ao estender uma rede virtual à sua rede local, além dos encargos padrão que se aplicam a cada máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-529">Note that additional charges apply when extending a virtual network to your on-premises network beyond the standard charges that apply to each VM.</span></span> <span data-ttu-id="ed6c7-530">Especificamente, há encargos para o tempo de CPU do gateway de Rede Virtual do Azure e para o tráfego de saída gerado por cada VM que se comunica com computadores locais pela VPN.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-530">Specifically, there are charges for CPU time of the Azure Virtual Network gateway and for the egress traffic generated by each VM that communicates with on-premises machines across the VPN.</span></span> <span data-ttu-id="ed6c7-531">Para saber mais sobre encargos de tráfego de rede, confira [Visão geral de preços do Azure](http://azure.microsoft.com/pricing/).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-531">For more information about network traffic charges, see [Azure pricing at-a-glance](http://azure.microsoft.com/pricing/).</span></span>

### <span data-ttu-id="ed6c7-532"><a name="BKMK_DeploymentConfig"></a>Configuração de implantação do controlador de domínio</span><span class="sxs-lookup"><span data-stu-id="ed6c7-532"><a name="BKMK_DeploymentConfig"></a>DC deployment configuration</span></span>
<span data-ttu-id="ed6c7-533">A maneira como você configura o controlador de domínio depende dos requisitos do serviço que deseja executar no Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-533">The way you configure the DC depends on the requirements for the service you want to run on Azure.</span></span> <span data-ttu-id="ed6c7-534">Por exemplo, você pode implantar uma nova floresta, isolada de sua própria floresta corporativa, para testar uma prova de conceito, um novo aplicativo ou outro projeto de curto prazo que requer serviços de diretório, mas não o acesso específico aos recursos corporativos internos.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-534">For example, you might deploy a new forest, isolated from your own corporate forest, for testing a proof-of-concept, a new application, or some other short term project that requires directory services but not specific access to internal corporate resources.</span></span>

<span data-ttu-id="ed6c7-535">Como benefício, um controlador de domínio de floresta isolado não replica com controladores de domínios locais, resultando em menor tráfego de rede de saída gerado pelo sistema em si e reduzindo custos diretamente.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-535">As a benefit, an isolated forest DC does not replicate with on-premises DCs, resulting in less outbound network traffic generated by the system itself, directly reducing costs.</span></span> <span data-ttu-id="ed6c7-536">Para saber mais sobre encargos de tráfego de rede, confira [Visão geral de preços do Azure](http://azure.microsoft.com/pricing/).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-536">For more information about network traffic charges, see [Azure pricing at-a-glance](http://azure.microsoft.com/pricing/).</span></span>

<span data-ttu-id="ed6c7-537">Para dar outro exemplo, suponha que você tenha requisitos de privacidade para um serviço, mas o serviço depende do acesso ao Active Directory do Windows Server interno.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-537">As another example, suppose you have privacy requirements for a service, but the service depends on access to your internal Windows Server Active Directory.</span></span> <span data-ttu-id="ed6c7-538">Se você tem permissão para hospedar dados do serviço na nuvem, pode implantar um novo domínio filho para sua floresta interna no Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-538">If you are allowed to host data for the service in the cloud, you might deploy a new child domain for your internal forest on Azure.</span></span> <span data-ttu-id="ed6c7-539">Nesse caso, você pode implantar um controlador de domínio para o novo domínio filho (sem o catálogo global para ajudar a resolver problemas de privacidade).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-539">In this case, you can deploy a DC for the new child domain (without the global catalog in order to help address privacy concerns).</span></span> <span data-ttu-id="ed6c7-540">Esse cenário, junto com uma implantação de controlador de domínio de réplica, requer uma rede virtual para conectividade com seus controladores de domínio locais.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-540">This scenario, along with a replica DC deployment, requires a virtual network for connectivity with your on-premises DCs.</span></span>

<span data-ttu-id="ed6c7-541">Se você criar uma nova floresta, escolha se deseja usar [relações de confiança do Active Directory](https://technet.microsoft.com/library/cc771397) ou da [federação](https://technet.microsoft.com/library/dd807036).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-541">If you create a new forest, choose whether to use [Active Directory trusts](https://technet.microsoft.com/library/cc771397) or [Federation trusts](https://technet.microsoft.com/library/dd807036).</span></span> <span data-ttu-id="ed6c7-542">Equilibre as exigências ditadas por compatibilidade, segurança, conformidade, custo e resiliência.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-542">Balance the requirements dictated by compatibility, security, compliance, cost, and resiliency.</span></span> <span data-ttu-id="ed6c7-543">Por exemplo, para tirar proveito da [autenticação seletiva](https://technet.microsoft.com/library/cc755844) , você pode optar por implantar uma nova floresta no Azure e criar uma relação de confiança entre a floresta local e a floresta da nuvem do Active Directory do Windows Server.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-543">For example, to take advantage of [selective authentication](https://technet.microsoft.com/library/cc755844) you might choose to deploy a new forest on Azure and create a Windows Server Active Directory trust between the on-premises forest and the cloud forest.</span></span> <span data-ttu-id="ed6c7-544">Se o aplicativo tiver reconhecimento de declarações, no entanto, você poderá implantar a confiança de federação em vez de relações de confiança de floresta do Active Directory.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-544">If the application is claims-aware, however, you might deploy federation trusts instead of Active Directory forest trusts.</span></span> <span data-ttu-id="ed6c7-545">Outro fator será o custo para replicar mais dados estendendo seu Active Directory do Windows Server local para a nuvem ou gerar mais tráfego de saída como resultado da autenticação e da carga de consulta.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-545">Another factor will be the cost to either replicate more data by extending your on-premises Windows Server Active Directory to the cloud or generate more outbound traffic as a result of authentication and query load.</span></span>

<span data-ttu-id="ed6c7-546">Os requisitos de disponibilidade e tolerância a falhas também afetam sua escolha.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-546">Requirements for availability and fault tolerance also affect your choice.</span></span> <span data-ttu-id="ed6c7-547">Por exemplo, se o link for interrompido, aplicativos que usam uma relação de confiança de Kerberos ou de federação serão todos totalmente descontinuados, a menos que você tenha implantado infraestrutura suficiente no Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-547">For example, if the link is interrupted, applications leveraging either a Kerberos trust or a federation trust are all likely entirely broken unless you have deployed sufficient infrastructure on Azure.</span></span> <span data-ttu-id="ed6c7-548">Configurações de implantação alternativas, como controladores de domínio de réplica (graváveis ou RODCs) aumentam a capacidade de tolerância a interrupções de link.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-548">Alternative deployment configurations such as replica DCs (writeable or RODCs) increase the likelihood of being able to tolerate link outages.</span></span>

### <span data-ttu-id="ed6c7-549"><a name="BKMK_ADSiteTopology"></a>Topologia do site do Active Directory do Windows Server</span><span class="sxs-lookup"><span data-stu-id="ed6c7-549"><a name="BKMK_ADSiteTopology"></a>Windows Server Active Directory site topology</span></span>
<span data-ttu-id="ed6c7-550">Você precisa definir corretamente os sites e links de sites para otimizar o tráfego e minimizar os custos.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-550">You need to correctly define sites and site links in order to optimize traffic and minimize cost.</span></span> <span data-ttu-id="ed6c7-551">Sites, links de sites e sub-redes afetam a topologia de replicação entre controladores de domínio e o fluxo de tráfego de autenticação.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-551">Sites, site-links, and subnets affect the replication topology between DCs and the flow of authentication traffic.</span></span> <span data-ttu-id="ed6c7-552">Considere os seguintes encargos de tráfego e implante e configure controladores de domínio de acordo com os requisitos de seu cenário de implantação:</span><span class="sxs-lookup"><span data-stu-id="ed6c7-552">Consider the following traffic charges and then deploy and configure DCs according to the requirements of your deployment scenario:</span></span>

* <span data-ttu-id="ed6c7-553">Há uma taxa nominal por hora para o próprio gateway:</span><span class="sxs-lookup"><span data-stu-id="ed6c7-553">There is a nominal fee per hour for the gateway itself:</span></span>
  
  * <span data-ttu-id="ed6c7-554">Ele pode ser iniciado e interrompido conforme você quiser</span><span class="sxs-lookup"><span data-stu-id="ed6c7-554">It can be started and stopped as you see fit</span></span>
  * <span data-ttu-id="ed6c7-555">Se forem interrompidas, as VMs do Azure serão isoladas da rede corporativa</span><span class="sxs-lookup"><span data-stu-id="ed6c7-555">If stopped, Azure VMs are isolated from the corporate network</span></span>
* <span data-ttu-id="ed6c7-556">O tráfego de entrada está livre</span><span class="sxs-lookup"><span data-stu-id="ed6c7-556">Inbound traffic is free</span></span>
* <span data-ttu-id="ed6c7-557">O tráfego de saída é cobrado conforme a [Visão geral de preços do Azure](http://azure.microsoft.com/pricing/).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-557">Outbound traffic is charged, according to [Azure pricing at-a-glance](http://azure.microsoft.com/pricing/).</span></span> <span data-ttu-id="ed6c7-558">Você pode otimizar propriedades de link de site entre sites locais e a nuvem da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="ed6c7-558">You can optimize site link properties between on-premises sites and the cloud sites as follows:</span></span>
  
  * <span data-ttu-id="ed6c7-559">Se você estiver usando várias redes virtuais, configure os links de site e seus custos de forma adequada para impedir que o AD DS do Windows Server priorize o site do Azure no lugar de um site que possa fornecer os mesmos níveis de serviço gratuitamente.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-559">If you are using multiple virtual networks, configure the site-links and their costs appropriately to prevent Windows Server AD DS from prioritizing the Azure site over one that can provide the same levels of service at no charge.</span></span> <span data-ttu-id="ed6c7-560">Você também pode considerar desabilitar a opção BASL (ponte de todos os links de site), que é habilitada por padrão.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-560">You might also consider disabling the Bridge all site link (BASL) option (which is enabled by default).</span></span> <span data-ttu-id="ed6c7-561">Isso faz com que somente os sites conectados diretamente repliquem entre si.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-561">This ensures that only directly-connected sites replicate with one another.</span></span> <span data-ttu-id="ed6c7-562">Os controladores de domínio em sites conectados temporariamente não conseguem replicar diretamente uns com os outros, mas devem replicar por meio de um ou mais sites em comum.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-562">DCs in transitively connected sites are no longer able to replicate directly with each other, but must replicate through a common site or sites.</span></span> <span data-ttu-id="ed6c7-563">Se os sites intermediários ficam indisponíveis por algum motivo, a replicação entre controladores de domínio em sites conectados temporariamente não ocorre mesmo que haja conectividade entre os sites.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-563">If the intermediary sites become unavailable for some reason, replication between DCs in transitively connected sites will not occur even if connectivity between the sites is available.</span></span> <span data-ttu-id="ed6c7-564">Finalmente, quando existirem seções do comportamento de replicação temporária ainda desejáveis, crie pontes de link de site que contêm os sites e links de site apropriados, como sites de rede corporativa locais.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-564">Finally, where sections of transitive replication behavior remain desirable, create site link bridges that contain the appropriate site-links and sites, such as on-premises, corporate network sites.</span></span>
  * <span data-ttu-id="ed6c7-565">[Configure custos de link de site](https://technet.microsoft.com/library/cc794882) adequadamente para evitar tráfego não intencional.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-565">[Configure site link costs](https://technet.microsoft.com/library/cc794882) appropriately to avoid unintended traffic.</span></span> <span data-ttu-id="ed6c7-566">Por exemplo, se a configuração **Tentar Site Mais Próximo** estiver habilitada, verifique se os sites de rede virtual não são os mais próximos aumentando o custo associado do objeto de link de site que conecta o site do Azure de volta à rede corporativa.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-566">For example, if **Try Next Closest Site** setting is enabled, make sure the virtual network sites are not the next closest by increasing the cost associated of the site-link object that connects the Azure site back to the corporate network.</span></span>
  * <span data-ttu-id="ed6c7-567">Configure os [intervalos](https://technet.microsoft.com/library/cc794878) e [agendas](https://technet.microsoft.com/library/cc816906) do link de site de acordo com os requisitos de consistência e taxa de alterações de objeto.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-567">Configure site link [intervals](https://technet.microsoft.com/library/cc794878) and [schedules](https://technet.microsoft.com/library/cc816906) according to consistency requirements and rate of object changes.</span></span> <span data-ttu-id="ed6c7-568">Alinhe a agenda de replicação com a tolerância à latência.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-568">Align replication schedule with latency tolerance.</span></span> <span data-ttu-id="ed6c7-569">Os controladores de domínio replicam somente o último estado de um valor, portanto, diminuir o intervalo de replicação poderá economizar custos se houver uma taxa de alteração de objeto suficiente.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-569">DCs replicate only the last state of a value, so decreasing the replication interval can save costs if there is a sufficient object change rate.</span></span>
* <span data-ttu-id="ed6c7-570">Se a minimização de custos for uma prioridade, verifique se a replicação está agendada e se a notificação de alteração não está habilitada.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-570">If minimizing costs is a priority, ensure replication is scheduled and change notification is not enabled.</span></span> <span data-ttu-id="ed6c7-571">Essa é a configuração padrão na replicação entre sites.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-571">This is the default configuration when replicating between sites.</span></span> <span data-ttu-id="ed6c7-572">Isso não é importante se você estiver implantando um RODC em uma rede virtual porque o RODC não replicará alterações de saída.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-572">This is not important if you are deploying an RODC on a virtual network because the RODC will not replicate any changes outbound.</span></span> <span data-ttu-id="ed6c7-573">Mas, se você implantar um CD gravável, deverá verificar se que o link de site não está configurado para replicar atualizações com frequência desnecessária.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-573">But if you deploy a writable DC, you should make sure the site link is not configured to replicate updates with unnecessary frequency.</span></span> <span data-ttu-id="ed6c7-574">Se você implantar um servidor de CG (catálogo global), verifique se todos os outros sites que contêm um CG replicam as partições de domínio de um CD de origem em um site que está conectado a um ou mais links de site que têm um custo menor do que o CG no site do Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-574">If you deploy a global catalog server (GC), make sure that every other site that contains a GC replicates domain partitions from a source DC in a site that is connected with a site-link or site-links that have a lower cost than the GC in the Azure site.</span></span>
* <span data-ttu-id="ed6c7-575">É possível reduzir ainda mais o tráfego de rede gerado pela replicação entre sites alterando o algoritmo de compactação de replicação.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-575">It is possible to further still reduce network traffic generated by replication between sites by changing the replication compression algorithm.</span></span> <span data-ttu-id="ed6c7-576">O algoritmo de compactação é controlado pelo algoritmo de compactação de HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NTDS\Parameters\Replicator de entrada do registro REG_DWORD.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-576">The compression algorithm is controlled by the REG_DWORD registry entry HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NTDS\Parameters\Replicator compression algorithm.</span></span> <span data-ttu-id="ed6c7-577">O valor padrão é 3, que se relaciona com o algoritmo de compactação Xpress.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-577">The default value is 3, which correlates to the Xpress Compress algorithm.</span></span> <span data-ttu-id="ed6c7-578">Você pode alterar o valor para 2, que altera o algoritmo para MSZip.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-578">You can change the value to 2, which changes the algorithm to MSZip.</span></span> <span data-ttu-id="ed6c7-579">Na maioria dos casos, isso aumentará a compactação, mas ele faz isso às custas da utilização da CPU.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-579">In most cases, this will increase the compression, but it does so at the expense of CPU utilization.</span></span> <span data-ttu-id="ed6c7-580">Para saber mais, confira [Como funciona a topologia de replicação do Active Directory](https://technet.microsoft.com/library/cc755994).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-580">For more information, see [How Active Directory replication topology works](https://technet.microsoft.com/library/cc755994).</span></span>

### <span data-ttu-id="ed6c7-581"><a name="BKMK_IPAddressDNS"></a>Endereçamento IP e DNS</span><span class="sxs-lookup"><span data-stu-id="ed6c7-581"><a name="BKMK_IPAddressDNS"></a>IP addressing and DNS</span></span>
<span data-ttu-id="ed6c7-582">As máquinas virtuais do Azure recebem "endereços arrendados para DHCP" por padrão.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-582">Azure virtual machines are allocated “DHCP-leased addresses” by default.</span></span> <span data-ttu-id="ed6c7-583">Como os endereços dinâmicos de rede virtual do Azure persistem com uma máquina virtual pelo tempo de vida da máquina virtual, os requisitos do AD DS do Windows Server são atendidos.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-583">Because Azure virtual network dynamic addresses persist with a virtual machine for the lifetime of the virtual machine, the requirements of Windows Server AD DS are met.</span></span>

<span data-ttu-id="ed6c7-584">Como resultado, quando você usa um endereço dinâmico no Azure, está de fato usando um endereço IP estático, pois ele é roteável pelo período da concessão e o período da concessão é igual ao tempo de vida do serviço de nuvem.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-584">As a result, when you use a dynamic address on Azure, you are in effect using a static IP address because it is routable for the period of the lease, and the period of the lease is equal to the lifetime of the cloud service.</span></span>

<span data-ttu-id="ed6c7-585">No entanto, o endereço dinâmico será desalocado se a VM for desligada.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-585">However, the dynamic address is deallocated if the VM is shutdown.</span></span> <span data-ttu-id="ed6c7-586">Para impedir que o endereço IP seja desalocado, você pode [usar Set-AzureStaticVNetIP para atribuir um endereço IP estático](http://social.technet.microsoft.com/wiki/contents/articles/23447.how-to-assign-a-private-static-ip-to-an-azure-vm.aspx).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-586">To prevent the IP address from being deallocated, you can [use Set-AzureStaticVNetIP to assign a static IP address](http://social.technet.microsoft.com/wiki/contents/articles/23447.how-to-assign-a-private-static-ip-to-an-azure-vm.aspx).</span></span>

<span data-ttu-id="ed6c7-587">Para a resolução de nomes, implante sua própria infraestrutura de servidor DNS (ou aproveite uma existente). O DNS fornecido pelo Azure não atende às necessidades de resolução de nome avançadas do AD DS do Windows Server.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-587">For name resolution, deploy your own (or leverage your existing) DNS server infrastructure; Azure-provided DNS does not meet the advanced name resolution needs of Windows Server AD DS.</span></span> <span data-ttu-id="ed6c7-588">Por exemplo, ele não é compatível com registros SRV dinâmicos e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-588">For example, it does not support dynamic SRV records, and so on.</span></span> <span data-ttu-id="ed6c7-589">A resolução de nomes é um item de configuração essencial para clientes ingressados no domínio e controladores de domínio.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-589">Name resolution is a critical configuration item for DCs and domain-joined clients.</span></span> <span data-ttu-id="ed6c7-590">Os controladores de domínio devem ser capazes de gravar registros de recursos e resolver registros de recursos de outros controladores de domínio.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-590">DCs must be capable of registering resource records and resolving other DC’s resource records.</span></span>
<span data-ttu-id="ed6c7-591">Por razões de desempenho e tolerância a falhas, é ideal instalar o serviço DNS do Windows Server nos controladores de domínio em execução no Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-591">For fault tolerance and performance reasons, it is optimal to install the Windows Server DNS service on the DCs running on Azure.</span></span> <span data-ttu-id="ed6c7-592">Em seguida, configure as propriedades de rede virtual do Azure com o nome e o endereço IP do servidor DNS.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-592">Then configure the Azure virtual network properties with the name and IP address of the DNS server.</span></span> <span data-ttu-id="ed6c7-593">Quando outras VMs na rede virtual iniciarem, suas configurações de resolvedor do cliente DNS serão configuradas com o servidor DNS como parte da alocação de endereços IP dinâmicos.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-593">When other VMs on the virtual network start, their DNS client resolver settings will be configured with DNS server as part of the dynamic IP address allocation.</span></span>

> [!NOTE]
> <span data-ttu-id="ed6c7-594">Você não pode ingressar computadores locais em um domínio do Active Directory do AD DS do Windows Server que está hospedado no Azure diretamente pela Internet.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-594">You cannot join on-premises computers to a Windows Server AD DS Active Directory domain that is hosted on Azure directly over the Internet.</span></span> <span data-ttu-id="ed6c7-595">Os requisitos de porta para o Active Directory e a operação de ingresso no domínio tornam impraticável a exposição direta das portas necessárias e, por consequência, um controlador de domínio inteiro para a Internet.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-595">The port requirements for Active Directory and the domain-join operation render it impractical to directly expose the necessary ports and in effect, an entire DC to the Internet.</span></span>
> 
> 

<span data-ttu-id="ed6c7-596">As máquinas virtuais registram automaticamente seu nome DNS na inicialização ou quando há uma alteração no nome.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-596">VMs register their DNS name automatically on startup or when there is a name change.</span></span>

<span data-ttu-id="ed6c7-597">Para saber mais sobre este exemplo e outro exemplo que mostra como provisionar a primeira VM e instalar o AD DS, confira [Instalar uma nova floresta do Active Directory no Microsoft Azure](active-directory-new-forest-virtual-machine.md).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-597">For more information about this example and another example that shows how to provision the first VM and install AD DS on it, see [Install a new Active Directory forest on Microsoft Azure](active-directory-new-forest-virtual-machine.md).</span></span> <span data-ttu-id="ed6c7-598">Para saber mais sobre como usar o Windows PowerShell, confira [Instalar o Azure PowerShell](/powershell/azureps-cmdlets-docs) e [Cmdlets de gerenciamento do Azure](/powershell/module/azurerm.compute/#virtual_machines).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-598">For more information about using Windows PowerShell, see [Install Azure PowerShell](/powershell/azureps-cmdlets-docs) and [Azure Management Cmdlets](/powershell/module/azurerm.compute/#virtual_machines).</span></span>

### <span data-ttu-id="ed6c7-599"><a name="BKMK_DistributedDCs"></a>Controladores de domínio distribuídos geograficamente</span><span class="sxs-lookup"><span data-stu-id="ed6c7-599"><a name="BKMK_DistributedDCs"></a>Geo-distributed DCs</span></span>
<span data-ttu-id="ed6c7-600">O Azure oferece vantagens ao hospedar vários controladores de domínio em redes virtuais diferentes:</span><span class="sxs-lookup"><span data-stu-id="ed6c7-600">Azure offers advantages when hosting multiple DCs on different virtual networks:</span></span>

* <span data-ttu-id="ed6c7-601">Tolerância a falhas de vários sites</span><span class="sxs-lookup"><span data-stu-id="ed6c7-601">Multi-site fault-tolerance</span></span>
* <span data-ttu-id="ed6c7-602">Proximidade física a ramificações (latência mais baixa)</span><span class="sxs-lookup"><span data-stu-id="ed6c7-602">Physical proximity to branch offices (lower latency)</span></span>

<span data-ttu-id="ed6c7-603">Para obter informações sobre como configurar a comunicação direta entre redes virtuais, confira [Configurar rede virtual para conectividade de rede virtual](../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-603">For information about configuring direct communication between virtual networks, see [Configure virtual network to virtual network connectivity](../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md).</span></span>

### <span data-ttu-id="ed6c7-604"><a name="BKMK_RODC"></a>Controladores de domínio somente leitura</span><span class="sxs-lookup"><span data-stu-id="ed6c7-604"><a name="BKMK_RODC"></a>Read-only DCs</span></span>
<span data-ttu-id="ed6c7-605">Você precisa optar entre implantar controladores de domínio somente leitura ou graváveis.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-605">You need to choose whether to deploy read-only or writeable DCs.</span></span> <span data-ttu-id="ed6c7-606">Talvez você queira implantar RODCs porque não terá controle físico sobre eles, mas os RODCs são projetados para serem implantados nos locais onde a segurança física está em risco, como nas filiais.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-606">You might be inclined to deploy RODCs because you will not have physical control over them, but RODCs are designed to be deployed in locations where their physical security is at risk, such as branch offices.</span></span>

<span data-ttu-id="ed6c7-607">O Azure não apresenta o risco de segurança física de uma filial, mas os RODCs podem ser ainda mais econômicos porque os recursos que eles fornecem são apropriados para esses ambientes, mas por razões muito diferentes.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-607">Azure does not present the physical security risk of a branch office, but RODCs might still prove to be more cost effective because the features they provide are well-suited to these environments albeit for very different reasons.</span></span> <span data-ttu-id="ed6c7-608">Por exemplo, os RODCs não têm replicações de saída e podem preencher segredos (senhas) de forma seletiva.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-608">For example, RODCs have no outbound replication and are able to selectively populate secrets (passwords).</span></span> <span data-ttu-id="ed6c7-609">Por outro lado, a falta desses segredos pode exigir que o tráfego de saída sob demanda valide-os como um usuário ou o computador autentica.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-609">On the downside, the lack of these secrets might require on-demand outbound traffic to validate them as a user or computer authenticates.</span></span> <span data-ttu-id="ed6c7-610">Mas os segredos podem ser seletivamente preenchidos previamente e armazenados em cache.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-610">But secrets can be selectively prepopulated and cached.</span></span>

<span data-ttu-id="ed6c7-611">Os RODCs fornecem uma vantagem adicional em relação a questões de HBI e PII porque você pode adicionar atributos que contêm dados confidenciais ao FAS (conjunto de atributos filtrados) do RODC.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-611">RODCs provide an additional advantage in and around HBI and PII concerns because you can add attributes that contain sensitive data to the RODC filtered attribute set (FAS).</span></span> <span data-ttu-id="ed6c7-612">O FAS é um conjunto de atributos personalizáveis que não são replicados para RODCs.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-612">The FAS is a customizable set of attributes that are not replicated to RODCs.</span></span> <span data-ttu-id="ed6c7-613">Você pode usar o FAS como proteção caso não possa ou não deseje armazenar o PII ou HBI no Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-613">You can use the FAS as a safeguard in case you are not permitted or do not want to store PII or HBI on Azure.</span></span> <span data-ttu-id="ed6c7-614">Para saber mais, confira [conjunto de atributos filtrados do RODC[(https://technet.microsoft.com/library/cc753459)]</span><span class="sxs-lookup"><span data-stu-id="ed6c7-614">For more information, see [RODC filtered attribute set[(https://technet.microsoft.com/library/cc753459)].</span></span>

<span data-ttu-id="ed6c7-615">Verifique se os aplicativos serão compatíveis com os RODCs que você planeja usar.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-615">Make sure that applications will be compatible with RODCs you plan to use.</span></span> <span data-ttu-id="ed6c7-616">Muitos aplicativos habilitados para o Active Directory do Windows Server funcionam bem com RODCs, mas alguns aplicativos poderão ser executados de maneira ineficiente ou falhar se não tiverem acesso a um controlador de domínio gravável.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-616">Many Windows Server Active Directory-enabled applications work well with RODCs, but some applications can perform inefficiently or fail if they do not have access to a writable DC.</span></span> <span data-ttu-id="ed6c7-617">Para saber mais, confira [Guia de compatibilidade de aplicativos de controladores de domínio somente leitura](https://technet.microsoft.com/library/cc755190).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-617">For more information, see [Read-Only DCs application compatibility guide](https://technet.microsoft.com/library/cc755190).</span></span>

### <span data-ttu-id="ed6c7-618"><a name="BKMK_GC"></a>Catálogo global</span><span class="sxs-lookup"><span data-stu-id="ed6c7-618"><a name="BKMK_GC"></a>Global catalog</span></span>
<span data-ttu-id="ed6c7-619">Você precisa escolher se deseja instalar um CG (catálogo global).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-619">You need to choose whether to install a global catalog (GC).</span></span> <span data-ttu-id="ed6c7-620">Em uma floresta de domínio único, você deve configurar todos os controladores de domínio como servidores de catálogo global.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-620">In a single domain forest, you should configure all DCs as global catalog servers.</span></span> <span data-ttu-id="ed6c7-621">Ele não aumentará o custo porque não haverá tráfego de replicação adicional.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-621">It will not increase costs because there will be no additional replication traffic.</span></span>

<span data-ttu-id="ed6c7-622">Em uma floresta de vários domínios, os CGs são necessários para expandir as associações ao Grupo Universal durante o processo de autenticação.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-622">In a multidomain forest, GCs are necessary to expand Universal Group memberships during the authentication process.</span></span> <span data-ttu-id="ed6c7-623">Se você não implantar um CG, as cargas de trabalho na rede virtual que autentica em um controlador de domínio no Azure gerarão tráfego de autenticação de saída indiretamente para consultar CGs locais durante cada tentativa de autenticação.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-623">If you do not deploy a GC, workloads on the virtual network that authenticate against a DC on Azure will indirectly generate outbound authentication traffic to query GCs on-premises during each authentication attempt.</span></span>

<span data-ttu-id="ed6c7-624">Os custos associados aos CGs serão menos previsíveis porque eles hospedam todos os domínios (parcialmente).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-624">The costs associated with GCs are less-predictable because they host every domain (in-part).</span></span> <span data-ttu-id="ed6c7-625">Se a carga de trabalho hospeda um serviço de acesso à Internet e autentica usuários no AD DS do Windows Server, os custos podem ser completamente imprevisíveis.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-625">If the workload hosts an Internet-facing service and authenticates users against Windows Server AD DS, the costs could be completely unpredictable.</span></span> <span data-ttu-id="ed6c7-626">Para ajudar a reduzir as consultas de GC fora do site de nuvem durante a autenticação, você pode [habilitar o Cache de Associação ao Grupo Universal](https://technet.microsoft.com/library/cc816928).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-626">To help reduce GC queries outside of the cloud site during authentication, you can [enable Universal Group Membership Caching](https://technet.microsoft.com/library/cc816928).</span></span>

### <span data-ttu-id="ed6c7-627"><a name="BKMK_InstallMethod"></a>Método de instalação</span><span class="sxs-lookup"><span data-stu-id="ed6c7-627"><a name="BKMK_InstallMethod"></a>Installation method</span></span>
<span data-ttu-id="ed6c7-628">Você precisa escolher como instalar os controladores de domínio na rede virtual:</span><span class="sxs-lookup"><span data-stu-id="ed6c7-628">You need to choose how to install the DCs on the virtual network:</span></span>

* <span data-ttu-id="ed6c7-629">Promova novos controladores de domínio.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-629">Promote new DCs.</span></span> <span data-ttu-id="ed6c7-630">Para saber mais, confira [Instalar uma nova floresta do Active Directory em uma rede virtual do Azure](active-directory-new-forest-virtual-machine.md).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-630">For more information, see [Install a new Active Directory forest on an Azure virtual network](active-directory-new-forest-virtual-machine.md).</span></span>
* <span data-ttu-id="ed6c7-631">Mova o VHD de um controlador de domínio virtual local para a nuvem.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-631">Move the VHD of an on-premises virtual DC to the cloud.</span></span> <span data-ttu-id="ed6c7-632">Nesse caso, você deve garantir que o controlador de domínio virtual local foi "movido", e não "copiado" ou "clonado".</span><span class="sxs-lookup"><span data-stu-id="ed6c7-632">In this case, you must ensure that the on-premises virtual DC is “moved,” not “copied” or “cloned.”</span></span>

<span data-ttu-id="ed6c7-633">Use somente máquinas virtuais do Azure para controladores de domínio (em vez das VMs de função "Web" ou "trabalho" do Azure).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-633">Use only Azure virtual machines for DCs (as opposed to Azure “web” or “worker” role VMs).</span></span> <span data-ttu-id="ed6c7-634">Elas são duráveis e é necessário ter durabilidade de estado para um controlador de domínio.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-634">They are durable and durability of state for a DC is required.</span></span> <span data-ttu-id="ed6c7-635">As máquinas virtuais do Azure são projetadas para cargas de trabalho como controladores de domínio.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-635">Azure virtual machines are designed for workloads such as DCs.</span></span>

<span data-ttu-id="ed6c7-636">Não use SYSPREP para implantar ou clonar controladores de domínio.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-636">Do not use SYSPREP to deploy or clone DCs.</span></span> <span data-ttu-id="ed6c7-637">A capacidade de clonar controladores de domínio está disponível somente a partir do Windows Server 2012.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-637">The ability to clone DCs is only available beginning in Windows Server 2012.</span></span> <span data-ttu-id="ed6c7-638">O recurso de clonagem exige suporte para VMGenerationID no hipervisor subjacente.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-638">The cloning feature requires support for VMGenerationID in the underlying hypervisor.</span></span> <span data-ttu-id="ed6c7-639">O Hyper-V no Windows Server 2012 e as redes virtuais do Azure dão suporte a VMGenerationID, como fornecedores de software de virtualização de terceiros.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-639">Hyper-V in Windows Server 2012 and Azure virtual networks both support VMGenerationID, as do third-party virtualization software vendors.</span></span>

### <span data-ttu-id="ed6c7-640"><a name="BKMK_PlaceDB"></a>Posicionamento do SYSVOL e do banco de dados do AD DS do Windows Server</span><span class="sxs-lookup"><span data-stu-id="ed6c7-640"><a name="BKMK_PlaceDB"></a>Placement of the Windows Server AD DS database and SYSVOL</span></span>
<span data-ttu-id="ed6c7-641">Escolha onde localizar o banco de dados, logs e SYSVOL do AD DS do Windows Server.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-641">Select where to locate the Windows Server AD DS database, logs, and SYSVOL.</span></span> <span data-ttu-id="ed6c7-642">Eles devem ser implantados em discos de dados do Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-642">They must be deployed on Azure Data disks.</span></span>

> [!NOTE]
> <span data-ttu-id="ed6c7-643">Os discos de dados do Azure são restritos a 1 TB.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-643">Azure Data disks are constrained to 1 TB.</span></span>
> 
> 

<span data-ttu-id="ed6c7-644">Por padrão, as unidades de disco de dados não fazem gravações em cache.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-644">Data disk drives do not cache writes by default.</span></span> <span data-ttu-id="ed6c7-645">As unidades de disco de dados que estão anexadas a uma máquina virtual usam cache de gravação.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-645">Data disk drives that are attached to a VM use write-through caching.</span></span> <span data-ttu-id="ed6c7-646">A gravação por cache faz com que a gravação seja enviada ao armazenamento durável do Azure antes que a transação seja concluída a partir da perspectiva do sistema operacional da VM.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-646">Write-through caching makes sure the write is committed to durable Azure storage before the transaction is complete from the perspective of the VM’s operating system.</span></span> <span data-ttu-id="ed6c7-647">Ela fornece durabilidade às custas de gravações um pouco mais lentas.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-647">It provides durability, at the expense of slightly slower writes.</span></span>

<span data-ttu-id="ed6c7-648">Isso é importante para o AD DS do Windows Server porque o cache de disco de gravação temporária invalida as suposições feitas pelo controlador de domínio.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-648">This is important for Windows Server AD DS because write-behind disk-caching invalidates assumptions made by the DC.</span></span> <span data-ttu-id="ed6c7-649">O AD DS do Windows Server tenta desabilitar o cache de gravação, mas cabe ao disco de sistema de E/S fazer isso.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-649">Windows Server AD DS attempts to disable write caching but it is up to the disk IO system to honor it.</span></span> <span data-ttu-id="ed6c7-650">A falha ao desabilitar o cache de gravação pode, em determinadas circunstâncias, introduzir a reversão do USN, resultando em objetos persistentes e outros problemas.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-650">Failure to disable write caching may, under certain circumstances, introduce USN rollback resulting in lingering objects and other problems.</span></span>

<span data-ttu-id="ed6c7-651">Como prática recomendada para controladores de domínio virtuais, faça o seguinte:</span><span class="sxs-lookup"><span data-stu-id="ed6c7-651">As a best practice for virtual DCs, do the following:</span></span>

* <span data-ttu-id="ed6c7-652">Defina a configuração de Preferência de Cache do Host no disco de dados do Azure para NONE.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-652">Set the Host Cache Preference setting on the Azure data disk for NONE.</span></span> <span data-ttu-id="ed6c7-653">Isso evita problemas com o cache de gravação para operações do AD DS.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-653">This prevents issues with write caching for AD DS operations.</span></span>
* <span data-ttu-id="ed6c7-654">Armazene banco de dados, logs e SYSVOL no mesmo disco de dados ou em discos de dados separados.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-654">Store the database, logs, and SYSVOL on the either same data disk or separate data disks.</span></span> <span data-ttu-id="ed6c7-655">Normalmente, isso é um disco separado do disco usado para o próprio sistema operacional.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-655">Typically, this is a separate disk from the disk used for the operating system itself.</span></span> <span data-ttu-id="ed6c7-656">A principal vantagem é que o SYSVOL e o banco de dados do AD DS do Windows Server não devem ser armazenados em um tipo de disco do Sistema Operacional do Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-656">The key takeaway is that the Windows Server AD DS database and SYSVOL must not be stored on an Azure Operating System disk type.</span></span> <span data-ttu-id="ed6c7-657">Por padrão, o processo de instalação do AD DS instala esses componentes na pasta %systemroot%, que NÃO é recomendável para o Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-657">By default, the AD DS installation process installs these components in %systemroot% folder, which is NOT recommended for Azure.</span></span>

### <span data-ttu-id="ed6c7-658"><a name="BKMK_BUR"></a>Backup e restauração</span><span class="sxs-lookup"><span data-stu-id="ed6c7-658"><a name="BKMK_BUR"></a>Backup and restore</span></span>
<span data-ttu-id="ed6c7-659">Lembre-se do que tem ou não suporte para backup e restauração de um controlador de domínio em geral e, mais especificamente, aqueles em execução em uma VM.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-659">Be aware of what is and is not supported for backup and restore of a DC in general, and more specifically, those running in a VM.</span></span> <span data-ttu-id="ed6c7-660">Confira [Considerações de Backup e Restauração para Controladores de Domínio Virtualizados](https://technet.microsoft.com/library/virtual_active_directory_domain_controller_virtualization_hyperv#backup_and_restore_considerations_for_virtualized_domain_controllers).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-660">See [Backup and Restore Considerations for Virtualized DCs](https://technet.microsoft.com/library/virtual_active_directory_domain_controller_virtualization_hyperv#backup_and_restore_considerations_for_virtualized_domain_controllers).</span></span>

<span data-ttu-id="ed6c7-661">Crie backups do estado de sistema usando apenas o software de backup que está especificamente ciente dos requisitos de backup do AD DS do Windows Server, como o Backup do Windows Server.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-661">Create system state backups by using only backup software that is specifically aware of backup requirements for Windows Server AD DS, such as Windows Server Backup.</span></span>

<span data-ttu-id="ed6c7-662">Não copie nem clone arquivos VHD de controladores de domínio em vez de executar backups regulares.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-662">Do not copy or clone VHD files of DCs instead of performing regular backups.</span></span> <span data-ttu-id="ed6c7-663">Se houver a necessidade de restauração, faça-a usando VHDs clonados ou copiados sem o Windows Server 2012 e um hipervisor com suporte introduzirá bolhas de USN.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-663">Should a restore ever be required, doing so using cloned or copied VHDs without Windows Server 2012 and a supported hypervisor will introduce USN bubbles.</span></span>

### <span data-ttu-id="ed6c7-664"><a name="BKMK_FedSrvConfig"></a>Configuração do servidor de federação</span><span class="sxs-lookup"><span data-stu-id="ed6c7-664"><a name="BKMK_FedSrvConfig"></a>Federation server configuration</span></span>
<span data-ttu-id="ed6c7-665">A configuração dos STSs (servidores de federação do AD FS do Windows Server) depende em parte da necessidade ou não dos aplicativos que você deseja implantar no Azure acessarem recursos em sua rede local.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-665">The configuration of Windows Server AD FS federation servers (STSs) depends in part on whether the applications that you want to deploy on Azure need to access resources on your on-premises network.</span></span>

<span data-ttu-id="ed6c7-666">Se os aplicativos atendem aos critérios a seguir, você pode implantar os aplicativos isoladamente a partir de sua rede local.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-666">If the applications meet the following criteria, you could deploy the applications in isolation from your on-premises network.</span></span>

* <span data-ttu-id="ed6c7-667">Eles aceitam tokens de segurança SAML</span><span class="sxs-lookup"><span data-stu-id="ed6c7-667">They accept SAML security tokens</span></span>
* <span data-ttu-id="ed6c7-668">Eles ficam expostos à Internet</span><span class="sxs-lookup"><span data-stu-id="ed6c7-668">They are exposable to the Internet</span></span>
* <span data-ttu-id="ed6c7-669">Eles não acessam recursos locais</span><span class="sxs-lookup"><span data-stu-id="ed6c7-669">They do not access on-premises resources</span></span>

<span data-ttu-id="ed6c7-670">Nesse caso, configure os STSs do AD FS do Windows Server da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="ed6c7-670">In this case, configure Windows Server AD FS STSs as follows:</span></span>

1. <span data-ttu-id="ed6c7-671">Configure uma floresta isolada de domínio único no Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-671">Configure an isolated single-domain forest on Azure.</span></span>
2. <span data-ttu-id="ed6c7-672">Forneça acesso federado à floresta configurando um farm de servidores de federação do AD FS do Windows Server.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-672">Provide federated access to the forest by configuring a Windows Server AD FS federation server farm.</span></span>
3. <span data-ttu-id="ed6c7-673">Configure o AD FS do Windows Server (farm de servidores de federação e farm de proxy do servidor de federação) na floresta local.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-673">Configure Windows Server AD FS (federation server farm and federation server proxy farm) in the on-premises forest.</span></span>
4. <span data-ttu-id="ed6c7-674">Estabeleça uma relação de confiança de federação entre as instâncias locais e as do Azure do AD FS do Windows Server.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-674">Establish a federation trust relationship between the on-premises and Azure instances of Windows Server AD FS.</span></span>

<span data-ttu-id="ed6c7-675">Por outro lado, se os aplicativos precisarem acessar recursos locais, você poderia configurar o AD FS do Windows Server com o aplicativo no Azure da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="ed6c7-675">On the other hand, if the applications require access to on-premises resources, you could configure Windows Server AD FS with the application on Azure as follows:</span></span>

1. <span data-ttu-id="ed6c7-676">Configure a conectividade entre redes locais e o Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-676">Configure connectivity between on-premises networks and Azure.</span></span>
2. <span data-ttu-id="ed6c7-677">Configure um farm de servidores de federação do AD FS do Windows Server na floresta local.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-677">Configure a Windows Server AD FS federation server farm in the on-premises forest.</span></span>
3. <span data-ttu-id="ed6c7-678">Configure um farm de proxy de servidor de federação do AD FS do Windows Server no Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-678">Configure a Windows Server AD FS federation server proxy farm on Azure.</span></span>

<span data-ttu-id="ed6c7-679">Essa configuração tem a vantagem de reduzir a exposição de recursos locais, semelhante à configuração do AD FS do Windows Server com aplicativos em uma rede de perímetro.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-679">This configuration has the advantage of reducing the exposure of on-premises resources, similar to configuring Windows Server AD FS with applications in a perimeter network.</span></span>

<span data-ttu-id="ed6c7-680">Observe que, em qualquer cenário, você pode estabelecer relações de confiança com mais provedores de identidade se houver necessidade de colaboração entre empresas.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-680">Note that in either scenario, you can establish trusts relationships with more identity providers, if business-to-business collaboration is needed.</span></span>

### <span data-ttu-id="ed6c7-681"><a name="BKMK_CloudSvcConfig"></a>Configuração de serviços de nuvem</span><span class="sxs-lookup"><span data-stu-id="ed6c7-681"><a name="BKMK_CloudSvcConfig"></a>Cloud services configuration</span></span>
<span data-ttu-id="ed6c7-682">Os serviços de nuvem são necessários se você quer expor uma VM diretamente na Internet ou expor um aplicativo de balanceamento de carga na Internet.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-682">Cloud services are necessary if you want to expose a VM directly to the Internet or to expose an Internet-facing load-balanced application.</span></span> <span data-ttu-id="ed6c7-683">Isso é possível porque cada serviço de nuvem oferece um único endereço IP virtual configurável.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-683">This is possible because each cloud service offers a single configurable virtual IP address.</span></span>

### <span data-ttu-id="ed6c7-684"><a name="BKMK_FedReqVIPDIP"></a>Requisitos do servidor de federação para endereçamento IP público e privado (IP dinâmico versus IP virtual)</span><span class="sxs-lookup"><span data-stu-id="ed6c7-684"><a name="BKMK_FedReqVIPDIP"></a>Federation server requirements for public and private IP addressing (dynamic IP vs. virtual IP)</span></span>
<span data-ttu-id="ed6c7-685">Cada máquina virtual do Azure recebe um endereço IP dinâmico.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-685">Each Azure virtual machine receives a dynamic IP address.</span></span> <span data-ttu-id="ed6c7-686">Um endereço IP dinâmico é um endereço privado que só pode ser acessado dentro do Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-686">A dynamic IP address is a private address accessible only within Azure.</span></span> <span data-ttu-id="ed6c7-687">Na maioria dos casos, no entanto, será necessário configurar um endereço IP virtual para suas implantações do AD FS do Windows Server.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-687">In most cases, however, it will be necessary to configure a virtual IP address for your Windows Server AD FS deployments.</span></span> <span data-ttu-id="ed6c7-688">O IP virtual é necessário para expor pontos de extremidade do AD FS do Windows Server na Internet e será usado por clientes e parceiros federados para autenticação e gerenciamento contínuo.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-688">The virtual IP is necessary to expose Windows Server AD FS endpoints to the Internet, and will be used by federated partners and clients for authentication and ongoing management.</span></span> <span data-ttu-id="ed6c7-689">Um endereço IP virtual é uma propriedade de um serviço de nuvem que contém uma ou mais máquinas virtuais do Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-689">A virtual IP address is a property of a cloud service which contains one or more Azure virtual machines.</span></span> <span data-ttu-id="ed6c7-690">Se os aplicativos com reconhecimento de declaração implantados no Azure e no AD FS do Windows Server estiverem voltados para a Internet e compartilharem portas comuns, cada um exigirá um endereço IP virtual próprio e, portanto, será necessário criar um serviço de nuvem para o aplicativo e um segundo para o AD FS do Windows Server.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-690">If the claims-aware application deployed on Azure and Windows Server AD FS are both Internet-facing and share common ports, each will require a virtual IP address of its own and it will therefore be necessary to create one cloud service for the application and a second for Windows Server AD FS.</span></span>

<span data-ttu-id="ed6c7-691">Para obter definições dos termos endereço IP virtual e endereço IP dinâmico, confira [Termos e definições](#BKMK_Glossary).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-691">For definitions of the terms virtual IP address and dynamic IP address, see [Terms and definitions](#BKMK_Glossary).</span></span>

### <span data-ttu-id="ed6c7-692"><a name="BKMK_ADFSHighAvail"></a>Configuração de alta disponibilidade do AD FS do Windows Server</span><span class="sxs-lookup"><span data-stu-id="ed6c7-692"><a name="BKMK_ADFSHighAvail"></a>Windows Server AD FS high availability configuration</span></span>
<span data-ttu-id="ed6c7-693">Embora seja possível implantar serviços de federação AD FS do Windows Server autônomos, é recomendável implantar um farm com pelo menos dois nós para STS do AD FS e proxies para ambientes de produção.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-693">While it is possible to deploy standalone Windows Server AD FS federation services, it is recommended to deploy a farm with at least two nodes for both AD FS STS and proxies for production environments.</span></span>

<span data-ttu-id="ed6c7-694">Confira [Considerações de topologia da implantação do AD FS 2.0](https://technet.microsoft.com/library/gg982489) no [Guia de Design do AD FS 2.0](https://technet.microsoft.com/library/dd807036) para decidir quais opções de configuração de implantação atendem melhor às suas necessidades específicas.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-694">See [AD FS 2.0 deployment topology considerations](https://technet.microsoft.com/library/gg982489) in the [AD FS 2.0 Design Guide](https://technet.microsoft.com/library/dd807036) to decide which deployment configuration options best suit your particular needs.</span></span>

> [!NOTE]
> <span data-ttu-id="ed6c7-695">Para obter o balanceamento de carga para pontos de extremidade do AD FS do Windows Server no Azure, configure todos os membros do farm do AD FS do Windows Server no mesmo serviço de nuvem e use o recurso de balanceamento de carga do Azure para HTTP (padrão 80) e portas HTTPS (padrão 443).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-695">In order to get load balancing for Windows Server AD FS endpoints on Azure, configure all members of the Windows Server AD FS farm in the same cloud service, and use the load balancing capability of Azure for HTTP (default 80) and HTTPS ports (default 443).</span></span> <span data-ttu-id="ed6c7-696">Para saber mais, confira [Investigação do balanceador de carga do Azure](https://msdn.microsoft.com/library/azure/jj151530).</span><span class="sxs-lookup"><span data-stu-id="ed6c7-696">For more information, see [Azure load-balancer probe](https://msdn.microsoft.com/library/azure/jj151530).</span></span>
> <span data-ttu-id="ed6c7-697">Não há suporte para o NLB (balanceamento de carga de rede) do Windows Server no Azure.</span><span class="sxs-lookup"><span data-stu-id="ed6c7-697">Windows Server Network Load Balancing (NLB) is not supported on Azure.</span></span>
> 
> 

