---
title: "Criptografar uma máquina virtual do Azure | Microsoft Docs"
description: "Este documento ajudará você a criptografar uma Máquina Virtual do Azure depois de receber um alerta da Central de Segurança do Azure."
services: security, security-center
documentationcenter: na
author: TomShinder
manager: swadhwa
editor: 
ms.assetid: f6c28bc4-1f79-4352-89d0-03659b2fa2f5
ms.service: security
ms.devlang: na
ms.topic: hero-article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 03/15/2017
ms.author: tomsh
ms.openlocfilehash: 8d39aafb0ab7b0e87afdf4d2f50f1e224b8d251f
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="encrypt-an-azure-virtual-machine"></a><span data-ttu-id="16d26-103">Criptografar uma Máquina Virtual do Azure</span><span class="sxs-lookup"><span data-stu-id="16d26-103">Encrypt an Azure Virtual Machine</span></span>
<span data-ttu-id="16d26-104">A Central de Segurança do Azure alertará você se houver máquinas virtuais que não estejam criptografadas.</span><span class="sxs-lookup"><span data-stu-id="16d26-104">Azure Security Center will alert you if you have virtual machines that are not encrypted.</span></span> <span data-ttu-id="16d26-105">Esses alertas serão mostrados como Alta Severidade e a recomendação é criptografar essas máquinas virtuais.</span><span class="sxs-lookup"><span data-stu-id="16d26-105">These alerts will show as High Severity and the recommendation is to encrypt these virtual machines.</span></span>

![Recomendação de criptografia de disco](./media/security-center-disk-encryption/security-center-disk-encryption-fig1.png)

> [!NOTE]
> <span data-ttu-id="16d26-107">As informações neste documento se aplicam à criptografia de máquinas virtuais sem usar uma Chave de Criptografia de Chave (que é necessária para fazer backup de máquinas virtuais usando o Backup do Azure).</span><span class="sxs-lookup"><span data-stu-id="16d26-107">The information in this document applies to encrypting virtual machines without using a Key Encryption Key (which is required for backing up virtual machines using Azure Backup).</span></span> <span data-ttu-id="16d26-108">Confira o artigo [Azure Disk Encryption para máquinas virtuais do Azure do Windows e do Linux](https://docs.microsoft.com/en-us/azure/security/azure-security-disk-encryption) para obter informações sobre como usar uma Chave de Criptografia de Chave para dar suporte ao Backup do Azure para Máquinas Virtuais do Azure criptografadas.</span><span class="sxs-lookup"><span data-stu-id="16d26-108">Please see the article [Azure Disk Encryption for Windows and Linux Azure Virtual Machines](https://docs.microsoft.com/en-us/azure/security/azure-security-disk-encryption) for information on how to use a Key Encryption Key to support Azure Backup for encrypted Azure Virtual Machines.</span></span>
>
>

<span data-ttu-id="16d26-109">Para criptografar as Máquinas Virtuais do Azure identificadas pela Central de Segurança do Azure como precisando de criptografia, recomendamos as seguintes etapas:</span><span class="sxs-lookup"><span data-stu-id="16d26-109">To encrypt Azure Virtual Machines that have been identified by Azure Security Center as needing encryption, we recommend the following steps:</span></span>

* <span data-ttu-id="16d26-110">Instalar e configurar o PowerShell do Azure.</span><span class="sxs-lookup"><span data-stu-id="16d26-110">Install and configure Azure PowerShell.</span></span> <span data-ttu-id="16d26-111">Isso permitirá que você execute os comandos do PowerShell necessários para a configuração dos pré-requisitos exigidos para criptografar as Máquinas Virtuais do Azure.</span><span class="sxs-lookup"><span data-stu-id="16d26-111">This will enable you to run the PowerShell commands required to set up the prerequisites required to encrypt Azure Virtual Machines.</span></span>
* <span data-ttu-id="16d26-112">Obter e executar o script Pré-requisitos de Azure Disk Encryption do Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="16d26-112">Obtain and run the Azure Disk Encryption Prerequisites Azure PowerShell script</span></span>
* <span data-ttu-id="16d26-113">Criptografar suas máquinas virtuais</span><span class="sxs-lookup"><span data-stu-id="16d26-113">Encrypt your virtual machines</span></span>

<span data-ttu-id="16d26-114">O objetivo deste documento é permitir que você criptografe suas máquinas virtuais, mesmo se tiver pouca ou nenhuma experiência com o Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="16d26-114">The goal of this document is to enable you to encrypt your virtual machines, even if you have little or no background in Azure PowerShell.</span></span>
<span data-ttu-id="16d26-115">Este documento presume que você esteja usando o Windows 10 como o computador cliente do qual configurará a Azure Disk Encryption.</span><span class="sxs-lookup"><span data-stu-id="16d26-115">This document assumes you are using Windows 10 as the client machine from which you will configure Azure Disk Encryption.</span></span>

<span data-ttu-id="16d26-116">Há várias abordagens que podem ser usadas para configurar os pré-requisitos e para configurar a criptografia para Máquinas Virtuais do Azure.</span><span class="sxs-lookup"><span data-stu-id="16d26-116">There are many approaches that can be used to setup the prerequisites and to configure encryption for Azure Virtual Machines.</span></span> <span data-ttu-id="16d26-117">Se você já estiver bem familiarizado com o Azure PowerShell ou a CLI do Azure, poderá preferir usar abordagens alternativas.</span><span class="sxs-lookup"><span data-stu-id="16d26-117">If you are already well-versed in Azure PowerShell or Azure CLI, then you may prefer to use alternate approaches.</span></span>

> [!NOTE]
> <span data-ttu-id="16d26-118">Para saber mais sobre as abordagens alternativas para configurar a criptografia para as máquinas virtuais do Azure, confira [Azure Disk Encryption para Máquinas Virtuais do Azure do Windows e do Linux](https://gallery.technet.microsoft.com/Azure-Disk-Encryption-for-a0018eb0).</span><span class="sxs-lookup"><span data-stu-id="16d26-118">To learn more about alternate approaches to configuring encryption for Azure virtual machines, please see [Azure Disk Encryption for Windows and Linux Azure Virtual Machines](https://gallery.technet.microsoft.com/Azure-Disk-Encryption-for-a0018eb0).</span></span>
>
>

## <a name="install-and-configure-azure-powershell"></a><span data-ttu-id="16d26-119">Instalar e configurar o PowerShell do Azure</span><span class="sxs-lookup"><span data-stu-id="16d26-119">Install and configure Azure PowerShell</span></span>
<span data-ttu-id="16d26-120">Você precisa do Azure PowerShell versão 1.2.1, ou superior, instalado no computador.</span><span class="sxs-lookup"><span data-stu-id="16d26-120">You need Azure PowerShell version 1.2.1 or above installed on your computer.</span></span> <span data-ttu-id="16d26-121">O artigo [Como instalar e configurar o Azure PowerShell](/powershell/azure/overview) contém todas as etapas necessárias para provisionar o computador para trabalhar com o Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="16d26-121">The article [How to install and configure Azure PowerShell](/powershell/azure/overview) contains all the steps you need to provision your computer to work with Azure PowerShell.</span></span> <span data-ttu-id="16d26-122">A abordagem mais simples é usar a abordagem de instalação do Web PI mencionado no artigo.</span><span class="sxs-lookup"><span data-stu-id="16d26-122">The most straightforward approach is to use the Web PI installation approach mentioned in that article.</span></span> <span data-ttu-id="16d26-123">Mesmo que você já tenha instalado o Azure PowerShell, instale novamente usando a abordagem do Web PI para que você tenha a versão mais recente do PowerShell do Azure.</span><span class="sxs-lookup"><span data-stu-id="16d26-123">Even if you already have Azure PowerShell installed, install again using the Web PI approach so that you have the latest version of Azure PowerShell.</span></span>

## <a name="obtain-and-run-the-azure-disk-encryption-prerequisites-configuration-script"></a><span data-ttu-id="16d26-124">Obtenha e execute o script de configuração de pré-requisitos de criptografia de disco do Azure.</span><span class="sxs-lookup"><span data-stu-id="16d26-124">Obtain and run the Azure disk encryption prerequisites configuration script</span></span>
<span data-ttu-id="16d26-125">O Script de Configuração de Pré-requisitos de Azure Disk Encryption configurará todos os pré-requisitos necessários para a criptografia de suas Máquinas Virtuais do Azure.</span><span class="sxs-lookup"><span data-stu-id="16d26-125">The Azure Disk Encryption Prerequisites Configuration Script will set up all the prerequisites required for encrypting your Azure Virtual Machines.</span></span>

1. <span data-ttu-id="16d26-126">Acesse a página do GitHub com o [Script de Configuração de Pré-requisito de Azure Disk Encryption](https://github.com/Azure/azure-powershell/blob/master/src/ResourceManager/Compute/Commands.Compute/Extension/AzureDiskEncryption/Scripts/AzureDiskEncryptionPreRequisiteSetup.ps1).</span><span class="sxs-lookup"><span data-stu-id="16d26-126">Go to the GitHub page that has the [Azure Disk Encryption Prerequisite Setup Script](https://github.com/Azure/azure-powershell/blob/master/src/ResourceManager/Compute/Commands.Compute/Extension/AzureDiskEncryption/Scripts/AzureDiskEncryptionPreRequisiteSetup.ps1).</span></span>
2. <span data-ttu-id="16d26-127">Na página do GitHub, clique no botão **Bruto** .</span><span class="sxs-lookup"><span data-stu-id="16d26-127">On the GibHub page, click the **Raw** button.</span></span>
3. <span data-ttu-id="16d26-128">Use **CTRL-A** para selecionar todo o texto na página e use **CTRL-C** para copiar todo o texto da página para a área de transferência.</span><span class="sxs-lookup"><span data-stu-id="16d26-128">Use **CTRL-A** to select all the text on the page and then use **CTRL-C** to copy all the text on the page to the clipboard.</span></span>
4. <span data-ttu-id="16d26-129">Abra o **Bloco de Notas** e cole nele o texto copiado.</span><span class="sxs-lookup"><span data-stu-id="16d26-129">Open **Notepad** and paste the copied text into Notepad.</span></span>
5. <span data-ttu-id="16d26-130">Crie uma nova pasta na unidade C: denominada **AzureADEScript**.</span><span class="sxs-lookup"><span data-stu-id="16d26-130">Create a new folder on your C: drive named **AzureADEScript**.</span></span>
6. <span data-ttu-id="16d26-131">Salve o arquivo do Bloco de Notas. Clique em **Arquivo** e em **Salvar como**.</span><span class="sxs-lookup"><span data-stu-id="16d26-131">Save the Notepad file – click **File**, then click **Save As**.</span></span> <span data-ttu-id="16d26-132">Na caixa Nome do arquivo, digite **"ADEPrereqScript.ps1"** e clique em **Salvar**.</span><span class="sxs-lookup"><span data-stu-id="16d26-132">In the File name textbox, enter **“ADEPrereqScript.ps1”** and click **Save**.</span></span> <span data-ttu-id="16d26-133">(coloque aspas ao redor do nome, caso contrário, ele salvará o arquivo com uma extensão .txt).</span><span class="sxs-lookup"><span data-stu-id="16d26-133">(make sure you put the quotation marks around the name, otherwise it will save the file with a .txt file extension).</span></span>

<span data-ttu-id="16d26-134">Agora que o conteúdo do script está salvo, abra o script no ISE do PowerShell:</span><span class="sxs-lookup"><span data-stu-id="16d26-134">Now that the script content is saved, open the script in the PowerShell ISE:</span></span>

1. <span data-ttu-id="16d26-135">No Menu Iniciar, clique em **Cortana**.</span><span class="sxs-lookup"><span data-stu-id="16d26-135">In the Start Menu, click **Cortana**.</span></span> <span data-ttu-id="16d26-136">Solicite “PowerShell” à **Cortana** digitando **PowerShell** na caixa de texto de pesquisa da Cortana.</span><span class="sxs-lookup"><span data-stu-id="16d26-136">Ask **Cortana** “PowerShell” by typing **PowerShell** in the Cortana search text box.</span></span>
2. <span data-ttu-id="16d26-137">Clique com o botão direito do mouse em **ISE do Windows PowerShell** e clique em **Executar como administrador**.</span><span class="sxs-lookup"><span data-stu-id="16d26-137">Right click **Windows PowerShell ISE** and click **Run as administrator**.</span></span>
3. <span data-ttu-id="16d26-138">Na janela **Administrador: ISE do Windows PowerShell**, clique em **Exibir** e clique em **Mostrar Painel de Script**.</span><span class="sxs-lookup"><span data-stu-id="16d26-138">In the **Administrator: Windows PowerShell ISE** window, click **View** and then click **Show Script Pane**.</span></span>
4. <span data-ttu-id="16d26-139">Se você vir o painel **Comandos** no lado direito da janela, clique no **"x"** no canto superior direito do painel para fechá-lo.</span><span class="sxs-lookup"><span data-stu-id="16d26-139">If you see the **Commands** pane on the right side of the window, click the **“x”** in the top right corner of the pane to close it.</span></span> <span data-ttu-id="16d26-140">Se o texto for muito pequeno para visualização, use **CTRL+Adicionar** ("Adicionar" é o sinal "+").</span><span class="sxs-lookup"><span data-stu-id="16d26-140">If the text is too small for you to see, use **CTRL+Add** (“Add” is the “+” sign).</span></span> <span data-ttu-id="16d26-141">Se o texto for muito grande, use **CTRL+Subtrair** (Subtrair é o sinal "-").</span><span class="sxs-lookup"><span data-stu-id="16d26-141">If the text is too large, use **CTRL+Subtract** (Subtract is the “-“ sign).</span></span>
5. <span data-ttu-id="16d26-142">Clique em **Arquivo** e clique em **Abrir**.</span><span class="sxs-lookup"><span data-stu-id="16d26-142">Click **File** and then click **Open**.</span></span> <span data-ttu-id="16d26-143">Navegue até a pasta **C:\AzureADEScript** e clique duas vezes no **ADEPrereqScript**.</span><span class="sxs-lookup"><span data-stu-id="16d26-143">Navigate to the **C:\AzureADEScript** folder and the double-click on the **ADEPrereqScript**.</span></span>
6. <span data-ttu-id="16d26-144">O conteúdo de **ADEPrereqScript** já deve aparecer no ISE do PowerShell e está codificado por cor para ajudar você a ver diversos componentes, como comandos, parâmetros e variáveis com maior facilidade.</span><span class="sxs-lookup"><span data-stu-id="16d26-144">The **ADEPrereqScript** contents should now appear in the PowerShell ISE and is color-coded to help you see various components, such as commands, parameters and variables more easily.</span></span>

<span data-ttu-id="16d26-145">Agora você verá algo como a figura abaixo.</span><span class="sxs-lookup"><span data-stu-id="16d26-145">You should now see something like the figure below.</span></span>

![Janela do ISE do PowerShell](./media/security-center-disk-encryption/security-center-disk-encryption-fig2.png)

<span data-ttu-id="16d26-147">O painel superior é conhecido como o "painel de script" e o painel inferior é conhecido como "console".</span><span class="sxs-lookup"><span data-stu-id="16d26-147">The top pane is referred to as the “script pane” and the bottom pane is referred to as the “console”.</span></span> <span data-ttu-id="16d26-148">Usaremos esses termos neste artigo.</span><span class="sxs-lookup"><span data-stu-id="16d26-148">We will use these terms later in this article.</span></span>

## <a name="run-the-azure-disk-encryption-prerequisites-powershell-command"></a><span data-ttu-id="16d26-149">Executar o comando do PowerShell de pré-requisitos de criptografia de disco do Azure</span><span class="sxs-lookup"><span data-stu-id="16d26-149">Run the Azure disk encryption prerequisites PowerShell command</span></span>
<span data-ttu-id="16d26-150">O script Pré-requisitos de Azure Disk Encryption solicitará as informações a seguir depois de iniciar o script:</span><span class="sxs-lookup"><span data-stu-id="16d26-150">The Azure Disk Encryption Prerequisites script will ask you for the following information after you start the script:</span></span>

* <span data-ttu-id="16d26-151">**Nome do Grupo de Recursos** - nome do Grupo de Recursos no qual você deseja colocar o Cofre da Chave.</span><span class="sxs-lookup"><span data-stu-id="16d26-151">**Resource Group Name** - Name of the Resource Group that you want to put the Key Vault into.</span></span>  <span data-ttu-id="16d26-152">Um novo Grupo de Recursos com o nome inserido será criado caso ainda não haja um com esse nome.</span><span class="sxs-lookup"><span data-stu-id="16d26-152">A new Resource Group with the name you enter will be created if there isn’t already one with that name created.</span></span> <span data-ttu-id="16d26-153">Se você já tiver um Grupo de Recursos que deseja usar nesta assinatura, insira o nome desse Grupo de Recursos.</span><span class="sxs-lookup"><span data-stu-id="16d26-153">If you already have a Resource Group that you want to use in this subscription, then enter the name of that Resource Group.</span></span>
* <span data-ttu-id="16d26-154">**Nome do Cofre da Chave** - nome do Cofre da Chave no qual as chaves de criptografia devem ser colocadas.</span><span class="sxs-lookup"><span data-stu-id="16d26-154">**Key Vault Name** - Name of the Key Vault in which encryption keys are to be placed.</span></span> <span data-ttu-id="16d26-155">Um novo Cofre da Chave com esse nome será criado caso você ainda não tenha um com esse nome.</span><span class="sxs-lookup"><span data-stu-id="16d26-155">A new Key Vault with this name will be created if you don’t already have a Key Vault with this name.</span></span> <span data-ttu-id="16d26-156">Se você já tiver um Cofre da Chave que deseja usar, insira o nome do cofre existente.</span><span class="sxs-lookup"><span data-stu-id="16d26-156">If you already have a Key Vault that you want to use, enter the name of the existing Key Vault.</span></span>
* <span data-ttu-id="16d26-157">**Local** - o local do Cofre da Chave.</span><span class="sxs-lookup"><span data-stu-id="16d26-157">**Location** - Location of the Key Vault.</span></span> <span data-ttu-id="16d26-158">Verifique se o Cofre da Chave e as VMs a serem criptografados estão no mesmo local.</span><span class="sxs-lookup"><span data-stu-id="16d26-158">Make sure the Key Vault and VMs to be encrypted are in the same location.</span></span> <span data-ttu-id="16d26-159">Se você não souber o local, há etapas posteriores neste artigo que mostram como encontrá-lo.</span><span class="sxs-lookup"><span data-stu-id="16d26-159">If you don’t know the location, there are steps later in this article that will show you how to find out.</span></span>
* <span data-ttu-id="16d26-160">**Nome do Aplicativo do Active Directory do Azure** - nome do aplicativo do Azure Active Directory que será usado para gravar segredos no Cofre da Chave.</span><span class="sxs-lookup"><span data-stu-id="16d26-160">**Azure Active Directory Application Name** - Name of the Azure Active Directory application that will be used to write secrets to the Key Vault.</span></span> <span data-ttu-id="16d26-161">Será criado um novo aplicativo com esse nome caso ele não exista.</span><span class="sxs-lookup"><span data-stu-id="16d26-161">A new application with this name will be created if one doesn't exist.</span></span> <span data-ttu-id="16d26-162">Se você já tiver um aplicativo do Azure Active Directory que deseja usar, insira o nome do aplicativo do Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="16d26-162">If you already have an Azure Active Directory application that you want to use, enter the name of that Azure Active Directory application.</span></span>

> [!NOTE]
> <span data-ttu-id="16d26-163">Se você estiver curioso sobre o motivo de precisar criar um aplicativo do Azure Active Directory, confira a seção *Registrar um aplicativo no Azure Active Directory* do artigo [Introdução ao Cofre da Chave do Azure](../key-vault/key-vault-get-started.md).</span><span class="sxs-lookup"><span data-stu-id="16d26-163">If you’re curious as to why you need to create an Azure Active Directory application, please see *Register an application with Azure Active Directory* section in the article [Getting Started with Azure Key Vault](../key-vault/key-vault-get-started.md).</span></span>
>
>

<span data-ttu-id="16d26-164">Execute as etapas a seguir para criptografar uma Máquina Virtual do Azure:</span><span class="sxs-lookup"><span data-stu-id="16d26-164">Perform the following steps to encrypt an Azure Virtual Machine:</span></span>

1. <span data-ttu-id="16d26-165">Se você tiver fechado o ISE do PowerShell, abra uma instância com privilégios elevados do ISE do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="16d26-165">If you closed the PowerShell ISE, open an elevated instance of the PowerShell ISE.</span></span> <span data-ttu-id="16d26-166">Siga as instruções mostradas anteriormente neste artigo se o ISE do PowerShell ainda não estiver aberto.</span><span class="sxs-lookup"><span data-stu-id="16d26-166">Follow the instructions earlier in this article if the PowerShell ISE is not already open.</span></span> <span data-ttu-id="16d26-167">Se você tiver fechado o script, abra o **ADEPrereqScript.ps1** clicando em **Arquivo**, em **Abrir** e selecionando o script na pasta **c:\AzureADEScript**.</span><span class="sxs-lookup"><span data-stu-id="16d26-167">If you closed the script, then open the **ADEPrereqScript.ps1** clicking **File**, then **Open** and selecting the script from the **c:\AzureADEScript** folder.</span></span> <span data-ttu-id="16d26-168">Se você estiver seguindo este artigo desde o início, vá para a próxima etapa.</span><span class="sxs-lookup"><span data-stu-id="16d26-168">If you have followed this article from the start, then just move on to the next step.</span></span>
2. <span data-ttu-id="16d26-169">No console do ISE do PowerShell (o painel inferior do ISE do PowerShell), altere o foco para o local do script ao digitar **cd c:\AzureADEScript** e pressione **ENTER**.</span><span class="sxs-lookup"><span data-stu-id="16d26-169">In the console of the PowerShell ISE (the bottom pane of the PowerShell ISE), change the focus to the local of the script by typing **cd c:\AzureADEScript** and press **ENTER**.</span></span>
3. <span data-ttu-id="16d26-170">Defina a política de execução em seu computador para que você possa executar o script.</span><span class="sxs-lookup"><span data-stu-id="16d26-170">Set the execution policy on your machine so that you can run the script.</span></span> <span data-ttu-id="16d26-171">Digite **Set-ExecutionPolicy Unrestricted** no console e pressione ENTER.</span><span class="sxs-lookup"><span data-stu-id="16d26-171">Type **Set-ExecutionPolicy Unrestricted** in the console and then press ENTER.</span></span> <span data-ttu-id="16d26-172">Se você vir uma caixa de diálogo informando sobre os efeitos da alteração da política de execução, clique em **Sim para tudo** ou em **Sim** (se você vir **Sim para tudo**, selecione essa opção; se não vir **Sim para todos**, clique em **Sim**).</span><span class="sxs-lookup"><span data-stu-id="16d26-172">If you see a dialog box telling about the effects of the change to execution policy, click either **Yes to all** or **Yes** (if you see **Yes to all**, select that option – if you do not see **Yes to all**, then click **Yes**).</span></span>
4. <span data-ttu-id="16d26-173">Faça logon na sua conta do Azure.</span><span class="sxs-lookup"><span data-stu-id="16d26-173">Log into your Azure account.</span></span> <span data-ttu-id="16d26-174">No console, digite **Login-AzureRmAccount** e pressione **ENTER**.</span><span class="sxs-lookup"><span data-stu-id="16d26-174">In the console, type **Login-AzureRmAccount** and press **ENTER**.</span></span> <span data-ttu-id="16d26-175">Será exibida uma caixa de diálogo na qual você vai inserir suas credenciais (verifique se tem direitos para alterar as máquinas virtuais. Caso não tenha direitos, não poderá criptografá-las.</span><span class="sxs-lookup"><span data-stu-id="16d26-175">A dialog box will appear in which you enter your credentials (make sure you have rights to change the virtual machines – if you do not have rights, you will not be able to encrypt them.</span></span> <span data-ttu-id="16d26-176">Se você não tiver certeza, pergunte ao proprietário da assinatura ou ao administrador).</span><span class="sxs-lookup"><span data-stu-id="16d26-176">If you are not sure, ask your subscription owner or administrator).</span></span> <span data-ttu-id="16d26-177">Você deverá ver informações sobre seu **Ambiente**, **Conta**, **TenantId**, **SubscriptionId** e **CurrentStorageAccount**.</span><span class="sxs-lookup"><span data-stu-id="16d26-177">You should see information about your **Environment**, **Account**, **TenantId**, **SubscriptionId** and **CurrentStorageAccount**.</span></span> <span data-ttu-id="16d26-178">Copie o **SubscriptionId** no bloco de notas.</span><span class="sxs-lookup"><span data-stu-id="16d26-178">Copy the **SubscriptionId** to Notepad.</span></span> <span data-ttu-id="16d26-179">Você precisará usá-la na etapa 6.</span><span class="sxs-lookup"><span data-stu-id="16d26-179">You will need to use this in step #6.</span></span>
5. <span data-ttu-id="16d26-180">Descubra a assinatura à qual sua máquina virtual pertence e sua localização.</span><span class="sxs-lookup"><span data-stu-id="16d26-180">Find what subscription your virtual machine belongs to and its location.</span></span> <span data-ttu-id="16d26-181">Entre em [https://portal.azure.com](ttps://portal.azure.com) e faça logon.</span><span class="sxs-lookup"><span data-stu-id="16d26-181">Go to [https://portal.azure.com](ttps://portal.azure.com) and log in.</span></span>  <span data-ttu-id="16d26-182">No lado esquerdo da página, clique em **Máquinas Virtuais**.</span><span class="sxs-lookup"><span data-stu-id="16d26-182">On the left side of the page, click **Virtual Machines**.</span></span> <span data-ttu-id="16d26-183">Você verá uma lista de suas máquinas virtuais e as assinaturas às quais elas pertencem.</span><span class="sxs-lookup"><span data-stu-id="16d26-183">You will see a list of your virtual machines and the subscriptions they belong to.</span></span>

   ![Máquinas Virtuais](./media/security-center-disk-encryption/security-center-disk-encryption-fig3.png)
6. <span data-ttu-id="16d26-185">Volte para o ISE do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="16d26-185">Return to the PowerShell ISE.</span></span> <span data-ttu-id="16d26-186">Defina o contexto da assinatura no qual o script será executado.</span><span class="sxs-lookup"><span data-stu-id="16d26-186">Set the subscription context in which the script will be run.</span></span> <span data-ttu-id="16d26-187">No console, digite **Select-AzureRmSubscription –SubscriptionId <sua_Id_assinatura >** (substitua **<sua_Id_assinatura >** por sua ID de assinatura real) e pressione **ENTER**.</span><span class="sxs-lookup"><span data-stu-id="16d26-187">In the console, type **Select-AzureRmSubscription –SubscriptionId <your_subscription_Id>** (replace **< your_subscription_Id >** with your actual Subscription ID) and press **ENTER**.</span></span> <span data-ttu-id="16d26-188">Você deverá ver informações sobre seu Ambiente, **Conta**, **TenantId**, **SubscriptionId** e **CurrentStorageAccount**.</span><span class="sxs-lookup"><span data-stu-id="16d26-188">You will see information about the Environment, **Account**, **TenantId**, **SubscriptionId** and **CurrentStorageAccount**.</span></span>
7. <span data-ttu-id="16d26-189">Agora você está pronto para executar o script.</span><span class="sxs-lookup"><span data-stu-id="16d26-189">You are now ready to run the script.</span></span> <span data-ttu-id="16d26-190">Clique no botão **Executar Script** ou pressione **F5** no teclado.</span><span class="sxs-lookup"><span data-stu-id="16d26-190">Click the **Run Script** button or press **F5** on the keyboard.</span></span>

   ![Execução de script do PowerShell](./media/security-center-disk-encryption/security-center-disk-encryption-fig4.png)
8. <span data-ttu-id="16d26-192">O script solicita o **resourceGroupName:** – insira o nome do *Grupo de Recursos* que você deseja usar e pressione **ENTER**.</span><span class="sxs-lookup"><span data-stu-id="16d26-192">The script asks for **resourceGroupName:** - enter the name of *Resource Group* you want to use, then press **ENTER**.</span></span> <span data-ttu-id="16d26-193">Se você não tiver um, insira um nome que você deseja usar em um novo grupo.</span><span class="sxs-lookup"><span data-stu-id="16d26-193">If you don’t have one, enter a name you want to use for a new one.</span></span> <span data-ttu-id="16d26-194">Se você já tiver um *Grupo de Recursos* que deseja usar (como aquele em que sua máquina virtual está), insira o nome do Grupo de Recursos existente.</span><span class="sxs-lookup"><span data-stu-id="16d26-194">If you already have a *Resource Group* that you want to use (such as the one that your virtual machine is in), enter the name of the existing Resource Group.</span></span>
9. <span data-ttu-id="16d26-195">O script solicita o **keyVaultName** : - insira o nome do *Cofre da Chave* que você deseja usar e pressione ENTER.</span><span class="sxs-lookup"><span data-stu-id="16d26-195">The script asks for **keyVaultName:** - enter the name of the *Key Vault* you want to use, then press ENTER.</span></span> <span data-ttu-id="16d26-196">Se você não tiver um, insira um nome que você deseja usar em um novo grupo.</span><span class="sxs-lookup"><span data-stu-id="16d26-196">If you don’t have one, enter a name you want to use for a new one.</span></span> <span data-ttu-id="16d26-197">Se você já tiver um Cofre da Chave que deseja usar, insira o nome do *Cofre da Chave*existente.</span><span class="sxs-lookup"><span data-stu-id="16d26-197">If you already have a Key Vault that you want to use, enter the name of the existing *Key Vault*.</span></span>
10. <span data-ttu-id="16d26-198">O script solicita o **local:** – insira o nome do local no qual a VM que você deseja criptografar está localizada e pressione **ENTER** a seguir.</span><span class="sxs-lookup"><span data-stu-id="16d26-198">The script asks for **location:** - enter the name of the location in which the VM you want to encrypt is located, then press **ENTER**.</span></span> <span data-ttu-id="16d26-199">Se você não se lembrar do local, volte para a etapa 5.</span><span class="sxs-lookup"><span data-stu-id="16d26-199">If you don’t remember the location, go back to step #5.</span></span>
11. <span data-ttu-id="16d26-200">O script solicita o **aadAppName:** – insira o nome do aplicativo do *Azure Active Directory* que você deseja usar e pressione **ENTER**.</span><span class="sxs-lookup"><span data-stu-id="16d26-200">The script asks for **aadAppName:** - enter the name of the *Azure Active Directory* application you want to use, then press **ENTER**.</span></span> <span data-ttu-id="16d26-201">Se você não tiver um, insira um nome que você deseja usar em um novo grupo.</span><span class="sxs-lookup"><span data-stu-id="16d26-201">If you don’t have one, enter a name you want to use for a new one.</span></span> <span data-ttu-id="16d26-202">Se você já tiver um *aplicativo do Azure Active Directory* que deseja usar, insira o nome do *aplicativo do Azure Active Directory* existente.</span><span class="sxs-lookup"><span data-stu-id="16d26-202">If you already have an *Azure Active Directory application* that you want to use, enter the name of the existing *Azure Active Directory application*.</span></span>
12. <span data-ttu-id="16d26-203">Será exibida uma caixa de diálogo de logon.</span><span class="sxs-lookup"><span data-stu-id="16d26-203">A log in dialog box will appear.</span></span> <span data-ttu-id="16d26-204">Forneça suas credenciais (sim, você fez logon uma vez, mas agora precisa fazer novamente).</span><span class="sxs-lookup"><span data-stu-id="16d26-204">Provide your credentials (yes, you have logged in once, but now you need to do it again).</span></span>
13. <span data-ttu-id="16d26-205">O script é executado e, quando for concluído, solicitará que você copie os valores da **aadClientID**, do **aadClientSecret**, da **diskEncryptionKeyVaultUrl** e da **keyVaultResourceId**.</span><span class="sxs-lookup"><span data-stu-id="16d26-205">The script runs and when complete it will ask you to copy the values of the **aadClientID**, **aadClientSecret**, **diskEncryptionKeyVaultUrl**, and **keyVaultResourceId**.</span></span> <span data-ttu-id="16d26-206">Copie cada um desses valores para a área de transferência e cole-os no Bloco de Notas.</span><span class="sxs-lookup"><span data-stu-id="16d26-206">Copy each of these values to the clipboard and paste them into Notepad.</span></span>
14. <span data-ttu-id="16d26-207">Volte para o ISE do PowerShell e coloque o cursor do mouse no final da última linha e pressione **ENTER**.</span><span class="sxs-lookup"><span data-stu-id="16d26-207">Return to the PowerShell ISE and place the cursor at the end of the last line, and press **ENTER**.</span></span>

<span data-ttu-id="16d26-208">A saída do script deve ser semelhante à tela abaixo:</span><span class="sxs-lookup"><span data-stu-id="16d26-208">The output of the script should look something like the screen below:</span></span>

![Saída do PowerShell](./media/security-center-disk-encryption/security-center-disk-encryption-fig5.png)

## <a name="encrypt-the-azure-virtual-machine"></a><span data-ttu-id="16d26-210">Criptografar a máquina virtual do Azure</span><span class="sxs-lookup"><span data-stu-id="16d26-210">Encrypt the Azure virtual machine</span></span>
<span data-ttu-id="16d26-211">Agora você está pronto para criptografar sua máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="16d26-211">You are now ready to encrypt your virtual machine.</span></span> <span data-ttu-id="16d26-212">Se sua máquina virtual estiver localizada no mesmo Grupo de Recursos que seu Cofre da Chave, você poderá prosseguir para a seção de etapas de criptografia.</span><span class="sxs-lookup"><span data-stu-id="16d26-212">If your virtual machine is located in the same Resource Group as your Key Vault, you can move on to the encryption steps section.</span></span> <span data-ttu-id="16d26-213">No entanto, se sua máquina virtual não estiver no mesmo Grupo de Recursos que o Cofre da Chave, será necessário inserir o seguinte no console do ISE do PowerShell:</span><span class="sxs-lookup"><span data-stu-id="16d26-213">However, if your virtual machine is not in the same Resource Group as your Key Vault, you will need to enter the following in the console in the PowerShell ISE:</span></span>

<span data-ttu-id="16d26-214">**$resourceGroupName = <’GR_da_Máquina_Virtual’>**</span><span class="sxs-lookup"><span data-stu-id="16d26-214">**$resourceGroupName = <’Virtual_Machine_RG’>**</span></span>

<span data-ttu-id="16d26-215">Substitua **<GR_da_Máquina_Virtual>** pelo nome do Grupo de Recursos no qual suas máquinas virtuais estão contidas, entre aspas simples.</span><span class="sxs-lookup"><span data-stu-id="16d26-215">Replace **< Virtual_Machine_RG >** with the name of the Resource Group in which your virtual machines are contained, surrounded by a single quote.</span></span> <span data-ttu-id="16d26-216">Em seguida, pressione **ENTER**.</span><span class="sxs-lookup"><span data-stu-id="16d26-216">Then press **ENTER**.</span></span>
<span data-ttu-id="16d26-217">Para confirmar se o nome do Grupo de Recursos correto foi inserido, digite o seguinte no console do ISE do PowerShell:</span><span class="sxs-lookup"><span data-stu-id="16d26-217">To confirm that the correct Resource Group name was entered, type the following in the PowerShell ISE console:</span></span>

<span data-ttu-id="16d26-218">**$resourceGroupName**</span><span class="sxs-lookup"><span data-stu-id="16d26-218">**$resourceGroupName**</span></span>

<span data-ttu-id="16d26-219">Pressione **ENTER**.</span><span class="sxs-lookup"><span data-stu-id="16d26-219">Press **ENTER**.</span></span> <span data-ttu-id="16d26-220">Você deverá ver o nome do Grupo de Recursos em que suas máquinas virtuais estão localizadas.</span><span class="sxs-lookup"><span data-stu-id="16d26-220">You should see the name of Resource Group that your virtual machines are located in.</span></span> <span data-ttu-id="16d26-221">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="16d26-221">For example:</span></span>

![Saída do PowerShell](./media/security-center-disk-encryption/security-center-disk-encryption-fig6.png)

### <a name="encryption-steps"></a><span data-ttu-id="16d26-223">Etapas de criptografia</span><span class="sxs-lookup"><span data-stu-id="16d26-223">Encryption steps</span></span>
<span data-ttu-id="16d26-224">Primeiro, você precisa dizer ao PowerShell o nome da máquina virtual que deseja criptografar.</span><span class="sxs-lookup"><span data-stu-id="16d26-224">First, you need to tell PowerShell the name of the virtual machine you want to encrypt.</span></span> <span data-ttu-id="16d26-225">No console, digite:</span><span class="sxs-lookup"><span data-stu-id="16d26-225">In the console, type:</span></span>

<span data-ttu-id="16d26-226">**$vmName = <’nome_da_sua_vm’>**</span><span class="sxs-lookup"><span data-stu-id="16d26-226">**$vmName = <’your_vm_name’>**</span></span>

<span data-ttu-id="16d26-227">Substitua **<'nome_da_sua_vm ' >** pelo nome da sua VM (verifique se o nome está entre aspas simples) e pressione **ENTER**.</span><span class="sxs-lookup"><span data-stu-id="16d26-227">Replace **<’your_vm_name’>** with the name of your VM (make sure the name is surrounded by a single quote) and then press **ENTER**.</span></span>

<span data-ttu-id="16d26-228">Para confirmar se o nome correto da VM foi inserido, digite:</span><span class="sxs-lookup"><span data-stu-id="16d26-228">To confirm that the correct VM name was entered, type:</span></span>

<span data-ttu-id="16d26-229">**$vmName**</span><span class="sxs-lookup"><span data-stu-id="16d26-229">**$vmName**</span></span>

<span data-ttu-id="16d26-230">Pressione **ENTER**.</span><span class="sxs-lookup"><span data-stu-id="16d26-230">Press **ENTER**.</span></span> <span data-ttu-id="16d26-231">Você deverá ver o nome da máquina virtual que deseja criptografar.</span><span class="sxs-lookup"><span data-stu-id="16d26-231">You should see the name of the virtual machine you want to encrypt.</span></span> <span data-ttu-id="16d26-232">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="16d26-232">For example:</span></span>

![Saída do PowerShell](./media/security-center-disk-encryption/security-center-disk-encryption-fig7.png)

<span data-ttu-id="16d26-234">Há dois métodos para executar o comando de criptografia para criptografar todas as unidades na máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="16d26-234">There are two methods to run the encryption command to encrypt all drives on the virtual machine.</span></span> <span data-ttu-id="16d26-235">O primeiro método é digitar o seguinte comando no console do ISE do PowerShell:</span><span class="sxs-lookup"><span data-stu-id="16d26-235">The first method is to type the following command in the PowerShell ISE console:</span></span>

~~~
Set-AzureRmVMDiskEncryptionExtension -ResourceGroupName $resourceGroupName -VMName $vmName -AadClientID $aadClientID -AadClientSecret $aadClientSecret -DiskEncryptionKeyVaultUrl $diskEncryptionKeyVaultUrl -DiskEncryptionKeyVaultId $keyVaultResourceId -VolumeType All
~~~

<span data-ttu-id="16d26-236">Depois de digitar esse comando, pressione **ENTER**.</span><span class="sxs-lookup"><span data-stu-id="16d26-236">After typing this command press **ENTER**.</span></span>

<span data-ttu-id="16d26-237">O segundo método é clicar no painel de script (o painel superior do ISE do PowerShell) e rolar até o final do script.</span><span class="sxs-lookup"><span data-stu-id="16d26-237">The second method is to click in the script pane (the top pane of the PowerShell ISE) and scroll down to the bottom of the script.</span></span> <span data-ttu-id="16d26-238">Realce o comando listado acima, clique com o botão direito do mouse nele e clique em **Executar Seleção** ou pressione **F8** no teclado.</span><span class="sxs-lookup"><span data-stu-id="16d26-238">Highlight the command listed above, and then right click it and then click **Run Selection** or press **F8** on the keyboard.</span></span>

![ISE do PowerShell](./media/security-center-disk-encryption/security-center-disk-encryption-fig8.png)

<span data-ttu-id="16d26-240">Independentemente do método usado, será exibida uma caixa de diálogo informando que a operação levará de 10 a 15 minutos para ser concluída.</span><span class="sxs-lookup"><span data-stu-id="16d26-240">Regardless of the method you use, a dialog box will appear informing you that it will take 10-15 minutes for the operation to complete.</span></span> <span data-ttu-id="16d26-241">Clique em **Sim**.</span><span class="sxs-lookup"><span data-stu-id="16d26-241">Click **Yes**.</span></span>

<span data-ttu-id="16d26-242">Durante o processo de criptografia, é possível retornar ao Portal do Azure e ver o status da máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="16d26-242">While the encryption process is taking place, you can return to the Azure Portal and see the status of the virtual machine.</span></span> <span data-ttu-id="16d26-243">No lado esquerdo da página, clique em **Máquinas Virtuais** e, na folha **Máquinas Virtuais**, clique no nome da máquina virtual que você está criptografando.</span><span class="sxs-lookup"><span data-stu-id="16d26-243">On the left side of the page, click **Virtual Machines**, then in the **Virtual Machines** blade, click the name of the virtual machine you’re encrypting.</span></span> <span data-ttu-id="16d26-244">Na folha exibida, você observará que o **Status** diz **Atualizando**.</span><span class="sxs-lookup"><span data-stu-id="16d26-244">In the blade that appears, you’ll notice that the **Status** says that it’s **Updating**.</span></span> <span data-ttu-id="16d26-245">Isso demonstra que a criptografia está em andamento.</span><span class="sxs-lookup"><span data-stu-id="16d26-245">This demonstrates that encryption is in process.</span></span>

![Mais detalhes sobre a VM](./media/security-center-disk-encryption/security-center-disk-encryption-fig9.png)

<span data-ttu-id="16d26-247">Volte para o ISE do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="16d26-247">Return to the PowerShell ISE.</span></span> <span data-ttu-id="16d26-248">Quando o script for concluído, você verá o que aparece na figura abaixo.</span><span class="sxs-lookup"><span data-stu-id="16d26-248">When the script completes, you’ll see what appears in the figure below.</span></span>

![Saída do PowerShell](./media/security-center-disk-encryption/security-center-disk-encryption-fig10.png)

<span data-ttu-id="16d26-250">Para demonstrar que a máquina virtual já está criptografada, retorne ao Portal do Azure e clique em **Máquinas Virtuais** no lado esquerdo da página.</span><span class="sxs-lookup"><span data-stu-id="16d26-250">To demonstrate that the virtual machine is now encrypted, return to the Azure Portal and click **Virtual Machines** on the left side of the page.</span></span> <span data-ttu-id="16d26-251">Clique no nome da máquina virtual que você criptografou.</span><span class="sxs-lookup"><span data-stu-id="16d26-251">Click the name of the virtual machine you encrypted.</span></span> <span data-ttu-id="16d26-252">Na folha **Configurações**, clique em **Discos**.</span><span class="sxs-lookup"><span data-stu-id="16d26-252">In the **Settings** blade, click **Disks**.</span></span>

![Opções de configurações](./media/security-center-disk-encryption/security-center-disk-encryption-fig11.png)

<span data-ttu-id="16d26-254">Na folha **Discos**, você verá que a **Criptografia** está **Habilitada**.</span><span class="sxs-lookup"><span data-stu-id="16d26-254">On the **Disks** blade, you will see that **Encryption** is **Enabled**.</span></span>

![Propriedades de discos](./media/security-center-disk-encryption/security-center-disk-encryption-fig12.png)

## <a name="next-steps"></a><span data-ttu-id="16d26-256">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="16d26-256">Next steps</span></span>
<span data-ttu-id="16d26-257">Neste documento, você aprendeu a criptografar uma Máquina Virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="16d26-257">In this document, you learned how to encrypt an Azure Virtual Machine.</span></span> <span data-ttu-id="16d26-258">Para saber mais sobre a Central de Segurança do Azure, veja o seguinte:</span><span class="sxs-lookup"><span data-stu-id="16d26-258">To learn more about Azure Security Center, see the following:</span></span>

* <span data-ttu-id="16d26-259">[Monitoramento de integridade de segurança na Central de Segurança do Azure](security-center-monitoring.md) – saiba como monitorar a integridade dos recursos do Azure</span><span class="sxs-lookup"><span data-stu-id="16d26-259">[Security health monitoring in Azure Security Center](security-center-monitoring.md) – Learn how to monitor the health of your Azure resources</span></span>
* <span data-ttu-id="16d26-260">[Gerenciando e respondendo a alertas de segurança na Central de Segurança do Azure](security-center-managing-and-responding-alerts.md) – aprenda a gerenciar e a responder a alertas de segurança</span><span class="sxs-lookup"><span data-stu-id="16d26-260">[Managing and responding to security alerts in Azure Security Center](security-center-managing-and-responding-alerts.md) - Learn how to manage and respond to security alerts</span></span>
* <span data-ttu-id="16d26-261">[Perguntas frequentes sobre a Central de Segurança do Azure](security-center-faq.md) – encontre perguntas frequentes sobre como usar o serviço</span><span class="sxs-lookup"><span data-stu-id="16d26-261">[Azure Security Center FAQ](security-center-faq.md) – Find frequently asked questions about using the service</span></span>
* <span data-ttu-id="16d26-262">[Blog de segurança do Azure](http://blogs.msdn.com/b/azuresecurity/) – encontre postagens no blog sobre conformidade e segurança do Azure</span><span class="sxs-lookup"><span data-stu-id="16d26-262">[Azure Security Blog](http://blogs.msdn.com/b/azuresecurity/) – Find blog posts about Azure security and compliance</span></span>
