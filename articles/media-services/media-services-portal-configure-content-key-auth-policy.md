---
title: "Configurar política de autorização de chave de conteúdo usando o portal do Azure | Microsoft Docs"
description: "Saiba como configurar uma política de autorização para uma chave de conteúdo."
services: media-services
documentationcenter: 
author: juliako
manager: cfowler
editor: 
ms.assetid: ee82a3fa-c34b-48f2-a108-8ba321f1691e
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/09/2017
ms.author: juliako
ms.openlocfilehash: 5a35c7255a1c30a693862589c14f6a22a1900790
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/29/2017
---
# <a name="configure-content-key-authorization-policy"></a><span data-ttu-id="83fd4-103">Configurar a Política de Autorização de Chave de Conteúdo</span><span class="sxs-lookup"><span data-stu-id="83fd4-103">Configure Content Key Authorization Policy</span></span>
[!INCLUDE [media-services-selector-content-key-auth-policy](../../includes/media-services-selector-content-key-auth-policy.md)]

## <a name="overview"></a><span data-ttu-id="83fd4-104">Visão geral</span><span class="sxs-lookup"><span data-stu-id="83fd4-104">Overview</span></span>
<span data-ttu-id="83fd4-105">Os Serviços de Mídia do Microsoft Azure permitem distribuir fluxos MPEG-DASH, Smooth Streaming e HLS (HTTP-Live-Streaming) protegidos com a criptografia AES (usando chaves de criptografia de 128 bits) ou com o [DRM do Microsoft PlayReady](https://www.microsoft.com/playready/overview/).</span><span class="sxs-lookup"><span data-stu-id="83fd4-105">Microsoft Azure Media Services enables you to deliver MPEG-DASH, Smooth Streaming, and HTTP-Live-Streaming (HLS) streams protected with Advanced Encryption Standard (AES) (using 128-bit encryption keys) or [Microsoft PlayReady DRM](https://www.microsoft.com/playready/overview/).</span></span> <span data-ttu-id="83fd4-106">O AMS também permite distribuir fluxos DASH criptografados com o DRM do Widevine.</span><span class="sxs-lookup"><span data-stu-id="83fd4-106">AMS also enables you to deliver DASH streams encrypted with Widevine DRM.</span></span> <span data-ttu-id="83fd4-107">PlayReady e Widevine são criptografados de acordo com a especificação de criptografia comum (ISO/IEC 23001-7 CENC).</span><span class="sxs-lookup"><span data-stu-id="83fd4-107">Both PlayReady and Widevine are encrypted per the Common Encryption (ISO/IEC 23001-7 CENC) specification.</span></span>

<span data-ttu-id="83fd4-108">Os Serviços de Mídia também fornecem um **Serviço de Entrega de Chaves/Licenças** por meio do qual os clientes podem obter chaves AES ou licenças do PlayReady/Widevine para reproduzir o conteúdo criptografado.</span><span class="sxs-lookup"><span data-stu-id="83fd4-108">Media Services also provides a **Key/License Delivery Service** from which clients can obtain AES keys or PlayReady/Widevine licenses to play the encrypted content.</span></span>

<span data-ttu-id="83fd4-109">Este tópico mostra como usar o Portal do Azure para configurar a política de autorização de chave de conteúdo.</span><span class="sxs-lookup"><span data-stu-id="83fd4-109">This topic shows how to use the Azure portal to configure the content key authorization policy.</span></span> <span data-ttu-id="83fd4-110">A chave pode ser usada posteriormente para criptografar dinamicamente o conteúdo.</span><span class="sxs-lookup"><span data-stu-id="83fd4-110">The key can later be used to dynamically encrypt your content.</span></span> <span data-ttu-id="83fd4-111">Observe que, no momento, você pode criptografar o seguintes formatos de streaming: HLS, MPEG DASH, e Smooth Streaming.</span><span class="sxs-lookup"><span data-stu-id="83fd4-111">Note that currently you can encrypt the following streaming formats: HLS, MPEG DASH, and Smooth Streaming.</span></span> <span data-ttu-id="83fd4-112">Não é possível criptografar downloads progressivos.</span><span class="sxs-lookup"><span data-stu-id="83fd4-112">You cannot encrypt progressive downloads.</span></span>

<span data-ttu-id="83fd4-113">Quando um player solicita um fluxo definido para ser criptografado dinamicamente, os Serviços de Mídia usam a chave configurada para criptografar dinamicamente o conteúdo usando a criptografia AES ou DRM.</span><span class="sxs-lookup"><span data-stu-id="83fd4-113">When a player requests a stream that is set to be dynamically encrypted, Media Services uses the configured key to dynamically encrypt your content using AES or DRM encryption.</span></span> <span data-ttu-id="83fd4-114">Para descriptografar o fluxo, o player solicitará a chave do serviço de distribuição de chaves.</span><span class="sxs-lookup"><span data-stu-id="83fd4-114">To decrypt the stream, the player will request the key from the key delivery service.</span></span> <span data-ttu-id="83fd4-115">Para decidir se o usuário está autorizado para obter a chave ou não, o serviço avalia as políticas de autorização que você especificou para a chave.</span><span class="sxs-lookup"><span data-stu-id="83fd4-115">To decide whether or not the user is authorized to get the key, the service evaluates the authorization policies that you specified for the key.</span></span>

<span data-ttu-id="83fd4-116">Se você pretende ter várias chaves de conteúdo ou se deseja especificar uma URL de **Serviço de Entrega de Chave/Licença** diferente do serviço de entrega de chaves dos Serviços de Mídia, use o SDK do .NET dos Serviços de Mídia ou as APIs REST.</span><span class="sxs-lookup"><span data-stu-id="83fd4-116">If you plan to have multiple content keys or want to specify a **Key/License Delivery Service** URL other than the Media Services key delivery service, use Media Services .NET SDK or REST APIs.</span></span>

[<span data-ttu-id="83fd4-117">Configurar política de autorização de chave de conteúdo usando o SDK do .NET dos Serviços de Mídia</span><span class="sxs-lookup"><span data-stu-id="83fd4-117">Configure Content Key Authorization Policy using Media Services .NET SDK</span></span>](media-services-dotnet-configure-content-key-auth-policy.md)

[<span data-ttu-id="83fd4-118">Configurar política de autorização de chave de conteúdo usando a API REST dos Serviços de Mídia</span><span class="sxs-lookup"><span data-stu-id="83fd4-118">Configure Content Key Authorization Policy using Media Services REST API</span></span>](media-services-rest-configure-content-key-auth-policy.md)

### <a name="some-considerations-apply"></a><span data-ttu-id="83fd4-119">Algumas considerações se aplicam:</span><span class="sxs-lookup"><span data-stu-id="83fd4-119">Some considerations apply:</span></span>
* <span data-ttu-id="83fd4-120">Quando sua conta AMS é criada, um ponto de extremidade de streaming **padrão** é adicionado à sua conta em estado **Parado**.</span><span class="sxs-lookup"><span data-stu-id="83fd4-120">When your AMS account is created a **default** streaming endpoint is added  to your account in the **Stopped** state.</span></span> <span data-ttu-id="83fd4-121">Para começar a transmitir seu conteúdo e aproveitar o empacotamento dinâmico e a criptografia dinâmica, o ponto de extremidade de streaming deve estar no estado **Executando**.</span><span class="sxs-lookup"><span data-stu-id="83fd4-121">To start streaming your content and take advantage of dynamic packaging and dynamic encryption, your streaming endpoint has to be in the **Running** state.</span></span> 
* <span data-ttu-id="83fd4-122">O ativo deve conter um conjunto de MP4s de taxa de bits adaptável ou arquivos de Smooth Streaming de taxa de bits adaptável.</span><span class="sxs-lookup"><span data-stu-id="83fd4-122">Your asset must contain a set of adaptive bitrate MP4s or adaptive bitrate Smooth Streaming files.</span></span> <span data-ttu-id="83fd4-123">Para obter mais informações, consulte [Codificar um ativo](media-services-encode-asset.md).</span><span class="sxs-lookup"><span data-stu-id="83fd4-123">For more information, see [Encode an asset](media-services-encode-asset.md).</span></span>
* <span data-ttu-id="83fd4-124">O serviço de entrega de chave armazena em cache ContentKeyAuthorizationPolicy e seus objetos relacionados (opções e restrições da política) por 15 minutos.</span><span class="sxs-lookup"><span data-stu-id="83fd4-124">The Key Delivery service caches ContentKeyAuthorizationPolicy and its related objects (policy options and restrictions) for 15 minutes.</span></span>  <span data-ttu-id="83fd4-125">Se você criar um ContentKeyAuthorizationPolicy e optar por usar uma restrição "Token", testá-lo e, em seguida, atualizar a política de restrição "Aberta", levará aproximadamente 15 minutos antes da política alternar para a versão "Aberta" da política.</span><span class="sxs-lookup"><span data-stu-id="83fd4-125">If you create a ContentKeyAuthorizationPolicy and specify to use a “Token” restriction, then test it, and then update the policy to “Open” restriction, it will take roughly 15 minutes before the policy switches to the “Open” version of the policy.</span></span>

## <a name="how-to-configure-the-key-authorization-policy"></a><span data-ttu-id="83fd4-126">Como: configurar a política de autorização da chave</span><span class="sxs-lookup"><span data-stu-id="83fd4-126">How to: configure the key authorization policy</span></span>
<span data-ttu-id="83fd4-127">Para configurar a política de autorização da chave, selecione a página **PROTEÇÃO DE CONTEÚDO** .</span><span class="sxs-lookup"><span data-stu-id="83fd4-127">To configure the key authorization policy, select the **CONTENT PROTECTION** page.</span></span>

<span data-ttu-id="83fd4-128">Os serviços de mídia oferecem suporte a várias maneiras de autenticar os usuários que fazem solicitações de chave.</span><span class="sxs-lookup"><span data-stu-id="83fd4-128">Media Services supports multiple ways of authenticating users who make key requests.</span></span> <span data-ttu-id="83fd4-129">A política de autorização de chave de conteúdo pode ter restrições de autorização **abertas**, de **token** ou de **IP** (a de **IP** pode ser configurada com REST ou SDK do .NET).</span><span class="sxs-lookup"><span data-stu-id="83fd4-129">The content key authorization policy can have **open**, **token**, or **IP** authorization restrictions (**IP** can be configured with REST or .NET SDK).</span></span>

### <a name="open-restriction"></a><span data-ttu-id="83fd4-130">Restrição aberta</span><span class="sxs-lookup"><span data-stu-id="83fd4-130">Open restriction</span></span>
<span data-ttu-id="83fd4-131">A restrição **aberta** significa que o sistema fornecerá a chave para qualquer pessoa que fizer uma solicitação de chave.</span><span class="sxs-lookup"><span data-stu-id="83fd4-131">The **open** restriction means the system will deliver the key to anyone who makes a key request.</span></span> <span data-ttu-id="83fd4-132">Essa restrição pode ser útil para fins de teste.</span><span class="sxs-lookup"><span data-stu-id="83fd4-132">This restriction might be useful for testing purposes.</span></span>

![OpenPolicy][open_policy]

### <a name="token-restriction"></a><span data-ttu-id="83fd4-134">Restrição de token</span><span class="sxs-lookup"><span data-stu-id="83fd4-134">Token restriction</span></span>
<span data-ttu-id="83fd4-135">Para escolher a política com restrição de token, pressione o botão **TOKEN** .</span><span class="sxs-lookup"><span data-stu-id="83fd4-135">To choose the token restricted policy, press the **TOKEN** button.</span></span>

<span data-ttu-id="83fd4-136">A política restrita do **token** deve ser acompanhada por um token emitido por um **Serviço de Token Seguro** (STS).</span><span class="sxs-lookup"><span data-stu-id="83fd4-136">The **token** restricted policy must be accompanied by a token issued by a **Secure Token Service** (STS).</span></span> <span data-ttu-id="83fd4-137">Os Serviços de Mídia oferecem suporte a tokens no formato **Token Simples da Web** ([SWT](https://msdn.microsoft.com/library/gg185950.aspx#BKMK_2)) e no formato **Token Web JSON** (JWT).</span><span class="sxs-lookup"><span data-stu-id="83fd4-137">Media Services supports tokens in the **Simple Web Tokens** ([SWT](https://msdn.microsoft.com/library/gg185950.aspx#BKMK_2)) format and **JSON Web Token** (JWT) format.</span></span> <span data-ttu-id="83fd4-138">Para obter informações, consulte [Autenticação de token JWT](http://www.gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/).</span><span class="sxs-lookup"><span data-stu-id="83fd4-138">For information, see [JWT token authentication](http://www.gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/).</span></span>

<span data-ttu-id="83fd4-139">Os Serviços de Mídia não fornecem **Serviços de Token Seguro**.</span><span class="sxs-lookup"><span data-stu-id="83fd4-139">Media Services does not provide **Secure Token Services**.</span></span> <span data-ttu-id="83fd4-140">Você pode criar um STS personalizado ou usar o Microsoft Azure ACS para emitir tokens.</span><span class="sxs-lookup"><span data-stu-id="83fd4-140">You can create a custom STS or leverage Microsoft Azure ACS to issue tokens.</span></span> <span data-ttu-id="83fd4-141">O STS deve ser configurado para criar um token assinado com as a chave especificada e declarações de emissão que você especificou na configuração de restrição do token.</span><span class="sxs-lookup"><span data-stu-id="83fd4-141">The STS must be configured to create a token signed with the specified key and issue claims that you specified in the token restriction configuration.</span></span> <span data-ttu-id="83fd4-142">O serviço de distribuição de chaves dos serviços de mídia retornará a chave de criptografia para o cliente se o token for válido e as declarações no token corresponderem aos configurados para a chave de conteúdo.</span><span class="sxs-lookup"><span data-stu-id="83fd4-142">The Media Services key delivery service will return the encryption key to the client if the token is valid and the claims in the token match those configured for the content key.</span></span> <span data-ttu-id="83fd4-143">Para saber mais, consulte [Uso do Azure ACS para emitir tokens](http://mingfeiy.com/acs-with-key-services).</span><span class="sxs-lookup"><span data-stu-id="83fd4-143">For more information, see [Use Azure ACS to issue tokens](http://mingfeiy.com/acs-with-key-services).</span></span>

<span data-ttu-id="83fd4-144">Ao configurar a política com restrição de **TOKEN**, você deve definir valores para **chave de verificação**, **emissor** e **Público**.</span><span class="sxs-lookup"><span data-stu-id="83fd4-144">When configuring the **TOKEN** restricted policy, you must set values for **verification key**, **issuer** and **audience**.</span></span> <span data-ttu-id="83fd4-145">A chave de verificação primária contém a chave que o token foi assinado, o emissor é o serviço de token seguro que emite o token.</span><span class="sxs-lookup"><span data-stu-id="83fd4-145">The primary verification key contains the key that the token was signed with, issuer is the secure token service that issues the token.</span></span> <span data-ttu-id="83fd4-146">A audiência (às vezes chamada de escopo) descreve a intenção do token ou o recurso que o token autoriza o acesso.</span><span class="sxs-lookup"><span data-stu-id="83fd4-146">The audience (sometimes called scope) describes the intent of the token or the resource the token authorizes access to.</span></span> <span data-ttu-id="83fd4-147">O serviço de distribuição de chaves dos serviços de mídia valida que esses valores no token correspondem aos valores no modelo.</span><span class="sxs-lookup"><span data-stu-id="83fd4-147">The Media Services key delivery service validates that these values in the token match the values in the template.</span></span>

### <a name="playready"></a><span data-ttu-id="83fd4-148">PlayReady</span><span class="sxs-lookup"><span data-stu-id="83fd4-148">PlayReady</span></span>
<span data-ttu-id="83fd4-149">Ao proteger o conteúdo com **PlayReady**, uma das coisas que você precisa especificar na sua política de autorização é uma cadeia de caracteres XML que define o modelo de licença do PlayReady.</span><span class="sxs-lookup"><span data-stu-id="83fd4-149">When protecting your content with **PlayReady**, one of the things you need to specify in your authorization policy is an XML string that defines the PlayReady license template.</span></span> <span data-ttu-id="83fd4-150">Por padrão, a seguinte política é definida:</span><span class="sxs-lookup"><span data-stu-id="83fd4-150">By default, the following policy is set:</span></span>

<span data-ttu-id="83fd4-151"><PlayReadyLicenseResponseTemplate xmlns:i="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://schemas.microsoft.com/Azure/MediaServices/KeyDelivery/PlayReadyTemplate/v1"> <LicenseTemplates> <PlayReadyLicenseTemplate><AllowTestDevices>true</AllowTestDevices> <ContentKey i:type="ContentEncryptionKeyFromHeader" /> <LicenseType>Nonpersistent</LicenseType> <PlayRight> <AllowPassingVideoContentToUnknownOutput>Allowed</AllowPassingVideoContentToUnknownOutput> </PlayRight> </PlayReadyLicenseTemplate> </LicenseTemplates> </PlayReadyLicenseResponseTemplate></span><span class="sxs-lookup"><span data-stu-id="83fd4-151"><PlayReadyLicenseResponseTemplate xmlns:i="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://schemas.microsoft.com/Azure/MediaServices/KeyDelivery/PlayReadyTemplate/v1"> <LicenseTemplates> <PlayReadyLicenseTemplate><AllowTestDevices>true</AllowTestDevices> <ContentKey i:type="ContentEncryptionKeyFromHeader" /> <LicenseType>Nonpersistent</LicenseType> <PlayRight> <AllowPassingVideoContentToUnknownOutput>Allowed</AllowPassingVideoContentToUnknownOutput> </PlayRight> </PlayReadyLicenseTemplate> </LicenseTemplates> </PlayReadyLicenseResponseTemplate></span></span>

<span data-ttu-id="83fd4-152">Você pode clicar no botão **Importar a política XML** e fornecer um XML diferente que está em conformidade com o esquema XML definido [aqui](media-services-playready-license-template-overview.md).</span><span class="sxs-lookup"><span data-stu-id="83fd4-152">You can click the **import policy xml** button and provide a different XML which conforms to the  XML Schema defined [here](media-services-playready-license-template-overview.md).</span></span>

## <a name="next-step"></a><span data-ttu-id="83fd4-153">Próxima etapa</span><span class="sxs-lookup"><span data-stu-id="83fd4-153">Next step</span></span>
<span data-ttu-id="83fd4-154">Revise os roteiros de aprendizagem dos Serviços de Mídia.</span><span class="sxs-lookup"><span data-stu-id="83fd4-154">Review Media Services learning paths.</span></span>

[!INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

## <a name="provide-feedback"></a><span data-ttu-id="83fd4-155">Fornecer comentários</span><span class="sxs-lookup"><span data-stu-id="83fd4-155">Provide feedback</span></span>
[!INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]

[open_policy]: ./media/media-services-portal-configure-content-key-auth-policy/media-services-protect-content-with-open-restriction.png
[token_policy]: ./media/media-services-key-authorization-policy/media-services-protect-content-with-token-restriction.png

