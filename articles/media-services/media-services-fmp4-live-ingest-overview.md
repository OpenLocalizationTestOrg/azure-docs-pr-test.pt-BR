---
title: "especificação de ingestão aaaAzure os serviços de mídia ao vivo MP4 fragmentado | Microsoft Docs"
description: "Essa especificação descreve o protocolo de saudação e formato fragmentados com base em MP4 live streaming inclusão para serviços de mídia do Azure. Você pode usar eventos ao vivo do Azure Media Services toostream e transmitir o conteúdo em tempo real usando o Azure como plataforma de nuvem hello. Este documento também aborda as práticas recomendadas para criação de mecanismos robustos de ingestão dinâmica e altamente redundantes."
services: media-services
documentationcenter: 
author: cenkdin
manager: cfowler
editor: 
ms.assetid: 43fac263-a5ea-44af-8dd5-cc88e423b4de
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/29/2017
ms.author: cenkd;juliako
ms.openlocfilehash: 0c191f8d6c5a595621feaba0e571fb984b666f34
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="azure-media-services-fragmented-mp4-live-ingest-specification"></a><span data-ttu-id="63133-105">Especificação da ingestão dinâmica de MP4 fragmentado para os Serviços de Mídia do Azure</span><span class="sxs-lookup"><span data-stu-id="63133-105">Azure Media Services fragmented MP4 live ingest specification</span></span>
<span data-ttu-id="63133-106">Essa especificação descreve o protocolo de saudação e formato fragmentados com base em MP4 live streaming inclusão para serviços de mídia do Azure.</span><span class="sxs-lookup"><span data-stu-id="63133-106">This specification describes hello protocol and format for fragmented MP4-based live streaming ingestion for Azure Media Services.</span></span> <span data-ttu-id="63133-107">Serviços de mídia fornecem um serviço de transmissão ao vivo que os clientes podem usar eventos ao vivo toostream e transmitir o conteúdo em tempo real usando o Azure como plataforma de nuvem hello.</span><span class="sxs-lookup"><span data-stu-id="63133-107">Media Services provides a live streaming service that customers can use toostream live events and broadcast content in real time by using Azure as hello cloud platform.</span></span> <span data-ttu-id="63133-108">Este documento também aborda as práticas recomendadas para criação de mecanismos robustos de ingestão dinâmica e altamente redundantes.</span><span class="sxs-lookup"><span data-stu-id="63133-108">This document also discusses best practices for building highly redundant and robust live ingest mechanisms.</span></span>

## <a name="1-conformance-notation"></a><span data-ttu-id="63133-109">1. Notação de conformidade</span><span class="sxs-lookup"><span data-stu-id="63133-109">1. Conformance notation</span></span>
<span data-ttu-id="63133-110">Olá palavras-chave "deve", "não deve," "Exigido", "Deverá", "não deverá", "Deveria", "Não devem,", "Recomendado", "Maio" e "Opcional" deste documento são toobe interpretado como elas são descritas no RFC 2119.</span><span class="sxs-lookup"><span data-stu-id="63133-110">hello key words "MUST," "MUST NOT," "REQUIRED," "SHALL," "SHALL NOT," "SHOULD," "SHOULD NOT," "RECOMMENDED," "MAY," and "OPTIONAL" in this document are toobe interpreted as they are described in RFC 2119.</span></span>

## <a name="2-service-diagram"></a><span data-ttu-id="63133-111">2. Diagrama de serviço</span><span class="sxs-lookup"><span data-stu-id="63133-111">2. Service diagram</span></span>
<span data-ttu-id="63133-112">Olá diagrama a seguir mostra arquitetura de alto nível de saudação do hello ao vivo de serviço nos serviços de mídia de streaming:</span><span class="sxs-lookup"><span data-stu-id="63133-112">hello following diagram shows hello high-level architecture of hello live streaming service in Media Services:</span></span>

1. <span data-ttu-id="63133-113">Um codificador ao vivo envia toochannels ao vivo que são criados e provisionados por meio de saudação SDK do Azure Media Services.</span><span class="sxs-lookup"><span data-stu-id="63133-113">A live encoder pushes live feeds toochannels that are created and provisioned via hello Azure Media Services SDK.</span></span>
2. <span data-ttu-id="63133-114">Nuvem de canais, programas e pontos de extremidade de streaming no identificador de serviços de mídia Olá todos live streaming funcionalidades, inclusive ingestão, formatação, DVR, segurança, escalabilidade e redundância.</span><span class="sxs-lookup"><span data-stu-id="63133-114">Channels, programs, and streaming endpoints in Media Services handle all hello live streaming functionalities, including ingest, formatting, cloud DVR, security, scalability, and redundancy.</span></span>
3. <span data-ttu-id="63133-115">Opcionalmente, os clientes podem escolher toodeploy uma camada de rede de fornecimento de conteúdo do Azure entre Olá Olá os pontos de extremidade e de ponto de extremidade de streaming.</span><span class="sxs-lookup"><span data-stu-id="63133-115">Optionally, customers can choose toodeploy an Azure Content Delivery Network layer between hello streaming endpoint and hello client endpoints.</span></span>
4. <span data-ttu-id="63133-116">Fluxo de pontos de extremidade de cliente do hello ponto de extremidade de streaming por meio de protocolos de Streaming adaptável de HTTP.</span><span class="sxs-lookup"><span data-stu-id="63133-116">Client endpoints stream from hello streaming endpoint by using HTTP Adaptive Streaming protocols.</span></span> <span data-ttu-id="63133-117">Os exemplos incluem Microsoft Smooth Streaming, Streaming adaptável dinâmico via HTTP (DASH ou MPEG-DASH) e Apple HTTP Live Streaming (HLS).</span><span class="sxs-lookup"><span data-stu-id="63133-117">Examples include Microsoft Smooth Streaming, Dynamic Adaptive Streaming over HTTP (DASH, or MPEG-DASH), and Apple HTTP Live Streaming (HLS).</span></span>

![fluxo de ingestão][image1]

## <a name="3-bitstream-format--iso-14496-12-fragmented-mp4"></a><span data-ttu-id="63133-119">3. Formato de fluxo de bits – MP4 fragmentado ISO 14496-12</span><span class="sxs-lookup"><span data-stu-id="63133-119">3. Bitstream format – ISO 14496-12 fragmented MP4</span></span>
<span data-ttu-id="63133-120">Hello formato com fio para transmissão ao vivo de ingestão discutido neste documento baseia-se no [ISO-14496-12].</span><span class="sxs-lookup"><span data-stu-id="63133-120">hello wire format for live streaming ingest discussed in this document is based on [ISO-14496-12].</span></span> <span data-ttu-id="63133-121">Para ver uma explicação detalhada do formato MP4 fragmentado e das extensões para arquivos de vídeo sob demanda e ingestão de transmissão ao vivo, consulte [[MS-SSTR]](http://msdn.microsoft.com/library/ff469518.aspx).</span><span class="sxs-lookup"><span data-stu-id="63133-121">For a detailed explanation of fragmented MP4 format and extensions both for video-on-demand files and live streaming ingestion, see [[MS-SSTR]](http://msdn.microsoft.com/library/ff469518.aspx).</span></span>

### <a name="live-ingest-format-definitions"></a><span data-ttu-id="63133-122">Definições de formato de ingestão ao vivo</span><span class="sxs-lookup"><span data-stu-id="63133-122">Live ingest format definitions</span></span>
<span data-ttu-id="63133-123">Olá lista a seguir descreve formato especial definições que se aplicam toolive ingestão nos serviços de mídia do Azure:</span><span class="sxs-lookup"><span data-stu-id="63133-123">hello following list describes special format definitions that apply toolive ingest into Azure Media Services:</span></span>

1. <span data-ttu-id="63133-124">Olá **ftyp**, **Live Server manifesto caixa**, e **moov** caixas devem ser enviadas com cada solicitação (HTTP POST).</span><span class="sxs-lookup"><span data-stu-id="63133-124">hello **ftyp**, **Live Server Manifest Box**, and **moov** boxes MUST be sent with each request (HTTP POST).</span></span> <span data-ttu-id="63133-125">Essas caixas devem ser enviadas no início de saudação do fluxo de saudação e qualquer tempo de codificador Olá deve se reconectar tooresume fluxo de ingestão.</span><span class="sxs-lookup"><span data-stu-id="63133-125">These boxes MUST be sent at hello beginning of hello stream and any time hello encoder must reconnect tooresume stream ingest.</span></span> <span data-ttu-id="63133-126">Para saber mais, consulte a Seção 6 em [1].</span><span class="sxs-lookup"><span data-stu-id="63133-126">For more information, see Section 6 in [1].</span></span>
2. <span data-ttu-id="63133-127">A Seção 3.3.2 em [1] define uma caixa opcional chamada **StreamManifestBox** para ingestão dinâmica.</span><span class="sxs-lookup"><span data-stu-id="63133-127">Section 3.3.2 in [1] defines an optional box called **StreamManifestBox** for live ingest.</span></span> <span data-ttu-id="63133-128">Devido a lógica de roteamento de toohello hello Azure do balanceador de carga, usar essa caixa é preterido.</span><span class="sxs-lookup"><span data-stu-id="63133-128">Due toohello routing logic of hello Azure load balancer, using this box is deprecated.</span></span> <span data-ttu-id="63133-129">caixa de saudação não deve estar presente quando ingestão nos serviços de mídia.</span><span class="sxs-lookup"><span data-stu-id="63133-129">hello box SHOULD NOT be present when ingesting into Media Services.</span></span> <span data-ttu-id="63133-130">Se essa caixa estiver presente, os Serviços de Mídia vão ignorá-la silenciosamente.</span><span class="sxs-lookup"><span data-stu-id="63133-130">If this box is present, Media Services silently ignores it.</span></span>
3. <span data-ttu-id="63133-131">Olá **TrackFragmentExtendedHeaderBox** caixa definida no 3.2.3.2 em [1] deve estar presente para cada fragmento.</span><span class="sxs-lookup"><span data-stu-id="63133-131">hello **TrackFragmentExtendedHeaderBox** box defined in 3.2.3.2 in [1] MUST be present for each fragment.</span></span>
4. <span data-ttu-id="63133-132">Versão 2 do hello **TrackFragmentExtendedHeaderBox** caixa deve ser usado toogenerate segmentos de mídia que têm URLs idênticos em vários data centers.</span><span class="sxs-lookup"><span data-stu-id="63133-132">Version 2 of hello **TrackFragmentExtendedHeaderBox** box SHOULD be used toogenerate media segments that have identical URLs in multiple datacenters.</span></span> <span data-ttu-id="63133-133">o campo de índice de fragmento Olá é obrigatório para o failover entre data centers de formatos de streaming baseada em índice como Apple HLS e MPEG-DASH baseada em índice.</span><span class="sxs-lookup"><span data-stu-id="63133-133">hello fragment index field is REQUIRED for cross-datacenter failover of index-based streaming formats such as Apple HLS and index-based MPEG-DASH.</span></span> <span data-ttu-id="63133-134">tooenable entre data centers failover, o índice de fragmento de saudação deve ser sincronizado entre vários codificadores e ser aumentado em 1 para cada fragmento de mídia sucessivas, mesmo em reinicializações de codificador ou falhas.</span><span class="sxs-lookup"><span data-stu-id="63133-134">tooenable cross-datacenter failover, hello fragment index MUST be synced across multiple encoders and be increased by 1 for each successive media fragment, even across encoder restarts or failures.</span></span>
5. <span data-ttu-id="63133-135">Seção 3.3.6 [1] define uma caixa denominada **MovieFragmentRandomAccessBox** (**mfra**) que podem ser enviados no final de saudação do canal de toohello inclusão dinâmica tooindicate final de fluxo (EOS).</span><span class="sxs-lookup"><span data-stu-id="63133-135">Section 3.3.6 in [1] defines a box called **MovieFragmentRandomAccessBox** (**mfra**) that MAY be sent at hello end of live ingestion tooindicate end-of-stream (EOS) toohello channel.</span></span> <span data-ttu-id="63133-136">Vencimento toohello ingestão lógica dos serviços de mídia usando EOS foi preterido e Olá **mfra** caixa para inclusão dinâmica não deve ser enviada.</span><span class="sxs-lookup"><span data-stu-id="63133-136">Due toohello ingest logic of Media Services, using EOS is deprecated, and hello **mfra** box for live ingestion SHOULD NOT be sent.</span></span> <span data-ttu-id="63133-137">Se enviada, os Serviços de Mídia vão ignorá-la silenciosamente.</span><span class="sxs-lookup"><span data-stu-id="63133-137">If sent, Media Services silently ignores it.</span></span> <span data-ttu-id="63133-138">estado de saudação tooreset de saudação ingestão ponto, é recomendável que você use [redefinir canal](https://docs.microsoft.com/rest/api/media/operations/channel#reset_channels).</span><span class="sxs-lookup"><span data-stu-id="63133-138">tooreset hello state of hello ingest point, we recommend that you use [Channel Reset](https://docs.microsoft.com/rest/api/media/operations/channel#reset_channels).</span></span> <span data-ttu-id="63133-139">Também é recomendável que você use [programa parar](https://msdn.microsoft.com/library/azure/dn783463.aspx#stop_programs) tooend uma apresentação e o fluxo.</span><span class="sxs-lookup"><span data-stu-id="63133-139">We also recommend that you use [Program Stop](https://msdn.microsoft.com/library/azure/dn783463.aspx#stop_programs) tooend a presentation and stream.</span></span>
6. <span data-ttu-id="63133-140">duração de fragmento Olá MP4 deve ser constante, tamanho de saudação tooreduce de manifestos de saudação do cliente.</span><span class="sxs-lookup"><span data-stu-id="63133-140">hello MP4 fragment duration SHOULD be constant, tooreduce hello size of hello client manifests.</span></span> <span data-ttu-id="63133-141">Uma duração de fragmento MP4 constante também melhora a heurística de download do cliente por meio do uso de saudação de marcas de repetição.</span><span class="sxs-lookup"><span data-stu-id="63133-141">A constant MP4 fragment duration also improves client download heuristics through hello use of repeat tags.</span></span> <span data-ttu-id="63133-142">duração de saudação pode flutuar toocompensate para taxas de quadros não inteiro.</span><span class="sxs-lookup"><span data-stu-id="63133-142">hello duration MAY fluctuate toocompensate for non-integer frame rates.</span></span>
7. <span data-ttu-id="63133-143">duração de fragmento Olá MP4 deve estar entre aproximadamente 2 e 6 segundos.</span><span class="sxs-lookup"><span data-stu-id="63133-143">hello MP4 fragment duration SHOULD be between approximately 2 and 6 seconds.</span></span>
8. <span data-ttu-id="63133-144">Os carimbos de data/hora e índices do fragmento MP4 (**TrackFragmentExtendedHeaderBox** `fragment_ absolute_ time` e `fragment_index`) DEVEM chegar na ordem crescente.</span><span class="sxs-lookup"><span data-stu-id="63133-144">MP4 fragment timestamps and indexes (**TrackFragmentExtendedHeaderBox** `fragment_ absolute_ time` and `fragment_index`) SHOULD arrive in increasing order.</span></span> <span data-ttu-id="63133-145">Embora os serviços de mídia seja resiliente tooduplicate fragmentos, ela tem limitada fragmentos de tooreorder de capacidade de acordo com o cronograma de mídia toohello.</span><span class="sxs-lookup"><span data-stu-id="63133-145">Although Media Services is resilient tooduplicate fragments, it has limited ability tooreorder fragments according toohello media timeline.</span></span>

## <a name="4-protocol-format--http"></a><span data-ttu-id="63133-146">4. Formato de protocolo – HTTP</span><span class="sxs-lookup"><span data-stu-id="63133-146">4. Protocol format – HTTP</span></span>
<span data-ttu-id="63133-147">ISO fragmentado MP4 com base em tempo real de ingestão para serviços de mídia usa um padrão demoradas HTTP POST tootransmit codificado mídia dados de solicitação que estão empacotados no serviço de toohello de formato MP4 fragmentado.</span><span class="sxs-lookup"><span data-stu-id="63133-147">ISO fragmented MP4-based live ingest for Media Services uses a standard long-running HTTP POST request tootransmit encoded media data that is packaged in fragmented MP4 format toohello service.</span></span> <span data-ttu-id="63133-148">Cada POSTAGEM HTTP envia uma completa fragmentado bits de MP4 ("fluxo"), a partir do início da saudação com caixas de cabeçalho (**ftyp**, **Live Server manifesto caixa**, e **moov** caixas) e continuar com uma sequência de fragmentos (**moof** e **mdat** caixas).</span><span class="sxs-lookup"><span data-stu-id="63133-148">Each HTTP POST sends a complete fragmented MP4 bitstream ("stream"), starting from hello beginning with header boxes (**ftyp**, **Live Server Manifest Box**, and **moov** boxes), and continuing with a sequence of fragments (**moof** and **mdat** boxes).</span></span> <span data-ttu-id="63133-149">Para obter a sintaxe de URL para solicitação de HTTP POST hello, consulte a seção em 9.2 [1].</span><span class="sxs-lookup"><span data-stu-id="63133-149">For URL syntax for hello HTTP POST request, see section 9.2 in [1].</span></span> <span data-ttu-id="63133-150">Um exemplo de hello URL de POST é:</span><span class="sxs-lookup"><span data-stu-id="63133-150">An example of hello POST URL is:</span></span> 

    http://customer.channel.mediaservices.windows.net/ingest.isml/streams(720p)

### <a name="requirements"></a><span data-ttu-id="63133-151">Requisitos</span><span class="sxs-lookup"><span data-stu-id="63133-151">Requirements</span></span>
<span data-ttu-id="63133-152">Aqui estão os requisitos detalhados de hello:</span><span class="sxs-lookup"><span data-stu-id="63133-152">Here are hello detailed requirements:</span></span>

1. <span data-ttu-id="63133-153">Olá codificador deve iniciar Olá difusão enviando uma solicitação HTTP POST com vazio Olá "body" (conteúdo comprimento zero) usando a mesma URL de ingestão.</span><span class="sxs-lookup"><span data-stu-id="63133-153">hello encoder SHOULD start hello broadcast by sending an HTTP POST request with an empty “body” (zero content length) by using hello same ingestion URL.</span></span> <span data-ttu-id="63133-154">Isso pode ajudar o codificador Olá rapidamente detectar se o ponto de extremidade de inclusão dinâmica Olá é válido e se não houver nenhuma autenticação ou outras condições necessárias.</span><span class="sxs-lookup"><span data-stu-id="63133-154">This can help hello encoder quickly detect whether hello live ingestion endpoint is valid, and if there are any authentication or other conditions required.</span></span> <span data-ttu-id="63133-155">Por protocolo HTTP, servidor de saudação não é possível enviar novamente uma resposta HTTP até hello toda solicitação, incluindo o corpo do POST Olá, é recebida.</span><span class="sxs-lookup"><span data-stu-id="63133-155">Per HTTP protocol, hello server can't send back an HTTP response until hello entire request, including hello POST body, is received.</span></span> <span data-ttu-id="63133-156">Considerando a natureza de longa execução Olá de um evento ao vivo, sem essa etapa, o codificador de saudação pode não ser capaz de toodetect qualquer erro até que ele termina de enviar todos os dados de saudação.</span><span class="sxs-lookup"><span data-stu-id="63133-156">Given hello long-running nature of a live event, without this step, hello encoder might not be able toodetect any error until it finishes sending all hello data.</span></span>
2. <span data-ttu-id="63133-157">codificador Olá deve tratar erros ou desafios de autenticação devido a (1).</span><span class="sxs-lookup"><span data-stu-id="63133-157">hello encoder MUST handle any errors or authentication challenges because of (1).</span></span> <span data-ttu-id="63133-158">Se (1) for bem-sucedido com uma resposta 200, continue.</span><span class="sxs-lookup"><span data-stu-id="63133-158">If (1) succeeds with a 200 response, continue.</span></span>
3. <span data-ttu-id="63133-159">codificador Olá deve iniciar uma nova solicitação de HTTP POST com hello fragmentado MP4 fluxo.</span><span class="sxs-lookup"><span data-stu-id="63133-159">hello encoder MUST start a new HTTP POST request with hello fragmented MP4 stream.</span></span> <span data-ttu-id="63133-160">carga Olá deve começar com caixas de cabeçalho hello, seguidas de fragmentos.</span><span class="sxs-lookup"><span data-stu-id="63133-160">hello payload MUST start with hello header boxes, followed by fragments.</span></span> <span data-ttu-id="63133-161">Observe que Olá **ftyp**, **Live Server manifesto caixa**, e **moov** caixas (em ordem) devem ser enviadas com cada solicitação, mesmo que o codificador Olá deve se reconectar porque Olá solicitação anterior foi encerrada toohello anterior final do fluxo de saudação.</span><span class="sxs-lookup"><span data-stu-id="63133-161">Note that hello **ftyp**, **Live Server Manifest Box**, and **moov** boxes (in this order) MUST be sent with each request, even if hello encoder must reconnect because hello previous request was terminated prior toohello end of hello stream.</span></span> 
4. <span data-ttu-id="63133-162">codificador Olá deve usar para carregamento de codificação de transferência em partes, porque é impossível toopredict Olá todo comprimento do conteúdo da saudação de evento ao vivo.</span><span class="sxs-lookup"><span data-stu-id="63133-162">hello encoder MUST use chunked transfer encoding for uploading, because it’s impossible toopredict hello entire content length of hello live event.</span></span>
5. <span data-ttu-id="63133-163">Quando o evento de saudação é, após o envio de fragmento da última Olá, codificador Olá normalmente deve terminar a sequência de mensagem (a maioria das pilhas de cliente HTTP tratá-la automaticamente) de codificação de transferência de saudação em partes.</span><span class="sxs-lookup"><span data-stu-id="63133-163">When hello event is over, after sending hello last fragment, hello encoder MUST gracefully end hello chunked transfer encoding message sequence (most HTTP client stacks handle it automatically).</span></span> <span data-ttu-id="63133-164">codificador Olá deve aguardar o código de resposta final Olá serviço tooreturn hello e, em seguida, encerre a conexão hello.</span><span class="sxs-lookup"><span data-stu-id="63133-164">hello encoder MUST wait for hello service tooreturn hello final response code, and then terminate hello connection.</span></span> 
6. <span data-ttu-id="63133-165">codificador de saudação não deve usar Olá `Events()` substantivo conforme descrito em in 9.2 [1] para inclusão em tempo real em serviços de mídia.</span><span class="sxs-lookup"><span data-stu-id="63133-165">hello encoder MUST NOT use hello `Events()` noun as described in 9.2 in [1] for live ingestion into Media Services.</span></span>
7. <span data-ttu-id="63133-166">Se solicitação de HTTP POST Olá encerra ou horários com extremidade TCP erro toohello anterior do fluxo de saudação codificador Olá deve emitir uma nova solicitação POST usando uma nova conexão e siga Olá requisitos anteriores.</span><span class="sxs-lookup"><span data-stu-id="63133-166">If hello HTTP POST request terminates or times out with a TCP error prior toohello end of hello stream, hello encoder MUST issue a new POST request by using a new connection, and follow hello preceding requirements.</span></span> <span data-ttu-id="63133-167">Além disso, codificador Olá deve reenviar Olá anterior dois fragmentos de MP4 para cada controle no fluxo de saudação e continuar sem introduzir uma descontinuidade na linha do tempo de mídia hello.</span><span class="sxs-lookup"><span data-stu-id="63133-167">Additionally, hello encoder MUST resend hello previous two MP4 fragments for each track in hello stream, and resume without introducing a discontinuity in hello media timeline.</span></span> <span data-ttu-id="63133-168">Reenviar Olá últimos dois fragmentos de MP4 para cada faixa garante que não há nenhuma perda de dados.</span><span class="sxs-lookup"><span data-stu-id="63133-168">Resending hello last two MP4 fragments for each track ensures that there is no data loss.</span></span> <span data-ttu-id="63133-169">Em outras palavras, se um fluxo contém um áudio e uma faixa de vídeo e solicitação POST atual Olá falha, codificador Olá deve se reconectar e reenviar Olá últimos dois fragmentos de faixa de áudio hello, que anteriormente foram enviados com êxito, e Olá últimos dois fragmentos do Olá faixa de vídeo, que foram anteriormente enviado com êxito, tooensure que não há nenhuma perda de dados.</span><span class="sxs-lookup"><span data-stu-id="63133-169">In other words, if a stream contains both an audio and a video track, and hello current POST request fails, hello encoder must reconnect and resend hello last two fragments for hello audio track, which were previously successfully sent, and hello last two fragments for hello video track, which were previously successfully sent, tooensure that there is no data loss.</span></span> <span data-ttu-id="63133-170">codificador Olá deve manter um buffer "forward" de fragmentos de mídia, que reenvia quando ele se reconectar.</span><span class="sxs-lookup"><span data-stu-id="63133-170">hello encoder MUST maintain a “forward” buffer of media fragments, which it resends when it reconnects.</span></span>

## <a name="5-timescale"></a><span data-ttu-id="63133-171">5. Escala de tempo</span><span class="sxs-lookup"><span data-stu-id="63133-171">5. Timescale</span></span>
<span data-ttu-id="63133-172">[[MS-SSTR] ](https://msdn.microsoft.com/library/ff469518.aspx) descreve o uso de saudação da escala de tempo para **SmoothStreamingMedia** (seção 2.2.2.1), **StreamElement** (seção 2.2.2.3), **StreamFragmentElement**(Seção 2.2.2.6), e **LiveSMIL** (seção 2.2.7.3.1).</span><span class="sxs-lookup"><span data-stu-id="63133-172">[[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx) describes hello usage of timescale for **SmoothStreamingMedia** (Section 2.2.2.1), **StreamElement** (Section 2.2.2.3), **StreamFragmentElement** (Section 2.2.2.6), and **LiveSMIL** (Section 2.2.7.3.1).</span></span> <span data-ttu-id="63133-173">Se o valor de escala de tempo de saudação não estiver presente, o valor de padrão de saudação usado é 10.000.000 (MHz 10).</span><span class="sxs-lookup"><span data-stu-id="63133-173">If hello timescale value is not present, hello default value used is 10,000,000 (10 MHz).</span></span> <span data-ttu-id="63133-174">Embora Olá especificação de formato de Smooth Streaming não bloqueia o uso de outros valores de escala de tempo, a maioria das implementações de codificador usar esse padrão toogenerate de valor (10 MHz) Smooth Streaming ingestão de dados.</span><span class="sxs-lookup"><span data-stu-id="63133-174">Although hello Smooth Streaming format specification doesn’t block usage of other timescale values, most encoder implementations use this default value (10 MHz) toogenerate Smooth Streaming ingest data.</span></span> <span data-ttu-id="63133-175">Vencimento toohello [empacotamento dinâmico do Azure Media](media-services-dynamic-packaging-overview.md) recurso, é recomendável que você use uma escala de tempo KHz 90 para fluxos de vídeo e 44,1 KHz ou 48.1 KHz para fluxos de áudio.</span><span class="sxs-lookup"><span data-stu-id="63133-175">Due toohello [Azure Media Dynamic Packaging](media-services-dynamic-packaging-overview.md) feature, we recommend that you use a 90-KHz timescale for video streams and 44.1 KHz or 48.1 KHz for audio streams.</span></span> <span data-ttu-id="63133-176">Se os valores de escala de tempo diferentes são usados para diferentes fluxos, escala de tempo de nível de fluxo Olá deve ser enviada.</span><span class="sxs-lookup"><span data-stu-id="63133-176">If different timescale values are used for different streams, hello stream-level timescale MUST be sent.</span></span> <span data-ttu-id="63133-177">Para obter mais informações, consulte [[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx).</span><span class="sxs-lookup"><span data-stu-id="63133-177">For more information, see [[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx).</span></span>     

## <a name="6-definition-of-stream"></a><span data-ttu-id="63133-178">6. Definição de “fluxo”</span><span class="sxs-lookup"><span data-stu-id="63133-178">6. Definition of “stream”</span></span>
<span data-ttu-id="63133-179">Fluxo é Olá unidade básica da operação de inclusão dinâmica para compor apresentações ao vivo, tratamento de failover de streaming e cenários de redundância.</span><span class="sxs-lookup"><span data-stu-id="63133-179">Stream is hello basic unit of operation in live ingestion for composing live presentations, handling streaming failover, and redundancy scenarios.</span></span> <span data-ttu-id="63133-180">Fluxo é definido como um único fluxo de bits MP4 fragmentado exclusivo que pode conter uma única faixa ou várias faixas.</span><span class="sxs-lookup"><span data-stu-id="63133-180">Stream is defined as one unique, fragmented MP4 bitstream that might contain a single track or multiple tracks.</span></span> <span data-ttu-id="63133-181">Uma apresentação ao vivo completa pode conter um ou mais fluxos, dependendo da configuração de saudação do codificadores ao vivo hello.</span><span class="sxs-lookup"><span data-stu-id="63133-181">A full live presentation might contain one or more streams, depending on hello configuration of hello live encoders.</span></span> <span data-ttu-id="63133-182">Olá exemplos a seguir ilustra várias opções de como usar fluxos toocompose uma apresentação ao vivo completo.</span><span class="sxs-lookup"><span data-stu-id="63133-182">hello following examples illustrate various options of using streams toocompose a full live presentation.</span></span>

<span data-ttu-id="63133-183">**Exemplo:**</span><span class="sxs-lookup"><span data-stu-id="63133-183">**Example:**</span></span> 

<span data-ttu-id="63133-184">Um cliente deseja toocreate uma apresentação de transmissão ao vivo que inclui Olá taxas de bits de áudio/vídeo a seguir:</span><span class="sxs-lookup"><span data-stu-id="63133-184">A customer wants toocreate a live streaming presentation that includes hello following audio/video bitrates:</span></span>

<span data-ttu-id="63133-185">Vídeo – 3000 kbps, 1500 kbps, 750 kbps</span><span class="sxs-lookup"><span data-stu-id="63133-185">Video – 3000 kbps, 1500 kbps, 750 kbps</span></span>

<span data-ttu-id="63133-186">Áudio – 128 kbps</span><span class="sxs-lookup"><span data-stu-id="63133-186">Audio – 128 kbps</span></span>

### <a name="option-1-all-tracks-in-one-stream"></a><span data-ttu-id="63133-187">Opção 1: Todas as faixas em um fluxo</span><span class="sxs-lookup"><span data-stu-id="63133-187">Option 1: All tracks in one stream</span></span>
<span data-ttu-id="63133-188">Nessa opção, um único codificador gera todas as faixas de áudio/vídeo e, em seguida, empacota-los em um fluxo de bits MP4 fragmentado.</span><span class="sxs-lookup"><span data-stu-id="63133-188">In this option, a single encoder generates all audio/video tracks, and then bundles them into one fragmented MP4 bitstream.</span></span> <span data-ttu-id="63133-189">Olá fragmentados MP4 bits é enviado por meio de uma única conexão de HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="63133-189">hello fragmented MP4 bitstream is then sent via a single HTTP POST connection.</span></span> <span data-ttu-id="63133-190">Neste exemplo, há apenas um fluxo para esta apresentação ao vivo.</span><span class="sxs-lookup"><span data-stu-id="63133-190">In this example, there is only one stream for this live presentation.</span></span>

![Fluxos de uma faixa][image2]

### <a name="option-2-each-track-in-a-separate-stream"></a><span data-ttu-id="63133-192">Opção 2: Cada faixa em um fluxo separado</span><span class="sxs-lookup"><span data-stu-id="63133-192">Option 2: Each track in a separate stream</span></span>
<span data-ttu-id="63133-193">Essa opção, codificador Olá coloca uma faixa em cada fragmento MP4 bits e, em seguida, envia todos os fluxos de saudação em conexões de HTTP separadas.</span><span class="sxs-lookup"><span data-stu-id="63133-193">In this option, hello encoder puts one track into each fragment MP4 bitstream, and then posts all of hello streams over separate HTTP connections.</span></span> <span data-ttu-id="63133-194">Isso pode ser feito com um codificador ou com vários codificadores.</span><span class="sxs-lookup"><span data-stu-id="63133-194">This can be done with one encoder or with multiple encoders.</span></span> <span data-ttu-id="63133-195">inclusão dinâmica Olá vê esta apresentação ao vivo como composto por quatro fluxos.</span><span class="sxs-lookup"><span data-stu-id="63133-195">hello live ingestion sees this live presentation as composed of four streams.</span></span>

![Fluxos de faixas separadas][image3]

### <a name="option-3-bundle-audio-track-with-hello-lowest-bitrate-video-track-into-one-stream"></a><span data-ttu-id="63133-197">Opção 3: Agrupar a faixa de áudio com menor faixa de vídeo de taxa de bits Olá em um fluxo</span><span class="sxs-lookup"><span data-stu-id="63133-197">Option 3: Bundle audio track with hello lowest bitrate video track into one stream</span></span>
<span data-ttu-id="63133-198">Essa opção, Prezado cliente escolhe faixa de áudio de saudação do toobundle com a faixa de vídeo de taxa de bits mais baixa Olá em bits de um fragmento MP4 e deixe Olá outras duas faixas de vídeo como fluxos separados.</span><span class="sxs-lookup"><span data-stu-id="63133-198">In this option, hello customer chooses toobundle hello audio track with hello lowest-bitrate video track in one fragment MP4 bitstream, and leave hello other two video tracks as separate streams.</span></span> 

![Fluxos com faixas de áudio e vídeo][image4]

### <a name="summary"></a><span data-ttu-id="63133-200">Resumo</span><span class="sxs-lookup"><span data-stu-id="63133-200">Summary</span></span>
<span data-ttu-id="63133-201">Essa não é uma lista completa de todas as opções possíveis de ingestão para este exemplo.</span><span class="sxs-lookup"><span data-stu-id="63133-201">This is not an exhaustive list of all possible ingestion options for this example.</span></span> <span data-ttu-id="63133-202">Na verdade, qualquer agrupamento de faixas em fluxos tem suporte da ingestão dinâmica.</span><span class="sxs-lookup"><span data-stu-id="63133-202">As a matter of fact, any grouping of tracks into streams is supported by live ingestion.</span></span> <span data-ttu-id="63133-203">Os clientes e fornecedores de codificadores podem escolher suas próprias implementações com base na complexidade de engenharia, na capacidade do codificador e nas considerações de failover e redundância.</span><span class="sxs-lookup"><span data-stu-id="63133-203">Customers and encoder vendors can choose their own implementations based on engineering complexity, encoder capacity, and redundancy and failover considerations.</span></span> <span data-ttu-id="63133-204">No entanto, na maioria dos casos, há apenas uma faixa de áudio para toda a apresentação ao vivo hello.</span><span class="sxs-lookup"><span data-stu-id="63133-204">However, in most cases, there is only one audio track for hello entire live presentation.</span></span> <span data-ttu-id="63133-205">Portanto, é importante tooensure Olá healthiness de saudação ingestão fluxo que contém a faixa de áudio hello. Esta consideração geralmente resulta em colocar a faixa de áudio Olá em seu próprio fluxo (como opção 2) ou agrupando-lo com a faixa de vídeo de taxa de bits mais baixa hello (como a opção 3).</span><span class="sxs-lookup"><span data-stu-id="63133-205">So, it’s important tooensure hello healthiness of hello ingest stream that contains hello audio track. This consideration often results in putting hello audio track in its own stream (as in Option 2) or bundling it with hello lowest-bitrate video track (as in Option 3).</span></span> <span data-ttu-id="63133-206">Além disso, para melhor redundância e tolerância a falhas, enviando Olá mesmo faixa de áudio em dois fluxos diferentes (opção 2 com redundância faixas de áudio) ou a faixa de áudio de saudação empacotamento com pelo menos duas das faixas de vídeo Olá taxas de bits menores (opção 3 com áudio agregado sem pelo menos dois fluxos vídeos) altamente recomendado ao vivo para inclusão nos serviços de mídia.</span><span class="sxs-lookup"><span data-stu-id="63133-206">Also, for better redundancy and fault tolerance, sending hello same audio track in two different streams (Option 2 with redundant audio tracks) or bundling hello audio track with at least two of hello lowest-bitrate video tracks (Option 3 with audio bundled in at least two video streams) is highly recommended for live ingest into Media Services.</span></span>

## <a name="7-service-failover"></a><span data-ttu-id="63133-207">7. Failover de serviço</span><span class="sxs-lookup"><span data-stu-id="63133-207">7. Service failover</span></span>
<span data-ttu-id="63133-208">Fornecido Olá a natureza da transmissão ao vivo, suporte a failover BOM é essencial para garantir a disponibilidade do serviço Olá Olá.</span><span class="sxs-lookup"><span data-stu-id="63133-208">Given hello nature of live streaming, good failover support is critical for ensuring hello availability of hello service.</span></span> <span data-ttu-id="63133-209">Serviços de mídia é projetado toohandle vários tipos de falhas, incluindo erros de rede, erros de servidor e problemas de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="63133-209">Media Services is designed toohandle various types of failures, including network errors, server errors, and storage issues.</span></span> <span data-ttu-id="63133-210">Quando usado em conjunto com a lógica de failover apropriado do lado do codificador dinâmico Olá, os clientes podem obter um serviço de transmissão ao vivo altamente confiável da nuvem de saudação.</span><span class="sxs-lookup"><span data-stu-id="63133-210">When used in conjunction with proper failover logic from hello live encoder side, customers can achieve a highly reliable live streaming service from hello cloud.</span></span>

<span data-ttu-id="63133-211">Nesta seção, abordamos os cenários de failover de serviço.</span><span class="sxs-lookup"><span data-stu-id="63133-211">In this section, we discuss service failover scenarios.</span></span> <span data-ttu-id="63133-212">Nesse caso, falha de saudação acontece em algum lugar no serviço de saudação e se manifesta como um erro de rede.</span><span class="sxs-lookup"><span data-stu-id="63133-212">In this case, hello failure happens somewhere within hello service, and it manifests itself as a network error.</span></span> <span data-ttu-id="63133-213">Aqui estão algumas recomendações para implementação de codificador Olá para lidar com o failover do serviço:</span><span class="sxs-lookup"><span data-stu-id="63133-213">Here are some recommendations for hello encoder implementation for handling service failover:</span></span>

1. <span data-ttu-id="63133-214">Use um tempo limite de 10 segundos para estabelecer a conexão de TCP hello.</span><span class="sxs-lookup"><span data-stu-id="63133-214">Use a 10-second timeout for establishing hello TCP connection.</span></span> <span data-ttu-id="63133-215">Se uma conexão de saudação tooestablish tentativa demora mais do que 10 segundos, anular Olá operação e tente novamente.</span><span class="sxs-lookup"><span data-stu-id="63133-215">If an attempt tooestablish hello connection takes longer than 10 seconds, abort hello operation and try again.</span></span> 
2. <span data-ttu-id="63133-216">Use um tempo limite curto para o envio de fragmentos de mensagem de solicitação de saudação HTTP.</span><span class="sxs-lookup"><span data-stu-id="63133-216">Use a short timeout for sending hello HTTP request message chunks.</span></span> <span data-ttu-id="63133-217">Se duração de fragmento de MP4 de destino Olá N segundos, use um tempo limite de envio entre N e 2 N segundos; Por exemplo, se a duração de fragmento de MP4 Olá é 6 segundos, use um tempo limite de 6 segundos too12.</span><span class="sxs-lookup"><span data-stu-id="63133-217">If hello target MP4 fragment duration is N seconds, use a send timeout between N and 2 N seconds; for example, if hello MP4 fragment duration is 6 seconds, use a timeout of 6 too12 seconds.</span></span> <span data-ttu-id="63133-218">Se ocorrer uma expiração, redefinição Olá conexão, abra uma nova conexão e retomar fluxo de ingestão em conexão nova hello.</span><span class="sxs-lookup"><span data-stu-id="63133-218">If a timeout occurs, reset hello connection, open a new connection, and resume stream ingest on hello new connection.</span></span> 
3. <span data-ttu-id="63133-219">Manter um buffer sem interrupção com hello últimos dois fragmentos para cada faixa com êxito e completamente enviados toohello serviço.</span><span class="sxs-lookup"><span data-stu-id="63133-219">Maintain a rolling buffer that has hello last two fragments for each track that were successfully and completely sent toohello service.</span></span>  <span data-ttu-id="63133-220">Se solicitação de HTTP POST Olá para um fluxo é encerrada ou expira toohello anterior final do fluxo de hello, abra uma nova conexão e começar outra solicitação HTTP POST, reenviar cabeçalhos de fluxo de saudação, reenviar Olá últimos dois fragmentos para cada faixa e retomar o fluxo de saudação sem introduzindo uma descontinuidade na mídia de saudação da linha do tempo.</span><span class="sxs-lookup"><span data-stu-id="63133-220">If hello HTTP POST request for a stream is terminated or times out prior toohello end of hello stream, open a new connection and begin another HTTP POST request, resend hello stream headers, resend hello last two fragments for each track, and resume hello stream without introducing a discontinuity in hello media timeline.</span></span> <span data-ttu-id="63133-221">Isso reduz a chance de saudação de perda de dados.</span><span class="sxs-lookup"><span data-stu-id="63133-221">This reduces hello chance of data loss.</span></span>
4. <span data-ttu-id="63133-222">É recomendável que codificador Olá não limitar o número de saudação de novas tentativas tooestablish uma conexão ou retomar o fluxo contínuo após ocorrer um erro TCP.</span><span class="sxs-lookup"><span data-stu-id="63133-222">We recommend that hello encoder does NOT limit hello number of retries tooestablish a connection or resume streaming after a TCP error occurs.</span></span>
5. <span data-ttu-id="63133-223">Após um erro TCP:</span><span class="sxs-lookup"><span data-stu-id="63133-223">After a TCP error:</span></span>
  
    <span data-ttu-id="63133-224">a.</span><span class="sxs-lookup"><span data-stu-id="63133-224">a.</span></span> <span data-ttu-id="63133-225">Olá atual conexão deve ser fechado e uma nova conexão deve ser criado para uma nova solicitação de HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="63133-225">hello current connection MUST be closed, and a new connection MUST be created for a new HTTP POST request.</span></span>

    <span data-ttu-id="63133-226">b.</span><span class="sxs-lookup"><span data-stu-id="63133-226">b.</span></span> <span data-ttu-id="63133-227">Olá novo HTTP POST URL deve ser Olá mesmo Olá URL inicial da publicação.</span><span class="sxs-lookup"><span data-stu-id="63133-227">hello new HTTP POST URL MUST be hello same as hello initial POST URL.</span></span>
  
    <span data-ttu-id="63133-228">c.</span><span class="sxs-lookup"><span data-stu-id="63133-228">c.</span></span> <span data-ttu-id="63133-229">Hello novo HTTP POST deve incluir cabeçalhos de fluxo (**ftyp**, **Live Server manifesto caixa**, e **moov** caixas) que são idênticos toohello cabeçalhos de fluxo em Olá inicial POST.</span><span class="sxs-lookup"><span data-stu-id="63133-229">hello new HTTP POST MUST include stream headers (**ftyp**, **Live Server Manifest Box**, and **moov** boxes) that are identical toohello stream headers in hello initial POST.</span></span>
  
    <span data-ttu-id="63133-230">d.</span><span class="sxs-lookup"><span data-stu-id="63133-230">d.</span></span> <span data-ttu-id="63133-231">última dois fragmentos de saudação enviados para cada faixa devem ser reenviados e streaming deve continuar sem introduzir uma descontinuidade na mídia de saudação da linha do tempo.</span><span class="sxs-lookup"><span data-stu-id="63133-231">hello last two fragments sent for each track must be resent, and streaming must resume without introducing a discontinuity in hello media timeline.</span></span> <span data-ttu-id="63133-232">Olá MP4 carimbos de hora do fragmento deve aumentar continuamente, mesmo em solicitações HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="63133-232">hello MP4 fragment timestamps must increase continuously, even across HTTP POST requests.</span></span>
6. <span data-ttu-id="63133-233">codificador Olá deve encerrar a solicitação de HTTP POST Olá se os dados não estão sendo enviados a uma taxa proporcional com duração de fragmento de MP4 hello.</span><span class="sxs-lookup"><span data-stu-id="63133-233">hello encoder SHOULD terminate hello HTTP POST request if data is not being sent at a rate commensurate with hello MP4 fragment duration.</span></span>  <span data-ttu-id="63133-234">Uma solicitação HTTP POST que não enviam dados pode impedir que os serviços de mídia rapidamente se desconectar do codificador Olá no evento de saudação de uma atualização de serviço.</span><span class="sxs-lookup"><span data-stu-id="63133-234">An HTTP POST request that does not send data can prevent Media Services from quickly disconnecting from hello encoder in hello event of a service update.</span></span> <span data-ttu-id="63133-235">Por esse motivo, Olá HTTP POST para esparsas rastreia (sinal de anúncio) deve ser curta duração, encerrando como fragmento esparsas Olá é enviado.</span><span class="sxs-lookup"><span data-stu-id="63133-235">For this reason, hello HTTP POST for sparse (ad signal) tracks SHOULD be short-lived, terminating as soon as hello sparse fragment is sent.</span></span>

## <a name="8-encoder-failover"></a><span data-ttu-id="63133-236">8. Failover do codificador</span><span class="sxs-lookup"><span data-stu-id="63133-236">8. Encoder failover</span></span>
<span data-ttu-id="63133-237">Failover de codificador é o segundo tipo de saudação do cenário de failover que precisa toobe endereçado para entrega de streaming ao vivo de ponta a ponta.</span><span class="sxs-lookup"><span data-stu-id="63133-237">Encoder failover is hello second type of failover scenario that needs toobe addressed for end-to-end live streaming delivery.</span></span> <span data-ttu-id="63133-238">Nesse cenário, condição de erro Olá ocorre no lado do codificador hello.</span><span class="sxs-lookup"><span data-stu-id="63133-238">In this scenario, hello error condition occurs on hello encoder side.</span></span> 

![failover do codificador][image5]

<span data-ttu-id="63133-240">Olá expectativas a seguir se aplicam do ponto de extremidade de inclusão dinâmica hello quando ocorre o failover de codificador:</span><span class="sxs-lookup"><span data-stu-id="63133-240">hello following expectations apply from hello live ingestion endpoint when encoder failover happens:</span></span>

1. <span data-ttu-id="63133-241">Uma nova instância do codificador deve ser criada toocontinue streaming, conforme ilustrado no diagrama de saudação (fluxo de 3000k vídeo com linha tracejada).</span><span class="sxs-lookup"><span data-stu-id="63133-241">A new encoder instance SHOULD be created toocontinue streaming, as illustrated in hello diagram (Stream for 3000k video, with dashed line).</span></span>
2. <span data-ttu-id="63133-242">codificador de novo Olá deve usar Olá mesmo solicitações de URL de HTTP POST como Olá Falha na instância.</span><span class="sxs-lookup"><span data-stu-id="63133-242">hello new encoder MUST use hello same URL for HTTP POST requests as hello failed instance.</span></span>
3. <span data-ttu-id="63133-243">Olá POSTAGEM solicitação do codificador nova deve incluir Olá mesmo fragmentado MP4 caixas de cabeçalho como Olá instância com falha.</span><span class="sxs-lookup"><span data-stu-id="63133-243">hello new encoder’s POST request MUST include hello same fragmented MP4 header boxes as hello failed instance.</span></span>
4. <span data-ttu-id="63133-244">codificador novo Olá deve ser sincronizado corretamente com todos os outros codificadores em execução para o mesmo toogenerate de apresentação ao vivo hello sincronizados exemplos de áudio/vídeo com limites de fragmento alinhado.</span><span class="sxs-lookup"><span data-stu-id="63133-244">hello new encoder MUST be properly synced with all other running encoders for hello same live presentation toogenerate synced audio/video samples with aligned fragment boundaries.</span></span>
5. <span data-ttu-id="63133-245">novo fluxo de saudação deve ser semanticamente equivalente ao fluxo de saudação anterior e intercambiáveis nos níveis de cabeçalho e um fragmento de saudação.</span><span class="sxs-lookup"><span data-stu-id="63133-245">hello new stream MUST be semantically equivalent with hello previous stream, and interchangeable at hello header and fragment levels.</span></span>
6. <span data-ttu-id="63133-246">codificador novo Olá deve tentar toominimize perda de dados.</span><span class="sxs-lookup"><span data-stu-id="63133-246">hello new encoder SHOULD try toominimize data loss.</span></span> <span data-ttu-id="63133-247">Olá `fragment_absolute_time` e `fragment_index` da mídia de fragmentos devem aumentar de ponto de saudação onde o codificador Olá última interrupção.</span><span class="sxs-lookup"><span data-stu-id="63133-247">hello `fragment_absolute_time` and `fragment_index` of media fragments SHOULD increase from hello point where hello encoder last stopped.</span></span> <span data-ttu-id="63133-248">Olá `fragment_absolute_time` e `fragment_index` deve aumentar de forma contínua, mas é permitido toointroduce uma descontinuidade, se necessário.</span><span class="sxs-lookup"><span data-stu-id="63133-248">hello `fragment_absolute_time` and `fragment_index` SHOULD increase in a continuous manner, but it is permissible toointroduce a discontinuity, if necessary.</span></span> <span data-ttu-id="63133-249">Serviços de mídia ignora fragmentos que ele já foi recebida e processada, portanto, é melhor tooerr no lado de saudação do reenviar fragmentos que descontinuidades toointroduce na linha de tempo de mídia de saudação.</span><span class="sxs-lookup"><span data-stu-id="63133-249">Media Services ignores fragments that it has already received and processed, so it's better tooerr on hello side of resending fragments than toointroduce discontinuities in hello media timeline.</span></span> 

## <a name="9-encoder-redundancy"></a><span data-ttu-id="63133-250">9. Redundância do codificador</span><span class="sxs-lookup"><span data-stu-id="63133-250">9. Encoder redundancy</span></span>
<span data-ttu-id="63133-251">Para certos eventos importantes ao vivo que demanda ainda maior disponibilidade e experiência de qualidade, recomendamos que você use codificadores redundantes ativo-ativo tooachieve perfeita failover sem perda de dados.</span><span class="sxs-lookup"><span data-stu-id="63133-251">For certain critical live events that demand even higher availability and quality of experience, we recommended that you use active-active redundant encoders tooachieve seamless failover with no data loss.</span></span>

![redundância do codificador][image6]

<span data-ttu-id="63133-253">Conforme ilustrado neste diagrama, dois grupos de codificadores push duas cópias de cada fluxo simultaneamente no serviço de saudação ao vivo.</span><span class="sxs-lookup"><span data-stu-id="63133-253">As illustrated in this diagram, two groups of encoders push two copies of each stream simultaneously into hello live service.</span></span> <span data-ttu-id="63133-254">Essa configuração tem suporte porque os Serviços de Mídia podem filtrar fragmentos duplicados com base na ID do fluxo e no carimbo de data/hora do fragmento.</span><span class="sxs-lookup"><span data-stu-id="63133-254">This setup is supported because Media Services can filter out duplicate fragments based on stream ID and fragment timestamp.</span></span> <span data-ttu-id="63133-255">Olá resultante de transmissão ao vivo e o arquivamento é uma única cópia de todos os fluxos de saudação que é a agregação de possíveis melhor Olá de duas fontes de saudação.</span><span class="sxs-lookup"><span data-stu-id="63133-255">hello resulting live stream and archive is a single copy of all hello streams that is hello best possible aggregation from hello two sources.</span></span> <span data-ttu-id="63133-256">Por exemplo, em casos extremos hipotético, desde que exista um codificador (ele não tem toobe Olá mesmo) em execução em qualquer ponto no tempo para cada fluxo, hello resultante fluxo ao vivo do serviço de saudação é contínuo sem perda de dados.</span><span class="sxs-lookup"><span data-stu-id="63133-256">For example, in a hypothetical extreme case, as long as there is one encoder (it doesn’t have toobe hello same one) running at any given point in time for each stream, hello resulting live stream from hello service is continuous without data loss.</span></span> 

<span data-ttu-id="63133-257">requisitos de saudação para este cenário são quase Olá mesmo como requisitos de saudação em caso de "Failover de codificador" Olá, com exceção de saudação segundo conjunto de saudação de codificadores são executados em Olá a mesma hora como Olá codificadores primários.</span><span class="sxs-lookup"><span data-stu-id="63133-257">hello requirements for this scenario are almost hello same as hello requirements in hello "Encoder failover" case, with hello exception that hello second set of encoders are running at hello same time as hello primary encoders.</span></span>

## <a name="10-service-redundancy"></a><span data-ttu-id="63133-258">10. Redundância de serviço</span><span class="sxs-lookup"><span data-stu-id="63133-258">10. Service redundancy</span></span>
<span data-ttu-id="63133-259">Para distribuição global altamente redundante, às vezes, você deve ter desastres regionais toohandle backup entre regiões.</span><span class="sxs-lookup"><span data-stu-id="63133-259">For highly redundant global distribution, sometimes you must have cross-region backup toohandle regional disasters.</span></span> <span data-ttu-id="63133-260">Expandindo topologia de "Redundância de codificador" Olá, os clientes podem escolher toohave uma implantação do serviço de redundância em uma região diferente que está conectada com o segundo conjunto de saudação de codificadores.</span><span class="sxs-lookup"><span data-stu-id="63133-260">Expanding on hello “Encoder redundancy” topology, customers can choose toohave a redundant service deployment in a different region that's connected with hello second set of encoders.</span></span> <span data-ttu-id="63133-261">Os clientes também podem trabalhar com um provedor de rede de fornecimento de conteúdo toodeploy um Gerenciador de tráfego Global na frente do tráfego de cliente do hello dois serviço implantações tooseamlessly rota.</span><span class="sxs-lookup"><span data-stu-id="63133-261">Customers also can work with a Content Delivery Network provider toodeploy a Global Traffic Manager in front of hello two service deployments tooseamlessly route client traffic.</span></span> <span data-ttu-id="63133-262">requisitos de saudação para codificadores Olá são Olá mesmo Olá caso "Redundância de codificador".</span><span class="sxs-lookup"><span data-stu-id="63133-262">hello requirements for hello encoders are hello same as hello “Encoder redundancy” case.</span></span> <span data-ttu-id="63133-263">Olá apenas a exceção é segundo conjunto de saudação de codificadores necessidades toobe apontada tooa diferente ao vivo ponto de extremidade de ingestão.</span><span class="sxs-lookup"><span data-stu-id="63133-263">hello only exception is that hello second set of encoders needs toobe pointed tooa different live ingest endpoint.</span></span> <span data-ttu-id="63133-264">Olá diagrama a seguir mostra essa configuração:</span><span class="sxs-lookup"><span data-stu-id="63133-264">hello following diagram shows this setup:</span></span>

![redundância de serviço][image7]

## <a name="11-special-types-of-ingestion-formats"></a><span data-ttu-id="63133-266">11. Tipos especiais de formatos de ingestão</span><span class="sxs-lookup"><span data-stu-id="63133-266">11. Special types of ingestion formats</span></span>
<span data-ttu-id="63133-267">Esta seção discute tipos especiais de formatos de inclusão dinâmica cenários específicos toohandle projetado.</span><span class="sxs-lookup"><span data-stu-id="63133-267">This section discusses special types of live ingestion formats that are designed toohandle specific scenarios.</span></span>

### <a name="sparse-track"></a><span data-ttu-id="63133-268">Faixa esparsa</span><span class="sxs-lookup"><span data-stu-id="63133-268">Sparse track</span></span>
<span data-ttu-id="63133-269">Ao realizar uma apresentação de transmissão ao vivo com uma experiência de cliente avançado, geralmente é necessário tootransmit sincronizados com o tempo eventos ou sinaliza em banda com dados de mídia principal hello.</span><span class="sxs-lookup"><span data-stu-id="63133-269">When delivering a live streaming presentation with a rich client experience, often it's necessary tootransmit time-synced events or signals in-band with hello main media data.</span></span> <span data-ttu-id="63133-270">Um exemplo disso é a inserção dinâmica de anúncios em tempo real.</span><span class="sxs-lookup"><span data-stu-id="63133-270">An example of this is dynamic live ad insertion.</span></span> <span data-ttu-id="63133-271">Esse tipo de sinalização de evento é diferente do streaming regular de áudio/vídeo devido à sua natureza esparsa.</span><span class="sxs-lookup"><span data-stu-id="63133-271">This type of event signaling is different from regular audio/video streaming because of its sparse nature.</span></span> <span data-ttu-id="63133-272">Em outras palavras, Olá sinalização de dados normalmente não ocorrem continuamente, e o intervalo de saudação pode ser toopredict de disco rígido.</span><span class="sxs-lookup"><span data-stu-id="63133-272">In other words, hello signaling data usually does not happen continuously, and hello interval can be hard toopredict.</span></span> <span data-ttu-id="63133-273">conceito de saudação de faixa esparsa foi projetado tooingest e dados de sinalização de difusão em banda.</span><span class="sxs-lookup"><span data-stu-id="63133-273">hello concept of sparse track was designed tooingest and broadcast in-band signaling data.</span></span>

<span data-ttu-id="63133-274">Olá, etapas a seguir são uma implementação recomendada para a ingestão de faixa esparsa:</span><span class="sxs-lookup"><span data-stu-id="63133-274">hello following steps are a recommended implementation for ingesting sparse track:</span></span>

1. <span data-ttu-id="63133-275">Crie um fluxo de bits MP4 fragmentado separado que contenha apenas faixas esparsas sem faixas de áudio/vídeo.</span><span class="sxs-lookup"><span data-stu-id="63133-275">Create a separate fragmented MP4 bitstream that contains only sparse tracks, without audio/video tracks.</span></span>
2. <span data-ttu-id="63133-276">Em Olá **Live Server manifesto caixa** conforme definido na seção 6 em [1], use Olá *parentTrackName* nome do parâmetro toospecify Olá da faixa de pai hello. Para saber mais, consulte a Seção 4.2.1.2.1.2 em [1].</span><span class="sxs-lookup"><span data-stu-id="63133-276">In hello **Live Server Manifest Box** as defined in Section 6 in [1], use hello *parentTrackName* parameter toospecify hello name of hello parent track. For more information, see section 4.2.1.2.1.2 in [1].</span></span>
3. <span data-ttu-id="63133-277">Em Olá **Live Server manifesto caixa**, **manifestOutput** deve ser definido muito**true**.</span><span class="sxs-lookup"><span data-stu-id="63133-277">In hello **Live Server Manifest Box**, **manifestOutput** MUST be set too**true**.</span></span>
4. <span data-ttu-id="63133-278">Devido a natureza esparsas Olá Olá sinalização de evento, é recomendável seguir hello:</span><span class="sxs-lookup"><span data-stu-id="63133-278">Given hello sparse nature of hello signaling event, we recommended hello following:</span></span>
   
    <span data-ttu-id="63133-279">a.</span><span class="sxs-lookup"><span data-stu-id="63133-279">a.</span></span> <span data-ttu-id="63133-280">No início de saudação do evento ao vivo hello, codificador Olá envia caixas de cabeçalho inicial Olá toohello serviço, que permite que a faixa esparsa do Olá Olá serviço tooregister no manifesto do cliente hello.</span><span class="sxs-lookup"><span data-stu-id="63133-280">At hello beginning of hello live event, hello encoder sends hello initial header boxes toohello service, which allows hello service tooregister hello sparse track in hello client manifest.</span></span>
   
    <span data-ttu-id="63133-281">b.</span><span class="sxs-lookup"><span data-stu-id="63133-281">b.</span></span> <span data-ttu-id="63133-282">codificador Olá deve encerrar a solicitação de HTTP POST hello quando dados não estão sendo enviados.</span><span class="sxs-lookup"><span data-stu-id="63133-282">hello encoder SHOULD terminate hello HTTP POST request when data is not being sent.</span></span> <span data-ttu-id="63133-283">Um POST HTTP de longa execução que não enviam dados pode impedir que os serviços de mídia rapidamente se desconectar do codificador Olá no evento de saudação de uma reinicialização do serviço servidor ou de atualização.</span><span class="sxs-lookup"><span data-stu-id="63133-283">A long-running HTTP POST that does not send data can prevent Media Services from quickly disconnecting from hello encoder in hello event of a service update or server reboot.</span></span> <span data-ttu-id="63133-284">Nesses casos, o servidor de mídia hello está temporariamente bloqueado em uma operação de recebimento no soquete hello.</span><span class="sxs-lookup"><span data-stu-id="63133-284">In these cases, hello media server is temporarily blocked in a receive operation on hello socket.</span></span>
   
    <span data-ttu-id="63133-285">c.</span><span class="sxs-lookup"><span data-stu-id="63133-285">c.</span></span> <span data-ttu-id="63133-286">Durante o tempo de saudação quando sinalização de dados não está disponível, codificador Olá deve fechar a solicitação de HTTP POST hello.</span><span class="sxs-lookup"><span data-stu-id="63133-286">During hello time when signaling data is not available, hello encoder SHOULD close hello HTTP POST request.</span></span> <span data-ttu-id="63133-287">Enquanto a solicitação POST Olá estiver ativa, o codificador de saudação deve enviar os dados.</span><span class="sxs-lookup"><span data-stu-id="63133-287">While hello POST request is active, hello encoder SHOULD send data.</span></span>

    <span data-ttu-id="63133-288">d.</span><span class="sxs-lookup"><span data-stu-id="63133-288">d.</span></span> <span data-ttu-id="63133-289">Ao enviar fragmentos esparsos, codificador Olá pode definir um cabeçalho de content-length explícito, se estiver disponível.</span><span class="sxs-lookup"><span data-stu-id="63133-289">When sending sparse fragments, hello encoder can set an explicit content-length header, if it’s available.</span></span>

    <span data-ttu-id="63133-290">e.</span><span class="sxs-lookup"><span data-stu-id="63133-290">e.</span></span> <span data-ttu-id="63133-291">Ao enviar esparsos fragmentos com uma nova conexão, codificador Olá deve começar a enviar de saudação cabeçalho seguido por fragmentos novo hello.</span><span class="sxs-lookup"><span data-stu-id="63133-291">When sending sparse fragments with a new connection, hello encoder SHOULD start sending from hello header boxes, followed by hello new fragments.</span></span> <span data-ttu-id="63133-292">Isso é para casos no qual o failover ocorre nesse meio e conexão esparsos do novo hello está sendo estabelecida tooa novo servidor que não viu a faixa esparsa Olá antes.</span><span class="sxs-lookup"><span data-stu-id="63133-292">This is for cases in which failover happens in-between, and hello new sparse connection is being established tooa new server that has not seen hello sparse track before.</span></span>

    <span data-ttu-id="63133-293">f.</span><span class="sxs-lookup"><span data-stu-id="63133-293">f.</span></span> <span data-ttu-id="63133-294">fragmento de faixa esparsa Olá torna-se disponível toohello cliente quando Olá pai acompanhar fragmento correspondente que tem um valor de carimbo de hora igual ou maior é feito cliente toohello disponíveis.</span><span class="sxs-lookup"><span data-stu-id="63133-294">hello sparse track fragment becomes available toohello client when hello corresponding parent track fragment that has an equal or larger timestamp value is made available toohello client.</span></span> <span data-ttu-id="63133-295">Por exemplo, se o fragmento esparsas Olá tem um carimbo de hora de t = 1000, espera-se que depois que o cliente Olá vê timestamp 1000 de fragmento "vídeo" (supondo que o nome da faixa Olá pai é "vídeo") ou posterior, ele pode baixar Olá fragmento esparsas t = 1000.</span><span class="sxs-lookup"><span data-stu-id="63133-295">For example, if hello sparse fragment has a timestamp of t=1000, it is expected that after hello client sees "video" (assuming hello parent track name is "video") fragment timestamp 1000 or beyond, it can download hello sparse fragment t=1000.</span></span> <span data-ttu-id="63133-296">Observe que Olá sinal real pode ser usado para uma posição diferente na linha de tempo de apresentação de saudação para sua finalidade designada.</span><span class="sxs-lookup"><span data-stu-id="63133-296">Note that hello actual signal could be used for a different position in hello presentation timeline for its designated purpose.</span></span> <span data-ttu-id="63133-297">Neste exemplo, ele do possíveis que Olá esparso fragmento de t = 1000 tem uma carga XML, que é para inserir um anúncio em uma posição de alguns segundos mais tarde.</span><span class="sxs-lookup"><span data-stu-id="63133-297">In this example, it’s possible that hello sparse fragment of t=1000 has an XML payload, which is for inserting an ad in a position that’s a few seconds later.</span></span>

    <span data-ttu-id="63133-298">g.</span><span class="sxs-lookup"><span data-stu-id="63133-298">g.</span></span> <span data-ttu-id="63133-299">carga de saudação de fragmentos de faixa esparsa pode ser em formatos diferentes (como XML, texto ou binário), dependendo do cenário de saudação.</span><span class="sxs-lookup"><span data-stu-id="63133-299">hello payload of sparse track fragments can be in different formats (such as XML, text, or binary), depending on hello scenario.</span></span>

### <a name="redundant-audio-track"></a><span data-ttu-id="63133-300">Faixa de áudio redundante</span><span class="sxs-lookup"><span data-stu-id="63133-300">Redundant audio track</span></span>
<span data-ttu-id="63133-301">Em um HTTP adaptive streaming cenário típico (por exemplo, Smooth Streaming ou traço), muitas vezes, há apenas uma faixa de áudio em toda a apresentação hello.</span><span class="sxs-lookup"><span data-stu-id="63133-301">In a typical HTTP adaptive streaming scenario (for example, Smooth Streaming or DASH), often, there's only one audio track in hello entire presentation.</span></span> <span data-ttu-id="63133-302">Ao contrário de faixas de vídeo, que têm vários níveis de qualidade para toochoose de cliente de saudação em condições de erro, faixa de áudio Olá pode ser um ponto único de falha se hello inclusão de fluxo de saudação que contém a faixa de áudio Olá for interrompida.</span><span class="sxs-lookup"><span data-stu-id="63133-302">Unlike video tracks, which have multiple quality levels for hello client toochoose from in error conditions, hello audio track can be a single point of failure if hello ingestion of hello stream that contains hello audio track is broken.</span></span> 

<span data-ttu-id="63133-303">toosolve oferece suporte a esse problema, os serviços de mídia ao vivo a inclusão de faixas de áudio redundantes.</span><span class="sxs-lookup"><span data-stu-id="63133-303">toosolve this problem, Media Services supports live ingestion of redundant audio tracks.</span></span> <span data-ttu-id="63133-304">Olá, trata-que Olá mesmo faixa de áudio pode ser enviada várias vezes em diferentes fluxos.</span><span class="sxs-lookup"><span data-stu-id="63133-304">hello idea is that hello same audio track can be sent multiple times in different streams.</span></span> <span data-ttu-id="63133-305">Embora hello serviço apenas registra faixa de áudio Olá uma vez no manifesto do cliente hello, ele pode usar faixas de áudio redundantes como backups para recuperar fragmentos de áudio se faixa de áudio principal Olá tem problemas.</span><span class="sxs-lookup"><span data-stu-id="63133-305">Although hello service only registers hello audio track once in hello client manifest, it can use redundant audio tracks as backups for retrieving audio fragments if hello primary audio track has issues.</span></span> <span data-ttu-id="63133-306">faixas de áudio de tooingest redundantes, codificador Olá precisa:</span><span class="sxs-lookup"><span data-stu-id="63133-306">tooingest redundant audio tracks, hello encoder needs to:</span></span>

1. <span data-ttu-id="63133-307">Crie hello faixa de áudio mesmo fragmento vários bitstreams MP4.</span><span class="sxs-lookup"><span data-stu-id="63133-307">Create hello same audio track in multiple fragment MP4 bitstreams.</span></span> <span data-ttu-id="63133-308">faixas de áudio redundantes Olá devem ser equivalentes semanticamente, com hello mesmo fragmentar os carimbos de hora e ser intercambiáveis no cabeçalho hello e níveis de fragmento.</span><span class="sxs-lookup"><span data-stu-id="63133-308">hello redundant audio tracks MUST be semantically equivalent, with hello same fragment timestamps, and be interchangeable at hello header and fragment levels.</span></span>
2. <span data-ttu-id="63133-309">Certifique-se de entrada "áudio" hello em Olá Live Server manifesto (seção 6 em [1]) é hello mesmo para redundância todas as faixas de áudio.</span><span class="sxs-lookup"><span data-stu-id="63133-309">Ensure that hello “audio” entry in hello Live Server Manifest (Section 6 in [1]) is hello same for all redundant audio tracks.</span></span>

<span data-ttu-id="63133-310">Olá implementação a seguir é recomendado para faixas de áudio redundantes:</span><span class="sxs-lookup"><span data-stu-id="63133-310">hello following implementation is recommended for redundant audio tracks:</span></span>

1. <span data-ttu-id="63133-311">Envie cada faixa de áudio exclusiva em um fluxo por si só.</span><span class="sxs-lookup"><span data-stu-id="63133-311">Send each unique audio track in a stream by itself.</span></span> <span data-ttu-id="63133-312">Além disso, enviar um fluxo redundante para cada um desses fluxos de faixa de áudio, onde a segundo fluxo de saudação difere de saudação somente por identificador Olá Olá URL de POSTAGEM HTTP: {protocolo} :// {endereço do servidor} / {path}/Streams({identifier}) de ponto de publicação.</span><span class="sxs-lookup"><span data-stu-id="63133-312">Also, send a redundant stream for each of these audio track streams, where hello second stream differs from hello first only by hello identifier in hello HTTP POST URL: {protocol}://{server address}/{publishing point path}/Streams({identifier}).</span></span>
2. <span data-ttu-id="63133-313">Use fluxos separados toosend Olá dois menores vídeo taxas de bits.</span><span class="sxs-lookup"><span data-stu-id="63133-313">Use separate streams toosend hello two lowest video bitrates.</span></span> <span data-ttu-id="63133-314">Cada um desses fluxos também DEVE conter uma cópia de cada faixa de áudio exclusiva. Por exemplo, quando há suporte para vários idiomas, esses fluxos DEVEM conter faixas de áudio para cada idioma.</span><span class="sxs-lookup"><span data-stu-id="63133-314">Each of these streams SHOULD also contain a copy of each unique audio track. For example, when multiple languages are supported, these streams SHOULD contain audio tracks for each language.</span></span>
3. <span data-ttu-id="63133-315">Usar tooencode de instâncias de servidor separados (codificador) e enviar fluxos de redundância Olá mencionados em (1) e (2).</span><span class="sxs-lookup"><span data-stu-id="63133-315">Use separate server (encoder) instances tooencode and send hello redundant streams mentioned in (1) and (2).</span></span> 

## <a name="media-services-learning-paths"></a><span data-ttu-id="63133-316">Roteiros de aprendizagem dos Serviços de Mídia</span><span class="sxs-lookup"><span data-stu-id="63133-316">Media Services learning paths</span></span>
[!INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

## <a name="provide-feedback"></a><span data-ttu-id="63133-317">Fornecer comentários</span><span class="sxs-lookup"><span data-stu-id="63133-317">Provide feedback</span></span>
[!INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]

[image1]: ./media/media-services-fmp4-live-ingest-overview/media-services-image1.png
[image2]: ./media/media-services-fmp4-live-ingest-overview/media-services-image2.png
[image3]: ./media/media-services-fmp4-live-ingest-overview/media-services-image3.png
[image4]: ./media/media-services-fmp4-live-ingest-overview/media-services-image4.png
[image5]: ./media/media-services-fmp4-live-ingest-overview/media-services-image5.png
[image6]: ./media/media-services-fmp4-live-ingest-overview/media-services-image6.png
[image7]: ./media/media-services-fmp4-live-ingest-overview/media-services-image7.png
