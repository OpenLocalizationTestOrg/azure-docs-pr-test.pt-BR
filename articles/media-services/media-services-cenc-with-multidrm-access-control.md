---
title: "CENC com Vários DRMs e Controle de Acesso: um Design e Implementação de Referência no Azure e nos Serviços de Mídia do Azure | Microsoft Docs"
description: "Saiba mais sobre como toolicensing Olá Microsoft® Smooth Streaming Client Porting Kit."
services: media-services
documentationcenter: 
author: willzhan
manager: cfowler
editor: 
ms.assetid: 7814739b-cea9-4b9b-8370-538702e5c615
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/19/2017
ms.author: willzhan;kilroyh;yanmf;juliako
ms.openlocfilehash: 033fb618650c4fbe9069d467159a8734da759bba
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="cenc-with-multi-drm-and-access-control-a-reference-design-and-implementation-on-azure-and-azure-media-services"></a><span data-ttu-id="f1a36-103">CENC com vários DRM e Controle de Acesso: design e implementação de referência no Azure e nos Serviços de Mídia do Azure</span><span class="sxs-lookup"><span data-stu-id="f1a36-103">CENC with Multi-DRM and Access Control: A Reference Design and Implementation on Azure and Azure Media Services</span></span>
 
## <a name="introduction"></a><span data-ttu-id="f1a36-104">Introdução</span><span class="sxs-lookup"><span data-stu-id="f1a36-104">Introduction</span></span>
<span data-ttu-id="f1a36-105">É bem conhecido que é uma tarefa complexa toodesign e criar um subsistema DRM para um OTT ou online de solução de streaming.</span><span class="sxs-lookup"><span data-stu-id="f1a36-105">It is well known that it is a complex task toodesign and build a DRM subsystem for an OTT or online streaming solution.</span></span> <span data-ttu-id="f1a36-106">E é um comum prática para operadores/online toooutsource de provedores de vídeo provedores de serviço essa parte toospecialized DRM.</span><span class="sxs-lookup"><span data-stu-id="f1a36-106">And it is a common practice for operators/online video providers toooutsource this part toospecialized DRM service providers.</span></span> <span data-ttu-id="f1a36-107">meta de saudação deste documento é toopresent um design de referência e a implementação do subsistema de ponta a ponta DRM OTT ou solução de streaming on-line.</span><span class="sxs-lookup"><span data-stu-id="f1a36-107">hello goal of this document is toopresent a reference design and implementation of end-to-end DRM subsystem in OTT or online streaming solution.</span></span>

<span data-ttu-id="f1a36-108">os leitores Olá alvo deste documento são engenheiros trabalhando no subsistema DRM do OTT streaming/multi-screen soluções online ou qualquer leitores interessados no subsistema DRM.</span><span class="sxs-lookup"><span data-stu-id="f1a36-108">hello targeted readers of this document are engineers working in DRM subsystem of OTT or online streaming/multi-screen solutions, or any readers interested in DRM subsystem.</span></span> <span data-ttu-id="f1a36-109">Olá pressupõe-se que os leitores esteja familiarizados com pelo menos uma das tecnologias DRM Olá no mercado hello, como o PlayReady, Widevine, FairPlay ou Adobe acesso.</span><span class="sxs-lookup"><span data-stu-id="f1a36-109">hello assumption is that readers are familiar with at least one of hello DRM technologies on hello market, such as PlayReady, Widevine, FairPlay or Adobe Access.</span></span>

<span data-ttu-id="f1a36-110">Em relação a DRM, também incluímos CENC (criptografia comum) com vários DRM.</span><span class="sxs-lookup"><span data-stu-id="f1a36-110">By DRM, we also include CENC (Common Encryption) with multi-DRM.</span></span> <span data-ttu-id="f1a36-111">Uma tendência principais na transmissão online e do setor OTT é toouse CENC com multi-native-DRM em várias plataformas de cliente, que é uma mudança de tendência anterior de saudação do uso de um único DRM e o SDK de cliente para várias plataformas de cliente.</span><span class="sxs-lookup"><span data-stu-id="f1a36-111">A major trend in online streaming and OTT industry is toouse CENC with multi-native-DRM on various client platforms, which is a shift from hello previous trend of using a single DRM and its client SDK for various client platforms.</span></span> <span data-ttu-id="f1a36-112">Ao usar CENC com vários native DRM, PlayReady e Widevine são criptografados por Olá [criptografia comum (ISO/IEC 23001-7 CENC)](http://www.iso.org/iso/home/store/catalogue_ics/catalogue_detail_ics.htm?csnumber=65271/) especificação.</span><span class="sxs-lookup"><span data-stu-id="f1a36-112">When using CENC with multi-native-DRM, both PlayReady and Widevine are encrypted per hello [Common Encryption (ISO/IEC 23001-7 CENC)](http://www.iso.org/iso/home/store/catalogue_ics/catalogue_detail_ics.htm?csnumber=65271/) specification.</span></span>

<span data-ttu-id="f1a36-113">benefícios de saudação do CENC com DRM de vários são da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="f1a36-113">hello benefits of CENC with multi-DRM are as follows:</span></span>

1. <span data-ttu-id="f1a36-114">Reduz o custo de criptografia, já que um único processo de criptografia é usado para diferentes plataformas e seus DRMs nativos;</span><span class="sxs-lookup"><span data-stu-id="f1a36-114">Reduces encryption cost since a single encryption processing is used targeting different platforms with its native DRMs;</span></span>
2. <span data-ttu-id="f1a36-115">Reduz o custo de saudação do gerenciamento de ativos criptografados como uma única cópia de ativos criptografados não é necessário;</span><span class="sxs-lookup"><span data-stu-id="f1a36-115">Reduces hello cost of managing encrypted assets since only a single copy of encrypted assets is needed;</span></span>
3. <span data-ttu-id="f1a36-116">Elimina o custo de licenciamento desde Olá native client DRM é geralmente livre em sua plataforma nativo de clientes do DRM.</span><span class="sxs-lookup"><span data-stu-id="f1a36-116">Eliminates DRM client licensing cost since hello native DRM client is usually free on its native platform.</span></span>

<span data-ttu-id="f1a36-117">A Microsoft sempre promoveu ativamente DASH e CENC juntamente com alguns principais vetores da indústria.</span><span class="sxs-lookup"><span data-stu-id="f1a36-117">Microsoft has been an active promoter of DASH and CENC together with some major industry players.</span></span> <span data-ttu-id="f1a36-118">Os Serviços de Mídia do Microsoft Azure dão suporte a DASH e a CENC.</span><span class="sxs-lookup"><span data-stu-id="f1a36-118">Microsoft Azure Media Services has been providing support of DASH and CENC.</span></span> <span data-ttu-id="f1a36-119">Para obter comunicados recentes, confira os blogs da Mingfei: [Announcing Google Widevine license delivery services in Azure Media Services](https://azure.microsoft.com/blog/announcing-general-availability-of-google-widevine-license-services/) (Anunciando os serviços de entrega da licença Google Widevine nos Serviços de Mídia do Azure) e [Azure Media Services adds Google Widevine packaging for delivering multi-DRM stream](https://azure.microsoft.com/blog/azure-media-services-adds-google-widevine-packaging-for-delivering-multi-drm-stream/) (Serviços de Mídia do Azure adiciona pacote do Google Widevine para fornecer fluxo de vários DRMs).</span><span class="sxs-lookup"><span data-stu-id="f1a36-119">For recent announcements, please see Mingfei’s blogs: [Announcing Google Widevine license delivery services in Azure Media Services](https://azure.microsoft.com/blog/announcing-general-availability-of-google-widevine-license-services/), and [Azure Media Services adds Google Widevine packaging for delivering multi-DRM stream](https://azure.microsoft.com/blog/azure-media-services-adds-google-widevine-packaging-for-delivering-multi-drm-stream/).</span></span>  

### <a name="overview-of-this-article"></a><span data-ttu-id="f1a36-120">Visão geral deste artigo</span><span class="sxs-lookup"><span data-stu-id="f1a36-120">Overview of this article</span></span>
<span data-ttu-id="f1a36-121">objetivo Olá deste artigo inclui o seguinte hello:</span><span class="sxs-lookup"><span data-stu-id="f1a36-121">hello goal of this article includes hello following:</span></span>

1. <span data-ttu-id="f1a36-122">Fornece um design de referência do subsistema DRM usando CENC com vários DRM;</span><span class="sxs-lookup"><span data-stu-id="f1a36-122">Provides a reference design of DRM subsystem using CENC with multi-DRM;</span></span>
2. <span data-ttu-id="f1a36-123">Fornece uma implementação de referência na plataforma Microsoft Azure/Serviços de Mídia do Azure;</span><span class="sxs-lookup"><span data-stu-id="f1a36-123">Provides a reference implementation on Microsoft Azure/Azure Media Services platform;</span></span>
3. <span data-ttu-id="f1a36-124">Analisa alguns tópicos de design e implementação.</span><span class="sxs-lookup"><span data-stu-id="f1a36-124">Discusses some design and implementation topics.</span></span>

<span data-ttu-id="f1a36-125">Artigo Olá, "multi-DRM" aborda a seguir hello:</span><span class="sxs-lookup"><span data-stu-id="f1a36-125">In hello article, “multi-DRM” covers hello following:</span></span>

1. <span data-ttu-id="f1a36-126">Microsoft PlayReady</span><span class="sxs-lookup"><span data-stu-id="f1a36-126">Microsoft PlayReady</span></span>
2. <span data-ttu-id="f1a36-127">Google Widevine</span><span class="sxs-lookup"><span data-stu-id="f1a36-127">Google Widevine</span></span>
3. <span data-ttu-id="f1a36-128">Apple FairPlay</span><span class="sxs-lookup"><span data-stu-id="f1a36-128">Apple FairPlay</span></span> 

<span data-ttu-id="f1a36-129">Hello tabela a seguir resume os aplicativos de plataforma nativo/nativo hello e navegadores compatíveis com cada DRM.</span><span class="sxs-lookup"><span data-stu-id="f1a36-129">hello following table summarizes hello native platform/native app, and browsers supported by each DRM.</span></span>

| <span data-ttu-id="f1a36-130">**Plataforma cliente**</span><span class="sxs-lookup"><span data-stu-id="f1a36-130">**Client Platform**</span></span> | <span data-ttu-id="f1a36-131">**Suporte nativo ao DRM**</span><span class="sxs-lookup"><span data-stu-id="f1a36-131">**Native DRM Support**</span></span> | <span data-ttu-id="f1a36-132">**Navegador/aplicativo**</span><span class="sxs-lookup"><span data-stu-id="f1a36-132">**Browser/App**</span></span> | <span data-ttu-id="f1a36-133">**Formatos de streaming**</span><span class="sxs-lookup"><span data-stu-id="f1a36-133">**Streaming Formats**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="f1a36-134">**Smart TVs, STBs de operador, STBs OTT**</span><span class="sxs-lookup"><span data-stu-id="f1a36-134">**Smart TVs, operator STBs, OTT STBs**</span></span> |<span data-ttu-id="f1a36-135">Basicamente PlayReady e/ou Widevine e/ou outros</span><span class="sxs-lookup"><span data-stu-id="f1a36-135">PlayReady primarily, and/or Widevine, and/or other</span></span> |<span data-ttu-id="f1a36-136">Linux, Opera, WebKit, outros</span><span class="sxs-lookup"><span data-stu-id="f1a36-136">Linux, Opera, WebKit, Other</span></span> |<span data-ttu-id="f1a36-137">Vários formatos</span><span class="sxs-lookup"><span data-stu-id="f1a36-137">Various formats</span></span> |
| <span data-ttu-id="f1a36-138">**Dispositivos com Windows 10 (computadores Windows, tablets Windows, Windows Phone, Xbox)**</span><span class="sxs-lookup"><span data-stu-id="f1a36-138">**Windows 10 devices (Windows PC, Windows Tablets, Windows Phone, Xbox)**</span></span> |<span data-ttu-id="f1a36-139">PlayReady</span><span class="sxs-lookup"><span data-stu-id="f1a36-139">PlayReady</span></span> |<span data-ttu-id="f1a36-140">MS Edge/IE11/EME</span><span class="sxs-lookup"><span data-stu-id="f1a36-140">MS Edge/IE11/EME</span></span><br/><br/><br/><span data-ttu-id="f1a36-141">UWP</span><span class="sxs-lookup"><span data-stu-id="f1a36-141">UWP</span></span> |<span data-ttu-id="f1a36-142">DASH (No HLS, o PlayReady não tem suporte)</span><span class="sxs-lookup"><span data-stu-id="f1a36-142">DASH (For HLS, PlayReady is not supported)</span></span><br/><br/><span data-ttu-id="f1a36-143">DASH, Smooth Streaming (No HLS, o PlayReady não tem suporte)</span><span class="sxs-lookup"><span data-stu-id="f1a36-143">DASH, Smooth Streaming (For HLS, PlayReady is not supported)</span></span> |
| <span data-ttu-id="f1a36-144">**Dispositivos com Android (telefone, tablet, TV)**</span><span class="sxs-lookup"><span data-stu-id="f1a36-144">**Android devices (Phone, Tablet, TV)**</span></span> |<span data-ttu-id="f1a36-145">Widevine</span><span class="sxs-lookup"><span data-stu-id="f1a36-145">Widevine</span></span> |<span data-ttu-id="f1a36-146">Chrome/EME</span><span class="sxs-lookup"><span data-stu-id="f1a36-146">Chrome/EME</span></span> |<span data-ttu-id="f1a36-147">DASH, HLS</span><span class="sxs-lookup"><span data-stu-id="f1a36-147">DASH,HLS</span></span> |
| <span data-ttu-id="f1a36-148">**iOS (iPhone, iPad), clientes OS X e Apple TV**</span><span class="sxs-lookup"><span data-stu-id="f1a36-148">**iOS (iPhone, iPad), OS X clients and Apple TV**</span></span> |<span data-ttu-id="f1a36-149">FairPlay</span><span class="sxs-lookup"><span data-stu-id="f1a36-149">FairPlay</span></span> |<span data-ttu-id="f1a36-150">Safari 8+/EME</span><span class="sxs-lookup"><span data-stu-id="f1a36-150">Safari 8+/EME</span></span> |<span data-ttu-id="f1a36-151">HLS</span><span class="sxs-lookup"><span data-stu-id="f1a36-151">HLS</span></span> |


<span data-ttu-id="f1a36-152">Considerando o estado atual de saudação de implantação para cada DRM, um serviço normalmente deseja tooimplement 2 ou 3 DRMs toomake-se de que você resolver todos os tipos de saudação de pontos de extremidade no hello melhor maneira.</span><span class="sxs-lookup"><span data-stu-id="f1a36-152">Considering hello current state of deployment for each DRM, a service will typically want tooimplement 2 or 3 DRMs toomake sure you address all hello types of endpoints in hello best way.</span></span>

<span data-ttu-id="f1a36-153">Há um equilíbrio entre a complexidade de saudação da lógica do serviço hello e experiência de complexidade de saudação em Olá cliente lado tooreach um determinado nível de usuário em hello vários clientes.</span><span class="sxs-lookup"><span data-stu-id="f1a36-153">There is a tradeoff between hello complexity of hello service logic and hello complexity on hello client side tooreach a certain level of user experience on hello various clients.</span></span>

<span data-ttu-id="f1a36-154">toomake sua seleção, tenha em mente esses fatos:</span><span class="sxs-lookup"><span data-stu-id="f1a36-154">toomake your selection, keep in mind these facts:</span></span>

* <span data-ttu-id="f1a36-155">O PlayReady é nativamente implementado em cada dispositivo com Windows, em alguns dispositivos com Android e está disponível em SDKs de software em praticamente qualquer plataforma</span><span class="sxs-lookup"><span data-stu-id="f1a36-155">PlayReady is natively implemented in every Windows device, on some Android devices, and available through software SDKs on virtually any platform</span></span>
* <span data-ttu-id="f1a36-156">O Widevine é nativamente implementado em cada dispositivo com Android, Chrome e alguns outros dispositivos</span><span class="sxs-lookup"><span data-stu-id="f1a36-156">Widevine is natively implemented in every Android device, in Chrome, and in some other devices</span></span>
* <span data-ttu-id="f1a36-157">O FairPlay está disponível apenas em clientes iOS e Mac OS, ou no iTunes.</span><span class="sxs-lookup"><span data-stu-id="f1a36-157">FairPlay is available only on iOS and Mac OS clients or through iTunes.</span></span>

<span data-ttu-id="f1a36-158">Portanto, um típico DRM variado seria:</span><span class="sxs-lookup"><span data-stu-id="f1a36-158">So a typical multi-DRM would be:</span></span>

* <span data-ttu-id="f1a36-159">Opção 1: PlayReady e Widevine</span><span class="sxs-lookup"><span data-stu-id="f1a36-159">Option 1: PlayReady and Widevine</span></span>
* <span data-ttu-id="f1a36-160">Opção 2: PlayReady, Widevine e FairPlay</span><span class="sxs-lookup"><span data-stu-id="f1a36-160">Option 2: PlayReady, Widevine and FairPlay</span></span>

## <a name="a-reference-design"></a><span data-ttu-id="f1a36-161">Um design de referência</span><span class="sxs-lookup"><span data-stu-id="f1a36-161">A reference design</span></span>
<span data-ttu-id="f1a36-162">Nesta seção, vamos apresentar um design de referência que é desconhecido tootechnologies usado tooimplement-lo.</span><span class="sxs-lookup"><span data-stu-id="f1a36-162">In this section, we will present a reference design which is agnostic tootechnologies used tooimplement it.</span></span>

<span data-ttu-id="f1a36-163">Um subsistema DRM pode conter Olá componentes a seguir:</span><span class="sxs-lookup"><span data-stu-id="f1a36-163">A DRM subsystem may contain hello following components:</span></span>

1. <span data-ttu-id="f1a36-164">Gerenciamento de chaves</span><span class="sxs-lookup"><span data-stu-id="f1a36-164">Key management</span></span>
2. <span data-ttu-id="f1a36-165">Empacotamento de DRM</span><span class="sxs-lookup"><span data-stu-id="f1a36-165">DRM packaging</span></span>
3. <span data-ttu-id="f1a36-166">Entrega de licença do DRM</span><span class="sxs-lookup"><span data-stu-id="f1a36-166">DRM license delivery</span></span>
4. <span data-ttu-id="f1a36-167">Verificação de autorização</span><span class="sxs-lookup"><span data-stu-id="f1a36-167">Entitlement check</span></span>
5. <span data-ttu-id="f1a36-168">Autenticação/autorização</span><span class="sxs-lookup"><span data-stu-id="f1a36-168">Authentication/authorization</span></span>
6. <span data-ttu-id="f1a36-169">Jogador</span><span class="sxs-lookup"><span data-stu-id="f1a36-169">Player</span></span>
7. <span data-ttu-id="f1a36-170">Origem/CDN</span><span class="sxs-lookup"><span data-stu-id="f1a36-170">Origin/CDN</span></span>

<span data-ttu-id="f1a36-171">Olá diagrama a seguir ilustra interação de nível alto Olá entre componentes de saudação em um subsistema DRM.</span><span class="sxs-lookup"><span data-stu-id="f1a36-171">hello following diagram illustrates hello high level interaction among hello components in a DRM subsystem.</span></span>

![Subsistema DRM com CENC](./media/media-services-cenc-with-multidrm-access-control/media-services-generic-drm-subsystem-with-cenc.png)

<span data-ttu-id="f1a36-173">Há três básico "camadas" no design de saudação:</span><span class="sxs-lookup"><span data-stu-id="f1a36-173">There are three basic “layers” in hello design:</span></span>

1. <span data-ttu-id="f1a36-174">A camada de back-office (em preto) que não é exposta externamente;</span><span class="sxs-lookup"><span data-stu-id="f1a36-174">Back office layer (in black) which are not exposed externally;</span></span>
2. <span data-ttu-id="f1a36-175">Camada de "Rede de Perímetro" (azul) que contém todos os pontos de extremidade Olá voltada para o público;</span><span class="sxs-lookup"><span data-stu-id="f1a36-175">“DMZ” layer (blue) containing all hello endpoints facing public;</span></span>
3. <span data-ttu-id="f1a36-176">A camada de Internet pública (azul-clara) que contém CDN e players com tráfego pela Internet pública.</span><span class="sxs-lookup"><span data-stu-id="f1a36-176">Public Internet layer (light blue) containing CDN and players with traffic across public Internet.</span></span>

<span data-ttu-id="f1a36-177">Deve haver uma ferramenta de gerenciamento de conteúdo para controlar a proteção do DRM, independentemente de a criptografia ser dinâmica ou estática.</span><span class="sxs-lookup"><span data-stu-id="f1a36-177">There should be a content management tool for controlling DRM protection, regardless it is static or dynamic encryption.</span></span> <span data-ttu-id="f1a36-178">entradas de saudação para criptografia de DRM devem incluir:</span><span class="sxs-lookup"><span data-stu-id="f1a36-178">hello inputs for DRM encryption should include:</span></span>

1. <span data-ttu-id="f1a36-179">Conteúdo de vídeo MBR;</span><span class="sxs-lookup"><span data-stu-id="f1a36-179">MBR video content;</span></span>
2. <span data-ttu-id="f1a36-180">Chave de conteúdo;</span><span class="sxs-lookup"><span data-stu-id="f1a36-180">Content key;</span></span>
3. <span data-ttu-id="f1a36-181">URLs de aquisição de licença.</span><span class="sxs-lookup"><span data-stu-id="f1a36-181">License acquisition URLs.</span></span>

<span data-ttu-id="f1a36-182">Durante o tempo de reprodução, o fluxo de nível alto de saudação é:</span><span class="sxs-lookup"><span data-stu-id="f1a36-182">During playback time, hello high level flow is:</span></span>

1. <span data-ttu-id="f1a36-183">O usuário é autenticado;</span><span class="sxs-lookup"><span data-stu-id="f1a36-183">User is authenticated;</span></span>
2. <span data-ttu-id="f1a36-184">Token de autorização é criado para o usuário Olá;</span><span class="sxs-lookup"><span data-stu-id="f1a36-184">Authorization token is created for hello user;</span></span>
3. <span data-ttu-id="f1a36-185">Conteúdo protegido por DRM (manifesto) é baixado tooplayer;</span><span class="sxs-lookup"><span data-stu-id="f1a36-185">DRM protected content (manifest) is downloaded tooplayer;</span></span>
4. <span data-ttu-id="f1a36-186">Player envia os servidores de toolicense de solicitação de aquisição de licença junto com a ID de chave e autorização token.</span><span class="sxs-lookup"><span data-stu-id="f1a36-186">Player submits license acquisition request toolicense servers together with key ID and authorization token.</span></span>

<span data-ttu-id="f1a36-187">Antes de mover próximo de tópico de toohello, algumas palavras sobre Olá design do gerenciamento de chaves.</span><span class="sxs-lookup"><span data-stu-id="f1a36-187">Before moving toohello next topic, a few words about hello design of key management.</span></span>

| <span data-ttu-id="f1a36-188">**ContentKey-para-ativo**</span><span class="sxs-lookup"><span data-stu-id="f1a36-188">**ContentKey–to-Asset**</span></span> | <span data-ttu-id="f1a36-189">**Cenário**</span><span class="sxs-lookup"><span data-stu-id="f1a36-189">**Scenario**</span></span> |
| --- | --- |
| <span data-ttu-id="f1a36-190">1 para 1</span><span class="sxs-lookup"><span data-stu-id="f1a36-190">1–to-1</span></span> |<span data-ttu-id="f1a36-191">caso mais simples de saudação.</span><span class="sxs-lookup"><span data-stu-id="f1a36-191">hello simplest case.</span></span> <span data-ttu-id="f1a36-192">Ele fornece controle mais refinado hello.</span><span class="sxs-lookup"><span data-stu-id="f1a36-192">It provides hello finest control.</span></span> <span data-ttu-id="f1a36-193">Mas, geralmente, resulta em custo de entrega de licença mais alto hello.</span><span class="sxs-lookup"><span data-stu-id="f1a36-193">But this generally results in hello highest license delivery cost.</span></span> <span data-ttu-id="f1a36-194">Pelo menos uma solicitação de licença é necessária para cada ativo protegido.</span><span class="sxs-lookup"><span data-stu-id="f1a36-194">At minimum one license request is required for each protected asset.</span></span> |
| <span data-ttu-id="f1a36-195">1-para-muitos</span><span class="sxs-lookup"><span data-stu-id="f1a36-195">1–to-Many</span></span> |<span data-ttu-id="f1a36-196">Você pode usar o mesmo conteúdo a chave de vários ativos de saudação.</span><span class="sxs-lookup"><span data-stu-id="f1a36-196">You could use hello same content key for multiple assets.</span></span> <span data-ttu-id="f1a36-197">Por exemplo, para todos os ativos de saudação em um grupo lógico, como um gênero ou um subconjunto de gênero (ou filme Gene), você pode usar uma única chave de conteúdo.</span><span class="sxs-lookup"><span data-stu-id="f1a36-197">For example, for all hello assets in a logical group such as a genre or subset of genre (or Movie Gene), you could use a single content key.</span></span> |
| <span data-ttu-id="f1a36-198">Muitos-para-1</span><span class="sxs-lookup"><span data-stu-id="f1a36-198">Many–to-1</span></span> |<span data-ttu-id="f1a36-199">Várias chaves de conteúdo são necessárias para cada ativo.</span><span class="sxs-lookup"><span data-stu-id="f1a36-199">Multiple content keys are needed for each asset.</span></span> <br/><br/><span data-ttu-id="f1a36-200">Por exemplo, se precisar de proteção de CENC dinâmica tooapply com várias DRM para MPEG-DASH e criptografia AES-128 dinâmica para HLS, será necessário duas separadas conteúdas chaves, cada qual com seu próprio ContentKeyType.</span><span class="sxs-lookup"><span data-stu-id="f1a36-200">For example, if you need tooapply dynamic CENC protection with multi-DRM for MPEG-DASH, and dynamic AES-128 encryption for HLS, you need two separate content keys, each with its own ContentKeyType.</span></span> <span data-ttu-id="f1a36-201">(Para a chave de conteúdo do hello usada para proteção de CENC dinâmica, ContentKeyType.CommonEncryption deve ser usado, enquanto para Olá conteúdo chave usada para criptografia AES-128, ContentKeyType.EnvelopeEncryption deve ser usada.)</span><span class="sxs-lookup"><span data-stu-id="f1a36-201">(For hello content key used for dynamic CENC protection, ContentKeyType.CommonEncryption should be used, while for hello content key used for dynamic AES-128 encryption, ContentKeyType.EnvelopeEncryption should be used.)</span></span><br/><br/><span data-ttu-id="f1a36-202">Outro exemplo, em proteção de CENC de traço de conteúdo, em tese, uma chave de conteúdo pode ser usado tooprotect fluxo de vídeo e outro fluxo de áudio tooprotect chave de conteúdo.</span><span class="sxs-lookup"><span data-stu-id="f1a36-202">Another example, in CENC protection of DASH content, in theory, one content key can be used tooprotect video stream and another content key tooprotect audio stream.</span></span> |
| <span data-ttu-id="f1a36-203">Muitos – muito-muitos</span><span class="sxs-lookup"><span data-stu-id="f1a36-203">Many – too- Many</span></span> |<span data-ttu-id="f1a36-204">Combinação de saudação acima dois cenários: um conjunto de conteúdo, as chaves são usadas para cada um dos Olá ativos em Olá mesmo ativo "grupo".</span><span class="sxs-lookup"><span data-stu-id="f1a36-204">Combination of hello above two scenarios: one set of content keys are used for each of hello multiple assets in hello same asset “group”.</span></span> |

<span data-ttu-id="f1a36-205">Tooconsider de outro fator importante é o uso de saudação de licenças persistentes e não persistentes.</span><span class="sxs-lookup"><span data-stu-id="f1a36-205">Another important factor tooconsider is hello use of persistent and non-persistent licenses.</span></span>

<span data-ttu-id="f1a36-206">Por que essas considerações são importantes?</span><span class="sxs-lookup"><span data-stu-id="f1a36-206">Why are these considerations important?</span></span>

<span data-ttu-id="f1a36-207">Eles têm a entrega de toolicense impacto direto de custo se você usar a nuvem pública para entrega de licença.</span><span class="sxs-lookup"><span data-stu-id="f1a36-207">They have direct impact toolicense delivery cost if you use public cloud for license delivery.</span></span> <span data-ttu-id="f1a36-208">Vamos considerar Olá dois tooillustrate de casos de design diferentes a seguir:</span><span class="sxs-lookup"><span data-stu-id="f1a36-208">Let’s consider hello following two different design cases tooillustrate:</span></span>

1. <span data-ttu-id="f1a36-209">Assinatura mensal: use a licença persistente e o mapeamento de chaves para ativos com conteúdo de um para muitos.</span><span class="sxs-lookup"><span data-stu-id="f1a36-209">Monthly subscription: Use persistent license, and 1-to-many content key-to-asset mapping.</span></span> <span data-ttu-id="f1a36-210">Por exemplo</span><span class="sxs-lookup"><span data-stu-id="f1a36-210">E.g.</span></span> <span data-ttu-id="f1a36-211">para todos os filmes de crianças hello, usamos uma única chave de conteúdo para criptografia.</span><span class="sxs-lookup"><span data-stu-id="f1a36-211">for all hello kids movies, we use a single content key for encryption.</span></span> <span data-ttu-id="f1a36-212">Nesse caso:</span><span class="sxs-lookup"><span data-stu-id="f1a36-212">In this case:</span></span>

    <span data-ttu-id="f1a36-213">Número total de licenças solicitadas para todos os filmes de criança/dispositivo = 1</span><span class="sxs-lookup"><span data-stu-id="f1a36-213">Total # licenses requested for all kids movies/device = 1</span></span>
2. <span data-ttu-id="f1a36-214">Assinatura mensal: use a licença não persistente e o mapeamento de um para um entre a chave e o ativo do conteúdo.</span><span class="sxs-lookup"><span data-stu-id="f1a36-214">Monthly subscription: Use non-persistent license, and 1-to-1 mapping between content key and asset.</span></span> <span data-ttu-id="f1a36-215">Nesse caso:</span><span class="sxs-lookup"><span data-stu-id="f1a36-215">In this case:</span></span>

    <span data-ttu-id="f1a36-216">Número total de licenças solicitadas para todos os filmes de criança/dispositivo = [# de filmes observados] x [# de sessões]</span><span class="sxs-lookup"><span data-stu-id="f1a36-216">Total # licenses requested for all kids movies/device = [# movies watched] x [# sessions]</span></span>

<span data-ttu-id="f1a36-217">Como você pode ver facilmente Olá dois projetos diferentes resultam na licença muito diferente solicitar padrões, portanto, se o serviço de entrega de licença é fornecido por uma nuvem pública, como os serviços de mídia do Azure de custo de entrega de licença.</span><span class="sxs-lookup"><span data-stu-id="f1a36-217">As you can easily see, hello two different designs result in very different license request patterns hence license delivery cost if license delivery service is provided by a public cloud such as Azure Media Services.</span></span>

## <a name="mapping-design-tootechnology-for-implementation"></a><span data-ttu-id="f1a36-218">Mapeamento de design tootechnology para implementação</span><span class="sxs-lookup"><span data-stu-id="f1a36-218">Mapping design tootechnology for implementation</span></span>
<span data-ttu-id="f1a36-219">Em seguida, podemos mapear tootechnologies nosso design genérico na plataforma Microsoft Azure/Azure Media Services, especificando quais toouse tecnologia para cada bloco de construção.</span><span class="sxs-lookup"><span data-stu-id="f1a36-219">Next, we map our generic design tootechnologies on Microsoft Azure/Azure Media Services platform, by specifying which technology toouse for each building block.</span></span>

<span data-ttu-id="f1a36-220">Olá tabela a seguir mostra o mapeamento de saudação:</span><span class="sxs-lookup"><span data-stu-id="f1a36-220">hello following table shows hello mapping:</span></span>

| <span data-ttu-id="f1a36-221">**Bloco de construção**</span><span class="sxs-lookup"><span data-stu-id="f1a36-221">**Building Block**</span></span> | <span data-ttu-id="f1a36-222">**Tecnologia**</span><span class="sxs-lookup"><span data-stu-id="f1a36-222">**Technology**</span></span> |
| --- | --- |
| <span data-ttu-id="f1a36-223">**Player**</span><span class="sxs-lookup"><span data-stu-id="f1a36-223">**Player**</span></span> |[<span data-ttu-id="f1a36-224">Player de Mídia do Azure</span><span class="sxs-lookup"><span data-stu-id="f1a36-224">Azure Media Player</span></span>](https://azure.microsoft.com/services/media-services/media-player/) |
| <span data-ttu-id="f1a36-225">**IDP (Provedor de identidade)**</span><span class="sxs-lookup"><span data-stu-id="f1a36-225">**Identity Provider (IDP)**</span></span> |<span data-ttu-id="f1a36-226">Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="f1a36-226">Azure Active Directory</span></span> |
| <span data-ttu-id="f1a36-227">**STS (Serviço de Token Seguro)**</span><span class="sxs-lookup"><span data-stu-id="f1a36-227">**Secure Token Service (STS)**</span></span> |<span data-ttu-id="f1a36-228">Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="f1a36-228">Azure Active Directory</span></span> |
| <span data-ttu-id="f1a36-229">**Fluxo de trabalho de proteção de DRM**</span><span class="sxs-lookup"><span data-stu-id="f1a36-229">**DRM Protection Workflow**</span></span> |<span data-ttu-id="f1a36-230">Proteção dinâmica dos Serviços de Mídia do Azure</span><span class="sxs-lookup"><span data-stu-id="f1a36-230">Azure Media Services Dynamic Protection</span></span> |
| <span data-ttu-id="f1a36-231">**Entrega de licença do DRM**</span><span class="sxs-lookup"><span data-stu-id="f1a36-231">**DRM License Delivery**</span></span> |<span data-ttu-id="f1a36-232">1. Entrega de licença dos Serviços de Mídia do Azure (PlayReady, Widevine, FairPlay) ou</span><span class="sxs-lookup"><span data-stu-id="f1a36-232">1. Azure Media Services License Delivery (PlayReady, Widevine, FairPlay), or</span></span> <br/><span data-ttu-id="f1a36-233">2. Servidor de licença Axinom,</span><span class="sxs-lookup"><span data-stu-id="f1a36-233">2. Axinom License Server,</span></span> <br/><span data-ttu-id="f1a36-234">3. Servidor de licença do PlayReady personalizado</span><span class="sxs-lookup"><span data-stu-id="f1a36-234">3. Custom PlayReady License Server</span></span> |
| <span data-ttu-id="f1a36-235">**Origem**</span><span class="sxs-lookup"><span data-stu-id="f1a36-235">**Origin**</span></span> |<span data-ttu-id="f1a36-236">Ponto de extremidade dos Serviços de Mídia do Azure</span><span class="sxs-lookup"><span data-stu-id="f1a36-236">Azure Media Services Streaming Endpoint</span></span> |
| <span data-ttu-id="f1a36-237">**Gerenciamento de Chaves**</span><span class="sxs-lookup"><span data-stu-id="f1a36-237">**Key Management**</span></span> |<span data-ttu-id="f1a36-238">Não é necessário para a implementação de referência</span><span class="sxs-lookup"><span data-stu-id="f1a36-238">Not needed for reference implementation</span></span> |
| <span data-ttu-id="f1a36-239">**Gerenciamento de Conteúdo**</span><span class="sxs-lookup"><span data-stu-id="f1a36-239">**Content Management**</span></span> |<span data-ttu-id="f1a36-240">Aplicativo do console C#</span><span class="sxs-lookup"><span data-stu-id="f1a36-240">A C# console application</span></span> |

<span data-ttu-id="f1a36-241">Em outras palavras, tanto o IDP (provedor de identidade) quanto o STS (Serviço de Token Seguro) serão do AD do Azure.</span><span class="sxs-lookup"><span data-stu-id="f1a36-241">In other words, both Identity Provider (IDP) and Secure Token Service (STS) will be Azure AD.</span></span> <span data-ttu-id="f1a36-242">Para o player, usaremos a [API do Player de Mídia do Azure](http://amp.azure.net/libs/amp/latest/docs/).</span><span class="sxs-lookup"><span data-stu-id="f1a36-242">For player, we will use [Azure Media Player API](http://amp.azure.net/libs/amp/latest/docs/).</span></span> <span data-ttu-id="f1a36-243">Os Serviços de Mídia do Azure e o Player de Mídia do Azure dão suporte a DASH e a CENC com vários DRM.</span><span class="sxs-lookup"><span data-stu-id="f1a36-243">Both Azure Media Services and Azure Media Player support DASH and CENC with multi-DRM.</span></span>

<span data-ttu-id="f1a36-244">Olá seguinte diagrama mostra Olá estrutura geral e o fluxo com hello acima mapeamento de tecnologia.</span><span class="sxs-lookup"><span data-stu-id="f1a36-244">hello following diagram shows hello overall structure and flow with hello above technology mapping.</span></span>

![CENC em AMS](./media/media-services-cenc-with-multidrm-access-control/media-services-cenc-subsystem-on-AMS-platform.png)

<span data-ttu-id="f1a36-246">Ordem tooset a criptografia dinâmica de CENC, ferramenta de gerenciamento de conteúdo Olá usará Olá entradas a seguir:</span><span class="sxs-lookup"><span data-stu-id="f1a36-246">In order tooset up dynamic CENC encryption, hello content management tool will use hello following inputs:</span></span>

1. <span data-ttu-id="f1a36-247">Abrir conteúdo;</span><span class="sxs-lookup"><span data-stu-id="f1a36-247">Open content;</span></span>
2. <span data-ttu-id="f1a36-248">Chave de conteúdo do gerenciamento/geração de chave;</span><span class="sxs-lookup"><span data-stu-id="f1a36-248">Content key from key generation/management;</span></span>
3. <span data-ttu-id="f1a36-249">URLs de aquisição de licença;</span><span class="sxs-lookup"><span data-stu-id="f1a36-249">License acquisition URLs;</span></span>
4. <span data-ttu-id="f1a36-250">Uma lista de informações do AD do Azure.</span><span class="sxs-lookup"><span data-stu-id="f1a36-250">A list of information from Azure AD.</span></span>

<span data-ttu-id="f1a36-251">Olá saída da ferramenta de gerenciamento de conteúdo de saudação será:</span><span class="sxs-lookup"><span data-stu-id="f1a36-251">hello output of hello content management tool will be:</span></span>

1. <span data-ttu-id="f1a36-252">ContentKeyAuthorizationPolicy que contém a especificação de saudação em como entrega de licença verifica um token JWT e especificações de licença do DRM;</span><span class="sxs-lookup"><span data-stu-id="f1a36-252">ContentKeyAuthorizationPolicy containing hello specification on how license delivery verifies a JWT token and DRM license specifications;</span></span>
2. <span data-ttu-id="f1a36-253">AssetDeliveryPolicy contendo especificações de formato de streaming, proteção DRM e URLs de aquisição de licença.</span><span class="sxs-lookup"><span data-stu-id="f1a36-253">AssetDeliveryPolicy containing specifications on streaming format, DRM protection and license acquisition URLs.</span></span>

<span data-ttu-id="f1a36-254">Durante a execução, o fluxo de saudação é como abaixo:</span><span class="sxs-lookup"><span data-stu-id="f1a36-254">During runtime, hello flow is as below:</span></span>

1. <span data-ttu-id="f1a36-255">Após a autenticação de usuário, um token JWT é gerado;</span><span class="sxs-lookup"><span data-stu-id="f1a36-255">Upon user authentication, a JWT token is generated;</span></span>
2. <span data-ttu-id="f1a36-256">Uma das declarações de saudação contidas no token JWT de saudação é declaração "groups" que contém a ID de objeto do grupo de saudação de "EntitledUserGroup".</span><span class="sxs-lookup"><span data-stu-id="f1a36-256">One of hello claims contained in hello JWT token is “groups” claim containing hello group object ID of “EntitledUserGroup”.</span></span> <span data-ttu-id="f1a36-257">Essa declaração será usada para a passagem de "verificação de autorização".</span><span class="sxs-lookup"><span data-stu-id="f1a36-257">This claim will be used for passing “entitlement check”.</span></span>
3. <span data-ttu-id="f1a36-258">Manifesto de cliente de downloads de Player de um CENC conteúdo protegido e seguir hello "vê":</span><span class="sxs-lookup"><span data-stu-id="f1a36-258">Player downloads client manifest of a CENC protected content and “sees” hello following:</span></span>

   1. <span data-ttu-id="f1a36-259">ID da chave;</span><span class="sxs-lookup"><span data-stu-id="f1a36-259">key ID,</span></span>
   2. <span data-ttu-id="f1a36-260">conteúdo de saudação é CENC protegido,</span><span class="sxs-lookup"><span data-stu-id="f1a36-260">hello content is CENC protected,</span></span>
   3. <span data-ttu-id="f1a36-261">URLs de aquisição de licença.</span><span class="sxs-lookup"><span data-stu-id="f1a36-261">License acquisition URLs.</span></span>
4. <span data-ttu-id="f1a36-262">Player faz uma solicitação de aquisição de licença com base em Olá navegador/DRM com suporte.</span><span class="sxs-lookup"><span data-stu-id="f1a36-262">Player makes a license acquisition request based on hello browser/DRM supported.</span></span> <span data-ttu-id="f1a36-263">Na solicitação de aquisição de licença hello, ID de chave e Olá JWT token também será enviado.</span><span class="sxs-lookup"><span data-stu-id="f1a36-263">In hello license acquisition request, key ID and hello JWT token will also be submitted.</span></span> <span data-ttu-id="f1a36-264">Serviço de entrega de licença verificará se o token JWT hello e declarações de saudação contidas antes de emitir Olá necessário licença.</span><span class="sxs-lookup"><span data-stu-id="f1a36-264">License delivery service will verify hello JWT token and hello claims contained before issuing hello needed license.</span></span>

## <a name="implementation"></a><span data-ttu-id="f1a36-265">Implementação</span><span class="sxs-lookup"><span data-stu-id="f1a36-265">Implementation</span></span>
### <a name="implementation-procedures"></a><span data-ttu-id="f1a36-266">Procedimentos de implementação</span><span class="sxs-lookup"><span data-stu-id="f1a36-266">Implementation procedures</span></span>
<span data-ttu-id="f1a36-267">implementação de saudação incluirá Olá etapas a seguir:</span><span class="sxs-lookup"><span data-stu-id="f1a36-267">hello implementation will include hello following steps:</span></span>

1. <span data-ttu-id="f1a36-268">Preparar os ativos de teste: codificar/pacote uma teste de vídeo toomulti taxas de bits fragmentado MP4 nos serviços de mídia do Azure.</span><span class="sxs-lookup"><span data-stu-id="f1a36-268">Prepare test asset(s): encode/package a test video toomulti-bitrate fragmented MP4 in Azure Media Services.</span></span> <span data-ttu-id="f1a36-269">Esse ativo NÃO é protegido por DRM.</span><span class="sxs-lookup"><span data-stu-id="f1a36-269">This asset is NOT DRM protected.</span></span> <span data-ttu-id="f1a36-270">A proteção DRM será feita pela proteção dinâmica posteriormente.</span><span class="sxs-lookup"><span data-stu-id="f1a36-270">DRM protection will be done by dynamic protection later.</span></span>
2. <span data-ttu-id="f1a36-271">Criar chave de ID e chave de conteúdo (opcionalmente da semente de chave).</span><span class="sxs-lookup"><span data-stu-id="f1a36-271">Create key ID and content key (optionally from key seed).</span></span> <span data-ttu-id="f1a36-272">Para nosso objetivo, o sistema de gerenciamento de chaves não é necessário, pois estamos lidando com apenas um único conjunto de ID de chave ID e de chave de conteúdo para alguns recursos de teste;</span><span class="sxs-lookup"><span data-stu-id="f1a36-272">For our purpose, key management system is not needed since we are dealing with only a single set of key ID and content key for a couple of test assets;</span></span>
3. <span data-ttu-id="f1a36-273">Use os serviços de entrega de licença AMS API tooconfigure DRM várias ativo de teste de saudação.</span><span class="sxs-lookup"><span data-stu-id="f1a36-273">Use AMS API tooconfigure multi-DRM license delivery services for hello test asset.</span></span> <span data-ttu-id="f1a36-274">Se você estiver usando servidores de licença personalizado por sua empresa ou fornecedores de sua empresa em vez de serviços de licença nos serviços de mídia do Azure, você pode ignorar esta etapa e especificar URLs de aquisição de licença na etapa Olá para configurar a entrega de licença.</span><span class="sxs-lookup"><span data-stu-id="f1a36-274">If you are using custom license servers by your company or your company’s vendors instead of license services in Azure Media Services, you can skip this step and specify license acquisition URLs in hello step for configuring license delivery.</span></span> <span data-ttu-id="f1a36-275">API de AMS é necessário toospecify alguns detalhadas configurações, como restrição de política de autorização de licença modelos de resposta para diferentes serviços de licença do DRM, etc. Neste momento, Olá portal do Azure ainda não fornecer Olá necessária da interface do usuário para essa configuração.</span><span class="sxs-lookup"><span data-stu-id="f1a36-275">AMS API is needed toospecify some detailed configurations, such as authorization policy restriction, license response templates for different DRM license services, etc. At this time, hello Azure portal does not yet provide hello needed UI for this configuration.</span></span> <span data-ttu-id="f1a36-276">Você pode encontrar informações e códigos de exemplo no nível de API no documento de Julia Kornich: [Usando a criptografia dinâmica comum do PlayReady e/ou do Widevine](media-services-protect-with-drm.md).</span><span class="sxs-lookup"><span data-stu-id="f1a36-276">You can find API level info and sample code in Julia Kornich’s document: [Using PlayReady and/or Widevine Dynamic Common Encryption](media-services-protect-with-drm.md).</span></span>
4. <span data-ttu-id="f1a36-277">Use política de entrega de ativos de tooconfigure AMS API para o ativo de teste de saudação.</span><span class="sxs-lookup"><span data-stu-id="f1a36-277">Use AMS API tooconfigure asset delivery policy for hello test asset.</span></span> <span data-ttu-id="f1a36-278">Você pode encontrar informações e códigos de exemplo no nível de API no documento de Julia Kornich: [Usando a criptografia dinâmica comum do PlayReady e/ou do Widevine](media-services-protect-with-drm.md).</span><span class="sxs-lookup"><span data-stu-id="f1a36-278">You can find API level info and sample code in Julia Kornich’s document: [Using PlayReady and/or Widevine Dynamic Common Encryption](media-services-protect-with-drm.md).</span></span>
5. <span data-ttu-id="f1a36-279">Criar e configurar um locatário do Active Directory do Azure no Azure;</span><span class="sxs-lookup"><span data-stu-id="f1a36-279">Create and configure an Azure Active Directory tenant in Azure;</span></span>
6. <span data-ttu-id="f1a36-280">Criar algumas contas de usuário e grupos em seu locatário do Active Directory do Azure: você deve criar pelo menos "EntitledUser" e adicione um grupo de toothis do usuário.</span><span class="sxs-lookup"><span data-stu-id="f1a36-280">Create a few user accounts and groups in your Azure Active Directory tenant: you should create at least “EntitledUser” group and add a user toothis group.</span></span> <span data-ttu-id="f1a36-281">Os usuários desse grupo passará a verificação de autorização na aquisição da licença e os usuários não desse grupo falharão toopass verificação de autenticação e não será capaz de tooacquire qualquer licença.</span><span class="sxs-lookup"><span data-stu-id="f1a36-281">Users in this group will pass entitlement check in license acquisition and users not in this group will fail toopass authentication check and will not be able tooacquire any license.</span></span> <span data-ttu-id="f1a36-282">Ser um membro desse grupo "EntitledUser" é uma declaração de "grupos" necessários em Olá token JWT emitido pelo AD do Azure.</span><span class="sxs-lookup"><span data-stu-id="f1a36-282">Being a member of this “EntitledUser” group is a required “groups” claim in hello JWT token issued by Azure AD.</span></span> <span data-ttu-id="f1a36-283">Esse requisito de declaração deve ser especificado na etapa de configuração dos serviços de entrega de licença para vários DRM.</span><span class="sxs-lookup"><span data-stu-id="f1a36-283">This claim requirement should be specified in configuring multi-DRM license delivery services step.</span></span>
7. <span data-ttu-id="f1a36-284">Crie um aplicativo MVC ASP.NET que hospedará o player de vídeo.</span><span class="sxs-lookup"><span data-stu-id="f1a36-284">Create an ASP.NET MVC app which will be hosting your video player.</span></span> <span data-ttu-id="f1a36-285">Este aplicativo ASP.NET será protegido com a autenticação de usuário no locatário do Active Directory do Azure hello.</span><span class="sxs-lookup"><span data-stu-id="f1a36-285">This ASP.NET app will be protected with user authentication against hello Azure Active Directory tenant.</span></span> <span data-ttu-id="f1a36-286">Declarações apropriadas serão incluídas nos tokens de acesso Olá obtidos após a autenticação do usuário.</span><span class="sxs-lookup"><span data-stu-id="f1a36-286">Proper claims will be included in hello access tokens obtained after user authentication.</span></span> <span data-ttu-id="f1a36-287">A API Connect OpenID é recomendada para esta etapa.</span><span class="sxs-lookup"><span data-stu-id="f1a36-287">OpenID Connect API is recommended for this step.</span></span> <span data-ttu-id="f1a36-288">Você precisa Olá tooinstall pacotes do NuGet a seguir:</span><span class="sxs-lookup"><span data-stu-id="f1a36-288">You need tooinstall hello following NuGet packages:</span></span>
   * <span data-ttu-id="f1a36-289">Install-Package Microsoft.Azure.ActiveDirectory.GraphClient</span><span class="sxs-lookup"><span data-stu-id="f1a36-289">Install-Package Microsoft.Azure.ActiveDirectory.GraphClient</span></span>
   * <span data-ttu-id="f1a36-290">Install-Package Microsoft.Owin.Security.OpenIdConnect</span><span class="sxs-lookup"><span data-stu-id="f1a36-290">Install-Package Microsoft.Owin.Security.OpenIdConnect</span></span>
   * <span data-ttu-id="f1a36-291">Install-Package Microsoft.Owin.Security.Cookies</span><span class="sxs-lookup"><span data-stu-id="f1a36-291">Install-Package Microsoft.Owin.Security.Cookies</span></span>
   * <span data-ttu-id="f1a36-292">Install-Package Microsoft.Owin.Host.SystemWeb</span><span class="sxs-lookup"><span data-stu-id="f1a36-292">Install-Package Microsoft.Owin.Host.SystemWeb</span></span>
   * <span data-ttu-id="f1a36-293">Install-Package Microsoft.IdentityModel.Clients.ActiveDirectory</span><span class="sxs-lookup"><span data-stu-id="f1a36-293">Install-Package Microsoft.IdentityModel.Clients.ActiveDirectory</span></span>
8. <span data-ttu-id="f1a36-294">Crie um player usando a [API do Player de Mídia do Azure](http://amp.azure.net/libs/amp/latest/docs/).</span><span class="sxs-lookup"><span data-stu-id="f1a36-294">Create a player using [Azure Media Player API](http://amp.azure.net/libs/amp/latest/docs/).</span></span> <span data-ttu-id="f1a36-295">[API de ProtectionInfo do Azure Media Player](http://amp.azure.net/libs/amp/latest/docs/) permite que você toospecify quais toouse de tecnologia DRM em diferentes plataformas DRM.</span><span class="sxs-lookup"><span data-stu-id="f1a36-295">[Azure Media Player’s ProtectionInfo API](http://amp.azure.net/libs/amp/latest/docs/) allows you toospecify which DRM technology toouse on different DRM platform.</span></span>
9. <span data-ttu-id="f1a36-296">Matriz de teste:</span><span class="sxs-lookup"><span data-stu-id="f1a36-296">Test matrix:</span></span>

| <span data-ttu-id="f1a36-297">**DRM**</span><span class="sxs-lookup"><span data-stu-id="f1a36-297">**DRM**</span></span> | <span data-ttu-id="f1a36-298">**Navegador**</span><span class="sxs-lookup"><span data-stu-id="f1a36-298">**Browser**</span></span> | <span data-ttu-id="f1a36-299">**Resultado de usuário qualificado**</span><span class="sxs-lookup"><span data-stu-id="f1a36-299">**Result for Entitled User**</span></span> | <span data-ttu-id="f1a36-300">**Resultado para usuário não qualificado**</span><span class="sxs-lookup"><span data-stu-id="f1a36-300">**Result for Un-entitled User**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="f1a36-301">**PlayReady**</span><span class="sxs-lookup"><span data-stu-id="f1a36-301">**PlayReady**</span></span> |<span data-ttu-id="f1a36-302">MS Edge ou IE11 no Windows 10</span><span class="sxs-lookup"><span data-stu-id="f1a36-302">MS Edge or IE11 on Windows 10</span></span> |<span data-ttu-id="f1a36-303">Êxito</span><span class="sxs-lookup"><span data-stu-id="f1a36-303">Succeed</span></span> |<span data-ttu-id="f1a36-304">Reprovado</span><span class="sxs-lookup"><span data-stu-id="f1a36-304">Fail</span></span> |
| <span data-ttu-id="f1a36-305">**Widevine**</span><span class="sxs-lookup"><span data-stu-id="f1a36-305">**Widevine**</span></span> |<span data-ttu-id="f1a36-306">Chrome no Windows 10</span><span class="sxs-lookup"><span data-stu-id="f1a36-306">Chrome on Windows 10</span></span> |<span data-ttu-id="f1a36-307">Êxito</span><span class="sxs-lookup"><span data-stu-id="f1a36-307">Succeed</span></span> |<span data-ttu-id="f1a36-308">Reprovado</span><span class="sxs-lookup"><span data-stu-id="f1a36-308">Fail</span></span> |
| <span data-ttu-id="f1a36-309">**FairPlay**</span><span class="sxs-lookup"><span data-stu-id="f1a36-309">**FairPlay**</span></span> |<span data-ttu-id="f1a36-310">TBD</span><span class="sxs-lookup"><span data-stu-id="f1a36-310">TBD</span></span> | | |

<span data-ttu-id="f1a36-311">George Trifonov, da equipe de Serviços de Mídia do Azure, escreveu um blog fornecendo as etapas detalhadas de configuração do Active Directory do Azure para um aplicativo de player MVC do ASP.NET: [Integrate Azure Media Services OWIN MVC based app with Azure Active Directory and restrict content key delivery based on JWT claims](http://gtrifonov.com/2015/01/24/mvc-owin-azure-media-services-ad-integration/).</span><span class="sxs-lookup"><span data-stu-id="f1a36-311">George Trifonov of Azure Media Services Team has written a blog providing detailed steps in setting up Azure Active Directory for an ASP.NET MVC player app: [Integrate Azure Media Services OWIN MVC based app with Azure Active Directory and restrict content key delivery based on JWT claims](http://gtrifonov.com/2015/01/24/mvc-owin-azure-media-services-ad-integration/).</span></span>

<span data-ttu-id="f1a36-312">George também escreveu um blog sobre [JWT token Authentication in Azure Media Services and Dynamic Encryption](http://gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/).</span><span class="sxs-lookup"><span data-stu-id="f1a36-312">George has also written a blog on [JWT token Authentication in Azure Media Services and Dynamic Encryption](http://gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/).</span></span> <span data-ttu-id="f1a36-313">E aqui está seu [exemplo de integração do AD do Azure à distribuição de chaves dos Serviços de Mídia do Azure](https://github.com/AzureMediaServicesSamples/Key-delivery-with-AAD-integration/).</span><span class="sxs-lookup"><span data-stu-id="f1a36-313">And here is his [sample on Azure AD integration with Azure Media Services key delivery](https://github.com/AzureMediaServicesSamples/Key-delivery-with-AAD-integration/).</span></span>

<span data-ttu-id="f1a36-314">Para obter informações sobre o Active Directory do Azure:</span><span class="sxs-lookup"><span data-stu-id="f1a36-314">For information on Azure Active Directory:</span></span>

* <span data-ttu-id="f1a36-315">Você pode encontrar informações de desenvolvedor no [Guia do desenvolvedor do Active Directory do Azure](../active-directory/active-directory-developers-guide.md).</span><span class="sxs-lookup"><span data-stu-id="f1a36-315">You can find developer information in [Azure Active Directory Developer’s Guide](../active-directory/active-directory-developers-guide.md).</span></span>
* <span data-ttu-id="f1a36-316">Você pode encontrar informações de administrador em [Administrar seu diretório do AD do Azure](../active-directory/active-directory-administer.md).</span><span class="sxs-lookup"><span data-stu-id="f1a36-316">You can find administrator information in [Administer Your Azure AD Directory](../active-directory/active-directory-administer.md).</span></span>

### <a name="some-gotchas-in-implementation"></a><span data-ttu-id="f1a36-317">Algumas pegadinhas na implementação</span><span class="sxs-lookup"><span data-stu-id="f1a36-317">Some gotchas in implementation</span></span>
<span data-ttu-id="f1a36-318">Há algumas armadilhas"" na implementação de saudação.</span><span class="sxs-lookup"><span data-stu-id="f1a36-318">There are some “gotchas” in hello implementation.</span></span> <span data-ttu-id="f1a36-319">Esperamos que Olá lista de "armadilhas" a seguir pode ajudá-lo no caso de você se deparar com problemas de solução de problemas.</span><span class="sxs-lookup"><span data-stu-id="f1a36-319">Hopefully hello following list of “gotchas” can help you troubleshooting in case you run into issues.</span></span>

1. <span data-ttu-id="f1a36-320">A URL do **emissor** deve terminar com **"/"**.</span><span class="sxs-lookup"><span data-stu-id="f1a36-320">**Issuer** URL should end with **"/"**.</span></span>  

    <span data-ttu-id="f1a36-321">**Público-alvo** devem ser Olá ID do cliente de aplicativo de player e você também deve adicionar **"/"** final Olá Olá URL do emissor.</span><span class="sxs-lookup"><span data-stu-id="f1a36-321">**Audience** should be hello player application client ID and you should also add **"/"** at hello end of hello issuer URL.</span></span>

        <add key="ida:audience" value="[Application Client ID GUID]" />
        <add key="ida:issuer" value="https://sts.windows.net/[AAD Tenant ID]/" />

    <span data-ttu-id="f1a36-322">Em [decodificador de JWT](http://jwt.calebb.net/), você deve ver **aud** e **iss** abaixo no token JWT hello:</span><span class="sxs-lookup"><span data-stu-id="f1a36-322">In [JWT Decoder](http://jwt.calebb.net/), you should see **aud** and **iss** as below in hello JWT token:</span></span>

    ![1ª pegadinha](./media/media-services-cenc-with-multidrm-access-control/media-services-1st-gotcha.png)
2. <span data-ttu-id="f1a36-324">Adicione o aplicativo de toohello de permissões no AAD (na guia Configurar do aplicativo hello).</span><span class="sxs-lookup"><span data-stu-id="f1a36-324">Add Permissions toohello application in AAD (on Configure tab of hello application).</span></span> <span data-ttu-id="f1a36-325">Isso é necessário para cada aplicativo (versões locais e implantadas).</span><span class="sxs-lookup"><span data-stu-id="f1a36-325">This is required for each application (local and deployed versions).</span></span>

    ![2ª pegadinha](./media/media-services-cenc-with-multidrm-access-control/media-services-perms-to-other-apps.png)
3. <span data-ttu-id="f1a36-327">Use o emissor de saudação à direita na configuração de proteção de CENC dinâmica:</span><span class="sxs-lookup"><span data-stu-id="f1a36-327">Use hello right issuer in setting up dynamic CENC protection:</span></span>

        <add key="ida:issuer" value="https://sts.windows.net/[AAD Tenant ID]/"/>

    <span data-ttu-id="f1a36-328">Olá seguinte não funcionará:</span><span class="sxs-lookup"><span data-stu-id="f1a36-328">hello following will not work:</span></span>

        <add key="ida:issuer" value="https://willzhanad.onmicrosoft.com/" />

    <span data-ttu-id="f1a36-329">Olá GUID é o ID de locatário Olá AAD.</span><span class="sxs-lookup"><span data-stu-id="f1a36-329">hello GUID is hello AAD tenant ID.</span></span> <span data-ttu-id="f1a36-330">Olá GUID pode ser encontrado no pop-up de pontos de extremidade no portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="f1a36-330">hello GUID can be found in Endpoints popup in Azure portal.</span></span>
4. <span data-ttu-id="f1a36-331">Conceder privilégios de declarações de associação de grupo.</span><span class="sxs-lookup"><span data-stu-id="f1a36-331">Grant group membership claims privileges.</span></span> <span data-ttu-id="f1a36-332">Certifique-se no arquivo de manifesto de aplicativo AAD, temos o seguinte Olá</span><span class="sxs-lookup"><span data-stu-id="f1a36-332">Make sure in AAD application manifest file, we have hello following</span></span>

    <span data-ttu-id="f1a36-333">"groupMembershipClaims": "All" (o valor padrão de saudação é nulo)</span><span class="sxs-lookup"><span data-stu-id="f1a36-333">"groupMembershipClaims": "All",    (hello default value is null)</span></span>
5. <span data-ttu-id="f1a36-334">Definir o TokenType apropriado durante a criação de requisitos de restrição.</span><span class="sxs-lookup"><span data-stu-id="f1a36-334">Setting proper TokenType when creating restriction requirements.</span></span>

        objTokenRestrictionTemplate.TokenType = TokenType.JWT;

    <span data-ttu-id="f1a36-335">Como adicionar suporte de JWT (AAD) além do tooSWT (ACS), o padrão de saudação TokenType é TokenType.JWT.</span><span class="sxs-lookup"><span data-stu-id="f1a36-335">Since adding support of JWT (AAD) in addition tooSWT (ACS), hello default TokenType is TokenType.JWT.</span></span> <span data-ttu-id="f1a36-336">Se você usar o SWT/ACS, você deve definir tooTokenType.SWT.</span><span class="sxs-lookup"><span data-stu-id="f1a36-336">If you use SWT/ACS, you must set tooTokenType.SWT.</span></span>

## <a name="additional-topics-for-implementation"></a><span data-ttu-id="f1a36-337">Tópicos Adicionais para Implementação</span><span class="sxs-lookup"><span data-stu-id="f1a36-337">Additional Topics for Implementation</span></span>
<span data-ttu-id="f1a36-338">Em seguida, iremos analisar alguns tópicos adicionais em nosso design e implementação.</span><span class="sxs-lookup"><span data-stu-id="f1a36-338">Next we will disc uss some additional topics in our design and implementation.</span></span>

### <a name="http-or-https"></a><span data-ttu-id="f1a36-339">HTTP ou HTTPS?</span><span class="sxs-lookup"><span data-stu-id="f1a36-339">HTTP or HTTPS?</span></span>
<span data-ttu-id="f1a36-340">Olá aplicativo de player do ASP.NET MVC que criamos deve oferecer suporte a seguir hello:</span><span class="sxs-lookup"><span data-stu-id="f1a36-340">hello ASP.NET MVC player application we built must support hello following:</span></span>

1. <span data-ttu-id="f1a36-341">Autenticação de usuário por meio do AD do Azure que precisa toobe em HTTPS.</span><span class="sxs-lookup"><span data-stu-id="f1a36-341">User authentication through Azure AD which needs toobe under HTTPS;</span></span>
2. <span data-ttu-id="f1a36-342">Troca de token de JWT entre o cliente e o Azure AD que precisa toobe em HTTPS.</span><span class="sxs-lookup"><span data-stu-id="f1a36-342">JWT token exchange between client and Azure AD which needs toobe under HTTPS;</span></span>
3. <span data-ttu-id="f1a36-343">Aquisição de licença do DRM pelo cliente de saudação que é necessário toobe em HTTPS se a entrega de licença é fornecida pelos serviços de mídia do Azure.</span><span class="sxs-lookup"><span data-stu-id="f1a36-343">DRM license acquisition by hello client which is required toobe under HTTPS if license delivery is provided by Azure Media Services.</span></span> <span data-ttu-id="f1a36-344">Obviamente, o pacote de produtos PlayReady não obriga HTTPS para entrega de licença.</span><span class="sxs-lookup"><span data-stu-id="f1a36-344">Of course, PlayReady product suite does not mandate HTTPS for license delivery.</span></span> <span data-ttu-id="f1a36-345">Se o servidor de licença do PlayReady estiver fora dos Serviços de Mídia do Azure, HTTP ou HTTPS poderão ser usados.</span><span class="sxs-lookup"><span data-stu-id="f1a36-345">If your PlayReady license server is outside of Azure Media Services, either HTTP or HTTPS could be used.</span></span>

<span data-ttu-id="f1a36-346">Portanto, Olá aplicativo de player ASP.NET usará o HTTPS como uma prática recomendada.</span><span class="sxs-lookup"><span data-stu-id="f1a36-346">Therefore, hello ASP.NET player application will use HTTPS as a best practice.</span></span> <span data-ttu-id="f1a36-347">Isso significa hello que Azure Media Player será uma página em HTTPS.</span><span class="sxs-lookup"><span data-stu-id="f1a36-347">This means hello Azure Media Player will be on a page under HTTPS.</span></span> <span data-ttu-id="f1a36-348">No entanto, para streaming preferem HTTP, portanto, precisamos tooconsider misto problema conteúdo.</span><span class="sxs-lookup"><span data-stu-id="f1a36-348">However, for streaming we prefer HTTP, hence we need tooconsider mixed content issue.</span></span>

1. <span data-ttu-id="f1a36-349">O navegador não permite conteúdo misto.</span><span class="sxs-lookup"><span data-stu-id="f1a36-349">Browser does not allow mixed content.</span></span> <span data-ttu-id="f1a36-350">Mas os plug-ins como o plug-in do Silverlight e do OSMF para smooth e DASH, sim.</span><span class="sxs-lookup"><span data-stu-id="f1a36-350">But plugins like Silverlight and OSMF plugin for smooth and DASH allow.</span></span> <span data-ttu-id="f1a36-351">Conteúdo misto é uma preocupação de segurança - isso é devido a ameaça de toohello de saudação capacidade tooinject JS mal-intencionado que pode causar Olá toobe de dados do cliente em risco.</span><span class="sxs-lookup"><span data-stu-id="f1a36-351">Mixed content is a security concern - This is due toohello threat of hello ability tooinject malicious JS which can cause hello customer data toobe at risk.</span></span>  <span data-ttu-id="f1a36-352">Esse bloqueiam navegadores por padrão e até o momento Olá toowork de maneira somente ao redor dele é no lado do servidor (origem) de hello, tooallow todos os domínios (independentemente https ou http).</span><span class="sxs-lookup"><span data-stu-id="f1a36-352">Browsers block this by default and so far hello only way toowork around it is on hello server (origin) side, tooallow all domains (regardless https or http).</span></span> <span data-ttu-id="f1a36-353">Isso provavelmente também não será uma boa ideia.</span><span class="sxs-lookup"><span data-stu-id="f1a36-353">This is probably not a good idea either.</span></span>
2. <span data-ttu-id="f1a36-354">Devemos evitar conteúdo misto: ou ambos usam HTTP, ou ambos usam HTTPS.</span><span class="sxs-lookup"><span data-stu-id="f1a36-354">We should avoid mixed content: either both use HTTP or both use HTTPS.</span></span> <span data-ttu-id="f1a36-355">Durante a reprodução de conteúdo misto, a tecnologia silverlightSS exige a desmarcação de um aviso de conteúdo misto.</span><span class="sxs-lookup"><span data-stu-id="f1a36-355">When playing mixed content, silverlightSS tech requires clearing a mixed content warning.</span></span> <span data-ttu-id="f1a36-356">A tecnologia flashSS lida com conteúdo misto sem aviso de conteúdo misto.</span><span class="sxs-lookup"><span data-stu-id="f1a36-356">flashSS tech handles mixed content without mixed content warning.</span></span>
3. <span data-ttu-id="f1a36-357">Se o ponto de extremidade de streaming foi criado antes de agosto de 2014, ele não dá suporte a HTTPS.</span><span class="sxs-lookup"><span data-stu-id="f1a36-357">If your streaming endpoint was created before August 2014, it will not support HTTPS.</span></span> <span data-ttu-id="f1a36-358">Nesse caso, crie e use um novo ponto de extremidade de streaming para HTTPS.</span><span class="sxs-lookup"><span data-stu-id="f1a36-358">In this case, please create and use a new streaming endpoint for HTTPS.</span></span>

<span data-ttu-id="f1a36-359">Na implementação de referência de saudação para conteúdo protegido por DRM, aplicativo e o streaming será em HTTTPS.</span><span class="sxs-lookup"><span data-stu-id="f1a36-359">In hello reference implementation, for DRM protected contents, both application and streaming will be under HTTTPS.</span></span> <span data-ttu-id="f1a36-360">Para abrir o conteúdo, player Olá não precisa de autenticação ou licença, para que você tenha Olá liberty toouse o HTTP ou HTTPS.</span><span class="sxs-lookup"><span data-stu-id="f1a36-360">For open contents, hello player does not need authentication or license, so you have hello liberty toouse either HTTP or HTTPS.</span></span>

### <a name="azure-active-directory-signing-key-rollover"></a><span data-ttu-id="f1a36-361">Substituição de chave de assinatura do Active Directory do Azure</span><span class="sxs-lookup"><span data-stu-id="f1a36-361">Azure Active Directory signing key rollover</span></span>
<span data-ttu-id="f1a36-362">Este é um tootake ponto importante em consideração de sua implementação.</span><span class="sxs-lookup"><span data-stu-id="f1a36-362">This is an important point tootake into consideration of your implementation.</span></span> <span data-ttu-id="f1a36-363">Se você não considere isto em sua implementação, sistema Olá concluída eventualmente deixarão de funcionar completamente dentro de no máximo de 6 semanas.</span><span class="sxs-lookup"><span data-stu-id="f1a36-363">If you do not consider this in your implementation, hello completed system will eventually stop working completely within at most 6 weeks.</span></span>

<span data-ttu-id="f1a36-364">O AD do Azure usa setor tooestablish padrão confiança entre ele mesmo e aplicativos usando o Azure AD.</span><span class="sxs-lookup"><span data-stu-id="f1a36-364">Azure AD uses industry standard tooestablish trust between itself and applications using Azure AD.</span></span> <span data-ttu-id="f1a36-365">Especificamente, o AD do Azure usa uma chave de assinatura que consiste em um par de chaves público e privado.</span><span class="sxs-lookup"><span data-stu-id="f1a36-365">Specifically, Azure AD uses a signing key that consists of a public and private key pair.</span></span> <span data-ttu-id="f1a36-366">Quando o AD do Azure cria um token de segurança que contém informações sobre o usuário hello, esse token é assinado pelo AD do Azure usando sua chave privada antes de serem enviado back toohello aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f1a36-366">When Azure AD creates a security token that contains information about hello user, this token is signed by Azure AD using its private key before it is sent back toohello application.</span></span> <span data-ttu-id="f1a36-367">tooverify Olá token seja válido e realmente originado do AD do Azure, o aplicativo hello deve validar a assinatura do token hello usando a chave pública do hello exposto pelo AD do Azure que está contido no documento de metadados de Federação do locatário hello.</span><span class="sxs-lookup"><span data-stu-id="f1a36-367">tooverify that hello token is valid and actually originated from Azure AD, hello application must validate hello token’s signature using hello public key exposed by Azure AD that is contained in hello tenant’s federation metadata document.</span></span> <span data-ttu-id="f1a36-368">Esta chave pública – e saudação da qual deriva de chave de assinatura – são hello mesmo aquele usado para todos os locatários no AD do Azure.</span><span class="sxs-lookup"><span data-stu-id="f1a36-368">This public key – and hello signing key from which it derives – is hello same one used for all tenants in Azure AD.</span></span>

<span data-ttu-id="f1a36-369">Informações detalhadas sobre a substituição de chave do AD do Azure podem ser encontradas no documento hello: [informações importantes sobre substituição de chave de assinatura no AD do Azure](../active-directory/active-directory-signing-key-rollover.md).</span><span class="sxs-lookup"><span data-stu-id="f1a36-369">Detailed info on Azure AD key rollover can be found in hello document: [Important Information about Signing Key Rollover in Azure AD](../active-directory/active-directory-signing-key-rollover.md).</span></span>

<span data-ttu-id="f1a36-370">Entre hello [par de chaves públicas-privadas](https://login.microsoftonline.com/common/discovery/keys/),</span><span class="sxs-lookup"><span data-stu-id="f1a36-370">Between hello [public-private key pair](https://login.microsoftonline.com/common/discovery/keys/),</span></span>

* <span data-ttu-id="f1a36-371">chave privada Olá é usado pelo Active Directory do Azure toogenerate um token JWT;</span><span class="sxs-lookup"><span data-stu-id="f1a36-371">hello private key is used by Azure Active Directory toogenerate a JWT token;</span></span>
* <span data-ttu-id="f1a36-372">chave pública de saudação é usada por um aplicativo, como serviços de distribuição de licença do DRM no token JWT de saudação do AMS tooverify;</span><span class="sxs-lookup"><span data-stu-id="f1a36-372">hello public key is used by an application such as DRM License Delivery Services in AMS tooverify hello JWT token;</span></span>

<span data-ttu-id="f1a36-373">Para fins de segurança, o Active Directory do Azure gira esse certificado periodicamente (a cada 6 semanas).</span><span class="sxs-lookup"><span data-stu-id="f1a36-373">For security purpose, Azure Active Directory rotates this certificate periodically (every 6 weeks).</span></span> <span data-ttu-id="f1a36-374">No caso de violações de segurança, substituição de chave Olá pode ocorrer qualquer momento.</span><span class="sxs-lookup"><span data-stu-id="f1a36-374">In case of security breaches, hello key rollover can occur any time.</span></span> <span data-ttu-id="f1a36-375">Portanto, serviços de distribuição de licença Olá no AMS necessário chave pública do hello tooupdate usado como o AD do Azure gira o par de chaves hello, caso contrário, a autenticação de token em AMS falhará e nenhuma licença será emitida.</span><span class="sxs-lookup"><span data-stu-id="f1a36-375">Therefore, hello license delivery services in AMS need tooupdate hello public key used as Azure AD rotates hello key pair, otherwise token authentication in AMS will fail and no license will be issued.</span></span>

<span data-ttu-id="f1a36-376">Isso é feito definindo TokenRestrictionTemplate.OpenIdConnectDiscoveryDocument ao configurar serviços de distribuição de licença do DRM.</span><span class="sxs-lookup"><span data-stu-id="f1a36-376">This is achieved by setting TokenRestrictionTemplate.OpenIdConnectDiscoveryDocument when configuring DRM license delivery services.</span></span>

<span data-ttu-id="f1a36-377">Olá fluxo do token JWT é como abaixo:</span><span class="sxs-lookup"><span data-stu-id="f1a36-377">hello JWT token flow is as below:</span></span>

1. <span data-ttu-id="f1a36-378">AD do Azure emite o token de JWT Olá com chave privada atual de saudação para um usuário autenticado;</span><span class="sxs-lookup"><span data-stu-id="f1a36-378">Azure AD will issue hello JWT token with hello current private key for an authenticated user;</span></span>
2. <span data-ttu-id="f1a36-379">Quando um player vê um CENC com conteúdo protegido por DRM de várias, ele localizará primeiro token JWT de saudação emitido pelo AD do Azure.</span><span class="sxs-lookup"><span data-stu-id="f1a36-379">When a player sees a CENC with multi-DRM protected content, it will first locate hello JWT token issued by Azure AD.</span></span>
3. <span data-ttu-id="f1a36-380">player de saudação envia a solicitação de aquisição de licença com serviços de distribuição de toolicense token de JWT de saudação em AMS;</span><span class="sxs-lookup"><span data-stu-id="f1a36-380">hello player sends license acquisition request with hello JWT token toolicense delivery services in AMS;</span></span>
4. <span data-ttu-id="f1a36-381">Serviços de distribuição de licença Olá no AMS usará Olá atual/uma chave pública válida do token JWT do AD do Azure tooverify hello, antes de emitir licenças.</span><span class="sxs-lookup"><span data-stu-id="f1a36-381">hello license delivery services in AMS will use hello current/valid public key from Azure AD tooverify hello JWT token, before issuing licenses.</span></span>

<span data-ttu-id="f1a36-382">Serviços de distribuição de licença do DRM sempre serão ser verificando Olá atual/uma chave pública válida do AD do Azure.</span><span class="sxs-lookup"><span data-stu-id="f1a36-382">DRM license delivery services will always be checking for hello current/valid public key from Azure AD.</span></span> <span data-ttu-id="f1a36-383">chave pública de saudação apresentado pelo AD do Azure será chave Olá usado para verificar um token JWT emitido pelo AD do Azure.</span><span class="sxs-lookup"><span data-stu-id="f1a36-383">hello public key presented by Azure AD will be hello key used for verifying a JWT token issued by Azure AD.</span></span>

<span data-ttu-id="f1a36-384">E se substituição de chave Olá acontece depois AAD gera um token JWT, mas antes de saudação JWT token é enviado por jogadores tooDRM licença serviços de distribuição no AMS para verificação?</span><span class="sxs-lookup"><span data-stu-id="f1a36-384">What if hello key rollover happens after AAD generates a JWT token but before hello JWT token is sent by players tooDRM license delivery services in AMS for verification?</span></span>

<span data-ttu-id="f1a36-385">Como uma chave pode ser substituída em qualquer momento, há sempre mais de uma chave pública válida disponível no documento de metadados de Federação hello.</span><span class="sxs-lookup"><span data-stu-id="f1a36-385">Because a key may be rolled at any moment, there is always more than one valid public key available in hello federation metadata document.</span></span> <span data-ttu-id="f1a36-386">Entrega de licença dos serviços de mídia do Azure pode usar qualquer um dos Olá chaves especificadas no documento hello, pois uma chave pode ser substituída em breve, outra pode ser seu substituição e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="f1a36-386">Azure Media Services license delivery can use any of hello keys specified in hello document, since one key may be rolled soon, another may be its replacement, and so forth.</span></span>

### <a name="where-is-hello-access-token"></a><span data-ttu-id="f1a36-387">Onde é Olá Token de acesso?</span><span class="sxs-lookup"><span data-stu-id="f1a36-387">Where is hello Access Token?</span></span>
<span data-ttu-id="f1a36-388">Se você examinar como um aplicativo web chama um aplicativo de API em [identidade do aplicativo com a concessão de credenciais de cliente OAuth 2.0](../active-directory/develop/active-directory-authentication-scenarios.md#web-application-to-web-api), é o fluxo de autenticação hello como abaixo:</span><span class="sxs-lookup"><span data-stu-id="f1a36-388">If you look at how a web app calls an API app under [Application Identity with OAuth 2.0 Client Credentials Grant](../active-directory/develop/active-directory-authentication-scenarios.md#web-application-to-web-api), hello authentication flow is as below:</span></span>

1. <span data-ttu-id="f1a36-389">Um usuário está conectado no tooAzure AD no aplicativo da web hello (consulte Olá [tooWeb do navegador da Web aplicativo](../active-directory/develop/active-directory-authentication-scenarios.md#web-browser-to-web-application).</span><span class="sxs-lookup"><span data-stu-id="f1a36-389">A user is signed in tooAzure AD in hello web application (see hello [Web Browser tooWeb Application](../active-directory/develop/active-directory-authentication-scenarios.md#web-browser-to-web-application).</span></span>
2. <span data-ttu-id="f1a36-390">ponto de extremidade de autorização de saudação do AD do Azure redireciona o agente do usuário de Olá toohello back aplicativo cliente com um código de autorização.</span><span class="sxs-lookup"><span data-stu-id="f1a36-390">hello Azure AD authorization endpoint redirects hello user agent back toohello client application with an authorization code.</span></span> <span data-ttu-id="f1a36-391">agente do usuário Olá retorna o URI de redirecionamento do aplicativo do cliente toohello código autorização.</span><span class="sxs-lookup"><span data-stu-id="f1a36-391">hello user agent returns authorization code toohello client application’s redirect URI.</span></span>
3. <span data-ttu-id="f1a36-392">aplicativo da web Hello precisa tooacquire um token de acesso para que ele possa autenticar toohello web API e recuperar o recurso de saudação desejado.</span><span class="sxs-lookup"><span data-stu-id="f1a36-392">hello web application needs tooacquire an access token so that it can authenticate toohello web API and retrieve hello desired resource.</span></span> <span data-ttu-id="f1a36-393">Faz uma tooAzure de solicitação do AD do ponto de extremidade token, fornecendo credenciais de hello, ID do cliente e URI de ID do aplicativo da API da web.</span><span class="sxs-lookup"><span data-stu-id="f1a36-393">It makes a request tooAzure AD’s token endpoint, providing hello credential, client ID, and web API’s application ID URI.</span></span> <span data-ttu-id="f1a36-394">Ele apresenta Olá tooprove de código de autorização que Olá usuário consentiu.</span><span class="sxs-lookup"><span data-stu-id="f1a36-394">It presents hello authorization code tooprove that hello user has consented.</span></span>
4. <span data-ttu-id="f1a36-395">O AD do Azure autentica o aplicativo hello e retorna um token de acesso JWT que é usado toocall Olá web API.</span><span class="sxs-lookup"><span data-stu-id="f1a36-395">Azure AD authenticates hello application and returns a JWT access token that is used toocall hello web API.</span></span>
5. <span data-ttu-id="f1a36-396">Via HTTPS, o aplicativo da web hello usa Olá retornado Olá tooadd token de acesso JWT cadeia de caracteres JWT com uma designação "Portador" no cabeçalho de autorização de saudação da API da web do toohello Olá solicitação.</span><span class="sxs-lookup"><span data-stu-id="f1a36-396">Over HTTPS, hello web application uses hello returned JWT access token tooadd hello JWT string with a “Bearer” designation in hello Authorization header of hello request toohello web API.</span></span> <span data-ttu-id="f1a36-397">Olá web API, em seguida, valida o token JWT hello e se a validação for bem-sucedida, retorna Olá desejado de recursos.</span><span class="sxs-lookup"><span data-stu-id="f1a36-397">hello web API then validates hello JWT token, and if validation is successful, returns hello desired resource.</span></span>

<span data-ttu-id="f1a36-398">Nesse fluxo "identidade de aplicativo", Olá web API confia usuário Olá web aplicativo saudação autenticada.</span><span class="sxs-lookup"><span data-stu-id="f1a36-398">In this “application identity” flow, hello web API trusts that hello web application authenticated hello user.</span></span> <span data-ttu-id="f1a36-399">Por esse motivo, esse padrão é chamado de subsistema confiável.</span><span class="sxs-lookup"><span data-stu-id="f1a36-399">For this reason, this pattern is called a trusted subsystem.</span></span> <span data-ttu-id="f1a36-400">Olá [diagrama nesta página](https://docs.microsoft.com/azure/active-directory/active-directory-protocols-oauth-code) descreve como o código de autorização conceder fluxo funciona.</span><span class="sxs-lookup"><span data-stu-id="f1a36-400">hello [diagram on this page](https://docs.microsoft.com/azure/active-directory/active-directory-protocols-oauth-code) describes how authorization code grant flow works.</span></span>

<span data-ttu-id="f1a36-401">Na aquisição de licença com a restrição de token, podemos seguir Olá mesmo padrão de subsistema confiável.</span><span class="sxs-lookup"><span data-stu-id="f1a36-401">In license acquisition with token restriction, we are following hello same trusted subsystem pattern.</span></span> <span data-ttu-id="f1a36-402">Serviço de entrega de licença Olá nos serviços de mídia do Azure é recurso Olá API da web hello "recursos de back-end" tooaccess precisa de um aplicativo da web.</span><span class="sxs-lookup"><span data-stu-id="f1a36-402">And hello license delivery service in Azure Media Services is hello web API resource, hello “backend resource” a web application needs tooaccess.</span></span> <span data-ttu-id="f1a36-403">Onde está o token de acesso Olá?</span><span class="sxs-lookup"><span data-stu-id="f1a36-403">So where is hello access token?</span></span>

<span data-ttu-id="f1a36-404">Na verdade, podemos obter token de acesso do AD do Azure.</span><span class="sxs-lookup"><span data-stu-id="f1a36-404">Indeed, we are obtaining access token from Azure AD.</span></span> <span data-ttu-id="f1a36-405">Após a autenticação bem-sucedida do usuário, o código de autorização é retornado.</span><span class="sxs-lookup"><span data-stu-id="f1a36-405">After successful user authentication, authorization code is returned.</span></span> <span data-ttu-id="f1a36-406">código de autorização de saudação é usado, junto com a chave de ID e o aplicativo cliente, tooexchange de token de acesso.</span><span class="sxs-lookup"><span data-stu-id="f1a36-406">hello authorization code is then used, together with client ID and app key, tooexchange for access token.</span></span> <span data-ttu-id="f1a36-407">E o token de acesso Olá para acessar um aplicativo de "ponteiro" apontando ou que representa o serviço de entrega de licença de serviços de mídia do Azure.</span><span class="sxs-lookup"><span data-stu-id="f1a36-407">And hello access token is for accessing a “pointer” application pointing or representing Azure Media Services license delivery service.</span></span>

<span data-ttu-id="f1a36-408">Precisamos tooregister e configurar hello "ponteiro" aplicativo no AD do Azure seguindo as etapas de saudação abaixo:</span><span class="sxs-lookup"><span data-stu-id="f1a36-408">We need tooregister and configure hello “pointer” app in Azure AD by following hello steps below:</span></span>

1. <span data-ttu-id="f1a36-409">No locatário de saudação do AD do Azure</span><span class="sxs-lookup"><span data-stu-id="f1a36-409">In hello Azure AD tenant</span></span>

   * <span data-ttu-id="f1a36-410">adicione um aplicativo (recurso) com a URL de logon:</span><span class="sxs-lookup"><span data-stu-id="f1a36-410">add an application (resource) with sign-on URL:</span></span>

   <span data-ttu-id="f1a36-411">https://[nome_do_recurso].azurewebsites.net/ e</span><span class="sxs-lookup"><span data-stu-id="f1a36-411">https://[resource_name].azurewebsites.net/ and</span></span>

   * <span data-ttu-id="f1a36-412">URL da ID do aplicativo:</span><span class="sxs-lookup"><span data-stu-id="f1a36-412">app ID URL:</span></span>

   <span data-ttu-id="f1a36-413">https://[nome_do_locatário_aad].onmicrosoft.com/[nome_do_recurso];</span><span class="sxs-lookup"><span data-stu-id="f1a36-413">https://[aad_tenant_name].onmicrosoft.com/[resource_name];</span></span>
2. <span data-ttu-id="f1a36-414">Adicione uma nova chave para o aplicativo de recurso Olá;</span><span class="sxs-lookup"><span data-stu-id="f1a36-414">Add a new key for hello resource app;</span></span>
3. <span data-ttu-id="f1a36-415">Atualizar o arquivo de manifesto de aplicativo hello para que a propriedade de groupMembershipClaims Olá tem Olá seguinte valor: "groupMembershipClaims": "Todas",</span><span class="sxs-lookup"><span data-stu-id="f1a36-415">Update hello app manifest file so that hello groupMembershipClaims property has hello following value: "groupMembershipClaims": "All",</span></span>  
4. <span data-ttu-id="f1a36-416">No aplicativo do AD do Azure Olá apontando toohello player web app, na seção hello "permissões tooother aplicativos", adicione Olá aplicativo de recurso que foi adicionado na etapa 1 acima.</span><span class="sxs-lookup"><span data-stu-id="f1a36-416">In hello Azure AD app pointing toohello player web app, in hello section “permissions tooother applications”, add hello resource app which was added in step 1 above.</span></span> <span data-ttu-id="f1a36-417">Em "permissões delegadas", verifique a marca de seleção de "Acessar [nome_recurso]".</span><span class="sxs-lookup"><span data-stu-id="f1a36-417">Under “delegated permissions” check “Access [resource_name]” checkmark.</span></span> <span data-ttu-id="f1a36-418">Isso dá permissão do aplicativo web hello toocreate tokens de acesso para acessar o aplicativo de recurso de saudação.</span><span class="sxs-lookup"><span data-stu-id="f1a36-418">This gives hello web app permission toocreate access tokens for accessing hello resource app.</span></span> <span data-ttu-id="f1a36-419">Você deve fazer isso para a versão local e implantado do aplicativo de web hello, se você estiver desenvolvendo com o aplicativo web do Visual Studio e o Azure.</span><span class="sxs-lookup"><span data-stu-id="f1a36-419">You should do this for both local and deployed version of hello web app if you are developing with Visual Studio and Azure web app.</span></span>

<span data-ttu-id="f1a36-420">Portanto, token JWT de saudação emitido pelo AD do Azure é realmente token de acesso de saudação para acessar esse recurso de "ponteiro".</span><span class="sxs-lookup"><span data-stu-id="f1a36-420">Therefore, hello JWT token issued by Azure AD is indeed hello access token for accessing this “pointer” resource.</span></span>

### <a name="what-about-live-streaming"></a><span data-ttu-id="f1a36-421">E quanto à Transmissão ao Vivo?</span><span class="sxs-lookup"><span data-stu-id="f1a36-421">What about Live Streaming?</span></span>
<span data-ttu-id="f1a36-422">Em Olá acima, nossa discussão tem sido focando ativos sob demanda.</span><span class="sxs-lookup"><span data-stu-id="f1a36-422">In hello above, our discussion has been focusing on on-demand assets.</span></span> <span data-ttu-id="f1a36-423">E quanto à Transmissão ao Vivo?</span><span class="sxs-lookup"><span data-stu-id="f1a36-423">What about live streaming?</span></span>

<span data-ttu-id="f1a36-424">Olá boa notícia é que você pode usar exatamente Olá mesmo design e implementação para proteger a transmissão ao vivo nos serviços de mídia do Azure, tratando ativo Olá associado a um programa como um ativo VOD"".</span><span class="sxs-lookup"><span data-stu-id="f1a36-424">hello good news is that you can use exactly hello same design and implementation for protecting live streaming in Azure Media Services, by treating hello asset associated with a program as a “VOD asset”.</span></span>

<span data-ttu-id="f1a36-425">Especificamente, é bem conhecido que toodo live streaming nos serviços de mídia do Azure, é necessário toocreate um canal, em seguida, um programa em canal de saudação.</span><span class="sxs-lookup"><span data-stu-id="f1a36-425">Specifically, it is well known that toodo live streaming in Azure Media Services, you need toocreate a channel, then a program under hello channel.</span></span> <span data-ttu-id="f1a36-426">programa de saudação toocreate, você precisa toocreate um ativo que conterá o arquivamento de dinâmico Olá para programa hello.</span><span class="sxs-lookup"><span data-stu-id="f1a36-426">toocreate hello program, you need toocreate an asset which will contain hello live archive for hello program.</span></span> <span data-ttu-id="f1a36-427">Em ordem tooprovide CENC com proteção de várias DRM de conteúdo ao vivo Olá, tudo o que você precisa toodo, é tooapply Olá mesmo ativo toohello de instalação para o processamento como se fosse um ativo VOD"" antes de iniciar o programa de saudação.</span><span class="sxs-lookup"><span data-stu-id="f1a36-427">In order tooprovide CENC with multi-DRM protection of hello live content, all you need toodo, is tooapply hello same setup/processing toohello asset as if it was a “VOD asset” before you start hello program.</span></span>

### <a name="what-about-license-servers-outside-of-azure-media-services"></a><span data-ttu-id="f1a36-428">E os servidores de licença fora dos Serviços de Mídia do Azure?</span><span class="sxs-lookup"><span data-stu-id="f1a36-428">What about license servers outside of Azure Media Services?</span></span>
<span data-ttu-id="f1a36-429">Muitas vezes os clientes investiram em um farm de servidores de licença em seu próprio data center ou hospedado por provedores de serviço DRM.</span><span class="sxs-lookup"><span data-stu-id="f1a36-429">Often, customers may have invested in license server farm either in their own data center or hosted by DRM service providers.</span></span> <span data-ttu-id="f1a36-430">Felizmente, proteção de conteúdo do Azure Media Services permite que você toooperate no modo híbrido: conteúdo hospedado e dinamicamente protegida nos serviços de mídia do Azure, ao mesmo tempo licenças DRM são fornecidas pelos servidores fora do Azure Media Services.</span><span class="sxs-lookup"><span data-stu-id="f1a36-430">Fortunately, Azure Media Services Content Protection allows you toooperate in hybrid mode: contents hosted and dynamically protected in Azure Media Services, while DRM licenses are delivered by servers outside Azure Media Services.</span></span> <span data-ttu-id="f1a36-431">Nesse caso, há Olá considerações das alterações a seguir:</span><span class="sxs-lookup"><span data-stu-id="f1a36-431">In this case, there are hello following considerations of changes:</span></span>

1. <span data-ttu-id="f1a36-432">Olá serviço de Token seguro necessidades tooissue tokens que são aceitáveis e podem ser verificadas pelo farm de servidores de licença hello.</span><span class="sxs-lookup"><span data-stu-id="f1a36-432">hello Secure Token Service needs tooissue tokens which are acceptable and can be verified by hello license server farm.</span></span> <span data-ttu-id="f1a36-433">Por exemplo, servidores de licenças Widevine Olá fornecidos pelo Axinom requer um token JWT específico que contém "mensagem de direitos".</span><span class="sxs-lookup"><span data-stu-id="f1a36-433">For example, hello Widevine license servers provided by Axinom requires a specific JWT token which contains “entitlement message”.</span></span> <span data-ttu-id="f1a36-434">Portanto, você precisa toohave tooissue um STS tal token JWT.</span><span class="sxs-lookup"><span data-stu-id="f1a36-434">Therefore, you need toohave an STS tooissue such JWT token.</span></span> <span data-ttu-id="f1a36-435">autores de saudação concluiu essa implementação e você pode encontrar detalhes de saudação em Olá seguindo o documento em [Centro de documentação do Azure](https://azure.microsoft.com/documentation/): [toodeliver Axinom usando Widevine licenças dos serviços de mídia tooAzure](media-services-axinom-integration.md).</span><span class="sxs-lookup"><span data-stu-id="f1a36-435">hello authors have completed such an implementation and you can find hello details in hello following document in [Azure Documentation Center](https://azure.microsoft.com/documentation/): [Using Axinom toodeliver Widevine licenses tooAzure Media Services](media-services-axinom-integration.md).</span></span>
2. <span data-ttu-id="f1a36-436">Você não precisar mais serviço de entrega de licença tooconfigure (ContentKeyAuthorizationPolicy) nos serviços de mídia do Azure.</span><span class="sxs-lookup"><span data-stu-id="f1a36-436">You no longer need tooconfigure license delivery service (ContentKeyAuthorizationPolicy) in Azure Media Services.</span></span> <span data-ttu-id="f1a36-437">O que você precisa é de toodo URLs de aquisição de licença tooprovide hello (para PlayReady, Widevine e FairPlay) quando você configura AssetDeliveryPolicy na configuração de CENC com DRM de várias.</span><span class="sxs-lookup"><span data-stu-id="f1a36-437">What you need toodo is tooprovide hello license acquisition URLs (for PlayReady, Widevine and FairPlay) when you configure AssetDeliveryPolicy in setting up CENC with multi-DRM.</span></span>

### <a name="what-if-i-want-toouse-a-custom-sts"></a><span data-ttu-id="f1a36-438">E se eu desejar toouse um STS personalizado?</span><span class="sxs-lookup"><span data-stu-id="f1a36-438">What if I want toouse a custom STS?</span></span>
<span data-ttu-id="f1a36-439">Pode haver alguns motivos que um cliente pode escolher toouse um STS personalizado (serviço de Token seguro) para fornecer tokens JWT.</span><span class="sxs-lookup"><span data-stu-id="f1a36-439">There could be a few reasons that a customer may choose toouse a custom STS (Secure Token Service) for providing JWT tokens.</span></span> <span data-ttu-id="f1a36-440">Alguns deles são:</span><span class="sxs-lookup"><span data-stu-id="f1a36-440">Some of them are:</span></span>

1. <span data-ttu-id="f1a36-441">Olá provedor de identidade (IDP) usado pelo cliente de saudação não oferece suporte para o STS.</span><span class="sxs-lookup"><span data-stu-id="f1a36-441">hello Identity Provider (IDP) used by hello customer does not support STS.</span></span> <span data-ttu-id="f1a36-442">Nesse caso, um STS personalizado pode ser uma opção.</span><span class="sxs-lookup"><span data-stu-id="f1a36-442">In this case a custom STS may be an option.</span></span>
2. <span data-ttu-id="f1a36-443">Prezado cliente talvez seja necessário mais flexível ou maior controle no STS integrando o assinante de cliente sistema de cobrança.</span><span class="sxs-lookup"><span data-stu-id="f1a36-443">hello customer may need more flexible or tighter control in integrating STS with customer’s subscriber billing system.</span></span> <span data-ttu-id="f1a36-444">Por exemplo, um operador MVPD pode oferecer vários pacotes de assinante OTT como premium, basic, tem, operador de saudação etc. Convém toomatch Olá declarações em um token com o pacote do assinante para que somente o conteúdo no pacote de saudação à direita é disponibilizada.</span><span class="sxs-lookup"><span data-stu-id="f1a36-444">For example, an MVPD operator may offer multiple OTT subscriber packages such as premium, basic, sports, etc. hello operator may want toomatch hello claims in a token with a subscriber’s package so that only contents in hello right package is made available.</span></span> <span data-ttu-id="f1a36-445">Nesse caso, um STS personalizado fornece Olá necessário flexibilidade e controle.</span><span class="sxs-lookup"><span data-stu-id="f1a36-445">In this case, a custom STS provides hello needed flexibility and control.</span></span>

<span data-ttu-id="f1a36-446">Duas alterações necessário toobe feita ao usar um STS personalizado:</span><span class="sxs-lookup"><span data-stu-id="f1a36-446">Two changes need toobe made when using a custom STS:</span></span>

1. <span data-ttu-id="f1a36-447">Ao configurar o serviço de entrega de licença para um ativo, você precisa de chave de segurança de saudação toospecify usado para verificação pelo STS personalizado hello (mais detalhes abaixo), em vez de chave atual de saudação do Active Directory do Azure.</span><span class="sxs-lookup"><span data-stu-id="f1a36-447">When configuring license delivery service for an asset, you need toospecify hello security key used for verification by hello custom STS (more details below) instead of hello current key from Azure Active Directory.</span></span>
2. <span data-ttu-id="f1a36-448">Quando um token JTW é gerado, uma chave de segurança é especificada em vez da chave privada de saudação do certificado de saudação X509 atual no Active Directory do Azure.</span><span class="sxs-lookup"><span data-stu-id="f1a36-448">When a JTW token is generated, a security key is specified instead of hello private key of hello current X509 certificate in Azure Active Directory.</span></span>

<span data-ttu-id="f1a36-449">Há dois tipos de chaves de segurança:</span><span class="sxs-lookup"><span data-stu-id="f1a36-449">There are two types of security keys:</span></span>

1. <span data-ttu-id="f1a36-450">Chave simétrica: Olá a mesma chave é usada para gerar e verificar um token JWT;</span><span class="sxs-lookup"><span data-stu-id="f1a36-450">Symmetric key: hello same key is used for both generating and verifying a JWT token;</span></span>
2. <span data-ttu-id="f1a36-451">Chave assimétrica: um par de chaves públicas-privadas no certificado é usado com a chave privada para criptografar/gerando um JWT token e hello chave pública para verificar o token Olá X509.</span><span class="sxs-lookup"><span data-stu-id="f1a36-451">Asymmetric key: a public-private key pair in an X509 certificate is used with private key for encrypting/generating a JWT token and hello public key for verifying hello token.</span></span>

#### <a name="tech-note"></a><span data-ttu-id="f1a36-452">Nota técnica</span><span class="sxs-lookup"><span data-stu-id="f1a36-452">Tech note</span></span>
<span data-ttu-id="f1a36-453">Se você usar o .NET Framework / c# como sua plataforma de desenvolvimento, Olá X509 certificado usado para a chave assimétrica de segurança deve ter o comprimento da chave de pelo menos 2048.</span><span class="sxs-lookup"><span data-stu-id="f1a36-453">If you use .NET Framework/C# as your development platform, hello X509 certificate used for asymmetric security key must have key length at least 2048.</span></span> <span data-ttu-id="f1a36-454">Este é um requisito da classe Olá System.IdentityModel.Tokens.X509AsymmetricSecurityKey no .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="f1a36-454">This is a requirement of hello class System.IdentityModel.Tokens.X509AsymmetricSecurityKey in .NET Framework.</span></span> <span data-ttu-id="f1a36-455">Caso contrário, será lançada Olá a seguinte exceção:</span><span class="sxs-lookup"><span data-stu-id="f1a36-455">Otherwise, hello following exception will be thrown:</span></span>

<span data-ttu-id="f1a36-456">IDX10630: Olá 'System.IdentityModel.Tokens.X509AsymmetricSecurityKey' para a assinatura não pode ser menor que '2048' bits.</span><span class="sxs-lookup"><span data-stu-id="f1a36-456">IDX10630: hello 'System.IdentityModel.Tokens.X509AsymmetricSecurityKey' for signing cannot be smaller than '2048' bits.</span></span>

## <a name="hello-completed-system-and-test"></a><span data-ttu-id="f1a36-457">teste e sistema Olá concluída</span><span class="sxs-lookup"><span data-stu-id="f1a36-457">hello completed system and test</span></span>
<span data-ttu-id="f1a36-458">Vamos percorrer alguns cenários no sistema de ponta a ponta Olá concluída para que os leitores podem ter uma "imagem" do comportamento de saudação basic antes de obter uma conta de logon.</span><span class="sxs-lookup"><span data-stu-id="f1a36-458">We will walk through a few scenarios in hello completed end-to-end system so that readers can have a basic “picture” of hello behavior before getting a login account.</span></span>

<span data-ttu-id="f1a36-459">Olá aplicativo da web de player e seu logon podem ser encontrados [aqui](https://openidconnectweb.azurewebsites.net/).</span><span class="sxs-lookup"><span data-stu-id="f1a36-459">hello player web application and its login can be found [here](https://openidconnectweb.azurewebsites.net/).</span></span>

<span data-ttu-id="f1a36-460">Se você precisa é de "não integrado" cenário: ativos de vídeo hospedados nos serviços de mídia do Azure que são um desprotegido ou protegido por DRM, mas sem autenticação de token (uma toowhoever licença solicitá-la de emissão), você pode testá-lo sem logon (alternando tooHTTP se o streaming de vídeo é por HTTP).</span><span class="sxs-lookup"><span data-stu-id="f1a36-460">If what you need is “non-integrated” scenario: video assets hosted in Azure Media Services which are either unprotected, or DRM protected but without token authentication (issuing a license toowhoever requesting it), you can test it without login (by switching tooHTTP if your video streaming is over HTTP).</span></span>

<span data-ttu-id="f1a36-461">Se você precisa é de cenário de ponta a ponta integrado: ativos de vídeo está sob proteção de DRM dinâmica nos serviços de mídia do Azure, com autenticação de token e o token JWT que está sendo gerada pelo AD do Azure, você precisa toologin.</span><span class="sxs-lookup"><span data-stu-id="f1a36-461">If what you need is end-to-end integrated scenario: video assets is under dynamic DRM protection in Azure Media Services, with token authentication and JWT token being generated by Azure AD, you need toologin.</span></span>

### <a name="user-login"></a><span data-ttu-id="f1a36-462">Logon de usuário</span><span class="sxs-lookup"><span data-stu-id="f1a36-462">User login</span></span>
<span data-ttu-id="f1a36-463">Em ordem tootest Olá ponta a ponta DRM sistema integrado, você precisa toohave uma "conta" criados ou adicionados.</span><span class="sxs-lookup"><span data-stu-id="f1a36-463">In order tootest hello end-to-end integrated DRM system, you need toohave an “account” created or added.</span></span>

<span data-ttu-id="f1a36-464">Qual conta?</span><span class="sxs-lookup"><span data-stu-id="f1a36-464">What account?</span></span>

<span data-ttu-id="f1a36-465">Embora o Azure originalmente permitisse acesso somente por usuários de contas da Microsoft, ele agora permite o acesso por usuários de ambos os sistemas.</span><span class="sxs-lookup"><span data-stu-id="f1a36-465">Although Azure originally allowed access only by Microsoft account users, it now allows access by users from both systems.</span></span> <span data-ttu-id="f1a36-466">Isso foi feito por ter confiança de propriedades Azure todos hello Azure AD para autenticação, com o AD do Azure autenticasse usuário institucionais e criando uma relação de Federação onde o AD do Azure confie o sistema de identidade de consumidor de conta do hello Microsoft usuários do consumidor tooauthenticate.</span><span class="sxs-lookup"><span data-stu-id="f1a36-466">This was done by having all hello Azure properties trust Azure AD for authentication, having Azure AD authenticate organizational users, and by creating a federation relationship where Azure AD trusts hello Microsoft account consumer identity system tooauthenticate consumer users.</span></span> <span data-ttu-id="f1a36-467">Como resultado, o AD do Azure é tooauthenticate capaz de contas da Microsoft "convidado" como "nativas" contas do AD do Azure.</span><span class="sxs-lookup"><span data-stu-id="f1a36-467">As a result, Azure AD is able tooauthenticate “guest” Microsoft accounts as well as “native” Azure AD accounts.</span></span>

<span data-ttu-id="f1a36-468">Desde que o AD do Azure confia no domínio de conta da Microsoft (MSA), você pode adicionar as contas de qualquer um dos Olá toohello domínios personalizados do AD do Azure a seguir de locatário e usam Olá conta toologin:</span><span class="sxs-lookup"><span data-stu-id="f1a36-468">Since Azure AD trusts Microsoft Account (MSA) domain, you can add any accounts from any of hello following domains toohello custom Azure AD tenant and use hello account toologin:</span></span>

| <span data-ttu-id="f1a36-469">**Nome de domínio**</span><span class="sxs-lookup"><span data-stu-id="f1a36-469">**Domain Name**</span></span> | <span data-ttu-id="f1a36-470">**Domínio**</span><span class="sxs-lookup"><span data-stu-id="f1a36-470">**Domain**</span></span> |
| --- | --- |
| <span data-ttu-id="f1a36-471">**Domínio de locatário do AD do Azure personalizado**</span><span class="sxs-lookup"><span data-stu-id="f1a36-471">**Custom Azure AD tenant domain**</span></span> |<span data-ttu-id="f1a36-472">somename.onmicrosoft.com</span><span class="sxs-lookup"><span data-stu-id="f1a36-472">somename.onmicrosoft.com</span></span> |
| <span data-ttu-id="f1a36-473">**Domínio corporativo**</span><span class="sxs-lookup"><span data-stu-id="f1a36-473">**Corporate domain**</span></span> |<span data-ttu-id="f1a36-474">microsoft.com</span><span class="sxs-lookup"><span data-stu-id="f1a36-474">microsoft.com</span></span> |
| <span data-ttu-id="f1a36-475">**Domínio de MSA (Conta da Microsoft)**</span><span class="sxs-lookup"><span data-stu-id="f1a36-475">**Microsoft Account (MSA) domain**</span></span> |<span data-ttu-id="f1a36-476">outlook.com, live.com, hotmail.com</span><span class="sxs-lookup"><span data-stu-id="f1a36-476">outlook.com, live.com, hotmail.com</span></span> |

<span data-ttu-id="f1a36-477">Você pode contatar qualquer Olá autores toohave uma conta criada ou adicionadas para você.</span><span class="sxs-lookup"><span data-stu-id="f1a36-477">You may contact any of hello authors toohave an account created or added for you.</span></span>

<span data-ttu-id="f1a36-478">Abaixo estão capturas de tela de saudação de páginas de logon diferentes usadas por diferentes contas de domínio.</span><span class="sxs-lookup"><span data-stu-id="f1a36-478">Below are hello screenshots of different login pages used by different domain accounts.</span></span>

<span data-ttu-id="f1a36-479">**Conta de domínio de locatário do AD do Azure personalizado**: nesse caso, você ver a página de logon personalizada de saudação do domínio de locatário Olá personalizados do AD do Azure.</span><span class="sxs-lookup"><span data-stu-id="f1a36-479">**Custom Azure AD tenant domain account**: In this case, you see hello customized login page of hello custom Azure AD tenant domain.</span></span>

![Conta de domínio do locatário do AD do Azure personalizada](./media/media-services-cenc-with-multidrm-access-control/media-services-ad-tenant-domain1.png)

<span data-ttu-id="f1a36-481">**Conta de domínio da Microsoft com cartão inteligente**: nesse caso você ver a página de logon Olá personalizada com a Microsoft corporativa IT com autenticação de dois fatores.</span><span class="sxs-lookup"><span data-stu-id="f1a36-481">**Microsoft domain account with smart card**: In this case you see hello login page customized by Microsoft corporate IT with two-factor authentication.</span></span>

![Conta de domínio do locatário do AD do Azure personalizada](./media/media-services-cenc-with-multidrm-access-control/media-services-ad-tenant-domain2.png)

<span data-ttu-id="f1a36-483">**Conta da Microsoft (MSA)**: nesse caso, você ver a página de logon de saudação do Account da Microsoft para consumidores.</span><span class="sxs-lookup"><span data-stu-id="f1a36-483">**Microsoft Account (MSA)**: In this case, you see hello login page of Microsoft Account for consumers.</span></span>

![Conta de domínio do locatário do AD do Azure personalizada](./media/media-services-cenc-with-multidrm-access-control/media-services-ad-tenant-domain3.png)

### <a name="using-encrypted-media-extensions-for-playready"></a><span data-ttu-id="f1a36-485">Usando Extensões de Mídia Criptografada para PlayReady</span><span class="sxs-lookup"><span data-stu-id="f1a36-485">Using Encrypted Media Extensions for PlayReady</span></span>
<span data-ttu-id="f1a36-486">Em um navegador moderno com criptografado mídia extensões (EME) para o PlayReady suporte, como navegador IE 11 no Windows 8.1 e backup e Microsoft Edge no Windows 10, PlayReady será hello DRM subjacente para EME.</span><span class="sxs-lookup"><span data-stu-id="f1a36-486">On a modern browser with Encrypted Media Extensions (EME) for PlayReady support, such as IE 11 on Windows 8.1 and up, and Microsoft Edge browser on Windows 10, PlayReady will be hello underlying DRM for EME.</span></span>

![Usando EME para PlayReady](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-playready1.png)

<span data-ttu-id="f1a36-488">área de player escuro Olá é devido fatos toohello proteção PlayReady impede que um façam a captura de tela de vídeo protegido.</span><span class="sxs-lookup"><span data-stu-id="f1a36-488">hello dark player area is due toohello fact that PlayReady protection prevents one from making screen capture of protected video.</span></span>

<span data-ttu-id="f1a36-489">Olá tela a seguir mostra plug-ins de player hello e suporte MSE/EME.</span><span class="sxs-lookup"><span data-stu-id="f1a36-489">hello following screen shows hello player plugins and MSE/EME support.</span></span>

![Usando EME para PlayReady](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-playready2.png)

<span data-ttu-id="f1a36-491">A EME no Microsoft Edge e no IE 11 no Windows 10 permite invocar o [PlayReady SL3000](https://www.microsoft.com/playready/features/EnhancedContentProtection.aspx/) em dispositivos com Windows 10 que o suportam.</span><span class="sxs-lookup"><span data-stu-id="f1a36-491">EME in Microsoft Edge and IE 11 on Windows 10 allows invoking of [PlayReady SL3000](https://www.microsoft.com/playready/features/EnhancedContentProtection.aspx/) on Windows 10 devices which support it.</span></span> <span data-ttu-id="f1a36-492">PlayReady SL3000 desbloqueia o fluxo de saudação do conteúdo premium avançado (4K, cabeçalho, etc.) e novos modelos de entrega de conteúdo (janela antecipado para aprimorar o conteúdo).</span><span class="sxs-lookup"><span data-stu-id="f1a36-492">PlayReady SL3000 unlocks hello flow of enhanced premium content (4K, HDR, etc.) and new content delivery models (early window for Enhanced Content).</span></span>

<span data-ttu-id="f1a36-493">Se concentrar em dispositivos do Windows hello: PlayReady é Olá somente DRM no hello HW disponível em dispositivos do Windows (PlayReady SL3000).</span><span class="sxs-lookup"><span data-stu-id="f1a36-493">Focus on hello Windows devices: PlayReady is hello only DRM in hello HW available on Windows devices (PlayReady SL3000).</span></span> <span data-ttu-id="f1a36-494">Um serviço de streaming pode usar o PlayReady por meio da EME ou de um aplicativo UWP e oferecer uma qualidade mais alta de vídeo usando o PlayReady SL3000 em vez de outro DRM.</span><span class="sxs-lookup"><span data-stu-id="f1a36-494">A streaming service can use PlayReady through EME or through a UWP application and offer a higher video quality using PlayReady SL3000 than another DRM.</span></span> <span data-ttu-id="f1a36-495">Normalmente, o conteúdo de 2K fluirá pelo Chrome ou Firefox e Olá de 4 K conteúdo por meio do Microsoft Edge/IE11 ou um aplicativo de UWP no mesmo dispositivo (dependendo da configuração de serviço e implementação).</span><span class="sxs-lookup"><span data-stu-id="f1a36-495">Typically, 2K content will flow through Chrome or Firefox, and 4K content through Microsoft Edge/IE11 or a UWP application on hello same device (depending on service settings and implementation).</span></span>

#### <a name="using-eme-for-widevine"></a><span data-ttu-id="f1a36-496">Usando EME para Widevine</span><span class="sxs-lookup"><span data-stu-id="f1a36-496">Using EME for Widevine</span></span>
<span data-ttu-id="f1a36-497">Em um navegador moderno com suporte no Android 4.4.4, EME/Widevine, como Chrome 41 + no Windows 10, Windows 8.1, Mac OSX Yosemite e Chrome Google Widevine é hello DRM atrás EME.</span><span class="sxs-lookup"><span data-stu-id="f1a36-497">On a modern browser with EME/Widevine support, such as Chrome 41+ on Windows 10, Windows 8.1, Mac OSX Yosemite, and Chrome on Android 4.4.4, Google Widevine is hello DRM behind EME.</span></span>

![Usando EME para Widevine](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-widevine1.png)

<span data-ttu-id="f1a36-499">Observe que o Widevine não impede a captura de tela de vídeo protegido.</span><span class="sxs-lookup"><span data-stu-id="f1a36-499">Notice that Widevine does not prevent one from making screen capture of protected video.</span></span>

![Usando EME para Widevine](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-widevine2.png)

### <a name="not-entitled-users"></a><span data-ttu-id="f1a36-501">Usuários não qualificados</span><span class="sxs-lookup"><span data-stu-id="f1a36-501">Not entitled users</span></span>
<span data-ttu-id="f1a36-502">Se um usuário não for um membro do grupo "Usuários intitulada", usuário Olá não será capaz de toopass "verificação de qualificação" e serviço de licença do DRM várias Olá recusará a licença solicitada do tooissue Olá conforme mostrado abaixo.</span><span class="sxs-lookup"><span data-stu-id="f1a36-502">If a user is not a member of "Entitled Users" group, hello user will not be able toopass “entitlement check” and hello multi-DRM license service will refuse tooissue hello requested license as shown below.</span></span> <span data-ttu-id="f1a36-503">Olá descrição detalhada é "adquirir licença falha", que é criado.</span><span class="sxs-lookup"><span data-stu-id="f1a36-503">hello detailed description is “License acquire failed”, which is as designed.</span></span>

![Usuários não qualificados](./media/media-services-cenc-with-multidrm-access-control/media-services-unentitledusers.png)

### <a name="running-custom-secure-token-service"></a><span data-ttu-id="f1a36-505">Executando Serviço de Token Seguro personalizado</span><span class="sxs-lookup"><span data-stu-id="f1a36-505">Running custom Secure Token Service</span></span>
<span data-ttu-id="f1a36-506">Para o cenário de saudação da execução personalizada Token STS (serviço seguro), token JWT Olá será emitido pelo STS personalizado hello usando chave simétrica ou assimétrica.</span><span class="sxs-lookup"><span data-stu-id="f1a36-506">For hello scenario of running custom Secure Token Service (STS), hello JWT token will be issued by hello custom STS using either symmetric or asymmetric key.</span></span>

<span data-ttu-id="f1a36-507">caso de saudação do uso de chave simétrica (usando o Chrome):</span><span class="sxs-lookup"><span data-stu-id="f1a36-507">hello case of using symmetric key (using Chrome):</span></span>

![Executando STS personalizado](./media/media-services-cenc-with-multidrm-access-control/media-services-running-sts1.png)

<span data-ttu-id="f1a36-509">Olá caso de uso de chave assimétrica via X509 do certificado (usando o navegador moderno da Microsoft).</span><span class="sxs-lookup"><span data-stu-id="f1a36-509">hello case of using asymmetric key via an X509 certificate (using Microsoft modern browser).</span></span>

![Executando STS personalizado](./media/media-services-cenc-with-multidrm-access-control/media-services-running-sts2.png)

<span data-ttu-id="f1a36-511">Em ambos Olá acima casos, a autenticação de usuário permanece Olá mesmo – por meio do AD do Azure.</span><span class="sxs-lookup"><span data-stu-id="f1a36-511">In both of hello above cases, user authentication stays hello same – through Azure AD.</span></span> <span data-ttu-id="f1a36-512">Olá única diferença é que os tokens JWT são emitidos pelo STS personalizado de saudação em vez do AD do Azure.</span><span class="sxs-lookup"><span data-stu-id="f1a36-512">hello only difference is that JWT tokens are issued by hello custom STS instead of Azure AD.</span></span> <span data-ttu-id="f1a36-513">É claro que, ao configurar a proteção de CENC dinâmica, restrição de saudação do serviço de entrega de licença especifica tipo de Olá de token JWT, chave simétrica ou assimétrica.</span><span class="sxs-lookup"><span data-stu-id="f1a36-513">Of course, when configuring dynamic CENC protection, hello restriction of license delivery service specifies hello type of JWT token, either symmetric or asymmetric key.</span></span>

## <a name="summary"></a><span data-ttu-id="f1a36-514">Resumo</span><span class="sxs-lookup"><span data-stu-id="f1a36-514">Summary</span></span>
<span data-ttu-id="f1a36-515">Neste documento, vimos CENC com vários DRM nativos e controle de acesso por meio de autenticação de token; seu design e sua implementação usando o Azure, os Serviços de Mídia do Azure e o Player de Mídia do Azure.</span><span class="sxs-lookup"><span data-stu-id="f1a36-515">In this document, we discussed CENC with multi-native-DRM and access control via token authentication: its design and its implementation using Azure, Azure Media Services and Azure Media Player.</span></span>

* <span data-ttu-id="f1a36-516">Um projeto de referência é apresentado, que contém todos os componentes necessários do hello em um subsistema DRM/CENC;</span><span class="sxs-lookup"><span data-stu-id="f1a36-516">A reference design is presented which contains all hello necessary components in a DRM/CENC subsystem;</span></span>
* <span data-ttu-id="f1a36-517">Uma implementação de referência no Azure, nos Serviços de Mídia do Azure e no Player de Mídia do Azure.</span><span class="sxs-lookup"><span data-stu-id="f1a36-517">A reference implementation on Azure, Azure Media Services and Azure Media Player.</span></span>
* <span data-ttu-id="f1a36-518">Alguns tópicos diretamente envolvidas na implementação e design de saudação também são discutidos.</span><span class="sxs-lookup"><span data-stu-id="f1a36-518">Some topics directly involved in hello design and implementation are also discussed.</span></span>

## <a name="media-services-learning-paths"></a><span data-ttu-id="f1a36-519">Roteiros de aprendizagem dos Serviços de Mídia</span><span class="sxs-lookup"><span data-stu-id="f1a36-519">Media Services learning paths</span></span>
[!INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

## <a name="provide-feedback"></a><span data-ttu-id="f1a36-520">Fornecer comentários</span><span class="sxs-lookup"><span data-stu-id="f1a36-520">Provide feedback</span></span>
[!INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]
 
