---
title: "aaaCopying blobs de uma conta de armazenamento em um ativo de serviços de mídia do Azure | Microsoft Docs"
description: "Este tópico mostra como toocopy existente de blob em um ativo de serviços de mídia. exemplo Hello usa extensões de SDK .NET do serviços de mídia do Azure."
services: media-services
documentationcenter: 
author: Juliako
manager: cfowler
editor: 
ms.assetid: 6a63823f-f3c9-424c-91b8-566f70bec346
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: ne
ms.topic: article
ms.date: 08/03/2017
ms.author: juliako
ms.openlocfilehash: 40660e5cbb3698fb2b0bdf414751e47d367794da
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="copying-existing-blobs-into-a-media-services-asset"></a><span data-ttu-id="0922e-104">Copiar blobs existentes para um ativo dos Serviços de Mídia</span><span class="sxs-lookup"><span data-stu-id="0922e-104">Copying existing blobs into a Media Services Asset</span></span>
<span data-ttu-id="0922e-105">Este tópico mostra como toocopy blobs de uma conta de armazenamento em um novo serviços de mídia do Azure (AMS) ativo usando [extensões do SDK do Azure Media Services .NET](https://github.com/Azure/azure-sdk-for-media-services-extensions/).</span><span class="sxs-lookup"><span data-stu-id="0922e-105">This topic shows how toocopy blobs from a storage account into a new Azure Media Services (AMS) asset using [Azure Media Services .NET SDK Extensions](https://github.com/Azure/azure-sdk-for-media-services-extensions/).</span></span>

<span data-ttu-id="0922e-106">métodos de extensão Olá funciona com:</span><span class="sxs-lookup"><span data-stu-id="0922e-106">hello extension methods works with:</span></span>

- <span data-ttu-id="0922e-107">Ativos regulares.</span><span class="sxs-lookup"><span data-stu-id="0922e-107">Regular assets.</span></span>
- <span data-ttu-id="0922e-108">Ativos de arquivamento dinâmico (formato FragBlob).</span><span class="sxs-lookup"><span data-stu-id="0922e-108">Live archive assets (FragBlob format).</span></span>
- <span data-ttu-id="0922e-109">Ativos de origem e de destino que pertencem a contas de serviços de mídia toodifferent (mesmo em data centers diferentes).</span><span class="sxs-lookup"><span data-stu-id="0922e-109">Source and destination assets belonging toodifferent Media Services accounts (even across different data centers).</span></span> <span data-ttu-id="0922e-110">No entanto, essa ação pode incorrer em encargos.</span><span class="sxs-lookup"><span data-stu-id="0922e-110">However, there may be charges incurred by doing so.</span></span> <span data-ttu-id="0922e-111">Para obter mais informações sobre preços, consulte o [Transferências de Dados](https://azure.microsoft.com/pricing/#header-11).</span><span class="sxs-lookup"><span data-stu-id="0922e-111">For more information about pricing, see [Data Transfers](https://azure.microsoft.com/pricing/#header-11).</span></span>

> [!NOTE]
> <span data-ttu-id="0922e-112">Não tente toochange conteúdo de saudação de contêineres de blob que foram gerados pelos serviços de mídia sem o uso de APIs de serviços de mídia.</span><span class="sxs-lookup"><span data-stu-id="0922e-112">You should not attempt toochange hello contents of blob containers that were generated by Media Services without using Media Service APIs.</span></span>
> 

<span data-ttu-id="0922e-113">tópico de saudação mostra dois exemplos de código:</span><span class="sxs-lookup"><span data-stu-id="0922e-113">hello topic shows two code samples:</span></span>

1. <span data-ttu-id="0922e-114">Copie blobs de um ativo em uma conta do AMS para um novo ativo em outra conta do AMS.</span><span class="sxs-lookup"><span data-stu-id="0922e-114">Copy blobs from an asset in one AMS account into a new asset in another AMS account.</span></span>
2. <span data-ttu-id="0922e-115">Copie blobs de alguma conta de armazenamento para um novo ativo em uma conta do AMS.</span><span class="sxs-lookup"><span data-stu-id="0922e-115">Copy blobs from some storage account into a new asset in an AMS account.</span></span>

## <a name="copy-blobs-between-two-ams-accounts"></a><span data-ttu-id="0922e-116">Copiar blobs entre duas contas do AMS</span><span class="sxs-lookup"><span data-stu-id="0922e-116">Copy blobs between two AMS accounts</span></span>  

### <a name="prerequisites"></a><span data-ttu-id="0922e-117">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="0922e-117">Prerequisites</span></span>

<span data-ttu-id="0922e-118">Duas contas dos Serviços de Mídia.</span><span class="sxs-lookup"><span data-stu-id="0922e-118">Two Media Services accounts.</span></span> <span data-ttu-id="0922e-119">Consulte o tópico Olá [como tooCreate uma conta do Media Services](media-services-portal-create-account.md).</span><span class="sxs-lookup"><span data-stu-id="0922e-119">See hello topic [How tooCreate a Media Services Account](media-services-portal-create-account.md).</span></span>

### <a name="download-sample"></a><span data-ttu-id="0922e-120">Baixar exemplo</span><span class="sxs-lookup"><span data-stu-id="0922e-120">Download sample</span></span>
<span data-ttu-id="0922e-121">Você pode seguir as etapas de saudação neste artigo ou você pode baixar um exemplo que contém código Olá descrito neste artigo do [aqui](https://azure.microsoft.com/documentation/samples/media-services-dotnet-copy-blob-into-asset/).</span><span class="sxs-lookup"><span data-stu-id="0922e-121">You can follow hello steps in this article or you can download a sample that contains hello code described in this article from [here](https://azure.microsoft.com/documentation/samples/media-services-dotnet-copy-blob-into-asset/).</span></span>

### <a name="set-up-your-project"></a><span data-ttu-id="0922e-122">Configurar o seu projeto</span><span class="sxs-lookup"><span data-stu-id="0922e-122">Set up your project</span></span>

1. <span data-ttu-id="0922e-123">Configure seu ambiente de desenvolvimento, conforme descrito em [Desenvolvimento de Serviços de Mídia com o .NET](media-services-dotnet-how-to-use.md).</span><span class="sxs-lookup"><span data-stu-id="0922e-123">Set up your development environment as described in [Media Services development with .NET](media-services-dotnet-how-to-use.md).</span></span> 
2. <span data-ttu-id="0922e-124">Adicione outras referências que são necessárias para este projeto: System.Configuration.</span><span class="sxs-lookup"><span data-stu-id="0922e-124">Add other references that are required for this project: System.Configuration.</span></span>
3. <span data-ttu-id="0922e-125">Adicionar Olá appSettings seção toohello. config arquivo e atualização Olá valores com base em suas contas de serviços de mídia, Olá conta de armazenamento de destino e Olá ID da fonte ativo.</span><span class="sxs-lookup"><span data-stu-id="0922e-125">Add hello appSettings section toohello .config file and update hello values based on your Media Services accounts, hello destination storage account and hello source asset ID.</span></span>  

```   
<appSettings>
    <add key="AMSSourceAADTenantDomain" value="AADTenantDomain"/>
    <add key="AMSSourceRESTAPIEndpoint" value="RESTAPIEndpoint"/>
    <add key="AMSDestAADTenantDomain" value="AADTenantDomain"/>
    <add key="AMSDestRESTAPIEndpoint" value="RESTAPIEndpoint"/>
    <add key="DestStorageAccountName" value="name"/>
    <add key="DestStorageAccountKey" value="key"/>
    <add key="SourceAssetID" value="nb:cid:UUID:assetID"/>
</appSettings>
```

### <a name="copy-blobs-from-an-asset-in-one-ams-account-into-an-asset-in-another-ams-account"></a><span data-ttu-id="0922e-126">Copiar blobs de um ativo em uma conta do AMS para um ativo em outra conta do AMS</span><span class="sxs-lookup"><span data-stu-id="0922e-126">Copy blobs from an asset in one AMS account into an asset in another AMS account</span></span>

<span data-ttu-id="0922e-127">Olá, código a seguir usa extensão **IAsset.Copy** método toocopy todos os arquivos no ativo de origem Olá no ativo de destino hello usando uma única extensão.</span><span class="sxs-lookup"><span data-stu-id="0922e-127">hello following code uses extension **IAsset.Copy** method toocopy all files in hello source asset into hello destination asset using a single extension.</span></span>

```
using System;
using Microsoft.WindowsAzure.MediaServices.Client;
using System.Linq;
using System.Configuration;
using Microsoft.WindowsAzure.Storage.Auth;

namespace CopyExistingBlobsIntoAsset
{
    class Program
    {
        static string _sourceAADTenantDomain = ConfigurationManager.AppSettings["AMSSourceAADTenantDomain"];
        static string _sourceRESTAPIEndpoint = ConfigurationManager.AppSettings["AMSSourceRESTAPIEndpoint"];
        static string _destAADTenantDomain = ConfigurationManager.AppSettings["AMSDestAADTenantDomain"];
        static string _destRESTAPIEndpoint = ConfigurationManager.AppSettings["AMSDestRESTAPIEndpoint"];
        static string _destStorageAccountName = ConfigurationManager.AppSettings["DestStorageAccountName"];
        static string _destStorageAccountKey = ConfigurationManager.AppSettings["DestStorageAccountKey"];
        static string _sourceAssetID = ConfigurationManager.AppSettings["SourceAssetID"];

        private static CloudMediaContext _sourceContext = null;
        private static CloudMediaContext _destContext = null;

        static void Main(string[] args)
        {
            var tokenCredentials1 = new AzureAdTokenCredentials(_sourceAADTenantDomain, AzureEnvironments.AzureCloudEnvironment);
            var tokenProvider1 = new AzureAdTokenProvider(tokenCredentials1);
            var tokenCredentials2 = new AzureAdTokenCredentials(_destAADTenantDomain, AzureEnvironments.AzureCloudEnvironment);
            var tokenProvider2 = new AzureAdTokenProvider(tokenCredentials2);

            // Create hello context for your source Media Services account.
            _sourceContext = new CloudMediaContext(new Uri(_sourceRESTAPIEndpoint), tokenProvider1);

            // Create hello context for your destination Media Services account.
            _destContext = new CloudMediaContext(new Uri(_destRESTAPIEndpoint), tokenProvider2);

            // Get hello credentials of hello default Storage account bound tooyour destination Media Services account.
            StorageCredentials destinationStorageCredentials =
                new StorageCredentials(_destStorageAccountName, _destStorageAccountKey);

            // Get a reference toohello source asset in hello source context.
            IAsset sourceAsset = _sourceContext.Assets.Where(a => a.Id == _sourceAssetID).First();

            // Create an empty destination asset in hello destination context.
            IAsset destinationAsset = _destContext.Assets.Create(sourceAsset.Name, AssetCreationOptions.None);

            // Copy hello files in hello source asset instance into hello destination asset instance.
            sourceAsset.Copy(destinationAsset, destinationStorageCredentials);

            Console.WriteLine("Done");
        }
    }
}
```

## <a name="copy-blobs-from-a-storage-account-into-an-ams-account"></a><span data-ttu-id="0922e-128">Copiar blobs de uma conta de armazenamento para uma conta do AMS</span><span class="sxs-lookup"><span data-stu-id="0922e-128">Copy blobs from a storage account into an AMS account</span></span> 

### <a name="prerequisites"></a><span data-ttu-id="0922e-129">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="0922e-129">Prerequisites</span></span>

- <span data-ttu-id="0922e-130">Uma conta de armazenamento do qual você deseja toocopy blobs.</span><span class="sxs-lookup"><span data-stu-id="0922e-130">One Storage account from which you want toocopy blobs.</span></span>
- <span data-ttu-id="0922e-131">Uma conta de AMS no qual você deseja toocopy blobs.</span><span class="sxs-lookup"><span data-stu-id="0922e-131">One AMS account into which you want toocopy blobs.</span></span>

### <a name="set-up-your-project"></a><span data-ttu-id="0922e-132">Configurar o seu projeto</span><span class="sxs-lookup"><span data-stu-id="0922e-132">Set up your project</span></span>

1. <span data-ttu-id="0922e-133">Configure seu ambiente de desenvolvimento, conforme descrito em [Desenvolvimento de Serviços de Mídia com o .NET](media-services-dotnet-how-to-use.md).</span><span class="sxs-lookup"><span data-stu-id="0922e-133">Set up your development environment as described in [Media Services development with .NET](media-services-dotnet-how-to-use.md).</span></span> 
2. <span data-ttu-id="0922e-134">Adicione outras referências que são necessárias para este projeto: System.Configuration.</span><span class="sxs-lookup"><span data-stu-id="0922e-134">Add other references that are required for this project: System.Configuration.</span></span>
3. <span data-ttu-id="0922e-135">Adicione Olá appSettings seção toohello. config arquivo e atualizar valores de saudação com base em seu armazenamento de origem e destino contas AMS.</span><span class="sxs-lookup"><span data-stu-id="0922e-135">Add hello appSettings section toohello .config file and update hello values based on your source storage and destination AMS accounts.</span></span>

```
<appSettings>
  <add key="SourceStorageAccountName" value="name" />
  <add key="SourceStorageAccountKey" value="key" />
  <add key="AMSAADTenantDomain" value="tenant"/>
  <add key="AMSESTAPIEndpoint" value="endpoint"/>
  <add key="AMSStorageAccountName" value="name" />
  <add key="AMSStorageAccountKey" value="key" />
</appSettings>
```

### <a name="copy-blobs-from-some-storage-account-into-a-new-asset-in-a-ams-account"></a><span data-ttu-id="0922e-136">Copiar blobs de alguma conta de armazenamento para um novo ativo na conta do AMS</span><span class="sxs-lookup"><span data-stu-id="0922e-136">Copy blobs from some storage account into a new asset in a AMS account</span></span>

<span data-ttu-id="0922e-137">Olá blobs de cópias de código a seguir de uma conta de armazenamento em um ativo de serviços de mídia.</span><span class="sxs-lookup"><span data-stu-id="0922e-137">hello following code copies blobs from a storage account into a Media Services asset.</span></span> 

>[!NOTE]
><span data-ttu-id="0922e-138">Há um limite de 1.000.000 políticas para diferentes políticas de AMS (por exemplo, para política de Localizador ou ContentKeyAuthorizationPolicy).</span><span class="sxs-lookup"><span data-stu-id="0922e-138">There is a limit of 1,000,000 policies for different AMS policies (for example, for Locator policy or ContentKeyAuthorizationPolicy).</span></span> <span data-ttu-id="0922e-139">Você deve usar Olá Olá a mesma ID de política se você estiver usando sempre mesmo dias acesso permissões, por exemplo, as políticas para localizadores são tooremain desejado no local por um longo período (políticas de carregamento não).</span><span class="sxs-lookup"><span data-stu-id="0922e-139">You should use hello same policy ID if you are always using hello same days / access permissions, for example, policies for locators that are intended tooremain in place for a long time (non-upload policies).</span></span> <span data-ttu-id="0922e-140">Para obter mais informações, consulte [este](media-services-dotnet-manage-entities.md#limit-access-policies) tópico.</span><span class="sxs-lookup"><span data-stu-id="0922e-140">For more information, see [this](media-services-dotnet-manage-entities.md#limit-access-policies) topic.</span></span>

```
using System;
using System.Configuration;
using System.Linq;
using Microsoft.WindowsAzure.MediaServices.Client;
using Microsoft.WindowsAzure.Storage.Auth;
using Microsoft.WindowsAzure.Storage;
using Microsoft.WindowsAzure.Storage.Blob;
    
namespace CopyExistingBlobsIntoAsset
{
    class Program
    {
        // Read values from hello App.config file.
        private static readonly string _AMSAADTenantDomain =
            ConfigurationManager.AppSettings["AMSAADTenantDomain"];
        private static readonly string _AMSRESTAPIEndpoint =
            ConfigurationManager.AppSettings["AMSESTAPIEndpoint"];
        private static readonly string _AMSStorageAccountName =
            ConfigurationManager.AppSettings["AMSStorageAccountName"];
        private static readonly string _AMSStorageAccountKey =
            ConfigurationManager.AppSettings["AMSStorageAccountKey"];
        private static readonly string _sourceStorageAccountName =
            ConfigurationManager.AppSettings["SourceStorageAccountName"];
        private static readonly string _sourceStorageAccountKey =
            ConfigurationManager.AppSettings["SourceStorageAccountKey"];

        // Field for service context.
        private static CloudMediaContext _context = null;
        private static CloudStorageAccount _sourceStorageAccount = null;
        private static CloudStorageAccount _destinationStorageAccount = null;

        static void Main(string[] args)
        {
            var tokenCredentials = new AzureAdTokenCredentials(_AMSAADTenantDomain, 
                AzureEnvironments.AzureCloudEnvironment);
            var tokenProvider = new AzureAdTokenProvider(tokenCredentials);

            // Create hello context for your source Media Services account.
            _context = new CloudMediaContext(new Uri(_AMSRESTAPIEndpoint), tokenProvider);
            
            _sourceStorageAccount =
                new CloudStorageAccount(new StorageCredentials(_sourceStorageAccountName,
                    _sourceStorageAccountKey), true);

            _destinationStorageAccount =
                new CloudStorageAccount(new StorageCredentials(_AMSStorageAccountName,
                    _AMSStorageAccountKey), true);

            CloudBlobClient sourceCloudBlobClient =
                _sourceStorageAccount.CreateCloudBlobClient();
            CloudBlobContainer sourceContainer =
                sourceCloudBlobClient.GetContainerReference("NameOfBlobContainerYouWantToCopy");

            CreateAssetFromExistingBlobs(sourceContainer);

            Console.WriteLine("Done");
        }

        static public IAsset CreateAssetFromExistingBlobs(CloudBlobContainer sourceBlobContainer)
        {
            CloudBlobClient destBlobStorage = _destinationStorageAccount.CreateCloudBlobClient();

            // Create a new asset. 
            IAsset asset = _context.Assets.Create("NewAsset_" + Guid.NewGuid(), AssetCreationOptions.None);

            IAccessPolicy writePolicy = _context.AccessPolicies.Create("writePolicy",
                TimeSpan.FromHours(24), AccessPermissions.Write);

            ILocator destinationLocator =
                _context.Locators.CreateLocator(LocatorType.Sas, asset, writePolicy);

            // Get hello asset container URI and Blob copy from mediaContainer tooassetContainer. 
            CloudBlobContainer destAssetContainer =
                destBlobStorage.GetContainerReference((new Uri(destinationLocator.Path)).Segments[1]);

            if (destAssetContainer.CreateIfNotExists())
            {
                destAssetContainer.SetPermissions(new BlobContainerPermissions
                {
                    PublicAccess = BlobContainerPublicAccessType.Blob
                });
            }

            var blobList = sourceBlobContainer.ListBlobs();

            foreach (var sourceBlob in blobList)
            {
                var assetFile = asset.AssetFiles.Create((sourceBlob as ICloudBlob).Name);

                ICloudBlob destinationBlob = destAssetContainer.GetBlockBlobReference(assetFile.Name);

                CopyBlob(sourceBlob as ICloudBlob, destAssetContainer);

                assetFile.ContentFileSize = (sourceBlob as ICloudBlob).Properties.Length;
                assetFile.Update();
                Console.WriteLine("File {0} is of {1} size", assetFile.Name, assetFile.ContentFileSize);
            }

            asset.Update();

            destinationLocator.Delete();
            writePolicy.Delete();

            // Set hello primary asset file.
            // If, for example, we copied a set of Smooth Streaming files, 
            // set hello .ism file toobe hello primary file. 
            // If we, for example, copied an .mp4, then hello mp4 would be hello primary file. 
            var ismAssetFile = asset.AssetFiles.ToList().
                Where(f => f.Name.EndsWith(".ism", StringComparison.OrdinalIgnoreCase)).ToArray().FirstOrDefault();

            // hello following code assigns hello first .ism file as hello primary file in hello asset.
            // An asset should have one .ism file.  
            if (ismAssetFile != null)
            {
                ismAssetFile.IsPrimary = true;
                ismAssetFile.Update();
            }

            return asset;
        }

        /// <summary>
        /// Copies hello specified blob into hello specified container.
        /// </summary>
        /// <param name="sourceBlob">hello source container.</param>
        /// <param name="destinationContainer">hello destination container.</param>
        static private void CopyBlob(ICloudBlob sourceBlob, CloudBlobContainer destinationContainer)
        {
            var signature = sourceBlob.GetSharedAccessSignature(new SharedAccessBlobPolicy
            {
                Permissions = SharedAccessBlobPermissions.Read,
                SharedAccessExpiryTime = DateTime.UtcNow.AddHours(24)
            });

            ICloudBlob destinationBlob = destinationContainer.GetBlockBlobReference(sourceBlob.Name);

            if (destinationBlob.Exists())
            {
                Console.WriteLine(string.Format("Destination blob '{0}' already exists. Skipping.", destinationBlob.Uri));
            }
            else
            {

                // Display hello size of hello source blob.
                Console.WriteLine(sourceBlob.Properties.Length);

                Console.WriteLine(string.Format("Copy blob '{0}' too'{1}'", sourceBlob.Uri, destinationBlob.Uri));
                destinationBlob.StartCopyFromBlob(new Uri(sourceBlob.Uri.AbsoluteUri + signature));

                while (true)
                {
                    // hello StartCopyFromBlob is an async operation, 
                    // so we want toocheck if hello copy operation is completed before proceeding. 
                    // toodo that, we call FetchAttributes on hello blob and check hello CopyStatus. 
                    destinationBlob.FetchAttributes();
                    if (destinationBlob.CopyState.Status != CopyStatus.Pending)
                    {
                        break;
                    }
                    //It's still not completed. So wait for some time.
                    System.Threading.Thread.Sleep(1000);
                }

                // Display hello size of hello destination blob.
                Console.WriteLine(destinationBlob.Properties.Length);

            }
        }
    }
}
```
## <a name="next-steps"></a><span data-ttu-id="0922e-141">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="0922e-141">Next steps</span></span>

<span data-ttu-id="0922e-142">Agora você pode codificar seus ativos carregados.</span><span class="sxs-lookup"><span data-stu-id="0922e-142">You can now encode your uploaded assets.</span></span> <span data-ttu-id="0922e-143">Para saber mais, veja [Codificar ativos](media-services-portal-encode.md).</span><span class="sxs-lookup"><span data-stu-id="0922e-143">For more information, see [Encode assets](media-services-portal-encode.md).</span></span>

<span data-ttu-id="0922e-144">Você também pode usar as funções do Azure tootrigger um trabalho de codificação com base em um arquivo que chegam no contêiner de saudação configurada.</span><span class="sxs-lookup"><span data-stu-id="0922e-144">You can also use Azure Functions tootrigger an encoding job based on a file arriving in hello configured container.</span></span> <span data-ttu-id="0922e-145">Para obter mais informações, confira [este exemplo](https://azure.microsoft.com/resources/samples/media-services-dotnet-functions-integration/ ).</span><span class="sxs-lookup"><span data-stu-id="0922e-145">For more information, see [this sample](https://azure.microsoft.com/resources/samples/media-services-dotnet-functions-integration/ ).</span></span>

## <a name="media-services-learning-paths"></a><span data-ttu-id="0922e-146">Roteiros de aprendizagem dos Serviços de Mídia</span><span class="sxs-lookup"><span data-stu-id="0922e-146">Media Services learning paths</span></span>
[!INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

## <a name="provide-feedback"></a><span data-ttu-id="0922e-147">Fornecer comentários</span><span class="sxs-lookup"><span data-stu-id="0922e-147">Provide feedback</span></span>
[!INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]

