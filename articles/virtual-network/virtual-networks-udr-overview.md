---
title: rotas definidas aaaUser e encaminhamento de IP no Azure | Microsoft Docs
description: "Saiba como rotas definidas pelo usuário do tooconfigure (UDR) e o encaminhamento IP tooforward tráfego toonetwork de dispositivos virtuais no Azure."
services: virtual-network
documentationcenter: na
author: jimdial
manager: timlt
editor: tysonn
ms.assetid: c39076c4-11b7-4b46-a904-817503c4b486
ms.service: virtual-network
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/15/2016
ms.author: jdial
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: f1f1d46166d5a7c776f472b7ade1354d943ece10
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="user-defined-routes-and-ip-forwarding"></a><span data-ttu-id="b57e0-103">Encaminhamento IP e rotas definidas pelo usuário</span><span class="sxs-lookup"><span data-stu-id="b57e0-103">User-defined routes and IP forwarding</span></span>

<span data-ttu-id="b57e0-104">Quando você adiciona máquinas virtuais (VMs) tooa VPN (rede virtual) no Azure, você observará que Olá VMs são capaz de toocommunicate entre si pela rede hello, automaticamente.</span><span class="sxs-lookup"><span data-stu-id="b57e0-104">When you add virtual machines (VMs) tooa virtual network (VNet) in Azure, you will notice that hello VMs are able toocommunicate with each other over hello network, automatically.</span></span> <span data-ttu-id="b57e0-105">Não é necessário toospecify um gateway, embora Olá VMs estiverem em sub-redes diferentes.</span><span class="sxs-lookup"><span data-stu-id="b57e0-105">You do not need toospecify a gateway, even though hello VMs are in different subnets.</span></span> <span data-ttu-id="b57e0-106">Olá mesmo é verdadeiro para comunicação de saudação VMs toohello Internet pública e rede de local tooyour mesmo quando uma conexão híbrida do Azure tooyour possui datacenter estiver presente.</span><span class="sxs-lookup"><span data-stu-id="b57e0-106">hello same is true for communication from hello VMs toohello public Internet, and even tooyour on-premises network when a hybrid connection from Azure tooyour own datacenter is present.</span></span>

<span data-ttu-id="b57e0-107">Este fluxo de comunicação é possível porque o Azure usa uma série de sistema rotas toodefine como fluxos de tráfego IP.</span><span class="sxs-lookup"><span data-stu-id="b57e0-107">This flow of communication is possible because Azure uses a series of system routes toodefine how IP traffic flows.</span></span> <span data-ttu-id="b57e0-108">Rotas de sistema controlam o fluxo de saudação de comunicação no hello os seguintes cenários:</span><span class="sxs-lookup"><span data-stu-id="b57e0-108">System routes control hello flow of communication in hello following scenarios:</span></span>

* <span data-ttu-id="b57e0-109">No hello na mesma sub-rede.</span><span class="sxs-lookup"><span data-stu-id="b57e0-109">From within hello same subnet.</span></span>
* <span data-ttu-id="b57e0-110">De tooanother uma sub-rede dentro de uma rede virtual.</span><span class="sxs-lookup"><span data-stu-id="b57e0-110">From a subnet tooanother within a VNet.</span></span>
* <span data-ttu-id="b57e0-111">De VMs toohello da Internet.</span><span class="sxs-lookup"><span data-stu-id="b57e0-111">From VMs toohello Internet.</span></span>
* <span data-ttu-id="b57e0-112">De uma rede virtual tooanother redes por meio de um gateway de VPN.</span><span class="sxs-lookup"><span data-stu-id="b57e0-112">From a VNet tooanother VNet through a VPN gateway.</span></span>
* <span data-ttu-id="b57e0-113">De uma rede virtual tooanother VNet a VNet emparelhamento (encadeamento de serviço).</span><span class="sxs-lookup"><span data-stu-id="b57e0-113">From a VNet tooanother VNet through VNet Peering (Service Chaining).</span></span>
* <span data-ttu-id="b57e0-114">De uma rede tooyour no local de rede virtual por meio de um gateway de VPN.</span><span class="sxs-lookup"><span data-stu-id="b57e0-114">From a VNet tooyour on-premises network through a VPN gateway.</span></span>

<span data-ttu-id="b57e0-115">Olá figura a seguir mostra uma configuração simples com uma rede virtual, duas sub-redes e algumas VMs, juntamente com hello rotas de sistema que permitem tooflow de tráfego IP.</span><span class="sxs-lookup"><span data-stu-id="b57e0-115">hello figure below shows a simple setup with a VNet, two subnets, and a few VMs, along with hello system routes that allow IP traffic tooflow.</span></span>

![Rotas de sistema no Azure](./media/virtual-networks-udr-overview/Figure1.png)

<span data-ttu-id="b57e0-117">Embora o uso de saudação de rotas do sistema facilita tráfego automaticamente para sua implantação, há casos em que você quer toocontrol Olá roteamento de pacotes por meio de um dispositivo virtual.</span><span class="sxs-lookup"><span data-stu-id="b57e0-117">Although hello use of system routes facilitates traffic automatically for your deployment, there are cases in which you want toocontrol hello routing of packets through a virtual appliance.</span></span> <span data-ttu-id="b57e0-118">Você pode então crie rotas definidas pelo usuário que especificar próximo salto Olá para pacotes que fluem de dispositivo virtual do tooa sub-rede específica toogo tooyour em vez disso, e habilitando IP encaminhamento para Olá VM em execução como dispositivo virtual hello.</span><span class="sxs-lookup"><span data-stu-id="b57e0-118">You can do so by creating user defined routes that specify hello next hop for packets flowing tooa specific subnet toogo tooyour virtual appliance instead, and enabling IP forwarding for hello VM running as hello virtual appliance.</span></span>

<span data-ttu-id="b57e0-119">Olá figura abaixo mostra um exemplo de rotas definidas pelo usuário e encaminhamento tooforce pacotes IP enviada tooone sub-rede do outro toogo por meio de um dispositivo virtual em uma sub-rede de terceiro.</span><span class="sxs-lookup"><span data-stu-id="b57e0-119">hello figure below shows an example of user defined routes and IP forwarding tooforce packets sent tooone subnet from another toogo through a virtual appliance on a third subnet.</span></span>

![Rotas de sistema no Azure](./media/virtual-networks-udr-overview/Figure2.png)

> [!IMPORTANT]
> <span data-ttu-id="b57e0-121">Rotas definidas pelo usuário são aplicada tootraffic deixando uma sub-rede de qualquer recurso (como interfaces de rede conectados tooVMs) na sub-rede hello.</span><span class="sxs-lookup"><span data-stu-id="b57e0-121">User-defined routes are applied tootraffic leaving a subnet from any resource (such as network interfaces attached tooVMs) in hello subnet.</span></span> <span data-ttu-id="b57e0-122">Não é possível criar rotas toospecify como tráfego entra em uma sub-rede de saudação da Internet, por exemplo.</span><span class="sxs-lookup"><span data-stu-id="b57e0-122">You cannot create routes toospecify how traffic enters a subnet from hello Internet, for instance.</span></span> <span data-ttu-id="b57e0-123">dispositivo Olá estiverem encaminhando tráfego toocannot estar no hello mesma sub-rede em que o tráfego de saudação se origina.</span><span class="sxs-lookup"><span data-stu-id="b57e0-123">hello appliance you are forwarding traffic toocannot be in hello same subnet where hello traffic originates.</span></span> <span data-ttu-id="b57e0-124">Sempre crie uma sub-rede separada para seus dispositivos.</span><span class="sxs-lookup"><span data-stu-id="b57e0-124">Always create a separate subnet for your appliances.</span></span> 
> 
> 

## <a name="route-resource"></a><span data-ttu-id="b57e0-125">Recurso de rota</span><span class="sxs-lookup"><span data-stu-id="b57e0-125">Route resource</span></span>
<span data-ttu-id="b57e0-126">Os pacotes são roteados por uma rede TCP/IP com base em uma tabela de rotas definida em cada nó na rede física hello.</span><span class="sxs-lookup"><span data-stu-id="b57e0-126">Packets are routed over a TCP/IP network based on a route table defined at each node on hello physical network.</span></span> <span data-ttu-id="b57e0-127">Uma tabela de rotas é que uma coleção de rotas individuais usadas toodecide onde tooforward pacotes com base no destino Olá endereço IP.</span><span class="sxs-lookup"><span data-stu-id="b57e0-127">A route table is a collection of individual routes used toodecide where tooforward packets based on hello destination IP address.</span></span> <span data-ttu-id="b57e0-128">Uma rota consiste nas seguintes hello:</span><span class="sxs-lookup"><span data-stu-id="b57e0-128">A route consists of hello following:</span></span>

| <span data-ttu-id="b57e0-129">Propriedade</span><span class="sxs-lookup"><span data-stu-id="b57e0-129">Property</span></span> | <span data-ttu-id="b57e0-130">Descrição</span><span class="sxs-lookup"><span data-stu-id="b57e0-130">Description</span></span> | <span data-ttu-id="b57e0-131">Restrições</span><span class="sxs-lookup"><span data-stu-id="b57e0-131">Constraints</span></span> | <span data-ttu-id="b57e0-132">Considerações</span><span class="sxs-lookup"><span data-stu-id="b57e0-132">Considerations</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="b57e0-133">Prefixo de Endereço</span><span class="sxs-lookup"><span data-stu-id="b57e0-133">Address Prefix</span></span> |<span data-ttu-id="b57e0-134">Olá destino CIDR toowhich Olá rota se aplica, como 10.1.0.0/16.</span><span class="sxs-lookup"><span data-stu-id="b57e0-134">hello destination CIDR toowhich hello route applies, such as 10.1.0.0/16.</span></span> |<span data-ttu-id="b57e0-135">Deve ser um intervalo CIDR válido que representa os endereços Olá Internet pública, a rede virtual do Azure ou o datacenter local.</span><span class="sxs-lookup"><span data-stu-id="b57e0-135">Must be a valid CIDR range representing addresses on hello public Internet, Azure virtual network, or on-premises datacenter.</span></span> |<span data-ttu-id="b57e0-136">Verifique se Olá **prefixo de endereço** não tem endereço Olá Olá **próximo salto**, caso contrário, seus pacotes entrará em um loop indo de próximo salto do hello fonte toohello sem atinja destino de saudação.</span><span class="sxs-lookup"><span data-stu-id="b57e0-136">Make sure hello **Address prefix** does not contain hello address for hello **Next hop address**, otherwise your packets will enter in a loop going from hello source toohello next hop without ever reaching hello destination.</span></span> |
| <span data-ttu-id="b57e0-137">Tipo do próximo salto</span><span class="sxs-lookup"><span data-stu-id="b57e0-137">Next hop type</span></span> |<span data-ttu-id="b57e0-138">tipo de saudação do pacote de saudação do nó do Azure deve ser enviado para.</span><span class="sxs-lookup"><span data-stu-id="b57e0-138">hello type of Azure hop hello packet should be sent to.</span></span> |<span data-ttu-id="b57e0-139">Deve ser um Olá valores a seguir:</span><span class="sxs-lookup"><span data-stu-id="b57e0-139">Must be one of hello following values:</span></span> <br/> <span data-ttu-id="b57e0-140">**Rede Virtual**.</span><span class="sxs-lookup"><span data-stu-id="b57e0-140">**Virtual Network**.</span></span> <span data-ttu-id="b57e0-141">Representa a rede virtual local de saudação.</span><span class="sxs-lookup"><span data-stu-id="b57e0-141">Represents hello local virtual network.</span></span> <span data-ttu-id="b57e0-142">Por exemplo, se você tiver duas sub-redes, 10.1.0.0/16 e 10.2.0.0/16 na mesma rede virtual de hello, rota Olá para cada sub-rede na tabela de rotas Olá terá um valor próximo salto *rede Virtual*.</span><span class="sxs-lookup"><span data-stu-id="b57e0-142">For instance, if you have two subnets, 10.1.0.0/16 and 10.2.0.0/16 in hello same virtual network, hello route for each subnet in hello route table will have a next hop value of *Virtual Network*.</span></span> <br/> <span data-ttu-id="b57e0-143">**Gateway de Rede Virtual**.</span><span class="sxs-lookup"><span data-stu-id="b57e0-143">**Virtual Network Gateway**.</span></span> <span data-ttu-id="b57e0-144">Representa um Gateway de VPN S2S do Azure.</span><span class="sxs-lookup"><span data-stu-id="b57e0-144">Represents an Azure S2S VPN Gateway.</span></span> <br/> <span data-ttu-id="b57e0-145">**Internet**.</span><span class="sxs-lookup"><span data-stu-id="b57e0-145">**Internet**.</span></span> <span data-ttu-id="b57e0-146">Representa o gateway de Internet padrão Olá fornecido pelo Olá infraestrutura do Azure.</span><span class="sxs-lookup"><span data-stu-id="b57e0-146">Represents hello default Internet gateway provided by hello Azure Infrastructure.</span></span> <br/> <span data-ttu-id="b57e0-147">**Dispositivo Virtual**.</span><span class="sxs-lookup"><span data-stu-id="b57e0-147">**Virtual Appliance**.</span></span> <span data-ttu-id="b57e0-148">Representa um dispositivo virtual que você adicionou tooyour rede virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="b57e0-148">Represents a virtual appliance you added tooyour Azure virtual network.</span></span> <br/> <span data-ttu-id="b57e0-149">**Nenhum**.</span><span class="sxs-lookup"><span data-stu-id="b57e0-149">**None**.</span></span> <span data-ttu-id="b57e0-150">Representa um buraco negro.</span><span class="sxs-lookup"><span data-stu-id="b57e0-150">Represents a black hole.</span></span> <span data-ttu-id="b57e0-151">Pacotes encaminhados de buraco negro tooa não serão encaminhados em todos os.</span><span class="sxs-lookup"><span data-stu-id="b57e0-151">Packets forwarded tooa black hole will not be forwarded at all.</span></span> |<span data-ttu-id="b57e0-152">Considere o uso de **dispositivo Virtual** toodirect tooa VM ou o balanceador de carga do Azure endereço IP interno de tráfego.</span><span class="sxs-lookup"><span data-stu-id="b57e0-152">Consider using **Virtual Appliance** toodirect traffic tooa VM or Azure Load Balancer internal IP address.</span></span>  <span data-ttu-id="b57e0-153">Esse tipo permite a especificação de saudação de um endereço IP, conforme descrito abaixo.</span><span class="sxs-lookup"><span data-stu-id="b57e0-153">This type allows hello specification of an IP address as described below.</span></span> <span data-ttu-id="b57e0-154">Considere o uso de um **nenhum** digite pacotes toostop tooa fluxo fornecido de destino.</span><span class="sxs-lookup"><span data-stu-id="b57e0-154">Consider using a **None** type toostop packets from flowing tooa given destination.</span></span> |
| <span data-ttu-id="b57e0-155">Endereço do próximo salto</span><span class="sxs-lookup"><span data-stu-id="b57e0-155">Next hop address</span></span> |<span data-ttu-id="b57e0-156">próximo endereço de salto Olá contém o endereço IP de saudação pacotes devem ser encaminhados.</span><span class="sxs-lookup"><span data-stu-id="b57e0-156">hello next hop address contains hello IP address packets should be forwarded to.</span></span> <span data-ttu-id="b57e0-157">Valores do próximo salto somente são permitidos em rotas onde é o tipo de próximo salto Olá *dispositivo Virtual*.</span><span class="sxs-lookup"><span data-stu-id="b57e0-157">Next hop values are only allowed in routes where hello next hop type is *Virtual Appliance*.</span></span> |<span data-ttu-id="b57e0-158">Deve ser um endereço IP que é acessível em Olá rede Virtual onde Olá rota definida pelo usuário é aplicada, sem passar por um **Gateway de rede Virtual**.</span><span class="sxs-lookup"><span data-stu-id="b57e0-158">Must be an IP address that is reachable within hello Virtual Network where hello User Defined Route is applied, without going through a **Virtual Network Gateway**.</span></span> <span data-ttu-id="b57e0-159">endereço IP Hello tem toobe Olá mesmo Virtual de rede quando ela é aplicada, ou em uma rede Virtual peered.</span><span class="sxs-lookup"><span data-stu-id="b57e0-159">hello IP address has toobe on hello same Virtual Network where it is applied, or on a peered Virtual Network.</span></span> |<span data-ttu-id="b57e0-160">Se o endereço IP hello representa uma máquina virtual, certifique-se de habilitar [encaminhamento IP](#IP-forwarding) no Azure para Olá VM.</span><span class="sxs-lookup"><span data-stu-id="b57e0-160">If hello IP address represents a VM, make sure you enable [IP forwarding](#IP-forwarding) in Azure for hello VM.</span></span> <span data-ttu-id="b57e0-161">Se hello IP endereço representa Olá endereço IP interno do balanceador de carga do Azure, verifique se você tem uma regra para cada porta de balanceamento de carga correspondente você deseja balancear tooload.</span><span class="sxs-lookup"><span data-stu-id="b57e0-161">If hello IP address represents hello internal IP address of Azure Load Balancer, make sure you have a matching load balancing rule for each port you wish tooload balance.</span></span>|

<span data-ttu-id="b57e0-162">No Azure PowerShell alguns dos valores de "NextHopType" hello têm nomes diferentes:</span><span class="sxs-lookup"><span data-stu-id="b57e0-162">In Azure PowerShell some of hello "NextHopType" values have different names:</span></span>

* <span data-ttu-id="b57e0-163">A Rede Virtual é VnetLocal</span><span class="sxs-lookup"><span data-stu-id="b57e0-163">Virtual Network is VnetLocal</span></span>
* <span data-ttu-id="b57e0-164">O Gateway de Rede Virtual é VirtualNetworkGateway</span><span class="sxs-lookup"><span data-stu-id="b57e0-164">Virtual Network Gateway is VirtualNetworkGateway</span></span>
* <span data-ttu-id="b57e0-165">O Dispositivo Virtual é VirtualAppliance</span><span class="sxs-lookup"><span data-stu-id="b57e0-165">Virtual Appliance is VirtualAppliance</span></span>
* <span data-ttu-id="b57e0-166">A Internet é Internet</span><span class="sxs-lookup"><span data-stu-id="b57e0-166">Internet is Internet</span></span>
* <span data-ttu-id="b57e0-167">Nenhum é None</span><span class="sxs-lookup"><span data-stu-id="b57e0-167">None is None</span></span>

### <a name="system-routes"></a><span data-ttu-id="b57e0-168">Rotas do sistema</span><span class="sxs-lookup"><span data-stu-id="b57e0-168">System routes</span></span>
<span data-ttu-id="b57e0-169">Cada sub-rede criada em uma rede virtual é associado automaticamente uma tabela de rota que contém Olá regras de rota do sistema a seguir:</span><span class="sxs-lookup"><span data-stu-id="b57e0-169">Every subnet created in a virtual network is automatically associated with a route table that contains hello following system route rules:</span></span>

* <span data-ttu-id="b57e0-170">**Regra de VNet local**: essa regra é criada automaticamente para todas as sub-redes em uma rede virtual.</span><span class="sxs-lookup"><span data-stu-id="b57e0-170">**Local Vnet Rule**: This rule is automatically created for every subnet in a virtual network.</span></span> <span data-ttu-id="b57e0-171">Especifica que há um link direto entre VMs Olá no hello rede virtual e não não próximo salto intermediário.</span><span class="sxs-lookup"><span data-stu-id="b57e0-171">It specifies that there is a direct link between hello VMs in hello VNet and there is no intermediate next hop.</span></span>
* <span data-ttu-id="b57e0-172">**Regra local**: esta regra aplica-se o intervalo de endereços do tooall o tráfego destinado toohello local e usa o gateway VPN como destino do hello próximo salto.</span><span class="sxs-lookup"><span data-stu-id="b57e0-172">**On-premises Rule**: This rule applies tooall traffic destined toohello on-premises address range and uses VPN gateway as hello next hop destination.</span></span>
* <span data-ttu-id="b57e0-173">**Regra de Internet**: essa regra trata todos os toohello de tráfego destinado Internet pública (prefixo de endereço 0.0.0.0/0) e o gateway de internet de infraestrutura usa hello como saudação do próximo salto para todo o tráfego destinado toohello da Internet.</span><span class="sxs-lookup"><span data-stu-id="b57e0-173">**Internet Rule**: This rule handles all traffic destined toohello public Internet (address prefix 0.0.0.0/0) and uses hello infrastructure internet gateway as hello next hop for all traffic destined toohello Internet.</span></span>

### <a name="user-defined-routes"></a><span data-ttu-id="b57e0-174">Rotas definidas pelo usuário</span><span class="sxs-lookup"><span data-stu-id="b57e0-174">User-defined routes</span></span>
<span data-ttu-id="b57e0-175">Para a maioria dos ambientes, precisará apenas rotas de sistema Olá já definidas pelo Azure.</span><span class="sxs-lookup"><span data-stu-id="b57e0-175">For most environments you will only need hello system routes already defined by Azure.</span></span> <span data-ttu-id="b57e0-176">No entanto, você pode precisar toocreate uma tabela de rota e adicione uma ou mais rotas em casos específicos, como:</span><span class="sxs-lookup"><span data-stu-id="b57e0-176">However, you may need toocreate a route table and add one or more routes in specific cases, such as:</span></span>

* <span data-ttu-id="b57e0-177">Força toohello encapsulamento da Internet por meio de sua rede local.</span><span class="sxs-lookup"><span data-stu-id="b57e0-177">Force tunneling toohello Internet via your on-premises network.</span></span>
* <span data-ttu-id="b57e0-178">Uso de dispositivos virtuais em seu ambiente do Azure.</span><span class="sxs-lookup"><span data-stu-id="b57e0-178">Use of virtual appliances in your Azure environment.</span></span>

<span data-ttu-id="b57e0-179">Em cenários de saudação acima, será necessário toocreate uma tabela de rota e adicionar tooit de rotas definidas pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="b57e0-179">In hello scenarios above, you will have toocreate a route table and add user defined routes tooit.</span></span> <span data-ttu-id="b57e0-180">Você pode ter várias tabelas de rota e hello mesma tabela de rota pode ser associado tooone ou mais sub-redes.</span><span class="sxs-lookup"><span data-stu-id="b57e0-180">You can have multiple route tables, and hello same route table can be associated tooone or more subnets.</span></span> <span data-ttu-id="b57e0-181">E cada sub-rede só pode ser a tabela de rota único tooa associado.</span><span class="sxs-lookup"><span data-stu-id="b57e0-181">And each subnet can only be associated tooa single route table.</span></span> <span data-ttu-id="b57e0-182">Todas as VMs e serviços de nuvem em uma sub-rede usam Olá rota tabela associada toothat sub-rede.</span><span class="sxs-lookup"><span data-stu-id="b57e0-182">All VMs and cloud services in a subnet use hello route table associated toothat subnet.</span></span>

<span data-ttu-id="b57e0-183">Sub-redes dependem de rotas do sistema até que uma tabela de rotas é sub-rede toohello associado.</span><span class="sxs-lookup"><span data-stu-id="b57e0-183">Subnets rely on system routes until a route table is associated toohello subnet.</span></span> <span data-ttu-id="b57e0-184">Quando existe uma associação, o roteamento é feito com base em LPM (Correspondência de Prefixo mais Longo) entre as rotas definidas pelo usuário e as rotas de sistema.</span><span class="sxs-lookup"><span data-stu-id="b57e0-184">Once an association exists, routing is done based on Longest Prefix Match (LPM) among both user defined routes and system routes.</span></span> <span data-ttu-id="b57e0-185">Se houver mais de uma rota com hello LPM mesmo corresponde então uma rota é selecionada com base em sua origem no hello ordem a seguir:</span><span class="sxs-lookup"><span data-stu-id="b57e0-185">If there is more than one route with hello same LPM match then a route is selected based on its origin in hello following order:</span></span>

1. <span data-ttu-id="b57e0-186">Rota definida pelo usuário</span><span class="sxs-lookup"><span data-stu-id="b57e0-186">User defined route</span></span>
2. <span data-ttu-id="b57e0-187">Rota BGP (quando o ExpressRoute é usado)</span><span class="sxs-lookup"><span data-stu-id="b57e0-187">BGP route (when ExpressRoute is used)</span></span>
3. <span data-ttu-id="b57e0-188">Rota de sistema</span><span class="sxs-lookup"><span data-stu-id="b57e0-188">System route</span></span>

<span data-ttu-id="b57e0-189">toolearn como usuário toocreate definidos rotas, consulte [como tooCreate rotas e habilitar o encaminhamento de IP no Azure](virtual-network-create-udr-arm-template.md).</span><span class="sxs-lookup"><span data-stu-id="b57e0-189">toolearn how toocreate user defined routes, see [How tooCreate Routes and Enable IP Forwarding in Azure](virtual-network-create-udr-arm-template.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="b57e0-190">Rotas definidas pelo usuário são apenas aplicado tooAzure VMs e serviços em nuvem.</span><span class="sxs-lookup"><span data-stu-id="b57e0-190">User defined routes are only applied tooAzure VMs and cloud services.</span></span> <span data-ttu-id="b57e0-191">Por exemplo, se você quiser tooadd um dispositivo virtual firewall entre sua rede local e o Azure, você terá toocreate uma rota definida pelo usuário para as tabelas de rota do Azure que encaminha todo o tráfego direcionado toohello de espaço de endereço de local toohello virtual dispositivo.</span><span class="sxs-lookup"><span data-stu-id="b57e0-191">For instance, if you want tooadd a firewall virtual appliance between your on-premises network and Azure, you will have toocreate a user defined route for your Azure route tables that forwards all traffic going toohello on-premises address space toohello virtual appliance.</span></span> <span data-ttu-id="b57e0-192">Você também pode adicionar que um usuário definido rota (UDR) toohello GatewaySubnet tooforward todo o tráfego de tooAzure local por meio do dispositivo virtual hello.</span><span class="sxs-lookup"><span data-stu-id="b57e0-192">You can also add a user defined route (UDR) toohello GatewaySubnet tooforward all traffic from on-premises tooAzure through hello virtual appliance.</span></span> <span data-ttu-id="b57e0-193">Isso é uma adição recente.</span><span class="sxs-lookup"><span data-stu-id="b57e0-193">This is a recent addition.</span></span>
> 
> 

### <a name="bgp-routes"></a><span data-ttu-id="b57e0-194">Rotas BGP</span><span class="sxs-lookup"><span data-stu-id="b57e0-194">BGP routes</span></span>
<span data-ttu-id="b57e0-195">Se você tiver uma conexão de rota expressa entre sua rede local e o Azure, você pode habilitar as rotas BGP toopropagate na sua tooAzure de rede local.</span><span class="sxs-lookup"><span data-stu-id="b57e0-195">If you have an ExpressRoute connection between your on-premises network and Azure, you can enable BGP toopropagate routes from your on-premises network tooAzure.</span></span> <span data-ttu-id="b57e0-196">Essas rotas BGP são usadas em Olá mesma forma que as rotas de sistema e usuário definidas rotas em cada sub-rede do Azure.</span><span class="sxs-lookup"><span data-stu-id="b57e0-196">These BGP routes are used in hello same way as system routes and user defined routes in each Azure subnet.</span></span> <span data-ttu-id="b57e0-197">Para obter mais informações, consulte [Introdução ao ExpressRoute](../expressroute/expressroute-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="b57e0-197">For more information see [ExpressRoute Introduction](../expressroute/expressroute-introduction.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="b57e0-198">Você pode configurar sua força de toouse do ambiente do Azure túnel por meio de sua rede local, criando uma rota definida pelo usuário para a sub-rede 0.0.0.0/0 que utiliza o gateway VPN hello como Olá próximo nó.</span><span class="sxs-lookup"><span data-stu-id="b57e0-198">You can configure your Azure environment toouse force tunneling through your on-premises network by creating a user defined route for subnet 0.0.0.0/0 that uses hello VPN gateway as hello next hop.</span></span> <span data-ttu-id="b57e0-199">No entanto, isso só funcionará se você estiver usando um gateway de VPN, não o ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="b57e0-199">However, this only works if you are using a VPN gateway, not ExpressRoute.</span></span> <span data-ttu-id="b57e0-200">Para o ExpressRoute, o túnel à força é configurado por meio do BGP.</span><span class="sxs-lookup"><span data-stu-id="b57e0-200">For ExpressRoute, forced tunneling is configured through BGP.</span></span>
> 
> 

## <a name="ip-forwarding"></a><span data-ttu-id="b57e0-201">Encaminhamento IP</span><span class="sxs-lookup"><span data-stu-id="b57e0-201">IP forwarding</span></span>
<span data-ttu-id="b57e0-202">Conforme descrito acima, uma saudação motivos principais pelos quais toocreate uma rota definida pelo usuário é dispositivo virtual do tooa tooforward tráfego.</span><span class="sxs-lookup"><span data-stu-id="b57e0-202">As described above, one of hello main reasons toocreate a user defined route is tooforward traffic tooa virtual appliance.</span></span> <span data-ttu-id="b57e0-203">Um dispositivo virtual é nada mais que uma VM que executa um tráfego de rede do aplicativo usado toohandle de alguma forma, como um firewall ou um dispositivo NAT.</span><span class="sxs-lookup"><span data-stu-id="b57e0-203">A virtual appliance is nothing more than a VM that runs an application used toohandle network traffic in some way, such as a firewall or a NAT device.</span></span>

<span data-ttu-id="b57e0-204">Este dispositivo virtual que VM deve ser capaz de tooreceive tráfego de entrada que é não resolvidos tooitself.</span><span class="sxs-lookup"><span data-stu-id="b57e0-204">This virtual appliance VM must be able tooreceive incoming traffic that is not addressed tooitself.</span></span> <span data-ttu-id="b57e0-205">tooallow um tráfego de tooreceive VM endereçado tooother destinos, você deve habilitar o encaminhamento IP para Olá VM.</span><span class="sxs-lookup"><span data-stu-id="b57e0-205">tooallow a VM tooreceive traffic addressed tooother destinations, you must enable IP Forwarding for hello VM.</span></span> <span data-ttu-id="b57e0-206">Este é um Azure configuração, não é uma configuração no sistema de operacional convidado hello.</span><span class="sxs-lookup"><span data-stu-id="b57e0-206">This is an Azure setting, not a setting in hello guest operating system.</span></span>

## <a name="next-steps"></a><span data-ttu-id="b57e0-207">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="b57e0-207">Next steps</span></span>
* <span data-ttu-id="b57e0-208">Saiba como muito[criar rotas no modelo de implantação do Gerenciador de recursos de saudação](virtual-network-create-udr-arm-template.md) e associá-los toosubnets.</span><span class="sxs-lookup"><span data-stu-id="b57e0-208">Learn how too[create routes in hello Resource Manager deployment model](virtual-network-create-udr-arm-template.md) and associate them toosubnets.</span></span> 
* <span data-ttu-id="b57e0-209">Saiba como muito[criar rotas no modelo de implantação clássico Olá](virtual-network-create-udr-classic-ps.md) e associá-los toosubnets.</span><span class="sxs-lookup"><span data-stu-id="b57e0-209">Learn how too[create routes in hello classic deployment model](virtual-network-create-udr-classic-ps.md) and associate them toosubnets.</span></span>

