---
title: "aaaResolution para VMs e instâncias de função"
description: "Cenários de resolução de nomes para o Azure IaaS, soluções híbridas, entre diferentes serviços de nuvem, Active Directory e usando o seu próprio servidor DNS  "
services: virtual-network
documentationcenter: na
author: GarethBradshawMSFT
manager: carmonm
editor: tysonn
ms.assetid: 5d73edde-979a-470a-b28c-e103fcf07e3e
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 12/06/2016
ms.author: telmos
ms.openlocfilehash: 0ec7903cf200c1d04d75601a5b0cefe4268f3dcf
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="name-resolution-for-vms-and-role-instances"></a><span data-ttu-id="d3464-103">Resolução de nomes de máquinas virtuais e instâncias de função</span><span class="sxs-lookup"><span data-stu-id="d3464-103">Name Resolution for VMs and Role Instances</span></span>
<span data-ttu-id="d3464-104">Dependendo de como você usa toohost Azure IaaS, PaaS e soluções híbridas, talvez seja necessário tooallow Olá VMs e instâncias de função que você crie toocommunicate entre si.</span><span class="sxs-lookup"><span data-stu-id="d3464-104">Depending on how you use Azure toohost IaaS, PaaS, and hybrid solutions, you may need tooallow hello VMs and role instances that you create toocommunicate with each other.</span></span> <span data-ttu-id="d3464-105">Embora essa comunicação pode ser feita usando endereços IP, é muito mais simples nomes toouse que podem ser facilmente lembrados e não são alterados.</span><span class="sxs-lookup"><span data-stu-id="d3464-105">Although this communication can be done by using IP addresses, it is much simpler toouse names that can be easily remembered and do not change.</span></span> 

<span data-ttu-id="d3464-106">Quando instâncias de função e as máquinas virtuais hospedadas no Azure precisam de endereços IP do tooresolve domínio nomes toointernal, eles podem usar um destes dois métodos:</span><span class="sxs-lookup"><span data-stu-id="d3464-106">When role instances and VMs hosted in Azure need tooresolve domain names toointernal IP addresses, they can use one of two methods:</span></span>

* [<span data-ttu-id="d3464-107">Resolução de nomes fornecida pelo Azure</span><span class="sxs-lookup"><span data-stu-id="d3464-107">Azure-provided name resolution</span></span>](#azure-provided-name-resolution)
* <span data-ttu-id="d3464-108">[Resolução de nomes usando seu próprio servidor DNS](#name-resolution-using-your-own-dns-server) (que pode encaminhar consultas toohello servidores DNS fornecidos pelo Azure)</span><span class="sxs-lookup"><span data-stu-id="d3464-108">[Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server) (which may forward queries toohello Azure-provided DNS servers)</span></span> 

<span data-ttu-id="d3464-109">tipo de Olá de resolução de nome que você usa depende de como suas máquinas virtuais e instâncias de função necessário toocommunicate uns com os outros.</span><span class="sxs-lookup"><span data-stu-id="d3464-109">hello type of name resolution you use depends on how your VMs and role instances need toocommunicate with each other.</span></span>

<span data-ttu-id="d3464-110">**Olá tabela a seguir ilustra os cenários e soluções de resolução de nome correspondente:**</span><span class="sxs-lookup"><span data-stu-id="d3464-110">**hello following table illustrates scenarios and corresponding name resolution solutions:**</span></span>

| <span data-ttu-id="d3464-111">**Cenário**</span><span class="sxs-lookup"><span data-stu-id="d3464-111">**Scenario**</span></span> | <span data-ttu-id="d3464-112">**Solução**</span><span class="sxs-lookup"><span data-stu-id="d3464-112">**Solution**</span></span> | <span data-ttu-id="d3464-113">**Suffix**</span><span class="sxs-lookup"><span data-stu-id="d3464-113">**Suffix**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="d3464-114">Resolução de nomes entre instâncias de função ou máquinas virtuais localizadas em Olá mesmo serviço de nuvem ou rede virtual</span><span class="sxs-lookup"><span data-stu-id="d3464-114">Name resolution between role instances or VMs located in hello same cloud service or virtual network</span></span> |[<span data-ttu-id="d3464-115">Resolução de nomes fornecida pelo Azure</span><span class="sxs-lookup"><span data-stu-id="d3464-115">Azure-provided name resolution</span></span>](#azure-provided-name-resolution) |<span data-ttu-id="d3464-116">nome de host ou FQDN</span><span class="sxs-lookup"><span data-stu-id="d3464-116">hostname or FQDN</span></span> |
| <span data-ttu-id="d3464-117">Resolução de nomes entre instâncias de função ou máquinas virtuais localizadas em redes virtuais diferentes</span><span class="sxs-lookup"><span data-stu-id="d3464-117">Name resolution between role instances or VMs located in different virtual networks</span></span> |<span data-ttu-id="d3464-118">Servidores DNS gerenciados pelo cliente que encaminham consultas entre redes virtuais para resolução pelo Azure (proxy DNS).</span><span class="sxs-lookup"><span data-stu-id="d3464-118">Customer-managed DNS servers forwarding queries between vnets for resolution by Azure (DNS proxy).</span></span>  <span data-ttu-id="d3464-119">Confira [Resolução de nome usando o seu próprio servidor DNS](#name-resolution-using-your-own-dns-server)</span><span class="sxs-lookup"><span data-stu-id="d3464-119">see [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server)</span></span> |<span data-ttu-id="d3464-120">Somente FQDN</span><span class="sxs-lookup"><span data-stu-id="d3464-120">FQDN only</span></span> |
| <span data-ttu-id="d3464-121">Resolução de nomes de serviço e de computador locais em instâncias de função ou VMs no Azure</span><span class="sxs-lookup"><span data-stu-id="d3464-121">Resolution of on-premises computer and service names from role instances or VMs in Azure</span></span> |<span data-ttu-id="d3464-122">Servidores DNS gerenciados pelo cliente (por exemplo, controlador de domínio local, controlador de domínio somente leitura local ou DNS secundário sincronizado usando transferências de zona).</span><span class="sxs-lookup"><span data-stu-id="d3464-122">Customer-managed DNS servers (e.g. on-premises domain controller, local read-only domain controller or a DNS secondary synced using zone transfers).</span></span>  <span data-ttu-id="d3464-123">Confira [Resolução de nome usando o seu próprio servidor DNS](#name-resolution-using-your-own-dns-server)</span><span class="sxs-lookup"><span data-stu-id="d3464-123">See [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server)</span></span> |<span data-ttu-id="d3464-124">Somente FQDN</span><span class="sxs-lookup"><span data-stu-id="d3464-124">FQDN only</span></span> |
| <span data-ttu-id="d3464-125">Resolução de nomes de host do Azure de computadores locais</span><span class="sxs-lookup"><span data-stu-id="d3464-125">Resolution of Azure hostnames from on-premises computers</span></span> |<span data-ttu-id="d3464-126">Encaminhar consultas tooa gerenciada pelo cliente proxy servidor DNS na rede virtual correspondente de saudação, servidor de proxy de saudação encaminha consultas tooAzure para resolução.</span><span class="sxs-lookup"><span data-stu-id="d3464-126">Forward queries tooa customer-managed DNS proxy server in hello corresponding vnet, hello proxy server forwards queries tooAzure for resolution.</span></span> <span data-ttu-id="d3464-127">Confira [Resolução de nome usando o seu próprio servidor DNS](#name-resolution-using-your-own-dns-server)</span><span class="sxs-lookup"><span data-stu-id="d3464-127">See [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server)</span></span> |<span data-ttu-id="d3464-128">Somente FQDN</span><span class="sxs-lookup"><span data-stu-id="d3464-128">FQDN only</span></span> |
| <span data-ttu-id="d3464-129">DNS inverso para IPs internos</span><span class="sxs-lookup"><span data-stu-id="d3464-129">Reverse DNS for internal IPs</span></span> |[<span data-ttu-id="d3464-130">Resolução de nome usando o seu próprio servidor DNS</span><span class="sxs-lookup"><span data-stu-id="d3464-130">Name resolution using your own DNS server</span></span>](#name-resolution-using-your-own-dns-server) |<span data-ttu-id="d3464-131">n/d</span><span class="sxs-lookup"><span data-stu-id="d3464-131">n/a</span></span> |
| <span data-ttu-id="d3464-132">Resolução de nomes entre VMs ou instâncias de função localizadas em serviços de nuvem diferente, não em uma rede virtual</span><span class="sxs-lookup"><span data-stu-id="d3464-132">Name resolution between VMs or role instances located in different cloud services, not in a virtual network</span></span> |<span data-ttu-id="d3464-133">Não aplicável.</span><span class="sxs-lookup"><span data-stu-id="d3464-133">Not applicable.</span></span> <span data-ttu-id="d3464-134">Não há suporte para a conectividade entre máquinas virtuais e instâncias de função em diferentes serviços de nuvem fora de uma rede virtual.</span><span class="sxs-lookup"><span data-stu-id="d3464-134">Connectivity between VMs and role instances in different cloud services is not supported outside a virtual network.</span></span> |<span data-ttu-id="d3464-135">n/d</span><span class="sxs-lookup"><span data-stu-id="d3464-135">n/a</span></span> |

## <a name="azure-provided-name-resolution"></a><span data-ttu-id="d3464-136">Resolução de nomes fornecida pelo Azure</span><span class="sxs-lookup"><span data-stu-id="d3464-136">Azure-provided name resolution</span></span>
<span data-ttu-id="d3464-137">Junto com a resolução de nomes DNS públicos, o Azure fornece resolução de nome interno para VMs e Olá de instâncias de função que residem no mesmo serviço de nuvem ou rede virtual.</span><span class="sxs-lookup"><span data-stu-id="d3464-137">Along with resolution of public DNS names, Azure provides internal name resolution for VMs and role instances that reside within hello same virtual network or cloud service.</span></span>  <span data-ttu-id="d3464-138">Máquinas virtuais/instâncias em um serviço de nuvem compartilham Olá DNS mesmo sufixo (forma Olá hostname sozinho é suficiente), mas em serviços de nuvem diferentes redes virtuais clássicas tem vários sufixos DNS Olá FQDN é necessário tooresolve nomes entre diferentes serviços de nuvem.</span><span class="sxs-lookup"><span data-stu-id="d3464-138">VMs/instances in a cloud service share hello same DNS suffix (so hello hostname alone is sufficient) but in classic virtual networks different cloud services have different DNS suffixes so hello FQDN is needed tooresolve names between different cloud services.</span></span>  <span data-ttu-id="d3464-139">Em redes virtuais no modelo de implantação do Gerenciador de recursos de Olá, sufixo DNS Olá é consistente entre a rede virtual hello (por Olá FQDN não é necessário) e nomes DNS podem ser atribuídos NICs tooboth e VMs.</span><span class="sxs-lookup"><span data-stu-id="d3464-139">In virtual networks in hello Resource Manager deployment model, hello DNS suffix is consistent across hello virtual network (so hello FQDN is not needed) and DNS names can be assigned tooboth NICs and VMs.</span></span> <span data-ttu-id="d3464-140">Embora a resolução de nomes fornecida pelo Azure não requer qualquer configuração, não é a opção apropriada Olá para todos os cenários de implantação, como mostrado na tabela de saudação acima.</span><span class="sxs-lookup"><span data-stu-id="d3464-140">Although Azure-provided name resolution does not require any configuration, it is not hello appropriate choice for all deployment scenarios, as seen on hello table above.</span></span>

> [!NOTE]
> <span data-ttu-id="d3464-141">No caso de saudação de funções da web e de trabalho, você também pode acessar os endereços IP internos Olá de instâncias de função com base em produtos de número de nome e a instância de função hello usando Olá API de REST do gerenciamento de serviços do Azure.</span><span class="sxs-lookup"><span data-stu-id="d3464-141">In hello case of web and worker roles, you can also access hello internal IP addresses of role instances based on hello role name and instance number using hello Azure Service Management REST API.</span></span> <span data-ttu-id="d3464-142">Para obter mais informações, veja [Referência da API REST de Gerenciamento de Serviços](https://msdn.microsoft.com/library/azure/ee460799.aspx).</span><span class="sxs-lookup"><span data-stu-id="d3464-142">For more information, see [Service Management REST API Reference](https://msdn.microsoft.com/library/azure/ee460799.aspx).</span></span>
> 
> 

### <a name="features-and-considerations"></a><span data-ttu-id="d3464-143">Recursos e considerações</span><span class="sxs-lookup"><span data-stu-id="d3464-143">Features and Considerations</span></span>
<span data-ttu-id="d3464-144">**Recursos:**</span><span class="sxs-lookup"><span data-stu-id="d3464-144">**Features:**</span></span>

* <span data-ttu-id="d3464-145">Facilidade de uso: nenhuma configuração é necessária na ordem toouse resolução de nomes fornecida pelo Azure.</span><span class="sxs-lookup"><span data-stu-id="d3464-145">Ease of use: No configuration is required in order toouse Azure-provided name resolution.</span></span>
* <span data-ttu-id="d3464-146">serviço de resolução de nome de fornecida pelo Azure de saudação é altamente disponível, salvando você hello necessário toocreate e gerenciar clusters de servidores DNS.</span><span class="sxs-lookup"><span data-stu-id="d3464-146">hello Azure-provided name resolution service is highly available, saving you hello need toocreate and manage clusters of your own DNS servers.</span></span>
* <span data-ttu-id="d3464-147">Pode ser usado em conjunto com seu próprios tooresolve de servidores DNS locais e nomes de host do Azure.</span><span class="sxs-lookup"><span data-stu-id="d3464-147">Can be used in conjunction with your own DNS servers tooresolve both on-premises and Azure hostnames.</span></span>
* <span data-ttu-id="d3464-148">Resolução de nomes é fornecida entre instâncias de função/VMs em Olá mesmo serviço sem a necessidade de um FQDN na nuvem.</span><span class="sxs-lookup"><span data-stu-id="d3464-148">Name resolution is provided between role instances/VMs within hello same cloud service without need for a FQDN.</span></span>
* <span data-ttu-id="d3464-149">Resolução de nomes é fornecida entre VMs em redes virtuais que usam o modelo de implantação do Gerenciador de recursos de hello, sem necessidade de saudação FQDN.</span><span class="sxs-lookup"><span data-stu-id="d3464-149">Name resolution is provided between VMs in virtual networks that use hello Resource Manager deployment model, without need for hello FQDN.</span></span> <span data-ttu-id="d3464-150">Redes virtuais no modelo de implantação clássico Olá exigem Olá FQDN durante a resolução de nomes em diferentes serviços de nuvem.</span><span class="sxs-lookup"><span data-stu-id="d3464-150">Virtual networks in hello classic deployment model require hello FQDN when resolving names in different cloud services.</span></span> 
* <span data-ttu-id="d3464-151">Você pode usar nomes de host que descrevem melhor as suas implantações, em vez de trabalhar com nomes gerados automaticamente.</span><span class="sxs-lookup"><span data-stu-id="d3464-151">You can use hostnames that best describe your deployments, rather than working with auto-generated names.</span></span>

<span data-ttu-id="d3464-152">**Considerações:**</span><span class="sxs-lookup"><span data-stu-id="d3464-152">**Considerations:**</span></span>

* <span data-ttu-id="d3464-153">sufixo DNS criado pelo Azure Olá não pode ser modificado.</span><span class="sxs-lookup"><span data-stu-id="d3464-153">hello Azure-created DNS suffix cannot be modified.</span></span>
* <span data-ttu-id="d3464-154">Não é possível registrar manualmente seus próprios registros.</span><span class="sxs-lookup"><span data-stu-id="d3464-154">You cannot manually register your own records.</span></span>
* <span data-ttu-id="d3464-155">Não há suporte para o WINS e NetBIOS.</span><span class="sxs-lookup"><span data-stu-id="d3464-155">WINS and NetBIOS are not supported.</span></span> <span data-ttu-id="d3464-156">(Você não pode ver suas VMs no Windows Explorer.)</span><span class="sxs-lookup"><span data-stu-id="d3464-156">(You cannot see your VMs in Windows Explorer.)</span></span>
* <span data-ttu-id="d3464-157">Os nomes de host devem ser compatíveis com DNS (eles devem usar somente 0-9, a-z e '-' e não podem começar ou terminar com um '-'.</span><span class="sxs-lookup"><span data-stu-id="d3464-157">Hostnames must be DNS-compatible (They must use only 0-9, a-z and '-', and cannot start or end with a '-'.</span></span> <span data-ttu-id="d3464-158">Consulte o RFC 3696, seção 2).</span><span class="sxs-lookup"><span data-stu-id="d3464-158">See RFC 3696 section 2.)</span></span>
* <span data-ttu-id="d3464-159">O tráfego da consulta DNS é restrita a cada VM.</span><span class="sxs-lookup"><span data-stu-id="d3464-159">DNS query traffic is throttled for each VM.</span></span> <span data-ttu-id="d3464-160">Isso não deve afetar a maioria dos aplicativos.</span><span class="sxs-lookup"><span data-stu-id="d3464-160">This shouldn't impact most applications.</span></span>  <span data-ttu-id="d3464-161">Se a limitação da solicitação for observada, certifique-se de que o armazenamento em cache do cliente está habilitado.</span><span class="sxs-lookup"><span data-stu-id="d3464-161">If request throttling is observed, ensure that client-side caching is enabled.</span></span>  <span data-ttu-id="d3464-162">Para obter mais detalhes, consulte [obtendo hello mais da resolução de nomes fornecida pelo Azure](#Getting-the-most-from-Azure-provided-name-resolution).</span><span class="sxs-lookup"><span data-stu-id="d3464-162">For more details, see [Getting hello most from Azure-provided name resolution](#Getting-the-most-from-Azure-provided-name-resolution).</span></span>
* <span data-ttu-id="d3464-163">Apenas as VMs no hello primeiro 180 serviços de nuvem são registradas para cada rede virtual em um modelo de implantação clássico.</span><span class="sxs-lookup"><span data-stu-id="d3464-163">Only VMs in hello first 180 cloud services are registered for each virtual network in a classic deployment model.</span></span> <span data-ttu-id="d3464-164">Isso não se aplica a redes toovirtual em modelos de implantação do Gerenciador de recursos.</span><span class="sxs-lookup"><span data-stu-id="d3464-164">This does not apply toovirtual networks in Resource Manager deployment models.</span></span>

### <a name="getting-hello-most-from-azure-provided-name-resolution"></a><span data-ttu-id="d3464-165">Obtendo hello mais da resolução de nomes fornecida pelo Azure</span><span class="sxs-lookup"><span data-stu-id="d3464-165">Getting hello most from Azure-provided name resolution</span></span>
<span data-ttu-id="d3464-166">**Armazenamento em cache no lado cliente:**</span><span class="sxs-lookup"><span data-stu-id="d3464-166">**Client-side Caching:**</span></span>

<span data-ttu-id="d3464-167">Nem todas as consultas DNS precisa toobe enviado pela rede hello.</span><span class="sxs-lookup"><span data-stu-id="d3464-167">Not every DNS query needs toobe sent across hello network.</span></span>  <span data-ttu-id="d3464-168">O cache do cliente ajuda a reduzir a latência e melhorar a pontos de luz resiliência toonetwork Resolvendo recorrentes consultas DNS de um cache local.</span><span class="sxs-lookup"><span data-stu-id="d3464-168">Client-side caching helps reduce latency and improve resilience toonetwork blips by resolving recurring DNS queries from a local cache.</span></span>  <span data-ttu-id="d3464-169">Os registros DNS contêm um tempo de vida (TTL) que permite que o registro de saudação do hello cache toostore por tempo possível sem afetar a atualização de registro, portanto, o cache do cliente é adequado para a maioria das situações.</span><span class="sxs-lookup"><span data-stu-id="d3464-169">DNS records contain a Time-To-Live (TTL) which allows hello cache toostore hello record for as long as possible without impacting record freshness, so client-side caching is suitable for most situations.</span></span>

<span data-ttu-id="d3464-170">padrão de saudação cliente DNS do Windows tem um cache DNS interno.</span><span class="sxs-lookup"><span data-stu-id="d3464-170">hello default Windows DNS Client has a DNS cache built-in.</span></span>  <span data-ttu-id="d3464-171">Alguns Linux distribuições não incluem o armazenamento em cache por padrão, é recomendável que um seja adicionada tooeach VM do Linux (depois de verificar se há um cache local estiver).</span><span class="sxs-lookup"><span data-stu-id="d3464-171">Some Linux distros do not include caching by default, it is recommended that one be added tooeach Linux VM (after checking that there isn't a local cache already).</span></span>

<span data-ttu-id="d3464-172">Há um número de diferentes DNS cache pacotes disponíveis, por exemplo, dnsmasq, aqui estão Olá etapas tooinstall dnsmasq em distribuições mais comuns de saudação:</span><span class="sxs-lookup"><span data-stu-id="d3464-172">There are a number of different DNS caching packages available, e.g. dnsmasq, here are hello steps tooinstall dnsmasq on hello most common distros:</span></span>

* <span data-ttu-id="d3464-173">**Ubuntu (usa resolvconf)**:</span><span class="sxs-lookup"><span data-stu-id="d3464-173">**Ubuntu (uses resolvconf)**:</span></span>
  * <span data-ttu-id="d3464-174">apenas instalação Olá dnsmasq pacote ("sudo apt get install dnsmasq").</span><span class="sxs-lookup"><span data-stu-id="d3464-174">just install hello dnsmasq package (“sudo apt-get install dnsmasq”).</span></span>
* <span data-ttu-id="d3464-175">**SUSE (usa netconf)**:</span><span class="sxs-lookup"><span data-stu-id="d3464-175">**SUSE (uses netconf)**:</span></span>
  * <span data-ttu-id="d3464-176">instalar o pacote de dnsmasq hello ("sudo zypper instalar dnsmasq")</span><span class="sxs-lookup"><span data-stu-id="d3464-176">install hello dnsmasq package (“sudo zypper install dnsmasq”)</span></span> 
  * <span data-ttu-id="d3464-177">Habilitar o serviço de dnsmasq hello ("systemctl habilitar dnsmasq.service")</span><span class="sxs-lookup"><span data-stu-id="d3464-177">enable hello dnsmasq service (“systemctl enable dnsmasq.service”)</span></span> 
  * <span data-ttu-id="d3464-178">Iniciar o serviço de dnsmasq hello ("systemctl início dnsmasq.service")</span><span class="sxs-lookup"><span data-stu-id="d3464-178">start hello dnsmasq service (“systemctl start dnsmasq.service”)</span></span> 
  * <span data-ttu-id="d3464-179">Editar "/ etc/sysconfig/rede/configuração" e alterar NETCONFIG_DNS_FORWARDER = "" muito "dnsmasq"</span><span class="sxs-lookup"><span data-stu-id="d3464-179">edit “/etc/sysconfig/network/config” and change NETCONFIG_DNS_FORWARDER="" too”dnsmasq”</span></span>
  * <span data-ttu-id="d3464-180">atualizar o cache resolv. conf ("atualização netconfig") tooset hello como Olá resolvedor DNS local</span><span class="sxs-lookup"><span data-stu-id="d3464-180">update resolv.conf ("netconfig update") tooset hello cache as hello local DNS resolver</span></span>
* <span data-ttu-id="d3464-181">**OpenLogic (usa NetworkManager)**:</span><span class="sxs-lookup"><span data-stu-id="d3464-181">**OpenLogic (uses NetworkManager)**:</span></span>
  * <span data-ttu-id="d3464-182">instalar o pacote de dnsmasq hello ("sudo yum install dnsmasq")</span><span class="sxs-lookup"><span data-stu-id="d3464-182">install hello dnsmasq package (“sudo yum install dnsmasq”)</span></span>
  * <span data-ttu-id="d3464-183">Habilitar o serviço de dnsmasq hello ("systemctl habilitar dnsmasq.service")</span><span class="sxs-lookup"><span data-stu-id="d3464-183">enable hello dnsmasq service (“systemctl enable dnsmasq.service”)</span></span>
  * <span data-ttu-id="d3464-184">Iniciar o serviço de dnsmasq hello ("systemctl início dnsmasq.service")</span><span class="sxs-lookup"><span data-stu-id="d3464-184">start hello dnsmasq service (“systemctl start dnsmasq.service”)</span></span>
  * <span data-ttu-id="d3464-185">Adicionar "preceda o nome-domínio-servidores 127.0.0.1;" too"/etc/dhclient-eth0.conf"</span><span class="sxs-lookup"><span data-stu-id="d3464-185">add “prepend domain-name-servers 127.0.0.1;” too“/etc/dhclient-eth0.conf”</span></span>
  * <span data-ttu-id="d3464-186">Reinicie o cache tooset saudação do ("rede reiniciar o serviço") de serviço de rede Olá Olá resolvedor DNS local</span><span class="sxs-lookup"><span data-stu-id="d3464-186">restart hello network service (“service network restart”) tooset hello cache as hello local DNS resolver</span></span>

> [!NOTE]
> <span data-ttu-id="d3464-187">pacote de 'dnsmasq' Hello é apenas uma saudação vários caches DNS disponíveis para Linux.</span><span class="sxs-lookup"><span data-stu-id="d3464-187">hello 'dnsmasq' package is only one of hello many DNS caches available for Linux.</span></span>  <span data-ttu-id="d3464-188">Antes de usá-lo, verifique sua adequação para suas necessidades específicas e se nenhum outro cache está instalado.</span><span class="sxs-lookup"><span data-stu-id="d3464-188">Before using it, please check its suitability for your particular needs and that no other cache is installed.</span></span>
> 
> 

<span data-ttu-id="d3464-189">**Tentativa no lado do cliente:**</span><span class="sxs-lookup"><span data-stu-id="d3464-189">**Client-side Retries:**</span></span>

<span data-ttu-id="d3464-190">O DNS é principalmente um protocolo UDP.</span><span class="sxs-lookup"><span data-stu-id="d3464-190">DNS is primarily a UDP protocol.</span></span>  <span data-ttu-id="d3464-191">Como Olá protocolo UDP não garante a entrega de mensagens, lógica de repetição é processada no próprio protocolo DNS hello.</span><span class="sxs-lookup"><span data-stu-id="d3464-191">As hello UDP protocol doesn't guarantee message delivery, retry logic is handled in hello DNS protocol itself.</span></span>  <span data-ttu-id="d3464-192">Cada cliente DNS (sistema operacional) pode apresentar a lógica de repetição diferente dependendo da preferência de criadores de saudação:</span><span class="sxs-lookup"><span data-stu-id="d3464-192">Each DNS client (operating system) can exhibit different retry logic depending on hello creators preference:</span></span>

* <span data-ttu-id="d3464-193">Sistemas operacionais Windows tentam novamente depois de 1 segundo e, em seguida, novamente após outros 2, 4 e outros 4 segundos.</span><span class="sxs-lookup"><span data-stu-id="d3464-193">Windows operating systems retry after 1 second and then again after another 2, 4 and another 4 seconds.</span></span> 
* <span data-ttu-id="d3464-194">Olá tentativas de instalação Linux padrão depois de 5 segundos.</span><span class="sxs-lookup"><span data-stu-id="d3464-194">hello default Linux setup retries after 5 seconds.</span></span>  <span data-ttu-id="d3464-195">É recomendável toochange este tooretry 5 vezes intervalos de 1 segundo.</span><span class="sxs-lookup"><span data-stu-id="d3464-195">It is recommended toochange this tooretry 5 times at 1 second intervals.</span></span>  

<span data-ttu-id="d3464-196">toocheck Olá configurações atuais em uma VM do Linux, 'cat /etc/resolv.conf' e procure na linha de 'Opções' hello, por exemplo:</span><span class="sxs-lookup"><span data-stu-id="d3464-196">toocheck hello current settings on a Linux VM, 'cat /etc/resolv.conf' and look at hello 'options' line, e.g.:</span></span>

    options timeout:1 attempts:5

<span data-ttu-id="d3464-197">arquivo de resolv. conf Olá é normalmente gerado automaticamente e não deve ser editado.</span><span class="sxs-lookup"><span data-stu-id="d3464-197">hello resolv.conf file is usually auto-generated and should not be edited.</span></span>  <span data-ttu-id="d3464-198">etapas específicas de saudação para adicionar a linha 'Opções' hello variam de acordo com a distribuição:</span><span class="sxs-lookup"><span data-stu-id="d3464-198">hello specific steps for adding hello 'options' line vary by distro:</span></span>

* <span data-ttu-id="d3464-199">**Ubuntu** (usa resolvconf):</span><span class="sxs-lookup"><span data-stu-id="d3464-199">**Ubuntu** (uses resolvconf):</span></span>
  * <span data-ttu-id="d3464-200">Adicionar Olá opções linha too'/etc/resolveconf/resolv.conf.d/head'</span><span class="sxs-lookup"><span data-stu-id="d3464-200">add hello options line too'/etc/resolveconf/resolv.conf.d/head'</span></span> 
  * <span data-ttu-id="d3464-201">executar tooupdate 'resolvconf -u'</span><span class="sxs-lookup"><span data-stu-id="d3464-201">run 'resolvconf -u' tooupdate</span></span>
* <span data-ttu-id="d3464-202">**SUSE** (usa netconf):</span><span class="sxs-lookup"><span data-stu-id="d3464-202">**SUSE** (uses netconf):</span></span>
  * <span data-ttu-id="d3464-203">Adicione 'tentativas timeout:1: 5' toohello NETCONFIG_DNS_RESOLVER_OPTIONS = "" parâmetro em '/ etc/sysconfig/rede/configuração'</span><span class="sxs-lookup"><span data-stu-id="d3464-203">add 'timeout:1 attempts:5' toohello NETCONFIG_DNS_RESOLVER_OPTIONS="" parameter in '/etc/sysconfig/network/config'</span></span> 
  * <span data-ttu-id="d3464-204">executar tooupdate 'netconfig update'</span><span class="sxs-lookup"><span data-stu-id="d3464-204">run 'netconfig update' tooupdate</span></span>
* <span data-ttu-id="d3464-205">**OpenLogic** (usa NetworkManager):</span><span class="sxs-lookup"><span data-stu-id="d3464-205">**OpenLogic** (uses NetworkManager):</span></span>
  * <span data-ttu-id="d3464-206">Adicionar too'/etc/NetworkManager/dispatcher.d/11-dhclient 'echo "opções timeout:1 tentativas: 5" ' '</span><span class="sxs-lookup"><span data-stu-id="d3464-206">add 'echo "options timeout:1 attempts:5"' too'/etc/NetworkManager/dispatcher.d/11-dhclient'</span></span> 
  * <span data-ttu-id="d3464-207">Execute o 'serviço rede restart' tooupdate</span><span class="sxs-lookup"><span data-stu-id="d3464-207">run 'service network restart' tooupdate</span></span>

## <a name="name-resolution-using-your-own-dns-server"></a><span data-ttu-id="d3464-208">Resolução de nome usando o seu próprio servidor DNS</span><span class="sxs-lookup"><span data-stu-id="d3464-208">Name resolution using your own DNS server</span></span>
<span data-ttu-id="d3464-209">Há várias situações em que as suas necessidades de resolução de nome podem ir além dos recursos de saudação fornecidos pelo Azure, por exemplo quando usando domínios do Active Directory ou quando precisar de resolução DNS entre redes virtuais (vnets).</span><span class="sxs-lookup"><span data-stu-id="d3464-209">There are a number of situations where your name resolution needs may go beyond hello features provided by Azure, for example when using Active Directory domains or when you require DNS resolution between virtual networks (vnets).</span></span>  <span data-ttu-id="d3464-210">toocover nesses cenários, o Azure fornece a capacidade de saudação para você toouse seus próprios servidores DNS.</span><span class="sxs-lookup"><span data-stu-id="d3464-210">toocover these scenarios, Azure provides hello ability for you toouse your own DNS servers.</span></span>  

<span data-ttu-id="d3464-211">Servidores DNS em uma rede virtual podem encaminhar resolvedores de recursiva do DNS consultas tooAzure tooresolve hostnames dentro da rede virtual.</span><span class="sxs-lookup"><span data-stu-id="d3464-211">DNS servers within a virtual network can forward DNS queries tooAzure's recursive resolvers tooresolve hostnames within that virtual network.</span></span>  <span data-ttu-id="d3464-212">Por exemplo, um controlador de domínio (DC) em execução no Azure pode responder a consultas tooDNS para seus domínios e encaminhar todos os outros tooAzure de consultas.</span><span class="sxs-lookup"><span data-stu-id="d3464-212">For example, a Domain Controller (DC) running in Azure can respond tooDNS queries for its domains and forward all other queries tooAzure.</span></span>  <span data-ttu-id="d3464-213">Isso permite que as VMs toosee seus recursos locais (via Olá controlador de domínio) e o fornecida pelo Azure nomes de host (por meio do encaminhador de saudação).</span><span class="sxs-lookup"><span data-stu-id="d3464-213">This allows VMs toosee both your on-premises resources (via hello DC) and Azure-provided hostnames (via hello forwarder).</span></span>  <span data-ttu-id="d3464-214">Resolvedores de recursiva do acesso tooAzure é fornecido através da saudação IP virtual 168.63.129.16.</span><span class="sxs-lookup"><span data-stu-id="d3464-214">Access tooAzure's recursive resolvers is provided via hello virtual IP 168.63.129.16.</span></span>

<span data-ttu-id="d3464-215">Encaminhamento de DNS também permite a resolução de DNS inter-rede virtual e permite que seu tooresolve de máquinas locais hostnames fornecida pelo Azure.</span><span class="sxs-lookup"><span data-stu-id="d3464-215">DNS forwarding also enables inter-vnet DNS resolution and allows your on-premises machines tooresolve Azure-provided hostnames.</span></span>  <span data-ttu-id="d3464-216">Em ordem tooresolve nome do host da VM, VM do servidor DNS Olá deve residir no hello mesmo virtual de rede e ser configurado tooforward tooAzure de consultas de nome de host.</span><span class="sxs-lookup"><span data-stu-id="d3464-216">In order tooresolve a VM's hostname, hello DNS server VM must reside in hello same virtual network and be configured tooforward hostname queries tooAzure.</span></span>  <span data-ttu-id="d3464-217">Como o sufixo DNS Olá é diferente em cada rede virtual, você pode usar o encaminhamento condicional regras toosend DNS consulta toohello corrigir a rede virtual para resolução.</span><span class="sxs-lookup"><span data-stu-id="d3464-217">As hello DNS suffix is different in each vnet, you can use conditional forwarding rules toosend DNS queries toohello correct vnet for resolution.</span></span>  <span data-ttu-id="d3464-218">Olá a imagem a seguir mostra dois vnets e uma rede local fazendo usando esse método de resolução de DNS inter-vnet.</span><span class="sxs-lookup"><span data-stu-id="d3464-218">hello following image shows two vnets and an on-premises network doing inter-vnet DNS resolution using this method.</span></span>  <span data-ttu-id="d3464-219">Um encaminhador DNS de exemplo está disponível no hello [Galeria de modelos de início rápido do Azure](https://azure.microsoft.com/documentation/templates/301-dns-forwarder/) e [GitHub](https://github.com/Azure/azure-quickstart-templates/tree/master/301-dns-forwarder).</span><span class="sxs-lookup"><span data-stu-id="d3464-219">An example DNS forwarder is available in hello [Azure Quickstart Templates gallery](https://azure.microsoft.com/documentation/templates/301-dns-forwarder/) and [GitHub](https://github.com/Azure/azure-quickstart-templates/tree/master/301-dns-forwarder).</span></span>

![DNS entre redes virtuais](./media/virtual-networks-name-resolution-for-vms-and-role-instances/inter-vnet-dns.png)

<span data-ttu-id="d3464-221">Ao usar a resolução de nomes fornecida pelo Azure, um sufixo de DNS interno (*. internal.cloudapp.net) é fornecido tooeach VM usando DHCP.</span><span class="sxs-lookup"><span data-stu-id="d3464-221">When using Azure-provided name resolution, an Internal DNS suffix (*.internal.cloudapp.net) is provided tooeach VM using DHCP.</span></span>  <span data-ttu-id="d3464-222">Isso permite que a resolução de nome de host de nome de host de saudação são registros na zona de internal.cloudapp.net hello.</span><span class="sxs-lookup"><span data-stu-id="d3464-222">This enables hostname resolution as hello hostname records are in hello internal.cloudapp.net zone.</span></span>  <span data-ttu-id="d3464-223">Ao usar sua própria solução de resolução de nome, Olá IDNS sufixo não é fornecido tooVMs porque interfira com outras arquiteturas DNS (como cenários de domínio).</span><span class="sxs-lookup"><span data-stu-id="d3464-223">When using your own name resolution solution, hello IDNS suffix is not supplied tooVMs because it interferes with other DNS architectures (like domain-joined scenarios).</span></span>  <span data-ttu-id="d3464-224">Em vez disso, fornecemos um espaço reservado que não funciona (reddog.microsoft.com).</span><span class="sxs-lookup"><span data-stu-id="d3464-224">Instead we provide a non-functioning placeholder (reddog.microsoft.com).</span></span>  

<span data-ttu-id="d3464-225">Se necessário, sufixo de DNS interno Olá pode ser determinado usando a API do PowerShell ou hello:</span><span class="sxs-lookup"><span data-stu-id="d3464-225">If needed, hello Internal DNS suffix can be determined using PowerShell or hello API:</span></span>

* <span data-ttu-id="d3464-226">Para redes virtuais nos modelos de implantação do Gerenciador de recursos, sufixo hello está disponível por meio de saudação [placa de interface de rede](https://msdn.microsoft.com/library/azure/mt163668.aspx) recurso ou por meio de saudação [AzureRmNetworkInterface Get](https://msdn.microsoft.com/library/mt619434.aspx) cmdlet.</span><span class="sxs-lookup"><span data-stu-id="d3464-226">For virtual networks in Resource Manager deployment models, hello suffix is available via hello [network interface card](https://msdn.microsoft.com/library/azure/mt163668.aspx) resource or via hello [Get-AzureRmNetworkInterface](https://msdn.microsoft.com/library/mt619434.aspx) cmdlet.</span></span>    
* <span data-ttu-id="d3464-227">Em modelos de implantação clássico, sufixo hello está disponível por meio de saudação [obter API de implantação](https://msdn.microsoft.com/library/azure/ee460804.aspx) chamar ou por meio de saudação [Get-AzureVM-depurar](https://msdn.microsoft.com/library/azure/dn495236.aspx) cmdlet.</span><span class="sxs-lookup"><span data-stu-id="d3464-227">In classic deployment models, hello suffix is available via hello [Get Deployment API](https://msdn.microsoft.com/library/azure/ee460804.aspx) call or via hello [Get-AzureVM -Debug](https://msdn.microsoft.com/library/azure/dn495236.aspx) cmdlet.</span></span>

<span data-ttu-id="d3464-228">Se o encaminhamento de consultas tooAzure não atender às suas necessidades, você precisará tooprovide sua própria solução DNS.</span><span class="sxs-lookup"><span data-stu-id="d3464-228">If forwarding queries tooAzure doesn't suit your needs, you will need tooprovide your own DNS solution.</span></span>  <span data-ttu-id="d3464-229">A solução DNS precisará:</span><span class="sxs-lookup"><span data-stu-id="d3464-229">Your DNS solution will need to:</span></span>

* <span data-ttu-id="d3464-230">Forneça uma resolução de nomes do host apropriada, por exemplo, por meio do [DDNS](virtual-networks-name-resolution-ddns.md).</span><span class="sxs-lookup"><span data-stu-id="d3464-230">Provide appropriate hostname resolution, e.g. via [DDNS](virtual-networks-name-resolution-ddns.md).</span></span>  <span data-ttu-id="d3464-231">Observe que, se usar DDNS talvez seja necessário toodisable DNS limpeza de registro como concessões de DHCP do Azure são muito longas e eliminação pode remover o DNS registra prematuramente.</span><span class="sxs-lookup"><span data-stu-id="d3464-231">Note, if using DDNS you may need toodisable DNS record scavenging as Azure's DHCP leases are very long and scavenging may remove DNS records prematurely.</span></span> 
* <span data-ttu-id="d3464-232">Fornece a resolução recursiva apropriado de tooallow de resolução de nomes de domínio externo.</span><span class="sxs-lookup"><span data-stu-id="d3464-232">Provide appropriate recursive resolution tooallow resolution of external domain names.</span></span>
* <span data-ttu-id="d3464-233">Ser acessível (TCP e UDP na porta 53) de clientes Olá serve e ser capaz de tooaccess Olá da internet.</span><span class="sxs-lookup"><span data-stu-id="d3464-233">Be accessible (TCP and UDP on port 53) from hello clients it serves and be able tooaccess hello internet.</span></span>
* <span data-ttu-id="d3464-234">Ser protegida contra o acesso de saudação à internet, ameaças de toomitigate impostas por agentes externos.</span><span class="sxs-lookup"><span data-stu-id="d3464-234">Be secured against access from hello internet, toomitigate threats posed by external agents.</span></span>

> [!NOTE]
> <span data-ttu-id="d3464-235">Para melhor desempenho, ao usar máquinas virtuais do Azure como servidores DNS, o IPv6 deve ser desabilitado e uma [IP público em nível de instância](virtual-networks-instance-level-public-ip.md) devem ser atribuídas a VM do servidor DNS tooeach.</span><span class="sxs-lookup"><span data-stu-id="d3464-235">For best performance, when using Azure VMs as DNS servers, IPv6 should be disabled and an [Instance-Level Public IP](virtual-networks-instance-level-public-ip.md) should be assigned tooeach DNS server VM.</span></span>  <span data-ttu-id="d3464-236">Se você escolher toouse Windows Server como seu servidor DNS, [neste artigo](http://blogs.technet.com/b/networking/archive/2015/08/19/name-resolution-performance-of-a-recursive-windows-dns-server-2012-r2.aspx) fornece análise de desempenho adicionais e otimizações.</span><span class="sxs-lookup"><span data-stu-id="d3464-236">If you choose toouse Windows Server as your DNS server, [this article](http://blogs.technet.com/b/networking/archive/2015/08/19/name-resolution-performance-of-a-recursive-windows-dns-server-2012-r2.aspx) provides additional performance analysis and optimizations.</span></span>
> 
> 

### <a name="specifying-dns-servers"></a><span data-ttu-id="d3464-237">Especificar servidores DNS</span><span class="sxs-lookup"><span data-stu-id="d3464-237">Specifying DNS servers</span></span>
<span data-ttu-id="d3464-238">Ao usar seus próprios servidores DNS, o Azure fornece Olá capacidade toospecify vários servidores DNS por rede virtual ou por rede interface (Gerenciador de recursos) / (clássico) do serviço de nuvem.</span><span class="sxs-lookup"><span data-stu-id="d3464-238">When using your own DNS servers, Azure provides hello ability toospecify multiple DNS servers per virtual network or per network interface (Resource Manager) / cloud service (classic).</span></span>  <span data-ttu-id="d3464-239">Os servidores DNS especificados para uma interface de rede/serviço de nuvem obtém precedência sobre os especificados para a rede virtual hello.</span><span class="sxs-lookup"><span data-stu-id="d3464-239">DNS servers specified for a cloud service/network interface get precedence over those specified for hello virtual network.</span></span>

> [!NOTE]
> <span data-ttu-id="d3464-240">Propriedades de conexão de rede, como o servidor DNS IPs, não devem ser editados diretamente em máquinas virtuais do Windows como eles podem obter apagados durante o serviço de reparo quando o adaptador de rede virtual Olá é substituído.</span><span class="sxs-lookup"><span data-stu-id="d3464-240">Network connection properties, such as DNS server IPs, should not be edited directly within Windows VMs as they may get erased during service heal when hello virtual network adaptor gets replaced.</span></span> 
> 
> 

<span data-ttu-id="d3464-241">Ao usar o modelo de implantação do Gerenciador de recursos de hello, servidores DNS podem ser especificados em Olá Portal, API/modelos ([vnet](https://msdn.microsoft.com/library/azure/mt163661.aspx), [nic](https://msdn.microsoft.com/library/azure/mt163668.aspx)) ou o PowerShell ([vnet](https://msdn.microsoft.com/library/mt603657.aspx), [nic](https://msdn.microsoft.com/library/mt619370.aspx)).</span><span class="sxs-lookup"><span data-stu-id="d3464-241">When using hello Resource Manager deployment model, DNS servers can be specified in hello Portal, API/Templates ([vnet](https://msdn.microsoft.com/library/azure/mt163661.aspx), [nic](https://msdn.microsoft.com/library/azure/mt163668.aspx)) or PowerShell ([vnet](https://msdn.microsoft.com/library/mt603657.aspx), [nic](https://msdn.microsoft.com/library/mt619370.aspx)).</span></span>

<span data-ttu-id="d3464-242">Ao usar o modelo de implantação clássico hello, servidores DNS para a rede virtual Olá pode ser especificado em Olá Portal ou [Olá *configuração de rede* arquivo](https://msdn.microsoft.com/library/azure/jj157100).</span><span class="sxs-lookup"><span data-stu-id="d3464-242">When using hello classic deployment model, DNS servers for hello virtual network can be specified in hello Portal or [hello *Network Configuration* file](https://msdn.microsoft.com/library/azure/jj157100).</span></span>  <span data-ttu-id="d3464-243">Para serviços de nuvem, os servidores DNS Olá são especificados por meio de [Olá *configuração do serviço* arquivo](https://msdn.microsoft.com/library/azure/ee758710) ou do PowerShell ([New-AzureVM](https://msdn.microsoft.com/library/azure/dn495254.aspx)).</span><span class="sxs-lookup"><span data-stu-id="d3464-243">For cloud services, hello DNS servers are specified via [hello *Service Configuration* file](https://msdn.microsoft.com/library/azure/ee758710) or in PowerShell ([New-AzureVM](https://msdn.microsoft.com/library/azure/dn495254.aspx)).</span></span>

> [!NOTE]
> <span data-ttu-id="d3464-244">Se você alterar as configurações de DNS Olá para um computador de rede virtual/virtual que já foi implantado, você precisa toorestart cada VM afetado para Olá alterações tootake efeito.</span><span class="sxs-lookup"><span data-stu-id="d3464-244">If you change hello DNS settings for a virtual network/virtual machine that is already deployed, you need toorestart each affected VM for hello changes tootake effect.</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="d3464-245">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="d3464-245">Next steps</span></span>
<span data-ttu-id="d3464-246">Modelo de implantação do Gerenciador de Recursos:</span><span class="sxs-lookup"><span data-stu-id="d3464-246">Resource Manager deployment model:</span></span>

* [<span data-ttu-id="d3464-247">Criar ou atualizar uma rede virtual</span><span class="sxs-lookup"><span data-stu-id="d3464-247">Create or update a virtual network</span></span>](https://msdn.microsoft.com/library/azure/mt163661.aspx)
* [<span data-ttu-id="d3464-248">Criar ou atualizar uma placa de interface de rede</span><span class="sxs-lookup"><span data-stu-id="d3464-248">Create or update a network interface card</span></span>](https://msdn.microsoft.com/library/azure/mt163668.aspx)
* [<span data-ttu-id="d3464-249">New-AzureRmVirtualNetwork</span><span class="sxs-lookup"><span data-stu-id="d3464-249">New-AzureRmVirtualNetwork</span></span>](https://msdn.microsoft.com/library/mt603657.aspx)
* [<span data-ttu-id="d3464-250">New-AzureRmNetworkInterface</span><span class="sxs-lookup"><span data-stu-id="d3464-250">New-AzureRmNetworkInterface</span></span>](https://msdn.microsoft.com/library/mt619370.aspx)

<span data-ttu-id="d3464-251">Modelo de implantação clássico:</span><span class="sxs-lookup"><span data-stu-id="d3464-251">Classic deployment model:</span></span>

* [<span data-ttu-id="d3464-252">Esquema de configuração de serviço do Azure</span><span class="sxs-lookup"><span data-stu-id="d3464-252">Azure Service Configuration Schema</span></span>](https://msdn.microsoft.com/library/azure/ee758710)
* [<span data-ttu-id="d3464-253">Esquema de configuração de Rede Virtual</span><span class="sxs-lookup"><span data-stu-id="d3464-253">Virtual Network Configuration Schema</span></span>](https://msdn.microsoft.com/library/azure/jj157100)
* [<span data-ttu-id="d3464-254">Configurar uma rede virtual usando um arquivo de configuração de rede</span><span class="sxs-lookup"><span data-stu-id="d3464-254">Configure a Virtual Network by Using a Network Configuration File</span></span>](virtual-networks-using-network-configuration-file.md) 

