---
title: "Solucionar problemas de rotas – Portal | Microsoft Docs"
description: "Saiba como solucionar problemas de rotas no modelo de implantação do Azure Resource Manager usando o Portal do Azure."
services: virtual-network
documentationcenter: na
author: AnithaAdusumilli
manager: narayan
editor: 
tags: azure-resource-manager
ms.assetid: bdd8b6dc-02fb-4057-bb23-8289caa9de89
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/23/2016
ms.author: anithaa
ms.openlocfilehash: dad415936280b4af916b8c46df46f6c51ac0bca4
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="troubleshoot-routes-using-the-azure-portal"></a><span data-ttu-id="d7a8b-103">Solucionar problemas de rotas usando o Portal do Azure</span><span class="sxs-lookup"><span data-stu-id="d7a8b-103">Troubleshoot routes using the Azure Portal</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="d7a8b-104">Portal do Azure</span><span class="sxs-lookup"><span data-stu-id="d7a8b-104">Azure Portal</span></span>](virtual-network-routes-troubleshoot-portal.md)
> * [<span data-ttu-id="d7a8b-105">PowerShell</span><span class="sxs-lookup"><span data-stu-id="d7a8b-105">PowerShell</span></span>](virtual-network-routes-troubleshoot-powershell.md)
>
>

<span data-ttu-id="d7a8b-106">Se você está tendo problemas de conectividade de rede para ou da sua VM (máquina virtual) do Azure, as rotas podem estar afetando os fluxos de tráfego da sua VM.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-106">If you are experiencing network connectivity issues to or from your Azure Virtual Machine (VM), routes may be impacting your VM traffic flows.</span></span> <span data-ttu-id="d7a8b-107">Este artigo oferece uma visão geral dos recursos de diagnóstico para rotas a fim de ajudar a solucionar outros problemas.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-107">This article provides an overview of diagnostics capabilities for routes to help troubleshoot further.</span></span>

<span data-ttu-id="d7a8b-108">As tabelas de rotas são associadas a sub-redes e estão em vigor em todas as NICs (interfaces de rede) nessa sub-rede.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-108">Route tables are associated with subnets and are effective on all network interfaces (NIC) in that subnet.</span></span> <span data-ttu-id="d7a8b-109">Os seguintes tipos de rotas podem ser aplicados a cada adaptador de rede:</span><span class="sxs-lookup"><span data-stu-id="d7a8b-109">The following types of routes can be applied to each network interface:</span></span>

* <span data-ttu-id="d7a8b-110">**Rotas de sistema:** por padrão, cada sub-rede criada em uma VNet (rede virtual) do Azure tem tabelas de rotas de sistema que possibilitam o tráfego da VNet, o tráfego local por meio de gateways de VPN e o tráfego da Internet.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-110">**System routes:** By default, every subnet created in an Azure Virtual Network (VNet) has system route tables that allow local VNet traffic, on-premises traffic via VPN gateways, and Internet traffic.</span></span> <span data-ttu-id="d7a8b-111">Também existem rotas de sistema para VNets emparelhadas.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-111">System routes also exist for peered VNets.</span></span>
* <span data-ttu-id="d7a8b-112">**Rotas BGP:** propagadas para adaptadores de rede por meio do ExpressRoute ou conexões VPN site a site.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-112">**BGP routes:** Propagated to network interfaces through ExpressRoute or site-to-site VPN connections.</span></span> <span data-ttu-id="d7a8b-113">Saiba mais sobre o roteamento BGP lendo os artigos [BGP com gateways de VPN](../vpn-gateway/vpn-gateway-bgp-overview.md) e de [visão geral do ExpressRoute](../expressroute/expressroute-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="d7a8b-113">Learn more about BGP routing by reading the [BGP with VPN gateways](../vpn-gateway/vpn-gateway-bgp-overview.md) and [ExpressRoute overview](../expressroute/expressroute-introduction.md) articles.</span></span>
* <span data-ttu-id="d7a8b-114">**UDR (Rotas definidas pelo usuário):** se você estiver usando soluções de virtualização de rede ou fazendo o túnel forçado do tráfego para uma rede local por meio de uma VPN site a site, você poderá ter UDRs (rotas definidas pelo usuário) associadas à sua tabela de rotas de sub-rede.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-114">**User-defined routes (UDR):** If you are using network virtual appliances or are forced-tunneling traffic to an on-premises network via a site-to-site VPN, you may have user-defined routes (UDRs) associated with your subnet route table.</span></span> <span data-ttu-id="d7a8b-115">Se você não estiver familiarizado com UDRs, leia o artigo [rotas definidas pelo usuário](virtual-networks-udr-overview.md#user-defined-routes) .</span><span class="sxs-lookup"><span data-stu-id="d7a8b-115">If you're not familiar with UDRs, read the [user-defined routes](virtual-networks-udr-overview.md#user-defined-routes) article.</span></span>

<span data-ttu-id="d7a8b-116">Com as várias rotas que podem ser aplicadas a um adaptador de rede, pode ser difícil determinar quais rotas agregadas estão em vigor.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-116">With the various routes that can be applied to a network interface, it can be difficult to determine which aggregate routes are effective.</span></span> <span data-ttu-id="d7a8b-117">Para ajudar a solucionar problemas de conectividade de rede da VM, você pode exibir todas as rotas em vigor para um adaptador de rede no modelo de implantação do Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-117">To help troubleshoot VM network connectivity, you can view all the effective routes for a network interface in the Azure Resource Manager deployment model.</span></span>

## <a name="using-effective-routes-to-troubleshoot-vm-traffic-flow"></a><span data-ttu-id="d7a8b-118">Usando rotas em vigor para solucionar problemas de fluxo de tráfego da VM</span><span class="sxs-lookup"><span data-stu-id="d7a8b-118">Using Effective Routes to troubleshoot VM traffic flow</span></span>
<span data-ttu-id="d7a8b-119">Este artigo usa o cenário a seguir como um exemplo para ilustrar como solucionar problemas das rotas em vigor de um adaptador de rede:</span><span class="sxs-lookup"><span data-stu-id="d7a8b-119">This article uses the following scenario as an example to illustrate how to troubleshoot the effective routes for a network interface:</span></span>

<span data-ttu-id="d7a8b-120">Uma VM (*VM1*) conectada à VNet (*VNet1*, prefixo: 10.9.0.0/16) falha ao se conectar a uma VM(VM3) em uma VNet recém-emparelhada (*VNet3*, prefixo 10.10.0.0/16).</span><span class="sxs-lookup"><span data-stu-id="d7a8b-120">A VM (*VM1*) connected to the VNet (*VNet1*, prefix: 10.9.0.0/16) fails to connect to a VM(VM3) in a newly peered VNet (*VNet3*, prefix 10.10.0.0/16).</span></span> <span data-ttu-id="d7a8b-121">Não há nenhuma UDR ou rotas BGP aplicadas ao adaptador de rede VM1-NIC1 conectado à VM. Apenas rotas de sistema foram aplicadas.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-121">There are no UDRs or BGP routes applied to VM1-NIC1 network interface connected to the VM, only system routes are applied.</span></span>

<span data-ttu-id="d7a8b-122">Este artigo explica como determinar a causa da falha de conexão, usando a funcionalidade de rotas em vigor no modelo de implantação do Gerenciamento de recursos do Azure.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-122">This article explains how to determine the cause of the connection failure, using effective routes capability in Azure Resource Management deployment model.</span></span>
<span data-ttu-id="d7a8b-123">Embora o exemplo use somente rotas de sistema, as mesmas etapas podem ser usadas para determinar falhas de conexão de entrada e saída em qualquer tipo de porta.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-123">While the example uses only system routes, the same steps can be used to determine inbound and outbound connection failures over any route type.</span></span>

> [!NOTE]
> <span data-ttu-id="d7a8b-124">Se sua VM tiver mais de uma NIC conectada, verifique as rotas em vigor para cada uma das NICs a fim de diagnosticar problemas de conectividade de rede para e de uma VM.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-124">If your VM has more than one NIC attached, check effective routes for each of the NICs to diagnose network connectivity issues to and from a VM.</span></span>
>
>

### <a name="view-effective-routes-for-a-virtual-machine"></a><span data-ttu-id="d7a8b-125">Exibir rotas em vigor para uma máquina virtual</span><span class="sxs-lookup"><span data-stu-id="d7a8b-125">View effective routes for a virtual machine</span></span>
<span data-ttu-id="d7a8b-126">Para ver as rotas agregadas aplicadas a uma VM, siga as etapas a seguir:</span><span class="sxs-lookup"><span data-stu-id="d7a8b-126">To see the aggregate routes that are applied to a VM, complete the following steps:</span></span>

1. <span data-ttu-id="d7a8b-127">Entre no portal do Azure em https://portal.azure.com.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-127">Login to the Azure portal at https://portal.azure.com.</span></span>
2. <span data-ttu-id="d7a8b-128">Clique em **Mais serviços** e em **Máquinas virtuais** na lista exibida.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-128">Click **More services**, then click **Virtual machines** in the list that appears.</span></span>
3. <span data-ttu-id="d7a8b-129">Selecione uma VM para solucionar problemas na lista, e uma folha da VM com opções é exibida.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-129">Select a VM to troubleshoot from the list that appears and a VM blade with options appears.</span></span>
4. <span data-ttu-id="d7a8b-130">Clique em **Diagnosticar e resolver problemas** e selecione um problema comum.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-130">Click **Diagnose & solve problems** and then select a common problem.</span></span> <span data-ttu-id="d7a8b-131">Neste exemplo, **Não é possível me conectar à minha VM do Windows** está selecionado.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-131">For this example, **I can’t connect to my Windows VM** is selected.</span></span>

    ![](./media/virtual-network-routes-troubleshoot-portal/image1.png)
5. <span data-ttu-id="d7a8b-132">As etapas são exibidas embaixo do problema, conforme mostrado na imagem a seguir:</span><span class="sxs-lookup"><span data-stu-id="d7a8b-132">Steps appear under the problem, as shown in the following picture:</span></span>

    ![](./media/virtual-network-routes-troubleshoot-portal/image2.png)

    <span data-ttu-id="d7a8b-133">Clique em *rotas efetivas* na lista de etapas recomendadas.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-133">Click *effective routes* in the list of recommended steps.</span></span>
6. <span data-ttu-id="d7a8b-134">A folha **Rotas em vigor** é exibida, conforme mostrado na imagem a seguir:</span><span class="sxs-lookup"><span data-stu-id="d7a8b-134">The **Effective routes** blade appears, as shown in the following picture:</span></span>

    ![](./media/virtual-network-routes-troubleshoot-portal/image3.png)

    <span data-ttu-id="d7a8b-135">Se sua VM tiver apenas um NIC, ele será selecionado por padrão.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-135">If your VM has only one NIC, it is selected by default.</span></span> <span data-ttu-id="d7a8b-136">Se você tiver mais de um NIC, selecione a NIC para a qual você deseja exibir as rotas em vigor.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-136">If you have more than one NIC, select the NIC for which you want to view the effective routes.</span></span>

   > [!NOTE]
   > <span data-ttu-id="d7a8b-137">Se a VM associada à NIC não estiver em um estado de execução, as rotas em vigor não serão exibidas.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-137">If the VM associated with the NIC is not in a running state, effective routes will not be shown.</span></span> <span data-ttu-id="d7a8b-138">Somente as primeiras 200 rotas em vigor são mostradas no portal.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-138">Only the first 200 effective routes are shown in the portal.</span></span> <span data-ttu-id="d7a8b-139">Para obter a lista completa, clique em **Baixar**.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-139">For the full list, click **Download**.</span></span> <span data-ttu-id="d7a8b-140">Você pode filtrar ainda mais os resultados do arquivo. csv baixado.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-140">You can further filter on the results from the downloaded .csv file.</span></span>
   >
   >

    <span data-ttu-id="d7a8b-141">Observe o seguinte na saída:</span><span class="sxs-lookup"><span data-stu-id="d7a8b-141">Notice the following in the output:</span></span>

   * <span data-ttu-id="d7a8b-142">**Source**: indica o tipo de rota.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-142">**Source**: Indicates the type of route.</span></span> <span data-ttu-id="d7a8b-143">Rotas de sistema são mostradas como *Default*, UDRs são mostradas como *User* e as rotas de gateway (estáticas ou BGP) são mostradas como *VPNGateway*.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-143">System routes are shown as *Default*, UDRs are shown as *User* and gateway routes (static or BGP) are shown as *VPNGateway*.</span></span>
   * <span data-ttu-id="d7a8b-144">**State**: indica o estado da rota em vigor.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-144">**State**: Indicates state of the effective route.</span></span> <span data-ttu-id="d7a8b-145">Os valores possíveis são *Active* ou *Invalid*.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-145">Possible values are *Active* or *Invalid*.</span></span>
   * <span data-ttu-id="d7a8b-146">**AddressPrefixes**: especifica o prefixo do endereço da rota em vigor na notação CIDR.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-146">**AddressPrefixes**: Specifies the address prefix of the effective route in CIDR notation.</span></span>
   * <span data-ttu-id="d7a8b-147">**nextHopType**: indica o próximo salto para a rota determinada.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-147">**nextHopType**: Indicates the next hop for the given route.</span></span> <span data-ttu-id="d7a8b-148">Os valores possíveis são *VirtualAppliance*, *Internet*, *VNetLocal*, *VNetPeering* ou *Null*.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-148">Possible values are *VirtualAppliance*, *Internet*, *VNetLocal*, *VNetPeering*, or *Null*.</span></span> <span data-ttu-id="d7a8b-149">Um valor *Null* para **nextHopType** em uma UDR pode indicar uma rota inválida.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-149">A value of *Null* for **nextHopType** in a UDR may indicate an invalid route.</span></span> <span data-ttu-id="d7a8b-150">Por exemplo, se **nextHopType** for *VirtualAppliance* e a VM da solução de virtualização de rede não estiver em um estado provisionado/de execução.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-150">For example, if **nextHopType** is *VirtualAppliance* and the network virtual appliance VM is not in a provisioned/running state.</span></span> <span data-ttu-id="d7a8b-151">Se **nextHopType** for *VPNGateway* e não houver nenhum gateway provisionado/em execução na VNet fornecida, a rota poderá se tornar inválida.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-151">If **nextHopType** is *VPNGateway* and there is no gateway provisioned/running in the given VNet, the route may become invalid.</span></span>
7. <span data-ttu-id="d7a8b-152">Não há nenhuma rota listada para a *VNet WestUS-VNET3* (prefixo 10.10.0.0/16) da *WestUS-VNet1* (prefixo 10.9.0.0/16) na imagem da etapa anterior.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-152">There is no route listed to the *WestUS-VNET3* VNet (Prefix 10.10.0.0/16) from the *WestUS-VNet1* (Prefix 10.9.0.0/16) in the picture in the previous step.</span></span> <span data-ttu-id="d7a8b-153">Na imagem a seguir, o vínculo de emparelhamento está no estado *Desconectado* :</span><span class="sxs-lookup"><span data-stu-id="d7a8b-153">In the following picture, the peering link is in the *Disconnected* state:</span></span>

    ![](./media/virtual-network-routes-troubleshoot-portal/image4.png)

    <span data-ttu-id="d7a8b-154">O link de bi-direcional para o emparelhamento está dividido, o que explica por que a VM1 não pôde se conectar à VM3 na VNet *WestUS-VNet3* .</span><span class="sxs-lookup"><span data-stu-id="d7a8b-154">The bi-directional link for the peering is broken, which explains why VM1 could not connect to VM3 in the *WestUS-VNet3* VNet.</span></span>
8. <span data-ttu-id="d7a8b-155">A imagem a seguir mostra as rotas depois de estabelecer o link de emparelhamento bidirecional:</span><span class="sxs-lookup"><span data-stu-id="d7a8b-155">The following picture shows the routes after establishing the bi-directional peering link:</span></span>

    ![](./media/virtual-network-routes-troubleshoot-portal/image5.png)

<span data-ttu-id="d7a8b-156">Para ver mais cenários de solução de problemas para avaliação de rotas e túnel forçado, leia a seção [Considerações](virtual-network-routes-troubleshoot-portal.md#considerations) deste artigo.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-156">For more troubleshooting scenarios for forced-tunneling and route evaluation, read the [Considerations](virtual-network-routes-troubleshoot-portal.md#considerations) section of this article.</span></span>

### <a name="view-effective-routes-for-a-network-interface"></a><span data-ttu-id="d7a8b-157">Exibir rotas em vigor para um adaptador de rede</span><span class="sxs-lookup"><span data-stu-id="d7a8b-157">View effective routes for a network interface</span></span>
<span data-ttu-id="d7a8b-158">Se o fluxo do tráfego de rede for afetado para um NIC (adaptador de rede) específico, você poderá ver uma lista completa de rotas em vigor em um NIC diretamente.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-158">If network traffic flow is impacted for a particular network interface (NIC), you can view a full list of effective routes on a NIC directly.</span></span> <span data-ttu-id="d7a8b-159">Para ver as rotas agregadas aplicadas a um NIC, siga as etapas a seguir:</span><span class="sxs-lookup"><span data-stu-id="d7a8b-159">To see the aggregate routes that are applied to a NIC, complete the following steps:</span></span>

1. <span data-ttu-id="d7a8b-160">Entre no portal do Azure em https://portal.azure.com.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-160">Login to the Azure portal at https://portal.azure.com.</span></span>
2. <span data-ttu-id="d7a8b-161">Clique em **Mais serviços** e, em seguida, clique em **Interfaces de rede**</span><span class="sxs-lookup"><span data-stu-id="d7a8b-161">Click **More services**, then click **Network interfaces**</span></span>
3. <span data-ttu-id="d7a8b-162">Procure o nome de um NIC na lista ou selecione-o na lista exibida.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-162">Search the list for the name of a NIC, or select it from the list that appears.</span></span> <span data-ttu-id="d7a8b-163">Neste exemplo, **VM1-NIC1** foi selecionada.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-163">In this example, **VM1-NIC1** is selected.</span></span>
4. <span data-ttu-id="d7a8b-164">Selecione **Rotas em vigor** na folha **Interface de rede**, conforme mostrado na imagem a seguir:</span><span class="sxs-lookup"><span data-stu-id="d7a8b-164">Select **Effective routes** in the **Network interface** blade, as shown in the following picture:</span></span>

       ![](./media/virtual-network-routes-troubleshoot-portal/image6.png)

    <span data-ttu-id="d7a8b-165">O valor padrão para o adaptador de rede selecionado é **Escopo** .</span><span class="sxs-lookup"><span data-stu-id="d7a8b-165">The **Scope** defaults to the network interface selected.</span></span>

      ![](./media/virtual-network-routes-troubleshoot-portal/image7.png)

### <a name="view-effective-routes-for-a-route-table"></a><span data-ttu-id="d7a8b-166">Exibir rotas em vigor para uma tabela de rotas</span><span class="sxs-lookup"><span data-stu-id="d7a8b-166">View effective routes for a route table</span></span>
<span data-ttu-id="d7a8b-167">Ao modificar as UDRs (rotas definidas pelo usuário) em uma tabela de rotas, convém analisar o impacto das rotas sendo adicionadas em uma VM específica.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-167">When modifying user-defined routes (UDRs) in a route table, you may want to review the impact of the routes being added on a particular VM.</span></span> <span data-ttu-id="d7a8b-168">Uma tabela de rotas pode ser associada a qualquer número de sub-redes.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-168">A route table can be associated with any number of subnets.</span></span> <span data-ttu-id="d7a8b-169">Agora você pode exibir todas as rotas em vigor para todas as NICs aos quais uma tabela de rotas determinada é aplicada, sem precisar mudar o contexto da folha de tabelas de rotas determinada.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-169">You can now view all the effective routes for all the NICs that a given route table is applied to, without having to switch context from the given route table blade.</span></span>

<span data-ttu-id="d7a8b-170">Neste exemplo, uma UDR (*UDRoute*) é especificada em uma tabela de rotas (*UDRouteTable*).</span><span class="sxs-lookup"><span data-stu-id="d7a8b-170">For this example, a UDR (*UDRoute*) is specified in a route table (*UDRouteTable*).</span></span> <span data-ttu-id="d7a8b-171">Essa rota envia todo o tráfego de Internet da *Subnet1* na VNet *WestUS-VNet1*, por meio de uma NVA (solução de virtualização de rede), na *Sub-rede 2* da mesma VNet.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-171">This route sends all Internet traffic from *Subnet1* in the *WestUS-VNet1* VNet, through a network virtual appliance (NVA), in *Subnet2* of the same VNet.</span></span> <span data-ttu-id="d7a8b-172">A saída é mostrada na imagem a seguir:</span><span class="sxs-lookup"><span data-stu-id="d7a8b-172">The route is shown in the following picture:</span></span>

![](./media/virtual-network-routes-troubleshoot-portal/image8.png)

<span data-ttu-id="d7a8b-173">Para ver as rotas agregadas para a uma tabela de rotas, conclua as etapas a seguir:</span><span class="sxs-lookup"><span data-stu-id="d7a8b-173">To see the aggregate routes for a route table, complete the following steps:</span></span>

1. <span data-ttu-id="d7a8b-174">Entre no portal do Azure em https://portal.azure.com.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-174">Login to the Azure portal at https://portal.azure.com.</span></span>
2. <span data-ttu-id="d7a8b-175">Clique em **Mais serviços** e, em seguida, clique em **Tabelas de rotas**</span><span class="sxs-lookup"><span data-stu-id="d7a8b-175">Click **More services**, then click **Route tables**</span></span>
3. <span data-ttu-id="d7a8b-176">Pesquise na lista a tabela de rotas para a qual você deseja ver rotas agregadas e selecione-a.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-176">Search the list for the route table you want to see aggregate routes for and select it.</span></span> <span data-ttu-id="d7a8b-177">Neste exemplo, **UDRouteTable** foi selecionado.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-177">In this example, **UDRouteTable** is selected.</span></span> <span data-ttu-id="d7a8b-178">Uma folha da tabela de rotas selecionada é exibida, conforme mostrado na imagem a seguir:</span><span class="sxs-lookup"><span data-stu-id="d7a8b-178">A blade for the selected route table appears, as shown in the following picture:</span></span>

    ![](./media/virtual-network-routes-troubleshoot-portal/image9.png)
4. <span data-ttu-id="d7a8b-179">Selecione **Rotas em vigor** na folha **Tabela de rotas**.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-179">Select **Effective Routes** in the **Route table** blade.</span></span> <span data-ttu-id="d7a8b-180">O **Escopo** é definido como a tabela de rotas selecionada.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-180">The **Scope** is set to the route table you selected.</span></span>
5. <span data-ttu-id="d7a8b-181">Uma tabela de rotas pode ser aplicada a várias sub-redes.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-181">A route table can be applied to multiple subnets.</span></span> <span data-ttu-id="d7a8b-182">Selecione a **Sub-rede** que você deseja examinar na lista.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-182">Select the **Subnet** you want to review from the list.</span></span> <span data-ttu-id="d7a8b-183">Neste exemplo, a **Subnet1** foi selecionada.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-183">In this example, **Subnet1** is selected.</span></span>
6. <span data-ttu-id="d7a8b-184">Selecione um **Adaptador de rede**.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-184">Select a **Network Interface**.</span></span> <span data-ttu-id="d7a8b-185">Todas as NICs conectadas à sub-rede selecionada são listadas.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-185">All NICs connected to the selected subnet are listed.</span></span> <span data-ttu-id="d7a8b-186">Neste exemplo, **VM1-NIC1** foi selecionada.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-186">In this example, **VM1-NIC1** is selected.</span></span>

    ![](./media/virtual-network-routes-troubleshoot-portal/image10.png)

   > [!NOTE]
   > <span data-ttu-id="d7a8b-187">Se a NIC não está associada uma VM em execução, nenhuma rota em vigor é mostrada.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-187">If the NIC is not associated with a running VM, no effective routes are shown.</span></span>
   >
   >

## <a name="considerations"></a><span data-ttu-id="d7a8b-188">Considerações</span><span class="sxs-lookup"><span data-stu-id="d7a8b-188">Considerations</span></span>
<span data-ttu-id="d7a8b-189">Algumas coisas para ter em mente ao examinar a lista de rotas retornadas:</span><span class="sxs-lookup"><span data-stu-id="d7a8b-189">A few things to keep in mind when reviewing the list of routes returned:</span></span>

* <span data-ttu-id="d7a8b-190">O roteamento é baseado no LPM (Correspondência de Prefixo Mais Longo) entre UDRs, rotas BGP e do sistema.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-190">Routing is based on Longest Prefix Match (LPM) among UDRs, BGP and system routes.</span></span> <span data-ttu-id="d7a8b-191">Se houver mais de uma rota com a mesma correspondência LPM, então uma rota será selecionada com base em sua origem na seguinte ordem:</span><span class="sxs-lookup"><span data-stu-id="d7a8b-191">If there is more than one route with the same LPM match, then a route is selected based on its origin in the following order:</span></span>

  * <span data-ttu-id="d7a8b-192">Rota definida pelo usuário</span><span class="sxs-lookup"><span data-stu-id="d7a8b-192">User-defined route</span></span>
  * <span data-ttu-id="d7a8b-193">Rota BGP</span><span class="sxs-lookup"><span data-stu-id="d7a8b-193">BGP route</span></span>
  * <span data-ttu-id="d7a8b-194">Rota do sistema (padrão)</span><span class="sxs-lookup"><span data-stu-id="d7a8b-194">System (Default) route</span></span>

    <span data-ttu-id="d7a8b-195">Com rotas em vigor, você só pode ver as rotas em vigor com correspondência LPM baseada em todas as rotas disponíveis.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-195">With effective routes, you can only see effective routes that are LPM match based on all the availble routes.</span></span> <span data-ttu-id="d7a8b-196">Ao mostrar como as rotas são realmente avaliadas para uma determinada NIC, fica muito mais fácil solucionar problemas de rotas específicas que podem afetar a conectividade para/de sua VM.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-196">By showing how the routes are actually evaluated for a given NIC, this makes it a lot easier to troubleshoot specific routes that may be impacting connectivity to/from your VM.</span></span>
* <span data-ttu-id="d7a8b-197">Se você tiver UDRs e estiver enviando o tráfego para uma NVA (solução de virtualização de rede) com *VirtualAppliance* como **nextHopType**, verifique se o encaminhamento de IP está habilitado na NVA que está recebendo o tráfego ou se os pacotes foram removidos.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-197">If you have UDRs and are sending traffic to a network virtual appliance (NVA), with *VirtualAppliance* as **nextHopType**, ensure that IP forwarding is enabled on the NVA receiving the traffic or packets are dropped.</span></span>
* <span data-ttu-id="d7a8b-198">Se túnel forçado estiver habilitado, todo o tráfego de Internet de saída será roteado para o local.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-198">If Forced tunneling is enabled, all outbound Internet traffic will be routed to on-premises.</span></span> <span data-ttu-id="d7a8b-199">O RDP/SSH da Internet para sua VM pode não funcionar com essa configuração, dependendo de como o local trata esse tráfego.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-199">RDP/SSH from Internet to your VM may not work with this setting, depending on how the on-premises handles this traffic.</span></span>
  <span data-ttu-id="d7a8b-200">O túnel forçado pode ser habilitado:</span><span class="sxs-lookup"><span data-stu-id="d7a8b-200">Forced-tunneling can be enabled:</span></span>
  * <span data-ttu-id="d7a8b-201">Se você estiver usando a VPN site a site, definindo uma UDR (rota definida pelo usuário) com nextHopType como Gateway de VPN</span><span class="sxs-lookup"><span data-stu-id="d7a8b-201">If using site-to-site VPN, by setting a user-defined route (UDR) with nextHopType as VPN Gateway</span></span>
  * <span data-ttu-id="d7a8b-202">Se uma rota padrão é anunciada por meio do BGP</span><span class="sxs-lookup"><span data-stu-id="d7a8b-202">If a default route is advertised over BGP</span></span>
* <span data-ttu-id="d7a8b-203">Para que o tráfego do emparelhamento de VNet funcione corretamente, deve haver uma rota do sistema com **nextHopType** *VNetPeering* para o intervalo de prefixo da VNet emparelhada.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-203">For VNet peering traffic to work correctly, a system route with **nextHopType** *VNetPeering* must exist for the peered VNet’s prefix range.</span></span> <span data-ttu-id="d7a8b-204">Se tal rota não existir e o link de emparelhamento da VNet parecer correto:</span><span class="sxs-lookup"><span data-stu-id="d7a8b-204">If such a route doesn’t exist and the VNet peering link looks OK:</span></span>
  * <span data-ttu-id="d7a8b-205">Aguarde alguns segundos e tente novamente se for um link de emparelhamento recém-estabelecido.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-205">Wait a few seconds and retry if it's a newly established peering link.</span></span> <span data-ttu-id="d7a8b-206">Ela ocasionalmente demora mais para propagar rotas para todos os adaptadores de rede em uma sub-rede.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-206">It occasionally takes longer to propagate routes to all the network interfaces in a subnet.</span></span>
  * <span data-ttu-id="d7a8b-207">As regras do NSG (grupo de segurança de rede) podem afetar os fluxos de tráfego.</span><span class="sxs-lookup"><span data-stu-id="d7a8b-207">Network Security Group (NSG) rules may be impacting the traffic flows.</span></span> <span data-ttu-id="d7a8b-208">Para obter mais informações, consulte o artigo [Solucionar problemas dos grupos de segurança de rede](virtual-network-nsg-troubleshoot-portal.md) .</span><span class="sxs-lookup"><span data-stu-id="d7a8b-208">For more information, see the [Troubleshoot Network Security Groups](virtual-network-nsg-troubleshoot-portal.md) article.</span></span>
