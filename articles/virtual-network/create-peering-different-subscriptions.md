---
title: "Criar um emparelhamento de rede virtual do Azure – Resource Manager – assinaturas diferentes | Microsoft Docs"
description: Saiba como criar um emparelhamento de rede virtual entre redes virtuais criadas por meio do Resource Manager que existem em assinaturas do Azure diferentes.
services: virtual-network
documentationcenter: 
author: jimdial
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 07/17/2017
ms.author: jdial;narayan;annahar
ms.openlocfilehash: 84bbf90257f038fb5f3e964b7b35419acd77fc6d
ms.sourcegitcommit: 422efcbac5b6b68295064bd545132fcc98349d01
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/29/2017
---
# <a name="create-a-virtual-network-peering---resource-manager-different-subscriptions"></a><span data-ttu-id="55983-103">Criar um emparelhamento de rede virtual – Resource Manager, assinaturas diferentes</span><span class="sxs-lookup"><span data-stu-id="55983-103">Create a virtual network peering - Resource Manager, different subscriptions</span></span> 

<span data-ttu-id="55983-104">Neste tutorial, você aprende a criar um emparelhamento de rede virtual entre redes virtuais criadas por meio do Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="55983-104">In this tutorial, you learn to create a virtual network peering between virtual networks created through Resource Manager.</span></span> <span data-ttu-id="55983-105">As redes virtuais existem em assinaturas diferentes.</span><span class="sxs-lookup"><span data-stu-id="55983-105">The virtual networks exist in different subscriptions.</span></span> <span data-ttu-id="55983-106">O emparelhamento de duas redes virtuais permite que recursos em diferentes redes virtuais se comuniquem com a mesma largura de banda e latência, como se os recursos estivessem na mesma rede virtual.</span><span class="sxs-lookup"><span data-stu-id="55983-106">Peering two virtual networks enables resources in different virtual networks to communicate with each other with the same bandwidth and latency as though the resources were in the same virtual network.</span></span> <span data-ttu-id="55983-107">Saiba mais sobre [Emparelhamento de rede virtual](virtual-network-peering-overview.md).</span><span class="sxs-lookup"><span data-stu-id="55983-107">Learn more about [Virtual network peering](virtual-network-peering-overview.md).</span></span> 

<span data-ttu-id="55983-108">As etapas para criar um emparelhamento de rede virtual são diferentes, dependendo de as redes virtuais estarem na mesma ou em diferentes assinaturas e do [modelo de implantação do Azure](../azure-resource-manager/resource-manager-deployment-model.md?toc=%2fazure%2fvirtual-network%2ftoc.json) pelo qual as redes virtuais são criadas.</span><span class="sxs-lookup"><span data-stu-id="55983-108">The steps to create a virtual network peering are different, depending on whether the virtual networks are in the same, or different, subscriptions, and which [Azure deployment model](../azure-resource-manager/resource-manager-deployment-model.md?toc=%2fazure%2fvirtual-network%2ftoc.json) the virtual networks are created through.</span></span> <span data-ttu-id="55983-109">Saiba como criar um emparelhamento de rede virtual em outros cenários clicando no cenário na tabela a seguir:</span><span class="sxs-lookup"><span data-stu-id="55983-109">Learn how to create a virtual network peering in other scenarios by clicking the scenario from the following table:</span></span>

|<span data-ttu-id="55983-110">Modelo de implantação do Azure</span><span class="sxs-lookup"><span data-stu-id="55983-110">Azure deployment model</span></span>  | <span data-ttu-id="55983-111">Assinatura do Azure</span><span class="sxs-lookup"><span data-stu-id="55983-111">Azure subscription</span></span>  |
|--------- |---------|
|[<span data-ttu-id="55983-112">Ambos Resource Manager</span><span class="sxs-lookup"><span data-stu-id="55983-112">Both Resource Manager</span></span>](virtual-network-create-peering.md) |<span data-ttu-id="55983-113">Idêntico</span><span class="sxs-lookup"><span data-stu-id="55983-113">Same</span></span>|
|[<span data-ttu-id="55983-114">Um Resource Manager, um clássico</span><span class="sxs-lookup"><span data-stu-id="55983-114">One Resource Manager, one classic</span></span>](create-peering-different-deployment-models.md) |<span data-ttu-id="55983-115">Idêntico</span><span class="sxs-lookup"><span data-stu-id="55983-115">Same</span></span>|
|[<span data-ttu-id="55983-116">Um Resource Manager, um clássico</span><span class="sxs-lookup"><span data-stu-id="55983-116">One Resource Manager, one classic</span></span>](create-peering-different-deployment-models-subscriptions.md) |<span data-ttu-id="55983-117">Diferente</span><span class="sxs-lookup"><span data-stu-id="55983-117">Different</span></span>|

<span data-ttu-id="55983-118">Não é possível criar um emparelhamento de rede virtual entre duas redes virtuais implantadas por meio do modelo de implantação clássico.</span><span class="sxs-lookup"><span data-stu-id="55983-118">A virtual network peering cannot be created between two virtual networks deployed through the classic deployment model.</span></span> <span data-ttu-id="55983-119">Um emparelhamento de rede virtual só pode ser criado entre duas redes virtuais que existem na mesma região do Azure.</span><span class="sxs-lookup"><span data-stu-id="55983-119">A virtual network peering can only be created between two virtual networks that exist in the same Azure region.</span></span> <span data-ttu-id="55983-120">Ao criar um emparelhamento de rede virtual entre redes virtuais em assinaturas diferentes, as assinaturas devem estar ambas associadas ao mesmo locatário do Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="55983-120">When creating a virtual network peering between virtual networks that exist in different subscriptions, the subscriptions must both be associated to the same Azure Active Directory tenant.</span></span> <span data-ttu-id="55983-121">Se você ainda não tem um locatário do Azure Active Directory, você pode [criar um](../active-directory/develop/active-directory-howto-tenant.md?toc=%2fazure%2fvirtual-network%2ftoc.json#start-from-scratch) rapidamente.</span><span class="sxs-lookup"><span data-stu-id="55983-121">If you don't already have an Azure Active Directory tenant, you can quickly [create one](../active-directory/develop/active-directory-howto-tenant.md?toc=%2fazure%2fvirtual-network%2ftoc.json#start-from-scratch).</span></span> <span data-ttu-id="55983-122">Se você precisar conectar redes virtuais que foram ambas criadas por meio do modelo de implantação clássico, ou que existem em diferentes regiões do Azure, ou ainda que existem em assinaturas associadas a locatários diferentes do Azure Active Directory, você pode usar um [Gateway de VPN](../vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal.md?toc=%2fazure%2fvirtual-network%2ftoc.json) do Azure para conectar as redes virtuais.</span><span class="sxs-lookup"><span data-stu-id="55983-122">If you need to connect virtual networks that were both created through the classic deployment model, or that exist in different Azure regions, or that exist in subscriptions associated to different Azure Active Directory tenants, you can use an Azure [VPN Gateway](../vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal.md?toc=%2fazure%2fvirtual-network%2ftoc.json) to connect the virtual networks.</span></span> 

<span data-ttu-id="55983-123">Você pode usar o [portal do Azure](#portal), a [CLI](#cli) (interface de linha de comando) do Azure ou o [Azure PowerShell](#powershell) para criar um emparelhamento de rede virtual.</span><span class="sxs-lookup"><span data-stu-id="55983-123">You can use the [Azure portal](#portal), the Azure [command-line interface](#cli) (CLI), or Azure [PowerShell](#powershell) to create a virtual network peering.</span></span> <span data-ttu-id="55983-124">Clique em um dos links de ferramentas anteriores para ir diretamente para as etapas para a criação de um emparelhamento de rede virtual usando a ferramenta de sua escolha.</span><span class="sxs-lookup"><span data-stu-id="55983-124">Click any of the previous tool links to go directly to the steps for creating a virtual network peering using your tool of choice.</span></span>

## <span data-ttu-id="55983-125"><a name="portal"></a>Criar emparelhamento – portal do Azure</span><span class="sxs-lookup"><span data-stu-id="55983-125"><a name="portal"></a>Create peering - Azure portal</span></span>

<span data-ttu-id="55983-126">Este tutorial usa contas diferentes para cada assinatura.</span><span class="sxs-lookup"><span data-stu-id="55983-126">This tutorial uses different accounts for each subscription.</span></span> <span data-ttu-id="55983-127">Se você estiver usando uma conta que tenha permissões para ambas as assinaturas, use a mesma conta para todas as etapas, pule as etapas para fazer logoff do portal e ignore as etapas para atribuir permissões de outro usuário para as redes virtuais.</span><span class="sxs-lookup"><span data-stu-id="55983-127">If you're using an account that has permissions to both subscriptions, you can use the same account for all steps, skip the steps for logging out of the portal, and skip the steps for assigning another user permissions to the virtual networks.</span></span>

1. <span data-ttu-id="55983-128">Faça logon no [Portal do Azure](https://portal.azure.com) como UserA.</span><span class="sxs-lookup"><span data-stu-id="55983-128">Log in to the [Azure portal](https://portal.azure.com) as UserA.</span></span> <span data-ttu-id="55983-129">A conta com a qual você faz logon deve ter as permissões necessárias para criar um emparelhamento de rede virtual.</span><span class="sxs-lookup"><span data-stu-id="55983-129">The account you log in with must have the necessary permissions to create a virtual network peering.</span></span> <span data-ttu-id="55983-130">Consulte a seção [Permissões](#permissions) deste artigo para obter detalhes.</span><span class="sxs-lookup"><span data-stu-id="55983-130">See the [Permissions](#permissions) section of this article for details.</span></span>
2. <span data-ttu-id="55983-131">Clique em **+ Novo**, em **Rede** e, em seguida, em **Rede virtual**.</span><span class="sxs-lookup"><span data-stu-id="55983-131">Click **+ New**, click **Networking**, then click **Virtual network**.</span></span>
3. <span data-ttu-id="55983-132">Na folha **Criar rede virtual**, insira ou selecione valores para as seguintes configurações e, depois, clique em **Criar**:</span><span class="sxs-lookup"><span data-stu-id="55983-132">In the **Create virtual network** blade, enter, or select values for the following settings, then click **Create**:</span></span>
    - <span data-ttu-id="55983-133">**Nome**: *myVnetA*</span><span class="sxs-lookup"><span data-stu-id="55983-133">**Name**: *myVnetA*</span></span>
    - <span data-ttu-id="55983-134">**Espaço de endereço**: *10.0.0.0/16*</span><span class="sxs-lookup"><span data-stu-id="55983-134">**Address space**: *10.0.0.0/16*</span></span>
    - <span data-ttu-id="55983-135">**Nome da sub-rede**: *padrão*</span><span class="sxs-lookup"><span data-stu-id="55983-135">**Subnet name**: *default*</span></span>
    - <span data-ttu-id="55983-136">**Intervalo de endereços da sub-rede**: *10.0.0.0/24*</span><span class="sxs-lookup"><span data-stu-id="55983-136">**Subnet address range**: *10.0.0.0/24*</span></span>
    - <span data-ttu-id="55983-137">**Assinatura:** selecione a assinatura A.</span><span class="sxs-lookup"><span data-stu-id="55983-137">**Subscription**: Select subscription A.</span></span>
    - <span data-ttu-id="55983-138">**Grupo de recursos**: selecione **Criar novo** e insira *myResourceGroupA*</span><span class="sxs-lookup"><span data-stu-id="55983-138">**Resource group**: Select **Create new** and enter *myResourceGroupA*</span></span>
    - <span data-ttu-id="55983-139">**Localização**: *Leste dos EUA*</span><span class="sxs-lookup"><span data-stu-id="55983-139">**Location**: *East US*</span></span>
4. <span data-ttu-id="55983-140">Na caixa **Pesquisar recursos** na parte superior do portal, digite *myVnetA*.</span><span class="sxs-lookup"><span data-stu-id="55983-140">In the **Search resources** box at the top of the portal, type *myVnetA*.</span></span> <span data-ttu-id="55983-141">Clique em **myVnetA** quando ele for exibido nos resultados da pesquisa.</span><span class="sxs-lookup"><span data-stu-id="55983-141">Click **myVnetA** when it appears in the search results.</span></span> <span data-ttu-id="55983-142">Uma folha é exibida para a rede virtual **myVnetA**.</span><span class="sxs-lookup"><span data-stu-id="55983-142">A blade appears for the **myVnetA** virtual network.</span></span>
5. <span data-ttu-id="55983-143">Na folha **myVnetA** que é exibida, clique em **Controle de acesso (IAM)** na lista vertical de opções no lado esquerdo da folha.</span><span class="sxs-lookup"><span data-stu-id="55983-143">In the **myVnetA** blade that appears, click **Access control (IAM)** from the vertical list of options on the left side of the blade.</span></span>
6. <span data-ttu-id="55983-144">Na folha **myVnetA – Controle de acesso (IAM)** exibida, clique em **+ Adicionar**.</span><span class="sxs-lookup"><span data-stu-id="55983-144">In the **myVnetA - Access control (IAM)** blade that appears, click **+ Add**.</span></span>
7. <span data-ttu-id="55983-145">Na folha **Adicionar permissões** exibida, selecione **Colaborador de rede** na caixa **Função**.</span><span class="sxs-lookup"><span data-stu-id="55983-145">In the **Add permissions** blade that appears, select **Network contributor** in the **Role** box.</span></span>
8. <span data-ttu-id="55983-146">Na caixa **Selecionar**, selecione um UserB ou digite o endereço de email de UserB para pesquisar por ele.</span><span class="sxs-lookup"><span data-stu-id="55983-146">In the **Select** box, select a UserB, or type UserB's email address to search for it.</span></span> <span data-ttu-id="55983-147">A lista de usuários mostrada é do mesmo locatário do Azure Active Directory da rede virtual para a qual você está configurando o emparelhamento.</span><span class="sxs-lookup"><span data-stu-id="55983-147">The list of users shown is from the same Azure Active Directory tenant as the virtual network you're setting up the peering for.</span></span>
9. <span data-ttu-id="55983-148">Clique em **Salvar**.</span><span class="sxs-lookup"><span data-stu-id="55983-148">Click **Save**.</span></span>
10. <span data-ttu-id="55983-149">Na folha **myVnetA – Controle de acesso (IAM)**, clique em **Propriedades** na lista vertical de opções no lado esquerdo da folha.</span><span class="sxs-lookup"><span data-stu-id="55983-149">In the **myVnetA - Access control (IAM)** blade, click **Properties** from the vertical list of options on the left side of the blade.</span></span> <span data-ttu-id="55983-150">Copie a **ID DE RECURSO**, que é usada em uma etapa posterior.</span><span class="sxs-lookup"><span data-stu-id="55983-150">Copy the **RESOURCE ID**, which is used in a later step.</span></span> <span data-ttu-id="55983-151">A ID de recurso é semelhante ao exemplo a seguir: /subscriptions/<Subscription Id>/resourceGroups/myResourceGroupA/providers/Microsoft.Network/virtualNetworks/myVnetA.</span><span class="sxs-lookup"><span data-stu-id="55983-151">The resource ID is similar to the following example: /subscriptions/<Subscription Id>/resourceGroups/myResourceGroupA/providers/Microsoft.Network/virtualNetworks/myVnetA.</span></span>
11. <span data-ttu-id="55983-152">Faça logoff do portal como UserA e faça logon como UserB.</span><span class="sxs-lookup"><span data-stu-id="55983-152">Log out of the portal as UserA, then log in as UserB.</span></span>
12. <span data-ttu-id="55983-153">Conclua as etapas 2 a 3, inserindo ou selecionando os seguintes valores na etapa 3:</span><span class="sxs-lookup"><span data-stu-id="55983-153">Complete steps 2-3, entering or selecting the following values in step 3:</span></span>

    - <span data-ttu-id="55983-154">**Nome**: *myVnetB*</span><span class="sxs-lookup"><span data-stu-id="55983-154">**Name**: *myVnetB*</span></span>
    - <span data-ttu-id="55983-155">**Espaço de endereço**: *10.1.0.0/16*</span><span class="sxs-lookup"><span data-stu-id="55983-155">**Address space**: *10.1.0.0/16*</span></span>
    - <span data-ttu-id="55983-156">**Nome da sub-rede**: *padrão*</span><span class="sxs-lookup"><span data-stu-id="55983-156">**Subnet name**: *default*</span></span>
    - <span data-ttu-id="55983-157">**Intervalo de endereços da sub-rede**: *10.1.0.0/24*</span><span class="sxs-lookup"><span data-stu-id="55983-157">**Subnet address range**: *10.1.0.0/24*</span></span>
    - <span data-ttu-id="55983-158">**Assinatura:** selecione a assinatura B.</span><span class="sxs-lookup"><span data-stu-id="55983-158">**Subscription**: Select subscription B.</span></span>
    - <span data-ttu-id="55983-159">**Grupo de recursos**: selecione **Criar novo** e insira *myResourceGroupB*</span><span class="sxs-lookup"><span data-stu-id="55983-159">**Resource group**: Select **Create new** and enter *myResourceGroupB*</span></span>
    - <span data-ttu-id="55983-160">**Localização**: *Leste dos EUA*</span><span class="sxs-lookup"><span data-stu-id="55983-160">**Location**: *East US*</span></span>

13. <span data-ttu-id="55983-161">Na caixa **Pesquisar recursos** na parte superior do portal, digite *myVnetB*.</span><span class="sxs-lookup"><span data-stu-id="55983-161">In the **Search resources** box at the top of the portal, type *myVnetB*.</span></span> <span data-ttu-id="55983-162">Clique em **myVnetB** quando ele for exibido nos resultados da pesquisa.</span><span class="sxs-lookup"><span data-stu-id="55983-162">Click **myVnetB** when it appears in the search results.</span></span> <span data-ttu-id="55983-163">Uma folha é exibida para a rede virtual **myVnetB**.</span><span class="sxs-lookup"><span data-stu-id="55983-163">A blade appears for the **myVnetB** virtual network.</span></span>
14. <span data-ttu-id="55983-164">Na folha **myVnetB** exibida, clique em **Propriedades** na lista vertical de opções no lado esquerdo da folha.</span><span class="sxs-lookup"><span data-stu-id="55983-164">In the **myVnetB** blade that appears, click **Properties** from the vertical list of options on the left side of the blade.</span></span> <span data-ttu-id="55983-165">Copie a **ID DE RECURSO**, que é usada em uma etapa posterior.</span><span class="sxs-lookup"><span data-stu-id="55983-165">Copy the **RESOURCE ID**, which is used in a later step.</span></span> <span data-ttu-id="55983-166">A ID de recurso é semelhante ao exemplo a seguir: /subscriptions/<Susbscription ID>/resourceGroups/myResoureGroupB/providers/Microsoft.ClassicNetwork/virtualNetworks/myVnetB.</span><span class="sxs-lookup"><span data-stu-id="55983-166">The resource ID is similar to the following example: /subscriptions/<Susbscription ID>/resourceGroups/myResoureGroupB/providers/Microsoft.ClassicNetwork/virtualNetworks/myVnetB.</span></span>
15. <span data-ttu-id="55983-167">Clique em **Controle de acesso (IAM)** na folha **myVnetB** e conclua as etapas 5 a 10 para myVnetB, inserindo **UserA** na etapa 8.</span><span class="sxs-lookup"><span data-stu-id="55983-167">Click **Access control (IAM)** in the **myVnetB** blade and then complete steps 5-10 for myVnetB, entering **UserA** in step 8.</span></span>
16. <span data-ttu-id="55983-168">Faça logoff do portal como UserB e faça logon como UserA.</span><span class="sxs-lookup"><span data-stu-id="55983-168">Log out of the portal as UserB and log in as UserA.</span></span>
17. <span data-ttu-id="55983-169">Na caixa **Pesquisar recursos** na parte superior do portal, digite *myVnetA*.</span><span class="sxs-lookup"><span data-stu-id="55983-169">In the **Search resources** box at the top of the portal, type *myVnetA*.</span></span> <span data-ttu-id="55983-170">Clique em **myVnetA** quando ele for exibido nos resultados da pesquisa.</span><span class="sxs-lookup"><span data-stu-id="55983-170">Click **myVnetA** when it appears in the search results.</span></span> <span data-ttu-id="55983-171">Uma folha é exibida para a rede virtual **myVnet**.</span><span class="sxs-lookup"><span data-stu-id="55983-171">A blade appears for the **myVnet** virtual network.</span></span>
18. <span data-ttu-id="55983-172">Clique em **myVnetA**.</span><span class="sxs-lookup"><span data-stu-id="55983-172">Click **myVnetA**.</span></span>
19. <span data-ttu-id="55983-173">Na folha **myVnetA** exibida, clique em **Emparelhamentos** na lista vertical de opções no lado esquerdo da folha.</span><span class="sxs-lookup"><span data-stu-id="55983-173">In the **myVnetA** blade that appears, click **Peerings** from the vertical list of options on the left side of the blade.</span></span>
20. <span data-ttu-id="55983-174">Na folha **myVnetA – Emparelhamentos** exibida, clique em **+ Adicionar**</span><span class="sxs-lookup"><span data-stu-id="55983-174">In the **myVnetA - Peerings** blade that appeared, click **+ Add**</span></span>
21. <span data-ttu-id="55983-175">Na folha **Adicionar emparelhamento** exibida, insira ou selecione as seguintes opções e clique em **OK**:</span><span class="sxs-lookup"><span data-stu-id="55983-175">In the **Add peering** blade that appears, enter, or select the following options, then click **OK**:</span></span>
     - <span data-ttu-id="55983-176">**Nome**: *myVnetAToMyVnetB*</span><span class="sxs-lookup"><span data-stu-id="55983-176">**Name**: *myVnetAToMyVnetB*</span></span>
     - <span data-ttu-id="55983-177">**Modelo de implantação de rede virtual**: selecione **Resource Manager**.</span><span class="sxs-lookup"><span data-stu-id="55983-177">**Virtual network deployment model**:  Select **Resource Manager**.</span></span>
     - <span data-ttu-id="55983-178">**Sei minha ID do recurso**: marque essa caixa.</span><span class="sxs-lookup"><span data-stu-id="55983-178">**I know my resource ID**: Check this box.</span></span>
     - <span data-ttu-id="55983-179">**ID do recurso**: insira a ID do recurso da etapa 14.</span><span class="sxs-lookup"><span data-stu-id="55983-179">**Resource ID**: Enter the resource ID from step 14.</span></span>
     - <span data-ttu-id="55983-180">**Permitir acesso à rede virtual:** verifique se a opção **Habilitado** está selecionada.</span><span class="sxs-lookup"><span data-stu-id="55983-180">**Allow virtual network access:** Ensure that **Enabled** is selected.</span></span>
    <span data-ttu-id="55983-181">Nenhuma outra configuração é usada neste tutorial.</span><span class="sxs-lookup"><span data-stu-id="55983-181">No other settings are used in this tutorial.</span></span> <span data-ttu-id="55983-182">Para saber mais sobre todas as configurações de emparelhamento, leia [Gerenciar emparelhamentos de rede virtual](virtual-network-manage-peering.md#create-a-peering).</span><span class="sxs-lookup"><span data-stu-id="55983-182">To learn about all peering settings, read [Manage virtual network peerings](virtual-network-manage-peering.md#create-a-peering).</span></span>
22. <span data-ttu-id="55983-183">Depois de clicar em **OK** na etapa anterior, a folha **Adicionar emparelhamento** será fechada e você verá a folha **myVnetA – Emparelhamentos** novamente.</span><span class="sxs-lookup"><span data-stu-id="55983-183">After clicking **OK** in the previous step, the **Add peering** blade closes and you see the **myVnetA - Peerings** blade again.</span></span> <span data-ttu-id="55983-184">Depois de alguns segundos, o emparelhamento que você criou será exibido na folha.</span><span class="sxs-lookup"><span data-stu-id="55983-184">After a few seconds, the peering you created appears in the blade.</span></span> <span data-ttu-id="55983-185">**Iniciado** é listado na coluna **STATUS DE EMPARELHAMENTO** do emparelhamento de **myVnetAToMyVnetB** criado.</span><span class="sxs-lookup"><span data-stu-id="55983-185">**Initiated** is listed in the **PEERING STATUS** column for the **myVnetAToMyVnetB** peering you created.</span></span> <span data-ttu-id="55983-186">Você já emparelhou myVnetA a myVnetB, mas agora você deve emparelhar myVnetB a myVnetA.</span><span class="sxs-lookup"><span data-stu-id="55983-186">You've peered myVnetA to myVnetB, but now you must peer myVnetB to myVnetA.</span></span> <span data-ttu-id="55983-187">O emparelhamento deve ser criado em ambas as orientações para permitir que os recursos nas redes virtuais se comuniquem entre si.</span><span class="sxs-lookup"><span data-stu-id="55983-187">The peering must be created in both directions to enable resources in the virtual networks to communicate with each other.</span></span>
23. <span data-ttu-id="55983-188">Faça logoff do portal como UserA e faça logon como UserB.</span><span class="sxs-lookup"><span data-stu-id="55983-188">Log out of the portal as UserA and log in as UserB.</span></span>
24. <span data-ttu-id="55983-189">Conclua as etapas 17 a 21 novamente para myVnetB.</span><span class="sxs-lookup"><span data-stu-id="55983-189">Complete steps 17-21 again for myVnetB.</span></span> <span data-ttu-id="55983-190">Na etapa 21, nomeie o emparelhamento *myVnetBToMyVnetA*, selecione *myVnetA* para **Rede virtual** e insira a ID da etapa 10 na caixa **ID de recurso**.</span><span class="sxs-lookup"><span data-stu-id="55983-190">In step 21, name the peering *myVnetBToMyVnetA*, select *myVnetA* for **Virtual network**, and enter the ID from step 10 in the **Resource ID** box.</span></span>
25. <span data-ttu-id="55983-191">Alguns segundos depois de clicar em **OK** para criar o emparelhamento para a myVnetB, o emparelhamento de **myVnetBToMyVnetA** que você acabou de criar será listado com **Conectado** na coluna **STATUS DE EMPARELHAMENTO**.</span><span class="sxs-lookup"><span data-stu-id="55983-191">A few seconds after clicking **OK** to create the peering for myVnetB, the **myVnetBToMyVnetA** peering you just created is listed with **Connected** in the **PEERING STATUS** column.</span></span>
26. <span data-ttu-id="55983-192">Faça logoff do portal como UserB e faça logon como UserA.</span><span class="sxs-lookup"><span data-stu-id="55983-192">Log out of the portal as UserB and log in as UserA.</span></span>
27. <span data-ttu-id="55983-193">Conclua as etapas 17 a 19 novamente.</span><span class="sxs-lookup"><span data-stu-id="55983-193">Complete steps 17-19 again.</span></span> <span data-ttu-id="55983-194">O **STATUS DE EMPARELHAMENTO** do emparelhamento de **myVnetAToVNetB** agora também é **Conectado**.</span><span class="sxs-lookup"><span data-stu-id="55983-194">The **PEERING STATUS** for the **myVnetAToVNetB** peering is now also **Connected**.</span></span> <span data-ttu-id="55983-195">O emparelhamento é estabelecido com êxito após a exibição de **Conectado** na coluna **STATUS DE EMPARELHAMENTO** de ambas as redes virtuais no emparelhamento.</span><span class="sxs-lookup"><span data-stu-id="55983-195">The peering is successfully established after you see **Connected** in the **PEERING STATUS** column for both virtual networks in the peering.</span></span> <span data-ttu-id="55983-196">Todos os recursos do Azure criados na rede virtual agora podem se comunicar entre si por meio de seus endereços IP.</span><span class="sxs-lookup"><span data-stu-id="55983-196">Any Azure resources you create in either virtual network are now able to communicate with each other through their IP addresses.</span></span> <span data-ttu-id="55983-197">Se você estiver usando a resolução de nomes padrão do Azure para as redes virtuais, os recursos nas redes virtuais não poderão resolver nomes entre as redes virtuais.</span><span class="sxs-lookup"><span data-stu-id="55983-197">If you're using default Azure name resolution for the virtual networks, the resources in the virtual networks are not able to resolve names across the virtual networks.</span></span> <span data-ttu-id="55983-198">Se você desejar resolver nomes entre redes virtuais em um emparelhamento, deverá criar seu próprio servidor DNS.</span><span class="sxs-lookup"><span data-stu-id="55983-198">If you want to resolve names across virtual networks in a peering, you must create your own DNS server.</span></span> <span data-ttu-id="55983-199">Saiba como configurar a [Resolução de nomes usando seu próprio servidor DNS](virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server).</span><span class="sxs-lookup"><span data-stu-id="55983-199">Learn how to set up [Name resolution using your own DNS server](virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server).</span></span>
28. <span data-ttu-id="55983-200">**Opcional**: embora a criação de máquinas virtuais não seja abordada neste tutorial, você poderá criar uma máquina virtual em cada rede virtual e conectar-se de uma máquina virtual a outra, para validar a conectividade.</span><span class="sxs-lookup"><span data-stu-id="55983-200">**Optional**: Though creating virtual machines is not covered in this tutorial, you can create a virtual machine in each virtual network and connect from one virtual machine to the other, to validate connectivity.</span></span>
29. <span data-ttu-id="55983-201">**Opcional**: para excluir os recursos criados neste tutorial, conclua as etapas da seção [Excluir recursos](#delete-portal) deste artigo.</span><span class="sxs-lookup"><span data-stu-id="55983-201">**Optional**: To delete the resources that you create in this tutorial, complete the steps in the [Delete resources](#delete-portal) section of this article.</span></span>

## <span data-ttu-id="55983-202"><a name="cli"></a>Criar emparelhamento – CLI do Azure</span><span class="sxs-lookup"><span data-stu-id="55983-202"><a name="cli"></a>Create peering - Azure CLI</span></span>

<span data-ttu-id="55983-203">Este tutorial usa contas diferentes para cada assinatura.</span><span class="sxs-lookup"><span data-stu-id="55983-203">This tutorial uses different accounts for each subscription.</span></span> <span data-ttu-id="55983-204">Se você estiver usando uma conta que tenha permissões para ambas as assinaturas, use a mesma conta para todas as etapas, ignore as etapas para fazer logoff do Azure e remova as linhas de script que criam atribuições de função de usuário.</span><span class="sxs-lookup"><span data-stu-id="55983-204">If you're using an account that has permissions to both subscriptions, you can use the same account for all steps, skip the steps for logging out of Azure, and remove the lines of script that create user role assignments.</span></span> <span data-ttu-id="55983-205">Substitua UserA@azure.com e UserB@azure.com em todos os scripts a seguir com os nomes de usuário que você está usando para UserA e UserB.</span><span class="sxs-lookup"><span data-stu-id="55983-205">Replace UserA@azure.com and UserB@azure.com in all of the following scripts with the usernames you're using for UserA and UserB.</span></span>

<span data-ttu-id="55983-206">O seguinte script:</span><span class="sxs-lookup"><span data-stu-id="55983-206">The following script:</span></span>

- <span data-ttu-id="55983-207">Exige a CLI do Azure versão 2.0.4 ou posterior.</span><span class="sxs-lookup"><span data-stu-id="55983-207">Requires the Azure CLI version 2.0.4 or later.</span></span> <span data-ttu-id="55983-208">Para saber qual é a versão, execute `az --version`.</span><span class="sxs-lookup"><span data-stu-id="55983-208">To find the version, run `az --version`.</span></span> <span data-ttu-id="55983-209">Se você precisar atualizar, confira [Instalar a CLI 2.0 do Azure](/cli/azure/install-azure-cli?toc=%2fazure%2fvirtual-network%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="55983-209">If you need to upgrade, see [Install Azure CLI 2.0](/cli/azure/install-azure-cli?toc=%2fazure%2fvirtual-network%2ftoc.json).</span></span>
- <span data-ttu-id="55983-210">Funciona em um shell do Bash.</span><span class="sxs-lookup"><span data-stu-id="55983-210">Works in a Bash shell.</span></span> <span data-ttu-id="55983-211">Para opções sobre como executar scripts da CLI do Azure no cliente Windows, veja [Execução da CLI do Azure no Windows](../virtual-machines/windows/cli-options.md?toc=%2fazure%2fvirtual-network%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="55983-211">For options on running Azure CLI scripts on Windows client, see [Running the Azure CLI in Windows](../virtual-machines/windows/cli-options.md?toc=%2fazure%2fvirtual-network%2ftoc.json).</span></span> 

<span data-ttu-id="55983-212">Em vez de instalar a CLI e suas dependências, você pode usar o Azure Cloud Shell.</span><span class="sxs-lookup"><span data-stu-id="55983-212">Instead of installing the CLI and its dependencies, you can use the Azure Cloud Shell.</span></span> <span data-ttu-id="55983-213">O Azure Cloud Shell é um shell Bash gratuito que podem ser executado diretamente no portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="55983-213">The Azure Cloud Shell is a free Bash shell that you can run directly within the Azure portal.</span></span> <span data-ttu-id="55983-214">Ele tem a CLI do Azure instalada e configurada para usar com sua conta.</span><span class="sxs-lookup"><span data-stu-id="55983-214">It has the Azure CLI preinstalled and configured to use with your account.</span></span> <span data-ttu-id="55983-215">Clique no botão **Experimente** no script a seguir, o que invoca Cloud Shell com o qual você pode fazer logon em sua conta do Azure.</span><span class="sxs-lookup"><span data-stu-id="55983-215">Click the **Try it** button in the script that follows, which invokes a Cloud Shell that you can log in to your Azure account with.</span></span> 

1. <span data-ttu-id="55983-216">Abra uma sessão da CLI e faça logon no Azure como UserA usando o comando `azure login`.</span><span class="sxs-lookup"><span data-stu-id="55983-216">Open a CLI session and log in to Azure as UserA using the `azure login` command.</span></span> <span data-ttu-id="55983-217">A conta com a qual você faz logon deve ter as permissões necessárias para criar um emparelhamento de rede virtual.</span><span class="sxs-lookup"><span data-stu-id="55983-217">The account you log in with must have the necessary permissions to create a virtual network peering.</span></span> <span data-ttu-id="55983-218">Consulte a seção [Permissões](#permissions) deste artigo para obter detalhes.</span><span class="sxs-lookup"><span data-stu-id="55983-218">See the [Permissions](#permissions) section of this article for details.</span></span>
2. <span data-ttu-id="55983-219">Copie o script a seguir para um editor de texto em seu computador, substitua `<SubscriptionA-Id>` pela ID da SubscriptionA, copie o script modificado, cole-o na sessão da CLI e pressione `Enter`.</span><span class="sxs-lookup"><span data-stu-id="55983-219">Copy the following script to a text editor on your PC, replace `<SubscriptionA-Id>` with the ID of SubscriptionA, then copy the modified script, paste it in your CLI session, and press `Enter`.</span></span> <span data-ttu-id="55983-220">Se você não souber a ID da assinatura, insira o comando 'az account show\`.</span><span class="sxs-lookup"><span data-stu-id="55983-220">If you don't know your subscription Id, enter the 'az account show\` command.</span></span> <span data-ttu-id="55983-221">O valor da **ID** na saída é sua ID da assinatura.</span><span class="sxs-lookup"><span data-stu-id="55983-221">The value for **id** in the output is your subscription Id.</span></span>

    ```azurecli-interactive
    # Create a resource group.
    az group create \
      --name myResourceGroupA \
      --location eastus

    # Create virtual network A.
    az network vnet create \
      --name myVnetA \
      --resource-group myResourceGroupA \
      --location eastus \
      --address-prefix 10.0.0.0/16

    # Assign UserB permissions to virtual network A.
    az role assignment create \
      --assignee UserB@azure.com \
      --role "Network Contributor" \
      --scope /subscriptions/<SubscriptionA-Id>/resourceGroups/myResourceGroupA/providers/Microsoft.Network/VirtualNetworks/myVnetA
    ```
    
     <span data-ttu-id="55983-222">A atribuição de permissão para UserB não é um requisito.</span><span class="sxs-lookup"><span data-stu-id="55983-222">The permission assignment for UserB is not a requirement.</span></span> <span data-ttu-id="55983-223">O emparelhamento pode ser estabelecido mesmo que os usuários façam individualmente as solicitações de emparelhamento para suas respectivas redes virtuais, desde que as solicitações coincidam.</span><span class="sxs-lookup"><span data-stu-id="55983-223">Peering can be established even if users individually raise peering requests for their respective virtual networks, as long as the requests match.</span></span> <span data-ttu-id="55983-224">Adicionar um usuário com privilégios de myVNetB como um colaborador de rede na rede virtual local facilita a configuração.</span><span class="sxs-lookup"><span data-stu-id="55983-224">Adding a privileged user of myVNetB as a network contributor in the local virtual network makes it easier to do the setup.</span></span>
3. <span data-ttu-id="55983-225">Faça logoff do Azure como UserA usando o comando `az logout`, então faça logon no Azure como UserB.</span><span class="sxs-lookup"><span data-stu-id="55983-225">Log out of Azure as UserA using the `az logout` command, then log in to Azure as UserB.</span></span> <span data-ttu-id="55983-226">A conta com a qual você faz logon deve ter as permissões necessárias para criar um emparelhamento de rede virtual.</span><span class="sxs-lookup"><span data-stu-id="55983-226">The account you log in with must have the necessary permissions to create a virtual network peering.</span></span> <span data-ttu-id="55983-227">Consulte a seção [Permissões](#permissions) deste artigo para obter detalhes.</span><span class="sxs-lookup"><span data-stu-id="55983-227">See the [Permissions](#permissions) section of this article for details.</span></span>
4. <span data-ttu-id="55983-228">Crie myVnetB.</span><span class="sxs-lookup"><span data-stu-id="55983-228">Create myVnetB.</span></span> <span data-ttu-id="55983-229">Copie o conteúdo de script na etapa 2 para um editor de texto em seu computador.</span><span class="sxs-lookup"><span data-stu-id="55983-229">Copy the script contents in step 2 to a text editor on your PC.</span></span> <span data-ttu-id="55983-230">Substitua `<SubscriptionA-Id>` pela ID da SubscriptionB.</span><span class="sxs-lookup"><span data-stu-id="55983-230">Replace `<SubscriptionA-Id>` with the ID of SubscriptionB.</span></span> <span data-ttu-id="55983-231">Altere 10.0.0.0/16 para 10.1.0.0/16, altere todos os As para B e todos os Bs para A. Copie o script modificado, cole-o na sua sessão da CLI e pressione `Enter`.</span><span class="sxs-lookup"><span data-stu-id="55983-231">Change 10.0.0.0/16 to 10.1.0.0/16, change all As to B, and all Bs to A. Copy the modified script, paste it in to your CLI session, and press `Enter`.</span></span> 
5. <span data-ttu-id="55983-232">Faça logoff do Azure como UserB e faça logon no Azure como UserA.</span><span class="sxs-lookup"><span data-stu-id="55983-232">Log out of Azure as UserB and log in to Azure as UserA.</span></span>
6. <span data-ttu-id="55983-233">Crie um emparelhamento de rede virtual de myVnetA para myVnetB.</span><span class="sxs-lookup"><span data-stu-id="55983-233">Create a virtual network peering from myVnetA to myVnetB.</span></span> <span data-ttu-id="55983-234">Copie o conteúdo de script a seguir em um editor de texto em seu computador.</span><span class="sxs-lookup"><span data-stu-id="55983-234">Copy the following script contents to a text editor on your PC.</span></span> <span data-ttu-id="55983-235">Substitua `<SubscriptionB-Id>` pela ID da SubscriptionB.</span><span class="sxs-lookup"><span data-stu-id="55983-235">Replace `<SubscriptionB-Id>` with the ID of SubscriptionB.</span></span> <span data-ttu-id="55983-236">Para executar o script, copie o script modificado, cole-o na sessão da CLI e pressione Enter.</span><span class="sxs-lookup"><span data-stu-id="55983-236">To execute the script, copy the modified script, paste it into your CLI session, and press Enter.</span></span>
 
    ```azurecli-interactive
        # Get the id for myVnetA.
        vnetAId=$(az network vnet show \
          --resource-group myResourceGroupA \
          --name myVnetA \
          --query id --out tsv)
    
        # Peer myVNetA to myVNetB.
        az network vnet peering create \
          --name myVnetAToMyVnetB \
          --resource-group myResourceGroupA \
          --vnet-name myVnetA \
          --remote-vnet-id /subscriptions/<SubscriptionB-Id>/resourceGroups/myResourceGroupB/providers/Microsoft.Network/VirtualNetworks/myVnetB \
          --allow-vnet-access
    ```

7. <span data-ttu-id="55983-237">Exiba o estado de emparelhamento de myVnetA.</span><span class="sxs-lookup"><span data-stu-id="55983-237">View the peering state of myVnetA.</span></span>

    ```azurecli-interactive
    az network vnet peering list \
      --resource-group myResourceGroupA \
      --vnet-name myVnetA \
      --output table
    ```

    <span data-ttu-id="55983-238">O estado é **Iniciado**.</span><span class="sxs-lookup"><span data-stu-id="55983-238">The state is **Initiated**.</span></span> <span data-ttu-id="55983-239">Ele é alterado para **Conectado** depois que você cria o emparelhamento de myVnetB para myVnetA.</span><span class="sxs-lookup"><span data-stu-id="55983-239">It changes to **Connected** once you create the peering to myVnetA from myVnetB.</span></span>

8. <span data-ttu-id="55983-240">Faça logoff do Azure como UserA e faça logon no Azure como UserB.</span><span class="sxs-lookup"><span data-stu-id="55983-240">Log out UserA from Azure and log in to Azure as UserB.</span></span>
9. <span data-ttu-id="55983-241">Crie o emparelhamento de myVnetB para myVnetA.</span><span class="sxs-lookup"><span data-stu-id="55983-241">Create the peering from myVnetB to myVnetA.</span></span> <span data-ttu-id="55983-242">Copie o conteúdo de script na etapa 6 para um editor de texto em seu computador.</span><span class="sxs-lookup"><span data-stu-id="55983-242">Copy the script contents in step 6 to a text editor on your PC.</span></span> <span data-ttu-id="55983-243">Substitua `<SubscriptionB-Id>` pela ID de SubscriptionA e altere todos os As para B e todos os Bs para A. Depois de fazer as alterações, copie o script modificado, cole-o em sua sessão da CLI e pressione `Enter`.</span><span class="sxs-lookup"><span data-stu-id="55983-243">Replace `<SubscriptionB-Id>` with the ID for SubscriptionA and change all As to B and all Bs to A. Once you've made the changes, copy the modified script, paste it into your CLI session, and press `Enter`.</span></span>
10. <span data-ttu-id="55983-244">Exiba o estado de emparelhamento de myVnetB.</span><span class="sxs-lookup"><span data-stu-id="55983-244">View the peering state of myVnetB.</span></span> <span data-ttu-id="55983-245">Copie o conteúdo de script na etapa 7 para um editor de texto em seu computador.</span><span class="sxs-lookup"><span data-stu-id="55983-245">Copy the script contents in step 7 to a text editor on your PC.</span></span> <span data-ttu-id="55983-246">Altere A para B para o grupo de recursos e nomes de rede virtual, copie o script, cole o script modificado em sua sessão da CLI e pressione `Enter`.</span><span class="sxs-lookup"><span data-stu-id="55983-246">Change A to B for the resource group and virtual network names, copy the script, paste the modified script in to your CLI session, and then press `Enter`.</span></span> <span data-ttu-id="55983-247">O estado de emparelhamento é **Conectado**.</span><span class="sxs-lookup"><span data-stu-id="55983-247">The peering state is **Connected**.</span></span> <span data-ttu-id="55983-248">O estado de emparelhamento de myVnetA se altera para **Conectado** depois de você criar o emparelhamento de myVnetB para myVnetA.</span><span class="sxs-lookup"><span data-stu-id="55983-248">The peering state of myVnetA changes to **Connected** after you've created the peering from myVnetB to myVnetA.</span></span> <span data-ttu-id="55983-249">Você pode fazer um novo logon como UserA no Azure e completar a etapa 7 novamente para verificar o estado de emparelhamento de myVnetA.</span><span class="sxs-lookup"><span data-stu-id="55983-249">You can log UserA back in to Azure and complete step 7 again to verify the peering state of myVnetA.</span></span> 

    > [!NOTE]
    > <span data-ttu-id="55983-250">O emparelhamento não é estabelecido até que o estado de emparelhamento para ambas as redes virtuais seja **Conectado**.</span><span class="sxs-lookup"><span data-stu-id="55983-250">The peering is not established until the peering state is **Connected** for both virtual networks.</span></span>

11. <span data-ttu-id="55983-251">**Opcional**: embora a criação de máquinas virtuais não seja abordada neste tutorial, você poderá criar uma máquina virtual em cada rede virtual e conectar-se de uma máquina virtual a outra, para validar a conectividade.</span><span class="sxs-lookup"><span data-stu-id="55983-251">**Optional**: Though creating virtual machines is not covered in this tutorial, you can create a virtual machine in each virtual network and connect from one virtual machine to the other, to validate connectivity.</span></span>
12. <span data-ttu-id="55983-252">**Opcional**: para excluir os recursos criados neste tutorial, conclua as etapas em [Excluir recursos](#delete-cli) deste artigo.</span><span class="sxs-lookup"><span data-stu-id="55983-252">**Optional**: To delete the resources that you create in this tutorial, complete the steps in [Delete resources](#delete-cli) in this article.</span></span>

<span data-ttu-id="55983-253">Todos os recursos do Azure criados na rede virtual agora podem se comunicar entre si por meio de seus endereços IP.</span><span class="sxs-lookup"><span data-stu-id="55983-253">Any Azure resources you create in either virtual network are now able to communicate with each other through their IP addresses.</span></span> <span data-ttu-id="55983-254">Se você estiver usando a resolução de nomes padrão do Azure para as redes virtuais, os recursos nas redes virtuais não poderão resolver nomes entre as redes virtuais.</span><span class="sxs-lookup"><span data-stu-id="55983-254">If you're using default Azure name resolution for the virtual networks, the resources in the virtual networks are not able to resolve names across the virtual networks.</span></span> <span data-ttu-id="55983-255">Se você desejar resolver nomes entre redes virtuais em um emparelhamento, deverá criar seu próprio servidor DNS.</span><span class="sxs-lookup"><span data-stu-id="55983-255">If you want to resolve names across virtual networks in a peering, you must create your own DNS server.</span></span> <span data-ttu-id="55983-256">Saiba como configurar a [Resolução de nomes usando seu próprio servidor DNS](virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server).</span><span class="sxs-lookup"><span data-stu-id="55983-256">Learn how to set up [Name resolution using your own DNS server](virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server).</span></span>
 
## <span data-ttu-id="55983-257"><a name="powershell"></a>Criar emparelhamento – PowerShell</span><span class="sxs-lookup"><span data-stu-id="55983-257"><a name="powershell"></a>Create peering - PowerShell</span></span>

<span data-ttu-id="55983-258">Este tutorial usa contas diferentes para cada assinatura.</span><span class="sxs-lookup"><span data-stu-id="55983-258">This tutorial uses different accounts for each subscription.</span></span> <span data-ttu-id="55983-259">Se você estiver usando uma conta que tenha permissões para ambas as assinaturas, use a mesma conta para todas as etapas, ignore as etapas para fazer logoff do Azure e remova as linhas de script que criam atribuições de função de usuário.</span><span class="sxs-lookup"><span data-stu-id="55983-259">If you're using an account that has permissions to both subscriptions, you can use the same account for all steps, skip the steps for logging out of Azure, and remove the lines of script that create user role assignments.</span></span> <span data-ttu-id="55983-260">Substitua UserA@azure.com e UserB@azure.com em todos os scripts a seguir com os nomes de usuário que você está usando para UserA e UserB.</span><span class="sxs-lookup"><span data-stu-id="55983-260">Replace UserA@azure.com and UserB@azure.com in all of the following scripts with the usernames you're using for UserA and UserB.</span></span>

1. <span data-ttu-id="55983-261">Instale a última versão do módulo [AzureRm](https://www.powershellgallery.com/packages/AzureRM/) do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="55983-261">Install the latest version of the PowerShell [AzureRm](https://www.powershellgallery.com/packages/AzureRM/) module.</span></span> <span data-ttu-id="55983-262">Se você for novo no Azure PowerShell, consulte [Visão geral do Azure PowerShell](/powershell/azure/overview?toc=%2fazure%2fvirtual-network%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="55983-262">If you're new to Azure PowerShell, see [Azure PowerShell overview](/powershell/azure/overview?toc=%2fazure%2fvirtual-network%2ftoc.json).</span></span>
2. <span data-ttu-id="55983-263">Inicie uma sessão do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="55983-263">Start a PowerShell session.</span></span>
3. <span data-ttu-id="55983-264">No PowerShell, faça logon no Azure como UserA inserindo o comando `login-azurermaccount`.</span><span class="sxs-lookup"><span data-stu-id="55983-264">In PowerShell, log in to Azure as UserA by entering the `login-azurermaccount` command.</span></span> <span data-ttu-id="55983-265">A conta com a qual você faz logon deve ter as permissões necessárias para criar um emparelhamento de rede virtual.</span><span class="sxs-lookup"><span data-stu-id="55983-265">The account you log in with must have the necessary permissions to create a virtual network peering.</span></span> <span data-ttu-id="55983-266">Consulte a seção [Permissões](#permissions) deste artigo para obter detalhes.</span><span class="sxs-lookup"><span data-stu-id="55983-266">See the [Permissions](#permissions) section of this article for details.</span></span>
4. <span data-ttu-id="55983-267">Crie um grupo de recursos e uma rede virtual A. Copie o script a seguir em um editor de texto em seu computador.</span><span class="sxs-lookup"><span data-stu-id="55983-267">Create a resource group and virtual network A. Copy the following script to a text editor on your PC.</span></span> <span data-ttu-id="55983-268">Substitua `<SubscriptionA-Id>` pela ID da SubscriptionA.</span><span class="sxs-lookup"><span data-stu-id="55983-268">Replace `<SubscriptionA-Id>` with the ID of SubscriptionA.</span></span> <span data-ttu-id="55983-269">Se você não souber a ID da assinatura, insira o comando `Get-AzureRmSubscription` para exibi-la.</span><span class="sxs-lookup"><span data-stu-id="55983-269">If you don't know your subscription Id, enter the `Get-AzureRmSubscription` command to view it.</span></span> <span data-ttu-id="55983-270">O valor da **ID** na saída retornada é sua ID da assinatura.</span><span class="sxs-lookup"><span data-stu-id="55983-270">The value for **Id** in the returned output is your subscription ID.</span></span> <span data-ttu-id="55983-271">Para executar o script, copie o script modificado, cole-o no PowerShell e pressione `Enter`.</span><span class="sxs-lookup"><span data-stu-id="55983-271">To execute the script, copy the modified script, paste it in to PowerShell, and then press `Enter`.</span></span>

    ```powershell
    # Create a resource group.
    New-AzureRmResourceGroup `
      -Name MyResourceGroupA `
      -Location eastus

    # Create virtual network A.
    $vNetA = New-AzureRmVirtualNetwork `
      -ResourceGroupName MyResourceGroupA `
      -Name 'myVnetA' `
      -AddressPrefix '10.0.0.0/16' `
      -Location eastus

    # Assign UserB permissions to myVnetA.
    New-AzureRmRoleAssignment `
      -SignInName UserB@azure.com `
      -RoleDefinitionName "Network Contributor" `
      -Scope /subscriptions/<SubscriptionA-Id>/resourceGroups/myResourceGroupA/providers/Microsoft.Network/VirtualNetworks/myVnetA
    ```

    <span data-ttu-id="55983-272">A atribuição de permissão para UserB não é um requisito.</span><span class="sxs-lookup"><span data-stu-id="55983-272">The permission assignment for UserB is not a requirement.</span></span> <span data-ttu-id="55983-273">O emparelhamento pode ser estabelecido mesmo que os usuários façam individualmente as solicitações de emparelhamento para suas respectivas redes virtuais, desde que as solicitações coincidam.</span><span class="sxs-lookup"><span data-stu-id="55983-273">Peering can be established even if users individually raise peering requests for their respective virtual networks, as long as the requests match.</span></span> <span data-ttu-id="55983-274">Adicionar um usuário com privilégios de outra rede virtual como um usuário na rede virtual local facilita a configuração.</span><span class="sxs-lookup"><span data-stu-id="55983-274">Adding a privileged user of the other virtual network as a user in the local virtual network makes it easier to do the setup.</span></span>
5. <span data-ttu-id="55983-275">Faça logoff do Azure como UserA e faça logon como UserB.</span><span class="sxs-lookup"><span data-stu-id="55983-275">Log out UserA from Azure and log in UserB.</span></span> <span data-ttu-id="55983-276">A conta com a qual você faz logon deve ter as permissões necessárias para criar um emparelhamento de rede virtual.</span><span class="sxs-lookup"><span data-stu-id="55983-276">The account you log in with must have the necessary permissions to create a virtual network peering.</span></span> <span data-ttu-id="55983-277">Consulte a seção [Permissões](#permissions) deste artigo para obter detalhes.</span><span class="sxs-lookup"><span data-stu-id="55983-277">See the [Permissions](#permissions) section of this article for details.</span></span>
6. <span data-ttu-id="55983-278">Copie o conteúdo de script na etapa 4 para um editor de texto em seu computador.</span><span class="sxs-lookup"><span data-stu-id="55983-278">Copy the script contents in step 4 to a text editor on your PC.</span></span> <span data-ttu-id="55983-279">Substitua `<SubscriptionA-Id>` pela ID da assinatura B. Altere 10.0.0.0/16 para 10.1.0.0/16.</span><span class="sxs-lookup"><span data-stu-id="55983-279">Replace `<SubscriptionA-Id>` with the ID for subscription B. Change 10.0.0.0/16 to 10.1.0.0/16.</span></span> <span data-ttu-id="55983-280">Altere todos os As para B e todos os Bs para A. Para executar o script, copie o script modificado, cole-o no PowerShell e pressione `Enter`.</span><span class="sxs-lookup"><span data-stu-id="55983-280">Change all As to B and all Bs to A. To execute the script, copy the modified script, paste into PowerShell, and then press `Enter`.</span></span>
7. <span data-ttu-id="55983-281">Faça logoff do Azure como UserB e faça logon como UserA.</span><span class="sxs-lookup"><span data-stu-id="55983-281">Log out UserB from Azure and log in UserA.</span></span>
8. <span data-ttu-id="55983-282">Crie o emparelhamento de myVnetA para myVnetB.</span><span class="sxs-lookup"><span data-stu-id="55983-282">Create the peering from myVnetA to myVnetB.</span></span> <span data-ttu-id="55983-283">Copie o script a seguir em um editor de texto em seu computador.</span><span class="sxs-lookup"><span data-stu-id="55983-283">Copy the following script to a text editor on your PC.</span></span> <span data-ttu-id="55983-284">Substitua `<SubscriptionB-Id>` pela ID da assinatura B. Para executar o script, copie o script modificado, cole-o no PowerShell e pressione `Enter`.</span><span class="sxs-lookup"><span data-stu-id="55983-284">Replace `<SubscriptionB-Id>` with the ID of subscription B. To execute the script, copy the modified script, paste in to PowerShell, and then press `Enter`.</span></span>
 
    ```powershell
    # Peer myVnetA to myVnetB.
    $vNetA=Get-AzureRmVirtualNetwork -Name myVnetA -ResourceGroupName myResourceGroupA
    Add-AzureRmVirtualNetworkPeering `
      -Name 'myVnetAToMyVnetB' `
      -VirtualNetwork $vNetA `
      -RemoteVirtualNetworkId "/subscriptions/<SubscriptionB-Id>/resourceGroups/myResourceGroupB/providers/Microsoft.Network/virtualNetworks/myVnetB"
    ```

9. <span data-ttu-id="55983-285">Exiba o estado de emparelhamento de myVnetA.</span><span class="sxs-lookup"><span data-stu-id="55983-285">View the peering state of myVnetA.</span></span>

    ```powershell
    Get-AzureRmVirtualNetworkPeering `
      -ResourceGroupName myResourceGroupA `
      -VirtualNetworkName myVnetA `
      | Format-Table VirtualNetworkName, PeeringState
    ```

    <span data-ttu-id="55983-286">O estado é **Iniciado**.</span><span class="sxs-lookup"><span data-stu-id="55983-286">The state is **Initiated**.</span></span> <span data-ttu-id="55983-287">Ele é alterado para **Conectado** depois de configurar o emparelhamento de myVnetB para myVnetA.</span><span class="sxs-lookup"><span data-stu-id="55983-287">It changes to **Connected** once you setup the peering to myVnetA from myVnetB.</span></span>

10. <span data-ttu-id="55983-288">Faça logoff do Azure como UserA e faça logon como UserB.</span><span class="sxs-lookup"><span data-stu-id="55983-288">Log out UserA from Azure and log in UserB.</span></span>
11. <span data-ttu-id="55983-289">Crie o emparelhamento de myVnetB para myVnetA.</span><span class="sxs-lookup"><span data-stu-id="55983-289">Create the peering from myVnetB to myVnetA.</span></span> <span data-ttu-id="55983-290">Copie o conteúdo de script na etapa 8 para um editor de texto em seu computador.</span><span class="sxs-lookup"><span data-stu-id="55983-290">Copy the script contents in step 8 to a text editor on your PC.</span></span> <span data-ttu-id="55983-291">Substitua `<SubscriptionB-Id>` pela ID da assinatura A e altere todos os As para B e todos os Bs para A. Para executar o script, copie o script modificado, cole-o no PowerShell e pressione `Enter`.</span><span class="sxs-lookup"><span data-stu-id="55983-291">Replace `<SubscriptionB-Id>` with the ID of subscription A and change all A's to B and all B's to A. To execute the script, copy the modified script, paste it in to PowerShell, and then press `Enter`.</span></span>
12. <span data-ttu-id="55983-292">Exiba o estado de emparelhamento de myVnetB.</span><span class="sxs-lookup"><span data-stu-id="55983-292">View the peering state of myVnetB.</span></span> <span data-ttu-id="55983-293">Copie o conteúdo de script na etapa 9 para um editor de texto em seu computador.</span><span class="sxs-lookup"><span data-stu-id="55983-293">Copy the script contents in step 9 to a text editor on your PC.</span></span> <span data-ttu-id="55983-294">Alterar A para B para o grupo de recursos e nomes de rede virtual.</span><span class="sxs-lookup"><span data-stu-id="55983-294">Change A to B for the resource group and virtual network names.</span></span> <span data-ttu-id="55983-295">Para executar o script, cole o script modificado no PowerShell e pressione `Enter`.</span><span class="sxs-lookup"><span data-stu-id="55983-295">To execute the script, paste the modified script into PowerShell, and then press `Enter`.</span></span> <span data-ttu-id="55983-296">O estado é **Conectado**.</span><span class="sxs-lookup"><span data-stu-id="55983-296">The state is **Connected**.</span></span> <span data-ttu-id="55983-297">O estado de emparelhamento de **myVnetA** se altera para **Conectado** depois de você criar o emparelhamento de **myVnetB** para **myVnetA**.</span><span class="sxs-lookup"><span data-stu-id="55983-297">The peering state of **myVnetA** changes to **Connected** after you've created the peering from **myVnetB** to **myVnetA**.</span></span> <span data-ttu-id="55983-298">Você pode fazer um novo logon como UserA no Azure e completar a etapa 9 novamente para verificar o estado de emparelhamento de myVnetA.</span><span class="sxs-lookup"><span data-stu-id="55983-298">You can log UserA back in to Azure and complete step 9 again to verify the peering state of myVnetA.</span></span> 

    > [!NOTE]
    > <span data-ttu-id="55983-299">O emparelhamento não é estabelecido até que o estado de emparelhamento para ambas as redes virtuais seja **Conectado**.</span><span class="sxs-lookup"><span data-stu-id="55983-299">The peering is not established until the peering state is **Connected** for both virtual networks.</span></span>

    <span data-ttu-id="55983-300">Todos os recursos do Azure criados na rede virtual agora podem se comunicar entre si por meio de seus endereços IP.</span><span class="sxs-lookup"><span data-stu-id="55983-300">Any Azure resources you create in either virtual network are now able to communicate with each other through their IP addresses.</span></span> <span data-ttu-id="55983-301">Se você estiver usando a resolução de nomes padrão do Azure para as redes virtuais, os recursos nas redes virtuais não poderão resolver nomes entre as redes virtuais.</span><span class="sxs-lookup"><span data-stu-id="55983-301">If you're using default Azure name resolution for the virtual networks, the resources in the virtual networks are not able to resolve names across the virtual networks.</span></span> <span data-ttu-id="55983-302">Se você desejar resolver nomes entre redes virtuais em um emparelhamento, deverá criar seu próprio servidor DNS.</span><span class="sxs-lookup"><span data-stu-id="55983-302">If you want to resolve names across virtual networks in a peering, you must create your own DNS server.</span></span> <span data-ttu-id="55983-303">Saiba como configurar a [Resolução de nomes usando seu próprio servidor DNS](virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server).</span><span class="sxs-lookup"><span data-stu-id="55983-303">Learn how to set up [Name resolution using your own DNS server](virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server).</span></span>

13. <span data-ttu-id="55983-304">**Opcional**: embora a criação de máquinas virtuais não seja abordada neste tutorial, você poderá criar uma máquina virtual em cada rede virtual e conectar-se de uma máquina virtual a outra, para validar a conectividade.</span><span class="sxs-lookup"><span data-stu-id="55983-304">**Optional**: Though creating virtual machines is not covered in this tutorial, you can create a virtual machine in each virtual network and connect from one virtual machine to the other, to validate connectivity.</span></span>
14. <span data-ttu-id="55983-305">**Opcional**: Para excluir os recursos criados neste tutorial, conclua as etapas em [Excluir recursos](#delete-powershell) deste artigo.</span><span class="sxs-lookup"><span data-stu-id="55983-305">**Optional**: To delete the resources that you create in this tutorial, complete the steps in [Delete resources](#delete-powershell) in this article.</span></span>

## <span data-ttu-id="55983-306"><a name="permissions"></a>Permissões</span><span class="sxs-lookup"><span data-stu-id="55983-306"><a name="permissions"></a>Permissions</span></span>

<span data-ttu-id="55983-307">As contas usadas para criar um emparelhamento de rede virtual devem ter a função ou as permissões necessárias.</span><span class="sxs-lookup"><span data-stu-id="55983-307">The accounts you use to create a virtual network peering must have the necessary role or permissions.</span></span> <span data-ttu-id="55983-308">Por exemplo, se você pretende emparelhar duas redes virtuais, chamadas **myVnetA** e **myVnetB**, sua conta deve ser atribuída à seguinte função ou permissões mínimas para cada rede virtual:</span><span class="sxs-lookup"><span data-stu-id="55983-308">For example, if you were peering two virtual networks named **myVnetA** and **myVnetB**, your account must be assigned the following minimum role or permissions for each virtual network:</span></span>
    
|<span data-ttu-id="55983-309">Rede virtual</span><span class="sxs-lookup"><span data-stu-id="55983-309">Virtual network</span></span>|<span data-ttu-id="55983-310">Função</span><span class="sxs-lookup"><span data-stu-id="55983-310">Role</span></span>|<span data-ttu-id="55983-311">Permissões</span><span class="sxs-lookup"><span data-stu-id="55983-311">Permissions</span></span>|
|---|---|---|
|<span data-ttu-id="55983-312">myVnetA</span><span class="sxs-lookup"><span data-stu-id="55983-312">myVnetA</span></span>|[<span data-ttu-id="55983-313">Colaborador de rede</span><span class="sxs-lookup"><span data-stu-id="55983-313">Network Contributor</span></span>](../active-directory/role-based-access-built-in-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json#network-contributor)|<span data-ttu-id="55983-314">Microsoft.Network/virtualNetworks/virtualNetworkPeerings/write</span><span class="sxs-lookup"><span data-stu-id="55983-314">Microsoft.Network/virtualNetworks/virtualNetworkPeerings/write</span></span>|
|<span data-ttu-id="55983-315">myVnetB</span><span class="sxs-lookup"><span data-stu-id="55983-315">myVnetB</span></span>|[<span data-ttu-id="55983-316">Colaborador de rede</span><span class="sxs-lookup"><span data-stu-id="55983-316">Network Contributor</span></span>](../active-directory/role-based-access-built-in-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json#network-contributor)|<span data-ttu-id="55983-317">Microsoft.Network/virtualNetworks/peer</span><span class="sxs-lookup"><span data-stu-id="55983-317">Microsoft.Network/virtualNetworks/peer</span></span>|

<span data-ttu-id="55983-318">Saiba mais sobre [funções internas](../active-directory/role-based-access-built-in-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json#network-contributor) e como atribuir permissões específicas a [funções personalizadas](../active-directory/role-based-access-control-custom-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json) (somente para o Resource Manager).</span><span class="sxs-lookup"><span data-stu-id="55983-318">Learn more about [built-in roles](../active-directory/role-based-access-built-in-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json#network-contributor) and assigning specific permissions to [custom roles](../active-directory/role-based-access-control-custom-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json) (Resource Manager only).</span></span>

## <span data-ttu-id="55983-319"><a name="delete"></a>Excluir recursos</span><span class="sxs-lookup"><span data-stu-id="55983-319"><a name="delete"></a>Delete resources</span></span>
<span data-ttu-id="55983-320">Ao concluir este tutorial, talvez você deseje excluir os recursos criados no tutorial para não incorrer em encargos de uso.</span><span class="sxs-lookup"><span data-stu-id="55983-320">When you've finished this tutorial, you might want to delete the resources you created in the tutorial, so you don't incur usage charges.</span></span> <span data-ttu-id="55983-321">A exclusão de um grupo de recursos também exclui todos os recursos que estão no grupo de recursos.</span><span class="sxs-lookup"><span data-stu-id="55983-321">Deleting a resource group also deletes all resources that are in the resource group.</span></span>

### <span data-ttu-id="55983-322"><a name="delete-portal"></a>Portal do Azure</span><span class="sxs-lookup"><span data-stu-id="55983-322"><a name="delete-portal"></a>Azure portal</span></span>

1. <span data-ttu-id="55983-323">Faça logon no Portal do Azure como UserA.</span><span class="sxs-lookup"><span data-stu-id="55983-323">Log in to the Azure portal as UserA.</span></span>
2. <span data-ttu-id="55983-324">Na caixa de pesquisa do portal, insira **myResourceGroupA**.</span><span class="sxs-lookup"><span data-stu-id="55983-324">In the portal search box, enter **myResourceGroupA**.</span></span> <span data-ttu-id="55983-325">Nos resultados da pesquisa, clique em **myResourceGroupA**.</span><span class="sxs-lookup"><span data-stu-id="55983-325">In the search results, click **myResourceGroupA**.</span></span>
3. <span data-ttu-id="55983-326">Na folha **myResourceGroupA**, clique no ícone **Excluir**.</span><span class="sxs-lookup"><span data-stu-id="55983-326">On the **myResourceGroupA** blade, click the **Delete** icon.</span></span>
4. <span data-ttu-id="55983-327">Para confirmar a exclusão, na caixa **DIGITAR O NOME DO GRUPO DE RECURSOS**, insira **myResourceGroupA** e, depois, clique em **Excluir**.</span><span class="sxs-lookup"><span data-stu-id="55983-327">To confirm the deletion, in the **TYPE THE RESOURCE GROUP NAME** box, enter **myResourceGroupA**, and then click **Delete**.</span></span>
5. <span data-ttu-id="55983-328">Faça logoff do portal como UserA e faça logon como UserB.</span><span class="sxs-lookup"><span data-stu-id="55983-328">Log out of the portal as UserA and log in as UserB.</span></span>
6. <span data-ttu-id="55983-329">Conclua as etapas 2 a 4 para myResourceGroupB.</span><span class="sxs-lookup"><span data-stu-id="55983-329">Complete steps 2-4 for myResourceGroupB.</span></span>

### <span data-ttu-id="55983-330"><a name="delete-cli"></a>Azure CLI</span><span class="sxs-lookup"><span data-stu-id="55983-330"><a name="delete-cli"></a>Azure CLI</span></span>

1. <span data-ttu-id="55983-331">Faça logon no Azure como UserA e execute o seguinte comando:</span><span class="sxs-lookup"><span data-stu-id="55983-331">Log in to Azure as UserA and execute the following command:</span></span>

    ```azurecli-interactive
    az group delete --name myResourceGroupA --yes
    ```
2. <span data-ttu-id="55983-332">Faça logoff do Azure como UserA e faça logon como UserB.</span><span class="sxs-lookup"><span data-stu-id="55983-332">Log out of Azure as UserA and log in as UserB.</span></span>
3. <span data-ttu-id="55983-333">Execute o seguinte comando:</span><span class="sxs-lookup"><span data-stu-id="55983-333">Execute the following command:</span></span>

    ```azurecli-interactive
    az group delete --name myResourceGroupB --yes
    ```

### <span data-ttu-id="55983-334"><a name="delete-powershell"></a>PowerShell</span><span class="sxs-lookup"><span data-stu-id="55983-334"><a name="delete-powershell"></a>PowerShell</span></span>

1. <span data-ttu-id="55983-335">Faça logon no Azure como UserA e execute o seguinte comando:</span><span class="sxs-lookup"><span data-stu-id="55983-335">Log in to Azure as UserA and execute the following command:</span></span>

    ```powershell
    Remove-AzureRmResourceGroup -Name myResourceGroupA -force
    ```

2. <span data-ttu-id="55983-336">Faça logoff do Azure como UserA e faça logon como UserB.</span><span class="sxs-lookup"><span data-stu-id="55983-336">Log out of Azure as UserA and log in as UserB.</span></span>
3. <span data-ttu-id="55983-337">Execute o seguinte comando:</span><span class="sxs-lookup"><span data-stu-id="55983-337">Execute the following command:</span></span>

    ```powershell
    Remove-AzureRmResourceGroup -Name myResourceGroupB -force
    ```

## <a name="next-steps"></a><span data-ttu-id="55983-338">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="55983-338">Next steps</span></span>

- <span data-ttu-id="55983-339">Familiarize por completo com [comportamentos e restrições importantes do emparelhamento de rede virtual](virtual-network-manage-peering.md#requirements-and-constraints) antes de criar um emparelhamento de rede virtual para uso em produção.</span><span class="sxs-lookup"><span data-stu-id="55983-339">Thoroughly familiarize yourself with important [virtual network peering constraints and behaviors](virtual-network-manage-peering.md#requirements-and-constraints) before creating a virtual network peering for production use.</span></span>
- <span data-ttu-id="55983-340">Saiba mais sobre todas as [configurações de emparelhamento de rede virtual](virtual-network-manage-peering.md#create-a-peering).</span><span class="sxs-lookup"><span data-stu-id="55983-340">Learn about all [virtual network peering settings](virtual-network-manage-peering.md#create-a-peering).</span></span>
- <span data-ttu-id="55983-341">Saiba como [criar uma topologia de rede hub e spoke](/azure/architecture/reference-architectures/hybrid-networking/hub-spoke?toc=%2fazure%2fvirtual-network%2ftoc.json#vnet-peering) com o emparelhamento de rede virtual.</span><span class="sxs-lookup"><span data-stu-id="55983-341">Learn how to [create a hub and spoke network topology](/azure/architecture/reference-architectures/hybrid-networking/hub-spoke?toc=%2fazure%2fvirtual-network%2ftoc.json#vnet-peering) with virtual network peering.</span></span>
