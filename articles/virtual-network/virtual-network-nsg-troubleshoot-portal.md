---
title: "Solucionar problemas de grupos de segurança de rede – Portal | Microsoft Docs"
description: "Saiba como solucionar problemas de Grupos de segurança de rede no modelo de implantação do Azure Resource Manager usando o Portal do Azure."
services: virtual-network
documentationcenter: na
author: AnithaAdusumilli
manager: narayan
editor: 
tags: azure-resource-manager
ms.assetid: a54feccf-0123-4e49-a743-eb8d0bdd1ebc
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/23/2016
ms.author: anithaa
ms.openlocfilehash: f01d3b43a7953697a6b03e176dace33448d95cd9
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="troubleshoot-network-security-groups-using-the-azure-portal"></a><span data-ttu-id="1a606-103">Solucionar problemas de grupos de segurança de rede usando o Portal do Azure</span><span class="sxs-lookup"><span data-stu-id="1a606-103">Troubleshoot Network Security Groups using the Azure Portal</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="1a606-104">Portal do Azure</span><span class="sxs-lookup"><span data-stu-id="1a606-104">Azure Portal</span></span>](virtual-network-nsg-troubleshoot-portal.md)
> * [<span data-ttu-id="1a606-105">PowerShell</span><span class="sxs-lookup"><span data-stu-id="1a606-105">PowerShell</span></span>](virtual-network-nsg-troubleshoot-powershell.md)
> 
> 

<span data-ttu-id="1a606-106">Se você configurou NSGs (grupos de segurança de rede) em sua VM (máquina virtual) e está tendo problemas de conectividade com a VM, este artigo fornece uma visão geral dos recursos de diagnóstico para NSGs a fim de ajudar a solucionar outros problemas.</span><span class="sxs-lookup"><span data-stu-id="1a606-106">If you configured Network Security Groups (NSGs) on your virtual machine (VM) and are experiencing VM connectivity issues, this article provides an overview of diagnostics capabilities for NSGs to help troubleshoot further.</span></span>

<span data-ttu-id="1a606-107">Os NSGs permitem que você controle os tipos de tráfego que fluem para dentro e fora de suas VMs (máquinas virtuais).</span><span class="sxs-lookup"><span data-stu-id="1a606-107">NSGs enable you to control the types of traffic that flow in and out of your virtual machines (VMs).</span></span> <span data-ttu-id="1a606-108">Os NSGs podem ser aplicados a sub-redes em uma VNet (rede virtual) do Azure, à NIC (adaptadores de rede) ou ambas.</span><span class="sxs-lookup"><span data-stu-id="1a606-108">NSGs can be applied to subnets in an Azure Virtual Network (VNet), network interfaces (NIC), or both.</span></span> <span data-ttu-id="1a606-109">As regras em vigor aplicadas a uma NIC são uma agregação das regras que existem nos NSGs aplicados a uma NIC e à sub-rede à qual ela está conectada.</span><span class="sxs-lookup"><span data-stu-id="1a606-109">The effective rules applied to a NIC are an aggregation of the rules that exist in the NSGs applied to a NIC and the subnet it is connected to.</span></span> <span data-ttu-id="1a606-110">As regras nesses NSGs podem, às vezes, entrar em conflito umas com as outras e afetar a conectividade de rede de uma VM.</span><span class="sxs-lookup"><span data-stu-id="1a606-110">Rules across these NSGs can sometimes conflict with each other and impact a VM's network connectivity.</span></span>  

<span data-ttu-id="1a606-111">Você pode ver todas as regras de segurança em vigor em seus NSGs, conforme aplicado nas NICs da sua VM.</span><span class="sxs-lookup"><span data-stu-id="1a606-111">You can view all the effective security rules from your NSGs, as applied on your VM's NICs.</span></span> <span data-ttu-id="1a606-112">Este artigo mostra como solucionar problemas de conectividade da VM usando essas regras no modelo de implantação do Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="1a606-112">This article shows how to troubleshoot VM connectivity issues using these rules in the Azure Resource Manager deployment model.</span></span> <span data-ttu-id="1a606-113">Se você não estiver familiarizado com conceitos de VNet e NSG, leia os artigos de visão geral de [Rede virtual](virtual-networks-overview.md) e [Grupos de segurança de rede](virtual-networks-nsg.md).</span><span class="sxs-lookup"><span data-stu-id="1a606-113">If you're not familiar with VNet and NSG concepts, read the [Virtual network](virtual-networks-overview.md) and [Network security groups](virtual-networks-nsg.md) overview articles.</span></span>

## <a name="using-effective-security-rules-to-troubleshoot-vm-traffic-flow"></a><span data-ttu-id="1a606-114">Usando regras de segurança em vigor para solucionar problemas de fluxo de tráfego da VM</span><span class="sxs-lookup"><span data-stu-id="1a606-114">Using Effective Security Rules to troubleshoot VM traffic flow</span></span>
<span data-ttu-id="1a606-115">O cenário a seguir é um exemplo de um problema de conexão comum:</span><span class="sxs-lookup"><span data-stu-id="1a606-115">The scenario that follows is an example of a common connection problem:</span></span>

<span data-ttu-id="1a606-116">Uma VM denominada *VM1* faz parte de uma sub-rede denominada *Subnet1* em uma VNet denominada *WestUS-VNet1*.</span><span class="sxs-lookup"><span data-stu-id="1a606-116">A VM named *VM1* is part of a subnet named *Subnet1* within a VNet named *WestUS-VNet1*.</span></span> <span data-ttu-id="1a606-117">Falha em uma tentativa de conectar-se à VM usando o RDP por meio da porta TCP 3389.</span><span class="sxs-lookup"><span data-stu-id="1a606-117">An attempt to connect to the VM using RDP over TCP port 3389 fails.</span></span> <span data-ttu-id="1a606-118">Os NSGs são aplicados tanto na NIC *VM1-NIC1* quanto na sub-rede *Subnet1*.</span><span class="sxs-lookup"><span data-stu-id="1a606-118">NSGs are applied at both the NIC *VM1-NIC1* and the subnet *Subnet1*.</span></span> <span data-ttu-id="1a606-119">O tráfego para a porta TCP 3389 é permitido no NSG associado ao adaptador de rede *VM1-NIC1*. No entanto, ocorre uma falha no ping do TCP para a porta 3389 da VM1.</span><span class="sxs-lookup"><span data-stu-id="1a606-119">Traffic to TCP port 3389 is allowed in the NSG associated with the network interface *VM1-NIC1*, however TCP ping to VM1's port 3389 fails.</span></span>

<span data-ttu-id="1a606-120">Embora este exemplo use a porta TCP 3389, as etapas a seguir podem ser seguidas para determinar falhas de conexão de entrada e saída em qualquer porta.</span><span class="sxs-lookup"><span data-stu-id="1a606-120">While this example uses TCP port 3389, the following steps can be used to determine inbound and outbound connection failures over any port.</span></span>

### <span data-ttu-id="1a606-121"><a name="vm"></a>Exibir regras de segurança em vigor para uma máquina virtual</span><span class="sxs-lookup"><span data-stu-id="1a606-121"><a name="vm"></a>View effective security rules for a virtual machine</span></span>
<span data-ttu-id="1a606-122">Siga as etapas a seguir para solucionar problemas de NSGs em uma VM:</span><span class="sxs-lookup"><span data-stu-id="1a606-122">Complete the following steps to troubleshoot NSGs for a VM:</span></span>

<span data-ttu-id="1a606-123">Você pode exibir uma lista completa das regras de segurança em vigor em uma NIC, por meio da VM em si.</span><span class="sxs-lookup"><span data-stu-id="1a606-123">You can view full list of the effective security rules on a NIC, from the VM itself.</span></span> <span data-ttu-id="1a606-124">Você também poderá adicionar, modificar e excluir tanto a NIC quanto as regras NSG da sub-rede da folha regras em vigor, se você tiver permissões para realizar essas operações.</span><span class="sxs-lookup"><span data-stu-id="1a606-124">You can also add, modify, and delete both NIC and subnet NSG rules from the effective rules blade, if you have permissions to perform these operations.</span></span>

1. <span data-ttu-id="1a606-125">Entre no Portal do Azure em https://portal.azure.com.</span><span class="sxs-lookup"><span data-stu-id="1a606-125">Login to the Azure portal at https://portal.azure.com.</span></span>
2. <span data-ttu-id="1a606-126">Clique em **Mais serviços** e em **Máquinas virtuais** na lista exibida.</span><span class="sxs-lookup"><span data-stu-id="1a606-126">Click **More services**, then click **Virtual machines** in the list that appears.</span></span>
3. <span data-ttu-id="1a606-127">Selecione uma VM para solucionar problemas na lista, e uma folha da VM com opções é exibida.</span><span class="sxs-lookup"><span data-stu-id="1a606-127">Select a VM to troubleshoot from the list that appears and a VM blade with options appears.</span></span>
4. <span data-ttu-id="1a606-128">Clique em **Diagnosticar e resolver problemas** e selecione um problema comum.</span><span class="sxs-lookup"><span data-stu-id="1a606-128">Click **Diagnose & solve problems** and then select a common problem.</span></span> <span data-ttu-id="1a606-129">Neste exemplo, **Não é possível me conectar à minha VM do Windows** está selecionado.</span><span class="sxs-lookup"><span data-stu-id="1a606-129">For this example, **I can’t connect to my Windows VM** is selected.</span></span> 
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image1.png)
5. <span data-ttu-id="1a606-130">As etapas são exibidas embaixo do problema, conforme mostrado na imagem a seguir:</span><span class="sxs-lookup"><span data-stu-id="1a606-130">Steps appear under the problem, as shown in the following picture:</span></span> 
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image2.png)
   
    <span data-ttu-id="1a606-131">Clique em *regras efetivas do grupo de segurança* na lista de etapas recomendadas.</span><span class="sxs-lookup"><span data-stu-id="1a606-131">Click *effective security group rules* in the list of recommended steps.</span></span>
6. <span data-ttu-id="1a606-132">A folha **Obter regras de segurança em vigor** é exibida, conforme mostrado na imagem a seguir:</span><span class="sxs-lookup"><span data-stu-id="1a606-132">The **Get effective security rules** blade appears, as shown in the following picture:</span></span>
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image3.png)
   
    <span data-ttu-id="1a606-133">Observe as seguintes seções da imagem:</span><span class="sxs-lookup"><span data-stu-id="1a606-133">Notice the following sections of the picture:</span></span>
   
   * <span data-ttu-id="1a606-134">**Escopo:** defina a VM selecionada na etapa 3 como *VM1*.</span><span class="sxs-lookup"><span data-stu-id="1a606-134">**Scope:** Set to *VM1*, the VM selected in step 3.</span></span>
   * <span data-ttu-id="1a606-135">**Adaptador de rede:** *VM1-NIC1* foi selecionado.</span><span class="sxs-lookup"><span data-stu-id="1a606-135">**Network interface:** *VM1-NIC1* is selected.</span></span> <span data-ttu-id="1a606-136">Uma VM pode ter vários adaptadores de rede (NIC).</span><span class="sxs-lookup"><span data-stu-id="1a606-136">A VM can have multiple network interfaces (NIC).</span></span> <span data-ttu-id="1a606-137">Cada NIC pode ter regras de segurança em vigor únicas.</span><span class="sxs-lookup"><span data-stu-id="1a606-137">Each NIC can have unique effective security rules.</span></span> <span data-ttu-id="1a606-138">Ao solucionar problemas, talvez seja necessário exibir as regras de segurança em vigor para cada NIC.</span><span class="sxs-lookup"><span data-stu-id="1a606-138">When troubleshooting, you may need to view the effective security rules for each NIC.</span></span>
   * <span data-ttu-id="1a606-139">**NSGs associados:** os NSGs podem ser aplicados tanto à NIC quanto à sub-rede à qual a NIC está conectada.</span><span class="sxs-lookup"><span data-stu-id="1a606-139">**Associated NSGs:** NSGs can be applied to both the NIC and the subnet the NIC is connected to.</span></span> <span data-ttu-id="1a606-140">Na imagem, um NSG foi aplicado à NIC e à sub-rede na qual ela está conectada.</span><span class="sxs-lookup"><span data-stu-id="1a606-140">In the picture, an NSG has been applied to both the NIC and the subnet it's connected to.</span></span> <span data-ttu-id="1a606-141">Você pode clicar nos nomes do NSG para modificar diretamente as regras nos NSGs.</span><span class="sxs-lookup"><span data-stu-id="1a606-141">You can click on the NSG names to directly modify rules in the NSGs.</span></span>
   * <span data-ttu-id="1a606-142">**Guia VM1-nsg:** a lista de regras exibidas na imagem é para o NSG aplicado à NIC.</span><span class="sxs-lookup"><span data-stu-id="1a606-142">**VM1-nsg tab:** The list of rules displayed in the picture is for the NSG applied to the NIC.</span></span> <span data-ttu-id="1a606-143">Várias regras padrão são criadas pelo Azure sempre que um NSG é criado.</span><span class="sxs-lookup"><span data-stu-id="1a606-143">Several default rules are created by Azure whenever an NSG is created.</span></span> <span data-ttu-id="1a606-144">Não é possível remover as regras padrão, mas você pode substituí-las por regras com prioridade mais alta.</span><span class="sxs-lookup"><span data-stu-id="1a606-144">You can't remove the default rules, but you can override them with rules of higher priority.</span></span> <span data-ttu-id="1a606-145">Para saber mais sobre regras padrão, leia o artigo [Visão geral do NSG](virtual-networks-nsg.md#default-rules) .</span><span class="sxs-lookup"><span data-stu-id="1a606-145">To learn more about default rules, read the [NSG overview](virtual-networks-nsg.md#default-rules) article.</span></span>
   * <span data-ttu-id="1a606-146">**Coluna DESTINO:** algumas regras têm texto na coluna, enquanto outras têm prefixos de endereço.</span><span class="sxs-lookup"><span data-stu-id="1a606-146">**DESTINATION column:** Some of the rules have text in the column, while others have address prefixes.</span></span> <span data-ttu-id="1a606-147">O texto é o nome de marcações padrão aplicadas à regra de segurança quando ela foi criada.</span><span class="sxs-lookup"><span data-stu-id="1a606-147">The text is the name of default tags applied to the security rule when it was created.</span></span> <span data-ttu-id="1a606-148">As marcações são identificadores fornecidos pelo sistema que representam vários prefixos.</span><span class="sxs-lookup"><span data-stu-id="1a606-148">The tags are system-provided identifiers that represent multiple prefixes.</span></span> <span data-ttu-id="1a606-149">A seleção de uma regra com uma marcação, como *AllowInternetOutBound*, lista os prefixos na folha **Prefixos de endereços** .</span><span class="sxs-lookup"><span data-stu-id="1a606-149">Selecting a rule with a tag, such as *AllowInternetOutBound*, lists the prefixes in the **Address prefixes** blade.</span></span>
   * <span data-ttu-id="1a606-150">**Baixar:** a lista de regras pode ser longa.</span><span class="sxs-lookup"><span data-stu-id="1a606-150">**Download:** The list of rules can be long.</span></span> <span data-ttu-id="1a606-151">Você pode baixar um arquivo. csv das regras para análise offline clicando em **Baixar** e salvando o arquivo.</span><span class="sxs-lookup"><span data-stu-id="1a606-151">You can download a .csv file of the rules for offline analysis by clicking **Download** and saving the file.</span></span>
   * <span data-ttu-id="1a606-152">**AllowRDP** : essa regra possibilita conexões RDP com a VM.</span><span class="sxs-lookup"><span data-stu-id="1a606-152">**AllowRDP** Inbound rule: This rule allows RDP connections to the VM.</span></span>
7. <span data-ttu-id="1a606-153">Clique na guia **Subnet1-NSG** para exibir as regras em vigor do NSG aplicado à sub-rede, conforme mostrado na imagem a seguir:</span><span class="sxs-lookup"><span data-stu-id="1a606-153">Click the **Subnet1-NSG** tab to view the effective rules from the NSG applied to the subnet, as shown in the following picture:</span></span> 
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image4.png)
   
    <span data-ttu-id="1a606-154">Observe a regra de *entrada* **denyRDP** .</span><span class="sxs-lookup"><span data-stu-id="1a606-154">Notice the *denyRDP* **Inbound** rule.</span></span> <span data-ttu-id="1a606-155">As regras de entrada aplicadas na sub-rede são avaliadas antes das regras aplicadas no adaptador de rede.</span><span class="sxs-lookup"><span data-stu-id="1a606-155">Inbound rules applied at the subnet are evaluated before rules applied at the network interface.</span></span> <span data-ttu-id="1a606-156">Como a regra negar é aplicada na sub-rede, a solicitação para se conectar à TCP 3389 falha, porque a regra permitir na NIC nunca é avaliada.</span><span class="sxs-lookup"><span data-stu-id="1a606-156">Since the deny rule is applied at the subnet, the request to connect to TCP 3389 fails, because the allow rule at the NIC is never evaluated.</span></span> 
   
    <span data-ttu-id="1a606-157">A regra *denyRDP* é a razão por que a conexão RDP está falhando.</span><span class="sxs-lookup"><span data-stu-id="1a606-157">The *denyRDP* rule is the reason why the RDP connection is failing.</span></span> <span data-ttu-id="1a606-158">Removê-la deve resolver o problema.</span><span class="sxs-lookup"><span data-stu-id="1a606-158">Removing it should resolve the problem.</span></span>
   
   > [!NOTE]
   > <span data-ttu-id="1a606-159">Se a VM associada à NIC não estiver no estado de execução ou os NSGs não tiverem sido aplicados à NIC ou à sub-rede, nenhuma regra será mostrada.</span><span class="sxs-lookup"><span data-stu-id="1a606-159">If the VM associated with the NIC is not in a running state, or NSGs haven't been applied to the NIC or subnet, no rules are shown.</span></span>
   > 
   > 
8. <span data-ttu-id="1a606-160">Para editar as regras do NSG, clique em *Subnet1-NSG* na seção **NSGs associados** .</span><span class="sxs-lookup"><span data-stu-id="1a606-160">To edit NSG rules, click *Subnet1-NSG* in the **Associated NSGs** section.</span></span>
   <span data-ttu-id="1a606-161">Isso abre a folha **Subnet1-NSG** .</span><span class="sxs-lookup"><span data-stu-id="1a606-161">This opens the **Subnet1-NSG** blade.</span></span> <span data-ttu-id="1a606-162">Você pode editar as regras diretamente clicando em **Regras de segurança de entrada**.</span><span class="sxs-lookup"><span data-stu-id="1a606-162">You can directly edit the rules by clicking on **Inbound security rules**.</span></span>
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image7.png)
9. <span data-ttu-id="1a606-163">Depois de remover a regra de entrada *denyRDP* na **Subnet1-NSG** e adicionar uma regra *allowRDP*, a lista de regras em vigor será semelhante à imagem a seguir:</span><span class="sxs-lookup"><span data-stu-id="1a606-163">After removing the *denyRDP* inbound rule in the **Subnet1-NSG** and adding an *allowRDP* rule, the effective rules list looks like the following picture:</span></span>
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image8.png)
   
    <span data-ttu-id="1a606-164">Confirme que a porta TCP 3389 está aberta abrindo uma conexão RDP com a VM ou usando a ferramenta PsPing.</span><span class="sxs-lookup"><span data-stu-id="1a606-164">Confirm that TCP port 3389 is open by opening an RDP connection to the VM or using the PsPing tool.</span></span> <span data-ttu-id="1a606-165">Você pode saber mais sobre o PsPing lendo a [página de download do PsPing](https://technet.microsoft.com/sysinternals/psping.aspx).</span><span class="sxs-lookup"><span data-stu-id="1a606-165">You can learn more about PsPing by reading the [PsPing download page](https://technet.microsoft.com/sysinternals/psping.aspx).</span></span>

### <span data-ttu-id="1a606-166"><a name="nic"></a>Exibir regras de segurança em vigor para um adaptador de rede</span><span class="sxs-lookup"><span data-stu-id="1a606-166"><a name="nic"></a>View effective security rules for a network interface</span></span>
<span data-ttu-id="1a606-167">Se seu fluxo de tráfego da VM for afetado para uma NIC específica, você poderá ver uma lista completa das regras em vigor para a NIC no contexto de adaptadores de rede concluindo as seguintes etapas:</span><span class="sxs-lookup"><span data-stu-id="1a606-167">If your VM traffic flow is impacted for a specific NIC, you can view a full list of the effective rules for the NIC from the network interfaces context by completing the following steps:</span></span>

1. <span data-ttu-id="1a606-168">Entre no Portal do Azure em https://portal.azure.com.</span><span class="sxs-lookup"><span data-stu-id="1a606-168">Login to the Azure portal at https://portal.azure.com.</span></span>
2. <span data-ttu-id="1a606-169">Clique em **Mais serviços** e em **Adaptadores de rede** na lista exibida.</span><span class="sxs-lookup"><span data-stu-id="1a606-169">Click **More services**, then click **Network interfaces** in the list that appears.</span></span>
3. <span data-ttu-id="1a606-170">Selecione um adaptador de rede.</span><span class="sxs-lookup"><span data-stu-id="1a606-170">Select a network interface.</span></span> <span data-ttu-id="1a606-171">Na imagem a seguir, uma NIC denominada *VM1-NIC1* foi selecionada.</span><span class="sxs-lookup"><span data-stu-id="1a606-171">In the following picture, a NIC named *VM1-NIC1* is selected.</span></span>
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image5.png)
   
    <span data-ttu-id="1a606-172">Observe que **Escopo** foi definido para o adaptador de rede selecionado.</span><span class="sxs-lookup"><span data-stu-id="1a606-172">Notice that the **Scope** is set to the network interface selected.</span></span> <span data-ttu-id="1a606-173">Para saber mais sobre as informações adicionais mostradas, leia a etapa 6 da seção **Solucionar problemas de NSGs para uma VM** deste artigo.</span><span class="sxs-lookup"><span data-stu-id="1a606-173">To learn more about the additional information shown, read step 6 of the **Troubleshoot NSGs for a VM** section of this article.</span></span>
   
   > [!NOTE]
   > <span data-ttu-id="1a606-174">Se um NSG for removido em um adaptador de rede, o NSG da sub-rede ainda estará em vigor na NIC fornecida.</span><span class="sxs-lookup"><span data-stu-id="1a606-174">If an NSG is removed from a network interface, the subnet NSG is still effective on the given NIC.</span></span> <span data-ttu-id="1a606-175">Nesse caso, a saída só mostraria regras do NSG da sub-rede.</span><span class="sxs-lookup"><span data-stu-id="1a606-175">In this case, the output would only show rules from the subnet NSG.</span></span> <span data-ttu-id="1a606-176">As regras serão exibidas somente se a NIC estiver conectada a uma VM.</span><span class="sxs-lookup"><span data-stu-id="1a606-176">Rules only appear if the NIC is attached to a VM.</span></span>
   > 
   > 
4. <span data-ttu-id="1a606-177">Você pode editar diretamente as regras para NSGs associados a uma NIC e a uma sub-rede.</span><span class="sxs-lookup"><span data-stu-id="1a606-177">You can directly edit rules for NSGs associated with a NIC and a subnet.</span></span> <span data-ttu-id="1a606-178">Para saber como fazer isso, leia a etapa 8 da seção **Exibir regras de segurança em vigor para uma máquina virtual** deste artigo.</span><span class="sxs-lookup"><span data-stu-id="1a606-178">To learn how, read step 8 of the **View effective security rules for a virtual machine** section of this article.</span></span>

## <span data-ttu-id="1a606-179"><a name="nsg"></a>Exibir regras de segurança em vigor para um NSG (grupo de segurança de rede)</span><span class="sxs-lookup"><span data-stu-id="1a606-179"><a name="nsg"></a>View effective security rules for a network security group (NSG)</span></span>
<span data-ttu-id="1a606-180">Ao modificar as regras do NSG, convém analisar o impacto das regras que estão sendo adicionadas em uma VM específica.</span><span class="sxs-lookup"><span data-stu-id="1a606-180">When modifying NSG rules, you may want to review the impact of the rules being added on a particular VM.</span></span> <span data-ttu-id="1a606-181">Agora você pode ver uma lista completa das regras de segurança em vigor para todas as NICs às quais um NSG fornecido é aplicado, sem precisar mudar o contexto da folha de NSG fornecida.</span><span class="sxs-lookup"><span data-stu-id="1a606-181">You can view a full list of the effective security rules for all the NICs that a given NSG is applied to, without having to switch context from the given NSG blade.</span></span> <span data-ttu-id="1a606-182">Para solucionar problemas de regras em vigor em um NSG, siga as etapas a seguir:</span><span class="sxs-lookup"><span data-stu-id="1a606-182">To troubleshoot effective rules within an NSG, complete the following steps:</span></span>

1. <span data-ttu-id="1a606-183">Entre no Portal do Azure em https://portal.azure.com.</span><span class="sxs-lookup"><span data-stu-id="1a606-183">Login to the Azure portal at https://portal.azure.com.</span></span>
2. <span data-ttu-id="1a606-184">Clique em **Mais serviços** e em **Grupos de segurança de rede** na lista exibida.</span><span class="sxs-lookup"><span data-stu-id="1a606-184">Click **More services**, then click **Network security groups** in the list that appears.</span></span>
3. <span data-ttu-id="1a606-185">Selecione um NSG.</span><span class="sxs-lookup"><span data-stu-id="1a606-185">Select an NSG.</span></span> <span data-ttu-id="1a606-186">Na imagem a seguir, um NSG denominado VM1-nsg foi selecionado.</span><span class="sxs-lookup"><span data-stu-id="1a606-186">In the following picture, an NSG named VM1-nsg was selected.</span></span>
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image6.png)
   
    <span data-ttu-id="1a606-187">Observe as seguintes seções da imagem anterior:</span><span class="sxs-lookup"><span data-stu-id="1a606-187">Notice the following sections of the previous picture:</span></span>
   
   * <span data-ttu-id="1a606-188">**Escopo:** defina para o NSG selecionado.</span><span class="sxs-lookup"><span data-stu-id="1a606-188">**Scope:** Set to the NSG selected.</span></span>
   * <span data-ttu-id="1a606-189">**Máquina Virtual:** quando um NSG é aplicado a uma sub-rede, ele é aplicado a todos os adaptadores de rede conectados a todas as VMs conectadas à sub-rede.</span><span class="sxs-lookup"><span data-stu-id="1a606-189">**Virtual machine:** When an NSG is applied to a subnet, it's applied to all network interfaces attached to all VMs connected to the subnet.</span></span> <span data-ttu-id="1a606-190">Esta lista mostra todas as VMs às quais este NSG foi aplicado.</span><span class="sxs-lookup"><span data-stu-id="1a606-190">This list shows all VMs this NSG is applied to.</span></span> <span data-ttu-id="1a606-191">Você pode selecionar qualquer VM na lista.</span><span class="sxs-lookup"><span data-stu-id="1a606-191">You can select any VM from the list.</span></span>
     
     > [!NOTE]
     > <span data-ttu-id="1a606-192">Se um NSG for aplicado a apenas uma sub-rede vazia, as VMs não serão listadas.</span><span class="sxs-lookup"><span data-stu-id="1a606-192">If an NSG is applied to only an empty subnet, VMs will not be listed.</span></span> <span data-ttu-id="1a606-193">Se um NSG for aplicado a uma NIC não associada a uma VM, essas NICs também não serão listadas.</span><span class="sxs-lookup"><span data-stu-id="1a606-193">If an NSG is applied to a NIC which is not associated with a VM, those NICs will also not be listed.</span></span> 
     > 
     > 
   * <span data-ttu-id="1a606-194">**Adaptador de rede:** uma VM pode ter vários adaptadores de rede.</span><span class="sxs-lookup"><span data-stu-id="1a606-194">**Network Interface:** A VM can have multiple network interfaces.</span></span> <span data-ttu-id="1a606-195">Você pode selecionar um adaptador de rede conectado à VM selecionada.</span><span class="sxs-lookup"><span data-stu-id="1a606-195">You can select a network interface attached to the selected VM.</span></span>
   * <span data-ttu-id="1a606-196">**AssociatedNSGs:** a qualquer momento, uma NIC pode ter até dois NSGs em vigor, um aplicado à NIC e o outro, à sub-rede.</span><span class="sxs-lookup"><span data-stu-id="1a606-196">**AssociatedNSGs:** At any time, a NIC can have up to two effective NSGs, one applied to the NIC and the other to the subnet.</span></span> <span data-ttu-id="1a606-197">Embora o escopo tenha sido selecionado como VM1-nsg, se a NIC tiver um NSG de sub-rede em vigor, a saída mostrará os dois NSGs.</span><span class="sxs-lookup"><span data-stu-id="1a606-197">Although the scope is selected as VM1-nsg, if the NIC has an effective subnet NSG, the output will show both NSGs.</span></span>
4. <span data-ttu-id="1a606-198">Você pode editar diretamente as regras para NSGs associados a uma NIC ou a uma sub-rede.</span><span class="sxs-lookup"><span data-stu-id="1a606-198">You can directly edit rules for NSGs associated with a NIC or subnet.</span></span> <span data-ttu-id="1a606-199">Para saber como fazer isso, leia a etapa 8 da seção **Exibir regras de segurança em vigor para uma máquina virtual** deste artigo.</span><span class="sxs-lookup"><span data-stu-id="1a606-199">To learn how, read step 8 of the **View effective security rules for a virtual machine** section of this article.</span></span>

<span data-ttu-id="1a606-200">Para saber mais sobre as outras informações mostradas, leia a etapa 6 da seção **Exibir regras de segurança em vigor para uma máquina virtual** deste artigo.</span><span class="sxs-lookup"><span data-stu-id="1a606-200">To learn more about the additional information shown, read step 6 of the **View effective security rules for a virtual machine** section of this article.</span></span>

> [!NOTE]
> <span data-ttu-id="1a606-201">Embora uma sub-rede e a NIC possam ter apenas um NSG aplicado a elas, um NSG pode ser associado a várias NICs e a várias sub-redes.</span><span class="sxs-lookup"><span data-stu-id="1a606-201">Though a subnet and NIC can each have only one NSG applied to them, an NSG can be associated to multiple NICs and multiple subnets.</span></span>
> 
> 

## <a name="considerations"></a><span data-ttu-id="1a606-202">Considerações</span><span class="sxs-lookup"><span data-stu-id="1a606-202">Considerations</span></span>
<span data-ttu-id="1a606-203">Considere os seguintes pontos ao solucionar problemas de conectividade:</span><span class="sxs-lookup"><span data-stu-id="1a606-203">Consider the following points when troubleshooting connectivity problems:</span></span>

* <span data-ttu-id="1a606-204">As regras NSG padrão bloquearão o acesso de entrada da Internet e permitirão apenas o tráfego de entrada da VNet.</span><span class="sxs-lookup"><span data-stu-id="1a606-204">Default NSG rules will block inbound access from the internet and only permit VNet inbound traffic.</span></span> <span data-ttu-id="1a606-205">As regras devem ser adicionadas explicitamente para permitir acesso de entrada da Internet, conforme necessário.</span><span class="sxs-lookup"><span data-stu-id="1a606-205">Rules should be explicitly added to allow inbound access from Internet, as required.</span></span>
* <span data-ttu-id="1a606-206">Se não houver nenhuma regra de segurança NSG que faça a conectividade de rede da VM falhar, o problema poderá ser devido a:</span><span class="sxs-lookup"><span data-stu-id="1a606-206">If there are no NSG security rules causing a VM’s network connectivity to fail, the problem may be due to:</span></span>
  * <span data-ttu-id="1a606-207">Software de firewall em execução no sistema operacional da VM</span><span class="sxs-lookup"><span data-stu-id="1a606-207">Firewall software running within the VM's operating system</span></span>
  * <span data-ttu-id="1a606-208">Rotas configuradas para soluções de virtualização ou tráfego local.</span><span class="sxs-lookup"><span data-stu-id="1a606-208">Routes configured for virtual appliances or on-premises traffic.</span></span> <span data-ttu-id="1a606-209">O tráfego da Internet pode ser redirecionado para o local por meio do túnel forçado.</span><span class="sxs-lookup"><span data-stu-id="1a606-209">Internet traffic can be redirected to on-premises via forced-tunneling.</span></span> <span data-ttu-id="1a606-210">Uma conexão RDP/SSH da Internet para sua VM pode não funcionar com essa configuração, dependendo de como o hardware de rede local trata esse tráfego.</span><span class="sxs-lookup"><span data-stu-id="1a606-210">An RDP/SSH connection from the Internet to your VM may not work with this setting, depending on how the on-premises network hardware handles this traffic.</span></span> <span data-ttu-id="1a606-211">Leia o artigo [Solucionando problemas de rotas](virtual-network-routes-troubleshoot-powershell.md) para saber como diagnosticar problemas de rotas que podem estar impedindo o fluxo de tráfego de entrada e saída da VM.</span><span class="sxs-lookup"><span data-stu-id="1a606-211">Read the [Troubleshooting Routes](virtual-network-routes-troubleshoot-powershell.md) article to learn how to diagnose route problems that may be impeding the flow of traffic in and out of the VM.</span></span> 
* <span data-ttu-id="1a606-212">Se você tiver VNets emparelhadas, por padrão, a marcação VIRTUAL_NETWORK expandirá automaticamente para incluir prefixos para VNets emparelhadas.</span><span class="sxs-lookup"><span data-stu-id="1a606-212">If you have peered VNets, by default, the VIRTUAL_NETWORK tag will automatically expand to include prefixes for peered VNets.</span></span> <span data-ttu-id="1a606-213">Você pode exibir esses prefixos na lista **ExpandedAddressPrefix** , para solucionar os problemas relacionados à conectividade de emparelhamento da VNet.</span><span class="sxs-lookup"><span data-stu-id="1a606-213">You can view these prefixes in the **ExpandedAddressPrefix** list, to troubleshoot any issues related to VNet peering connectivity.</span></span> 
* <span data-ttu-id="1a606-214">As regras de segurança em vigor serão mostradas apenas se houver um NSG associado à NIC e/ou sub-rede da VM.</span><span class="sxs-lookup"><span data-stu-id="1a606-214">Effective security rules are only shown if there is an NSG associated with the VM’s NIC and or subnet.</span></span> 
* <span data-ttu-id="1a606-215">Se não houver nenhum NSG associado à NIC ou à sub-rede e você tiver um endereço IP público atribuído à sua VM, todas as portas estarão abertas para acesso de entrada e saída.</span><span class="sxs-lookup"><span data-stu-id="1a606-215">If there are no NSGs associated with the NIC or subnet and you have a public IP address assigned to your VM, all ports will be open for inbound and outbound access.</span></span> <span data-ttu-id="1a606-216">Se a VM tem um endereço IP público, recomenda-se aplicar NSGs à NIC ou à sub-rede.</span><span class="sxs-lookup"><span data-stu-id="1a606-216">If the VM has a public IP address, applying NSGs to the NIC or subnet is strongly recommended.</span></span>

