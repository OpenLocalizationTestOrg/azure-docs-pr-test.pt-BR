---
title: "Isolando aplicativos do Barramento de Serviço do Azure contra interrupções e desastres | Microsoft Docs"
description: "Descreve técnicas que podem ser usadas para proteger aplicativos contra uma potencial interrupção do Barramento de Serviço."
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: tysonn
ms.assetid: fd9fa8ab-f4c4-43f7-974f-c876df1614d4
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/12/2017
ms.author: sethm
ms.openlocfilehash: bc84dbe5c26a834b2cff5f71ba5f541e94ba0b38
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="best-practices-for-insulating-applications-against-service-bus-outages-and-disasters"></a><span data-ttu-id="48318-103">Práticas recomendadas para isolar aplicativos contra interrupções e desastres do Barramento de Serviço</span><span class="sxs-lookup"><span data-stu-id="48318-103">Best practices for insulating applications against Service Bus outages and disasters</span></span>
<span data-ttu-id="48318-104">Os aplicativos de missão crítica devem funcionar continuamente, mesmo na presença de interrupções ou de desastres não planejados.</span><span class="sxs-lookup"><span data-stu-id="48318-104">Mission-critical applications must operate continuously, even in the presence of unplanned outages or disasters.</span></span> <span data-ttu-id="48318-105">Este tópico descreve técnicas que podem ser usadas para proteger aplicativos do Barramento de Serviço contra uma potencial interrupção de serviço ou um desastre.</span><span class="sxs-lookup"><span data-stu-id="48318-105">This topic describes techniques you can use to protect Service Bus applications against a potential service outage or disaster.</span></span>

<span data-ttu-id="48318-106">Uma interrupção é definida como a indisponibilidade temporária do Barramento de Serviço do Azure.</span><span class="sxs-lookup"><span data-stu-id="48318-106">An outage is defined as the temporary unavailability of Azure Service Bus.</span></span> <span data-ttu-id="48318-107">A interrupção pode afetar alguns componentes do Barramento de Serviço, como um repositório de mensagens ou até mesmo o datacenter inteiro.</span><span class="sxs-lookup"><span data-stu-id="48318-107">The outage can affect some components of Service Bus, such as a messaging store, or even the entire datacenter.</span></span> <span data-ttu-id="48318-108">Depois que o problema tiver sido corrigido, o Barramento de Serviço ficará disponível novamente.</span><span class="sxs-lookup"><span data-stu-id="48318-108">After the problem has been fixed, Service Bus becomes available again.</span></span> <span data-ttu-id="48318-109">Normalmente, uma interrupção não causa a perda de mensagens ou de outros dados.</span><span class="sxs-lookup"><span data-stu-id="48318-109">Typically, an outage does not cause loss of messages or other data.</span></span> <span data-ttu-id="48318-110">Um exemplo de falha de um componente é a indisponibilidade de um repositório de mensagens específico.</span><span class="sxs-lookup"><span data-stu-id="48318-110">An example of a component failure is the unavailability of a particular messaging store.</span></span> <span data-ttu-id="48318-111">Um exemplo de uma paralisação de todo o datacenter é uma falha de energia do datacenter ou uma chave de rede do datacenter com defeito.</span><span class="sxs-lookup"><span data-stu-id="48318-111">An example of a datacenter-wide outage is a power failure of the datacenter, or a faulty datacenter network switch.</span></span> <span data-ttu-id="48318-112">Uma falha pode durar de alguns minutos até alguns dias.</span><span class="sxs-lookup"><span data-stu-id="48318-112">An outage can last from a few minutes to a few days.</span></span>

<span data-ttu-id="48318-113">Um desastre é definido como a perda permanente de uma unidade de escala ou de um datacenter do Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="48318-113">A disaster is defined as the permanent loss of a Service Bus scale unit or datacenter.</span></span> <span data-ttu-id="48318-114">O datacenter pode ou não ficar disponível novamente.</span><span class="sxs-lookup"><span data-stu-id="48318-114">The datacenter may or may not become available again.</span></span> <span data-ttu-id="48318-115">Normalmente, um desastre causa perda de algumas ou de todas as mensagens ou de outros dados.</span><span class="sxs-lookup"><span data-stu-id="48318-115">Typically a disaster causes loss of some or all messages or other data.</span></span> <span data-ttu-id="48318-116">Exemplos de desastres são incêndios, enchentes ou terremoto.</span><span class="sxs-lookup"><span data-stu-id="48318-116">Examples of disasters are fire, flooding, or earthquake.</span></span>

## <a name="current-architecture"></a><span data-ttu-id="48318-117">Arquitetura atual</span><span class="sxs-lookup"><span data-stu-id="48318-117">Current architecture</span></span>
<span data-ttu-id="48318-118">O Barramento de Serviço usa vários repositórios de mensagens para armazenar mensagens enviadas para filas ou tópicos.</span><span class="sxs-lookup"><span data-stu-id="48318-118">Service Bus uses multiple messaging stores to store messages that are sent to queues or topics.</span></span> <span data-ttu-id="48318-119">Uma fila ou um tópico não particionado é atribuído a um repositório de mensagens.</span><span class="sxs-lookup"><span data-stu-id="48318-119">A non-partitioned queue or topic is assigned to one messaging store.</span></span> <span data-ttu-id="48318-120">Se esse repositório de mensagens não estiver disponível, todas as operações na fila ou no tópico falharão.</span><span class="sxs-lookup"><span data-stu-id="48318-120">If this messaging store is unavailable, all operations on that queue or topic will fail.</span></span>

<span data-ttu-id="48318-121">Todas as entidades de mensagens do Barramento de Serviço (filas, tópicos, retransmissões) residem em um namespace de serviço, que está associado a um datacenter.</span><span class="sxs-lookup"><span data-stu-id="48318-121">All Service Bus messaging entities (queues, topics, relays) reside in a service namespace, which is affiliated with a datacenter.</span></span> <span data-ttu-id="48318-122">O Barramento de Serviço não habilita a replicação geográfica automática de dados, nem permite que um namespace se estenda para vários data centers.</span><span class="sxs-lookup"><span data-stu-id="48318-122">Service Bus does not enable automatic geo-replication of data, nor does it allow a namespace to span multiple datacenters.</span></span>

## <a name="protecting-against-acs-outages"></a><span data-ttu-id="48318-123">Proteção contra interrupções do ACS</span><span class="sxs-lookup"><span data-stu-id="48318-123">Protecting against ACS outages</span></span>
<span data-ttu-id="48318-124">Se você estiver usando as credenciais do ACS e ele ficar indisponível, os clientes não poderão mais obter tokens.</span><span class="sxs-lookup"><span data-stu-id="48318-124">If you are using ACS credentials, and ACS becomes unavailable, clients can no longer obtain tokens.</span></span> <span data-ttu-id="48318-125">Os clientes com um token no momento em que o ACS ficar inativo poderão continuar a usar o Barramento de Serviço até que os tokens expirem.</span><span class="sxs-lookup"><span data-stu-id="48318-125">Clients that have a token at the time ACS goes down can continue to use Service Bus until the tokens expire.</span></span> <span data-ttu-id="48318-126">A vida útil do token padrão é de 3 horas.</span><span class="sxs-lookup"><span data-stu-id="48318-126">The default token lifetime is 3 hours.</span></span>

<span data-ttu-id="48318-127">Para proteger contra interrupções do ACS, use tokens de Assinatura de Acesso Compartilhado (SAS).</span><span class="sxs-lookup"><span data-stu-id="48318-127">To protect against ACS outages, use Shared Access Signature (SAS) tokens.</span></span> <span data-ttu-id="48318-128">Nesse caso, o cliente autenticará diretamente no Barramento de Serviço assinando um token sem uso com uma chave secreta.</span><span class="sxs-lookup"><span data-stu-id="48318-128">In this case, the client authenticates directly with Service Bus by signing a self-minted token with a secret key.</span></span> <span data-ttu-id="48318-129">As chamadas ao ACS não são mais necessárias.</span><span class="sxs-lookup"><span data-stu-id="48318-129">Calls to ACS are no longer required.</span></span> <span data-ttu-id="48318-130">Para saber mais sobre tokens SAS, confira [Autenticação do Barramento de Serviço][Service Bus authentication].</span><span class="sxs-lookup"><span data-stu-id="48318-130">For more information about SAS tokens, see [Service Bus authentication][Service Bus authentication].</span></span>

## <a name="protecting-queues-and-topics-against-messaging-store-failures"></a><span data-ttu-id="48318-131">Protegendo filas e tópicos contra falhas do repositório de mensagens</span><span class="sxs-lookup"><span data-stu-id="48318-131">Protecting queues and topics against messaging store failures</span></span>
<span data-ttu-id="48318-132">Uma fila ou um tópico não particionado é atribuído a um repositório de mensagens.</span><span class="sxs-lookup"><span data-stu-id="48318-132">A non-partitioned queue or topic is assigned to one messaging store.</span></span> <span data-ttu-id="48318-133">Se esse repositório de mensagens não estiver disponível, todas as operações na fila ou no tópico falharão.</span><span class="sxs-lookup"><span data-stu-id="48318-133">If this messaging store is unavailable, all operations on that queue or topic will fail.</span></span> <span data-ttu-id="48318-134">Uma fila particionada, por outro lado, consiste em vários fragmentos.</span><span class="sxs-lookup"><span data-stu-id="48318-134">A partitioned queue, on the other hand, consists of multiple fragments.</span></span> <span data-ttu-id="48318-135">Cada fragmento é armazenado em um repositório de mensagens diferente.</span><span class="sxs-lookup"><span data-stu-id="48318-135">Each fragment is stored in a different messaging store.</span></span> <span data-ttu-id="48318-136">Quando uma mensagem é enviada a uma fila ou um tópico particionado, o Barramento de Serviço atribui a mensagem a um dos fragmentos.</span><span class="sxs-lookup"><span data-stu-id="48318-136">When a message is sent to a partitioned queue or topic, Service Bus assigns the message to one of the fragments.</span></span> <span data-ttu-id="48318-137">Se o repositório de mensagens correspondente não estiver disponível, o Barramento de Serviço grava a mensagem em um fragmento diferente, se possível.</span><span class="sxs-lookup"><span data-stu-id="48318-137">If the corresponding messaging store is unavailable, Service Bus writes the message to a different fragment, if possible.</span></span> <span data-ttu-id="48318-138">Para saber mais sobre entidades particionadas, confira [Entidades de mensagens particionadas][Partitioned messaging entities].</span><span class="sxs-lookup"><span data-stu-id="48318-138">For more information about partitioned entities, see [Partitioned messaging entities][Partitioned messaging entities].</span></span>

## <a name="protecting-against-datacenter-outages-or-disasters"></a><span data-ttu-id="48318-139">Proteção contra interrupções ou desastres de datacenter</span><span class="sxs-lookup"><span data-stu-id="48318-139">Protecting against datacenter outages or disasters</span></span>
<span data-ttu-id="48318-140">Para permitir um failover entre dois datacenters, você poderá criar um namespace de serviço do Barramento de Serviço em cada datacenter.</span><span class="sxs-lookup"><span data-stu-id="48318-140">To allow for a failover between two datacenters, you can create a Service Bus service namespace in each datacenter.</span></span> <span data-ttu-id="48318-141">Por exemplo, o namespace de serviço do Barramento de Serviço **contosoPrimary.servicebus.windows.net** pode estar localizado na região Norte/Central dos Estados Unidos, e **contosoSecondary.servicebus.windows.net** pode estar localizado na região Sul/Central dos EUA.</span><span class="sxs-lookup"><span data-stu-id="48318-141">For example, the Service Bus service namespace **contosoPrimary.servicebus.windows.net** might be located in the United States North/Central region, and **contosoSecondary.servicebus.windows.net** might be located in the US South/Central region.</span></span> <span data-ttu-id="48318-142">Se uma entidade de mensagens do Barramento de Serviço tiver de permanecer acessível em caso de falha do datacenter, você poderá criar essa entidade em ambos os namespaces.</span><span class="sxs-lookup"><span data-stu-id="48318-142">If a Service Bus messaging entity must remain accessible in the presence of a datacenter outage, you can create that entity in both namespaces.</span></span>

<span data-ttu-id="48318-143">Para saber mais, confira a seção "Falha do Barramento de Serviço em um datacenter do Azure" em [Padrões de mensagens assíncronas e alta disponibilidade][Asynchronous messaging patterns and high availability].</span><span class="sxs-lookup"><span data-stu-id="48318-143">For more information, see the "Failure of Service Bus within an Azure datacenter" section in [Asynchronous messaging patterns and high availability][Asynchronous messaging patterns and high availability].</span></span>

## <a name="protecting-relay-endpoints-against-datacenter-outages-or-disasters"></a><span data-ttu-id="48318-144">Protegendo pontos de extremidade de retransmissão contra interrupções ou desastres</span><span class="sxs-lookup"><span data-stu-id="48318-144">Protecting relay endpoints against datacenter outages or disasters</span></span>
<span data-ttu-id="48318-145">A replicação geográfica de pontos de extremidade de retransmissão permite que um serviço que exponha um ponto de extremidade de retransmissão esteja acessível quando houver interrupções do Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="48318-145">Geo-replication of relay endpoints allows a service that exposes a relay endpoint to be reachable in the presence of Service Bus outages.</span></span> <span data-ttu-id="48318-146">Para obter a replicação geográfica, o serviço deverá criar dois pontos de extremidade de retransmissão em namespaces diferentes.</span><span class="sxs-lookup"><span data-stu-id="48318-146">To achieve geo-replication, the service must create two relay endpoints in different namespaces.</span></span> <span data-ttu-id="48318-147">Os namespaces devem residir em datacenters diferentes e os dois pontos de extremidade devem ter nomes diferentes.</span><span class="sxs-lookup"><span data-stu-id="48318-147">The namespaces must reside in different datacenters and the two endpoints must have different names.</span></span> <span data-ttu-id="48318-148">Por exemplo, um ponto de extremidade primário pode ser acessado em **contosoPrimary.servicebus.windows.net/myPrimaryService**, enquanto seu equivalente secundário pode ser acessado em **contosoSecondary.servicebus.windows.net/mySecondaryService**.</span><span class="sxs-lookup"><span data-stu-id="48318-148">For example, a primary endpoint can be reached under **contosoPrimary.servicebus.windows.net/myPrimaryService**, while its secondary counterpart can be reached under **contosoSecondary.servicebus.windows.net/mySecondaryService**.</span></span>

<span data-ttu-id="48318-149">O serviço escuta em ambos os pontos de extremidade e um cliente pode invocar o serviço por meio de um dos pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="48318-149">The service then listens on both endpoints, and a client can invoke the service via either endpoint.</span></span> <span data-ttu-id="48318-150">Um aplicativo cliente escolhe aleatoriamente uma das retransmissões como o ponto de extremidade primário e envia a sua solicitação ao ponto de extremidade ativo.</span><span class="sxs-lookup"><span data-stu-id="48318-150">A client application randomly picks one of the relays as the primary endpoint, and sends its request to the active endpoint.</span></span> <span data-ttu-id="48318-151">Se a operação falhar com um código de erro, essa falha indicará que o ponto de extremidade de retransmissão não está disponível.</span><span class="sxs-lookup"><span data-stu-id="48318-151">If the operation fails with an error code, this failure indicates that the relay endpoint is not available.</span></span> <span data-ttu-id="48318-152">O aplicativo abre um canal para o ponto de extremidade de backup e emite a solicitação novamente.</span><span class="sxs-lookup"><span data-stu-id="48318-152">The application opens a channel to the backup endpoint and reissues the request.</span></span> <span data-ttu-id="48318-153">Nesse ponto, os pontos de extremidade ativo e o de backup alternam as funções: o aplicativo cliente considera o ponto de extremidade ativo antigo como o novo ponto de extremidade de backup e o ponto de extremidade de backup antigo como o novo ponto de extremidade ativo.</span><span class="sxs-lookup"><span data-stu-id="48318-153">At that point the active and the backup endpoints switch roles: the client application considers the old active endpoint to be the new backup endpoint, and the old backup endpoint to be the new active endpoint.</span></span> <span data-ttu-id="48318-154">Se ambas as operações de envio falharem, as funções das duas entidades permanecerão inalteradas e um erro será retornado.</span><span class="sxs-lookup"><span data-stu-id="48318-154">If both send operations fail, the roles of the two entities remain unchanged and an error is returned.</span></span>

<span data-ttu-id="48318-155">O exemplo [Replicação geográfica com mensagens retransmitidas do Barramento de Serviço][Geo-replication with Service Bus relayed Messages] demonstra como replicar retransmissões.</span><span class="sxs-lookup"><span data-stu-id="48318-155">The [Geo-replication with Service Bus relayed messages][Geo-replication with Service Bus relayed Messages] sample demonstrates how to replicate relays.</span></span>

## <a name="protecting-queues-and-topics-against-datacenter-outages-or-disasters"></a><span data-ttu-id="48318-156">Protegendo filas e tópicos contra interrupções ou desastres do datacenter</span><span class="sxs-lookup"><span data-stu-id="48318-156">Protecting queues and topics against datacenter outages or disasters</span></span>
<span data-ttu-id="48318-157">Para obter resiliência contra interrupções de datacenter ao usar o sistema de mensagens agenciado, o Barramento de Serviço dá suporte a duas abordagens: replicação *ativa* e *passiva*.</span><span class="sxs-lookup"><span data-stu-id="48318-157">To achieve resilience against datacenter outages when using brokered messaging, Service Bus supports two approaches: *active* and *passive* replication.</span></span> <span data-ttu-id="48318-158">Para cada abordagem, se um determinado tópico ou fila deve permanecer acessível em caso de falha do datacenter, você poderá criá-lo em ambos os namespaces.</span><span class="sxs-lookup"><span data-stu-id="48318-158">For each approach, if a given queue or topic must remain accessible in the presence of a datacenter outage, you can create it in both namespaces.</span></span> <span data-ttu-id="48318-159">Ambas as entidades podem ter o mesmo nome.</span><span class="sxs-lookup"><span data-stu-id="48318-159">Both entities can have the same name.</span></span> <span data-ttu-id="48318-160">Por exemplo, uma fila primária pode ser acessada em **contosoPrimary.servicebus.windows.net/myQueue**, enquanto sua equivalente secundária pode ser acessada em **contosoSecondary.servicebus.windows.net/myQueue**.</span><span class="sxs-lookup"><span data-stu-id="48318-160">For example, a primary queue can be reached under **contosoPrimary.servicebus.windows.net/myQueue**, while its secondary counterpart can be reached under **contosoSecondary.servicebus.windows.net/myQueue**.</span></span>

<span data-ttu-id="48318-161">Se o aplicativo não exigir comunicação permanente do remetente para receptor, o aplicativo poderá implementar uma fila durável do lado do cliente para evitar a perda de mensagens e proteger o remetente de erros transitórios do Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="48318-161">If the application does not require permanent sender-to-receiver communication, the application can implement a durable client-side queue to prevent message loss and to shield the sender from any transient Service Bus errors.</span></span>

## <a name="active-replication"></a><span data-ttu-id="48318-162">Replicação ativa</span><span class="sxs-lookup"><span data-stu-id="48318-162">Active replication</span></span>
<span data-ttu-id="48318-163">A replicação ativa usa entidades em ambos os namespaces para todas as operações.</span><span class="sxs-lookup"><span data-stu-id="48318-163">Active replication uses entities in both namespaces for every operation.</span></span> <span data-ttu-id="48318-164">Qualquer cliente que enviar uma mensagem enviará duas cópias da mesma mensagem.</span><span class="sxs-lookup"><span data-stu-id="48318-164">Any client that sends a message sends two copies of the same message.</span></span> <span data-ttu-id="48318-165">A primeira cópia é enviada para a entidade principal (por exemplo, **contosoPrimary.servicebus.windows.net/sales**) e a segunda cópia da mensagem é enviada para a entidade secundária (por exemplo, **contosoSecondary.servicebus.windows.net/sales**).</span><span class="sxs-lookup"><span data-stu-id="48318-165">The first copy is sent to the primary entity (for example, **contosoPrimary.servicebus.windows.net/sales**), and the second copy of the message is sent to the secondary entity (for example, **contosoSecondary.servicebus.windows.net/sales**).</span></span>

<span data-ttu-id="48318-166">Um cliente recebe mensagens de ambas as filas.</span><span class="sxs-lookup"><span data-stu-id="48318-166">A client receives messages from both queues.</span></span> <span data-ttu-id="48318-167">O receptor processa a primeira cópia de uma mensagem e a segunda cópia é suprimida.</span><span class="sxs-lookup"><span data-stu-id="48318-167">The receiver processes the first copy of a message, and the second copy is suppressed.</span></span> <span data-ttu-id="48318-168">Para suprimir mensagens duplicadas, o remetente deverá marcar cada mensagem com um identificador exclusivo.</span><span class="sxs-lookup"><span data-stu-id="48318-168">To suppress duplicate messages, the sender must tag each message with a unique identifier.</span></span> <span data-ttu-id="48318-169">Ambas as cópias da mensagem devem ser marcadas com o mesmo identificador.</span><span class="sxs-lookup"><span data-stu-id="48318-169">Both copies of the message must be tagged with the same identifier.</span></span> <span data-ttu-id="48318-170">Você pode usar as propriedades [BrokeredMessage.MessageId][BrokeredMessage.MessageId] ou [BrokeredMessage.Label][BrokeredMessage.Label] ou uma propriedade personalizada para marcar a mensagem.</span><span class="sxs-lookup"><span data-stu-id="48318-170">You can use the [BrokeredMessage.MessageId][BrokeredMessage.MessageId] or [BrokeredMessage.Label][BrokeredMessage.Label] properties, or a custom property to tag the message.</span></span> <span data-ttu-id="48318-171">O receptor deve manter uma lista de mensagens que já recebeu.</span><span class="sxs-lookup"><span data-stu-id="48318-171">The receiver must maintain a list of messages that it has already received.</span></span>

<span data-ttu-id="48318-172">O exemplo [Replicação geográfica com mensagens agenciadas do Barramento de Serviço][Geo-replication with Service Bus Brokered Messages] demonstra a replicação ativa de entidades de mensagens.</span><span class="sxs-lookup"><span data-stu-id="48318-172">The [Geo-replication with Service Bus Brokered Messages][Geo-replication with Service Bus Brokered Messages] sample demonstrates active replication of messaging entities.</span></span>

> [!NOTE]
> <span data-ttu-id="48318-173">A abordagem de replicação ativa dobra o número de operações e, portanto, essa abordagem pode gerar custos mais altos.</span><span class="sxs-lookup"><span data-stu-id="48318-173">The active replication approach doubles the number of operations, therefore this approach can lead to higher cost.</span></span>
> 
> 

## <a name="passive-replication"></a><span data-ttu-id="48318-174">Replicação passiva</span><span class="sxs-lookup"><span data-stu-id="48318-174">Passive replication</span></span>
<span data-ttu-id="48318-175">No caso sem falhas, a replicação passiva usará apenas uma das duas entidades de mensagens.</span><span class="sxs-lookup"><span data-stu-id="48318-175">In the fault-free case, passive replication uses only one of the two messaging entities.</span></span> <span data-ttu-id="48318-176">Um cliente envia a mensagem para a entidade ativa.</span><span class="sxs-lookup"><span data-stu-id="48318-176">A client sends the message to the active entity.</span></span> <span data-ttu-id="48318-177">Se a operação na entidade ativa falhar com um código de erro que indique que o datacenter que hospeda a entidade ativa pode estar indisponível, o cliente enviará uma cópia da mensagem para a entidade de backup.</span><span class="sxs-lookup"><span data-stu-id="48318-177">If the operation on the active entity fails with an error code that indicates the datacenter that hosts the active entity might be unavailable, the client sends a copy of the message to the backup entity.</span></span> <span data-ttu-id="48318-178">Nesse ponto, as entidades ativa e a de backup alternam as funções: o aplicativo cliente considera a entidade ativa antiga como a nova entidade de backup e entidades de backup antiga como a nova entidade ativa.</span><span class="sxs-lookup"><span data-stu-id="48318-178">At that point the active and the backup entities switch roles: the sending client considers the old active entity to be the new backup entity, and the old backup entity is the new active entity.</span></span> <span data-ttu-id="48318-179">Se ambas as operações de envio falharem, as funções das duas entidades permanecerão inalteradas e um erro será retornado.</span><span class="sxs-lookup"><span data-stu-id="48318-179">If both send operations fail, the roles of the two entities remain unchanged and an error is returned.</span></span>

<span data-ttu-id="48318-180">Um cliente recebe mensagens de ambas as filas.</span><span class="sxs-lookup"><span data-stu-id="48318-180">A client receives messages from both queues.</span></span> <span data-ttu-id="48318-181">Como há uma chance de que o receptor receba duas cópias da mesma mensagem, o receptor deverá suprimir mensagens duplicadas.</span><span class="sxs-lookup"><span data-stu-id="48318-181">Because there is a chance that the receiver receives two copies of the same message, the receiver must suppress duplicate messages.</span></span> <span data-ttu-id="48318-182">Você pode suprimir duplicatas da mesma maneira como descrito para a replicação ativa.</span><span class="sxs-lookup"><span data-stu-id="48318-182">You can suppress duplicates in the same way as described for active replication.</span></span>

<span data-ttu-id="48318-183">Em geral, a replicação passiva é mais econômica do que a replicação ativa porque, na maioria dos casos, somente uma operação é executada.</span><span class="sxs-lookup"><span data-stu-id="48318-183">In general, passive replication is more economical than active replication because in most cases only one operation is performed.</span></span> <span data-ttu-id="48318-184">A latência, a taxa de transferência e o custo monetário são idênticos aos do cenário não replicado.</span><span class="sxs-lookup"><span data-stu-id="48318-184">Latency, throughput, and monetary cost are identical to the non-replicated scenario.</span></span>

<span data-ttu-id="48318-185">Quando a replicação passiva for usada, as mensagens de cenário a seguir poderão ser perdidas ou recebidas duas vezes:</span><span class="sxs-lookup"><span data-stu-id="48318-185">When using passive replication, in the following scenarios messages can be lost or received twice:</span></span>

* <span data-ttu-id="48318-186">**Perda ou atraso de mensagens**: suponha que o remetente tenha enviado com êxito uma mensagem m1 para a fila primária e então a fila ficou indisponível antes do destinatário receber m1.</span><span class="sxs-lookup"><span data-stu-id="48318-186">**Message delay or loss**: Assume that the sender successfully sent a message m1 to the primary queue, and then the queue becomes unavailable before the receiver receives m1.</span></span> <span data-ttu-id="48318-187">O remetente envia uma mensagem subsequente m2 para a fila secundária.</span><span class="sxs-lookup"><span data-stu-id="48318-187">The sender sends a subsequent message m2 to the secondary queue.</span></span> <span data-ttu-id="48318-188">Se a fila primária estiver temporariamente indisponível, o destinatário receberá m1 depois que a fila ficar disponível novamente.</span><span class="sxs-lookup"><span data-stu-id="48318-188">If the primary queue is temporarily unavailable, the receiver receives m1 after the queue becomes available again.</span></span> <span data-ttu-id="48318-189">Em caso de desastre, talvez o receptor nunca receba m1.</span><span class="sxs-lookup"><span data-stu-id="48318-189">In case of a disaster, the receiver may never receive m1.</span></span>
* <span data-ttu-id="48318-190">**Recebimento duplicado**: suponha que o remetente enviar uma mensagem m para a fila primária.</span><span class="sxs-lookup"><span data-stu-id="48318-190">**Duplicate reception**: Assume that the sender sends a message m to the primary queue.</span></span> <span data-ttu-id="48318-191">O Barramento de Serviço processa m com êxito, mas falha ao enviar uma resposta.</span><span class="sxs-lookup"><span data-stu-id="48318-191">Service Bus successfully processes m but fails to send a response.</span></span> <span data-ttu-id="48318-192">Depois que a operação de envio atingir o tempo limite, o remetente enviará uma cópia idêntica de m para a fila secundária.</span><span class="sxs-lookup"><span data-stu-id="48318-192">After the send operation times out, the sender sends an identical copy of m to the secondary queue.</span></span> <span data-ttu-id="48318-193">Se o receptor for capaz de receber a primeira cópia de m antes da fila primária ficar indisponível, o receptor receberá ambas as cópias de m aproximadamente ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="48318-193">If the receiver is able to receive the first copy of m before the primary queue becomes unavailable, the receiver receives both copies of m at approximately the same time.</span></span> <span data-ttu-id="48318-194">Se o receptor não for capaz de receber a primeira cópia de m antes da fila primária ficar indisponível, inicialmente o destinatário receberá somente a segunda cópia de m, mas depois receberá uma segunda cópia de m quando a fila primária ficar disponível.</span><span class="sxs-lookup"><span data-stu-id="48318-194">If the receiver is not able to receive the first copy of m before the primary queue becomes unavailable, the receiver initially receives only the second copy of m, but then receives a second copy of m when the primary queue becomes available.</span></span>

<span data-ttu-id="48318-195">O exemplo [Replicação geográfica com mensagens agenciadas do Barramento de Serviço][Geo-replication with Service Bus Brokered Messages] demonstra a replicação passiva de entidades de mensagens.</span><span class="sxs-lookup"><span data-stu-id="48318-195">The [Geo-replication with Service Bus brokered messages][Geo-replication with Service Bus Brokered Messages] sample demonstrates passive replication of messaging entities.</span></span>

## <a name="next-steps"></a><span data-ttu-id="48318-196">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="48318-196">Next steps</span></span>
<span data-ttu-id="48318-197">Para saber mais sobre a recuperação de desastres, confira estes artigos:</span><span class="sxs-lookup"><span data-stu-id="48318-197">To learn more about disaster recovery, see these articles:</span></span>

* <span data-ttu-id="48318-198">[Continuidade dos negócios no Banco de dados SQL do Azure][Azure SQL Database Business Continuity]</span><span class="sxs-lookup"><span data-stu-id="48318-198">[Azure SQL Database Business Continuity][Azure SQL Database Business Continuity]</span></span>
* <span data-ttu-id="48318-199">[Projetando aplicativos resilientes para Azure][Azure resiliency technical guidance]</span><span class="sxs-lookup"><span data-stu-id="48318-199">[Designing resilient applications for Azure][Azure resiliency technical guidance]</span></span>

[Service Bus Authentication]: service-bus-authentication-and-authorization.md
[Partitioned messaging entities]: service-bus-partitioning.md
[Asynchronous messaging patterns and high availability]: service-bus-async-messaging.md#failure-of-service-bus-within-an-azure-datacenter
[Geo-replication with Service Bus Relayed Messages]: http://code.msdn.microsoft.com/Geo-replication-with-16dbfecd
[BrokeredMessage.MessageId]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_MessageId
[BrokeredMessage.Label]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label
[Geo-replication with Service Bus Brokered Messages]: http://code.msdn.microsoft.com/Geo-replication-with-f5688664
[Azure SQL Database Business Continuity]: ../sql-database/sql-database-business-continuity.md
[Azure resiliency technical guidance]: /azure/architecture/resiliency
