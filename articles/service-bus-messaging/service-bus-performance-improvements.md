---
title: "Práticas recomendadas para melhorar o desempenho usando o Barramento de Serviço do Azure| Microsoft Docs"
description: "Descreve como usar o Barramento de Serviço para otimizar o desempenho na troca de mensagens agenciadas."
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: e756c15d-31fc-45c0-8df4-0bca0da10bb2
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 05/10/2017
ms.author: sethm
ms.openlocfilehash: e6a0e480f7748f12f5e566cf4059b5b2c4242c09
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="best-practices-for-performance-improvements-using-service-bus-messaging"></a><span data-ttu-id="99bb5-103">Práticas recomendadas para melhorias de desempenho usando o Sistema de Mensagens do Barramento de Serviço</span><span class="sxs-lookup"><span data-stu-id="99bb5-103">Best Practices for performance improvements using Service Bus Messaging</span></span>

<span data-ttu-id="99bb5-104">Este artigo descreve como usar o [sistema de mensagens do Barramento de Serviço do Azure](https://azure.microsoft.com/services/service-bus/) para otimizar o desempenho na troca de mensagens agenciadas.</span><span class="sxs-lookup"><span data-stu-id="99bb5-104">This article describes how to use [Azure Service Bus messaging](https://azure.microsoft.com/services/service-bus/) to optimize performance when exchanging brokered messages.</span></span> <span data-ttu-id="99bb5-105">A primeira parte deste tópico descreve os diferentes mecanismos oferecidos para ajudar a melhorar o desempenho.</span><span class="sxs-lookup"><span data-stu-id="99bb5-105">The first part of this topic describes the different mechanisms that are offered to help increase performance.</span></span> <span data-ttu-id="99bb5-106">A segunda parte oferece orientação sobre como usar o Barramento de Serviço de uma maneira que possa oferecer o melhor desempenho em um determinado cenário.</span><span class="sxs-lookup"><span data-stu-id="99bb5-106">The second part provides guidance on how to use Service Bus in a way that can offer the best performance in a given scenario.</span></span>

<span data-ttu-id="99bb5-107">Ao longo deste tópico, o termo "cliente" refere-se a qualquer entidade que acesse o Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="99bb5-107">Throughout this topic, the term "client" refers to any entity that accesses Service Bus.</span></span> <span data-ttu-id="99bb5-108">Um cliente pode assumir a função de um remetente ou de um receptor.</span><span class="sxs-lookup"><span data-stu-id="99bb5-108">A client can take the role of a sender or a receiver.</span></span> <span data-ttu-id="99bb5-109">O termo "remetente" é usado para um cliente de fila ou de tópico do Barramento de Serviço que envia mensagens para uma fila ou um tópico do Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="99bb5-109">The term "sender" is used for a Service Bus queue or topic client that sends messages to a Service Bus queue or topic.</span></span> <span data-ttu-id="99bb5-110">O termo "receptor" refere-se a um cliente de fila ou de assinatura do Barramento de Serviço que recebe mensagens de uma fila ou uma assinatura do Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="99bb5-110">The term "receiver" refers to a Service Bus queue or subscription client that receives messages from a Service Bus queue or subscription.</span></span>

<span data-ttu-id="99bb5-111">Estas seções apresentam vários conceitos usados pelo Barramento de Serviço para melhorar o desempenho.</span><span class="sxs-lookup"><span data-stu-id="99bb5-111">These sections introduce several concepts that Service Bus uses to help boost performance.</span></span>

## <a name="protocols"></a><span data-ttu-id="99bb5-112">Protocolos</span><span class="sxs-lookup"><span data-stu-id="99bb5-112">Protocols</span></span>
<span data-ttu-id="99bb5-113">O Barramento de Serviço permite que os clientes enviem e recebam mensagens por meio de um destes três protocolos:</span><span class="sxs-lookup"><span data-stu-id="99bb5-113">Service Bus enables clients to send and receive messages via one of three protocols:</span></span>

1. <span data-ttu-id="99bb5-114">Advanced Message Queuing Protocol (AMQP)</span><span class="sxs-lookup"><span data-stu-id="99bb5-114">Advanced Message Queuing Protocol (AMQP)</span></span>
2. <span data-ttu-id="99bb5-115">Protocolo do sistema de mensagens do Barramento de Serviço (SBMP)</span><span class="sxs-lookup"><span data-stu-id="99bb5-115">Service Bus Messaging Protocol (SBMP)</span></span>
3. <span data-ttu-id="99bb5-116">http</span><span class="sxs-lookup"><span data-stu-id="99bb5-116">HTTP</span></span>

<span data-ttu-id="99bb5-117">AMQP e SBMP são mais eficientes, pois mantêm a conexão com o Barramento de Serviço enquanto a fábrica do sistema de mensagens existir.</span><span class="sxs-lookup"><span data-stu-id="99bb5-117">AMQP and SBMP are more efficient, because they maintain the connection to Service Bus as long as the messaging factory exists.</span></span> <span data-ttu-id="99bb5-118">Ele também implementa o envio em lote e a pré-busca.</span><span class="sxs-lookup"><span data-stu-id="99bb5-118">It also implements batching and prefetching.</span></span> <span data-ttu-id="99bb5-119">A menos que mencionado explicitamente, todo o conteúdo deste tópico supõe o uso do AMQP ou do SBMP.</span><span class="sxs-lookup"><span data-stu-id="99bb5-119">Unless explicitly mentioned, all content in this topic assumes the use of AMQP or SBMP.</span></span>

## <a name="reusing-factories-and-clients"></a><span data-ttu-id="99bb5-120">Reutilizando fábricas e clientes</span><span class="sxs-lookup"><span data-stu-id="99bb5-120">Reusing factories and clients</span></span>
<span data-ttu-id="99bb5-121">Os objetos de cliente do Barramento de Serviço, como [QueueClient][QueueClient] ou [MessageSender][MessageSender], são criados por meio de um objeto [MessagingFactory][MessagingFactory], que também oferece gerenciamento interno de conexões.</span><span class="sxs-lookup"><span data-stu-id="99bb5-121">Service Bus client objects, such as [QueueClient][QueueClient] or [MessageSender][MessageSender], are created through a [MessagingFactory][MessagingFactory] object, which also provides internal management of connections.</span></span> <span data-ttu-id="99bb5-122">Você não deve fechar fábricas do sistema de mensagens ou os clientes de fila, de tópico e de assinatura depois de enviar uma mensagem e então recriá-los ao enviar a próxima mensagem.</span><span class="sxs-lookup"><span data-stu-id="99bb5-122">You should not close messaging factories or queue, topic, and subscription clients after you send a message, and then re-create them when you send the next message.</span></span> <span data-ttu-id="99bb5-123">Fechar uma fábrica do sistema de mensagens exclui a conexão com o serviço Barramento de Serviço e uma nova conexão é estabelecida na recriação da fábrica.</span><span class="sxs-lookup"><span data-stu-id="99bb5-123">Closing a messaging factory deletes the connection to the Service Bus service, and a new connection is established when recreating the factory.</span></span> <span data-ttu-id="99bb5-124">O estabelecimento de uma conexão é uma operação cara que você pode evitar usando a mesma fábrica e objetos de cliente para diversas operações.</span><span class="sxs-lookup"><span data-stu-id="99bb5-124">Establishing a connection is an expensive operation that you can avoid by re-using the same factory and client objects for multiple operations.</span></span> <span data-ttu-id="99bb5-125">É possível usar com segurança o objeto [QueueClient][QueueClient] para enviar mensagens de operações assíncronas simultâneas e de vários threads.</span><span class="sxs-lookup"><span data-stu-id="99bb5-125">You can safely use the [QueueClient][QueueClient] object for sending messages from concurrent asynchronous operations and multiple threads.</span></span> 

## <a name="concurrent-operations"></a><span data-ttu-id="99bb5-126">Operações simultâneas</span><span class="sxs-lookup"><span data-stu-id="99bb5-126">Concurrent operations</span></span>
<span data-ttu-id="99bb5-127">A execução de uma operação (enviar, receber, excluir etc.) leva algum tempo.</span><span class="sxs-lookup"><span data-stu-id="99bb5-127">Performing an operation (send, receive, delete, etc.) takes some time.</span></span> <span data-ttu-id="99bb5-128">Esse tempo inclui o processamento da operação pelo serviço do barramento de serviço, além da latência da solicitação e resposta.</span><span class="sxs-lookup"><span data-stu-id="99bb5-128">This time includes the processing of the operation by the Service Bus service in addition to the latency of the request and the reply.</span></span> <span data-ttu-id="99bb5-129">Para aumentar o número de operações por hora, elas devem ser executadas simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="99bb5-129">To increase the number of operations per time, operations must execute concurrently.</span></span> <span data-ttu-id="99bb5-130">Você pode fazer isso de várias maneiras diferentes:</span><span class="sxs-lookup"><span data-stu-id="99bb5-130">You can do this in several different ways:</span></span>

* <span data-ttu-id="99bb5-131">**Operações assíncronas**: o cliente agenda operações realizando operações assíncronas.</span><span class="sxs-lookup"><span data-stu-id="99bb5-131">**Asynchronous operations**: the client schedules operations by performing asynchronous operations.</span></span> <span data-ttu-id="99bb5-132">A próxima solicitação é iniciada antes que a solicitação anterior seja concluída.</span><span class="sxs-lookup"><span data-stu-id="99bb5-132">The next request is started before the previous request is completed.</span></span> <span data-ttu-id="99bb5-133">Este é um exemplo de uma operação de envio assíncrono:</span><span class="sxs-lookup"><span data-stu-id="99bb5-133">The following is an example of an asynchronous send operation:</span></span>
  
 ```csharp
  BrokeredMessage m1 = new BrokeredMessage(body);
  BrokeredMessage m2 = new BrokeredMessage(body);
  
  Task send1 = queueClient.SendAsync(m1).ContinueWith((t) => 
    {
      Console.WriteLine("Sent message #1");
    });
  Task send2 = queueClient.SendAsync(m2).ContinueWith((t) => 
    {
      Console.WriteLine("Sent message #2");
    });
  Task.WaitAll(send1, send2);
  Console.WriteLine("All messages sent");
  ```
  
  <span data-ttu-id="99bb5-134">Este é um exemplo de uma operação de recebimento assíncrono:</span><span class="sxs-lookup"><span data-stu-id="99bb5-134">This is an example of an asynchronous receive operation:</span></span>
  
  ```csharp
  Task receive1 = queueClient.ReceiveAsync().ContinueWith(ProcessReceivedMessage);
  Task receive2 = queueClient.ReceiveAsync().ContinueWith(ProcessReceivedMessage);
  
  Task.WaitAll(receive1, receive2);
  Console.WriteLine("All messages received");
  
  async void ProcessReceivedMessage(Task<BrokeredMessage> t)
  {
    BrokeredMessage m = t.Result;
    Console.WriteLine("{0} received", m.Label);
    await m.CompleteAsync();
    Console.WriteLine("{0} complete", m.Label);
  }
  ```
* <span data-ttu-id="99bb5-135">**Diversas fábricas**: todos os clientes (remetentes e receptores) criados pela mesma fábrica compartilham uma conexão TCP.</span><span class="sxs-lookup"><span data-stu-id="99bb5-135">**Multiple factories**: all clients (senders in addition to receivers) that are created by the same factory share one TCP connection.</span></span> <span data-ttu-id="99bb5-136">A taxa de transferência máxima de mensagens é limitada pelo número de operações que podem passar por essa conexão TCP.</span><span class="sxs-lookup"><span data-stu-id="99bb5-136">The maximum message throughput is limited by the number of operations that can go through this TCP connection.</span></span> <span data-ttu-id="99bb5-137">A taxa de transferência que pode ser obtida com uma única fábrica varia muito de acordo com os tempos de viagem de ida e volta do TCP e com o tamanho da mensagem.</span><span class="sxs-lookup"><span data-stu-id="99bb5-137">The throughput that can be obtained with a single factory varies greatly with TCP round-trip times and message size.</span></span> <span data-ttu-id="99bb5-138">Para obter taxas de transferência mais altas, você deverá usar diversas fábricas do sistema de mensagens.</span><span class="sxs-lookup"><span data-stu-id="99bb5-138">To obtain higher throughput rates, you should use multiple messaging factories.</span></span>

## <a name="receive-mode"></a><span data-ttu-id="99bb5-139">Modo de recebimento</span><span class="sxs-lookup"><span data-stu-id="99bb5-139">Receive mode</span></span>
<span data-ttu-id="99bb5-140">Ao criar um cliente de fila ou de assinatura, você poderá especificar um modo de recebimento: *Bloqueio de pico* ou *Receber e Excluir*.</span><span class="sxs-lookup"><span data-stu-id="99bb5-140">When creating a queue or subscription client, you can specify a receive mode: *Peek-lock* or *Receive and Delete*.</span></span> <span data-ttu-id="99bb5-141">O modo de recebimento padrão é [PeekLock][PeekLock].</span><span class="sxs-lookup"><span data-stu-id="99bb5-141">The default receive mode is [PeekLock][PeekLock].</span></span> <span data-ttu-id="99bb5-142">Ao operar nesse modo, o cliente envia uma solicitação para receber uma mensagem do Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="99bb5-142">When operating in this mode, the client sends a request to receive a message from Service Bus.</span></span> <span data-ttu-id="99bb5-143">Depois que o cliente tiver recebido a mensagem, ele enviará uma solicitação para concluir a mensagem.</span><span class="sxs-lookup"><span data-stu-id="99bb5-143">After the client has received the message, it sends a request to complete the message.</span></span>

<span data-ttu-id="99bb5-144">Ao definir o modo de recebimento como [ReceiveAndDelete][ReceiveAndDelete], as duas etapas serão combinadas em uma única solicitação.</span><span class="sxs-lookup"><span data-stu-id="99bb5-144">When setting the receive mode to [ReceiveAndDelete][ReceiveAndDelete], both steps are combined in a single request.</span></span> <span data-ttu-id="99bb5-145">Isso reduz o número total de operações e pode melhorar a taxa de transferência geral da mensagem.</span><span class="sxs-lookup"><span data-stu-id="99bb5-145">This reduces the overall number of operations, and can improve the overall message throughput.</span></span> <span data-ttu-id="99bb5-146">Este ganho de desempenho vem com o risco de perda de mensagens.</span><span class="sxs-lookup"><span data-stu-id="99bb5-146">This performance gain comes at the risk of losing messages.</span></span>

<span data-ttu-id="99bb5-147">O Barramento de Serviço não dá suporte a transações para operações de receber e excluir.</span><span class="sxs-lookup"><span data-stu-id="99bb5-147">Service Bus does not support transactions for receive-and-delete operations.</span></span> <span data-ttu-id="99bb5-148">Além disso, a semântica do bloqueio de pico é necessária para todos os cenários em que o cliente deseje adiar uma mensagem ou enviá-la para as [mensagens mortas](service-bus-dead-letter-queues.md).</span><span class="sxs-lookup"><span data-stu-id="99bb5-148">In addition, peek-lock semantics are required for any scenarios in which the client wants to defer or [dead-letter](service-bus-dead-letter-queues.md) a message.</span></span>

## <a name="client-side-batching"></a><span data-ttu-id="99bb5-149">Envio em lote no lado do cliente</span><span class="sxs-lookup"><span data-stu-id="99bb5-149">Client-side batching</span></span>
<span data-ttu-id="99bb5-150">O envio em lote no lado do cliente permite que um cliente de fila ou de tópico atrase o envio de uma mensagem por um determinado período.</span><span class="sxs-lookup"><span data-stu-id="99bb5-150">Client-side batching enables a queue or topic client to delay the sending of a message for a certain period of time.</span></span> <span data-ttu-id="99bb5-151">Se o cliente enviar mensagens adicionais durante esse período, ele transmitirá as mensagens em um único lote.</span><span class="sxs-lookup"><span data-stu-id="99bb5-151">If the client sends additional messages during this time period, it transmits the messages in a single batch.</span></span> <span data-ttu-id="99bb5-152">O envio em lote do lado do cliente também faz com que um cliente de fila ou assinatura agrupe em lote diversas solicitações **Concluir** em uma única solicitação.</span><span class="sxs-lookup"><span data-stu-id="99bb5-152">Client-side batching also causes a queue or subscription client to batch multiple **Complete** requests into a single request.</span></span> <span data-ttu-id="99bb5-153">O envio em lote está disponível apenas para operações **Enviar** e **Concluir** assíncronas.</span><span class="sxs-lookup"><span data-stu-id="99bb5-153">Batching is only available for asynchronous **Send** and **Complete** operations.</span></span> <span data-ttu-id="99bb5-154">As operações síncronas são imediatamente enviadas para o serviço Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="99bb5-154">Synchronous operations are immediately sent to the Service Bus service.</span></span> <span data-ttu-id="99bb5-155">O envio em lote não ocorre para as operações de pico ou de recebimento, e também não ocorre entre clientes.</span><span class="sxs-lookup"><span data-stu-id="99bb5-155">Batching does not occur for peek or receive operations, nor does batching occur across clients.</span></span>

<span data-ttu-id="99bb5-156">Por padrão, um cliente usa um intervalo de lote de 20 ms.</span><span class="sxs-lookup"><span data-stu-id="99bb5-156">By default, a client uses a batch interval of 20ms.</span></span> <span data-ttu-id="99bb5-157">Você pode alterar o intervalo de lote definindo a propriedade [BatchFlushInterval][BatchFlushInterval] antes de criar a fábrica de mensagens.</span><span class="sxs-lookup"><span data-stu-id="99bb5-157">You can change the batch interval by setting the [BatchFlushInterval][BatchFlushInterval] property before creating the messaging factory.</span></span> <span data-ttu-id="99bb5-158">Essa configuração afeta todos os clientes criados por essa fábrica.</span><span class="sxs-lookup"><span data-stu-id="99bb5-158">This setting affects all clients that are created by this factory.</span></span>

<span data-ttu-id="99bb5-159">Para desabilitar o envio em lote, defina a propriedade [BatchFlushInterval][BatchFlushInterval] como **TimeSpan.Zero**.</span><span class="sxs-lookup"><span data-stu-id="99bb5-159">To disable batching, set the [BatchFlushInterval][BatchFlushInterval] property to **TimeSpan.Zero**.</span></span> <span data-ttu-id="99bb5-160">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="99bb5-160">For example:</span></span>

```csharp
MessagingFactorySettings mfs = new MessagingFactorySettings();
mfs.TokenProvider = tokenProvider;
mfs.NetMessagingTransportSettings.BatchFlushInterval = TimeSpan.FromSeconds(0.05);
MessagingFactory messagingFactory = MessagingFactory.Create(namespaceUri, mfs);
```

<span data-ttu-id="99bb5-161">O envio em lote não afeta o número de operações faturáveis do sistema de mensagens e está disponível somente para o protocolo de cliente do Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="99bb5-161">Batching does not affect the number of billable messaging operations, and is available only for the Service Bus client protocol.</span></span> <span data-ttu-id="99bb5-162">O protocolo HTTP não dá suporte ao envio em lote.</span><span class="sxs-lookup"><span data-stu-id="99bb5-162">The HTTP protocol does not support batching.</span></span>

## <a name="batching-store-access"></a><span data-ttu-id="99bb5-163">Acesso ao repositório do envio em lote</span><span class="sxs-lookup"><span data-stu-id="99bb5-163">Batching store access</span></span>
<span data-ttu-id="99bb5-164">Para aumentar a taxa de transferência de uma fila, tópico ou assinatura, o Barramento de Serviço agrupa várias mensagens ao gravar em seu repositório interno.</span><span class="sxs-lookup"><span data-stu-id="99bb5-164">To increase the throughput of a queue, topic, or subscription, Service Bus batches multiple messages when it writes to its internal store.</span></span> <span data-ttu-id="99bb5-165">Se habilitada em uma fila ou tópico, a gravação de mensagens no repositório ocorrerá em lote.</span><span class="sxs-lookup"><span data-stu-id="99bb5-165">If enabled on a queue or topic, writing messages into the store will be batched.</span></span> <span data-ttu-id="99bb5-166">Se habilitada em uma fila ou assinatura, a exclusão de mensagens no repositório ocorrerá em lote.</span><span class="sxs-lookup"><span data-stu-id="99bb5-166">If enabled on a queue or subscription, deleting messages from the store will be batched.</span></span> <span data-ttu-id="99bb5-167">Se o acesso ao repositório em lote estiver habilitado para uma entidade, o Barramento de Serviço atrasará uma operação de gravação do repositório em relação àquela entidade por até 20 ms.</span><span class="sxs-lookup"><span data-stu-id="99bb5-167">If batched store access is enabled for an entity, Service Bus delays a store write operation regarding that entity by up to 20ms.</span></span> <span data-ttu-id="99bb5-168">As operações de armazenamento adicionais que ocorrerem durante esse intervalo serão adicionadas ao lote.</span><span class="sxs-lookup"><span data-stu-id="99bb5-168">Additional store operations that occur during this interval are added to the batch.</span></span> <span data-ttu-id="99bb5-169">O acesso ao repositório em lote só afetará as operações **Enviar** e **Concluir**; as operações de receber não são afetadas.</span><span class="sxs-lookup"><span data-stu-id="99bb5-169">Batched store access only affects **Send** and **Complete** operations; receive operations are not affected.</span></span> <span data-ttu-id="99bb5-170">O acesso ao repositório em lote é uma propriedade em uma entidade.</span><span class="sxs-lookup"><span data-stu-id="99bb5-170">Batched store access is a property on an entity.</span></span> <span data-ttu-id="99bb5-171">O envio em lote ocorrerá em todas as entidades que permitirem o acesso ao repositório em lote.</span><span class="sxs-lookup"><span data-stu-id="99bb5-171">Batching occurs across all entities that enable batched store access.</span></span>

<span data-ttu-id="99bb5-172">Quando uma nova fila, um novo tópico ou uma nova assinatura for criada, o acesso ao repositório em lote será habilitado por padrão.</span><span class="sxs-lookup"><span data-stu-id="99bb5-172">When creating a new queue, topic or subscription, batched store access is enabled by default.</span></span> <span data-ttu-id="99bb5-173">Para desabilitar o acesso ao repositório em lote, defina a propriedade [EnableBatchedOperations][EnableBatchedOperations] como **false** antes de criar a entidade.</span><span class="sxs-lookup"><span data-stu-id="99bb5-173">To disable batched store access, set the [EnableBatchedOperations][EnableBatchedOperations] property to **false** before creating the entity.</span></span> <span data-ttu-id="99bb5-174">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="99bb5-174">For example:</span></span>

```csharp
QueueDescription qd = new QueueDescription();
qd.EnableBatchedOperations = false;
Queue q = namespaceManager.CreateQueue(qd);
```

<span data-ttu-id="99bb5-175">O acesso ao repositório em lote não afeta o número de operações faturáveis do sistema de mensagens faturáveis e é uma propriedade de uma fila, um tópico ou uma assinatura.</span><span class="sxs-lookup"><span data-stu-id="99bb5-175">Batched store access does not affect the number of billable messaging operations, and is a property of a queue, topic, or subscription.</span></span> <span data-ttu-id="99bb5-176">É independente do modo de recebimento e do protocolo usado entre um cliente e o serviço Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="99bb5-176">It is independent of the receive mode and the protocol that is used between a client and the Service Bus service.</span></span>

## <a name="prefetching"></a><span data-ttu-id="99bb5-177">Pré-busca</span><span class="sxs-lookup"><span data-stu-id="99bb5-177">Prefetching</span></span>
<span data-ttu-id="99bb5-178">A pré-busca permite que o cliente de fila ou de assinatura carregue mensagens adicionais do serviço ao executar uma operação de recebimento.</span><span class="sxs-lookup"><span data-stu-id="99bb5-178">Prefetching enables the queue or subscription client to load additional messages from the service when it performs a receive operation.</span></span> <span data-ttu-id="99bb5-179">O cliente armazena essas mensagens em um cache local.</span><span class="sxs-lookup"><span data-stu-id="99bb5-179">The client stores these messages in a local cache.</span></span> <span data-ttu-id="99bb5-180">O tamanho do cache é determinado pelas propriedades [QueueClient.PrefetchCount][QueueClient.PrefetchCount] ou [SubscriptionClient.PrefetchCount][SubscriptionClient.PrefetchCount].</span><span class="sxs-lookup"><span data-stu-id="99bb5-180">The size of the cache is determined by the [QueueClient.PrefetchCount][QueueClient.PrefetchCount] or [SubscriptionClient.PrefetchCount][SubscriptionClient.PrefetchCount] properties.</span></span> <span data-ttu-id="99bb5-181">Cada cliente que permite a pré-busca mantém seu próprio cache.</span><span class="sxs-lookup"><span data-stu-id="99bb5-181">Each client that enables prefetching maintains its own cache.</span></span> <span data-ttu-id="99bb5-182">Um cache não é compartilhado entre os clientes.</span><span class="sxs-lookup"><span data-stu-id="99bb5-182">A cache is not shared across clients.</span></span> <span data-ttu-id="99bb5-183">Se o cliente iniciar uma operação de recebimento e se o cache estiver vazio, o serviço transmitirá um lote de mensagens.</span><span class="sxs-lookup"><span data-stu-id="99bb5-183">If the client initiates a receive operation and its cache is empty, the service transmits a batch of messages.</span></span> <span data-ttu-id="99bb5-184">O tamanho do lote é igual ao tamanho do cache ou a 256 KB, o que for menor.</span><span class="sxs-lookup"><span data-stu-id="99bb5-184">The size of the batch equals the size of the cache or 256 KB, whichever is smaller.</span></span> <span data-ttu-id="99bb5-185">Se o cliente iniciar uma operação de recebimento e se o cache contiver uma mensagem, a mensagem será retirada do cache.</span><span class="sxs-lookup"><span data-stu-id="99bb5-185">If the client initiates a receive operation and the cache contains a message, the message is taken from the cache.</span></span>

<span data-ttu-id="99bb5-186">Quando uma mensagem for pré-buscada, ela será bloqueada pelo serviço.</span><span class="sxs-lookup"><span data-stu-id="99bb5-186">When a message is prefetched, the service locks the prefetched message.</span></span> <span data-ttu-id="99bb5-187">Ao fazer isso, a mensagem pré-buscada não poderá ser recebida por um receptor diferente.</span><span class="sxs-lookup"><span data-stu-id="99bb5-187">By doing this, the prefetched message cannot be received by a different receiver.</span></span> <span data-ttu-id="99bb5-188">Se o receptor não puder concluir a mensagem antes da expiração do bloqueio, a mensagem ficará disponível para outros destinatários.</span><span class="sxs-lookup"><span data-stu-id="99bb5-188">If the receiver cannot complete the message before the lock expires, the message becomes available to other receivers.</span></span> <span data-ttu-id="99bb5-189">A cópia pré-buscada da mensagem permanecerá no cache.</span><span class="sxs-lookup"><span data-stu-id="99bb5-189">The prefetched copy of the message remains in the cache.</span></span> <span data-ttu-id="99bb5-190">O receptor que consumir a cópia armazenada em cache expirada receberá uma exceção ao tentar concluir essa mensagem.</span><span class="sxs-lookup"><span data-stu-id="99bb5-190">The receiver that consumes the expired cached copy will receive an exception when it tries to complete that message.</span></span> <span data-ttu-id="99bb5-191">Por padrão, o bloqueio da mensagem expira após 60 segundos.</span><span class="sxs-lookup"><span data-stu-id="99bb5-191">By default, the message lock expires after 60 seconds.</span></span> <span data-ttu-id="99bb5-192">Esse valor pode ser estendido para 5 minutos.</span><span class="sxs-lookup"><span data-stu-id="99bb5-192">This value can be extended to 5 minutes.</span></span> <span data-ttu-id="99bb5-193">Para impedir o consumo de mensagens expiradas, o tamanho do cache sempre deverá ser menor do que o número de mensagens que podem ser consumidas por um cliente no intervalo de tempo limite de bloqueio.</span><span class="sxs-lookup"><span data-stu-id="99bb5-193">To prevent the consumption of expired messages, the cache size should always be smaller than the number of messages that can be consumed by a client within the lock time-out interval.</span></span>

<span data-ttu-id="99bb5-194">Ao usar a expiração de bloqueio padrão de 60 segundos, um bom valor para [SubscriptionClient.PrefetchCount][SubscriptionClient.PrefetchCount] será de 20 vezes as taxas máximas de processamento de todos os receptores da fábrica.</span><span class="sxs-lookup"><span data-stu-id="99bb5-194">When using the default lock expiration of 60 seconds, a good value for [SubscriptionClient.PrefetchCount][SubscriptionClient.PrefetchCount] is 20 times the maximum processing rates of all receivers of the factory.</span></span> <span data-ttu-id="99bb5-195">Por exemplo, uma fábrica cria 3 receptores e cada receptor pode processar até 10 mensagens por segundo.</span><span class="sxs-lookup"><span data-stu-id="99bb5-195">For example, a factory creates 3 receivers, and each receiver can process up to 10 messages per second.</span></span> <span data-ttu-id="99bb5-196">A contagem de pré-busca não deve exceder 20 X 3 X 10 = 600.</span><span class="sxs-lookup"><span data-stu-id="99bb5-196">The prefetch count should not exceed 20 X 3 X 10 = 600.</span></span> <span data-ttu-id="99bb5-197">Por padrão, [QueueClient.PrefetchCount][QueueClient.PrefetchCount] é definido como 0, o que significa que nenhuma mensagem adicional será buscada do serviço.</span><span class="sxs-lookup"><span data-stu-id="99bb5-197">By default, [QueueClient.PrefetchCount][QueueClient.PrefetchCount] is set to 0, which means that no additional messages are fetched from the service.</span></span>

<span data-ttu-id="99bb5-198">A pré-busca de mensagens aumenta a taxa de transferência geral de uma fila ou uma assinatura porque reduz o número geral de operações de mensagem, ou as viagens de ida e volta.</span><span class="sxs-lookup"><span data-stu-id="99bb5-198">Prefetching messages increases the overall throughput for a queue or subscription because it reduces the overall number of message operations, or round trips.</span></span> <span data-ttu-id="99bb5-199">A busca da primeira mensagem, no entanto, demorará mais (devido ao tamanho maior da mensagem).</span><span class="sxs-lookup"><span data-stu-id="99bb5-199">Fetching the first message, however, will take longer (due to the increased message size).</span></span> <span data-ttu-id="99bb5-200">O recebimento de mensagens pré-buscadas será mais rápido porque essas mensagens já foram baixadas pelo cliente.</span><span class="sxs-lookup"><span data-stu-id="99bb5-200">Receiving prefetched messages will be faster because these messages have already been downloaded by the client.</span></span>

<span data-ttu-id="99bb5-201">A propriedade de vida útil (TTL) de uma mensagem é verificada pelo servidor no momento em que o servidor envia a mensagem para o cliente.</span><span class="sxs-lookup"><span data-stu-id="99bb5-201">The time-to-live (TTL) property of a message is checked by the server at the time the server sends the message to the client.</span></span> <span data-ttu-id="99bb5-202">O cliente não verifica a propriedade TTL da mensagem quando a mensagem é recebida.</span><span class="sxs-lookup"><span data-stu-id="99bb5-202">The client does not check the message’s TTL property when the message is received.</span></span> <span data-ttu-id="99bb5-203">Em vez disso, a mensagem poderá ser recebida mesmo se a TTL da mensagem tiver passado enquanto a mensagem estava armazenada em cache pelo cliente.</span><span class="sxs-lookup"><span data-stu-id="99bb5-203">Instead, the message can be received even if the message’s TTL has passed while the message was cached by the client.</span></span>

<span data-ttu-id="99bb5-204">A pré-busca não afeta o número de operações faturáveis do sistema de mensagens e está disponível somente para o protocolo de cliente do Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="99bb5-204">Prefetching does not affect the number of billable messaging operations, and is available only for the Service Bus client protocol.</span></span> <span data-ttu-id="99bb5-205">O protocolo HTTP não dá suporte à pré-busca.</span><span class="sxs-lookup"><span data-stu-id="99bb5-205">The HTTP protocol does not support prefetching.</span></span> <span data-ttu-id="99bb5-206">A pré-busca está disponível para as operações de recebimento síncrono e assíncrono.</span><span class="sxs-lookup"><span data-stu-id="99bb5-206">Prefetching is available for both synchronous and asynchronous receive operations.</span></span>

## <a name="express-queues-and-topics"></a><span data-ttu-id="99bb5-207">Filas e tópicos expressos</span><span class="sxs-lookup"><span data-stu-id="99bb5-207">Express queues and topics</span></span>

<span data-ttu-id="99bb5-208">As entidades expressas possibilitam cenários de redução da latência e alta produtividade e têm suporte apenas na camada de mensagens Standard.</span><span class="sxs-lookup"><span data-stu-id="99bb5-208">Express entities enable high throughput and reduced latency scenarios, and are supported only in the Standard messaging tier.</span></span> <span data-ttu-id="99bb5-209">As entidades criadas em [namespaces Premium](service-bus-premium-messaging.md) não dão suporte à opção expressa.</span><span class="sxs-lookup"><span data-stu-id="99bb5-209">Entities created in [Premium namespaces](service-bus-premium-messaging.md) do not support the express option.</span></span> <span data-ttu-id="99bb5-210">Com as entidades expressas, caso uma mensagem seja enviada para uma fila ou um tópico, ela não será armazenada imediatamente no repositório de mensagens.</span><span class="sxs-lookup"><span data-stu-id="99bb5-210">With express entities, if a message is sent to a queue or topic, the message is not immediately stored in the messaging store.</span></span> <span data-ttu-id="99bb5-211">Em vez disso, ela será armazenada em cache na memória.</span><span class="sxs-lookup"><span data-stu-id="99bb5-211">Instead, it is cached in memory.</span></span> <span data-ttu-id="99bb5-212">Se uma mensagem permanecer na fila por mais de alguns segundos, será automaticamente gravada em armazenamento estável, que o protegerá contra perda devido a uma interrupção.</span><span class="sxs-lookup"><span data-stu-id="99bb5-212">If a message remains in the queue for more than a few seconds, it is automatically written to stable storage, thus protecting it against loss due to an outage.</span></span> <span data-ttu-id="99bb5-213">A gravação da mensagem em um cache de memória aumenta a taxa de transferência e reduz a latência porque não há nenhum acesso ao armazenamento estável no momento em que a mensagem é enviada.</span><span class="sxs-lookup"><span data-stu-id="99bb5-213">Writing the message into a memory cache increases throughput and reduces latency because there is no access to stable storage at the time the message is sent.</span></span> <span data-ttu-id="99bb5-214">As mensagens consumidas em alguns segundos não são gravadas no repositório de mensagens.</span><span class="sxs-lookup"><span data-stu-id="99bb5-214">Messages that are consumed within a few seconds are not written to the messaging store.</span></span> <span data-ttu-id="99bb5-215">O exemplo a seguir cria um tópico expresso.</span><span class="sxs-lookup"><span data-stu-id="99bb5-215">The following example creates an express topic.</span></span>

```csharp
TopicDescription td = new TopicDescription(TopicName);
td.EnableExpress = true;
namespaceManager.CreateTopic(td);
```

<span data-ttu-id="99bb5-216">Se uma mensagem com informações importantes que não devem ser perdidas for enviada para uma entidade expressa, o remetente poderá impor o Barramento de Serviço para persistir imediatamente a mensagem em armazenamento estável ao definir a propriedade [ForcePersistence][ForcePersistence] como **true**.</span><span class="sxs-lookup"><span data-stu-id="99bb5-216">If a message containing critical information that must not be lost is sent to an express entity, the sender can force Service Bus to immediately persist the message to stable storage by setting the [ForcePersistence][ForcePersistence] property to **true**.</span></span>

> [!NOTE]
> <span data-ttu-id="99bb5-217">As entidades expressas não dão suporte a transações.</span><span class="sxs-lookup"><span data-stu-id="99bb5-217">Express entities do not support transactions.</span></span>

## <a name="use-of-partitioned-queues-or-topics"></a><span data-ttu-id="99bb5-218">Uso de filas ou tópicos particionados</span><span class="sxs-lookup"><span data-stu-id="99bb5-218">Use of partitioned queues or topics</span></span>
<span data-ttu-id="99bb5-219">Internamente, o Barramento de Serviço usa o mesmo nó e o repositório de mensagens para processar e armazenar todas as mensagens para uma entidade de mensagens (fila ou tópico).</span><span class="sxs-lookup"><span data-stu-id="99bb5-219">Internally, Service Bus uses the same node and messaging store to process and store all messages for a messaging entity (queue or topic).</span></span> <span data-ttu-id="99bb5-220">Uma fila ou tópico particionado, por outro lado, é distribuído entre vários nós e repositórios de mensagens.</span><span class="sxs-lookup"><span data-stu-id="99bb5-220">A partitioned queue or topic, on the other hand, is distributed across multiple nodes and messaging stores.</span></span> <span data-ttu-id="99bb5-221">As filas e tópicos particionados não só geram uma taxa de transferência mais alta do que as filas e os tópicos normais, como também exibem disponibilidade superior.</span><span class="sxs-lookup"><span data-stu-id="99bb5-221">Partitioned queues and topics not only yield a higher throughput than regular queues and topics, they also exhibit superior availability.</span></span> <span data-ttu-id="99bb5-222">Para criar uma entidade particionada, defina a propriedade [EnablePartitioning][EnablePartitioning] como **true**, como mostrado no exemplo a seguir.</span><span class="sxs-lookup"><span data-stu-id="99bb5-222">To create a partitioned entity, set the [EnablePartitioning][EnablePartitioning] property to **true**, as shown in the following example.</span></span> <span data-ttu-id="99bb5-223">Para obter mais informações sobre entidades particionadas, veja as [Entidades de Mensagens Particionadas][Partitioned messaging entities].</span><span class="sxs-lookup"><span data-stu-id="99bb5-223">For more information about partitioned entities, see [Partitioned messaging entities][Partitioned messaging entities].</span></span>

```csharp
// Create partitioned queue.
QueueDescription qd = new QueueDescription(QueueName);
qd.EnablePartitioning = true;
namespaceManager.CreateQueue(qd);
```

## <a name="use-of-multiple-queues"></a><span data-ttu-id="99bb5-224">Uso de várias filas</span><span class="sxs-lookup"><span data-stu-id="99bb5-224">Use of multiple queues</span></span>

<span data-ttu-id="99bb5-225">Se não for possível usar uma fila ou tópico particionado, ou se a carga esperada não puder ser manipulada por uma única fila ou tópico particionada, você deverá usar várias entidades de mensagens.</span><span class="sxs-lookup"><span data-stu-id="99bb5-225">If it is not possible to use a partitioned queue or topic, or the expected load cannot be handled by a single partitioned queue or topic, you must use multiple messaging entities.</span></span> <span data-ttu-id="99bb5-226">Ao usar várias entidades, crie um cliente dedicado para cada entidade em vez de usar o mesmo cliente para todas as entidades.</span><span class="sxs-lookup"><span data-stu-id="99bb5-226">When using multiple entities, create a dedicated client for each entity, instead of using the same client for all entities.</span></span>

## <a name="development-and-testing-features"></a><span data-ttu-id="99bb5-227">Recursos de desenvolvimento e teste</span><span class="sxs-lookup"><span data-stu-id="99bb5-227">Development and testing features</span></span>

<span data-ttu-id="99bb5-228">O Barramento de Serviço tem um recurso usado especificamente para desenvolvimento que **nunca deve ser usado em configurações de produção**: [TopicDescription.EnableFilteringMessagesBeforePublishing][].</span><span class="sxs-lookup"><span data-stu-id="99bb5-228">Service Bus has one feature that is used specifically for development which **should never be used in production configurations**: [TopicDescription.EnableFilteringMessagesBeforePublishing][].</span></span>

<span data-ttu-id="99bb5-229">Quando novas regras ou filtros são adicionados ao tópico, é possível usar [TopicDescription.EnableFilteringMessagesBeforePublishing][] para verificar se a nova expressão de filtro está funcionando conforme o esperado.</span><span class="sxs-lookup"><span data-stu-id="99bb5-229">When new rules or filters are added to the topic, you can use [TopicDescription.EnableFilteringMessagesBeforePublishing][] to verify that the new filter expression is working as expected.</span></span>

## <a name="scenarios"></a><span data-ttu-id="99bb5-230">Cenários</span><span class="sxs-lookup"><span data-stu-id="99bb5-230">Scenarios</span></span>
<span data-ttu-id="99bb5-231">As seções a seguir descrevem cenários típicos de mensagens e as configurações preferenciais do Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="99bb5-231">The following sections describe typical messaging scenarios and outline the preferred Service Bus settings.</span></span> <span data-ttu-id="99bb5-232">As taxas de transferência são classificadas como pequena (menos de 1 mensagem/segundo), moderada (1 mensagem/segundo ou mais, mas menos de 100 mensagens por segundo) e alta (100 mensagens/segundo ou mais).</span><span class="sxs-lookup"><span data-stu-id="99bb5-232">Throughput rates are classified as small (less than 1 message/second), moderate (1 message/second or greater but less than 100 messages/second) and high (100 messages/second or greater).</span></span> <span data-ttu-id="99bb5-233">O número de clientes é classificado como pequeno (5 ou menos), moderado (de 5 a 20) e grande (mais de 20).</span><span class="sxs-lookup"><span data-stu-id="99bb5-233">The number of clients are classified as small (5 or fewer), moderate (more than 5 but less than or equal to 20), and large (more than 20).</span></span>

### <a name="high-throughput-queue"></a><span data-ttu-id="99bb5-234">Fila de alta taxa de transferência</span><span class="sxs-lookup"><span data-stu-id="99bb5-234">High-throughput queue</span></span>
<span data-ttu-id="99bb5-235">Meta: maximizar a taxa de transferência de uma única fila.</span><span class="sxs-lookup"><span data-stu-id="99bb5-235">Goal: Maximize the throughput of a single queue.</span></span> <span data-ttu-id="99bb5-236">O número de remetentes e de receptores é pequeno.</span><span class="sxs-lookup"><span data-stu-id="99bb5-236">The number of senders and receivers is small.</span></span>

* <span data-ttu-id="99bb5-237">Use uma fila particionada para obter desempenho e disponibilidade aprimorados.</span><span class="sxs-lookup"><span data-stu-id="99bb5-237">Use a partitioned queue for improved performance and availability.</span></span>
* <span data-ttu-id="99bb5-238">Para aumentar a taxa geral de envio para a fila, use diversas fábricas de mensagens para criar remetentes.</span><span class="sxs-lookup"><span data-stu-id="99bb5-238">To increase the overall send rate into the queue, use multiple message factories to create senders.</span></span> <span data-ttu-id="99bb5-239">Para cada remetente, use operações assíncronas ou vários threads.</span><span class="sxs-lookup"><span data-stu-id="99bb5-239">For each sender, use asynchronous operations or multiple threads.</span></span>
* <span data-ttu-id="99bb5-240">Para aumentar a taxa geral de recebimento da fila, use diversas fábricas de mensagens para criar receptores.</span><span class="sxs-lookup"><span data-stu-id="99bb5-240">To increase the overall receive rate from the queue, use multiple message factories to create receivers.</span></span>
* <span data-ttu-id="99bb5-241">Use operações assíncronas para tirar proveito do envio em lote no lado do cliente.</span><span class="sxs-lookup"><span data-stu-id="99bb5-241">Use asynchronous operations to take advantage of client-side batching.</span></span>
* <span data-ttu-id="99bb5-242">Defina o intervalo de envio em lote como 50 ms para reduzir o número de transmissões de protocolo de cliente do Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="99bb5-242">Set the batching interval to 50ms to reduce the number of Service Bus client protocol transmissions.</span></span> <span data-ttu-id="99bb5-243">Se forem usados vários remetentes, aumente o intervalo de envio em lote para 100 ms.</span><span class="sxs-lookup"><span data-stu-id="99bb5-243">If multiple senders are used, increase the batching interval to 100ms.</span></span>
* <span data-ttu-id="99bb5-244">Deixe o acesso ao repositório em lote habilitado.</span><span class="sxs-lookup"><span data-stu-id="99bb5-244">Leave batched store access enabled.</span></span> <span data-ttu-id="99bb5-245">Isso aumenta a taxa geral em que as mensagens podem ser gravadas na fila.</span><span class="sxs-lookup"><span data-stu-id="99bb5-245">This increases the overall rate at which messages can be written into the queue.</span></span>
* <span data-ttu-id="99bb5-246">Defina a contagem de pré-busca como 20 vezes as taxas máximas de processamento de todos os receptores de uma fábrica.</span><span class="sxs-lookup"><span data-stu-id="99bb5-246">Set the prefetch count to 20 times the maximum processing rates of all receivers of a factory.</span></span> <span data-ttu-id="99bb5-247">Isso reduz o número de transmissões de protocolo de cliente do Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="99bb5-247">This reduces the number of Service Bus client protocol transmissions.</span></span>

### <a name="multiple-high-throughput-queues"></a><span data-ttu-id="99bb5-248">Várias filas de alta taxa de transferência</span><span class="sxs-lookup"><span data-stu-id="99bb5-248">Multiple high-throughput queues</span></span>
<span data-ttu-id="99bb5-249">Meta: maximize a taxa de transferência geral de diversas filas.</span><span class="sxs-lookup"><span data-stu-id="99bb5-249">Goal: Maximize overall throughput of multiple queues.</span></span> <span data-ttu-id="99bb5-250">A taxa de transferência de uma fila individual é moderada ou alta.</span><span class="sxs-lookup"><span data-stu-id="99bb5-250">The throughput of an individual queue is moderate or high.</span></span>

<span data-ttu-id="99bb5-251">Para obter a taxa de transferência máxima em várias filas, use as configurações descritas para maximizar a taxa de transferência de uma única fila.</span><span class="sxs-lookup"><span data-stu-id="99bb5-251">To obtain maximum throughput across multiple queues, use the settings outlined to maximize the throughput of a single queue.</span></span> <span data-ttu-id="99bb5-252">Além disso, use fábricas diferentes para criar clientes que enviem ou recebam de filas diferentes.</span><span class="sxs-lookup"><span data-stu-id="99bb5-252">In addition, use different factories to create clients that send or receive from different queues.</span></span>

### <a name="low-latency-queue"></a><span data-ttu-id="99bb5-253">Fila de baixa latência</span><span class="sxs-lookup"><span data-stu-id="99bb5-253">Low latency queue</span></span>
<span data-ttu-id="99bb5-254">Meta: minimize a latência de ponta a ponta de uma fila ou um tópico.</span><span class="sxs-lookup"><span data-stu-id="99bb5-254">Goal: Minimize end-to-end latency of a queue or topic.</span></span> <span data-ttu-id="99bb5-255">O número de remetentes e de receptores é pequeno.</span><span class="sxs-lookup"><span data-stu-id="99bb5-255">The number of senders and receivers is small.</span></span> <span data-ttu-id="99bb5-256">A taxa de transferência da fila é pequena ou moderada.</span><span class="sxs-lookup"><span data-stu-id="99bb5-256">The throughput of the queue is small or moderate.</span></span>

* <span data-ttu-id="99bb5-257">Use uma fila particionada para obter disponibilidade aprimorada.</span><span class="sxs-lookup"><span data-stu-id="99bb5-257">Use a partitioned queue for improved availability.</span></span>
* <span data-ttu-id="99bb5-258">Desabilite o envio em lote no lado do cliente.</span><span class="sxs-lookup"><span data-stu-id="99bb5-258">Disable client-side batching.</span></span> <span data-ttu-id="99bb5-259">O cliente envia uma mensagem imediatamente.</span><span class="sxs-lookup"><span data-stu-id="99bb5-259">The client immediately sends a message.</span></span>
* <span data-ttu-id="99bb5-260">Desabilite o acesso ao repositório em lote.</span><span class="sxs-lookup"><span data-stu-id="99bb5-260">Disable batched store access.</span></span> <span data-ttu-id="99bb5-261">O serviço grava imediatamente a mensagem no repositório.</span><span class="sxs-lookup"><span data-stu-id="99bb5-261">The service immediately writes the message to the store.</span></span>
* <span data-ttu-id="99bb5-262">Se estiver usando um único cliente, defina a contagem de pré-busca como 20 vezes a taxa de processamento do receptor.</span><span class="sxs-lookup"><span data-stu-id="99bb5-262">If using a single client, set the prefetch count to 20 times the processing rate of the receiver.</span></span> <span data-ttu-id="99bb5-263">Se várias mensagens chegarem à fila ao mesmo tempo, o protocolo de cliente do Barramento de Serviço transmite todas ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="99bb5-263">If multiple messages arrive at the queue at the same time, the Service Bus client protocol transmits them all at the same time.</span></span> <span data-ttu-id="99bb5-264">Quando o cliente receber a próxima mensagem, essa mensagem já estará no cache local.</span><span class="sxs-lookup"><span data-stu-id="99bb5-264">When the client receives the next message, that message is already in the local cache.</span></span> <span data-ttu-id="99bb5-265">O cache deve ser pequeno.</span><span class="sxs-lookup"><span data-stu-id="99bb5-265">The cache should be small.</span></span>
* <span data-ttu-id="99bb5-266">Se você estiver usando vários clientes, defina a contagem de pré-busca como 0.</span><span class="sxs-lookup"><span data-stu-id="99bb5-266">If using multiple clients, set the prefetch count to 0.</span></span> <span data-ttu-id="99bb5-267">Ao fazer isso, o segundo cliente poderá receber a segunda mensagem enquanto o primeiro cliente ainda estiver processando a primeira mensagem.</span><span class="sxs-lookup"><span data-stu-id="99bb5-267">By doing this, the second client can receive the second message while the first client is still processing the first message.</span></span>

### <a name="queue-with-a-large-number-of-senders"></a><span data-ttu-id="99bb5-268">Fila com um grande número de remetentes</span><span class="sxs-lookup"><span data-stu-id="99bb5-268">Queue with a large number of senders</span></span>
<span data-ttu-id="99bb5-269">Meta: maximizar a taxa de transferência de uma fila ou tópico com um grande número de remetentes.</span><span class="sxs-lookup"><span data-stu-id="99bb5-269">Goal: Maximize throughput of a queue or topic with a large number of senders.</span></span> <span data-ttu-id="99bb5-270">Cada remetente envia mensagens com uma taxa moderada.</span><span class="sxs-lookup"><span data-stu-id="99bb5-270">Each sender sends messages with a moderate rate.</span></span> <span data-ttu-id="99bb5-271">O número de receptores é pequeno.</span><span class="sxs-lookup"><span data-stu-id="99bb5-271">The number of receivers is small.</span></span>

<span data-ttu-id="99bb5-272">O Barramento de Serviço permite até 1000 conexões simultâneas a uma entidade do sistema de mensagens (ou 5000 usando AMQP).</span><span class="sxs-lookup"><span data-stu-id="99bb5-272">Service Bus enables up to 1000 concurrent connections to a messaging entity (or 5000 using AMQP).</span></span> <span data-ttu-id="99bb5-273">Esse limite é imposto no nível de namespace e tópicos/filas/assinaturas são controlados pelo limite de conexões simultâneas por namespace.</span><span class="sxs-lookup"><span data-stu-id="99bb5-273">This limit is enforced at the namespace level, and queues/topics/subscriptions are capped by the limit of concurrent connections per namespace.</span></span> <span data-ttu-id="99bb5-274">Para filas, esse número é compartilhado entre remetentes e receptores.</span><span class="sxs-lookup"><span data-stu-id="99bb5-274">For queues, this number is shared between senders and receivers.</span></span> <span data-ttu-id="99bb5-275">Se todas as 1000 conexões forem obrigatórias para os remetentes, você deverá substituir a fila por um tópico e uma única assinatura.</span><span class="sxs-lookup"><span data-stu-id="99bb5-275">If all 1000 connections are required for senders, you should replace the queue with a topic and a single subscription.</span></span> <span data-ttu-id="99bb5-276">Um tópico aceita até 1000 conexões simultâneas dos remetentes, enquanto a assinatura aceita 1000 conexões simultâneas adicionais dos receptores.</span><span class="sxs-lookup"><span data-stu-id="99bb5-276">A topic accepts up to 1000 concurrent connections from senders, whereas the subscription accepts an additional 1000 concurrent connections from receivers.</span></span> <span data-ttu-id="99bb5-277">Se mais de 1000 remetentes simultâneos forem necessários, os remetentes deverão enviar mensagens para o protocolo do Barramento de Serviço via HTTP.</span><span class="sxs-lookup"><span data-stu-id="99bb5-277">If more than 1000 concurrent senders are required, the senders should send messages to the Service Bus protocol via HTTP.</span></span>

<span data-ttu-id="99bb5-278">Para maximizar a taxa de transferência, faça o seguinte:</span><span class="sxs-lookup"><span data-stu-id="99bb5-278">To maximize throughput, do the following:</span></span>

* <span data-ttu-id="99bb5-279">Use uma fila particionada para obter desempenho e disponibilidade aprimorados.</span><span class="sxs-lookup"><span data-stu-id="99bb5-279">Use a partitioned queue for improved performance and availability.</span></span>
* <span data-ttu-id="99bb5-280">Se cada remetente residir em um processo diferente, use somente uma única fábrica por processo.</span><span class="sxs-lookup"><span data-stu-id="99bb5-280">If each sender resides in a different process, use only a single factory per process.</span></span>
* <span data-ttu-id="99bb5-281">Use operações assíncronas para tirar proveito do envio em lote no lado do cliente.</span><span class="sxs-lookup"><span data-stu-id="99bb5-281">Use asynchronous operations to take advantage of client-side batching.</span></span>
* <span data-ttu-id="99bb5-282">Use o intervalo de lote padrão de 20 ms para reduzir o número de transmissões de protocolo de cliente do Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="99bb5-282">Use the default batching interval of 20ms to reduce the number of Service Bus client protocol transmissions.</span></span>
* <span data-ttu-id="99bb5-283">Deixe o acesso ao repositório em lote habilitado.</span><span class="sxs-lookup"><span data-stu-id="99bb5-283">Leave batched store access enabled.</span></span> <span data-ttu-id="99bb5-284">Isso aumenta a taxa geral em que as mensagens podem ser gravadas na fila ou no tópico.</span><span class="sxs-lookup"><span data-stu-id="99bb5-284">This increases the overall rate at which messages can be written into the queue or topic.</span></span>
* <span data-ttu-id="99bb5-285">Defina a contagem de pré-busca como 20 vezes as taxas máximas de processamento de todos os receptores de uma fábrica.</span><span class="sxs-lookup"><span data-stu-id="99bb5-285">Set the prefetch count to 20 times the maximum processing rates of all receivers of a factory.</span></span> <span data-ttu-id="99bb5-286">Isso reduz o número de transmissões de protocolo de cliente do Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="99bb5-286">This reduces the number of Service Bus client protocol transmissions.</span></span>

### <a name="queue-with-a-large-number-of-receivers"></a><span data-ttu-id="99bb5-287">Fila com um grande número de receptores</span><span class="sxs-lookup"><span data-stu-id="99bb5-287">Queue with a large number of receivers</span></span>
<span data-ttu-id="99bb5-288">Meta: maximizar a taxa de recebimento de uma fila ou de uma assinatura com um grande número de receptores.</span><span class="sxs-lookup"><span data-stu-id="99bb5-288">Goal: Maximize the receive rate of a queue or subscription with a large number of receivers.</span></span> <span data-ttu-id="99bb5-289">Cada receptor recebe mensagens a uma taxa moderada.</span><span class="sxs-lookup"><span data-stu-id="99bb5-289">Each receiver receives messages at a moderate rate.</span></span> <span data-ttu-id="99bb5-290">O número de remetentes é pequeno.</span><span class="sxs-lookup"><span data-stu-id="99bb5-290">The number of senders is small.</span></span>

<span data-ttu-id="99bb5-291">O Barramento de Serviço permite até 1000 conexões simultâneas a uma entidade.</span><span class="sxs-lookup"><span data-stu-id="99bb5-291">Service Bus enables up to 1000 concurrent connections to an entity.</span></span> <span data-ttu-id="99bb5-292">Se uma fila exigir mais de 1000 receptores, você deverá substituir a fila por um tópico e várias assinaturas.</span><span class="sxs-lookup"><span data-stu-id="99bb5-292">If a queue requires more than 1000 receivers, you should replace the queue with a topic and multiple subscriptions.</span></span> <span data-ttu-id="99bb5-293">Cada assinatura pode dar suporte a até 1000 conexões simultâneas.</span><span class="sxs-lookup"><span data-stu-id="99bb5-293">Each subscription can support up to 1000 concurrent connections.</span></span> <span data-ttu-id="99bb5-294">Como alternativa, os receptores poderão acessar a fila por meio do protocolo HTTP.</span><span class="sxs-lookup"><span data-stu-id="99bb5-294">Alternatively, receivers can access the queue via the HTTP protocol.</span></span>

<span data-ttu-id="99bb5-295">Para maximizar a taxa de transferência, faça o seguinte:</span><span class="sxs-lookup"><span data-stu-id="99bb5-295">To maximize throughput, do the following:</span></span>

* <span data-ttu-id="99bb5-296">Use uma fila particionada para obter desempenho e disponibilidade aprimorados.</span><span class="sxs-lookup"><span data-stu-id="99bb5-296">Use a partitioned queue for improved performance and availability.</span></span>
* <span data-ttu-id="99bb5-297">Se cada receptor residir em um processo diferente, use somente uma única fábrica por processo.</span><span class="sxs-lookup"><span data-stu-id="99bb5-297">If each receiver resides in a different process, use only a single factory per process.</span></span>
* <span data-ttu-id="99bb5-298">Os receptores poderão usar operações síncronas ou assíncronas.</span><span class="sxs-lookup"><span data-stu-id="99bb5-298">Receivers can use synchronous or asynchronous operations.</span></span> <span data-ttu-id="99bb5-299">Dada a taxa de recebimento moderada de um receptor individual, o envio em lote no lado do cliente de uma solicitação Concluir não afetará a taxa de transferência do receptor.</span><span class="sxs-lookup"><span data-stu-id="99bb5-299">Given the moderate receive rate of an individual receiver, client-side batching of a Complete request does not affect receiver throughput.</span></span>
* <span data-ttu-id="99bb5-300">Deixe o acesso ao repositório em lote habilitado.</span><span class="sxs-lookup"><span data-stu-id="99bb5-300">Leave batched store access enabled.</span></span> <span data-ttu-id="99bb5-301">Isso reduz a carga geral da entidade.</span><span class="sxs-lookup"><span data-stu-id="99bb5-301">This reduces the overall load of the entity.</span></span> <span data-ttu-id="99bb5-302">Isso também reduz a taxa geral em que as mensagens podem ser gravadas na fila ou no tópico.</span><span class="sxs-lookup"><span data-stu-id="99bb5-302">It also reduces the overall rate at which messages can be written into the queue or topic.</span></span>
* <span data-ttu-id="99bb5-303">Defina a contagem de pré-busca como um valor pequeno (por exemplo, PrefetchCount = 10).</span><span class="sxs-lookup"><span data-stu-id="99bb5-303">Set the prefetch count to a small value (for example, PrefetchCount = 10).</span></span> <span data-ttu-id="99bb5-304">Isso impede que os receptores fiquem ociosos enquanto outros receptores tenham grandes quantidades de mensagens armazenadas em cache.</span><span class="sxs-lookup"><span data-stu-id="99bb5-304">This prevents receivers from being idle while other receivers have large numbers of messages cached.</span></span>

### <a name="topic-with-a-small-number-of-subscriptions"></a><span data-ttu-id="99bb5-305">Tópico com um pequeno número de assinaturas</span><span class="sxs-lookup"><span data-stu-id="99bb5-305">Topic with a small number of subscriptions</span></span>
<span data-ttu-id="99bb5-306">Meta: maximizar a taxa de transferência de um tópico com um pequeno número de assinaturas.</span><span class="sxs-lookup"><span data-stu-id="99bb5-306">Goal: Maximize the throughput of a topic with a small number of subscriptions.</span></span> <span data-ttu-id="99bb5-307">Uma mensagem é recebida por muitas assinaturas, o que significa que a taxa de recebimento combinada em todas as assinaturas é maior do que a taxa de envio.</span><span class="sxs-lookup"><span data-stu-id="99bb5-307">A message is received by many subscriptions, which means the combined receive rate over all subscriptions is larger than the send rate.</span></span> <span data-ttu-id="99bb5-308">O número de remetentes é pequeno.</span><span class="sxs-lookup"><span data-stu-id="99bb5-308">The number of senders is small.</span></span> <span data-ttu-id="99bb5-309">O número de receptores por assinatura é pequeno.</span><span class="sxs-lookup"><span data-stu-id="99bb5-309">The number of receivers per subscription is small.</span></span>

<span data-ttu-id="99bb5-310">Para maximizar a taxa de transferência, faça o seguinte:</span><span class="sxs-lookup"><span data-stu-id="99bb5-310">To maximize throughput, do the following:</span></span>

* <span data-ttu-id="99bb5-311">Use um tópico particionado para obter desempenho e disponibilidade aprimorados.</span><span class="sxs-lookup"><span data-stu-id="99bb5-311">Use a partitioned topic for improved performance and availability.</span></span>
* <span data-ttu-id="99bb5-312">Para aumentar a taxa geral de envio para o tópico, use diversas fábricas de mensagens para criar remetentes.</span><span class="sxs-lookup"><span data-stu-id="99bb5-312">To increase the overall send rate into the topic, use multiple message factories to create senders.</span></span> <span data-ttu-id="99bb5-313">Para cada remetente, use operações assíncronas ou vários threads.</span><span class="sxs-lookup"><span data-stu-id="99bb5-313">For each sender, use asynchronous operations or multiple threads.</span></span>
* <span data-ttu-id="99bb5-314">Para aumentar a taxa geral de recebimento de uma assinatura, use diversas fábricas de mensagens para criar receptores.</span><span class="sxs-lookup"><span data-stu-id="99bb5-314">To increase the overall receive rate from a subscription, use multiple message factories to create receivers.</span></span> <span data-ttu-id="99bb5-315">Para cada receptor, use operações assíncronas ou vários threads.</span><span class="sxs-lookup"><span data-stu-id="99bb5-315">For each receiver, use asynchronous operations or multiple threads.</span></span>
* <span data-ttu-id="99bb5-316">Use operações assíncronas para tirar proveito do envio em lote no lado do cliente.</span><span class="sxs-lookup"><span data-stu-id="99bb5-316">Use asynchronous operations to take advantage of client-side batching.</span></span>
* <span data-ttu-id="99bb5-317">Use o intervalo de lote padrão de 20 ms para reduzir o número de transmissões de protocolo de cliente do Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="99bb5-317">Use the default batching interval of 20ms to reduce the number of Service Bus client protocol transmissions.</span></span>
* <span data-ttu-id="99bb5-318">Deixe o acesso ao repositório em lote habilitado.</span><span class="sxs-lookup"><span data-stu-id="99bb5-318">Leave batched store access enabled.</span></span> <span data-ttu-id="99bb5-319">Isso aumenta a taxa geral em que as mensagens podem ser gravadas no tópico.</span><span class="sxs-lookup"><span data-stu-id="99bb5-319">This increases the overall rate at which messages can be written into the topic.</span></span>
* <span data-ttu-id="99bb5-320">Defina a contagem de pré-busca como 20 vezes as taxas máximas de processamento de todos os receptores de uma fábrica.</span><span class="sxs-lookup"><span data-stu-id="99bb5-320">Set the prefetch count to 20 times the maximum processing rates of all receivers of a factory.</span></span> <span data-ttu-id="99bb5-321">Isso reduz o número de transmissões de protocolo de cliente do Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="99bb5-321">This reduces the number of Service Bus client protocol transmissions.</span></span>

### <a name="topic-with-a-large-number-of-subscriptions"></a><span data-ttu-id="99bb5-322">Tópico com um grande número de assinaturas</span><span class="sxs-lookup"><span data-stu-id="99bb5-322">Topic with a large number of subscriptions</span></span>
<span data-ttu-id="99bb5-323">Meta: maximizar a taxa de transferência de um tópico com um grande número de assinaturas.</span><span class="sxs-lookup"><span data-stu-id="99bb5-323">Goal: Maximize the throughput of a topic with a large number of subscriptions.</span></span> <span data-ttu-id="99bb5-324">Uma mensagem é recebida por várias assinaturas, o que significa que a taxa de recebimento combinada em todas as assinaturas é muito maior do que a taxa de envio.</span><span class="sxs-lookup"><span data-stu-id="99bb5-324">A message is received by many subscriptions, which means the combined receive rate over all subscriptions is much larger than the send rate.</span></span> <span data-ttu-id="99bb5-325">O número de remetentes é pequeno.</span><span class="sxs-lookup"><span data-stu-id="99bb5-325">The number of senders is small.</span></span> <span data-ttu-id="99bb5-326">O número de receptores por assinatura é pequeno.</span><span class="sxs-lookup"><span data-stu-id="99bb5-326">The number of receivers per subscription is small.</span></span>

<span data-ttu-id="99bb5-327">Os tópicos com um grande número de assinaturas normalmente terão uma taxa de transferência geral baixa se todas as mensagens forem roteadas a todas as assinaturas.</span><span class="sxs-lookup"><span data-stu-id="99bb5-327">Topics with a large number of subscriptions typically expose a low overall throughput if all messages are routed to all subscriptions.</span></span> <span data-ttu-id="99bb5-328">Isso é causado pelo fato de que cada mensagem é recebida várias vezes e todas as mensagens contidas em um tópico e todas as suas assinaturas são armazenadas no mesmo repositório.</span><span class="sxs-lookup"><span data-stu-id="99bb5-328">This is caused by the fact that each message is received many times, and all messages that are contained in a topic and all its subscriptions are stored in the same store.</span></span> <span data-ttu-id="99bb5-329">Supõe-se que o número de remetentes e o número de receptores por assinatura é baixo.</span><span class="sxs-lookup"><span data-stu-id="99bb5-329">It is assumed that the number of senders and number of receivers per subscription is small.</span></span> <span data-ttu-id="99bb5-330">O Barramento de Serviço dá suporte a até 2.000 assinaturas por tópico.</span><span class="sxs-lookup"><span data-stu-id="99bb5-330">Service Bus supports up to 2,000 subscriptions per topic.</span></span>

<span data-ttu-id="99bb5-331">Para maximizar a taxa de transferência, faça o seguinte:</span><span class="sxs-lookup"><span data-stu-id="99bb5-331">To maximize throughput, do the following:</span></span>

* <span data-ttu-id="99bb5-332">Use um tópico particionado para obter desempenho e disponibilidade aprimorados.</span><span class="sxs-lookup"><span data-stu-id="99bb5-332">Use a partitioned topic for improved performance and availability.</span></span>
* <span data-ttu-id="99bb5-333">Use operações assíncronas para tirar proveito do envio em lote no lado do cliente.</span><span class="sxs-lookup"><span data-stu-id="99bb5-333">Use asynchronous operations to take advantage of client-side batching.</span></span>
* <span data-ttu-id="99bb5-334">Use o intervalo de lote padrão de 20 ms para reduzir o número de transmissões de protocolo de cliente do Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="99bb5-334">Use the default batching interval of 20ms to reduce the number of Service Bus client protocol transmissions.</span></span>
* <span data-ttu-id="99bb5-335">Deixe o acesso ao repositório em lote habilitado.</span><span class="sxs-lookup"><span data-stu-id="99bb5-335">Leave batched store access enabled.</span></span> <span data-ttu-id="99bb5-336">Isso aumenta a taxa geral em que as mensagens podem ser gravadas no tópico.</span><span class="sxs-lookup"><span data-stu-id="99bb5-336">This increases the overall rate at which messages can be written into the topic.</span></span>
* <span data-ttu-id="99bb5-337">Defina a contagem de pré-busca como 20 vezes a taxa de recebimento esperada em segundos.</span><span class="sxs-lookup"><span data-stu-id="99bb5-337">Set the prefetch count to 20 times the expected receive rate in seconds.</span></span> <span data-ttu-id="99bb5-338">Isso reduz o número de transmissões de protocolo de cliente do Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="99bb5-338">This reduces the number of Service Bus client protocol transmissions.</span></span>

## <a name="next-steps"></a><span data-ttu-id="99bb5-339">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="99bb5-339">Next steps</span></span>
<span data-ttu-id="99bb5-340">Para saber mais sobre como otimizar o desempenho do Barramento de Serviço, veja [Entidades de mensagens particionadas][Partitioned messaging entities].</span><span class="sxs-lookup"><span data-stu-id="99bb5-340">To learn more about optimizing Service Bus performance, see [Partitioned messaging entities][Partitioned messaging entities].</span></span>

[QueueClient]: /dotnet/api/microsoft.servicebus.messaging.queueclient
[MessageSender]: /dotnet/api/microsoft.servicebus.messaging.messagesender
[MessagingFactory]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory
[PeekLock]: /dotnet/api/microsoft.servicebus.messaging.receivemode
[ReceiveAndDelete]: /dotnet/api/microsoft.servicebus.messaging.receivemode
[BatchFlushInterval]: /dotnet/api/microsoft.servicebus.messaging.netmessagingtransportsettings.batchflushinterval#Microsoft_ServiceBus_Messaging_NetMessagingTransportSettings_BatchFlushInterval
[EnableBatchedOperations]: /dotnet/api/microsoft.servicebus.messaging.queuedescription.enablebatchedoperations#Microsoft_ServiceBus_Messaging_QueueDescription_EnableBatchedOperations
[QueueClient.PrefetchCount]: /dotnet/api/microsoft.servicebus.messaging.queueclient.prefetchcount#Microsoft_ServiceBus_Messaging_QueueClient_PrefetchCount
[SubscriptionClient.PrefetchCount]: /dotnet/api/microsoft.servicebus.messaging.subscriptionclient.prefetchcount#Microsoft_ServiceBus_Messaging_SubscriptionClient_PrefetchCount
[ForcePersistence]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage.forcepersistence#Microsoft_ServiceBus_Messaging_BrokeredMessage_ForcePersistence
[EnablePartitioning]: /dotnet/api/microsoft.servicebus.messaging.queuedescription.enablepartitioning#Microsoft_ServiceBus_Messaging_QueueDescription_EnablePartitioning
[Partitioned messaging entities]: service-bus-partitioning.md
<span data-ttu-id="99bb5-341">[TopicDescription.EnableFilteringMessagesBeforePublishing]: /dotnet/api/microsoft.servicebus.messaging.topicdescription.enablefilteringmessagesbeforepublishing#Microsoft_ServiceBus_Messaging_TopicDescription_EnableFilteringMessagesBeforePublishing</span><span class="sxs-lookup"><span data-stu-id="99bb5-341">[TopicDescription.EnableFilteringMessagesBeforePublishing]: /dotnet/api/microsoft.servicebus.messaging.topicdescription.enablefilteringmessagesbeforepublishing#Microsoft_ServiceBus_Messaging_TopicDescription_EnableFilteringMessagesBeforePublishing</span></span>
