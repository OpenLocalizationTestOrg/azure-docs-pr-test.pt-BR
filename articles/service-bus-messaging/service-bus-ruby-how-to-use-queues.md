---
title: aaaHow toouse Azure Service Bus filas com Ruby | Microsoft Docs
description: "Saiba como filas de toouse barramento de serviço no Azure. Exemplos de códigos escritos em Ruby."
services: service-bus-messaging
documentationcenter: ruby
author: sethmanheim
manager: timlt
editor: 
ms.assetid: 0a11eab2-823f-4cc7-842b-fbbe0f953751
ms.service: service-bus-messaging
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: ruby
ms.topic: article
ms.date: 08/10/2017
ms.author: sethm
ms.openlocfilehash: 7270154583f98e3372e82efbb967ea7a5acd1686
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="how-toouse-service-bus-queues-with-ruby"></a><span data-ttu-id="de44b-104">Como toouse Service Bus filas com Ruby</span><span class="sxs-lookup"><span data-stu-id="de44b-104">How toouse Service Bus queues with Ruby</span></span>

[!INCLUDE [service-bus-selector-queues](../../includes/service-bus-selector-queues.md)]

<span data-ttu-id="de44b-105">Este guia descreve como as filas do barramento de serviço toouse.</span><span class="sxs-lookup"><span data-stu-id="de44b-105">This guide describes how toouse Service Bus queues.</span></span> <span data-ttu-id="de44b-106">exemplos de saudação são escritos em Ruby e usam Olá gem do Azure.</span><span class="sxs-lookup"><span data-stu-id="de44b-106">hello samples are written in Ruby and use hello Azure gem.</span></span> <span data-ttu-id="de44b-107">Olá cenários abordados incluem **Criando filas, enviando e recebendo mensagens**, e **excluindo filas**.</span><span class="sxs-lookup"><span data-stu-id="de44b-107">hello scenarios covered include **creating queues, sending and receiving messages**, and **deleting queues**.</span></span> <span data-ttu-id="de44b-108">Para obter mais informações sobre as filas do barramento de serviço, consulte Olá [próximas etapas](#next-steps) seção.</span><span class="sxs-lookup"><span data-stu-id="de44b-108">For more information about Service Bus queues, see hello [Next Steps](#next-steps) section.</span></span>

[!INCLUDE [howto-service-bus-queues](../../includes/howto-service-bus-queues.md)]

[!INCLUDE [service-bus-create-namespace-portal](../../includes/service-bus-create-namespace-portal.md)]
   
[!INCLUDE [service-bus-ruby-setup](../../includes/service-bus-ruby-setup.md)]

## <a name="how-toocreate-a-queue"></a><span data-ttu-id="de44b-109">Como toocreate uma fila</span><span class="sxs-lookup"><span data-stu-id="de44b-109">How toocreate a queue</span></span>
<span data-ttu-id="de44b-110">Olá **Azure::ServiceBusService** objeto permite que você toowork com filas.</span><span class="sxs-lookup"><span data-stu-id="de44b-110">hello **Azure::ServiceBusService** object enables you toowork with queues.</span></span> <span data-ttu-id="de44b-111">toocreate uma fila, use Olá `create_queue()` método.</span><span class="sxs-lookup"><span data-stu-id="de44b-111">toocreate a queue, use hello `create_queue()` method.</span></span> <span data-ttu-id="de44b-112">Olá exemplo a seguir cria uma fila ou imprime os erros.</span><span class="sxs-lookup"><span data-stu-id="de44b-112">hello following example creates a queue or prints out any errors.</span></span>

```ruby
azure_service_bus_service = Azure::ServiceBus::ServiceBusService.new(sb_host, { signer: signer})
begin
  queue = azure_service_bus_service.create_queue("test-queue")
rescue
  puts $!
end
```

<span data-ttu-id="de44b-113">Você também pode passar um **Azure::ServiceBus::Queue** do objeto com opções adicionais, que permite toooverride Olá fila as configurações padrão, como tamanho de fila toolive ou máximo de tempo de mensagem.</span><span class="sxs-lookup"><span data-stu-id="de44b-113">You can also pass a **Azure::ServiceBus::Queue** object with additional options, which enables you toooverride hello default queue settings, such as message time toolive or maximum queue size.</span></span> <span data-ttu-id="de44b-114">saudação de exemplo a seguir mostra como tooset Olá GB de too5 de tamanho máximo da fila e too1 toolive minutos de tempo:</span><span class="sxs-lookup"><span data-stu-id="de44b-114">hello following example shows how tooset hello maximum queue size too5 GB and time toolive too1 minute:</span></span>

```ruby
queue = Azure::ServiceBus::Queue.new("test-queue")
queue.max_size_in_megabytes = 5120
queue.default_message_time_to_live = "PT1M"

queue = azure_service_bus_service.create_queue(queue)
```

## <a name="how-toosend-messages-tooa-queue"></a><span data-ttu-id="de44b-115">Como toosend mensagens de fila de tooa</span><span class="sxs-lookup"><span data-stu-id="de44b-115">How toosend messages tooa queue</span></span>
<span data-ttu-id="de44b-116">toosend uma fila de barramento de serviço tooa mensagens, o aplicativo chama Olá `send_queue_message()` método hello **Azure::ServiceBusService** objeto.</span><span class="sxs-lookup"><span data-stu-id="de44b-116">toosend a message tooa Service Bus queue, your application calls hello `send_queue_message()` method on hello **Azure::ServiceBusService** object.</span></span> <span data-ttu-id="de44b-117">Mensagens enviadas muito (e recebidas pelo) barramento de serviço filas são **Azure::ServiceBus::BrokeredMessage** objetos e tem um conjunto de propriedades padrão (como `label` e `time_to_live`), um dicionário que é usado toohold propriedades específicas do aplicativo personalizadas e um corpo de dados arbitrários do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="de44b-117">Messages sent too(and received from) Service Bus queues are **Azure::ServiceBus::BrokeredMessage** objects, and have a set of standard properties (such as `label` and `time_to_live`), a dictionary that is used toohold custom application-specific properties, and a body of arbitrary application data.</span></span> <span data-ttu-id="de44b-118">Um aplicativo pode definir o corpo de saudação da mensagem de saudação, passando um valor de cadeia de caracteres como mensagem de saudação e as propriedades padrão são preenchidas com valores padrão.</span><span class="sxs-lookup"><span data-stu-id="de44b-118">An application can set hello body of hello message by passing a string value as hello message and any required standard properties are populated with default values.</span></span>

<span data-ttu-id="de44b-119">Olá exemplo a seguir demonstra como toosend uma fila de toohello de mensagens de teste chamado `test-queue` usando `send_queue_message()`:</span><span class="sxs-lookup"><span data-stu-id="de44b-119">hello following example demonstrates how toosend a test message toohello queue named `test-queue` using `send_queue_message()`:</span></span>

```ruby
message = Azure::ServiceBus::BrokeredMessage.new("test queue message")
message.correlation_id = "test-correlation-id"
azure_service_bus_service.send_queue_message("test-queue", message)
```

<span data-ttu-id="de44b-120">Filas do barramento de serviço de suportam a um tamanho máximo de 256 KB em Olá [camada padrão](service-bus-premium-messaging.md) e 1 MB de saudação [camada Premium](service-bus-premium-messaging.md).</span><span class="sxs-lookup"><span data-stu-id="de44b-120">Service Bus queues support a maximum message size of 256 KB in hello [Standard tier](service-bus-premium-messaging.md) and 1 MB in hello [Premium tier](service-bus-premium-messaging.md).</span></span> <span data-ttu-id="de44b-121">cabeçalho de saudação, que inclui o padrão de saudação e propriedades de aplicativo personalizado, pode ter um tamanho máximo de 64 KB.</span><span class="sxs-lookup"><span data-stu-id="de44b-121">hello header, which includes hello standard and custom application properties, can have a maximum size of 64 KB.</span></span> <span data-ttu-id="de44b-122">Não há nenhum limite no número de saudação da mantidas em uma fila de mensagens, mas há um limite no tamanho total de saudação da mantidas por uma fila de mensagens de saudação.</span><span class="sxs-lookup"><span data-stu-id="de44b-122">There is no limit on hello number of messages held in a queue but there is a cap on hello total size of hello messages held by a queue.</span></span> <span data-ttu-id="de44b-123">O tamanho da fila é definido no momento da criação, com um limite superior de 5 GB.</span><span class="sxs-lookup"><span data-stu-id="de44b-123">This queue size is defined at creation time, with an upper limit of 5 GB.</span></span>

## <a name="how-tooreceive-messages-from-a-queue"></a><span data-ttu-id="de44b-124">Como tooreceive mensagens de uma fila</span><span class="sxs-lookup"><span data-stu-id="de44b-124">How tooreceive messages from a queue</span></span>
<span data-ttu-id="de44b-125">As mensagens são recebidas de uma fila usando Olá `receive_queue_message()` método hello **Azure::ServiceBusService** objeto.</span><span class="sxs-lookup"><span data-stu-id="de44b-125">Messages are received from a queue using hello `receive_queue_message()` method on hello **Azure::ServiceBusService** object.</span></span> <span data-ttu-id="de44b-126">Por padrão, mensagens são lidos e bloqueadas sem que sejam excluídas da fila de saudação.</span><span class="sxs-lookup"><span data-stu-id="de44b-126">By default, messages are read and locked without being deleted from hello queue.</span></span> <span data-ttu-id="de44b-127">No entanto, você pode excluir as mensagens da fila de saudação conforme eles são lidos por configuração Olá `:peek_lock` opção muito**false**.</span><span class="sxs-lookup"><span data-stu-id="de44b-127">However, you can delete messages from hello queue as they are read by setting hello `:peek_lock` option too**false**.</span></span>

<span data-ttu-id="de44b-128">comportamento padrão de saudação torna Olá ler e excluir uma operação de duas etapas, que também torna possível toosupport aplicativos que não podem tolerar mensagens ausentes.</span><span class="sxs-lookup"><span data-stu-id="de44b-128">hello default behavior makes hello reading and deleting a two-stage operation, which also makes it possible toosupport applications that cannot tolerate missing messages.</span></span> <span data-ttu-id="de44b-129">Quando o barramento de serviço recebe uma solicitação, ele localiza Olá próxima mensagem toobe consumida, boqueia-tooprevent outros consumidores a recebam e retorna toohello aplicativo.</span><span class="sxs-lookup"><span data-stu-id="de44b-129">When Service Bus receives a request, it finds hello next message toobe consumed, locks it tooprevent other consumers receiving it, and then returns it toohello application.</span></span> <span data-ttu-id="de44b-130">Depois que o aplicativo hello termina de processar a mensagem de saudação (ou armazena com segurança para processamento futuro), ele conclui Olá segunda etapa de saudação processo de recebimento chamando `delete_queue_message()` método e fornecendo toobe de mensagem de saudação excluído como um parâmetro.</span><span class="sxs-lookup"><span data-stu-id="de44b-130">After hello application finishes processing hello message (or stores it reliably for future processing), it completes hello second stage of hello receive process by calling `delete_queue_message()` method and providing hello message toobe deleted as a parameter.</span></span> <span data-ttu-id="de44b-131">Olá `delete_queue_message()` método será marcar a mensagem de saudação como sendo consumida e removê-la da fila de saudação.</span><span class="sxs-lookup"><span data-stu-id="de44b-131">hello `delete_queue_message()` method will mark hello message as being consumed and remove it from hello queue.</span></span>

<span data-ttu-id="de44b-132">Se hello `:peek_lock` parâmetro está definido muito**false**, ler e excluir a mensagem de saudação torna-se o modelo mais simples de saudação e funciona melhor nos cenários em que um aplicativo pode tolerar não processar uma mensagem no evento de saudação de um Falha.</span><span class="sxs-lookup"><span data-stu-id="de44b-132">If hello `:peek_lock` parameter is set too**false**, reading and deleting hello message becomes hello simplest model, and works best for scenarios in which an application can tolerate not processing a message in hello event of a failure.</span></span> <span data-ttu-id="de44b-133">toounderstand isso, considere um cenário em que problemas do consumidor Olá Olá receber a solicitação e falha antes de processá-lo.</span><span class="sxs-lookup"><span data-stu-id="de44b-133">toounderstand this, consider a scenario in which hello consumer issues hello receive request and then crashes before processing it.</span></span> <span data-ttu-id="de44b-134">Porque o barramento de serviço marcou a mensagem de saudação como sendo consumida, quando o aplicativo hello reinicia e começa a consumir mensagens novamente, ele terá perdido mensagem de saudação foi consumido falha toohello anterior.</span><span class="sxs-lookup"><span data-stu-id="de44b-134">Because Service Bus has marked hello message as being consumed, when hello application restarts and begins consuming messages again, it will have missed hello message that was consumed prior toohello crash.</span></span>

<span data-ttu-id="de44b-135">Olá exemplo a seguir demonstra como tooreceive e processar mensagens usando `receive_queue_message()`.</span><span class="sxs-lookup"><span data-stu-id="de44b-135">hello following example demonstrates how tooreceive and process messages using `receive_queue_message()`.</span></span> <span data-ttu-id="de44b-136">exemplo Hello primeiro recebe e exclui uma mensagem usando `:peek_lock` definido muito**false**, receber outra mensagem e, em seguida, exclui hello usando `delete_queue_message()`:</span><span class="sxs-lookup"><span data-stu-id="de44b-136">hello example first receives and deletes a message by using `:peek_lock` set too**false**, then it receives another message and then deletes hello message using `delete_queue_message()`:</span></span>

```ruby
message = azure_service_bus_service.receive_queue_message("test-queue",
  { :peek_lock => false })
message = azure_service_bus_service.receive_queue_message("test-queue")
azure_service_bus_service.delete_queue_message(message)
```

## <a name="how-toohandle-application-crashes-and-unreadable-messages"></a><span data-ttu-id="de44b-137">Como o aplicativo de toohandle falha e mensagens ilegíveis</span><span class="sxs-lookup"><span data-stu-id="de44b-137">How toohandle application crashes and unreadable messages</span></span>
<span data-ttu-id="de44b-138">Barramento de serviço fornece funcionalidade toohelp que normalmente recuperar de erros no seu aplicativo ou dificuldade para processar uma mensagem.</span><span class="sxs-lookup"><span data-stu-id="de44b-138">Service Bus provides functionality toohelp you gracefully recover from errors in your application or difficulties processing a message.</span></span> <span data-ttu-id="de44b-139">Se um aplicativo receptor não puder tooprocess Olá mensagem por algum motivo, em seguida, pode chamar hello `unlock_queue_message()` método hello **Azure::ServiceBusService** objeto.</span><span class="sxs-lookup"><span data-stu-id="de44b-139">If a receiver application is unable tooprocess hello message for some reason, then it can call hello `unlock_queue_message()` method on hello **Azure::ServiceBusService** object.</span></span> <span data-ttu-id="de44b-140">Essa chamada faz com que hello de toounlock de barramento de serviço de mensagens na fila de saudação e torná-lo disponível toobe recebida novamente, ou por Olá mesmo aplicativo ou por outro aplicativo de consumo de consumo.</span><span class="sxs-lookup"><span data-stu-id="de44b-140">This call causes Service Bus toounlock hello message within hello queue and make it available toobe received again, either by hello same consuming application or by another consuming application.</span></span>

<span data-ttu-id="de44b-141">Também há um tempo limite associado a uma mensagem bloqueada em fila hello e se a mensagem de saudação tooprocess antes de falha de aplicativo hello Olá bloqueio tempo limite expirar (por exemplo, se o aplicativo hello falhar), e a mensagem de saudação desbloqueia o barramento de serviço automaticamente e o torna disponível toobe recebida novamente.</span><span class="sxs-lookup"><span data-stu-id="de44b-141">There is also a timeout associated with a message locked within hello queue, and if hello application fails tooprocess hello message before hello lock timeout expires (for example, if hello application crashes), then Service Bus unlocks hello message automatically and makes it available toobe received again.</span></span>

<span data-ttu-id="de44b-142">Em Olá evento Olá aplicativo falha após o processamento de mensagem de saudação, mas antes de saudação `delete_queue_message()` método é chamado, mensagem de saudação será entregue novamente toohello aplicativo quando ele for reiniciado.</span><span class="sxs-lookup"><span data-stu-id="de44b-142">In hello event that hello application crashes after processing hello message but before hello `delete_queue_message()` method is called, then hello message is redelivered toohello application when it restarts.</span></span> <span data-ttu-id="de44b-143">Esse processo é geralmente chamado *, pelo menos, após processamento*; ou seja, cada mensagem é processada pelo menos uma vez, mas em certo Olá situações mesma mensagem pode ser entregue novamente.</span><span class="sxs-lookup"><span data-stu-id="de44b-143">This process is often called *At Least Once Processing*; that is, each message is processed at least once but in certain situations hello same message may be redelivered.</span></span> <span data-ttu-id="de44b-144">Se o cenário de saudação não puder tolerar o processamento duplicado, os desenvolvedores de aplicativos devem adicionar entrega de mensagens duplicadas lógica adicional tootheir aplicativos toohandle.</span><span class="sxs-lookup"><span data-stu-id="de44b-144">If hello scenario cannot tolerate duplicate processing, then application developers should add additional logic tootheir application toohandle duplicate message delivery.</span></span> <span data-ttu-id="de44b-145">Isso geralmente é obtido usando Olá `message_id` propriedade da mensagem de saudação, que permanece constante entre tentativas de entrega.</span><span class="sxs-lookup"><span data-stu-id="de44b-145">This is often achieved using hello `message_id` property of hello message, which remains constant across delivery attempts.</span></span>

## <a name="next-steps"></a><span data-ttu-id="de44b-146">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="de44b-146">Next steps</span></span>
<span data-ttu-id="de44b-147">Agora que você aprendeu as Noções básicas de saudação de filas do barramento de serviço, siga essas toolearn links mais.</span><span class="sxs-lookup"><span data-stu-id="de44b-147">Now that you've learned hello basics of Service Bus queues, follow these links toolearn more.</span></span>

* <span data-ttu-id="de44b-148">Visão geral de [filas, tópicos e assinaturas](service-bus-queues-topics-subscriptions.md).</span><span class="sxs-lookup"><span data-stu-id="de44b-148">Overview of [queues, topics, and subscriptions](service-bus-queues-topics-subscriptions.md).</span></span>
* <span data-ttu-id="de44b-149">Visite Olá [SDK do Azure para Ruby](https://github.com/Azure/azure-sdk-for-ruby) repositório no GitHub.</span><span class="sxs-lookup"><span data-stu-id="de44b-149">Visit hello [Azure SDK for Ruby](https://github.com/Azure/azure-sdk-for-ruby) repository on GitHub.</span></span>

<span data-ttu-id="de44b-150">Para obter uma comparação entre filas do barramento de serviço do Azure Olá discutidas neste artigo e Azure discutidos Olá [como toouse armazenamento de fila do Ruby](../storage/queues/storage-ruby-how-to-use-queue-storage.md) do artigo, consulte [filas do Azure e filas do Azure Service Bus - comparadas e diferenças](service-bus-azure-and-service-bus-queues-compared-contrasted.md)</span><span class="sxs-lookup"><span data-stu-id="de44b-150">For a comparison between hello Azure Service Bus queues discussed in this article and Azure Queues discussed in hello [How toouse Queue storage from Ruby](../storage/queues/storage-ruby-how-to-use-queue-storage.md) article, see [Azure Queues and Azure Service Bus Queues - Compared and Contrasted](service-bus-azure-and-service-bus-queues-compared-contrasted.md)</span></span>

