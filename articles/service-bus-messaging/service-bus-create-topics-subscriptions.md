---
title: "Criar aplicativos que usam os tópicos e as assinaturas do Barramento de Serviço do Azure | Microsoft Docs"
description: "Introdução às funcionalidades de publicação/assinatura oferecidas pelos tópicos e pelas assinaturas do Barramento de Serviço."
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: a48fc9b0-b7b0-464e-8187-a517bf8b4eb4
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/07/2017
ms.author: sethm
ms.openlocfilehash: eb01120ce9578f716e5381c107faa93f0b36e358
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/18/2017
---
# <a name="create-applications-that-use-service-bus-topics-and-subscriptions"></a><span data-ttu-id="2e973-103">Criar aplicativos que usam os tópicos e as assinaturas do Barramento de Serviço</span><span class="sxs-lookup"><span data-stu-id="2e973-103">Create applications that use Service Bus topics and subscriptions</span></span>
<span data-ttu-id="2e973-104">O Barramento de Serviço do Azure oferece suporte a um conjunto de tecnologias middleware orientado a mensagens, baseado em nuvem, incluindo o serviço de enfileiramento de mensagens confiável e o sistema de mensagens de publicação/assinatura durável.</span><span class="sxs-lookup"><span data-stu-id="2e973-104">Azure Service Bus supports a set of cloud-based, message-oriented middleware technologies including reliable message queuing and durable publish/subscribe messaging.</span></span> <span data-ttu-id="2e973-105">Este artigo baseia-se nas informações fornecidas em [Criar aplicativos que usam as filas do Barramento de Serviço](service-bus-create-queues.md) e oferece uma introdução às funcionalidades de publicação/assinatura oferecidas pelos tópicos do Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="2e973-105">This article builds on the information provided in [Create applications that use Service Bus queues](service-bus-create-queues.md) and offers an introduction to the publish/subscribe capabilities offered by Service Bus topics.</span></span>

## <a name="evolving-retail-scenario"></a><span data-ttu-id="2e973-106">Cenário de varejo em evolução</span><span class="sxs-lookup"><span data-stu-id="2e973-106">Evolving retail scenario</span></span>
<span data-ttu-id="2e973-107">Este artigo continua o cenário de varejo usado em [Criar aplicativos que usem filas do Barramento de Serviço](service-bus-create-queues.md).</span><span class="sxs-lookup"><span data-stu-id="2e973-107">This article continues the retail scenario used in [Create applications that use Service Bus queues](service-bus-create-queues.md).</span></span> <span data-ttu-id="2e973-108">Relembre os dados de vendas de terminais de Ponto de Venda (PDV) individuais devem ser roteados para um sistema de gerenciamento de estoque que usa esses dados para determinar quando o estoque deverá ser reposto.</span><span class="sxs-lookup"><span data-stu-id="2e973-108">Recall that sales data from individual Point of Sale (POS) terminals must be routed to an inventory management system which uses that data to determine when stock has to be replenished.</span></span> <span data-ttu-id="2e973-109">Cada terminal de PDV relata seus dados de vendas enviando mensagens para a fila **DataCollectionQueue**, onde permanecem até que sejam recebidas pelo sistema de gerenciamento de estoque, como mostrado aqui:</span><span class="sxs-lookup"><span data-stu-id="2e973-109">Each POS terminal reports its sales data by sending messages to the **DataCollectionQueue** queue, where they remain until they are received by the inventory management system, as shown here:</span></span>

![Barramento de Serviço 1](./media/service-bus-create-topics-subscriptions/IC657161.gif)

<span data-ttu-id="2e973-111">Para desenvolver este cenário, um novo requisito foi adicionado ao sistema: o proprietário da loja deseja ser capaz de monitorar como está o desempenho da loja em tempo real.</span><span class="sxs-lookup"><span data-stu-id="2e973-111">To evolve this scenario, a new requirement has been added to the system: the store owner wants to be able to monitor how the store is performing in real time.</span></span>

<span data-ttu-id="2e973-112">Para atender a esse requisito, o sistema deverá desativar o fluxo de dados de vendas.</span><span class="sxs-lookup"><span data-stu-id="2e973-112">To address this requirement, the system must "tap" off the sales data stream.</span></span> <span data-ttu-id="2e973-113">Ainda queremos que cada mensagem enviada por terminais de PDV seja enviada para o sistema de gerenciamento de estoque como antes, mas queremos outra cópia de cada mensagem que podemos usar para apresentar o modo de exibição de painel para o proprietário da loja.</span><span class="sxs-lookup"><span data-stu-id="2e973-113">We still want each message sent by the POS terminals to be sent to the inventory management system as before, but we want another copy of each message that we can use to present the dashboard view to the store owner.</span></span>

<span data-ttu-id="2e973-114">Em qualquer situação como essa, na qual você exige que cada mensagem seja consumida por várias partes, é possível usar os *tópicos* do Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="2e973-114">In any situation such as this, in which you require each message to be consumed by multiple parties, you can use Service Bus *topics*.</span></span> <span data-ttu-id="2e973-115">Os tópicos fornecem um padrão de publicação/assinatura na qual cada mensagem publicada é disponibilizada para uma ou mais assinaturas registradas no tópico.</span><span class="sxs-lookup"><span data-stu-id="2e973-115">Topics provide a publish/subscribe pattern in which each published message is made available to one or more subscriptions registered with the topic.</span></span> <span data-ttu-id="2e973-116">Por outro lado, com as filas, cada mensagem é recebida por um único consumidor.</span><span class="sxs-lookup"><span data-stu-id="2e973-116">In contrast, with queues each message is received by a single consumer.</span></span>

<span data-ttu-id="2e973-117">As mensagens são enviadas para um tópico da mesma maneira como são enviadas para uma fila.</span><span class="sxs-lookup"><span data-stu-id="2e973-117">Messages are sent to a topic in the same way as they are sent to a queue.</span></span> <span data-ttu-id="2e973-118">No entanto, as mensagens não são recebidas do tópico diretamente; elas são recebidas de assinaturas.</span><span class="sxs-lookup"><span data-stu-id="2e973-118">However, messages are not received from the topic directly; they are received from subscriptions.</span></span> <span data-ttu-id="2e973-119">Você pode considerar uma assinatura em relação a um tópico como uma fila virtual que recebe cópias das mensagens enviadas para esse tópico.</span><span class="sxs-lookup"><span data-stu-id="2e973-119">You can think of a subscription to a topic as a virtual queue that receives copies of the messages that are sent to that topic.</span></span> <span data-ttu-id="2e973-120">As mensagens são recebidas de uma assinatura da mesma maneira como são recebidas de uma fila.</span><span class="sxs-lookup"><span data-stu-id="2e973-120">Messages are received from a subscription the same way as they are received from a queue.</span></span>

<span data-ttu-id="2e973-121">Voltando ao cenário de varejo, a fila é substituída por um tópico, e uma assinatura é adicionada, que pode ser usada pelo componente do sistema de gerenciamento de estoque.</span><span class="sxs-lookup"><span data-stu-id="2e973-121">Going back to the retail scenario, the queue is replaced by a topic, and a subscription is added, which the inventory management system component can use.</span></span> <span data-ttu-id="2e973-122">O sistema agora aparece da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="2e973-122">The system now appears as follows:</span></span>

![Barramento de Serviço 2](./media/service-bus-create-topics-subscriptions/IC657165.gif)

<span data-ttu-id="2e973-124">A configuração aqui é executada de forma idêntica ao design baseado em fila anterior.</span><span class="sxs-lookup"><span data-stu-id="2e973-124">The configuration here performs identically to the previous queue-based design.</span></span> <span data-ttu-id="2e973-125">Ou seja, as mensagens enviadas para o tópico são encaminhadas para a assinatura do **Estoque**, da qual o **Sistema de Gerenciamento de Estoque** as consome.</span><span class="sxs-lookup"><span data-stu-id="2e973-125">That is, messages sent to the topic are routed to the **Inventory** subscription, from which the **Inventory Management System** consumes them.</span></span>

<span data-ttu-id="2e973-126">Para dar suporte ao painel de gerenciamento, criamos uma segunda assinatura no tópico, como mostrado aqui:</span><span class="sxs-lookup"><span data-stu-id="2e973-126">In order to support the management dashboard, we create a second subscription on the topic, as shown here:</span></span>

![Barramento de Serviço 3](./media/service-bus-create-topics-subscriptions/IC657166.gif)

<span data-ttu-id="2e973-128">Com essa configuração, cada mensagem dos terminais de PDV será disponibilizada para ambas as assinaturas, de **Painel** e **Estoque**.</span><span class="sxs-lookup"><span data-stu-id="2e973-128">With this configuration, each message from the POS terminals is made available to both the **Dashboard** and **Inventory** subscriptions.</span></span>

## <a name="show-me-the-code"></a><span data-ttu-id="2e973-129">Mostrar-me o código</span><span class="sxs-lookup"><span data-stu-id="2e973-129">Show me the code</span></span>
<span data-ttu-id="2e973-130">O artigo [Criar aplicativos que usem as filas do Barramento de Serviço](service-bus-create-queues.md) descreve como se inscrever em uma conta do Azure e criar um namespace de serviço.</span><span class="sxs-lookup"><span data-stu-id="2e973-130">The article [Create applications that use Service Bus queues](service-bus-create-queues.md) describes how to sign up for an Azure account and create a service namespace.</span></span> <span data-ttu-id="2e973-131">A maneira mais fácil de referenciar as dependências do Barramento de Serviço é instalar o [pacote NuGet](https://www.nuget.org/packages/WindowsAzure.ServiceBus/) do Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="2e973-131">The easiest way to reference Service Bus dependencies is to install the Service Bus [Nuget package](https://www.nuget.org/packages/WindowsAzure.ServiceBus/).</span></span> <span data-ttu-id="2e973-132">Você também pode encontrar as bibliotecas do Barramento de Serviço como parte do SDK do Azure.</span><span class="sxs-lookup"><span data-stu-id="2e973-132">You can also find the Service Bus libraries as part of the Azure SDK.</span></span> <span data-ttu-id="2e973-133">O download está disponível na [página de download do SDK do Azure](https://azure.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="2e973-133">The download is available at the [Azure SDK download page](https://azure.microsoft.com/downloads/).</span></span>

### <a name="create-the-topic-and-subscriptions"></a><span data-ttu-id="2e973-134">Criar o tópico e as assinaturas</span><span class="sxs-lookup"><span data-stu-id="2e973-134">Create the topic and subscriptions</span></span>
<span data-ttu-id="2e973-135">As operações de gerenciamento para as entidades do sistema de mensagens do Barramento de Serviço (filas e tópicos de publicação/assinatura) são executadas por meio da classe [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager).</span><span class="sxs-lookup"><span data-stu-id="2e973-135">Management operations for Service Bus messaging entities (queues and publish/subscribe topics) are performed via the [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) class.</span></span> <span data-ttu-id="2e973-136">As credenciais apropriadas são necessárias para criar uma instância do **NamespaceManager** para um namespace específico.</span><span class="sxs-lookup"><span data-stu-id="2e973-136">Appropriate credentials are required in order to create a **NamespaceManager** instance for a particular namespace.</span></span> <span data-ttu-id="2e973-137">O Barramento de Serviço usa um modelo de segurança baseado na [Assinatura de Acesso Compartilhado (SAS)](service-bus-sas.md).</span><span class="sxs-lookup"><span data-stu-id="2e973-137">Service Bus uses a [Shared Access Signature (SAS)](service-bus-sas.md) based security model.</span></span> <span data-ttu-id="2e973-138">A classe [TokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#microsoft_servicebus_tokenprovider) representa um provedor de token de segurança com métodos de fábrica internos que retornam alguns provedores de token conhecidos.</span><span class="sxs-lookup"><span data-stu-id="2e973-138">The [TokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#microsoft_servicebus_tokenprovider) class represents a security token provider with built-in factory methods returning some well-known token providers.</span></span> <span data-ttu-id="2e973-139">Usaremos um método [CreateSharedAccessSignatureTokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#Microsoft_ServiceBus_TokenProvider_CreateSharedAccessSignatureTokenProvider_System_String_) para armazenar as credenciais SAS.</span><span class="sxs-lookup"><span data-stu-id="2e973-139">We’ll use a [CreateSharedAccessSignatureTokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#Microsoft_ServiceBus_TokenProvider_CreateSharedAccessSignatureTokenProvider_System_String_) method to hold the SAS credentials.</span></span> <span data-ttu-id="2e973-140">Assim, a instância de [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) é construída com o endereço base do namespace do Barramento de Serviço e do provedor de token.</span><span class="sxs-lookup"><span data-stu-id="2e973-140">The [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) instance is then constructed with the base address of the Service Bus namespace and the token provider.</span></span>

<span data-ttu-id="2e973-141">A classe [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) oferece métodos para criar, enumerar e excluir entidades do sistema de mensagens.</span><span class="sxs-lookup"><span data-stu-id="2e973-141">The [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) class provides methods to create, enumerate and delete messaging entities.</span></span> <span data-ttu-id="2e973-142">O código exibido aqui mostra como a instância de **NamespaceManager** é criada e usada para criar o tópico **DataCollectionTopic**.</span><span class="sxs-lookup"><span data-stu-id="2e973-142">The code that is shown here shows how the **NamespaceManager** instance is created and used to create the **DataCollectionTopic** topic.</span></span>

```csharp
Uri uri = ServiceBusEnvironment.CreateServiceUri("sb", "test-blog", string.Empty);
string name = "RootManageSharedAccessKey";
string key = "abcdefghijklmopqrstuvwxyz";

TokenProvider tokenProvider = TokenProvider.CreateSharedAccessSignatureTokenProvider(name, key);
NamespaceManager namespaceManager = new NamespaceManager(uri, tokenProvider);

namespaceManager.CreateTopic("DataCollectionTopic");
```

<span data-ttu-id="2e973-143">Observe que há sobrecargas do método [CreateTopic](/dotnet/api/microsoft.servicebus.namespacemanager#Microsoft_ServiceBus_NamespaceManager_CreateTopic_System_String_) que permitem que as propriedades do tópico sejam definidas.</span><span class="sxs-lookup"><span data-stu-id="2e973-143">Note that there are overloads of the [CreateTopic](/dotnet/api/microsoft.servicebus.namespacemanager#Microsoft_ServiceBus_NamespaceManager_CreateTopic_System_String_) method that enable you to set properties of the topic.</span></span> <span data-ttu-id="2e973-144">Por exemplo, você pode definir o valor padrão da TTL (vida útil) das mensagens enviadas para o tópico.</span><span class="sxs-lookup"><span data-stu-id="2e973-144">For example, you can set the default time-to-live (TTL) value for messages sent to the topic.</span></span> <span data-ttu-id="2e973-145">Em seguida, adicione as assinaturas de **Estoque** e **Painel**.</span><span class="sxs-lookup"><span data-stu-id="2e973-145">Next, add the **Inventory** and **Dashboard** subscriptions.</span></span>

```csharp
namespaceManager.CreateSubscription("DataCollectionTopic", "Inventory");
namespaceManager.CreateSubscription("DataCollectionTopic", "Dashboard");
```

### <a name="send-messages-to-the-topic"></a><span data-ttu-id="2e973-146">Enviar mensagens para o tópico</span><span class="sxs-lookup"><span data-stu-id="2e973-146">Send messages to the topic</span></span>
<span data-ttu-id="2e973-147">Para operações de tempo de execução em entidades do Barramento de Serviço; por exemplo, para enviar e receber mensagens, primeiro um aplicativo deverá criar um objeto [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#microsoft_servicebus_messaging_messagingfactory).</span><span class="sxs-lookup"><span data-stu-id="2e973-147">For run-time operations on Service Bus entities; for example, sending and receiving messages, an application must first create a [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#microsoft_servicebus_messaging_messagingfactory) object.</span></span> <span data-ttu-id="2e973-148">Semelhante à classe [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager), a instância **MessagingFactory** será criada do endereço base do namespace de serviço e do provedor de token.</span><span class="sxs-lookup"><span data-stu-id="2e973-148">Similar to the [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) class, the **MessagingFactory** instance is created from the base address of the service namespace and the token provider.</span></span>

```
MessagingFactory factory = MessagingFactory.Create(uri, tokenProvider);
```

<span data-ttu-id="2e973-149">As mensagens enviadas para os tópicos do Barramento de Serviço e recebidas dele são instâncias da classe [BrokeredMessage](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage).</span><span class="sxs-lookup"><span data-stu-id="2e973-149">Messages sent to and received from Service Bus topics, are instances of the [BrokeredMessage](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage) class.</span></span> <span data-ttu-id="2e973-150">Essa classe consiste em um conjunto de propriedades padrão (como [Label](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.label?view=azureservicebus-4.0.0#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label) e [TimeToLive](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.timetolive?view=azureservicebus-4.0.0#Microsoft_ServiceBus_Messaging_BrokeredMessage_TimeToLive)), um dicionário usado para manter as propriedades do aplicativo e um corpo de dados de aplicativo arbitrários.</span><span class="sxs-lookup"><span data-stu-id="2e973-150">This class consists of a set of standard properties (such as [Label](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.label?view=azureservicebus-4.0.0#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label) and [TimeToLive](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.timetolive?view=azureservicebus-4.0.0#Microsoft_ServiceBus_Messaging_BrokeredMessage_TimeToLive)), a dictionary that is used to hold application properties, and a body of arbitrary application data.</span></span> <span data-ttu-id="2e973-151">Um aplicativo pode definir o corpo passando qualquer objeto serializável (o exemplo a seguir passa um objeto **SalesData** que representa os dados de vendas do terminal de PDV), que usará o [DataContractSerializer](https://msdn.microsoft.com/library/system.runtime.serialization.datacontractserializer.aspx) para serializar o objeto.</span><span class="sxs-lookup"><span data-stu-id="2e973-151">An application can set the body by passing in any serializable object (the following example passes in a **SalesData** object that represents the sales data from the POS terminal), which will use the [DataContractSerializer](https://msdn.microsoft.com/library/system.runtime.serialization.datacontractserializer.aspx) to serialize the object.</span></span> <span data-ttu-id="2e973-152">Como alternativa, poderá ser fornecido um objeto [Stream](https://msdn.microsoft.com/library/system.io.stream.aspx).</span><span class="sxs-lookup"><span data-stu-id="2e973-152">Alternatively, a [Stream](https://msdn.microsoft.com/library/system.io.stream.aspx) object can be provided.</span></span>

```csharp
BrokeredMessage bm = new BrokeredMessage(salesData);
bm.Label = "SalesReport";
bm.Properties["StoreName"] = "Redmond";
bm.Properties["MachineID"] = "POS_1";
```

<span data-ttu-id="2e973-153">A maneira mais fácil de enviar mensagens para o tópico é usar [CreateMessageSender](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageSender_System_String_) para criar um objeto [MessageSender](/dotnet/api/microsoft.servicebus.messaging.messagesender) diretamente da instância [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory):</span><span class="sxs-lookup"><span data-stu-id="2e973-153">The easiest way to send messages to the topic is to use [CreateMessageSender](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageSender_System_String_) to create a [MessageSender](/dotnet/api/microsoft.servicebus.messaging.messagesender) object directly from the [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) instance:</span></span>

```csharp
MessageSender sender = factory.CreateMessageSender("DataCollectionTopic");
sender.Send(bm);
```

### <a name="receive-messages-from-a-subscription"></a><span data-ttu-id="2e973-154">Receber mensagens de uma assinatura</span><span class="sxs-lookup"><span data-stu-id="2e973-154">Receive messages from a subscription</span></span>
<span data-ttu-id="2e973-155">Semelhante ao uso de filas, para receber mensagens de uma assinatura, você poderá usar um objeto [MessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagereceiver), que pode ser criado diretamente de [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) usando [CreateMessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageReceiver_System_String_).</span><span class="sxs-lookup"><span data-stu-id="2e973-155">Similar to using queues, to receive messages from a subscription you can use a [MessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagereceiver) object which you create directly from the [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) using [CreateMessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageReceiver_System_String_).</span></span> <span data-ttu-id="2e973-156">Você pode usar um de dois modos de recebimento diferentes (**ReceiveAndDelete** e **PeekLock**), como discutido em [Criar aplicativos que usam filas do Barramento de Serviço](service-bus-create-queues.md).</span><span class="sxs-lookup"><span data-stu-id="2e973-156">You can use one of the two different receive modes (**ReceiveAndDelete** and **PeekLock**), as discussed in [Create applications that use Service Bus queues](service-bus-create-queues.md).</span></span>

<span data-ttu-id="2e973-157">Observe que quando você cria um **MessageReceiver** para assinaturas, o parâmetro *entityPath* fica no formato`topicPath/subscriptions/subscriptionName`.</span><span class="sxs-lookup"><span data-stu-id="2e973-157">Note that when you create a **MessageReceiver** for subscriptions, the *entityPath* parameter is of the form `topicPath/subscriptions/subscriptionName`.</span></span> <span data-ttu-id="2e973-158">Portanto, para criar um **MessageReceiver** para a assinatura de **Estoque** do tópico **DataCollectionTopic**, *entityPath* deverá ser definido como `DataCollectionTopic/subscriptions/Inventory`.</span><span class="sxs-lookup"><span data-stu-id="2e973-158">Therefore, to create a **MessageReceiver** for the **Inventory** subscription of the **DataCollectionTopic** topic, *entityPath* must be set to `DataCollectionTopic/subscriptions/Inventory`.</span></span> <span data-ttu-id="2e973-159">O código aparece da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="2e973-159">The code appears as follows:</span></span>

```csharp
MessageReceiver receiver = factory.CreateMessageReceiver("DataCollectionTopic/subscriptions/Inventory");
BrokeredMessage receivedMessage = receiver.Receive();
try
{
    ProcessMessage(receivedMessage);
    receivedMessage.Complete();
}
catch (Exception e)
{
    receivedMessage.Abandon();
}
```

## <a name="subscription-filters"></a><span data-ttu-id="2e973-160">Filtros de assinatura</span><span class="sxs-lookup"><span data-stu-id="2e973-160">Subscription filters</span></span>
<span data-ttu-id="2e973-161">Até agora neste cenário, todas as mensagens enviadas ao tópico são disponibilizadas para todas as assinaturas registradas.</span><span class="sxs-lookup"><span data-stu-id="2e973-161">So far, in this scenario all messages sent to the topic are made available to all registered subscriptions.</span></span> <span data-ttu-id="2e973-162">A frase-chave aqui é "disponibilizadas".</span><span class="sxs-lookup"><span data-stu-id="2e973-162">The key phrase here is "made available."</span></span> <span data-ttu-id="2e973-163">Embora as assinaturas do Barramento de Serviço vejam todas as mensagens enviadas para o tópico, você só poderá copiar um subconjunto dessas mensagens na fila de assinatura virtual.</span><span class="sxs-lookup"><span data-stu-id="2e973-163">While Service Bus subscriptions see all messages sent to the topic, you can copy only a subset of those messages to the virtual subscription queue.</span></span> <span data-ttu-id="2e973-164">Isso é feito usando *filtros* de assinatura.</span><span class="sxs-lookup"><span data-stu-id="2e973-164">This is performed using subscription *filters*.</span></span> <span data-ttu-id="2e973-165">Quando você cria uma assinatura, pode fornecer uma expressão de filtro na forma de um predicado de estilo SQL92 que funciona sobre as propriedades da mensagem, as propriedades do sistema (por exemplo, [Label](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label)) e as propriedades do aplicativo, como **StoreName** no exemplo anterior.</span><span class="sxs-lookup"><span data-stu-id="2e973-165">When you create a subscription, you can supply a filter expression in the form of a SQL92 style predicate that operates over the properties of the message, both the system properties (for example, [Label](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label)) and the application properties, such as **StoreName** in the previous example.</span></span>

<span data-ttu-id="2e973-166">Fazendo o cenário evoluir para ilustrar isso, uma segunda loja deverá ser adicionada ao nosso cenário de varejo.</span><span class="sxs-lookup"><span data-stu-id="2e973-166">Evolving the scenario to illustrate this, a second store is to be added to our retail scenario.</span></span> <span data-ttu-id="2e973-167">Os dados de vendas de todos os terminais de PDV de ambas as lojas ainda precisam ser roteados para o sistema de gerenciamento de estoque centralizado, mas um gerente de loja usando a ferramenta de painel só está interessado no desempenho da loja dele.</span><span class="sxs-lookup"><span data-stu-id="2e973-167">Sales data from all of the POS terminals from both stores still have to be routed to the centralized inventory management system, but a store manager using the dashboard tool is only interested in the performance of that store.</span></span> <span data-ttu-id="2e973-168">Você pode usar a filtragem de assinatura para conseguir isso.</span><span class="sxs-lookup"><span data-stu-id="2e973-168">You can use subscription filtering to achieve this.</span></span> <span data-ttu-id="2e973-169">Observe que, quando os terminais de PDV publicarem mensagens, eles definem a propriedade do aplicativo **StoreName** na mensagem.</span><span class="sxs-lookup"><span data-stu-id="2e973-169">Note that when the POS terminals publish messages, they set the **StoreName** application property on the message.</span></span> <span data-ttu-id="2e973-170">Dadas duas lojas, por exemplo, **Redmond** e **Seattle**, os terminais de PDV na loja de Redmond carimbam as mensagens de dados sobre as vendas com um **StoreName** igual a **Redmond**, enquanto os terminais de PDV da loja de Seattle usam um **StoreName** igual a **Seattle**.</span><span class="sxs-lookup"><span data-stu-id="2e973-170">Given two stores, for example **Redmond** and **Seattle**, the POS terminals in the Redmond store stamp their sales data messages with a **StoreName** equal to **Redmond**, whereas the Seattle store POS terminals use a **StoreName** equal to **Seattle**.</span></span> <span data-ttu-id="2e973-171">O gerente da loja da loja de Redmond só deseja ver os dados de seus terminais de PDV.</span><span class="sxs-lookup"><span data-stu-id="2e973-171">The store manager of the Redmond store only wants to see data from its POS terminals.</span></span> <span data-ttu-id="2e973-172">O sistema aparece da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="2e973-172">The system appears as follows:</span></span>

![Service-Bus4](./media/service-bus-create-topics-subscriptions/IC657167.gif)

<span data-ttu-id="2e973-174">Para configurar esse roteamento, crie a assinatura de **Painel** da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="2e973-174">To set up this routing, you create the **Dashboard** subscription as follows:</span></span>

```csharp
SqlFilter dashboardFilter = new SqlFilter("StoreName = 'Redmond'");
namespaceManager.CreateSubscription("DataCollectionTopic", "Dashboard", dashboardFilter);
```

<span data-ttu-id="2e973-175">Com esse [filtro de assinatura](/dotnet/api/microsoft.servicebus.messaging.sqlfilter), somente as mensagens com a propriedade **StoreName** definida como **Redmond** serão copiadas na fila virtual da assinatura de **Painel**.</span><span class="sxs-lookup"><span data-stu-id="2e973-175">With this [subscription filter](/dotnet/api/microsoft.servicebus.messaging.sqlfilter), only messages that have the **StoreName** property set to **Redmond** will be copied to the virtual queue for the **Dashboard** subscription.</span></span> <span data-ttu-id="2e973-176">No entanto, há muito mais sobre a filtragem de assinatura.</span><span class="sxs-lookup"><span data-stu-id="2e973-176">There is much more to subscription filtering, however.</span></span> <span data-ttu-id="2e973-177">Os aplicativos podem ter várias regras de filtro por assinatura, além da capacidade de modificar as propriedades de uma mensagem à medida que ela passa para uma fila virtual de uma assinatura.</span><span class="sxs-lookup"><span data-stu-id="2e973-177">Applications can have multiple filter rules per subscription in addition to the ability to modify the properties of a message as it passes to a subscription's virtual queue.</span></span>

## <a name="summary"></a><span data-ttu-id="2e973-178">Resumo</span><span class="sxs-lookup"><span data-stu-id="2e973-178">Summary</span></span>
<span data-ttu-id="2e973-179">Todos os motivos para usar o enfileiramento de mensagens descrito em [Criar aplicativos que usam as filas do Barramento de Serviço](service-bus-create-queues.md) também se aplicam aos tópicos, especificamente:</span><span class="sxs-lookup"><span data-stu-id="2e973-179">All of the reasons to use queuing described in [Create applications that use Service Bus queues](service-bus-create-queues.md) also apply to topics, specifically:</span></span>

* <span data-ttu-id="2e973-180">Desacoplamento tempo - os produtores e os consumidores da mensagem não precisam estar online ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="2e973-180">Temporal decoupling – message producers and consumers do not have to be online at the same time.</span></span>
* <span data-ttu-id="2e973-181">Nivelamento de carga – os picos de carga são suavizados pelo tópico, permitindo que os aplicativos de consumo sejam provisionados para a carga média em vez de para a carga de pico.</span><span class="sxs-lookup"><span data-stu-id="2e973-181">Load leveling – peaks in load are smoothed out by the topic enabling consuming applications to be provisioned for average load instead of peak load.</span></span>
* <span data-ttu-id="2e973-182">Balanceamento de carga – semelhante a uma fila, você pode ter vários consumidores concorrentes escutando em uma única assinatura, com cada mensagem entregue para um dos consumidores, balanceando, assim, a carga.</span><span class="sxs-lookup"><span data-stu-id="2e973-182">Load balancing – similar to a queue, you can have multiple competing consumers listening on a single subscription, with each message handed off to only one of the consumers, thereby balancing load.</span></span>
* <span data-ttu-id="2e973-183">Acoplamento flexível – você pode fazer a rede de mensagens evoluir sem afetar os pontos de extremidade existentes; por exemplo, adicionando assinaturas ou alterando filtros de um tópico para permitir novos consumidores.</span><span class="sxs-lookup"><span data-stu-id="2e973-183">Loose coupling – you can evolve the messaging network without affecting existing endpoints; for example, adding subscriptions or changing filters to a topic to allow for new consumers.</span></span>

## <a name="next-steps"></a><span data-ttu-id="2e973-184">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="2e973-184">Next steps</span></span>

<span data-ttu-id="2e973-185">Consulte [Criar aplicativos que usem as filas do Barramento de Serviço](service-bus-create-queues.md) para informações sobre como usar as filas no cenário de varejo de PDV.</span><span class="sxs-lookup"><span data-stu-id="2e973-185">See [Create applications that use Service Bus queues](service-bus-create-queues.md) for information about how to use queues in the POS retail scenario.</span></span>

