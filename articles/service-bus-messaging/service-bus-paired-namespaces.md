---
title: "Namespaces emparelhados do Barramento de Serviço do Azure | Microsoft Docs"
description: "Detalhes e custo de implementação do namespace emparelhado"
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: 2440c8d3-ed2e-47e0-93cf-ab7fbb855d2e
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 05/25/2017
ms.author: sethm
ms.openlocfilehash: a200ea7937b9f5296c743928a9408897adfba428
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="paired-namespace-implementation-details-and-cost-implications"></a><span data-ttu-id="b5398-103">Detalhes e implicações de custo da implementação do namespace emparelhado</span><span class="sxs-lookup"><span data-stu-id="b5398-103">Paired namespace implementation details and cost implications</span></span>
<span data-ttu-id="b5398-104">O método [PairNamespaceAsync][PairNamespaceAsync], que usa uma instância de [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions], realiza tarefas visíveis em seu nome.</span><span class="sxs-lookup"><span data-stu-id="b5398-104">The [PairNamespaceAsync][PairNamespaceAsync] method, using a [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] instance, performs visible tasks on your behalf.</span></span> <span data-ttu-id="b5398-105">Como o uso do recurso envolve considerações sobre o custo, convém entender essas tarefas para que quando isso ocorrer você já saiba do que se trata.</span><span class="sxs-lookup"><span data-stu-id="b5398-105">Because there are cost considerations when using the feature, it is useful to understand those tasks so that you expect the behavior when it happens.</span></span> <span data-ttu-id="b5398-106">A API realiza o seguinte comportamento automático em seu nome:</span><span class="sxs-lookup"><span data-stu-id="b5398-106">The API engages the following automatic behavior on your behalf:</span></span>

* <span data-ttu-id="b5398-107">Criação de filas de pendências.</span><span class="sxs-lookup"><span data-stu-id="b5398-107">Creation of backlog queues.</span></span>
* <span data-ttu-id="b5398-108">Criação de um objeto [MessageSender][MessageSender] que se comunica com filas ou tópicos.</span><span class="sxs-lookup"><span data-stu-id="b5398-108">Creation of a [MessageSender][MessageSender] object that talks to queues or topics.</span></span>
* <span data-ttu-id="b5398-109">Quando uma entidade de mensagem fica indisponível, ela envia mensagens de ping à entidade para tentar detectar quando a entidade ficará disponível novamente.</span><span class="sxs-lookup"><span data-stu-id="b5398-109">When a messaging entity becomes unavailable, sends ping messages to the entity in an attempt to detect when that entity becomes available again.</span></span>
* <span data-ttu-id="b5398-110">Opcionalmente, ela cria um conjunto de "propulsores de mensagens" que as movem das filas de pendências para as filas principais.</span><span class="sxs-lookup"><span data-stu-id="b5398-110">Optionally creates of a set of “message pumps” that move messages from the backlog queues to the primary queues.</span></span>
* <span data-ttu-id="b5398-111">Coordena o fechamento/falha das instâncias primária e secundária de [MessagingFactory][MessagingFactory].</span><span class="sxs-lookup"><span data-stu-id="b5398-111">Coordinates closing/faulting of the primary and secondary [MessagingFactory][MessagingFactory] instances.</span></span>

<span data-ttu-id="b5398-112">Em alto nível, o recurso funciona da seguinte maneira: quando a entidade principal está íntegra, não ocorre qualquer alteração de comportamento.</span><span class="sxs-lookup"><span data-stu-id="b5398-112">At a high level, the feature works as follows: when the primary entity is healthy, no behavior changes occur.</span></span> <span data-ttu-id="b5398-113">Após o término do [FailoverInterval][FailoverInterval] sem que a entidade primária consiga envios bem-sucedidos após um [MessagingException][MessagingException] ou um [TimeoutException][TimeoutException] não transitório, o seguinte comportamento ocorrerá:</span><span class="sxs-lookup"><span data-stu-id="b5398-113">When the [FailoverInterval][FailoverInterval] duration elapses, and the primary entity sees no successful sends after a non-transient [MessagingException][MessagingException] or a [TimeoutException][TimeoutException], the following behavior occurs:</span></span>

1. <span data-ttu-id="b5398-114">As operações de envio para a entidade primária são desabilitadas e o sistema efetua pings na entidade primária até que os pings possam ser entregues com sucesso.</span><span class="sxs-lookup"><span data-stu-id="b5398-114">Send operations to the primary entity are disabled and the system pings the primary entity until pings can be successfully delivered.</span></span>
2. <span data-ttu-id="b5398-115">Uma fila de pendências aleatória é selecionada.</span><span class="sxs-lookup"><span data-stu-id="b5398-115">A random backlog queue is selected.</span></span>
3. <span data-ttu-id="b5398-116">Os objetos [BrokeredMessage][BrokeredMessage] são roteados para a fila da lista de pendências escolhida.</span><span class="sxs-lookup"><span data-stu-id="b5398-116">[BrokeredMessage][BrokeredMessage] objects are routed to the chosen backlog queue.</span></span>
4. <span data-ttu-id="b5398-117">Se uma operação de envio para a fila de pendências escolhida falhar, essa fila será retirada da rotação e uma nova fila será selecionada.</span><span class="sxs-lookup"><span data-stu-id="b5398-117">If a send operation to the chosen backlog queue fails, that queue is pulled from the rotation and a new queue is selected.</span></span> <span data-ttu-id="b5398-118">Todos os remetentes da instância [MessagingFactory][MessagingFactory] tomam conhecimento da falha.</span><span class="sxs-lookup"><span data-stu-id="b5398-118">All senders on the [MessagingFactory][MessagingFactory] instance learn of the failure.</span></span>

<span data-ttu-id="b5398-119">As figuras a seguir ilustram a sequência.</span><span class="sxs-lookup"><span data-stu-id="b5398-119">The following figures depict the sequence.</span></span> <span data-ttu-id="b5398-120">Primeiro, o remetente envia mensagens.</span><span class="sxs-lookup"><span data-stu-id="b5398-120">First, the sender sends messages.</span></span>

![Namespaces emparelhados][0]

<span data-ttu-id="b5398-122">Após a falha de envio para a fila primária, o remetente começa a enviar mensagens para uma fila de pendências escolhida aleatoriamente.</span><span class="sxs-lookup"><span data-stu-id="b5398-122">Upon failure to send to the primary queue, the sender begins sending messages to a randomly chosen backlog queue.</span></span> <span data-ttu-id="b5398-123">Simultaneamente, ele inicia uma tarefa de ping.</span><span class="sxs-lookup"><span data-stu-id="b5398-123">Simultaneously, it starts a ping task.</span></span>

![Namespaces emparelhados][1]

<span data-ttu-id="b5398-125">Neste ponto, as mensagens ainda estão na fila secundária e não foram entregues à fila primária.</span><span class="sxs-lookup"><span data-stu-id="b5398-125">At this point the messages are still in the secondary queue and have not been delivered to the primary queue.</span></span> <span data-ttu-id="b5398-126">Quando a fila primária fica íntegra novamente, pelo menos um processo deve estar em execução no sifão.</span><span class="sxs-lookup"><span data-stu-id="b5398-126">Once the primary queue is healthy again, at least one process should be running the syphon.</span></span> <span data-ttu-id="b5398-127">O sifão entrega as mensagens de todas as diversas filas de lista de pendências para as entidades de destino apropriadas (filas e tópicos).</span><span class="sxs-lookup"><span data-stu-id="b5398-127">The syphon delivers the messages from all the various backlog queues to the proper destination entities (queues and topics).</span></span>

![Namespaces emparelhados][2]

<span data-ttu-id="b5398-129">O restante deste tópico discute os detalhes específicos de funcionamento dessas partes.</span><span class="sxs-lookup"><span data-stu-id="b5398-129">The remainder of this topic discusses the specific details of how these pieces work.</span></span>

## <a name="creation-of-backlog-queues"></a><span data-ttu-id="b5398-130">Criação de filas de pendências</span><span class="sxs-lookup"><span data-stu-id="b5398-130">Creation of backlog queues</span></span>
<span data-ttu-id="b5398-131">O objeto [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] passado ao método [PairNamespaceAsync][PairNamespaceAsync] indica o número de filas de lista de pendências que você deseja usar.</span><span class="sxs-lookup"><span data-stu-id="b5398-131">The [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] object passed to the [PairNamespaceAsync][PairNamespaceAsync] method indicates the number of backlog queues you want to use.</span></span> <span data-ttu-id="b5398-132">Em seguida, cada fila de lista de pendências é criada com as seguintes propriedades definidas explicitamente (todos os outros valores são definidos com os valores padrão de [QueueDescription][QueueDescription]):</span><span class="sxs-lookup"><span data-stu-id="b5398-132">Each backlog queue is then created with the following properties explicitly set (all other values are set to the [QueueDescription][QueueDescription] defaults):</span></span>

| <span data-ttu-id="b5398-133">Caminho</span><span class="sxs-lookup"><span data-stu-id="b5398-133">Path</span></span> | <span data-ttu-id="b5398-134">[namespace primário]/x-servicebus-transfer/[índice] no qual [índice] é um valor em [0, BacklogQueueCount)</span><span class="sxs-lookup"><span data-stu-id="b5398-134">[primary namespace]/x-servicebus-transfer/[index] where [index] is a value in [0, BacklogQueueCount)</span></span> |
| --- | --- |
| <span data-ttu-id="b5398-135">MaxSizeInMegabytes</span><span class="sxs-lookup"><span data-stu-id="b5398-135">MaxSizeInMegabytes</span></span> |<span data-ttu-id="b5398-136">5120</span><span class="sxs-lookup"><span data-stu-id="b5398-136">5120</span></span> |
| <span data-ttu-id="b5398-137">MaxDeliveryCount</span><span class="sxs-lookup"><span data-stu-id="b5398-137">MaxDeliveryCount</span></span> |<span data-ttu-id="b5398-138">int.MaxValue</span><span class="sxs-lookup"><span data-stu-id="b5398-138">int.MaxValue</span></span> |
| <span data-ttu-id="b5398-139">DefaultMessageTimeToLive</span><span class="sxs-lookup"><span data-stu-id="b5398-139">DefaultMessageTimeToLive</span></span> |<span data-ttu-id="b5398-140">TimeSpan.MaxValue</span><span class="sxs-lookup"><span data-stu-id="b5398-140">TimeSpan.MaxValue</span></span> |
| <span data-ttu-id="b5398-141">AutoDeleteOnIdle</span><span class="sxs-lookup"><span data-stu-id="b5398-141">AutoDeleteOnIdle</span></span> |<span data-ttu-id="b5398-142">TimeSpan.MaxValue</span><span class="sxs-lookup"><span data-stu-id="b5398-142">TimeSpan.MaxValue</span></span> |
| <span data-ttu-id="b5398-143">LockDuration</span><span class="sxs-lookup"><span data-stu-id="b5398-143">LockDuration</span></span> |<span data-ttu-id="b5398-144">1 minuto</span><span class="sxs-lookup"><span data-stu-id="b5398-144">1 minute</span></span> |
| <span data-ttu-id="b5398-145">EnableDeadLetteringOnMessageExpiration</span><span class="sxs-lookup"><span data-stu-id="b5398-145">EnableDeadLetteringOnMessageExpiration</span></span> |<span data-ttu-id="b5398-146">verdadeiro</span><span class="sxs-lookup"><span data-stu-id="b5398-146">true</span></span> |
| <span data-ttu-id="b5398-147">EnableBatchedOperations</span><span class="sxs-lookup"><span data-stu-id="b5398-147">EnableBatchedOperations</span></span> |<span data-ttu-id="b5398-148">verdadeiro</span><span class="sxs-lookup"><span data-stu-id="b5398-148">true</span></span> |

<span data-ttu-id="b5398-149">Por exemplo, a primeira fila de pendências criada para o namespace **contoso** é chamada de `contoso/x-servicebus-transfer/0`.</span><span class="sxs-lookup"><span data-stu-id="b5398-149">For example, the first backlog queue created for namespace **contoso** is named `contoso/x-servicebus-transfer/0`.</span></span>

<span data-ttu-id="b5398-150">Durante a criação das filas, primeiro o código verifica se essa fila já existe.</span><span class="sxs-lookup"><span data-stu-id="b5398-150">When creating the queues, the code first checks to see if such a queue exists.</span></span> <span data-ttu-id="b5398-151">Se a fila não existir, ela será criada.</span><span class="sxs-lookup"><span data-stu-id="b5398-151">If the queue does not exist, then the queue is created.</span></span> <span data-ttu-id="b5398-152">O código não limpa as filas de pendência "extras".</span><span class="sxs-lookup"><span data-stu-id="b5398-152">The code does not clean up "extra" backlog queues.</span></span> <span data-ttu-id="b5398-153">Especificamente, se o aplicativo com o namespace primário **contoso** solicitar cinco filas de pendência, mas já existir uma fila de pendências com o caminho `contoso/x-servicebus-transfer/7`, essa fila de pendências extra ainda estará presente, mas não será usada.</span><span class="sxs-lookup"><span data-stu-id="b5398-153">Specifically, if the application with the primary namespace **contoso** requests five backlog queues but a backlog queue with the path `contoso/x-servicebus-transfer/7` exists, that extra backlog queue is still present but is not used.</span></span> <span data-ttu-id="b5398-154">O sistema permite explicitamente a existência de filas de pendência extras que não serão usadas.</span><span class="sxs-lookup"><span data-stu-id="b5398-154">The system explicitly allows extra backlog queues to exist that would not be used.</span></span> <span data-ttu-id="b5398-155">Como proprietário do namespace, você é responsável por limpar quaisquer filas de pendência não usadas/não desejadas.</span><span class="sxs-lookup"><span data-stu-id="b5398-155">As the namespace owner, you are responsible for cleaning up any unused/unwanted backlog queues.</span></span> <span data-ttu-id="b5398-156">O motivo dessa decisão é que o Barramento de Serviço não pode saber quais são as finalidades de todas as filas no namespace.</span><span class="sxs-lookup"><span data-stu-id="b5398-156">The reason for this decision is that Service Bus cannot know what purposes exist for all the queues in your namespace.</span></span> <span data-ttu-id="b5398-157">Além disso, se houver uma fila com o nome especificado, mas que não atender à suposta [QueueDescription][QueueDescription], você terá seus próprios motivos para alterar o comportamento padrão.</span><span class="sxs-lookup"><span data-stu-id="b5398-157">Furthermore, if a queue exists with the given name but does not meet the assumed [QueueDescription][QueueDescription], then your reasons are your own for changing the default behavior.</span></span> <span data-ttu-id="b5398-158">Não há garantias para as modificações feitas por seu código nas filas de pendência.</span><span class="sxs-lookup"><span data-stu-id="b5398-158">No guarantees are made for modifications to the backlog queues by your code.</span></span> <span data-ttu-id="b5398-159">Teste suas alterações com cuidado.</span><span class="sxs-lookup"><span data-stu-id="b5398-159">Make sure to test your changes thoroughly.</span></span>

## <a name="custom-messagesender"></a><span data-ttu-id="b5398-160">MessageSender personalizado</span><span class="sxs-lookup"><span data-stu-id="b5398-160">Custom MessageSender</span></span>
<span data-ttu-id="b5398-161">Durante o envio, todas as mensagens passam por um objeto [MessageSender][MessageSender] interno que se comporta normalmente quando tudo funciona e redireciona para a fila de lista de pendências quando as coisas "dão errado".</span><span class="sxs-lookup"><span data-stu-id="b5398-161">When sending, all messages go through an internal [MessageSender][MessageSender] object that behaves normally when everything works, and redirects to the backlog queues when things "break."</span></span> <span data-ttu-id="b5398-162">Ao receber uma falha não transitória, um timer é iniciado.</span><span class="sxs-lookup"><span data-stu-id="b5398-162">Upon receiving a non-transient failure, a timer starts.</span></span> <span data-ttu-id="b5398-163">Após um período de [TimeSpan][TimeSpan] composto pelo valor da propriedade [FailoverInterval][FailoverInterval], durante o qual nenhuma mensagem é enviada, o failover é acionado.</span><span class="sxs-lookup"><span data-stu-id="b5398-163">After a [TimeSpan][TimeSpan] period consisting of the [FailoverInterval][FailoverInterval] property value during which no successful messages are sent, the failover is engaged.</span></span> <span data-ttu-id="b5398-164">Nesse ponto, acontece o seguinte para cada entidade:</span><span class="sxs-lookup"><span data-stu-id="b5398-164">At this point, the following things happen for each entity:</span></span>

* <span data-ttu-id="b5398-165">Uma tarefa de ping é executada a cada [PingPrimaryInterval][PingPrimaryInterval], a fim de verificar se a entidade está disponível.</span><span class="sxs-lookup"><span data-stu-id="b5398-165">A ping task executes every [PingPrimaryInterval][PingPrimaryInterval] to check if the entity is available.</span></span> <span data-ttu-id="b5398-166">Após o êxito dessa tarefa, todo código do cliente que utiliza a entidade passará imediatamente a enviar novas mensagens ao namespace primário.</span><span class="sxs-lookup"><span data-stu-id="b5398-166">Once this task succeeds, all client code that uses the entity immediately starts sending new messages to the primary namespace.</span></span>
* <span data-ttu-id="b5398-167">As solicitações futuras enviadas à mesma entidade de qualquer outro remetente resultarão no envio de [BrokeredMessage][BrokeredMessage] à fila de lista de pendências para sofrer alteração.</span><span class="sxs-lookup"><span data-stu-id="b5398-167">Future requests to send to that same entity from any other senders will result in the [BrokeredMessage][BrokeredMessage] being sent to be modified to sit in the backlog queue.</span></span> <span data-ttu-id="b5398-168">A alteração remove algumas propriedades do objeto [BrokeredMessage][BrokeredMessage] e as armazena em outro lugar.</span><span class="sxs-lookup"><span data-stu-id="b5398-168">The modification removes some properties from the [BrokeredMessage][BrokeredMessage] object and stores them elsewhere.</span></span> <span data-ttu-id="b5398-169">As propriedades a seguir são limpas e adicionadas com um novo alias, permitindo que o Barramento de Serviço e o SDK processem as mensagens de maneira uniforme:</span><span class="sxs-lookup"><span data-stu-id="b5398-169">The following properties are cleared and added under a new alias, allowing Service Bus and the SDK to process messages uniformly:</span></span>

| <span data-ttu-id="b5398-170">Nome antigo da propriedade</span><span class="sxs-lookup"><span data-stu-id="b5398-170">Old Property Name</span></span> | <span data-ttu-id="b5398-171">Novo nome da propriedade</span><span class="sxs-lookup"><span data-stu-id="b5398-171">New Property Name</span></span> |
| --- | --- |
| <span data-ttu-id="b5398-172">SessionId</span><span class="sxs-lookup"><span data-stu-id="b5398-172">SessionId</span></span> |<span data-ttu-id="b5398-173">x-ms-sessionid</span><span class="sxs-lookup"><span data-stu-id="b5398-173">x-ms-sessionid</span></span> |
| <span data-ttu-id="b5398-174">TimeToLive</span><span class="sxs-lookup"><span data-stu-id="b5398-174">TimeToLive</span></span> |<span data-ttu-id="b5398-175">x-ms-timetolive</span><span class="sxs-lookup"><span data-stu-id="b5398-175">x-ms-timetolive</span></span> |
| <span data-ttu-id="b5398-176">ScheduledEnqueueTimeUtc</span><span class="sxs-lookup"><span data-stu-id="b5398-176">ScheduledEnqueueTimeUtc</span></span> |<span data-ttu-id="b5398-177">x-ms-path</span><span class="sxs-lookup"><span data-stu-id="b5398-177">x-ms-path</span></span> |

<span data-ttu-id="b5398-178">O caminho de destino original também é armazenado dentro da mensagem como uma propriedade chamada x-ms-path.</span><span class="sxs-lookup"><span data-stu-id="b5398-178">The original destination path is also stored within the message as a property named x-ms-path.</span></span> <span data-ttu-id="b5398-179">Esse design permite a coexistência de mensagens para muitas entidades em uma fila de pendências única.</span><span class="sxs-lookup"><span data-stu-id="b5398-179">This design allows messages for many entities to coexist in a single backlog queue.</span></span> <span data-ttu-id="b5398-180">As propriedades são convertidas novamente pelo sifão.</span><span class="sxs-lookup"><span data-stu-id="b5398-180">The properties are translated back by the syphon.</span></span>

<span data-ttu-id="b5398-181">O objeto [MessageSender][MessageSender] personalizado poderá enfrentar problemas quando as mensagens se aproximarem do limite de 256 KB e o failover será acionado.</span><span class="sxs-lookup"><span data-stu-id="b5398-181">The custom [MessageSender][MessageSender] object can encounter issues when messages approach the 256-KB limit and failover is engaged.</span></span> <span data-ttu-id="b5398-182">O objeto [MessageSender][MessageSender] personalizado armazena as mensagens de todas as filas e tópicos nas filas de lista de pendências.</span><span class="sxs-lookup"><span data-stu-id="b5398-182">The custom [MessageSender][MessageSender] object stores messages for all queues and topics together in the backlog queues.</span></span> <span data-ttu-id="b5398-183">Esse objeto combina mensagens de muitos primários nas filas de pendência.</span><span class="sxs-lookup"><span data-stu-id="b5398-183">This object mixes messages from many primaries together within the backlog queues.</span></span> <span data-ttu-id="b5398-184">Para lidar com o balanceamento de carga entre vários clientes que não se conhecem, o SDK escolhe aleatoriamente uma fila de lista de pendências para cada [QueueClient][QueueClient] ou [TopicClient][TopicClient] criado no código.</span><span class="sxs-lookup"><span data-stu-id="b5398-184">To handle load balancing among many clients that do not know each other, the SDK randomly picks one backlog queue for each [QueueClient][QueueClient] or [TopicClient][TopicClient] you create in code.</span></span>

## <a name="pings"></a><span data-ttu-id="b5398-185">Pings</span><span class="sxs-lookup"><span data-stu-id="b5398-185">Pings</span></span>
<span data-ttu-id="b5398-186">Uma mensagem de ping é uma [BrokeredMessage][BrokeredMessage] vazia com a propriedade [ContentType][ContentType] definida como application/vnd.ms-servicebus-ping e com um valor de [TimeToLive][TimeToLive] de um segundo.</span><span class="sxs-lookup"><span data-stu-id="b5398-186">A ping message is an empty [BrokeredMessage][BrokeredMessage] with its [ContentType][ContentType] property set to application/vnd.ms-servicebus-ping and a [TimeToLive][TimeToLive] value of 1 second.</span></span> <span data-ttu-id="b5398-187">Esse ping tem uma característica especial no Barramento de Serviço: o servidor nunca entrega um ping quando o chamador solicita uma [BrokeredMessage][BrokeredMessage].</span><span class="sxs-lookup"><span data-stu-id="b5398-187">This ping has one special characteristic in Service Bus: the server never delivers a ping when any caller requests a [BrokeredMessage][BrokeredMessage].</span></span> <span data-ttu-id="b5398-188">Assim, não há a necessidade de aprender como receber e ignorar essas mensagens.</span><span class="sxs-lookup"><span data-stu-id="b5398-188">Thus, you never have to learn how to receive and ignore these messages.</span></span> <span data-ttu-id="b5398-189">Cada entidade (fila ou tópico exclusivo) por instância [MessagingFactory][MessagingFactory] por cliente receberá um ping quando for considerada não disponível.</span><span class="sxs-lookup"><span data-stu-id="b5398-189">Each entity (unique queue or topic) per [MessagingFactory][MessagingFactory] instance per client will be pinged when they are considered to be unavailable.</span></span> <span data-ttu-id="b5398-190">Por padrão, isso ocorre uma vez por minuto.</span><span class="sxs-lookup"><span data-stu-id="b5398-190">By default, this happens once per minute.</span></span> <span data-ttu-id="b5398-191">Mensagens de ping são consideradas mensagens normais do Barramento de Serviço e podem resultar em encargos de largura de banda e de mensagens.</span><span class="sxs-lookup"><span data-stu-id="b5398-191">Ping messages are considered to be regular Service Bus messages, and can result in charges for bandwidth and messages.</span></span> <span data-ttu-id="b5398-192">Assim que os clientes detectam que o sistema está disponível, as mensagens são interrompidas.</span><span class="sxs-lookup"><span data-stu-id="b5398-192">As soon as the clients detect that the system is available, the messages stop.</span></span>

## <a name="the-syphon"></a><span data-ttu-id="b5398-193">O sifão</span><span class="sxs-lookup"><span data-stu-id="b5398-193">The syphon</span></span>
<span data-ttu-id="b5398-194">Pelo menos um programa executável no aplicativo deve executar ativamente o sifão.</span><span class="sxs-lookup"><span data-stu-id="b5398-194">At least one executable program in the application should be actively running the syphon.</span></span> <span data-ttu-id="b5398-195">O sifão realiza uma longa recepção de sondagem que dura 15 minutos.</span><span class="sxs-lookup"><span data-stu-id="b5398-195">The syphon performs a long poll receive that lasts 15 minutes.</span></span> <span data-ttu-id="b5398-196">Quando todas as entidades estão disponíveis e você tem 10 filas de pendência, o aplicativo que hospeda o sifão chama a operação de recebimento 40 vezes por hora, 960 vezes por dia e 28.800 vezes em 30 dias.</span><span class="sxs-lookup"><span data-stu-id="b5398-196">When all entities are available and you have 10 backlog queues, the application that hosts the syphon calls the receive operation 40 times per hour, 960 times per day, and 28800 times in 30 days.</span></span> <span data-ttu-id="b5398-197">Quando o sifão estiver movendo ativamente as mensagens da lista de pendências para a fila primária, cada mensagem sofrerá os seguintes encargos (os encargos padrão para o tamanho da mensagem e a largura de banda são aplicados em todos os estágios):</span><span class="sxs-lookup"><span data-stu-id="b5398-197">When the syphon is actively moving messages from the backlog to the primary queue, each message experiences the following charges (standard charges for message size and bandwidth apply in all stages):</span></span>

1. <span data-ttu-id="b5398-198">Envio à lista de pendências.</span><span class="sxs-lookup"><span data-stu-id="b5398-198">Send to the backlog.</span></span>
2. <span data-ttu-id="b5398-199">Recebimento da lista de pendências.</span><span class="sxs-lookup"><span data-stu-id="b5398-199">Receive from the backlog.</span></span>
3. <span data-ttu-id="b5398-200">Envio ao primário.</span><span class="sxs-lookup"><span data-stu-id="b5398-200">Send to the primary.</span></span>
4. <span data-ttu-id="b5398-201">Recebimento do primário.</span><span class="sxs-lookup"><span data-stu-id="b5398-201">Receive from the primary.</span></span>

## <a name="closefault-behavior"></a><span data-ttu-id="b5398-202">Comportamento de fechamento/falha</span><span class="sxs-lookup"><span data-stu-id="b5398-202">Close/fault behavior</span></span>
<span data-ttu-id="b5398-203">Em um aplicativo que hospeda o sifão, quando a [MessagingFactory][MessagingFactory] primária ou secundária falha ou fecha sem que seu parceiro também apresente falha ou seja fechado, sendo que quando o sifão detecta esse estado, ele age.</span><span class="sxs-lookup"><span data-stu-id="b5398-203">Within an application that hosts the syphon, once the primary or secondary [MessagingFactory][MessagingFactory] faults or is closed without its partner also being faulted/closed and the syphon detects this state, the syphon acts.</span></span> <span data-ttu-id="b5398-204">Se a outra [MessagingFactory][MessagingFactory] não for fechada dentro de cinco segundos, o sifão falhará na [MessagingFactory][MessagingFactory] ainda aberta.</span><span class="sxs-lookup"><span data-stu-id="b5398-204">If the other [MessagingFactory][MessagingFactory] is not closed within 5 seconds, the syphon will fault the still open [MessagingFactory][MessagingFactory].</span></span>

## <a name="next-steps"></a><span data-ttu-id="b5398-205">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="b5398-205">Next steps</span></span>
<span data-ttu-id="b5398-206">Consulte [Padrões de sistema de mensagens assíncronas e alta disponibilidade][Asynchronous messaging patterns and high availability] para obter uma discussão detalhada da mensagem assíncrona do Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="b5398-206">See [Asynchronous messaging patterns and high availability][Asynchronous messaging patterns and high availability] for a detailed discussion of Service Bus asynchronous messaging.</span></span> 

[PairNamespaceAsync]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_PairNamespaceAsync_Microsoft_ServiceBus_Messaging_PairedNamespaceOptions_
[SendAvailabilityPairedNamespaceOptions]: /dotnet/api/microsoft.servicebus.messaging.sendavailabilitypairednamespaceoptions
[MessageSender]: /dotnet/api/microsoft.servicebus.messaging.messagesender
[MessagingFactory]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory
[FailoverInterval]: /dotnet/api/microsoft.servicebus.messaging.pairednamespaceoptions#Microsoft_ServiceBus_Messaging_PairedNamespaceOptions_FailoverInterval
[MessagingException]: /dotnet/api/microsoft.servicebus.messaging.messagingexception
[TimeoutException]: https://msdn.microsoft.com/library/azure/system.timeoutexception.aspx
[BrokeredMessage]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage
[QueueDescription]: /dotnet/api/microsoft.servicebus.messaging.queuedescription
[TimeSpan]: https://msdn.microsoft.com/library/azure/system.timespan.aspx
[PingPrimaryInterval]: /dotnet/api/microsoft.servicebus.messaging.sendavailabilitypairednamespaceoptions#Microsoft_ServiceBus_Messaging_SendAvailabilityPairedNamespaceOptions_PingPrimaryInterval
[QueueClient]: /dotnet/api/microsoft.servicebus.messaging.queueclient
[TopicClient]: /dotnet/api/microsoft.servicebus.messaging.topicclient
[ContentType]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_ContentType
[TimeToLive]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_TimeToLive
[Asynchronous messaging patterns and high availability]: service-bus-async-messaging.md
[0]: ./media/service-bus-paired-namespaces/IC673405.png
[1]: ./media/service-bus-paired-namespaces/IC673406.png
[2]: ./media/service-bus-paired-namespaces/IC673407.png
