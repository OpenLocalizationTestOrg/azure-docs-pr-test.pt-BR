---
title: "Iniciando e parando máquinas virtuais — Graph | Microsoft Docs"
description: "Versão do fluxo de trabalho do PowerShell do cenário de Automação do Azure, incluindo runbooks para iniciar e parar máquinas virtuais clássicas."
services: automation
documentationcenter: 
author: mgoedtel
manager: jwhit
editor: tysonn
ms.assetid: 62d93170-ca3d-42ef-ac1d-6d50b61ac87d
ms.service: automation
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 07/06/2016
ms.author: magoedte;bwren
redirect_url: https://docs.microsoft.com/azure/automation/automation-solution-vm-management
redirect_document_id: FALSE
ms.openlocfilehash: 338d5712239356e13cbf480d9655ca3ca499701d
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="azure-automation-scenario---starting-and-stopping-virtual-machines"></a><span data-ttu-id="a2048-103">Cenário de Automação do Azure — iniciando e parando máquinas virtuais</span><span class="sxs-lookup"><span data-stu-id="a2048-103">Azure Automation scenario - starting and stopping virtual machines</span></span>
<span data-ttu-id="a2048-104">Esse cenário de Automação do Azure inclui runbooks para iniciar e parar máquinas virtuais clássicas.</span><span class="sxs-lookup"><span data-stu-id="a2048-104">This Azure Automation scenario includes runbooks to start and stop classic virtual machines.</span></span>  <span data-ttu-id="a2048-105">Você pode usar esse cenário para qualquer um destes objetivos:</span><span class="sxs-lookup"><span data-stu-id="a2048-105">You can use this scenario for any of the following:</span></span>  

* <span data-ttu-id="a2048-106">Usar os runbooks sem modificação em seu próprio ambiente.</span><span class="sxs-lookup"><span data-stu-id="a2048-106">Use the runbooks without modification in your own environment.</span></span>
* <span data-ttu-id="a2048-107">Modificar os runbooks para executar funcionalidade personalizada.</span><span class="sxs-lookup"><span data-stu-id="a2048-107">Modify the runbooks to perform customized functionality.</span></span>  
* <span data-ttu-id="a2048-108">Chamar os runbooks de outro runbook como parte de uma solução geral.</span><span class="sxs-lookup"><span data-stu-id="a2048-108">Call the runbooks from another runbook as part of an overall solution.</span></span>
* <span data-ttu-id="a2048-109">Usar os runbooks como tutoriais para saber sobre os conceitos de criação do runbook.</span><span class="sxs-lookup"><span data-stu-id="a2048-109">Use the runbooks as tutorials to learn runbook authoring concepts.</span></span>

> [!div class="op_single_selector"]
> * [<span data-ttu-id="a2048-110">Gráfico</span><span class="sxs-lookup"><span data-stu-id="a2048-110">Graphical</span></span>](automation-solution-startstopvm-graphical.md)
> * [<span data-ttu-id="a2048-111">Fluxo de Trabalho do PowerShell</span><span class="sxs-lookup"><span data-stu-id="a2048-111">PowerShell Workflow</span></span>](automation-solution-startstopvm-psworkflow.md)
>
>

<span data-ttu-id="a2048-112">Esta é a versão gráfica do runbook desse cenário.</span><span class="sxs-lookup"><span data-stu-id="a2048-112">This is the graphical runbook version of this scenario.</span></span> <span data-ttu-id="a2048-113">Ela também pode ser disponibilizada usando os [runbooks de Fluxo de Trabalho do PowerShell](automation-solution-startstopvm-psworkflow.md).</span><span class="sxs-lookup"><span data-stu-id="a2048-113">It is also available using [PowerShell Workflow runbooks](automation-solution-startstopvm-psworkflow.md).</span></span>

## <a name="getting-the-scenario"></a><span data-ttu-id="a2048-114">Obtendo o cenário</span><span class="sxs-lookup"><span data-stu-id="a2048-114">Getting the scenario</span></span>
<span data-ttu-id="a2048-115">Esse cenário é formado por dois runbooks gráficos que você pode baixar dos links a seguir.</span><span class="sxs-lookup"><span data-stu-id="a2048-115">This scenario consists of two two graphical runbooks that you can download from the following links.</span></span>  <span data-ttu-id="a2048-116">Confira a [versão do Fluxo de Trabalho do PowerShell](automation-solution-startstopvm-psworkflow.md) desse cenário para obter links para os runbooks de Fluxo de Trabalho do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a2048-116">See the [PowerShell Workflow version](automation-solution-startstopvm-psworkflow.md) of this scenario for links to the PowerShell Workflow runbooks.</span></span>

| <span data-ttu-id="a2048-117">Runbook</span><span class="sxs-lookup"><span data-stu-id="a2048-117">Runbook</span></span> | <span data-ttu-id="a2048-118">Link</span><span class="sxs-lookup"><span data-stu-id="a2048-118">Link</span></span> | <span data-ttu-id="a2048-119">Tipo</span><span class="sxs-lookup"><span data-stu-id="a2048-119">Type</span></span> | <span data-ttu-id="a2048-120">Descrição</span><span class="sxs-lookup"><span data-stu-id="a2048-120">Description</span></span> |
|:--- |:--- |:--- |:--- |
| <span data-ttu-id="a2048-121">StartAzureClassicVM</span><span class="sxs-lookup"><span data-stu-id="a2048-121">StartAzureClassicVM</span></span> |[<span data-ttu-id="a2048-122">Runbook gráfico Iniciar VM clássica do Azure</span><span class="sxs-lookup"><span data-stu-id="a2048-122">Start Azure Classic VM Graphical Runbook</span></span>](https://gallery.technet.microsoft.com/scriptcenter/Start-Azure-Classic-VM-c6067b3d) |<span data-ttu-id="a2048-123">Gráfico</span><span class="sxs-lookup"><span data-stu-id="a2048-123">Graphical</span></span> |<span data-ttu-id="a2048-124">Inicia todas as máquinas virtuais clássicas em uma assinatura do Azure ou todas as máquinas virtuais com um nome de serviço específico.</span><span class="sxs-lookup"><span data-stu-id="a2048-124">Starts all classic virtual machines in an Azure subscription or all virtual machines with a particular service name.</span></span> |
| <span data-ttu-id="a2048-125">StopAzureClassicVM</span><span class="sxs-lookup"><span data-stu-id="a2048-125">StopAzureClassicVM</span></span> |[<span data-ttu-id="a2048-126">Runbook gráfico Parar VM clássica do Azure</span><span class="sxs-lookup"><span data-stu-id="a2048-126">Stop Azure Classic VM Graphical Runbook</span></span>](https://gallery.technet.microsoft.com/scriptcenter/Stop-Azure-Classic-VM-397819bd) |<span data-ttu-id="a2048-127">Gráfico</span><span class="sxs-lookup"><span data-stu-id="a2048-127">Graphical</span></span> |<span data-ttu-id="a2048-128">Para todas as máquinas virtuais em uma conta de automação ou todas as máquinas virtuais com um nome de serviço específico.</span><span class="sxs-lookup"><span data-stu-id="a2048-128">Stops all virtual machines in an automation account or all virtual machines with a particular service name.</span></span> |

## <a name="installing-and-configuring-the-scenario"></a><span data-ttu-id="a2048-129">Instalando e configurando o cenário</span><span class="sxs-lookup"><span data-stu-id="a2048-129">Installing and configuring the scenario</span></span>
### <a name="1-install-the-runbooks"></a><span data-ttu-id="a2048-130">1. Instalar os runbooks</span><span class="sxs-lookup"><span data-stu-id="a2048-130">1. Install the runbooks</span></span>
<span data-ttu-id="a2048-131">Depois de baixar os runbooks, você poderá importá-los usando o procedimento em [Procedimentos de runbook gráfico](automation-graphical-authoring-intro.md#graphical-runbook-procedures).</span><span class="sxs-lookup"><span data-stu-id="a2048-131">After downloading the runbooks, you can import them using the procedure in [Graphical runbook procedures](automation-graphical-authoring-intro.md#graphical-runbook-procedures).</span></span>

### <a name="2-review-the-description-and-requirements"></a><span data-ttu-id="a2048-132">2. Analisar a descrição e os requisitos</span><span class="sxs-lookup"><span data-stu-id="a2048-132">2. Review the description and requirements</span></span>
<span data-ttu-id="a2048-133">Os runbooks incluem uma atividade chamada **Leia-me** , que apresenta uma descrição e ativos necessários.</span><span class="sxs-lookup"><span data-stu-id="a2048-133">The runbooks include an activity called **Read Me** that includes a description and required assets.</span></span>  <span data-ttu-id="a2048-134">Você pode exibir essas informações selecionando a atividade **Leia-me** e, em seguida, o parâmetro **Script do Fluxo de Trabalho**.</span><span class="sxs-lookup"><span data-stu-id="a2048-134">You can view this information by selecting the **Read Me** activity and then the **Workflow Script** parameter.</span></span>  <span data-ttu-id="a2048-135">Também é possível obter as mesmas informações neste artigo.</span><span class="sxs-lookup"><span data-stu-id="a2048-135">You can also get the same information from this article.</span></span>

### <a name="3-configure-assets"></a><span data-ttu-id="a2048-136">3. Configurar ativos</span><span class="sxs-lookup"><span data-stu-id="a2048-136">3. Configure assets</span></span>
<span data-ttu-id="a2048-137">Os runbooks exigem os ativos a seguir, que você deverá criar e preencher com os valores apropriados.</span><span class="sxs-lookup"><span data-stu-id="a2048-137">The runbooks require the following assets that you must create and populate with appropriate values.</span></span>  <span data-ttu-id="a2048-138">Os nomes são padrão.</span><span class="sxs-lookup"><span data-stu-id="a2048-138">The names are default.</span></span>  <span data-ttu-id="a2048-139">Será possível usar ativos com nomes diferentes se você especificar esses nomes nos [parâmetros de entrada](#using-the-runbooks) quando inicia o runbook.</span><span class="sxs-lookup"><span data-stu-id="a2048-139">You can use assets with different names if you specify those names in the [input parameters](#using-the-runbooks) when you start the runbook.</span></span>

| <span data-ttu-id="a2048-140">Tipo de Ativo</span><span class="sxs-lookup"><span data-stu-id="a2048-140">Asset Type</span></span> | <span data-ttu-id="a2048-141">Nome padrão</span><span class="sxs-lookup"><span data-stu-id="a2048-141">Default Name</span></span> | <span data-ttu-id="a2048-142">Descrição</span><span class="sxs-lookup"><span data-stu-id="a2048-142">Description</span></span> |
|:--- |:--- |:--- |:--- |
| [<span data-ttu-id="a2048-143">Credencial</span><span class="sxs-lookup"><span data-stu-id="a2048-143">Credential</span></span>](automation-credentials.md) |<span data-ttu-id="a2048-144">AzureCredential</span><span class="sxs-lookup"><span data-stu-id="a2048-144">AzureCredential</span></span> |<span data-ttu-id="a2048-145">Contém as credenciais de uma conta com autoridade para iniciar e parar máquinas virtuais na assinatura do Azure.</span><span class="sxs-lookup"><span data-stu-id="a2048-145">Contains credentials for an account that has authority to start and stop virtual machines in the Azure subscription.</span></span> |
| [<span data-ttu-id="a2048-146">Variável</span><span class="sxs-lookup"><span data-stu-id="a2048-146">Variable</span></span>](automation-variables.md) |<span data-ttu-id="a2048-147">AzureSubscriptionId</span><span class="sxs-lookup"><span data-stu-id="a2048-147">AzureSubscriptionId</span></span> |<span data-ttu-id="a2048-148">Contém a ID da sua assinatura do Azure.</span><span class="sxs-lookup"><span data-stu-id="a2048-148">Contains the subscription ID of your Azure subscription.</span></span> |

## <a name="using-the-scenario"></a><span data-ttu-id="a2048-149">Usando o cenário</span><span class="sxs-lookup"><span data-stu-id="a2048-149">Using the scenario</span></span>
### <a name="parameters"></a><span data-ttu-id="a2048-150">Parâmetros</span><span class="sxs-lookup"><span data-stu-id="a2048-150">Parameters</span></span>
<span data-ttu-id="a2048-151">Cada um dos runbooks tem os [parâmetros de entrada](automation-starting-a-runbook.md#runbook-parameters)a seguir.</span><span class="sxs-lookup"><span data-stu-id="a2048-151">The runbooks each have the following [input parameters](automation-starting-a-runbook.md#runbook-parameters).</span></span>  <span data-ttu-id="a2048-152">Você deve fornecer valores para todos os parâmetros obrigatórios e pode, se desejar, fornecer valores para outros parâmetros de acordo com os próprios requisitos.</span><span class="sxs-lookup"><span data-stu-id="a2048-152">You must provide values for any mandatory parameters and can optionally provide values for other parameters depending on your requirements.</span></span>

| <span data-ttu-id="a2048-153">Parâmetro</span><span class="sxs-lookup"><span data-stu-id="a2048-153">Parameter</span></span> | <span data-ttu-id="a2048-154">Tipo</span><span class="sxs-lookup"><span data-stu-id="a2048-154">Type</span></span> | <span data-ttu-id="a2048-155">Obrigatório</span><span class="sxs-lookup"><span data-stu-id="a2048-155">Mandatory</span></span> | <span data-ttu-id="a2048-156">Descrição</span><span class="sxs-lookup"><span data-stu-id="a2048-156">Description</span></span> |
|:--- |:--- |:--- |:--- |
| <span data-ttu-id="a2048-157">ServiceName</span><span class="sxs-lookup"><span data-stu-id="a2048-157">ServiceName</span></span> |<span data-ttu-id="a2048-158">string</span><span class="sxs-lookup"><span data-stu-id="a2048-158">string</span></span> |<span data-ttu-id="a2048-159">Não</span><span class="sxs-lookup"><span data-stu-id="a2048-159">No</span></span> |<span data-ttu-id="a2048-160">Se um valor for fornecido, todas as máquinas virtuais com esse nome de serviço serão iniciadas ou paradas.</span><span class="sxs-lookup"><span data-stu-id="a2048-160">If a value is provided, then all virtual machines with that service name are started or stopped.</span></span>  <span data-ttu-id="a2048-161">Se nenhum valor for fornecido, todas as máquinas virtuais clássicas na assinatura do Azure serão iniciadas ou paradas.</span><span class="sxs-lookup"><span data-stu-id="a2048-161">If no value is provided, then all classic virtual machines in the Azure subscription are started or stopped.</span></span> |
| <span data-ttu-id="a2048-162">AzureSubscriptionIdAssetName</span><span class="sxs-lookup"><span data-stu-id="a2048-162">AzureSubscriptionIdAssetName</span></span> |<span data-ttu-id="a2048-163">string</span><span class="sxs-lookup"><span data-stu-id="a2048-163">string</span></span> |<span data-ttu-id="a2048-164">Não</span><span class="sxs-lookup"><span data-stu-id="a2048-164">No</span></span> |<span data-ttu-id="a2048-165">Contém o nome do [ativo variável](#installing-and-configuring-the-scenario) que contém a ID da sua assinatura do Azure.</span><span class="sxs-lookup"><span data-stu-id="a2048-165">Contains the name of the [variable asset](#installing-and-configuring-the-scenario) that contains the subscription ID of your Azure subscription.</span></span>  <span data-ttu-id="a2048-166">Se você não especificar um valor, *AzureSubscriptionId* será usado.</span><span class="sxs-lookup"><span data-stu-id="a2048-166">If you don't specify a value, *AzureSubscriptionId* is used.</span></span> |
| <span data-ttu-id="a2048-167">AzureCredentialAssetName</span><span class="sxs-lookup"><span data-stu-id="a2048-167">AzureCredentialAssetName</span></span> |<span data-ttu-id="a2048-168">string</span><span class="sxs-lookup"><span data-stu-id="a2048-168">string</span></span> |<span data-ttu-id="a2048-169">Não</span><span class="sxs-lookup"><span data-stu-id="a2048-169">No</span></span> |<span data-ttu-id="a2048-170">Contém o nome do [ativo de credencial](#installing-and-configuring-the-scenario) com as credenciais para o runbook a ser usado.</span><span class="sxs-lookup"><span data-stu-id="a2048-170">Contains the name of the [credential asset](#installing-and-configuring-the-scenario) that contains the credentials for the runbook to use.</span></span>  <span data-ttu-id="a2048-171">Se você não especificar um valor, *AzureCredential* será usado.</span><span class="sxs-lookup"><span data-stu-id="a2048-171">If you don't specify a value, *AzureCredential* is used.</span></span> |

### <a name="starting-the-runbooks"></a><span data-ttu-id="a2048-172">Iniciando os runbooks</span><span class="sxs-lookup"><span data-stu-id="a2048-172">Starting the runbooks</span></span>
<span data-ttu-id="a2048-173">Você pode usar qualquer um dos métodos em [Iniciando um runbook na Automação do Azure](automation-starting-a-runbook.md) para iniciar qualquer um dos runbooks neste artigo.</span><span class="sxs-lookup"><span data-stu-id="a2048-173">You can use any of the methods in [Starting a runbook in Azure Automation](automation-starting-a-runbook.md) to start either of the runbooks in this article.</span></span>

<span data-ttu-id="a2048-174">O comando de exemplo a seguir usa o Windows PowerShell para executar **StartAzureClassicVM** e iniciar todas as máquinas virtuais com o nome do serviço *MyVMService*.</span><span class="sxs-lookup"><span data-stu-id="a2048-174">The following sample commands uses Windows PowerShell to run **StartAzureClassicVM** to start all virtual machines with the service name *MyVMService*.</span></span>

    $params = @{"ServiceName"="MyVMService"}
    Start-AzureAutomationRunbook –AutomationAccountName "MyAutomationAccount" –Name "StartAzureClassicVM" –Parameters $params

### <a name="output"></a><span data-ttu-id="a2048-175">Saída</span><span class="sxs-lookup"><span data-stu-id="a2048-175">Output</span></span>
<span data-ttu-id="a2048-176">Os runbooks [emitirão uma mensagem](automation-runbook-output-and-messages.md) para cada máquina virtual, indicando se a instrução de inicialização ou interrupção foi enviada com êxito.</span><span class="sxs-lookup"><span data-stu-id="a2048-176">The runbooks will [output a message](automation-runbook-output-and-messages.md) for each virtual machine indicating whether or not the start or stop instruction was successfully submitted.</span></span>  <span data-ttu-id="a2048-177">Você pode procurar uma cadeia de caracteres específica na saída para determinar o resultado de cada runbook.</span><span class="sxs-lookup"><span data-stu-id="a2048-177">You can look for a specific string in the output to determine the result for each runbook.</span></span>  <span data-ttu-id="a2048-178">As cadeias de caracteres de saída possíveis estão listadas na tabela a seguir.</span><span class="sxs-lookup"><span data-stu-id="a2048-178">The possible output strings are listed in the following table.</span></span>

| <span data-ttu-id="a2048-179">Runbook</span><span class="sxs-lookup"><span data-stu-id="a2048-179">Runbook</span></span> | <span data-ttu-id="a2048-180">Condição</span><span class="sxs-lookup"><span data-stu-id="a2048-180">Condition</span></span> | <span data-ttu-id="a2048-181">Mensagem</span><span class="sxs-lookup"><span data-stu-id="a2048-181">Message</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="a2048-182">StartAzureClassicVM</span><span class="sxs-lookup"><span data-stu-id="a2048-182">StartAzureClassicVM</span></span> |<span data-ttu-id="a2048-183">A máquina virtual já está em execução</span><span class="sxs-lookup"><span data-stu-id="a2048-183">Virtual machine is already running</span></span> |<span data-ttu-id="a2048-184">MyVM já está em execução</span><span class="sxs-lookup"><span data-stu-id="a2048-184">MyVM is already running</span></span> |
| <span data-ttu-id="a2048-185">StartAzureClassicVM</span><span class="sxs-lookup"><span data-stu-id="a2048-185">StartAzureClassicVM</span></span> |<span data-ttu-id="a2048-186">Solicitação de inicialização para máquina virtual enviada com êxito</span><span class="sxs-lookup"><span data-stu-id="a2048-186">Start request for virtual machine successfully submitted</span></span> |<span data-ttu-id="a2048-187">MyVM foi iniciada</span><span class="sxs-lookup"><span data-stu-id="a2048-187">MyVM has been started</span></span> |
| <span data-ttu-id="a2048-188">StartAzureClassicVM</span><span class="sxs-lookup"><span data-stu-id="a2048-188">StartAzureClassicVM</span></span> |<span data-ttu-id="a2048-189">Falha na solicitação de inicialização para máquina virtual</span><span class="sxs-lookup"><span data-stu-id="a2048-189">Start request for virtual machine failed</span></span> |<span data-ttu-id="a2048-190">Falha ao iniciar a MyVM</span><span class="sxs-lookup"><span data-stu-id="a2048-190">MyVM failed to start</span></span> |
| <span data-ttu-id="a2048-191">StopAzureClassicVM</span><span class="sxs-lookup"><span data-stu-id="a2048-191">StopAzureClassicVM</span></span> |<span data-ttu-id="a2048-192">A máquina virtual já está em execução</span><span class="sxs-lookup"><span data-stu-id="a2048-192">Virtual machine is already running</span></span> |<span data-ttu-id="a2048-193">MyVM já foi parada</span><span class="sxs-lookup"><span data-stu-id="a2048-193">MyVM is already stopped</span></span> |
| <span data-ttu-id="a2048-194">StopAzureClassicVM</span><span class="sxs-lookup"><span data-stu-id="a2048-194">StopAzureClassicVM</span></span> |<span data-ttu-id="a2048-195">Solicitação de inicialização para máquina virtual enviada com êxito</span><span class="sxs-lookup"><span data-stu-id="a2048-195">Start request for virtual machine successfully submitted</span></span> |<span data-ttu-id="a2048-196">MyVM foi iniciada</span><span class="sxs-lookup"><span data-stu-id="a2048-196">MyVM has been started</span></span> |
| <span data-ttu-id="a2048-197">StopAzureClassicVM</span><span class="sxs-lookup"><span data-stu-id="a2048-197">StopAzureClassicVM</span></span> |<span data-ttu-id="a2048-198">Falha na solicitação de inicialização para máquina virtual</span><span class="sxs-lookup"><span data-stu-id="a2048-198">Start request for virtual machine failed</span></span> |<span data-ttu-id="a2048-199">Falha ao iniciar a MyVM</span><span class="sxs-lookup"><span data-stu-id="a2048-199">MyVM failed to start</span></span> |

<span data-ttu-id="a2048-200">A seguir, uma imagem de como usar **StartAzureClassicVM** com um [runbook filho](automation-child-runbooks.md) em um runbook gráfico de exemplo.</span><span class="sxs-lookup"><span data-stu-id="a2048-200">Following is an image of using the **StartAzureClassicVM** as a [child runbook](automation-child-runbooks.md) in a sample graphical runbook.</span></span>  <span data-ttu-id="a2048-201">Ela usa os links condicionais da tabela a seguir.</span><span class="sxs-lookup"><span data-stu-id="a2048-201">This uses the conditional links in the following table.</span></span>

| <span data-ttu-id="a2048-202">Link</span><span class="sxs-lookup"><span data-stu-id="a2048-202">Link</span></span> | <span data-ttu-id="a2048-203">Critérios</span><span class="sxs-lookup"><span data-stu-id="a2048-203">Criteria</span></span> |
|:--- |:--- |
| <span data-ttu-id="a2048-204">Link de êxito</span><span class="sxs-lookup"><span data-stu-id="a2048-204">Success link</span></span> |<span data-ttu-id="a2048-205">$ActivityOutput['StartAzureClassicVM'] -like "\* foi iniciada"</span><span class="sxs-lookup"><span data-stu-id="a2048-205">$ActivityOutput['StartAzureClassicVM'] -like "\* has been started"</span></span> |
| <span data-ttu-id="a2048-206">Link de erro</span><span class="sxs-lookup"><span data-stu-id="a2048-206">Error link</span></span> |<span data-ttu-id="a2048-207">$ActivityOutput['StartAzureClassicVM'] -notlike "\* foi iniciada"</span><span class="sxs-lookup"><span data-stu-id="a2048-207">$ActivityOutput['StartAzureClassicVM'] -notlike "\* has been started"</span></span> |

![Exemplo de runbook filho](media/automation-solution-startstopvm/graphical-childrunbook-example.png)

## <a name="detailed-breakdown"></a><span data-ttu-id="a2048-209">Divisão detalhada</span><span class="sxs-lookup"><span data-stu-id="a2048-209">Detailed breakdown</span></span>
<span data-ttu-id="a2048-210">Veja a seguir uma divisão detalhada dos runbooks nesse cenário.</span><span class="sxs-lookup"><span data-stu-id="a2048-210">Following is a detailed breakdown of the runbooks in this scenario.</span></span>  <span data-ttu-id="a2048-211">Você pode usar essas informações para personalizar os runbooks ou apenas para aprender a criar seus próprios cenários de automação.</span><span class="sxs-lookup"><span data-stu-id="a2048-211">You can use this information to either customize the runbooks or just to learn from them for authoring your own automation scenarios.</span></span>

### <a name="authentication"></a><span data-ttu-id="a2048-212">Autenticação</span><span class="sxs-lookup"><span data-stu-id="a2048-212">Authentication</span></span>
![Autenticação](media/automation-solution-startstopvm/graphical-authentication.png)

<span data-ttu-id="a2048-214">O runbook começa com atividades para definir as [credenciais](automation-credentials.md) e a assinatura do Azure que serão usadas para o restante do runbook.</span><span class="sxs-lookup"><span data-stu-id="a2048-214">The runbook starts with activities to set the [credentials](automation-credentials.md) and Azure subscription that will be used for the rest of the runbook.</span></span>

<span data-ttu-id="a2048-215">As primeiras duas atividades, **Obter ID de Assinatura** e **Obter Credenciais do Azure**, recuperam os [ativos](#installing-the-runbook) que serão usados pelas duas atividades.</span><span class="sxs-lookup"><span data-stu-id="a2048-215">The first two activities, **Get Subscription Id** and **Get Azure Credential**, retrieve the [assets](#installing-the-runbook) that are used by the next two activities.</span></span>  <span data-ttu-id="a2048-216">Essas atividades podem especificar diretamente os ativos, mas elas precisam dos nomes do ativo.</span><span class="sxs-lookup"><span data-stu-id="a2048-216">Those activities could directly specify the assets, but they need the asset names.</span></span>  <span data-ttu-id="a2048-217">Uma vez que estamos permitindo ao usuário especificar esses nomes nos [parâmetros de entrada](#using-the-runbooks), precisamos dessas atividades para recuperar os ativos com um nome especificado por um parâmetro de entrada.</span><span class="sxs-lookup"><span data-stu-id="a2048-217">Since we are allowing the user to specify those names in the [input parameters](#using-the-runbooks), we need these activities to retrieve the assets with a name specified by an input parameter.</span></span>

<span data-ttu-id="a2048-218">**Add-AzureAccount** define as credenciais que serão usadas no restante do runbook.</span><span class="sxs-lookup"><span data-stu-id="a2048-218">**Add-AzureAccount** sets the credentials that will be used for the rest of the runbook.</span></span>  <span data-ttu-id="a2048-219">O ativo credencial recuperado de **Obter Credencial do Azure** deve ter acesso para iniciar e parar máquinas virtuais na assinatura do Azure.</span><span class="sxs-lookup"><span data-stu-id="a2048-219">The credential asset that it retrieves from **Get Azure Credential** must have access to start and stop virtual machines in the Azure subscription.</span></span>  <span data-ttu-id="a2048-220">A assinatura usada é selecionada por **Select-AzureSubscription**, que usa a ID de assinatura de **Obter ID de Assinatura**.</span><span class="sxs-lookup"><span data-stu-id="a2048-220">The subscription that's used is selected by **Select-AzureSubscription** which uses the subscription Id from **Get Subscription Id**.</span></span>

### <a name="get-virtual-machines"></a><span data-ttu-id="a2048-221">Obter máquinas virtuais</span><span class="sxs-lookup"><span data-stu-id="a2048-221">Get virtual machines</span></span>
![Obter VMs](media/automation-solution-startstopvm/graphical-getvms.png)

<span data-ttu-id="a2048-223">O runbook precisa determinar com quais máquinas virtuais ele trabalhará e se elas já tiverem sido iniciadas ou paradas (dependendo do runbook).</span><span class="sxs-lookup"><span data-stu-id="a2048-223">The runbook needs to determine which virtual machines it will be working with and whether they are already started or stopped (depending on the runbook).</span></span>   <span data-ttu-id="a2048-224">Uma das duas atividades vai recuperar as VMs.</span><span class="sxs-lookup"><span data-stu-id="a2048-224">One of two activities will retrieve the VMs.</span></span>  <span data-ttu-id="a2048-225">**Obter VMs em Serviço** será executado se o parâmetro de entrada *ServiceName* para o runbook contiver um valor.</span><span class="sxs-lookup"><span data-stu-id="a2048-225">**Get VMs in Service** will run if the *ServiceName* input parameter for the runbook contains a value.</span></span>  <span data-ttu-id="a2048-226">**Obter Todas as VMs** será executado se o parâmetro de entrada *ServiceName* para o runbook não contiver um valor.</span><span class="sxs-lookup"><span data-stu-id="a2048-226">**Get All VMs** will run if the *ServiceName* input parameter for the runbook does not contain a value.</span></span>  <span data-ttu-id="a2048-227">Essa lógica é executada pelos links condicionais que precedem cada atividade.</span><span class="sxs-lookup"><span data-stu-id="a2048-227">This logic is performed by the conditional links preceding each activity.</span></span>

<span data-ttu-id="a2048-228">Ambas as atividades usam o cmdlet **Get-AzureVM** .</span><span class="sxs-lookup"><span data-stu-id="a2048-228">Both activities use the **Get-AzureVM** cmdlet.</span></span>  <span data-ttu-id="a2048-229">**Obter Todas as VMs** usa o conjunto de parâmetros **ListAllVMs** para retornar todas as máquinas virtuais.</span><span class="sxs-lookup"><span data-stu-id="a2048-229">**Get All VMs** uses the **ListAllVMs** parameter set to return all virtual machines.</span></span>  <span data-ttu-id="a2048-230">**Obter VMs em Serviço** usa o conjunto de parâmetros **GetVMByServiceAndVMName** e fornece o parâmetro de entrada **ServiceName** para o parâmetro **ServiceName**.</span><span class="sxs-lookup"><span data-stu-id="a2048-230">**Get VMs in Service** uses the **GetVMByServiceAndVMName** parameter set and provides the **ServiceName** input parameter for the **ServiceName** parameter.</span></span>  

### <a name="merge-vms"></a><span data-ttu-id="a2048-231">Mesclar VMs</span><span class="sxs-lookup"><span data-stu-id="a2048-231">Merge VMs</span></span>
![Mesclar VMs](media/automation-solution-startstopvm/graphical-mergevms.png)

<span data-ttu-id="a2048-233">A atividade **Mesclar VMs** é exigida para fornecer entrada para **Start-AzureVM**, que precisa do nome e do nome do serviço das VMs a serem iniciadas.</span><span class="sxs-lookup"><span data-stu-id="a2048-233">The **Merge VMs** activity is required to provide input to **Start-AzureVM** which needs the name and service name of the vm(s) to start.</span></span>  <span data-ttu-id="a2048-234">Essa entrada pode ser originada em **Obter Todas as VMs** ou **Obter VMs em Serviço**, mas **Start-AzureVM** pode apenas especificar uma atividade para sua entrada.</span><span class="sxs-lookup"><span data-stu-id="a2048-234">That input could come from either **Get All VMs** or **Get VMs in Service**, but **Start-AzureVM** can only specify one activity for its input.</span></span>   

<span data-ttu-id="a2048-235">A função do cenário é criar a opção **Mesclar VMs**, que executa o cmdlet **Write-Output**.</span><span class="sxs-lookup"><span data-stu-id="a2048-235">The scenario is to create **Merge VMs** which runs the **Write-Output** cmdlet.</span></span>  <span data-ttu-id="a2048-236">O parâmetro **InputObject** para esse cmdlet é uma Expressão do PowerShell que combina a entrada das duas atividades anteriores.</span><span class="sxs-lookup"><span data-stu-id="a2048-236">The **InputObject** parameter for that cmdlet is a PowerShell Expression that combines the input of the previous two activities.</span></span>  <span data-ttu-id="a2048-237">Apenas uma dessas atividades será executada, de modo que apenas um conjunto de saída é esperado.</span><span class="sxs-lookup"><span data-stu-id="a2048-237">Only one of those activities will run, so only one set of output is expected.</span></span>  <span data-ttu-id="a2048-238">**Start-AzureVM** pode usar essa saída para seus parâmetros de entrada.</span><span class="sxs-lookup"><span data-stu-id="a2048-238">**Start-AzureVM** can use that output for its input parameters.</span></span>

### <a name="startstop-virtual-machines"></a><span data-ttu-id="a2048-239">Iniciar/parar máquinas virtuais</span><span class="sxs-lookup"><span data-stu-id="a2048-239">Start/Stop virtual machines</span></span>
![Iniciar VMs](media/automation-solution-startstopvm/graphical-startvm.png) ![Parar VMs](media/automation-solution-startstopvm/graphical-stopvm.png)

<span data-ttu-id="a2048-242">Dependendo do runbook, as próximas atividades tentam iniciar ou parar o runbook usando **Start-AzureVM** ou **Stop-AzureVM**.</span><span class="sxs-lookup"><span data-stu-id="a2048-242">Depending on the runbook, the next activities attempt to start or stop the runbook using **Start-AzureVM** or **Stop-AzureVM**.</span></span>  <span data-ttu-id="a2048-243">Uma vez que a atividade é precedida por um link de pipeline, ela será executada uma vez para cada objeto retornado de **Mesclar VMs**.</span><span class="sxs-lookup"><span data-stu-id="a2048-243">Since the activity is preceded by a pipeline link, it will run once for each object returned from **Merge VMs**.</span></span>  <span data-ttu-id="a2048-244">O link é condicional, de modo que a atividade será executada somente se *RunningState* da máquina virtual for *Parado* para **Start-AzureVM** e *Iniciado* para **Stop-AzureVM**.</span><span class="sxs-lookup"><span data-stu-id="a2048-244">The link is conditional so that the activity will only run if the *RunningState* of the virtual machine is *Stopped* for **Start-AzureVM** and *Started* for **Stop-AzureVM**.</span></span> <span data-ttu-id="a2048-245">Se essa condição não for atendida, **Notificar Já Iniciadas** ou **Notificar Já Interrompidas** será executada para enviar uma mensagem usando **Write-Output**.</span><span class="sxs-lookup"><span data-stu-id="a2048-245">If this condition is not met, then **Notify Already Started** or **Notify Already Stopped** is run to send a message using **Write-Output**.</span></span>

### <a name="send-output"></a><span data-ttu-id="a2048-246">Enviar saída</span><span class="sxs-lookup"><span data-stu-id="a2048-246">Send output</span></span>
![Notificar Iniciar VMs](media/automation-solution-startstopvm/graphical-notifystart.png) ![Notificar Parar VMs](media/automation-solution-startstopvm/graphical-notifystop.png)

<span data-ttu-id="a2048-249">A etapa final no runbook é enviar a saída, se a solicitação de inicialização ou de interrupção de cada máquina virtual tiver sido enviada com êxito.</span><span class="sxs-lookup"><span data-stu-id="a2048-249">The final step in the runbook is to send output whether the start or stop request for each virtual machine was successfully submitted.</span></span> <span data-ttu-id="a2048-250">Há uma atividade **Write-Output** separada para cada uma e determinamos qual delas executar com links condicionais.</span><span class="sxs-lookup"><span data-stu-id="a2048-250">There is a separate **Write-Output** activity for each, and we determine which one to run with conditional links.</span></span>  <span data-ttu-id="a2048-251">**Notificar VM Iniciada** ou **Notificar VM Parada** será executada se *OperationStatus* for *Êxito*.</span><span class="sxs-lookup"><span data-stu-id="a2048-251">**Notify VM Started** or **Notify VM Stopped** is run if *OperationStatus* is *Succeeded*.</span></span>  <span data-ttu-id="a2048-252">Se *OperationStatus* tiver qualquer outro valor, **Notificar Falhou ao Iniciar** ou **Notificar Falhou ao Parar** será executada.</span><span class="sxs-lookup"><span data-stu-id="a2048-252">If *OperationStatus* is any other value, then **Notify Failed To Start** or **Notify Failed to Stop** is run.</span></span>

## <a name="next-steps"></a><span data-ttu-id="a2048-253">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="a2048-253">Next steps</span></span>
* [<span data-ttu-id="a2048-254">Criação gráfica na Automação do Azure</span><span class="sxs-lookup"><span data-stu-id="a2048-254">Graphical authoring in Azure Automation</span></span>](automation-graphical-authoring-intro.md)
* [<span data-ttu-id="a2048-255">Runbooks filhos na Automação do Azure</span><span class="sxs-lookup"><span data-stu-id="a2048-255">Child runbooks in Azure Automation</span></span>](automation-child-runbooks.md)
* [<span data-ttu-id="a2048-256">Saída de runbook e mensagens na Automação do Azure</span><span class="sxs-lookup"><span data-stu-id="a2048-256">Runbook output and messages in Azure Automation</span></span>](automation-runbook-output-and-messages.md)
