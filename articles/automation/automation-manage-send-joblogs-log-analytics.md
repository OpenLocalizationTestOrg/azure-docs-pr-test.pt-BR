---
title: "Encaminhar dados do trabalho da Automação do Azure para o OMS Log Analytics | Microsoft Docs"
description: "Este artigo demonstra como enviar status de trabalho e fluxos de trabalho de runbook para Gerenciamento e Log Analytics do Microsoft Operations Management Suite para fornecer informações adicionais."
services: automation
documentationcenter: 
author: MGoedtel
manager: carmonm
editor: tysonn
ms.assetid: c12724c6-01a9-4b55-80ae-d8b7b99bd436
ms.service: automation
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 06/02/2017
ms.author: magoedte
ms.openlocfilehash: 2c0ca7fc332963e5a5db3c20c400ed877ae0cc54
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="forward-job-status-and-job-streams-from-automation-to-log-analytics-oms"></a><span data-ttu-id="2a94e-103">Encaminhar status do trabalho e fluxos de trabalho de Automação para Log Analytics (OMS)</span><span class="sxs-lookup"><span data-stu-id="2a94e-103">Forward job status and job streams from Automation to Log Analytics (OMS)</span></span>
<span data-ttu-id="2a94e-104">A Automação pode enviar o status do trabalho de runbook e fluxos de trabalho para seu espaço de trabalho de Log Analytics do Microsoft Operations Management Suite (OMS).</span><span class="sxs-lookup"><span data-stu-id="2a94e-104">Automation can send runbook job status and job streams to your Microsoft Operations Management Suite (OMS) Log Analytics workspace.</span></span>  <span data-ttu-id="2a94e-105">Os logs e fluxos de trabalho podem ser vistos no portal do Azure ou com o PowerShell, no caso de trabalhos individuais, e isso permite a você fazer investigações simples.</span><span class="sxs-lookup"><span data-stu-id="2a94e-105">Job logs and job streams are visible in the Azure portal, or with PowerShell, for individual jobs and this allows you to perform simple investigations.</span></span> <span data-ttu-id="2a94e-106">Com o Log Analytics, você pode:</span><span class="sxs-lookup"><span data-stu-id="2a94e-106">Now with Log Analytics you can:</span></span>

* <span data-ttu-id="2a94e-107">Obter informações sobre os trabalhos de Automação</span><span class="sxs-lookup"><span data-stu-id="2a94e-107">Get insight on your Automation jobs</span></span>
* <span data-ttu-id="2a94e-108">Disparar um email ou um alerta com base no status do trabalho de runbook (por exemplo, com falha ou suspenso)</span><span class="sxs-lookup"><span data-stu-id="2a94e-108">Trigger an email or alert based on your runbook job status (for example, failed or suspended)</span></span>
* <span data-ttu-id="2a94e-109">Escrever consultas avançadas em seus fluxos de trabalho</span><span class="sxs-lookup"><span data-stu-id="2a94e-109">Write advanced queries across your job streams</span></span>
* <span data-ttu-id="2a94e-110">Correlacionar trabalhos em contas de Automação</span><span class="sxs-lookup"><span data-stu-id="2a94e-110">Correlate jobs across Automation accounts</span></span>
* <span data-ttu-id="2a94e-111">Visualizar o histórico de trabalho ao longo do tempo</span><span class="sxs-lookup"><span data-stu-id="2a94e-111">Visualize your job history over time</span></span>     

## <a name="prerequisites-and-deployment-considerations"></a><span data-ttu-id="2a94e-112">Pré-requisitos e considerações de implantação</span><span class="sxs-lookup"><span data-stu-id="2a94e-112">Prerequisites and deployment considerations</span></span>
<span data-ttu-id="2a94e-113">Para começar a enviar seus logs de Automação para Log Analytics, você precisará do seguinte:</span><span class="sxs-lookup"><span data-stu-id="2a94e-113">To start sending your Automation logs to Log Analytics, you need:</span></span>

1. <span data-ttu-id="2a94e-114">Versão de novembro 2016 ou posterior do [Azure PowerShell](https://docs.microsoft.com/powershell/azureps-cmdlets-docs/) ( versão 2.3.0).</span><span class="sxs-lookup"><span data-stu-id="2a94e-114">The November 2016 or later release of [Azure PowerShell](https://docs.microsoft.com/powershell/azureps-cmdlets-docs/) (v2.3.0).</span></span>
2. <span data-ttu-id="2a94e-115">Um espaço de trabalho do Log Analytics.</span><span class="sxs-lookup"><span data-stu-id="2a94e-115">A Log Analytics workspace.</span></span> <span data-ttu-id="2a94e-116">Para saber mais, confira [Introdução ao Log Analytics](../log-analytics/log-analytics-get-started.md).</span><span class="sxs-lookup"><span data-stu-id="2a94e-116">For more information, see [Get started with Log Analytics](../log-analytics/log-analytics-get-started.md).</span></span> 
3. <span data-ttu-id="2a94e-117">O ResourceId para sua conta da Automação do Azure</span><span class="sxs-lookup"><span data-stu-id="2a94e-117">The ResourceId for your Azure Automation account</span></span>

<span data-ttu-id="2a94e-118">Para localizar o ResourceId da sua conta da Automação do Azure e o espaço de trabalho do Log Analytics, execute o seguinte PowerShell:</span><span class="sxs-lookup"><span data-stu-id="2a94e-118">To find the ResourceId for your Azure Automation account and Log Analytics workspace, run the following PowerShell:</span></span>

```powershell
# Find the ResourceId for the Automation Account
Find-AzureRmResource -ResourceType "Microsoft.Automation/automationAccounts"

# Find the ResourceId for the Log Analytics workspace
Find-AzureRmResource -ResourceType "Microsoft.OperationalInsights/workspaces"
```

<span data-ttu-id="2a94e-119">Se tiver várias contas de automação ou espaços de trabalho, na saída dos comandos acima, localize o *Nome* que você precisa configurar e copie o valor de *ResourceId*.</span><span class="sxs-lookup"><span data-stu-id="2a94e-119">If you have multiple Automation accounts, or workspaces, in the output of the preceding commands, find the *Name* you need to configure and copy the value for *ResourceId*.</span></span>

<span data-ttu-id="2a94e-120">Se precisar encontrar o *Nome* da sua Conta de automação, no portal do Azure, selecione sua conta de Automação na folha **Conta de automação** e selecione **Todas as configurações**.</span><span class="sxs-lookup"><span data-stu-id="2a94e-120">If you need to find the *Name* of your Automation account, in the Azure portal select your Automation account from the **Automation account** blade and select **All settings**.</span></span>  <span data-ttu-id="2a94e-121">Na folha **Todas as configurações**, em **Configurações de Conta**, selecione **Propriedades**.</span><span class="sxs-lookup"><span data-stu-id="2a94e-121">From the **All settings** blade, under **Account Settings** select **Properties**.</span></span>  <span data-ttu-id="2a94e-122">Na folha **Propriedades**, você pode observar esses valores.</span><span class="sxs-lookup"><span data-stu-id="2a94e-122">In the **Properties** blade, you can note these values.</span></span><br> <span data-ttu-id="2a94e-123">![Propriedades da Conta de Automação](media/automation-manage-send-joblogs-log-analytics/automation-account-properties.png).</span><span class="sxs-lookup"><span data-stu-id="2a94e-123">![Automation Account properties](media/automation-manage-send-joblogs-log-analytics/automation-account-properties.png).</span></span>

## <a name="set-up-integration-with-log-analytics"></a><span data-ttu-id="2a94e-124">Configurar a integração com o Log Analytics</span><span class="sxs-lookup"><span data-stu-id="2a94e-124">Set up integration with Log Analytics</span></span>
1. <span data-ttu-id="2a94e-125">Em seu computador, inicie o **Windows PowerShell** na tela **Inicial**.</span><span class="sxs-lookup"><span data-stu-id="2a94e-125">On your computer, start **Windows PowerShell** from the **Start** screen.</span></span>  
2. <span data-ttu-id="2a94e-126">Copie e cole o PowerShell a seguir e edite o valor de `$workspaceId` e `$automationAccountId`.</span><span class="sxs-lookup"><span data-stu-id="2a94e-126">Copy and paste the following PowerShell, and edit the value for the `$workspaceId` and `$automationAccountId`.</span></span>  <span data-ttu-id="2a94e-127">Para o parâmetro `-Environment`, os valores válidos são *AzureCloud* ou *AzureUSGovernment*, dependendo do ambiente de nuvem no qual você está trabalhando.</span><span class="sxs-lookup"><span data-stu-id="2a94e-127">For the `-Environment` parameter, valid values are *AzureCloud* or *AzureUSGovernment* depending on the cloud environment you are working in.</span></span>     

```powershell
[cmdletBinding()]
    Param
    (
        [Parameter(Mandatory=$True)]
        [ValidateSet("AzureCloud","AzureUSGovernment")]
        [string]$Environment="AzureCloud"
    )

#Check to see which cloud environment to sign into.
Switch ($Environment)
   {
       "AzureCloud" {Login-AzureRmAccount}
       "AzureUSGovernment" {Login-AzureRmAccount -EnvironmentName AzureUSGovernment} 
   }

# if you have one Log Analytics workspace you can use the following command to get the resource id of the workspace
$workspaceId = (Get-AzureRmOperationalInsightsWorkspace).ResourceId

$automationAccountId = "/SUBSCRIPTIONS/ec11ca60-1234-491e-5678-0ea07feae25c/RESOURCEGROUPS/DEMO/PROVIDERS/MICROSOFT.AUTOMATION/ACCOUNTS/DEMO" 

Set-AzureRmDiagnosticSetting -ResourceId $automationAccountId -WorkspaceId $workspaceId -Enabled $true

```

<span data-ttu-id="2a94e-128">Depois de executar esse script, você verá os registros no Log Analytics em 10 minutos a seguir à gravação do novo JobLogs ou JobStreams.</span><span class="sxs-lookup"><span data-stu-id="2a94e-128">After running this script, you will see records in Log Analytics within 10 minutes of new JobLogs or JobStreams being written.</span></span>

<span data-ttu-id="2a94e-129">Para ver os logs, execute a seguinte consulta na pesquisa de logs do Log Analytics: `Type=AzureDiagnostics ResourceProvider="MICROSOFT.AUTOMATION"`</span><span class="sxs-lookup"><span data-stu-id="2a94e-129">To see the logs, run the following query in Log Analytics log search: `Type=AzureDiagnostics ResourceProvider="MICROSOFT.AUTOMATION"`</span></span>

### <a name="verify-configuration"></a><span data-ttu-id="2a94e-130">Verificar a configuração</span><span class="sxs-lookup"><span data-stu-id="2a94e-130">Verify configuration</span></span>
<span data-ttu-id="2a94e-131">Para confirmar que sua conta de automação está enviando logs para o seu espaço de trabalho do Log Analytics, verifique se os diagnósticos estão definidos corretamente na Conta de automação usando o seguinte PowerShell:</span><span class="sxs-lookup"><span data-stu-id="2a94e-131">To confirm that your Automation account is sending logs to your Log Analytics workspace, check that diagnostics are set correctly on the Automation account using the following PowerShell:</span></span>

```powershell
[cmdletBinding()]
    Param
    (
        [Parameter(Mandatory=$True)]
        [ValidateSet("AzureCloud","AzureUSGovernment")]
        [string]$Environment="AzureCloud"
    )

#Check to see which cloud environment to sign into.
Switch ($Environment)
   {
       "AzureCloud" {Login-AzureRmAccount}
       "AzureUSGovernment" {Login-AzureRmAccount -EnvironmentName AzureUSGovernment} 
   }
# if you have one Log Analytics workspace you can use the following command to get the resource id of the workspace
$workspaceId = (Get-AzureRmOperationalInsightsWorkspace).ResourceId

$automationAccountId = "/SUBSCRIPTIONS/ec11ca60-1234-491e-5678-0ea07feae25c/RESOURCEGROUPS/DEMO/PROVIDERS/MICROSOFT.AUTOMATION/ACCOUNTS/DEMO" 

Get-AzureRmDiagnosticSetting -ResourceId $automationAccountId
```

<span data-ttu-id="2a94e-132">Na saída, verifique se:</span><span class="sxs-lookup"><span data-stu-id="2a94e-132">In the output ensure that:</span></span>
+ <span data-ttu-id="2a94e-133">Em *Logs*, o valor de *Habilitado* é *True*</span><span class="sxs-lookup"><span data-stu-id="2a94e-133">Under *Logs*, the value for *Enabled* is *True*</span></span>
+ <span data-ttu-id="2a94e-134">O valor de *WorkspaceId* é definido como o ResourceId do seu espaço de trabalho do Log Analytics</span><span class="sxs-lookup"><span data-stu-id="2a94e-134">The value of *WorkspaceId* is set to the ResourceId of your Log Analytics workspace</span></span>


## <a name="log-analytics-records"></a><span data-ttu-id="2a94e-135">Registros do Log Analytics</span><span class="sxs-lookup"><span data-stu-id="2a94e-135">Log Analytics records</span></span>
<span data-ttu-id="2a94e-136">O diagnóstico de Automação do Azure cira dois tipos de registros no Log Analytics e é marcado como **Type=AzureDiagnostics**.</span><span class="sxs-lookup"><span data-stu-id="2a94e-136">Diagnostics from Azure Automation creates two types of records in Log Analytics and are tagged as **Type=AzureDiagnostics**.</span></span>

### <a name="job-logs"></a><span data-ttu-id="2a94e-137">Logs de trabalho</span><span class="sxs-lookup"><span data-stu-id="2a94e-137">Job Logs</span></span>
| <span data-ttu-id="2a94e-138">Propriedade</span><span class="sxs-lookup"><span data-stu-id="2a94e-138">Property</span></span> | <span data-ttu-id="2a94e-139">Descrição</span><span class="sxs-lookup"><span data-stu-id="2a94e-139">Description</span></span> |
| --- | --- |
| <span data-ttu-id="2a94e-140">TimeGenerated</span><span class="sxs-lookup"><span data-stu-id="2a94e-140">TimeGenerated</span></span> |<span data-ttu-id="2a94e-141">Data e hora da execução do trabalho de runbook.</span><span class="sxs-lookup"><span data-stu-id="2a94e-141">Date and time when the runbook job executed.</span></span> |
| <span data-ttu-id="2a94e-142">RunbookName_s</span><span class="sxs-lookup"><span data-stu-id="2a94e-142">RunbookName_s</span></span> |<span data-ttu-id="2a94e-143">O nome do runbook.</span><span class="sxs-lookup"><span data-stu-id="2a94e-143">The name of the runbook.</span></span> |
| <span data-ttu-id="2a94e-144">Caller_s</span><span class="sxs-lookup"><span data-stu-id="2a94e-144">Caller_s</span></span> |<span data-ttu-id="2a94e-145">Quem iniciou a operação.</span><span class="sxs-lookup"><span data-stu-id="2a94e-145">Who initiated the operation.</span></span>  <span data-ttu-id="2a94e-146">Os valores possíveis são um endereço de email ou o sistema para trabalhos agendados.</span><span class="sxs-lookup"><span data-stu-id="2a94e-146">Possible values are either an email address or system for scheduled jobs.</span></span> |
| <span data-ttu-id="2a94e-147">Tenant_g</span><span class="sxs-lookup"><span data-stu-id="2a94e-147">Tenant_g</span></span> | <span data-ttu-id="2a94e-148">GUID que identifica o locatário para o Chamador.</span><span class="sxs-lookup"><span data-stu-id="2a94e-148">GUID that identifies the tenant for the Caller.</span></span> |
| <span data-ttu-id="2a94e-149">JobId_g</span><span class="sxs-lookup"><span data-stu-id="2a94e-149">JobId_g</span></span> |<span data-ttu-id="2a94e-150">GUID que é a Id do trabalho de runbook.</span><span class="sxs-lookup"><span data-stu-id="2a94e-150">GUID that is the Id of the runbook job.</span></span> |
| <span data-ttu-id="2a94e-151">ResultType</span><span class="sxs-lookup"><span data-stu-id="2a94e-151">ResultType</span></span> |<span data-ttu-id="2a94e-152">O status do trabalho de runbook.</span><span class="sxs-lookup"><span data-stu-id="2a94e-152">The status of the runbook job.</span></span>  <span data-ttu-id="2a94e-153">Os valores possíveis são:</span><span class="sxs-lookup"><span data-stu-id="2a94e-153">Possible values are:</span></span><br><span data-ttu-id="2a94e-154">- Iniciado</span><span class="sxs-lookup"><span data-stu-id="2a94e-154">- Started</span></span><br><span data-ttu-id="2a94e-155">- Parado</span><span class="sxs-lookup"><span data-stu-id="2a94e-155">- Stopped</span></span><br><span data-ttu-id="2a94e-156">- Suspenso</span><span class="sxs-lookup"><span data-stu-id="2a94e-156">- Suspended</span></span><br><span data-ttu-id="2a94e-157">- Com falha</span><span class="sxs-lookup"><span data-stu-id="2a94e-157">- Failed</span></span><br><span data-ttu-id="2a94e-158">– Concluído</span><span class="sxs-lookup"><span data-stu-id="2a94e-158">- Completed</span></span> |
| <span data-ttu-id="2a94e-159">Categoria</span><span class="sxs-lookup"><span data-stu-id="2a94e-159">Category</span></span> | <span data-ttu-id="2a94e-160">Classificação do tipo de dados.</span><span class="sxs-lookup"><span data-stu-id="2a94e-160">Classification of the type of data.</span></span>  <span data-ttu-id="2a94e-161">Para a Automação, o valor é JobLogs.</span><span class="sxs-lookup"><span data-stu-id="2a94e-161">For Automation, the value is JobLogs.</span></span> |
| <span data-ttu-id="2a94e-162">OperationName</span><span class="sxs-lookup"><span data-stu-id="2a94e-162">OperationName</span></span> | <span data-ttu-id="2a94e-163">Especifica o tipo de operação realizada no Azure.</span><span class="sxs-lookup"><span data-stu-id="2a94e-163">Specifies the type of operation performed in Azure.</span></span>  <span data-ttu-id="2a94e-164">Para a Automação, o valor é Job.</span><span class="sxs-lookup"><span data-stu-id="2a94e-164">For Automation, the value is Job.</span></span> |
| <span data-ttu-id="2a94e-165">Recurso</span><span class="sxs-lookup"><span data-stu-id="2a94e-165">Resource</span></span> | <span data-ttu-id="2a94e-166">Nome da Conta de automação</span><span class="sxs-lookup"><span data-stu-id="2a94e-166">Name of the Automation account</span></span> |
| <span data-ttu-id="2a94e-167">SourceSystem</span><span class="sxs-lookup"><span data-stu-id="2a94e-167">SourceSystem</span></span> | <span data-ttu-id="2a94e-168">Como o Log Analytics coletou os dados.</span><span class="sxs-lookup"><span data-stu-id="2a94e-168">How Log Analytics collected the data.</span></span> <span data-ttu-id="2a94e-169">Sempre *Azure* para o Diagnóstico do Azure.</span><span class="sxs-lookup"><span data-stu-id="2a94e-169">Always *Azure* for Azure diagnostics.</span></span> |
| <span data-ttu-id="2a94e-170">ResultDescription</span><span class="sxs-lookup"><span data-stu-id="2a94e-170">ResultDescription</span></span> |<span data-ttu-id="2a94e-171">Descreve o estado de resultado do trabalho de runbook.</span><span class="sxs-lookup"><span data-stu-id="2a94e-171">Describes the runbook job result state.</span></span>  <span data-ttu-id="2a94e-172">Os valores possíveis são:</span><span class="sxs-lookup"><span data-stu-id="2a94e-172">Possible values are:</span></span><br><span data-ttu-id="2a94e-173">- O trabalho foi iniciado</span><span class="sxs-lookup"><span data-stu-id="2a94e-173">- Job is started</span></span><br><span data-ttu-id="2a94e-174">- O trabalho falhou</span><span class="sxs-lookup"><span data-stu-id="2a94e-174">- Job Failed</span></span><br><span data-ttu-id="2a94e-175">- Trabalho Concluído</span><span class="sxs-lookup"><span data-stu-id="2a94e-175">- Job Completed</span></span> |
| <span data-ttu-id="2a94e-176">CorrelationId</span><span class="sxs-lookup"><span data-stu-id="2a94e-176">CorrelationId</span></span> |<span data-ttu-id="2a94e-177">O GUID que é a Id de correlação do trabalho de runbook.</span><span class="sxs-lookup"><span data-stu-id="2a94e-177">GUID that is the Correlation Id of the runbook job.</span></span> |
| <span data-ttu-id="2a94e-178">ResourceId</span><span class="sxs-lookup"><span data-stu-id="2a94e-178">ResourceId</span></span> |<span data-ttu-id="2a94e-179">Especifica a ID de recurso da conta da Automação do Azure para o runbook.</span><span class="sxs-lookup"><span data-stu-id="2a94e-179">Specifies the Azure Automation account resource id of the runbook.</span></span> |
| <span data-ttu-id="2a94e-180">SubscriptionId</span><span class="sxs-lookup"><span data-stu-id="2a94e-180">SubscriptionId</span></span> | <span data-ttu-id="2a94e-181">O GUID (ID de assinatura do Azure) para a Conta de automação.</span><span class="sxs-lookup"><span data-stu-id="2a94e-181">The Azure subscription Id (GUID) for the Automation account.</span></span> |
| <span data-ttu-id="2a94e-182">ResourceGroup</span><span class="sxs-lookup"><span data-stu-id="2a94e-182">ResourceGroup</span></span> | <span data-ttu-id="2a94e-183">Nome do grupo de recursos para a Conta de automação.</span><span class="sxs-lookup"><span data-stu-id="2a94e-183">Name of the resource group for the Automation account.</span></span> |
| <span data-ttu-id="2a94e-184">ResourceProvider</span><span class="sxs-lookup"><span data-stu-id="2a94e-184">ResourceProvider</span></span> | <span data-ttu-id="2a94e-185">MICROSOFT.AUTOMATION</span><span class="sxs-lookup"><span data-stu-id="2a94e-185">MICROSOFT.AUTOMATION</span></span> |
| <span data-ttu-id="2a94e-186">ResourceType</span><span class="sxs-lookup"><span data-stu-id="2a94e-186">ResourceType</span></span> | <span data-ttu-id="2a94e-187">AUTOMATIONACCOUNTS</span><span class="sxs-lookup"><span data-stu-id="2a94e-187">AUTOMATIONACCOUNTS</span></span> |


### <a name="job-streams"></a><span data-ttu-id="2a94e-188">Transmissões de trabalho</span><span class="sxs-lookup"><span data-stu-id="2a94e-188">Job Streams</span></span>
| <span data-ttu-id="2a94e-189">Propriedade</span><span class="sxs-lookup"><span data-stu-id="2a94e-189">Property</span></span> | <span data-ttu-id="2a94e-190">Descrição</span><span class="sxs-lookup"><span data-stu-id="2a94e-190">Description</span></span> |
| --- | --- |
| <span data-ttu-id="2a94e-191">TimeGenerated</span><span class="sxs-lookup"><span data-stu-id="2a94e-191">TimeGenerated</span></span> |<span data-ttu-id="2a94e-192">Data e hora da execução do trabalho de runbook.</span><span class="sxs-lookup"><span data-stu-id="2a94e-192">Date and time when the runbook job executed.</span></span> |
| <span data-ttu-id="2a94e-193">RunbookName_s</span><span class="sxs-lookup"><span data-stu-id="2a94e-193">RunbookName_s</span></span> |<span data-ttu-id="2a94e-194">O nome do runbook.</span><span class="sxs-lookup"><span data-stu-id="2a94e-194">The name of the runbook.</span></span> |
| <span data-ttu-id="2a94e-195">Caller_s</span><span class="sxs-lookup"><span data-stu-id="2a94e-195">Caller_s</span></span> |<span data-ttu-id="2a94e-196">Quem iniciou a operação.</span><span class="sxs-lookup"><span data-stu-id="2a94e-196">Who initiated the operation.</span></span>  <span data-ttu-id="2a94e-197">Os valores possíveis são um endereço de email ou o sistema para trabalhos agendados.</span><span class="sxs-lookup"><span data-stu-id="2a94e-197">Possible values are either an email address or system for scheduled jobs.</span></span> |
| <span data-ttu-id="2a94e-198">StreamType_s</span><span class="sxs-lookup"><span data-stu-id="2a94e-198">StreamType_s</span></span> |<span data-ttu-id="2a94e-199">O tipo de fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="2a94e-199">The type of job stream.</span></span> <span data-ttu-id="2a94e-200">Os valores possíveis são:</span><span class="sxs-lookup"><span data-stu-id="2a94e-200">Possible values are:</span></span><br><span data-ttu-id="2a94e-201">- Andamento</span><span class="sxs-lookup"><span data-stu-id="2a94e-201">-Progress</span></span><br><span data-ttu-id="2a94e-202">- Saída</span><span class="sxs-lookup"><span data-stu-id="2a94e-202">- Output</span></span><br><span data-ttu-id="2a94e-203">- Aviso</span><span class="sxs-lookup"><span data-stu-id="2a94e-203">- Warning</span></span><br><span data-ttu-id="2a94e-204">- Erro</span><span class="sxs-lookup"><span data-stu-id="2a94e-204">- Error</span></span><br><span data-ttu-id="2a94e-205">- Depurar</span><span class="sxs-lookup"><span data-stu-id="2a94e-205">- Debug</span></span><br><span data-ttu-id="2a94e-206">- Detalhado</span><span class="sxs-lookup"><span data-stu-id="2a94e-206">- Verbose</span></span> |
| <span data-ttu-id="2a94e-207">Tenant_g</span><span class="sxs-lookup"><span data-stu-id="2a94e-207">Tenant_g</span></span> | <span data-ttu-id="2a94e-208">GUID que identifica o locatário para o Chamador.</span><span class="sxs-lookup"><span data-stu-id="2a94e-208">GUID that identifies the tenant for the Caller.</span></span> |
| <span data-ttu-id="2a94e-209">JobId_g</span><span class="sxs-lookup"><span data-stu-id="2a94e-209">JobId_g</span></span> |<span data-ttu-id="2a94e-210">GUID que é a Id do trabalho de runbook.</span><span class="sxs-lookup"><span data-stu-id="2a94e-210">GUID that is the Id of the runbook job.</span></span> |
| <span data-ttu-id="2a94e-211">ResultType</span><span class="sxs-lookup"><span data-stu-id="2a94e-211">ResultType</span></span> |<span data-ttu-id="2a94e-212">O status do trabalho de runbook.</span><span class="sxs-lookup"><span data-stu-id="2a94e-212">The status of the runbook job.</span></span>  <span data-ttu-id="2a94e-213">Os valores possíveis são:</span><span class="sxs-lookup"><span data-stu-id="2a94e-213">Possible values are:</span></span><br><span data-ttu-id="2a94e-214">- em andamento</span><span class="sxs-lookup"><span data-stu-id="2a94e-214">- In Progress</span></span> |
| <span data-ttu-id="2a94e-215">Categoria</span><span class="sxs-lookup"><span data-stu-id="2a94e-215">Category</span></span> | <span data-ttu-id="2a94e-216">Classificação do tipo de dados.</span><span class="sxs-lookup"><span data-stu-id="2a94e-216">Classification of the type of data.</span></span>  <span data-ttu-id="2a94e-217">Para a Automação, o valor é JobStreams.</span><span class="sxs-lookup"><span data-stu-id="2a94e-217">For Automation, the value is JobStreams.</span></span> |
| <span data-ttu-id="2a94e-218">OperationName</span><span class="sxs-lookup"><span data-stu-id="2a94e-218">OperationName</span></span> | <span data-ttu-id="2a94e-219">Especifica o tipo de operação realizada no Azure.</span><span class="sxs-lookup"><span data-stu-id="2a94e-219">Specifies the type of operation performed in Azure.</span></span>  <span data-ttu-id="2a94e-220">Para a Automação, o valor é Job.</span><span class="sxs-lookup"><span data-stu-id="2a94e-220">For Automation, the value is Job.</span></span> |
| <span data-ttu-id="2a94e-221">Recurso</span><span class="sxs-lookup"><span data-stu-id="2a94e-221">Resource</span></span> | <span data-ttu-id="2a94e-222">Nome da Conta de automação</span><span class="sxs-lookup"><span data-stu-id="2a94e-222">Name of the Automation account</span></span> |
| <span data-ttu-id="2a94e-223">SourceSystem</span><span class="sxs-lookup"><span data-stu-id="2a94e-223">SourceSystem</span></span> | <span data-ttu-id="2a94e-224">Como o Log Analytics coletou os dados.</span><span class="sxs-lookup"><span data-stu-id="2a94e-224">How Log Analytics collected the data.</span></span> <span data-ttu-id="2a94e-225">Sempre *Azure* para o Diagnóstico do Azure.</span><span class="sxs-lookup"><span data-stu-id="2a94e-225">Always *Azure* for Azure diagnostics.</span></span> |
| <span data-ttu-id="2a94e-226">ResultDescription</span><span class="sxs-lookup"><span data-stu-id="2a94e-226">ResultDescription</span></span> |<span data-ttu-id="2a94e-227">Inclui o fluxo de saída do runbook.</span><span class="sxs-lookup"><span data-stu-id="2a94e-227">Includes the output stream from the runbook.</span></span> |
| <span data-ttu-id="2a94e-228">CorrelationId</span><span class="sxs-lookup"><span data-stu-id="2a94e-228">CorrelationId</span></span> |<span data-ttu-id="2a94e-229">O GUID que é a Id de correlação do trabalho de runbook.</span><span class="sxs-lookup"><span data-stu-id="2a94e-229">GUID that is the Correlation Id of the runbook job.</span></span> |
| <span data-ttu-id="2a94e-230">ResourceId</span><span class="sxs-lookup"><span data-stu-id="2a94e-230">ResourceId</span></span> |<span data-ttu-id="2a94e-231">Especifica a ID de recurso da conta da Automação do Azure para o runbook.</span><span class="sxs-lookup"><span data-stu-id="2a94e-231">Specifies the Azure Automation account resource id of the runbook.</span></span> |
| <span data-ttu-id="2a94e-232">SubscriptionId</span><span class="sxs-lookup"><span data-stu-id="2a94e-232">SubscriptionId</span></span> | <span data-ttu-id="2a94e-233">O GUID (ID de assinatura do Azure) para a Conta de automação.</span><span class="sxs-lookup"><span data-stu-id="2a94e-233">The Azure subscription Id (GUID) for the Automation account.</span></span> |
| <span data-ttu-id="2a94e-234">ResourceGroup</span><span class="sxs-lookup"><span data-stu-id="2a94e-234">ResourceGroup</span></span> | <span data-ttu-id="2a94e-235">Nome do grupo de recursos para a Conta de automação.</span><span class="sxs-lookup"><span data-stu-id="2a94e-235">Name of the resource group for the Automation account.</span></span> |
| <span data-ttu-id="2a94e-236">ResourceProvider</span><span class="sxs-lookup"><span data-stu-id="2a94e-236">ResourceProvider</span></span> | <span data-ttu-id="2a94e-237">MICROSOFT.AUTOMATION</span><span class="sxs-lookup"><span data-stu-id="2a94e-237">MICROSOFT.AUTOMATION</span></span> |
| <span data-ttu-id="2a94e-238">ResourceType</span><span class="sxs-lookup"><span data-stu-id="2a94e-238">ResourceType</span></span> | <span data-ttu-id="2a94e-239">AUTOMATIONACCOUNTS</span><span class="sxs-lookup"><span data-stu-id="2a94e-239">AUTOMATIONACCOUNTS</span></span> |

## <a name="viewing-automation-logs-in-log-analytics"></a><span data-ttu-id="2a94e-240">Exibir Logs de Automação no Log Analytics</span><span class="sxs-lookup"><span data-stu-id="2a94e-240">Viewing Automation Logs in Log Analytics</span></span>
<span data-ttu-id="2a94e-241">.Agora que você começou a enviar logs de trabalho de Automação para Log Analytics, vamos ver o que você pode fazer com esses logs no Log Analytics.</span><span class="sxs-lookup"><span data-stu-id="2a94e-241">Now that you have started sending your Automation job logs to Log Analytics, let’s see what you can do with these logs inside Log Analytics.</span></span>

<span data-ttu-id="2a94e-242">Para ver os logs, execute a seguinte consulta: `Type=AzureDiagnostics ResourceProvider="MICROSOFT.AUTOMATION"`</span><span class="sxs-lookup"><span data-stu-id="2a94e-242">To see the logs, run the following query: `Type=AzureDiagnostics ResourceProvider="MICROSOFT.AUTOMATION"`</span></span>

### <a name="send-an-email-when-a-runbook-job-fails-or-suspends"></a><span data-ttu-id="2a94e-243">Enviar um email quando um trabalho de runbook falhar ou for suspenso</span><span class="sxs-lookup"><span data-stu-id="2a94e-243">Send an email when a runbook job fails or suspends</span></span>
<span data-ttu-id="2a94e-244">Uma das principais solicitações de nossos clientes é a capacidade de enviar um email ou uma mensagem de texto quando algo dá errado em um trabalho de runbook.</span><span class="sxs-lookup"><span data-stu-id="2a94e-244">One of our top customer asks is for the ability to send an email or a text when something goes wrong with a runbook job.</span></span>   

<span data-ttu-id="2a94e-245">Para criar uma regra de alerta, você começa criando uma pesquisa de log para os registros de trabalhos de runbook que devem invocar o alerta.</span><span class="sxs-lookup"><span data-stu-id="2a94e-245">To create an alert rule, you start by creating a log search for the runbook job records that should invoke the alert.</span></span>  <span data-ttu-id="2a94e-246">Clique no botão **Alerta** para criar e configurar a regra de alerta.</span><span class="sxs-lookup"><span data-stu-id="2a94e-246">Click the **Alert** button to create and configure the alert rule.</span></span>

1. <span data-ttu-id="2a94e-247">Na página Visão geral do Log Analytics, clique em **Pesquisa de Logs**.</span><span class="sxs-lookup"><span data-stu-id="2a94e-247">From the Log Analytics Overview page, click **Log Search**.</span></span>
2. <span data-ttu-id="2a94e-248">Crie uma consulta de pesquisa de logs para o alerta digitando a seguinte pesquisa no campo de consulta: `Type=AzureDiagnostics ResourceProvider="MICROSOFT.AUTOMATION" Category=JobLogs (ResultType=Failed OR ResultType=Suspended)` Você também pode agrupar pelo RunbookName usando: `Type=AzureDiagnostics ResourceProvider="MICROSOFT.AUTOMATION" Category=JobLogs (ResultType=Failed OR ResultType=Suspended) | measure Count() by RunbookName_s`</span><span class="sxs-lookup"><span data-stu-id="2a94e-248">Create a log search query for your alert by typing the following search into the query field:  `Type=AzureDiagnostics ResourceProvider="MICROSOFT.AUTOMATION" Category=JobLogs (ResultType=Failed OR ResultType=Suspended)`  You can also group by the RunbookName by using: `Type=AzureDiagnostics ResourceProvider="MICROSOFT.AUTOMATION" Category=JobLogs (ResultType=Failed OR ResultType=Suspended) | measure Count() by RunbookName_s`</span></span>   

   <span data-ttu-id="2a94e-249">Se você tiver configurado logs de mais de uma Conta de automação ou assinatura para o espaço de trabalho, também poderá agrupar os alertas por assinatura e por conta de Automação.</span><span class="sxs-lookup"><span data-stu-id="2a94e-249">If you have set up logs from more than one Automation account or subscription to your workspace, you can group your alerts by subscription and Automation account.</span></span>  <span data-ttu-id="2a94e-250">O nome da conta de Automação pode ser derivado do campo de Recurso na pesquisa de JobLogs.</span><span class="sxs-lookup"><span data-stu-id="2a94e-250">Automation account name can be derived from the Resource field in the search of JobLogs.</span></span>  
3. <span data-ttu-id="2a94e-251">Para abrir a tela **Adicionar Regra de Alerta**, clique em **Alerta** na parte superior da página.</span><span class="sxs-lookup"><span data-stu-id="2a94e-251">To open the **Add Alert Rule** screen, click **Alert** at the top of the page.</span></span> <span data-ttu-id="2a94e-252">Para obter mais detalhes sobre as opções de configuração de alerta, confira [Alertas no Log Analytics](../log-analytics/log-analytics-alerts.md#alert-rules).</span><span class="sxs-lookup"><span data-stu-id="2a94e-252">For further details on the options to configure the alert, see [Alerts in Log Analytics](../log-analytics/log-analytics-alerts.md#alert-rules).</span></span>

### <a name="find-all-jobs-that-have-completed-with-errors"></a><span data-ttu-id="2a94e-253">Localizar todos os trabalhos que foram concluídos com erros</span><span class="sxs-lookup"><span data-stu-id="2a94e-253">Find all jobs that have completed with errors</span></span>
<span data-ttu-id="2a94e-254">Além de alertas de falhas, você pode descobrir quando um trabalho de runbook tem um erro não fatal.</span><span class="sxs-lookup"><span data-stu-id="2a94e-254">In addition to alerting on failures, you can find when a runbook job has a non-terminating error.</span></span> <span data-ttu-id="2a94e-255">Nesses casos, o PowerShell produz um fluxo de erro, mas os erros não fatais fazem com que seu trabalho seja suspenso ou falhe.</span><span class="sxs-lookup"><span data-stu-id="2a94e-255">In these cases PowerShell produces an error stream, but the non-terminating errors do not cause your job to suspend or fail.</span></span>    

1. <span data-ttu-id="2a94e-256">No seu espaço de trabalho do Log Analytics, clique em **Pesquisa de Logs**.</span><span class="sxs-lookup"><span data-stu-id="2a94e-256">In your Log Analytics workspace, click **Log Search**.</span></span>
2. <span data-ttu-id="2a94e-257">No campo de consulta, digite `Type=AzureDiagnostics ResourceProvider="MICROSOFT.AUTOMATION" Category=JobStreams StreamType_s=Error | measure count() by JobId_g` e clique em **Pesquisar**.</span><span class="sxs-lookup"><span data-stu-id="2a94e-257">In the query field, type `Type=AzureDiagnostics ResourceProvider="MICROSOFT.AUTOMATION" Category=JobStreams StreamType_s=Error | measure count() by JobId_g` and then click **Search**.</span></span>

### <a name="view-job-streams-for-a-job"></a><span data-ttu-id="2a94e-258">Exibir fluxos de trabalho para um trabalho</span><span class="sxs-lookup"><span data-stu-id="2a94e-258">View job streams for a job</span></span>
<span data-ttu-id="2a94e-259">Ao depurar um trabalho, talvez você também queira examinar os fluxos de trabalho.</span><span class="sxs-lookup"><span data-stu-id="2a94e-259">When you are debugging a job, you may also want to look into the job streams.</span></span>  <span data-ttu-id="2a94e-260">A consulta abaixo mostra todos os fluxos para um único trabalho com GUID 2ebd22ea-e05e-4eb9-9d76-d73cbd4356e0:</span><span class="sxs-lookup"><span data-stu-id="2a94e-260">The following query shows all the streams for a single job with GUID 2ebd22ea-e05e-4eb9-9d76-d73cbd4356e0:</span></span>   

`Type=AzureDiagnostics ResourceProvider="MICROSOFT.AUTOMATION" Category=JobStreams JobId_g="2ebd22ea-e05e-4eb9-9d76-d73cbd4356e0" | sort TimeGenerated | select ResultDescription`

### <a name="view-historical-job-status"></a><span data-ttu-id="2a94e-261">Exibir o status do histórico de trabalho</span><span class="sxs-lookup"><span data-stu-id="2a94e-261">View historical job status</span></span>
<span data-ttu-id="2a94e-262">Finalmente, talvez você queira visualizar o histórico de trabalho ao longo do tempo.</span><span class="sxs-lookup"><span data-stu-id="2a94e-262">Finally, you may want to visualize your job history over time.</span></span>  <span data-ttu-id="2a94e-263">Você pode usar essa consulta para pesquisar o status dos trabalhos ao longo do tempo.</span><span class="sxs-lookup"><span data-stu-id="2a94e-263">You can use this query to search for the status of your jobs over time.</span></span>

`Type=AzureDiagnostics ResourceProvider="MICROSOFT.AUTOMATION" Category=JobLogs NOT(ResultType="started") | measure Count() by ResultType interval 1hour`  
<br> <span data-ttu-id="2a94e-264">![Gráfico de status de trabalho histórico do OMS](media/automation-manage-send-joblogs-log-analytics/historical-job-status-chart.png)</span><span class="sxs-lookup"><span data-stu-id="2a94e-264">![OMS Historical Job Status Chart](media/automation-manage-send-joblogs-log-analytics/historical-job-status-chart.png)</span></span><br>

## <a name="summary"></a><span data-ttu-id="2a94e-265">Resumo</span><span class="sxs-lookup"><span data-stu-id="2a94e-265">Summary</span></span>
<span data-ttu-id="2a94e-266">Ao enviar seus dados de fluxo e status do Trabalho de automação para Log Analytics, você poderá ter mais informações sobre o status de seus Trabalhos de automação:</span><span class="sxs-lookup"><span data-stu-id="2a94e-266">By sending your Automation job status and stream data to Log Analytics, you can get better insight into the status of your Automation jobs by:</span></span>
+ <span data-ttu-id="2a94e-267">Configurando alertas para notificá-lo quando houver um problema</span><span class="sxs-lookup"><span data-stu-id="2a94e-267">Setting up alerts to notify you when there is an issue</span></span>
+ <span data-ttu-id="2a94e-268">Usando exibições personalizadas e consultas de pesquisa para visualizar os resultados de runbook, o status do trabalho de runbook e outros principais indicadores ou métricas relacionadas.</span><span class="sxs-lookup"><span data-stu-id="2a94e-268">Using custom views and search queries to visualize your runbook results, runbook job status, and other related key indicators or metrics.</span></span>  

<span data-ttu-id="2a94e-269">O Log Analytics oferece maior visibilidade operacional para os Trabalhos de automação e pode ajudar a tratar de incidentes mais rapidamente.</span><span class="sxs-lookup"><span data-stu-id="2a94e-269">Log Analytics provides greater operational visibility to your Automation jobs and can help address incidents quicker.</span></span>  

## <a name="next-steps"></a><span data-ttu-id="2a94e-270">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="2a94e-270">Next steps</span></span>
* <span data-ttu-id="2a94e-271">Para saber mais sobre como construir consultas de pesquisa diferentes e examinar os logs de trabalho de Automação com o Log Analytics, confira [Efetuar pesquisas no Log Analytics](../log-analytics/log-analytics-log-searches.md)</span><span class="sxs-lookup"><span data-stu-id="2a94e-271">To learn more about how to construct different search queries and review the Automation job logs with Log Analytics, see [Log searches in Log Analytics](../log-analytics/log-analytics-log-searches.md)</span></span>
* <span data-ttu-id="2a94e-272">Para entender como criar e recuperar mensagens de erro e de saída de runbooks, confira [Saída e mensagens de Runbook](automation-runbook-output-and-messages.md)</span><span class="sxs-lookup"><span data-stu-id="2a94e-272">To understand how to create and retrieve output and error messages from runbooks, see [Runbook output and messages](automation-runbook-output-and-messages.md)</span></span>
* <span data-ttu-id="2a94e-273">Para saber mais sobre a execução de runbooks, como monitorar trabalhos de runbook e outros detalhes técnicos, confira [Acompanhar um trabalho de runbook](automation-runbook-execution.md)</span><span class="sxs-lookup"><span data-stu-id="2a94e-273">To learn more about runbook execution, how to monitor runbook jobs, and other technical details, see [Track a runbook job](automation-runbook-execution.md)</span></span>
* <span data-ttu-id="2a94e-274">Para saber mais sobre o Log Analytics do OMS e fontes de coleta de dados, confira [Coletar dados do Armazenamento do Azure na visão geral do Log Analytics](../log-analytics/log-analytics-azure-storage.md)</span><span class="sxs-lookup"><span data-stu-id="2a94e-274">To learn more about OMS Log Analytics and data collection sources, see [Collecting Azure storage data in Log Analytics overview](../log-analytics/log-analytics-azure-storage.md)</span></span>
