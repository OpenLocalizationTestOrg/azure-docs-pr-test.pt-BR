---
title: "aaaCalling um Runbook da automação do Azure de um alerta de análise de Log | Microsoft Docs"
description: "Este artigo fornece uma visão geral de como tooinvoke um runbook de automação de um alerta de análise de Log de OMS do Microsoft."
services: automation
documentationcenter: 
author: mgoedtel
manager: jwhit
editor: 
ms.assetid: 
ms.service: automation
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 01/31/2017
ms.author: magoedte
ms.openlocfilehash: 8b745d6e6c2b0294d676e010f52855cd51741cf9
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="calling-an-azure-automation-runbook-from-an-oms-log-analytics-alert"></a><span data-ttu-id="c3a6d-103">Chamando um runbook de Automação do Azure a partir de um alerta do Log Analytics do OMS</span><span class="sxs-lookup"><span data-stu-id="c3a6d-103">Calling an Azure Automation runbook from an OMS Log Analytics alert</span></span>

<span data-ttu-id="c3a6d-104">Quando um alerta é configurado em análise de Log toocreate um registro de alerta se os resultados corresponderem a um critério específico, como um aumento prolongado na utilização do processador ou uma determinado aplicativo processo toohello crítico a funcionalidade de um aplicativo de negócios falhar e grava um evento correspondente no log de eventos do Windows hello, esse alerta pode executar automaticamente um runbook de automação em uma tentativa de tooauto-corrigir o problema de saudação.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-104">When an alert is configured in Log Analytics toocreate an alert record if results match a particular criteria, such as a prolonged spike in processor utilization or a particular application process critical toohello functionality of a business application fails and writes a corresponding event in hello Windows event log, that alert can automatically run an Automation runbook in an attempt tooauto-remediate hello issue.</span></span>  

<span data-ttu-id="c3a6d-105">Há dois toocall de opções um runbook quando a configuração de alerta de saudação.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-105">There are two options toocall a runbook when configuring hello alert.</span></span>  <span data-ttu-id="c3a6d-106">Especificamente:</span><span class="sxs-lookup"><span data-stu-id="c3a6d-106">Specifically,</span></span>

1. <span data-ttu-id="c3a6d-107">Usando um Webhook.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-107">Using a Webhook.</span></span>
   * <span data-ttu-id="c3a6d-108">Isso é Olá a única opção disponível se o seu espaço de trabalho do OMS não é vinculado tooan conta de automação.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-108">This is hello only option available if your OMS workspace is not linked tooan Automation account.</span></span>
   * <span data-ttu-id="c3a6d-109">Se você já tiver um espaço de trabalho automação conta vinculada tooan OMS, essa opção ainda está disponível.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-109">If you already have an Automation account linked tooan OMS workspace, this option is still available.</span></span>  

2. <span data-ttu-id="c3a6d-110">Selecione um runbook diretamente.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-110">Select a runbook directly.</span></span>
   * <span data-ttu-id="c3a6d-111">Essa opção está disponível somente quando o espaço de trabalho do hello OMS é vinculado tooan conta de automação.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-111">This option is available only when hello OMS workspace is linked tooan Automation account.</span></span>  

## <a name="calling-a-runbook-using-a-webhook"></a><span data-ttu-id="c3a6d-112">Chamando um runbook com um webhook</span><span class="sxs-lookup"><span data-stu-id="c3a6d-112">Calling a runbook using a webhook</span></span>

<span data-ttu-id="c3a6d-113">Um webhook permite toostart um determinado runbook na automação do Azure por meio de uma única solicitação HTTP.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-113">A webhook allows you toostart a particular runbook in Azure Automation through a single HTTP request.</span></span>  <span data-ttu-id="c3a6d-114">Antes de configurar Olá [alerta de análise de Log](../log-analytics/log-analytics-alerts.md#alert-rules) toocall Olá runbook usando um webhook como uma ação de alerta, você precisará toofirst criar um webhook de runbook Olá que será chamado usando esse método.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-114">Before configuring hello [Log Analytics alert](../log-analytics/log-analytics-alerts.md#alert-rules) toocall hello runbook using a webhook as an alert action, you will need toofirst create a webhook for hello runbook that will be called using this method.</span></span>  <span data-ttu-id="c3a6d-115">Examine e siga as etapas de Olá Olá [criar um webhook](automation-webhooks.md#creating-a-webhook) artigo e lembre-se a URL do webhook toorecord Olá para que você poderá referenciá-lo ao configurar a regra de alerta de saudação.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-115">Review and follow hello steps in hello [create a webhook](automation-webhooks.md#creating-a-webhook) article and remember toorecord hello webhook URL so that you can reference it while configuring hello alert rule.</span></span>   

## <a name="calling-a-runbook-directly"></a><span data-ttu-id="c3a6d-116">Chamando um runbook diretamente</span><span class="sxs-lookup"><span data-stu-id="c3a6d-116">Calling a runbook directly</span></span>

<span data-ttu-id="c3a6d-117">Se tiver Olá automação & oferta controle instalado e configurado em seu espaço de trabalho do OMS, ao configurar opção de ações de Runbook Olá alerta hello, você pode exibir todos os runbooks de saudação **selecionar um runbook** lista suspensa e selecione Olá runbook específico que você deseja toorun no alerta de toohello de resposta.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-117">If you have hello Automation & Control offering installed and configured in your OMS workspace, when configuring hello Runbook actions option for hello alert, you can view all runbooks from hello **Select a runbook** dropdown list and select hello specific runbook you want toorun in response toohello alert.</span></span>  <span data-ttu-id="c3a6d-118">Olá selecionado runbook pode executar em um espaço de trabalho em Olá nuvem do Azure ou em um trabalho de runbook híbrido.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-118">hello selected runbook can run in a workspace in hello Azure cloud or on a hybrid runbook worker.</span></span>  <span data-ttu-id="c3a6d-119">Quando o alerta de saudação é criada usando a opção de runbook hello, um webhook será criado para o runbook hello.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-119">When hello alert is created using hello runbook option, a webhook will be created for hello runbook.</span></span>  <span data-ttu-id="c3a6d-120">Você pode ver Olá webhook se você acessar a conta de automação toohello e navegue toohello webhook folha do runbook Olá selecionado.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-120">You can see hello webhook if you go toohello Automation account and navigate toohello webhook blade of hello selected runbook.</span></span>  <span data-ttu-id="c3a6d-121">Se você excluir o alerta hello, Olá webhook não é excluído, mas usuário Olá pode excluir o webhook Olá manualmente.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-121">If you delete hello alert, hello webhook is not deleted, but hello user can delete hello webhook manually.</span></span>  <span data-ttu-id="c3a6d-122">Não é um problema se Olá webhook não é excluído, ele é excluído de um item órfão que deverão toobe em ordem toomaintain uma conta de automação organizada.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-122">It is not a problem if hello webhook is not deleted, it is just an orphaned item that will eventually need toobe deleted in order toomaintain an organized Automation account.</span></span>  

## <a name="characteristics-of-a-runbook-for-both-options"></a><span data-ttu-id="c3a6d-123">Características de um runbook (para ambas as opções)</span><span class="sxs-lookup"><span data-stu-id="c3a6d-123">Characteristics of a runbook (for both options)</span></span>

<span data-ttu-id="c3a6d-124">Os dois métodos para chamar hello runbook de alerta de análise de Log Olá têm características de um comportamento diferente que precisam toobe compreendido antes de configurar suas regras de alerta.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-124">Both methods for calling hello runbook from hello Log Analytics alert have different behavior characteristics that need toobe understood before you configure your alert rules.</span></span>  

* <span data-ttu-id="c3a6d-125">Você deve ter um parâmetro de entrada do runbook denominado **WebhookData** que é do tipo **Objeto**.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-125">You must have a runbook input parameter called **WebhookData** that is **Object** type.</span></span>  <span data-ttu-id="c3a6d-126">Pode ser obrigatório ou opcional.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-126">It can be mandatory or optional.</span></span>  <span data-ttu-id="c3a6d-127">alerta de saudação passa Olá pesquisa resultados toohello runbook usando o parâmetro de entrada.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-127">hello alert passes hello search results toohello runbook using this input parameter.</span></span>

        param  
         (  
          [Parameter (Mandatory=$true)]  
          [object] $WebhookData  
         )

*  <span data-ttu-id="c3a6d-128">Você deve ter um objeto do código tooconvert Olá WebhookData tooa do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-128">You must have code tooconvert hello WebhookData tooa PowerShell object.</span></span>

    `$SearchResults = (ConvertFrom-Json $WebhookData.RequestBody).SearchResults.value`

    <span data-ttu-id="c3a6d-129">*$SearchResults* será uma matriz de objetos; cada objeto contém Olá campos com valores de um resultado de pesquisa</span><span class="sxs-lookup"><span data-stu-id="c3a6d-129">*$SearchResults* will be an array of objects; each object contains hello fields with values from one search result</span></span>

### <a name="webhookdata-inconsistencies-between-hello-webhook-option-and-runbook-option"></a><span data-ttu-id="c3a6d-130">WebhookData inconsistências entre a opção de webhook hello e opção de runbook</span><span class="sxs-lookup"><span data-stu-id="c3a6d-130">WebhookData inconsistencies between hello webhook option and runbook option</span></span>

* <span data-ttu-id="c3a6d-131">Ao configurar um alerta toocall um Webhook, insira uma URL de webhook criado para um runbook e clique em Olá **Webhook teste** botão.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-131">When configuring an alert toocall a Webhook, enter a webhook URL you created for a runbook, and click hello **Test Webhook** button.</span></span>  <span data-ttu-id="c3a6d-132">Olá WebhookData resultante enviados toohello runbook não contém um *. SearchResult* ou *. SearchResults*.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-132">hello resulting WebhookData sent toohello runbook does not contain either *.SearchResult* or *.SearchResults*.</span></span>

*  <span data-ttu-id="c3a6d-133">Se você salvar esse alerta, quando o alerta de saudação dispara e chama webhook Olá, Olá WebhookData enviados runbook toohello contém *. SearchResult*.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-133">If you save that alert, when hello alert triggers and calls hello webhook, hello WebhookData sent toohello runbook contains *.SearchResult*.</span></span>
* <span data-ttu-id="c3a6d-134">Se você cria um alerta e configurá-lo toocall um runbook (que também cria um webhook), quando Olá gatilhos alertas envia WebhookData toohello runbook que contenha *. SearchResults*.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-134">If you create an alert, and configure it toocall a runbook (which also creates a webhook), when hello alert triggers it sends WebhookData toohello runbook that contains *.SearchResults*.</span></span>

<span data-ttu-id="c3a6d-135">Portanto, no exemplo de código Olá acima, você precisará tooget *. SearchResult* se alerta Olá chama um webhook e será necessário tooget *. SearchResults* se o alerta Olá chamar um runbook diretamente.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-135">Thus in hello code example above, you will need tooget *.SearchResult* if hello alert calls a webhook, and will need tooget *.SearchResults* if hello alert calls a runbook directly.</span></span>

## <a name="example-walkthrough"></a><span data-ttu-id="c3a6d-136">Exemplo de passo a passo</span><span class="sxs-lookup"><span data-stu-id="c3a6d-136">Example walkthrough</span></span>

<span data-ttu-id="c3a6d-137">Demonstraremos como isso funciona usando Olá runbook gráfico do exemplo, que inicia um serviço do Windows a seguir.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-137">We will demonstrate how this works by using hello following example graphical runbook, which starts a Windows service.</span></span><br><br> ![Iniciar Runbook Gráfico do Serviço do Windows](media/automation-invoke-runbook-from-omsla-alert/automation-runbook-restartservice.png)<br>

<span data-ttu-id="c3a6d-139">Olá runbook tem um parâmetro de entrada do tipo **objeto** que é chamado **WebhookData** e inclui dados de webhook Olá passados do hello alerta contendo *. SearchResults*.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-139">hello runbook has one input parameter of type **Object** that is called **WebhookData** and includes hello webhook data passed from hello alert containing *.SearchResults*.</span></span><br><br> <span data-ttu-id="c3a6d-140">![Parâmetros de entrada do runbook](media/automation-invoke-runbook-from-omsla-alert/automation-runbook-restartservice-inputparameter.png)</span><span class="sxs-lookup"><span data-stu-id="c3a6d-140">![Runbook input parameters](media/automation-invoke-runbook-from-omsla-alert/automation-runbook-restartservice-inputparameter.png)</span></span><br>

<span data-ttu-id="c3a6d-141">Neste exemplo, na análise de Log criamos dois campos personalizados, *SvcDisplayName_CF* e *SvcState_CF*, tooextract Olá serviço nome e hello estado de exibição do serviço hello (ou seja, em execução ou parado) do evento Olá gravado toohello log de eventos do sistema.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-141">For this example, in Log Analytics we created two custom fields, *SvcDisplayName_CF* and *SvcState_CF*, tooextract hello service display name and hello state of hello service (i.e. running or stopped) from hello event written toohello System event log.</span></span>  <span data-ttu-id="c3a6d-142">Em seguida, criamos uma regra de alerta com hello consulta de pesquisa a seguir: `Type=Event SvcDisplayName_CF="Print Spooler" SvcState_CF="stopped"` para que podemos pode detectar quando Olá serviço Spooler de impressão é interrompida no hello sistema Windows.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-142">We then create an alert rule with hello following search query: `Type=Event SvcDisplayName_CF="Print Spooler" SvcState_CF="stopped"` so that we can detect when hello Print Spooler service is stopped on hello Windows system.</span></span>  <span data-ttu-id="c3a6d-143">Pode ser qualquer serviço de interesse, mas para este exemplo, podemos fazem referência a um dos serviços de pré-existente Olá que acompanham a saudação sistema operacional Windows.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-143">It can be any service of interest, but for this example we are referencing one of hello pre-existing services that are included with hello Windows OS.</span></span>  <span data-ttu-id="c3a6d-144">ação de alerta de saudação é configurado tooexecute nosso runbook usado neste exemplo e execute em Olá Hybrid Runbook Worker, que é habilitado em sistemas de destino hello.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-144">hello alert action is configured tooexecute our runbook used in this example and run on hello Hybrid Runbook Worker, which are enabled on hello target systems.</span></span>   

<span data-ttu-id="c3a6d-145">Hello atividade de código runbook **obter o nome do serviço de LA** converterá a cadeia de caracteres formatada em JSON de saudação em um tipo de objeto e um filtro no item de saudação *SvcDisplayName_CF* tooextract nome para exibição Olá da saudação Serviço Windows e a passa para a próxima atividade do hello verificar Olá foi interrompido antes de tentar toorestart-lo.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-145">hello runbook code activity **Get Service Name from LA** will convert hello JSON-formatted string into an object type and filter on hello item *SvcDisplayName_CF* tooextract hello display name of hello Windows service and pass this onto hello next activity which will verify hello service is stopped before attempting toorestart it.</span></span>  <span data-ttu-id="c3a6d-146">*SvcDisplayName_CF* é um [campo personalizado](../log-analytics/log-analytics-custom-fields.md) criado na análise de Log toodemonstrate neste exemplo.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-146">*SvcDisplayName_CF* is a [custom field](../log-analytics/log-analytics-custom-fields.md) created in Log Analytics toodemonstrate this example.</span></span>

    $SearchResults = (ConvertFrom-Json $WebhookData.RequestBody).SearchResults.value
    $SearchResults.SvcDisplayName_CF  

<span data-ttu-id="c3a6d-147">Quando o serviço de saudação for interrompida, regra de alerta de saudação na análise de Log detectar uma correspondência e disparar o runbook Olá e enviar Olá contexto de alerta toohello runbook.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-147">When hello service stops, hello alert rule in Log Analytics will detect a match and trigger hello runbook and send hello alert context toohello runbook.</span></span> <span data-ttu-id="c3a6d-148">Olá runbook executará a ação tooverify Olá serviço for interrompido, e então toorestart tentativa Olá serviço e verifique se ele é iniciado corretamente e resultados de saudação de saída.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-148">hello runbook will take action tooverify hello service is stopped, and if so attempt toorestart hello service and verify it started correctly and output hello results.</span></span>     

<span data-ttu-id="c3a6d-149">Como alternativa se você não tiver o seu espaço de trabalho automação conta vinculada tooyour OMS, você deve configurar regra de alerta de saudação com um webhook ação tootrigger Olá runbook e configurar de caracteres formatada em JSON Olá runbook tooconvert Olá e filtro em *. SearchResult* orientação Olá mencionada a seguir.</span><span class="sxs-lookup"><span data-stu-id="c3a6d-149">Alternatively if you don't have your Automation account linked tooyour OMS workspace, you would configure hello alert rule with a webhook action tootrigger hello runbook and configure hello runbook tooconvert hello JSON-formatted string and filter on *.SearchResult* following hello guidance mentioned earlier.</span></span>    

## <a name="next-steps"></a><span data-ttu-id="c3a6d-150">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="c3a6d-150">Next steps</span></span>

* <span data-ttu-id="c3a6d-151">toolearn mais sobre alertas em análise de Log e como toocreate, consulte [alertas na análise de Log](../log-analytics/log-analytics-alerts.md).</span><span class="sxs-lookup"><span data-stu-id="c3a6d-151">toolearn more about alerts in Log Analytics and how toocreate one, see [Alerts in Log Analytics](../log-analytics/log-analytics-alerts.md).</span></span>

* <span data-ttu-id="c3a6d-152">como ver tootrigger runbooks usando um webhook de toounderstand [webhooks de automação do Azure](automation-webhooks.md).</span><span class="sxs-lookup"><span data-stu-id="c3a6d-152">toounderstand how tootrigger runbooks using a webhook, see [Azure Automation webhooks](automation-webhooks.md).</span></span>
