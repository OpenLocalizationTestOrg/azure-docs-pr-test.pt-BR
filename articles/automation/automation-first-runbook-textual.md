---
title: "O meu primeiro runbook de Fluxo de Trabalho do PowerShell na Automação do Azure | Microsoft Docs"
description: "Tutorial que orienta você pela criação, teste e publicação de um runbook textual simples usando o Fluxo de Trabalho do PowerShell."
services: automation
documentationcenter: 
author: mgoedtel
manager: jwhit
editor: 
keywords: fluxo de trabalho do powershell, exemplos de fluxo de trabalho do powershell, fluxo de trabalho powershell
ms.assetid: 0002d7f7-e2b5-46e3-b5eb-4596b84fd526
ms.service: automation
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 03/26/2017
ms.author: magoedte;bwren
ms.openlocfilehash: 739f7c0fe0cca03d80fa8b4bdadbf93b5da72a73
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="my-first-powershell-workflow-runbook"></a><span data-ttu-id="35a19-104">Meu primeiro runbook de Fluxo de Trabalho do PowerShell</span><span class="sxs-lookup"><span data-stu-id="35a19-104">My first PowerShell Workflow runbook</span></span>

> [!div class="op_single_selector"]
> * [<span data-ttu-id="35a19-105">Gráfico</span><span class="sxs-lookup"><span data-stu-id="35a19-105">Graphical</span></span>](automation-first-runbook-graphical.md)
> * [<span data-ttu-id="35a19-106">PowerShell</span><span class="sxs-lookup"><span data-stu-id="35a19-106">PowerShell</span></span>](automation-first-runbook-textual-powershell.md)
> * [<span data-ttu-id="35a19-107">Fluxo de Trabalho do PowerShell</span><span class="sxs-lookup"><span data-stu-id="35a19-107">PowerShell Workflow</span></span>](automation-first-runbook-textual.md)
> 
> 

<span data-ttu-id="35a19-108">Este tutorial orienta você durante a criação de um [runbook de Fluxo de Trabalho do PowerShell](automation-runbook-types.md#powershell-workflow-runbooks) na Automação do Azure.</span><span class="sxs-lookup"><span data-stu-id="35a19-108">This tutorial walks you through the creation of a [PowerShell Workflow runbook](automation-runbook-types.md#powershell-workflow-runbooks) in Azure Automation.</span></span> <span data-ttu-id="35a19-109">Começamos com um runbook simples, que testamos e publicamos enquanto explicamos como acompanhar o status do trabalho do runbook.</span><span class="sxs-lookup"><span data-stu-id="35a19-109">We start with a simple runbook that we test and publish while explaining how to track the status of the runbook job.</span></span> <span data-ttu-id="35a19-110">Em seguida, modificamos o runbook para gerenciar os recursos do Azure, neste caso, iniciando uma máquina virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="35a19-110">Then we modify the runbook to actually manage Azure resources, in this case starting an Azure virtual machine.</span></span> <span data-ttu-id="35a19-111">Depois, tornamos o runbook mais robusto adicionando os parâmetros de runbook.</span><span class="sxs-lookup"><span data-stu-id="35a19-111">Lastly we make the runbook more robust by adding runbook parameters.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="35a19-112">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="35a19-112">Prerequisites</span></span>
<span data-ttu-id="35a19-113">Para concluir este tutorial, você precisará do seguinte:</span><span class="sxs-lookup"><span data-stu-id="35a19-113">To complete this tutorial, you will need the following:</span></span>

* <span data-ttu-id="35a19-114">Assinatura do Azure.</span><span class="sxs-lookup"><span data-stu-id="35a19-114">Azure subscription.</span></span> <span data-ttu-id="35a19-115">Se você ainda não tiver uma, poderá [ativar os benefícios de assinante do MSDN](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/) ou <a href="/pricing/free-account/" target="_blank">[inscrever-se em uma conta gratuita](https://azure.microsoft.com/free/).</span><span class="sxs-lookup"><span data-stu-id="35a19-115">If you don't have one yet, you can [activate your MSDN subscriber benefits](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/) or <a href="/pricing/free-account/" target="_blank">[sign up for a free account](https://azure.microsoft.com/free/).</span></span>
* <span data-ttu-id="35a19-116">[Conta de automação](automation-sec-configure-azure-runas-account.md) para manter o runbook e se autenticar nos recursos do Azure.</span><span class="sxs-lookup"><span data-stu-id="35a19-116">[Automation account](automation-sec-configure-azure-runas-account.md) to hold the runbook and authenticate to Azure resources.</span></span>  <span data-ttu-id="35a19-117">Esta conta deve ter permissão para iniciar e parar a máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="35a19-117">This account must have permission to start and stop the virtual machine.</span></span>
* <span data-ttu-id="35a19-118">Uma máquina virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="35a19-118">An Azure virtual machine.</span></span> <span data-ttu-id="35a19-119">Paramos e iniciamos o computador, portanto, ele não deve ser uma VM de produção.</span><span class="sxs-lookup"><span data-stu-id="35a19-119">We stop and start this machine so it should not be a production VM.</span></span>

## <a name="step-1---create-new-runbook"></a><span data-ttu-id="35a19-120">Etapa 1: criar o novo runbook</span><span class="sxs-lookup"><span data-stu-id="35a19-120">Step 1 - Create new runbook</span></span>
<span data-ttu-id="35a19-121">Começaremos criando um runbook simples que exibe o texto *Olá mundo*.</span><span class="sxs-lookup"><span data-stu-id="35a19-121">We'll start by creating a simple runbook that outputs the text *Hello World*.</span></span>

1. <span data-ttu-id="35a19-122">No portal do Azure, abra sua conta da Automação.</span><span class="sxs-lookup"><span data-stu-id="35a19-122">In the Azure portal, open your Automation account.</span></span>  
   <span data-ttu-id="35a19-123">A página da conta de Automação fornece uma exibição rápida dos recursos nessa conta.</span><span class="sxs-lookup"><span data-stu-id="35a19-123">The Automation account page gives you a quick view of the resources in this account.</span></span> <span data-ttu-id="35a19-124">Você já deve ter alguns ativos.</span><span class="sxs-lookup"><span data-stu-id="35a19-124">You should already have some assets.</span></span> <span data-ttu-id="35a19-125">A maioria deles são os módulos que são incluídos automaticamente em uma nova conta de Automação.</span><span class="sxs-lookup"><span data-stu-id="35a19-125">Most of those are the modules that are automatically included in a new Automation account.</span></span> <span data-ttu-id="35a19-126">Você também deve ter o ativo de credencial que é mencionado nos [pré-requisitos](#prerequisites).</span><span class="sxs-lookup"><span data-stu-id="35a19-126">You should also have the Credential asset that's mentioned in the [prerequisites](#prerequisites).</span></span>
2. <span data-ttu-id="35a19-127">Clique no bloco **Runbooks** para abrir a lista de runbooks.</span><span class="sxs-lookup"><span data-stu-id="35a19-127">Click on the **Runbooks** tile to open the list of runbooks.</span></span><br><br> <span data-ttu-id="35a19-128">![Controle de runbooks](media/automation-first-runbook-textual/runbooks-control-tiles.png)</span><span class="sxs-lookup"><span data-stu-id="35a19-128">![Runbooks control](media/automation-first-runbook-textual/runbooks-control-tiles.png)</span></span>
3. <span data-ttu-id="35a19-129">Crie um novo runbook clicando no botão **Adicionar um runbook** e em **Criar um novo runbook**.</span><span class="sxs-lookup"><span data-stu-id="35a19-129">Create a new runbook by clicking on the **Add a runbook** button and then **Create a new runbook**.</span></span>
4. <span data-ttu-id="35a19-130">Atribua o nome *MyFirstRunbook-Workflow*ao runbook.</span><span class="sxs-lookup"><span data-stu-id="35a19-130">Give the runbook the name *MyFirstRunbook-Workflow*.</span></span>
5. <span data-ttu-id="35a19-131">Nesse caso, vamos criar um [runbook de Fluxo de Trabalho do PowerShell](automation-runbook-types.md#powershell-workflow-runbooks), portanto, selecione **Fluxo de Trabalho do PowerShell** como o **Tipo de runbook**.</span><span class="sxs-lookup"><span data-stu-id="35a19-131">In this case, we're going to create a [PowerShell Workflow runbook](automation-runbook-types.md#powershell-workflow-runbooks) so select **Powershell Workflow** for **Runbook type**.</span></span><br><br> <span data-ttu-id="35a19-132">![Novo runbook](media/automation-first-runbook-textual/new-runbook-properties.png)</span><span class="sxs-lookup"><span data-stu-id="35a19-132">![New runbook](media/automation-first-runbook-textual/new-runbook-properties.png)</span></span>
6. <span data-ttu-id="35a19-133">Clique em **criar** para criar o runbook e abrir o editor textual.</span><span class="sxs-lookup"><span data-stu-id="35a19-133">Click **Create** to create the runbook and open the textual editor.</span></span>

## <a name="step-2---add-code-to-the-runbook"></a><span data-ttu-id="35a19-134">Etapa 2 - adicionar código ao runbook</span><span class="sxs-lookup"><span data-stu-id="35a19-134">Step 2 - Add code to the runbook</span></span>
<span data-ttu-id="35a19-135">Você pode digitar o código diretamente no runbook, ou você pode selecionar cmdlets, runbooks, e ativos do controle de biblioteca e adicioná-los ao runbook com quaisquer parâmetros relacionados.</span><span class="sxs-lookup"><span data-stu-id="35a19-135">You can either type code directly into the runbook, or you can select cmdlets, runbooks, and assets from the Library control and have them added to the runbook with any related parameters.</span></span> <span data-ttu-id="35a19-136">Para este passo a passo, digitaremos diretamente no runbook.</span><span class="sxs-lookup"><span data-stu-id="35a19-136">For this walkthrough, we'll type directly into the runbook.</span></span>

1. <span data-ttu-id="35a19-137">No momento, nosso runbook está vazio, com apenas a palavra-chave *fluxo de trabalho* necessária, o nome do nosso runbook e as chaves que encerrarão o fluxo de trabalho inteiro.</span><span class="sxs-lookup"><span data-stu-id="35a19-137">Our runbook is currently empty with only the required *workflow* keyword, the name of our runbook, and the braces that will encase the entire workflow.</span></span>

   ```
   Workflow MyFirstRunbook-Workflow
   {
   }
   ```
2. <span data-ttu-id="35a19-138">Digite *Write-Output "Hello World."*</span><span class="sxs-lookup"><span data-stu-id="35a19-138">Type *Write-Output "Hello World."*</span></span> <span data-ttu-id="35a19-139">entre as chaves.</span><span class="sxs-lookup"><span data-stu-id="35a19-139">between the braces.</span></span>

   ```
   Workflow MyFirstRunbook-Workflow
   {
   Write-Output "Hello World"
   }
   ```
3. <span data-ttu-id="35a19-140">Salve o runbook clicando em **Salvar**.</span><span class="sxs-lookup"><span data-stu-id="35a19-140">Save the runbook by clicking **Save**.</span></span><br><br> <span data-ttu-id="35a19-141">![Salvar runbook](media/automation-first-runbook-textual/automation-runbook-edit-controls-save.png)</span><span class="sxs-lookup"><span data-stu-id="35a19-141">![Save runbook](media/automation-first-runbook-textual/automation-runbook-edit-controls-save.png)</span></span>

## <a name="step-3---test-the-runbook"></a><span data-ttu-id="35a19-142">Etapa 3: testar o runbook</span><span class="sxs-lookup"><span data-stu-id="35a19-142">Step 3 - Test the runbook</span></span>
<span data-ttu-id="35a19-143">Antes que publicamos o runbook para disponibilizá-lo na produção, queremos testá-lo para garantir que ele funciona corretamente.</span><span class="sxs-lookup"><span data-stu-id="35a19-143">Before we publish the runbook to make it available in production, we want to test it to make sure that it works properly.</span></span> <span data-ttu-id="35a19-144">Quando você testa um runbook, executa sua versão de **Rascunho** e vê sua saída interativamente.</span><span class="sxs-lookup"><span data-stu-id="35a19-144">When you test a runbook, you run its **Draft** version and view its output interactively.</span></span>

1. <span data-ttu-id="35a19-145">Clique em **Painel de teste** para abrir o Painel de teste.</span><span class="sxs-lookup"><span data-stu-id="35a19-145">Click **Test pane** to open the Test pane.</span></span><br><br> <span data-ttu-id="35a19-146">![Painel de teste](media/automation-first-runbook-textual/automation-runbook-edit-controls-test.png)</span><span class="sxs-lookup"><span data-stu-id="35a19-146">![Test pane](media/automation-first-runbook-textual/automation-runbook-edit-controls-test.png)</span></span>
2. <span data-ttu-id="35a19-147">Clique em **Iniciar** para iniciar o teste.</span><span class="sxs-lookup"><span data-stu-id="35a19-147">Click **Start** to start the test.</span></span> <span data-ttu-id="35a19-148">Essa deve ser a única opção habilitada.</span><span class="sxs-lookup"><span data-stu-id="35a19-148">This should be the only enabled option.</span></span>
3. <span data-ttu-id="35a19-149">Um [trabalho de runbook](automation-runbook-execution.md) é criado e seu status é exibido.</span><span class="sxs-lookup"><span data-stu-id="35a19-149">A [runbook job](automation-runbook-execution.md) is created and its status displayed.</span></span>  
   <span data-ttu-id="35a19-150">O status do trabalho iniciará como *Na fila* , indicando que ele está aguardando um runbook worker na nuvem ficar disponível.</span><span class="sxs-lookup"><span data-stu-id="35a19-150">The job status will start as *Queued* indicating that it is waiting for a runbook worker in the cloud to come available.</span></span> <span data-ttu-id="35a19-151">Mudará para *Iniciando* quando um trabalhador reivindicar o trabalho, em seguida, para *Executando* quando o runbook realmente começar a ser executado.</span><span class="sxs-lookup"><span data-stu-id="35a19-151">It will then move to *Starting* when a worker claims the job, and then *Running* when the runbook actually starts running.</span></span>  
4. <span data-ttu-id="35a19-152">Quando o trabalho do runbook é concluído, sua saída é exibida.</span><span class="sxs-lookup"><span data-stu-id="35a19-152">When the runbook job completes, its output is displayed.</span></span> <span data-ttu-id="35a19-153">Em nosso caso, deveremos ver *Olá mundo*.</span><span class="sxs-lookup"><span data-stu-id="35a19-153">In our case, we should see *Hello World*.</span></span><br><br> <span data-ttu-id="35a19-154">![Olá mundo](media/automation-first-runbook-textual/test-output-hello-world.png)</span><span class="sxs-lookup"><span data-stu-id="35a19-154">![Hello World](media/automation-first-runbook-textual/test-output-hello-world.png)</span></span>
5. <span data-ttu-id="35a19-155">Feche o Painel de teste para retornar à tela.</span><span class="sxs-lookup"><span data-stu-id="35a19-155">Close the Test pane to return to the canvas.</span></span>

## <a name="step-4---publish-and-start-the-runbook"></a><span data-ttu-id="35a19-156">Etapa 4: publicar e iniciar o runbook</span><span class="sxs-lookup"><span data-stu-id="35a19-156">Step 4 - Publish and start the runbook</span></span>
<span data-ttu-id="35a19-157">O runbook que acabamos de criar ainda está em Modo de rascunho.</span><span class="sxs-lookup"><span data-stu-id="35a19-157">The runbook that we just created is still in Draft mode.</span></span> <span data-ttu-id="35a19-158">Precisamos publicá-lo antes que possamos executá-lo na produção.</span><span class="sxs-lookup"><span data-stu-id="35a19-158">We need to publish it before we can run it in production.</span></span> <span data-ttu-id="35a19-159">Quando você publica um runbook, substitui a versão Publicada existente pela versão de Rascunho.</span><span class="sxs-lookup"><span data-stu-id="35a19-159">When you publish a runbook, you overwrite the existing Published version with the Draft version.</span></span> <span data-ttu-id="35a19-160">Em nosso caso, não temos uma versão Publicada ainda porque que acabamos de criar o runbook.</span><span class="sxs-lookup"><span data-stu-id="35a19-160">In our case, we don't have a Published version yet because we just created the runbook.</span></span>

1. <span data-ttu-id="35a19-161">Clique em **Publicar** para publicar o runbook e em **Sim** quando solicitado.</span><span class="sxs-lookup"><span data-stu-id="35a19-161">Click **Publish** to publish the runbook and then **Yes** when prompted.</span></span><br><br> <span data-ttu-id="35a19-162">![Publicar](media/automation-first-runbook-textual/automation-runbook-edit-controls-publish.png)</span><span class="sxs-lookup"><span data-stu-id="35a19-162">![Publish](media/automation-first-runbook-textual/automation-runbook-edit-controls-publish.png)</span></span>
2. <span data-ttu-id="35a19-163">Se você rolar para a esquerda para exibir o runbook no painel **Runbooks** agora, ele mostrará um **Status de Criação** de **Publicado**.</span><span class="sxs-lookup"><span data-stu-id="35a19-163">If you scroll left to view the runbook in the **Runbooks** pane now, it will show an **Authoring Status** of **Published**.</span></span>
3. <span data-ttu-id="35a19-164">Role para a direita para exibir o painel de **MyFirstRunbook-Workflow**.</span><span class="sxs-lookup"><span data-stu-id="35a19-164">Scroll back to the right to view the pane for **MyFirstRunbook-Workflow**.</span></span>  
   <span data-ttu-id="35a19-165">As opções na parte superior nos permitem iniciar o runbook, agendá-lo para iniciar em algum momento no futuro ou criar um [webhook](automation-webhooks.md) para que ele possa ser iniciado por meio de uma chamada de HTTP.</span><span class="sxs-lookup"><span data-stu-id="35a19-165">The options across the top allow us to start the runbook, schedule it to start at some time in the future, or create a [webhook](automation-webhooks.md) so it can be started through an HTTP call.</span></span>
4. <span data-ttu-id="35a19-166">Queremos apenas iniciar o runbook, então clique em **Iniciar** e em **Sim** quando solicitado.</span><span class="sxs-lookup"><span data-stu-id="35a19-166">We just want to start the runbook so click **Start** and then **Yes** when prompted.</span></span><br><br> <span data-ttu-id="35a19-167">![Iniciar runbook](media/automation-first-runbook-textual/automation-runbook-controls-start.png)</span><span class="sxs-lookup"><span data-stu-id="35a19-167">![Start runbook](media/automation-first-runbook-textual/automation-runbook-controls-start.png)</span></span>
5. <span data-ttu-id="35a19-168">Um painel de trabalho é aberto para o trabalho de runbook que acabamos de criar.</span><span class="sxs-lookup"><span data-stu-id="35a19-168">A job pane is opened for the runbook job that we just created.</span></span> <span data-ttu-id="35a19-169">Podemos fechar esse painel, mas nesse caso, o deixaremos aberto para que possamos acompanhar o progresso do trabalho.</span><span class="sxs-lookup"><span data-stu-id="35a19-169">We can close this pane, but in this case we'll leave it open so we can watch the job's progress.</span></span>
6. <span data-ttu-id="35a19-170">O status do trabalho é mostrado em **Resumo do trabalho** e corresponde aos status que vimos quando testamos o runbook.</span><span class="sxs-lookup"><span data-stu-id="35a19-170">The job status is shown in **Job Summary** and matches the statuses that we saw when we tested the runbook.</span></span><br><br> <span data-ttu-id="35a19-171">![Resumo do trabalho](media/automation-first-runbook-textual/job-pane-status-blade-jobsummary.png)</span><span class="sxs-lookup"><span data-stu-id="35a19-171">![Job Summary](media/automation-first-runbook-textual/job-pane-status-blade-jobsummary.png)</span></span>
7. <span data-ttu-id="35a19-172">Assim que o status do runbook mostrar *Concluído*, clique em **Saída**.</span><span class="sxs-lookup"><span data-stu-id="35a19-172">Once the runbook status shows *Completed*, click **Output**.</span></span> <span data-ttu-id="35a19-173">O painel Saída é aberto e podemos ver nosso *Olá mundo*.</span><span class="sxs-lookup"><span data-stu-id="35a19-173">The Output pane is opened, and we can see our *Hello World*.</span></span><br><br> <span data-ttu-id="35a19-174">![Resumo do trabalho](media/automation-first-runbook-textual/job-pane-status-blade-outputtile.png)</span><span class="sxs-lookup"><span data-stu-id="35a19-174">![Job Summary](media/automation-first-runbook-textual/job-pane-status-blade-outputtile.png)</span></span>  
8. <span data-ttu-id="35a19-175">Feche o painel Saída.</span><span class="sxs-lookup"><span data-stu-id="35a19-175">Close the Output pane.</span></span>
9. <span data-ttu-id="35a19-176">Clique em **Todos os Logs** para abrir o painel Fluxos do trabalho do runbook.</span><span class="sxs-lookup"><span data-stu-id="35a19-176">Click **All Logs** to open the Streams pane for the runbook job.</span></span> <span data-ttu-id="35a19-177">Devemos ver apenas *Olá Mundo* no fluxo de saída, mas isso pode mostrar outros fluxos de um trabalho do runbook como Detalhado e Erro se o runbook gravar neles.</span><span class="sxs-lookup"><span data-stu-id="35a19-177">We should only see *Hello World* in the output stream, but this can show other streams for a runbook job such as Verbose and Error if the runbook writes to them.</span></span><br><br> <span data-ttu-id="35a19-178">![Resumo do trabalho](media/automation-first-runbook-textual/job-pane-status-blade-alllogstile.png)</span><span class="sxs-lookup"><span data-stu-id="35a19-178">![Job Summary](media/automation-first-runbook-textual/job-pane-status-blade-alllogstile.png)</span></span>
10. <span data-ttu-id="35a19-179">Feche o painel Fluxos e o painel Trabalho para retornar ao painel MyFirstRunbook.</span><span class="sxs-lookup"><span data-stu-id="35a19-179">Close the Streams pane and the Job pane to return to the MyFirstRunbook pane.</span></span>
11. <span data-ttu-id="35a19-180">Clique em **Trabalhos** para abrir o painel de trabalhos para este runbook.</span><span class="sxs-lookup"><span data-stu-id="35a19-180">Click **Jobs** to open the Jobs pane for this runbook.</span></span> <span data-ttu-id="35a19-181">Ele lista todos os trabalhos criados por esse runbook.</span><span class="sxs-lookup"><span data-stu-id="35a19-181">This lists all of the jobs created by this runbook.</span></span> <span data-ttu-id="35a19-182">Devemos ver apenas um trabalho listado, já que executamos o trabalho apenas uma vez.</span><span class="sxs-lookup"><span data-stu-id="35a19-182">We should only see one job listed since we only ran the job once.</span></span><br><br> <span data-ttu-id="35a19-183">![Trabalhos](media/automation-first-runbook-textual/runbook-control-job-tile.png)</span><span class="sxs-lookup"><span data-stu-id="35a19-183">![Jobs](media/automation-first-runbook-textual/runbook-control-job-tile.png)</span></span>
12. <span data-ttu-id="35a19-184">Você pode clicar neste trabalho para abrir o mesmo painel Trabalho que exibimos quando iniciamos o runbook.</span><span class="sxs-lookup"><span data-stu-id="35a19-184">You can click on this job to open the same Job pane that we viewed when we started the runbook.</span></span> <span data-ttu-id="35a19-185">Isso permite que você volte no tempo e veja os detalhes de qualquer trabalho que foi criado para um determinado runbook.</span><span class="sxs-lookup"><span data-stu-id="35a19-185">This allows you to go back in time and view the details of any job that was created for a particular runbook.</span></span>

## <a name="step-5---add-authentication-to-manage-azure-resources"></a><span data-ttu-id="35a19-186">Etapa 5: adicionar autenticação para gerenciar recursos do Azure</span><span class="sxs-lookup"><span data-stu-id="35a19-186">Step 5 - Add authentication to manage Azure resources</span></span>
<span data-ttu-id="35a19-187">Testamos e publicamos nosso runbook, mas até o momento ele não faz nada útil.</span><span class="sxs-lookup"><span data-stu-id="35a19-187">We've tested and published our runbook, but so far it doesn't do anything useful.</span></span> <span data-ttu-id="35a19-188">Gostaríamos que ele gerenciasse recursos do Azure.</span><span class="sxs-lookup"><span data-stu-id="35a19-188">We want to have it manage Azure resources.</span></span> <span data-ttu-id="35a19-189">No entanto, ele não será capaz de fazer isso a menos que o autentiquemos usando as credenciais mencionadas nos [pré-requisitos](#prerequisites).</span><span class="sxs-lookup"><span data-stu-id="35a19-189">It won't be able to do that though unless we have it authenticate using the credentials that are referred to in the [prerequisites](#prerequisites).</span></span> <span data-ttu-id="35a19-190">Fazemos isso com o cmdlet **Add-AzureRMAccount** .</span><span class="sxs-lookup"><span data-stu-id="35a19-190">We do that with the **Add-AzureRMAccount** cmdlet.</span></span>

1. <span data-ttu-id="35a19-191">Abra o editor gráfico clicando em **Editar** no painel MyFirstRunbook-Workflow.</span><span class="sxs-lookup"><span data-stu-id="35a19-191">Open the textual editor by clicking **Edit** on the MyFirstRunbook-Workflow pane.</span></span><br><br> <span data-ttu-id="35a19-192">![Editar runbook](media/automation-first-runbook-textual/automation-runbook-controls-edit.png)</span><span class="sxs-lookup"><span data-stu-id="35a19-192">![Edit runbook](media/automation-first-runbook-textual/automation-runbook-controls-edit.png)</span></span>
2. <span data-ttu-id="35a19-193">Já não precisamos da linha **Write-Output** , então vamos continuar e excluí-la.</span><span class="sxs-lookup"><span data-stu-id="35a19-193">We don't need the **Write-Output** line anymore, so go ahead and delete it.</span></span>
3. <span data-ttu-id="35a19-194">Posicione o cursor em uma linha em branco entre as chaves.</span><span class="sxs-lookup"><span data-stu-id="35a19-194">Position the cursor on a blank line between the braces.</span></span>
4. <span data-ttu-id="35a19-195">Digite ou copie e cole o seguinte código que irá manipular a autenticação com sua conta de Automação Executar Como:</span><span class="sxs-lookup"><span data-stu-id="35a19-195">Type or copy and paste the following code that will handle the authentication with your Automation Run As account:</span></span>

   ```
   $Conn = Get-AutomationConnection -Name AzureRunAsConnection
   Add-AzureRMAccount -ServicePrincipal -Tenant $Conn.TenantID `
   -ApplicationId $Conn.ApplicationID -CertificateThumbprint $Conn.CertificateThumbprint
   ```
5. <span data-ttu-id="35a19-196">Clique no **Painel de teste** para que possamos testar o runbook.</span><span class="sxs-lookup"><span data-stu-id="35a19-196">Click **Test pane** so that we can test the runbook.</span></span>
6. <span data-ttu-id="35a19-197">Clique em **Iniciar** para iniciar o teste.</span><span class="sxs-lookup"><span data-stu-id="35a19-197">Click **Start** to start the test.</span></span> <span data-ttu-id="35a19-198">Quando ele for concluído, você deverá receber uma saída semelhante ao exemplo a seguir, que exibe informações básicas de sua conta.</span><span class="sxs-lookup"><span data-stu-id="35a19-198">Once it completes, you should receive output similar to the following, displaying basic information from your account.</span></span> <span data-ttu-id="35a19-199">Isso confirma que a credencial é válida.</span><span class="sxs-lookup"><span data-stu-id="35a19-199">This confirms that the credential is valid.</span></span><br><br> <span data-ttu-id="35a19-200">![Autenticar](media/automation-first-runbook-textual/runbook-auth-output.png)</span><span class="sxs-lookup"><span data-stu-id="35a19-200">![Authenticate](media/automation-first-runbook-textual/runbook-auth-output.png)</span></span>

## <a name="step-6---add-code-to-start-a-virtual-machine"></a><span data-ttu-id="35a19-201">Etapa 6: adicionar código para iniciar uma máquina virtual</span><span class="sxs-lookup"><span data-stu-id="35a19-201">Step 6 - Add code to start a virtual machine</span></span>
<span data-ttu-id="35a19-202">Agora que nosso runbook está se autenticando em nossa assinatura do Azure, podemos gerenciar recursos.</span><span class="sxs-lookup"><span data-stu-id="35a19-202">Now that our runbook is authenticating to our Azure subscription, we can manage resources.</span></span> <span data-ttu-id="35a19-203">Adicionamos um comando para iniciar uma máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="35a19-203">We add a command to start a virtual machine.</span></span> <span data-ttu-id="35a19-204">Você pode escolher qualquer máquina virtual em sua assinatura do Azure e, por enquanto, codificaremos esse nome no runbook.</span><span class="sxs-lookup"><span data-stu-id="35a19-204">You can pick any virtual machine in your Azure subscription, and for now we will be hardcoding that name in the runbook.</span></span>

1. <span data-ttu-id="35a19-205">Depois de *Add-AzureRmAccount*, digite *Start-AzureRmVM -Name 'VMName' -ResourceGroupName 'NameofResourceGroup'*, fornecendo o nome da máquina virtual a iniciar e o nome do Grupo de Recursos dessa máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="35a19-205">After *Add-AzureRmAccount*, type *Start-AzureRmVM -Name 'VMName' -ResourceGroupName 'NameofResourceGroup'* providing the name and Resource Group name of the virtual machine to start.</span></span>  

   ```
   workflow MyFirstRunbook-Workflow
   {
   $Conn = Get-AutomationConnection -Name AzureRunAsConnection
   Add-AzureRMAccount -ServicePrincipal -Tenant $Conn.TenantID -ApplicationId $Conn.ApplicationID -CertificateThumbprint $Conn.CertificateThumbprint
   Start-AzureRmVM -Name 'VMName' -ResourceGroupName 'ResourceGroupName'
   }
   ```
2. <span data-ttu-id="35a19-206">Salve o runbook e, para que possamos testá-lo, clique em **Painel de teste** .</span><span class="sxs-lookup"><span data-stu-id="35a19-206">Save the runbook and then click **Test pane** so that we can test it.</span></span>
3. <span data-ttu-id="35a19-207">Clique em **Iniciar** para iniciar o teste.</span><span class="sxs-lookup"><span data-stu-id="35a19-207">Click **Start** to start the test.</span></span> <span data-ttu-id="35a19-208">Quando for concluído, verifique se a máquina virtual foi iniciada.</span><span class="sxs-lookup"><span data-stu-id="35a19-208">Once it completes, check that the virtual machine was started.</span></span>

## <a name="step-7---add-an-input-parameter-to-the-runbook"></a><span data-ttu-id="35a19-209">Etapa 7: adicionar um parâmetro de entrada ao runbook</span><span class="sxs-lookup"><span data-stu-id="35a19-209">Step 7 - Add an input parameter to the runbook</span></span>
<span data-ttu-id="35a19-210">No momento, nosso runbook inicia a máquina virtual que codificamos no runbook, mas ele seria mais útil pudéssemos especificar a máquina virtual quando o runbook é iniciado.</span><span class="sxs-lookup"><span data-stu-id="35a19-210">Our runbook currently starts the virtual machine that we hardcoded in the runbook, but it would be more useful if we could specify the virtual machine when the runbook is started.</span></span> <span data-ttu-id="35a19-211">Agora adicionaremos parâmetros de entrada ao runbook para fornecer essa funcionalidade.</span><span class="sxs-lookup"><span data-stu-id="35a19-211">We will now add input parameters to the runbook to provide that functionality.</span></span>

1. <span data-ttu-id="35a19-212">Adicione parâmetros para *VMName* e *ResourceGroupName* ao runbook e use essas variáveis com o cmdlet **Start-AzureRmVM** como no exemplo abaixo.</span><span class="sxs-lookup"><span data-stu-id="35a19-212">Add parameters for *VMName* and *ResourceGroupName* to the runbook and use these variables with the **Start-AzureRmVM** cmdlet as in the example below.</span></span>

   ```
   workflow MyFirstRunbook-Workflow
   {
    Param(
     [string]$VMName,
     [string]$ResourceGroupName
    )  
   $Conn = Get-AutomationConnection -Name AzureRunAsConnection
   Add-AzureRMAccount -ServicePrincipal -Tenant $Conn.TenantID -ApplicationId $Conn.ApplicationID -CertificateThumbprint $Conn.CertificateThumbprint
   Start-AzureRmVM -Name $VMName -ResourceGroupName $ResourceGroupName
   }
   ```
2. <span data-ttu-id="35a19-213">Salve o runbook e abra o Painel de teste.</span><span class="sxs-lookup"><span data-stu-id="35a19-213">Save the runbook and open the Test pane.</span></span> <span data-ttu-id="35a19-214">Observe que agora você pode fornecer valores para as duas variáveis de entrada que serão usadas no teste.</span><span class="sxs-lookup"><span data-stu-id="35a19-214">Note that you can now provide values for the two input variables that will be used in the test.</span></span>
3. <span data-ttu-id="35a19-215">Feche o Painel de teste.</span><span class="sxs-lookup"><span data-stu-id="35a19-215">Close the Test pane.</span></span>
4. <span data-ttu-id="35a19-216">Clique em **Publicar** para publicar a nova versão do runbook.</span><span class="sxs-lookup"><span data-stu-id="35a19-216">Click **Publish** to publish the new version of the runbook.</span></span>
5. <span data-ttu-id="35a19-217">Pare a máquina virtual que você iniciou na etapa anterior.</span><span class="sxs-lookup"><span data-stu-id="35a19-217">Stop the virtual machine that you started in the previous step.</span></span>
6. <span data-ttu-id="35a19-218">Clique em **Iniciar** para iniciar o runbook.</span><span class="sxs-lookup"><span data-stu-id="35a19-218">Click **Start** to start the runbook.</span></span> <span data-ttu-id="35a19-219">Digite o **VMName** e o **ResourceGroupName** da máquina virtual que você iniciará.</span><span class="sxs-lookup"><span data-stu-id="35a19-219">Type in the **VMName** and **ResourceGroupName** for the virtual machine that you're going to start.</span></span><br><br> <span data-ttu-id="35a19-220">![Start Runbook](media/automation-first-runbook-textual/automation-pass-params.png)</span><span class="sxs-lookup"><span data-stu-id="35a19-220">![Start Runbook](media/automation-first-runbook-textual/automation-pass-params.png)</span></span><br>  
7. <span data-ttu-id="35a19-221">Quando o runbook for concluído, verifique se a máquina virtual foi iniciada.</span><span class="sxs-lookup"><span data-stu-id="35a19-221">When the runbook completes, check that the virtual machine was started.</span></span>  

## <a name="next-steps"></a><span data-ttu-id="35a19-222">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="35a19-222">Next steps</span></span>
* <span data-ttu-id="35a19-223">Para começar a usar runbooks gráficos, veja [O meu primeiro runbook gráfico](automation-first-runbook-graphical.md)</span><span class="sxs-lookup"><span data-stu-id="35a19-223">To get started with Graphical runbooks, see [My first graphical runbook](automation-first-runbook-graphical.md)</span></span>
* <span data-ttu-id="35a19-224">Para começar a usar os runbooks do PowerShell, veja [Meu primeiro runbook do PowerShell](automation-first-runbook-textual-powershell.md)</span><span class="sxs-lookup"><span data-stu-id="35a19-224">To get started with PowerShell runbooks, see [My first PowerShell runbook](automation-first-runbook-textual-powershell.md)</span></span>
* <span data-ttu-id="35a19-225">Para aprender mais sobre os tipos de runbook, suas vantagens e limitações, veja [Tipos de runbook da Automação do Azure](automation-runbook-types.md)</span><span class="sxs-lookup"><span data-stu-id="35a19-225">To learn more about runbook types, their advantages and limitations, see [Azure Automation runbook types](automation-runbook-types.md)</span></span>
* <span data-ttu-id="35a19-226">Para saber mais sobre o recurso de suporte a scripts do PowerShell, veja [Native PowerShell script support in Azure Automation (Suporte a scripts nativos do PowerShell na Automação do Azure)](https://azure.microsoft.com/blog/announcing-powershell-script-support-azure-automation-2/)</span><span class="sxs-lookup"><span data-stu-id="35a19-226">For more information on PowerShell script support feature, see [Native PowerShell script support in Azure Automation](https://azure.microsoft.com/blog/announcing-powershell-script-support-azure-automation-2/)</span></span>
