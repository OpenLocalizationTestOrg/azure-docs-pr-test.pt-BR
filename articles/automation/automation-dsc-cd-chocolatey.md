---
title: "aaaAzure implantação contínua de DSC de automação com Chocolatey | Microsoft Docs"
description: "Implantação contínua de DevOps usando DSC de Automação do Azure e o gerenciador de pacotes Chocolatey.  Exemplo com modelo ARM JSON completo e fonte do PowerShell."
services: automation
documentationcenter: 
author: eslesar
manager: carmonm
editor: tysonn
ms.assetid: c0baa411-eb76-4f91-8d14-68f68b4805b6
ms.service: automation
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: na
ms.date: 10/29/2016
ms.author: golive
ms.openlocfilehash: 60af52af5f834fd48e3a0dc4677919397b53f0f4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="usage-example-continuous-deployment-toovirtual-machines-using-automation-dsc-and-chocolatey"></a><span data-ttu-id="7f584-104">Exemplo de uso: Implantação contínua tooVirtual máquinas usando DSC de automação e Chocolatey</span><span class="sxs-lookup"><span data-stu-id="7f584-104">Usage Example: Continuous deployment tooVirtual Machines using Automation DSC and Chocolatey</span></span>
<span data-ttu-id="7f584-105">Em um mundo de DevOps há muitos tooassist ferramentas com vários pontos no pipeline de integração contínua hello.</span><span class="sxs-lookup"><span data-stu-id="7f584-105">In a DevOps world there are many tools tooassist with various points in hello Continuous Integration pipeline.</span></span>  <span data-ttu-id="7f584-106">Configuração de estado do Azure Automation desejado (DSC) é um opções de toohello de adição de novos bem-vindo que utilizam a equipes de DevOps.</span><span class="sxs-lookup"><span data-stu-id="7f584-106">Azure Automation Desired State Configuration (DSC) is a welcome new addition toohello options that DevOps teams can employ.</span></span>  <span data-ttu-id="7f584-107">Este artigo demonstra a configuração da CD (Implantação Contínua) para um computador com Windows.</span><span class="sxs-lookup"><span data-stu-id="7f584-107">This article demonstrates setting up Continuous Deployment (CD) for a Windows computer.</span></span>  <span data-ttu-id="7f584-108">Você pode estender facilmente Olá técnica tooinclude tantos computadores Windows conforme necessário na função hello (um site da web, por exemplo) e de lá tooadditional funções também.</span><span class="sxs-lookup"><span data-stu-id="7f584-108">You can easily extend hello technique tooinclude as many Windows computers as necessary in hello role (a web site, for example), and from there tooadditional roles as well.</span></span>

![Implantação contínua para VMs do IaaS](./media/automation-dsc-cd-chocolatey/cdforiaasvm.png)

## <a name="at-a-high-level"></a><span data-ttu-id="7f584-110">Em um alto nível</span><span class="sxs-lookup"><span data-stu-id="7f584-110">At a high level</span></span>
<span data-ttu-id="7f584-111">Há bem pouco acontecendo aqui, mas, felizmente, é possível dividir tudo em dois processos principais:</span><span class="sxs-lookup"><span data-stu-id="7f584-111">There is quite a bit going on here, but fortunately it can be broken into two main processes:</span></span> 

* <span data-ttu-id="7f584-112">Escrevendo código e testá-lo, em seguida, criar e publicar pacotes de instalação para as versões principais e secundárias do sistema de saudação.</span><span class="sxs-lookup"><span data-stu-id="7f584-112">Writing code and testing it, then creating and publishing installation packages for major and minor versions of hello system.</span></span> 
* <span data-ttu-id="7f584-113">Criar e gerenciar máquinas virtuais que irão instalar e executar o código de saudação em pacotes de saudação.</span><span class="sxs-lookup"><span data-stu-id="7f584-113">Creating and managing VMs that will install and execute hello code in hello packages.</span></span>  

<span data-ttu-id="7f584-114">Depois que esses dois principais processos estão em vigor, é um pacote de saudação etapa curto tooautomatically atualização em execução em uma VM específica como novas versões são criadas e implantadas.</span><span class="sxs-lookup"><span data-stu-id="7f584-114">Once both of these core processes are in place, it’s a short step tooautomatically update hello package running on any particular VM as new versions are created and deployed.</span></span>

## <a name="component-overview"></a><span data-ttu-id="7f584-115">Visão geral do componente</span><span class="sxs-lookup"><span data-stu-id="7f584-115">Component overview</span></span>
<span data-ttu-id="7f584-116">Os gerentes do pacote como [apt get](https://en.wikipedia.org/wiki/Advanced_Packaging_Tool) são bastante conhecidos no Linux Olá, mundo, mas não tanto no mundo do Windows hello.</span><span class="sxs-lookup"><span data-stu-id="7f584-116">Package managers such as [apt-get](https://en.wikipedia.org/wiki/Advanced_Packaging_Tool) are pretty well known in hello Linux world, but not so much in hello Windows world.</span></span>  <span data-ttu-id="7f584-117">[Chocolatey](https://chocolatey.org/) é tal uma coisa e de Scott Hanselman [blog](http://www.hanselman.com/blog/IsTheWindowsUserReadyForAptget.aspx) em Olá tópico é uma ótima introdução.</span><span class="sxs-lookup"><span data-stu-id="7f584-117">[Chocolatey](https://chocolatey.org/) is such a thing, and Scott Hanselman’s [blog](http://www.hanselman.com/blog/IsTheWindowsUserReadyForAptget.aspx) on hello topic is a great intro.</span></span>  <span data-ttu-id="7f584-118">Resumindo, Chocolatey permite tooinstall pacotes de um repositório central de pacotes em um sistema do Windows usando a linha de comando hello.</span><span class="sxs-lookup"><span data-stu-id="7f584-118">In a nutshell, Chocolatey allows you tooinstall packages from a central repository of packages into a Windows system using hello command line.</span></span>  <span data-ttu-id="7f584-119">Você pode criar e gerenciar seu próprio repositório, e o Chocolatey pode instalar pacotes de qualquer repositório que você designar.</span><span class="sxs-lookup"><span data-stu-id="7f584-119">You can create and manage your own repository, and Chocolatey can install packages from any number of repositories that you designate.</span></span>

<span data-ttu-id="7f584-120">Estado de configuração desejado (DSC) ([visão geral](https://technet.microsoft.com/library/dn249912.aspx)) é uma ferramenta do PowerShell que permite que você toodeclare Olá configuração para uma máquina.</span><span class="sxs-lookup"><span data-stu-id="7f584-120">Desired State Configuration (DSC) ([overview](https://technet.microsoft.com/library/dn249912.aspx)) is a PowerShell tool that allows you toodeclare hello configuration that you want for a machine.</span></span>  <span data-ttu-id="7f584-121">Por exemplo, você pode dizer: "Quero o Chocolatey instalado, quero o IIS instalado, quero a porta 80 aberta, quero a versão 1.0.0 de meu site instalada".</span><span class="sxs-lookup"><span data-stu-id="7f584-121">For example, you can say, “I want Chocolatey installed, I want IIS installed, I want port 80 opened, I want version 1.0.0 of my website installed.”</span></span>  <span data-ttu-id="7f584-122">Olá DSC Gerenciador de configurações Local (LCM) implementa essa configuração.</span><span class="sxs-lookup"><span data-stu-id="7f584-122">hello DSC Local Configuration Manager (LCM) implements that configuration.</span></span> <span data-ttu-id="7f584-123">Um Servidor de recepção da DSC mantém um repositório de configurações para seus computadores.</span><span class="sxs-lookup"><span data-stu-id="7f584-123">A DSC Pull Server holds a repository of configurations for your machines.</span></span> <span data-ttu-id="7f584-124">Olá LCM em cada computador verifica no toosee periodicamente se sua configuração corresponde à configuração armazenada hello.</span><span class="sxs-lookup"><span data-stu-id="7f584-124">hello LCM on each machine checks in periodically toosee if its configuration matches hello stored configuration.</span></span> <span data-ttu-id="7f584-125">Ele pode relatar o status ou tentativa de máquina de saudação toobring no alinhamento com a configuração armazenada hello.</span><span class="sxs-lookup"><span data-stu-id="7f584-125">It can either report status or attempt toobring hello machine back into alignment with hello stored configuration.</span></span> <span data-ttu-id="7f584-126">Você pode editar Olá configuração armazenada em Olá pull server toocause uma máquina ou conjunto de máquinas toocome alinhada com a configuração de saudação alterada.</span><span class="sxs-lookup"><span data-stu-id="7f584-126">You can edit hello stored configuration on hello pull server toocause a machine or set of machines toocome into alignment with hello changed configuration.</span></span>

<span data-ttu-id="7f584-127">Automação do Azure é um serviço gerenciado no Microsoft Azure que permite que você tooautomate várias tarefas usando runbooks, nós, credenciais, recursos e ativos como variáveis globais e agendas.</span><span class="sxs-lookup"><span data-stu-id="7f584-127">Azure Automation is a managed service in Microsoft Azure that allows you tooautomate various tasks using runbooks, nodes, credentials, resources and assets such as schedules and global variables.</span></span> <span data-ttu-id="7f584-128">DSC de automação do Azure estende essa automação ferramentas do recurso tooinclude DSC do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="7f584-128">Azure Automation DSC extends this automation capability tooinclude PowerShell DSC tools.</span></span>  <span data-ttu-id="7f584-129">Confira uma excelente [visão geral](automation-dsc-overview.md).</span><span class="sxs-lookup"><span data-stu-id="7f584-129">Here’s a great [overview](automation-dsc-overview.md).</span></span>

<span data-ttu-id="7f584-130">Um Recurso DSC é um módulo de código que tem recursos específicos, como gerenciar redes, o Active Directory ou o SQL Server.</span><span class="sxs-lookup"><span data-stu-id="7f584-130">A DSC Resource is a module of code that has specific capabilities, such as managing networking, Active Directory, or SQL Server.</span></span>  <span data-ttu-id="7f584-131">Olá Chocolatey recurso de DSC sabe como tooaccess um servidor do NuGet (entre outros), baixe os pacotes, pacotes de instalação e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="7f584-131">hello Chocolatey DSC Resource knows how tooaccess a NuGet Server (among others), download packages, install packages, and so on.</span></span>  <span data-ttu-id="7f584-132">Há muitos outros recursos de DSC em Olá [Galeria do PowerShell](http://www.powershellgallery.com/packages?q=dsc+resources&prerelease=&sortOrder=package-title).</span><span class="sxs-lookup"><span data-stu-id="7f584-132">There are many other DSC Resources in hello [PowerShell Gallery](http://www.powershellgallery.com/packages?q=dsc+resources&prerelease=&sortOrder=package-title).</span></span>  <span data-ttu-id="7f584-133">Esses módulos são instalados no Servidor de Recepção da DSC de Automação do Azure (por você) para que possam ser usados por suas configurações.</span><span class="sxs-lookup"><span data-stu-id="7f584-133">These modules are installed into your Azure Automation DSC Pull Server (by you) so they can be used by your configurations.</span></span>

<span data-ttu-id="7f584-134">Os modelos do Resource Manager fornecem uma maneira declarativa de gerar sua infraestrutura (itens como redes, sub-redes, roteamento e segurança de rede, balanceadores de carga, NICs, VMs e assim por diante).</span><span class="sxs-lookup"><span data-stu-id="7f584-134">Resource Manager templates provide a declarative way of generating your infrastructure - things like networks, subnets, network security and routing, load balancers, NICs, VMs, and so on.</span></span>  <span data-ttu-id="7f584-135">Aqui está uma [artigo](../azure-resource-manager/resource-manager-deployment-model.md) que compara Olá modelo de implantação do Gerenciador de recursos (declarativo) com hello Azure Service Management (ASM ou clássico) implantação de modelo (obrigatória) e discute o recurso de núcleo Olá provedores, computação, armazenamento e rede.</span><span class="sxs-lookup"><span data-stu-id="7f584-135">Here’s an [article](../azure-resource-manager/resource-manager-deployment-model.md) that compares hello Resource Manager deployment model (declarative) with hello Azure Service Management (ASM, or classic) deployment model (imperative), and discusses hello core resource providers, compute, storage and network.</span></span>

<span data-ttu-id="7f584-136">Um recurso importante de um modelo do Gerenciador de recursos é sua capacidade tooinstall uma extensão de VM na VM de saudação conforme ela é provisionada.</span><span class="sxs-lookup"><span data-stu-id="7f584-136">One key feature of an Resource Manager template is its ability tooinstall a VM extension into hello VM as it’s provisioned.</span></span>  <span data-ttu-id="7f584-137">Uma extensão de VM tem recursos específicos, como executar um script personalizado, instalar software antivírus ou executar um script de configuração de DSC.</span><span class="sxs-lookup"><span data-stu-id="7f584-137">A VM extension has specific capabilities such as running a custom script, installing anti-virus software, or running a DSC configuration script.</span></span>  <span data-ttu-id="7f584-138">Há muitos outros tipos de extensões de VM.</span><span class="sxs-lookup"><span data-stu-id="7f584-138">There are many other types of VM extensions.</span></span>

## <a name="quick-trip-around-hello-diagram"></a><span data-ttu-id="7f584-139">Processamento rápido em torno do diagrama de saudação</span><span class="sxs-lookup"><span data-stu-id="7f584-139">Quick trip around hello diagram</span></span>
<span data-ttu-id="7f584-140">Iniciando na parte superior do hello, você escreve seu código, compilar e testar e criar um pacote de instalação.</span><span class="sxs-lookup"><span data-stu-id="7f584-140">Starting at hello top, you write your code, build and test, then create an installation package.</span></span>  <span data-ttu-id="7f584-141">O Chocolatey pode manipular vários tipos de pacotes de instalação, como MSI, MSU e ZIP.</span><span class="sxs-lookup"><span data-stu-id="7f584-141">Chocolatey can handle various types of installation packages, such as MSI, MSU, ZIP.</span></span>  <span data-ttu-id="7f584-142">E você tem toda a capacidade de instalação real do PowerShell toodo Olá Olá se recursos nativos do Chocolatey não são bastante o tooit.</span><span class="sxs-lookup"><span data-stu-id="7f584-142">And you have hello full power of PowerShell toodo hello actual installation if Chocolatey’s native capabilities aren’t quite up tooit.</span></span>  <span data-ttu-id="7f584-143">Coloque o pacote de saudação em algum lugar acessível – um repositório de pacotes.</span><span class="sxs-lookup"><span data-stu-id="7f584-143">Put hello package into someplace reachable – a package repository.</span></span>  <span data-ttu-id="7f584-144">Este exemplo de uso usa uma pasta pública em uma conta de armazenamento de blob do Azure, mas pode estar em qualquer outro lugar.</span><span class="sxs-lookup"><span data-stu-id="7f584-144">This usage example uses a public folder in an Azure blob storage account, but it can be anywhere.</span></span>  <span data-ttu-id="7f584-145">O Chocolatey funciona nativamente com servidores do NuGet e alguns outras para o gerenciamento de metadados de pacote.</span><span class="sxs-lookup"><span data-stu-id="7f584-145">Chocolatey works natively with NuGet servers and a few others for management of package metadata.</span></span>  <span data-ttu-id="7f584-146">[Este artigo](https://github.com/chocolatey/choco/wiki/How-To-Host-Feed) descreve opções de saudação.</span><span class="sxs-lookup"><span data-stu-id="7f584-146">[This article](https://github.com/chocolatey/choco/wiki/How-To-Host-Feed) describes hello options.</span></span>  <span data-ttu-id="7f584-147">Este exemplo de uso usa o NuGet.</span><span class="sxs-lookup"><span data-stu-id="7f584-147">This usage example uses NuGet.</span></span>  <span data-ttu-id="7f584-148">Um Nuspec consiste em metadados sobre seus pacotes.</span><span class="sxs-lookup"><span data-stu-id="7f584-148">A Nuspec is metadata about your packages.</span></span>  <span data-ttu-id="7f584-149">saudação Nuspec é "compilado" do NuPkg e armazenado em um servidor do NuGet.</span><span class="sxs-lookup"><span data-stu-id="7f584-149">hello Nuspec’s are “compiled” into NuPkg’s and stored in a NuGet server.</span></span>  <span data-ttu-id="7f584-150">Quando sua configuração solicita um pacote por nome e faz referência a um servidor do NuGet, Olá Chocolatey recurso de DSC (agora em Olá VM) captura pacote hello e instala para você.</span><span class="sxs-lookup"><span data-stu-id="7f584-150">When your configuration requests a package by name, and references a NuGet server, hello Chocolatey DSC Resource (now on hello VM) grabs hello package and installs it for you.</span></span>  <span data-ttu-id="7f584-151">Você também pode solicitar uma versão específica de um pacote.</span><span class="sxs-lookup"><span data-stu-id="7f584-151">You can also request a specific version of a package.</span></span>

<span data-ttu-id="7f584-152">Olá inferior esquerdo parte imagem hello, há um modelo do Azure Resource Manager (ARM).</span><span class="sxs-lookup"><span data-stu-id="7f584-152">In hello bottom left portion of hello picture, there is an Azure Resource Manager (ARM) template.</span></span>  <span data-ttu-id="7f584-153">Neste exemplo de uso, Olá extensão de VM registra Olá VM com hello o servidor de Pull de DSC do Azure Automation (isto é, um servidor de pull) como um nó.</span><span class="sxs-lookup"><span data-stu-id="7f584-153">In this usage example, hello VM extension registers hello VM with hello Azure Automation DSC Pull Server (that is, a pull server) as a Node.</span></span>  <span data-ttu-id="7f584-154">Olá configuração é armazenada no servidor de pull de saudação.</span><span class="sxs-lookup"><span data-stu-id="7f584-154">hello configuration is stored in hello pull server.</span></span>  <span data-ttu-id="7f584-155">Na verdade, ela é armazenada duas vezes: uma vez como texto sem formatação e uma vez compilada como um arquivo MOF (para aqueles que os conhecem.)  No portal de saudação Olá MOF é uma configuração de nó"" (como toosimply contrário "configuração").</span><span class="sxs-lookup"><span data-stu-id="7f584-155">Actually, it’s stored twice: once as plain text and once compiled as an MOF file (for those that know about such things.)  In hello portal, hello MOF is a “node configuration” (as opposed toosimply “configuration”).</span></span>  <span data-ttu-id="7f584-156">Sua saudação artefato associado a um nó para que nó Olá saiba sua configuração.</span><span class="sxs-lookup"><span data-stu-id="7f584-156">It’s hello artifact that’s associated with a Node so hello node will know its configuration.</span></span>  <span data-ttu-id="7f584-157">Os detalhes abaixo mostram como tooassign Olá nó de toohello de configuração do nó.</span><span class="sxs-lookup"><span data-stu-id="7f584-157">Details below show how tooassign hello node configuration toohello node.</span></span>

<span data-ttu-id="7f584-158">Presume-se já estiver fazendo bit Olá na parte superior do hello, ou a maioria dos-lo.</span><span class="sxs-lookup"><span data-stu-id="7f584-158">Presumably you’re already doing hello bit at hello top, or most of it.</span></span>  <span data-ttu-id="7f584-159">Criando nuspec hello, compilação e armazená-los em um servidor do NuGet são uma coisa pequena.</span><span class="sxs-lookup"><span data-stu-id="7f584-159">Creating hello nuspec, compiling and storing it in a NuGet server is a small thing.</span></span>  <span data-ttu-id="7f584-160">E você já está gerenciando VMs.</span><span class="sxs-lookup"><span data-stu-id="7f584-160">And you’re already managing VMs.</span></span>  <span data-ttu-id="7f584-161">Levar Olá próxima etapa toocontinuous implantação requer a configuração de servidor de pull de saudação (uma vez), registrar os nós com ele (uma vez) e criar e armazenar a configuração de saudação existe (inicialmente).</span><span class="sxs-lookup"><span data-stu-id="7f584-161">Taking hello next step toocontinuous deployment requires setting up hello pull server (once), registering your nodes with it (once), and creating and storing hello configuration there (initially).</span></span>  <span data-ttu-id="7f584-162">Como os pacotes são atualizados e implantados toohello repositório, atualize hello configuração e configuração de nó no servidor de pull da saudação (repetir conforme necessário).</span><span class="sxs-lookup"><span data-stu-id="7f584-162">Then as packages are upgraded and deployed toohello repository, refresh hello Configuration and Node Configuration in hello pull server (repeat as needed).</span></span>

<span data-ttu-id="7f584-163">Se você não estiver começando com um modelo do ARM, isso também está OK.</span><span class="sxs-lookup"><span data-stu-id="7f584-163">If you’re not starting with an ARM template, that’s also OK.</span></span>  <span data-ttu-id="7f584-164">Há PowerShell cmdlets projetados toohelp registrar suas VMs com o servidor de pull hello e Olá resto.</span><span class="sxs-lookup"><span data-stu-id="7f584-164">There are PowerShell cmdlets designed toohelp you register your VMs with hello pull server and all of hello rest.</span></span> <span data-ttu-id="7f584-165">Para obter mais detalhes, confira este artigo: [Integrando máquinas para o gerenciamento pelo DSC de Automação do Azure](automation-dsc-onboarding.md)</span><span class="sxs-lookup"><span data-stu-id="7f584-165">For more details, see this article: [Onboarding machines for management by Azure Automation DSC](automation-dsc-onboarding.md)</span></span>

## <a name="step-1-setting-up-hello-pull-server-and-automation-account"></a><span data-ttu-id="7f584-166">Etapa 1: Configuração de conta de automação e de servidor de pull Olá</span><span class="sxs-lookup"><span data-stu-id="7f584-166">Step 1: Setting up hello pull server and automation account</span></span>
<span data-ttu-id="7f584-167">Em uma linha de comando do PowerShell (Adicionar AzureRmAccount) autenticada: (pode levar alguns minutos enquanto o servidor de recepção de saudação é configurado)</span><span class="sxs-lookup"><span data-stu-id="7f584-167">At an authenticated (Add-AzureRmAccount) PowerShell command line:  (can take a few minutes while hello pull server is set up)</span></span>

    New-AzureRmResourceGroup –Name MY-AUTOMATION-RG –Location MY-RG-LOCATION-IN-QUOTES
    New-AzureRmAutomationAccount –ResourceGroupName MY-AUTOMATION-RG –Location MY-RG-LOCATION-IN-QUOTES –Name MY-AUTOMATION-ACCOUNT 

<span data-ttu-id="7f584-168">Você pode colocar sua conta de automação em qualquer Olá regiões (também conhecido como local) a seguir: Leste dos EUA 2, Centro Sul dos EUA, nós Gov Virgínia, Europa Ocidental, Sudeste da Ásia, Leste do Japão, Índia Central e Sudeste da Austrália, Canadá Central, Norte da Europa.</span><span class="sxs-lookup"><span data-stu-id="7f584-168">You can put your automation account into any of hello following regions (aka location):  East US 2, South Central US, US Gov Virginia, West Europe, Southeast Asia, Japan East, Central India and Australia Southeast, Canada Central, North Europe.</span></span>

## <a name="step-2-vm-extension-tweaks-toohello-arm-template"></a><span data-ttu-id="7f584-169">Etapa 2: Extensão de VM ajustes toohello modelo do ARM</span><span class="sxs-lookup"><span data-stu-id="7f584-169">Step 2: VM extension tweaks toohello ARM template</span></span>
<span data-ttu-id="7f584-170">Detalhes de registro VM (usando a extensão de VM de DSC do PowerShell Olá) fornecido neste [modelo de início rápido do Azure](https://github.com/Azure/azure-quickstart-templates/tree/master/dsc-extension-azure-automation-pullserver).</span><span class="sxs-lookup"><span data-stu-id="7f584-170">Details for VM registration (using hello PowerShell DSC VM extension) provided in this [Azure Quickstart Template](https://github.com/Azure/azure-quickstart-templates/tree/master/dsc-extension-azure-automation-pullserver).</span></span>  <span data-ttu-id="7f584-171">Esta etapa registra sua nova VM com o servidor de pull Olá na lista de saudação de nós de DSC.</span><span class="sxs-lookup"><span data-stu-id="7f584-171">This step registers your new VM with hello pull server in hello list of DSC Nodes.</span></span>  <span data-ttu-id="7f584-172">Parte do registro está especificando Olá configuração toobe aplicada toohello nós.</span><span class="sxs-lookup"><span data-stu-id="7f584-172">Part of this registration is specifying hello node configuration toobe applied toohello node.</span></span>  <span data-ttu-id="7f584-173">Essa configuração de nó ainda não tiver tooexist no servidor de pull hello, portanto é Okey etapa 4 é onde isso é feito para Olá primeira vez.</span><span class="sxs-lookup"><span data-stu-id="7f584-173">This node configuration doesn't have tooexist yet in hello pull server, so it's OK that Step 4 is where this is done for hello first time.</span></span>  <span data-ttu-id="7f584-174">Mas aqui na etapa 2 você precisa toohave nome hello decidiu nó de saudação e nome de saudação da configuração de saudação.</span><span class="sxs-lookup"><span data-stu-id="7f584-174">But here in Step 2 you do need toohave decided hello name of hello node and hello name of hello configuration.</span></span>  <span data-ttu-id="7f584-175">Neste exemplo de uso, o nó de saudação é 'isvbox' e Olá configuração 'ISVBoxConfig'.</span><span class="sxs-lookup"><span data-stu-id="7f584-175">In this usage example, hello node is 'isvbox' and hello configuration is 'ISVBoxConfig'.</span></span>  <span data-ttu-id="7f584-176">Portanto, nome de configuração de nó hello (toobe especificado em DeploymentTemplate.json) é 'ISVBoxConfig.isvbox'.</span><span class="sxs-lookup"><span data-stu-id="7f584-176">So hello node configuration name (toobe specified in DeploymentTemplate.json) is 'ISVBoxConfig.isvbox'.</span></span>  

## <a name="step-3-adding-required-dsc-resources-toohello-pull-server"></a><span data-ttu-id="7f584-177">Etapa 3: Adicionando necessário servidor de pull de DSC recursos toohello</span><span class="sxs-lookup"><span data-stu-id="7f584-177">Step 3: Adding required DSC resources toohello pull server</span></span>
<span data-ttu-id="7f584-178">Olá Galeria do PowerShell é instrumentado tooinstall recursos de DSC em sua conta de automação do Azure.</span><span class="sxs-lookup"><span data-stu-id="7f584-178">hello PowerShell Gallery is instrumented tooinstall DSC resources into your Azure Automation account.</span></span>  <span data-ttu-id="7f584-179">Navegue toohello recurso desejado e clique botão de "Implantar tooAzure automação" hello.</span><span class="sxs-lookup"><span data-stu-id="7f584-179">Navigate toohello resource you want and click hello “Deploy tooAzure Automation” button.</span></span>

![Exemplo da Galeria do PowerShell](./media/automation-dsc-cd-chocolatey/xNetworking.PNG)

<span data-ttu-id="7f584-181">Outra técnica adicionado recentemente toohello Portal do Azure permite que você toopull em novos módulos ou módulos de atualização existente.</span><span class="sxs-lookup"><span data-stu-id="7f584-181">Another technique recently added toohello Azure Portal allows you toopull in new modules or update existing modules.</span></span> <span data-ttu-id="7f584-182">Clique em recursos da conta de automação de hello, bloco de ativos de saudação e, finalmente, bloco de módulos de saudação.</span><span class="sxs-lookup"><span data-stu-id="7f584-182">Click through hello Automation Account resource, hello Assets tile, and finally hello Modules tile.</span></span>  <span data-ttu-id="7f584-183">ícone de procurar Galeria Olá permite toosee lista Olá módulos Galeria hello, fazer drill down nos detalhes e, por fim, importar para a conta de automação.</span><span class="sxs-lookup"><span data-stu-id="7f584-183">hello Browse Gallery icon allows you toosee hello list of modules in hello gallery, drill down into details and ultimately import into your Automation Account.</span></span> <span data-ttu-id="7f584-184">Isso é uma ótima maneira tookeep seus módulos backup toodate de tootime de tempo.</span><span class="sxs-lookup"><span data-stu-id="7f584-184">This is a great way tookeep your modules up toodate from time tootime.</span></span> <span data-ttu-id="7f584-185">Além disso, o recurso de importação Olá verifica as dependências com outros tooensure módulos que nada obtém fora de sincronia.</span><span class="sxs-lookup"><span data-stu-id="7f584-185">And, hello import feature checks dependencies with other modules tooensure nothing gets out of sync.</span></span>

<span data-ttu-id="7f584-186">Ou, não há abordagem manual hello.</span><span class="sxs-lookup"><span data-stu-id="7f584-186">Or, there’s hello manual approach.</span></span>  <span data-ttu-id="7f584-187">estrutura de pastas de saudação de um módulo de integração para um computador com o Windows PowerShell é um pouco diferente da estrutura de pastas de saudação esperada pelo Olá automação do Azure.</span><span class="sxs-lookup"><span data-stu-id="7f584-187">hello folder structure of a PowerShell Integration Module for a Windows computer is a little different from hello folder structure expected by hello Azure Automation.</span></span>  <span data-ttu-id="7f584-188">Isso exige que você faça alguns ajustes.</span><span class="sxs-lookup"><span data-stu-id="7f584-188">This requires a little tweaking on your part.</span></span>  <span data-ttu-id="7f584-189">Mas não é difícil, e isso é feito apenas uma vez por recurso (a menos que você deseja tooupgrade-lo no futuro.)  Para saber mais sobre como criar Módulos de Integração do PowerShell, confira este artigo: [Criando Módulos de Integração para a Automação do Azure](https://azure.microsoft.com/blog/authoring-integration-modules-for-azure-automation/)</span><span class="sxs-lookup"><span data-stu-id="7f584-189">But it’s not hard, and it’s done only once per resource (unless you want tooupgrade it in future.)  For more information on authoring PowerShell Integration Modules, see this article: [Authoring Integration Modules for Azure Automation](https://azure.microsoft.com/blog/authoring-integration-modules-for-azure-automation/)</span></span>

* <span data-ttu-id="7f584-190">Instale o módulo de saudação que são necessários em sua estação de trabalho, da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="7f584-190">Install hello module that you need on your workstation, as follows:</span></span>
  * <span data-ttu-id="7f584-191">Instale o [Windows Management Framework, v5](http://aka.ms/wmf5latest) (não é necessário para o Windows 10)</span><span class="sxs-lookup"><span data-stu-id="7f584-191">Install [Windows Management Framework, v5](http://aka.ms/wmf5latest) (not needed for Windows 10)</span></span>
  * <span data-ttu-id="7f584-192">`Install-Module –Name MODULE-NAME`< — captura Olá módulo a partir da saudação Galeria do PowerShell</span><span class="sxs-lookup"><span data-stu-id="7f584-192">`Install-Module –Name MODULE-NAME`    <—grabs hello module from hello PowerShell Gallery</span></span> 
* <span data-ttu-id="7f584-193">Pasta de módulo de saudação de cópia de `c:\Program Files\WindowsPowerShell\Modules\MODULE-NAME` pasta temp tooa</span><span class="sxs-lookup"><span data-stu-id="7f584-193">Copy hello module folder from `c:\Program Files\WindowsPowerShell\Modules\MODULE-NAME` tooa temp folder</span></span> 
* <span data-ttu-id="7f584-194">Excluir amostras e documentação da pasta principal Olá</span><span class="sxs-lookup"><span data-stu-id="7f584-194">Delete samples and documentation from hello main folder</span></span> 
* <span data-ttu-id="7f584-195">Pasta principal do ZIP hello, nomear o arquivo ZIP de saudação exatamente Olá mesmo como pasta Olá</span><span class="sxs-lookup"><span data-stu-id="7f584-195">Zip hello main folder, naming hello ZIP file exactly hello same as hello folder</span></span> 
* <span data-ttu-id="7f584-196">Coloque o arquivo ZIP de saudação em um local acessível de HTTP, como o armazenamento de blob em uma conta de armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="7f584-196">Put hello ZIP file into a reachable HTTP location, such as blob storage in an Azure Storage Account.</span></span>
* <span data-ttu-id="7f584-197">Execute este PowerShell:</span><span class="sxs-lookup"><span data-stu-id="7f584-197">Run this PowerShell:</span></span>
  
      New-AzureRmAutomationModule `
          -ResourceGroupName MY-AUTOMATION-RG -AutomationAccountName MY-AUTOMATION-ACCOUNT `
          -Name MODULE-NAME –ContentLink "https://STORAGE-URI/CONTAINERNAME/MODULE-NAME.zip"

<span data-ttu-id="7f584-198">exemplo Hello incluído executa estas etapas para cChoco e xNetworking.</span><span class="sxs-lookup"><span data-stu-id="7f584-198">hello included example performs these steps for cChoco and xNetworking.</span></span> <span data-ttu-id="7f584-199">Consulte Olá [notas](#notes) para tratamento especial para cChoco.</span><span class="sxs-lookup"><span data-stu-id="7f584-199">See hello [Notes](#notes) for special handling for cChoco.</span></span>

## <a name="step-4-adding-hello-node-configuration-toohello-pull-server"></a><span data-ttu-id="7f584-200">Etapa 4: Adicionando um servidor de pull Olá nó configuração toohello</span><span class="sxs-lookup"><span data-stu-id="7f584-200">Step 4: Adding hello node configuration toohello pull server</span></span>
<span data-ttu-id="7f584-201">Não há nada especial sobre Olá primeira vez que você importar sua configuração para a compilação e o servidor de pull de saudação.</span><span class="sxs-lookup"><span data-stu-id="7f584-201">There’s nothing special about hello first time you import your configuration into hello pull server and compile.</span></span>  <span data-ttu-id="7f584-202">Importação subsequentes/compila todos da saudação mesma aparência configuração exatamente Olá mesmo.</span><span class="sxs-lookup"><span data-stu-id="7f584-202">All subsequent import/compiles of hello same configuration look exactly hello same.</span></span>  <span data-ttu-id="7f584-203">Cada vez que o pacote de atualização e precisa toopush-tooproduction você executar essa etapa depois de verificar o arquivo de configuração de saudação está correto – incluindo Olá nova versão do pacote.</span><span class="sxs-lookup"><span data-stu-id="7f584-203">Each time you update your package and need toopush it out tooproduction you do this step after ensuring hello configuration file is correct – including hello new version of your package.</span></span>  <span data-ttu-id="7f584-204">Aqui está o arquivo de configuração de saudação e do PowerShell:</span><span class="sxs-lookup"><span data-stu-id="7f584-204">Here’s hello configuration file and PowerShell:</span></span>

<span data-ttu-id="7f584-205">ISVBoxConfig.ps1:</span><span class="sxs-lookup"><span data-stu-id="7f584-205">ISVBoxConfig.ps1:</span></span>

    Configuration ISVBoxConfig 
    { 
        Import-DscResource -ModuleName cChoco 
        Import-DscResource -ModuleName xNetworking

        Node "isvbox" {   

            cChocoInstaller installChoco 
            { 
                InstallDir = "C:\choco" 
            }

            WindowsFeature installIIS 
            { 
                Ensure="Present" 
                Name="Web-Server" 
            }

            xFirewall WebFirewallRule 
            { 
                Direction = "Inbound" 
                Name = "Web-Server-TCP-In" 
                DisplayName = "Web Server (TCP-In)" 
                Description = "IIS allow incoming web site traffic." 
                DisplayGroup = "IIS Incoming Traffic" 
                State = "Enabled" 
                Access = "Allow" 
                Protocol = "TCP" 
                LocalPort = "80" 
                Ensure = "Present" 
            }

            cChocoPackageInstaller trivialWeb 
            {            
                Name = "trivialweb" 
                Version = "1.0.0" 
                Source = “MY-NUGET-V2-SERVER-ADDRESS” 
                DependsOn = "[cChocoInstaller]installChoco", 
                "[WindowsFeature]installIIS" 
            } 
        }    
    }

<span data-ttu-id="7f584-206">New-ConfigurationScript.ps1:</span><span class="sxs-lookup"><span data-stu-id="7f584-206">New-ConfigurationScript.ps1:</span></span>

    Import-AzureRmAutomationDscConfiguration ` 
        -ResourceGroupName MY-AUTOMATION-RG –AutomationAccountName MY-AUTOMATION-ACCOUNT ` 
        -SourcePath C:\temp\AzureAutomationDsc\ISVBoxConfig.ps1 ` 
        -Published –Force

    $jobData = Start-AzureRmAutomationDscCompilationJob ` 
        -ResourceGroupName MY-AUTOMATION-RG –AutomationAccountName MY-AUTOMATION-ACCOUNT ` 
        -ConfigurationName ISVBoxConfig 

    $compilationJobId = $jobData.Id

    Get-AzureRmAutomationDscCompilationJob ` 
        -ResourceGroupName MY-AUTOMATION-RG –AutomationAccountName MY-AUTOMATION-ACCOUNT ` 
        -Id $compilationJobId

<span data-ttu-id="7f584-207">Esses resultados de etapas em uma nova configuração de nó nomeado "ISVBoxConfig.isvbox" que está sendo colocado no servidor de pull de saudação.</span><span class="sxs-lookup"><span data-stu-id="7f584-207">These steps result in a new node configuration named “ISVBoxConfig.isvbox” being placed on hello pull server.</span></span>  <span data-ttu-id="7f584-208">nome de configuração de nó de saudação é compilado como "configurationName.nodeName".</span><span class="sxs-lookup"><span data-stu-id="7f584-208">hello node configuration name is built as “configurationName.nodeName”.</span></span>

## <a name="step-5-creating-and-maintaining-package-metadata"></a><span data-ttu-id="7f584-209">Etapa 5: criar e manter metadados de pacote</span><span class="sxs-lookup"><span data-stu-id="7f584-209">Step 5: Creating and maintaining package metadata</span></span>
<span data-ttu-id="7f584-210">Para cada pacote que você colocar em um repositório de pacotes de saudação, é necessário um nuspec que descreve a ele.</span><span class="sxs-lookup"><span data-stu-id="7f584-210">For each package that you put into hello package repository, you need a nuspec that describes it.</span></span>  <span data-ttu-id="7f584-211">Esse nuspec deve ser compilado e armazenado em seu servidor do NuGet.</span><span class="sxs-lookup"><span data-stu-id="7f584-211">That nuspec must be compiled and stored in your NuGet server.</span></span> <span data-ttu-id="7f584-212">Este processo é descrito [aqui](http://docs.nuget.org/create/creating-and-publishing-a-package).</span><span class="sxs-lookup"><span data-stu-id="7f584-212">This process is described [here](http://docs.nuget.org/create/creating-and-publishing-a-package).</span></span>  <span data-ttu-id="7f584-213">Você pode usar MyGet.org como um servidor do NuGet.</span><span class="sxs-lookup"><span data-stu-id="7f584-213">You can use MyGet.org as a NuGet server.</span></span>  <span data-ttu-id="7f584-214">Eles vendem este serviço, mas há uma SKU inicial que é gratuita.</span><span class="sxs-lookup"><span data-stu-id="7f584-214">They sell this service, but have a starter SKU that’s free.</span></span>  <span data-ttu-id="7f584-215">Em NuGet.org, você encontrará instruções sobre como instalar seu próprio servidor do NuGet para seus pacotes privados.</span><span class="sxs-lookup"><span data-stu-id="7f584-215">At NuGet.org you’ll find instructions on installing your own NuGet server for your private packages.</span></span>

## <a name="step-6-tying-it-all-together"></a><span data-ttu-id="7f584-216">Etapa 6: reunir tudo isso</span><span class="sxs-lookup"><span data-stu-id="7f584-216">Step 6: Tying it all together</span></span>
<span data-ttu-id="7f584-217">Cada vez que uma versão passa o controle de qualidade e for aprovada para implantação, Olá pacote é criado, nuspec nupkg e atualizados implantado toohello NuGet server.</span><span class="sxs-lookup"><span data-stu-id="7f584-217">Each time a version passes QA and is approved for deployment, hello package is created, nuspec and nupkg updated and deployed toohello NuGet server.</span></span>  <span data-ttu-id="7f584-218">Além disso, a configuração de saudação (etapa 4 acima) deve ser tooagree atualizada com novo número de versão hello.</span><span class="sxs-lookup"><span data-stu-id="7f584-218">In addition, hello configuration (Step 4 above) must be updated tooagree with hello new version number.</span></span>  <span data-ttu-id="7f584-219">Ele deve ser enviado do servidor de pull toohello e compilado.</span><span class="sxs-lookup"><span data-stu-id="7f584-219">It must be sent toohello pull server and compiled.</span></span>  <span data-ttu-id="7f584-220">A partir desse ponto em diante, é máquinas virtuais toohello que dependem dessa atualização da configuração toopull hello e instalá-lo.</span><span class="sxs-lookup"><span data-stu-id="7f584-220">From that point on, it's up toohello VMs that depend on that configuration toopull hello update and install it.</span></span>  <span data-ttu-id="7f584-221">Cada uma dessas atualizações é simples - apenas uma ou duas linhas do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="7f584-221">Each of these updates are simple - just a line or two of PowerShell.</span></span>  <span data-ttu-id="7f584-222">No caso de saudação do Visual Studio Team Services, algumas delas são encapsuladas em tarefas de compilação que podem ser encadeadas em uma compilação.</span><span class="sxs-lookup"><span data-stu-id="7f584-222">In hello case of Visual Studio Team Services, some of them are encapsulated in build tasks that can be chained together in a build.</span></span>  <span data-ttu-id="7f584-223">Este [artigo](https://www.visualstudio.com/en-us/docs/alm-devops-feature-index#continuous-delivery) fornece mais detalhes.</span><span class="sxs-lookup"><span data-stu-id="7f584-223">This [article](https://www.visualstudio.com/en-us/docs/alm-devops-feature-index#continuous-delivery) provides more details.</span></span>  <span data-ttu-id="7f584-224">Isso [repositório GitHub](https://github.com/Microsoft/vso-agent-tasks) detalhes Olá várias tarefas de build disponíveis.</span><span class="sxs-lookup"><span data-stu-id="7f584-224">This [GitHub repo](https://github.com/Microsoft/vso-agent-tasks) details hello various available build tasks.</span></span>

## <a name="notes"></a><span data-ttu-id="7f584-225">Observações</span><span class="sxs-lookup"><span data-stu-id="7f584-225">Notes</span></span>
<span data-ttu-id="7f584-226">Este exemplo de uso inicia com uma máquina virtual de uma imagem do Windows Server 2012 R2 genérica de saudação Galeria do Azure.</span><span class="sxs-lookup"><span data-stu-id="7f584-226">This usage example starts with a VM from a generic Windows Server 2012 R2 image from hello Azure gallery.</span></span>  <span data-ttu-id="7f584-227">Você pode iniciar a partir de qualquer imagem armazenada e, em seguida, ajustar a partir daí com configuração de DSC hello.</span><span class="sxs-lookup"><span data-stu-id="7f584-227">You can start from any stored image and then tweak from there with hello DSC configuration.</span></span>  <span data-ttu-id="7f584-228">No entanto, a alteração de configuração é baked em uma imagem é muito mais difícil do que a atualização dinâmica de configuração de saudação usando DSC.</span><span class="sxs-lookup"><span data-stu-id="7f584-228">However, changing configuration that is baked into an image is much harder than dynamically updating hello configuration using DSC.</span></span>

<span data-ttu-id="7f584-229">Você não tem toouse um modelo do ARM e toouse de extensão VM Olá essa técnica com suas VMs.</span><span class="sxs-lookup"><span data-stu-id="7f584-229">You don’t have toouse an ARM template and hello VM extension toouse this technique with your VMs.</span></span>  <span data-ttu-id="7f584-230">E suas VMs não tem toobe toobe do Azure sob gerenciamento do CD.</span><span class="sxs-lookup"><span data-stu-id="7f584-230">And your VMs don’t have toobe on Azure toobe under CD management.</span></span>  <span data-ttu-id="7f584-231">Tudo o que é necessário é que Chocolatey ser instalado e hello LCM configurado no hello VM para que ele saiba onde hello servidor de pull é.</span><span class="sxs-lookup"><span data-stu-id="7f584-231">All that’s necessary is that Chocolatey be installed and hello LCM configured on hello VM so it knows where hello pull server is.</span></span>  

<span data-ttu-id="7f584-232">É claro que, quando você atualiza um pacote em uma VM que está em produção, é necessário tootake VM da rotação enquanto Olá atualização está instalada.</span><span class="sxs-lookup"><span data-stu-id="7f584-232">Of course, when you update a package on a VM that’s in production, you need tootake that VM out of rotation while hello update is installed.</span></span>  <span data-ttu-id="7f584-233">A maneira de fazer isso varia muito.</span><span class="sxs-lookup"><span data-stu-id="7f584-233">How you do this varies widely.</span></span>  <span data-ttu-id="7f584-234">Por exemplo, com uma VM por trás de um Balanceador de Carga do Azure, você pode adicionar uma Sonda Personalizada.</span><span class="sxs-lookup"><span data-stu-id="7f584-234">For example, with a VM behind an Azure Load Balancer, you can add a Custom Probe.</span></span>  <span data-ttu-id="7f584-235">Ao atualizar Olá VM, ter ponto de extremidade de investigação de saudação retornar um 400.</span><span class="sxs-lookup"><span data-stu-id="7f584-235">While updating hello VM, have hello probe endpoint return a 400.</span></span>  <span data-ttu-id="7f584-236">Olá ajuste necessário toocause essa alteração pode ser dentro de sua configuração, que pode Olá tooswitch ajuste-o novamente tooreturning uma resposta 200 após a conclusão da atualização de saudação.</span><span class="sxs-lookup"><span data-stu-id="7f584-236">hello tweak necessary toocause this change can be inside your configuration, as can hello tweak tooswitch it back tooreturning a 200 once hello update is complete.</span></span>

<span data-ttu-id="7f584-237">O código-fonte completo deste exemplo de uso está [neste projeto do Visual Studio](https://github.com/sebastus/ARM/tree/master/CDIaaSVM) no GitHub.</span><span class="sxs-lookup"><span data-stu-id="7f584-237">Full source for this usage example is in [this Visual Studio project](https://github.com/sebastus/ARM/tree/master/CDIaaSVM) on GitHub.</span></span>

## <a name="related-articles"></a><span data-ttu-id="7f584-238">Artigos relacionados</span><span class="sxs-lookup"><span data-stu-id="7f584-238">Related Articles</span></span>
* [<span data-ttu-id="7f584-239">Visão geral da DSC da Automação do Azure</span><span class="sxs-lookup"><span data-stu-id="7f584-239">Azure Automation DSC Overview</span></span>](automation-dsc-overview.md)
* [<span data-ttu-id="7f584-240">cmdlets da DSC de Automação do Azure</span><span class="sxs-lookup"><span data-stu-id="7f584-240">Azure Automation DSC cmdlets</span></span>](https://msdn.microsoft.com/library/mt244122.aspx)
* [<span data-ttu-id="7f584-241">Máquinas de integração para o gerenciamento pelo DSC de Automação do Azure</span><span class="sxs-lookup"><span data-stu-id="7f584-241">Onboarding machines for management by Azure Automation DSC</span></span>](automation-dsc-onboarding.md)

