---
title: "Runbooks-filho na Automação do Azure | Microsoft Docs"
description: "Descreve os diferentes métodos para iniciar um runbook na Automação do Azure de outro runbook e compartilhar informações entre eles."
services: automation
documentationcenter: 
author: mgoedtel
manager: jwhit
editor: tysonn
ms.assetid: 919887b9-43e2-4c16-883c-f81807fe37db
ms.service: automation
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 02/02/2017
ms.author: magoedte;bwren
ms.openlocfilehash: a605d278dbbda9613b91007ea6a7042403a7a6ff
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="child-runbooks-in-azure-automation"></a><span data-ttu-id="bfe5e-103">Runbooks filhos na Automação do Azure</span><span class="sxs-lookup"><span data-stu-id="bfe5e-103">Child runbooks in Azure Automation</span></span>
<span data-ttu-id="bfe5e-104">É uma prática recomendada na Automação do Azure escrever runbooks reutilizáveis e modulares com uma função distinta que pode ser usada por outros runbooks.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-104">It is a best practice in Azure Automation to write reusable, modular runbooks with a discrete function that can be used by other runbooks.</span></span> <span data-ttu-id="bfe5e-105">Um runbook pai geralmente chamará um ou mais runbooks filhos para executar o recurso necessário.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-105">A parent runbook will often call one or more child runbooks to perform required functionality.</span></span> <span data-ttu-id="bfe5e-106">Há duas maneiras de chamar um runbook filho e cada uma tem diferenças marcantes que você deve compreender para que possa determinar qual será melhor para seus diferentes cenários.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-106">There are two ways to call a child runbook, and each has distinct differences that you should understand so that you can determine which will be best for your different scenarios.</span></span>

## <a name="invoking-a-child-runbook-using-inline-execution"></a><span data-ttu-id="bfe5e-107">Invocar um runbook filho usando a execução embutida</span><span class="sxs-lookup"><span data-stu-id="bfe5e-107">Invoking a child runbook using inline execution</span></span>
<span data-ttu-id="bfe5e-108">Para invocar um runbook embutido de outro runbook, use o nome do runbook e forneça valores para os parâmetros exatamente como você faria ao usar uma atividade ou um cmdlet.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-108">To invoke a runbook inline from another runbook, you use the name of the runbook and provide values for its parameters exactly like you would use an activity or cmdlet.</span></span>  <span data-ttu-id="bfe5e-109">Todos os runbooks na mesma conta de automação estão disponíveis para todos os outros para serem usados dessa maneira.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-109">All runbooks in the same Automation account are available to all others to be used in this manner.</span></span> <span data-ttu-id="bfe5e-110">O runbook pai aguardará o runbook filho concluir antes de passar para a próxima linha e nenhuma saída é retornada diretamente para o pai.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-110">The parent runbook will wait for the child runbook to complete before moving to the next line, and any output is returned directly to the parent.</span></span>

<span data-ttu-id="bfe5e-111">Quando você chama um runbook embutido, ele é executado no mesmo trabalho que o runbook pai.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-111">When you invoke a runbook inline, it runs in the same job as the parent runbook.</span></span> <span data-ttu-id="bfe5e-112">Não haverá nenhuma indicação no histórico de trabalho do runbook filho de que ele foi executado.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-112">There will be no indication in the job history of the child runbook that it ran.</span></span> <span data-ttu-id="bfe5e-113">Todas as exceções e fluxos de saída do runbook filho serão associados ao pai.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-113">Any exceptions and any stream output from the child runbook will be associated with the parent.</span></span> <span data-ttu-id="bfe5e-114">Isso resulta em menos trabalhos e torna mais fácil rastrear e solucionar problemas, já que as exceções geradas pelo runbook filho e por sua saída de fluxo são associadas ao trabalho pai.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-114">This results in fewer jobs and makes them easier to track and to troubleshoot since any exceptions thrown by the child runbook and any of its stream output are associated with the parent job.</span></span>

<span data-ttu-id="bfe5e-115">Quando um runbook é publicado, todos os runbooks filhos que ele chamar já devem ter sido publicados.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-115">When a runbook is published, any child runbooks that it calls must already be published.</span></span> <span data-ttu-id="bfe5e-116">Isso ocorre porque a Automação do Azure cria uma associação com os runbooks filhos quando um runbook é compilado.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-116">This is because Azure Automation builds an association with any child runbooks when a runbook is compiled.</span></span> <span data-ttu-id="bfe5e-117">Se não tiverem sido,o runbook pai aparecerá para publicação corretamente, mas poderá gerar uma exceção quando for iniciado.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-117">If they aren’t, the parent runbook will appear to publish properly, but will generate an exception when it’s started.</span></span> <span data-ttu-id="bfe5e-118">Se isso acontecer, você poderá republicar o runbook pai para referenciar corretamente os runbooks filhos.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-118">If this happens, you can republish the parent runbook in order to properly reference the child runbooks.</span></span> <span data-ttu-id="bfe5e-119">Você não precisa republicar o runbook pai se algum dos runbooks filhos forem alterados porque a associação terá sido criada.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-119">You do not need to republish the parent runbook if any of the child runbooks are changed because the association will have already been created.</span></span>

<span data-ttu-id="bfe5e-120">Os parâmetros de um runbook filho com chamada embutida podem ser de qualquer tipo de dados, incluindo objetos complexos, e não há nenhuma [serialização JSON](automation-starting-a-runbook.md#runbook-parameters) como quando você inicia o runbook usando o Portal de Gerenciamento do Azure ou o cmdlet Start-AzureRmAutomationRunbook.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-120">The parameters of a child runbook called inline can be any data type including complex objects, and there is no [JSON serialization](automation-starting-a-runbook.md#runbook-parameters) as there is when you start the runbook using the Azure Management Portal or with the Start-AzureRmAutomationRunbook cmdlet.</span></span>

### <a name="runbook-types"></a><span data-ttu-id="bfe5e-121">Tipos de runbook</span><span class="sxs-lookup"><span data-stu-id="bfe5e-121">Runbook types</span></span>
<span data-ttu-id="bfe5e-122">Quais tipos podem chamar um ao outro:</span><span class="sxs-lookup"><span data-stu-id="bfe5e-122">Which types can call each other:</span></span>

* <span data-ttu-id="bfe5e-123">Um [runbook do PowerShell ](automation-runbook-types.md#powershell-runbooks) e os [runbooks gráficos](automation-runbook-types.md#graphical-runbooks) podem chamar uns aos outros em linha (ambos são baseados no PowerShell).</span><span class="sxs-lookup"><span data-stu-id="bfe5e-123">A [PowerShell runbook](automation-runbook-types.md#powershell-runbooks) and [Graphical runbooks](automation-runbook-types.md#graphical-runbooks) can call each other inline (both are PowerShell based).</span></span>
* <span data-ttu-id="bfe5e-124">Um [runbook do Fluxo de Trabalho do PowerShell](automation-runbook-types.md#powershell-workflow-runbooks) e runbooks gráficos do Fluxo de Trabalho do PowerShell podem chamar uns aos outros de forma embutida (ambos são baseados no Fluxo de Trabalho do PowerShell)</span><span class="sxs-lookup"><span data-stu-id="bfe5e-124">A [PowerShell Workflow runbook](automation-runbook-types.md#powershell-workflow-runbooks) and Graphical PowerShell Workflow runbooks can call each other inline (both are PowerShell Workflow based)</span></span>
* <span data-ttu-id="bfe5e-125">Os tipos de PowerShell e os tipos de Fluxo de Trabalho do PowerShell não podem chamar uns aos outros de forma embutida e precisam usar Start-AzureRmAutomationRunbook.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-125">The PowerShell types and the PowerShell Workflow types can’t call each other inline, and must use Start-AzureRmAutomationRunbook.</span></span>

<span data-ttu-id="bfe5e-126">Quando a ordem de publicação é importante:</span><span class="sxs-lookup"><span data-stu-id="bfe5e-126">When does publish order matter:</span></span>

* <span data-ttu-id="bfe5e-127">a ordem de publicação de runbooks é importante apenas para runbooks do Fluxo de Trabalho do PowerShell e runbooks gráficos do Fluxo de Trabalho do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-127">The publish order of runbooks only matters for PowerShell Workflow and Graphical PowerShell Workflow runbooks.</span></span>

<span data-ttu-id="bfe5e-128">Quando você chama um runbook filho Gráfico ou de Fluxo de Trabalho do PowerShell usando execução embutida, você usa apenas o nome do runbook.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-128">When you call a Graphical or PowerShell Workflow child runbook using inline execution, you just use the name of the runbook.</span></span>  <span data-ttu-id="bfe5e-129">Quando você chamar um runbook filho do PowerShell, você deve precedido seu nome com *.\\*  para especificar que o script está localizado no diretório local.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-129">When you call a PowerShell child runbook, you must preceded its name with *.\\* to specify that the script is located in the local directory.</span></span> 

### <a name="example"></a><span data-ttu-id="bfe5e-130">Exemplo</span><span class="sxs-lookup"><span data-stu-id="bfe5e-130">Example</span></span>
<span data-ttu-id="bfe5e-131">O exemplo a seguir invoca um runbook filho de teste que aceita três parâmetros, um objeto complexo, um número inteiro e um valor booleano.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-131">The following example invokes a test child runbook that accepts three parameters, a complex object, an integer, and a boolean.</span></span> <span data-ttu-id="bfe5e-132">A saída do runbook filho é atribuída a uma variável.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-132">The output of the child runbook is assigned to a variable.</span></span>  <span data-ttu-id="bfe5e-133">Nesse caso, o runbook filho é um runbook de Fluxo de Trabalho do PowerShell</span><span class="sxs-lookup"><span data-stu-id="bfe5e-133">In this case, the child runbook is a PowerShell Workflow runbook</span></span>

    $vm = Get-AzureRmVM –ResourceGroupName "LabRG" –Name "MyVM"
    $output = PSWF-ChildRunbook –VM $vm –RepeatCount 2 –Restart $true

<span data-ttu-id="bfe5e-134">A seguir, temos o mesmo exemplo usando um runbook do PowerShell como o filho.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-134">Following is the same example using a PowerShell runbook as the child.</span></span>

    $vm = Get-AzureRmVM –ResourceGroupName "LabRG" –Name "MyVM"
    $output = .\PS-ChildRunbook.ps1 –VM $vm –RepeatCount 2 –Restart $true


## <a name="starting-a-child-runbook-using-cmdlet"></a><span data-ttu-id="bfe5e-135">Iniciar um runbook filho usando cmdlet</span><span class="sxs-lookup"><span data-stu-id="bfe5e-135">Starting a child runbook using cmdlet</span></span>
<span data-ttu-id="bfe5e-136">Você pode usar o cmdlet [Start-AzureRmAutomationRunbook](https://msdn.microsoft.com/library/mt603661.aspx) para iniciar um runbook, como descrito em [Para iniciar um runbook com o Windows PowerShell](automation-starting-a-runbook.md#starting-a-runbook-with-windows-powershell).</span><span class="sxs-lookup"><span data-stu-id="bfe5e-136">You can use the [Start-AzureRmAutomationRunbook](https://msdn.microsoft.com/library/mt603661.aspx) cmdlet to start a runbook as described in [To start a runbook with Windows PowerShell](automation-starting-a-runbook.md#starting-a-runbook-with-windows-powershell).</span></span> <span data-ttu-id="bfe5e-137">Há dois modos de uso para esse cmdlet.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-137">There are two modes of use for this cmdlet.</span></span>  <span data-ttu-id="bfe5e-138">Em um modo, o cmdlet retorna a ID do trabalho assim que o trabalho filho é criado para o runbook filho.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-138">In one mode, the cmdlet returns the job id as soon as the child job is created for the child runbook.</span></span>  <span data-ttu-id="bfe5e-139">No outro modo, que você habilita especificando o parâmetro **-wait** , o cmdlet aguarda até que o trabalho filho seja concluído e retorna a saída do runbook filho.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-139">In the other mode, which you enable by specifying the **-wait** parameter, the cmdlet will wait until the child job finishes and will return the output from the child runbook.</span></span>

<span data-ttu-id="bfe5e-140">O trabalho de um runbook filho iniciado com um cmdlet executará um trabalho separado do runbook pai.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-140">The job from a child runbook started with a cmdlet will run in a separate job from the parent runbook.</span></span> <span data-ttu-id="bfe5e-141">Isso resulta em mais trabalhos do que invocar o runbook embutido e torna o acompanhamento mais difícil de rastrear.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-141">This results in more jobs than invoking the runbook inline and makes them more difficult to track.</span></span> <span data-ttu-id="bfe5e-142">O pai pode iniciar vários runbooks filhos assincronamente sem esperar a conclusão de cada um.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-142">The parent can start multiple child runbooks asynchronously without waiting for each to complete.</span></span> <span data-ttu-id="bfe5e-143">Para a mesma variante de execução paralela que chama runbooks filho embutidos, o runbook pai precisaria usar a [palavra-chave paralela](automation-powershell-workflow.md#parallel-processing).</span><span class="sxs-lookup"><span data-stu-id="bfe5e-143">For that same kind of parallel execution calling the child runbooks inline, the parent runbook would need to use the [parallel keyword](automation-powershell-workflow.md#parallel-processing).</span></span>

<span data-ttu-id="bfe5e-144">Parâmetros de um runbook filho iniciados com um cmdlet são fornecidos como uma tabela de hash, conforme descrito em [Parâmetros de Runbook](automation-starting-a-runbook.md#runbook-parameters).</span><span class="sxs-lookup"><span data-stu-id="bfe5e-144">Parameters for a child runbook started with a cmdlet are provided as a hashtable as described in [Runbook Parameters](automation-starting-a-runbook.md#runbook-parameters).</span></span> <span data-ttu-id="bfe5e-145">Somente tipos de dados simples podem ser usados.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-145">Only simple data types can be used.</span></span> <span data-ttu-id="bfe5e-146">Se o runbook tiver um parâmetro com um tipo de dados complexos, ele deve ser chamado embutido.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-146">If the runbook has a parameter with a complex data type, then it must be called inline.</span></span>

### <a name="example"></a><span data-ttu-id="bfe5e-147">Exemplo</span><span class="sxs-lookup"><span data-stu-id="bfe5e-147">Example</span></span>
<span data-ttu-id="bfe5e-148">O exemplo a seguir inicia um runbook filho com parâmetros e aguarda a sua conclusão usando o parâmetro Start-AzureRmAutomationRunbook -wait.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-148">The following example starts a child runbook with parameters and then waits for it to complete using the Start-AzureRmAutomationRunbook -wait parameter.</span></span> <span data-ttu-id="bfe5e-149">Depois de concluído, sua saída é coletada do runbook filho.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-149">Once completed, its output is collected from the child runbook.</span></span>

    $params = @{"VMName"="MyVM";"RepeatCount"=2;"Restart"=$true} 
    $joboutput = Start-AzureRmAutomationRunbook –AutomationAccountName "MyAutomationAccount" –Name "Test-ChildRunbook" -ResourceGroupName "LabRG" –Parameters $params –wait


## <a name="comparison-of-methods-for-calling-a-child-runbook"></a><span data-ttu-id="bfe5e-150">Comparação de métodos para chamar um runbook filho</span><span class="sxs-lookup"><span data-stu-id="bfe5e-150">Comparison of methods for calling a child runbook</span></span>
<span data-ttu-id="bfe5e-151">A tabela a seguir resume as diferenças entre os dois métodos para chamar um runbook de outro runbook.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-151">The following table summarizes the differences between the two methods for calling a runbook from another runbook.</span></span>

|  | <span data-ttu-id="bfe5e-152">Embutido</span><span class="sxs-lookup"><span data-stu-id="bfe5e-152">Inline</span></span> | <span data-ttu-id="bfe5e-153">Cmdlet</span><span class="sxs-lookup"><span data-stu-id="bfe5e-153">Cmdlet</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="bfe5e-154">Trabalho</span><span class="sxs-lookup"><span data-stu-id="bfe5e-154">Job</span></span> |<span data-ttu-id="bfe5e-155">Os runbooks filhos são executados no mesmo trabalho que o pai.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-155">Child runbooks run in the same job as the parent.</span></span> |<span data-ttu-id="bfe5e-156">Um trabalho separado é criado para o runbook filho.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-156">A separate job is created for the child runbook.</span></span> |
| <span data-ttu-id="bfe5e-157">Execução</span><span class="sxs-lookup"><span data-stu-id="bfe5e-157">Execution</span></span> |<span data-ttu-id="bfe5e-158">O runbook pai aguarda a conclusão do runbook filho antes de continuar.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-158">Parent runbook waits for the child runbook to complete before continuing.</span></span> |<span data-ttu-id="bfe5e-159">O runbook pai continua imediatamente após o runbook filho ser iniciado *ou* o runbook pai aguarda a conclusão do trabalho filho.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-159">Parent runbook continues immediately after child runbook is started *or* parent runbook waits for the child job to finish.</span></span> |
| <span data-ttu-id="bfe5e-160">Saída</span><span class="sxs-lookup"><span data-stu-id="bfe5e-160">Output</span></span> |<span data-ttu-id="bfe5e-161">O runbook pai pode obter saída diretamente do runbook filho.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-161">Parent runbook can directly get output from child runbook.</span></span> |<span data-ttu-id="bfe5e-162">O runbook pai deve recuperar a saída do trabalho do runbook filho *ou* o runbook pai pode obter a saída diretamente do runbook filho.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-162">Parent runbook must retrieve output from child runbook job *or* parent runbook can directly get output from child runbook.</span></span> |
| <span data-ttu-id="bfe5e-163">Parâmetros</span><span class="sxs-lookup"><span data-stu-id="bfe5e-163">Parameters</span></span> |<span data-ttu-id="bfe5e-164">Os valores para os parâmetros de runbook filho são especificados separadamente e podem usar qualquer tipo de dados.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-164">Values for the child runbook parameters are specified separately and can use any data type.</span></span> |<span data-ttu-id="bfe5e-165">Os valores para os parâmetros de runbook filho devem ser combinados em uma única tabela de hash e somente podem tipos de dados simples, de matriz e de objeto que aproveitem a serialização JSON.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-165">Values for the child runbook parameters must be combined into a single hashtable and can only include simple, array, and object data types that leverage JSON serialization.</span></span> |
| <span data-ttu-id="bfe5e-166">Conta de Automação</span><span class="sxs-lookup"><span data-stu-id="bfe5e-166">Automation Account</span></span> |<span data-ttu-id="bfe5e-167">O runbook pai somente pode usar o runbook filho na mesma conta de automação.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-167">Parent runbook can only use child runbook in the same automation account.</span></span> |<span data-ttu-id="bfe5e-168">O runbook pai pode usar runbook filho de qualquer conta de automação da mesma assinatura do Azure e até mesmo de uma assinatura diferente se você tiver uma conexão com ele.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-168">Parent runbook can use child runbook from any automation account from the same Azure subscription and even a different subscription if you have a connection to it.</span></span> |
| <span data-ttu-id="bfe5e-169">Publicação</span><span class="sxs-lookup"><span data-stu-id="bfe5e-169">Publishing</span></span> |<span data-ttu-id="bfe5e-170">O runbook filho deve ser publicado antes da publicação do runbook pai.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-170">Child runbook must be published before parent runbook is published.</span></span> |<span data-ttu-id="bfe5e-171">O runbook filho deve ser publicado antes da inicialização do runbook pai.</span><span class="sxs-lookup"><span data-stu-id="bfe5e-171">Child runbook must be published any time before parent runbook is started.</span></span> |

## <a name="next-steps"></a><span data-ttu-id="bfe5e-172">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="bfe5e-172">Next steps</span></span>
* [<span data-ttu-id="bfe5e-173">Como iniciar um Runbook na Automação do Azure</span><span class="sxs-lookup"><span data-stu-id="bfe5e-173">Starting a runbook in Azure Automation</span></span>](automation-starting-a-runbook.md)
* [<span data-ttu-id="bfe5e-174">Saída de runbook e mensagens na Automação do Azure</span><span class="sxs-lookup"><span data-stu-id="bfe5e-174">Runbook output and messages in Azure Automation</span></span>](automation-runbook-output-and-messages.md)

