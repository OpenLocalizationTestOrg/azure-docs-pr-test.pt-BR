---
title: "Tratamento de erros em runbooks gráficos na Automação do Azure | Microsoft Docs"
description: "Este artigo descreve como implementar a lógica de tratamento de erros em runbooks gráficos na Automação do Azure."
services: automation
documentationcenter: 
author: mgoedtel
manager: jwhit
editor: tysonn
ms.assetid: 
ms.service: automation
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 12/26/2016
ms.author: magoedte
ms.openlocfilehash: 12313f7f245d32c33882f1036f7d4b48bfb3ddc5
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="error-handling-in-azure-automation-graphical-runbooks"></a><span data-ttu-id="c8bcc-103">Tratamento de erros em runbooks gráficos na Automação do Azure</span><span class="sxs-lookup"><span data-stu-id="c8bcc-103">Error handling in Azure Automation graphical runbooks</span></span>

<span data-ttu-id="c8bcc-104">Um objeto de design runbook chave a considerar é identificar problemas diferentes que pode ter um runbook.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-104">A key runbook design principal to consider is identifying different issues that a runbook might experience.</span></span> <span data-ttu-id="c8bcc-105">Esses problemas podem incluir sucesso, estados de erro esperado e as condições de erro inesperado.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-105">These issues can include success, expected error states, and unexpected error conditions.</span></span>

<span data-ttu-id="c8bcc-106">Runbooks deve incluir o tratamento de erros.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-106">Runbooks should include error handling.</span></span> <span data-ttu-id="c8bcc-107">Para validar a saída de uma atividade ou manipular um erro com runbooks gráficos, você pode usar uma atividade de código do Windows PowerShell, definem lógica condicional no link de saída da atividade ou aplicar outro método.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-107">To validate the output of an activity or handle an error with graphical runbooks, you could use a Windows PowerShell code activity, define conditional logic on the output link of the activity, or apply another method.</span></span>          

<span data-ttu-id="c8bcc-108">Geralmente, se houver um erro não fatal que ocorre com uma atividade de runbook, qualquer atividade que segue é processada, independentemente do erro.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-108">Often, if there is a non-terminating error that occurs with a runbook activity, any activity that follows is processed regardless of the error.</span></span> <span data-ttu-id="c8bcc-109">O erro é provavelmente gerar uma exceção, mas a próxima atividade ainda pode ser executado.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-109">The error is likely to generate an exception, but the next activity is still allowed to run.</span></span> <span data-ttu-id="c8bcc-110">Essa é a maneira que o PowerShell foi projetado para lidar com erros.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-110">This is the way that PowerShell is designed to handle errors.</span></span>    

<span data-ttu-id="c8bcc-111">Os tipos de erros do PowerShell que podem ocorrer durante a execução são de finalização ou não fatais.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-111">The types of PowerShell errors that can occur during execution are terminating or non-terminating.</span></span> <span data-ttu-id="c8bcc-112">As diferenças entre os erros de finalização e finalização não são da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="c8bcc-112">The differences between terminating and non-terminating errors are as follows:</span></span>

* <span data-ttu-id="c8bcc-113">**Erro de finalização**: um erro grave durante a execução que interrompe o comando (ou a execução do script) completamente.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-113">**Terminating error**: A serious error during execution that halts the command (or script execution) completely.</span></span> <span data-ttu-id="c8bcc-114">Os exemplos incluem cmdlets inexistentes, erros de sintaxe que impedem a execução de um cmdlet ou outros erros fatais.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-114">Examples include non-existent cmdlets, syntax errors that prevent a cmdlet from running, or other fatal errors.</span></span>

* <span data-ttu-id="c8bcc-115">**Erro não fatal**: um erro não grave que permite que a execução continue, apesar da falha.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-115">**Non-terminating error**: A non-serious error that allows execution to continue despite the failure.</span></span> <span data-ttu-id="c8bcc-116">Os exemplos incluem erros operacionais como erros de arquivo não encontrado e problemas de permissões.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-116">Examples include operational errors such as file not found errors and permissions problems.</span></span>

<span data-ttu-id="c8bcc-117">Runbooks gráficos de automação do Azure foram aprimorados com a possibilidade de incluir o tratamento de erros.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-117">Azure Automation graphical runbooks have been improved with the capability to include error handling.</span></span> <span data-ttu-id="c8bcc-118">Agora você pode ativar exceções em erros de não finalização e criar links de erro entre atividades.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-118">You can now turn exceptions into non-terminating errors and create error links between activities.</span></span> <span data-ttu-id="c8bcc-119">Esse processo permite que um autor de runbook capture erros e gerencie condições percebidas ou inesperadas.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-119">This process allows a runbook author to catch errors and manage realized or unexpected conditions.</span></span>  

## <a name="when-to-use-error-handling"></a><span data-ttu-id="c8bcc-120">Quando usar o tratamento de erros</span><span class="sxs-lookup"><span data-stu-id="c8bcc-120">When to use error handling</span></span>

<span data-ttu-id="c8bcc-121">Sempre que houver uma atividade essencial que gera um erro ou exceção, é importante para evitar a próxima atividade no runbook do processamento e tratar o erro adequadamente.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-121">Whenever there is a critical activity that throws an error or exception, it's important to prevent the next activity in your runbook from processing and to handle the error appropriately.</span></span> <span data-ttu-id="c8bcc-122">Isso é particularmente crítico quando seus runbooks dão suporte a uma empresa ou a um processo de operações de serviço.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-122">This is especially critical when your runbooks are supporting a business or service operations process.</span></span>

<span data-ttu-id="c8bcc-123">Para cada atividade que pode produzir um erro, o autor do runbook pode adicionar um link de erro apontando para qualquer outra atividade.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-123">For each activity that can produce an error, the runbook author can add an error link pointing to any other activity.</span></span>  <span data-ttu-id="c8bcc-124">A atividade de destino pode ser de qualquer tipo, incluindo atividades de código, invocação de um cmdlet, chamada de outro runbook e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-124">The destination activity can be of any type, including code activities, invoking a cmdlet, invoking another runbook, and so on.</span></span>

<span data-ttu-id="c8bcc-125">Além disso, a atividade de destino também pode ter links de saída.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-125">In addition, the destination activity can also have outgoing links.</span></span> <span data-ttu-id="c8bcc-126">Esses links são links regulares ou erro.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-126">These links can be regular links or error links.</span></span> <span data-ttu-id="c8bcc-127">Isso significa que o autor de runbook pode implementar a lógica de tratamento de erros complexa sem recorrer a uma atividade de código.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-127">This means the runbook author can implement complex error-handling logic without resorting to a code activity.</span></span> <span data-ttu-id="c8bcc-128">A prática recomendada é criar um runbook dedicado de tratamento de erros com funcionalidade comum, mas não é obrigatório.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-128">The recommended practice is to create a dedicated error-handling runbook with common functionality, but it's not mandatory.</span></span> <span data-ttu-id="c8bcc-129">Atividade não é a única opção de código de lógica de tratamento de erros no PowerShell.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-129">Error-handling logic in a PowerShell code activity it isn't the only option.</span></span>  

<span data-ttu-id="c8bcc-130">Por exemplo, considere um runbook que tenta iniciar uma VM e instalar um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-130">For example, consider a runbook that tries to start a VM and install an application on it.</span></span> <span data-ttu-id="c8bcc-131">Se a máquina virtual não iniciar corretamente, ele executa duas ações:</span><span class="sxs-lookup"><span data-stu-id="c8bcc-131">If the VM doesn't start correctly, it performs two actions:</span></span>

1. <span data-ttu-id="c8bcc-132">Ele envia uma notificação sobre esse problema.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-132">It sends a notification about this problem.</span></span>
2. <span data-ttu-id="c8bcc-133">Ele inicia outro runbook que provisiona automaticamente uma nova VM em vez disso.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-133">It starts another runbook that automatically provisions a new VM instead.</span></span>

<span data-ttu-id="c8bcc-134">Uma solução é ter um link de erro apontando para uma atividade que alças etapa um.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-134">One solution is to have an error link pointing to an activity that handles step one.</span></span> <span data-ttu-id="c8bcc-135">Por exemplo, você pode conectar o **Write-Warning** cmdlet para uma atividade para a etapa 2, como o **AzureRmAutomationRunbook início** cmdlet.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-135">For example, you could connect the **Write-Warning** cmdlet to an activity for step two, such as the **Start-AzureRmAutomationRunbook** cmdlet.</span></span>

<span data-ttu-id="c8bcc-136">Você também pode generalizar esse comportamento para uso em vários runbooks ao colocar essas duas atividades em um runbook de tratamento de erros separado e seguir as orientações sugeridas anteriormente.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-136">You could also generalize this behavior for use in many runbooks by putting these two activities in a separate error handling runbook and following the guidance suggested earlier.</span></span> <span data-ttu-id="c8bcc-137">Antes de chamar esse runbook de tratamento de erros, você pode criar uma mensagem personalizada com base nos dados no runbook original e, em seguida, passá-la como um parâmetro para o runbook de tratamento de erros.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-137">Before calling this error-handling runbook, you could construct a custom message from the data in the original runbook, and then pass it as a parameter to the error-handling runbook.</span></span>

## <a name="how-to-use-error-handling"></a><span data-ttu-id="c8bcc-138">Como usar o tratamento de erros</span><span class="sxs-lookup"><span data-stu-id="c8bcc-138">How to use error handling</span></span>

<span data-ttu-id="c8bcc-139">Cada atividade tem um parâmetro de configuração que transforma exceções em erros de não finalização.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-139">Each activity has a configuration setting that turns exceptions into non-terminating errors.</span></span> <span data-ttu-id="c8bcc-140">Por padrão, essa configuração é desabilitada.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-140">By default, this setting is disabled.</span></span> <span data-ttu-id="c8bcc-141">Recomendamos que você habilite essa configuração em qualquer atividade em que você deseja manipular erros.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-141">We recommend that you enable this setting on any activity where you want to handle errors.</span></span>  

<span data-ttu-id="c8bcc-142">Habilitando a configuração, você garante que erros de não finalização e finalização na atividade sejam tratados como erros de não finalização e possam ser manipulados com um link de erro.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-142">By enabling this configuration, you are assuring that both terminating and non-terminating errors in the activity are handled as non-terminating errors, and can be handled with an error link.</span></span>  

<span data-ttu-id="c8bcc-143">Depois de definir essa configuração, você cria uma atividade que manipulará o erro.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-143">After configuring this setting, you create an activity that handles the error.</span></span> <span data-ttu-id="c8bcc-144">Se uma atividade produzir erros, os links de saída de erro serão seguidos e os links regulares não o serão, mesmo que uma atividade também produza saída regular.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-144">If an activity produces any error, then the outgoing error links are followed, and the regular links are not, even if the activity produces regular output as well.</span></span><br><br> ![Exemplo de link de erro de runbook de automação](media/automation-runbook-graphical-error-handling/error-link-example.png)

<span data-ttu-id="c8bcc-146">No exemplo a seguir, um runbook recupera uma variável que contém o nome do computador de uma máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-146">In the following example, a runbook retrieves a variable that contains the computer name of a virtual machine.</span></span> <span data-ttu-id="c8bcc-147">Em seguida, ele tenta iniciar a máquina virtual com a próxima atividade.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-147">It then attempts to start the virtual machine with the next activity.</span></span><br><br> ![Exemplo de tratamento de erro de runbook de automação](media/automation-runbook-graphical-error-handling/runbook-example-error-handling.png)<br><br>      

<span data-ttu-id="c8bcc-149">A atividade **Get-AutomationVariable** e **Start-AzureRmVm** são configurados para converter exceções em erros.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-149">The **Get-AutomationVariable** activity and **Start-AzureRmVm** are configured to convert exceptions to errors.</span></span>  <span data-ttu-id="c8bcc-150">Se houver problemas ao obter a variável ou iniciar a VM, serão gerados erros.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-150">If there are problems getting the variable or starting the VM, then errors are generated.</span></span><br><br> <span data-ttu-id="c8bcc-151">![Configurações de atividade de tratamento de erros de runbook de automação](media/automation-runbook-graphical-error-handling/activity-blade-convertexception-option.png)</span><span class="sxs-lookup"><span data-stu-id="c8bcc-151">![Automation runbook error-handling activity settings](media/automation-runbook-graphical-error-handling/activity-blade-convertexception-option.png)</span></span>

<span data-ttu-id="c8bcc-152">Links de erro de fluxo dessas atividades em uma única **gerenciamento erro** atividade (uma atividade code).</span><span class="sxs-lookup"><span data-stu-id="c8bcc-152">Error links flow from these activities to a single **error management** activity (a code activity).</span></span> <span data-ttu-id="c8bcc-153">Essa atividade é configurada com uma expressão simple do PowerShell que usa o *lançar* palavra-chave para parar o processamento, juntamente com *$Error.Exception.Message* para obter a mensagem que descreve a exceção atual.</span><span class="sxs-lookup"><span data-stu-id="c8bcc-153">This activity is configured with a simple PowerShell expression that uses the *Throw* keyword to stop processing, along with *$Error.Exception.Message* to get the message that describes the current exception.</span></span><br><br> <span data-ttu-id="c8bcc-154">![Exemplo de código de tratamento de erros de runbook de automação](media/automation-runbook-graphical-error-handling/runbook-example-error-handling-code.png)</span><span class="sxs-lookup"><span data-stu-id="c8bcc-154">![Automation runbook error-handling code example](media/automation-runbook-graphical-error-handling/runbook-example-error-handling-code.png)</span></span>


## <a name="next-steps"></a><span data-ttu-id="c8bcc-155">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="c8bcc-155">Next steps</span></span>

* <span data-ttu-id="c8bcc-156">Para saber mais sobre links e tipos de link em runbooks gráficos, confira [Criação gráfica na Automação do Azure](automation-graphical-authoring-intro.md#links-and-workflow).</span><span class="sxs-lookup"><span data-stu-id="c8bcc-156">To learn more about links and link types in graphical runbooks, see [Graphical authoring in Azure Automation](automation-graphical-authoring-intro.md#links-and-workflow).</span></span>

* <span data-ttu-id="c8bcc-157">Para saber mais sobre a execução de runbooks, como monitorar trabalhos de runbook e outros detalhes técnicos, confira [Acompanhar um trabalho de runbook](automation-runbook-execution.md).</span><span class="sxs-lookup"><span data-stu-id="c8bcc-157">To learn more about runbook execution, how to monitor runbook jobs, and other technical details, see [Track a runbook job](automation-runbook-execution.md).</span></span>
