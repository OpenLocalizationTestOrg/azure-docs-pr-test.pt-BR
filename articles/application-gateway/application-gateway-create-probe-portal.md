---
title: "Criar uma investigação personalizada - Gateway de Aplicativo do Azure - Portal do Azure | Microsoft Docs"
description: "Saiba como criar uma investigação personalizada para o Gateway de Aplicativo usando o portal"
services: application-gateway
documentationcenter: na
author: georgewallace
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 33fd5564-43a7-4c54-a9ec-b1235f661f97
ms.service: application-gateway
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/26/2017
ms.author: gwallace
ms.openlocfilehash: 65e9bba4ce9ac41ae2a9a8c3fa7f661165fc1403
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/03/2017
---
# <a name="create-a-custom-probe-for-application-gateway-by-using-the-portal"></a><span data-ttu-id="46f37-103">Criar uma investigação personalizada para o Gateway de Aplicativo usando o portal</span><span class="sxs-lookup"><span data-stu-id="46f37-103">Create a custom probe for Application Gateway by using the portal</span></span>

> [!div class="op_single_selector"]
> * [<span data-ttu-id="46f37-104">Portal do Azure</span><span class="sxs-lookup"><span data-stu-id="46f37-104">Azure portal</span></span>](application-gateway-create-probe-portal.md)
> * [<span data-ttu-id="46f37-105">PowerShell do Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="46f37-105">Azure Resource Manager PowerShell</span></span>](application-gateway-create-probe-ps.md)
> * [<span data-ttu-id="46f37-106">Azure Classic PowerShell</span><span class="sxs-lookup"><span data-stu-id="46f37-106">Azure Classic PowerShell</span></span>](application-gateway-create-probe-classic-ps.md)

<span data-ttu-id="46f37-107">Neste artigo, você adiciona uma investigação personalizada a um gateway de aplicativo existente por meio do portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="46f37-107">In this article, you add a custom probe to an existing application gateway through the Azure portal.</span></span> <span data-ttu-id="46f37-108">As investigações personalizadas são úteis para aplicativos que tenham uma página de verificação de integridade específica ou para aplicativos que não forneçam uma resposta bem-sucedida no aplicativo Web padrão.</span><span class="sxs-lookup"><span data-stu-id="46f37-108">Custom probes are useful for applications that have a specific health check page or for applications that do not provide a successful response on the default web application.</span></span>

## <a name="before-you-begin"></a><span data-ttu-id="46f37-109">Antes de começar</span><span class="sxs-lookup"><span data-stu-id="46f37-109">Before you begin</span></span>

<span data-ttu-id="46f37-110">Se você ainda não tiver um gateway de aplicativo, visite [Criar um Gateway de Aplicativo](application-gateway-create-gateway-portal.md) a fim de criar um gateway de aplicativo para trabalhar.</span><span class="sxs-lookup"><span data-stu-id="46f37-110">If you do not already have an application gateway, visit [Create an Application Gateway](application-gateway-create-gateway-portal.md) to create an application gateway to work with.</span></span>

## <span data-ttu-id="46f37-111"><a name="createprobe"></a>Criar a investigação</span><span class="sxs-lookup"><span data-stu-id="46f37-111"><a name="createprobe"></a>Create the probe</span></span>

<span data-ttu-id="46f37-112">As investigações são configuradas em um processo de duas etapas pelo portal.</span><span class="sxs-lookup"><span data-stu-id="46f37-112">Probes are configured in a two-step process through the portal.</span></span> <span data-ttu-id="46f37-113">A primeira etapa é criar a investigação.</span><span class="sxs-lookup"><span data-stu-id="46f37-113">The first step is to create the probe.</span></span> <span data-ttu-id="46f37-114">Na segunda etapa, você adiciona a investigação às configurações de HTTP do back-end do Gateway de Aplicativo.</span><span class="sxs-lookup"><span data-stu-id="46f37-114">In the second step, you add the probe to the backend http settings of the application gateway.</span></span>

1. <span data-ttu-id="46f37-115">Faça logon no [Portal do Azure](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="46f37-115">Log in to the [Azure portal](https://portal.azure.com).</span></span> <span data-ttu-id="46f37-116">Caso ainda não tenha uma conta, você pode se inscrever para obter uma [avaliação gratuita por um mês](https://azure.microsoft.com/free).</span><span class="sxs-lookup"><span data-stu-id="46f37-116">If you don't already have an account, you can sign up for a [free one-month trial](https://azure.microsoft.com/free)</span></span>

1. <span data-ttu-id="46f37-117">No painel Favoritos do portal do Azure, clique em Todos os recursos.</span><span class="sxs-lookup"><span data-stu-id="46f37-117">In the Azure portal Favorites pane, click All resources.</span></span> <span data-ttu-id="46f37-118">Clique no gateway de aplicativo na folha Todos os recursos.</span><span class="sxs-lookup"><span data-stu-id="46f37-118">Click the application gateway in the All resources blade.</span></span> <span data-ttu-id="46f37-119">Se a assinatura que você selecionou já contém vários recursos, você pode inserir partners.contoso.net na caixa Filtrar por nome...</span><span class="sxs-lookup"><span data-stu-id="46f37-119">If the subscription you selected already has several resources in it, you can enter partners.contoso.net in the Filter by name…</span></span> <span data-ttu-id="46f37-120">para acessar facilmente o gateway de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="46f37-120">box to easily access the application gateway.</span></span>

1. <span data-ttu-id="46f37-121">Clique em **Investigações** e clique no botão **Adicionar** para adicionar uma investigação.</span><span class="sxs-lookup"><span data-stu-id="46f37-121">Click **Probes** and click the **Add** button to add a probe.</span></span>

  ![Folha Adicionar Investigação com as informações preenchidas][1]

1. <span data-ttu-id="46f37-123">Na folha **Adicionar investigação de integridade**, preencha as informações necessárias para a investigação e ao concluir, clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="46f37-123">On the **Add health probe** blade, fill out the required information for the probe, and when complete click **OK**.</span></span>

  |<span data-ttu-id="46f37-124">**Configuração**</span><span class="sxs-lookup"><span data-stu-id="46f37-124">**Setting**</span></span> | <span data-ttu-id="46f37-125">**Valor**</span><span class="sxs-lookup"><span data-stu-id="46f37-125">**Value**</span></span> | <span data-ttu-id="46f37-126">**Detalhes**</span><span class="sxs-lookup"><span data-stu-id="46f37-126">**Details**</span></span>|
  |---|---|---|
  |<span data-ttu-id="46f37-127">**Nome**</span><span class="sxs-lookup"><span data-stu-id="46f37-127">**Name**</span></span>|<span data-ttu-id="46f37-128">customProbe</span><span class="sxs-lookup"><span data-stu-id="46f37-128">customProbe</span></span>|<span data-ttu-id="46f37-129">Este valor é um nome amigável para a investigação que está acessível no portal.</span><span class="sxs-lookup"><span data-stu-id="46f37-129">This value is a friendly name to the probe that is accessible in the portal.</span></span>|
  |<span data-ttu-id="46f37-130">**Protocolo**</span><span class="sxs-lookup"><span data-stu-id="46f37-130">**Protocol**</span></span>|<span data-ttu-id="46f37-131">HTTP ou HTTPS</span><span class="sxs-lookup"><span data-stu-id="46f37-131">HTTP or HTTPS</span></span> | <span data-ttu-id="46f37-132">O protocolo que a investigação de integridade usa.</span><span class="sxs-lookup"><span data-stu-id="46f37-132">The protocol that the health probe uses.</span></span>|
  |<span data-ttu-id="46f37-133">**Host**</span><span class="sxs-lookup"><span data-stu-id="46f37-133">**Host**</span></span>|<span data-ttu-id="46f37-134">ou seja</span><span class="sxs-lookup"><span data-stu-id="46f37-134">i.e</span></span> <span data-ttu-id="46f37-135">contoso.com</span><span class="sxs-lookup"><span data-stu-id="46f37-135">contoso.com</span></span>|<span data-ttu-id="46f37-136">Este valor é o nome do host usado para a investigação.</span><span class="sxs-lookup"><span data-stu-id="46f37-136">This value is the host name that is used for the probe.</span></span> <span data-ttu-id="46f37-137">Aplicável somente quando vários sites são configurados no Gateway de Aplicativo; do contrário, use '127.0.0.1'.</span><span class="sxs-lookup"><span data-stu-id="46f37-137">Applicable only when multi-site is configured on Application Gateway, otherwise use '127.0.0.1'.</span></span> <span data-ttu-id="46f37-138">Este valor é diferente do nome do host de VM.</span><span class="sxs-lookup"><span data-stu-id="46f37-138">This value is different from the VM host name.</span></span>|
  |<span data-ttu-id="46f37-139">**Caminho**</span><span class="sxs-lookup"><span data-stu-id="46f37-139">**Path**</span></span>|<span data-ttu-id="46f37-140">/ ou outro caminho</span><span class="sxs-lookup"><span data-stu-id="46f37-140">/ or another path</span></span>|<span data-ttu-id="46f37-141">O restante da URL completa para a investigação personalizada.</span><span class="sxs-lookup"><span data-stu-id="46f37-141">The remainder of the full url for the custom probe.</span></span> <span data-ttu-id="46f37-142">Um caminho válido começa com "/".</span><span class="sxs-lookup"><span data-stu-id="46f37-142">A valid path starts with '/'.</span></span> <span data-ttu-id="46f37-143">Para o caminho padrão de http://contoso.com use apenas '/'</span><span class="sxs-lookup"><span data-stu-id="46f37-143">For the default path of http://contoso.com just use '/'</span></span> |
  |<span data-ttu-id="46f37-144">**Intervalo (segundos)**</span><span class="sxs-lookup"><span data-stu-id="46f37-144">**Interval (secs)**</span></span>|<span data-ttu-id="46f37-145">30</span><span class="sxs-lookup"><span data-stu-id="46f37-145">30</span></span>|<span data-ttu-id="46f37-146">Frequência com que a investigação é executada para verificar a integridade.</span><span class="sxs-lookup"><span data-stu-id="46f37-146">How often the probe is run to check for health.</span></span> <span data-ttu-id="46f37-147">Não é recomendável defini-la abaixo de 30 segundos.</span><span class="sxs-lookup"><span data-stu-id="46f37-147">It is not recommended to set the lower than 30 seconds.</span></span>|
  |<span data-ttu-id="46f37-148">**Tempo limite (segundos)**</span><span class="sxs-lookup"><span data-stu-id="46f37-148">**Timeout (secs)**</span></span>|<span data-ttu-id="46f37-149">30</span><span class="sxs-lookup"><span data-stu-id="46f37-149">30</span></span>|<span data-ttu-id="46f37-150">A quantidade de tempo que a investigação espera antes de atingir o tempo limite.</span><span class="sxs-lookup"><span data-stu-id="46f37-150">The amount of time the probe waits before timing out.</span></span> <span data-ttu-id="46f37-151">O intervalo de tempo limite deve ser alto o suficiente para que uma chamada http possa ser feita a fim de garantir que a página de integridade do back-end estará disponível.</span><span class="sxs-lookup"><span data-stu-id="46f37-151">The timeout interval needs to be high enough that an http call can be made to ensure the backend health page is available.</span></span>|
  |<span data-ttu-id="46f37-152">**Limite não íntegro**</span><span class="sxs-lookup"><span data-stu-id="46f37-152">**Unhealthy threshold**</span></span>|<span data-ttu-id="46f37-153">3</span><span class="sxs-lookup"><span data-stu-id="46f37-153">3</span></span>|<span data-ttu-id="46f37-154">Número de tentativas com falha para ser considerado não íntegro.</span><span class="sxs-lookup"><span data-stu-id="46f37-154">Number of failed attempts to be considered unhealthy.</span></span> <span data-ttu-id="46f37-155">Um limite de 0 significa que, em caso de falha de verificação de integridade, o back-end é considerado não íntegro imediatamente.</span><span class="sxs-lookup"><span data-stu-id="46f37-155">A threshold of 0 means that if a health check fails the back-end is determined unhealthy immediately.</span></span>|

  > [!IMPORTANT]
  > <span data-ttu-id="46f37-156">O nome do host não é o mesmo que o nome do servidor.</span><span class="sxs-lookup"><span data-stu-id="46f37-156">The host name is not the same as server name.</span></span> <span data-ttu-id="46f37-157">Esse valor é o nome do host virtual em execução no servidor de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="46f37-157">This value is the name of the virtual host running on the application server.</span></span> <span data-ttu-id="46f37-158">A investigação é enviada para http://(nome do host):(porta de httpsetting)/urlPath</span><span class="sxs-lookup"><span data-stu-id="46f37-158">The probe is sent to http://(host name):(port from httpsetting)/urlPath</span></span>

## <a name="add-probe-to-the-gateway"></a><span data-ttu-id="46f37-159">Adicionar a investigação ao gateway</span><span class="sxs-lookup"><span data-stu-id="46f37-159">Add probe to the gateway</span></span>

<span data-ttu-id="46f37-160">Agora que a investigação foi criada, é hora de adicioná-la ao gateway.</span><span class="sxs-lookup"><span data-stu-id="46f37-160">Now that the probe has been created, it is time to add it to the gateway.</span></span> <span data-ttu-id="46f37-161">As configurações da investigação são definidas nas configurações de http do back-end do Gateway de Aplicativo.</span><span class="sxs-lookup"><span data-stu-id="46f37-161">Probe settings are set on the backend http settings of the application gateway.</span></span>

1. <span data-ttu-id="46f37-162">Clique em **Configurações de HTTP** do Gateway de Aplicativo e clique nas configurações de HTTP do back-end atual listadas na janela para abrir a folha de configuração.</span><span class="sxs-lookup"><span data-stu-id="46f37-162">Click **HTTP settings** on the application gateway, to bring up the configuration blade click the current backend http settings listed in the window.</span></span>

  ![janela de configurações de https][2]

1. <span data-ttu-id="46f37-164">Na folha de configuração **appGatewayBackEndHttp**, marque a caixa de seleção **Usar investigação personalizada** e selecione a investigação criada na seção [Criar a investigação](#createprobe) do menu suspenso **Investigação personalizada**.</span><span class="sxs-lookup"><span data-stu-id="46f37-164">On the **appGatewayBackEndHttpSettings** settings blade, check the **Use custom probe** checkbox and choose the probe created in the [Create the probe](#createprobe) section on the **Custom probe** drop-down..</span></span>
<span data-ttu-id="46f37-165">Ao concluir, clique em **Salvar** e as configurações são aplicadas.</span><span class="sxs-lookup"><span data-stu-id="46f37-165">When complete, click **Save** and the settings are applied.</span></span>

<span data-ttu-id="46f37-166">A investigação de padrão verifica o acesso padrão ao aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="46f37-166">The default probe checks the default access to the web application.</span></span> <span data-ttu-id="46f37-167">Agora que uma investigação personalizada foi criada, o gateway de aplicativo usa o caminho personalizado definido para monitorar a integridade dos servidores back-end selecionados.</span><span class="sxs-lookup"><span data-stu-id="46f37-167">Now that a custom probe has been created, the application gateway uses the custom path defined to monitor health for the backend servers.</span></span> <span data-ttu-id="46f37-168">Com base nos critérios definidos, o Gateway de Aplicativo verifica o caminho especificado na investigação.</span><span class="sxs-lookup"><span data-stu-id="46f37-168">Based on the criteria that was defined, the application gateway checks the path specified in the probe.</span></span> <span data-ttu-id="46f37-169">Se a chamada para host:Porta/caminho não retornar uma resposta de status HTTP 200-399, o servidor será retirado da rotação após o limite não íntegro ser atingido.</span><span class="sxs-lookup"><span data-stu-id="46f37-169">If the call to host:Port/path does not return an HTTP 200-399 status response, the server is taken out of rotation after the unhealthy threshold is reached.</span></span> <span data-ttu-id="46f37-170">A investigação continua na instância não íntegra para determinar quando ela se torna íntegra novamente.</span><span class="sxs-lookup"><span data-stu-id="46f37-170">Probing continues on the unhealthy instance to determine when it becomes healthy again.</span></span> <span data-ttu-id="46f37-171">Após a instância ser adicionada novamente ao pool de servidores íntegros, o tráfego começa a fluir para ela novamente e a investigação da instância continua normalmente no intervalo especificado pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="46f37-171">Once the instance is added back to healthy server pool, traffic begins flowing to it again and probing to the instance continues at user specified interval as normal.</span></span>

## <a name="next-steps"></a><span data-ttu-id="46f37-172">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="46f37-172">Next steps</span></span>

<span data-ttu-id="46f37-173">Para saber como configurar o descarregamento SSL com o Gateway de Aplicativo do Azure, veja [Configurar descarregamento SSL](application-gateway-ssl-portal.md)</span><span class="sxs-lookup"><span data-stu-id="46f37-173">To learn how to configure SSL Offloading with Azure Application Gateway, see [Configure SSL Offload](application-gateway-ssl-portal.md)</span></span>

[1]: ./media/application-gateway-create-probe-portal/figure1.png
[2]: ./media/application-gateway-create-probe-portal/figure2.png

