---
title: "Visão geral do monitoramento de integridade do Gateway de Aplicativo do Azure | Microsoft Docs"
description: Saiba mais sobre os recursos de monitoramento do Application Gateway do Azure
services: application-gateway
documentationcenter: na
author: georgewallace
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 7eeba328-bb2d-4d3e-bdac-7552e7900b7f
ms.service: application-gateway
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 12/14/2016
ms.author: gwallace
ms.openlocfilehash: 899115d213e626f17e58c2e5f01313f760f9e7f4
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="application-gateway-health-monitoring-overview"></a><span data-ttu-id="3f49e-103">Visão geral do monitoramento de integridade do Gateway de Aplicativo</span><span class="sxs-lookup"><span data-stu-id="3f49e-103">Application Gateway health monitoring overview</span></span>

<span data-ttu-id="3f49e-104">Por padrão, o Gateway de Aplicativo do Azure monitora a integridade de todos os recursos em seu pool de back-end e remove automaticamente qualquer recurso do pool que não for considerado íntegro.</span><span class="sxs-lookup"><span data-stu-id="3f49e-104">Azure Application Gateway by default monitors the health of all resources in its back-end pool and automatically removes any resource considered unhealthy from the pool.</span></span> <span data-ttu-id="3f49e-105">O Gateway de Aplicativo continua monitorando as instâncias não íntegras e as adiciona de volta ao pool de back-end íntegro depois que elas se tornarem disponíveis e responderem a investigações de integridade.</span><span class="sxs-lookup"><span data-stu-id="3f49e-105">Application Gateway continues to monitor the unhealthy instances and adds them back to the healthy back-end pool once they become available and respond to health probes.</span></span> <span data-ttu-id="3f49e-106">O Gateway de Aplicativo envia as investigações de integridade na mesma porta que é definida nas configurações de HTTP do back-end.</span><span class="sxs-lookup"><span data-stu-id="3f49e-106">Application gateway sends the health probes with the same port that is defined in the back-end HTTP settings.</span></span> <span data-ttu-id="3f49e-107">A configuração assegura que a investigação teste a mesma porta que os clientes usariam para se conectar ao back-end.</span><span class="sxs-lookup"><span data-stu-id="3f49e-107">This configuration ensures that the probe is testing the same port that customers would be using to connect to the backend.</span></span>

![exemplo de investigação de gateway de aplicativo][1]

<span data-ttu-id="3f49e-109">Além de usar o monitoramento da investigação de integridade padrão, você também pode personalizar a investigação de integridade para atender às necessidades do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="3f49e-109">In addition to using default health probe monitoring, you can also customize the health probe to suit your application's requirements.</span></span> <span data-ttu-id="3f49e-110">Neste artigo, serão abordadas as investigações de integridade padrão e personalizadas.</span><span class="sxs-lookup"><span data-stu-id="3f49e-110">In this article, both default and custom health probes are covered.</span></span>

> [!NOTE]
> <span data-ttu-id="3f49e-111">Se houver um NSG na sub-rede do Gateway de Aplicativo, os intervalos de porta 65503 a 65534 deverão ser abertos na sub-rede do Gateway de Aplicativo para o tráfego de entrada.</span><span class="sxs-lookup"><span data-stu-id="3f49e-111">If there is an NSG on Application Gateway subnet, port ranges 65503-65534 should be opened on the Application Gateway subnet for Inbound traffic.</span></span> <span data-ttu-id="3f49e-112">Essas portas são necessárias para que a API de integridade do back-end funcione.</span><span class="sxs-lookup"><span data-stu-id="3f49e-112">These ports are required for the backend health API to work.</span></span>

## <a name="default-health-probe"></a><span data-ttu-id="3f49e-113">Investigação de integridade padrão</span><span class="sxs-lookup"><span data-stu-id="3f49e-113">Default health probe</span></span>

<span data-ttu-id="3f49e-114">Um Application Gateway configura automaticamente uma investigação de integridade padrão quando você não define nenhuma configuração de investigação personalizada.</span><span class="sxs-lookup"><span data-stu-id="3f49e-114">An application gateway automatically configures a default health probe when you don't set up any custom probe configuration.</span></span> <span data-ttu-id="3f49e-115">O comportamento de monitoramento funciona fazendo uma solicitação HTTP para os endereços IP configurados para o pool de back-end.</span><span class="sxs-lookup"><span data-stu-id="3f49e-115">The monitoring behavior works by making an HTTP request to the IP addresses configured for the back-end pool.</span></span> <span data-ttu-id="3f49e-116">Para investigações padrão, se as configurações de HTTP de back-end estão configuradas para HTTPS, a investigação também usa HTTPS para testar a integridade dos back-ends.</span><span class="sxs-lookup"><span data-stu-id="3f49e-116">For default probes if the backend http settings are configured for HTTPS, the probe uses HTTPS as well to test health of the backends.</span></span>

<span data-ttu-id="3f49e-117">Por exemplo: configure seu Application Gateway para usar os servidores de back-end, A, B e C para receber o tráfego de rede HTTP na porta 80.</span><span class="sxs-lookup"><span data-stu-id="3f49e-117">For example: You configure your application gateway to use back-end servers A, B, and C to receive HTTP network traffic on port 80.</span></span> <span data-ttu-id="3f49e-118">O monitoramento de integridade padrão testa os três servidores a cada 30 segundos para receber uma de HTTP íntegra.</span><span class="sxs-lookup"><span data-stu-id="3f49e-118">The default health monitoring tests the three servers every 30 seconds for a healthy HTTP response.</span></span> <span data-ttu-id="3f49e-119">Uma resposta de HTTP íntegra tem um [código de status](https://msdn.microsoft.com/library/aa287675.aspx) entre 200 e 399.</span><span class="sxs-lookup"><span data-stu-id="3f49e-119">A healthy HTTP response has a [status code](https://msdn.microsoft.com/library/aa287675.aspx) between 200 and 399.</span></span>

<span data-ttu-id="3f49e-120">Se a verificação de investigação padrão falhar para o servidor A, o Application Gateway o remove do seu pool de back-end e o tráfego de rede para de fluir para este servidor.</span><span class="sxs-lookup"><span data-stu-id="3f49e-120">If the default probe check fails for server A, the application gateway removes it from its back-end pool, and network traffic stops flowing to this server.</span></span> <span data-ttu-id="3f49e-121">A investigação padrão ainda continua a verificar o servidor A a cada 30 segundos.</span><span class="sxs-lookup"><span data-stu-id="3f49e-121">The default probe still continues to check for server A every 30 seconds.</span></span> <span data-ttu-id="3f49e-122">Quando o Servidor A responde com êxito a uma solicitação de uma investigação de integridade, ela é adicionada de volta como íntegro ao pool de back-end e o tráfego começa a fluir para esse servidor novamente.</span><span class="sxs-lookup"><span data-stu-id="3f49e-122">When server A responds successfully to one request from a default health probe, it is added back as healthy to the back-end pool, and traffic starts flowing to the server again.</span></span>

### <a name="default-health-probe-settings"></a><span data-ttu-id="3f49e-123">Configurações da investigação de integridade padrão</span><span class="sxs-lookup"><span data-stu-id="3f49e-123">Default health probe settings</span></span>

| <span data-ttu-id="3f49e-124">Propriedades da investigação</span><span class="sxs-lookup"><span data-stu-id="3f49e-124">Probe property</span></span> | <span data-ttu-id="3f49e-125">Valor</span><span class="sxs-lookup"><span data-stu-id="3f49e-125">Value</span></span> | <span data-ttu-id="3f49e-126">Descrição</span><span class="sxs-lookup"><span data-stu-id="3f49e-126">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="3f49e-127">URL de investigação</span><span class="sxs-lookup"><span data-stu-id="3f49e-127">Probe URL</span></span> |<span data-ttu-id="3f49e-128">http://127.0.0.1:\<porta\>/</span><span class="sxs-lookup"><span data-stu-id="3f49e-128">http://127.0.0.1:\<port\>/</span></span> |<span data-ttu-id="3f49e-129">Caminho da URL</span><span class="sxs-lookup"><span data-stu-id="3f49e-129">URL path</span></span> |
| <span data-ttu-id="3f49e-130">Intervalo</span><span class="sxs-lookup"><span data-stu-id="3f49e-130">Interval</span></span> |<span data-ttu-id="3f49e-131">30</span><span class="sxs-lookup"><span data-stu-id="3f49e-131">30</span></span> |<span data-ttu-id="3f49e-132">Intervalo da investigação em segundos</span><span class="sxs-lookup"><span data-stu-id="3f49e-132">Probe interval in seconds</span></span> |
| <span data-ttu-id="3f49e-133">Tempo limite</span><span class="sxs-lookup"><span data-stu-id="3f49e-133">Time-out</span></span> |<span data-ttu-id="3f49e-134">30</span><span class="sxs-lookup"><span data-stu-id="3f49e-134">30</span></span> |<span data-ttu-id="3f49e-135">Tempo limite da investigação em segundos</span><span class="sxs-lookup"><span data-stu-id="3f49e-135">Probe time-out in seconds</span></span> |
| <span data-ttu-id="3f49e-136">Limite não íntegro</span><span class="sxs-lookup"><span data-stu-id="3f49e-136">Unhealthy threshold</span></span> |<span data-ttu-id="3f49e-137">3</span><span class="sxs-lookup"><span data-stu-id="3f49e-137">3</span></span> |<span data-ttu-id="3f49e-138">Contagem de repetições da investigação.</span><span class="sxs-lookup"><span data-stu-id="3f49e-138">Probe retry count.</span></span> <span data-ttu-id="3f49e-139">O servidor de back-end é marcado após a contagem de falhas de investigação consecutivas atingir o limite de não íntegro.</span><span class="sxs-lookup"><span data-stu-id="3f49e-139">The back-end server is marked down after the consecutive probe failure count reaches the unhealthy threshold.</span></span> |

> [!NOTE]
> <span data-ttu-id="3f49e-140">A porta é a mesma das configurações de HTTP de back-end.</span><span class="sxs-lookup"><span data-stu-id="3f49e-140">The port is the same port as the back-end HTTP settings.</span></span>

<span data-ttu-id="3f49e-141">A investigação padrão examina apenas http://127.0.0.1:\<port\> para determinar o status de integridade.</span><span class="sxs-lookup"><span data-stu-id="3f49e-141">The default probe looks only at http://127.0.0.1:\<port\> to determine health status.</span></span> <span data-ttu-id="3f49e-142">Se precisar configurar a investigação de integridade para ir para uma URL personalizada ou modificar outras configurações, você deverá usar investigações personalizadas, conforme descrito nas etapas a seguir:</span><span class="sxs-lookup"><span data-stu-id="3f49e-142">If you need to configure the health probe to go to a custom URL or modify any other settings, you must use custom probes as described in the following steps:</span></span>

## <a name="custom-health-probe"></a><span data-ttu-id="3f49e-143">Investigação de integridade personalizada</span><span class="sxs-lookup"><span data-stu-id="3f49e-143">Custom health probe</span></span>

<span data-ttu-id="3f49e-144">Investigações personalizadas permitem que você tenha um controle mais granular sobre o monitoramento de integridade.</span><span class="sxs-lookup"><span data-stu-id="3f49e-144">Custom probes allow you to have a more granular control over the health monitoring.</span></span> <span data-ttu-id="3f49e-145">Ao usar investigações personalizadas, você pode configurar o intervalo de investigação, a URL e o caminho a testar e quantas respostas com falha devem ser aceitas antes de marcar a instância do pool de back-end como não íntegra.</span><span class="sxs-lookup"><span data-stu-id="3f49e-145">When using custom probes, you can configure the probe interval, the URL and path to test, and how many failed responses to accept before marking the back-end pool instance as unhealthy.</span></span>

### <a name="custom-health-probe-settings"></a><span data-ttu-id="3f49e-146">Configurações da investigação de integridade personalizada</span><span class="sxs-lookup"><span data-stu-id="3f49e-146">Custom health probe settings</span></span>

<span data-ttu-id="3f49e-147">A tabela a seguir fornece definições para as propriedades de uma investigação de integridade personalizada.</span><span class="sxs-lookup"><span data-stu-id="3f49e-147">The following table provides definitions for the properties of a custom health probe.</span></span>

| <span data-ttu-id="3f49e-148">Propriedades da investigação</span><span class="sxs-lookup"><span data-stu-id="3f49e-148">Probe property</span></span> | <span data-ttu-id="3f49e-149">Descrição</span><span class="sxs-lookup"><span data-stu-id="3f49e-149">Description</span></span> |
| --- | --- |
| <span data-ttu-id="3f49e-150">Name</span><span class="sxs-lookup"><span data-stu-id="3f49e-150">Name</span></span> |<span data-ttu-id="3f49e-151">O nome da investigação.</span><span class="sxs-lookup"><span data-stu-id="3f49e-151">Name of the probe.</span></span> <span data-ttu-id="3f49e-152">Este é o nome usado para se referir à investigação nas configurações de HTTP de back-end.</span><span class="sxs-lookup"><span data-stu-id="3f49e-152">This name is used to refer to the probe in back-end HTTP settings.</span></span> |
| <span data-ttu-id="3f49e-153">Protocolo</span><span class="sxs-lookup"><span data-stu-id="3f49e-153">Protocol</span></span> |<span data-ttu-id="3f49e-154">O protocolo usado para enviar a investigação.</span><span class="sxs-lookup"><span data-stu-id="3f49e-154">Protocol used to send the probe.</span></span> <span data-ttu-id="3f49e-155">A investigação usa o protocolo definido nas configurações de HTTP do back-end</span><span class="sxs-lookup"><span data-stu-id="3f49e-155">The probe uses the protocol defined in the back-end HTTP settings</span></span> |
| <span data-ttu-id="3f49e-156">Host</span><span class="sxs-lookup"><span data-stu-id="3f49e-156">Host</span></span> |<span data-ttu-id="3f49e-157">O nome do host para enviar a investigação.</span><span class="sxs-lookup"><span data-stu-id="3f49e-157">Host name to send the probe.</span></span> <span data-ttu-id="3f49e-158">Aplicável somente quando vários sites são configurados no Application Gateway; do contrário, use '127.0.0.1'.</span><span class="sxs-lookup"><span data-stu-id="3f49e-158">Applicable only when multi-site is configured on Application Gateway, otherwise use '127.0.0.1'.</span></span> <span data-ttu-id="3f49e-159">Este valor é diferente do nome do host de VM.</span><span class="sxs-lookup"><span data-stu-id="3f49e-159">This value is different from VM host name.</span></span> |
| <span data-ttu-id="3f49e-160">Caminho</span><span class="sxs-lookup"><span data-stu-id="3f49e-160">Path</span></span> |<span data-ttu-id="3f49e-161">O caminho relativo da investigação.</span><span class="sxs-lookup"><span data-stu-id="3f49e-161">Relative path of the probe.</span></span> <span data-ttu-id="3f49e-162">Um caminho válido começa com '/'.</span><span class="sxs-lookup"><span data-stu-id="3f49e-162">The valid path starts from '/'.</span></span> |
| <span data-ttu-id="3f49e-163">Intervalo</span><span class="sxs-lookup"><span data-stu-id="3f49e-163">Interval</span></span> |<span data-ttu-id="3f49e-164">Intervalo de investigação em segundos.</span><span class="sxs-lookup"><span data-stu-id="3f49e-164">Probe interval in seconds.</span></span> <span data-ttu-id="3f49e-165">Este valor é o intervalo de tempo entre duas investigações consecutivas.</span><span class="sxs-lookup"><span data-stu-id="3f49e-165">This value is the time interval between two consecutive probes.</span></span> |
| <span data-ttu-id="3f49e-166">Tempo limite</span><span class="sxs-lookup"><span data-stu-id="3f49e-166">Time-out</span></span> |<span data-ttu-id="3f49e-167">Tempo limite da investigação em segundos.</span><span class="sxs-lookup"><span data-stu-id="3f49e-167">Probe time-out in seconds.</span></span> <span data-ttu-id="3f49e-168">Se uma resposta válida não for recebida dentro desse período de tempo limite, a investigação será marcada como com falha.</span><span class="sxs-lookup"><span data-stu-id="3f49e-168">If a valid response is not received within this time-out period, the probe is marked as failed.</span></span>  |
| <span data-ttu-id="3f49e-169">Limite não íntegro</span><span class="sxs-lookup"><span data-stu-id="3f49e-169">Unhealthy threshold</span></span> |<span data-ttu-id="3f49e-170">Contagem de repetições da investigação.</span><span class="sxs-lookup"><span data-stu-id="3f49e-170">Probe retry count.</span></span> <span data-ttu-id="3f49e-171">O servidor de back-end é marcado após a contagem de falhas de investigação consecutivas atingir o limite de não íntegro.</span><span class="sxs-lookup"><span data-stu-id="3f49e-171">The back-end server is marked down after the consecutive probe failure count reaches the unhealthy threshold.</span></span> |

> [!IMPORTANT]
> <span data-ttu-id="3f49e-172">Se o Gateway de Aplicativo estiver configurado para um único site, por padrão, o nome do Host deverá ser especificado como '127.0.0.1', a menos que seja configurado de outra forma na investigação personalizada.</span><span class="sxs-lookup"><span data-stu-id="3f49e-172">If Application Gateway is configured for a single site, by default the Host name should be specified as '127.0.0.1', unless otherwise configured in custom probe.</span></span>
> <span data-ttu-id="3f49e-173">Para referência, uma investigação personalizada é enviada para \<protocol\>://\<host\>:\<port\>\<path\>.</span><span class="sxs-lookup"><span data-stu-id="3f49e-173">For reference a custom probe is sent to \<protocol\>://\<host\>:\<port\>\<path\>.</span></span> <span data-ttu-id="3f49e-174">A porta usada será a mesma definida nas configurações de HTTP do back-end.</span><span class="sxs-lookup"><span data-stu-id="3f49e-174">The port used will be the same port as defined in the back-end HTTP settings.</span></span>

## <a name="next-steps"></a><span data-ttu-id="3f49e-175">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="3f49e-175">Next steps</span></span>
<span data-ttu-id="3f49e-176">Depois de aprender sobre o monitoramento de integridade do Gateway de Aplicativo, você poderá configurar uma [investigação de integridade personalizada](application-gateway-create-probe-portal.md) no portal do Azure ou uma [investigação de integridade personalizada](application-gateway-create-probe-ps.md) usando o PowerShell e o modelo de implantação do Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="3f49e-176">After learning about Application Gateway health monitoring, you can configure a [custom health probe](application-gateway-create-probe-portal.md) in the Azure portal or a [custom health probe](application-gateway-create-probe-ps.md) using PowerShell and the Azure Resource Manager deployment model.</span></span>

[1]: ./media/application-gateway-probe-overview/appgatewayprobe.png
