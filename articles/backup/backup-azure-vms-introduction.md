---
title: Planejar sua infraestrutura de backup da VM no Azure | Microsoft Docs
description: "Considerações importantes ao planejar o backup de máquinas virtuais no Azure"
services: backup
documentationcenter: 
author: markgalioto
manager: carmonm
editor: 
keywords: "backup de vms, backup de máquinas virtuais"
ms.assetid: 19d2cf82-1f60-43e1-b089-9238042887a9
ms.service: backup
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 7/18/2017
ms.author: markgal;trinadhk
ms.openlocfilehash: 0c930c7413b24a811707c3a1ff3d7d70585bc528
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/29/2017
---
# <a name="plan-your-vm-backup-infrastructure-in-azure"></a><span data-ttu-id="f3711-104">Planejar sua infraestrutura de backup da VM no Azure</span><span class="sxs-lookup"><span data-stu-id="f3711-104">Plan your VM backup infrastructure in Azure</span></span>
<span data-ttu-id="f3711-105">Este artigo fornece sugestões de desempenho e recursos para ajudá-lo a planejar a infraestrutura de backup da VM.</span><span class="sxs-lookup"><span data-stu-id="f3711-105">This article provides performance and resource suggestions to help you plan your VM backup infrastructure.</span></span> <span data-ttu-id="f3711-106">Ele também define os principais aspectos do serviço de Backup. Esses aspectos podem ser críticos para determinar a arquitetura, o planejamento de capacidade e o agendamento.</span><span class="sxs-lookup"><span data-stu-id="f3711-106">It also defines key aspects of the Backup service; these aspects can be critical in determining your architecture, capacity planning, and scheduling.</span></span> <span data-ttu-id="f3711-107">Se você [preparou o ambiente](backup-azure-vms-prepare.md), o planejamento será a próxima etapa antes de começar a [fazer backup das VMs](backup-azure-vms.md).</span><span class="sxs-lookup"><span data-stu-id="f3711-107">If you've [prepared your environment](backup-azure-vms-prepare.md), planning is the next step before you begin [to back up VMs](backup-azure-vms.md).</span></span> <span data-ttu-id="f3711-108">Se você precisa de mais informações sobre máquinas virtuais do Azure, confira a [documentação da Máquina Virtual](https://azure.microsoft.com/documentation/services/virtual-machines/).</span><span class="sxs-lookup"><span data-stu-id="f3711-108">If you need more information about Azure virtual machines, see the [Virtual Machines documentation](https://azure.microsoft.com/documentation/services/virtual-machines/).</span></span>

## <a name="how-does-azure-back-up-virtual-machines"></a><span data-ttu-id="f3711-109">Como o Azure faz backup de máquinas virtuais?</span><span class="sxs-lookup"><span data-stu-id="f3711-109">How does Azure back up virtual machines?</span></span>
<span data-ttu-id="f3711-110">Quando o serviço de Backup do Azure inicia um trabalho de backup no horário agendado, ele dispara a extensão de backup para obter um instantâneo pontual.</span><span class="sxs-lookup"><span data-stu-id="f3711-110">When the Azure Backup service initiates a backup job at the scheduled time, it triggers the backup extension to take a point-in-time snapshot.</span></span> <span data-ttu-id="f3711-111">O serviço de Backup do Azure usa a extensão _VMSnapshot_ no Windows e a extensão _VMSnapshotLinux_ no Linux.</span><span class="sxs-lookup"><span data-stu-id="f3711-111">The Azure Backup service uses the _VMSnapshot_ extension in Windows, and the _VMSnapshotLinux_ extension in Linux.</span></span> <span data-ttu-id="f3711-112">A extensão é instalada durante o primeiro backup de VM.</span><span class="sxs-lookup"><span data-stu-id="f3711-112">The extension is installed during the first VM backup.</span></span> <span data-ttu-id="f3711-113">Para instalar a extensão, a VM deve estar em execução.</span><span class="sxs-lookup"><span data-stu-id="f3711-113">To install the extension, the VM must be running.</span></span> <span data-ttu-id="f3711-114">Se a VM não estiver em execução, o serviço de Backup criará um instantâneo do armazenamento subjacente (já que nenhuma gravação de aplicativo ocorre enquanto a VM está parada).</span><span class="sxs-lookup"><span data-stu-id="f3711-114">If the VM is not running, the Backup service takes a snapshot of the underlying storage (since no application writes occur while the VM is stopped).</span></span>

<span data-ttu-id="f3711-115">Ao gerar um instantâneo de VMs do Windows, o Serviço de backup coordena com o VSS (Serviço de Cópias de Sombra de Volume) para obter um instantâneo consistente dos discos da máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="f3711-115">When taking a snapshot of Windows VMs, the Backup service coordinates with the Volume Shadow Copy Service (VSS) to get a consistent snapshot of the virtual machine's disks.</span></span> <span data-ttu-id="f3711-116">Se você estiver fazendo backup de VMs do Linux, poderá escrever seus próprios scripts personalizados para garantir a consistência ao gerar um instantâneo de VM.</span><span class="sxs-lookup"><span data-stu-id="f3711-116">If you're backing up Linux VMs, you can write your own custom scripts to ensure consistency when taking a VM snapshot.</span></span> <span data-ttu-id="f3711-117">Detalhes sobre como invocar esses scripts são fornecidos posteriormente neste artigo.</span><span class="sxs-lookup"><span data-stu-id="f3711-117">Details on invoking these scripts are provided later in this article.</span></span>

<span data-ttu-id="f3711-118">Depois que o serviço de Backup do Azure gera o instantâneo, os dados são transferidos para o cofre.</span><span class="sxs-lookup"><span data-stu-id="f3711-118">Once the Azure Backup service takes the snapshot, the data is transferred to the vault.</span></span> <span data-ttu-id="f3711-119">Para maximizar a eficiência, o serviço identifica e transfere apenas os blocos de dados que foram alterados desde o backup anterior.</span><span class="sxs-lookup"><span data-stu-id="f3711-119">To maximize efficiency, the service identifies and transfers only the blocks of data that have changed since the previous backup.</span></span>

![Arquitetura de backup de máquinas virtuais do Azure](./media/backup-azure-vms-introduction/vmbackup-architecture.png)

<span data-ttu-id="f3711-121">Quando a transferência de dados é concluída, o instantâneo é removido e um ponto de recuperação é criado.</span><span class="sxs-lookup"><span data-stu-id="f3711-121">When the data transfer is complete, the snapshot is removed and a recovery point is created.</span></span>

> [!NOTE]
> 1. <span data-ttu-id="f3711-122">Durante o processo de backup, o Backup do Azure não inclui o disco temporário conectado à máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="f3711-122">During the backup process, Azure Backup doesn't include the temporary disk attached to the virtual machine.</span></span> <span data-ttu-id="f3711-123">Para obter mais informações, consulte o blog sobre [armazenamento temporário](https://blogs.msdn.microsoft.com/mast/2013/12/06/understanding-the-temporary-drive-on-windows-azure-virtual-machines/).</span><span class="sxs-lookup"><span data-stu-id="f3711-123">For more information, see the blog on [temporary storage](https://blogs.msdn.microsoft.com/mast/2013/12/06/understanding-the-temporary-drive-on-windows-azure-virtual-machines/).</span></span>
> 2. <span data-ttu-id="f3711-124">Como o Backup do Azure gera um instantâneo de nível de armazenamento e o transfere para o cofre, não altere as chaves da conta de armazenamento até que o trabalho de backup seja concluído.</span><span class="sxs-lookup"><span data-stu-id="f3711-124">Since Azure Backup takes a storage-level snapshot and transfers that snapshot to vault, do not change the storage account keys until the backup job finishes.</span></span>
> 3. <span data-ttu-id="f3711-125">Para VMs premium, copiamos o instantâneo para a conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="f3711-125">For premium VMs, we copy the snapshot to storage account.</span></span> <span data-ttu-id="f3711-126">Isso serve para garantir que o serviço de Backup do Azure obtém IOPS suficientes para transferir dados para o cofre.</span><span class="sxs-lookup"><span data-stu-id="f3711-126">This is to make sure that Azure Backup service gets sufficient IOPS for transferring data to vault.</span></span> <span data-ttu-id="f3711-127">Essa cópia adicional de armazenamento é cobrada de acordo com o tamanho alocado de VM.</span><span class="sxs-lookup"><span data-stu-id="f3711-127">This additional copy of storage is charged as per the VM allocated size.</span></span> 
>

### <a name="data-consistency"></a><span data-ttu-id="f3711-128">Consistência de dados</span><span class="sxs-lookup"><span data-stu-id="f3711-128">Data consistency</span></span>
<span data-ttu-id="f3711-129">Fazer backup e restaurar dados corporativos críticos é complicado porque os dados críticos precisam ter o backup feito enquanto os aplicativos que produzem os dados estão em execução.</span><span class="sxs-lookup"><span data-stu-id="f3711-129">Backing up and restoring business critical data is complicated by the fact that business critical data must be backed up while the applications that produce the data are running.</span></span> <span data-ttu-id="f3711-130">Para resolver isso, o Backup do Azure dá suporte a backups consistentes com o aplicativo para VMs Windows e Linux</span><span class="sxs-lookup"><span data-stu-id="f3711-130">To address this, Azure Backup supports application-consistent backups for both Windows and Linux VMs</span></span>
#### <a name="windows-vm"></a><span data-ttu-id="f3711-131">VM Windows</span><span class="sxs-lookup"><span data-stu-id="f3711-131">Windows VM</span></span>
<span data-ttu-id="f3711-132">O Backup do Azure realiza backups completos de VSS em VMs do Windows (leia mais sobre [backup completo de VSS](http://blogs.technet.com/b/filecab/archive/2008/05/21/what-is-the-difference-between-vss-full-backup-and-vss-copy-backup-in-windows-server-2008.aspx)).</span><span class="sxs-lookup"><span data-stu-id="f3711-132">Azure Backup takes VSS full backups on Windows VMs (read more about [VSS full backup](http://blogs.technet.com/b/filecab/archive/2008/05/21/what-is-the-difference-between-vss-full-backup-and-vss-copy-backup-in-windows-server-2008.aspx)).</span></span> <span data-ttu-id="f3711-133">Para permitir backups de cópia do VSS, a chave do Registro a seguir precisa ser definida na VM.</span><span class="sxs-lookup"><span data-stu-id="f3711-133">To enable VSS copy backups, the following registry key needs to be set on the VM.</span></span>

```
[HKEY_LOCAL_MACHINE\SOFTWARE\MICROSOFT\BCDRAGENT]
"USEVSSCOPYBACKUP"="TRUE"
```

#### <a name="linux-vms"></a><span data-ttu-id="f3711-134">VMs Linux</span><span class="sxs-lookup"><span data-stu-id="f3711-134">Linux VMs</span></span>
<span data-ttu-id="f3711-135">O Backup do Azure fornece uma estrutura de script.</span><span class="sxs-lookup"><span data-stu-id="f3711-135">Azure Backup provides a scripting framework.</span></span> <span data-ttu-id="f3711-136">Para garantir a consistência do aplicativo ao fazer backup de VMs do Linux, crie scripts personalizados de pré e pós-scripts que controlam o fluxo de trabalho de backup e o ambiente.</span><span class="sxs-lookup"><span data-stu-id="f3711-136">To ensure application consistency when backing up Linux VMs, create custom pre-scripts and post-scripts that control the backup workflow and environment.</span></span> <span data-ttu-id="f3711-137">O Backup do Azure invoca o pré-script antes de gerar o instantâneo de VM e invoca o pós-script após concluir o trabalho de instantâneo de VM.</span><span class="sxs-lookup"><span data-stu-id="f3711-137">Azure Backup invokes the pre-script before taking the VM snapshot and invokes the post-script once the VM snapshot job completes.</span></span> <span data-ttu-id="f3711-138">Para obter mais detalhes, consulte [Backup de VM Linux consistente com o aplicativo usando pré-script e pós-script](https://docs.microsoft.com/azure/backup/backup-azure-linux-app-consistent).</span><span class="sxs-lookup"><span data-stu-id="f3711-138">For more details, see [application consistent VM backups using pre-script and post-script](https://docs.microsoft.com/azure/backup/backup-azure-linux-app-consistent).</span></span>
> [!NOTE]
> <span data-ttu-id="f3711-139">O Backup do Azure invoca apenas os pré e pós-scripts escritos pelo cliente.</span><span class="sxs-lookup"><span data-stu-id="f3711-139">Azure Backup only invokes the customer-written pre- and post-scripts.</span></span> <span data-ttu-id="f3711-140">Se o pré e pós-scripts forem executados com êxito, o Backup do Azure marcará o ponto de recuperação como consistente com o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f3711-140">If the pre-script and post-scripts execute successfully, Azure Backup marks the recovery point as application consistent.</span></span> <span data-ttu-id="f3711-141">No entanto, o cliente é responsável pela consistência do aplicativo ao usar scripts personalizados.</span><span class="sxs-lookup"><span data-stu-id="f3711-141">However, the customer is ultimately responsible for the application consistency when using custom scripts.</span></span>
>


<span data-ttu-id="f3711-142">Esta tabela explica os tipos de consistência e as condições sob as quais elas ocorrem durante o backup da VM do Azure e os procedimentos de restauração.</span><span class="sxs-lookup"><span data-stu-id="f3711-142">This table explains the types of consistency and the conditions that they occur under during Azure VM backup and restore procedures.</span></span>

| <span data-ttu-id="f3711-143">Consistência</span><span class="sxs-lookup"><span data-stu-id="f3711-143">Consistency</span></span> | <span data-ttu-id="f3711-144">Baseado em VSS</span><span class="sxs-lookup"><span data-stu-id="f3711-144">VSS-based</span></span> | <span data-ttu-id="f3711-145">Explicação e detalhes</span><span class="sxs-lookup"><span data-stu-id="f3711-145">Explanation and details</span></span> |
| --- | --- | --- |
| <span data-ttu-id="f3711-146">Consistência de aplicativo</span><span class="sxs-lookup"><span data-stu-id="f3711-146">Application consistency</span></span> |<span data-ttu-id="f3711-147">Sim para Windows</span><span class="sxs-lookup"><span data-stu-id="f3711-147">Yes for Windows</span></span>|<span data-ttu-id="f3711-148">A consistência do aplicativo é ideal para cargas de trabalho, pois garante que:</span><span class="sxs-lookup"><span data-stu-id="f3711-148">Application consistency is ideal for workloads as it ensures that:</span></span><ol><li> <span data-ttu-id="f3711-149">a VM *seja iniciada*.</span><span class="sxs-lookup"><span data-stu-id="f3711-149">The VM *boots up*.</span></span> <li><span data-ttu-id="f3711-150">Não há *corrupção*.</span><span class="sxs-lookup"><span data-stu-id="f3711-150">There is *no corruption*.</span></span> <li><span data-ttu-id="f3711-151">*Não há perda de dados*.</span><span class="sxs-lookup"><span data-stu-id="f3711-151">There is *no data loss*.</span></span><li> <span data-ttu-id="f3711-152">Os dados são consistentes com o aplicativo que usa os dados, envolvendo o aplicativo no momento do backup – usando o VSS ou o pré/pós-script.</span><span class="sxs-lookup"><span data-stu-id="f3711-152">The data is consistent to the application that uses the data, by involving the application at the time of backup--using VSS or pre/post script.</span></span></ol> <li><span data-ttu-id="f3711-153">*VMs Windows* – a maioria das cargas de trabalho da Microsoft têm gravadores VSS que executam ações específicas à carga de trabalho relacionadas à consistência dos dados.</span><span class="sxs-lookup"><span data-stu-id="f3711-153">*Windows VMs*- Most Microsoft workloads have VSS writers that do workload-specific actions related to data consistency.</span></span> <span data-ttu-id="f3711-154">Por exemplo, o Microsoft SQL Server tem um gravador VSS que garante que as gravações no arquivo de log de transações e no banco de dados sejam realizadas corretamente.</span><span class="sxs-lookup"><span data-stu-id="f3711-154">For example, Microsoft SQL Server has a VSS writer that ensures that the writes to the transaction log file and the database are done correctly.</span></span> <span data-ttu-id="f3711-155">Para backups de VM Windows do Azure, para criar um ponto de recuperação consistente com o aplicativo, a extensão de backup deve invocar o fluxo de trabalho do VSS e concluí-lo antes da criação do instantâneo de VM.</span><span class="sxs-lookup"><span data-stu-id="f3711-155">For Azure Windows VM backups, to create an application-consistent recovery point, the backup extension must invoke the VSS workflow and complete it before taking the VM snapshot.</span></span> <span data-ttu-id="f3711-156">Para que o instantâneo de VM do Azure seja preciso, os gravadores VSS de todos os aplicativos de VM do Azure também devem ser concluídos.</span><span class="sxs-lookup"><span data-stu-id="f3711-156">For the Azure VM snapshot to be accurate, the VSS writers of all Azure VM applications must complete as well.</span></span> <span data-ttu-id="f3711-157">(Aprenda as [noções básicas do VSS](http://blogs.technet.com/b/josebda/archive/2007/10/10/the-basics-of-the-volume-shadow-copy-service-vss.aspx) e aprofunde-se nos detalhes de [como ele funciona](https://technet.microsoft.com/library/cc785914%28v=ws.10%29.aspx).)</span><span class="sxs-lookup"><span data-stu-id="f3711-157">(Learn the [basics of VSS](http://blogs.technet.com/b/josebda/archive/2007/10/10/the-basics-of-the-volume-shadow-copy-service-vss.aspx) and dive deep into the details of [how it works](https://technet.microsoft.com/library/cc785914%28v=ws.10%29.aspx)).</span></span> </li> <li> <span data-ttu-id="f3711-158">*VMs Linux* – Os clientes podem executar o [pré-script e pós-script personalizados para garantir a consistência do aplicativo](https://docs.microsoft.com/azure/backup/backup-azure-linux-app-consistent).</span><span class="sxs-lookup"><span data-stu-id="f3711-158">*Linux VMs*- Customers can execute [custom pre-script and post-script to ensure application consistency](https://docs.microsoft.com/azure/backup/backup-azure-linux-app-consistent).</span></span> </li> |
| <span data-ttu-id="f3711-159">Consistência do sistema de arquivos</span><span class="sxs-lookup"><span data-stu-id="f3711-159">File-system consistency</span></span> |<span data-ttu-id="f3711-160">Sim - para computadores baseados em Windows</span><span class="sxs-lookup"><span data-stu-id="f3711-160">Yes - for Windows-based computers</span></span> |<span data-ttu-id="f3711-161">Há dois cenários em que o ponto de recuperação pode ser *consistente com o sistema de arquivos*:</span><span class="sxs-lookup"><span data-stu-id="f3711-161">There are two scenarios where the recovery point can be *file-system consistent*:</span></span><ul><li><span data-ttu-id="f3711-162">Backups de VMs Linux no Azure, sem pré-script/pós-script ou se o pré-script/pós-script falhou.</span><span class="sxs-lookup"><span data-stu-id="f3711-162">Backups of Linux VMs in Azure, without pre-script/post-script or if pre-script/post-script failed.</span></span> <li><span data-ttu-id="f3711-163">Falha do VSS durante o backup de VMs Windows no Azure.</span><span class="sxs-lookup"><span data-stu-id="f3711-163">VSS failure during backup for Windows VMs in Azure.</span></span></li></ul> <span data-ttu-id="f3711-164">Em ambos os casos, o melhor que se pode fazer é garantir que:</span><span class="sxs-lookup"><span data-stu-id="f3711-164">In both these cases, the best that can be done is to ensure that:</span></span> <ol><li> <span data-ttu-id="f3711-165">a VM *seja iniciada*.</span><span class="sxs-lookup"><span data-stu-id="f3711-165">The VM *boots up*.</span></span> <li><span data-ttu-id="f3711-166">Não há *corrupção*.</span><span class="sxs-lookup"><span data-stu-id="f3711-166">There is *no corruption*.</span></span><li><span data-ttu-id="f3711-167">*Não há perda de dados*.</span><span class="sxs-lookup"><span data-stu-id="f3711-167">There is *no data loss*.</span></span></ol> <span data-ttu-id="f3711-168">Os aplicativos precisam implementar seu próprio mecanismo de "correção" nos dados restaurados.</span><span class="sxs-lookup"><span data-stu-id="f3711-168">Applications need to implement their own "fix-up" mechanism on the restored data.</span></span> |
| <span data-ttu-id="f3711-169">Consistência de falhas</span><span class="sxs-lookup"><span data-stu-id="f3711-169">Crash consistency</span></span> |<span data-ttu-id="f3711-170">Não</span><span class="sxs-lookup"><span data-stu-id="f3711-170">No</span></span> |<span data-ttu-id="f3711-171">Essa situação é equivalente a uma máquina virtual tendo uma "falha" (por meio de uma reinicialização forçada ou flexível).</span><span class="sxs-lookup"><span data-stu-id="f3711-171">This situation is equivalent to a virtual machine experiencing a "crash" (through either a soft or hard reset).</span></span> <span data-ttu-id="f3711-172">A consistência de falhas geralmente ocorre quando a máquina virtual do Azure está desligada no momento do backup.</span><span class="sxs-lookup"><span data-stu-id="f3711-172">Crash consistency typically happens when the Azure virtual machine is shut down at the time of backup.</span></span> <span data-ttu-id="f3711-173">Um ponto de recuperação com controle de falhas não garante a consistência dos dados no meio de armazenamento – tanto da perspectiva do sistema operacional quanto do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f3711-173">A crash-consistent recovery point provides no guarantees around the consistency of the data on the storage medium--either from the perspective of the operating system or the application.</span></span> <span data-ttu-id="f3711-174">Apenas os dados que já existem no disco no momento do backup são capturados e copiados em backup.</span><span class="sxs-lookup"><span data-stu-id="f3711-174">Only the data that already exists on the disk at the time of backup is captured and backed up.</span></span> <br/> <br/> <span data-ttu-id="f3711-175">Embora não haja nenhuma garantia, em geral, o sistema operacional é inicializado, seguido pelo procedimento de verificação de disco, como chkdsk, para corrigir erros de danos.</span><span class="sxs-lookup"><span data-stu-id="f3711-175">While there are no guarantees, usually, the operating system boots, followed by disk-checking procedure, like chkdsk, to fix any corruption errors.</span></span> <span data-ttu-id="f3711-176">Todos os dados ou gravações na memória que não foram transferidos para o disco serão perdidos.</span><span class="sxs-lookup"><span data-stu-id="f3711-176">Any in-memory data or writes that have not been transferred to the disk are lost.</span></span> <span data-ttu-id="f3711-177">O aplicativo geralmente segue com seu próprio mecanismo de verificação, caso seja necessário realizar reversão de dados.</span><span class="sxs-lookup"><span data-stu-id="f3711-177">The application typically follows with its own verification mechanism in case data rollback needs to be done.</span></span> <br><br><span data-ttu-id="f3711-178">Por exemplo, se o log de transações tiver entradas que não estão presentes no banco de dados, o software de banco de dados faz uma reversão até que os dados fiquem consistentes.</span><span class="sxs-lookup"><span data-stu-id="f3711-178">As an example, if the transaction log has entries that are not present in the database, then the database software does a rollback until the data is consistent.</span></span> <span data-ttu-id="f3711-179">Quando os dados são distribuídos entre vários discos virtuais (como volumes estendidos), um ponto de recuperação consistente quanto a falhas não garante a exatidão dos dados.</span><span class="sxs-lookup"><span data-stu-id="f3711-179">When data is spread across multiple virtual disks (like spanned volumes), a crash-consistent recovery point provides no guarantees for the correctness of the data.</span></span> |

## <a name="performance-and-resource-utilization"></a><span data-ttu-id="f3711-180">Desempenho e utilização de recursos</span><span class="sxs-lookup"><span data-stu-id="f3711-180">Performance and resource utilization</span></span>
<span data-ttu-id="f3711-181">Assim como o software de backup que é implantado localmente, você deve se planejar em termos das necessidades de utilização de recursos e capacidade ao fazer o backup de VMs no Azure.</span><span class="sxs-lookup"><span data-stu-id="f3711-181">Like backup software that is deployed on-premises, you should plan for capacity and resource utilization needs when backing up VMs in Azure.</span></span> <span data-ttu-id="f3711-182">Os [Limites de armazenamento do Azure](../azure-subscription-service-limits.md#storage-limits) definem como estruturar as implantações de VM para obter o máximo de desempenho com o mínimo de impacto na execução de cargas de trabalho.</span><span class="sxs-lookup"><span data-stu-id="f3711-182">The [Azure Storage limits](../azure-subscription-service-limits.md#storage-limits) define how to structure VM deployments to get maximum performance with minimum impact to running workloads.</span></span>

<span data-ttu-id="f3711-183">Preste atenção aos seguintes limites de Armazenamento do Azure durante o planejamento de desempenho de backup:</span><span class="sxs-lookup"><span data-stu-id="f3711-183">Pay attention to the following Azure Storage limits when planning backup performance:</span></span>

* <span data-ttu-id="f3711-184">Egresso máximo por conta de armazenamento</span><span class="sxs-lookup"><span data-stu-id="f3711-184">Max egress per storage account</span></span>
* <span data-ttu-id="f3711-185">Taxa de solicitação total por conta de armazenamento</span><span class="sxs-lookup"><span data-stu-id="f3711-185">Total request rate per storage account</span></span>

### <a name="storage-account-limits"></a><span data-ttu-id="f3711-186">Limites da conta de armazenamento</span><span class="sxs-lookup"><span data-stu-id="f3711-186">Storage account limits</span></span>
<span data-ttu-id="f3711-187">Dados de backup copiados de uma conta de armazenamento são adicionados às operações de entrada/saída por segundo (IOPS) e entrada (ou taxa de transferência) da conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="f3711-187">Backup data copied from a storage account, adds to the input/output operations per second (IOPS) and egress (or throughput) metrics of the storage account.</span></span> <span data-ttu-id="f3711-188">Ao mesmo tempo, as máquinas virtuais também consomem IOPS e taxa de transferência.</span><span class="sxs-lookup"><span data-stu-id="f3711-188">At the same time, virtual machines are also consuming IOPS and throughput.</span></span> <span data-ttu-id="f3711-189">A meta é garantir que o tráfego de backup e da máquina virtual não exceda os limites da conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="f3711-189">The goal is to ensure Backup and virtual machine traffic don't exceed your storage account limits.</span></span>

### <a name="number-of-disks"></a><span data-ttu-id="f3711-190">Número de discos</span><span class="sxs-lookup"><span data-stu-id="f3711-190">Number of disks</span></span>
<span data-ttu-id="f3711-191">O processo de backup tenta concluir um trabalho de backup o mais rápido possível.</span><span class="sxs-lookup"><span data-stu-id="f3711-191">The backup process tries to complete a backup job as quickly as possible.</span></span> <span data-ttu-id="f3711-192">Dessa forma, ele consome o mínimo de recursos possível.</span><span class="sxs-lookup"><span data-stu-id="f3711-192">In doing so, it consumes as many resources as it can.</span></span> <span data-ttu-id="f3711-193">No entanto, todas as operações de E/S são limitadas pela *Taxa de transferência de destino para blob único*, que tem um limite de 60 MB por segundo.</span><span class="sxs-lookup"><span data-stu-id="f3711-193">However, all I/O operations are limited by the *Target Throughput for Single Blob*, which has a limit of 60 MB per second.</span></span> <span data-ttu-id="f3711-194">Na tentativa de maximizar sua velocidade, o processo de backup tenta fazer backup de cada um dos discos da VM *em paralelo*.</span><span class="sxs-lookup"><span data-stu-id="f3711-194">In an attempt to maximize its speed, the backup process tries to back up each of the VM's disks *in parallel*.</span></span> <span data-ttu-id="f3711-195">Se uma VM tiver quatro discos, o serviço tentará fazer backup dos quatro discos em paralelo.</span><span class="sxs-lookup"><span data-stu-id="f3711-195">If a VM has four disks, the service attempts to back up all four disks in parallel.</span></span> <span data-ttu-id="f3711-196">O **número de discos** de backup é o fator mais importante para determinar o tráfego de backup da conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="f3711-196">The **number of disks** being backed up, is the most important factor in determining storage account backup traffic.</span></span>

### <a name="backup-schedule"></a><span data-ttu-id="f3711-197">Agendamento de backup</span><span class="sxs-lookup"><span data-stu-id="f3711-197">Backup schedule</span></span>
<span data-ttu-id="f3711-198">Um fator adicional que afeta o desempenho é o **agendamento de backup**.</span><span class="sxs-lookup"><span data-stu-id="f3711-198">An additional factor that impacts performance is the **backup schedule**.</span></span> <span data-ttu-id="f3711-199">Se configurar as políticas para que seja feito backup de todas as VMs ao mesmo tempo, você terá agendado um congestionamento no tráfego.</span><span class="sxs-lookup"><span data-stu-id="f3711-199">If you configure the policies so all VMs are backed up at the same time, you have scheduled a traffic jam.</span></span> <span data-ttu-id="f3711-200">O processo de backup tentará fazer backup de todos os discos em paralelo.</span><span class="sxs-lookup"><span data-stu-id="f3711-200">The backup process attempts to back up all disks in parallel.</span></span> <span data-ttu-id="f3711-201">Para reduzir o tráfego de backup de uma conta de armazenamento, faça backup de VMs diferentes em um momento diferente do dia, sem sobreposição.</span><span class="sxs-lookup"><span data-stu-id="f3711-201">To reduce the backup traffic from a storage account, back up different VMs at different time of the day, with no overlap.</span></span>

## <a name="capacity-planning"></a><span data-ttu-id="f3711-202">Planejamento da capacidade</span><span class="sxs-lookup"><span data-stu-id="f3711-202">Capacity planning</span></span>
<span data-ttu-id="f3711-203">Reunindo os fatores anteriores, você precisa planejar as necessidades de uso da conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="f3711-203">Putting the previous factors together, you need to plan for the storage account usage needs.</span></span> <span data-ttu-id="f3711-204">Baixe a [planilha do Excel de planejamento de capacidade de backup da VM](https://gallery.technet.microsoft.com/Azure-Backup-Storage-a46d7e33) para ver o impacto do disco rígido e as opções de agendamento de backup.</span><span class="sxs-lookup"><span data-stu-id="f3711-204">Download the [VM backup capacity planning Excel spreadsheet](https://gallery.technet.microsoft.com/Azure-Backup-Storage-a46d7e33) to see the impact of your disk and backup schedule choices.</span></span>

### <a name="backup-throughput"></a><span data-ttu-id="f3711-205">Taxa de transferência de backup</span><span class="sxs-lookup"><span data-stu-id="f3711-205">Backup throughput</span></span>
<span data-ttu-id="f3711-206">Para cada disco cujo backup está sendo feito, o Backup do Azure lê os blocos no disco e armazena somente os dados alterados (backup incremental).</span><span class="sxs-lookup"><span data-stu-id="f3711-206">For each disk being backed up, Azure Backup reads the blocks on the disk and stores only the changed data (incremental backup).</span></span> <span data-ttu-id="f3711-207">A tabela a seguir mostra os valores médios da taxa de transferência do serviço de Backup.</span><span class="sxs-lookup"><span data-stu-id="f3711-207">The following table shows the average Backup service throughput values.</span></span> <span data-ttu-id="f3711-208">Ao usar os dados a seguir, é possível estimar o tempo necessário para fazer backup de um disco de um tamanho específico.</span><span class="sxs-lookup"><span data-stu-id="f3711-208">Using the following data, you can estimate the amount of time needed to back up a disk of a given size.</span></span>

| <span data-ttu-id="f3711-209">Operação de backup</span><span class="sxs-lookup"><span data-stu-id="f3711-209">Backup operation</span></span> | <span data-ttu-id="f3711-210">Melhor taxa de transferência possível</span><span class="sxs-lookup"><span data-stu-id="f3711-210">Best-case throughput</span></span> |
| --- | --- |
| <span data-ttu-id="f3711-211">Backup inicial</span><span class="sxs-lookup"><span data-stu-id="f3711-211">Initial backup</span></span> |<span data-ttu-id="f3711-212">160 Mbps</span><span class="sxs-lookup"><span data-stu-id="f3711-212">160 Mbps</span></span> |
| <span data-ttu-id="f3711-213">Backup incremental (DR)</span><span class="sxs-lookup"><span data-stu-id="f3711-213">Incremental backup (DR)</span></span> |<span data-ttu-id="f3711-214">640 Mbps </span><span class="sxs-lookup"><span data-stu-id="f3711-214">640 Mbps</span></span> <br><br> <span data-ttu-id="f3711-215">A taxa de transferência é reduzida consideravelmente se os dados alterados (que precisam ser copiados em backup) são espalhados pelo disco.</span><span class="sxs-lookup"><span data-stu-id="f3711-215">Throughput drops significantly if the changed data (that needs to be backed up) is dispersed across the disk.</span></span>|

## <a name="total-vm-backup-time"></a><span data-ttu-id="f3711-216">Tempo total de backup da VM</span><span class="sxs-lookup"><span data-stu-id="f3711-216">Total VM backup time</span></span>
<span data-ttu-id="f3711-217">Embora a maioria do tempo de backup seja gasto na leitura e cópia de dados, outras operações contribuem para o tempo total necessário para o backup de uma VM:</span><span class="sxs-lookup"><span data-stu-id="f3711-217">While most of the backup time is spent reading and copying data, other operations contribute to the total time needed to back up a VM:</span></span>

* <span data-ttu-id="f3711-218">Tempo necessário para [instalar ou atualizar a extensão de backup](backup-azure-vms.md).</span><span class="sxs-lookup"><span data-stu-id="f3711-218">Time needed to [install or update the backup extension](backup-azure-vms.md).</span></span>
* <span data-ttu-id="f3711-219">Hora do instantâneo, que é o tempo levado para disparar um instantâneo.</span><span class="sxs-lookup"><span data-stu-id="f3711-219">Snapshot time, which is the time taken to trigger a snapshot.</span></span> <span data-ttu-id="f3711-220">Os instantâneos são disparados próximo ao horário de backup agendado.</span><span class="sxs-lookup"><span data-stu-id="f3711-220">Snapshots are triggered close to the scheduled backup time.</span></span>
* <span data-ttu-id="f3711-221">Tempo de espera da fila.</span><span class="sxs-lookup"><span data-stu-id="f3711-221">Queue wait time.</span></span> <span data-ttu-id="f3711-222">Quando o serviço de backup estiver processando backups de vários clientes, a cópia de dados de backup do instantâneo para o cofre do backup ou dos Serviços de Recuperação poderá não ser iniciada imediatamente.</span><span class="sxs-lookup"><span data-stu-id="f3711-222">Since the Backup service is processing backups from multiple customers, copying backup data from snapshot to the backup or Recovery Services vault might not start immediately.</span></span> <span data-ttu-id="f3711-223">Em períodos de pico de carga, a espera pode se alongar a até oito horas devido ao número de backups sendo processados.</span><span class="sxs-lookup"><span data-stu-id="f3711-223">In times of peak load, the wait can stretch up to eight hours due to the number of backups being processed.</span></span> <span data-ttu-id="f3711-224">No entanto, o tempo total de backup da VM é inferior a 24 horas para políticas de backup diárias.</span><span class="sxs-lookup"><span data-stu-id="f3711-224">However, the total VM backup time is less than 24 hours for daily backup policies.</span></span>
* <span data-ttu-id="f3711-225">Tempo de transferência de dados, o tempo necessário para o serviço de backup computar as alterações incrementais do backup anterior e transferir essas alterações para o armazenamento de cofre.</span><span class="sxs-lookup"><span data-stu-id="f3711-225">Data transfer time, time needed for backup service to compute the incremental changes from previous backup and transfer those changes to vault storage.</span></span>

### <a name="why-am-i-observing-longer12-hours-backup-time"></a><span data-ttu-id="f3711-226">Por que eu estou observando tempos de backup mais longos (mais de 12 horas)?</span><span class="sxs-lookup"><span data-stu-id="f3711-226">Why am I observing longer(>12 hours) backup time?</span></span>
<span data-ttu-id="f3711-227">O backup consiste em duas fases: criação de instantâneos e transferência dos instantâneos para o cofre.</span><span class="sxs-lookup"><span data-stu-id="f3711-227">Backup consists of two phases: taking snapshots and transferring the snapshots to the vault.</span></span> <span data-ttu-id="f3711-228">O serviço de Backup otimiza o armazenamento.</span><span class="sxs-lookup"><span data-stu-id="f3711-228">The Backup service optimizes for storage.</span></span> <span data-ttu-id="f3711-229">Ao transferir os dados de instantâneo para um cofre, o serviço transfere apenas as alterações incrementais do instantâneo anterior.</span><span class="sxs-lookup"><span data-stu-id="f3711-229">When transferring the snapshot data to a vault, the service only transfers incremental changes from the previous snapshot.</span></span>  <span data-ttu-id="f3711-230">Para determinar as alterações incrementais, o serviço calcula a soma de verificação dos blocos.</span><span class="sxs-lookup"><span data-stu-id="f3711-230">To determine the incremental changes, the service computes the checksum of the blocks.</span></span> <span data-ttu-id="f3711-231">Se um bloco é alterado, o bloco é identificado como um bloco a ser enviado para o cofre.</span><span class="sxs-lookup"><span data-stu-id="f3711-231">If a block is changed, the block is identified as a block to be sent to the vault.</span></span> <span data-ttu-id="f3711-232">O serviço realiza então uma busca mais detalhada em cada um dos blocos identificados, procurando oportunidades para minimizar os dados a serem transferidos.</span><span class="sxs-lookup"><span data-stu-id="f3711-232">Then the service drills further into each of the identified blocks, looking for opportunities to minimize the data to transfer.</span></span> <span data-ttu-id="f3711-233">Depois de avaliar todos os blocos alterados, o serviço une as alterações e as envia para o cofre.</span><span class="sxs-lookup"><span data-stu-id="f3711-233">After evaluating all changed blocks, the service coalesces the changes and sends them to the vault.</span></span> <span data-ttu-id="f3711-234">Em alguns aplicativos herdados, gravações pequenas e fragmentadas não são ideais para armazenamento.</span><span class="sxs-lookup"><span data-stu-id="f3711-234">In some legacy applications, small, fragmented writes are not optimal for storage.</span></span> <span data-ttu-id="f3711-235">Se o instantâneo contém várias gravações pequenas e fragmentadas, o serviço gasta mais tempo no processamento dos dados gravados pelos aplicativos.</span><span class="sxs-lookup"><span data-stu-id="f3711-235">If the snapshot contains many small, fragmented writes, the service spends additional time processing the data written by the applications.</span></span> <span data-ttu-id="f3711-236">O bloco de gravação do aplicativo recomendado do Azure, para aplicativos executados dentro da VM, é de, no mínimo, 8 KB.</span><span class="sxs-lookup"><span data-stu-id="f3711-236">The recommended application write block from Azure, for applications running inside the VM, is a minimum of 8 KB.</span></span> <span data-ttu-id="f3711-237">Se o aplicativo usar um bloco inferior a 8 KB, o desempenho do backup será afetado.</span><span class="sxs-lookup"><span data-stu-id="f3711-237">If your application uses a block of less than 8 KB, backup performance is effected.</span></span> <span data-ttu-id="f3711-238">Para obter ajuda com o ajuste do aplicativo para melhorar o desempenho do backup, consulte [Ajustando aplicativos para o desempenho ideal com o armazenamento do Azure](../storage/common/storage-premium-storage-performance.md).</span><span class="sxs-lookup"><span data-stu-id="f3711-238">For help with tuning your application to improve backup performance, see [Tuning applications for optimal performance with Azure storage](../storage/common/storage-premium-storage-performance.md).</span></span> <span data-ttu-id="f3711-239">Embora o artigo sobre desempenho do backup use exemplos do armazenamento Premium, as diretrizes são aplicáveis a discos de armazenamento Standard.</span><span class="sxs-lookup"><span data-stu-id="f3711-239">Though the article on backup performance uses Premium storage examples, the guidance is applicable for Standard storage disks.</span></span>

## <a name="total-restore-time"></a><span data-ttu-id="f3711-240">Tempo total de restauração</span><span class="sxs-lookup"><span data-stu-id="f3711-240">Total restore time</span></span>
<span data-ttu-id="f3711-241">Uma operação de restauração consiste em duas subtarefas principais: a cópia de dados do cofre para a conta de armazenamento do cliente escolhida e a criação da máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="f3711-241">A restore operation consists of two main sub tasks: Copying data back from the vault to the chosen customer storage account, and creating the virtual machine.</span></span> <span data-ttu-id="f3711-242">A cópia de dados do cofre depende do local em que os backups estão armazenados internamente no Azure e do local em que a conta de armazenamento do cliente está armazenada.</span><span class="sxs-lookup"><span data-stu-id="f3711-242">Copying data back from the vault depends on where the backups are stored internally in Azure, and where the customer storage account is stored.</span></span> <span data-ttu-id="f3711-243">O tempo necessário para copiar os dados depende de:</span><span class="sxs-lookup"><span data-stu-id="f3711-243">Time taken to copy data depends upon:</span></span>
* <span data-ttu-id="f3711-244">Tempo de espera de fila – como o serviço processa trabalhos de restauração de vários clientes ao mesmo tempo, as solicitações de restauração são colocadas em uma fila.</span><span class="sxs-lookup"><span data-stu-id="f3711-244">Queue wait time - Since the service processes restore jobs from multiple customers at the same time, restore requests are put in a queue.</span></span>
* <span data-ttu-id="f3711-245">Tempo de cópia de dados – Os dados são copiados primeiro do cofre para a conta de armazenamento do cliente.</span><span class="sxs-lookup"><span data-stu-id="f3711-245">Data copy time - Data is copied from the vault to the customer storage account.</span></span> <span data-ttu-id="f3711-246">O tempo de restauração depende de IOPS e serviço de Backup do Azure da taxa de transferência obtida na conta de armazenamento do cliente selecionado.</span><span class="sxs-lookup"><span data-stu-id="f3711-246">Restore time depends on IOPS and throughput Azure Backup service gets on the selected customer storage account.</span></span> <span data-ttu-id="f3711-247">Para reduzir o tempo de cópia durante o processo de restauração, selecione uma conta de armazenamento não carregada com outras leituras e gravações de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f3711-247">To reduce the copying time during the restore process, select a storage account not loaded with other application writes and reads.</span></span>

## <a name="best-practices"></a><span data-ttu-id="f3711-248">Práticas recomendadas</span><span class="sxs-lookup"><span data-stu-id="f3711-248">Best practices</span></span>
<span data-ttu-id="f3711-249">É recomendável seguir essas práticas ao configurar backups de máquinas virtuais:</span><span class="sxs-lookup"><span data-stu-id="f3711-249">We suggest following these practices while configuring backups for virtual machines:</span></span>

* <span data-ttu-id="f3711-250">Não agende mais de 10 VMs clássicas do mesmo serviço de nuvem para fazer backup ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="f3711-250">Don't schedule more than 10 classic VMs from the same cloud service to back up at the same time.</span></span> <span data-ttu-id="f3711-251">Se você quiser fazer backup de várias VMs do mesmo serviço de nuvem, distribua os horários de início de backup em uma hora.</span><span class="sxs-lookup"><span data-stu-id="f3711-251">If you want to back up multiple VMs from same cloud service, stagger the backup start times by an hour.</span></span>
* <span data-ttu-id="f3711-252">Não agende mais de 40 VMs para fazer backup ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="f3711-252">Do not schedule more than 40 VMs to back up at the same time.</span></span>
* <span data-ttu-id="f3711-253">Agende os backups de VM fora do horário de pico.</span><span class="sxs-lookup"><span data-stu-id="f3711-253">Schedule VM backups during non-peak hours.</span></span> <span data-ttu-id="f3711-254">Dessa forma, o serviço de Backup usa o IOPS para transferir dados da conta de armazenamento do cliente para o cofre.</span><span class="sxs-lookup"><span data-stu-id="f3711-254">This way the Backup service uses IOPS for transferring data from the customer storage account to the vault.</span></span>
* <span data-ttu-id="f3711-255">Certifique-se de que uma política seja aplicada às VMs distribuídas entre diferentes contas de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="f3711-255">Make sure that a policy is applied on VMs spread across different storage accounts.</span></span> <span data-ttu-id="f3711-256">Sugerimos que não mais do que 20 discos de uma única conta de armazenamento sejam protegidos pelo mesmo agendamento de backup.</span><span class="sxs-lookup"><span data-stu-id="f3711-256">We suggest no more than 20 total disks from a single storage account be protected by the same backup schedule.</span></span> <span data-ttu-id="f3711-257">Se você tiver mais de 20 discos em uma conta de armazenamento, distribua as VMs por várias políticas para obter o IOPS necessário durante a fase de transferência do processo de backup.</span><span class="sxs-lookup"><span data-stu-id="f3711-257">If you have greater than 20 disks in a storage account, spread those VMs across multiple policies to get the required IOPS during the transfer phase of the backup process.</span></span>
* <span data-ttu-id="f3711-258">Não restaure uma VM em execução no armazenamento Premium para a mesma conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="f3711-258">Do not restore a VM running on Premium storage to same storage account.</span></span> <span data-ttu-id="f3711-259">Se o processo de operação de restauração coincidir com a operação de backup, ele reduzirá o IOPS disponível para backup.</span><span class="sxs-lookup"><span data-stu-id="f3711-259">If the restore operation process coincides with the backup operation, it reduces the available IOPS for backup.</span></span>
* <span data-ttu-id="f3711-260">Para backup de VM Premium, certifique-se de que a conta de armazenamento que hospeda os discos premium tem pelo menos 50% de espaço livre para preparar instantâneo de um backup bem-sucedido.</span><span class="sxs-lookup"><span data-stu-id="f3711-260">For Premium VM backup, ensure that storage account that hosts premium disks has atleast 50% free space for staging snapshot for a successful backup.</span></span> 
* <span data-ttu-id="f3711-261">Verifique se essa versão do python em VMs do Linux habilitado para backup é 2.7</span><span class="sxs-lookup"><span data-stu-id="f3711-261">Make sure that python version on Linux VMs enabled for backup is 2.7</span></span>

## <a name="data-encryption"></a><span data-ttu-id="f3711-262">Criptografia de dados</span><span class="sxs-lookup"><span data-stu-id="f3711-262">Data encryption</span></span>
<span data-ttu-id="f3711-263">O Backup do Azure não criptografa os dados como parte do processo de backup.</span><span class="sxs-lookup"><span data-stu-id="f3711-263">Azure Backup does not encrypt data as a part of the backup process.</span></span> <span data-ttu-id="f3711-264">No entanto, você pode criptografar os dados dentro da VM e fazer backup dos dados protegidos diretamente (leia mais sobre [backup de dados criptografados](backup-azure-vms-encryption.md)).</span><span class="sxs-lookup"><span data-stu-id="f3711-264">However, you can encrypt data within the VM and back up the protected data seamlessly (read more about [backup of encrypted data](backup-azure-vms-encryption.md)).</span></span>

## <a name="calculating-the-cost-of-protected-instances"></a><span data-ttu-id="f3711-265">Calculando o custo de instâncias protegidas</span><span class="sxs-lookup"><span data-stu-id="f3711-265">Calculating the cost of protected instances</span></span>
<span data-ttu-id="f3711-266">As máquinas virtuais do Azure submetidas a backup por meio do Backup do Azure estão sujeitas aos [preços do Backup do Azure](https://azure.microsoft.com/pricing/details/backup/).</span><span class="sxs-lookup"><span data-stu-id="f3711-266">Azure virtual machines that are backed up through Azure Backup are subject to [Azure Backup pricing](https://azure.microsoft.com/pricing/details/backup/).</span></span> <span data-ttu-id="f3711-267">O cálculo de Instâncias Protegidas se baseia no tamanho *real* da máquina virtual, que é a soma de todos os dados na máquina virtual – excluindo o “disco de recursos”.</span><span class="sxs-lookup"><span data-stu-id="f3711-267">The Protected Instances calculation is based on the *actual* size of the virtual machine, which is the sum of all the data in the virtual machine--excluding the “resource disk.”</span></span>

<span data-ttu-id="f3711-268">O preço para o backup de VMs *não* se baseia no tamanho máximo com suporte para cada disco de dados anexado à máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="f3711-268">Pricing for backing up VMs is *not* based on the maximum supported size for each data disk attached to the virtual machine.</span></span> <span data-ttu-id="f3711-269">O preço baseia-se nos dados reais armazenados no disco de dados.</span><span class="sxs-lookup"><span data-stu-id="f3711-269">Pricing is based on the actual data stored in the data disk.</span></span> <span data-ttu-id="f3711-270">Da mesma forma, a cobrança do armazenamento de backup é baseada na quantidade de dados armazenados no Backup do Azure, que é a soma dos dados reais em cada ponto de recuperação.</span><span class="sxs-lookup"><span data-stu-id="f3711-270">Similarly, the backup storage bill is based on the amount of data that is stored in Azure Backup, which is the sum of the actual data in each recovery point.</span></span>

<span data-ttu-id="f3711-271">Por exemplo, considere uma máquina virtual de tamanho A2 Standard que tem dois discos de dados adicionais com um tamanho máximo de 1 TB cada.</span><span class="sxs-lookup"><span data-stu-id="f3711-271">For example, take an A2 Standard-sized virtual machine that has two additional data disks with a maximum size of 1 TB each.</span></span> <span data-ttu-id="f3711-272">A seguinte tabela fornece os dados reais armazenados em cada um desses discos:</span><span class="sxs-lookup"><span data-stu-id="f3711-272">The following table gives the actual data stored on each of these disks:</span></span>

| <span data-ttu-id="f3711-273">Tipo de disco</span><span class="sxs-lookup"><span data-stu-id="f3711-273">Disk type</span></span> | <span data-ttu-id="f3711-274">Tamanho máx.</span><span class="sxs-lookup"><span data-stu-id="f3711-274">Max size</span></span> | <span data-ttu-id="f3711-275">Dados reais presentes</span><span class="sxs-lookup"><span data-stu-id="f3711-275">Actual data present</span></span> |
| --- | --- | --- |
| <span data-ttu-id="f3711-276">Disco do sistema operacional</span><span class="sxs-lookup"><span data-stu-id="f3711-276">Operating system disk</span></span> |<span data-ttu-id="f3711-277">1023 GB</span><span class="sxs-lookup"><span data-stu-id="f3711-277">1023 GB</span></span> |<span data-ttu-id="f3711-278">17 GB</span><span class="sxs-lookup"><span data-stu-id="f3711-278">17 GB</span></span> |
| <span data-ttu-id="f3711-279">Disco local/disco de recursos</span><span class="sxs-lookup"><span data-stu-id="f3711-279">Local disk / Resource disk</span></span> |<span data-ttu-id="f3711-280">135 GB</span><span class="sxs-lookup"><span data-stu-id="f3711-280">135 GB</span></span> |<span data-ttu-id="f3711-281">5 GB (não incluído no backup)</span><span class="sxs-lookup"><span data-stu-id="f3711-281">5 GB (not included for backup)</span></span> |
| <span data-ttu-id="f3711-282">Disco de dados 1</span><span class="sxs-lookup"><span data-stu-id="f3711-282">Data disk 1</span></span> |<span data-ttu-id="f3711-283">1023 GB</span><span class="sxs-lookup"><span data-stu-id="f3711-283">1023 GB</span></span> |<span data-ttu-id="f3711-284">30 GB</span><span class="sxs-lookup"><span data-stu-id="f3711-284">30 GB</span></span> |
| <span data-ttu-id="f3711-285">Disco de dados 2</span><span class="sxs-lookup"><span data-stu-id="f3711-285">Data disk 2</span></span> |<span data-ttu-id="f3711-286">1023 GB</span><span class="sxs-lookup"><span data-stu-id="f3711-286">1023 GB</span></span> |<span data-ttu-id="f3711-287">0 GB</span><span class="sxs-lookup"><span data-stu-id="f3711-287">0 GB</span></span> |

<span data-ttu-id="f3711-288">Neste caso, o tamanho *real* da máquina virtual é de 17 GB + 30 GB + 0 GB = 47 GB.</span><span class="sxs-lookup"><span data-stu-id="f3711-288">The *actual* size of the virtual machine in this case is 17 GB + 30 GB + 0 GB = 47 GB.</span></span> <span data-ttu-id="f3711-289">Esse tamanho de Instância Protegida (47 GB) se torna a base para a fatura mensal.</span><span class="sxs-lookup"><span data-stu-id="f3711-289">This Protected Instance size (47 GB) becomes the basis for the monthly bill.</span></span> <span data-ttu-id="f3711-290">Conforme aumenta a quantidade de dados na máquina virtual, o tamanho da Instância Protegida usada para cobrança também será alterado de acordo.</span><span class="sxs-lookup"><span data-stu-id="f3711-290">As the amount of data in the virtual machine grows, the Protected Instance size used for billing changes accordingly.</span></span>

<span data-ttu-id="f3711-291">A cobrança só é iniciada quando o primeiro backup bem-sucedido é concluído.</span><span class="sxs-lookup"><span data-stu-id="f3711-291">Billing does not start until the first successful backup completes.</span></span> <span data-ttu-id="f3711-292">Neste ponto, a cobrança de Instâncias Protegidas e de Armazenamento é iniciada.</span><span class="sxs-lookup"><span data-stu-id="f3711-292">At this point, the billing for both Storage and Protected Instances begins.</span></span> <span data-ttu-id="f3711-293">A cobrança continuará desde que haja *qualquer dado de backup armazenado em um cofre* para a máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="f3711-293">Billing continues as long as there is *any backup data stored in a vault* for the virtual machine.</span></span> <span data-ttu-id="f3711-294">Se você interromper a proteção na máquina virtual, mas os dados de backup de máquina virtual existirem em um cofre, a cobrança continuará.</span><span class="sxs-lookup"><span data-stu-id="f3711-294">If you stop protection on the virtual machine, but virtual machine backup data exists in a vault, billing continues.</span></span>

<span data-ttu-id="f3711-295">A cobrança para uma máquina virtual especificada parará somente se a proteção for interrompida *e* os dados de backup forem excluídos.</span><span class="sxs-lookup"><span data-stu-id="f3711-295">Billing for a specified virtual machine stops only if the protection is stopped *and* all backup data is deleted.</span></span> <span data-ttu-id="f3711-296">Quando a proteção for interrompido e não houver nenhum trabalho de backup ativo, o tamanho do último backup bem-sucedido de VM torna-se o tamanho da instância protegida usada para a fatura mensal.</span><span class="sxs-lookup"><span data-stu-id="f3711-296">When protection stops and there are no active backup jobs, the size of the last successful VM backup becomes the Protected Instance size used for the monthly bill.</span></span>

## <a name="questions"></a><span data-ttu-id="f3711-297">Perguntas?</span><span class="sxs-lookup"><span data-stu-id="f3711-297">Questions?</span></span>
<span data-ttu-id="f3711-298">Se você tiver dúvidas ou gostaria de ver algum recurso incluído, [envie-nos seus comentários](http://aka.ms/azurebackup_feedback).</span><span class="sxs-lookup"><span data-stu-id="f3711-298">If you have questions, or if there is any feature that you would like to see included, [send us feedback](http://aka.ms/azurebackup_feedback).</span></span>

## <a name="next-steps"></a><span data-ttu-id="f3711-299">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="f3711-299">Next steps</span></span>
* [<span data-ttu-id="f3711-300">Backup de máquinas virtuais</span><span class="sxs-lookup"><span data-stu-id="f3711-300">Back up virtual machines</span></span>](backup-azure-vms.md)
* [<span data-ttu-id="f3711-301">Gerenciar o backup de máquinas virtuais</span><span class="sxs-lookup"><span data-stu-id="f3711-301">Manage virtual machine backup</span></span>](backup-azure-manage-vms.md)
* [<span data-ttu-id="f3711-302">Restaurar máquinas virtuais</span><span class="sxs-lookup"><span data-stu-id="f3711-302">Restore virtual machines</span></span>](backup-azure-restore-vms.md)
* [<span data-ttu-id="f3711-303">Solucionar problemas de backup da VM</span><span class="sxs-lookup"><span data-stu-id="f3711-303">Troubleshoot VM backup issues</span></span>](backup-azure-vms-troubleshoot.md)
