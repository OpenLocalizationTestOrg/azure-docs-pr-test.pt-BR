---
title: "Sincronização de dados offline em aplicativos móveis do Azure | Microsoft Docs"
description: "Visão geral e referência conceitual do recurso de sincronização de dados offline para aplicativos móveis do Azure"
documentationcenter: windows
author: ggailey777
manager: syntaxc4
editor: 
services: app-service\mobile
ms.assetid: 982fb683-8884-40da-96e6-77eeca2500e3
ms.service: app-service-mobile
ms.workload: mobile
ms.tgt_pltfrm: na
ms.devlang: multiple
ms.topic: article
ms.date: 10/30/2016
ms.author: glenga
ms.openlocfilehash: 8e2bd755d14319f8c66f7ae7ec64fbd10801b39d
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/29/2017
---
# <a name="offline-data-sync-in-azure-mobile-apps"></a><span data-ttu-id="7024c-103">Sincronização de dados offline em Aplicativos Móveis do Azure</span><span class="sxs-lookup"><span data-stu-id="7024c-103">Offline Data Sync in Azure Mobile Apps</span></span>
## <a name="what-is-offline-data-sync"></a><span data-ttu-id="7024c-104">O que é sincronização de dados offline?</span><span class="sxs-lookup"><span data-stu-id="7024c-104">What is offline data sync?</span></span>
<span data-ttu-id="7024c-105">A sincronização de dados offline é um recurso do SDK para cliente e servidor de Aplicativos Móveis do Azure que torna mais fácil para os desenvolvedores criarem aplicativos que funcionem sem uma conexão de rede do servidor.</span><span class="sxs-lookup"><span data-stu-id="7024c-105">Offline data sync is a client and server SDK feature of Azure Mobile Apps that makes it easy for developers to create apps that are functional without a network connection.</span></span>

<span data-ttu-id="7024c-106">Quando seu aplicativo estiver no modo offline, os usuários ainda poderão criar e modificar os dados, que serão salvos em um repositório local.</span><span class="sxs-lookup"><span data-stu-id="7024c-106">When your app is in offline mode, you can still create and modify data, which are saved to a local store.</span></span> <span data-ttu-id="7024c-107">Quando o aplicativo estiver online novamente, você pode sincronizar as alterações locais com o back-end do aplicativo Móvel do Azure.</span><span class="sxs-lookup"><span data-stu-id="7024c-107">When the app is back online, it can synchronize local changes with your Azure Mobile App backend.</span></span> <span data-ttu-id="7024c-108">O recurso também inclui suporte para detectar conflitos quando o mesmo registro é alterado no cliente e no back-end.</span><span class="sxs-lookup"><span data-stu-id="7024c-108">The feature also includes support for detecting conflicts when the same record is changed on both the client and the backend.</span></span> <span data-ttu-id="7024c-109">Os conflitos podem ser tratados no servidor ou cliente.</span><span class="sxs-lookup"><span data-stu-id="7024c-109">Conflicts can then be handled either on the server or the client.</span></span>

<span data-ttu-id="7024c-110">A sincronização offline proporciona vários benefícios:</span><span class="sxs-lookup"><span data-stu-id="7024c-110">Offline sync has several benefits:</span></span>

* <span data-ttu-id="7024c-111">Melhora a capacidade de resposta do aplicativo armazenando em cache os dados do servidor localmente no dispositivo</span><span class="sxs-lookup"><span data-stu-id="7024c-111">Improve app responsiveness by caching server data locally on the device</span></span>
* <span data-ttu-id="7024c-112">Crie aplicativos robustos que permanecem úteis quando há problemas de rede</span><span class="sxs-lookup"><span data-stu-id="7024c-112">Create robust apps that remain useful when there are network issues</span></span>
* <span data-ttu-id="7024c-113">Permite que usuários finais criem e modifiquem dados mesmo quando não há acesso à rede, com suporte para cenários com pouca ou nenhuma conectividade</span><span class="sxs-lookup"><span data-stu-id="7024c-113">Allow end users to create and modify data even when there is no network access, supporting scenarios with little or no connectivity</span></span>
* <span data-ttu-id="7024c-114">Sincroniza dados entre vários dispositivos e detecta conflitos quando o mesmo registro é modificado por dois dispositivos</span><span class="sxs-lookup"><span data-stu-id="7024c-114">Sync data across multiple devices and detect conflicts when the same record is modified by two devices</span></span>
* <span data-ttu-id="7024c-115">Limite o uso de rede em redes de alta latência ou monitoradas</span><span class="sxs-lookup"><span data-stu-id="7024c-115">Limit network use on high-latency or metered networks</span></span>

<span data-ttu-id="7024c-116">Os tutoriais a seguir mostram como adicionar sincronização offline para os clientes móveis usando aplicativos móveis do Azure:</span><span class="sxs-lookup"><span data-stu-id="7024c-116">The following tutorials show how to add offline sync to your mobile clients using Azure Mobile Apps:</span></span>

* <span data-ttu-id="7024c-117">[Android: Habilitar a sincronização offline]</span><span class="sxs-lookup"><span data-stu-id="7024c-117">[Android: Enable offline sync]</span></span>
* [<span data-ttu-id="7024c-118">Apache Cordova: habilitar sincronização offline</span><span class="sxs-lookup"><span data-stu-id="7024c-118">Apache Cordova: Enable offline sync</span></span>](app-service-mobile-cordova-get-started-offline-data.md)
* <span data-ttu-id="7024c-119">[iOS: Habilitar a sincronização offline]</span><span class="sxs-lookup"><span data-stu-id="7024c-119">[iOS: Enable offline sync]</span></span>
* <span data-ttu-id="7024c-120">[Xamarin iOS: Habilitar a sincronização offline]</span><span class="sxs-lookup"><span data-stu-id="7024c-120">[Xamarin iOS: Enable offline sync]</span></span>
* <span data-ttu-id="7024c-121">[Xamarin Android: Habilitar a sincronização offline]</span><span class="sxs-lookup"><span data-stu-id="7024c-121">[Xamarin Android: Enable offline sync]</span></span>
* [<span data-ttu-id="7024c-122">Xamarin.Forms: habilitar a sincronização offline</span><span class="sxs-lookup"><span data-stu-id="7024c-122">Xamarin.Forms: Enable offline sync</span></span>](app-service-mobile-xamarin-forms-get-started-offline-data.md)
* <span data-ttu-id="7024c-123">[Plataforma Universal do Windows: habilitar a sincronização offline]</span><span class="sxs-lookup"><span data-stu-id="7024c-123">[Universal Windows Platform: Enable offline sync]</span></span>

## <a name="what-is-a-sync-table"></a><span data-ttu-id="7024c-124">O que é uma tabela de sincronização?</span><span class="sxs-lookup"><span data-stu-id="7024c-124">What is a sync table?</span></span>
<span data-ttu-id="7024c-125">Para acessar o ponto de extremidade "/tables", os SDKs do cliente móvel do Azure fornecem interfaces como `IMobileServiceTable` (SDK do cliente .NET) ou `MSTable` (cliente iOS).</span><span class="sxs-lookup"><span data-stu-id="7024c-125">To access the "/tables" endpoint, the Azure Mobile client SDKs provide interfaces such as `IMobileServiceTable` (.NET client SDK) or `MSTable` (iOS client).</span></span> <span data-ttu-id="7024c-126">Essas APIs se conectam diretamente ao back-end do Aplicativo Móvel do Azure e falharão se o dispositivo cliente não tiver uma conexão de rede.</span><span class="sxs-lookup"><span data-stu-id="7024c-126">These APIs connect directly to the Azure Mobile App backend and fail if the client device does not have a network connection.</span></span>

<span data-ttu-id="7024c-127">Para oferecer suporte a uso offline, seu aplicativo deve usar as APIs de *tabela de sincronização*, como `IMobileServiceSyncTable` (SDK do cliente .NET) ou `MSSyncTable` (cliente iOS).</span><span class="sxs-lookup"><span data-stu-id="7024c-127">To support offline use, your app should instead use the *sync table* APIs, such as `IMobileServiceSyncTable` (.NET client SDK) or `MSSyncTable` (iOS client).</span></span> <span data-ttu-id="7024c-128">As mesmas operações CRUD (Criar, Ler, Atualizar e Excluir) funcionam com as APIs de tabela de sincronização, exceto que agora elas leem ou gravam em um *repositório local*.</span><span class="sxs-lookup"><span data-stu-id="7024c-128">All the same CRUD operations (Create, Read, Update, Delete) work against sync table APIs, except now they read from or write to a *local store*.</span></span> <span data-ttu-id="7024c-129">Antes de qualquer operação de tabela de sincronização poder ser executada, o armazenamento local deve ser inicializado.</span><span class="sxs-lookup"><span data-stu-id="7024c-129">Before any sync table operations can be performed, the local store must be initialized.</span></span>

## <a name="what-is-a-local-store"></a><span data-ttu-id="7024c-130">O que é um armazenamento local?</span><span class="sxs-lookup"><span data-stu-id="7024c-130">What is a local store?</span></span>
<span data-ttu-id="7024c-131">Um armazenamento local é a camada de persistência de dados no dispositivo cliente.</span><span class="sxs-lookup"><span data-stu-id="7024c-131">A local store is the data persistence layer on the client device.</span></span> <span data-ttu-id="7024c-132">Os SDKs de cliente de aplicativos móveis do Azure oferecem uma implementação padrão do armazenamento local.</span><span class="sxs-lookup"><span data-stu-id="7024c-132">The Azure Mobile Apps client SDKs provide a default local store implementation.</span></span> <span data-ttu-id="7024c-133">No Windows, Xamarin e Android, ele se baseia em SQLite.</span><span class="sxs-lookup"><span data-stu-id="7024c-133">On Windows, Xamarin and Android, it is based on SQLite.</span></span> <span data-ttu-id="7024c-134">No iOS, ele se baseia em Core Data.</span><span class="sxs-lookup"><span data-stu-id="7024c-134">On iOS, it is based on Core Data.</span></span>

<span data-ttu-id="7024c-135">Para usar a implementação baseada em SQLite no Windows Phone ou Windows Store 8.1, é preciso instalar uma extensão do SQLite.</span><span class="sxs-lookup"><span data-stu-id="7024c-135">To use the SQLite-based implementation on Windows Phone or Windows Store 8.1, you need to install a SQLite extension.</span></span> <span data-ttu-id="7024c-136">Para obter mais detalhes, veja [Plataforma Universal do Windows: habilitar a sincronização offline]. Android e iOS são fornecidos com uma versão do SQLite no próprio sistema operacional do dispositivo; portanto, não é necessário fazer referência a sua própria versão do SQLite.</span><span class="sxs-lookup"><span data-stu-id="7024c-136">For more information, see [Universal Windows Platform: Enable offline sync]. Android and iOS ship with a version of SQLite in the device operating system itself, so it is not necessary to reference your own version of SQLite.</span></span>

<span data-ttu-id="7024c-137">Os desenvolvedores também podem implementar seu próprio armazenamento local.</span><span class="sxs-lookup"><span data-stu-id="7024c-137">Developers can also implement their own local store.</span></span> <span data-ttu-id="7024c-138">Por exemplo, se você quiser armazenar dados em um formato criptografado no cliente móvel, poderá definir um armazenamento local que usa SQLCipher para criptografia.</span><span class="sxs-lookup"><span data-stu-id="7024c-138">For instance, if you wish to store data in an encrypted format on the mobile client, you can define a local store that uses SQLCipher for encryption.</span></span>

## <a name="what-is-a-sync-context"></a><span data-ttu-id="7024c-139">O que é um contexto de sincronização?</span><span class="sxs-lookup"><span data-stu-id="7024c-139">What is a sync context?</span></span>
<span data-ttu-id="7024c-140">Um *contexto de sincronização* é associado a um objeto de cliente móvel (como `IMobileServiceClient` ou `MSClient`) e rastreia as alterações que são feitas com tabelas de sincronização.</span><span class="sxs-lookup"><span data-stu-id="7024c-140">A *sync context* is associated with a mobile client object (such as `IMobileServiceClient` or `MSClient`) and tracks changes that are made with sync tables.</span></span> <span data-ttu-id="7024c-141">O contexto de sincronização mantém uma *fila de operação* que conserva uma lista ordenada de operações CUD (Criar, Atualizar e Excluir) que é posteriormente enviada ao servidor.</span><span class="sxs-lookup"><span data-stu-id="7024c-141">The sync context maintains an *operation queue*, which keeps an ordered list of CUD operations (Create, Update, Delete) that is later be sent to the server.</span></span>

<span data-ttu-id="7024c-142">Um armazenamento local é associado ao contexto de sincronização usando um método initialize como `IMobileServicesSyncContext.InitializeAsync(localstore)` no [SDK do cliente do .NET].</span><span class="sxs-lookup"><span data-stu-id="7024c-142">A local store is associated with the sync context using an initialize method such as `IMobileServicesSyncContext.InitializeAsync(localstore)` in the [.NET client SDK].</span></span>

## <span data-ttu-id="7024c-143"><a name="how-sync-works"></a>Como a sincronização offline funciona</span><span class="sxs-lookup"><span data-stu-id="7024c-143"><a name="how-sync-works"></a>How offline synchronization works</span></span>
<span data-ttu-id="7024c-144">Ao usar tabelas de sincronização, o código do cliente controla quando as alterações locais são sincronizadas com um back-end do aplicativo móvel do Azure.</span><span class="sxs-lookup"><span data-stu-id="7024c-144">When using sync tables, your client code controls when local changes are synchronized with an Azure Mobile App backend.</span></span> <span data-ttu-id="7024c-145">Nada será enviado ao back-end até que haja uma chamada para alterações locais de *push* .</span><span class="sxs-lookup"><span data-stu-id="7024c-145">Nothing is sent to the backend until there is a call to *push* local changes.</span></span> <span data-ttu-id="7024c-146">Da mesma forma, o armazenamento local é preenchido com dados novos somente quando há uma chamada para dados de *pull* .</span><span class="sxs-lookup"><span data-stu-id="7024c-146">Similarly, the local store is populated with new data only when there is a call to *pull* data.</span></span>

* <span data-ttu-id="7024c-147">**Push**: push é uma operação no contexto de sincronização e envia todas as alterações de CUD desde o último envio por push.</span><span class="sxs-lookup"><span data-stu-id="7024c-147">**Push**: Push is an operation on the sync context and sends all CUD changes since the last push.</span></span> <span data-ttu-id="7024c-148">Observe que não é possível enviar apenas alterações de uma tabela individual, pois as operações poderiam ser enviadas fora da ordem.</span><span class="sxs-lookup"><span data-stu-id="7024c-148">Note that it is not possible to send only an individual table's changes, because otherwise operations could be sent out of order.</span></span> <span data-ttu-id="7024c-149">O envio por push executa uma série de chamadas REST ao back-end do seu aplicativo móvel do Azure, que por sua vez, modifica o banco de dados do servidor.</span><span class="sxs-lookup"><span data-stu-id="7024c-149">Push executes a series of REST calls to your Azure Mobile App backend, which in turn modifies your server database.</span></span>
* <span data-ttu-id="7024c-150">**Pull**: o pull é executado por tabela e pode ser personalizado com uma consulta para recuperar apenas um subconjunto dos dados do servidor.</span><span class="sxs-lookup"><span data-stu-id="7024c-150">**Pull**: Pull is performed on a per-table basis and can be customized with a query to retrieve only a subset of the server data.</span></span> <span data-ttu-id="7024c-151">Os SDKs de cliente móvel do Azure inserem então os dados resultantes no armazenamento local.</span><span class="sxs-lookup"><span data-stu-id="7024c-151">The Azure Mobile client SDKs then insert the resulting data into the local store.</span></span>
* <span data-ttu-id="7024c-152">**Pushes implícitos**: se um pull for executado em uma tabela que tenha atualizações locais pendentes, o pull primeiro executará um `push()` no contexto de sincronização.</span><span class="sxs-lookup"><span data-stu-id="7024c-152">**Implicit Pushes**: If a pull is executed against a table that has pending local updates, the pull first executes a `push()` on the sync context.</span></span> <span data-ttu-id="7024c-153">Esse envio por push ajuda a minimizar conflitos entre as alterações que já estão na fila e novos dados do servidor.</span><span class="sxs-lookup"><span data-stu-id="7024c-153">This push helps minimize conflicts between changes that are already queued and new data from the server.</span></span>
* <span data-ttu-id="7024c-154">**Sincronização Incremental**: o primeiro parâmetro para a operação de pull é um *nome de consulta* que é usado apenas no cliente.</span><span class="sxs-lookup"><span data-stu-id="7024c-154">**Incremental Sync**: the first parameter to the pull operation is a *query name* that is used only on the client.</span></span> <span data-ttu-id="7024c-155">Se você usar um nome de consulta não nulo, o SDK móvel do Azure executará uma *sincronização incremental*. Cada vez que uma operação de pull retornar um conjunto de resultados, o carimbo de data/hora `updatedAt` mais recente desse conjunto de resultados será armazenado nas tabelas do sistema local do SDK.</span><span class="sxs-lookup"><span data-stu-id="7024c-155">If you use a non-null query name, the Azure Mobile SDK performs an *incremental sync*. Each time a pull operation returns a set of results, the latest `updatedAt` timestamp from that result set is stored in the SDK local system tables.</span></span> <span data-ttu-id="7024c-156">As operações de pull subsequentes recuperarão somente registros após esse carimbo de data/hora.</span><span class="sxs-lookup"><span data-stu-id="7024c-156">Subsequent pull operations retrieve only records after that timestamp.</span></span>

  <span data-ttu-id="7024c-157">Para usar a sincronização incremental, o servidor deve retornar valores `updatedAt` significativos e também deve oferecer suporte à classificação por este campo.</span><span class="sxs-lookup"><span data-stu-id="7024c-157">To use incremental sync, your server must return meaningful `updatedAt` values and must also support sorting by this field.</span></span> <span data-ttu-id="7024c-158">No entanto, como o SDK adiciona sua própria classificação no campo updatedAt, não é possível usar uma consulta de pull que tem sua própria cláusula `orderBy` .</span><span class="sxs-lookup"><span data-stu-id="7024c-158">However, since the SDK adds its own sort on the updatedAt field, you cannot use a pull query that has its own `orderBy` clause.</span></span>

  <span data-ttu-id="7024c-159">O nome da consulta pode ser qualquer sequência de caracteres que você escolher, mas deve ser exclusivo para cada consulta lógica em seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="7024c-159">The query name can be any string you choose, but it must be unique for each logical query in your app.</span></span>
  <span data-ttu-id="7024c-160">Caso contrário, operações de pull diferentes poderiam substituir o mesmo carimbo de data/hora de sincronização incremental e as consultas poderiam retornar resultados incorretos.</span><span class="sxs-lookup"><span data-stu-id="7024c-160">Otherwise, different pull operations could overwrite the same incremental sync timestamp and your queries can return incorrect results.</span></span>

  <span data-ttu-id="7024c-161">Se a consulta tiver um parâmetro, uma maneira de criar um nome de consulta exclusivo é incorporar o valor do parâmetro.</span><span class="sxs-lookup"><span data-stu-id="7024c-161">If the query has a parameter, one way to create a unique query name is to incorporate the parameter value.</span></span>
  <span data-ttu-id="7024c-162">Por exemplo, se você estiver filtrando userid, o nome da consulta pode ser da seguinte maneira (em C#):</span><span class="sxs-lookup"><span data-stu-id="7024c-162">For instance, if you are filtering on userid, your query name could be as follows (in C#):</span></span>

        await todoTable.PullAsync("todoItems" + userid,
            syncTable.Where(u => u.UserId == userid));

  <span data-ttu-id="7024c-163">Se você deseja recusar a sincronização incremental, passe `null` como a ID da consulta.</span><span class="sxs-lookup"><span data-stu-id="7024c-163">If you want to opt out of incremental sync, pass `null` as the query ID.</span></span> <span data-ttu-id="7024c-164">Nesse caso, todos os registros são recuperados em cada chamada de `PullAsync`, o que é potencialmente ineficiente.</span><span class="sxs-lookup"><span data-stu-id="7024c-164">In this case, all records are retrieved on every call to `PullAsync`, which is potentially inefficient.</span></span>
* <span data-ttu-id="7024c-165">**Limpeza**: é possível limpar o conteúdo do armazenamento local usando `IMobileServiceSyncTable.PurgeAsync`.</span><span class="sxs-lookup"><span data-stu-id="7024c-165">**Purging**: You can clear the contents of the local store using `IMobileServiceSyncTable.PurgeAsync`.</span></span>
  <span data-ttu-id="7024c-166">Pode ser necessário realizar limpeza se você tiver dados obsoletos no banco de dados do cliente ou se quiser descartar todas as alterações pendentes.</span><span class="sxs-lookup"><span data-stu-id="7024c-166">Purging may be necessary if you have stale data in the client database, or if you wish to discard all pending changes.</span></span>

  <span data-ttu-id="7024c-167">Uma limpeza remove uma tabela do repositório local.</span><span class="sxs-lookup"><span data-stu-id="7024c-167">A purge clears a table from the local store.</span></span> <span data-ttu-id="7024c-168">Se houver operações que estão aguardando a sincronização com o banco de dados do servidor, a limpeza gerará uma exceção, a menos que o parâmetro *forçar limpeza* esteja definido.</span><span class="sxs-lookup"><span data-stu-id="7024c-168">If there are operations awaiting synchronization with the server database, the purge throws an exception unless the *force purge* parameter is set.</span></span>

  <span data-ttu-id="7024c-169">Como exemplo de dados obsoletos no cliente, suponha que no exemplo "lista de tarefas", Device1 mantém apenas os itens que não foram concluídos.</span><span class="sxs-lookup"><span data-stu-id="7024c-169">As an example of stale data on the client, suppose in the "todo list" example, Device1 only pulls items that are not completed.</span></span> <span data-ttu-id="7024c-170">Um todoitem “Comprar leite” é marcado como concluído no servidor por outro dispositivo.</span><span class="sxs-lookup"><span data-stu-id="7024c-170">A todoitem "Buy milk" is marked completed on the server by another device.</span></span> <span data-ttu-id="7024c-171">No entanto, o Device1 ainda terá o todoitem “Comprar leite” no repositório local, pois ele só está obtendo itens que não foram marcados como concluídos.</span><span class="sxs-lookup"><span data-stu-id="7024c-171">However, Device1 still has the "Buy milk" todoitem in local store because it is only pulling items that are not marked complete.</span></span> <span data-ttu-id="7024c-172">Uma limpeza limpa esse item obsoleto.</span><span class="sxs-lookup"><span data-stu-id="7024c-172">A purge clears this stale item.</span></span>

## <a name="next-steps"></a><span data-ttu-id="7024c-173">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="7024c-173">Next steps</span></span>
* <span data-ttu-id="7024c-174">[iOS: Habilitar a sincronização offline]</span><span class="sxs-lookup"><span data-stu-id="7024c-174">[iOS: Enable offline sync]</span></span>
* <span data-ttu-id="7024c-175">[Xamarin iOS: Habilitar a sincronização offline]</span><span class="sxs-lookup"><span data-stu-id="7024c-175">[Xamarin iOS: Enable offline sync]</span></span>
* <span data-ttu-id="7024c-176">[Xamarin Android: Habilitar a sincronização offline]</span><span class="sxs-lookup"><span data-stu-id="7024c-176">[Xamarin Android: Enable offline sync]</span></span>
* <span data-ttu-id="7024c-177">[Plataforma Universal do Windows: habilitar a sincronização offline]</span><span class="sxs-lookup"><span data-stu-id="7024c-177">[Universal Windows Platform: Enable offline sync]</span></span>

<!-- Links -->
[SDK do cliente do .NET]: app-service-mobile-dotnet-how-to-use-client-library.md
[Android: Habilitar a sincronização offline]: app-service-mobile-android-get-started-offline-data.md
[iOS: Habilitar a sincronização offline]: app-service-mobile-ios-get-started-offline-data.md
[Xamarin iOS: Habilitar a sincronização offline]: app-service-mobile-xamarin-ios-get-started-offline-data.md
[Xamarin Android: Habilitar a sincronização offline]: app-service-mobile-xamarin-android-get-started-offline-data.md
[Plataforma Universal do Windows: habilitar a sincronização offline]: app-service-mobile-windows-store-dotnet-get-started-offline-data.md
