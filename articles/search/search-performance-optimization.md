---
title: "Considerações de desempenho e otimização do Azure Search | Microsoft Docs"
description: Ajustar o desempenho da Pesquisa do Azure e configurar o dimensionamento ideal
services: search
documentationcenter: 
author: LiamCavanagh
manager: pablocas
editor: 
ms.assetid: 4d3cd864-29d2-4921-be0d-a3f1a819de46
ms.service: search
ms.devlang: rest-api
ms.workload: search
ms.topic: article
ms.tgt_pltfrm: na
ms.date: 05/01/2017
ms.author: liamca
ms.openlocfilehash: f4e371fc16bc57e6963f1ec51c0ea864fa568f0c
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="azure-search-performance-and-optimization-considerations"></a><span data-ttu-id="fbbee-103">Considerações de desempenho e otimização da Pesquisa do Azure</span><span class="sxs-lookup"><span data-stu-id="fbbee-103">Azure Search performance and optimization considerations</span></span>
<span data-ttu-id="fbbee-104">Uma boa experiência de pesquisa é essencial para o sucesso de muitos aplicativos móveis e da Web.</span><span class="sxs-lookup"><span data-stu-id="fbbee-104">A great search experience is a key to success for many mobile and web applications.</span></span> <span data-ttu-id="fbbee-105">De imóveis a feiras de carros usados até catálogos online, uma pesquisa rápida e resultados relevantes afetarão a experiência do cliente.</span><span class="sxs-lookup"><span data-stu-id="fbbee-105">From real estate, to used car marketplaces to online catalogs, fast search and relevant results will affect the customer experience.</span></span> <span data-ttu-id="fbbee-106">Este documento tem como objetivo ajuda a descobrir as práticas recomendadas para obter o máximo da Pesquisa do Azure, especialmente para cenários avançados com requisitos sofisticados de escalabilidade, suporte a vários idiomas ou classificação personalizada.</span><span class="sxs-lookup"><span data-stu-id="fbbee-106">This document is intended to help you discover best practices for how to get the most out of Azure Search, especially for advanced scenarios with sophisticated requirements for scalability, multi-language support, or custom ranking.</span></span>  <span data-ttu-id="fbbee-107">Além disso, este documento descreve componentes internos e cobre abordagens que funcionam bem em aplicativos reais de clientes.</span><span class="sxs-lookup"><span data-stu-id="fbbee-107">In addition, this document outlines internals and covers approaches that work effectively in real-world customer apps.</span></span>

## <a name="performance-and-scale-tuning-for-search-services"></a><span data-ttu-id="fbbee-108">Ajuste de desempenho e escala para serviços de pesquisa</span><span class="sxs-lookup"><span data-stu-id="fbbee-108">Performance and scale tuning for Search services</span></span>
<span data-ttu-id="fbbee-109">Estamos todos acostumados com mecanismos de pesquisa como o Bing e o Google e com o ótimo desempenho que eles oferecem.</span><span class="sxs-lookup"><span data-stu-id="fbbee-109">We are all used to search engines such as Bing and Google and the high performance they offer.</span></span>  <span data-ttu-id="fbbee-110">Como resultado, quando os clientes usam seu aplicativo móvel ou da Web habilitado para pesquisa, eles esperam características de desempenho semelhantes.</span><span class="sxs-lookup"><span data-stu-id="fbbee-110">As a result, when customers use your search-enabled web or mobile application, they will expect similar performance characteristics.</span></span>  <span data-ttu-id="fbbee-111">Ao otimizar o desempenho da pesquisa, uma das abordagens recomendadas é se concentrar na latência, que é o tempo que uma consulta demora para ser concluída e retornar resultados.</span><span class="sxs-lookup"><span data-stu-id="fbbee-111">When optimizing for search performance, one of the best approaches is to focus on latency, which is the time a query takes to complete and return results.</span></span>  <span data-ttu-id="fbbee-112">Ao otimização a latência de pesquisa é importante:</span><span class="sxs-lookup"><span data-stu-id="fbbee-112">When optimizing for search latency it is important to:</span></span>

1. <span data-ttu-id="fbbee-113">Escolher uma latência de destino (ou a quantidade máxima de tempo) que uma solicitação de pesquisa normal deve demorar para ser concluída.</span><span class="sxs-lookup"><span data-stu-id="fbbee-113">Pick a target latency (or maximum amount of time) that a typical search request should take to complete.</span></span>
2. <span data-ttu-id="fbbee-114">Criar e testar uma carga de trabalho real com o serviço de pesquisa com um conjunto de dados realista a fim de medir essas taxas de latência.</span><span class="sxs-lookup"><span data-stu-id="fbbee-114">Create and test a real workload against your search service with a realistic dataset to measure these latency rates.</span></span>
3. <span data-ttu-id="fbbee-115">Comece com um número baixo de QPS (consultas por segundo) e continue a aumentar o número executado no teste de até que a latência da consulta fique abaixo da latência de destino definida.</span><span class="sxs-lookup"><span data-stu-id="fbbee-115">Start with a low number of queries per second (QPS) and continue to increase the number executed in the test until the query latency drops below the defined target latency.</span></span>  <span data-ttu-id="fbbee-116">Este é um parâmetro de comparação importante para ajudar você a planejar a escala à medida que o uso de seu aplicativo cresce.</span><span class="sxs-lookup"><span data-stu-id="fbbee-116">This is an important benchmark to help you plan for scale as your application grows in usage.</span></span>
4. <span data-ttu-id="fbbee-117">Sempre que possível, reutilize as conexões HTTP.</span><span class="sxs-lookup"><span data-stu-id="fbbee-117">Wherever possible, reuse HTTP connections.</span></span>  <span data-ttu-id="fbbee-118">Se você estiver usando o SDK .NET da Pesquisa do Azure, significa que você deve reutilizar uma instância ou instância do [SearchIndexClient](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.searchindexclient) , e se você estiver usando a API REST, reutilize um único HttpClient.</span><span class="sxs-lookup"><span data-stu-id="fbbee-118">If you are using the Azure Search .NET SDK, this means you should reuse an instance or [SearchIndexClient](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.searchindexclient) instance, and if you are using the REST API, you should reuse a single HttpClient.</span></span>

<span data-ttu-id="fbbee-119">Ao criar essas cargas de trabalho de teste, tenha em mente algumas características da Pesquisa do Azure:</span><span class="sxs-lookup"><span data-stu-id="fbbee-119">While creating these test workloads, there are some characteristics of Azure Search to keep in mind:</span></span>

1. <span data-ttu-id="fbbee-120">É possível obter tantas consultas de pesquisa ao mesmo tempo, que os recursos disponíveis em seu serviço de Pesquisa do Azure ficarão sobrecarregados.</span><span class="sxs-lookup"><span data-stu-id="fbbee-120">It is possible to push so many search queries at one time, that the resources available in your Azure Search service will be overwhelmed.</span></span>  <span data-ttu-id="fbbee-121">Quando isso acontecer, você verá códigos de resposta HTTP 503.</span><span class="sxs-lookup"><span data-stu-id="fbbee-121">When this happens, you will see HTTP 503 response codes.</span></span>  <span data-ttu-id="fbbee-122">Por esse motivo, é melhor começar com vários intervalos de solicitações de pesquisa para ver as diferenças nas taxas de latência conforme você adiciona mais solicitações de pesquisa.</span><span class="sxs-lookup"><span data-stu-id="fbbee-122">For this reason, it is best to start with various ranges of search requests to see the differences in latency rates as you add more search requests.</span></span>
2. <span data-ttu-id="fbbee-123">O carregamento de conteúdo na Pesquisa do Azure afetará o desempenho geral e a latência do serviço de Pesquisa do Azure.</span><span class="sxs-lookup"><span data-stu-id="fbbee-123">Uploading of content to Azure Search will impact the overall performance and latency of the Azure Search service.</span></span>  <span data-ttu-id="fbbee-124">Se você pretende enviar dados enquanto os usuários estão executando pesquisas, é importante levar em conta essa carga de trabalho em seus testes.</span><span class="sxs-lookup"><span data-stu-id="fbbee-124">If you expect to send data while users are performing searches, it is important to take this workload into account in your tests.</span></span>
3. <span data-ttu-id="fbbee-125">Nem todas as consultas de pesquisa serão executadas com os mesmos níveis de desempenho.</span><span class="sxs-lookup"><span data-stu-id="fbbee-125">Not every search query will perform at the same performance levels.</span></span>  <span data-ttu-id="fbbee-126">Por exemplo, uma sugestão de pesquisa ou pesquisa de documento normalmente será executada mais rápido do que uma consulta com um número considerável de facetas e filtros.</span><span class="sxs-lookup"><span data-stu-id="fbbee-126">For example, a document lookup or search suggestion will typically perform faster than a query with a significant number of facets and filters.</span></span>  <span data-ttu-id="fbbee-127">É melhor levar em conta as diversas consultas que você espera ver ao criar seus testes.</span><span class="sxs-lookup"><span data-stu-id="fbbee-127">It is best to take the various queries you expect to see into account when building your tests.</span></span>  
4. <span data-ttu-id="fbbee-128">A variação das solicitações de pesquisa é importante, pois se você executar continuamente as mesmas solicitações de pesquisa, o armazenamento de dados em cache começará a fazer o desempenho parecer melhor que pode ser com um conjunto de consultas mais diferentes.</span><span class="sxs-lookup"><span data-stu-id="fbbee-128">Variation of search requests is important because if you continually execute the same search requests, caching of data will start to make performance look better than it might with a more disparate query set.</span></span>

> [!NOTE]
> <span data-ttu-id="fbbee-129">O [Teste de Carga no Visual Studio](https://www.visualstudio.com/docs/test/performance-testing/run-performance-tests-app-before-release) é uma boa maneira de executar os testes de parâmetros de comparação que permitem a você executar solicitações HTTP da forma necessária para executar consultas no Azure Search e permite a paralelização de solicitações.</span><span class="sxs-lookup"><span data-stu-id="fbbee-129">[Visual Studio Load Testing](https://www.visualstudio.com/docs/test/performance-testing/run-performance-tests-app-before-release) is a really good way to perform your benchmark tests as it allows you to execute HTTP requests as you would need for executing queries against Azure Search and enables parallelization of requests.</span></span>
> 
> 

## <a name="scaling-azure-search-for-high-query-rates-and-throttled-requests"></a><span data-ttu-id="fbbee-130">Dimensionamento da Pesquisa do Azure para taxas de consulta altas e solicitações limitadas</span><span class="sxs-lookup"><span data-stu-id="fbbee-130">Scaling Azure Search for high query rates and throttled requests</span></span>
<span data-ttu-id="fbbee-131">Quando você estiver recebendo muitas solicitações limitadas ou ultrapassar suas taxas de latência de destino de uma carga de consulta maior, você pode diminuir essas taxas de latência usando uma dentre duas maneiras:</span><span class="sxs-lookup"><span data-stu-id="fbbee-131">When you are receiving too many throttled requests or exceed your target latency rates from an increased query load, you can look to decrease latency rates in one of two ways:</span></span>

1. <span data-ttu-id="fbbee-132">**Aumentar as Réplicas:** uma réplica é semelhante a uma cópia dos seus dados, permitindo que o Azure Search balanceie a carga de solicitações em várias cópias.</span><span class="sxs-lookup"><span data-stu-id="fbbee-132">**Increase Replicas:**  A replica is like a copy of your data allowing Azure Search to load balance requests against the multiple copies.</span></span>  <span data-ttu-id="fbbee-133">Todo o balanceamento de carga e a replicação de dados entre as réplicas é gerenciado pela Pesquisa do Azure, e você pode alterar o número de réplicas alocadas para o serviço a qualquer momento.</span><span class="sxs-lookup"><span data-stu-id="fbbee-133">All load balancing and replication of data across replicas is managed by Azure Search and you can alter the number of replicas allocated for your service at any time.</span></span>  <span data-ttu-id="fbbee-134">É possível alocar até 12 réplicas em um serviço de pesquisa Standard e três réplicas em um serviço de pesquisa Básico.</span><span class="sxs-lookup"><span data-stu-id="fbbee-134">You can allocate up to 12 replicas in a Standard search service and 3 replicas in a Basic search service.</span></span> <span data-ttu-id="fbbee-135">As réplicas podem ser ajustadas no [Portal do Azure](search-create-service-portal.md) ou [PowerShell](search-manage-powershell.md).</span><span class="sxs-lookup"><span data-stu-id="fbbee-135">Replicas can be adjusted either from the [Azure portal](search-create-service-portal.md) or [PowerShell](search-manage-powershell.md).</span></span>
2. <span data-ttu-id="fbbee-136">**Aumentar a Camada de Pesquisa:** o Azure Search vem em [várias camadas](https://azure.microsoft.com/pricing/details/search/), e cada uma dessas camadas oferece níveis diferentes de desempenho.</span><span class="sxs-lookup"><span data-stu-id="fbbee-136">**Increase Search Tier:**  Azure Search comes in a [number of tiers](https://azure.microsoft.com/pricing/details/search/) and each of these tiers offers different levels of performance.</span></span>  <span data-ttu-id="fbbee-137">Em alguns casos, você pode ter tantas consultas que a camada na qual você está não consegue fornecer taxas latência suficientemente baixas, mesmo quando as réplicas são maximizadas.</span><span class="sxs-lookup"><span data-stu-id="fbbee-137">In some cases, you may have so many queries that the tier you are on cannot provide sufficiently low latency rates, even when replicas are maxed out.</span></span>  <span data-ttu-id="fbbee-138">Nesse caso, convém utilizar uma das camadas mais altas de pesquisa, como a camada S3 da Pesquisa do Azure, que é adequada para cenários com uma grande quantidade de documentos e cargas de trabalho extremamente altas.</span><span class="sxs-lookup"><span data-stu-id="fbbee-138">In this case, you may want to consider leveraging one of the higher search tiers such as the Azure Search S3 tier that is well suited for scenarios with large numbers of documents and extremely high query workloads.</span></span>

## <a name="scaling-azure-search-for-slow-individual-queries"></a><span data-ttu-id="fbbee-139">Dimensionamento da Pesquisa do Azure para consultas individuais lentas</span><span class="sxs-lookup"><span data-stu-id="fbbee-139">Scaling Azure Search for slow individual queries</span></span>
<span data-ttu-id="fbbee-140">Outro motivo de as taxas de latência serem lentas é uma única consulta demorar muito para ser concluída.</span><span class="sxs-lookup"><span data-stu-id="fbbee-140">Another reason why latency rates can be slow is from a single query taking too long to complete.</span></span>  <span data-ttu-id="fbbee-141">Nesse caso, a adição de réplicas não melhorará as taxas de latência.</span><span class="sxs-lookup"><span data-stu-id="fbbee-141">In this case, adding replicas will not improve latency rates.</span></span>  <span data-ttu-id="fbbee-142">Para esses casos, há duas opções disponíveis:</span><span class="sxs-lookup"><span data-stu-id="fbbee-142">For this case there are two options available:</span></span>

1. <span data-ttu-id="fbbee-143">**Aumentar Partições** Uma partição é um mecanismo para dividir os dados entre recursos extras.</span><span class="sxs-lookup"><span data-stu-id="fbbee-143">**Increase Partitions** A partition is a mechanism for splitting your data across extra resources.</span></span>  <span data-ttu-id="fbbee-144">Por esse motivo, quando você adiciona uma segunda partição, seus dados são divididos em dois.</span><span class="sxs-lookup"><span data-stu-id="fbbee-144">For this reason, when you add a second partition, your data gets split into two.</span></span>  <span data-ttu-id="fbbee-145">Uma terceira partição divide o índice em três etc.  Isso também tem o efeito de, em alguns casos, as consultas lentas serem executadas com mais rapidez devido à paralelização da computação.</span><span class="sxs-lookup"><span data-stu-id="fbbee-145">A third partition splits your index into three, etc.  This also has the effect that in some cases, slow queries will perform faster due to the parallelization of computation.</span></span>  <span data-ttu-id="fbbee-146">Há alguns exemplos nos quais temos visto essa paralelização funcionar muito bem com consultas de baixa seletividade.</span><span class="sxs-lookup"><span data-stu-id="fbbee-146">There are a few examples of where we have seen this parallelization work extremely well with queries that have low selectivity queries.</span></span>  <span data-ttu-id="fbbee-147">Essas são formadas por consultas que correspondam a muitos documentos, ou quando facetas precisam fornecer contagens de uma grande quantidade de documentos.</span><span class="sxs-lookup"><span data-stu-id="fbbee-147">This consists of queries that match many documents or when faceting needs to provide counts over large numbers of documents.</span></span>  <span data-ttu-id="fbbee-148">Como há muita computação envolvida para pontuar a relevância dos documentos ou para contar o número de documentos, a adição de partições extras pode ajudar a fornecer essa computação adicional.</span><span class="sxs-lookup"><span data-stu-id="fbbee-148">Since there is a lot of computation needed to score the relevancy of the documents or to count the numbers of documents, adding extra partitions can help to provide additional computation.</span></span>  
   
   <span data-ttu-id="fbbee-149">Pode haver no máximo 12 partições no serviço de pesquisa Standard, e uma partição no serviço de pesquisa Básico.</span><span class="sxs-lookup"><span data-stu-id="fbbee-149">There can be a maximum of 12 partitions in Standard search service and 1 partition in the basic search service.</span></span>  <span data-ttu-id="fbbee-150">As partições podem ser ajustadas no [Portal do Azure](search-create-service-portal.md) ou [PowerShell](search-manage-powershell.md).</span><span class="sxs-lookup"><span data-stu-id="fbbee-150">Partitions can be adjusted either from the [Azure portal](search-create-service-portal.md) or [PowerShell](search-manage-powershell.md).</span></span>
2. <span data-ttu-id="fbbee-151">**Limitar Campos de Alta Cardinalidade :** um campo de alta cardinalidade é composto por um campo facetável ou filtrável que tem um número considerável de valores exclusivos e, como resultado, usa muitos recursos para calcular os resultados.</span><span class="sxs-lookup"><span data-stu-id="fbbee-151">**Limit High Cardinality Fields:** A high cardinality field consists of a facetable or filterable field that has a significant number of unique values, and as a result, takes a lot of resources to compute results over.</span></span>   <span data-ttu-id="fbbee-152">Por exemplo, a configuração de um campo de ID do Produto ou Descrição como facetável/filtrável permitira a alta cardinalidade, pois a maioria dos valores de documento a documento é exclusiva.</span><span class="sxs-lookup"><span data-stu-id="fbbee-152">For example, setting a Product ID or Description field as facetable/filterable would make for high cardinality because most of the values from document to document are unique.</span></span> <span data-ttu-id="fbbee-153">Sempre que for possível, limite o número de campos de alta cardinalidade.</span><span class="sxs-lookup"><span data-stu-id="fbbee-153">Wherever possible, limit the number of high cardinality fields.</span></span>
3. <span data-ttu-id="fbbee-154">**Aumentar a Camada de Pesquisa:** mudar para um nível mais alto do Azure Search pode ser outra maneira de melhorar o desempenho de consultas lentas.</span><span class="sxs-lookup"><span data-stu-id="fbbee-154">**Increase Search Tier:**  Moving up to a higher Azure Search tier can be another way to improve performance of slow queries.</span></span>  <span data-ttu-id="fbbee-155">Cada camada superior também fornece uma CPU mais rápida e mais memória, o que pode ter um impacto positivo no desempenho da consulta.</span><span class="sxs-lookup"><span data-stu-id="fbbee-155">Each higher tier also provides faster CPU’s and more memory which can have a positive impact on query performance.</span></span>

## <a name="scaling-for-availability"></a><span data-ttu-id="fbbee-156">Dimensionamento para disponibilidade</span><span class="sxs-lookup"><span data-stu-id="fbbee-156">Scaling for availability</span></span>
<span data-ttu-id="fbbee-157">As réplicas não apenas ajudam a reduzir a latência da consulta, mas também permitem a alta disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="fbbee-157">Replicas not only help reduce query latency but can also allow for high availability.</span></span>  <span data-ttu-id="fbbee-158">Com uma única réplica, você deve esperar um tempo de inatividade periódico devido à reinicialização do servidor após atualizações de software ou a outros eventos de manutenção.</span><span class="sxs-lookup"><span data-stu-id="fbbee-158">With a single replica, you should expect periodic downtime due to server reboots after software updates or for other maintenance events that will occur.</span></span>  <span data-ttu-id="fbbee-159">Como resultado, é importante considerar se seu aplicativo exige alta disponibilidade de pesquisas (consultas), bem como gravações (eventos de indexação).</span><span class="sxs-lookup"><span data-stu-id="fbbee-159">As a result, it is important to consider if your application requires high availability of searches (queries) as well as writes (indexing events).</span></span>  <span data-ttu-id="fbbee-160">A Pesquisa do Azure oferece opções de SLA em todas as ofertas de pesquisa pagas, com os seguintes atributos:</span><span class="sxs-lookup"><span data-stu-id="fbbee-160">Azure Search offers SLA options on all the paid search offerings with the following attributes:</span></span>

* <span data-ttu-id="fbbee-161">Duas réplicas para alta disponibilidade das cargas de trabalho somente leitura (consultas)</span><span class="sxs-lookup"><span data-stu-id="fbbee-161">2 replicas for high availability of read-only workloads (queries)</span></span>
* <span data-ttu-id="fbbee-162">Três ou mais réplicas para alta disponibilidade das cargas de trabalho de leitura/gravação (consultas e indexação)</span><span class="sxs-lookup"><span data-stu-id="fbbee-162">3 or more replicas for high availability of read-write workloads (queries and indexing)</span></span>

<span data-ttu-id="fbbee-163">Para obter mais detalhes sobre isso, visite o [Contrato de Nível de Serviço da Pesquisa do Azure](https://azure.microsoft.com/support/legal/sla/search/v1_0/).</span><span class="sxs-lookup"><span data-stu-id="fbbee-163">For more details on this, please visit the [Azure Search Service Level Agreement](https://azure.microsoft.com/support/legal/sla/search/v1_0/).</span></span>

<span data-ttu-id="fbbee-164">Como réplicas são cópias de seus dados, ter várias réplicas permite que a Pesquisa do Azure execute reinicializações e manutenção da máquina em uma réplica por vez, permitindo que as consultas continuem a ser executadas em outras réplicas.</span><span class="sxs-lookup"><span data-stu-id="fbbee-164">Since replicas are copies of your data, having multiple replicas allows Azure Search to do machine reboots and maintenance against one replica at a time while allowing queries to continue to be executed against the other replicas.</span></span>  <span data-ttu-id="fbbee-165">Por esse motivo, você também precisa considerar como esse tempo de inatividade pode afetar as consultas que precisam ser executadas em uma cópia a menos dos dados.</span><span class="sxs-lookup"><span data-stu-id="fbbee-165">For that reason, you will also need to consider how this downtime may impact the queries that now have to be executed against one less copy of the data.</span></span>

## <a name="scaling-geo-distributed-workloads-and-provide-geo-redundancy"></a><span data-ttu-id="fbbee-166">Dimensionamento de cargas de trabalho distribuídas geograficamente e fornecimento de redundância geográfica</span><span class="sxs-lookup"><span data-stu-id="fbbee-166">Scaling geo-distributed workloads and provide geo-redundancy</span></span>
<span data-ttu-id="fbbee-167">Para cargas de trabalho distribuídas geograficamente, você perceberá que os usuários localizados longe do data center no qual o serviço da Pesquisa do Azure está hospedado terão taxas mais altas de latência.</span><span class="sxs-lookup"><span data-stu-id="fbbee-167">For geo-distributed workloads, you will find that users located far from the data center where your Azure Search service is hosted will have higher latency rates.</span></span>  <span data-ttu-id="fbbee-168">Por esse motivo, geralmente é importante ter vários serviços de pesquisa em regiões que estão mais próximas a esses usuários.</span><span class="sxs-lookup"><span data-stu-id="fbbee-168">For this reason, it is often important to have multiple search services in regions that are in closer proximity to these users.</span></span>  <span data-ttu-id="fbbee-169">No momento, a Pesquisa do Azure não fornece um método automatizado de replicação geográfica de índices da Pesquisa do Azure entre regiões, mas há algumas técnicas que podem ser usadas para tornar esse processo simples de implementar e gerenciar.</span><span class="sxs-lookup"><span data-stu-id="fbbee-169">Azure Search does not currently provide an automated method of geo-replicating Azure Search indexes across regions, but there are some techniques that can be used that can make this process simple to implement and manage.</span></span> <span data-ttu-id="fbbee-170">Elas serão descritas nas próximas seções.</span><span class="sxs-lookup"><span data-stu-id="fbbee-170">These are outlined in the next few sections.</span></span>

<span data-ttu-id="fbbee-171">O objetivo de um conjunto de serviços de pesquisa distribuídos geograficamente é ter dois ou mais índices disponíveis em duas ou mais regiões. Nesse caso, o usuário será encaminhado para o serviço de Pesquisa do Azure com a menor latência, como visto neste exemplo:</span><span class="sxs-lookup"><span data-stu-id="fbbee-171">The goal of a geo-distributed set of search services is to have two or more indexes available in two or more regions where a user will be routed to the Azure Search service that provides the lowest latency as seen in this example:</span></span>

   ![Tabela de referência cruzada de serviços por região][1]

### <a name="keeping-data-in-sync-across-multiple-azure-search-services"></a><span data-ttu-id="fbbee-173">Manter os dados sincronizados em vários serviços de Pesquisa do Azure</span><span class="sxs-lookup"><span data-stu-id="fbbee-173">Keeping data in sync across multiple Azure Search services</span></span>
<span data-ttu-id="fbbee-174">Há duas opções para manter seus serviços de pesquisa distribuídos em sincronia, que são o uso do [Indexador do Azure Search](search-indexer-overview.md) ou a API Push (também conhecida como a [API REST do Azure Search](https://docs.microsoft.com/rest/api/searchservice/)).</span><span class="sxs-lookup"><span data-stu-id="fbbee-174">There are two options for keeping your distributed search services in sync which consist of either using the [Azure Search Indexer](search-indexer-overview.md) or the Push API (also referred to as the [Azure Search REST API](https://docs.microsoft.com/rest/api/searchservice/)).</span></span>  

### <a name="azure-search-indexers"></a><span data-ttu-id="fbbee-175">Indexadores na Pesquisa do Azure</span><span class="sxs-lookup"><span data-stu-id="fbbee-175">Azure Search Indexers</span></span>
<span data-ttu-id="fbbee-176">Se você estiver usando o Indexador do Azure Search, já estará importando as alterações de um armazenamento de dados central, como o Banco de Dados SQL do Azure ou o Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="fbbee-176">If you are using the Azure Search Indexer, you are already importing data changes from a central datastore such as Azure SQL DB or Azure Cosmos DB.</span></span> <span data-ttu-id="fbbee-177">Quando você cria um novo Serviço de pesquisa, você simplesmente cria também um novo Indexador de Pesquisa do Azure para esse serviço que aponta para o mesmo repositório de dados.</span><span class="sxs-lookup"><span data-stu-id="fbbee-177">When you create a new search Service, you simply also create a new Azure Search Indexer for that service that points to this same datastore.</span></span> <span data-ttu-id="fbbee-178">Dessa forma, sempre que novas alterações entrarem no repositório de dados, elas serão indexadas pelos vários Indexadores.</span><span class="sxs-lookup"><span data-stu-id="fbbee-178">That way, whenever new changes come into the data store, they will then be indexed by the various Indexers.</span></span>  

<span data-ttu-id="fbbee-179">Veja um exemplo de como seria a aparência dessa arquitetura.</span><span class="sxs-lookup"><span data-stu-id="fbbee-179">Here is an example of what that architecture would look like.</span></span>

   ![Única fonte de dados com o indexador distribuído e combinações de serviço][2]

### <a name="push-api"></a><span data-ttu-id="fbbee-181">API Push</span><span class="sxs-lookup"><span data-stu-id="fbbee-181">Push API</span></span>
<span data-ttu-id="fbbee-182">Se você estiver usando a API Push da Pesquisa do Azure para [Atualizar conteúdo em seu índice da Pesquisa do Azure](https://docs.microsoft.com/rest/api/searchservice/update-index), você pode manter em sincronia seus vários serviços de pesquisa enviando por push as alterações para todos os serviços de pesquisa, sempre que uma atualização for necessária.</span><span class="sxs-lookup"><span data-stu-id="fbbee-182">If you are using the Azure Search Push API to [update content in your Azure Search index](https://docs.microsoft.com/rest/api/searchservice/update-index), you can keep your various search services in sync by pushing changes to all search services whenever an update is required.</span></span>  <span data-ttu-id="fbbee-183">Ao fazer isso é importante lidar com casos nos quais uma atualização para um serviço de pesquisa falha e uma ou mais atualizações são bem-sucedidas.</span><span class="sxs-lookup"><span data-stu-id="fbbee-183">When doing this it is important to make sure to handle cases where an update to one search service fails and one or more updates succeed.</span></span>

## <a name="leveraging-azure-traffic-manager"></a><span data-ttu-id="fbbee-184">Aproveitando o Gerenciador de Tráfego do Azure</span><span class="sxs-lookup"><span data-stu-id="fbbee-184">Leveraging Azure Traffic Manager</span></span>
<span data-ttu-id="fbbee-185">[Gerenciador de Tráfego do Azure](../traffic-manager/traffic-manager-overview.md) permite que você encaminhe solicitações para vários sites localizados geograficamente que recebem suporte de vários Serviços de Pesquisa do Azure.</span><span class="sxs-lookup"><span data-stu-id="fbbee-185">[Azure Traffic Manager](../traffic-manager/traffic-manager-overview.md) allows you to route requests to multiple geo-located websites that are then backed by multiple Azure Search Services.</span></span>  <span data-ttu-id="fbbee-186">Uma vantagem do Gerenciador de Tráfego é que ele pode investigar a Pesquisa do Azure para garantir sua disponibilidade e encaminhar os usuários aos serviços de pesquisa alternativos em caso de inatividade.</span><span class="sxs-lookup"><span data-stu-id="fbbee-186">One advantage of the Traffic Manager is that it can probe Azure Search to ensure that it is available and route users to alternate search services in the event of downtime.</span></span>  <span data-ttu-id="fbbee-187">Além disso, se você estiver encaminhando solicitações de pesquisa por meio dos Sites do Azure, o Gerenciador de Tráfego do Azure permitirá o balanceamento de carga de casos em que o site está ativo, mas não a Pesquisa do Azure.</span><span class="sxs-lookup"><span data-stu-id="fbbee-187">In addition, if you are routing search requests through Azure Web Sites, Azure Traffic Manager allows you to load balance cases where the Website is up but not Azure Search.</span></span>  <span data-ttu-id="fbbee-188">Veja um exemplo de uma arquitetura que aproveita o Gerenciador de Tráfego.</span><span class="sxs-lookup"><span data-stu-id="fbbee-188">Here is an example of what the architecture that leverages Traffic Manager.</span></span>

   ![Tabela de referência cruzada de serviços por região, com o Gerenciador de tráfego central][3]

## <a name="monitoring-performance"></a><span data-ttu-id="fbbee-190">Monitoramento de desempenho</span><span class="sxs-lookup"><span data-stu-id="fbbee-190">Monitoring performance</span></span>
<span data-ttu-id="fbbee-191">A Pesquisa do Azure oferece a capacidade de analisar e monitorar o desempenho do serviço por meio da [STA (Análise de Tráfego de Pesquisa)](search-traffic-analytics.md).</span><span class="sxs-lookup"><span data-stu-id="fbbee-191">Azure Search offers the ability to analyze and monitor the performance of your service through [Search Traffic Analytics (STA)](search-traffic-analytics.md).</span></span> <span data-ttu-id="fbbee-192">Com a STA, você também pode registrar operações de pesquisa individuais, bem como as métricas agregadas para uma conta de armazenamento do Azure que pode ser processada para análise ou visualizada no Power BI.</span><span class="sxs-lookup"><span data-stu-id="fbbee-192">Through STA, you can optionally log the individual search operations as well as aggregated metrics to an Azure Storage account that can then be processed for analysis or visualized in Power BI.</span></span>  <span data-ttu-id="fbbee-193">Usando as métricas de STA, você pode examinar as estatísticas de desempenho, como o número médio de consultas ou tempos de resposta da consulta.</span><span class="sxs-lookup"><span data-stu-id="fbbee-193">Using STA metrics, you can review performance statistics such as average number of queries or query response times.</span></span>  <span data-ttu-id="fbbee-194">Além disso, o registro em log das operações permite a análise de detalhes das operações de pesquisa específicas.</span><span class="sxs-lookup"><span data-stu-id="fbbee-194">In addition, the operation logging allows you to drill into details of specific search operations.</span></span>

<span data-ttu-id="fbbee-195">STA é uma ferramenta valiosa para compreender as taxas de latência sob essa perspectiva da Pesquisa do Azure.</span><span class="sxs-lookup"><span data-stu-id="fbbee-195">STA is a valuable tool to understand latency rates from that Azure Search perspective.</span></span>  <span data-ttu-id="fbbee-196">Como as métricas de desempenho de consulta registradas têm base no tempo que uma consulta leva para ser completamente processada na Pesquisa do Azure (desde o momento da solicitação até quando é enviada), você poderá usá-las para determinar se os problemas de latência estão no lado do serviço de Pesquisa do Azure, ou fora do serviço, como a latência de rede.</span><span class="sxs-lookup"><span data-stu-id="fbbee-196">Since the query performance metrics logged are based on the time a query takes to be fully processed in Azure Search (from the time it is requested to when it is sent out), you are able to use this to determine if latency issues are from the Azure Search service side or outside of the service, such as from network latency.</span></span>  

## <a name="next-steps"></a><span data-ttu-id="fbbee-197">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="fbbee-197">Next steps</span></span>
<span data-ttu-id="fbbee-198">Para saber mais sobre os limites de serviços e os tipos de preço para cada um, confira [Limites do serviço de Pesquisa do Azure](search-limits-quotas-capacity.md).</span><span class="sxs-lookup"><span data-stu-id="fbbee-198">To learn more about the pricing tiers and services limits for each one, see [Service limits in Azure Search](search-limits-quotas-capacity.md).</span></span>

<span data-ttu-id="fbbee-199">Visite [Planejamento de capacidade](search-capacity-planning.md) para saber mais sobre combinações de partição e de réplica.</span><span class="sxs-lookup"><span data-stu-id="fbbee-199">Visit [Capacity planning](search-capacity-planning.md) to learn more about partition and replica combinations.</span></span>

<span data-ttu-id="fbbee-200">Para obter dados mais detalhados sobre o desempenho e para ver algumas demonstrações de como implementar as otimizações discutidas neste artigo, assista ao vídeo a seguir:</span><span class="sxs-lookup"><span data-stu-id="fbbee-200">For more drilldown on performance and to see some demonstrations of how to implement the optimizations discussed in this article, watch the following video:</span></span>

> [!VIDEO https://channel9.msdn.com/Events/Microsoft-Azure/AzureCon-2015/ACON319/player]
> 
> 

<!--Image references-->
[1]: ./media/search-performance-optimization/geo-redundancy.png
[2]: ./media/search-performance-optimization/scale-indexers.png
[3]: ./media/search-performance-optimization/geo-search-traffic-mgr.png
