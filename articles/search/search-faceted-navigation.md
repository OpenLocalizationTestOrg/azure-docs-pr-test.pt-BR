---
title: "Como implementar a navegação facetada no Azure Search | Microsoft Docs"
description: "Navegação facetada adicionada aos aplicativos que são integrados à Pesquisa do Azure, um serviço de pesquisa hospedado na nuvem do Microsoft Azure."
services: search
documentationcenter: 
author: HeidiSteen
manager: mblythe
editor: 
ms.assetid: cdf98fd4-63fd-4b50-b0b0-835cb08ad4d3
ms.service: search
ms.devlang: rest-api
ms.workload: search
ms.topic: article
ms.tgt_pltfrm: na
ms.date: 3/10/2017
ms.author: heidist
ms.openlocfilehash: 413f498eeb0bbc9a971c7a65200ed2fd8caa9aaf
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="how-to-implement-faceted-navigation-in-azure-search"></a><span data-ttu-id="3f99b-103">Como implementar a navegação facetada na Pesquisa do Azure</span><span class="sxs-lookup"><span data-stu-id="3f99b-103">How to implement faceted navigation in Azure Search</span></span>
<span data-ttu-id="3f99b-104">A navegação facetada é um mecanismo de filtragem que fornece navegação de busca detalhada autodirigida em aplicativos de pesquisa.</span><span class="sxs-lookup"><span data-stu-id="3f99b-104">Faceted navigation is a filtering mechanism that provides self-directed drilldown navigation in search applications.</span></span> <span data-ttu-id="3f99b-105">O termo 'navegação facetada' pode não ser familiar, mas provavelmente você já a usou antes.</span><span class="sxs-lookup"><span data-stu-id="3f99b-105">The term 'faceted navigation' may be unfamiliar, but you've probably used it before.</span></span> <span data-ttu-id="3f99b-106">Como mostra o exemplo a seguir, a navegação facetada é nada mais do que as categorias usadas para filtrar resultados.</span><span class="sxs-lookup"><span data-stu-id="3f99b-106">As the following example shows, faceted navigation is nothing more than the categories used to filter results.</span></span>

 ![Demonstração de Portal de Trabalho do Azure Search][1]

<span data-ttu-id="3f99b-108">A navegação facetada é um ponto de entrada alternativo para a pesquisa.</span><span class="sxs-lookup"><span data-stu-id="3f99b-108">Faceted navigation is an alternative entry point to search.</span></span> <span data-ttu-id="3f99b-109">Ela oferece uma alternativa conveniente para digitar expressões de pesquisa complexas manualmente.</span><span class="sxs-lookup"><span data-stu-id="3f99b-109">It offers a convenient alternative to typing complex search expressions by hand.</span></span> <span data-ttu-id="3f99b-110">As facetas podem ajudar a encontrar o que você está procurando, garantindo que você não obterá zero resultados.</span><span class="sxs-lookup"><span data-stu-id="3f99b-110">Facets can help you find what you're looking for, while ensuring that you don’t get zero results.</span></span> <span data-ttu-id="3f99b-111">Como desenvolvedor, facetas permitem que você exponha os critérios de pesquisa mais úteis para navegar pelo seu corpo de busca.</span><span class="sxs-lookup"><span data-stu-id="3f99b-111">As a developer, facets let you expose the most useful search criteria for navigating your search corpus.</span></span> <span data-ttu-id="3f99b-112">Em aplicativos de varejo online, a navegação facetada geralmente é criada sobre marcas, departamentos (sapatos infantis), tamanho, preço, popularidade e classificações.</span><span class="sxs-lookup"><span data-stu-id="3f99b-112">In online retail applications, faceted navigation is often built over brands, departments (kid’s shoes), size, price, popularity, and ratings.</span></span> 

<span data-ttu-id="3f99b-113">A implementação da navegação facetada varia entre diferentes tecnologias de pesquisa.</span><span class="sxs-lookup"><span data-stu-id="3f99b-113">Implementing faceted navigation differs across search technologies.</span></span> <span data-ttu-id="3f99b-114">No Azure Search, a navegação facetada baseia-se no tempo da consulta, usando os campos atribuídos especificados anteriormente no seu esquema.</span><span class="sxs-lookup"><span data-stu-id="3f99b-114">In Azure Search, faceted navigation is built at query time, using fields that you previously attributed in your schema.</span></span>

-   <span data-ttu-id="3f99b-115">Nas consultas compiladas pelo seu aplicativo, uma consulta deve enviar *parâmetros de faceta de consulta* para obter os valores de filtro de faceta disponíveis para esse conjunto de resultados do documento.</span><span class="sxs-lookup"><span data-stu-id="3f99b-115">In the queries that your application builds, a query must send *facet query parameters* to get the available facet filter values for that document result set.</span></span>

-   <span data-ttu-id="3f99b-116">Para realmente recortar o conjunto de resultados do documento, o aplicativo também deve aplicar uma expressão `$filter`.</span><span class="sxs-lookup"><span data-stu-id="3f99b-116">To actually trim the document result set, the application must also apply a `$filter` expression.</span></span>

<span data-ttu-id="3f99b-117">No desenvolvimento do aplicativo, escrever um código que construa consultas constitui a maior parte do trabalho.</span><span class="sxs-lookup"><span data-stu-id="3f99b-117">In your application development, writing code that constructs queries constitutes the bulk of the work.</span></span> <span data-ttu-id="3f99b-118">Muitos dos comportamentos de aplicativo que você esperaria da navegação facetada são fornecidos pelo serviço, incluindo suporte integrado para configuração de intervalos e obtenção de contagens de resultados de uma determinada faceta.</span><span class="sxs-lookup"><span data-stu-id="3f99b-118">Many of the application behaviors that you would expect from faceted navigation are provided by the service, including built-in support for defining ranges and getting counts for facet results.</span></span> <span data-ttu-id="3f99b-119">O serviço também inclui padrões pertinentes, que o ajudarão a evitar estruturas de navegação complicadas.</span><span class="sxs-lookup"><span data-stu-id="3f99b-119">The service also includes sensible defaults that help you avoid unwieldy navigation structures.</span></span> 

## <a name="sample-code-and-demo"></a><span data-ttu-id="3f99b-120">Demonstração e código de exemplo</span><span class="sxs-lookup"><span data-stu-id="3f99b-120">Sample code and demo</span></span>
<span data-ttu-id="3f99b-121">Este artigo usa um portal de pesquisa de trabalhos como um exemplo.</span><span class="sxs-lookup"><span data-stu-id="3f99b-121">This article uses a job search portal as an example.</span></span> <span data-ttu-id="3f99b-122">O exemplo é implementado como um aplicativo ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="3f99b-122">The example is implemented as an ASP.NET MVC application.</span></span>

-   <span data-ttu-id="3f99b-123">Veja e teste a demonstração de trabalho online na [Demonstração do portal do trabalho do Azure Search](http://azjobsdemo.azurewebsites.net/).</span><span class="sxs-lookup"><span data-stu-id="3f99b-123">See and test the working demo online at [Azure Search Job Portal Demo](http://azjobsdemo.azurewebsites.net/).</span></span>

-   <span data-ttu-id="3f99b-124">Baixe o código do [repositório Azure-Samples no GitHub](https://github.com/Azure-Samples/search-dotnet-asp-net-mvc-jobs).</span><span class="sxs-lookup"><span data-stu-id="3f99b-124">Download the code from the [Azure-Samples repo on GitHub](https://github.com/Azure-Samples/search-dotnet-asp-net-mvc-jobs).</span></span>

## <a name="get-started"></a><span data-ttu-id="3f99b-125">Introdução</span><span class="sxs-lookup"><span data-stu-id="3f99b-125">Get started</span></span>
<span data-ttu-id="3f99b-126">Se você é novo no desenvolvimento de pesquisa, a melhor maneira de pensar em navegação facetada é que ela mostra as possibilidades de pesquisa autodirigida.</span><span class="sxs-lookup"><span data-stu-id="3f99b-126">If you're new to search development, the best way to think of faceted navigation is that it shows the possibilities for self-directed search.</span></span> <span data-ttu-id="3f99b-127">É um tipo de experiência de busca detalhada, com base em filtros predefinidos usados para restringir os resultados da pesquisa rapidamente por meio de ações de apontar e clicar.</span><span class="sxs-lookup"><span data-stu-id="3f99b-127">It’s a type of drill-down search experience, based on predefined filters, used for quickly narrowing down search results through point-and-click actions.</span></span> 

### <a name="interaction-model"></a><span data-ttu-id="3f99b-128">Modelo de interação</span><span class="sxs-lookup"><span data-stu-id="3f99b-128">Interaction model</span></span>

<span data-ttu-id="3f99b-129">A experiência de pesquisa para navegação facetada é iterativa, então vamos começar entendê-la como uma sequência de consultas que se desenrolam em resposta às ações do usuário.</span><span class="sxs-lookup"><span data-stu-id="3f99b-129">The search experience for faceted navigation is iterative, so let’s start by understanding it as a sequence of queries that unfold in response to user actions.</span></span>

<span data-ttu-id="3f99b-130">O ponto de partida é uma página de aplicativo que oferece navegação facetada, normalmente posicionada na periferia.</span><span class="sxs-lookup"><span data-stu-id="3f99b-130">The starting point is an application page that provides faceted navigation, typically placed on the periphery.</span></span> <span data-ttu-id="3f99b-131">A navegação facetada costuma ser uma estrutura de árvore, com caixas de seleção para cada valor ou texto que pode ser clicado.</span><span class="sxs-lookup"><span data-stu-id="3f99b-131">Faceted navigation is often a tree structure, with checkboxes for each value, or clickable text.</span></span> 

1. <span data-ttu-id="3f99b-132">Uma consulta enviada para a Pesquisa do Azure especifica a estrutura de navegação facetada por meio de um ou mais parâmetros de consulta de faceta.</span><span class="sxs-lookup"><span data-stu-id="3f99b-132">A query sent to Azure Search specifies the faceted navigation structure via one or more facet query parameters.</span></span> <span data-ttu-id="3f99b-133">Por exemplo, a consulta pode incluir `facet=Rating`, talvez com uma opção `:values` ou `:sort` para refinar ainda mais a apresentação.</span><span class="sxs-lookup"><span data-stu-id="3f99b-133">For instance, the query might include `facet=Rating`, perhaps with a `:values` or `:sort` option to further refine the presentation.</span></span>
2. <span data-ttu-id="3f99b-134">A camada de apresentação renderiza uma página de pesquisa que oferece navegação facetada, usando as facetas especificadas na solicitação.</span><span class="sxs-lookup"><span data-stu-id="3f99b-134">The presentation layer renders a search page that provides faceted navigation, using the facets specified on the request.</span></span>
3. <span data-ttu-id="3f99b-135">Dada uma estrutura de navegação facetada que inclui classificação, você clica em "4" para indicar que somente os produtos com uma classificação 4 ou superior devem ser mostrados.</span><span class="sxs-lookup"><span data-stu-id="3f99b-135">Given a faceted navigation structure that includes Rating, you click "4" to indicate that only products with a rating of 4 or higher should be shown.</span></span> 
4. <span data-ttu-id="3f99b-136">Em resposta, o aplicativo envia uma consulta que inclui `$filter=Rating ge 4`</span><span class="sxs-lookup"><span data-stu-id="3f99b-136">In response, the application sends a query that includes `$filter=Rating ge 4`</span></span> 
5. <span data-ttu-id="3f99b-137">A camada de apresentação atualiza a página, mostrando um conjunto de resultados reduzido apenas com os itens que atendem aos novos critérios (nesse caso, os produtos classificados como 4 e superior).</span><span class="sxs-lookup"><span data-stu-id="3f99b-137">The presentation layer updates the page, showing a reduced result set, containing just those items that satisfy the new criteria (in this case, products rated 4 and up).</span></span>

<span data-ttu-id="3f99b-138">Uma faceta é um parâmetro de consulta, mas não a confunda com uma entrada de consulta.</span><span class="sxs-lookup"><span data-stu-id="3f99b-138">A facet is a query parameter, but do not confuse it with query input.</span></span> <span data-ttu-id="3f99b-139">Ela nunca é usada como critério de seleção em uma consulta.</span><span class="sxs-lookup"><span data-stu-id="3f99b-139">It is never used as selection criteria in a query.</span></span> <span data-ttu-id="3f99b-140">Em vez disso, pense em facetas usadas como parâmetros de consulta como entradas para a estrutura de navegação que retorna como resposta.</span><span class="sxs-lookup"><span data-stu-id="3f99b-140">Instead, think of facet query parameters as inputs to the navigation structure that comes back in the response.</span></span> <span data-ttu-id="3f99b-141">Para cada parâmetro de consulta de faceta que você fornecer, o Azure Search avaliará quantos documentos estão nos resultados parciais para cada valor de faceta.</span><span class="sxs-lookup"><span data-stu-id="3f99b-141">For each facet query parameter you provide, Azure Search evaluates how many documents are in the partial results for each facet value.</span></span>

<span data-ttu-id="3f99b-142">Observe o `$filter` na etapa 4.</span><span class="sxs-lookup"><span data-stu-id="3f99b-142">Notice the `$filter` in step 4.</span></span> <span data-ttu-id="3f99b-143">O filtro é um aspecto importante da navegação facetada.</span><span class="sxs-lookup"><span data-stu-id="3f99b-143">The filter is an important aspect of faceted navigation.</span></span> <span data-ttu-id="3f99b-144">Embora facetas e filtros sejam independentes na API, você precisará de ambos para fornecer a experiência que pretende.</span><span class="sxs-lookup"><span data-stu-id="3f99b-144">Although facets and filters are independent in the API, you need both to deliver the experience you intend.</span></span> 

### <a name="app-design-pattern"></a><span data-ttu-id="3f99b-145">Padrão de design do aplicativo</span><span class="sxs-lookup"><span data-stu-id="3f99b-145">App design pattern</span></span>

<span data-ttu-id="3f99b-146">No código do aplicativo, o padrão é usar parâmetros de consulta de faceta para retornar a estrutura de navegação facetada juntamente com os resultados da faceta, mais de uma expressão $filter.</span><span class="sxs-lookup"><span data-stu-id="3f99b-146">In application code, the pattern is to use facet query parameters to return the faceted navigation structure along with facet results, plus a $filter expression.</span></span>  <span data-ttu-id="3f99b-147">A expressão de filtro manipula o evento de clique no valor da faceta.</span><span class="sxs-lookup"><span data-stu-id="3f99b-147">The filter expression handles the click event on the facet value.</span></span> <span data-ttu-id="3f99b-148">Imagine a expressão `$filter` como o código por trás do verdadeiro recorte dos resultados da pesquisa retornados para a camada de apresentação.</span><span class="sxs-lookup"><span data-stu-id="3f99b-148">Think of the `$filter` expression as the code behind the actual trimming of search results returned to the presentation layer.</span></span> <span data-ttu-id="3f99b-149">Dada uma faceta de cores, clicar na cor Vermelho é implementado através de uma expressão `$filter` que seleciona somente os itens que têm cor vermelha.</span><span class="sxs-lookup"><span data-stu-id="3f99b-149">Given a Colors facet, clicking the color Red is implemented through a `$filter` expression that selects only those items that have a color of red.</span></span> 

### <a name="query-basics"></a><span data-ttu-id="3f99b-150">Noções básicas sobre consulta</span><span class="sxs-lookup"><span data-stu-id="3f99b-150">Query basics</span></span>

<span data-ttu-id="3f99b-151">Na pesquisa do Azure, uma solicitação é especificada por meio de um ou mais parâmetros de consulta (consulte [Procurar documentos](http://msdn.microsoft.com/library/azure/dn798927.aspx) para obter uma descrição de cada um deles).</span><span class="sxs-lookup"><span data-stu-id="3f99b-151">In Azure Search, a request is specified through one or more query parameters (see [Search Documents](http://msdn.microsoft.com/library/azure/dn798927.aspx) for a description of each one).</span></span> <span data-ttu-id="3f99b-152">Nenhum dos parâmetros de consulta é necessário, mas você deve ter pelo menos um para que uma consulta seja válida.</span><span class="sxs-lookup"><span data-stu-id="3f99b-152">None of the query parameters are required, but you must have at least one in order for a query to be valid.</span></span>

<span data-ttu-id="3f99b-153">A precisão, entendida como a capacidade de filtrar correspondências irrelevantes, é obtida por meio de uma ou de ambas as expressões:</span><span class="sxs-lookup"><span data-stu-id="3f99b-153">Precision, understood as the ability to filter out irrelevant hits, is achieved through one or both of these expressions:</span></span>

-   <span data-ttu-id="3f99b-154">**search=**</span><span class="sxs-lookup"><span data-stu-id="3f99b-154">**search=**</span></span>  
    <span data-ttu-id="3f99b-155">O valor deste parâmetro constitui a expressão de pesquisa.</span><span class="sxs-lookup"><span data-stu-id="3f99b-155">The value of this parameter constitutes the search expression.</span></span> <span data-ttu-id="3f99b-156">Pode ser uma única parte de texto ou uma expressão de pesquisa complexa que inclua vários termos e operadores.</span><span class="sxs-lookup"><span data-stu-id="3f99b-156">It might be a single piece of text, or a complex search expression that includes multiple terms and operators.</span></span> <span data-ttu-id="3f99b-157">No servidor, uma expressão de pesquisa é usada para pesquisa de texto completo, consultando os campos de pesquisa no índice para correspondência de termos, retornando resultados em ordem de classificação.</span><span class="sxs-lookup"><span data-stu-id="3f99b-157">On the server, a search expression is used for full-text search, querying searchable fields in the index for matching terms, returning results in rank order.</span></span> <span data-ttu-id="3f99b-158">Se você definir `search` como nulo, a consulta é executada sobre todo o índice (ou seja, `search=*`).</span><span class="sxs-lookup"><span data-stu-id="3f99b-158">If you set `search` to null, query execution is over the entire index (that is, `search=*`).</span></span> <span data-ttu-id="3f99b-159">Nesse caso, outros elementos da consulta, como um `$filter` ou perfil de pontuação, são os principais fatores que afetam quais documentos são retornados `($filter`) e em qual ordem (`scoringProfile` ou `$orderby`).</span><span class="sxs-lookup"><span data-stu-id="3f99b-159">In this case, other elements of the query, such as a `$filter` or scoring profile, are the primary factors affecting which documents are returned `($filter`) and in what order (`scoringProfile` or `$orderby`).</span></span>

-   <span data-ttu-id="3f99b-160">**$filter=**</span><span class="sxs-lookup"><span data-stu-id="3f99b-160">**$filter=**</span></span>  
    <span data-ttu-id="3f99b-161">Um filtro é um mecanismo poderoso para limitar o tamanho dos resultados da pesquisa com base nos valores de atributos específicos do documento.</span><span class="sxs-lookup"><span data-stu-id="3f99b-161">A filter is a powerful mechanism for limiting the size of search results based on the values of specific document attributes.</span></span> <span data-ttu-id="3f99b-162">Um `$filter` é avaliado primeiro, seguido pela lógica de facetagem que gera os valores disponíveis e as contagens correspondentes para cada valor</span><span class="sxs-lookup"><span data-stu-id="3f99b-162">A `$filter` is evaluated first, followed by faceting logic that generates the available values and corresponding counts for each value</span></span>

<span data-ttu-id="3f99b-163">As expressões de pesquisa complexas diminuem o desempenho da consulta.</span><span class="sxs-lookup"><span data-stu-id="3f99b-163">Complex search expressions decrease the performance of the query.</span></span> <span data-ttu-id="3f99b-164">Sempre que possível, utilize expressões de filtro bem construídas para aumentar a precisão e melhorar o desempenho da consulta.</span><span class="sxs-lookup"><span data-stu-id="3f99b-164">Where possible, use well-constructed filter expressions to increase precision and improve query performance.</span></span>

<span data-ttu-id="3f99b-165">Para entender melhor como um filtro adiciona mais precisão, compare uma expressão de pesquisa complexa a uma que inclui uma expressão de filtro:</span><span class="sxs-lookup"><span data-stu-id="3f99b-165">To better understand how a filter adds more precision, compare a complex search expression to one that includes a filter expression:</span></span>

-   `GET /indexes/hotel/docs?search=lodging budget +Seattle –motel +parking`
-   `GET /indexes/hotel/docs?search=lodging&$filter=City eq ‘Seattle’ and Parking and Type ne ‘motel’`

<span data-ttu-id="3f99b-166">Embora ambas as consultas sejam válidas, a segunda é melhor se você está procurando estabelecimentos que não sejam motéis com estacionamento em Seattle.</span><span class="sxs-lookup"><span data-stu-id="3f99b-166">Both queries are valid, but the second is superior if you’re looking for non-motels with parking in Seattle.</span></span>
-   <span data-ttu-id="3f99b-167">A primeira consulta depende dessas palavras específicas serem mencionadas ou não nos campos de cadeia de caracteres como Nome, Descrição e qualquer outro campo que contenha dados pesquisáveis.</span><span class="sxs-lookup"><span data-stu-id="3f99b-167">The first query relies on those specific words being mentioned or not mentioned in string fields like Name, Description, and any other field containing searchable data.</span></span>
-   <span data-ttu-id="3f99b-168">A segunda consulta procura correspondências precisas em dados estruturados, e provavelmente será muito mais precisa.</span><span class="sxs-lookup"><span data-stu-id="3f99b-168">The second query looks for precise matches on structured data and is likely to be much more accurate.</span></span>

<span data-ttu-id="3f99b-169">Em aplicativos que incluam navegação facetada, garanta que cada ação do usuário em uma estrutura de navegação facetada seja acompanhada de uma redução dos resultados da pesquisa.</span><span class="sxs-lookup"><span data-stu-id="3f99b-169">In applications that include faceted navigation, make sure that each user action over a faceted navigation structure is accompanied by a narrowing of search results.</span></span> <span data-ttu-id="3f99b-170">Para restringir os resultados, use uma expressão de filtro.</span><span class="sxs-lookup"><span data-stu-id="3f99b-170">To narrow results, use a filter expression.</span></span>

<a name="howtobuildit"></a>

## <a name="build-a-faceted-navigation-app"></a><span data-ttu-id="3f99b-171">Criar um aplicativo de navegação facetada</span><span class="sxs-lookup"><span data-stu-id="3f99b-171">Build a faceted navigation app</span></span>
<span data-ttu-id="3f99b-172">Você pode implementar a navegação facetada com o Azure Search em seu código de aplicativo que cria a solicitação de pesquisa.</span><span class="sxs-lookup"><span data-stu-id="3f99b-172">You implement faceted navigation with Azure Search in your application code that builds the search request.</span></span> <span data-ttu-id="3f99b-173">A navegação facetada se baseia em elementos no esquema que você definiu anteriormente.</span><span class="sxs-lookup"><span data-stu-id="3f99b-173">The faceted navigation relies on elements in your schema that you defined previously.</span></span>

<span data-ttu-id="3f99b-174">Predefinido em sua pesquisa de índice está o atributo de índice `Facetable [true|false]` , definido nos campos selecionados para habilitar ou desabilitar seu uso em uma estrutura de navegação facetada.</span><span class="sxs-lookup"><span data-stu-id="3f99b-174">Predefined in your search index is the `Facetable [true|false]` index attribute, set on selected fields to enable or disable their use in a faceted navigation structure.</span></span> <span data-ttu-id="3f99b-175">Sem `"Facetable" = true`, um campo não pode ser usado na navegação facetada.</span><span class="sxs-lookup"><span data-stu-id="3f99b-175">Without `"Facetable" = true`, a field cannot be used in facet navigation.</span></span>

<span data-ttu-id="3f99b-176">A camada de apresentação em seu código fornece a experiência do usuário.</span><span class="sxs-lookup"><span data-stu-id="3f99b-176">The presentation layer in your code provides the user experience.</span></span> <span data-ttu-id="3f99b-177">Ele deve listar as partes constituintes da navegação facetada, como o rótulo, valores, caixas de seleção e a contagem.</span><span class="sxs-lookup"><span data-stu-id="3f99b-177">It should list the constituent parts of the faceted navigation, such as the label, values, check boxes, and the count.</span></span> <span data-ttu-id="3f99b-178">A API REST de Pesquisa do Azure é independente de plataforma, portanto, use qualquer idioma e plataforma que desejar.</span><span class="sxs-lookup"><span data-stu-id="3f99b-178">The Azure Search REST API is platform agnostic, so use whatever language and platform you want.</span></span> <span data-ttu-id="3f99b-179">O importante é incluir elementos de interface do usuário que deem suporte a atualização incremental, com estado da interface do usuário sendo atualizado quando cada faceta adicional é selecionada.</span><span class="sxs-lookup"><span data-stu-id="3f99b-179">The important thing is to include UI elements that support incremental refresh, with updated UI state as each additional facet is selected.</span></span> 

<span data-ttu-id="3f99b-180">No momento da consulta, o código do aplicativo cria uma solicitação que inclui `facet=[string]`, um parâmetro de solicitação que fornece o campo pelo qual facetar.</span><span class="sxs-lookup"><span data-stu-id="3f99b-180">At query time, your application code creates a request that includes `facet=[string]`, a request parameter that provides the field to facet by.</span></span> <span data-ttu-id="3f99b-181">Uma consulta pode ter múltiplas facetas, como `&facet=color&facet=category&facet=rating`, cada uma separada por um caractere “e” comercial (&).</span><span class="sxs-lookup"><span data-stu-id="3f99b-181">A query can have multiple facets, such as `&facet=color&facet=category&facet=rating`, each one separated by an ampersand (&) character.</span></span>

<span data-ttu-id="3f99b-182">O código do aplicativo também deve construir uma expressão `$filter` para manipular os eventos de clique na navegação facetada.</span><span class="sxs-lookup"><span data-stu-id="3f99b-182">Application code must also construct a `$filter` expression to handle the click events in faceted navigation.</span></span> <span data-ttu-id="3f99b-183">Um `$filter` reduz os resultados da pesquisa, usando o valor da faceta como critério de filtro.</span><span class="sxs-lookup"><span data-stu-id="3f99b-183">A `$filter` reduces the search results, using the facet value as filter criteria.</span></span>

<span data-ttu-id="3f99b-184">O Azure Search retorna os resultados da pesquisa com base em um ou mais termos que você insere, junto com as atualizações para a estrutura de navegação facetada.</span><span class="sxs-lookup"><span data-stu-id="3f99b-184">Azure Search returns the search results, based on one or more terms that you enter, along with updates to the faceted navigation structure.</span></span> <span data-ttu-id="3f99b-185">Na Pesquisa do Azure, a navegação facetada é uma construção de nível único, com valores de facetas e contagens de quantos resultados são encontrados para cada uma delas.</span><span class="sxs-lookup"><span data-stu-id="3f99b-185">In Azure Search, faceted navigation is a single-level construction, with facet values, and counts of how many results are found for each one.</span></span>

<span data-ttu-id="3f99b-186">Nas seções a seguir, examinaremos mais detalhadamente como criar cada parte.</span><span class="sxs-lookup"><span data-stu-id="3f99b-186">In the following sections, we take a closer look at how to build each part.</span></span>

<a name="buildindex"></a>

## <a name="build-the-index"></a><span data-ttu-id="3f99b-187">Compilar o índice</span><span class="sxs-lookup"><span data-stu-id="3f99b-187">Build the index</span></span>
<span data-ttu-id="3f99b-188">A facetagem está habilitada no índice de campo por campo, por meio desse atributo de índice: `"Facetable": true`.</span><span class="sxs-lookup"><span data-stu-id="3f99b-188">Faceting is enabled on a field-by-field basis in the index, via this index attribute: `"Facetable": true`.</span></span>  
<span data-ttu-id="3f99b-189">Todos os tipos de campo que poderiam ser usados na navegação facetada são `Facetable` por padrão.</span><span class="sxs-lookup"><span data-stu-id="3f99b-189">All field types that could possibly be used in faceted navigation are `Facetable` by default.</span></span> <span data-ttu-id="3f99b-190">Esses tipos de campo incluem `Edm.String`, `Edm.DateTimeOffset` e todos os tipos de campo numérico (basicamente, todos os tipos de campo são facetáveis exceto `Edm.GeographyPoint`, que não pode ser usado na navegação facetada).</span><span class="sxs-lookup"><span data-stu-id="3f99b-190">Such field types include `Edm.String`, `Edm.DateTimeOffset`, and all the numeric field types (essentially, all field types are facetable except `Edm.GeographyPoint`, which can’t be used in faceted navigation).</span></span> 

<span data-ttu-id="3f99b-191">Ao criar um índice, uma prática recomendada para navegação facetada é desativar explicitamente a facetagem para os campos que nunca devem ser usados como uma faceta.</span><span class="sxs-lookup"><span data-stu-id="3f99b-191">When building an index, a best practice for faceted navigation is to explicitly turn faceting off for fields that should never be used as a facet.</span></span>  <span data-ttu-id="3f99b-192">Em particular, os campos de cadeia de caracteres para valores únicos, como uma ID ou nome de produto, devem ser definidos como `"Facetable": false` para evitar seu uso acidental (e ineficaz) na navegação facetada.</span><span class="sxs-lookup"><span data-stu-id="3f99b-192">In particular, string fields for singleton values, such as an ID or product name, should be set to `"Facetable": false` to prevent their accidental (and ineffective) use in faceted navigation.</span></span> <span data-ttu-id="3f99b-193">Desligar a facetagem onde você não precisa dela ajuda a manter o tamanho do índice pequeno e geralmente melhora o desempenho.</span><span class="sxs-lookup"><span data-stu-id="3f99b-193">Turning faceting off where you don’t need it helps keep the size of the index small, and typically improves performance.</span></span>

<span data-ttu-id="3f99b-194">A seguir, parte do esquema para o aplicativo de exemplo de Demonstração do Portal de Trabalho, sem alguns atributos para reduzir o tamanho:</span><span class="sxs-lookup"><span data-stu-id="3f99b-194">Following is part of the schema for the Job Portal Demo sample app, trimmed of some attributes to reduce the size:</span></span>

```json
{
  ...
  "name": "nycjobs",
  "fields": [
    { “name”: "id",                 "type": "Edm.String",              "searchable": false, "filterable": false, ... "facetable": false, ... },
    { “name”: "job_id",             "type": "Edm.String",              "searchable": false, "filterable": false, ... "facetable": false, ... },
    { “name”: "agency",              "type": "Edm.String",             "searchable": true,  "filterable": true, ...  "facetable": true, ...  },
    { “name”: "posting_type",        "type": "Edm.String",             "searchable": true,  "filterable": true, ...  "facetable": true, ...  },
    { “name”: "num_of_positions",    "type": "Edm.Int32",              "searchable": false, "filterable": true, ...  "facetable": true, ...  },
    { “name”: "business_title",      "type": "Edm.String",             "searchable": true,  "filterable": true, ...  "facetable": true, ...  },
    { “name”: "civil_service_title", "type": "Edm.String",             "searchable": true,  "filterable": true, ...  "facetable": true, ...  },
    { “name”: "title_code_no",       "type": "Edm.String",             "searchable": true,  "filterable": true, ...  "facetable": true, ...  },
    { “name”: "level",               "type": "Edm.String",             "searchable": true,  "filterable": true, ...  "facetable": true, ...  },
    { “name”: "salary_range_from",   "type": "Edm.Int32",              "searchable": false, "filterable": true, ...  "facetable": true, ...  },
    { “name”: "salary_range_to",     "type": "Edm.Int32",              "searchable": false, "filterable": true, ...  "facetable": true, ...  },
    { “name”: "salary_frequency",    "type": "Edm.String",             "searchable": true,  "filterable": true, ...  "facetable": true, ...  },
    { “name”: "work_location",       "type": "Edm.String",             "searchable": true,  "filterable": true, ...  "facetable": true, ...  },
…
    { “name”: "geo_location",        "type": "Edm.GeographyPoint",     "searchable": false, "filterable": true, ...  "facetable": false, ... },
    { “name”: "tags",                "type": "Collection(Edm.String)", "searchable": true,  "filterable": true, ...  "facetable": true, ...  }
  ],
…
}
```

<span data-ttu-id="3f99b-195">Como você pode ver no esquema de exemplo, `Facetable` é desativado para os campos de cadeia de caracteres que não devem ser usados como facetas, como os valores de ID.</span><span class="sxs-lookup"><span data-stu-id="3f99b-195">As you can see in the sample schema, `Facetable` is turned off for string fields that shouldn’t be used as facets, such as ID values.</span></span> <span data-ttu-id="3f99b-196">Desligar a facetagem onde você não precisa dela ajuda a manter o tamanho do índice pequeno e geralmente melhora o desempenho.</span><span class="sxs-lookup"><span data-stu-id="3f99b-196">Turning faceting off where you don’t need it helps keep the size of the index small, and typically improves performance.</span></span>

> [!TIP]
> <span data-ttu-id="3f99b-197">Como prática recomendada, inclua o conjunto completo de atributos de índice para cada campo.</span><span class="sxs-lookup"><span data-stu-id="3f99b-197">As a best practice, include the full set of index attributes for each field.</span></span> <span data-ttu-id="3f99b-198">Embora `Facetable` seja ativado por padrão para quase todos os campos, definir propositadamente cada atributo pode ajudá-lo a considerar as implicações de cada decisão do esquema.</span><span class="sxs-lookup"><span data-stu-id="3f99b-198">Although `Facetable` is on by default for almost all fields, purposely setting each attribute can help you think through the implications of each schema decision.</span></span> 

<a name="checkdata"></a>

## <a name="check-the-data"></a><span data-ttu-id="3f99b-199">Verificar os dados</span><span class="sxs-lookup"><span data-stu-id="3f99b-199">Check the data</span></span>
<span data-ttu-id="3f99b-200">A qualidade dos seus dados tem um impacto direto sobre se a estrutura de navegação facetada se materializa como esperado.</span><span class="sxs-lookup"><span data-stu-id="3f99b-200">The quality of your data has a direct effect on whether the faceted navigation structure materializes as you expect it to.</span></span> <span data-ttu-id="3f99b-201">Ela também afeta a facilidade de criação de filtros para reduzir o conjunto de resultados.</span><span class="sxs-lookup"><span data-stu-id="3f99b-201">It also affects the ease of constructing filters to reduce the result set.</span></span>

<span data-ttu-id="3f99b-202">Se você quiser realizar a facetagem por Marca ou Preço, cada documento deverá conter valores para *BrandName* e *ProductPrice* que sejam válidos, consistentes e produtivos como uma opção de filtragem.</span><span class="sxs-lookup"><span data-stu-id="3f99b-202">If you want to facet by Brand or Price, each document should contain values for *BrandName* and *ProductPrice* that are valid, consistent, and productive as a filter option.</span></span>

<span data-ttu-id="3f99b-203">Veja alguns lembretes sobre o que se deve procurar:</span><span class="sxs-lookup"><span data-stu-id="3f99b-203">Here are a few reminders of what to scrub for:</span></span>

* <span data-ttu-id="3f99b-204">Pergunte-se, para cada campo segundo o qual você deseja realizar a facetagem, se ele contém valores que são adequados como filtros na pesquisa autodirigida.</span><span class="sxs-lookup"><span data-stu-id="3f99b-204">For every field that you want to facet by, ask yourself whether it contains values that are suitable as filters in self-directed search.</span></span> <span data-ttu-id="3f99b-205">Os valores devem ser curtos, descritivos e suficientemente diferentes para oferecer uma escolha clara entre as opções de concorrentes.</span><span class="sxs-lookup"><span data-stu-id="3f99b-205">The values should be short, descriptive, and sufficiently distinctive to offer a clear choice between competing options.</span></span>
* <span data-ttu-id="3f99b-206">Erros de ortografia ou valores quase correspondentes.</span><span class="sxs-lookup"><span data-stu-id="3f99b-206">Misspellings or nearly matching values.</span></span> <span data-ttu-id="3f99b-207">Se você realiza a facetagem por Cor e os valores de campo incluem Laranja e Laranja (erro), uma facetagem baseada no campo Cor utilizaria ambos.</span><span class="sxs-lookup"><span data-stu-id="3f99b-207">If you facet on Color, and field values include Orange and Ornage (a misspelling), a facet based on the Color field would pick up both.</span></span>
* <span data-ttu-id="3f99b-208">Texto composto
de caracteres maiúsculos e minúsculos também pode causar estragos na navegação facetada, com laranja e Laranja aparecendo como dois valores diferentes.</span><span class="sxs-lookup"><span data-stu-id="3f99b-208">Mixed case text can also wreak havoc in faceted navigation, with orange and Orange appearing as two different values.</span></span> 
* <span data-ttu-id="3f99b-209">Versões do mesmo valor no singular e no plural podem resultar em uma faceta separada para cada uma.</span><span class="sxs-lookup"><span data-stu-id="3f99b-209">Single and plural versions of the same value can result in a separate facet for each.</span></span>

<span data-ttu-id="3f99b-210">Como você pode imaginar, a auditoria na preparação dos dados é um aspecto essencial para uma navegação facetada eficiente.</span><span class="sxs-lookup"><span data-stu-id="3f99b-210">As you can imagine, diligence in preparing the data is an essential aspect of effective faceted navigation.</span></span>

<a name="presentationlayer"></a>

## <a name="build-the-ui"></a><span data-ttu-id="3f99b-211">Criar a interface do usuário</span><span class="sxs-lookup"><span data-stu-id="3f99b-211">Build the UI</span></span>
<span data-ttu-id="3f99b-212">Trabalhar na camada de apresentação pode ajudá-lo a descobrir requisitos que de outro modo poderiam ter sido ignorados, além de entender quais recursos são essenciais para a experiência de pesquisa.</span><span class="sxs-lookup"><span data-stu-id="3f99b-212">Working back from the presentation layer can help you uncover requirements that might be missed otherwise, and understand which capabilities are essential to the search experience.</span></span>

<span data-ttu-id="3f99b-213">Em termos de navegação facetada, sua página ou aplicativo da Web exibe a estrutura de navegação facetada, detecta a entrada do usuário na página e insere os elementos alterados.</span><span class="sxs-lookup"><span data-stu-id="3f99b-213">In terms of faceted navigation, your web or application page displays the faceted navigation structure, detects user input on the page, and inserts the changed elements.</span></span> 

<span data-ttu-id="3f99b-214">Para aplicativos da Web, o AJAX normalmente é usado na camada de apresentação porque ele permite que você atualize as alterações incrementais.</span><span class="sxs-lookup"><span data-stu-id="3f99b-214">For web applications, AJAX is commonly used in the presentation layer because it allows you to refresh incremental changes.</span></span> <span data-ttu-id="3f99b-215">Você também pode usar o MVC ASP.NET ou qualquer outra plataforma de visualização que possa se conectar a um serviço de pesquisa do Azure via HTTP.</span><span class="sxs-lookup"><span data-stu-id="3f99b-215">You could also use ASP.NET MVC or any other visualization platform that can connect to an Azure Search service over HTTP.</span></span> <span data-ttu-id="3f99b-216">O aplicativo de exemplo referenciado neste artigo – a **Demonstração do Portal de Trabalho do Azure Search** – trata-se de um aplicativo ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="3f99b-216">The sample application referenced throughout this article -- the **Azure Search Job Portal Demo** – happens to be an ASP.NET MVC application.</span></span>

<span data-ttu-id="3f99b-217">No exemplo, a navegação facetada baseia-se na página de resultados da pesquisa.</span><span class="sxs-lookup"><span data-stu-id="3f99b-217">In the sample, faceted navigation is built into the search results page.</span></span> <span data-ttu-id="3f99b-218">O exemplo a seguir, extraído do arquivo `index.cshtml` do aplicativo de exemplo, mostra a estrutura HTML estática para exibir a navegação facetada em sua página de resultados da pesquisa.</span><span class="sxs-lookup"><span data-stu-id="3f99b-218">The following example, taken from the `index.cshtml` file of the sample application, shows the static HTML structure for displaying faceted navigation on the search results page.</span></span> <span data-ttu-id="3f99b-219">A lista de facetas é criada ou recriada dinamicamente quando você envia um termo de pesquisa ou marca ou desmarca uma faceta.</span><span class="sxs-lookup"><span data-stu-id="3f99b-219">The list of facets is built or rebuilt dynamically when you submit a search term, or select or clear a facet.</span></span>

```html
<div class="widget sidebar-widget jobs-filter-widget">
  <h5 class="widget-title">Filter Results</h5>
    <p id="filterReset"></p>
    <div class="widget-content">

      <h6 id="businessTitleFacetTitle">Business Title</h6>
      <ul class="filter-list" id="business_title_facets">
      </ul>

      <h6>Location</h6>
      <ul class="filter-list" id="posting_type_facets">
      </ul>

      <h6>Posting Type</h6>
      <ul class="filter-list" id="posting_type_facets"></ul>

      <h6>Minimum Salary</h6>
      <ul class="filter-list" id="salary_range_facets">
      </ul>

  </div>
</div>
```

<span data-ttu-id="3f99b-220">O trecho de código a seguir da página `index.cshtml` cria dinamicamente o HTML para exibir a primeira faceta, Cargo.</span><span class="sxs-lookup"><span data-stu-id="3f99b-220">The following code snippet from the `index.cshtml` page dynamically builds the HTML to display the first facet, Business Title.</span></span> <span data-ttu-id="3f99b-221">Funções semelhantes criam dinamicamente o HTML para as outras facetas.</span><span class="sxs-lookup"><span data-stu-id="3f99b-221">Similar functions dynamically build the HTML for the other facets.</span></span> <span data-ttu-id="3f99b-222">Cada faceta tem um rótulo e uma contagem, que exibe o número de itens encontrados para o resultado dessa faceta.</span><span class="sxs-lookup"><span data-stu-id="3f99b-222">Each facet has a label and a count, which displays the number of items found for that facet result.</span></span>

```js
function UpdateBusinessTitleFacets(data) {
  var facetResultsHTML = '';
  for (var i = 0; i < data.length; i++) {
    facetResultsHTML += '<li><a href="javascript:void(0)" onclick="ChooseBusinessTitleFacet(\'' + data[i].Value + '\');">' + data[i].Value + ' (' + data[i].Count + ')</span></a></li>';
  }

  $("#business_title_facets").html(facetResultsHTML);
}
```

> [!TIP]
> <span data-ttu-id="3f99b-223">Ao criar a página de resultados da pesquisa, lembre-se de adicionar um mecanismo para limpar facetas.</span><span class="sxs-lookup"><span data-stu-id="3f99b-223">When you design the search results page, remember to add a mechanism for clearing facets.</span></span> <span data-ttu-id="3f99b-224">Se você adicionar caixas de seleção, poderá ver com facilidade como limpar os filtros.</span><span class="sxs-lookup"><span data-stu-id="3f99b-224">If you add check boxes, you can easily see how to clear the filters.</span></span> <span data-ttu-id="3f99b-225">Para outros layouts, talvez seja necessário um padrão de navegação estrutural ou outra abordagem criativa.</span><span class="sxs-lookup"><span data-stu-id="3f99b-225">For other layouts, you might need a breadcrumb pattern or another creative approach.</span></span> <span data-ttu-id="3f99b-226">Por exemplo, no aplicativo de exemplo do Portal de Pesquisa de Trabalho, você pode clicar no `[X]` após uma faceta selecionada para limpar a faceta.</span><span class="sxs-lookup"><span data-stu-id="3f99b-226">For example, in the Job Search Portal sample application, you can click the `[X]` after a selected facet to clear the facet.</span></span>

<a name="buildquery"></a>

## <a name="build-the-query"></a><span data-ttu-id="3f99b-227">Compilar a consulta</span><span class="sxs-lookup"><span data-stu-id="3f99b-227">Build the query</span></span>
<span data-ttu-id="3f99b-228">O código que você escreve para a compilação de consultas deve especificar todas as partes de uma consulta válida, incluindo expressões de pesquisa, facetas, filtros, perfis de pontuação – tudo o que for usado para formular uma solicitação.</span><span class="sxs-lookup"><span data-stu-id="3f99b-228">The code that you write for building queries should specify all parts of a valid query, including search expressions, facets, filters, scoring profiles– anything used to formulate a request.</span></span> <span data-ttu-id="3f99b-229">Nesta seção, exploramos onde as facetas se encaixam em uma consulta e como os filtros são usados com facetas para fornecer um conjunto de resultados reduzido.</span><span class="sxs-lookup"><span data-stu-id="3f99b-229">In this section, we explore where facets fit into a query, and how filters are used with facets to deliver a reduced result set.</span></span>

<span data-ttu-id="3f99b-230">Observe que as facetas são integrais nesse aplicativo de exemplo.</span><span class="sxs-lookup"><span data-stu-id="3f99b-230">Notice that facets are integral in this sample application.</span></span> <span data-ttu-id="3f99b-231">A experiência de pesquisa na Demonstração do Portal de Trabalho foi criada em torno de filtros e navegação facetada.</span><span class="sxs-lookup"><span data-stu-id="3f99b-231">The search experience in the Job Portal Demo is designed around faceted navigation and filters.</span></span> <span data-ttu-id="3f99b-232">O posicionamento proeminente de navegação facetada na página demonstra sua importância.</span><span class="sxs-lookup"><span data-stu-id="3f99b-232">The prominent placement of faceted navigation on the page demonstrates its importance.</span></span> 

<span data-ttu-id="3f99b-233">Um exemplo é geralmente um bom lugar para começar.</span><span class="sxs-lookup"><span data-stu-id="3f99b-233">An example is often a good place to begin.</span></span> <span data-ttu-id="3f99b-234">O exemplo a seguir, extraído do arquivo `JobsSearch.cs`, compila uma solicitação que cria a navegação facetada com base no Cargo, no Local, no Tipo de Lançamento e no Salário Mínimo.</span><span class="sxs-lookup"><span data-stu-id="3f99b-234">The following example, taken from the `JobsSearch.cs` file, builds a request that creates facet navigation based on Business Title, Location, Posting Type, and Minimum Salary.</span></span> 

```cs
SearchParameters sp = new SearchParameters()
{
  ...
  // Add facets
  Facets = new List<String>() { "business_title", "posting_type", "level", "salary_range_from,interval:50000" },
};
```

<span data-ttu-id="3f99b-235">Um parâmetro de faceta para consulta é definido como um campo e, dependendo do tipo de dados, pode ser ainda mais parametrizado por uma lista delimitada por vírgulas que inclua `count:<integer>`, `sort:<>`, `interval:<integer>` e `values:<list>`.</span><span class="sxs-lookup"><span data-stu-id="3f99b-235">A facet query parameter is set to a field and depending on the data type, can be further parameterized by comma-delimited list that includes `count:<integer>`, `sort:<>`, `interval:<integer>`, and `values:<list>`.</span></span> <span data-ttu-id="3f99b-236">Há suporte para dados numéricos em uma lista de valores ao configurar intervalos.</span><span class="sxs-lookup"><span data-stu-id="3f99b-236">A values list is supported for numeric data when setting up ranges.</span></span> <span data-ttu-id="3f99b-237">Consulte [Pesquisar documentos (API da Pesquisa do Azure)](http://msdn.microsoft.com/library/azure/dn798927.aspx) para obter detalhes de utilização.</span><span class="sxs-lookup"><span data-stu-id="3f99b-237">See [Search Documents (Azure Search API)](http://msdn.microsoft.com/library/azure/dn798927.aspx) for usage details.</span></span>

<span data-ttu-id="3f99b-238">Além de facetas, a solicitação formulada pelo seu aplicativo também deve criar filtros para restringir o conjunto de documentos candidatos com base em uma seleção de valor da faceta.</span><span class="sxs-lookup"><span data-stu-id="3f99b-238">Along with facets, the request formulated by your application should also build filters to narrow down the set of candidate documents based on a facet value selection.</span></span> <span data-ttu-id="3f99b-239">Para uma loja de bicicletas, a navegação facetada oferece dicas para perguntas como *Quais cores, fabricantes e tipos de bicicletas estão disponíveis?*.</span><span class="sxs-lookup"><span data-stu-id="3f99b-239">For a bike store, faceted navigation provides clues to questions like *What colors, manufacturers, and types of bikes are available?*.</span></span> <span data-ttu-id="3f99b-240">A filtragem de respostas a perguntas como *Quais bicicletas exatamente são vermelhas, mountain bikes e estão neste intervalo de preços?*.</span><span class="sxs-lookup"><span data-stu-id="3f99b-240">Filtering answers questions like *Which exact bikes are red, mountain bikes, in this price range?*.</span></span> <span data-ttu-id="3f99b-241">Quando você clica em "Vermelho" para indicar que somente os produtos vermelhos devem ser mostrados, a próxima consulta enviada pelo aplicativo inclui `$filter=Color eq ‘Red’`.</span><span class="sxs-lookup"><span data-stu-id="3f99b-241">When you click "Red" to indicate that only Red products should be shown, the next query the application sends includes `$filter=Color eq ‘Red’`.</span></span>

<span data-ttu-id="3f99b-242">O seguinte trecho de código da página `JobsSearch.cs` adiciona o Cargo selecionado de negócios ao filtro se você selecionar um valor na faceta Cargo.</span><span class="sxs-lookup"><span data-stu-id="3f99b-242">The following code snippet from the `JobsSearch.cs` page adds the selected Business Title to the filter if you select a value from the Business Title facet.</span></span>

```cs
if (businessTitleFacet != "")
  filter = "business_title eq '" + businessTitleFacet + "'";
```

<a name="tips"></a> 

## <a name="tips-and-best-practices"></a><span data-ttu-id="3f99b-243">Dicas e melhores práticas</span><span class="sxs-lookup"><span data-stu-id="3f99b-243">Tips and best practices</span></span>

### <a name="indexing-tips"></a><span data-ttu-id="3f99b-244">Dicas de indexação</span><span class="sxs-lookup"><span data-stu-id="3f99b-244">Indexing tips</span></span>
<span data-ttu-id="3f99b-245">**Melhorar a eficiência de índice se você não usar uma caixa de Pesquisa**</span><span class="sxs-lookup"><span data-stu-id="3f99b-245">**Improve index efficiency if you don't use a Search box**</span></span>

<span data-ttu-id="3f99b-246">Se seu aplicativo usa a navegação facetada exclusivamente (ou seja, sem nenhuma caixa de pesquisa), marque o campo como `searchable=false`, `facetable=true` para produzir um índice mais compacto.</span><span class="sxs-lookup"><span data-stu-id="3f99b-246">If your application uses faceted navigation exclusively (that is, no search box), you can mark the field as `searchable=false`, `facetable=true` to produce a more compact index.</span></span> <span data-ttu-id="3f99b-247">Além disso, a indexação ocorre somente em valores de faceta inteiros, sem nenhuma quebra de palavra nem indexação das partes componentes de um valor com várias palavras.</span><span class="sxs-lookup"><span data-stu-id="3f99b-247">In addition, indexing occurs only on whole facet values, with no word-break or indexing of the component parts of a multi-word value.</span></span>

<span data-ttu-id="3f99b-248">**Definir quais campos podem ser usados como facetas**</span><span class="sxs-lookup"><span data-stu-id="3f99b-248">**Specify which fields can be used as facets**</span></span>

<span data-ttu-id="3f99b-249">Lembre-se que o esquema de índice determina quais campos estão disponíveis para uso como uma faceta.</span><span class="sxs-lookup"><span data-stu-id="3f99b-249">Recall that the schema of the index determines which fields are available to use as a facet.</span></span> <span data-ttu-id="3f99b-250">Supondo que um campo seja passível de facetagem, a consulta especifica por quais campos realizar essa facetagem.</span><span class="sxs-lookup"><span data-stu-id="3f99b-250">Assuming a field is facetable, the query specifies which fields to facet by.</span></span> <span data-ttu-id="3f99b-251">O campo pelo qual você está realizando a facetagem fornece os valores que aparecem abaixo do rótulo.</span><span class="sxs-lookup"><span data-stu-id="3f99b-251">The field by which you are faceting provides the values that appear below the label.</span></span> 

<span data-ttu-id="3f99b-252">Os valores que aparecem em cada rótulo são recuperados do índice.</span><span class="sxs-lookup"><span data-stu-id="3f99b-252">The values that appear under each label are retrieved from the index.</span></span> <span data-ttu-id="3f99b-253">Por exemplo, se o campo da faceta for *Cor*, os valores disponíveis para filtragem adicional serão os valores para esse campo - Vermelho, Preto e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="3f99b-253">For example, if the facet field is *Color*, the values available for additional filtering are the values for that field - Red, Black, and so forth.</span></span>

<span data-ttu-id="3f99b-254">Apenas para valores dos campos Numérico e DataHora, você pode definir explicitamente os valores no campo da faceta (por exemplo, `facet=Rating,values:1|2|3|4|5`).</span><span class="sxs-lookup"><span data-stu-id="3f99b-254">For Numeric and DateTime values only, you can explicitly set values on the facet field (for example, `facet=Rating,values:1|2|3|4|5`).</span></span> <span data-ttu-id="3f99b-255">Uma lista de valores é permitida para esses tipos de campo para simplificar a separação dos resultados da faceta em intervalos contíguos (qualquer um dos intervalos com base em valores numéricos ou períodos de tempo).</span><span class="sxs-lookup"><span data-stu-id="3f99b-255">A values list is allowed for these field types to simplify the separation of facet results into contiguous ranges (either ranges based on numeric values or time periods).</span></span> 

<span data-ttu-id="3f99b-256">**Por padrão, você só pode ter um nível de navegação facetada**</span><span class="sxs-lookup"><span data-stu-id="3f99b-256">**By default you can only have one level of faceted navigation**</span></span> 

<span data-ttu-id="3f99b-257">Como observado, não há nenhum suporte direto para aninhamento de facetas em uma hierarquia.</span><span class="sxs-lookup"><span data-stu-id="3f99b-257">As noted, there is no direct support for nesting facets in a hierarchy.</span></span> <span data-ttu-id="3f99b-258">Por padrão, a navegação facetada no Azure Search dá suporte a apenas um nível de filtros.</span><span class="sxs-lookup"><span data-stu-id="3f99b-258">By default, faceted navigation in Azure Search only supports one level of filters.</span></span> <span data-ttu-id="3f99b-259">No entanto, existem soluções alternativas.</span><span class="sxs-lookup"><span data-stu-id="3f99b-259">However, workarounds do exist.</span></span> <span data-ttu-id="3f99b-260">Você pode codificar uma estrutura hierárquica de facetas em um `Collection(Edm.String)` com um ponto de entrada por hierarquia.</span><span class="sxs-lookup"><span data-stu-id="3f99b-260">You can encode a hierarchical facet structure in a `Collection(Edm.String)` with one entry point per hierarchy.</span></span> <span data-ttu-id="3f99b-261">Implementar essa solução alternativa está além do escopo deste artigo.</span><span class="sxs-lookup"><span data-stu-id="3f99b-261">Implementing this workaround is beyond the scope of this article.</span></span> 

### <a name="querying-tips"></a><span data-ttu-id="3f99b-262">Dicas de consulta</span><span class="sxs-lookup"><span data-stu-id="3f99b-262">Querying tips</span></span>
<span data-ttu-id="3f99b-263">**Validar campos**</span><span class="sxs-lookup"><span data-stu-id="3f99b-263">**Validate fields**</span></span>

<span data-ttu-id="3f99b-264">Se você criar a lista de facetas dinamicamente com base na entrada do usuário não confiável, valide se os nomes dos campos facetados são válidos.</span><span class="sxs-lookup"><span data-stu-id="3f99b-264">If you build the list of facets dynamically based on untrusted user input, validate that the names of the faceted fields are valid.</span></span> <span data-ttu-id="3f99b-265">Ou escape os nomes ao criar URLs usando `Uri.EscapeDataString()` no .NET ou o equivalente em sua plataforma de preferência.</span><span class="sxs-lookup"><span data-stu-id="3f99b-265">Or, escape the names when building URLs by using either `Uri.EscapeDataString()` in .NET, or the equivalent in your platform of choice.</span></span>

### <a name="filtering-tips"></a><span data-ttu-id="3f99b-266">Dicas de filtragem</span><span class="sxs-lookup"><span data-stu-id="3f99b-266">Filtering tips</span></span>
<span data-ttu-id="3f99b-267">**Aumentar a precisão da pesquisa com filtros**</span><span class="sxs-lookup"><span data-stu-id="3f99b-267">**Increase search precision with filters**</span></span>

<span data-ttu-id="3f99b-268">Utilize filtros.</span><span class="sxs-lookup"><span data-stu-id="3f99b-268">Use filters.</span></span> <span data-ttu-id="3f99b-269">Se você depender apenas de expressões de pesquisa, a lematização pode fazer com que seja retornado um documento que não tenha o valor preciso da faceta em nenhum de seus campos.</span><span class="sxs-lookup"><span data-stu-id="3f99b-269">If you rely on just search expressions alone, stemming could cause a document to be returned that doesn’t have the precise facet value in any of its fields.</span></span>

<span data-ttu-id="3f99b-270">**Aumentar o desempenho da pesquisa com filtros**</span><span class="sxs-lookup"><span data-stu-id="3f99b-270">**Increase search performance with filters**</span></span>

<span data-ttu-id="3f99b-271">Filtros restringem o conjunto de documentos candidatos para pesquisa e exclui-los da classificação.</span><span class="sxs-lookup"><span data-stu-id="3f99b-271">Filters narrow down the set of candidate documents for search and exclude them from ranking.</span></span> <span data-ttu-id="3f99b-272">Se você tiver um grande conjunto de documentos, usar uma busca detalhada de faceta seletiva geralmente proporciona melhor desempenho.</span><span class="sxs-lookup"><span data-stu-id="3f99b-272">If you have a large set of documents, using a selective facet drill-down often gives you better performance.</span></span>
  
<span data-ttu-id="3f99b-273">**Filtrar somente os campos facetados**</span><span class="sxs-lookup"><span data-stu-id="3f99b-273">**Filter only the faceted fields**</span></span>

<span data-ttu-id="3f99b-274">Em uma busca detalhada facetada, você geralmente deseja incluir apenas os documentos que tenham o valor da faceta em um campo específico (facetado), não em qualquer lugar por todos os campos de pesquisa pesquisáveis.</span><span class="sxs-lookup"><span data-stu-id="3f99b-274">In faceted drill-down, you typically want to only include documents that have the facet value in a specific (faceted) field, not anywhere across all searchable fields.</span></span> <span data-ttu-id="3f99b-275">A adição de um filtro reforça o campo alvo, direcionando o serviço para pesquisar somente no campo facetado por um valor correspondente.</span><span class="sxs-lookup"><span data-stu-id="3f99b-275">Adding a filter reinforces the target field by directing the service to search only in the faceted field for a matching value.</span></span>

<span data-ttu-id="3f99b-276">**Recortar resultados da faceta com mais filtros**</span><span class="sxs-lookup"><span data-stu-id="3f99b-276">**Trim facet results with more filters**</span></span>

<span data-ttu-id="3f99b-277">Resultados da faceta são documentos encontrados nos resultados da pesquisa que correspondem a um termo usado como faceta.</span><span class="sxs-lookup"><span data-stu-id="3f99b-277">Facet results are documents found in the search results that match a facet term.</span></span> <span data-ttu-id="3f99b-278">No exemplo a seguir, nos resultados da pesquisa para *computação em nuvem*, 254 itens também têm *especificação interna* como um tipo de conteúdo.</span><span class="sxs-lookup"><span data-stu-id="3f99b-278">In the following example, in search results for *cloud computing*, 254 items also have *internal specification* as a content type.</span></span> <span data-ttu-id="3f99b-279">Os itens não são necessariamente mutuamente exclusivos.</span><span class="sxs-lookup"><span data-stu-id="3f99b-279">Items are not necessarily mutually exclusive.</span></span> <span data-ttu-id="3f99b-280">Se um item atende aos critérios de ambos os filtros, ele será contado em cada um deles.</span><span class="sxs-lookup"><span data-stu-id="3f99b-280">If an item meets the criteria of both filters, it is counted in each one.</span></span> <span data-ttu-id="3f99b-281">Essa duplicação é possível ao realizar a facetagem em campos `Collection(Edm.String)`, que geralmente são usados para implementar a marcação do documento.</span><span class="sxs-lookup"><span data-stu-id="3f99b-281">This duplication is possible when faceting on `Collection(Edm.String)` fields, which are often used to implement document tagging.</span></span>

        Search term: "cloud computing"
        Content type
           Internal specification (254)
           Video (10) 

<span data-ttu-id="3f99b-282">Em geral, se você descobrir que os resultados da faceta costumam ser muito grandes, é recomendável adicionar mais filtros para fornecer aos usuários mais opções para limitar a pesquisa.</span><span class="sxs-lookup"><span data-stu-id="3f99b-282">In general, if you find that facet results are consistently too large, we recommend that you add more filters to give users more options for narrowing the search.</span></span>

### <a name="tips-about-result-count"></a><span data-ttu-id="3f99b-283">Dicas sobre contagem de resultados</span><span class="sxs-lookup"><span data-stu-id="3f99b-283">Tips about result count</span></span>

<span data-ttu-id="3f99b-284">**Limitar o número de itens na navegação facetada**</span><span class="sxs-lookup"><span data-stu-id="3f99b-284">**Limit the number of items in the facet navigation**</span></span>

<span data-ttu-id="3f99b-285">Para cada campo facetado na árvore de navegação, há um limite padrão de 10 valores.</span><span class="sxs-lookup"><span data-stu-id="3f99b-285">For each faceted field in the navigation tree, there is a default limit of 10 values.</span></span> <span data-ttu-id="3f99b-286">Esse padrão faz sentido para estruturas de navegação porque mantém a lista de valores de um tamanho gerenciável.</span><span class="sxs-lookup"><span data-stu-id="3f99b-286">This default makes sense for navigation structures because it keeps the values list to a manageable size.</span></span> <span data-ttu-id="3f99b-287">Você pode substituir o padrão, atribuindo um valor para a contagem.</span><span class="sxs-lookup"><span data-stu-id="3f99b-287">You can override the default by assigning a value to count.</span></span>

* <span data-ttu-id="3f99b-288">`&facet=city,count:5` especifica que apenas as cinco primeiras cidades localizadas nos resultados com a melhor classificação são retornadas como um resultado da faceta.</span><span class="sxs-lookup"><span data-stu-id="3f99b-288">`&facet=city,count:5` specifies that only the first five cities found in the top ranked results are returned as a facet result.</span></span> <span data-ttu-id="3f99b-289">Considere um exemplo de consulta com um termo de pesquisa "aeroporto" e 32 correspondências.</span><span class="sxs-lookup"><span data-stu-id="3f99b-289">Consider a sample query with a search term of “airport” and 32 matches.</span></span> <span data-ttu-id="3f99b-290">Se a consulta especificar `&facet=city,count:5`, somente as cinco primeiras cidades únicas com a maioria dos documentos nos resultados da pesquisa serão incluídas nos resultados da faceta.</span><span class="sxs-lookup"><span data-stu-id="3f99b-290">If the query specifies `&facet=city,count:5`, only the first five unique cities with the most documents in the search results are included in the facet results.</span></span>

<span data-ttu-id="3f99b-291">Observe a diferença entre os resultados da pesquisa e os resultados da faceta.</span><span class="sxs-lookup"><span data-stu-id="3f99b-291">Notice the distinction between facet results and search results.</span></span> <span data-ttu-id="3f99b-292">Os resultados da pesquisa são todos os documentos que correspondem à consulta.</span><span class="sxs-lookup"><span data-stu-id="3f99b-292">Search results are all the documents that match the query.</span></span> <span data-ttu-id="3f99b-293">Os resultados da faceta são as correspondências para cada valor da faceta.</span><span class="sxs-lookup"><span data-stu-id="3f99b-293">Facet results are the matches for each facet value.</span></span> <span data-ttu-id="3f99b-294">No exemplo, os resultados da pesquisa incluem nomes de cidades que não estão na lista de classificação da faceta (5 em nosso exemplo).</span><span class="sxs-lookup"><span data-stu-id="3f99b-294">In the example, search results include City names that are not in the facet classification list (5 in our example).</span></span> <span data-ttu-id="3f99b-295">Os resultados que são filtrados por meio de navegação facetada se tornam visíveis quando você limpa facetas ou escolhe outras facetas além de Cidade.</span><span class="sxs-lookup"><span data-stu-id="3f99b-295">Results that are filtered out through faceted navigation become visible when you clear facets, or choose other facets besides City.</span></span> 

> [!NOTE]
> <span data-ttu-id="3f99b-296">Discutir `count` quando há mais de um tipo pode ser confuso.</span><span class="sxs-lookup"><span data-stu-id="3f99b-296">Discussing `count` when there is more than one type can be confusing.</span></span> <span data-ttu-id="3f99b-297">A tabela a seguir oferece um breve resumo de como o termo é usado na API de Pesquisa do Azure, um código de exemplo e a documentação.</span><span class="sxs-lookup"><span data-stu-id="3f99b-297">The following table offers a brief summary of how the term is used in Azure Search API, sample code, and documentation.</span></span> 

* `@colorFacet.count`<br/>
  <span data-ttu-id="3f99b-298">No código de apresentação, você deverá ver um parâmetro de contagem na faceta, usada para exibir o número de resultados da faceta.</span><span class="sxs-lookup"><span data-stu-id="3f99b-298">In presentation code, you should see a count parameter on the facet, used to display the number of facet results.</span></span> <span data-ttu-id="3f99b-299">Nos resultados da faceta, a contagem indica o número de documentos que correspondam ao intervalo ou termo da faceta em questão.</span><span class="sxs-lookup"><span data-stu-id="3f99b-299">In facet results, count indicates the number of documents that match on the facet term or range.</span></span>
* `&facet=City,count:12`<br/>
  <span data-ttu-id="3f99b-300">Em uma consulta de faceta, você pode definir a contagem para um determinado valor.</span><span class="sxs-lookup"><span data-stu-id="3f99b-300">In a facet query, you can set count to a value.</span></span>  <span data-ttu-id="3f99b-301">O padrão é 10, mas você pode defini-lo com um valor maior ou menor.</span><span class="sxs-lookup"><span data-stu-id="3f99b-301">The default is 10, but you can set it higher or lower.</span></span> <span data-ttu-id="3f99b-302">Definir `count:12` retorna as 12 correspondências melhor classificadas nos resultados da faceta pela contagem de documento.</span><span class="sxs-lookup"><span data-stu-id="3f99b-302">Setting `count:12` gets the top 12 matches in facet results by document count.</span></span>
* <span data-ttu-id="3f99b-303">"`@odata.count`"</span><span class="sxs-lookup"><span data-stu-id="3f99b-303">"`@odata.count`"</span></span><br/>
  <span data-ttu-id="3f99b-304">Na resposta da consulta, esse valor indica o número de itens correspondentes nos resultados da pesquisa.</span><span class="sxs-lookup"><span data-stu-id="3f99b-304">In the query response, this value indicates the number of matching items in the search results.</span></span> <span data-ttu-id="3f99b-305">Em média, ele é maior que a soma de todos os resultados de faceta combinados, devido à presença de itens que correspondem ao termo de pesquisa, mas não tem correspondências com o valor da faceta.</span><span class="sxs-lookup"><span data-stu-id="3f99b-305">On average, it’s larger than the sum of all facet results combined, due to the presence of items that match the search term, but have no facet value matches.</span></span>

<span data-ttu-id="3f99b-306">**Obter contagens dos resultados da faceta**</span><span class="sxs-lookup"><span data-stu-id="3f99b-306">**Get counts in facet results**</span></span>

<span data-ttu-id="3f99b-307">Ao adicionar um filtro a uma consulta facetada, talvez você queira manter a instrução da faceta (por exemplo, `facet=Rating&$filter=Rating ge 4`).</span><span class="sxs-lookup"><span data-stu-id="3f99b-307">When you add a filter to a faceted query, you might want to retain the facet statement (for example, `facet=Rating&$filter=Rating ge 4`).</span></span> <span data-ttu-id="3f99b-308">Tecnicamente, facet=Rating não é necessária, mas mantê-la retorna as contagens de valores de faceta para classificações iguais ou superiores a 4.</span><span class="sxs-lookup"><span data-stu-id="3f99b-308">Technically, facet=Rating isn’t needed, but keeping it returns the counts of facet values for ratings 4 and higher.</span></span> <span data-ttu-id="3f99b-309">Por exemplo, se você clica em "4" e a consulta inclui um filtro para maior ou igual a "4", as contagens são retornadas para cada classificação igual ou superior a 4.</span><span class="sxs-lookup"><span data-stu-id="3f99b-309">For example, if you click "4" and the query includes a filter for greater or equal to "4", counts are returned for each rating that is 4 and higher.</span></span>  

<span data-ttu-id="3f99b-310">**Certifique-se de obter contagens de facetas precisas**</span><span class="sxs-lookup"><span data-stu-id="3f99b-310">**Make sure you get accurate facet counts**</span></span>

<span data-ttu-id="3f99b-311">Em determinadas circunstâncias, você pode achar que as contagens de faceta não coincidem com os conjuntos de resultados (consulte [Navegação facetada na Pesquisa do Azure (postagem no fórum)](https://social.msdn.microsoft.com/Forums/azure/06461173-ea26-4e6a-9545-fbbd7ee61c8f/faceting-on-azure-search?forum=azuresearch)).</span><span class="sxs-lookup"><span data-stu-id="3f99b-311">Under certain circumstances, you might find that facet counts do not match the result sets (see [Faceted navigation in Azure Search (forum post)](https://social.msdn.microsoft.com/Forums/azure/06461173-ea26-4e6a-9545-fbbd7ee61c8f/faceting-on-azure-search?forum=azuresearch)).</span></span>

<span data-ttu-id="3f99b-312">As contagens de faceta podem ser imprecisas devido à arquitetura de fragmentação.</span><span class="sxs-lookup"><span data-stu-id="3f99b-312">Facet counts can be inaccurate due to the sharding architecture.</span></span> <span data-ttu-id="3f99b-313">Cada índice de pesquisa tem vários fragmentos, e cada um deles relata as N facetas com maior classificação por contagem de documento, que em seguida são combinadas em um único resultado.</span><span class="sxs-lookup"><span data-stu-id="3f99b-313">Every search index has multiple shards, and each shard reports the top N facets by document count, which is then combined into a single result.</span></span> <span data-ttu-id="3f99b-314">Se alguns fragmentos têm muitos valores correspondentes enquanto outros têm menos, você poderá descobrir que alguns valores de faceta estão faltando ou com contagem reduzida nos resultados.</span><span class="sxs-lookup"><span data-stu-id="3f99b-314">If some shards have many matching values, while others have fewer, you may find that some facet values are missing or under-counted in the results.</span></span>

<span data-ttu-id="3f99b-315">Embora esse comportamento possa mudar a qualquer momento, se você encontrar esse problema hoje, você pode contorná-lo artificialmente aumentando a contagem:<number> para um número grande para impor a emissão de relatórios completos de cada fragmento.</span><span class="sxs-lookup"><span data-stu-id="3f99b-315">Although this behavior could change at any time, if you encounter this behavior today, you can work around it by artificially inflating the count:<number> to a large number to enforce full reporting from each shard.</span></span> <span data-ttu-id="3f99b-316">Se o valor de contagem: é maior que ou igual ao número de valores exclusivos no campo, você tem a garantia de resultados precisos.</span><span class="sxs-lookup"><span data-stu-id="3f99b-316">If the value of count: is greater than or equal to the number of unique values in the field, you are guaranteed accurate results.</span></span> <span data-ttu-id="3f99b-317">No entanto, quando as contagens de documento são altas há uma penalidade de desempenho, portanto, use essa opção criteriosamente.</span><span class="sxs-lookup"><span data-stu-id="3f99b-317">However, when document counts are high, there is a performance penalty, so use this option judiciously.</span></span>

### <a name="user-interface-tips"></a><span data-ttu-id="3f99b-318">Dicas da interface do usuário</span><span class="sxs-lookup"><span data-stu-id="3f99b-318">User interface tips</span></span>
<span data-ttu-id="3f99b-319">**Adicionar rótulos para cada campo na navegação facetada**</span><span class="sxs-lookup"><span data-stu-id="3f99b-319">**Add labels for each field in facet navigation**</span></span>

<span data-ttu-id="3f99b-320">Os rótulos geralmente são definidos no HTML ou no formulário (`index.cshtml` no aplicativo de exemplo).</span><span class="sxs-lookup"><span data-stu-id="3f99b-320">Labels are typically defined in the HTML or form (`index.cshtml` in the sample application).</span></span> <span data-ttu-id="3f99b-321">Não há API no Azure Search para rótulos de navegação facetada ou qualquer outro metadado.</span><span class="sxs-lookup"><span data-stu-id="3f99b-321">There is no API in Azure Search for facet navigation labels or any other metadata.</span></span>

<a name="rangefacets"></a>

## <a name="filter-based-on-a-range"></a><span data-ttu-id="3f99b-322">Filtrar com base em um intervalo</span><span class="sxs-lookup"><span data-stu-id="3f99b-322">Filter based on a range</span></span>
<span data-ttu-id="3f99b-323">A facetagem em intervalos de valores é um requisito comum de aplicativo de pesquisa.</span><span class="sxs-lookup"><span data-stu-id="3f99b-323">Faceting over ranges of values is a common search application requirement.</span></span> <span data-ttu-id="3f99b-324">Intervalos têm suporte para dados numéricos e valores de DataHora.</span><span class="sxs-lookup"><span data-stu-id="3f99b-324">Ranges are supported for numeric data and DateTime values.</span></span> <span data-ttu-id="3f99b-325">Você pode ler mais sobre cada abordagem em [Procurar documentos (API da Pesquisa do Azure)](http://msdn.microsoft.com/library/azure/dn798927.aspx).</span><span class="sxs-lookup"><span data-stu-id="3f99b-325">You can read more about each approach in [Search Documents (Azure Search API)](http://msdn.microsoft.com/library/azure/dn798927.aspx).</span></span>

<span data-ttu-id="3f99b-326">A Pesquisa do Azure simplifica a construção do intervalo, fornecendo duas abordagens para a computação de um intervalo.</span><span class="sxs-lookup"><span data-stu-id="3f99b-326">Azure Search simplifies range construction by providing two approaches for computing a range.</span></span> <span data-ttu-id="3f99b-327">Para ambas as abordagens, a Pesquisa do Azure cria os intervalos apropriados, considerando as entradas que você forneceu.</span><span class="sxs-lookup"><span data-stu-id="3f99b-327">For both approaches, Azure Search creates the appropriate ranges given the inputs you’ve provided.</span></span> <span data-ttu-id="3f99b-328">Por exemplo, se você especificar valores de intervalo de 10|20|30, ele criará automaticamente intervalos de 0-10, 10-20, 20-30 -10, 10-20 e 20-30.</span><span class="sxs-lookup"><span data-stu-id="3f99b-328">For instance, if you specify range values of 10|20|30, it automatically creates ranges of 0-10, 10-20, 20-30.</span></span> <span data-ttu-id="3f99b-329">Seu aplicativo pode, opcionalmente, remover quaisquer intervalos que estejam vazios.</span><span class="sxs-lookup"><span data-stu-id="3f99b-329">Your application can optionally remove any intervals that are empty.</span></span> 

<span data-ttu-id="3f99b-330">**Abordagem 1: usar o parâmetro de intervalo**</span><span class="sxs-lookup"><span data-stu-id="3f99b-330">**Approach 1: Use the interval parameter**</span></span>  
<span data-ttu-id="3f99b-331">Para definir facetas de preço em incrementos de US$ 10, você deve especificar: `&facet=price,interval:10`</span><span class="sxs-lookup"><span data-stu-id="3f99b-331">To set price facets in $10 increments, you would specify: `&facet=price,interval:10`</span></span>

<span data-ttu-id="3f99b-332">**Abordagem 2: usar uma lista de valores**</span><span class="sxs-lookup"><span data-stu-id="3f99b-332">**Approach 2: Use a values list**</span></span>  
<span data-ttu-id="3f99b-333">Para dados numéricos, você pode usar uma lista de valores.</span><span class="sxs-lookup"><span data-stu-id="3f99b-333">For numeric data, you can use a values list.</span></span>  <span data-ttu-id="3f99b-334">Considere o intervalo da faceta para um campo `listPrice`, renderizado como a seguir:</span><span class="sxs-lookup"><span data-stu-id="3f99b-334">Consider the facet range for a `listPrice` field, rendered as follows:</span></span>

  ![Lista de valores de exemplo][5]

<span data-ttu-id="3f99b-336">Para especificar um intervalo da faceta como a mostrada na captura de tela a anterior, use uma lista de valores:</span><span class="sxs-lookup"><span data-stu-id="3f99b-336">To specify a facet range like the one in the preceding screen shot, use a values list:</span></span>

    facet=listPrice,values:10|25|100|500|1000|2500

<span data-ttu-id="3f99b-337">Cada intervalo é criado usando 0 como ponto de partida, um valor da lista como um ponto de extremidade e então recortado do intervalo anterior para criar intervalos discretos.</span><span class="sxs-lookup"><span data-stu-id="3f99b-337">Each range is built using 0 as a starting point, a value from the list as an endpoint, and then trimmed of the previous range to create discrete intervals.</span></span> <span data-ttu-id="3f99b-338">O Azure Search faz essas coisas como parte da navegação facetada.</span><span class="sxs-lookup"><span data-stu-id="3f99b-338">Azure Search does these things as part of faceted navigation.</span></span> <span data-ttu-id="3f99b-339">Você não precisa escrever código para estruturar cada intervalo.</span><span class="sxs-lookup"><span data-stu-id="3f99b-339">You do not have to write code for structuring each interval.</span></span>

### <a name="build-a-filter-for-a-range"></a><span data-ttu-id="3f99b-340">Criar um filtro para um intervalo</span><span class="sxs-lookup"><span data-stu-id="3f99b-340">Build a filter for a range</span></span>
<span data-ttu-id="3f99b-341">Para filtrar os documentos com base em um intervalo selecionado por você, será possível usar os operadores de filtragem `"ge"` e `"lt"` em uma expressão de duas partes que defina os pontos de extremidade do intervalo.</span><span class="sxs-lookup"><span data-stu-id="3f99b-341">To filter documents based on a range you select, you can use the `"ge"` and `"lt"` filter operators in a two-part expression that defines the endpoints of the range.</span></span> <span data-ttu-id="3f99b-342">Por exemplo, se você escolher o intervalo 10-25 para uma `listPrice` campo, o filtro será `$filter=listPrice ge 10 and listPrice lt 25`.</span><span class="sxs-lookup"><span data-stu-id="3f99b-342">For example, if you choose the range 10-25 for a `listPrice` field, the filter would be `$filter=listPrice ge 10 and listPrice lt 25`.</span></span> <span data-ttu-id="3f99b-343">No código de exemplo, a expressão de filtro usa os parâmetros **priceFrom** e **priceTo** para definir os pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="3f99b-343">In the sample code, the filter expression uses **priceFrom** and **priceTo** parameters to set the endpoints.</span></span> 

  ![Consultar um intervalo de valores][6]

<a name="geofacets"></a> 

## <a name="filter-based-on-distance"></a><span data-ttu-id="3f99b-345">Filtrar com base na distância</span><span class="sxs-lookup"><span data-stu-id="3f99b-345">Filter based on distance</span></span>
<span data-ttu-id="3f99b-346">É comum ver filtros que ajudam você a escolher uma loja, restaurante ou destino com base na proximidade desse local com relação ao local onde você está atualmente.</span><span class="sxs-lookup"><span data-stu-id="3f99b-346">It’s common to see filters that help you choose a store, restaurant, or destination based on its proximity to your current location.</span></span> <span data-ttu-id="3f99b-347">Embora esse tipo de filtro possa parecer com a navegação facetada, trata-se apenas de um filtro.</span><span class="sxs-lookup"><span data-stu-id="3f99b-347">While this type of filter might look like faceted navigation, it’s just a filter.</span></span> <span data-ttu-id="3f99b-348">Mencionamos isso aqui para aqueles que estão procurando especificamente conselhos de implementação para um problema de design específico.</span><span class="sxs-lookup"><span data-stu-id="3f99b-348">We mention it here for those of you who are specifically looking for implementation advice for that particular design problem.</span></span>

<span data-ttu-id="3f99b-349">Há duas funções geoespaciais no Azure Search, **geo.distance** e **geo.intersects**.</span><span class="sxs-lookup"><span data-stu-id="3f99b-349">There are two Geospatial functions in Azure Search, **geo.distance** and **geo.intersects**.</span></span>

* <span data-ttu-id="3f99b-350">A função **geo.distance** retorna a distância em quilômetros entre dois pontos.</span><span class="sxs-lookup"><span data-stu-id="3f99b-350">The **geo.distance** function returns the distance in kilometers between two points.</span></span> <span data-ttu-id="3f99b-351">Um ponto é um campo e o outro é uma constante passada como parte do filtro.</span><span class="sxs-lookup"><span data-stu-id="3f99b-351">One point is a field and other is a constant passed as part of the filter.</span></span> 
* <span data-ttu-id="3f99b-352">A função **geo.intersects** retornará true se um determinado ponto estiver dentro de um polígono determinado.</span><span class="sxs-lookup"><span data-stu-id="3f99b-352">The **geo.intersects** function returns true if a given point is within a given polygon.</span></span> <span data-ttu-id="3f99b-353">O ponto é um campo e o polígono é especificado como uma lista constante de coordenadas passadas como parte do filtro.</span><span class="sxs-lookup"><span data-stu-id="3f99b-353">The point is a field and the polygon is specified as a constant list of coordinates passed as part of the filter.</span></span>

<span data-ttu-id="3f99b-354">Você pode encontrar exemplos de filtros em [Sintaxe de expressão OData (Pesquisa do Azure)](http://msdn.microsoft.com/library/azure/dn798921.aspx).</span><span class="sxs-lookup"><span data-stu-id="3f99b-354">You can find filter examples in [OData expression syntax (Azure Search)](http://msdn.microsoft.com/library/azure/dn798921.aspx).</span></span>

<a name="tryitout"></a>

## <a name="try-the-demo"></a><span data-ttu-id="3f99b-355">Experimente a demonstração</span><span class="sxs-lookup"><span data-stu-id="3f99b-355">Try the demo</span></span>
<span data-ttu-id="3f99b-356">A Demonstração do Portal de Trabalho do Azure Search contém os exemplos mencionados neste artigo.</span><span class="sxs-lookup"><span data-stu-id="3f99b-356">The Azure Search Job Portal Demo contains the examples referenced in this article.</span></span>

-   <span data-ttu-id="3f99b-357">Veja e teste a demonstração de trabalho online na [Demonstração do portal do trabalho do Azure Search](http://azjobsdemo.azurewebsites.net/).</span><span class="sxs-lookup"><span data-stu-id="3f99b-357">See and test the working demo online at [Azure Search Job Portal Demo](http://azjobsdemo.azurewebsites.net/).</span></span>

-   <span data-ttu-id="3f99b-358">Baixe o código do [repositório Azure-Samples no GitHub](https://github.com/Azure-Samples/search-dotnet-asp-net-mvc-jobs).</span><span class="sxs-lookup"><span data-stu-id="3f99b-358">Download the code from the [Azure-Samples repo on GitHub](https://github.com/Azure-Samples/search-dotnet-asp-net-mvc-jobs).</span></span>

<span data-ttu-id="3f99b-359">Ao trabalhar com os resultados da pesquisa, monitore a URL quanto a alterações na construção de consulta.</span><span class="sxs-lookup"><span data-stu-id="3f99b-359">As you work with search results, watch the URL for changes in query construction.</span></span> <span data-ttu-id="3f99b-360">Esse aplicativo acrescenta facetas ao URI conforme você seleciona cada uma.</span><span class="sxs-lookup"><span data-stu-id="3f99b-360">This application happens to append facets to the URI as you select each one.</span></span>

1. <span data-ttu-id="3f99b-361">Para usar a funcionalidade de mapeamento do aplicativo de demonstração, obtém uma chave do Bing Mapas no [Centro de Desenvolvimento do Bing Mapas](https://www.bingmapsportal.com/).</span><span class="sxs-lookup"><span data-stu-id="3f99b-361">To use the mapping functionality of the demo app, get a Bing Maps key from the [Bing Maps Dev Center](https://www.bingmapsportal.com/).</span></span> <span data-ttu-id="3f99b-362">Cole-a sobre a chave existente na página `index.cshtml`.</span><span class="sxs-lookup"><span data-stu-id="3f99b-362">Paste it over the existing key in the `index.cshtml` page.</span></span> <span data-ttu-id="3f99b-363">A configuração `BingApiKey` no arquivo `Web.config` não é usada.</span><span class="sxs-lookup"><span data-stu-id="3f99b-363">The `BingApiKey` setting in the `Web.config` file is not used.</span></span> 

2. <span data-ttu-id="3f99b-364">Execute o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="3f99b-364">Run the application.</span></span> <span data-ttu-id="3f99b-365">Faça o tour opcional ou ignore a caixa de diálogo.</span><span class="sxs-lookup"><span data-stu-id="3f99b-365">Take the optional tour, or dismiss the dialog box.</span></span>
   
3. <span data-ttu-id="3f99b-366">Insira um termo de pesquisa, como "analista" e clique no ícone de pesquisa.</span><span class="sxs-lookup"><span data-stu-id="3f99b-366">Enter a search term, such as "analyst", and click the Search icon.</span></span> <span data-ttu-id="3f99b-367">A consulta é executada rapidamente.</span><span class="sxs-lookup"><span data-stu-id="3f99b-367">The query executes quickly.</span></span>
   
   <span data-ttu-id="3f99b-368">Uma estrutura de navegação facetada também é retornada com os resultados da pesquisa.</span><span class="sxs-lookup"><span data-stu-id="3f99b-368">A faceted navigation structure is also returned with the search results.</span></span> <span data-ttu-id="3f99b-369">Na página de resultados de pesquisa, a estrutura de navegação facetada inclui contagens para cada resultado da faceta.</span><span class="sxs-lookup"><span data-stu-id="3f99b-369">In the search result page, the faceted navigation structure includes counts for each facet result.</span></span> <span data-ttu-id="3f99b-370">Nenhuma faceta está selecionada, todos os resultados correspondentes são retornados.</span><span class="sxs-lookup"><span data-stu-id="3f99b-370">No facets are selected, so all matching results are returned.</span></span>
   
   ![Resultados da pesquisa antes de selecionar facetas][11]

4. <span data-ttu-id="3f99b-372">Clique em um Cargo, Local ou Salário Mínimo.</span><span class="sxs-lookup"><span data-stu-id="3f99b-372">Click a Business Title, Location, or Minimum Salary.</span></span> <span data-ttu-id="3f99b-373">As facetas eram nulas na pesquisa inicial, mas já que elas recebem valores, os resultados da pesquisa são recortados eliminando-se os itens que não correspondem mais.</span><span class="sxs-lookup"><span data-stu-id="3f99b-373">Facets were null on the initial search, but as they take on values, the search results are trimmed of items that no longer match.</span></span>
   
   ![Resultados da pesquisa após a seleção de facetas][12]

5. <span data-ttu-id="3f99b-375">Para limpar a consulta facetada para que você possa tentar comportamentos de consulta diferentes, clique o `[X]` após as facetas selecionadas para limpar as facetas.</span><span class="sxs-lookup"><span data-stu-id="3f99b-375">To clear the faceted query so that you can try different query behaviors, click the `[X]` after the selected facets to clear the facets.</span></span>
   
<a name="nextstep"></a>

## <a name="learn-more"></a><span data-ttu-id="3f99b-376">Saiba mais</span><span class="sxs-lookup"><span data-stu-id="3f99b-376">Learn more</span></span>
<span data-ttu-id="3f99b-377">Assista [Aprofundamento no Azure Search](http://channel9.msdn.com/Events/TechEd/Europe/2014/DBI-B410).</span><span class="sxs-lookup"><span data-stu-id="3f99b-377">Watch [Azure Search Deep Dive](http://channel9.msdn.com/Events/TechEd/Europe/2014/DBI-B410).</span></span> <span data-ttu-id="3f99b-378">Em 45:25, há uma demonstração de como implementar facetas.</span><span class="sxs-lookup"><span data-stu-id="3f99b-378">At 45:25, there is a demo on how to implement facets.</span></span>

<span data-ttu-id="3f99b-379">Para obter mais informações sobre princípios de design para navegação facetada, recomendamos os seguintes links:</span><span class="sxs-lookup"><span data-stu-id="3f99b-379">For more insights on design principles for faceted navigation, we recommend the following links:</span></span>

* [<span data-ttu-id="3f99b-380">Design para pesquisa facetada</span><span class="sxs-lookup"><span data-stu-id="3f99b-380">Designing for Faceted Search</span></span>](http://www.uie.com/articles/faceted_search/)
* [<span data-ttu-id="3f99b-381">Padrões de design: navegação facetada</span><span class="sxs-lookup"><span data-stu-id="3f99b-381">Design Patterns: Faceted Navigation</span></span>](http://alistapart.com/article/design-patterns-faceted-navigation)


<!--Anchors-->
[How to build it]: #howtobuildit
[Build the presentation layer]: #presentationlayer
[Build the index]: #buildindex
[Check for data quality]: #checkdata
[Build the query]: #buildquery
[Tips on how to control faceted navigation]: #tips
[Faceted navigation based on range values]: #rangefacets
[Faceted navigation based on GeoPoints]: #geofacets
[Try it out]: #tryitout

<!--Image references-->
[1]: ./media/search-faceted-navigation/azure-search-faceting-example.PNG
[2]: ./media/search-faceted-navigation/Facet-2-CSHTML.PNG
[3]: ./media/search-faceted-navigation/Facet-3-schema.PNG
[4]: ./media/search-faceted-navigation/Facet-4-SearchMethod.PNG
[5]: ./media/search-faceted-navigation/Facet-5-Prices.PNG
[6]: ./media/search-faceted-navigation/Facet-6-buildfilter.PNG
[7]: ./media/search-faceted-navigation/Facet-7-appstart.png
[8]: ./media/search-faceted-navigation/Facet-8-appbike.png
[9]: ./media/search-faceted-navigation/Facet-9-appbikefaceted.png
[10]: ./media/search-faceted-navigation/Facet-10-appTitle.png
[11]: ./media/search-faceted-navigation/faceted-search-before-facets.png
[12]: ./media/search-faceted-navigation/faceted-search-after-facets.png

<!--Link references-->
[Designing for Faceted Search]: http://www.uie.com/articles/faceted_search/
[Design Patterns: Faceted Navigation]: http://alistapart.com/article/design-patterns-faceted-navigation
[Create your first application]: search-create-first-solution.md
[OData expression syntax (Azure Search)]: http://msdn.microsoft.com/library/azure/dn798921.aspx
[Azure Search Adventure Works Demo]: https://azuresearchadventureworksdemo.codeplex.com/
[http://www.odata.org/documentation/odata-version-2-0/overview/]: http://www.odata.org/documentation/odata-version-2-0/overview/ 
[Faceting on Azure Search forum post]: ../faceting-on-azure-search.md?forum=azuresearch
[Search Documents (Azure Search API)]: http://msdn.microsoft.com/library/azure/dn798927.aspx

