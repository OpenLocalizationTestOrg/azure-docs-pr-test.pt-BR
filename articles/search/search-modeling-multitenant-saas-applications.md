---
title: "Modelagem multilocação no Azure Search | Microsoft Docs"
description: "Saiba mais sobre padrões de design comuns para aplicativos SaaS multilocatários ao usar o Azure Search."
services: search
manager: jhubbard
author: ashmaka
documentationcenter: 
ms.assetid: 72e9696a-553b-47dc-9e05-a82db0ebf094
ms.service: search
ms.devlang: NA
ms.workload: search
ms.topic: article
ms.tgt_pltfrm: na
ms.date: 10/26/2016
ms.author: ashmaka
ms.openlocfilehash: fd1b0c7cc8210d27fdc500bf4e5641bedfe93cff
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="design-patterns-for-multitenant-saas-applications-and-azure-search"></a><span data-ttu-id="06ca6-103">Padrões de design para aplicativos SaaS multilocatários e Azure Search</span><span class="sxs-lookup"><span data-stu-id="06ca6-103">Design patterns for multitenant SaaS applications and Azure Search</span></span>
<span data-ttu-id="06ca6-104">Um aplicativo multilocatário é aquele que fornece os mesmos serviços e funcionalidades para qualquer número de locatários que não conseguem ver nem compartilhar os dados de qualquer outro locatário.</span><span class="sxs-lookup"><span data-stu-id="06ca6-104">A multitenant application is one that provides the same services and capabilities to any number of tenants who cannot see or share the data of any other tenant.</span></span> <span data-ttu-id="06ca6-105">Este documento discute estratégias de isolamento de locatário para aplicativos multilocatários criados com o Azure Search.</span><span class="sxs-lookup"><span data-stu-id="06ca6-105">This document discusses tenant isolation strategies for multitenant applications built with Azure Search.</span></span>

## <a name="azure-search-concepts"></a><span data-ttu-id="06ca6-106">Conceitos do Azure Search</span><span class="sxs-lookup"><span data-stu-id="06ca6-106">Azure Search concepts</span></span>
<span data-ttu-id="06ca6-107">Como uma solução de pesquisa como serviço, o Azure Search permite aos desenvolvedores adicionar experiências de pesquisa avançada para aplicativos sem nenhuma infraestrutura de gerenciamento ou se tornar um especialista em pesquisa.</span><span class="sxs-lookup"><span data-stu-id="06ca6-107">As a search-as-a-service solution, Azure Search allows developers to add rich search experiences to applications without managing any infrastructure or becoming an expert in search.</span></span> <span data-ttu-id="06ca6-108">Os dados são carregados para o serviço e, em seguida, são armazenados na nuvem.</span><span class="sxs-lookup"><span data-stu-id="06ca6-108">Data is uploaded to the service and then stored in the cloud.</span></span> <span data-ttu-id="06ca6-109">Usando solicitações simples para a API do Azure Search, os dados podem então ser modificados e pesquisados.</span><span class="sxs-lookup"><span data-stu-id="06ca6-109">Using simple requests to the Azure Search API, the data can then be modified and searched.</span></span> <span data-ttu-id="06ca6-110">Uma visão geral do serviço pode ser encontrada em [neste artigo](http://aka.ms/whatisazsearch).</span><span class="sxs-lookup"><span data-stu-id="06ca6-110">An overview of the service can be found in [this article](http://aka.ms/whatisazsearch).</span></span> <span data-ttu-id="06ca6-111">Antes de discutir os padrões de design, é importante compreender alguns conceitos do Azure Search.</span><span class="sxs-lookup"><span data-stu-id="06ca6-111">Before discussing design patterns, it is important to understand some concepts in Azure Search.</span></span>

### <a name="search-services-indexes-fields-and-documents"></a><span data-ttu-id="06ca6-112">Serviços de pesquisa, índices, campos e documentos</span><span class="sxs-lookup"><span data-stu-id="06ca6-112">Search services, indexes, fields, and documents</span></span>
<span data-ttu-id="06ca6-113">Ao usar o Azure Search, alguém assina um *serviço de pesquisa*.</span><span class="sxs-lookup"><span data-stu-id="06ca6-113">When using Azure Search, one subscribes to a *search service*.</span></span> <span data-ttu-id="06ca6-114">Como os dados são carregados no Azure Search, eles são armazenados em um *índice* dentro do serviço de pesquisa.</span><span class="sxs-lookup"><span data-stu-id="06ca6-114">As data is uploaded to Azure Search, it is stored in an *index* within the search service.</span></span> <span data-ttu-id="06ca6-115">Pode haver um número de índices em um único serviço.</span><span class="sxs-lookup"><span data-stu-id="06ca6-115">There can be a number of indexes within a single service.</span></span> <span data-ttu-id="06ca6-116">Para usar os conceitos familiares de bancos de dados, o serviço de pesquisa pode ser comparado a um banco de dados, enquanto os índices dentro de um serviço podem ser comparados a tabelas em um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="06ca6-116">To use the familiar concepts of databases, the search service can be likened to a database while the indexes within a service can be likened to tables within a database.</span></span>

<span data-ttu-id="06ca6-117">Cada índice dentro de um serviço de pesquisa tem seu próprio esquema, que é definido por um número de *campos*personalizáveis.</span><span class="sxs-lookup"><span data-stu-id="06ca6-117">Each index within a search service has its own schema, which is defined by a number of customizable *fields*.</span></span> <span data-ttu-id="06ca6-118">Os dados são adicionados a um índice do Azure Search na forma de *documentos*individuais.</span><span class="sxs-lookup"><span data-stu-id="06ca6-118">Data is added to an Azure Search index in the form of individual *documents*.</span></span> <span data-ttu-id="06ca6-119">Cada documento deve ser carregado em um índice específico e deve se ajustar o esquema do índice.</span><span class="sxs-lookup"><span data-stu-id="06ca6-119">Each document must be uploaded to a particular index and must fit that index's schema.</span></span> <span data-ttu-id="06ca6-120">Ao pesquisar dados usando o Azure Search, as consultas de pesquisa de texto completo são emitidas em relação a um índice específico.</span><span class="sxs-lookup"><span data-stu-id="06ca6-120">When searching data using Azure Search, the full-text search queries are issued against a particular index.</span></span>  <span data-ttu-id="06ca6-121">Para comparar esses conceitos àqueles de um banco de dados, os campos podem ser comparados a colunas em uma tabela e os documentos podem ser comparados a linhas.</span><span class="sxs-lookup"><span data-stu-id="06ca6-121">To compare these concepts to those of a database, fields can be likened to columns in a table and documents can be likened to rows.</span></span>

### <a name="scalability"></a><span data-ttu-id="06ca6-122">Escalabilidade</span><span class="sxs-lookup"><span data-stu-id="06ca6-122">Scalability</span></span>
<span data-ttu-id="06ca6-123">Qualquer serviço do Azure Search no [tipo de preço](https://azure.microsoft.com/pricing/details/search/) Standard pode ser dimensionado em duas dimensões: armazenamento e disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="06ca6-123">Any Azure Search service in the Standard [pricing tier](https://azure.microsoft.com/pricing/details/search/) can scale in two dimensions: storage and availability.</span></span>

* <span data-ttu-id="06ca6-124">*Partições* podem ser adicionadas para aumentar o armazenamento de um serviço de pesquisa.</span><span class="sxs-lookup"><span data-stu-id="06ca6-124">*Partitions* can be added to increase the storage of a search service.</span></span>
* <span data-ttu-id="06ca6-125">*Réplicas* podem ser adicionados a um serviço para aumentar a taxa de solicitações que pode lidar com um serviço de pesquisa.</span><span class="sxs-lookup"><span data-stu-id="06ca6-125">*Replicas* can be added to a service to increase the throughput of requests that a search service can handle.</span></span>

<span data-ttu-id="06ca6-126">Adicionar e remover partições e réplicas permitirá que a capacidade do serviço de pesquisa cresça de acordo com a quantidade de dados e tráfego que o aplicativo exige.</span><span class="sxs-lookup"><span data-stu-id="06ca6-126">Adding and removing partitions and replicas at will allow the capacity of the search service to grow with the amount of data and traffic the application demands.</span></span> <span data-ttu-id="06ca6-127">Para que um serviço de pesquisa obtenha um [SLA](https://azure.microsoft.com/support/legal/sla/search/v1_0/)de leitura, ele requer duas réplicas.</span><span class="sxs-lookup"><span data-stu-id="06ca6-127">In order for a search service to achieve a read [SLA](https://azure.microsoft.com/support/legal/sla/search/v1_0/), it requires two replicas.</span></span> <span data-ttu-id="06ca6-128">Para que um serviço de pesquisa obtenha um [SLA](https://azure.microsoft.com/support/legal/sla/search/v1_0/)de leitura/gravação, ele requer três réplicas.</span><span class="sxs-lookup"><span data-stu-id="06ca6-128">In order for a service to achieve a read-write [SLA](https://azure.microsoft.com/support/legal/sla/search/v1_0/), it requires three replicas.</span></span>

### <a name="service-and-index-limits-in-azure-search"></a><span data-ttu-id="06ca6-129">Limites de serviço e índice no Azure Search</span><span class="sxs-lookup"><span data-stu-id="06ca6-129">Service and index limits in Azure Search</span></span>
<span data-ttu-id="06ca6-130">Há alguns [tipos de preço](https://azure.microsoft.com/pricing/details/search/) diferentes no Azure Search, cada um dos tipos tem [limites e cotas](search-limits-quotas-capacity.md) diferentes.</span><span class="sxs-lookup"><span data-stu-id="06ca6-130">There are a few different [pricing tiers](https://azure.microsoft.com/pricing/details/search/) in Azure Search, each of the tiers has different [limits and quotas](search-limits-quotas-capacity.md).</span></span> <span data-ttu-id="06ca6-131">Alguns desses limites estão no nível de serviço, alguns estão no nível do índice e alguns estão no nível da partição.</span><span class="sxs-lookup"><span data-stu-id="06ca6-131">Some of these limits are at the service-level, some are at the index-level, and some are at the partition-level.</span></span>

|  | <span data-ttu-id="06ca6-132">Basic</span><span class="sxs-lookup"><span data-stu-id="06ca6-132">Basic</span></span> | <span data-ttu-id="06ca6-133">Standard1</span><span class="sxs-lookup"><span data-stu-id="06ca6-133">Standard1</span></span> | <span data-ttu-id="06ca6-134">Standard2</span><span class="sxs-lookup"><span data-stu-id="06ca6-134">Standard2</span></span> | <span data-ttu-id="06ca6-135">Standard3</span><span class="sxs-lookup"><span data-stu-id="06ca6-135">Standard3</span></span> | <span data-ttu-id="06ca6-136">Standard3 HD</span><span class="sxs-lookup"><span data-stu-id="06ca6-136">Standard3 HD</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="06ca6-137">Máximo de réplicas por serviço</span><span class="sxs-lookup"><span data-stu-id="06ca6-137">Maximum Replicas per Service</span></span> |<span data-ttu-id="06ca6-138">3</span><span class="sxs-lookup"><span data-stu-id="06ca6-138">3</span></span> |<span data-ttu-id="06ca6-139">12</span><span class="sxs-lookup"><span data-stu-id="06ca6-139">12</span></span> |<span data-ttu-id="06ca6-140">12</span><span class="sxs-lookup"><span data-stu-id="06ca6-140">12</span></span> |<span data-ttu-id="06ca6-141">12</span><span class="sxs-lookup"><span data-stu-id="06ca6-141">12</span></span> |<span data-ttu-id="06ca6-142">12</span><span class="sxs-lookup"><span data-stu-id="06ca6-142">12</span></span> |
| <span data-ttu-id="06ca6-143">Máximo de partições por serviço</span><span class="sxs-lookup"><span data-stu-id="06ca6-143">Maximum Partitions per Service</span></span> |<span data-ttu-id="06ca6-144">1</span><span class="sxs-lookup"><span data-stu-id="06ca6-144">1</span></span> |<span data-ttu-id="06ca6-145">12</span><span class="sxs-lookup"><span data-stu-id="06ca6-145">12</span></span> |<span data-ttu-id="06ca6-146">12</span><span class="sxs-lookup"><span data-stu-id="06ca6-146">12</span></span> |<span data-ttu-id="06ca6-147">12</span><span class="sxs-lookup"><span data-stu-id="06ca6-147">12</span></span> |<span data-ttu-id="06ca6-148">1</span><span class="sxs-lookup"><span data-stu-id="06ca6-148">1</span></span> |
| <span data-ttu-id="06ca6-149">Máximo de unidades de pesquisa (réplicas * partições) por serviço</span><span class="sxs-lookup"><span data-stu-id="06ca6-149">Maximum Search Units (Replicas*Partitions) per Service</span></span> |<span data-ttu-id="06ca6-150">3</span><span class="sxs-lookup"><span data-stu-id="06ca6-150">3</span></span> |<span data-ttu-id="06ca6-151">36</span><span class="sxs-lookup"><span data-stu-id="06ca6-151">36</span></span> |<span data-ttu-id="06ca6-152">36</span><span class="sxs-lookup"><span data-stu-id="06ca6-152">36</span></span> |<span data-ttu-id="06ca6-153">36</span><span class="sxs-lookup"><span data-stu-id="06ca6-153">36</span></span> |<span data-ttu-id="06ca6-154">36 (máx. de 3 partições)</span><span class="sxs-lookup"><span data-stu-id="06ca6-154">36 (max 3 partitions)</span></span> |
| <span data-ttu-id="06ca6-155">Máximo de documentos por serviço</span><span class="sxs-lookup"><span data-stu-id="06ca6-155">Maximum Documents per Service</span></span> |<span data-ttu-id="06ca6-156">1 milhão</span><span class="sxs-lookup"><span data-stu-id="06ca6-156">1 million</span></span> |<span data-ttu-id="06ca6-157">180 milhões</span><span class="sxs-lookup"><span data-stu-id="06ca6-157">180 million</span></span> |<span data-ttu-id="06ca6-158">720 milhões</span><span class="sxs-lookup"><span data-stu-id="06ca6-158">720 million</span></span> |<span data-ttu-id="06ca6-159">1.4 bilhão</span><span class="sxs-lookup"><span data-stu-id="06ca6-159">1.4 billion</span></span> |<span data-ttu-id="06ca6-160">600 milhões</span><span class="sxs-lookup"><span data-stu-id="06ca6-160">600 million</span></span> |
| <span data-ttu-id="06ca6-161">Armazenamento máximo por serviço</span><span class="sxs-lookup"><span data-stu-id="06ca6-161">Maximum Storage per Service</span></span> |<span data-ttu-id="06ca6-162">2 GB</span><span class="sxs-lookup"><span data-stu-id="06ca6-162">2 GB</span></span> |<span data-ttu-id="06ca6-163">300 GB</span><span class="sxs-lookup"><span data-stu-id="06ca6-163">300 GB</span></span> |<span data-ttu-id="06ca6-164">1,2 TB</span><span class="sxs-lookup"><span data-stu-id="06ca6-164">1.2 TB</span></span> |<span data-ttu-id="06ca6-165">2,4 TB</span><span class="sxs-lookup"><span data-stu-id="06ca6-165">2.4 TB</span></span> |<span data-ttu-id="06ca6-166">600 GB</span><span class="sxs-lookup"><span data-stu-id="06ca6-166">600 GB</span></span> |
| <span data-ttu-id="06ca6-167">Máximo de documentos por partição</span><span class="sxs-lookup"><span data-stu-id="06ca6-167">Maximum Documents per Partition</span></span> |<span data-ttu-id="06ca6-168">1 milhão</span><span class="sxs-lookup"><span data-stu-id="06ca6-168">1 million</span></span> |<span data-ttu-id="06ca6-169">15 milhões</span><span class="sxs-lookup"><span data-stu-id="06ca6-169">15 million</span></span> |<span data-ttu-id="06ca6-170">60 milhões</span><span class="sxs-lookup"><span data-stu-id="06ca6-170">60 million</span></span> |<span data-ttu-id="06ca6-171">120 milhões</span><span class="sxs-lookup"><span data-stu-id="06ca6-171">120 million</span></span> |<span data-ttu-id="06ca6-172">200 milhões</span><span class="sxs-lookup"><span data-stu-id="06ca6-172">200 million</span></span> |
| <span data-ttu-id="06ca6-173">Armazenamento máximo por partição</span><span class="sxs-lookup"><span data-stu-id="06ca6-173">Maximum Storage per Partition</span></span> |<span data-ttu-id="06ca6-174">2 GB</span><span class="sxs-lookup"><span data-stu-id="06ca6-174">2 GB</span></span> |<span data-ttu-id="06ca6-175">25 GB</span><span class="sxs-lookup"><span data-stu-id="06ca6-175">25 GB</span></span> |<span data-ttu-id="06ca6-176">100 GB</span><span class="sxs-lookup"><span data-stu-id="06ca6-176">100 GB</span></span> |<span data-ttu-id="06ca6-177">200 GB</span><span class="sxs-lookup"><span data-stu-id="06ca6-177">200 GB</span></span> |<span data-ttu-id="06ca6-178">200 GB</span><span class="sxs-lookup"><span data-stu-id="06ca6-178">200 GB</span></span> |
| <span data-ttu-id="06ca6-179">Índices máximos por serviço</span><span class="sxs-lookup"><span data-stu-id="06ca6-179">Maximum Indexes per Service</span></span> |<span data-ttu-id="06ca6-180">5</span><span class="sxs-lookup"><span data-stu-id="06ca6-180">5</span></span> |<span data-ttu-id="06ca6-181">50</span><span class="sxs-lookup"><span data-stu-id="06ca6-181">50</span></span> |<span data-ttu-id="06ca6-182">200</span><span class="sxs-lookup"><span data-stu-id="06ca6-182">200</span></span> |<span data-ttu-id="06ca6-183">200</span><span class="sxs-lookup"><span data-stu-id="06ca6-183">200</span></span> |<span data-ttu-id="06ca6-184">3000 (máx. de 1000 índices/partição)</span><span class="sxs-lookup"><span data-stu-id="06ca6-184">3000 (max 1000 indexes/partition)</span></span> |

#### <a name="s3-high-density"></a><span data-ttu-id="06ca6-185">Alta densidade S3</span><span class="sxs-lookup"><span data-stu-id="06ca6-185">S3 High Density'</span></span>
<span data-ttu-id="06ca6-186">No tipo de preço S3 do Azure Search, há uma opção para o modo HD (alta densidade) desenvolvido especificamente para cenários de multilocatários.</span><span class="sxs-lookup"><span data-stu-id="06ca6-186">In Azure Search’s S3 pricing tier, there is an option for the High Density (HD) mode designed specifically for multitenant scenarios.</span></span> <span data-ttu-id="06ca6-187">Em muitos casos, é necessário dar suporte a um grande número de locatários menores em um único serviço para obter os benefícios de simplicidade e redução de custos.</span><span class="sxs-lookup"><span data-stu-id="06ca6-187">In many cases, it is necessary to support a large number of smaller tenants under a single service to achieve the benefits of simplicity and cost efficiency.</span></span>

<span data-ttu-id="06ca6-188">S3 HD permite que os muitos índices pequenos sejam empacotados no gerenciamento de um único serviço de pesquisa, negociando a capacidade de escalar horizontalmente índices usando partições para a capacidade de hospedar mais índices em um único serviço.</span><span class="sxs-lookup"><span data-stu-id="06ca6-188">S3 HD allows for the many small indexes to be packed under the management of a single search service by trading the ability to scale out indexes using partitions for the ability to host more indexes in a single service.</span></span>

<span data-ttu-id="06ca6-189">Concretamente, um serviço S3 poderia ter entre 1 e 200 índices que juntos podem hospedar até 1,4 bilhão de documentos.</span><span class="sxs-lookup"><span data-stu-id="06ca6-189">Concretely, an S3 service could have between 1 and 200 indexes that together could host up to 1.4 billion documents.</span></span> <span data-ttu-id="06ca6-190">Por outro lado, um S3 HD permitiria que índices individuais tenham apenas até 1 milhão de documentos, mas pode manipular até 1000 índices por partição (até 3000 por serviço) com uma contagem total do documento de 200 milhões por partição (até 600 milhões por serviço).</span><span class="sxs-lookup"><span data-stu-id="06ca6-190">An S3 HD on the other hand would allow individual indexes to only go up to 1 million documents, but it can handle up to 1000 indexes per partition (up to 3000 per service) with a total document count of 200 million per partition (up to 600 million per service).</span></span>

## <a name="considerations-for-multitenant-applications"></a><span data-ttu-id="06ca6-191">Considerações para aplicativos multilocatários</span><span class="sxs-lookup"><span data-stu-id="06ca6-191">Considerations for multitenant applications</span></span>
<span data-ttu-id="06ca6-192">Aplicativos multilocatários devem distribuir efetivamente recursos entre locatários preservando algum nível de privacidade entre os vários locatários.</span><span class="sxs-lookup"><span data-stu-id="06ca6-192">Multitenant applications must effectively distribute resources among the tenants while preserving some level of privacy between the various tenants.</span></span> <span data-ttu-id="06ca6-193">Há algumas considerações ao criar a arquitetura para esse aplicativo:</span><span class="sxs-lookup"><span data-stu-id="06ca6-193">There are a few considerations when designing the architecture for such an application:</span></span>

* <span data-ttu-id="06ca6-194">*Isolamento de locatários:* os desenvolvedores de aplicativos precisam tomar as medidas apropriadas para garantir que nenhum locatário tenha acesso não autorizado ou indesejado aos dados de outros locatários.</span><span class="sxs-lookup"><span data-stu-id="06ca6-194">*Tenant isolation:* Application developers need to take appropriate measures to ensure that no tenants have unauthorized or unwanted access to the data of other tenants.</span></span> <span data-ttu-id="06ca6-195">Além da perspectiva de privacidade de dados, estratégias de isolamento de locatários requerem um gerenciamento eficiente de recursos compartilhados e a proteção de vizinhos com ruídos.</span><span class="sxs-lookup"><span data-stu-id="06ca6-195">Beyond the perspective of data privacy, tenant isolation strategies require effective management of shared resources and protection from noisy neighbors.</span></span>
* <span data-ttu-id="06ca6-196">*Custo de recursos de nuvem:* como com qualquer outro aplicativo, as soluções de software devem permanecer competitivas em termos de custo como um componente de um aplicativo multilocatário.</span><span class="sxs-lookup"><span data-stu-id="06ca6-196">*Cloud resource cost:* As with any other application, software solutions must remain cost competitive as a component of a multitenant application.</span></span>
* <span data-ttu-id="06ca6-197">*Facilidade de operações:* ao desenvolver uma arquitetura de multilocatários, o impacto sobre as operações e a complexidade do aplicativo é uma consideração importante.</span><span class="sxs-lookup"><span data-stu-id="06ca6-197">*Ease of Operations:* When developing a multitenant architecture, the impact on the application's operations and complexity is an important consideration.</span></span> <span data-ttu-id="06ca6-198">O Azure Search tem um [SLA de 99,9%](https://azure.microsoft.com/support/legal/sla/search/v1_0/).</span><span class="sxs-lookup"><span data-stu-id="06ca6-198">Azure Search has a [99.9% SLA](https://azure.microsoft.com/support/legal/sla/search/v1_0/).</span></span>
* <span data-ttu-id="06ca6-199">*Superfície global:* aplicativos multilocatários talvez precisem atender efetivamente locatários distribuídos em todo o mundo.</span><span class="sxs-lookup"><span data-stu-id="06ca6-199">*Global footprint:* Multitenant applications may need to effectively serve tenants which are distributed across the globe.</span></span>
* <span data-ttu-id="06ca6-200">*Escalabilidade:* os desenvolvedores de aplicativos precisam considerar como eles reconciliam entre manter um nível suficientemente baixo de complexidade do aplicativo e criar o aplicativo para dimensionar com número de locatários e o tamanho dos dados e a carga de trabalho de locatários.</span><span class="sxs-lookup"><span data-stu-id="06ca6-200">*Scalability:* Application developers need to consider how they reconcile between maintaining a sufficiently low level of application complexity and designing the application to scale with number of tenants and the size of tenants' data and workload.</span></span>

<span data-ttu-id="06ca6-201">O Azure Search oferece alguns limites que podem ser usados para isolar dados e carga de trabalho de locatários.</span><span class="sxs-lookup"><span data-stu-id="06ca6-201">Azure Search offers a few boundaries that can be used to isolate tenants’ data and workload.</span></span>

## <a name="modeling-multitenancy-with-azure-search"></a><span data-ttu-id="06ca6-202">Modelagem de multilocação com o Azure Search</span><span class="sxs-lookup"><span data-stu-id="06ca6-202">Modeling multitenancy with Azure Search</span></span>
<span data-ttu-id="06ca6-203">No caso de um cenário de multilocatário, o desenvolvedor do aplicativo consome um ou mais serviços de pesquisa e divide seus locatários entre serviços, índices ou ambos.</span><span class="sxs-lookup"><span data-stu-id="06ca6-203">In the case of a multitenant scenario, the application developer consumes one or more search services and divide their tenants among services, indexes, or both.</span></span> <span data-ttu-id="06ca6-204">O Azure Search tem alguns padrões comuns ao modelar um cenário de multilocatário:</span><span class="sxs-lookup"><span data-stu-id="06ca6-204">Azure Search has a few common patterns when modeling a multitenant scenario:</span></span>

1. <span data-ttu-id="06ca6-205">*Índice por locatário:* cada locatário tem seu próprio índice dentro de um serviço de pesquisa que é compartilhado com outros locatários.</span><span class="sxs-lookup"><span data-stu-id="06ca6-205">*Index per tenant:* Each tenant has its own index within a search service that is shared with other tenants.</span></span>
2. <span data-ttu-id="06ca6-206">*Serviço por locatário:* cada locatário tem seu próprio serviço do Azure Search dedicado, oferecendo o nível mais alto de separação de dados e a carga de trabalho.</span><span class="sxs-lookup"><span data-stu-id="06ca6-206">*Service per tenant:* Each tenant has its own dedicated Azure Search service, offering highest level of data and workload separation.</span></span>
3. <span data-ttu-id="06ca6-207">*Mistura de ambos:* locatários maiores e mais ativos são atribuídos a serviços dedicados enquanto locatários menores são atribuídos a índices individuais dentro de serviços compartilhados.</span><span class="sxs-lookup"><span data-stu-id="06ca6-207">*Mix of both:* Larger, more-active tenants are assigned dedicated services while smaller tenants are assigned individual indexes within shared services.</span></span>

## <a name="1-index-per-tenant"></a><span data-ttu-id="06ca6-208">1. Indexar por locatário</span><span class="sxs-lookup"><span data-stu-id="06ca6-208">1. Index per tenant</span></span>
![Uma descrição do modelo de índice por locatário](./media/search-modeling-multitenant-saas-applications/azure-search-index-per-tenant.png)

<span data-ttu-id="06ca6-210">Em um modelo de índice por locatário, vários locatários ocupam um único serviço do Azure Search, em que cada locatário tem seu próprio índice.</span><span class="sxs-lookup"><span data-stu-id="06ca6-210">In an index-per-tenant model, multiple tenants occupy a single Azure Search service where each tenant has their own index.</span></span>

<span data-ttu-id="06ca6-211">Locatários atingem o isolamento de dados porque todas as solicitações de pesquisa e operações de documento são emitidas em um nível de índice no Azure Search.</span><span class="sxs-lookup"><span data-stu-id="06ca6-211">Tenants achieve data isolation because all search requests and document operations are issued at an index level in Azure Search.</span></span> <span data-ttu-id="06ca6-212">Na camada de aplicativo, há o reconhecimento da necessidade de direcionar o tráfego de vários locatários para os índices certos enquanto gerencia recursos no nível de serviço em todos os locatários.</span><span class="sxs-lookup"><span data-stu-id="06ca6-212">In the application layer, there is the need awareness to direct the various tenants’ traffic to the proper indexes while also managing resources at the service level across all tenants.</span></span>

<span data-ttu-id="06ca6-213">Um atributo de chave do modelo de índice por locatário é a capacidade do desenvolvedor do aplicativo de subscrever a capacidade de um serviço de pesquisa entre locatários do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="06ca6-213">A key attribute of the index-per-tenant model is the ability for the application developer to oversubscribe the capacity of a search service among the application’s tenants.</span></span> <span data-ttu-id="06ca6-214">Se os locatários têm uma distribuição desigual de carga de trabalho, a combinação ideal de locatários pode ser distribuída em índices de um serviço de pesquisa para acomodar inúmeros locatários altamente ativos e com uso intensivo de recursos, ao mesmo tempo em que atende uma cauda longa de locatários menos ativos.</span><span class="sxs-lookup"><span data-stu-id="06ca6-214">If the tenants have an uneven distribution of workload, the optimal combination of tenants can be distributed across a search service’s indexes to accommodate a number of highly active, resource-intensive tenants while simultaneously serving a long tail of less active tenants.</span></span> <span data-ttu-id="06ca6-215">A desvantagem é a incapacidade do modelo de lidar com situações em que cada locatário é altamente ativo simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="06ca6-215">The trade-off is the inability of the model to handle situations where each tenant is concurrently highly active.</span></span>

<span data-ttu-id="06ca6-216">O modelo de índice por locatário fornece a base para um modelo de custo variável, em que um serviço inteiro do Azure Search é comprado antecipado e, em seguida, preenchido com locatários.</span><span class="sxs-lookup"><span data-stu-id="06ca6-216">The index-per-tenant model provides the basis for a variable cost model, where an entire Azure Search service is bought up-front and then subsequently filled with tenants.</span></span> <span data-ttu-id="06ca6-217">Isso permite que a capacidade não utilizada seja designada para contas gratuitas e de avaliação.</span><span class="sxs-lookup"><span data-stu-id="06ca6-217">This allows for unused capacity to be designated for trials and free accounts.</span></span>

<span data-ttu-id="06ca6-218">Para aplicativos com uma superfície global, o modelo de índice por locatário pode não ser o mais eficiente.</span><span class="sxs-lookup"><span data-stu-id="06ca6-218">For applications with a global footprint, the index-per-tenant model may not be the most efficient.</span></span> <span data-ttu-id="06ca6-219">Se locatários do aplicativo são distribuídos em todo o mundo, um serviço separado pode ser necessário para cada região que pode duplicar os custos em cada um deles.</span><span class="sxs-lookup"><span data-stu-id="06ca6-219">If an application's tenants are distributed across the globe, a separate service may be necessary for each region which may duplicate costs across each of them.</span></span>

<span data-ttu-id="06ca6-220">O Azure Search permite a escala de índices individuais e do número total de índices para crescer.</span><span class="sxs-lookup"><span data-stu-id="06ca6-220">Azure Search allows for the scale of both the individual indexes and the total number of indexes to grow.</span></span> <span data-ttu-id="06ca6-221">Se um tipo de preço apropriado for escolhido, partições e réplicas poderão ser adicionadas ao serviço de pesquisa inteiro quando um índice individual dentro do serviço se tornar muito extenso em termos de armazenamento ou tráfego.</span><span class="sxs-lookup"><span data-stu-id="06ca6-221">If an appropriate pricing tier is chosen, partitions and replicas can be added to the entire search service when an individual index within the service grows too large in terms of storage or traffic.</span></span>

<span data-ttu-id="06ca6-222">Se o número total de índices aumenta muito para um único serviço, outro serviço deve ser configurado para acomodar novos locatários.</span><span class="sxs-lookup"><span data-stu-id="06ca6-222">If the total number of indexes grows too large for a single service, another service has to be provisioned to accommodate the new tenants.</span></span> <span data-ttu-id="06ca6-223">Se os índices precisam ser movidos entre os serviços de pesquisa à medida que novos serviços são adicionados, os dados do índice devem ser copiados manualmente de um índice para o outro, já que o Azure Search não permite que um índice seja movido.</span><span class="sxs-lookup"><span data-stu-id="06ca6-223">If indexes have to be moved between search services as new services are added, the data from the index has to be manually copied from one index to the other as Azure Search does not allow for an index to be moved.</span></span>

## <a name="2-service-per-tenant"></a><span data-ttu-id="06ca6-224">2. Serviço por locatário</span><span class="sxs-lookup"><span data-stu-id="06ca6-224">2. Service per tenant</span></span>
![Uma descrição do modelo de serviço por locatário](./media/search-modeling-multitenant-saas-applications/azure-search-service-per-tenant.png)

<span data-ttu-id="06ca6-226">Em uma arquitetura de serviço por locatário, cada locatário tem seu próprio serviço de pesquisa.</span><span class="sxs-lookup"><span data-stu-id="06ca6-226">In a service-per-tenant architecture, each tenant has its own search service.</span></span>

<span data-ttu-id="06ca6-227">Nesse modelo, o aplicativo atinge o nível máximo de isolamento para seus locatários.</span><span class="sxs-lookup"><span data-stu-id="06ca6-227">In this model, the application achieves the maximum level of isolation for its tenants.</span></span> <span data-ttu-id="06ca6-228">Cada serviço tem armazenamento dedicado e taxa de transferência para lidar com solicitação de pesquisa, bem como chaves de API separadas.</span><span class="sxs-lookup"><span data-stu-id="06ca6-228">Each service has dedicated storage and throughput for handling search request as well as separate API keys.</span></span>

<span data-ttu-id="06ca6-229">Para aplicativos em que cada locatário tem uma grande superfície ou a carga de trabalho tem menos variabilidade de locatário para locatário, o modelo de serviço por locatário é uma opção adequada, já que recursos não são compartilhados entre cargas de trabalho de vários locatários.</span><span class="sxs-lookup"><span data-stu-id="06ca6-229">For applications where each tenant has a large footprint or the workload has little variability from tenant to tenant, the service-per-tenant model is an effective choice as resources are not shared across various tenants’ workloads.</span></span>

<span data-ttu-id="06ca6-230">Um modelo de serviço por locatário também oferece o benefício de um modelo de custo fixo e previsível.</span><span class="sxs-lookup"><span data-stu-id="06ca6-230">A service per tenant model also offers the benefit of a predictable, fixed cost model.</span></span> <span data-ttu-id="06ca6-231">Não há nenhum investimento antecipado em um serviço de pesquisa inteiro até que haja um locatário para preenchê-lo. No entanto, o custo por locatário é maior do que um modelo de índice por locatário.</span><span class="sxs-lookup"><span data-stu-id="06ca6-231">There is no up-front investment in an entire search service until there is a tenant to fill it, however the cost-per-tenant is higher than an index-per-tenant model.</span></span>

<span data-ttu-id="06ca6-232">O modelo de serviço por locatário é uma opção eficiente para aplicativos com uma superfície global.</span><span class="sxs-lookup"><span data-stu-id="06ca6-232">The service-per-tenant model is an efficient choice for applications with a global footprint.</span></span> <span data-ttu-id="06ca6-233">Com locatários distribuídos geograficamente, é fácil ter cada serviço do locatário na região apropriada.</span><span class="sxs-lookup"><span data-stu-id="06ca6-233">With geographically-distributed tenants, it is easy to have each tenant's service in the appropriate region.</span></span>

<span data-ttu-id="06ca6-234">Os desafios de dimensionamento desse padrão surgem quando locatários individuais excedem o serviço.</span><span class="sxs-lookup"><span data-stu-id="06ca6-234">The challenges in scaling this pattern arise when individual tenants outgrow their service.</span></span> <span data-ttu-id="06ca6-235">O Azure Search atualmente não dá suporte à atualização do tipo de preço de um serviço de pesquisa, por isso todos os dados precisam ser copiados manualmente para um novo serviço.</span><span class="sxs-lookup"><span data-stu-id="06ca6-235">Azure Search does not currently support upgrading the pricing tier of a search service, so all data would have to be manually copied to a new service.</span></span>

## <a name="3-mixing-both-models"></a><span data-ttu-id="06ca6-236">3. Combinação dos dois modelos</span><span class="sxs-lookup"><span data-stu-id="06ca6-236">3. Mixing both models</span></span>
<span data-ttu-id="06ca6-237">Outro padrão para modelar a multilocação é misturar estratégias de índice por locatário e de serviço por locatário.</span><span class="sxs-lookup"><span data-stu-id="06ca6-237">Another pattern for modeling multitenancy is mixing both index-per-tenant and service-per-tenant strategies.</span></span>

<span data-ttu-id="06ca6-238">Combinando os dois padrões, locatários maiores do aplicativo podem ocupar serviços dedicados, enquanto a cauda longa de locatários menores, menos ativos pode ocupar índices em um serviço compartilhado.</span><span class="sxs-lookup"><span data-stu-id="06ca6-238">By mixing the two patterns, an application's largest tenants can occupy dedicated services while the long tail of less active, smaller tenants can occupy indexes in a shared service.</span></span> <span data-ttu-id="06ca6-239">Esse modelo garante que os locatários maiores tenham consistentemente alto desempenho do serviço, ajudando a proteger os locatários menores de vizinhos com ruídos.</span><span class="sxs-lookup"><span data-stu-id="06ca6-239">This model ensures that the largest tenants have consistently high performance from the service while helping to protect the smaller tenants from any noisy neighbors.</span></span>

<span data-ttu-id="06ca6-240">No entanto, implementar essa estratégia depende da antecipação para prever quais locatários exigirão um serviço dedicado em vez de um índice em um serviço compartilhado.</span><span class="sxs-lookup"><span data-stu-id="06ca6-240">However, implementing this strategy relies foresight in predicting which tenants will require a dedicated service versus an index in a shared service.</span></span> <span data-ttu-id="06ca6-241">A complexidade do aplicativo aumenta com a necessidade de gerenciar esses dois modelos multilocação.</span><span class="sxs-lookup"><span data-stu-id="06ca6-241">Application complexity increases with the need to manage both of these multitenancy models.</span></span>

## <a name="achieving-even-finer-granularity"></a><span data-ttu-id="06ca6-242">Como obter granularidade ainda maior</span><span class="sxs-lookup"><span data-stu-id="06ca6-242">Achieving even finer granularity</span></span>
<span data-ttu-id="06ca6-243">Os padrões de design acima para modelar cenários de multilocatários no Azure Search presumem um escopo uniforme, no qual cada locatário é uma instância inteira de um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="06ca6-243">The above design patterns to model multitenant scenarios in Azure Search assume a uniform scope where each tenant is a whole instance of an application.</span></span> <span data-ttu-id="06ca6-244">No entanto, às vezes, os aplicativos podem manipular vários escopos menores.</span><span class="sxs-lookup"><span data-stu-id="06ca6-244">However, applications can sometimes handle many smaller scopes.</span></span>

<span data-ttu-id="06ca6-245">Se os modelos de serviço por locatário e de índice por locatário não são escopos suficientemente pequenos, é possível modelar um índice para atingir um nível ainda maior de granularidade.</span><span class="sxs-lookup"><span data-stu-id="06ca6-245">If service-per-tenant and index-per-tenant models are not sufficiently small scopes, it is possible to model an index to achieve an even finer degree of granularity.</span></span>

<span data-ttu-id="06ca6-246">Para que um único índice se comporte de modo diferente para pontos de extremidade de cliente diferentes, é possível adicionar um campo a um índice que designa um valor determinado para cada cliente possível.</span><span class="sxs-lookup"><span data-stu-id="06ca6-246">To have a single index behave differently for different client endpoints, a field can be added to an index which designates a certain value for each possible client.</span></span> <span data-ttu-id="06ca6-247">Cada vez que um cliente chama o Azure Search para consultar ou modificar um índice, o código do aplicativo cliente especifica o valor apropriado para o campo usando a funcionalidade de [filtro](https://msdn.microsoft.com/library/azure/dn798921.aspx) do Azure Search no momento da consulta.</span><span class="sxs-lookup"><span data-stu-id="06ca6-247">Each time a client calls Azure Search to query or modify an index, the code from the client application specifies the appropriate value for that field using Azure Search's [filter](https://msdn.microsoft.com/library/azure/dn798921.aspx) capability at query time.</span></span>

<span data-ttu-id="06ca6-248">Esse método pode ser usado para obter uma funcionalidade de contas de usuário separadas, níveis de permissão separados e até mesmo aplicativos completamente separados.</span><span class="sxs-lookup"><span data-stu-id="06ca6-248">This method can be used to achieve functionality of separate user accounts, separate permission levels, and even completely separate applications.</span></span>

> [!NOTE]
> <span data-ttu-id="06ca6-249">Usar a abordagem descrita acima para configurar um único índice para atender a vários locatários afeta a relevância dos resultados da pesquisa.</span><span class="sxs-lookup"><span data-stu-id="06ca6-249">Using the approach described above to configure a single index to serve multiple tenants affects the relevance of search results.</span></span> <span data-ttu-id="06ca6-250">Pontuações de relevância de pesquisa são calculadas em um escopo no nível do índice, não no nível do locatário, para que dados de todos os locatários sejam incorporados às estatísticas subjacentes das pontuações de relevância, tal como frequência de termo.</span><span class="sxs-lookup"><span data-stu-id="06ca6-250">Search relevance scores are computed at an index-level scope, not a tenant-level scope, so all tenants' data is incorporated in the relevance scores' underlying statistics such as term frequency.</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="06ca6-251">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="06ca6-251">Next steps</span></span>
<span data-ttu-id="06ca6-252">O Azure Search é uma opção atraente para muitos aplicativos. [Leia mais sobre os recursos avançados do serviço](http://aka.ms/whatisazsearch).</span><span class="sxs-lookup"><span data-stu-id="06ca6-252">Azure Search is a compelling choice for many applications, [read more about the service's robust capabilities](http://aka.ms/whatisazsearch).</span></span> <span data-ttu-id="06ca6-253">Ao avaliar os vários padrões de design para aplicativos multilocatários, considere os [vários tipos de preços](https://azure.microsoft.com/pricing/details/search/) e os respectivos [limites de serviço](search-limits-quotas-capacity.md) para melhor personalizar o Azure Search para ajustar cargas de trabalho do aplicativo e arquiteturas de todos os tamanhos.</span><span class="sxs-lookup"><span data-stu-id="06ca6-253">When evaluating the various design patterns for multitenant applications, consider the [various pricing tiers](https://azure.microsoft.com/pricing/details/search/) and the respective [service limits](search-limits-quotas-capacity.md) to best tailor Azure Search to fit application workloads and architectures of all sizes.</span></span>

<span data-ttu-id="06ca6-254">Perguntas sobre o Azure Search e cenários de multilocatários podem ser direcionadas para azuresearch_contact@microsoft.com.</span><span class="sxs-lookup"><span data-stu-id="06ca6-254">Any questions about Azure Search and multitenant scenarios can be directed to azuresearch_contact@microsoft.com.</span></span>

