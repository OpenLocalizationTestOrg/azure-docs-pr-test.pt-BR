---
title: "Práticas recomendadas de segurança de rede do Azure | Microsoft Docs"
description: "Conheça alguns dos principais recursos disponíveis no Azure para ajudar a criar ambientes de rede segura"
services: virtual-network
documentationcenter: na
author: tracsman
manager: rossort
editor: 
ms.assetid: d169387a-1243-4867-a602-01d6f2d8a2a1
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 01/03/2017
ms.author: jonor
ms.openlocfilehash: fb5e399d4ab02a7f2805cc280b213bf5b44f6993
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="microsoft-cloud-services-and-network-security"></a><span data-ttu-id="2ed3b-103">Segurança de rede e serviços em nuvem da Microsoft</span><span class="sxs-lookup"><span data-stu-id="2ed3b-103">Microsoft cloud services and network security</span></span>
<span data-ttu-id="2ed3b-104">Os serviços em nuvem da Microsoft entregam serviços e estrutura em larga escala, recursos de nível empresarial e várias opções de conectividade híbrida.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-104">Microsoft cloud services deliver hyper-scale services and infrastructure, enterprise-grade capabilities, and many choices for hybrid connectivity.</span></span> <span data-ttu-id="2ed3b-105">Os clientes podem optar por acessar esses serviços através da Internet ou com a Azure ExpressRoute, que fornece conectividade de rede privada.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-105">Customers can choose to access these services either via the Internet or with Azure ExpressRoute, which provides private network connectivity.</span></span> <span data-ttu-id="2ed3b-106">A plataforma Microsoft Azure permite que os clientes estendam facilmente sua infra-estrutura para a nuvem e criem arquiteturas com várias camadas.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-106">The Microsoft Azure platform allows customers to seamlessly extend their infrastructure into the cloud and build multi-tier architectures.</span></span> <span data-ttu-id="2ed3b-107">Além disso, terceiros podem habilitar recursos avançados oferecendo serviços de segurança e soluções de virtualização.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-107">Additionally, third parties can enable enhanced capabilities by offering security services and virtual appliances.</span></span> <span data-ttu-id="2ed3b-108">Este white paper fornece uma visão geral sobre segurança e problemas de arquitetura que os clientes devem considerar ao usar os serviços em nuvem da Microsoft acessados através do ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-108">This white paper provides an overview of security and architectural issues that customers should consider when using Microsoft cloud services accessed via ExpressRoute.</span></span> <span data-ttu-id="2ed3b-109">Ele também aborda a criação de serviços mais seguros em redes virtuais do Azure.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-109">It also covers creating more secure services in Azure virtual networks.</span></span>

## <a name="fast-start"></a><span data-ttu-id="2ed3b-110">Início rápido</span><span class="sxs-lookup"><span data-stu-id="2ed3b-110">Fast start</span></span>
<span data-ttu-id="2ed3b-111">O gráfico lógico a seguir pode direcioná-lo a um exemplo específico das várias técnicas de segurança disponíveis na plataforma Azure.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-111">The following logic chart can direct you to a specific example of the many security techniques available with the Azure platform.</span></span> <span data-ttu-id="2ed3b-112">Para referência rápida, encontre o exemplo que melhor se ajusta a seu caso.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-112">For quick reference, find the example that best fits your case.</span></span> <span data-ttu-id="2ed3b-113">Para obter explicações mais completas, continue lendo o artigo.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-113">For expanded explanations, continue reading through the paper.</span></span>
<span data-ttu-id="2ed3b-114">[![0]][0]</span><span class="sxs-lookup"><span data-stu-id="2ed3b-114">[![0]][0]</span></span>

[<span data-ttu-id="2ed3b-115">Exemplo 1: crie uma rede de perímetro (também conhecida como DMZ, zona desmilitarizada ou sub-rede filtrada) para ajudar a proteger aplicativos com NSGs (grupos de segurança de rede).</span><span class="sxs-lookup"><span data-stu-id="2ed3b-115">Example 1: Build a perimeter network (also known as DMZ, demilitarized zone, or screened subnet) to help protect applications with network security groups (NSGs).</span></span>](#example-1-build-a-perimeter-network-to-help-protect-applications-with-nsgs)</br><span data-ttu-id="2ed3b-116">
[Exemplo 2: crie uma rede de perímetro para ajudar a proteger aplicativos com um firewall e NSGs.](#example-2-build-a-perimeter-network-to-help-protect-applications-with-a-firewall-and-nsgs)</span><span class="sxs-lookup"><span data-stu-id="2ed3b-116">
[Example 2: Build a perimeter network to help protect applications with a firewall and NSGs.](#example-2-build-a-perimeter-network-to-help-protect-applications-with-a-firewall-and-nsgs)</span></span></br><span data-ttu-id="2ed3b-117">
[Exemplo 3: crie uma rede de perímetro para ajudar a proteger as redes com um firewall, UDR (rota definida pelo usuário) e NSG.](#example-3-build-a-perimeter-network-to-help-protect-networks-with-a-firewall-and-udr-and-nsg)</span><span class="sxs-lookup"><span data-stu-id="2ed3b-117">
[Example 3: Build a perimeter network to help protect networks with a firewall, user-defined route (UDR), and NSG.](#example-3-build-a-perimeter-network-to-help-protect-networks-with-a-firewall-and-udr-and-nsg)</span></span></br><span data-ttu-id="2ed3b-118">
[Exemplo 4: adicione uma conexão híbrida com uma VPN (rede privada virtual) site a site de solução de virtualização.](#example-4-add-a-hybrid-connection-with-a-site-to-site-virtual-appliance-vpn)</span><span class="sxs-lookup"><span data-stu-id="2ed3b-118">
[Example 4: Add a hybrid connection with a site-to-site, virtual appliance virtual private network (VPN).](#example-4-add-a-hybrid-connection-with-a-site-to-site-virtual-appliance-vpn)</span></span></br><span data-ttu-id="2ed3b-119">
[Exemplo 5: adicione uma conexão híbrida com um gateway de VPN site a site do Azure.](#example-5-add-a-hybrid-connection-with-a-site-to-site-azure-vpn-gateway)</span><span class="sxs-lookup"><span data-stu-id="2ed3b-119">
[Example 5: Add a hybrid connection with a site-to-site, Azure VPN gateway.](#example-5-add-a-hybrid-connection-with-a-site-to-site-azure-vpn-gateway)</span></span></br><span data-ttu-id="2ed3b-120">
[Exemplo 6: adicione uma conexão híbrida com o ExpressRoute.](#example-6-add-a-hybrid-connection-with-expressroute)</span><span class="sxs-lookup"><span data-stu-id="2ed3b-120">
[Example 6: Add a hybrid connection with ExpressRoute.](#example-6-add-a-hybrid-connection-with-expressroute)</span></span></br>
<span data-ttu-id="2ed3b-121">Exemplos para adicionar conexões entre redes virtuais, alta disponibilidade e encadeamento de serviços serão adicionados a esse documento durante os próximos meses.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-121">Examples for adding connections between virtual networks, high availability, and service chaining will be added to this document over the next few months.</span></span>

## <a name="microsoft-compliance-and-infrastructure-protection"></a><span data-ttu-id="2ed3b-122">Proteção de infraestrutura e conformidade da Microsoft</span><span class="sxs-lookup"><span data-stu-id="2ed3b-122">Microsoft compliance and infrastructure protection</span></span>
<span data-ttu-id="2ed3b-123">Para ajudar as organizações a atender os requisitos regionais, nacionais e específicos do setor que controlam a coleta e o uso de dados de indivíduos, a Microsoft oferece mais de 40 certificações e atestados.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-123">To help organizations comply with national, regional, and industry-specific requirements governing the collection and use of individuals’ data, Microsoft offers over 40 certifications and attestations.</span></span> <span data-ttu-id="2ed3b-124">O conjunto mais abrangente de qualquer provedor de serviços de nuvem.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-124">The most comprehensive set of any cloud service provider.</span></span>

<span data-ttu-id="2ed3b-125">Para obter mais informações, consulte as informações de conformidade no [Microsoft Trust Center][TrustCenter].</span><span class="sxs-lookup"><span data-stu-id="2ed3b-125">For more information, see the compliance information on the [Microsoft Trust Center][TrustCenter].</span></span>

<span data-ttu-id="2ed3b-126">A Microsoft tem uma abordagem abrangente para proteger a infraestrutura de nuvem necessária para executar os serviços globais em larga escala.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-126">Microsoft has a comprehensive approach to protect cloud infrastructure needed to run hyper-scale global services.</span></span> <span data-ttu-id="2ed3b-127">Além dos datacenters físicos, a infraestrutura de nuvem da Microsoft também inclui hardware, software, redes, administrativas e equipe de operações.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-127">Microsoft cloud infrastructure includes hardware, software, networks, and administrative and operations staff, in addition to the physical data centers.</span></span>

<span data-ttu-id="2ed3b-128">![2]</span><span class="sxs-lookup"><span data-stu-id="2ed3b-128">![2]</span></span>

<span data-ttu-id="2ed3b-129">A abordagem acima fornece uma base segura para os clientes implantarem seus serviços na Microsoft Cloud.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-129">This approach provides a more secure foundation for customers to deploy their services in the Microsoft cloud.</span></span> <span data-ttu-id="2ed3b-130">A próxima etapa é o design e a criação de uma arquitetura de segurança pelos clientes para proteger esses serviços.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-130">The next step is for customers to design and create a security architecture to protect these services.</span></span>

## <a name="traditional-security-architectures-and-perimeter-networks"></a><span data-ttu-id="2ed3b-131">Arquiteturas de segurança tradicionais e redes de perímetro</span><span class="sxs-lookup"><span data-stu-id="2ed3b-131">Traditional security architectures and perimeter networks</span></span>
<span data-ttu-id="2ed3b-132">Embora a Microsoft faça investimentos consideráveis para proteger a infraestrutura de nuvem, os clientes também devem proteger os serviços de nuvem e os grupos de recursos.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-132">Although Microsoft invests heavily in protecting the cloud infrastructure, customers must also protect their cloud services and resource groups.</span></span> <span data-ttu-id="2ed3b-133">Uma abordagem multicamada para a segurança oferece a melhor defesa.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-133">A multilayered approach to security provides the best defense.</span></span> <span data-ttu-id="2ed3b-134">Uma zona de segurança de rede de perímetro protege recursos da rede interna de uma rede não confiável.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-134">A perimeter network security zone protects internal network resources from an untrusted network.</span></span> <span data-ttu-id="2ed3b-135">Uma rede de perímetro refere-se às bordas ou partes da rede que ficam entre a Internet e a infraestrutura de TI da empresa protegida.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-135">A perimeter network refers to the edges or parts of the network that sit between the Internet and the protected enterprise IT infrastructure.</span></span>

<span data-ttu-id="2ed3b-136">Em redes empresariais típicas, a infraestrutura básica é reforçada intensamente no perímetro, com várias camadas de dispositivos de segurança.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-136">In typical enterprise networks, the core infrastructure is heavily fortified at the perimeters, with multiple layers of security devices.</span></span> <span data-ttu-id="2ed3b-137">O limite de cada camada consiste em dispositivos e pontos de imposição de políticas.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-137">The boundary of each layer consists of devices and policy enforcement points.</span></span> <span data-ttu-id="2ed3b-138">Cada camada pode incluir uma combinação dos seguintes dispositivos de segurança de rede: firewalls, prevenção de DoS (ataque de negação de serviço), IDS/IPS (sistemas de detecção de intrusão ou sistemas de proteção) e dispositivos VPN.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-138">Each layer can include a combination of the following network security devices: firewalls, Denial of Service (DoS) prevention, Intrusion Detection or Protection Systems (IDS/IPS), and VPN devices.</span></span> <span data-ttu-id="2ed3b-139">A imposição de políticas pode assumir a forma de políticas de firewall, ACLs (listas de controle de acesso) ou roteamento específico.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-139">Policy enforcement can take the form of firewall policies, access control lists (ACLs), or specific routing.</span></span> <span data-ttu-id="2ed3b-140">A primeira linha de defesa da rede, que aceita diretamente o tráfego de entrada da Internet, é uma combinação desses mecanismos para bloquear ataques e tráfego perigoso, permitindo que solicitações legítimas adentrem a rede.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-140">The first line of defense in the network, directly accepting incoming traffic from the Internet, is a combination of these mechanisms to block attacks and harmful traffic while allowing legitimate requests further into the network.</span></span> <span data-ttu-id="2ed3b-141">Esse tráfego é roteado diretamente aos recursos na rede de perímetro.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-141">This traffic routes directly to resources in the perimeter network.</span></span> <span data-ttu-id="2ed3b-142">Esse recurso pode "falar" com recursos mais dentro da rede, passando primeiro pelo próximo limite de validação.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-142">That resource may then “talk” to resources deeper in the network, transiting the next boundary for validation first.</span></span> <span data-ttu-id="2ed3b-143">A camada mais externa é chamada de a rede de perímetro, porque essa parte da rede está exposta à Internet, geralmente com alguma forma de proteção em ambos os lados.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-143">The outermost layer is called the perimeter network because this part of the network is exposed to the Internet, usually with some form of protection on both sides.</span></span> <span data-ttu-id="2ed3b-144">A figura a seguir mostra um exemplo de uma rede de perímetro de sub-rede individual em uma rede corporativa, com dois limites de segurança.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-144">The following figure shows an example of a single subnet perimeter network in a corporate network, with two security boundaries.</span></span>

<span data-ttu-id="2ed3b-145">![3]</span><span class="sxs-lookup"><span data-stu-id="2ed3b-145">![3]</span></span>

<span data-ttu-id="2ed3b-146">Há muitas arquiteturas usadas para implementar uma rede de perímetro.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-146">There are many architectures used to implement a perimeter network.</span></span> <span data-ttu-id="2ed3b-147">Essas arquiteturas podem variar de um simples do balanceador de carga até uma rede de perímetro com várias sub-redes e diferentes mecanismos em cada limite para bloquear o tráfego e proteger as camadas mais profundas da rede corporativa.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-147">These architectures can range from a simple load balancer to a multiple-subnet perimeter network with varied mechanisms at each boundary to block traffic and protect the deeper layers of the corporate network.</span></span> <span data-ttu-id="2ed3b-148">Como a rede de perímetro é criada depende das necessidades específicas da organização e da tolerância a riscos geral.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-148">How the perimeter network is built depends on the specific needs of the organization and its overall risk tolerance.</span></span>

<span data-ttu-id="2ed3b-149">Conforme os clientes vão movendo suas cargas de trabalho para nuvens públicas, é essencial dar suporte a recursos semelhantes de arquitetura de rede de perímetro no Azure para atender aos requisitos de conformidade e de segurança.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-149">As customers move their workloads to public clouds, it is critical to support similar capabilities for perimeter network architecture in Azure to meet compliance and security requirements.</span></span> <span data-ttu-id="2ed3b-150">Este documento fornece diretrizes sobre como os clientes podem criar um ambiente de rede segura no Azure.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-150">This document provides guidelines on how customers can build a secure network environment in Azure.</span></span> <span data-ttu-id="2ed3b-151">Ele se concentra na rede de perímetro, mas também inclui uma discussão abrangente sobre muitos aspectos de segurança de rede.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-151">It focuses on the perimeter network, but also includes a comprehensive discussion of many aspects of network security.</span></span> <span data-ttu-id="2ed3b-152">As perguntas a seguir informam essa discussão:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-152">The following questions inform this discussion:</span></span>

* <span data-ttu-id="2ed3b-153">Como é possível criar uma rede de perímetro no Azure?</span><span class="sxs-lookup"><span data-stu-id="2ed3b-153">How can a perimeter network in Azure be built?</span></span>
* <span data-ttu-id="2ed3b-154">Quais são alguns dos recursos do Azure disponíveis para criar a rede de perímetro?</span><span class="sxs-lookup"><span data-stu-id="2ed3b-154">What are some of the Azure features available to build the perimeter network?</span></span>
* <span data-ttu-id="2ed3b-155">Como cargas de trabalho de back-end podem ser protegidas?</span><span class="sxs-lookup"><span data-stu-id="2ed3b-155">How can back-end workloads be protected?</span></span>
* <span data-ttu-id="2ed3b-156">Como a comunicação com a Internet é controlada para as cargas de trabalho no Azure?</span><span class="sxs-lookup"><span data-stu-id="2ed3b-156">How are Internet communications controlled to the workloads in Azure?</span></span>
* <span data-ttu-id="2ed3b-157">Como as redes locais podem ser protegidas contra implantações no Azure?</span><span class="sxs-lookup"><span data-stu-id="2ed3b-157">How can the on-premises networks be protected from deployments in Azure?</span></span>
* <span data-ttu-id="2ed3b-158">Quando recursos de segurança nativos do Azure devem ser usados em vez de dispositivos ou serviços de terceiros?</span><span class="sxs-lookup"><span data-stu-id="2ed3b-158">When should native Azure security features be used versus third-party appliances or services?</span></span>

<span data-ttu-id="2ed3b-159">O diagrama a seguir mostra várias camadas de segurança que Azure fornece aos clientes.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-159">The following diagram shows various layers of security Azure provides to customers.</span></span> <span data-ttu-id="2ed3b-160">Essas camadas são tanto nativas na plataforma Azure em si quanto recursos definidos pelo cliente:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-160">These layers are both native in the Azure platform itself and customer-defined features:</span></span>

<span data-ttu-id="2ed3b-161">![4]</span><span class="sxs-lookup"><span data-stu-id="2ed3b-161">![4]</span></span>

<span data-ttu-id="2ed3b-162">Vinda da Internet a proteção DDoS do Azure ajuda a proteger contra ataques em grande escala contra o Azure.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-162">Inbound from the Internet, Azure DDoS helps protect against large-scale attacks against Azure.</span></span> <span data-ttu-id="2ed3b-163">A próxima camada é de endereços IP públicos definidos pelo cliente (pontos de extremidade), que são usados para determinar qual tráfego pode passar pelo serviço de nuvem para a rede virtual.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-163">The next layer is customer-defined public IP addresses (endpoints), which are used to determine which traffic can pass through the cloud service to the virtual network.</span></span> <span data-ttu-id="2ed3b-164">O isolamento de rede virtual nativa do Azure garante o isolamento completo de todas as outras redes e garante que o tráfego flua somente através de métodos e caminhos configurados pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-164">Native Azure virtual network isolation ensures complete isolation from all other networks and that traffic only flows through user configured paths and methods.</span></span> <span data-ttu-id="2ed3b-165">Esses caminhos e métodos são a próxima camada em que NSGs, UDR e soluções de virtualização de rede podem ser usados para criar limites de segurança para proteger as implantações de aplicativo na rede protegida.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-165">These paths and methods are the next layer, where NSGs, UDR, and network virtual appliances can be used to create security boundaries to protect the application deployments in the protected network.</span></span>

<span data-ttu-id="2ed3b-166">A próxima seção fornece uma visão geral das redes virtuais do Azure.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-166">The next section provides an overview of Azure virtual networks.</span></span> <span data-ttu-id="2ed3b-167">As redes virtuais do Azure são criadas por clientes e tratam-se daquilo a que as cargas de trabalho implantadas por esses clientes estão conectadas.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-167">These virtual networks are created by customers, and are what their deployed workloads are connected to.</span></span> <span data-ttu-id="2ed3b-168">Redes virtuais são a base de todos os recursos de segurança de rede necessários para estabelecer uma rede de perímetro e proteger as implantações dos clientes no Azure.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-168">Virtual networks are the basis of all the network security features required to establish a perimeter network to protect customer deployments in Azure.</span></span>

## <a name="overview-of-azure-virtual-networks"></a><span data-ttu-id="2ed3b-169">Visão geral das redes virtuais do Azure</span><span class="sxs-lookup"><span data-stu-id="2ed3b-169">Overview of Azure virtual networks</span></span>
<span data-ttu-id="2ed3b-170">Antes que o tráfego da Internet possa acessar as redes virtuais do Azure, há duas camadas de segurança inerentes à plataforma Azure:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-170">Before Internet traffic can get to the Azure virtual networks, there are two layers of security inherent to the Azure platform:</span></span>

1.    <span data-ttu-id="2ed3b-171">**Proteção DDoS**: a proteção DDoS é uma camada de rede física do Azure que protege a plataforma do Azure em si contra ataques em larga escala baseados na Internet.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-171">**DDoS protection**: DDoS protection is a layer of the Azure physical network that protects the Azure platform itself from large-scale Internet-based attacks.</span></span> <span data-ttu-id="2ed3b-172">Esses ataques usam vários nós de "bot" em uma tentativa de sobrecarregar um serviço de Internet.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-172">These attacks use multiple “bot” nodes in an attempt to overwhelm an Internet service.</span></span> <span data-ttu-id="2ed3b-173">O Azure tem uma malha de proteção sólida contra DDoS em todas as conexões de entrada, saída e entre regiões do Azure.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-173">Azure has a robust DDoS protection mesh on all inbound, outbound, and cross-Azure region connectivity.</span></span> <span data-ttu-id="2ed3b-174">Essa camada de proteção contra DDoS não tem atributos configuráveis pelo usuário e não é acessível ao cliente.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-174">This DDoS protection layer has no user configurable attributes and is not accessible to the customer.</span></span> <span data-ttu-id="2ed3b-175">A camada de proteção contra DDoS protege o Azure como uma plataforma de ataques em grande escala, além de monitorar o tráfego de saída e o tráfego entre regiões do Azure.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-175">The DDoS protection layer protects Azure as a platform from large-scale attacks, it also monitors out-bound traffic and cross-Azure region traffic.</span></span> <span data-ttu-id="2ed3b-176">Usando soluções de virtualização de rede na VNet, camadas adicionais de resiliência podem ser configuradas pelo cliente contra um ataque de menor escala que não ative a proteção no nível de plataforma.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-176">Using network virtual appliances on the VNet, additional layers of resilience can be configured by the customer against a smaller scale attack that doesn't trip the platform level protection.</span></span> <span data-ttu-id="2ed3b-177">Um exemplo de DDoS em ação: se um endereço IP voltado para a Internet fosse atacado por um ataque de DDoS em larga escala, o Azure detectaria as origens dos ataques e eliminaria o tráfego ofensivo antes que este atingisse seu destino pretendido.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-177">An example of DDoS in action; if an internet facing IP address was attacked by a large-scale DDoS attack, Azure would detect the sources of the attacks and scrub the offending traffic before it reached its intended destination.</span></span> <span data-ttu-id="2ed3b-178">Em quase todos os casos, o ponto de extremidade atacado não é afetado pelo ataque.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-178">In almost all cases, the attacked endpoint isn't affected by the attack.</span></span> <span data-ttu-id="2ed3b-179">Nos raros casos em que um ponto de extremidade é afetado, nenhum tráfego é afetado para outros pontos de extremidade, apenas para o ponto de extremidade atacado.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-179">In the rare cases that an endpoint is affected, no traffic is affected to other endpoints, only the attacked endpoint.</span></span> <span data-ttu-id="2ed3b-180">Assim, outros clientes e serviços não veem nenhum impacto vindo desse ataque.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-180">Thus other customers and services would see no impact from that attack.</span></span> <span data-ttu-id="2ed3b-181">É fundamental observar que o Azure DDoS está procurando apenas por ataques em grande escala.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-181">It's critical to note that Azure DDoS is only looking for large-scale attacks.</span></span> <span data-ttu-id="2ed3b-182">É possível que seu serviço específico seja sobrecarregado antes que os limites de proteção no nível de plataforma sejam excedidos.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-182">It is possible that your specific service could be overwhelmed before the platform level protection thresholds are exceeded.</span></span> <span data-ttu-id="2ed3b-183">Por exemplo, um site da Web em um único servidor IIS A0 poderia ficar offline devido a um ataque de DDoS antes que a proteção contra DDoS no nível de plataforma do Azure registrasse uma ameaça.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-183">For example, a web site on a single A0 IIS server, could be taken offline by a DDoS attack before Azure platform level DDoS protection registered a threat.</span></span>

2.  <span data-ttu-id="2ed3b-184">**Endereços IP públicos**: endereços IP públicos (habilitados por meio de pontos de extremidade de serviço, endereços IP públicos, Gateway de Aplicativo e outros recursos do Azure que apresentam um endereço IP público para a Internet roteado para o seu recurso) permitem que serviços de nuvem ou grupos de recursos tenham portas e endereços IP públicos de Internet expostos.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-184">**Public IP Addresses**: Public IP addresses (enabled via service endpoints, Public IP addresses, Application Gateway, and other Azure features that present a public IP address to the internet routed to your resource) allow cloud services or resource groups to have public Internet IP addresses and ports exposed.</span></span> <span data-ttu-id="2ed3b-185">O ponto de extremidade usa NAT (Conversão de Endereços de Rede) para rotear o tráfego para a porta e endereço internos na rede virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-185">The endpoint uses Network Address Translation (NAT) to route traffic to the internal address and port on the Azure virtual network.</span></span> <span data-ttu-id="2ed3b-186">Esse caminho é a principal rota para que o tráfego externo passe para dentro da rede virtual.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-186">This path is the primary way for external traffic to pass into the virtual network.</span></span> <span data-ttu-id="2ed3b-187">Os endereços IP públicos são configuráveis pelo usuário para determinar tanto qual tráfego pode passar quanto como e para onde esse tráfego deve ser convertido na rede virtual.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-187">The Public IP addresses are configurable to determine which traffic is passed in, and how and where it's translated on to the virtual network.</span></span>

<span data-ttu-id="2ed3b-188">Depois que o tráfego alcança a rede virtual, há muitos recursos que entram em cena.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-188">Once traffic reaches the virtual network, there are many features that come into play.</span></span> <span data-ttu-id="2ed3b-189">Redes virtuais do Azure são a base para que clientes possam anexar suas cargas de trabalho e o local em que a segurança no nível da rede básica se aplica.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-189">Azure virtual networks are the foundation for customers to attach their workloads and where basic network-level security applies.</span></span> <span data-ttu-id="2ed3b-190">É uma rede privada (uma sobreposição de rede virtual) no Azure para clientes com os seguintes recursos e características:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-190">It is a private network (a virtual network overlay) in Azure for customers with the following features and characteristics:</span></span>

* <span data-ttu-id="2ed3b-191">**Isolamento de tráfego**: uma rede virtual é o limite de isolamento de tráfego na plataforma Azure.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-191">**Traffic isolation**: A virtual network is the traffic isolation boundary on the Azure platform.</span></span> <span data-ttu-id="2ed3b-192">As VMs (máquinas virtuais) em uma rede virtual não podem comunicar-se diretamente com VMs em uma rede virtual diferente, mesmo que ambas as redes virtuais sejam criadas pelo mesmo cliente.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-192">Virtual machines (VMs) in one virtual network cannot communicate directly to VMs in a different virtual network, even if both virtual networks are created by the same customer.</span></span> <span data-ttu-id="2ed3b-193">Isolamento é uma propriedade vital que garante que as VMs e as comunicações do cliente permaneçam privadas em uma rede virtual.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-193">Isolation is a critical property that ensures customer VMs and communication remains private within a virtual network.</span></span>

>[!NOTE]
><span data-ttu-id="2ed3b-194">O isolamento de tráfego refere-se apenas ao tráfego *de entrada* para a rede virtual.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-194">Traffic isolation refers only to traffic *inbound* to the virtual network.</span></span> <span data-ttu-id="2ed3b-195">Por padrão, o tráfego de saída da VNet para Internet é permitido, mas pode ser evitado se desejado por NSGs.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-195">By default outbound traffic from the VNet to the internet is allowed, but can be prevented if desired by NSGs.</span></span>
>
>

* <span data-ttu-id="2ed3b-196">**Topologia multicamada**: as redes virtuais permitem que os clientes definam a topologia multicamada alocando sub-redes e designando os espaços de endereço separados para elementos ou "camadas" diferentes de suas cargas de trabalho.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-196">**Multi-tier topology**: Virtual networks allow customers to define multi-tier topology by allocating subnets and designating separate address spaces for different elements or “tiers” of their workloads.</span></span> <span data-ttu-id="2ed3b-197">Esses agrupamentos e topologias lógicos permitem que os clientes definam políticas de acesso diferentes baseadas nos tipos de carga de trabalho e também controlam fluxos de tráfego entre as camadas.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-197">These logical groupings and topologies enable customers to define different access policy based on the workload types, and also control traffic flows between the tiers.</span></span>
* <span data-ttu-id="2ed3b-198">**Conectividade entre locais**: os clientes podem estabelecer a conectividade entre locais entre uma rede virtual e vários sites locais ou outras redes virtuais no Azure.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-198">**Cross-premises connectivity**: Customers can establish cross-premises connectivity between a virtual network and multiple on-premises sites or other virtual networks in Azure.</span></span> <span data-ttu-id="2ed3b-199">Para criar uma conexão, os clientes podem usar o emparelhamento de VNet, Gateways de VPN do Azure, soluções de virtualização de rede de terceiros ou ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-199">To construct a connection, customers can use VNet Peering, Azure VPN Gateways, third-party network virtual appliances, or ExpressRoute.</span></span> <span data-ttu-id="2ed3b-200">O Azure dá suporte a VPNs site a site (S2S) usando protocolos padrão de IPsec/IKE e conectividade privada de ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-200">Azure supports site-to-site (S2S) VPNs using standard IPsec/IKE protocols and ExpressRoute private connectivity.</span></span>
* <span data-ttu-id="2ed3b-201">**NSG** permite que os clientes criem regras (ACLs) no nível desejado de granularidade: sub-redes virtuais, VMs individuais ou interfaces de rede.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-201">**NSG** allows customers to create rules (ACLs) at the desired level of granularity: network interfaces, individual VMs, or virtual subnets.</span></span> <span data-ttu-id="2ed3b-202">Os clientes podem controlar o acesso permitindo ou negando a comunicação entre as cargas de trabalho em uma rede virtual, de sistemas nas redes do cliente por meio de conectividade entre locais ou comunicação direta via Internet.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-202">Customers can control access by permitting or denying communication between the workloads within a virtual network, from systems on customer’s networks via cross-premises connectivity, or direct Internet communication.</span></span>
* <span data-ttu-id="2ed3b-203">**UDR** e **Encaminhamento IP** permitem que os clientes definam os caminhos de comunicação entre camadas diferentes em uma rede virtual.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-203">**UDR** and **IP Forwarding** allow customers to define the communication paths between different tiers within a virtual network.</span></span> <span data-ttu-id="2ed3b-204">Os clientes podem implantar firewall, IDS/IPS e outras soluções de virtualização, além de rotear o tráfego de rede por meio dessas soluções de segurança para a aplicação, auditoria e inspeção das políticas de limites de segurança.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-204">Customers can deploy a firewall, IDS/IPS, and other virtual appliances, and route network traffic through these security appliances for security boundary policy enforcement, auditing, and inspection.</span></span>
* <span data-ttu-id="2ed3b-205">**Soluções de virtualização de rede** no Azure Marketplace: dispositivos de segurança, como firewalls, balanceadores de carga e IDS/IPS estão disponíveis no Azure Marketplace e na Galeria de Imagens de VM.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-205">**Network virtual appliances** in the Azure Marketplace: Security appliances such as firewalls, load balancers, and IDS/IPS are available in the Azure Marketplace and the VM Image Gallery.</span></span> <span data-ttu-id="2ed3b-206">Os clientes podem implantar essas soluções em suas redes virtuais e, especificamente, em seus limites de segurança (incluindo as sub-redes da rede de perímetro) para completar um ambiente de rede segura com várias camadas.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-206">Customers can deploy these appliances into their virtual networks, and specifically, at their security boundaries (including the perimeter network subnets) to complete a multi-tiered secure network environment.</span></span>

<span data-ttu-id="2ed3b-207">Com esses recursos e funções, um exemplo de como uma arquitetura de rede de perímetro poderia ser criada no Azure é a mostrada no seguinte diagrama:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-207">With these features and capabilities, one example of how a perimeter network architecture could be constructed in Azure is the following diagram:</span></span>

<span data-ttu-id="2ed3b-208">![5]</span><span class="sxs-lookup"><span data-stu-id="2ed3b-208">![5]</span></span>

## <a name="perimeter-network-characteristics-and-requirements"></a><span data-ttu-id="2ed3b-209">Requisitos e características da rede de perímetro</span><span class="sxs-lookup"><span data-stu-id="2ed3b-209">Perimeter network characteristics and requirements</span></span>
<span data-ttu-id="2ed3b-210">A rede de perímetro é o front-end da rede, fazendo a interface de comunicação diretamente da Internet.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-210">The perimeter network is the front end of the network, directly interfacing communication from the Internet.</span></span> <span data-ttu-id="2ed3b-211">Os pacotes de entrada devem fluir por dispositivos de segurança, como firewall, IDS, IPS e afins, antes de alcançar os servidores back-end.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-211">The incoming packets should flow through the security appliances, such as the firewall, IDS, and IPS, before reaching the back-end servers.</span></span> <span data-ttu-id="2ed3b-212">Pacotes das cargas de trabalho associados à Internet também podem fluir pelos dispositivos de segurança na rede de perímetro para fins de auditoria, inspeção e imposição da política antes de sair da rede.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-212">Internet-bound packets from the workloads can also flow through the security appliances in the perimeter network for policy enforcement, inspection, and auditing purposes, before leaving the network.</span></span> <span data-ttu-id="2ed3b-213">Além disso, a rede de perímetro pode hospedar os gateways de VPN entre locais entre redes virtuais de cliente e redes locais.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-213">Additionally, the perimeter network can host cross-premises VPN gateways between customer virtual networks and on-premises networks.</span></span>

### <a name="perimeter-network-characteristics"></a><span data-ttu-id="2ed3b-214">Características da rede de perímetro</span><span class="sxs-lookup"><span data-stu-id="2ed3b-214">Perimeter network characteristics</span></span>
<span data-ttu-id="2ed3b-215">Algumas das características de uma boa rede de perímetro, referenciando a figura anterior, são as seguintes:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-215">Referencing the previous figure, some of the characteristics of a good perimeter network are as follows:</span></span>

* <span data-ttu-id="2ed3b-216">Voltada para a Internet:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-216">Internet-facing:</span></span>
  * <span data-ttu-id="2ed3b-217">A sub-rede da rede de perímetro em si é voltada para a Internet, comunicando-se diretamente com ela.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-217">The perimeter network subnet itself is Internet-facing, directly communicating with the Internet.</span></span>
  * <span data-ttu-id="2ed3b-218">Endereços IP públicos, VIPs e/ou pontos de extremidade de serviço passam tráfego da Internet para a rede e dispositivos de front-end.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-218">Public IP addresses, VIPs, and/or service endpoints pass Internet traffic to the front-end network and devices.</span></span>
  * <span data-ttu-id="2ed3b-219">O tráfego de entrada da Internet passa por dispositivos de segurança antes de outros recursos na rede de front-end.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-219">Inbound traffic from the Internet passes through security devices before other resources on the front-end network.</span></span>
  * <span data-ttu-id="2ed3b-220">Se segurança de saída estiver habilitada, o tráfego passará por dispositivos de segurança, como a etapa final, antes de passar para a Internet.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-220">If outbound security is enabled, traffic passes through security devices, as the final step, before passing to the Internet.</span></span>
* <span data-ttu-id="2ed3b-221">Rede protegida:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-221">Protected network:</span></span>
  * <span data-ttu-id="2ed3b-222">Não há caminho direto da Internet para a infraestrutura básica.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-222">There is no direct path from the Internet to the core infrastructure.</span></span>
  * <span data-ttu-id="2ed3b-223">Os canais para a infraestrutura básica devem percorrer dispositivos de segurança, como NSGs, firewalls ou dispositivos VPN.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-223">Channels to the core infrastructure must traverse through security devices such as NSGs, firewalls, or VPN devices.</span></span>
  * <span data-ttu-id="2ed3b-224">Outros dispositivos não devem ligar a Internet à infraestrutura básica.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-224">Other devices must not bridge Internet and the core infrastructure.</span></span>
  * <span data-ttu-id="2ed3b-225">Dispositivos de segurança tanto no limite para a Internet quanto nos limites voltados à rede protegida da rede de perímetro (por exemplo, os dois ícones de firewall mostrados na figura anterior) podem, na verdade, ser uma única solução de virtualização com regras ou interfaces diferenciadas para cada limite.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-225">Security devices on both the Internet-facing and the protected network facing boundaries of the perimeter network (for example, the two firewall icons shown in the previous figure) may actually be a single virtual appliance with differentiated rules or interfaces for each boundary.</span></span> <span data-ttu-id="2ed3b-226">Por exemplo, um dispositivo físico, logicamente separado, lidando com a carga para ambos os limites da rede de perímetro.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-226">For example, one physical device, logically separated, handling the load for both boundaries of the perimeter network.</span></span>
* <span data-ttu-id="2ed3b-227">Outras práticas e restrições comuns:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-227">Other common practices and constraints:</span></span>
  * <span data-ttu-id="2ed3b-228">As cargas de trabalho não devem armazenar informações essenciais aos negócios.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-228">Workloads must not store business critical information.</span></span>
  * <span data-ttu-id="2ed3b-229">O acesso e as atualizações para configurações e implantações da rede de perímetro são limitados somente aos administradores autorizados.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-229">Access and updates to perimeter network configurations and deployments are limited to only authorized administrators.</span></span>

### <a name="perimeter-network-requirements"></a><span data-ttu-id="2ed3b-230">Requisitos de rede de perímetro</span><span class="sxs-lookup"><span data-stu-id="2ed3b-230">Perimeter network requirements</span></span>
<span data-ttu-id="2ed3b-231">Para habilitar essas características, siga essas diretrizes sobre requisitos de rede virtual para implementar uma rede de perímetro com êxito:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-231">To enable these characteristics, follow these guidelines on virtual network requirements to implement a successful perimeter network:</span></span>

* <span data-ttu-id="2ed3b-232">**Arquitetura de sub-rede:** especifique a rede virtual de modo que uma sub-rede inteira seja dedicada como a rede de perímetro, separada de outras sub-redes na mesma rede virtual.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-232">**Subnet architecture:** Specify the virtual network such that an entire subnet is dedicated as the perimeter network, separated from other subnets in the same virtual network.</span></span> <span data-ttu-id="2ed3b-233">Essa separação garante o tráfego entre a rede de perímetro e outras camadas de sub-rede internas ou privadas flua por meio de um firewall ou solução de virtualização IDS/IPS.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-233">This separation ensures the traffic between the perimeter network and other internal or private subnet tiers flows through a firewall or IDS/IPS virtual appliance.</span></span>  <span data-ttu-id="2ed3b-234">Rotas definidas pelo usuário nas sub-redes de limite são necessárias para encaminhar esse tráfego para a solução de virtualização.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-234">User-defined routes on the boundary subnets are required to forward this traffic to the virtual appliance.</span></span>
* <span data-ttu-id="2ed3b-235">**NSG:** a sub-rede da rede de perímetro em si deve estar aberta para permitir a comunicação com a Internet, mas isso não significa que os clientes devem ignorar os NSGs.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-235">**NSG:** The perimeter network subnet itself should be open to allow communication with the Internet, but that does not mean customers should be bypassing NSGs.</span></span> <span data-ttu-id="2ed3b-236">Siga as práticas de segurança comuns para minimizar as superfícies de rede expostas à Internet.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-236">Follow common security practices to minimize the network surfaces exposed to the Internet.</span></span> <span data-ttu-id="2ed3b-237">Bloqueie os intervalos de endereços remotos com permissão para acessar as implantações ou os protocolos de aplicativo específicos e as portas que estão abertas.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-237">Lock down the remote address ranges allowed to access the deployments or the specific application protocols and ports that are open.</span></span> <span data-ttu-id="2ed3b-238">Pode haver circunstâncias, porém, em que um bloqueio total não é possível.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-238">There may be circumstances, however, in which a complete lock-down is not possible.</span></span> <span data-ttu-id="2ed3b-239">Por exemplo, se os clientes têm um site externo no Azure, a rede de perímetro deve permitir solicitações de entrada da Web de endereços IP públicos, mas só deve abrir as portas do aplicativo Web: TCP na porta 80 e/ou TCP na porta 443.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-239">For example, if customers have an external website in Azure, the perimeter network should allow the incoming web requests from any public IP addresses, but should only open the web application ports: TCP on port 80 and/or TCP on port 443.</span></span>
* <span data-ttu-id="2ed3b-240">**Tabela de roteamento:** a sub-rede da rede de perímetro em si deve ser capaz de se comunicar diretamente com a Internet, mas não deve permitir a comunicação direta de e para o back-end ou em redes locais sem passar por um dispositivo de firewall ou de segurança.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-240">**Routing table:** The perimeter network subnet itself should be able to communicate to the Internet directly, but should not allow direct communication to and from the back end or on-premises networks without going through a firewall or security appliance.</span></span>
* <span data-ttu-id="2ed3b-241">**Configuração de dispositivo de segurança:** para rotear e inspecionar os pacotes entre a rede de perímetro e o restante das redes protegidas, os dispositivos de segurança como dispositivos IPS, IDS e firewall podem ter vários locais de origem.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-241">**Security appliance configuration:** To route and inspect packets between the perimeter network and the rest of the protected networks, the security appliances such as firewall, IDS, and IPS devices may be multi-homed.</span></span> <span data-ttu-id="2ed3b-242">Eles podem ter NICs separadas para a rede de perímetro e as sub-redes de back-end.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-242">They may have separate NICs for the perimeter network and the back-end subnets.</span></span> <span data-ttu-id="2ed3b-243">As NICs na rede de perímetro se comunicarão diretamente de e para a Internet, com os NSGs correspondentes e a tabela de roteamento da rede de perímetro.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-243">The NICs in the perimeter network communicate directly to and from the Internet, with the corresponding NSGs and the perimeter network routing table.</span></span> <span data-ttu-id="2ed3b-244">As NICs conectadas às sub-redes de back-end têm NSGs e tabelas de roteamento mais restritos das sub-redes correspondentes do back-end.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-244">The NICs connecting to the back-end subnets have more restricted NSGs and routing tables of the corresponding back-end subnets.</span></span>
* <span data-ttu-id="2ed3b-245">**Funcionalidade de dispositivo de segurança:** os dispositivos de segurança implantados na rede de perímetro normalmente executam a seguinte funcionalidade:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-245">**Security appliance functionality:** The security appliances deployed in the perimeter network typically perform the following functionality:</span></span>
  * <span data-ttu-id="2ed3b-246">Firewall: imposição de regras de firewall ou políticas de controle de acesso para solicitações de entrada.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-246">Firewall: Enforcing firewall rules or access control policies for the incoming requests.</span></span>
  * <span data-ttu-id="2ed3b-247">Detecção e prevenção de ameaças: detecta ameaças e atenua ataques da Internet.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-247">Threat detection and prevention: Detecting and mitigating malicious attacks from the Internet.</span></span>
  * <span data-ttu-id="2ed3b-248">Auditoria e registro em log: mantém logs detalhados de auditoria e análise.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-248">Auditing and logging: Maintaining detailed logs for auditing and analysis.</span></span>
  * <span data-ttu-id="2ed3b-249">Proxy reverso: redireciona as solicitações de entrada para os servidores back-end correspondentes.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-249">Reverse proxy: Redirecting the incoming requests to the corresponding back-end servers.</span></span> <span data-ttu-id="2ed3b-250">Esse redirecionamento envolve o mapeamento e conversão de endereços de destino nos dispositivos de front-end, normalmente firewalls, para os endereços de servidores back-end.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-250">This redirection involves mapping and translating the destination addresses on the front-end devices, typically firewalls, to the back-end server addresses.</span></span>
  * <span data-ttu-id="2ed3b-251">Proxy de encaminhamento: fornece NAT e também realiza auditoria para a comunicação iniciada de dentro da rede virtual para a Internet.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-251">Forward proxy: Providing NAT and performing auditing for communication initiated from within the virtual network to the Internet.</span></span>
  * <span data-ttu-id="2ed3b-252">Roteador: encaminha tráfego de entrada de sub-rede e entre sub-redes dentro da rede virtual.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-252">Router: Forwarding incoming and cross-subnet traffic inside the virtual network.</span></span>
  * <span data-ttu-id="2ed3b-253">Dispositivo VPN: atua como os gateways de VPN entre instalações para conectividade VPN entre instalações entre redes locais do cliente e redes virtuais do Azure.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-253">VPN device: Acting as the cross-premises VPN gateways for cross-premises VPN connectivity between customer on-premises networks and Azure virtual networks.</span></span>
  * <span data-ttu-id="2ed3b-254">Servidor VPN: aceita clientes VPN que se conectam a redes virtuais do Azure.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-254">VPN server: Accepting VPN clients connecting to Azure virtual networks.</span></span>

> [!TIP]
> <span data-ttu-id="2ed3b-255">Mantenha os dois grupos a seguir separados: as pessoas autorizadas a acessar o mecanismo de segurança da rede de perímetro e as pessoas autorizadas como administradores de operações, implantação ou desenvolvimento de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-255">Keep the following two groups separate: the individuals authorized to access the perimeter network security gear and the individuals authorized as application development, deployment, or operations administrators.</span></span> <span data-ttu-id="2ed3b-256">Manter esses grupos separados permite uma diferenciação de deveres e impede que uma única pessoa ignore controles de segurança de aplicativos e de rede.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-256">Keeping these groups separate allows for a segregation of duties and prevents a single person from bypassing both applications security and network security controls.</span></span>
>
>

### <a name="questions-to-be-asked-when-building-network-boundaries"></a><span data-ttu-id="2ed3b-257">Perguntas a serem feitas durante a criação de limites de rede</span><span class="sxs-lookup"><span data-stu-id="2ed3b-257">Questions to be asked when building network boundaries</span></span>
<span data-ttu-id="2ed3b-258">Nesta seção, a menos que especificamente mencionadas, o termo "redes" refere-se a redes virtuais privadas do Azure criadas por um administrador de assinatura.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-258">In this section, unless specifically mentioned, the term "networks" refers to private Azure virtual networks created by a subscription administrator.</span></span> <span data-ttu-id="2ed3b-259">O termo não se refere às redes físicas subjacentes no Azure.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-259">The term doesn't refer to the underlying physical networks within Azure.</span></span>

<span data-ttu-id="2ed3b-260">Além disso, as redes virtuais do Azure geralmente são usadas para estender redes locais tradicionais.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-260">Also, Azure virtual networks are often used to extend traditional on-premises networks.</span></span> <span data-ttu-id="2ed3b-261">É possível incorporar soluções de rede híbridas site a site ou de ExpressRoute com arquiteturas de rede de perímetro.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-261">It is possible to incorporate either site-to-site or ExpressRoute hybrid networking solutions with perimeter network architectures.</span></span> <span data-ttu-id="2ed3b-262">Esse link híbrido é uma consideração importante na criação de limites de segurança de rede.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-262">This hybrid link is an important consideration in building network security boundaries.</span></span>

<span data-ttu-id="2ed3b-263">É essencial responder as três perguntas a seguir quando você está criando uma rede com uma rede de perímetro e vários limites de segurança.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-263">The following three questions are critical to answer when you're building a network with a perimeter network and multiple security boundaries.</span></span>

#### <a name="1-how-many-boundaries-are-needed"></a><span data-ttu-id="2ed3b-264">1) Quantos limites são necessários?</span><span class="sxs-lookup"><span data-stu-id="2ed3b-264">1) How many boundaries are needed?</span></span>
<span data-ttu-id="2ed3b-265">O primeiro ponto de decisão é decidir quantos limites de segurança são necessários em um determinado cenário:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-265">The first decision point is to decide how many security boundaries are needed in a given scenario:</span></span>

* <span data-ttu-id="2ed3b-266">Um único limite: um na rede de perímetro de front-end, entre a rede virtual e a Internet.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-266">A single boundary: One on the front-end perimeter network, between the virtual network and the Internet.</span></span>
* <span data-ttu-id="2ed3b-267">Dois limites: um do lado da Internet da rede de perímetro, outro entre a sub-rede da rede de perímetro e as sub-redes de back-end nas redes virtuais do Azure.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-267">Two boundaries: One on the Internet side of the perimeter network, and another between the perimeter network subnet and the back-end subnets in the Azure virtual networks.</span></span>
* <span data-ttu-id="2ed3b-268">Três limites: o primeiro do lado da Internet da rede de perímetro, o segundo entre a sub-rede da rede de perímetro e as sub-redes de back-end e o terceiro entre as sub-redes de back-end e a rede local.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-268">Three boundaries: One on the Internet side of the perimeter network, one between the perimeter network and back-end subnets, and one between the back-end subnets and the on-premises network.</span></span>
* <span data-ttu-id="2ed3b-269">Limites de N: um número variável.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-269">N boundaries: A variable number.</span></span> <span data-ttu-id="2ed3b-270">Dependendo dos requisitos de segurança, pode-se aplicar qualquer número de limites de segurança a uma determinada rede.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-270">Depending on security requirements, there is no limit to the number of security boundaries that can be applied in a given network.</span></span>

<span data-ttu-id="2ed3b-271">O número e tipo dos limites necessários variam dependendo da tolerância a riscos da empresa e do cenário específico que está sendo implementado.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-271">The number and type of boundaries needed vary based on a company’s risk tolerance and the specific scenario being implemented.</span></span> <span data-ttu-id="2ed3b-272">Geralmente essa é uma decisão conjunta tomada por vários grupos dentro de uma organização, muitas vezes incluindo uma equipe de risco e conformidade, uma equipe de rede e plataforma e uma equipe de desenvolvimento de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-272">This decision is often made together with multiple groups within an organization, often including a risk and compliance team, a network and platform team, and an application development team.</span></span> <span data-ttu-id="2ed3b-273">As pessoas com conhecimento de segurança, os dados envolvidos e as tecnologias usadas devem pesar na decisão para garantir a postura de segurança apropriada em cada implementação.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-273">People with knowledge of security, the data involved, and the technologies being used should have a say in this decision to ensure the appropriate security stance for each implementation.</span></span>

> [!TIP]
> <span data-ttu-id="2ed3b-274">Use a menor quantidade de limites que satisfaçam os requisitos de segurança em uma determinada situação.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-274">Use the smallest number of boundaries that satisfy the security requirements for a given situation.</span></span> <span data-ttu-id="2ed3b-275">Com mais limites, as operações e a solução de problemas podem tornar-se mais difíceis, bem como a sobrecarga do gerenciamento envolvido com a gestão de várias políticas de limites ao longo do tempo.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-275">With more boundaries, operations and troubleshooting can be more difficult, as well as the management overhead involved with managing the multiple boundary policies over time.</span></span> <span data-ttu-id="2ed3b-276">No entanto, os limites insuficientes aumentam o risco.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-276">However, insufficient boundaries increase risk.</span></span> <span data-ttu-id="2ed3b-277">Encontrar o equilíbrio é fundamental.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-277">Finding the balance is critical.</span></span>
>
>

<span data-ttu-id="2ed3b-278">![6]</span><span class="sxs-lookup"><span data-stu-id="2ed3b-278">![6]</span></span>

<span data-ttu-id="2ed3b-279">A figura anterior mostra uma visão geral de uma rede de limite com três limites de segurança.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-279">The preceding figure shows a high-level view of a three security boundary network.</span></span> <span data-ttu-id="2ed3b-280">Os limites estão entre a rede de perímetro e a Internet, entre as sub-redes privadas de front-end e back-end do Azure e entre a sub-rede de back-end do Azure e rede corporativa local.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-280">The boundaries are between the perimeter network and the Internet, the Azure front-end and back-end private subnets, and the Azure back-end subnet and the on-premises corporate network.</span></span>

#### <a name="2-where-are-the-boundaries-located"></a><span data-ttu-id="2ed3b-281">2) Onde estão localizados os limites?</span><span class="sxs-lookup"><span data-stu-id="2ed3b-281">2) Where are the boundaries located?</span></span>
<span data-ttu-id="2ed3b-282">Depois que o número de limites é decidido, onde implementá-los é o próximo ponto a se decidir.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-282">Once the number of boundaries are decided, where to implement them is the next decision point.</span></span> <span data-ttu-id="2ed3b-283">Geralmente, há três opções:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-283">There are generally three choices:</span></span>

* <span data-ttu-id="2ed3b-284">Usar um serviço intermediário baseado na Internet (por exemplo, um firewall do aplicativo Web baseado em nuvem, que não é discutido neste documento)</span><span class="sxs-lookup"><span data-stu-id="2ed3b-284">Using an Internet-based intermediary service (for example, a cloud-based Web application firewall, which is not discussed in this document)</span></span>
* <span data-ttu-id="2ed3b-285">Usar recursos nativos e/ou soluções de virtualização de rede no Azure</span><span class="sxs-lookup"><span data-stu-id="2ed3b-285">Using native features and/or network virtual appliances in Azure</span></span>
* <span data-ttu-id="2ed3b-286">Usar dispositivos físicos na rede local</span><span class="sxs-lookup"><span data-stu-id="2ed3b-286">Using physical devices on the on-premises network</span></span>

<span data-ttu-id="2ed3b-287">Em redes puramente do Azure, as opções são recursos nativos do Azure (por exemplo, Balanceadores de Carga do Azure) ou soluções de virtualização de rede do ecossistema variado de parceiros do Azure (por exemplo, firewalls de Ponto de Verificação).</span><span class="sxs-lookup"><span data-stu-id="2ed3b-287">On purely Azure networks, the options are native Azure features (for example, Azure Load Balancers) or network virtual appliances from the rich partner ecosystem of Azure (for example, Check Point firewalls).</span></span>

<span data-ttu-id="2ed3b-288">Se for necessário um limite entre o Azure e uma rede local, os dispositivos de segurança poderão residir em qualquer um dos lados da conexão (ou em ambos).</span><span class="sxs-lookup"><span data-stu-id="2ed3b-288">If a boundary is needed between Azure and an on-premises network, the security devices can reside on either side of the connection (or both sides).</span></span> <span data-ttu-id="2ed3b-289">Assim, uma decisão deve ser tomada sobre o local para colocar o mecanismo de segurança.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-289">Thus a decision must be made on the location to place security gear.</span></span>

<span data-ttu-id="2ed3b-290">Na figura anterior, os limites Internet para rede de perímetro e front-end para back-end estão totalmente contidos no Azure e devem ser recursos nativos do Azure ou soluções de virtualização de rede.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-290">In the previous figure, the Internet-to-perimeter network and the front-to-back-end boundaries are entirely contained within Azure, and must be either native Azure features or network virtual appliances.</span></span> <span data-ttu-id="2ed3b-291">Os dispositivos de segurança no limite entre o Azure (sub-rede de back-end) e a rede corporativa podem estar no lado do Azure ou no lado local, ou até como uma combinação de dispositivos em ambos os lados.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-291">Security devices on the boundary between Azure (back-end subnet) and the corporate network could be either on the Azure side or the on-premises side, or even a combination of devices on both sides.</span></span> <span data-ttu-id="2ed3b-292">Pode haver vantagens e desvantagens relevantes em ambas as opções; portanto, elas devem ser levadas em consideração.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-292">There can be significant advantages and disadvantages to either option that must be seriously considered.</span></span>

<span data-ttu-id="2ed3b-293">Por exemplo, usar o mecanismo de segurança físico existente no lado da rede local tem a vantagem de não haver necessidade de nenhuma nova engrenagem.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-293">For example, using existing physical security gear on the on-premises network side has the advantage that no new gear is needed.</span></span> <span data-ttu-id="2ed3b-294">Ele precisa apenas de reconfiguração.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-294">It just needs reconfiguration.</span></span> <span data-ttu-id="2ed3b-295">A desvantagem, no entanto, é que todo o tráfego deve voltar do Azure para a rede local para ser visto pelo mecanismo de segurança.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-295">The disadvantage, however, is that all traffic must come back from Azure to the on-premises network to be seen by the security gear.</span></span> <span data-ttu-id="2ed3b-296">Assim, o tráfego do Azure para o Azure poderia incorrer em latência significativa e afetar a experiência do usuário e o desempenho do aplicativo se ele fosse forçado novamente à rede local para a imposição de política de segurança.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-296">Thus Azure-to-Azure traffic could incur significant latency, and affect application performance and user experience, if it was forced back to the on-premises network for security policy enforcement.</span></span>

#### <a name="3-how-are-the-boundaries-implemented"></a><span data-ttu-id="2ed3b-297">3) Como os limites são implementados?</span><span class="sxs-lookup"><span data-stu-id="2ed3b-297">3) How are the boundaries implemented?</span></span>
<span data-ttu-id="2ed3b-298">Cada limite de segurança provavelmente terá requisitos de capacidade diferentes (por exemplo, IDS e regras de firewall no lado da Internet da rede de perímetro, mas somente ACLs entre a rede de perímetro e a sub-rede de back-end).</span><span class="sxs-lookup"><span data-stu-id="2ed3b-298">Each security boundary will likely have different capability requirements (for example, IDS and firewall rules on the Internet side of the perimeter network, but only ACLs between the perimeter network and back-end subnet).</span></span> <span data-ttu-id="2ed3b-299">A decisão de quais (ou quantos) dispositivos usar depende dos requisitos de cenário e de segurança.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-299">Deciding on which device (or how many devices) to use depends on the scenario and security requirements.</span></span> <span data-ttu-id="2ed3b-300">Na seção a seguir, os exemplos 1, 2 e 3 discutem algumas opções que podem ser usadas.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-300">In the following section, examples 1, 2, and 3 discuss some options that could be used.</span></span> <span data-ttu-id="2ed3b-301">A análise dos recursos de rede nativos do Azure e dos dispositivos disponíveis no Azure do ecossistema de parceiros mostra as inúmeras opções disponíveis para resolver praticamente qualquer cenário.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-301">Reviewing the Azure native network features and the devices available in Azure from the partner ecosystem shows the myriad options available to solve virtually any scenario.</span></span>

<span data-ttu-id="2ed3b-302">Outro ponto-chave de decisão de implementação é como se conectar à rede local com o Azure.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-302">Another key implementation decision point is how to connect the on-premises network with Azure.</span></span> <span data-ttu-id="2ed3b-303">Você deveria usar o gateway virtual do Azure ou uma solução de virtualização de rede?</span><span class="sxs-lookup"><span data-stu-id="2ed3b-303">Should you use the Azure virtual gateway or a network virtual appliance?</span></span> <span data-ttu-id="2ed3b-304">Essas opções são discutidas mais detalhadamente na seção a seguir (exemplos 4, 5 e 6).</span><span class="sxs-lookup"><span data-stu-id="2ed3b-304">These options are discussed in greater detail in the following section (examples 4, 5, and 6).</span></span>

<span data-ttu-id="2ed3b-305">Além disso, o tráfego entre redes virtuais no Azure pode ser necessário.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-305">Additionally, traffic between virtual networks within Azure may be needed.</span></span> <span data-ttu-id="2ed3b-306">Esses cenários serão adicionados posteriormente.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-306">These scenarios will be added in the future.</span></span>

<span data-ttu-id="2ed3b-307">Depois de saber as respostas para as perguntas acima, a seção [Início Rápido](#fast-start) pode ajudá-lo a identificar quais exemplos são mais apropriados para um determinado cenário.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-307">Once you know the answers to the previous questions, the [Fast Start](#fast-start) section can help identify which examples are most appropriate for a given scenario.</span></span>

## <a name="examples-building-security-boundaries-with-azure-virtual-networks"></a><span data-ttu-id="2ed3b-308">Exemplos: criando limites de segurança com redes virtuais do Azure</span><span class="sxs-lookup"><span data-stu-id="2ed3b-308">Examples: Building security boundaries with Azure virtual networks</span></span>
### <a name="example-1-build-a-perimeter-network-to-help-protect-applications-with-nsgs"></a><span data-ttu-id="2ed3b-309">Exemplo 1: crie uma rede de perímetro para ajudar a proteger aplicativos com NSGs</span><span class="sxs-lookup"><span data-stu-id="2ed3b-309">Example 1 Build a perimeter network to help protect applications with NSGs</span></span>
<span data-ttu-id="2ed3b-310">[Voltar ao Início rápido](#fast-start) | [Instruções detalhadas de build para este exemplo][Example1]</span><span class="sxs-lookup"><span data-stu-id="2ed3b-310">[Back to Fast start](#fast-start) | [Detailed build instructions for this example][Example1]</span></span>

<span data-ttu-id="2ed3b-311">[![7]][7]</span><span class="sxs-lookup"><span data-stu-id="2ed3b-311">[![7]][7]</span></span>

#### <a name="environment-description"></a><span data-ttu-id="2ed3b-312">Descrição do ambiente</span><span class="sxs-lookup"><span data-stu-id="2ed3b-312">Environment description</span></span>
<span data-ttu-id="2ed3b-313">Neste exemplo, há uma assinatura que contém os seguintes recursos:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-313">In this example, there is a subscription that contains the following resources:</span></span>

- <span data-ttu-id="2ed3b-314">Um único grupo de recursos</span><span class="sxs-lookup"><span data-stu-id="2ed3b-314">A single resource group</span></span>
- <span data-ttu-id="2ed3b-315">Uma rede virtual com duas sub-redes: “FrontEnd” e “BackEnd”</span><span class="sxs-lookup"><span data-stu-id="2ed3b-315">A virtual network with two subnets: “FrontEnd” and “BackEnd”</span></span>
- <span data-ttu-id="2ed3b-316">Um grupo de segurança de rede que é aplicado a ambas as sub-redes</span><span class="sxs-lookup"><span data-stu-id="2ed3b-316">A Network Security Group that is applied to both subnets</span></span>
- <span data-ttu-id="2ed3b-317">Um servidor Windows que representa um servidor Web de aplicativos ("IIS01")</span><span class="sxs-lookup"><span data-stu-id="2ed3b-317">A Windows server that represents an application web server (“IIS01”)</span></span>
- <span data-ttu-id="2ed3b-318">Dois servidores Windows que representam servidores de back-end de aplicativos ("AppVM01", "AppVM02")</span><span class="sxs-lookup"><span data-stu-id="2ed3b-318">Two Windows servers that represent application back-end servers (“AppVM01”, “AppVM02”)</span></span>
- <span data-ttu-id="2ed3b-319">Um servidor Windows que representa um servidor DNS ("DNS01")</span><span class="sxs-lookup"><span data-stu-id="2ed3b-319">A Windows server that represents a DNS server (“DNS01”)</span></span>
- <span data-ttu-id="2ed3b-320">Um IP público associado ao servidor Web do aplicativo</span><span class="sxs-lookup"><span data-stu-id="2ed3b-320">A public IP associated with the application web server</span></span>

<span data-ttu-id="2ed3b-321">Para ver scripts e um modelo do Azure Resource Manager, consulte as [instruções detalhadas de build][Example1].</span><span class="sxs-lookup"><span data-stu-id="2ed3b-321">For scripts and an Azure Resource Manager template, see the [detailed build instructions][Example1].</span></span>

#### <a name="nsg-description"></a><span data-ttu-id="2ed3b-322">Descrição de NSG</span><span class="sxs-lookup"><span data-stu-id="2ed3b-322">NSG description</span></span>
<span data-ttu-id="2ed3b-323">Neste exemplo, um grupo NSG é criado e então carregado com seis regras.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-323">In this example, an NSG group is built and then loaded with six rules.</span></span>

> [!TIP]
> <span data-ttu-id="2ed3b-324">Em geral, você deve criar suas regras específicas "Permitir" primeiro, seguidas pelas regras “Negar” de caráter mais genérico.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-324">Generally speaking, you should create your specific “Allow” rules first, followed by the more generic “Deny” rules.</span></span> <span data-ttu-id="2ed3b-325">A prioridade dada determina quais regras são avaliadas primeiro.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-325">The given priority dictates which rules are evaluated first.</span></span> <span data-ttu-id="2ed3b-326">Quando o tráfego se aplicar a uma regra específica, nenhuma regra adicional será avaliada.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-326">Once traffic is found to apply to a specific rule, no further rules are evaluated.</span></span> <span data-ttu-id="2ed3b-327">As regras NSG podem se aplicar na direção de entrada ou de saída (na perspectiva da sub-rede).</span><span class="sxs-lookup"><span data-stu-id="2ed3b-327">NSG rules can apply in either the inbound or outbound direction (from the perspective of the subnet).</span></span>
>
>

<span data-ttu-id="2ed3b-328">Declarativamente, as regras a seguir estão sendo criadas para tráfego de entrada:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-328">Declaratively, the following rules are being built for inbound traffic:</span></span>

1. <span data-ttu-id="2ed3b-329">O tráfego interno de DNS (porta 53) é permitido.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-329">Internal DNS traffic (port 53) is allowed.</span></span>
2. <span data-ttu-id="2ed3b-330">O tráfego de RDP (porta 3389) da Internet para qualquer Máquina Virtual é permitido.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-330">RDP traffic (port 3389) from the Internet to any Virtual Machine is allowed.</span></span>
3. <span data-ttu-id="2ed3b-331">O tráfego HTTP (porta 80) da Internet para o servidor Web (IIS01) é permitido.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-331">HTTP traffic (port 80) from the Internet to web server (IIS01) is allowed.</span></span>
4. <span data-ttu-id="2ed3b-332">Todo o tráfego (todas as portas) de IIS01 para AppVM1 é permitido.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-332">Any traffic (all ports) from IIS01 to AppVM1 is allowed.</span></span>
5. <span data-ttu-id="2ed3b-333">Todo o tráfego (todas as portas) da Internet para a rede virtual inteira (ambas as sub-redes) é negado.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-333">Any traffic (all ports) from the Internet to the entire virtual network (both subnets) is denied.</span></span>
6. <span data-ttu-id="2ed3b-334">Todo o tráfego (todas as portas) da sub-rede de front-end para a sub-rede de back-end é negado.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-334">Any traffic (all ports) from the front-end subnet to the back-end subnet is denied.</span></span>

<span data-ttu-id="2ed3b-335">Com essas regras associado a cada sub-rede, se uma solicitação HTTP entrou pela Internet no servidor Web, as duas regras 3 (permitir) e 5 (negar) seriam aplicáveis.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-335">With these rules bound to each subnet, if an HTTP request was inbound from the Internet to the web server, both rules 3 (allow) and 5 (deny) would apply.</span></span> <span data-ttu-id="2ed3b-336">Mas como a regra 3 tem uma prioridade mais alta, apenas ela seria aplicável e a regra 5 não seria entram em cena.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-336">But because rule 3 has a higher priority, only it would apply, and rule 5 would not come into play.</span></span> <span data-ttu-id="2ed3b-337">Portanto, a solicitação HTTP seria permitida para o servidor Web.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-337">Thus the HTTP request would be allowed to the web server.</span></span> <span data-ttu-id="2ed3b-338">Se esse mesmo tráfego estivesse tentando acessar o servidor DNS01, a regra 5 (negar) seria a primeira a ser aplicada e o tráfego não teria permissão para passar para o servidor.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-338">If that same traffic was trying to reach the DNS01 server, rule 5 (deny) would be the first to apply, and the traffic would not be allowed to pass to the server.</span></span> <span data-ttu-id="2ed3b-339">A regra 6 (negar) bloqueia a comunicação entre a sub-rede de front-end e a sub-rede de back-end (exceto pelo tráfego permitido nas regras 1 e 4).</span><span class="sxs-lookup"><span data-stu-id="2ed3b-339">Rule 6 (deny) blocks the front-end subnet from talking to the back-end subnet (except for allowed traffic in rules 1 and 4).</span></span> <span data-ttu-id="2ed3b-340">Esse conjunto de regras protege a rede de back-end no caso de um invasor comprometer o aplicativo Web no front-end.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-340">This rule-set protects the back-end network in case an attacker compromises the web application on the front end.</span></span> <span data-ttu-id="2ed3b-341">O invasor teria acesso limitado à rede back-end "protegida" (apenas para recursos expostos no servidor AppVM01).</span><span class="sxs-lookup"><span data-stu-id="2ed3b-341">The attacker would have limited access to the back-end “protected” network (only to resources exposed on the AppVM01 server).</span></span>

<span data-ttu-id="2ed3b-342">Há uma regra de saída padrão que permite o tráfego de saída para a Internet.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-342">There is a default outbound rule that allows traffic out to the Internet.</span></span> <span data-ttu-id="2ed3b-343">Neste exemplo, permitiremos o tráfego de saída e não modificaremos quaisquer regras de saída.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-343">For this example, we’re allowing outbound traffic and not modifying any outbound rules.</span></span> <span data-ttu-id="2ed3b-344">Para bloquear o tráfego em ambos os trajetos, é necessário o roteamento definido pelo usuário (veja o exemplo 3).</span><span class="sxs-lookup"><span data-stu-id="2ed3b-344">To lock down traffic in both directions, user-defined routing is required (see example 3).</span></span>

#### <a name="conclusion"></a><span data-ttu-id="2ed3b-345">Conclusão</span><span class="sxs-lookup"><span data-stu-id="2ed3b-345">Conclusion</span></span>
<span data-ttu-id="2ed3b-346">Esse exemplo representa uma maneira relativamente simples e direta de isolar a sub-rede de back-end do tráfego de entrada.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-346">This example is a relatively simple and straightforward way of isolating the back-end subnet from inbound traffic.</span></span> <span data-ttu-id="2ed3b-347">Para obter mais informações, consulte as [instruções detalhadas de build][Example1].</span><span class="sxs-lookup"><span data-stu-id="2ed3b-347">For more information, see the [detailed build instructions][Example1].</span></span> <span data-ttu-id="2ed3b-348">Essas instruções incluem:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-348">These instructions include:</span></span>

* <span data-ttu-id="2ed3b-349">Como criar essa rede de perímetro com scripts do PowerShell clássico.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-349">How to build this perimeter network with classic PowerShell scripts.</span></span>
* <span data-ttu-id="2ed3b-350">Como criar essa rede de perímetro com um modelo do Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-350">How to build this perimeter network with an Azure Resource Manager template.</span></span>
* <span data-ttu-id="2ed3b-351">Descrições detalhadas de cada comando NSG.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-351">Detailed descriptions of each NSG command.</span></span>
* <span data-ttu-id="2ed3b-352">Cenários de fluxo de tráfego detalhados mostrando como o tráfego é permitido ou negado em cada camada.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-352">Detailed traffic flow scenarios, showing how traffic is allowed or denied in each layer.</span></span>


### <a name="example-2-build-a-perimeter-network-to-help-protect-applications-with-a-firewall-and-nsgs"></a><span data-ttu-id="2ed3b-353">Exemplo 2: crie uma rede de perímetro para ajudar a proteger aplicativos com um firewall e NSGs</span><span class="sxs-lookup"><span data-stu-id="2ed3b-353">Example 2 Build a perimeter network to help protect applications with a firewall and NSGs</span></span>
<span data-ttu-id="2ed3b-354">[Voltar ao Início rápido](#fast-start) | [Instruções detalhadas de build para este exemplo][Example2]</span><span class="sxs-lookup"><span data-stu-id="2ed3b-354">[Back to Fast start](#fast-start) | [Detailed build instructions for this example][Example2]</span></span>

<span data-ttu-id="2ed3b-355">[![8]][8]</span><span class="sxs-lookup"><span data-stu-id="2ed3b-355">[![8]][8]</span></span>

#### <a name="environment-description"></a><span data-ttu-id="2ed3b-356">Descrição do ambiente</span><span class="sxs-lookup"><span data-stu-id="2ed3b-356">Environment description</span></span>
<span data-ttu-id="2ed3b-357">Neste exemplo, há uma assinatura que contém os seguintes recursos:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-357">In this example, there is a subscription that contains the following resources:</span></span>

* <span data-ttu-id="2ed3b-358">Um único grupo de recursos</span><span class="sxs-lookup"><span data-stu-id="2ed3b-358">A single resource group</span></span>
* <span data-ttu-id="2ed3b-359">Uma rede virtual com duas sub-redes: “FrontEnd” e “BackEnd”</span><span class="sxs-lookup"><span data-stu-id="2ed3b-359">A virtual network with two subnets: “FrontEnd” and “BackEnd”</span></span>
* <span data-ttu-id="2ed3b-360">Um grupo de segurança de rede que é aplicado a ambas as sub-redes</span><span class="sxs-lookup"><span data-stu-id="2ed3b-360">A Network Security Group that is applied to both subnets</span></span>
* <span data-ttu-id="2ed3b-361">Uma solução de virtualização de rede, neste caso um firewall, conectada à sub-rede de front-end</span><span class="sxs-lookup"><span data-stu-id="2ed3b-361">A network virtual appliance, in this case a firewall, connected to the front-end subnet</span></span>
* <span data-ttu-id="2ed3b-362">Um servidor Windows que representa um servidor Web de aplicativos ("IIS01")</span><span class="sxs-lookup"><span data-stu-id="2ed3b-362">A Windows server that represents an application web server (“IIS01”)</span></span>
* <span data-ttu-id="2ed3b-363">Dois servidores Windows que representam servidores de back-end de aplicativos ("AppVM01", "AppVM02")</span><span class="sxs-lookup"><span data-stu-id="2ed3b-363">Two Windows servers that represent application back-end servers (“AppVM01”, “AppVM02”)</span></span>
* <span data-ttu-id="2ed3b-364">Um servidor Windows que representa um servidor DNS ("DNS01")</span><span class="sxs-lookup"><span data-stu-id="2ed3b-364">A Windows server that represents a DNS server (“DNS01”)</span></span>

<span data-ttu-id="2ed3b-365">Para ver scripts e um modelo do Azure Resource Manager, consulte as [instruções detalhadas de build][Example2].</span><span class="sxs-lookup"><span data-stu-id="2ed3b-365">For scripts and an Azure Resource Manager template, see the [detailed build instructions][Example2].</span></span>

#### <a name="nsg-description"></a><span data-ttu-id="2ed3b-366">Descrição de NSG</span><span class="sxs-lookup"><span data-stu-id="2ed3b-366">NSG description</span></span>
<span data-ttu-id="2ed3b-367">Neste exemplo, um grupo NSG é criado e então carregado com seis regras.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-367">In this example, an NSG group is built and then loaded with six rules.</span></span>

> [!TIP]
> <span data-ttu-id="2ed3b-368">Em geral, você deve criar suas regras específicas "Permitir" primeiro, seguidas pelas regras “Negar” de caráter mais genérico.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-368">Generally speaking, you should create your specific “Allow” rules first, followed by the more generic “Deny” rules.</span></span> <span data-ttu-id="2ed3b-369">A prioridade dada determina quais regras são avaliadas primeiro.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-369">The given priority dictates which rules are evaluated first.</span></span> <span data-ttu-id="2ed3b-370">Quando o tráfego se aplicar a uma regra específica, nenhuma regra adicional será avaliada.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-370">Once traffic is found to apply to a specific rule, no further rules are evaluated.</span></span> <span data-ttu-id="2ed3b-371">As regras NSG podem se aplicar na direção de entrada ou de saída (na perspectiva da sub-rede).</span><span class="sxs-lookup"><span data-stu-id="2ed3b-371">NSG rules can apply in either the inbound or outbound direction (from the perspective of the subnet).</span></span>
>
>

<span data-ttu-id="2ed3b-372">Declarativamente, as regras a seguir estão sendo criadas para tráfego de entrada:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-372">Declaratively, the following rules are being built for inbound traffic:</span></span>

1. <span data-ttu-id="2ed3b-373">O tráfego interno de DNS (porta 53) é permitido.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-373">Internal DNS traffic (port 53) is allowed.</span></span>
2. <span data-ttu-id="2ed3b-374">O tráfego de RDP (porta 3389) da Internet para qualquer Máquina Virtual é permitido.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-374">RDP traffic (port 3389) from the Internet to any Virtual Machine is allowed.</span></span>
3. <span data-ttu-id="2ed3b-375">Todo tráfego da Internet (todas as portas) para a solução de virtualização de rede (firewall) é permitido.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-375">Any Internet traffic (all ports) to the network virtual appliance (firewall) is allowed.</span></span>
4. <span data-ttu-id="2ed3b-376">Todo o tráfego (todas as portas) de IIS01 para AppVM1 é permitido.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-376">Any traffic (all ports) from IIS01 to AppVM1 is allowed.</span></span>
5. <span data-ttu-id="2ed3b-377">Todo o tráfego (todas as portas) da Internet para a rede virtual inteira (ambas as sub-redes) é negado.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-377">Any traffic (all ports) from the Internet to the entire virtual network (both subnets) is denied.</span></span>
6. <span data-ttu-id="2ed3b-378">Todo o tráfego (todas as portas) da sub-rede de front-end para a sub-rede de back-end é negado.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-378">Any traffic (all ports) from the front-end subnet to the back-end subnet is denied.</span></span>

<span data-ttu-id="2ed3b-379">Com essas regras associadas a cada sub-rede, se uma solicitação HTTP entrasse da Internet para firewall, as duas regras 3 (permitir) e 5 (negar) seriam aplicáveis.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-379">With these rules bound to each subnet, if an HTTP request was inbound from the Internet to the firewall, both rules 3 (allow) and 5 (deny) would apply.</span></span> <span data-ttu-id="2ed3b-380">Mas como a regra 3 tem uma prioridade mais alta, apenas ela seria aplicável e a regra 5 não seria entram em cena.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-380">But because rule 3 has a higher priority, only it would apply, and rule 5 would not come into play.</span></span> <span data-ttu-id="2ed3b-381">Assim, a solicitação HTTP seria permitida ao firewall.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-381">Thus the HTTP request would be allowed to the firewall.</span></span> <span data-ttu-id="2ed3b-382">Se esse mesmo tráfego estava tentando alcançar o servidor IIS01, mesmo que ele estivesse na sub-rede de front-end, a regra 5 (negar) seria aplicável e o tráfego não teria permissão para passar para o servidor.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-382">If that same traffic was trying to reach the IIS01 server, even though it’s on the front-end subnet, rule 5 (deny) would apply, and the traffic would not be allowed to pass to the server.</span></span> <span data-ttu-id="2ed3b-383">A regra 6 (negar) bloqueia a comunicação entre a sub-rede de front-end e a sub-rede de back-end (exceto pelo tráfego permitido nas regras 1 e 4).</span><span class="sxs-lookup"><span data-stu-id="2ed3b-383">Rule 6 (deny) blocks the front-end subnet from talking to the back-end subnet (except for allowed traffic in rules 1 and 4).</span></span> <span data-ttu-id="2ed3b-384">Esse conjunto de regras protege a rede de back-end no caso de um invasor comprometer o aplicativo Web no front-end.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-384">This rule-set protects the back-end network in case an attacker compromises the web application on the front end.</span></span> <span data-ttu-id="2ed3b-385">O invasor teria acesso limitado à rede back-end "protegida" (apenas para recursos expostos no servidor AppVM01).</span><span class="sxs-lookup"><span data-stu-id="2ed3b-385">The attacker would have limited access to the back-end “protected” network (only to resources exposed on the AppVM01 server).</span></span>

<span data-ttu-id="2ed3b-386">Há uma regra de saída padrão que permite o tráfego de saída para a Internet.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-386">There is a default outbound rule that allows traffic out to the Internet.</span></span> <span data-ttu-id="2ed3b-387">Neste exemplo, permitiremos o tráfego de saída e não modificaremos quaisquer regras de saída.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-387">For this example, we’re allowing outbound traffic and not modifying any outbound rules.</span></span> <span data-ttu-id="2ed3b-388">Para bloquear o tráfego em ambos os trajetos, é necessário o roteamento definido pelo usuário (veja o exemplo 3).</span><span class="sxs-lookup"><span data-stu-id="2ed3b-388">To lock down traffic in both directions, user-defined routing is required (see example 3).</span></span>

#### <a name="firewall-rule-description"></a><span data-ttu-id="2ed3b-389">Descrição da regra de firewall</span><span class="sxs-lookup"><span data-stu-id="2ed3b-389">Firewall rule description</span></span>
<span data-ttu-id="2ed3b-390">No firewall, será necessário criar regras de encaminhamento.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-390">On the firewall, forwarding rules should be created.</span></span> <span data-ttu-id="2ed3b-391">Como este exemplo só roteia o tráfego de Internet de entrada para o firewall e, em seguida, para o servidor Web, somente uma regra de NAT (conversão de endereços de rede) de encaminhamento é necessária.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-391">Since this example only routes Internet traffic in-bound to the firewall and then to the web server, only one forwarding network address translation (NAT) rule is needed.</span></span>

<span data-ttu-id="2ed3b-392">A regra de encaminhamento aceita qualquer endereço de origem de entrada que acesse o firewall tentando alcançar HTTP (porta 80 ou 443 para HTTPS).</span><span class="sxs-lookup"><span data-stu-id="2ed3b-392">The forwarding rule accepts any inbound source address that hits the firewall trying to reach HTTP (port 80 or 443 for HTTPS).</span></span> <span data-ttu-id="2ed3b-393">Ela sai da interface local do firewall e é redirecionada para o servidor Web com o Endereço IP 10.0.1.5.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-393">It's sent out of the firewall’s local interface and redirected to the web server with the IP Address of 10.0.1.5.</span></span>

#### <a name="conclusion"></a><span data-ttu-id="2ed3b-394">Conclusão</span><span class="sxs-lookup"><span data-stu-id="2ed3b-394">Conclusion</span></span>
<span data-ttu-id="2ed3b-395">Este exemplo é uma maneira relativamente simples de proteger seu aplicativo com um firewall e isolar a sub-rede de back-end do tráfego de entrada.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-395">This example is a relatively straightforward way of protecting your application with a firewall and isolating the back-end subnet from inbound traffic.</span></span> <span data-ttu-id="2ed3b-396">Para obter mais informações, consulte as [instruções detalhadas de build][Example2].</span><span class="sxs-lookup"><span data-stu-id="2ed3b-396">For more information, see the [detailed build instructions][Example2].</span></span> <span data-ttu-id="2ed3b-397">Essas instruções incluem:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-397">These instructions include:</span></span>

* <span data-ttu-id="2ed3b-398">Como criar essa rede de perímetro com scripts do PowerShell clássico.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-398">How to build this perimeter network with classic PowerShell scripts.</span></span>
* <span data-ttu-id="2ed3b-399">Como criar esse exemplo com um modelo do Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-399">How to build this example with an Azure Resource Manager template.</span></span>
* <span data-ttu-id="2ed3b-400">Descrições detalhadas de cada comando NSG e regra de firewall.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-400">Detailed descriptions of each NSG command and firewall rule.</span></span>
* <span data-ttu-id="2ed3b-401">Cenários de fluxo de tráfego detalhados mostrando como o tráfego é permitido ou negado em cada camada.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-401">Detailed traffic flow scenarios, showing how traffic is allowed or denied in each layer.</span></span>

### <a name="example-3-build-a-perimeter-network-to-help-protect-networks-with-a-firewall-and-udr-and-nsg"></a><span data-ttu-id="2ed3b-402">Exemplo 3: crie uma rede de perímetro para ajudar a proteger as redes com um firewall, UDR e NSG</span><span class="sxs-lookup"><span data-stu-id="2ed3b-402">Example 3 Build a perimeter network to help protect networks with a firewall and UDR and NSG</span></span>
<span data-ttu-id="2ed3b-403">[Voltar ao Início rápido](#fast-start) | [Instruções detalhadas de build para este exemplo][Example3]</span><span class="sxs-lookup"><span data-stu-id="2ed3b-403">[Back to Fast start](#fast-start) | [Detailed build instructions for this example][Example3]</span></span>

<span data-ttu-id="2ed3b-404">[![9]][9]</span><span class="sxs-lookup"><span data-stu-id="2ed3b-404">[![9]][9]</span></span>

#### <a name="environment-description"></a><span data-ttu-id="2ed3b-405">Descrição do ambiente</span><span class="sxs-lookup"><span data-stu-id="2ed3b-405">Environment description</span></span>
<span data-ttu-id="2ed3b-406">Neste exemplo, há uma assinatura que contém os seguintes recursos:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-406">In this example, there is a subscription that contains the following resources:</span></span>

* <span data-ttu-id="2ed3b-407">Um único grupo de recursos</span><span class="sxs-lookup"><span data-stu-id="2ed3b-407">A single resource group</span></span>
* <span data-ttu-id="2ed3b-408">Uma rede virtual com três sub-redes; “SecNet”, “FrontEnd” e “BackEnd”</span><span class="sxs-lookup"><span data-stu-id="2ed3b-408">A virtual network with three subnets: “SecNet”, “FrontEnd”, and “BackEnd”</span></span>
* <span data-ttu-id="2ed3b-409">Uma solução de virtualização de rede, neste caso um firewall, conectada à sub-rede SecNet</span><span class="sxs-lookup"><span data-stu-id="2ed3b-409">A network virtual appliance, in this case a firewall, connected to the SecNet subnet</span></span>
* <span data-ttu-id="2ed3b-410">Um servidor Windows que representa um servidor Web de aplicativos ("IIS01")</span><span class="sxs-lookup"><span data-stu-id="2ed3b-410">A Windows server that represents an application web server (“IIS01”)</span></span>
* <span data-ttu-id="2ed3b-411">Dois servidores Windows que representam servidores de back-end de aplicativos ("AppVM01", "AppVM02")</span><span class="sxs-lookup"><span data-stu-id="2ed3b-411">Two Windows servers that represent application back-end servers (“AppVM01”, “AppVM02”)</span></span>
* <span data-ttu-id="2ed3b-412">Um servidor Windows que representa um servidor DNS ("DNS01")</span><span class="sxs-lookup"><span data-stu-id="2ed3b-412">A Windows server that represents a DNS server (“DNS01”)</span></span>

<span data-ttu-id="2ed3b-413">Para ver scripts e um modelo do Azure Resource Manager, consulte as [instruções detalhadas de build][Example3].</span><span class="sxs-lookup"><span data-stu-id="2ed3b-413">For scripts and an Azure Resource Manager template, see the [detailed build instructions][Example3].</span></span>

#### <a name="udr-description"></a><span data-ttu-id="2ed3b-414">Descrição de UDR</span><span class="sxs-lookup"><span data-stu-id="2ed3b-414">UDR description</span></span>
<span data-ttu-id="2ed3b-415">Por padrão, as rotas do sistema a seguir são definidas como:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-415">By default, the following system routes are defined as:</span></span>

        Effective routes :
         Address Prefix    Next hop type    Next hop IP address Status   Source     
         --------------    -------------    ------------------- ------   ------     
         {10.0.0.0/16}     VNETLocal                            Active   Default    
         {0.0.0.0/0}       Internet                             Active   Default    
         {10.0.0.0/8}      Null                                 Active   Default    
         {100.64.0.0/10}   Null                                 Active   Default    
         {172.16.0.0/12}   Null                                 Active   Default    
         {192.168.0.0/16}  Null                                 Active   Default

<span data-ttu-id="2ed3b-416">O VNETLocal é sempre um ou mais prefixos de endereço definidos que compõem a rede virtual para essa rede específica (ou seja, ele muda de rede virtual para rede virtual, dependendo de como cada rede virtual específica é definida).</span><span class="sxs-lookup"><span data-stu-id="2ed3b-416">The VNETLocal is always one or more defined address prefixes that make up the virtual network for that specific network (that is, it changes from virtual network to virtual network, depending on how each specific virtual network is defined).</span></span> <span data-ttu-id="2ed3b-417">As rotas do sistema restantes são estáticas e padrão conforme indicado na tabela.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-417">The remaining system routes are static and default as indicated in the table.</span></span>

<span data-ttu-id="2ed3b-418">Neste exemplo, duas tabelas de roteamento são criadas, uma para a sub-rede de front-end e a outra para a sub-rede de back-end.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-418">In this example, two routing tables are created, one each for the front-end and back-end subnets.</span></span> <span data-ttu-id="2ed3b-419">Cada tabela é carregada com as rotas estáticas apropriadas para determinada sub-rede.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-419">Each table is loaded with static routes appropriate for the given subnet.</span></span> <span data-ttu-id="2ed3b-420">Nesse exemplo, cada tabela tem três rotas que direcionam todo o tráfego (0.0.0.0/0) através do firewall (Próximo salto = endereço IP da Solução de Virtualização):</span><span class="sxs-lookup"><span data-stu-id="2ed3b-420">In this example, each table has three routes that direct all traffic (0.0.0.0/0) through the firewall (Next hop = Virtual Appliance IP address):</span></span>

1. <span data-ttu-id="2ed3b-421">O tráfego de sub-rede local sem Próximo Salto definido para permitir que o tráfego de sub-rede local ignore o firewall.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-421">Local subnet traffic with no Next Hop defined to allow local subnet traffic to bypass the firewall.</span></span>
2. <span data-ttu-id="2ed3b-422">Tráfego de rede virtual com um Próximo Salto definido como firewall.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-422">Virtual network traffic with a Next Hop defined as firewall.</span></span> <span data-ttu-id="2ed3b-423">Esse próximo salto substitui a regra padrão que permite que o tráfego de Rede Virtual local seja roteado diretamente.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-423">This next hop overrides the default rule that allows local virtual network traffic to route directly.</span></span>
3. <span data-ttu-id="2ed3b-424">Todo o tráfego restante (0/0) com um Próximo Salto definido como o firewall.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-424">All remaining traffic (0/0) with a Next Hop defined as the firewall.</span></span>

> [!TIP]
> <span data-ttu-id="2ed3b-425">A falta da entrada de sub-rede local no UDR interrompe as comunicações na sub-rede local.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-425">Not having the local subnet entry in the UDR breaks local subnet communications.</span></span>
>
> * <span data-ttu-id="2ed3b-426">No nosso exemplo, 10.0.1.0/24 apontando para VNETLocal é fundamental!</span><span class="sxs-lookup"><span data-stu-id="2ed3b-426">In our example, 10.0.1.0/24 pointing to VNETLocal is critical!</span></span> <span data-ttu-id="2ed3b-427">Sem ele, o pacote deixando o servidor Web (10.0.1.4) destinado a outro servidor local (por exemplo) 10.0.1.25 falhará, pois eles serão enviados para a NVA.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-427">Without it, packet leaving the Web Server (10.0.1.4) destined to another local server (for example) 10.0.1.25 will fail as they will be sent to the NVA.</span></span> <span data-ttu-id="2ed3b-428">A NVA o enviará para a sub-rede e a sub-rede o reenviará para a NVA em um loop infinito.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-428">The NVA will send it to the subnet, and the subnet will resend it to the NVA in an infinite loop.</span></span>
> * <span data-ttu-id="2ed3b-429">As chances de um loop de roteamento são geralmente maiores em dispositivos de várias NICs conectados a sub-redes separadas, o que é normalmente o caso de dispositivos locais tradicionais.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-429">The chances of a routing loop are typically higher on appliances with multiple NICs that are connected to separate subnets, which is often of traditional, on-premises appliances.</span></span>
>
>

<span data-ttu-id="2ed3b-430">Depois que as tabelas de roteamento forem criadas, elas deverão ser associadas às respectivas sub-redes.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-430">Once the routing tables are created, they must be bound to their subnets.</span></span> <span data-ttu-id="2ed3b-431">A tabela de roteamento da sub-rede de front-end, uma vez criada e associada à sub-rede, teria esta aparência:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-431">The front-end subnet routing table, once created and bound to the subnet, would look like this output:</span></span>

        Effective routes :
         Address Prefix    Next hop type    Next hop IP address Status   Source     
         --------------    -------------    ------------------- ------   ------     
         {10.0.1.0/24}     VNETLocal                            Active
         {10.0.0.0/16}     VirtualAppliance 10.0.0.4            Active    
         {0.0.0.0/0}       VirtualAppliance 10.0.0.4            Active

> [!NOTE]
> <span data-ttu-id="2ed3b-432">O UDR agora pode ser aplicado à sub-rede de gateway a qual o circuito de ExpressRoute está conectado.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-432">UDR can now be applied to the gateway subnet on which the ExpressRoute circuit is connected.</span></span>
>
> <span data-ttu-id="2ed3b-433">Exemplos de como habilitar a rede de perímetro com a rede site a site ou de ExpressRoute são mostrados nos exemplos 3 e 4.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-433">Examples of how to enable your perimeter network with ExpressRoute or site-to-site networking are shown in examples 3 and 4.</span></span>
>
>

#### <a name="ip-forwarding-description"></a><span data-ttu-id="2ed3b-434">Descrição de Encaminhamento IP</span><span class="sxs-lookup"><span data-stu-id="2ed3b-434">IP Forwarding description</span></span>
<span data-ttu-id="2ed3b-435">O Encaminhamento IP é um recurso complementar para o UDR.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-435">IP Forwarding is a companion feature to UDR.</span></span> <span data-ttu-id="2ed3b-436">O Encaminhamento de IP é uma configuração em uma solução de virtualização que permite receber o tráfego endereçado não especificamente para a solução e, em seguida, encaminhar esse tráfego para seu destino final.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-436">IP Forwarding is a setting on a virtual appliance that allows it to receive traffic not specifically addressed to the appliance, and then forward that traffic to its ultimate destination.</span></span>

<span data-ttu-id="2ed3b-437">Por exemplo, se AppVM01 fizesse uma solicitação para o servidor DNS01, o UDR rotearia esse tráfego para o firewall.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-437">For example, if AppVM01 makes a request to the DNS01 server, UDR would route this traffic to the firewall.</span></span> <span data-ttu-id="2ed3b-438">Com o Encaminhamento IP habilitado, o tráfego para o destino DNS01 (10.0.2.4) será aceito pelo dispositivo (10.0.0.4) e então encaminhado para seu destino final (10.0.2.4).</span><span class="sxs-lookup"><span data-stu-id="2ed3b-438">With IP Forwarding enabled, the traffic for the DNS01 destination (10.0.2.4) is accepted by the appliance (10.0.0.4) and then forwarded to its ultimate destination (10.0.2.4).</span></span> <span data-ttu-id="2ed3b-439">Sem o Encaminhamento IP habilitado no firewall, o tráfego não seria aceito pela solução, embora a tabela de rota tenha o firewall como o próximo salto.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-439">Without IP Forwarding enabled on the firewall, traffic would not be accepted by the appliance even though the route table has the firewall as the next hop.</span></span> <span data-ttu-id="2ed3b-440">Para usar uma solução de virtualização, é essencial lembrar-se de habilitar o Encaminhamento IP em conjunto com o UDR.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-440">To use a virtual appliance, it’s critical to remember to enable IP Forwarding along with UDR.</span></span>

#### <a name="nsg-description"></a><span data-ttu-id="2ed3b-441">Descrição de NSG</span><span class="sxs-lookup"><span data-stu-id="2ed3b-441">NSG description</span></span>
<span data-ttu-id="2ed3b-442">Neste exemplo, um grupo NSG é criado e então carregado com uma única regra.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-442">In this example, an NSG group is built and then loaded with a single rule.</span></span> <span data-ttu-id="2ed3b-443">Esse grupo é então associado somente às sub-redes de front-end e back-end (e não a SecNet).</span><span class="sxs-lookup"><span data-stu-id="2ed3b-443">This group is then bound only to the front-end and back-end subnets (not the SecNet).</span></span> <span data-ttu-id="2ed3b-444">Declarativamente, a seguinte regra está sendo criada:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-444">Declaratively the following rule is being built:</span></span>

* <span data-ttu-id="2ed3b-445">Todo o tráfego (todas as portas) da Internet para a rede virtual inteira (todas as sub-redes) é negado.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-445">Any traffic (all ports) from the Internet to the entire virtual network (all subnets) is denied.</span></span>

<span data-ttu-id="2ed3b-446">Embora NSGs sejam usados neste exemplo, seu principal objetivo será ser como uma segunda camada de defesa contra erros de configuração manual.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-446">Although NSGs are used in this example, its main purpose is as a secondary layer of defense against manual misconfiguration.</span></span> <span data-ttu-id="2ed3b-447">A meta é bloquear todo o tráfego de entrada da Internet para as sub-redes de front-end ou back-end.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-447">The goal is to block all inbound traffic from the Internet to either the front-end or back-end subnets.</span></span> <span data-ttu-id="2ed3b-448">O tráfego deve fluir somente pela sub-rede SecNet para o firewall (e, se apropriado, continuar para as sub-redes de front-end ou back-end).</span><span class="sxs-lookup"><span data-stu-id="2ed3b-448">Traffic should only flow through the SecNet subnet to the firewall (and then, if appropriate, on to the front-end or back-end subnets).</span></span> <span data-ttu-id="2ed3b-449">Além disso, com as regras UDR em vigor, qualquer tráfego que tenha conseguido passar para as sub-redes de front-end ou de back-end seria direcionado para o firewall (graças ao UDR).</span><span class="sxs-lookup"><span data-stu-id="2ed3b-449">Plus, with the UDR rules in place, any traffic that did make it into the front-end or back-end subnets would be directed out to the firewall (thanks to UDR).</span></span> <span data-ttu-id="2ed3b-450">O firewall veria esse tráfego como um fluxo assimétrico e descartaria o tráfego de saída.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-450">The firewall would see this traffic as an asymmetric flow and would drop the outbound traffic.</span></span> <span data-ttu-id="2ed3b-451">Assim, há três camadas de segurança protegendo as sub-redes:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-451">Thus there are three layers of security protecting the subnets:</span></span>

* <span data-ttu-id="2ed3b-452">Não há endereços IP públicos em nenhuma NIC de front-end ou back-end.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-452">No Public IP addresses on any FrontEnd or BackEnd NICs.</span></span>
* <span data-ttu-id="2ed3b-453">NSGs negando o tráfego da Internet.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-453">NSGs denying traffic from the Internet.</span></span>
* <span data-ttu-id="2ed3b-454">O firewall soltando tráfego assimétrico.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-454">The firewall dropping asymmetric traffic.</span></span>

<span data-ttu-id="2ed3b-455">Um ponto interessante sobre o NSG neste exemplo é que ele contém apenas uma regra, que é negar o tráfego da Internet para toda a rede virtual, incluindo a sub-rede de Segurança.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-455">One interesting point regarding the NSG in this example is that it contains only one rule, which is to deny Internet traffic to the entire virtual network, including the Security subnet.</span></span> <span data-ttu-id="2ed3b-456">No entanto, como o NSG está associado apenas às sub-redes de front-end e de back-end, a regra não é processada em tráfego de entrada para a sub-rede de Segurança.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-456">However, since the NSG is only bound to the front-end and back-end subnets, the rule isn’t processed on traffic inbound to the Security subnet.</span></span> <span data-ttu-id="2ed3b-457">Como resultado, o tráfego flui para a sub-rede de segurança.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-457">As a result, traffic flows to the Security subnet.</span></span>

#### <a name="firewall-rules"></a><span data-ttu-id="2ed3b-458">Regras de firewall</span><span class="sxs-lookup"><span data-stu-id="2ed3b-458">Firewall rules</span></span>
<span data-ttu-id="2ed3b-459">No firewall, será necessário criar regras de encaminhamento.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-459">On the firewall, forwarding rules should be created.</span></span> <span data-ttu-id="2ed3b-460">Uma vez que o firewall está bloqueando ou encaminhando todos os tráfegos de entrada, de saída e entre redes virtuais, serão necessárias muitas regras de firewall.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-460">Since the firewall is blocking or forwarding all inbound, outbound, and intra-virtual network traffic, many firewall rules are needed.</span></span> <span data-ttu-id="2ed3b-461">Além disso, todo o tráfego de entrada atinge o endereço IP público do Serviço de Segurança (em portas diferentes) para ser processado pelo firewall.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-461">Also, all inbound traffic hits the Security Service public IP address (on different ports), to be processed by the firewall.</span></span> <span data-ttu-id="2ed3b-462">Uma prática recomendada é criar um diagrama dos fluxos lógicos antes de configurar as sub-redes e as regras de firewall, para evitar uma reformulação posterior.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-462">A best practice is to diagram the logical flows before setting up the subnets and firewall rules, to avoid rework later.</span></span> <span data-ttu-id="2ed3b-463">A figura a seguir é uma exibição lógica das regras de firewall para este exemplo:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-463">The following figure is a logical view of the firewall rules for this example:</span></span>

<span data-ttu-id="2ed3b-464">![10]</span><span class="sxs-lookup"><span data-stu-id="2ed3b-464">![10]</span></span>

> [!NOTE]
> <span data-ttu-id="2ed3b-465">Com base na Solução de Virtualização de Rede usada, as portas de gerenciamento variam.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-465">Based on the Network Virtual Appliance used, the management ports vary.</span></span> <span data-ttu-id="2ed3b-466">Neste exemplo, um Firewall NextGen Barracuda é mencionado e usa as portas 22, 801 e 807.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-466">In this example, a Barracuda NextGen Firewall is referenced, which uses ports 22, 801, and 807.</span></span> <span data-ttu-id="2ed3b-467">Consulte a documentação do fornecedor do dispositivo para localizar as portas exatas usadas para o gerenciamento do dispositivo usado.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-467">Consult the appliance vendor documentation to find the exact ports used for management of the device being used.</span></span>
>
>

#### <a name="firewall-rules-description"></a><span data-ttu-id="2ed3b-468">Descrição das regras de firewall</span><span class="sxs-lookup"><span data-stu-id="2ed3b-468">Firewall rules description</span></span>
<span data-ttu-id="2ed3b-469">No diagrama lógico anterior, a sub-rede de segurança não é mostrada porque o firewall é o único recurso nessa sub-rede.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-469">In the preceding logical diagram, the security subnet is not shown because the firewall is the only resource on that subnet.</span></span> <span data-ttu-id="2ed3b-470">O diagrama mostra as regras de firewall e como elas permitem ou negam logicamente os fluxos de tráfego, mas não o caminho roteado real.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-470">The diagram is showing the firewall rules and how they logically allow or deny traffic flows, not the actual routed path.</span></span> <span data-ttu-id="2ed3b-471">Além disso, as portas externas selecionadas para o tráfego RDP são portas com um intervalo maior (8014 – 8026) e foram selecionadas para alinhar um pouco com os dois últimos octetos do endereço IP local para facilitar a leitura (por exemplo, o endereço do servidor local 10.0.1.4 está associado à porta externa 8014).</span><span class="sxs-lookup"><span data-stu-id="2ed3b-471">Also, the external ports selected for the RDP traffic are higher ranged ports (8014 – 8026) and were selected to loosely align with the last two octets of the local IP address for easier readability (for example, local server address 10.0.1.4 is associated with external port 8014).</span></span> <span data-ttu-id="2ed3b-472">No entanto, todas as portas não conflitantes acima disso poderiam ser usadas.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-472">Any higher non-conflicting ports, however, could be used.</span></span>

<span data-ttu-id="2ed3b-473">Para este exemplo, precisamos de sete tipos de regras:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-473">For this example, we need seven types of rules:</span></span>

* <span data-ttu-id="2ed3b-474">Regras externas (para o tráfego de entrada):</span><span class="sxs-lookup"><span data-stu-id="2ed3b-474">External rules (for inbound traffic):</span></span>
  1. <span data-ttu-id="2ed3b-475">Regra de gerenciamento de firewall: essa regra de Redirecionamento de Aplicativo permite que o tráfego passe para as portas de gerenciamento da solução de virtualização de rede.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-475">Firewall management rule: This App Redirect rule allows traffic to pass to the management ports of the network virtual appliance.</span></span>
  2. <span data-ttu-id="2ed3b-476">Regras de RDP (para cada servidor Windows): essas quatro regras (uma para cada servidor) permitem o gerenciamento dos servidores individuais via RDP.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-476">RDP rules (for each Windows server): These four rules (one for each server) allow management of the individual servers via RDP.</span></span> <span data-ttu-id="2ed3b-477">As quatro regras de RDP também poderiam ser recolhidas em uma regra, dependendo dos recursos da solução de virtualização de rede usada.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-477">The four RDP rules could also be collapsed into one rule, depending on the capabilities of the network virtual appliance being used.</span></span>
  3. <span data-ttu-id="2ed3b-478">Regras de tráfego do aplicativo: há duas regras desse tipo, a primeira para o tráfego da Web de front-end e a segunda para o tráfego de back-end (por exemplo, o servidor Web para a camada de dados).</span><span class="sxs-lookup"><span data-stu-id="2ed3b-478">Application traffic rules: There are two of these rules, the first for the front-end web traffic, and the second for the back-end traffic (for example, web server to data tier).</span></span> <span data-ttu-id="2ed3b-479">A configuração dessas regras depende da arquitetura de rede (na qual os servidores são colocados) e dos fluxos de tráfego (a direção na qual o tráfego flui e quais portas são usadas).</span><span class="sxs-lookup"><span data-stu-id="2ed3b-479">The configuration of these rules depends on the network architecture (where your servers are placed) and traffic flows (which direction the traffic flows, and which ports are used).</span></span>
     * <span data-ttu-id="2ed3b-480">A primeira regra permite que o tráfego de aplicativo real alcance o servidor de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-480">The first rule allows the actual application traffic to reach the application server.</span></span> <span data-ttu-id="2ed3b-481">Embora as outras regras permitam segurança e gerenciamento, as regras de aplicativo são as que permitem que usuários ou serviços externos acessem os aplicativos.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-481">While the other rules allow for security and management, application traffic rules are what allow external users or services to access the applications.</span></span> <span data-ttu-id="2ed3b-482">Neste exemplo, há um único servidor Web na porta 80.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-482">For this example, there is a single web server on port 80.</span></span> <span data-ttu-id="2ed3b-483">Assim, uma única regra de aplicativo de firewall redireciona o tráfego de entrada para o IP externo, para o endereço IP interno dos servidores Web.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-483">Thus a single firewall application rule redirects inbound traffic to the external IP, to the web servers internal IP address.</span></span> <span data-ttu-id="2ed3b-484">A sessão de tráfego redirecionado seria movida por meio de NAT para o servidor interno.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-484">The redirected traffic session would be translated via NAT to the internal server.</span></span>
     * <span data-ttu-id="2ed3b-485">A segunda regra de tráfego é a regra de back-end que permite que o servidor Web converse com o servidor AppVM01 (mas não com AppVM02) por meio de qualquer porta.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-485">The second rule is the back-end rule to allow the web server to talk to the AppVM01 server (but not AppVM02) via any port.</span></span>
* <span data-ttu-id="2ed3b-486">Regras internas (para tráfego entre redes virtuais)</span><span class="sxs-lookup"><span data-stu-id="2ed3b-486">Internal rules (for intra-virtual network traffic)</span></span>
  1. <span data-ttu-id="2ed3b-487">Regra de saída para Internet: essa regra permite que o tráfego de qualquer rede passe para as redes selecionadas.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-487">Outbound to Internet rule: This rule allows traffic from any network to pass to the selected networks.</span></span> <span data-ttu-id="2ed3b-488">Normalmente, essa regra é uma regra padrão que já existe no firewall, mas em um estado desabilitado.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-488">This rule is usually a default rule already on the firewall, but in a disabled state.</span></span> <span data-ttu-id="2ed3b-489">Essa regra deve ser habilitada para esse exemplo.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-489">This rule should be enabled for this example.</span></span>
  2. <span data-ttu-id="2ed3b-490">Regra DNS: essa regra permite que somente o tráfego DNS (porta 53) passe para o servidor DNS.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-490">DNS rule: This rule allows only DNS (port 53) traffic to pass to the DNS server.</span></span> <span data-ttu-id="2ed3b-491">Para esse ambiente, a maior parte do tráfego do front-end para o back-end está bloqueado.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-491">For this environment, most traffic from the front end to the back end is blocked.</span></span> <span data-ttu-id="2ed3b-492">Essa regra permite especificamente DNS de qualquer sub-rede local.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-492">This rule specifically allows DNS from any local subnet.</span></span>
  3. <span data-ttu-id="2ed3b-493">Regra sub-rede para sub-rede: essa regra permite que qualquer servidor na rede de back-end se conecte a qualquer servidor na rede de front-end (mas não o contrário).</span><span class="sxs-lookup"><span data-stu-id="2ed3b-493">Subnet to subnet rule: This rule is to allow any server on the back-end subnet to connect to any server on the front-end subnet (but not the reverse).</span></span>
* <span data-ttu-id="2ed3b-494">Regra à prova de falhas (para tráfego que não atenda a nenhum dos itens acima):</span><span class="sxs-lookup"><span data-stu-id="2ed3b-494">Fail-safe rule (for traffic that doesn’t meet any of the previous):</span></span>
  1. <span data-ttu-id="2ed3b-495">Regra negar todo o tráfego: essa deverá ser sempre a última regra (em termos de prioridade) e, como tal, se um fluxo de tráfego falhar na correspondência a todas as regras anteriores, ele será removido por essa regra.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-495">Deny all traffic rule: This deny rule should always be the final rule (in terms of priority), and as such if a traffic flow fails to match any of the preceding rules it is dropped by this rule.</span></span> <span data-ttu-id="2ed3b-496">Essa regra é uma regra padrão e geralmente in-loco e ativa.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-496">This rule is a default rule and usually in-place and active.</span></span> <span data-ttu-id="2ed3b-497">Geralmente, nenhuma modificação é necessária para essa regra.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-497">No modifications are usually needed to this rule.</span></span>

> [!TIP]
> <span data-ttu-id="2ed3b-498">Na segunda regra de tráfego de aplicativo, para simplificar este exemplo, qualquer porta é permitida.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-498">On the second application traffic rule, to simplify this example, any port is allowed.</span></span> <span data-ttu-id="2ed3b-499">Em um cenário real, a porta mais específica e os intervalos de endereços devem ser usados para reduzir a superfície de ataque desta regra.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-499">In a real scenario, the most specific port and address ranges should be used to reduce the attack surface of this rule.</span></span>
>
>

<span data-ttu-id="2ed3b-500">Depois que as regras anteriores forem criadas, será importante examinar a prioridade de cada regra para garantir que o tráfego seja permitido ou negado conforme desejado.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-500">Once the previous rules are created, it’s important to review the priority of each rule to ensure traffic is allowed or denied as desired.</span></span> <span data-ttu-id="2ed3b-501">Neste exemplo, as regras estão em ordem de prioridade.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-501">For this example, the rules are in priority order.</span></span>

#### <a name="conclusion"></a><span data-ttu-id="2ed3b-502">Conclusão</span><span class="sxs-lookup"><span data-stu-id="2ed3b-502">Conclusion</span></span>
<span data-ttu-id="2ed3b-503">Esse exemplo é uma maneira mais complexa, porém mais completa de proteger e isolar a rede do que as vistas nos exemplos anteriores.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-503">This example is a more complex but complete way of protecting and isolating the network than the previous examples.</span></span> <span data-ttu-id="2ed3b-504">(o Exemplo 2 protege apenas o aplicativo e o Exemplo 1 isola apenas sub-redes).</span><span class="sxs-lookup"><span data-stu-id="2ed3b-504">(Example 2 protects just the application, and Example 1 just isolates subnets).</span></span> <span data-ttu-id="2ed3b-505">Esse design permite monitorar o tráfego em ambos os trajetos e protege não apenas o servidor de aplicativos de entrada, mas impõe políticas de segurança de rede para todos os servidores nessa rede.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-505">This design allows for monitoring traffic in both directions, and protects not just the inbound application server but enforces network security policy for all servers on this network.</span></span> <span data-ttu-id="2ed3b-506">Além disso, dependendo do dispositivo usado, pode-se conseguir auditoria e reconhecimento total de tráfego.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-506">Also, depending on the appliance used, full traffic auditing and awareness can be achieved.</span></span> <span data-ttu-id="2ed3b-507">Para obter mais informações, consulte as [instruções detalhadas de build][Example3].</span><span class="sxs-lookup"><span data-stu-id="2ed3b-507">For more information, see the [detailed build instructions][Example3].</span></span> <span data-ttu-id="2ed3b-508">Essas instruções incluem:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-508">These instructions include:</span></span>

* <span data-ttu-id="2ed3b-509">Como criar essa rede de perímetro de exemplo com scripts clássicos do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-509">How to build this example perimeter network with classic PowerShell scripts.</span></span>
* <span data-ttu-id="2ed3b-510">Como criar esse exemplo com um modelo do Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-510">How to build this example with an Azure Resource Manager template.</span></span>
* <span data-ttu-id="2ed3b-511">As descrições detalhadas de cada comando NSG, UDR e regra de firewall.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-511">Detailed descriptions of each UDR, NSG command, and firewall rule.</span></span>
* <span data-ttu-id="2ed3b-512">Cenários de fluxo de tráfego detalhados mostrando como o tráfego é permitido ou negado em cada camada.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-512">Detailed traffic flow scenarios, showing how traffic is allowed or denied in each layer.</span></span>

### <a name="example-4-add-a-hybrid-connection-with-a-site-to-site-virtual-appliance-vpn"></a><span data-ttu-id="2ed3b-513">Exemplo 4: adicionar uma conexão híbrida com uma VPN de solução de virtualização site a site</span><span class="sxs-lookup"><span data-stu-id="2ed3b-513">Example 4 Add a hybrid connection with a site-to-site, virtual appliance VPN</span></span>
<span data-ttu-id="2ed3b-514">[Voltar ao Início rápido](#fast-start) | Instruções detalhadas de build estarão disponíveis em breve</span><span class="sxs-lookup"><span data-stu-id="2ed3b-514">[Back to Fast start](#fast-start) | Detailed build instructions available soon</span></span>

<span data-ttu-id="2ed3b-515">[![11]][11]</span><span class="sxs-lookup"><span data-stu-id="2ed3b-515">[![11]][11]</span></span>

#### <a name="environment-description"></a><span data-ttu-id="2ed3b-516">Descrição do ambiente</span><span class="sxs-lookup"><span data-stu-id="2ed3b-516">Environment description</span></span>
<span data-ttu-id="2ed3b-517">Uma rede híbrida usando um NVA (solução de virtualização de rede) pode ser adicionada a qualquer um dos tipos de rede de perímetro descritas no exemplo 1, 2 ou 3.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-517">Hybrid networking using a network virtual appliance (NVA) can be added to any of the perimeter network types described in examples 1, 2, or 3.</span></span>

<span data-ttu-id="2ed3b-518">Conforme mostrado na figura anterior, uma conexão VPN pela Internet (site a site) é usada para conectar uma rede local a uma rede virtual do Azure através de um NVA.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-518">As shown in the previous figure, a VPN connection over the Internet (site-to-site) is used to connect an on-premises network to an Azure virtual network via an NVA.</span></span>

> [!NOTE]
> <span data-ttu-id="2ed3b-519">Se você usar o ExpressRoute com a opção de Emparelhamento Público do Azure habilitada, uma rota estática deverá ser criada.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-519">If you use ExpressRoute with the Azure Public Peering option enabled, a static route should be created.</span></span> <span data-ttu-id="2ed3b-520">Essa rota estática deve rotear para o endereço IP de VPN de NVA fora de sua Internet corporativa e não através da conexão do ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-520">This static route should route to the NVA VPN IP address out your corporate Internet and not via the ExpressRoute connection.</span></span> <span data-ttu-id="2ed3b-521">A NAT necessária na opção de Emparelhamento Público de ExpressRoute do Azure pode interromper a sessão de VPN.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-521">The NAT required on the ExpressRoute Azure Public Peering option can break the VPN session.</span></span>
>
>

<span data-ttu-id="2ed3b-522">Depois que a VPN estiver no local, o NVA torna-se o hub central para todas as redes e sub-redes.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-522">Once the VPN is in place, the NVA becomes the central hub for all networks and subnets.</span></span> <span data-ttu-id="2ed3b-523">As regras de encaminhamento de firewall determinam quais fluxos de tráfego são permitidos, convertidos via NAT, redirecionados ou removidos (mesmo para fluxos de tráfego entre a rede local e o Azure).</span><span class="sxs-lookup"><span data-stu-id="2ed3b-523">The firewall forwarding rules determine which traffic flows are allowed, are translated via NAT, are redirected, or are dropped (even for traffic flows between the on-premises network and Azure).</span></span>

<span data-ttu-id="2ed3b-524">Os fluxos de tráfego devem ser considerados com cuidado, já que podem ser otimizados ou degradados por esse padrão de design dependendo do caso de uso específico.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-524">Traffic flows should be considered carefully, as they can be optimized or degraded by this design pattern, depending on the specific use case.</span></span>

<span data-ttu-id="2ed3b-525">Usar o ambiente criado no exemplo 3 e então adicionar uma conexão de rede híbrida VPN site a site gera o design a seguir:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-525">Using the environment built in example 3, and then adding a site-to-site VPN hybrid network connection, produces the following design:</span></span>

<span data-ttu-id="2ed3b-526">[![12]][12]</span><span class="sxs-lookup"><span data-stu-id="2ed3b-526">[![12]][12]</span></span>

<span data-ttu-id="2ed3b-527">O roteador local, ou outro dispositivo de rede que seja compatível com seu NVA para VPN, seria o cliente VPN.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-527">The on-premises router, or any other network device that is compatible with your NVA for VPN, would be the VPN client.</span></span> <span data-ttu-id="2ed3b-528">Este dispositivo físico seria responsável por iniciar e manter a conexão VPN com seu NVA.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-528">This physical device would be responsible for initiating and maintaining the VPN connection with your NVA.</span></span>

<span data-ttu-id="2ed3b-529">Logicamente para o NVA, a rede é igual a quatro "zonas de segurança" separadas com as regras sobre o NVA sendo as principais orientadoras do tráfego entre essas zonas:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-529">Logically to the NVA, the network looks like four separate “security zones” with the rules on the NVA being the primary director of traffic between these zones:</span></span>

<span data-ttu-id="2ed3b-530">![13]</span><span class="sxs-lookup"><span data-stu-id="2ed3b-530">![13]</span></span>

#### <a name="conclusion"></a><span data-ttu-id="2ed3b-531">Conclusão</span><span class="sxs-lookup"><span data-stu-id="2ed3b-531">Conclusion</span></span>
<span data-ttu-id="2ed3b-532">A adição de uma conexão de rede híbrida VPN site a site para uma rede virtual do Azure pode estender a rede local no Azure de maneira segura.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-532">The addition of a site-to-site VPN hybrid network connection to an Azure virtual network can extend the on-premises network into Azure in a secure manner.</span></span> <span data-ttu-id="2ed3b-533">Ao usar uma conexão VPN, o tráfego é criptografado e roteado pela Internet.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-533">In using a VPN connection, your traffic is encrypted and routes via the Internet.</span></span> <span data-ttu-id="2ed3b-534">O NVA neste exemplo fornece um local central para aplicar e gerenciar a política de segurança.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-534">The NVA in this example provides a central location to enforce and manage the security policy.</span></span> <span data-ttu-id="2ed3b-535">Para obter mais informações, consulte as instruções detalhadas de build (próximo).</span><span class="sxs-lookup"><span data-stu-id="2ed3b-535">For more information, see the detailed build instructions (forthcoming).</span></span> <span data-ttu-id="2ed3b-536">Essas instruções incluem:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-536">These instructions include:</span></span>

* <span data-ttu-id="2ed3b-537">Como criar essa rede de perímetro de exemplo com scripts do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-537">How to build this example perimeter network with PowerShell scripts.</span></span>
* <span data-ttu-id="2ed3b-538">Como criar esse exemplo com um modelo do Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-538">How to build this example with an Azure Resource Manager template.</span></span>
* <span data-ttu-id="2ed3b-539">Cenários de fluxo de tráfego detalhados mostrando como o tráfego flui através desse design.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-539">Detailed traffic flow scenarios, showing how traffic flows through this design.</span></span>

### <a name="example-5-add-a-hybrid-connection-with-a-site-to-site-azure-vpn-gateway"></a><span data-ttu-id="2ed3b-540">Exemplo 5: adicionar uma conexão híbrida com um gateway de VPN site a site do Azure</span><span class="sxs-lookup"><span data-stu-id="2ed3b-540">Example 5 Add a hybrid connection with a site-to-site, Azure VPN gateway</span></span>
<span data-ttu-id="2ed3b-541">[Voltar ao Início rápido](#fast-start) | Instruções detalhadas de build estarão disponíveis em breve</span><span class="sxs-lookup"><span data-stu-id="2ed3b-541">[Back to Fast start](#fast-start) | Detailed build instructions available soon</span></span>

<span data-ttu-id="2ed3b-542">[![14]][14]</span><span class="sxs-lookup"><span data-stu-id="2ed3b-542">[![14]][14]</span></span>

#### <a name="environment-description"></a><span data-ttu-id="2ed3b-543">Descrição do ambiente</span><span class="sxs-lookup"><span data-stu-id="2ed3b-543">Environment description</span></span>
<span data-ttu-id="2ed3b-544">Uma rede híbrida usando um gateway de VPN do Azure pode ser adicionada a qualquer tipo de rede de perímetro descrito nos exemplos 1 ou 2.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-544">Hybrid networking using an Azure VPN gateway can be added to either perimeter network type described in examples 1 or 2.</span></span>

<span data-ttu-id="2ed3b-545">Conforme mostrado na figura anterior, uma conexão VPN pela Internet (site a site) é usada para conectar uma rede local a uma rede virtual do Azure através de um gateway de VPN do Azure.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-545">As shown in the preceding figure, a VPN connection over the Internet (site-to-site) is used to connect an on-premises network to an Azure virtual network via an Azure VPN gateway.</span></span>

> [!NOTE]
> <span data-ttu-id="2ed3b-546">Se você usar o ExpressRoute com a opção de Emparelhamento Público do Azure habilitada, uma rota estática deverá ser criada.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-546">If you use ExpressRoute with the Azure Public Peering option enabled, a static route should be created.</span></span> <span data-ttu-id="2ed3b-547">Essa rota estática deve rotear para o endereço IP de VPN de NVA fora de sua Internet corporativa e não através da WAN do ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-547">This  static route should route to the NVA VPN IP address out your corporate Internet and not via the ExpressRoute WAN.</span></span> <span data-ttu-id="2ed3b-548">A NAT necessária na opção de Emparelhamento Público de ExpressRoute do Azure pode interromper a sessão de VPN.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-548">The NAT required on the ExpressRoute Azure Public Peering option can break the VPN session.</span></span>
>
>

<span data-ttu-id="2ed3b-549">A figura a seguir mostra as duas bordas de rede nesse exemplo.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-549">The following figure shows the two network edges in this example.</span></span> <span data-ttu-id="2ed3b-550">Na primeira borda, o NVA e os NSGs controlam os fluxos de tráfego entre redes do Azure e entre o Azure e a Internet.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-550">On the first edge, the NVA and NSGs control traffic flows for intra-Azure networks and between Azure and the Internet.</span></span> <span data-ttu-id="2ed3b-551">A segunda borda é o gateway de VPN do Azure, que é uma borda de rede separada e isolada entre local e o Azure.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-551">The second edge is the Azure VPN gateway, which is a separate and isolated network edge between on-premises and Azure.</span></span>

<span data-ttu-id="2ed3b-552">Os fluxos de tráfego devem ser considerados com cuidado, já que podem ser otimizados ou degradados por esse padrão de design dependendo do caso de uso específico.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-552">Traffic flows should be considered carefully, as they can be optimized or degraded by this design pattern, depending on the specific use case.</span></span>

<span data-ttu-id="2ed3b-553">Usar o ambiente criado no exemplo 1 e então adicionar uma conexão de rede híbrida VPN site a site gera o design a seguir:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-553">Using the environment built in example 1, and then adding a site-to-site VPN hybrid network connection, produces the following design:</span></span>

<span data-ttu-id="2ed3b-554">[![15]][15]</span><span class="sxs-lookup"><span data-stu-id="2ed3b-554">[![15]][15]</span></span>

#### <a name="conclusion"></a><span data-ttu-id="2ed3b-555">Conclusão</span><span class="sxs-lookup"><span data-stu-id="2ed3b-555">Conclusion</span></span>
<span data-ttu-id="2ed3b-556">A adição de uma conexão de rede híbrida VPN site a site para uma rede virtual do Azure pode estender a rede local no Azure de maneira segura.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-556">The addition of a site-to-site VPN hybrid network connection to an Azure virtual network can extend the on-premises network into Azure in a secure manner.</span></span> <span data-ttu-id="2ed3b-557">Usando o gateway de VPN do Azure nativo, o tráfego é criptografado com IPsec e roteado via Internet.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-557">Using the native Azure VPN gateway, your traffic is IPSec encrypted and routes via the Internet.</span></span> <span data-ttu-id="2ed3b-558">Além disso, o uso de gateway de VPN do Azure pode oferecer uma opção de menor custo (sem custos com licença adicional ou NVAs de terceiros).</span><span class="sxs-lookup"><span data-stu-id="2ed3b-558">Also, using the Azure VPN gateway can provide a lower-cost option (no additional licensing cost as with third-party NVAs).</span></span> <span data-ttu-id="2ed3b-559">Essa opção é mais econômica no exemplo 1, em que nenhuma NVA é usada.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-559">This option is most economical in example 1, where no NVA is used.</span></span> <span data-ttu-id="2ed3b-560">Para obter mais informações, consulte as instruções detalhadas de build (próximo).</span><span class="sxs-lookup"><span data-stu-id="2ed3b-560">For more information, see the detailed build instructions (forthcoming).</span></span> <span data-ttu-id="2ed3b-561">Essas instruções incluem:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-561">These instructions include:</span></span>

* <span data-ttu-id="2ed3b-562">Como criar essa rede de perímetro de exemplo com scripts do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-562">How to build this example perimeter network with PowerShell scripts.</span></span>
* <span data-ttu-id="2ed3b-563">Como criar esse exemplo com um modelo do Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-563">How to build this example with an Azure Resource Manager template.</span></span>
* <span data-ttu-id="2ed3b-564">Cenários de fluxo de tráfego detalhados mostrando como o tráfego flui através desse design.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-564">Detailed traffic flow scenarios, showing how traffic flows through this design.</span></span>

### <a name="example-6-add-a-hybrid-connection-with-expressroute"></a><span data-ttu-id="2ed3b-565">Exemplo 6: adicione uma conexão híbrida com o ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="2ed3b-565">Example 6 Add a hybrid connection with ExpressRoute</span></span>
<span data-ttu-id="2ed3b-566">[Voltar ao Início rápido](#fast-start) | Instruções detalhadas de build estarão disponíveis em breve</span><span class="sxs-lookup"><span data-stu-id="2ed3b-566">[Back to Fast start](#fast-start) | Detailed build instructions available soon</span></span>

<span data-ttu-id="2ed3b-567">[![16]][16]</span><span class="sxs-lookup"><span data-stu-id="2ed3b-567">[![16]][16]</span></span>

#### <a name="environment-description"></a><span data-ttu-id="2ed3b-568">Descrição do ambiente</span><span class="sxs-lookup"><span data-stu-id="2ed3b-568">Environment description</span></span>
<span data-ttu-id="2ed3b-569">Uma rede híbrida usando uma conexão de emparelhamento privado de ExpressRoute pode ser adicionada a qualquer tipo de rede de perímetro descrita nos exemplos 1 ou 2.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-569">Hybrid networking using an ExpressRoute private peering connection can be added to either perimeter network type described in examples 1 or 2.</span></span>

<span data-ttu-id="2ed3b-570">Conforme mostrado na figura anterior, o emparelhamento privado de ExpressRoute fornece uma conexão direta entre sua rede local e de rede virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-570">As shown in the preceding figure, ExpressRoute private peering provides a direct connection between your on-premises network and the Azure virtual network.</span></span> <span data-ttu-id="2ed3b-571">O tráfego transmite apenas a rede do provedor de serviços e a rede do Microsoft Azure, nunca em contato com a Internet.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-571">Traffic transits only the service provider network and the Microsoft Azure network, never touching the Internet.</span></span>

> [!TIP]
> <span data-ttu-id="2ed3b-572">Usar o ExpressRoute mantém o tráfego de rede corporativa fora da Internet.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-572">Using ExpressRoute keeps corporate network traffic off the Internet.</span></span> <span data-ttu-id="2ed3b-573">Ele também permite SLAs do seu provedor do ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-573">It also allows for service level agreements from your ExpressRoute provider.</span></span> <span data-ttu-id="2ed3b-574">O Gateway do Azure pode passar até 10 Gbps com o ExpressRoute, enquanto com VPNs site a site, a taxa de transferência máxima do Gateway do Azure é de 200 Mbps.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-574">The Azure Gateway can pass up to 10 Gbps with ExpressRoute, whereas with site-to-site VPNs, the Azure Gateway maximum throughput is 200 Mbps.</span></span>
>
>

<span data-ttu-id="2ed3b-575">Conforme mostrado no diagrama abaixo, com essa opção, o ambiente agora tem duas bordas de rede.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-575">As seen in the following diagram, with this option the environment now has two network edges.</span></span> <span data-ttu-id="2ed3b-576">A NVA e NSG controlam fluxos de tráfego para redes internas do Azure e entre o Azure e a Internet, enquanto o gateway é uma borda de rede separada e isolada entre locais e o Azure.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-576">The NVA and NSG control traffic flows for intra-Azure networks and between Azure and the Internet, while the gateway is a separate and isolated network edge between on-premises and Azure.</span></span>

<span data-ttu-id="2ed3b-577">Os fluxos de tráfego devem ser considerados com cuidado, já que podem ser otimizados ou degradados por esse padrão de design dependendo do caso de uso específico.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-577">Traffic flows should be considered carefully, as they can be optimized or degraded by this design pattern, depending on the specific use case.</span></span>

<span data-ttu-id="2ed3b-578">Usar o ambiente criado no exemplo 1 e então adicionar uma conexão de rede híbrida de ExpressRoute gera o design a seguir:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-578">Using the environment built in example 1, and then adding an ExpressRoute hybrid network connection, produces the following design:</span></span>

<span data-ttu-id="2ed3b-579">[![17]][17]</span><span class="sxs-lookup"><span data-stu-id="2ed3b-579">[![17]][17]</span></span>

#### <a name="conclusion"></a><span data-ttu-id="2ed3b-580">Conclusão</span><span class="sxs-lookup"><span data-stu-id="2ed3b-580">Conclusion</span></span>
<span data-ttu-id="2ed3b-581">A adição de uma conexão de rede de emparelhamento privado de ExpressRoute pode estender a rede local para o Azure de forma segura, com baixa latência e alto desempenho.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-581">The addition of an ExpressRoute Private Peering network connection can extend the on-premises network into Azure in a secure, lower latency, higher performing manner.</span></span> <span data-ttu-id="2ed3b-582">Além disso, o uso de Gateway do Azure nativo, como visto neste exemplo, fornece uma opção de menor custo (sem licenciamento adicional nem NVAs de terceiros).</span><span class="sxs-lookup"><span data-stu-id="2ed3b-582">Also, using the native Azure Gateway, as in this example, provides a lower-cost option (no additional licensing as with third-party NVAs).</span></span> <span data-ttu-id="2ed3b-583">Para obter mais informações, consulte as instruções detalhadas de build (próximo).</span><span class="sxs-lookup"><span data-stu-id="2ed3b-583">For more information, see the detailed build instructions (forthcoming).</span></span> <span data-ttu-id="2ed3b-584">Essas instruções incluem:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-584">These instructions include:</span></span>

* <span data-ttu-id="2ed3b-585">Como criar essa rede de perímetro de exemplo com scripts do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-585">How to build this example perimeter network with PowerShell scripts.</span></span>
* <span data-ttu-id="2ed3b-586">Como criar esse exemplo com um modelo do Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-586">How to build this example with an Azure Resource Manager template.</span></span>
* <span data-ttu-id="2ed3b-587">Cenários de fluxo de tráfego detalhados mostrando como o tráfego flui através desse design.</span><span class="sxs-lookup"><span data-stu-id="2ed3b-587">Detailed traffic flow scenarios, showing how traffic flows through this design.</span></span>

## <a name="references"></a><span data-ttu-id="2ed3b-588">Referências</span><span class="sxs-lookup"><span data-stu-id="2ed3b-588">References</span></span>
### <a name="helpful-websites-and-documentation"></a><span data-ttu-id="2ed3b-589">Sites úteis e documentação</span><span class="sxs-lookup"><span data-stu-id="2ed3b-589">Helpful websites and documentation</span></span>
* <span data-ttu-id="2ed3b-590">Acesse o Azure com o Azure Resource Manager:</span><span class="sxs-lookup"><span data-stu-id="2ed3b-590">Access Azure with Azure Resource Manager:</span></span>
* <span data-ttu-id="2ed3b-591">Acessando o Azure com o PowerShell: [https://docs.microsoft.com/powershell/azureps-cmdlets-docs/](/powershell/azure/overview)</span><span class="sxs-lookup"><span data-stu-id="2ed3b-591">Accessing Azure with PowerShell: [https://docs.microsoft.com/powershell/azureps-cmdlets-docs/](/powershell/azure/overview)</span></span>
* <span data-ttu-id="2ed3b-592">Documentação de rede virtual: [https://docs.microsoft.com/azure/virtual-network/](https://docs.microsoft.com/azure/virtual-network/)</span><span class="sxs-lookup"><span data-stu-id="2ed3b-592">Virtual networking documentation: [https://docs.microsoft.com/azure/virtual-network/](https://docs.microsoft.com/azure/virtual-network/)</span></span>
* <span data-ttu-id="2ed3b-593">Documentação do grupo de segurança de rede: [https://docs.microsoft.com/azure/virtual-network/virtual-networks-nsg](virtual-network/virtual-networks-nsg.md)</span><span class="sxs-lookup"><span data-stu-id="2ed3b-593">Network security group documentation: [https://docs.microsoft.com/azure/virtual-network/virtual-networks-nsg](virtual-network/virtual-networks-nsg.md)</span></span>
* <span data-ttu-id="2ed3b-594">Documentação do roteamento definido pelo usuário: [https://docs.microsoft.com/azure/virtual-network/virtual-networks-udr-overview](virtual-network/virtual-networks-udr-overview.md)</span><span class="sxs-lookup"><span data-stu-id="2ed3b-594">User-defined routing documentation: [https://docs.microsoft.com/azure/virtual-network/virtual-networks-udr-overview](virtual-network/virtual-networks-udr-overview.md)</span></span>
* <span data-ttu-id="2ed3b-595">Gateways virtuais do Azure: [https://docs.microsoft.com/azure/vpn-gateway/](https://docs.microsoft.com/azure/vpn-gateway/)</span><span class="sxs-lookup"><span data-stu-id="2ed3b-595">Azure virtual gateways: [https://docs.microsoft.com/azure/vpn-gateway/](https://docs.microsoft.com/azure/vpn-gateway/)</span></span>
* <span data-ttu-id="2ed3b-596">VPNs Site a Site: [https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-create-site-to-site-rm-powershell](vpn-gateway/vpn-gateway-create-site-to-site-rm-powershell.md)</span><span class="sxs-lookup"><span data-stu-id="2ed3b-596">Site-to-Site VPNs: [https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-create-site-to-site-rm-powershell](vpn-gateway/vpn-gateway-create-site-to-site-rm-powershell.md)</span></span>
* <span data-ttu-id="2ed3b-597">Documentação da ExpressRoute (não deixe de conferir as seções "Introdução" e "Tutoriais"): [https://docs.microsoft.com/azure/expressroute/](https://docs.microsoft.com/azure/expressroute/)</span><span class="sxs-lookup"><span data-stu-id="2ed3b-597">ExpressRoute documentation (be sure to check out the “Getting Started” and “How To” sections): [https://docs.microsoft.com/azure/expressroute/](https://docs.microsoft.com/azure/expressroute/)</span></span>

<!--Image References-->
<span data-ttu-id="2ed3b-598">[0]: ./media/best-practices-network-security/flowchart.png "Fluxograma de opções de segurança"</span><span class="sxs-lookup"><span data-stu-id="2ed3b-598">[0]: ./media/best-practices-network-security/flowchart.png "Security Options Flowchart"</span></span>
<span data-ttu-id="2ed3b-599">[2]: ./media/best-practices-network-security/azuresecurityfeatures.png "Recursos de segurança do Azure"</span><span class="sxs-lookup"><span data-stu-id="2ed3b-599">[2]: ./media/best-practices-network-security/azuresecurityfeatures.png "Azure Security Features"</span></span>
<span data-ttu-id="2ed3b-600">[3]: ./media/best-practices-network-security/dmzcorporate.png "Uma DMZ em uma rede corporativa"</span><span class="sxs-lookup"><span data-stu-id="2ed3b-600">[3]: ./media/best-practices-network-security/dmzcorporate.png "A DMZ in a Corporate network"</span></span>
<span data-ttu-id="2ed3b-601">[4]: ./media/best-practices-network-security/azuresecurityarchitecture.png "Arquitetura de segurança do Azure"</span><span class="sxs-lookup"><span data-stu-id="2ed3b-601">[4]: ./media/best-practices-network-security/azuresecurityarchitecture.png "Azure Security Architecture"</span></span>
<span data-ttu-id="2ed3b-602">[5]: ./media/best-practices-network-security/dmzazure.png "Uma DMZ em uma Rede Virtual do Azure"</span><span class="sxs-lookup"><span data-stu-id="2ed3b-602">[5]: ./media/best-practices-network-security/dmzazure.png "A DMZ in an Azure Virtual Network"</span></span>
<span data-ttu-id="2ed3b-603">[6]: ./media/best-practices-network-security/dmzhybrid.png "Rede híbrida com três limites de segurança"</span><span class="sxs-lookup"><span data-stu-id="2ed3b-603">[6]: ./media/best-practices-network-security/dmzhybrid.png "Hybrid Network with Three Security Boundaries"</span></span>
<span data-ttu-id="2ed3b-604">[7]: ./media/best-practices-network-security/example1design.png "DMZ de entrada com NSG"</span><span class="sxs-lookup"><span data-stu-id="2ed3b-604">[7]: ./media/best-practices-network-security/example1design.png "Inbound DMZ with NSG"</span></span>
<span data-ttu-id="2ed3b-605">[8]: ./media/best-practices-network-security/example2design.png "DMZ de entrada com NVA e NSG"</span><span class="sxs-lookup"><span data-stu-id="2ed3b-605">[8]: ./media/best-practices-network-security/example2design.png "Inbound DMZ with NVA and NSG"</span></span>
<span data-ttu-id="2ed3b-606">[9]: ./media/best-practices-network-security/example3design.png "DMZ bidirecional com NVA, NSG e UDR"</span><span class="sxs-lookup"><span data-stu-id="2ed3b-606">[9]: ./media/best-practices-network-security/example3design.png "Bi-directional DMZ with NVA, NSG, and UDR"</span></span>
<span data-ttu-id="2ed3b-607">[10]: ./media/best-practices-network-security/example3firewalllogical.png "Exibição lógica das regras de firewall"</span><span class="sxs-lookup"><span data-stu-id="2ed3b-607">[10]: ./media/best-practices-network-security/example3firewalllogical.png "Logical View of the Firewall Rules"</span></span>
<span data-ttu-id="2ed3b-608">[11]: ./media/best-practices-network-security/example3designoptions.png "DMZ com rede híbrida conectada com NVA"</span><span class="sxs-lookup"><span data-stu-id="2ed3b-608">[11]: ./media/best-practices-network-security/example3designoptions.png "DMZ with NVA Connected Hybrid Network"</span></span>
<span data-ttu-id="2ed3b-609">[12]: ./media/best-practices-network-security/example4designs2s.png "DMZ com NVA conectado usando VPN site a site"</span><span class="sxs-lookup"><span data-stu-id="2ed3b-609">[12]: ./media/best-practices-network-security/example4designs2s.png "DMZ with NVA Connected Using a Site-to-Site VPN"</span></span>
<span data-ttu-id="2ed3b-610">[13]: ./media/best-practices-network-security/example4networklogical.png "Rede lógica da perspectiva de NVA"</span><span class="sxs-lookup"><span data-stu-id="2ed3b-610">[13]: ./media/best-practices-network-security/example4networklogical.png "Logical Network from NVA Perspective"</span></span>
<span data-ttu-id="2ed3b-611">[14]: ./media/best-practices-network-security/example5designoptions.png "DMZ com rede híbrida site a site conectada ao Gateway do Azure"</span><span class="sxs-lookup"><span data-stu-id="2ed3b-611">[14]: ./media/best-practices-network-security/example5designoptions.png "DMZ with Azure Gateway Connected Site-to-Site Hybrid Network"</span></span>
<span data-ttu-id="2ed3b-612">[15]: ./media/best-practices-network-security/example5designs2s.png "DMZ com Gateway do Azure usando VPN site a site"</span><span class="sxs-lookup"><span data-stu-id="2ed3b-612">[15]: ./media/best-practices-network-security/example5designs2s.png "DMZ with Azure Gateway Using Site-to-Site VPN"</span></span>
<span data-ttu-id="2ed3b-613">[16]: ./media/best-practices-network-security/example6designoptions.png "DMZ com rede híbrida da ExpressRoute conectada ao Gateway do Azure"</span><span class="sxs-lookup"><span data-stu-id="2ed3b-613">[16]: ./media/best-practices-network-security/example6designoptions.png "DMZ with Azure Gateway Connected ExpressRoute Hybrid Network"</span></span>
<span data-ttu-id="2ed3b-614">[17]: ./media/best-practices-network-security/example6designexpressroute.png "DMZ com Gateway do Azure usando uma conexão ExpressRoute"</span><span class="sxs-lookup"><span data-stu-id="2ed3b-614">[17]: ./media/best-practices-network-security/example6designexpressroute.png "DMZ with Azure Gateway Using an ExpressRoute Connection"</span></span>

<!--Link References-->
[TrustCenter]: https://azure.microsoft.com/support/trust-center/compliance/
[Example1]: ./virtual-network/virtual-networks-dmz-nsg.md
[Example2]: ./virtual-network/virtual-networks-dmz-nsg-fw-asm.md
[Example3]: ./virtual-network/virtual-networks-dmz-nsg-fw-udr-asm.md
[Example4]: ./virtual-network/virtual-networks-hybrid-s2s-nva-asm.md
[Example5]: ./virtual-network/virtual-networks-hybrid-s2s-agw-asm.md
[Example6]: ./virtual-network/virtual-networks-hybrid-expressroute-asm.md
[Example7]: ./virtual-network/virtual-networks-vnet2vnet-direct-asm.md
[Example8]: ./virtual-network/virtual-networks-vnet2vnet-transit-asm.md
