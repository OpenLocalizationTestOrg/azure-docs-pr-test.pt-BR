---
title: "Práticas recomendadas para dimensionamento automático | Microsoft Docs"
description: "Padrões de dimensionamento automático no Azure para Aplicativos Web, conjuntos de Dimensionamento de Máquina Virtual e Serviços de Nuvem"
author: anirudhcavale
manager: orenr
editor: 
services: monitoring-and-diagnostics
documentationcenter: monitoring-and-diagnostics
ms.assetid: 9fa2b94b-dfa5-4106-96ff-74fd1fba4657
ms.service: monitoring-and-diagnostics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/07/2017
ms.author: ancav
ms.openlocfilehash: 54dad831287376db7fb2dc46e4591be1499dc072
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/03/2017
---
# <a name="best-practices-for-autoscale"></a><span data-ttu-id="1d6cb-103">Práticas recomendadas para Dimensionamento Automático</span><span class="sxs-lookup"><span data-stu-id="1d6cb-103">Best practices for Autoscale</span></span>
<span data-ttu-id="1d6cb-104">Este artigo ensina práticas recomendadas para o dimensionamento automático no Azure.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-104">This article teaches best practices to autoscale in Azure.</span></span> <span data-ttu-id="1d6cb-105">O dimensionamento automático do Azure Monitor aplica-se somente aos [Conjuntos de Dimensionamento da Máquina Virtual](https://azure.microsoft.com/services/virtual-machine-scale-sets/), [Serviços de Nuvem](https://azure.microsoft.com/services/cloud-services/) e [Serviço de Aplicativo - Aplicativos Web](https://azure.microsoft.com/services/app-service/web/).</span><span class="sxs-lookup"><span data-stu-id="1d6cb-105">Azure Monitor autoscale applies only to [Virtual Machine Scale Sets](https://azure.microsoft.com/services/virtual-machine-scale-sets/), [Cloud Services](https://azure.microsoft.com/services/cloud-services/), and [App Service - Web Apps](https://azure.microsoft.com/services/app-service/web/).</span></span> <span data-ttu-id="1d6cb-106">Outros serviços do Azure usam métodos de dimensionamento diferentes.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-106">Other Azure services use different scaling methods.</span></span>

## <a name="autoscale-concepts"></a><span data-ttu-id="1d6cb-107">Conceitos de dimensionamento automático</span><span class="sxs-lookup"><span data-stu-id="1d6cb-107">Autoscale concepts</span></span>
* <span data-ttu-id="1d6cb-108">Um recurso pode ter apenas *uma* configuração de Dimensionamento Automático</span><span class="sxs-lookup"><span data-stu-id="1d6cb-108">A resource can have only *one* autoscale setting</span></span>
* <span data-ttu-id="1d6cb-109">Uma configuração de Dimensionamento Automático pode ter um ou mais perfis e cada perfil pode ter uma ou mais regras de dimensionamento automático.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-109">An autoscale setting can have one or more profiles and each profile can have one or more autoscale rules.</span></span>
* <span data-ttu-id="1d6cb-110">Uma configuração de dimensionamento automático dimensiona instâncias horizontalmente, que é *escalar* ao aumentar as instâncias e *reduzir* ao diminuir o número de instâncias.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-110">An autoscale setting scales instances horizontally, which is *out* by increasing the instances and *in* by decreasing the number of instances.</span></span>
  <span data-ttu-id="1d6cb-111">Uma configuração de dimensionamento automático tem um valor máximo, mínimo e padrão de instâncias.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-111">An autoscale setting has a maximum, minimum, and default value of instances.</span></span>
* <span data-ttu-id="1d6cb-112">Um trabalho de dimensionamento automático sempre lê a métrica associada para expandir, verificando se ele ultrapassou o limite configurado para escalar ou reduzir horizontalmente.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-112">An autoscale job always reads the associated metric to scale by, checking if it has crossed the configured threshold for scale-out or scale-in.</span></span> <span data-ttu-id="1d6cb-113">Você pode exibir uma lista de métricas que o dimensionamento automático pode dimensionar em [métricas comuns de dimensionamento automático do Azure Monitor](insights-autoscale-common-metrics.md).</span><span class="sxs-lookup"><span data-stu-id="1d6cb-113">You can view a list of metrics that autoscale can scale by at [Azure Monitor autoscaling common metrics](insights-autoscale-common-metrics.md).</span></span>
* <span data-ttu-id="1d6cb-114">Todos os limites são calculados em um nível de instância.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-114">All thresholds are calculated at an instance level.</span></span> <span data-ttu-id="1d6cb-115">Por exemplo, "escalar horizontalmente por 1 instância quando a média da CPU > 80% quando a contagem de instâncias for 2" significa escalar horizontalmente quando a média da CPU em todas as instâncias for maior que 80%.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-115">For example, "scale out by 1 instance when average CPU > 80% when instance count is 2", means scale-out when the average CPU across all instances is greater than 80%.</span></span>
* <span data-ttu-id="1d6cb-116">Você sempre receberá notificações de falha via email.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-116">You always receive failure notifications via email.</span></span> <span data-ttu-id="1d6cb-117">Especificamente o proprietário, o colaborador e os leitores do recurso de destino receberão email.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-117">Specifically, the owner, contributor, and readers of the target resource receive email.</span></span> <span data-ttu-id="1d6cb-118">Você também receberá um email de *recuperação* quando o dimensionamento automático se recuperar de uma falha e iniciar o funcionamento normalmente.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-118">You also always receive a *recovery* email when autoscale recovers from a failure and starts functioning normally.</span></span>
* <span data-ttu-id="1d6cb-119">Você pode optar por receber uma notificação de ação de escala com êxito por meio de email e ganchos.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-119">You can opt-in to receive a successful scale action notification via email and webhooks.</span></span>

## <a name="autoscale-best-practices"></a><span data-ttu-id="1d6cb-120">Práticas recomendadas de dimensionamento automático</span><span class="sxs-lookup"><span data-stu-id="1d6cb-120">Autoscale best practices</span></span>
<span data-ttu-id="1d6cb-121">Use as seguintes práticas recomendadas ao usar o dimensionamento automático.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-121">Use the following best practices as you use autoscale.</span></span>

### <a name="ensure-the-maximum-and-minimum-values-are-different-and-have-an-adequate-margin-between-them"></a><span data-ttu-id="1d6cb-122">Verifique se os valores mínimo e máximo são diferentes e têm uma margem suficiente entre eles</span><span class="sxs-lookup"><span data-stu-id="1d6cb-122">Ensure the maximum and minimum values are different and have an adequate margin between them</span></span>
<span data-ttu-id="1d6cb-123">Se você tiver uma configuração que tenha no máximo = 2, mínimo = 2 e atual contagem de instâncias for 2, nenhuma ação de escala poderá ocorrer.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-123">If you have a setting that has minimum=2, maximum=2 and the current instance count is 2, no scale action can occur.</span></span> <span data-ttu-id="1d6cb-124">Mantenha uma margem suficiente entre as contagens de instância máxima e mínima, que são inclusivas.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-124">Keep an adequate margin between the maximum and minimum instance counts, which are inclusive.</span></span> <span data-ttu-id="1d6cb-125">O dimensionamento automático sempre dimensiona dentro desses limites.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-125">Autoscale always scales between these limits.</span></span>

### <a name="manual-scaling-is-reset-by-autoscale-min-and-max"></a><span data-ttu-id="1d6cb-126">O redimensionamento manual é redefinido pelo máximo e pelo mínimo do dimensionamento automático</span><span class="sxs-lookup"><span data-stu-id="1d6cb-126">Manual scaling is reset by autoscale min and max</span></span>
<span data-ttu-id="1d6cb-127">Se você atualizar manualmente a contagem de instâncias para um valor acima ou abaixo do máximo, o mecanismo de dimensionamento automático dimensionará novamente para o mínimo (se estiver abaixo) ou máximo (se estiver acima) automaticamente.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-127">If you manually update the instance count to a value above or below the maximum, the autoscale engine automatically scales back to the minimum (if below) or the maximum (if above).</span></span> <span data-ttu-id="1d6cb-128">Por exemplo, você pode definir o intervalo entre 3 e 6.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-128">For example, you set the range between 3 and 6.</span></span> <span data-ttu-id="1d6cb-129">Se você tiver uma instância em execução, o mecanismo de dimensionamento automático dimensionará para 3 instâncias na sua próxima execução.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-129">If you have one running instance, the autoscale engine scales to 3 instances on its next run.</span></span> <span data-ttu-id="1d6cb-130">Da mesma forma, ele reduziria 8 instâncias para 6 na sua próxima execução.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-130">Likewise, it would scale-in 8 instances back to 6 on its next run.</span></span>  <span data-ttu-id="1d6cb-131">O redimensionamento manual é muito temporário, a menos que você também redefina as regras de dimensionamento automático.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-131">Manual scaling is very temporary unless you reset the autoscale rules as well.</span></span>

### <a name="always-use-a-scale-out-and-scale-in-rule-combination-that-performs-an-increase-and-decrease"></a><span data-ttu-id="1d6cb-132">Sempre use uma combinação de regras de escala e redução horizontal que executa um aumento e uma redução</span><span class="sxs-lookup"><span data-stu-id="1d6cb-132">Always use a scale-out and scale-in rule combination that performs an increase and decrease</span></span>
<span data-ttu-id="1d6cb-133">Se você usar apenas uma parte da combinação, o dimensionamento automático reduzirá horizontalmente a única redução ou escala, até que o máximo ou o mínimo seja alcançado.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-133">If you use only one part of the combination, autoscale scale-in that single out, or in, until the maximum, or minimum, is reached.</span></span>

### <a name="do-not-switch-between-the-azure-portal-and-the-azure-classic-portal-when-managing-autoscale"></a><span data-ttu-id="1d6cb-134">Não alternar entre o portal do Azure e o portal clássico do Azure ao gerenciar o dimensionamento automático</span><span class="sxs-lookup"><span data-stu-id="1d6cb-134">Do not switch between the Azure portal and the Azure classic portal when managing Autoscale</span></span>
<span data-ttu-id="1d6cb-135">Para Serviços de Nuvem e Serviços de Aplicativos (Aplicativos Web), use o portal do Azure (portal.azure.com) para criar e gerenciar configurações de dimensionamento automático.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-135">For Cloud Services and App Services (Web Apps), use the Azure portal (portal.azure.com) to create and manage autoscale settings.</span></span> <span data-ttu-id="1d6cb-136">Para Conjuntos de Escala de Máquina Virtual, use o PowerShell, CLI ou API REST para criar e gerenciar a configuração de dimensionamento automático.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-136">For Virtual Machine Scale Sets use PowerShell, CLI or REST API to create and manage autoscale setting.</span></span> <span data-ttu-id="1d6cb-137">Não alterne entre o portal clássico do Azure (manage.windowsazure.com) e o portal do Azure (portal.azure.com) ao gerenciar as configurações de dimensionamento automático.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-137">Do not switch between the Azure classic portal (manage.windowsazure.com) and the Azure portal (portal.azure.com) when managing autoscale configurations.</span></span> <span data-ttu-id="1d6cb-138">O portal clássico do Azure e seu back-end subjacente têm limitações.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-138">The Azure classic portal and its underlying backend has limitations.</span></span> <span data-ttu-id="1d6cb-139">Mova para o portal do Azure para gerenciar o dimensionamento automático usando a interface gráfica do usuário.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-139">Move to the Azure portal to manage autoscale using a graphical user interface.</span></span> <span data-ttu-id="1d6cb-140">As opções são usar Autoscale PowerShell, CLI ou API REST (por meio do Gerenciador de Recursos do Azure).</span><span class="sxs-lookup"><span data-stu-id="1d6cb-140">The options are to use the autoscale PowerShell, CLI or REST API (via Azure Resource Explorer).</span></span>

### <a name="choose-the-appropriate-statistic-for-your-diagnostics-metric"></a><span data-ttu-id="1d6cb-141">Escolher a estatística apropriada para sua métrica de diagnóstico</span><span class="sxs-lookup"><span data-stu-id="1d6cb-141">Choose the appropriate statistic for your diagnostics metric</span></span>
<span data-ttu-id="1d6cb-142">Para métricas de diagnóstico, você pode escolher entre *Média*, *Mínimo*, *Máximo* e *Total* como uma métrica para expandir.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-142">For diagnostics metrics, you can choose among *Average*, *Minimum*, *Maximum* and *Total* as a metric to scale by.</span></span> <span data-ttu-id="1d6cb-143">A estatística mais comum é *Média*.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-143">The most common statistic is *Average*.</span></span>

### <a name="choose-the-thresholds-carefully-for-all-metric-types"></a><span data-ttu-id="1d6cb-144">Escolha os limites cuidadosamente para todos os tipos de métrica</span><span class="sxs-lookup"><span data-stu-id="1d6cb-144">Choose the thresholds carefully for all metric types</span></span>
<span data-ttu-id="1d6cb-145">Recomendamos escolher cuidadosamente limites diferentes para escalar e reduzir horizontalmente com base em situações práticas.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-145">We recommend carefully choosing different thresholds for scale-out and scale-in based on practical situations.</span></span>

<span data-ttu-id="1d6cb-146">*Não recomendamos* as configurações de dimensionamento automático como os exemplos abaixo com os valores de limite igual ou muito semelhante para condições de redução e escala:</span><span class="sxs-lookup"><span data-stu-id="1d6cb-146">We *do not recommend* autoscale settings like the examples below with the same or very similar threshold values for out and in conditions:</span></span>

* <span data-ttu-id="1d6cb-147">Aumentar as instâncias por contagem de 1 quando a Contagem de Threads < = 600</span><span class="sxs-lookup"><span data-stu-id="1d6cb-147">Increase instances by 1 count when Thread Count <= 600</span></span>
* <span data-ttu-id="1d6cb-148">Reduzir as instâncias por contagem de 1 quando a Contagem de Threads >= 600</span><span class="sxs-lookup"><span data-stu-id="1d6cb-148">Decrease instances by 1 count when Thread Count >= 600</span></span>

<span data-ttu-id="1d6cb-149">Vejamos um exemplo de como o que pode levar a um comportamento que possa parecer confuso.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-149">Let's look at an example of what can lead to a behavior that may seem confusing.</span></span> <span data-ttu-id="1d6cb-150">Considere a sequência a seguir.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-150">Consider the following sequence.</span></span>

1. <span data-ttu-id="1d6cb-151">Suponha que há 2 instâncias para começar e, em seguida, o número médio de threads por instância aumenta para 625.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-151">Assume there are 2 instances to begin with and then the average number of threads per instance grows to 625.</span></span>
2. <span data-ttu-id="1d6cb-152">O dimensionamento automático escala horizontalmente uma terceira instância.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-152">Autoscale scales out adding a 3rd instance.</span></span>
3. <span data-ttu-id="1d6cb-153">Em seguida, suponha que a contagem média de threads entre a instância seja de 575.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-153">Next, assume that the average thread count across instance falls to 575.</span></span>
4. <span data-ttu-id="1d6cb-154">Antes de reduzir verticalmente, o dimensionamento automático tenta estimar como será o estado final de ele for reduzido horizontalmente.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-154">Before scaling down, autoscale tries to estimate what the final state will be if it scaled in.</span></span> <span data-ttu-id="1d6cb-155">Por exemplo, 575 x 3 (contagem de instância atual) = 1.725 / 2 (número final de instâncias quando reduzido verticalmente) = 862.5 threads.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-155">For example, 575 x  3 (current instance count) = 1,725 / 2 (final number of instances when scaled down) = 862.5 threads.</span></span> <span data-ttu-id="1d6cb-156">Isso significa que o dimensionamento automático terá que imediatamente escalar horizontalmente novamente mesmo depois de ter sido reduzido horizontalmente, se a contagem média de threads permanecer a mesma ou tiver apenas uma pequena quantidade reduzida.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-156">This means autoscale would have to immediately scale-out again even after it scaled in, if the average thread count remains the same or even falls only a small amount.</span></span> <span data-ttu-id="1d6cb-157">No entanto, se escalado verticalmente novamente, todo o processo se repetiria, resultando em um loop infinito.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-157">However, if it scaled up again, the whole process would repeat, leading to an infinite loop.</span></span>
5. <span data-ttu-id="1d6cb-158">Para evitar essa situação (conhecida como “flapping”), o dimensionamento automático não reduz verticalmente.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-158">To avoid this situation (termed "flapping"), autoscale does not scale down at all.</span></span> <span data-ttu-id="1d6cb-159">Em vez disso, ele ignora e reavalia a condição novamente na próxima vez em que executa trabalho do serviço.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-159">Instead, it skips and reevaluates the condition again the next time the service's job executes.</span></span> <span data-ttu-id="1d6cb-160">Isso poderia confundir muitas pessoas porque o Dimensionamento Automático não funcionaria quando a contagem média de threads fosse 575.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-160">This could confuse many people because autoscale wouldn't appear to work when the average thread count was 575.</span></span>

<span data-ttu-id="1d6cb-161">A estimativa durante uma redução serve para evitar situações de "oscilação", em que as ações de redução e expansão variam continuamente.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-161">Estimation during a scale-in is intended to avoid "flapping" situations, where scale-in and scale-out actions continually go back and forth.</span></span> <span data-ttu-id="1d6cb-162">Lembre-se desse comportamento ao escolher os mesmos limites de redução e expansão.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-162">Keep this behavior in mind when you choose the same thresholds for scale-out and in.</span></span>

<span data-ttu-id="1d6cb-163">Recomendamos escolher uma margem suficiente entre os limites de redução e escala horizontal.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-163">We recommend choosing an adequate margin between the scale-out and in thresholds.</span></span> <span data-ttu-id="1d6cb-164">Por exemplo, considere a seguinte combinação de melhor regra.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-164">As an example, consider the following better rule combination.</span></span>

* <span data-ttu-id="1d6cb-165">Aumentar as instâncias por contagem de 1 quando CPU% >= 80</span><span class="sxs-lookup"><span data-stu-id="1d6cb-165">Increase instances by 1 count when CPU%  >= 80</span></span>
* <span data-ttu-id="1d6cb-166">Reduzir as instâncias por contagem de 1 quando CPU% <= 60</span><span class="sxs-lookup"><span data-stu-id="1d6cb-166">Decrease instances by 1 count when CPU% <= 60</span></span>

<span data-ttu-id="1d6cb-167">Nesse caso</span><span class="sxs-lookup"><span data-stu-id="1d6cb-167">In this case</span></span>  

1. <span data-ttu-id="1d6cb-168">Suponha que há 2 instâncias para começar.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-168">Assume there are 2 instances to start with.</span></span>
2. <span data-ttu-id="1d6cb-169">Se a porcentagem média de CPU entre instâncias for até 80, o dimensionamento automático escalará horizontalmente, adicionando uma terceira instância.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-169">If the average CPU% across instances goes to 80, autoscale scales out adding a third instance.</span></span>
3. <span data-ttu-id="1d6cb-170">Agora suponha que, ao longo do tempo, o percentual de CPU caia para 60.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-170">Now assume that over time the CPU% falls to 60.</span></span>
4. <span data-ttu-id="1d6cb-171">A regra de redução horizontal do dimensionamento automático estimaria o estado final se fosse necessário fazer a redução horizontal.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-171">Autoscale's scale-in rule estimates the final state if it were to scale-in.</span></span> <span data-ttu-id="1d6cb-172">Por exemplo, 60 x 3 (contagem de instância atual) = 180 / 2 (número final de instâncias quando reduzido verticalmente) = 90 threads.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-172">For example, 60 x 3 (current instance count) = 180 / 2 (final number of instances when scaled down) = 90.</span></span> <span data-ttu-id="1d6cb-173">Portanto, o dimensionamento automático não reduz horizontalmente, pois ele teria que escalar horizontalmente novamente imediatamente.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-173">So autoscale does not scale-in because it would have to scale-out again immediately.</span></span> <span data-ttu-id="1d6cb-174">Em vez disso, ele ignora a redução vertical.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-174">Instead, it skips scaling down.</span></span>
5. <span data-ttu-id="1d6cb-175">Na próxima verificação do dimensionamento automático, a CPU continuará a cair para 50.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-175">The next time autoscale checks, the CPU continues to fall to 50.</span></span> <span data-ttu-id="1d6cb-176">Ele estima novamente - instância de 3 x 50 = 150 / 2 instâncias = 75, que está abaixo do limite de escala horizontal de 80, portanto ele reduz horizontalmente para que ele é dimensionado em com êxito para 2 instâncias.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-176">It estimates again -  50 x 3 instance = 150 / 2 instances = 75, which is below the scale-out threshold of 80, so it scales in successfully to 2 instances.</span></span>

### <a name="considerations-for-scaling-threshold-values-for-special-metrics"></a><span data-ttu-id="1d6cb-177">Considerações sobre valores de dimensionamento de limite para métricas especiais</span><span class="sxs-lookup"><span data-stu-id="1d6cb-177">Considerations for scaling threshold values for special metrics</span></span>
 <span data-ttu-id="1d6cb-178">Para métricas especiais, como a métrica do comprimento da Fila do Barramento de Serviço ou de Armazenamento, o limite é o número médio de mensagens disponíveis por número atual de instâncias.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-178">For special metrics such as Storage or Service Bus Queue length metric, the threshold is the average number of messages available per current number of instances.</span></span> <span data-ttu-id="1d6cb-179">Opte por escolher cuidadosamente o valor de limite para esta métrica.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-179">Carefully choose the choose the threshold value for this metric.</span></span>

<span data-ttu-id="1d6cb-180">Vamos ilustrá-lo com um exemplo para que entender o comportamento melhor.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-180">Let's illustrate it with an example to ensure you understand the behavior better.</span></span>

* <span data-ttu-id="1d6cb-181">Aumentar o número de instâncias por contagem de 1 quando a contagem de mensagem de Fila de Armazenamento > = 50</span><span class="sxs-lookup"><span data-stu-id="1d6cb-181">Increase instances by 1 count when Storage Queue message count >= 50</span></span>
* <span data-ttu-id="1d6cb-182">Reduzir o número de instâncias por contagem 1 de contagem de mensagem de Fila de Armazenamento > = 10</span><span class="sxs-lookup"><span data-stu-id="1d6cb-182">Decrease instances by 1 count when Storage Queue message count <= 10</span></span>

<span data-ttu-id="1d6cb-183">Considere a sequência a seguir:</span><span class="sxs-lookup"><span data-stu-id="1d6cb-183">Consider the following sequence:</span></span>

1. <span data-ttu-id="1d6cb-184">Há duas instâncias de fila de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-184">There are 2 storage queue instances.</span></span>
2. <span data-ttu-id="1d6cb-185">As mensagens continuam chegando e, ao examinar a fila de armazenamento, a contagem total é de 50.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-185">Messages keep coming and when you review the storage queue, the total count reads 50.</span></span> <span data-ttu-id="1d6cb-186">Você pode pressupor que o dimensionamento automático deve iniciar uma ação de escala horizontal.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-186">You might assume that autoscale should start a scale-out action.</span></span> <span data-ttu-id="1d6cb-187">No entanto, observe que ainda é 50/2 = 25 mensagens por instância.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-187">However, note that it is still 50/2 = 25 messages per instance.</span></span> <span data-ttu-id="1d6cb-188">Portanto, a escala horizontal não ocorrerá.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-188">So, scale-out does not occur.</span></span> <span data-ttu-id="1d6cb-189">Para a primeira escala horizontal acontecer, a contagem total de mensagens na fila de armazenamento deve ser de 100.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-189">For the first scale-out to happen, the total message count in the storage queue should be 100.</span></span>
3. <span data-ttu-id="1d6cb-190">Em seguida, suponha que a contagem total de mensagens chegue a 100.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-190">Next, assume that the total message count reaches 100.</span></span>
4. <span data-ttu-id="1d6cb-191">Uma terceira instância de fila de armazenamento é adicionada devido a uma ação de escala horizontal.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-191">A 3rd storage queue instance is added due to a scale-out action.</span></span>  <span data-ttu-id="1d6cb-192">A ação de escala horizontal a seguir não ocorrerá até que a contagem total de mensagens na fila atinja 150 porque 150/3 = 50.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-192">The next scale-out action will not happen until the total message count in the queue reaches 150 because 150/3 = 50.</span></span>
5. <span data-ttu-id="1d6cb-193">Agora, o número de mensagens na fila é menor.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-193">Now the number of messages in the queue gets smaller.</span></span> <span data-ttu-id="1d6cb-194">Com três instâncias, a primeira ação de escala horizontal acontece quando o total de mensagens em todas as filas atinge 30, porque 30/3 = 10 mensagens por instância, que é o limite de redução horizontal.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-194">With 3 instances, the first scale-in action happens when the total messages in all queues add up to 30 because 30/3 = 10 messages per instance, which is the scale-in threshold.</span></span>

### <a name="considerations-for-scaling-when-multiple-profiles-are-configured-in-an-autoscale-setting"></a><span data-ttu-id="1d6cb-195">Considerações sobre dimensionamento quando vários perfis são configurados em uma configuração de dimensionamento automático</span><span class="sxs-lookup"><span data-stu-id="1d6cb-195">Considerations for scaling when multiple profiles are configured in an autoscale setting</span></span>
<span data-ttu-id="1d6cb-196">Em uma configuração de dimensionamento automático, você pode escolher um perfil padrão, que é sempre aplicado sem qualquer dependência de agenda ou hora, ou você pode escolher um perfil recorrente ou um perfil para um período fixo com um intervalo de data e hora.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-196">In an autoscale setting, you can choose a default profile, which is always applied without any dependency on schedule or time, or you can choose a recurring profile or a profile for a fixed period with a date and time range.</span></span>

<span data-ttu-id="1d6cb-197">Quando o serviço de dimensionamento automático o processar, ele sempre verifica na seguinte ordem:</span><span class="sxs-lookup"><span data-stu-id="1d6cb-197">When autoscale service processes them, it always checks in the following order:</span></span>

1. <span data-ttu-id="1d6cb-198">Perfil de Data Fixa</span><span class="sxs-lookup"><span data-stu-id="1d6cb-198">Fixed Date profile</span></span>
2. <span data-ttu-id="1d6cb-199">Perfil recorrente</span><span class="sxs-lookup"><span data-stu-id="1d6cb-199">Recurring profile</span></span>
3. <span data-ttu-id="1d6cb-200">Perfil ("Sempre") Padrão</span><span class="sxs-lookup"><span data-stu-id="1d6cb-200">Default ("Always") profile</span></span>

<span data-ttu-id="1d6cb-201">Se uma condição de perfil for atendida, o dimensionamento automático não verificará a próxima condição de perfil abaixo dele.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-201">If a profile condition is met, autoscale does not check the next profile condition below it.</span></span> <span data-ttu-id="1d6cb-202">O dimensionamento automático só processa um perfil por vez.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-202">Autoscale only processes one profile at a time.</span></span> <span data-ttu-id="1d6cb-203">Isso significa que, se você quiser incluir também uma condição de processamento de um perfil de nível inferior, você deverá incluir essas regras bem no perfil atual.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-203">This means if you want to also include a processing condition from a lower-tier profile, you must include those rules as well in the current profile.</span></span>

<span data-ttu-id="1d6cb-204">Vamos examinar isso usando um exemplo:</span><span class="sxs-lookup"><span data-stu-id="1d6cb-204">Let's review this using an example:</span></span>

<span data-ttu-id="1d6cb-205">A imagem abaixo mostra uma configuração de dimensionamento automático com um perfil padrão de instâncias mínimas = 2 e máximo de instâncias = 10.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-205">The image below shows an autoscale setting with a default profile of minimum instances = 2 and maximum instances = 10.</span></span> <span data-ttu-id="1d6cb-206">Neste exemplo, as regras são configuradas para escalar horizontalmente quando a contagem de mensagens na fila for maior que 10 e reduzir horizontalmente de quando a contagem de mensagens na fila for menor que 3.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-206">In this example, rules are configured to scale-out when the message count in the queue is greater than 10 and scale-in when the message count in the queue is less than 3.</span></span> <span data-ttu-id="1d6cb-207">Agora, o recurso pode ser dimensionado entre 2 e 10 instâncias.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-207">So now the resource can scale between 2 and 10 instances.</span></span>

<span data-ttu-id="1d6cb-208">Além disso, há um perfil recorrente para segunda-feira.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-208">In addition, there is a recurring profile set for Monday.</span></span> <span data-ttu-id="1d6cb-209">Ele é definido para instâncias mínimas = 2 e máximo de instâncias = 12.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-209">It is set for minimum instances = 2 and maximum instances = 12.</span></span> <span data-ttu-id="1d6cb-210">Isso significa que na segunda-feira, na primeira vez que o dimensionamento automático verificar essa condição, a contagem de instâncias era de 2, e ela será dimensionada para o novo mínimo de 3.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-210">This means on Monday, the first time autoscale checks for this condition, if the instance count is 2, it scales to the new minimum of 3.</span></span> <span data-ttu-id="1d6cb-211">Enquanto o dimensionamento automático continuar encontrando essa condição de perfil correspondida (segunda-feira), ele só processará as regras de redução/escala horizontal com base na CPU configuradas para esse perfil.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-211">As long as autoscale continues to find this profile condition matched (Monday), it only processes the CPU-based scale-out/in rules configured for this profile.</span></span> <span data-ttu-id="1d6cb-212">Neste momento, ele não verificará o comprimento da fila.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-212">At this time, it does not check for the queue length.</span></span> <span data-ttu-id="1d6cb-213">No entanto, se você deseja que a condição de comprimento de fila seja verificada, você deve incluir as regras do perfil padrão também em seu perfil de segunda-feira.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-213">However, if you also want the queue length condition to be checked, you should include those rules from the default profile as well in your Monday profile.</span></span>

<span data-ttu-id="1d6cb-214">Da mesma forma, quando o dimensionamento automático alternar de volta para o perfil padrão, ele primeiro verifica se as condições de mínimas e máxima são atendidas.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-214">Similarly, when autoscale switches back to the default profile, it first checks if the minimum and maximum conditions are met.</span></span> <span data-ttu-id="1d6cb-215">Se o número de instâncias no momento é 12, ele é dimensionado em 10, o máximo permitido para o perfil padrão.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-215">If the number of instances at the time is 12, it scales in to 10, the maximum allowed for the default profile.</span></span>

![configurações de dimensionamento automático](./media/insights-autoscale-best-practices/insights-autoscale-best-practices-2.png)

### <a name="considerations-for-scaling-when-multiple-rules-are-configured-in-a-profile"></a><span data-ttu-id="1d6cb-217">Considerações sobre dimensionamento quando várias regras são configuradas em um perfil</span><span class="sxs-lookup"><span data-stu-id="1d6cb-217">Considerations for scaling when multiple rules are configured in a profile</span></span>
<span data-ttu-id="1d6cb-218">Há casos em que talvez você precise definir várias regras em um perfil.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-218">There are cases where you may have to set multiple rules in a profile.</span></span> <span data-ttu-id="1d6cb-219">O seguinte conjunto de regras de dimensionamento automático é usado por serviços quando várias regras são definidas.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-219">The following set of autoscale rules are used by services use when multiple rules are set.</span></span>

<span data-ttu-id="1d6cb-220">Em *escalar horizontalmente*, o dimensionamento automático será executado se nenhuma regra for atendida.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-220">On *scale out*, autoscale runs if any rule is met.</span></span>
<span data-ttu-id="1d6cb-221">Em *reduzir horizontalmente*, o dimensionamento automático exige que todas as regras sejam atendidas.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-221">On *scale-in*, autoscale require all rules to be met.</span></span>

<span data-ttu-id="1d6cb-222">Para ilustrar, suponha que você tenha as seguintes 4 regras de dimensionamento automático:</span><span class="sxs-lookup"><span data-stu-id="1d6cb-222">To illustrate, assume that you have the following 4 autoscale rules:</span></span>

* <span data-ttu-id="1d6cb-223">Se CPU < 30%, reduza horizontalmente em 1</span><span class="sxs-lookup"><span data-stu-id="1d6cb-223">If CPU < 30 %, scale-in by 1</span></span>
* <span data-ttu-id="1d6cb-224">Se Memória < 50%, reduza horizontalmente em 1</span><span class="sxs-lookup"><span data-stu-id="1d6cb-224">If Memory < 50%, scale-in by 1</span></span>
* <span data-ttu-id="1d6cb-225">Se CPU < 75%, escale horizontalmente em 1</span><span class="sxs-lookup"><span data-stu-id="1d6cb-225">If CPU > 75%, scale-out by 1</span></span>
* <span data-ttu-id="1d6cb-226">Se Memória < 75, escale horizontalmente em 1</span><span class="sxs-lookup"><span data-stu-id="1d6cb-226">If Memory > 75%, scale-out by 1</span></span>

<span data-ttu-id="1d6cb-227">Em seguida, ocorrerá o seguinte:</span><span class="sxs-lookup"><span data-stu-id="1d6cb-227">Then the follow occurs:</span></span>

* <span data-ttu-id="1d6cb-228">Se a CPU for 76% e a Memória 50%, escalaremos horizontalmente.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-228">If CPU is 76% and Memory is 50%, we scale-out.</span></span>
* <span data-ttu-id="1d6cb-229">Se a CPU for 50% e a Memória 76%, escalaremos horizontalmente.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-229">If CPU is 50% and Memory is 76% we scale-out.</span></span>

<span data-ttu-id="1d6cb-230">Por outro lado, se a CPU é 25% e a memória é 51%, dimensionamento automático **não** será reduzido horizontalmente.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-230">On the other hand, if CPU is 25% and memory is 51% autoscale does **not** scale-in.</span></span> <span data-ttu-id="1d6cb-231">Para reduzir horizontalmente, a CPU deve ser 29% e memória 49%.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-231">In order to scale-in, CPU must be 29% and Memory 49%.</span></span>

### <a name="always-select-a-safe-default-instance-count"></a><span data-ttu-id="1d6cb-232">Sempre selecione uma contagem de instância de segurança padrão</span><span class="sxs-lookup"><span data-stu-id="1d6cb-232">Always select a safe default instance count</span></span>
<span data-ttu-id="1d6cb-233">A contagem de instâncias padrão é importante porque o dimensionamento automático dimensiona o serviço para essa contagem quando métricas não estão disponíveis.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-233">The default instance count is important autoscale scales your service to that count when metrics are not available.</span></span> <span data-ttu-id="1d6cb-234">Portanto, selecione uma contagem de instância padrão que seja segura para suas cargas de trabalho.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-234">Therefore, select a default instance count that's safe for your workloads.</span></span>

### <a name="configure-autoscale-notifications"></a><span data-ttu-id="1d6cb-235">Configurar notificações de dimensionamento automático</span><span class="sxs-lookup"><span data-stu-id="1d6cb-235">Configure autoscale notifications</span></span>
<span data-ttu-id="1d6cb-236">O dimensionamento automático notificará os administradores e os colaboradores do recurso por email se ocorrer qualquer uma das seguintes condições:</span><span class="sxs-lookup"><span data-stu-id="1d6cb-236">Autoscale notifies the administrators and contributors of the resource by email if any of the following conditions occur:</span></span>

* <span data-ttu-id="1d6cb-237">O serviço de dimensionamento automático não pode executar uma ação.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-237">autoscale service fails to take an action.</span></span>
* <span data-ttu-id="1d6cb-238">As métricas não estão disponíveis para o serviço de dimensionamento automático tomar uma decisão de escala.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-238">Metrics are not available for autoscale service to make a scale decision.</span></span>
* <span data-ttu-id="1d6cb-239">As métricas estão disponíveis (recuperação) novamente para tomar uma decisão de escala.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-239">Metrics are available (recovery) again to make a scale decision.</span></span>
  <span data-ttu-id="1d6cb-240">Além das condições acima, você pode configurar notificações por email ou webhook para obter notificações de ações de dimensionamento bem-sucedido.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-240">In addition to the conditions above, you can configure email or webhook notifications to get notified for successful scale actions.</span></span>
  
<span data-ttu-id="1d6cb-241">Você também pode usar um alerta do Log de Atividades para monitorar a integridade do mecanismo de dimensionamento automático.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-241">You can also use an Activity Log alert to monitor the health of the autoscale engine.</span></span> <span data-ttu-id="1d6cb-242">Aqui estão exemplos para [criar um Alerta de Log de Atividades para monitorar todas as operações do mecanismo de dimensionamento automático em sua assinatura](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert) ou [criar um Alerta de Log de Atividades para monitorar todas as operações de escalar horizontalmente/reduzir horizontalmente com falha na sua assinatura](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert).</span><span class="sxs-lookup"><span data-stu-id="1d6cb-242">Here are examples to [create an Activity Log Alert to monitor all autoscale engine operations on your subscription](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert) or to [create an Activity Log Alert to monitor all failed autoscale scale in/scale out operations on your subscription](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert).</span></span>

## <a name="next-steps"></a><span data-ttu-id="1d6cb-243">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="1d6cb-243">Next Steps</span></span>
- [<span data-ttu-id="1d6cb-244">Crie um Alerta de Log de Atividades para monitorar todas as operações de mecanismo de dimensionamento automático em sua assinatura.</span><span class="sxs-lookup"><span data-stu-id="1d6cb-244">Create an Activity Log Alert to monitor all autoscale engine operations on your subscription.</span></span>](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert)
- [<span data-ttu-id="1d6cb-245">Crie um Alerta de Log de Atividades para monitorar todas as operações de escalar horizontalmente/reduzir horizontalmente com falha na sua assinatura</span><span class="sxs-lookup"><span data-stu-id="1d6cb-245">Create an Activity Log Alert to monitor all failed autoscale scale in/scale out operations on your subscription</span></span>](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert)
