---
title: "Criação de modelos do Azure para soluções complexas | Microsoft Docs"
description: "Mostra as práticas recomendadas para criação de modelos do Azure Resource Manager para cenários complexos"
services: azure-resource-manager
documentationcenter: 
author: tfitzmac
manager: timlt
editor: tysonn
ms.assetid: ce1141d6-ece7-4976-acea-1db1f775409e
ms.service: azure-resource-manager
ms.workload: multiple
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/19/2016
ms.author: tomfitz
ms.openlocfilehash: dcc31f7a8c85a8f7fbd554371a66fb1e348bca17
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/03/2017
---
# <a name="design-patterns-for-azure-resource-manager-templates-when-deploying-complex-solutions"></a><span data-ttu-id="3e871-103">Padrões de design para modelos do Azure Resource Manager ao implantar soluções complexas</span><span class="sxs-lookup"><span data-stu-id="3e871-103">Design patterns for Azure Resource Manager templates when deploying complex solutions</span></span>
<span data-ttu-id="3e871-104">Usando uma abordagem flexível com base em modelos do Azure Resource Manager, você pode implantar topologias complexas de forma rápida e consistente.</span><span class="sxs-lookup"><span data-stu-id="3e871-104">Using a flexible approach based on Azure Resource Manager templates, you can deploy complex topologies quickly and consistently.</span></span> <span data-ttu-id="3e871-105">Você pode adaptar essas implantações facilmente conforme as ofertas de núcleo evoluem ou para acomodar variantes para cenários de exceção ou clientes.</span><span class="sxs-lookup"><span data-stu-id="3e871-105">You can adapt these deployments easily as core offerings evolve or to accommodate variants for outlier scenarios or customers.</span></span>

<span data-ttu-id="3e871-106">Este tópico faz parte de um whitepaper mais amplo.</span><span class="sxs-lookup"><span data-stu-id="3e871-106">This topic is part of a larger whitepaper.</span></span> <span data-ttu-id="3e871-107">Para ler o artigo completo, baixe as [Considerações e práticas comprovadas dos modelos do Azure Resource Manager da mais alta qualidade](http://download.microsoft.com/download/8/E/1/8E1DBEFA-CECE-4DC9-A813-93520A5D7CFE/World Class ARM Templates - Considerations and Proven Practices.pdf).</span><span class="sxs-lookup"><span data-stu-id="3e871-107">To read the full paper, download [World Class Azure Resource Manager Templates Considerations and Proven Practices](http://download.microsoft.com/download/8/E/1/8E1DBEFA-CECE-4DC9-A813-93520A5D7CFE/World Class ARM Templates - Considerations and Proven Practices.pdf).</span></span>

<span data-ttu-id="3e871-108">Modelos combinam os benefícios do Gerenciador de Recursos do Azure subjacente com a capacidade de adaptação e legibilidade de JSON (JavaScript Object Notation).</span><span class="sxs-lookup"><span data-stu-id="3e871-108">Templates combine the benefits of the underlying Azure Resource Manager with the adaptability and readability of JavaScript Object Notation (JSON).</span></span> <span data-ttu-id="3e871-109">Usando modelos, você pode:</span><span class="sxs-lookup"><span data-stu-id="3e871-109">Using templates, you can:</span></span>

* <span data-ttu-id="3e871-110">Implantar consistentemente topologias e suas cargas de trabalho.</span><span class="sxs-lookup"><span data-stu-id="3e871-110">Deploy topologies and their workloads consistently.</span></span>
* <span data-ttu-id="3e871-111">Gerencie todos os seus recursos em um aplicativo coletivamente usando grupos de recursos.</span><span class="sxs-lookup"><span data-stu-id="3e871-111">Manage all your resources in an application together using resource groups.</span></span>
* <span data-ttu-id="3e871-112">Aplique o RBAC (controle de acesso baseado em função) para conceder acesso apropriado aos usuários, grupos e serviços.</span><span class="sxs-lookup"><span data-stu-id="3e871-112">Apply role-based access control (RBAC) to grant appropriate access to users, groups, and services.</span></span>
* <span data-ttu-id="3e871-113">Use associações de marcação para simplificar tarefas como cobrança de valores acumulados.</span><span class="sxs-lookup"><span data-stu-id="3e871-113">Use tagging associations to streamline tasks such as billing rollups.</span></span>

<span data-ttu-id="3e871-114">Este artigo fornece detalhes sobre cenários de consumo, arquitetura e padrões de implementação identificados durante nossas sessões de design e implementações de modelos do mundo real com os clientes da AzureCAT (Azure Customer Advisory Team).</span><span class="sxs-lookup"><span data-stu-id="3e871-114">This article provides details on consumption scenarios, architecture, and implementation patterns identified during our design sessions and real-world template implementations with Azure Customer Advisory Team (AzureCAT) customers.</span></span> <span data-ttu-id="3e871-115">Longe de serem acadêmicas, essas abordagens são práticas comprovadas informadas pelo desenvolvimento de modelos para 12 das principais tecnologias de OSS baseadas em Linux, incluindo: Apache Kafka, Apache Spark, Cloudera, Couchbase, Hortonworks HDP, Enterprise DataStax da plataforma Apache Cassandra, Elasticsearch, Jenkins, MongoDB, PostgreSQL, Redis e Nagios.</span><span class="sxs-lookup"><span data-stu-id="3e871-115">Far from academic, these approaches are proven practices informed by the development of templates for 12 of the top Linux-based OSS technologies, including: Apache Kafka, Apache Spark, Cloudera, Couchbase, Hortonworks HDP, DataStax Enterprise powered by Apache Cassandra, Elasticsearch, Jenkins, MongoDB, PostgreSQL, Redis, and Nagios.</span></span> 

<span data-ttu-id="3e871-116">Este artigo compartilha essas práticas comprovadas para ajudá-lo a projetar modelos do Gerenciador de Recursos do Azure de classe mundial.</span><span class="sxs-lookup"><span data-stu-id="3e871-116">This article shares these proven practices to help you architect world class Azure Resource Manager templates.</span></span>  

<span data-ttu-id="3e871-117">Em nosso trabalho com clientes, identificamos várias experiências de consumo de modelos do Resource Manager entre empresas, SIs (integradores de sistemas) e CSVs (fornecedores de serviço de nuvem).</span><span class="sxs-lookup"><span data-stu-id="3e871-117">In our work with customers, we have identified several Resource Manager template consumption experiences across enterprises, System Integrators (SI)s, and CSVs.</span></span> <span data-ttu-id="3e871-118">As seções a seguir fornecem uma visão geral de alto nível dos cenários e padrões comuns para diferentes tipos de clientes.</span><span class="sxs-lookup"><span data-stu-id="3e871-118">The following sections provide a high-level overview of common scenarios and patterns for different customer types.</span></span>

## <a name="enterprises-and-system-integrators"></a><span data-ttu-id="3e871-119">Empresas e integradores de sistemas</span><span class="sxs-lookup"><span data-stu-id="3e871-119">Enterprises and system integrators</span></span>
<span data-ttu-id="3e871-120">Em grandes organizações, normalmente observamos dois consumidores de modelos do Azure Resource Manager: as equipes de desenvolvimento interno de software e o TI empresarial.</span><span class="sxs-lookup"><span data-stu-id="3e871-120">Within large organizations, we commonly see two consumers of Resource Manager templates: internal software development teams and corporate IT.</span></span> <span data-ttu-id="3e871-121">Descobrimos que os cenários para SIs são mapeados para os cenários para empresas, portanto, as mesmas considerações se aplicam.</span><span class="sxs-lookup"><span data-stu-id="3e871-121">We've found that the scenarios for the SIs map to the scenarios for Enterprises, so the same considerations apply.</span></span>

### <a name="internal-software-development-teams"></a><span data-ttu-id="3e871-122">Equipes de desenvolvimento interno de software</span><span class="sxs-lookup"><span data-stu-id="3e871-122">Internal software development teams</span></span>
<span data-ttu-id="3e871-123">Se sua equipe desenvolve software para dar suporte a seus negócios, os modelos fornecem uma maneira fácil de implantar rapidamente as tecnologias para uso em soluções específicas para o negócio.</span><span class="sxs-lookup"><span data-stu-id="3e871-123">If your team develops software to support your business, templates provide an easy way to quickly deploy technologies for use in business-specific solutions.</span></span> <span data-ttu-id="3e871-124">Você também pode usar modelos para criar rapidamente ambientes de treinamento que permitam aos membros da equipe obter as habilidades necessárias.</span><span class="sxs-lookup"><span data-stu-id="3e871-124">You can also use templates to rapidly create training environments that enable team members to gain necessary skills.</span></span>

<span data-ttu-id="3e871-125">Você pode usar os modelos “como são”, ou então estendê-los ou integrá-los para atender às suas necessidades.</span><span class="sxs-lookup"><span data-stu-id="3e871-125">You can use templates as-is or extend or compose them to accommodate your needs.</span></span> <span data-ttu-id="3e871-126">Usando marcação nos modelos, você pode fornecer um resumo de cobrança com várias exibições, como equipe, projeto, indivíduo e educação.</span><span class="sxs-lookup"><span data-stu-id="3e871-126">Using tagging within templates, you can provide a billing summary with various views such as team, project, individual, and education.</span></span>

<span data-ttu-id="3e871-127">As empresas geralmente desejam que as equipes de desenvolvimento de software criem um modelo de implantação consistente de uma solução.</span><span class="sxs-lookup"><span data-stu-id="3e871-127">Businesses often want software development teams to create a template for consistent deployment of a solution.</span></span> <span data-ttu-id="3e871-128">O modelo facilita as restrições para que determinados itens dentro desse ambiente permaneçam fixos e não possam ser substituídos.</span><span class="sxs-lookup"><span data-stu-id="3e871-128">The template facilitates constraints so certain items within that environment remain fixed and can't be overridden.</span></span> <span data-ttu-id="3e871-129">Por exemplo, um banco pode exigir que um modelo inclua RBAC, para que um programador não possa revisar uma solução bancária para assim enviar dados para uma conta de armazenamento pessoal.</span><span class="sxs-lookup"><span data-stu-id="3e871-129">For example, a bank might require a template to include RBAC so a programmer can’t revise a banking solution to send data to a personal storage account.</span></span>

### <a name="corporate-it"></a><span data-ttu-id="3e871-130">TI Empresarial</span><span class="sxs-lookup"><span data-stu-id="3e871-130">Corporate IT</span></span>
<span data-ttu-id="3e871-131">As organizações de TI empresarial normalmente usam modelos para fornecer capacidade de nuvem e recursos hospedados na nuvem.</span><span class="sxs-lookup"><span data-stu-id="3e871-131">Corporate IT organizations typically use templates for delivering cloud capacity and cloud-hosted capabilities.</span></span>

#### <a name="cloud-capacity"></a><span data-ttu-id="3e871-132">Capacidade de nuvem</span><span class="sxs-lookup"><span data-stu-id="3e871-132">Cloud capacity</span></span>
<span data-ttu-id="3e871-133">Uma maneira comum de grupos de TI empresarial fornecerem capacidade de nuvem para as equipes é com "tamanhos de camiseta", que são tamanhos padrão de oferta como pequeno, médio e grande.</span><span class="sxs-lookup"><span data-stu-id="3e871-133">A common way for corporate IT groups to provide cloud capacity for teams is with "t-shirt sizes", which are standard offering sizes such as small, medium, and large.</span></span> <span data-ttu-id="3e871-134">As ofertas em tamanhos de camiseta podem combinar diferentes tipos de recursos e quantidades, fornecendo um nível de padronização que torna possível o uso dos modelos.</span><span class="sxs-lookup"><span data-stu-id="3e871-134">The t-shirt sized offerings can mix different resource types and quantities while providing a level of standardization that makes it possible to use templates.</span></span> <span data-ttu-id="3e871-135">Os modelos oferecem capacidade de uma maneira consistente, que impõe políticas corporativas e usa marcação para fornecer estorno a organizações consumidoras.</span><span class="sxs-lookup"><span data-stu-id="3e871-135">The templates deliver capacity in a consistent way that enforces corporate policies and uses tagging to provide chargeback to consuming organizations.</span></span>

<span data-ttu-id="3e871-136">Por exemplo, talvez seja necessário fornecer ambientes de desenvolvimento, teste ou produção em que as equipes de desenvolvimento de software possam implantar suas soluções.</span><span class="sxs-lookup"><span data-stu-id="3e871-136">For example, you may need to provide development, test, or production environments within which the software development teams can deploy their solutions.</span></span> <span data-ttu-id="3e871-137">O ambiente tem uma topologia de rede predefinida e elementos que as equipes de desenvolvimento de software não podem alterar, como as regras que regem o acesso para a inspeção de pacotes e de Internet pública.</span><span class="sxs-lookup"><span data-stu-id="3e871-137">The environment has a predefined network topology and elements that the software development teams cannot change, such as rules governing access to the public internet and packet inspection.</span></span> <span data-ttu-id="3e871-138">Você também pode ter funções específicas da organização para esses ambientes, com direitos de acesso distintos para o ambiente utilizado.</span><span class="sxs-lookup"><span data-stu-id="3e871-138">You may also have organization-specific roles for these environments with distinct access rights for the environment.</span></span>

#### <a name="cloud-hosted-capabilities"></a><span data-ttu-id="3e871-139">Recursos hospedados na nuvem</span><span class="sxs-lookup"><span data-stu-id="3e871-139">Cloud-hosted capabilities</span></span>
<span data-ttu-id="3e871-140">Você pode usar modelos para dar suporte a recursos hospedados na nuvem, incluindo pacotes de software individuais ou ofertas compostas feitas a linhas de negócios internas.</span><span class="sxs-lookup"><span data-stu-id="3e871-140">You can use templates to support cloud-hosted capabilities, including individual software packages or composite offerings that are offered to internal lines of business.</span></span> <span data-ttu-id="3e871-141">Um exemplo de uma oferta composta seria análise como serviço - análise, visualização e outras tecnologias - entregue em uma configuração otimizada e conectada, em uma topologia de rede predefinida.</span><span class="sxs-lookup"><span data-stu-id="3e871-141">An example of a composite offering would be analytics-as-a-service—analytics, visualization, and other technologies—delivered in an optimized, connected configuration on a predefined network topology.</span></span>

<span data-ttu-id="3e871-142">Os recursos hospedados na nuvem são afetados pelas considerações de segurança e função estabelecidas pela oferta de capacidade de nuvem em que eles são criados.</span><span class="sxs-lookup"><span data-stu-id="3e871-142">Cloud-hosted capabilities are affected by the security and role considerations established by the cloud capacity offering on which they’re built.</span></span> <span data-ttu-id="3e871-143">Esses recursos são oferecidos como são ou como um serviço gerenciado.</span><span class="sxs-lookup"><span data-stu-id="3e871-143">These capabilities are offered as is or as a managed service.</span></span> <span data-ttu-id="3e871-144">Para essa última opção, as funções de acesso restrito são necessárias para habilitar o acesso ao ambiente para fins de gerenciamento.</span><span class="sxs-lookup"><span data-stu-id="3e871-144">For the latter, access-constrained roles are required to enable access into the environment for management purposes.</span></span>

## <a name="cloud-service-vendors"></a><span data-ttu-id="3e871-145">Fornecedores de serviço de nuvem</span><span class="sxs-lookup"><span data-stu-id="3e871-145">Cloud service vendors</span></span>
<span data-ttu-id="3e871-146">Depois de conversar com vários CSVs, identificamos diversas abordagens que você pode tomar para implantar serviços para seus clientes e os requisitos associados.</span><span class="sxs-lookup"><span data-stu-id="3e871-146">After talking to many CSVs, we identified multiple approaches you can take to deploy services for your customers and associated requirements.</span></span>

### <a name="csv-hosted-offering"></a><span data-ttu-id="3e871-147">Oferta hospedada em CSV</span><span class="sxs-lookup"><span data-stu-id="3e871-147">CSV-hosted offering</span></span>
<span data-ttu-id="3e871-148">Se você hospeda sua oferta em sua própria assinatura do Azure, há duas abordagens de hospedagem comuns: uma implantação distinta para cada cliente ou então a implantação de unidades de escala, que são a base de uma infraestrutura compartilhada usada para todos os clientes.</span><span class="sxs-lookup"><span data-stu-id="3e871-148">If you host your offering in your own Azure subscription, two hosting approaches are common: deploying a distinct deployment for every customer or deploying scale units that underpin a shared infrastructure used for all customers.</span></span>

* <span data-ttu-id="3e871-149">**Implantações distintas para cada cliente.**</span><span class="sxs-lookup"><span data-stu-id="3e871-149">**Distinct deployments for each customer.**</span></span> <span data-ttu-id="3e871-150">Implantações distintas para cada cliente exigem topologias fixas de diferentes configurações conhecidas.</span><span class="sxs-lookup"><span data-stu-id="3e871-150">Distinct deployments per customer require fixed topologies of different known configurations.</span></span> <span data-ttu-id="3e871-151">Essas implantações podem ter diferentes tamanhos de VM (máquina virtual), números variados de nós e quantidades diferentes de armazenamento associado.</span><span class="sxs-lookup"><span data-stu-id="3e871-151">These deployments may have different virtual machine (VM) sizes, varying numbers of nodes, and different amounts of associated storage.</span></span> <span data-ttu-id="3e871-152">A marcação de implantações é usada para cobrança de valores acumulados de cada cliente.</span><span class="sxs-lookup"><span data-stu-id="3e871-152">Tagging of deployments is used for roll-up billing of each customer.</span></span> <span data-ttu-id="3e871-153">O RBAC pode ser habilitado para permitir que clientes acessem os aspectos do seu ambiente de nuvem.</span><span class="sxs-lookup"><span data-stu-id="3e871-153">RBAC may be enabled to allow customers access to aspects of their cloud environment.</span></span>
* <span data-ttu-id="3e871-154">**Unidades de escala em ambientes multilocatário compartilhados.**</span><span class="sxs-lookup"><span data-stu-id="3e871-154">**Scale units in shared multi-tenant environments.**</span></span> <span data-ttu-id="3e871-155">Um modelo pode representar uma unidade de escala para ambientes multilocatário.</span><span class="sxs-lookup"><span data-stu-id="3e871-155">A template can represent a scale unit for multi-tenant environments.</span></span> <span data-ttu-id="3e871-156">Nesse caso, a mesma infraestrutura é usada para dar suporte a todos os clientes.</span><span class="sxs-lookup"><span data-stu-id="3e871-156">In this case, the same infrastructure is used to support all customers.</span></span> <span data-ttu-id="3e871-157">As implantações representam um grupo de recursos que fornecem um nível de capacidade para a oferta hospedada, como o número de usuários e o número de transações.</span><span class="sxs-lookup"><span data-stu-id="3e871-157">The deployments represent a group of resources that deliver a level of capacity for the hosted offering, such as number of users and number of transactions.</span></span> <span data-ttu-id="3e871-158">Essas unidades de escala são aumentadas ou reduzidas conforme a demanda.</span><span class="sxs-lookup"><span data-stu-id="3e871-158">These scale units are increased or decreased as demand requires.</span></span>

### <a name="csv-offering-injected-into-customer-subscription"></a><span data-ttu-id="3e871-159">Oferta de CSV introduzida na assinatura do cliente</span><span class="sxs-lookup"><span data-stu-id="3e871-159">CSV offering injected into customer subscription</span></span>
<span data-ttu-id="3e871-160">Você talvez queira implantar seu software em assinaturas pertencentes a clientes finais.</span><span class="sxs-lookup"><span data-stu-id="3e871-160">You may want to deploy your software into subscriptions owned by end customers.</span></span> <span data-ttu-id="3e871-161">Você pode usar modelos para realizar implantações distintas em uma conta de cliente do Azure.</span><span class="sxs-lookup"><span data-stu-id="3e871-161">You can use templates to deploy distinct deployments into a customer’s Azure account.</span></span>

<span data-ttu-id="3e871-162">Essas implantações usam RBAC, portanto, você poderá atualizar e gerenciar a implantação na conta do cliente.</span><span class="sxs-lookup"><span data-stu-id="3e871-162">These deployments use RBAC so you can update and manage the deployment within the customer’s account.</span></span>

### <a name="azure-marketplace"></a><span data-ttu-id="3e871-163">Azure Marketplace</span><span class="sxs-lookup"><span data-stu-id="3e871-163">Azure Marketplace</span></span>
<span data-ttu-id="3e871-164">Para anunciar e vender suas ofertas por meio de um marketplace, como o Azure Marketplace, você pode desenvolver modelos para fornecer tipos distintos de implantações que são executados em uma conta de cliente do Azure.</span><span class="sxs-lookup"><span data-stu-id="3e871-164">To advertise and sell your offerings through a marketplace, such as Azure Marketplace, you can develop templates to deliver distinct types of deployments that run in a customer’s Azure account.</span></span> <span data-ttu-id="3e871-165">Essas implantações distintas normalmente podem ser descritas como um tamanho de camiseta (pequeno, médio, grande), tipo de produto/público (community, developer, enterprise) ou tipo de recurso (básico, de alta disponibilidade).</span><span class="sxs-lookup"><span data-stu-id="3e871-165">These distinct deployments can be typically described as a t-shirt size (small, medium, large), product/audience type (community, developer, enterprise), or feature type (basic, high availability).</span></span>  <span data-ttu-id="3e871-166">Em alguns casos, esses tipos permitem que você especifique certos atributos de implantação, como tipo de VM ou número de discos.</span><span class="sxs-lookup"><span data-stu-id="3e871-166">In some cases, these types allow you to specify certain attributes of the deployment, such as VM type or number of disks.</span></span>

## <a name="oss-projects"></a><span data-ttu-id="3e871-167">Projetos de software livre</span><span class="sxs-lookup"><span data-stu-id="3e871-167">OSS projects</span></span>
<span data-ttu-id="3e871-168">Em projetos de software livre, os modelos de Gerenciador de Recursos habilitam uma comunidade a implantar uma solução rapidamente, usando práticas comprovadas.</span><span class="sxs-lookup"><span data-stu-id="3e871-168">Within open source projects, Resource Manager templates enable a community to deploy a solution quickly using proven practices.</span></span> <span data-ttu-id="3e871-169">Você pode armazenar modelos em um repositório GitHub, para que a comunidade possa revisá-los ao longo do tempo.</span><span class="sxs-lookup"><span data-stu-id="3e871-169">You can store templates in a GitHub repository so the community can revise them over time.</span></span> <span data-ttu-id="3e871-170">Os usuários implantam esses modelos em suas próprias assinaturas do Azure.</span><span class="sxs-lookup"><span data-stu-id="3e871-170">Users deploy these templates in their own Azure subscriptions.</span></span>

<span data-ttu-id="3e871-171">As seções a seguir identificam as coisas que você precisa considerar antes de projetar sua solução.</span><span class="sxs-lookup"><span data-stu-id="3e871-171">The following sections identify the things you need to consider before designing your solution.</span></span>

## <a name="identifying-what-is-outside-and-inside-a-vm"></a><span data-ttu-id="3e871-172">Identificando o que está fora e o que está dentro de uma VM</span><span class="sxs-lookup"><span data-stu-id="3e871-172">Identifying what is outside and inside a VM</span></span>
<span data-ttu-id="3e871-173">Ao projetar seu modelo, é útil examinar os requisitos em termos de o que está no interior e no exterior das VMs (máquinas virtuais):</span><span class="sxs-lookup"><span data-stu-id="3e871-173">As you design your template, it’s helpful to look at the requirements in terms of what's outside and inside the virtual machines (VMs):</span></span>

* <span data-ttu-id="3e871-174">Exterior significa as máquinas virtuais e outros recursos de sua implantação, como a topologia de rede, marcação, faz referência aos certificados/segredos e controle de acesso baseado em função.</span><span class="sxs-lookup"><span data-stu-id="3e871-174">Outside means the VMs and other resources of your deployment, such as the network topology, tagging, references to the certs/secrets, and role-based access control.</span></span> <span data-ttu-id="3e871-175">Todos esses recursos fazem parte do seu modelo.</span><span class="sxs-lookup"><span data-stu-id="3e871-175">All these resources are part of your template.</span></span>
* <span data-ttu-id="3e871-176">Interior significa o software instalado e a configuração do estado geral desejado.</span><span class="sxs-lookup"><span data-stu-id="3e871-176">Inside means the installed software and overall desired state configuration.</span></span> <span data-ttu-id="3e871-177">Outros mecanismos, como scripts ou extensões de VM, são usados no todo ou em parte.</span><span class="sxs-lookup"><span data-stu-id="3e871-177">Other mechanisms, such as VM extensions or scripts, are used in whole or in part.</span></span> <span data-ttu-id="3e871-178">Esses mecanismos podem ser identificados e executados pelo modelo, mas não estão contidos nele.</span><span class="sxs-lookup"><span data-stu-id="3e871-178">These mechanisms may be identified and executed by the template but aren’t in it.</span></span>

<span data-ttu-id="3e871-179">Exemplos comuns de atividades que você realizaria "no interior da caixa" incluem:</span><span class="sxs-lookup"><span data-stu-id="3e871-179">Common examples of activities you would do “inside the box” include -</span></span>  

* <span data-ttu-id="3e871-180">Instalar ou remover recursos e funções de servidor</span><span class="sxs-lookup"><span data-stu-id="3e871-180">Install or remove server roles and features</span></span>
* <span data-ttu-id="3e871-181">Instalar e configurar o software no nível do cluster ou nó</span><span class="sxs-lookup"><span data-stu-id="3e871-181">Install and configure software at the node or cluster level</span></span>
* <span data-ttu-id="3e871-182">Implantar sites em um servidor Web</span><span class="sxs-lookup"><span data-stu-id="3e871-182">Deploy websites on a web server</span></span>
* <span data-ttu-id="3e871-183">Implantar esquemas de banco de dados</span><span class="sxs-lookup"><span data-stu-id="3e871-183">Deploy database schemas</span></span>
* <span data-ttu-id="3e871-184">Gerenciar o Registro ou outros tipos de configurações</span><span class="sxs-lookup"><span data-stu-id="3e871-184">Manage registry or other types of configuration settings</span></span>
* <span data-ttu-id="3e871-185">Gerenciar arquivos e diretórios</span><span class="sxs-lookup"><span data-stu-id="3e871-185">Manage files and directories</span></span>
* <span data-ttu-id="3e871-186">Iniciar, parar e gerenciar processos e serviços</span><span class="sxs-lookup"><span data-stu-id="3e871-186">Start, stop, and manage processes and services</span></span>
* <span data-ttu-id="3e871-187">Gerenciar contas de usuário e grupos locais</span><span class="sxs-lookup"><span data-stu-id="3e871-187">Manage local groups and user accounts</span></span>
* <span data-ttu-id="3e871-188">Instalar e gerenciar pacotes (. msi, .exe, yum, etc.)</span><span class="sxs-lookup"><span data-stu-id="3e871-188">Install and manage packages (.msi, .exe, yum, etc.)</span></span>
* <span data-ttu-id="3e871-189">Gerenciar variáveis de ambiente</span><span class="sxs-lookup"><span data-stu-id="3e871-189">Manage environment variables</span></span>
* <span data-ttu-id="3e871-190">Executar scripts nativos (Windows PowerShell, bash, etc.)</span><span class="sxs-lookup"><span data-stu-id="3e871-190">Run native scripts (Windows PowerShell, bash, etc.)</span></span>

### <a name="desired-state-configuration-dsc"></a><span data-ttu-id="3e871-191">Configuração de estado desejado (DSC)</span><span class="sxs-lookup"><span data-stu-id="3e871-191">Desired state configuration (DSC)</span></span>
<span data-ttu-id="3e871-192">Pensando sobre o estado interno de suas VMs além da implantação, convém garantir que essa implantação não se desvie da configuração que você definiu e marcou no controle do código-fonte.</span><span class="sxs-lookup"><span data-stu-id="3e871-192">Thinking about the internal state of your VMs beyond deployment, you want to make sure this deployment doesn’t "drift" from the configuration that you have defined and checked into source control.</span></span> <span data-ttu-id="3e871-193">Essa abordagem garante que seus desenvolvedores ou equipe de operações não façam, em um determinado ambiente, alterações ad hoc que não sejam aprovadas, testadas ou registradas no controle do código-fonte.</span><span class="sxs-lookup"><span data-stu-id="3e871-193">This approach ensures your developers or operations staff don’t make ad-hoc changes to an environment that are not vetted, tested, or recorded in source control.</span></span> <span data-ttu-id="3e871-194">Esse controle é importante, porque as alterações manuais não estão no controle do código-fonte.</span><span class="sxs-lookup"><span data-stu-id="3e871-194">This control is important, because the manual changes are not in source control.</span></span> <span data-ttu-id="3e871-195">Elas também não fazem parte da implantação padrão e terão impacto sobre futuras implantações automatizadas do software.</span><span class="sxs-lookup"><span data-stu-id="3e871-195">They are also not part of the standard deployment and will impact future automated deployments of the software.</span></span>

<span data-ttu-id="3e871-196">Além de seus funcionários internos, a configuração de estado desejado também é importante segundo uma perspectiva de segurança.</span><span class="sxs-lookup"><span data-stu-id="3e871-196">Beyond your internal employees, desired state configuration is also important from a security perspective.</span></span> <span data-ttu-id="3e871-197">Os hackers estão regularmente tentando comprometer e explorar sistemas de software.</span><span class="sxs-lookup"><span data-stu-id="3e871-197">Hackers are regularly trying to compromise and exploit software systems.</span></span> <span data-ttu-id="3e871-198">Quando têm êxito, é comum que instalem arquivos e alterem de outras maneiras o estado de um sistema comprometido.</span><span class="sxs-lookup"><span data-stu-id="3e871-198">When successful, it's common to install files and otherwise change the state of a compromised system.</span></span> <span data-ttu-id="3e871-199">Usando a configuração de estado desejado, você pode identificar os deltas entre o estado desejado e o atual, para então restaurar uma configuração conhecida.</span><span class="sxs-lookup"><span data-stu-id="3e871-199">Using desired state configuration, you can identify deltas between the desired and actual state and restore a known configuration.</span></span>

<span data-ttu-id="3e871-200">Há extensões de recurso para os mecanismos mais populares para DSC - PowerShell DSC, Chef e Puppet.</span><span class="sxs-lookup"><span data-stu-id="3e871-200">There are resource extensions for the most popular mechanisms for DSC - PowerShell DSC, Chef, and Puppet.</span></span> <span data-ttu-id="3e871-201">Cada uma dessas extensões pode implantar o estado inicial de sua VM e também ser usado para assegurar que o estado desejado seja mantido.</span><span class="sxs-lookup"><span data-stu-id="3e871-201">Each of these extensions can deploy the initial state of your VM and also be used to make sure the desired state is maintained.</span></span>

## <a name="common-template-scopes"></a><span data-ttu-id="3e871-202">Escopos de modelo comuns</span><span class="sxs-lookup"><span data-stu-id="3e871-202">Common template scopes</span></span>
<span data-ttu-id="3e871-203">Em nossa experiência, vimos três escopos principais de modelos de solução surgirem.</span><span class="sxs-lookup"><span data-stu-id="3e871-203">In our experience, we’ve seen three key solution templates scopes emerge.</span></span> <span data-ttu-id="3e871-204">Esses três escopos (capacidade, funcionalidade e solução de ponta a ponta) são descritos nas seções a seguir.</span><span class="sxs-lookup"><span data-stu-id="3e871-204">These three scopes – capacity, capability, and end-to-end solution – are described in the following sections.</span></span>

### <a name="capacity-scope"></a><span data-ttu-id="3e871-205">Escopo de capacidade</span><span class="sxs-lookup"><span data-stu-id="3e871-205">Capacity scope</span></span>
<span data-ttu-id="3e871-206">Um escopo de capacidade oferece um conjunto de recursos em uma topologia padrão que é pré-configurada para estar em conformidade com normas e políticas.</span><span class="sxs-lookup"><span data-stu-id="3e871-206">A capacity scope delivers a set of resources in a standard topology that is pre-configured to be in compliance with regulations and policies.</span></span> <span data-ttu-id="3e871-207">O exemplo mais comum é implantar um ambiente de desenvolvimento padrão em um cenário de SI (integrador de sistemas) ou TI empresarial.</span><span class="sxs-lookup"><span data-stu-id="3e871-207">The most common example is deploying a standard development environment in an Enterprise IT or SI scenario.</span></span>

### <a name="capability-scope"></a><span data-ttu-id="3e871-208">Escopo de funcionalidade</span><span class="sxs-lookup"><span data-stu-id="3e871-208">Capability scope</span></span>
<span data-ttu-id="3e871-209">Um escopo de funcionalidade concentra-se em como implantar e configurar uma topologia para uma determinada tecnologia.</span><span class="sxs-lookup"><span data-stu-id="3e871-209">A capability scope is focused on deploying and configuring a topology for a given technology.</span></span> <span data-ttu-id="3e871-210">Cenários comuns, incluindo tecnologias como SQL Server, Cassandra, Hadoop.</span><span class="sxs-lookup"><span data-stu-id="3e871-210">Common scenarios including technologies such as SQL Server, Cassandra, Hadoop.</span></span>

### <a name="end-to-end-solution-scope"></a><span data-ttu-id="3e871-211">Escopo da solução de ponta a ponta</span><span class="sxs-lookup"><span data-stu-id="3e871-211">End-to-end solution scope</span></span>
<span data-ttu-id="3e871-212">Um escopo de solução de ponta a ponta é direcionado além de uma única funcionalidade e, em vez disso, dedicado a oferecer uma solução de ponta a ponta, composta de várias funcionalidades.</span><span class="sxs-lookup"><span data-stu-id="3e871-212">An End-to-End Solution Scope is targeted beyond a single capability, and instead focused on delivering an end to end solution comprised of multiple capabilities.</span></span>  

<span data-ttu-id="3e871-213">Um escopo de modelo com escopo de solução se manifesta como um conjunto de um ou mais modelos com escopo de funcionalidade com recursos, lógica e estado desejado específicos da solução.</span><span class="sxs-lookup"><span data-stu-id="3e871-213">A solution-scoped template scope manifests itself as a set of one or more capability-scoped templates with solution-specific resources, logic, and desired state.</span></span> <span data-ttu-id="3e871-214">Um exemplo de um modelo com escopo de solução é um modelo de solução de pipeline de dados de ponta a ponta.</span><span class="sxs-lookup"><span data-stu-id="3e871-214">An example of a solution-scoped template is an end to end data pipeline solution template.</span></span> <span data-ttu-id="3e871-215">O modelo poderá misturar a topologia e o estado específicos da solução com vários modelos de solução com escopo de funcionalidade, como Kafka, Storm e Hadoop.</span><span class="sxs-lookup"><span data-stu-id="3e871-215">The template might mix solution-specific topology and state with multiple capability-scoped solution templates such as Kafka, Storm, and Hadoop.</span></span>

## <a name="choosing-free-form-vs-known-configurations"></a><span data-ttu-id="3e871-216">Escolhendo entre configurações de forma livre e configurações conhecidas</span><span class="sxs-lookup"><span data-stu-id="3e871-216">Choosing free-form vs. known configurations</span></span>
<span data-ttu-id="3e871-217">Você pode pensar inicialmente que um modelo deve fornecer a máxima flexibilidade aos clientes, mas muitas considerações afetam a escolha entre usar configurações de forma livre ou conhecidas.</span><span class="sxs-lookup"><span data-stu-id="3e871-217">You might initially think a template should give consumers the utmost flexibility, but many considerations affect the choice of whether to use free-form configurations vs. known configurations.</span></span> <span data-ttu-id="3e871-218">Esta seção identifica as principais necessidades do cliente e considerações técnicas que deram forma à abordagem compartilhada neste documento.</span><span class="sxs-lookup"><span data-stu-id="3e871-218">This section identifies the key customer requirements and technical considerations that shaped the approach shared in this document.</span></span>

### <a name="free-form-configurations"></a><span data-ttu-id="3e871-219">Configurações de forma livre</span><span class="sxs-lookup"><span data-stu-id="3e871-219">Free-form configurations</span></span>
<span data-ttu-id="3e871-220">À primeira vista, configurações de forma livre parecem ideais.</span><span class="sxs-lookup"><span data-stu-id="3e871-220">On the surface, free-form configurations sound ideal.</span></span> <span data-ttu-id="3e871-221">Elas permitem que você selecione um tipo de VM e forneça um número arbitrário de nós e discos para os nós conectados e faça isso como parâmetros para um modelo.</span><span class="sxs-lookup"><span data-stu-id="3e871-221">They allow you to select a VM type and provide an arbitrary number of nodes and attached disks for those nodes — and do so as parameters to a template.</span></span> <span data-ttu-id="3e871-222">No entanto, essa abordagem não é ideal para alguns cenários.</span><span class="sxs-lookup"><span data-stu-id="3e871-222">However, this approach is not ideal for some scenarios.</span></span>

<span data-ttu-id="3e871-223">Em [Tamanhos de máquinas virtuais](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json), são identificados os diferentes tipos de VM e tamanhos disponíveis, além de cada um dos números de discos duráveis (2, 4, 8, 16 ou 32) que podem ser anexados.</span><span class="sxs-lookup"><span data-stu-id="3e871-223">In [Sizes for virtual machines](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json), the different VM types and available sizes are identified, and each of the number of durable disks (2, 4, 8, 16, or 32) that can be attached.</span></span> <span data-ttu-id="3e871-224">Cada disco conectado fornece 500 IOPS e múltiplos desses discos podem ser agrupados (pooling) para se obter um multiplicador desse número de IOPS.</span><span class="sxs-lookup"><span data-stu-id="3e871-224">Each attached disk provides 500 IOPS and multiples of these disks can be pooled for a multiplier of that number of IOPS.</span></span> <span data-ttu-id="3e871-225">Por exemplo, 16 discos podem ser agrupados (pooling) para fornecer 8.000 IOPS.</span><span class="sxs-lookup"><span data-stu-id="3e871-225">For example, 16 disks can be pooled to provide 8,000 IOPS.</span></span> <span data-ttu-id="3e871-226">O pooling é realizado com a configuração no sistema operacional, usando espaços de armazenamento do Microsoft Windows ou RAID (redundant array of inexpensive disks) no Linux.</span><span class="sxs-lookup"><span data-stu-id="3e871-226">Pooling is done with configuration in the operating system, using Microsoft Windows Storage Spaces or redundant array of inexpensive disks (RAID) in Linux.</span></span>

<span data-ttu-id="3e871-227">Uma configuração de forma livre permite a seleção de diversas instâncias de VM, vários tipos e tamanhos de VM para essas instâncias, vários discos para o tipo de VM e um ou mais scripts para configurar os conteúdos da VM.</span><span class="sxs-lookup"><span data-stu-id="3e871-227">A free-form configuration enables the selection several VM instances, various VM types and sizes for those instances, various disks for the VM type, and one or more scripts to configure the VM contents.</span></span>

<span data-ttu-id="3e871-228">É comum que uma implantação tenha vários tipos de nós, como nós mestres e de dados; portanto, essa flexibilidade geralmente é fornecida para todos os tipos de nó.</span><span class="sxs-lookup"><span data-stu-id="3e871-228">It is common that a deployment may have multiple types of nodes, such as master and data nodes, so this flexibility is often provided for every node type.</span></span>

<span data-ttu-id="3e871-229">Quando começar a implantar clusters de qualquer significância, você começa a trabalhar com esses cenários complexos.</span><span class="sxs-lookup"><span data-stu-id="3e871-229">As you start to deploy clusters of any significance, you begin to work with these complex scenarios.</span></span> <span data-ttu-id="3e871-230">Se você estivesse implantando um cluster Hadoop, por exemplo, com 8 nós mestres e 200 nós de dados e, em seguida, agrupasse em pool 4 discos anexados em cada nó mestre e 16 discos conectados por nó de dados, você teria 208 VMs e 3.232 discos para gerenciar.</span><span class="sxs-lookup"><span data-stu-id="3e871-230">If you were deploying a Hadoop cluster, for example, with 8 master nodes and 200 data nodes, and pooled 4 attached disks on each master node and pooled 16 attached disks per data node, you would have 208 VMs and 3,232 disks to manage.</span></span>

<span data-ttu-id="3e871-231">Uma conta de armazenamento acelerará as solicitações acima de seu limite identificado de 20.000 transações/s, portanto, você deve examinar o particionamento de conta de armazenamento e usar cálculos para determinar o número apropriado de contas de armazenamento para acomodar essa topologia.</span><span class="sxs-lookup"><span data-stu-id="3e871-231">A storage account will throttle requests above its identified 20,000 transactions/second limit, so you should look at storage account partitioning and use calculations to determine the appropriate number of storage accounts to accommodate this topology.</span></span> <span data-ttu-id="3e871-232">Dada a infinidade de combinações às quais a abordagem de forma livre dá suporte, são necessários cálculos dinâmicos para determinar o particionamento apropriado.</span><span class="sxs-lookup"><span data-stu-id="3e871-232">Given the multitude of combinations supported by the free-form approach, dynamic calculations are required to determine the appropriate partitioning.</span></span> <span data-ttu-id="3e871-233">O idioma do modelo do Gerenciador de Recursos do Azure não oferece funções matemáticas atualmente; portanto, você deve executar esses cálculos em código, gerando um modelo exclusivo embutido em código com os detalhes apropriados.</span><span class="sxs-lookup"><span data-stu-id="3e871-233">The Azure Resource Manager Template Language does not presently provide mathematical functions, so you must perform these calculations in code, generating a unique, hard-coded template with the appropriate details.</span></span>

<span data-ttu-id="3e871-234">Em cenários de SI e TI empresarial, alguém deve manter os modelos e dar suporte às topologias implantadas para uma ou mais organizações.</span><span class="sxs-lookup"><span data-stu-id="3e871-234">In enterprise IT and SI scenarios, someone must maintain the templates and support the deployed topologies for one or more organizations.</span></span> <span data-ttu-id="3e871-235">Essa sobrecarga adicional - diferentes configurações e modelos para cada cliente - está longe de ser desejável.</span><span class="sxs-lookup"><span data-stu-id="3e871-235">This additional overhead — different configurations and templates for each customer — is far from desirable.</span></span>

<span data-ttu-id="3e871-236">Você pode usar esses modelos para implantar ambientes na assinatura do Azure do seu cliente, mas as equipes de TI empresariais e também os CSVs normalmente os implantarão em suas próprias assinaturas, usando uma função de estorno para cobrar seus clientes.</span><span class="sxs-lookup"><span data-stu-id="3e871-236">You can use these templates to deploy environments in your customer’s Azure subscription, but both corporate IT teams and CSVs typically deploy them into their own subscriptions, using a chargeback function to bill their customers.</span></span> <span data-ttu-id="3e871-237">Nesses cenários, a meta é implantar capacidade para vários clientes em um pool de assinaturas e manter as implantações densamente populadas nas assinaturas, para minimizar a proliferação de assinatura - ou seja, mais assinaturas para gerenciar.</span><span class="sxs-lookup"><span data-stu-id="3e871-237">In these scenarios, the goal is to deploy capacity for multiple customers across a pool of subscriptions and keep deployments densely populated into the subscriptions to minimize subscription sprawl—that is, more subscriptions to manage.</span></span> <span data-ttu-id="3e871-238">Com tamanhos de implantação realmente dinâmicos, alcançar esse tipo de densidade requer um planejamento cuidadoso e desenvolvimento adicional para o trabalho de scaffolding em nome da organização.</span><span class="sxs-lookup"><span data-stu-id="3e871-238">With truly dynamic deployment sizes, achieving this type of density requires careful planning and additional development for scaffolding work on behalf of the organization.</span></span>

<span data-ttu-id="3e871-239">Além disso, você não pode criar assinaturas por meio de uma chamada à API, mas deve fazê-lo manualmente por meio do portal.</span><span class="sxs-lookup"><span data-stu-id="3e871-239">In addition, you can’t create subscriptions via an API call but must do so manually through the portal.</span></span> <span data-ttu-id="3e871-240">Na medida em que aumenta o número de assinaturas, qualquer expansão de assinatura resultante requer intervenção humana - ela não pode ser automatizada.</span><span class="sxs-lookup"><span data-stu-id="3e871-240">As the number of subscriptions increases, any resulting subscription sprawl requires human intervention—it can’t be automated.</span></span> <span data-ttu-id="3e871-241">Com tanta variabilidade em tamanhos de implantações, você precisaria pré-provisionar um número de assinaturas manualmente para garantir que as assinaturas estivessem disponíveis.</span><span class="sxs-lookup"><span data-stu-id="3e871-241">With so much variability in the sizes of deployments, you would have to pre-provision a number of subscriptions manually to ensure subscriptions are available.</span></span>

<span data-ttu-id="3e871-242">Considerando todos esses fatores, uma configuração de forma verdadeiramente livre é menos atraente do que parece à primeira vista.</span><span class="sxs-lookup"><span data-stu-id="3e871-242">Considering all these factors, a truly free-form configuration is less appealing than at first blush.</span></span>

### <a name="known-configurations--the-t-shirt-sizing-approach"></a><span data-ttu-id="3e871-243">Configurações conhecidas - a abordagem de dimensionamento por tamanho de camiseta</span><span class="sxs-lookup"><span data-stu-id="3e871-243">Known configurations — the t-shirt sizing approach</span></span>
<span data-ttu-id="3e871-244">Em de oferecer um modelo que fornece total flexibilidade e inúmeras variações, um padrão comum é, segundo nossa experiência, fornecer a capacidade de selecionar configurações conhecidas - na verdade, tamanhos de camiseta padrão como área restrita, pequeno, médio e grande.</span><span class="sxs-lookup"><span data-stu-id="3e871-244">Rather than offer a template that provides total flexibility and countless variations, in our experience a common pattern is to provide the ability to select known configurations — in effect, standard t-shirt sizes such as sandbox, small, medium, and large.</span></span> <span data-ttu-id="3e871-245">Outros exemplos de tamanhos de camiseta são ofertas de produtos, como community edition ou enterprise edition.</span><span class="sxs-lookup"><span data-stu-id="3e871-245">Other examples of t-shirt sizes are product offerings, such as community edition or enterprise edition.</span></span>  <span data-ttu-id="3e871-246">Em outros casos, podem se tratar de configurações de uma tecnologia específicas para uma determinada carga de trabalho - como mapear/reduzir ou no SQL.</span><span class="sxs-lookup"><span data-stu-id="3e871-246">In other cases, it may be workload-specific configurations of a technology – such as map reduce or no sql.</span></span>

<span data-ttu-id="3e871-247">Muitas organizações de TI empresarial, fornecedores de software livre e SIs disponibilizam hoje suas ofertas dessa maneira em ambientes virtualizados (empresas) locais ou como ofertas de SaaS (software como serviço) - CSVs e OSVs.</span><span class="sxs-lookup"><span data-stu-id="3e871-247">Many enterprise IT organizations, OSS vendors, and SIs make their offerings available today in this way in on-premises, virtualized environments (enterprises) or as software-as-a-service (SaaS) offerings (CSVs and OSVs).</span></span>

<span data-ttu-id="3e871-248">Essa abordagem fornece boas configurações conhecidas, de tamanhos variados que são pré-configurados para os clientes.</span><span class="sxs-lookup"><span data-stu-id="3e871-248">This approach provides good, known configurations of varying sizes that are preconfigured for customers.</span></span> <span data-ttu-id="3e871-249">Sem configurações conhecidas, os clientes finais devem determinar o tamanho do cluster por conta própria, levar em consideração restrições de recursos de plataforma e fazer cálculos para identificar o particionamento resultante de contas de armazenamento e outros recursos (devido a restrições de recursos e de tamanho do cluster).</span><span class="sxs-lookup"><span data-stu-id="3e871-249">Without known configurations, end customers must determine cluster sizing on their own, factor in platform resource constraints, and do math to identify the resulting partitioning of storage accounts and other resources (due to cluster size and resource constraints).</span></span> <span data-ttu-id="3e871-250">As configurações conhecidas permitem que os clientes selecionem facilmente o tamanho de camiseta certo - ou seja, uma determinada implantação.</span><span class="sxs-lookup"><span data-stu-id="3e871-250">Known configurations enable customers to easily select the right t-shirt size—that is, a given deployment.</span></span> <span data-ttu-id="3e871-251">É mais fácil dar suporte a um pequeno número de configurações conhecidas; além disso, o uso de um pequeno número delas resulta em uma melhor experiência para o cliente e pode ajudá-lo a oferecer um maior nível de densidade.</span><span class="sxs-lookup"><span data-stu-id="3e871-251">In addition to making a better experience for the customer, a small number of known configurations is easier to support and can help you deliver a higher level of density.</span></span>

<span data-ttu-id="3e871-252">Uma abordagem de configuração conhecida voltada para tamanhos de camiseta também pode ter um número variável de nós em um determinado tamanho.</span><span class="sxs-lookup"><span data-stu-id="3e871-252">A known configuration approach focused on t-shirt sizes may also have varying number of nodes within a size.</span></span> <span data-ttu-id="3e871-253">Por exemplo, um tamanho de camiseta pequeno pode ter entre 3 e 10 nós.</span><span class="sxs-lookup"><span data-stu-id="3e871-253">For example, a small t-shirt size may be between 3 and 10 nodes.</span></span>  <span data-ttu-id="3e871-254">O tamanho de camiseta seria projetado para acomodar até 10 nós e fornecer ao consumidor a capacidade de fazer seleções de forma livre até o tamanho máximo identificado.</span><span class="sxs-lookup"><span data-stu-id="3e871-254">The t-shirt size would be designed to accommodate up to 10 nodes and provide the consumer the ability to make free form selections up to the maximum size identified.</span></span>  

<span data-ttu-id="3e871-255">Um tamanho de camiseta com base no tipo de carga de trabalho pode ter uma natureza mais voltada à forma livre em termos de número de nós que podem ser implantados, mas terá a configuração do software do nó e o tamanho de nó distintos para a carga de trabalho.</span><span class="sxs-lookup"><span data-stu-id="3e871-255">A t-shirt size based on workload type, may be more free form in nature in terms of the number of nodes that can be deployed but will have workload distinct node size and configuration of the software on the node.</span></span>

<span data-ttu-id="3e871-256">Tamanhos de camiseta baseados em ofertas de produto, como Community ou Enterprise, podem ter diferentes tipos de recurso e número máximo de nós que podem ser implantados, normalmente associados a considerações sobre licenciamento ou a disponibilidade de recursos entre as diferentes ofertas.</span><span class="sxs-lookup"><span data-stu-id="3e871-256">T-shirt sizes based on product offerings, such as community or Enterprise, may have distinct resource types and maximum number of nodes that can be deployed, typically tied to licensing considerations or feature availability across the different offerings.</span></span>

<span data-ttu-id="3e871-257">Você também pode acomodar clientes com variantes exclusivas, usando os modelos baseados em JSON.</span><span class="sxs-lookup"><span data-stu-id="3e871-257">You can also accommodate customers with unique variants using the JSON-based templates.</span></span> <span data-ttu-id="3e871-258">Ao lidar com exceções, você pode incorporar o planejamento e considerações adequados para o desenvolvimento, suporte e custeio.</span><span class="sxs-lookup"><span data-stu-id="3e871-258">When dealing with outliers, you can incorporate the appropriate planning and considerations for development, support, and costing.</span></span>

<span data-ttu-id="3e871-259">Com base em cenários de consumo de modelo de clientes e requisitos identificados no início deste documento, identificamos um padrão para a decomposição de modelos.</span><span class="sxs-lookup"><span data-stu-id="3e871-259">Based on the customer template consumption scenarios, and requirements identified at the start of this document, we identified a pattern for template decomposition.</span></span>

## <a name="capacity-and-capability-scoped-solution-templates"></a><span data-ttu-id="3e871-260">Modelos de solução no escopo de capacidade e funcionalidade</span><span class="sxs-lookup"><span data-stu-id="3e871-260">Capacity and capability-scoped solution templates</span></span>
<span data-ttu-id="3e871-261">A decomposição fornece uma abordagem modular para desenvolvimento de modelos, que dá suporte a reutilização, extensibilidade, testes e instrumentação.</span><span class="sxs-lookup"><span data-stu-id="3e871-261">Decomposition provides a modular approach to template development that supports reuse, extensibility, testing, and tooling.</span></span> <span data-ttu-id="3e871-262">Esta seção fornece detalhes sobre como uma abordagem hierárquica pode ser aplicada aos modelos com um escopo de Capacidade ou Funcionalidade.</span><span class="sxs-lookup"><span data-stu-id="3e871-262">This section provides detail on how a decomposition approach can be applied to templates with a Capacity or Capability scope.</span></span>

<span data-ttu-id="3e871-263">Nessa abordagem, um modelo principal recebe valores de parâmetro de um consumidor de modelo, além de links para vários tipos de modelos e scripts downstream, conforme mostrado abaixo.</span><span class="sxs-lookup"><span data-stu-id="3e871-263">In this approach, a main template receives parameter values from a template consumer, then links to several types of templates and scripts downstream as shown below.</span></span> <span data-ttu-id="3e871-264">Os parâmetros, variáveis estáticas e variáveis gerados são usados para fornecer valores de entrada e saída nos modelos vinculados.</span><span class="sxs-lookup"><span data-stu-id="3e871-264">Parameters, static variables, and generated variables are used to provide values in and out of the linked templates.</span></span>

![Parâmetros de modelo](./media/best-practices-resource-manager-design-templates/template-parameters.png)

<span data-ttu-id="3e871-266">**Os parâmetros são passados para um modelo principal e, em seguida, para os modelos vinculados**</span><span class="sxs-lookup"><span data-stu-id="3e871-266">**Parameters are passed to a main template then to linked templates**</span></span>

<span data-ttu-id="3e871-267">As seções a seguir se concentram nos tipos de modelos e scripts em que um único modelo é decomposto.</span><span class="sxs-lookup"><span data-stu-id="3e871-267">The following sections focus on the types of templates and scripts that a single template is decomposed into.</span></span> <span data-ttu-id="3e871-268">As seções apresentam abordagens para passar informações de estado entre os modelos.</span><span class="sxs-lookup"><span data-stu-id="3e871-268">The sections present approaches for passing state information among the templates.</span></span> <span data-ttu-id="3e871-269">Cada modelo e os tipos de script na imagem são descritos juntamente com exemplos.</span><span class="sxs-lookup"><span data-stu-id="3e871-269">Each template and the script types in the image are described along with examples.</span></span> <span data-ttu-id="3e871-270">Para obter um exemplo contextual, consulte "Juntando as peças: um exemplo de implementação", mais adiante neste documento.</span><span class="sxs-lookup"><span data-stu-id="3e871-270">For a contextual example, see "Putting it together: a sample implementation" later in this document.</span></span>

### <a name="template-metadata"></a><span data-ttu-id="3e871-271">Metadados de modelo</span><span class="sxs-lookup"><span data-stu-id="3e871-271">Template metadata</span></span>
<span data-ttu-id="3e871-272">Metadados de modelo (o arquivo metadata.json) contém pares chave/valor que descrevem um modelo em JSON, que pode ser lido por seres humanos e sistemas de software.</span><span class="sxs-lookup"><span data-stu-id="3e871-272">Template metadata (the metadata.json file) contains key/value pairs that describe a template in JSON, which can be read by humans and software systems.</span></span>

![Metadados de modelo](./media/best-practices-resource-manager-design-templates/template-metadata.png)

<span data-ttu-id="3e871-274">**Os metadados do modelo são descritos no arquivo metadata.json**</span><span class="sxs-lookup"><span data-stu-id="3e871-274">**Template metadata is described in the metadata.json file**</span></span>

<span data-ttu-id="3e871-275">Agentes de software podem recuperar o arquivo metadata.json e publicar as informações e um link para o modelo em um diretório ou uma página da Web.</span><span class="sxs-lookup"><span data-stu-id="3e871-275">Software agents can retrieve the metadata.json file and publish the information and a link to the template in a web page or directory.</span></span> <span data-ttu-id="3e871-276">Os elementos incluem *itemDisplayName*, *description*, *summary*, *githubUsername* e *dateUpdated*.</span><span class="sxs-lookup"><span data-stu-id="3e871-276">Elements include *itemDisplayName*, *description*, *summary*, *githubUsername*, and *dateUpdated*.</span></span>

<span data-ttu-id="3e871-277">Um exemplo de arquivo é mostrado abaixo em sua totalidade.</span><span class="sxs-lookup"><span data-stu-id="3e871-277">An example file is shown below in its entirety.</span></span>

    {
        "itemDisplayName": "PostgreSQL 9.3 on Ubuntu VMs",
        "description": "This template creates a PostgreSQL streaming-replication between a master and one or more slave servers each with 2 striped data disks. The database servers are deployed into a private-only subnet with one publicly accessible jumpbox VM in a DMZ subnet with public IP.",
        "summary": "PostgreSQL stream-replication with multiple slave servers and a publicly accessible jumpbox VM",
        "githubUsername": "arsenvlad",
        "dateUpdated": "2015-04-24"
    }

### <a name="main-template"></a><span data-ttu-id="3e871-278">Modelo principal</span><span class="sxs-lookup"><span data-stu-id="3e871-278">Main template</span></span>
<span data-ttu-id="3e871-279">O modelo principal recebe parâmetros de um usuário, usa essas informações para preencher as variáveis de objeto complexo e executa os modelos vinculados.</span><span class="sxs-lookup"><span data-stu-id="3e871-279">The main template receives parameters from a user, uses that information to populate complex object variables, and executes the linked templates.</span></span>

![Modelo principal](./media/best-practices-resource-manager-design-templates/main-template.png)

<span data-ttu-id="3e871-281">**O modelo principal recebe parâmetros de um usuário**</span><span class="sxs-lookup"><span data-stu-id="3e871-281">**The main template receives parameters from a user**</span></span>

<span data-ttu-id="3e871-282">Um parâmetro que é fornecido é um tipo de configuração conhecida, também conhecido como o parâmetro de tamanho de camiseta devido a seus valores padronizados, como pequeno, médio ou grande.</span><span class="sxs-lookup"><span data-stu-id="3e871-282">One parameter that is provided is a known configuration type also known as the t-shirt size parameter because of its standardized values such as small, medium, or large.</span></span> <span data-ttu-id="3e871-283">Na prática, você pode usar esse parâmetro de várias maneiras.</span><span class="sxs-lookup"><span data-stu-id="3e871-283">In practice, you can use this parameter in multiple ways.</span></span> <span data-ttu-id="3e871-284">Para obter detalhes, consulte "Modelo de recursos de configuração conhecida", posteriormente neste documento.</span><span class="sxs-lookup"><span data-stu-id="3e871-284">For details, see "Known configuration resources template" later in this document.</span></span>

<span data-ttu-id="3e871-285">Alguns recursos são implantados independentemente da configuração conhecida especificada por um parâmetro de usuário.</span><span class="sxs-lookup"><span data-stu-id="3e871-285">Some resources are deployed regardless of the known configuration specified by a user parameter.</span></span> <span data-ttu-id="3e871-286">Esses recursos são provisionados usando um único modelo de recurso compartilhado e são compartilhados por outros modelos, de modo que o modelo de recurso compartilhado é executado primeiro.</span><span class="sxs-lookup"><span data-stu-id="3e871-286">These resources are provisioned using a single shared resource template and are shared by other templates, so the shared resource template is run first.</span></span>

<span data-ttu-id="3e871-287">Alguns recursos são implantados opcionalmente, independentemente da configuração conhecida especificada.</span><span class="sxs-lookup"><span data-stu-id="3e871-287">Some resources are deployed optionally regardless of the specified known configuration.</span></span>

### <a name="shared-resources-template"></a><span data-ttu-id="3e871-288">Modelo de recursos compartilhados</span><span class="sxs-lookup"><span data-stu-id="3e871-288">Shared resources template</span></span>
<span data-ttu-id="3e871-289">Esse modelo fornece recursos que são comuns a todas as configurações conhecidas.</span><span class="sxs-lookup"><span data-stu-id="3e871-289">This template delivers resources that are common across all known configurations.</span></span> <span data-ttu-id="3e871-290">Ele contém a rede virtual, conjuntos de disponibilidade e outros recursos que são necessários, independentemente do modelo de configuração que é implantado.</span><span class="sxs-lookup"><span data-stu-id="3e871-290">It contains the virtual network, availability sets, and other resources that are required regardless of the known configuration template that is deployed.</span></span>

![Recursos de modelo](./media/best-practices-resource-manager-design-templates/template-resources.png)

<span data-ttu-id="3e871-292">**Modelo de recursos compartilhados**</span><span class="sxs-lookup"><span data-stu-id="3e871-292">**Shared resources template**</span></span>

<span data-ttu-id="3e871-293">Os nomes de recursos, como o nome de rede virtual, baseiam-se no modelo principal.</span><span class="sxs-lookup"><span data-stu-id="3e871-293">Resource names, such as the virtual network name, are based on the main template.</span></span> <span data-ttu-id="3e871-294">Você pode especificá-los como uma variável dentro desse modelo ou recebê-los como um parâmetro do usuário, conforme exigido pela sua organização.</span><span class="sxs-lookup"><span data-stu-id="3e871-294">You can specify them as a variable within that template or receive them as a parameter from the user, as required by your organization.</span></span>

### <a name="optional-resources-template"></a><span data-ttu-id="3e871-295">Modelo de recursos opcionais</span><span class="sxs-lookup"><span data-stu-id="3e871-295">Optional resources template</span></span>
<span data-ttu-id="3e871-296">O modelo de recursos opcionais contém recursos que são implantados por meio de programação com base no valor de um parâmetro ou variável.</span><span class="sxs-lookup"><span data-stu-id="3e871-296">The optional resources template contains resources that are programmatically deployed based on the value of a parameter or variable.</span></span>

![Recursos opcionais](./media/best-practices-resource-manager-design-templates/optional-resources.png)

<span data-ttu-id="3e871-298">**Modelo de recursos opcionais**</span><span class="sxs-lookup"><span data-stu-id="3e871-298">**Optional resources template**</span></span>

<span data-ttu-id="3e871-299">Por exemplo, você pode usar um modelo de recursos opcionais para configurar um jumpbox que permita acesso indireto a um ambiente implantado pela Internet pública.</span><span class="sxs-lookup"><span data-stu-id="3e871-299">For example, you can use an optional resources template to configure a jumpbox that enables indirect access to a deployed environment from the public Internet.</span></span> <span data-ttu-id="3e871-300">Você usaria um parâmetro ou variável para identificar se o jumpbox deve ou não ser habilitado e a função *concat* para criar o nome de destino para o modelo, como *jumpbox_enabled.json*.</span><span class="sxs-lookup"><span data-stu-id="3e871-300">You would use a parameter or variable to identify whether the jumpbox should be enabled and the *concat* function to build the target name for the template, such as *jumpbox_enabled.json*.</span></span> <span data-ttu-id="3e871-301">A vinculação de modelos usaria a variável resultante para instalar o jumpbox.</span><span class="sxs-lookup"><span data-stu-id="3e871-301">Template linking would use the resulting variable to install the jumpbox.</span></span>

<span data-ttu-id="3e871-302">É possível vincular o modelo de recursos opcionais de vários locais:</span><span class="sxs-lookup"><span data-stu-id="3e871-302">You can link the optional resources template from multiple places:</span></span>

* <span data-ttu-id="3e871-303">Quando aplicável a todas as implantações, crie, do modelo de recursos compartilhados, um link orientado por parâmetros.</span><span class="sxs-lookup"><span data-stu-id="3e871-303">When applicable to every deployment, create a parameter-driven link from the shared resources template.</span></span>
* <span data-ttu-id="3e871-304">Quando aplicável para configurações conhecidas seletas - por exemplo, para instalar somente em grandes implantações - crie, do modelo de configuração, um link orientado por parâmetros ou orientado por variáveis.</span><span class="sxs-lookup"><span data-stu-id="3e871-304">When applicable to select known configurations—for example, only install on large deployments—create a parameter-driven or variable-driven link from the known configuration template.</span></span>

<span data-ttu-id="3e871-305">Se um determinado recurso for opcional, ele pode não estar sendo orientado pelo consumidor de modelos, mas sim pelo provedor de modelos.</span><span class="sxs-lookup"><span data-stu-id="3e871-305">Whether a given resource is optional may not be driven by the template consumer but instead by the template provider.</span></span> <span data-ttu-id="3e871-306">Por exemplo, talvez seja necessário atender a um requisito de determinado produto ou complemento de produto (comum para CSVs) ou impor políticas (comum para SIs e grupos de TI empresarial).</span><span class="sxs-lookup"><span data-stu-id="3e871-306">For example, you may need to satisfy a particular product requirement or product add-on (common for CSVs) or to enforce policies (common for SIs and enterprise IT groups).</span></span> <span data-ttu-id="3e871-307">Nesses casos, você pode usar uma variável para identificar se o recurso deve ou não ser implantado.</span><span class="sxs-lookup"><span data-stu-id="3e871-307">In these cases, you can use a variable to identify whether the resource should be deployed.</span></span>

### <a name="known-configuration-resources-template"></a><span data-ttu-id="3e871-308">Modelo de recursos de configuração conhecida</span><span class="sxs-lookup"><span data-stu-id="3e871-308">Known configuration resources template</span></span>
<span data-ttu-id="3e871-309">No modelo principal, um parâmetro pode ser exposto para permitir que o consumidor de modelo especifique uma configuração conhecida desejada para implantar.</span><span class="sxs-lookup"><span data-stu-id="3e871-309">In the main template, a parameter can be exposed to allow the template consumer to specify a desired known configuration to deploy.</span></span> <span data-ttu-id="3e871-310">Muitas vezes, essa configuração usa uma abordagem de tamanho de camiseta com um conjunto de tamanhos de configuração fixa, como área restrita, pequeno, médio e grande.</span><span class="sxs-lookup"><span data-stu-id="3e871-310">Often, this known configuration uses a t-shirt size approach with a set of fixed configuration sizes such as sandbox, small, medium, and large.</span></span>

![Recursos de configuração conhecida](./media/best-practices-resource-manager-design-templates/known-config.png)

<span data-ttu-id="3e871-312">**Modelo de recursos de configuração conhecida**</span><span class="sxs-lookup"><span data-stu-id="3e871-312">**Known configuration resources template**</span></span>

<span data-ttu-id="3e871-313">A abordagem de tamanho de camiseta é usada frequentemente, mas os parâmetros podem representar qualquer conjunto de configurações conhecidas.</span><span class="sxs-lookup"><span data-stu-id="3e871-313">The t-shirt size approach is commonly used, but the parameters can represent any set of known configurations.</span></span> <span data-ttu-id="3e871-314">Por exemplo, você pode especificar um conjunto de ambientes para um aplicativo empresarial como Development, Test e Product.</span><span class="sxs-lookup"><span data-stu-id="3e871-314">For example, you can specify a set of environments for an enterprise application such as Development, Test, and Product.</span></span> <span data-ttu-id="3e871-315">Ou você pode usá-lo para um serviço de nuvem representar unidades de escala, versões do produto ou configurações de produto diferentes, como Community, Developer ou Enterprise.</span><span class="sxs-lookup"><span data-stu-id="3e871-315">Or you could use it for a cloud service to represent different scale units, product versions, or product configurations such as Community, Developer, or Enterprise.</span></span>

<span data-ttu-id="3e871-316">Assim como acontece com o modelo de recurso compartilhado, variáveis são passadas para o modelo de configurações conhecidas de um dos entes citados a seguir:</span><span class="sxs-lookup"><span data-stu-id="3e871-316">As with the shared resource template, variables are passed to the known configurations template from either:</span></span>

* <span data-ttu-id="3e871-317">Um usuário final - ou seja, os parâmetros enviados para o modelo principal.</span><span class="sxs-lookup"><span data-stu-id="3e871-317">An end user—that is, the parameters sent to the main template.</span></span>
* <span data-ttu-id="3e871-318">Uma organização - ou seja, as variáveis no modelo principal que representam requisitos ou políticas internos.</span><span class="sxs-lookup"><span data-stu-id="3e871-318">An organization—that is, the variables in the main template that represent internal requirements or policies.</span></span>

### <a name="member-resources-template"></a><span data-ttu-id="3e871-319">Modelo de recursos de membro</span><span class="sxs-lookup"><span data-stu-id="3e871-319">Member resources template</span></span>
<span data-ttu-id="3e871-320">Em uma configuração conhecida, um ou mais tipos de nó de membro costumam ser incluídos.</span><span class="sxs-lookup"><span data-stu-id="3e871-320">Within a known configuration, one or more member node types are often included.</span></span> <span data-ttu-id="3e871-321">Por exemplo, com o Hadoop, você tem nós mestres e nós de dados.</span><span class="sxs-lookup"><span data-stu-id="3e871-321">For example, with Hadoop you have master nodes and data nodes.</span></span> <span data-ttu-id="3e871-322">Se estiver instalando o MongoDB, você terá nós de dados e um arbitrador.</span><span class="sxs-lookup"><span data-stu-id="3e871-322">If you are installing MongoDB, you have data nodes and an arbiter.</span></span> <span data-ttu-id="3e871-323">Se está implantando o DataStax, você tem nós de dados e uma máquina virtual com OpsCenter instalado.</span><span class="sxs-lookup"><span data-stu-id="3e871-323">If you are deploying DataStax, you have data nodes and a VM with OpsCenter installed.</span></span>

![Recursos de membros](./media/best-practices-resource-manager-design-templates/member-resources.png)

<span data-ttu-id="3e871-325">**Modelo de recursos de membro**</span><span class="sxs-lookup"><span data-stu-id="3e871-325">**Member resources template**</span></span>

<span data-ttu-id="3e871-326">Cada tipo de nó pode ter diferentes tamanhos de VMs, números de discos conectados, scripts para instalar e configurar os nós, configurações de porta para as VMs, número de instâncias e outros detalhes.</span><span class="sxs-lookup"><span data-stu-id="3e871-326">Each type of nodes can have different sizes of VMs, numbers of attached disks, scripts to install and set up the nodes, port configurations for the VMs, number of instances, and other details.</span></span> <span data-ttu-id="3e871-327">Portanto, cada tipo de nó obtém seu próprio modelo de recurso de membro, que contém os detalhes para implantação e configuração de uma infraestrutura, bem como execução de scripts para implantar e configurar o software na VM.</span><span class="sxs-lookup"><span data-stu-id="3e871-327">So each node type gets its own member resource template, which contains the details for deploying and configuring an infrastructure as well as executing scripts to deploy and configure software within the VM.</span></span>

<span data-ttu-id="3e871-328">Para VMs, geralmente dois tipos de scripts são utilizados: os amplamente reutilizáveis e os personalizados.</span><span class="sxs-lookup"><span data-stu-id="3e871-328">For VMs, typically two types of scripts are used, widely reusable and custom scripts.</span></span>

### <a name="widely-reusable-scripts"></a><span data-ttu-id="3e871-329">Scripts amplamente reutilizáveis</span><span class="sxs-lookup"><span data-stu-id="3e871-329">Widely reusable scripts</span></span>
<span data-ttu-id="3e871-330">Scripts amplamente reutilizáveis podem ser usados em vários tipos de modelos.</span><span class="sxs-lookup"><span data-stu-id="3e871-330">Widely reusable scripts can be used across multiple types of templates.</span></span> <span data-ttu-id="3e871-331">Um dos melhores exemplos desses scripts amplamente reutilizáveis define o RAID no Linux para efetuar o pooling de discos e obter um maior número de IOPS.</span><span class="sxs-lookup"><span data-stu-id="3e871-331">One of the better examples of these widely reusable scripts sets up RAID on Linux to pool disks and gain a greater number of IOPS.</span></span> <span data-ttu-id="3e871-332">Independentemente do software que está sendo instalado na VM, esse script oferece a reutilização de práticas comprovadas para cenários comuns.</span><span class="sxs-lookup"><span data-stu-id="3e871-332">Regardless of the software being installed in the VM, this script provides reuse of proven practices for common scenarios.</span></span>

![Scripts reutilizáveis](./media/best-practices-resource-manager-design-templates/reusable-scripts.png)

<span data-ttu-id="3e871-334">**Modelos de recursos de membro podem chamar scripts amplamente reutilizáveis**</span><span class="sxs-lookup"><span data-stu-id="3e871-334">**Member resources templates can call widely reusable scripts**</span></span>

### <a name="custom-scripts"></a><span data-ttu-id="3e871-335">Scripts personalizados</span><span class="sxs-lookup"><span data-stu-id="3e871-335">Custom scripts</span></span>
<span data-ttu-id="3e871-336">Modelos normalmente chamam um ou mais scripts que instalam e configuram software em máquinas virtuais.</span><span class="sxs-lookup"><span data-stu-id="3e871-336">Templates commonly call one or more scripts that install and configure software within VMs.</span></span> <span data-ttu-id="3e871-337">Um padrão comum é visto com grandes topologias em que várias instâncias de um ou mais tipos de membro são implantadas.</span><span class="sxs-lookup"><span data-stu-id="3e871-337">A common pattern is seen with large topologies where multiple instances of one or more member types are deployed.</span></span> <span data-ttu-id="3e871-338">Um script de instalação é iniciado para cada VM que pode ser executada em paralelo, seguido por um script de instalação que é chamado depois que todas as máquinas virtuais (ou todas as máquinas virtuais de um determinado tipo de membro) são implantadas.</span><span class="sxs-lookup"><span data-stu-id="3e871-338">An installation script is initiated for every VM that can be run in parallel, followed by a setup script that is called after all VMs (or all VMs of a given member type) are deployed.</span></span>

![Scripts personalizados](./media/best-practices-resource-manager-design-templates/custom-scripts.png)

<span data-ttu-id="3e871-340">**Modelos de recursos de membro podem chamar scripts para uma finalidade específica, como a configuração da VM**</span><span class="sxs-lookup"><span data-stu-id="3e871-340">**Member resources templates can call scripts for a specific purpose such as VM configuration**</span></span>

## <a name="capability-scoped-solution-template-example---redis"></a><span data-ttu-id="3e871-341">Exemplo de modelo de solução no escopo de funcionalidade - Redis</span><span class="sxs-lookup"><span data-stu-id="3e871-341">Capability-scoped solution template example - Redis</span></span>
<span data-ttu-id="3e871-342">Para mostrar como uma implementação pode funcionar, vamos examinar um exemplo prático de como criar um modelo que facilita a implantação e configuração do Redis em tamanhos de camiseta padrão.</span><span class="sxs-lookup"><span data-stu-id="3e871-342">To show how an implementation might work, let's look at a practical example of building a template that facilitates the deployment and configuration of Redis in standard t-shirt sizes.</span></span>  

<span data-ttu-id="3e871-343">Para a implantação, há um conjunto de recursos compartilhados (rede virtual, conta de armazenamento, conjuntos de disponibilidade) e um recurso opcional (jumpbox).</span><span class="sxs-lookup"><span data-stu-id="3e871-343">For the deployment, there are a set of shared resources (virtual network, storage account, availability sets) and an optional resource (jumpbox).</span></span> <span data-ttu-id="3e871-344">Há várias configurações conhecidas representadas como tamanhos de camiseta (pequeno, médio, grande), mas cada uma com um único tipo de nó.</span><span class="sxs-lookup"><span data-stu-id="3e871-344">There are multiple known configurations represented as t-shirt sizes (small, medium, large) but each with a single node type.</span></span> <span data-ttu-id="3e871-345">Há também dois scripts específicos para a finalidade (instalação, configuração).</span><span class="sxs-lookup"><span data-stu-id="3e871-345">There are also two purpose-specific scripts (installation, configuration).</span></span>

### <a name="creating-the-template-files"></a><span data-ttu-id="3e871-346">Criando os arquivos de modelo</span><span class="sxs-lookup"><span data-stu-id="3e871-346">Creating the template files</span></span>
<span data-ttu-id="3e871-347">Você cria um modelo principal chamado azuredeploy.json.</span><span class="sxs-lookup"><span data-stu-id="3e871-347">You would create a Main Template named azuredeploy.json.</span></span>

<span data-ttu-id="3e871-348">Você cria um modelo de recursos compartilhados chamado shared-resources.json</span><span class="sxs-lookup"><span data-stu-id="3e871-348">You create Shared Resources Template named shared-resources.json</span></span>

<span data-ttu-id="3e871-349">Você cria um modelo de recurso opcional para habilitar a implantação de um jumpbox denominado jumpbox_enabled.json</span><span class="sxs-lookup"><span data-stu-id="3e871-349">You create an Optional Resource Template to enable the deployment of a jumpbox, named jumpbox_enabled.json</span></span>

<span data-ttu-id="3e871-350">O Redis usa apenas um tipo de nó, portanto, você cria um modelo único de recurso de membro chamado node-resources.json.</span><span class="sxs-lookup"><span data-stu-id="3e871-350">Redis uses just a single node type, so you create a single Member Resource Template named node-resources.json.</span></span>

<span data-ttu-id="3e871-351">Com o Redis, convém instalar cada nó individual e, em seguida, configurar o cluster.</span><span class="sxs-lookup"><span data-stu-id="3e871-351">With Redis, you want to install each individual node, and then set up the cluster.</span></span>  <span data-ttu-id="3e871-352">Você tem scripts para acomodar a instalação e configurar, redis-cluster-install.sh e redis-cluster-setup.sh.</span><span class="sxs-lookup"><span data-stu-id="3e871-352">You have scripts to accommodate the installation and set up, redis-cluster-install.sh and redis-cluster-setup.sh.</span></span>

### <a name="linking-the-templates"></a><span data-ttu-id="3e871-353">Vinculando os modelos</span><span class="sxs-lookup"><span data-stu-id="3e871-353">Linking the templates</span></span>
<span data-ttu-id="3e871-354">Usando vinculação de modelos, o modelo principal vincula-se ao modelo de recursos compartilhados, o que estabelece a rede virtual.</span><span class="sxs-lookup"><span data-stu-id="3e871-354">Using template linking, the main template links out to the shared resources template, which establishes the virtual network.</span></span>

<span data-ttu-id="3e871-355">A lógica é adicionada dentro do modelo principal para permitir que os consumidores do modelo especifiquem se um jumpbox deve ou não ser implantado.</span><span class="sxs-lookup"><span data-stu-id="3e871-355">Logic is added within the main template to enable consumers of the template to specify whether a jumpbox should be deployed.</span></span> <span data-ttu-id="3e871-356">Um valor *enabled* para o parâmetro *EnableJumpbox* indica que o cliente deseja implantar um jumpbox.</span><span class="sxs-lookup"><span data-stu-id="3e871-356">An *enabled* value for the *EnableJumpbox* parameter indicates that the customer wants to deploy a jumpbox.</span></span> <span data-ttu-id="3e871-357">Quando esse valor é fornecido, o modelo concatena *_enabled* como um sufixo para um nome de modelo base para a funcionalidade de jumpbox.</span><span class="sxs-lookup"><span data-stu-id="3e871-357">When this value is provided, the template concatenates *_enabled* as a suffix to a base template name for the jumpbox capability.</span></span>

<span data-ttu-id="3e871-358">O modelo principal aplica o valor de parâmetro *large* como um sufixo para um nome de modelo base para tamanhos de camiseta, então usa esse valor em uma vinculação de modelo para *technology_on_os_large.json*.</span><span class="sxs-lookup"><span data-stu-id="3e871-358">The main template applies the *large* parameter value as a suffix to a base template name for t-shirt sizes, and then uses that value in a template link out to *technology_on_os_large.json*.</span></span>

<span data-ttu-id="3e871-359">A topologia seria semelhante a essa ilustração.</span><span class="sxs-lookup"><span data-stu-id="3e871-359">The topology would resemble this illustration.</span></span>

![Modelo de Redis](./media/best-practices-resource-manager-design-templates/redis-template.png)

<span data-ttu-id="3e871-361">**Estrutura de modelo para um modelo de Redis**</span><span class="sxs-lookup"><span data-stu-id="3e871-361">**Template structure for a Redis template**</span></span>

### <a name="configuring-state"></a><span data-ttu-id="3e871-362">Configurando o estado</span><span class="sxs-lookup"><span data-stu-id="3e871-362">Configuring state</span></span>
<span data-ttu-id="3e871-363">Para os nós no cluster, há duas etapas para configurar o estado, representadas por Scripts de Finalidade Específica.</span><span class="sxs-lookup"><span data-stu-id="3e871-363">For the nodes in the cluster, there are two steps to configuring the state, both represented by Purpose Specific Scripts.</span></span>  <span data-ttu-id="3e871-364">"redis-cluster-install.sh" instala o Redis e "redis-cluster-setup.sh" configura o cluster.</span><span class="sxs-lookup"><span data-stu-id="3e871-364">"redis-cluster-install.sh" installs Redis and "redis-cluster-setup.sh" sets up the cluster.</span></span>

### <a name="supporting-different-size-deployments"></a><span data-ttu-id="3e871-365">Suporte a implantações de tamanho diferente</span><span class="sxs-lookup"><span data-stu-id="3e871-365">Supporting Different Size Deployments</span></span>
<span data-ttu-id="3e871-366">Nas variáveis, o modelo de tamanho de camiseta especifica o número de nós de cada tipo a ser implantado para o tamanho especificado (*large*).</span><span class="sxs-lookup"><span data-stu-id="3e871-366">Inside variables, the t-shirt size template specifies the number of nodes of each type to deploy for the specified size (*large*).</span></span> <span data-ttu-id="3e871-367">Em seguida, implanta esse número de instâncias de VM usando loops de recursos, fornecendo nomes exclusivos para recursos ao acrescentar um nome de nó com um número de sequência numérica de *copyIndex()*.</span><span class="sxs-lookup"><span data-stu-id="3e871-367">It then deploys that number of VM instances using resource loops, providing unique names to resources by appending a node name with a numeric sequence number from *copyIndex()*.</span></span> <span data-ttu-id="3e871-368">Ele executa essas etapas tanto para VMs de zona temperada quanto de zona quente, conforme definido no modelo de nome de camiseta</span><span class="sxs-lookup"><span data-stu-id="3e871-368">It does these steps for both hot and warm zone VMs, as defined in the t-shirt name template</span></span>

## <a name="decomposition-and-end-to-end-solution-scoped-templates"></a><span data-ttu-id="3e871-369">Modelos com escopo de solução de ponta a ponta e decomposição</span><span class="sxs-lookup"><span data-stu-id="3e871-369">Decomposition and end-to-end solution scoped templates</span></span>
<span data-ttu-id="3e871-370">Um modelo de solução com um escopo de solução de ponta a ponta se concentra em fornecer uma solução desse tipo.</span><span class="sxs-lookup"><span data-stu-id="3e871-370">A solution template with an end-to-end solution scope is focused on delivering an end-to-end solution.</span></span>  <span data-ttu-id="3e871-371">Normalmente, essa abordagem é uma composição de vários modelos com escopo de funcionalidade com recursos, lógica e estado adicionais.</span><span class="sxs-lookup"><span data-stu-id="3e871-371">This approach is typically a composition of multiple capability-scoped templates with additional resources, logic, and state.</span></span>

<span data-ttu-id="3e871-372">Conforme realçado na imagem abaixo, o mesmo modelo usado para modelos com escopo de funcionalidade estende-se a modelos com escopo de solução de ponta a ponta.</span><span class="sxs-lookup"><span data-stu-id="3e871-372">As highlighted in the image below, the same model used for capability scoped templates is extended for templates with an End-to-End Solution Scope.</span></span>

<span data-ttu-id="3e871-373">Um modelo de recursos compartilhados e modelos de recursos opcionais têm a mesma função que as observadas nas abordagens de modelo com escopo de capacidade e de funcionalidade, mas têm o escopo para solução de ponta a ponta.</span><span class="sxs-lookup"><span data-stu-id="3e871-373">A Shared Resources Template and Optional Resources Templates serve the same function as in the capacity and capability scoped template approaches, but are scoped for the end to end solution.</span></span>

<span data-ttu-id="3e871-374">Já que os modelos com escopo de solução de ponta a ponta também podem normalmente ter tamanhos de roupa, o modelo de recursos de configuração conhecida reflete o que é necessário para uma determinada configuração conhecida da solução.</span><span class="sxs-lookup"><span data-stu-id="3e871-374">As end to end solution scoped templates also can typically have t-shirt sizes, the Known Configuration Resources template reflects what is required for a given known configuration of the solution.</span></span>

<span data-ttu-id="3e871-375">O modelo de recursos de configuração conhecida se vincula a um ou mais modelos de solução com escopo de funcionalidade que são relevantes para a solução de ponta a ponta, bem como os modelos de recursos de membro que são necessários para a solução de ponta a ponta.</span><span class="sxs-lookup"><span data-stu-id="3e871-375">The Known Configuration Resources Template links to one or more capability scoped solution templates that are relevant to the end to end solution as well as the Member Resource Templates that are required for the end to end solution.</span></span>

<span data-ttu-id="3e871-376">Assim como o tamanho de camiseta da solução pode ser diferente do modelo individual com escopo de funcionalidade, as variáveis dentro do Modelo de Recursos de Configuração Conhecida são usadas para fornecer os valores apropriados em downstream para os modelos de solução com escopo de funcionalidade para implantar o tamanho de camiseta apropriado.</span><span class="sxs-lookup"><span data-stu-id="3e871-376">As the t-shirt size of the solution may be different than the individual capability-scoped template, variables within the Known Configuration Resources Template are used to provide the appropriate values for downstream capability scoped solution templates to deploy the appropriate t-shirt size.</span></span>

![Ponta a ponta](./media/best-practices-resource-manager-design-templates/end-to-end.png)

<span data-ttu-id="3e871-378">**O modelo usado para modelos de solução com escopo de capacidade ou funcionalidade podem ser prontamente estendidos para escopos de modelo de solução de ponta a ponta**</span><span class="sxs-lookup"><span data-stu-id="3e871-378">**The model used for capacity or capability scoped solution templates can be readily extended for end to end solution template scopes**</span></span>

## <a name="preparing-templates-for-the-marketplace"></a><span data-ttu-id="3e871-379">Preparando modelos para o Marketplace</span><span class="sxs-lookup"><span data-stu-id="3e871-379">Preparing templates for the Marketplace</span></span>
<span data-ttu-id="3e871-380">A abordagem anterior acomoda prontamente cenários em que as empresas, SIs e CSVs desejam implantar os modelos ou então habilitar seus clientes a implantar esses modelos por conta própria.</span><span class="sxs-lookup"><span data-stu-id="3e871-380">The preceding approach readily accommodates scenarios where Enterprises, SIs, and CSVs want to either deploy the templates themselves or enable their customers to deploy on their own.</span></span>

<span data-ttu-id="3e871-381">Outro cenário desejado é implantar um modelo por meio do marketplace.</span><span class="sxs-lookup"><span data-stu-id="3e871-381">Another desired scenario is deploying a template via the marketplace.</span></span>  <span data-ttu-id="3e871-382">Essa abordagem de decomposição funciona para o marketplace também, com algumas pequenas alterações.</span><span class="sxs-lookup"><span data-stu-id="3e871-382">This decomposition approach works for the marketplace as well, with some minor changes.</span></span>

<span data-ttu-id="3e871-383">Conforme mencionado anteriormente, os modelos podem ser usados para oferecer tipos distintos de implantação para venda no marketplace.</span><span class="sxs-lookup"><span data-stu-id="3e871-383">As mentioned previously, templates can be used to offer distinct deployment types for sale in the marketplace.</span></span> <span data-ttu-id="3e871-384">Tipos distintos de implantação podem ser tamanhos de camiseta (pequeno, médio, grande), tipo de produto/público (community, developer, enterprise) ou tipo de recurso (básico, de alta disponibilidade).</span><span class="sxs-lookup"><span data-stu-id="3e871-384">Distinct deployment types may be t-shirt sizes (small, medium, large), product/audience type (community, developer, enterprise), or feature type (basic, high availability).</span></span>

<span data-ttu-id="3e871-385">Conforme mostrado abaixo, a solução de ponta a ponta existente ou modelos com escopo de funcionalidade podem ser prontamente utilizados para listar as diferentes configurações conhecidas no marketplace.</span><span class="sxs-lookup"><span data-stu-id="3e871-385">As shown below, the existing end to end solution or capability scoped templates can be readily utilized to list the different known configurations in the marketplace.</span></span>

<span data-ttu-id="3e871-386">Primeiro, os parâmetros para o modelo principal são modificados para remover o parâmetro de entrada chamado tshirtSize.</span><span class="sxs-lookup"><span data-stu-id="3e871-386">The parameters to the main template are first modified to remove the inbound parameter named tshirtSize.</span></span>

<span data-ttu-id="3e871-387">Embora os tipos de implantação distintos sejam mapeados para o modelo de recursos de configuração conhecida, eles também precisam das configurações e recursos comuns encontrados no modelo de recursos compartilhados e, potencialmente, daqueles nos modelos de recursos opcionais.</span><span class="sxs-lookup"><span data-stu-id="3e871-387">While the distinct deployment types map to the Known Configuration Resources Template, they also need the common resources and configuration found in the Shared Resources Template and potentially those in Optional Resource Templates.</span></span>

<span data-ttu-id="3e871-388">Se desejar publicar seu modelo no marketplace, estabeleça cópias distintas do seu modelo principal que substitui o parâmetro de entrada tshirtSize anteriormente disponível para uma variável inserida no modelo.</span><span class="sxs-lookup"><span data-stu-id="3e871-388">If you want to publish your template to the marketplace, you establish distinct copies of your Main template that replaces the previously available inbound parameter of tshirtSize to a variable embedded within the template.</span></span>

![Marketplace](./media/best-practices-resource-manager-design-templates/marketplace.png)

<span data-ttu-id="3e871-390">**Adaptando um modelo com escopo de solução para o marketplace**</span><span class="sxs-lookup"><span data-stu-id="3e871-390">**Adapting a solution scoped template for the marketplace**</span></span>

## <a name="next-steps"></a><span data-ttu-id="3e871-391">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="3e871-391">Next steps</span></span>
* <span data-ttu-id="3e871-392">Para saber mais sobre como compartilhar o estado dentro e fora dos modelos, consulte [Compartilhando estado em modelos do Gerenciador de Recursos do Azure](best-practices-resource-manager-state.md).</span><span class="sxs-lookup"><span data-stu-id="3e871-392">To learn about sharing state into and out of templates, see [Sharing state in Azure Resource Manager templates](best-practices-resource-manager-state.md).</span></span>
* <span data-ttu-id="3e871-393">Para obter orientação sobre como as empresas podem usar o Resource Manager para gerenciar assinaturas de forma eficaz, consulte [Azure enterprise scaffold – controle de assinatura prescritivas](resource-manager-subscription-governance.md).</span><span class="sxs-lookup"><span data-stu-id="3e871-393">For guidance on how enterprises can use Resource Manager to effectively manage subscriptions, see [Azure enterprise scaffold - prescriptive subscription governance](resource-manager-subscription-governance.md).</span></span>

