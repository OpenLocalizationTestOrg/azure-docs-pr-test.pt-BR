---
title: 'Otimizar o roteamento de ExpressRoute: Azure | Microsoft Docs'
description: "Esta página fornece detalhes sobre como toooptimize roteamento quando você tiver mais de um ExpressRoute circuitos que conectar-se entre a Microsoft e sua rede corp."
documentationcenter: na
services: expressroute
author: charwen
manager: carmonm
editor: 
ms.assetid: fca53249-d9c3-4cff-8916-f8749386a4dd
ms.service: expressroute
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/06/2017
ms.author: charwen
ms.openlocfilehash: ebcfb638f67a9ac78c3e476668bfd0bb0ffb9985
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="optimize-expressroute-routing"></a><span data-ttu-id="665b2-103">Otimizar o roteamento do ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="665b2-103">Optimize ExpressRoute Routing</span></span>
<span data-ttu-id="665b2-104">Quando você tiver vários circuitos de rota expressa, você tem mais de um tooMicrosoft tooconnect de caminho.</span><span class="sxs-lookup"><span data-stu-id="665b2-104">When you have multiple ExpressRoute circuits, you have more than one path tooconnect tooMicrosoft.</span></span> <span data-ttu-id="665b2-105">Como resultado, roteamento abaixo do ideal pode acontecer - ou seja, o tráfego pode levar uma tooreach de caminho mais Microsoft e a rede da Microsoft tooyour.</span><span class="sxs-lookup"><span data-stu-id="665b2-105">As a result, suboptimal routing may happen - that is, your traffic may take a longer path tooreach Microsoft, and Microsoft tooyour network.</span></span> <span data-ttu-id="665b2-106">Olá mais Olá caminho de rede, latência mais alta de Olá Olá.</span><span class="sxs-lookup"><span data-stu-id="665b2-106">hello longer hello network path, hello higher hello latency.</span></span> <span data-ttu-id="665b2-107">A latência tem impacto direto na experiência de usuário e no desempenho do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="665b2-107">Latency has direct impact on application performance and user experience.</span></span> <span data-ttu-id="665b2-108">Este artigo ilustram esse problema e explicar como toooptimize roteamento usando Olá tecnologias padrão de roteamentos.</span><span class="sxs-lookup"><span data-stu-id="665b2-108">This article will illustrate this problem and explain how toooptimize routing using hello standard routing technologies.</span></span>

## <a name="suboptimal-routing-from-customer-toomicrosoft"></a><span data-ttu-id="665b2-109">Qualidade inferior de roteamento do cliente tooMicrosoft</span><span class="sxs-lookup"><span data-stu-id="665b2-109">Suboptimal routing from customer tooMicrosoft</span></span>
<span data-ttu-id="665b2-110">Vamos dar uma olhada Fechar ao problema de roteamento Olá por um exemplo.</span><span class="sxs-lookup"><span data-stu-id="665b2-110">Let's take a close look at hello routing problem by an example.</span></span> <span data-ttu-id="665b2-111">Imagine que você tem dois escritórios em Olá dos Estados Unidos, um em Los Angeles e um em Nova York.</span><span class="sxs-lookup"><span data-stu-id="665b2-111">Imagine you have two offices in hello US, one in Los Angeles and one in New York.</span></span> <span data-ttu-id="665b2-112">Seus escritórios estão conectados em uma WAN (rede de longa distância), que pode ser sua própria rede backbone ou VPN de IP do provedor de serviços.</span><span class="sxs-lookup"><span data-stu-id="665b2-112">Your offices are connected on a Wide Area Network (WAN), which can be either your own backbone network or your service provider's IP VPN.</span></span> <span data-ttu-id="665b2-113">Você tem dois circuitos de rota expressa, um em US West e um em US East, que também estão conectados no hello WAN.</span><span class="sxs-lookup"><span data-stu-id="665b2-113">You have two ExpressRoute circuits, one in US West and one in US East, that are also connected on hello WAN.</span></span> <span data-ttu-id="665b2-114">Obviamente, você tem dois caminhos tooconnect toohello MSN.</span><span class="sxs-lookup"><span data-stu-id="665b2-114">Obviously, you have two paths tooconnect toohello Microsoft network.</span></span> <span data-ttu-id="665b2-115">Agora imagine que você tem a implantação do Azure (por exemplo, o Serviço de Aplicativo do Azure) no Oeste dos EUA e no Leste dos EUA.</span><span class="sxs-lookup"><span data-stu-id="665b2-115">Now imagine you have Azure deployment (for example, Azure App Service) in both US West and US East.</span></span> <span data-ttu-id="665b2-116">Sua intenção é tooconnect seus usuários em Los Angeles tooAzure US West e seus usuários em Nova York tooAzure US East porque seu administrador de serviço anuncia que os usuários em cada acesso office Olá nas proximidades de serviços do Azure melhores experiências.</span><span class="sxs-lookup"><span data-stu-id="665b2-116">Your intention is tooconnect your users in Los Angeles tooAzure US West and your users in New York tooAzure US East because your service admin advertises that users in each office access hello nearby Azure services for optimal experiences.</span></span> <span data-ttu-id="665b2-117">Infelizmente, plano Olá estabelece bem para os usuários do hello Costa Leste, mas não para os usuários do hello Costa Oeste.</span><span class="sxs-lookup"><span data-stu-id="665b2-117">Unfortunately, hello plan works out well for hello east coast users but not for hello west coast users.</span></span> <span data-ttu-id="665b2-118">Olá causa problema Olá é seguir hello.</span><span class="sxs-lookup"><span data-stu-id="665b2-118">hello cause of hello problem is hello following.</span></span> <span data-ttu-id="665b2-119">Cada circuito de rota expressa, podemos anunciar tooyou tanto prefixo Olá no Azure US East (23.100.0.0/16) e o prefixo de saudação no Azure US West (13.100.0.0/16).</span><span class="sxs-lookup"><span data-stu-id="665b2-119">On each ExpressRoute circuit, we advertise tooyou both hello prefix in Azure US East (23.100.0.0/16) and hello prefix in Azure US West (13.100.0.0/16).</span></span> <span data-ttu-id="665b2-120">Se você não souber qual prefixo da qual região, você não é capaz de tootreat ele diferente.</span><span class="sxs-lookup"><span data-stu-id="665b2-120">If you don't know which prefix is from which region, you are not able tootreat it differently.</span></span> <span data-ttu-id="665b2-121">Sua rede WAN pode pensar dois prefixos de saudação são Leste tooUS mais próximo que US West e circular, portanto, os dois toohello de usuários do office circuito de rota expressa em US East.</span><span class="sxs-lookup"><span data-stu-id="665b2-121">Your WAN network may think both of hello prefixes are closer tooUS East than US West and therefore route both office users toohello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="665b2-122">No final do hello, você terá muitos usuários insatisfeitos em Los Angeles office de hello.</span><span class="sxs-lookup"><span data-stu-id="665b2-122">In hello end, you will have many unhappy users in hello Los Angeles office.</span></span>

![Problema de rota expressa caso 1 - qualidade inferior de roteamento do cliente tooMicrosoft](./media/expressroute-optimize-routing/expressroute-case1-problem.png)

### <a name="solution-use-bgp-communities"></a><span data-ttu-id="665b2-124">Solução: usar comunidades BGP</span><span class="sxs-lookup"><span data-stu-id="665b2-124">Solution: use BGP Communities</span></span>
<span data-ttu-id="665b2-125">toooptimize roteamento para os usuários do office, você precisa tooknow qual prefixo é do Azure US West e que do Azure US East.</span><span class="sxs-lookup"><span data-stu-id="665b2-125">toooptimize routing for both office users, you need tooknow which prefix is from Azure US West and which from Azure US East.</span></span> <span data-ttu-id="665b2-126">Nós codificamos essas informações usando [Valores da Comunidade BGP](expressroute-routing.md).</span><span class="sxs-lookup"><span data-stu-id="665b2-126">We encode this information by using [BGP Community values](expressroute-routing.md).</span></span> <span data-ttu-id="665b2-127">Atribuímos um tooeach de valor exclusivo do BGP Community região do Azure, por exemplo "12076:51004" para o Leste dos EUA, "12076:51006" para o Oeste dos EUA.</span><span class="sxs-lookup"><span data-stu-id="665b2-127">We've assigned a unique BGP Community value tooeach Azure region, e.g. "12076:51004" for US East, "12076:51006" for US West.</span></span> <span data-ttu-id="665b2-128">Agora que você sabe que prefixo é de que região do Azure, pode configurar qual circuito de ExpressRoute deve ser preferencial.</span><span class="sxs-lookup"><span data-stu-id="665b2-128">Now that you know which prefix is from which Azure region, you can configure which ExpressRoute circuit should be preferred.</span></span> <span data-ttu-id="665b2-129">Como podemos usar informações de roteamento Olá BGP tooexchange, você pode usar o roteamento do BGP preferência Local tooinfluence.</span><span class="sxs-lookup"><span data-stu-id="665b2-129">Because we use hello BGP tooexchange routing info, you can use BGP's Local Preference tooinfluence routing.</span></span> <span data-ttu-id="665b2-130">Em nosso exemplo, você pode atribuir um maior preferência local valor too13.100.0.0/16 em US West que em US East e da mesma forma, um maior preferência local valor too23.100.0.0/16 em US East que em US West.</span><span class="sxs-lookup"><span data-stu-id="665b2-130">In our example, you can assign a higher local preference value too13.100.0.0/16 in US West than in US East, and similarly, a higher local preference value too23.100.0.0/16 in US East than in US West.</span></span> <span data-ttu-id="665b2-131">Essa configuração garantirá que, quando ambos os tooMicrosoft caminhos estão disponíveis, os usuários em Los Angeles levará circuito de rota expressa Olá em US West tooconnect tooAzure US West enquanto os usuários em Nova York levar Olá rota expressa em US East tooAzure US East .</span><span class="sxs-lookup"><span data-stu-id="665b2-131">This configuration will make sure that, when both paths tooMicrosoft are available, your users in Los Angeles will take hello ExpressRoute circuit in US West tooconnect tooAzure US West whereas your users in New York take hello ExpressRoute in US East tooAzure US East.</span></span> <span data-ttu-id="665b2-132">O roteamento é otimizado em ambos os lados.</span><span class="sxs-lookup"><span data-stu-id="665b2-132">Routing is optimized on both sides.</span></span> 

![Solução de ExpressRoute, Caso 1 - usar Comunidades BGP](./media/expressroute-optimize-routing/expressroute-case1-solution.png)

> [!NOTE]
> <span data-ttu-id="665b2-134">Olá a mesma técnica, com preferência Local, pode ser aplicada toorouting do cliente tooAzure rede Virtual.</span><span class="sxs-lookup"><span data-stu-id="665b2-134">hello same technique, using Local Preference, can be applied toorouting from customer tooAzure Virtual Network.</span></span> <span data-ttu-id="665b2-135">Nós não marcar os prefixos de toohello de valor de comunidade de BGP anunciados da rede tooyour do Azure.</span><span class="sxs-lookup"><span data-stu-id="665b2-135">We don't tag BGP Community value toohello prefixes advertised from Azure tooyour network.</span></span> <span data-ttu-id="665b2-136">No entanto, como você sabe que a implantação de rede Virtual toowhich fechar seu escritório, você pode configurar seus roteadores adequadamente tooprefer um tooanother de circuito de rota expressa.</span><span class="sxs-lookup"><span data-stu-id="665b2-136">However, since you know which of your Virtual Network deployment is close toowhich of your office, you can configure your routers accordingly tooprefer one ExpressRoute circuit tooanother.</span></span>
>
>

## <a name="suboptimal-routing-from-microsoft-toocustomer"></a><span data-ttu-id="665b2-137">Qualidade inferior de roteamento do Microsoft toocustomer</span><span class="sxs-lookup"><span data-stu-id="665b2-137">Suboptimal routing from Microsoft toocustomer</span></span>
<span data-ttu-id="665b2-138">Aqui está outro exemplo em que conexões da Microsoft levar uma tooreach de caminho mais sua rede.</span><span class="sxs-lookup"><span data-stu-id="665b2-138">Here is another example where connections from Microsoft take a longer path tooreach your network.</span></span> <span data-ttu-id="665b2-139">Nesse caso, você usa servidores Exchange locais e o Exchange Online em um [ambiente híbrido](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx).</span><span class="sxs-lookup"><span data-stu-id="665b2-139">In this case, you use on-premises Exchange servers and Exchange Online in a [hybrid environment](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx).</span></span> <span data-ttu-id="665b2-140">Do escritório é conectado tooa WAN.</span><span class="sxs-lookup"><span data-stu-id="665b2-140">Your offices are connected tooa WAN.</span></span> <span data-ttu-id="665b2-141">Anunciar prefixos Olá dos seus servidores locais no seu tooMicrosoft escritórios através de circuitos do ExpressRoute Olá dois.</span><span class="sxs-lookup"><span data-stu-id="665b2-141">You advertise hello prefixes of your on-premises servers in both of your offices tooMicrosoft through hello two ExpressRoute circuits.</span></span> <span data-ttu-id="665b2-142">Exchange Online será iniciada servidores de locais de toohello conexões em casos como migração de caixa de correio.</span><span class="sxs-lookup"><span data-stu-id="665b2-142">Exchange Online will initiate connections toohello on-premises servers in cases such as mailbox migration.</span></span> <span data-ttu-id="665b2-143">Infelizmente, Olá conexão tooyour Los Angeles office é roteado toohello circuito de rota expressa em US East antes de desvio Costa do hello todo toohello back continente Oeste.</span><span class="sxs-lookup"><span data-stu-id="665b2-143">Unfortunately, hello connection tooyour Los Angeles office is routed toohello ExpressRoute circuit in US East before traversing hello entire continent back toohello west coast.</span></span> <span data-ttu-id="665b2-144">causa do problema de Olá Olá é semelhante toohello um primeiro.</span><span class="sxs-lookup"><span data-stu-id="665b2-144">hello cause of hello problem is similar toohello first one.</span></span> <span data-ttu-id="665b2-145">Sem qualquer dica, a rede da Microsoft hello não pode determinar qual prefixo de cliente é Leste tooUS fechar e qual delas é fechar tooUS Oeste.</span><span class="sxs-lookup"><span data-stu-id="665b2-145">Without any hint, hello Microsoft network can't tell which customer prefix is close tooUS East and which one is close tooUS West.</span></span> <span data-ttu-id="665b2-146">Isso acontece office de tooyour de caminho errado toopick Olá em Los Angeles.</span><span class="sxs-lookup"><span data-stu-id="665b2-146">It happens toopick hello wrong path tooyour office in Los Angeles.</span></span>

![Rota expressa caso 2 - qualidade inferior de roteamento do Microsoft toocustomer](./media/expressroute-optimize-routing/expressroute-case2-problem.png)

### <a name="solution-use-as-path-prepending"></a><span data-ttu-id="665b2-148">Solução: usar precedência de caminho AS</span><span class="sxs-lookup"><span data-stu-id="665b2-148">Solution: use AS PATH prepending</span></span>
<span data-ttu-id="665b2-149">Há dois problemas toohello de soluções.</span><span class="sxs-lookup"><span data-stu-id="665b2-149">There are two solutions toohello problem.</span></span> <span data-ttu-id="665b2-150">Olá primeiro um é que você simplesmente anunciar seu prefixo de local de escritório Los Angeles, 177.2.0.0/31, no circuito de rota expressa Olá em US West e o local do prefixo para o escritório de Nova York, 177.2.0.2/31, no circuito de rota expressa Olá em US East.</span><span class="sxs-lookup"><span data-stu-id="665b2-150">hello first one is that you simply advertise your on-premises prefix for your Los Angeles office, 177.2.0.0/31, on hello ExpressRoute circuit in US West and your on-premises prefix for your New York office, 177.2.0.2/31, on hello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="665b2-151">Como resultado, há apenas um caminho para o Microsoft tooconnect tooeach dos seus escritórios.</span><span class="sxs-lookup"><span data-stu-id="665b2-151">As a result, there is only one path for Microsoft tooconnect tooeach of your offices.</span></span> <span data-ttu-id="665b2-152">Não há nenhuma ambiguidade e o roteamento é otimizado.</span><span class="sxs-lookup"><span data-stu-id="665b2-152">There is no ambiguity and routing is optimized.</span></span> <span data-ttu-id="665b2-153">Com esse design, você precisa toothink sobre sua estratégia de failover.</span><span class="sxs-lookup"><span data-stu-id="665b2-153">With this design, you need toothink about your failover strategy.</span></span> <span data-ttu-id="665b2-154">Olá evento Olá tooMicrosoft caminho por meio de rota expressa é interrompido, será necessário toomake-se de que o Exchange Online ainda pode se conectar servidores de locais tooyour.</span><span class="sxs-lookup"><span data-stu-id="665b2-154">In hello event that hello path tooMicrosoft via ExpressRoute is broken, you need toomake sure that Exchange Online can still connect tooyour on-premises servers.</span></span> 

<span data-ttu-id="665b2-155">Olá segunda solução é que continuar tooadvertise de prefixos de saudação em ambos os circuitos de rota expressa e, além de fornecer uma dica do qual prefixo é toowhich fechar um de seus escritórios.</span><span class="sxs-lookup"><span data-stu-id="665b2-155">hello second solution is that you continue tooadvertise both of hello prefixes on both ExpressRoute circuits, and in addition you give us a hint of which prefix is close toowhich one of your offices.</span></span> <span data-ttu-id="665b2-156">Porque há suporte para o caminho do BGP porque acrescentando, você pode configurar hello como caminho para o roteamento de tooinfluence de prefixo.</span><span class="sxs-lookup"><span data-stu-id="665b2-156">Because we support BGP AS Path prepending, you can configure hello AS Path for your prefix tooinfluence routing.</span></span> <span data-ttu-id="665b2-157">Neste exemplo, você pode aumentar hello como caminho para 172.2.0.0/31 em US East para que podemos prefiram circuito de rota expressa Olá em US West para o tráfego destinado a esse prefixo (como rede será considerado toothis prefixo da saudação é menor no Oeste Olá).</span><span class="sxs-lookup"><span data-stu-id="665b2-157">In this example, you can lengthen hello AS PATH for 172.2.0.0/31 in US East so that we will prefer hello ExpressRoute circuit in US West for traffic destined for this prefix (as our network will think hello path toothis prefix is shorter in hello west).</span></span> <span data-ttu-id="665b2-158">Da mesma forma, você pode aumentar hello como caminho para 172.2.0.2/31 em US West para que é preferível circuito de rota expressa Olá em US East.</span><span class="sxs-lookup"><span data-stu-id="665b2-158">Similarly you can lengthen hello AS PATH for 172.2.0.2/31 in US West so that we'll prefer hello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="665b2-159">O roteamento é otimizado para ambos os escritórios.</span><span class="sxs-lookup"><span data-stu-id="665b2-159">Routing is optimized for both offices.</span></span> <span data-ttu-id="665b2-160">Com esse design, se um circuito do ExpressRoute for interrompido, o Exchange Online poderá ainda acessá-lo por meio de outro circuito do ExpressRoute e sua WAN.</span><span class="sxs-lookup"><span data-stu-id="665b2-160">With this design, if one ExpressRoute circuit is broken, Exchange Online can still reach you via another ExpressRoute circuit and your WAN.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="665b2-161">Removemos particulares como números em hello como caminho de prefixos de saudação recebida no Microsoft Peering.</span><span class="sxs-lookup"><span data-stu-id="665b2-161">We remove private AS numbers in hello AS PATH for hello prefixes received on Microsoft Peering.</span></span> <span data-ttu-id="665b2-162">Você precisa tooappend público como números em Olá caminho porque tooinfluence roteamento para Peering Microsoft.</span><span class="sxs-lookup"><span data-stu-id="665b2-162">You need tooappend public AS numbers in hello AS PATH tooinfluence routing for Microsoft Peering.</span></span>
> 
> 

![Solução de ExpressRoute, caso 2 - usar precedência de AS PATH](./media/expressroute-optimize-routing/expressroute-case2-solution.png)

> [!NOTE]
> <span data-ttu-id="665b2-164">Enquanto os exemplos de Olá fornecidos aqui são para a Microsoft e emparelhamentos públicos, há suporte para Olá os mesmos recursos para o emparelhamento privado hello.</span><span class="sxs-lookup"><span data-stu-id="665b2-164">While hello examples given here are for Microsoft and Public peerings, we do support hello same capabilities for hello Private peering.</span></span> <span data-ttu-id="665b2-165">Além disso, Olá caminho porque acrescentando funciona dentro de um único circuito de rota expressa, seleção de saudação tooinfluence dos caminhos de saudação primários e secundários.</span><span class="sxs-lookup"><span data-stu-id="665b2-165">Also, hello AS Path prepending works within one single ExpressRoute circuit, tooinfluence hello selection of hello primary and secondary paths.</span></span>
> 
> 

## <a name="suboptimal-routing-between-virtual-networks"></a><span data-ttu-id="665b2-166">Qualidade inferior de roteamento entre redes virtuais</span><span class="sxs-lookup"><span data-stu-id="665b2-166">Suboptimal routing between virtual networks</span></span>
<span data-ttu-id="665b2-167">Com o ExpressRoute, você pode habilitar a rede Virtual tooVirtual rede (que também é conhecido como "VNet") comunicação vinculando tooan circuito de rota expressa.</span><span class="sxs-lookup"><span data-stu-id="665b2-167">With ExpressRoute, you can enable Virtual Network tooVirtual Network (which is also known as "VNet") communication by linking them tooan ExpressRoute circuit.</span></span> <span data-ttu-id="665b2-168">Quando você vinculá-los circuitos do ExpressRoute toomultiple, roteamento abaixo do ideal pode ocorrer entre hello VNets.</span><span class="sxs-lookup"><span data-stu-id="665b2-168">When you link them toomultiple ExpressRoute circuits, suboptimal routing can happen between hello VNets.</span></span> <span data-ttu-id="665b2-169">Vamos considerar um exemplo.</span><span class="sxs-lookup"><span data-stu-id="665b2-169">Let's consider an example.</span></span> <span data-ttu-id="665b2-170">Você tem dois circuitos de ExpressRoute, um no Oeste dos EUA e outro no Leste dos EUA.</span><span class="sxs-lookup"><span data-stu-id="665b2-170">You have two ExpressRoute circuits, one in US West and one in US East.</span></span> <span data-ttu-id="665b2-171">Em cada região, você tem duas VNets.</span><span class="sxs-lookup"><span data-stu-id="665b2-171">In each region, you have two VNets.</span></span> <span data-ttu-id="665b2-172">Os servidores web são implantados em uma VNet e servidores de aplicativo hello outros.</span><span class="sxs-lookup"><span data-stu-id="665b2-172">Your web servers are deployed in one VNet and application servers in hello other.</span></span> <span data-ttu-id="665b2-173">Para redundância, você vincular Olá dois VNets no circuito de rota expressa local cada região tooboth hello e Olá remoto circuito de rota expressa.</span><span class="sxs-lookup"><span data-stu-id="665b2-173">For redundancy, you link hello two VNets in each region tooboth hello local ExpressRoute circuit and hello remote ExpressRoute circuit.</span></span> <span data-ttu-id="665b2-174">Como pode ser visto abaixo, de cada VNet existem dois toohello de caminhos outras redes.</span><span class="sxs-lookup"><span data-stu-id="665b2-174">As can be seen below, from each VNet there are two paths toohello other VNet.</span></span> <span data-ttu-id="665b2-175">Olá VNets não sabe qual circuito de rota expressa é local e qual é remoto.</span><span class="sxs-lookup"><span data-stu-id="665b2-175">hello VNets don't know which ExpressRoute circuit is local and which one is remote.</span></span> <span data-ttu-id="665b2-176">Consequentemente, como igual-custo-Multi-Path (ECMP) roteamento tooload-VNet inter balancear, alguns fluxos de tráfego levará o caminho mais longo de saudação e no circuito de rota expressa Olá remoto podem ser roteados.</span><span class="sxs-lookup"><span data-stu-id="665b2-176">Consequently as they do Equal-Cost-Multi-Path (ECMP) routing tooload-balance inter-VNet traffic, some traffic flows will take hello longer path and get routed at hello remote ExpressRoute circuit.</span></span>

![ExpressRoute, Caso 3 - qualidade inferior de roteamento entre redes virtuais](./media/expressroute-optimize-routing/expressroute-case3-problem.png)

### <a name="solution-assign-a-high-weight-toolocal-connection"></a><span data-ttu-id="665b2-178">Solução: atribuir uma conexão de toolocal peso alta</span><span class="sxs-lookup"><span data-stu-id="665b2-178">Solution: assign a high weight toolocal connection</span></span>
<span data-ttu-id="665b2-179">solução de saudação é simple.</span><span class="sxs-lookup"><span data-stu-id="665b2-179">hello solution is simple.</span></span> <span data-ttu-id="665b2-180">Como você sabe onde estão os circuitos de VNets e Olá Olá, você pode Conte-nos qual caminho deve preferir a cada rede virtual.</span><span class="sxs-lookup"><span data-stu-id="665b2-180">Since you know where hello VNets and hello circuits are, you can tell us which path each VNet should prefer.</span></span> <span data-ttu-id="665b2-181">Especificamente para este exemplo, você atribui uma conexão de local de toohello superior do peso de conexão remota toohello (consulte o exemplo de configuração hello [aqui](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection)).</span><span class="sxs-lookup"><span data-stu-id="665b2-181">Specifically for this example, you assign a higher weight toohello local connection than toohello remote connection (see hello configuration example [here](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection)).</span></span> <span data-ttu-id="665b2-182">Quando uma rede virtual recebe prefixo Olá Olá outras redes em várias conexões prefiram conexão Olá com hello maior peso toosend tráfego destinado a esse prefixo.</span><span class="sxs-lookup"><span data-stu-id="665b2-182">When a VNet receives hello prefix of hello other VNet on multiple connections it will prefer hello connection with hello highest weight toosend traffic destined for that prefix.</span></span>

![Solução de rota expressa caso 3 - atribuir peso alta toolocal conexão](./media/expressroute-optimize-routing/expressroute-case3-solution.png)

> [!NOTE]
> <span data-ttu-id="665b2-184">Você também pode influenciar o roteamento da rede de local de tooyour de rede virtual, se você tiver vários circuitos de rota expressa, configurando o peso de saudação de uma conexão em vez de aplicar AS PATH acrescentando uma técnica descrita Olá segundo cenário acima.</span><span class="sxs-lookup"><span data-stu-id="665b2-184">You can also influence routing from VNet tooyour on-premises network, if you have multiple ExpressRoute circuits, by configuring hello weight of a connection instead of applying AS PATH prepending, a technique described in hello second scenario above.</span></span> <span data-ttu-id="665b2-185">Para cada prefixo sempre examinaremos peso de conexão Olá antes Olá comprimento de caminho porque ao decidir como toosend tráfego.</span><span class="sxs-lookup"><span data-stu-id="665b2-185">For each prefix, we will always look at hello connection weight before hello AS Path length when deciding how toosend traffic.</span></span>
>
>
