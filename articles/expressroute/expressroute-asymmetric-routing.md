---
title: roteamento de aaaAsymmetric | Microsoft Docs
description: "Este artigo orienta problemas Olá que um cliente poderá enfrentar com o roteamento assimétrico em uma rede que tem o destino de tooa vários links."
documentationcenter: na
services: expressroute
author: osamazia
manager: carmonm
editor: 
ms.assetid: a754bff9-95c9-44b5-9796-377fc21e8322
ms.service: expressroute
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/10/2016
ms.author: osamam
ms.openlocfilehash: 01a16242437a3674dcfe27b074911a829a6c1abd
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="asymmetric-routing-with-multiple-network-paths"></a><span data-ttu-id="1a89c-103">Roteamento assimétrico com vários caminhos de rede</span><span class="sxs-lookup"><span data-stu-id="1a89c-103">Asymmetric routing with multiple network paths</span></span>
<span data-ttu-id="1a89c-104">Este artigo explica como o encaminhamento e o retorno do tráfego de rede podem adotar rotas diferentes quando há vários caminhos disponíveis entre a origem e o destino da rede.</span><span class="sxs-lookup"><span data-stu-id="1a89c-104">This article explains how forward and return network traffic might take different routes when multiple paths are available between network source and destination.</span></span>

<span data-ttu-id="1a89c-105">É importante toounderstand dois conceitos toounderstand assimétrica de roteamento.</span><span class="sxs-lookup"><span data-stu-id="1a89c-105">It's important toounderstand two concepts toounderstand asymmetric routing.</span></span> <span data-ttu-id="1a89c-106">Um é o efeito de saudação de vários caminhos de rede.</span><span class="sxs-lookup"><span data-stu-id="1a89c-106">One is hello effect of multiple network paths.</span></span> <span data-ttu-id="1a89c-107">Olá outros é como dispositivos, como um firewall, mantêm o estado.</span><span class="sxs-lookup"><span data-stu-id="1a89c-107">hello other is how devices, like a firewall, keep state.</span></span> <span data-ttu-id="1a89c-108">Esses tipos de dispositivos são chamados de dispositivos com estado.</span><span class="sxs-lookup"><span data-stu-id="1a89c-108">These types of devices are called stateful devices.</span></span> <span data-ttu-id="1a89c-109">Uma combinação desses dois fatores cria cenários na rede à qual o tráfego é descartado por um dispositivo com monitoração de estado porque o dispositivo com monitoração de estado Olá não detecta que o tráfego originado com o próprio dispositivo hello.</span><span class="sxs-lookup"><span data-stu-id="1a89c-109">A combination of these two factors creates scenarios in which network traffic is dropped by a stateful device because hello stateful device didn't detect that traffic originated with hello device itself.</span></span>

## <a name="multiple-network-paths"></a><span data-ttu-id="1a89c-110">Vários caminhos de rede</span><span class="sxs-lookup"><span data-stu-id="1a89c-110">Multiple network paths</span></span>
<span data-ttu-id="1a89c-111">Quando uma rede corporativa tem somente um toohello link Internet por meio de seu provedor de serviços de Internet, todos os tooand de tráfego de Internet de saudação viaja Olá mesmo caminho.</span><span class="sxs-lookup"><span data-stu-id="1a89c-111">When an enterprise network has only one link toohello Internet through their Internet service provider, all traffic tooand from hello Internet travels hello same path.</span></span> <span data-ttu-id="1a89c-112">Geralmente, as empresas compram vários circuitos, como caminhos redundantes, tempo de atividade tooimprove.</span><span class="sxs-lookup"><span data-stu-id="1a89c-112">Often, companies purchase multiple circuits, as redundant paths, tooimprove network uptime.</span></span> <span data-ttu-id="1a89c-113">Quando isso acontece, é possível que o tráfego que passa fora da rede hello, toohello Internet, passa por um link e hello retornar tráfego passa por um link diferente.</span><span class="sxs-lookup"><span data-stu-id="1a89c-113">When this happens, it's possible that traffic that goes outside of hello network, toohello Internet, goes through one link, and hello return traffic goes through a different link.</span></span> <span data-ttu-id="1a89c-114">Isso é conhecido como roteamento assimétrico.</span><span class="sxs-lookup"><span data-stu-id="1a89c-114">This is commonly known as asymmetric routing.</span></span> <span data-ttu-id="1a89c-115">Roteamento assimétrico, inversa tráfego de rede tem um caminho diferente de fluxo de saudação original.</span><span class="sxs-lookup"><span data-stu-id="1a89c-115">In asymmetric routing, reverse network traffic takes a different path from hello original flow.</span></span>

![Rede com vários caminhos](./media/expressroute-asymmetric-routing/AsymmetricRouting3.png)

<span data-ttu-id="1a89c-117">Embora ele ocorre principalmente em Olá Internet, roteamento assimétrico também se aplica a tooother combinações de vários caminhos.</span><span class="sxs-lookup"><span data-stu-id="1a89c-117">Although it primarily occurs on hello Internet, asymmetric routing also applies tooother combinations of multiple paths.</span></span> <span data-ttu-id="1a89c-118">Ele se aplica, por exemplo, caminho de Internet tooan e um caminho particular que vão toohello mesmo destino e caminhos toomultiple particulares vá toohello mesmo destino.</span><span class="sxs-lookup"><span data-stu-id="1a89c-118">It applies, for example, both tooan Internet path and a private path that go toohello same destination, and toomultiple private paths that go toohello same destination.</span></span>

<span data-ttu-id="1a89c-119">Cada roteador ao longo de forma hello, de origem toodestination, calcula tooreach de caminho melhor Olá um destino.</span><span class="sxs-lookup"><span data-stu-id="1a89c-119">Each router along hello way, from source toodestination, computes hello best path tooreach a destination.</span></span> <span data-ttu-id="1a89c-120">Olá determinação do roteador do melhor caminho possíveis se baseia em dois fatores principais:</span><span class="sxs-lookup"><span data-stu-id="1a89c-120">hello router's determination of best possible path is based on two main factors:</span></span>

* <span data-ttu-id="1a89c-121">O roteamento entre as redes externas é baseado em um protocolo de roteamento, BGP (Border Gateway Protocol).</span><span class="sxs-lookup"><span data-stu-id="1a89c-121">Routing between external networks is based on a routing protocol, Border Gateway Protocol (BGP).</span></span> <span data-ttu-id="1a89c-122">BGP usa anúncios de vizinhos e executa uma série de etapas toodetermine Olá melhor caminho toohello devem destino.</span><span class="sxs-lookup"><span data-stu-id="1a89c-122">BGP takes advertisements from neighbors and runs them through a series of steps toodetermine hello best path toohello intended destination.</span></span> <span data-ttu-id="1a89c-123">Ele armazena o melhor caminho de saudação na sua tabela de roteamento.</span><span class="sxs-lookup"><span data-stu-id="1a89c-123">It stores hello best path in its routing table.</span></span>
* <span data-ttu-id="1a89c-124">comprimento de saudação de uma máscara de sub-rede associada a uma rota influencia caminhos de roteamento.</span><span class="sxs-lookup"><span data-stu-id="1a89c-124">hello length of a subnet mask associated with a route influences routing paths.</span></span> <span data-ttu-id="1a89c-125">Se receber um roteador vários anúncios para Olá mesmo endereço IP, mas com as máscaras de sub-rede diferente, o roteador de saudação prefere anúncio Olá com uma máscara de sub-rede mais porque ele é considerado uma rota mais específica.</span><span class="sxs-lookup"><span data-stu-id="1a89c-125">If a router receives multiple advertisements for hello same IP address but with different subnet masks, hello router prefers hello advertisement with a longer subnet mask because it's considered a more specific route.</span></span>

## <a name="stateful-devices"></a><span data-ttu-id="1a89c-126">Dispositivos com estado</span><span class="sxs-lookup"><span data-stu-id="1a89c-126">Stateful devices</span></span>
<span data-ttu-id="1a89c-127">Roteadores verificar Olá cabeçalho IP de um pacote para fins de roteamento.</span><span class="sxs-lookup"><span data-stu-id="1a89c-127">Routers look at hello IP header of a packet for routing purposes.</span></span> <span data-ttu-id="1a89c-128">Alguns dispositivos pesquisar ainda mais dentro do pacote de saudação.</span><span class="sxs-lookup"><span data-stu-id="1a89c-128">Some devices look even deeper inside hello packet.</span></span> <span data-ttu-id="1a89c-129">Normalmente, esses dispositivos examinam os cabeçalhos da Camada4 (Protocolo de Controle de Transmissão - TCP; User Datagram Protocol - UDP) ou até mesmo da Camada7.</span><span class="sxs-lookup"><span data-stu-id="1a89c-129">Typically, these devices look at Layer4 (Transmission Control Protocol, or TCP; or User Datagram Protocol, or UDP), or even Layer7 (Application Layer) headers.</span></span> <span data-ttu-id="1a89c-130">Esses tipos de dispositivos são dispositivos de otimização da largura de banda ou dispositivos de segurança.</span><span class="sxs-lookup"><span data-stu-id="1a89c-130">These kinds of devices are either security devices or bandwidth-optimization devices.</span></span> 

<span data-ttu-id="1a89c-131">O firewall é um exemplo comum de dispositivo com estado.</span><span class="sxs-lookup"><span data-stu-id="1a89c-131">A firewall is a common example of a stateful device.</span></span> <span data-ttu-id="1a89c-132">Um firewall permite ou nega toopass um pacote por meio de suas interfaces com base em vários campos, como o protocolo, porta TCP/UDP e cabeçalhos de URL.</span><span class="sxs-lookup"><span data-stu-id="1a89c-132">A firewall allows or denies a packet toopass through its interfaces based on various fields such as protocol, TCP/UDP port, and URL headers.</span></span> <span data-ttu-id="1a89c-133">Esse nível de inspeção de pacotes coloca uma pesada carga de processamento no dispositivo de saudação.</span><span class="sxs-lookup"><span data-stu-id="1a89c-133">This level of packet inspection puts a heavy processing load on hello device.</span></span> <span data-ttu-id="1a89c-134">desempenho tooimprove, firewall Olá inspeciona primeiro o pacote de um fluxo de saudação.</span><span class="sxs-lookup"><span data-stu-id="1a89c-134">tooimprove performance, hello firewall inspects hello first packet of a flow.</span></span> <span data-ttu-id="1a89c-135">Se ele permite Olá pacote tooproceed, ele mantém as informações de fluxo de saudação em sua tabela de estado.</span><span class="sxs-lookup"><span data-stu-id="1a89c-135">If it allows hello packet tooproceed, it keeps hello flow information in its state table.</span></span> <span data-ttu-id="1a89c-136">Todo o fluxo de pacotes subsequentes toothis relacionados são permitidas com base na determinação de saudação inicial.</span><span class="sxs-lookup"><span data-stu-id="1a89c-136">All subsequent packets related toothis flow are allowed based on hello initial determination.</span></span> <span data-ttu-id="1a89c-137">Um pacote que é parte de um fluxo existente pode chegar ao firewall hello.</span><span class="sxs-lookup"><span data-stu-id="1a89c-137">A packet that is part of an existing flow might arrive at hello firewall.</span></span> <span data-ttu-id="1a89c-138">Se firewall Olá nenhuma informação de estado anterior sobre ele firewall Olá descarta o pacote de saudação.</span><span class="sxs-lookup"><span data-stu-id="1a89c-138">If hello firewall has no prior state information about it, hello firewall drops hello packet.</span></span>

## <a name="asymmetric-routing-with-expressroute"></a><span data-ttu-id="1a89c-139">Roteamento assimétrico com o ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="1a89c-139">Asymmetric routing with ExpressRoute</span></span>
<span data-ttu-id="1a89c-140">Quando você conectar tooMicrosoft por meio de rota expressa do Azure, as alterações de rede assim:</span><span class="sxs-lookup"><span data-stu-id="1a89c-140">When you connect tooMicrosoft through Azure ExpressRoute, your network changes like this:</span></span>

* <span data-ttu-id="1a89c-141">Você tem várias tooMicrosoft de links.</span><span class="sxs-lookup"><span data-stu-id="1a89c-141">You have multiple links tooMicrosoft.</span></span> <span data-ttu-id="1a89c-142">Um link é sua conexão de Internet existente e outra Olá é por meio de rota expressa.</span><span class="sxs-lookup"><span data-stu-id="1a89c-142">One link is your existing Internet connection, and hello other is via ExpressRoute.</span></span> <span data-ttu-id="1a89c-143">Alguns tooMicrosoft de tráfego pode percorrer Olá Internet mas voltar por meio de rota expressa, ou vice-versa.</span><span class="sxs-lookup"><span data-stu-id="1a89c-143">Some traffic tooMicrosoft might go through hello Internet but come back via ExpressRoute, or vice versa.</span></span>
* <span data-ttu-id="1a89c-144">Você recebe endereços IP mais específicos por meio do ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="1a89c-144">You receive more specific IP addresses via ExpressRoute.</span></span> <span data-ttu-id="1a89c-145">Portanto, para o tráfego do seu tooMicrosoft de rede para serviços oferecidos por meio de rota expressa, roteadores sempre preferem rota expressa.</span><span class="sxs-lookup"><span data-stu-id="1a89c-145">So, for traffic from your network tooMicrosoft for services offered via ExpressRoute, routers always prefer ExpressRoute.</span></span>

<span data-ttu-id="1a89c-146">efeito de saudação toounderstand tem destas duas alterações em uma rede, vamos considerar alguns cenários.</span><span class="sxs-lookup"><span data-stu-id="1a89c-146">toounderstand hello effect these two changes have on a network, let’s consider some scenarios.</span></span> <span data-ttu-id="1a89c-147">Por exemplo, você tem apenas um circuito toohello Internet e consumir todos os serviços da Microsoft por meio de saudação à Internet.</span><span class="sxs-lookup"><span data-stu-id="1a89c-147">As an example, you have only one circuit toohello Internet and you consume all Microsoft services via hello Internet.</span></span> <span data-ttu-id="1a89c-148">tráfego de saudação do seu percorrerá tooMicrosoft e de volta de rede Olá mesmo link da Internet e passa pelo firewall hello.</span><span class="sxs-lookup"><span data-stu-id="1a89c-148">hello traffic from your network tooMicrosoft and back traverses hello same Internet link and passes through hello firewall.</span></span> <span data-ttu-id="1a89c-149">registros de firewall Olá Olá fluxo, ele vê o primeiro pacote de saudação e retornará pacotes são permitidas porque fluxo Olá existe na tabela de estado de saudação.</span><span class="sxs-lookup"><span data-stu-id="1a89c-149">hello firewall records hello flow as it sees hello first packet and return packets are allowed because hello flow exists in hello state table.</span></span>

![Roteamento assimétrico com o ExpressRoute](./media/expressroute-asymmetric-routing/AsymmetricRouting1.png)

<span data-ttu-id="1a89c-151">Então, você ativa o ExpressRoute e consome os serviços oferecidos pela Microsoft por meio do ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="1a89c-151">Then, you turn on ExpressRoute and consume services offered by Microsoft over ExpressRoute.</span></span> <span data-ttu-id="1a89c-152">Todos os outros serviços da Microsoft são consumidos pela Olá da Internet.</span><span class="sxs-lookup"><span data-stu-id="1a89c-152">All other services from Microsoft are consumed over hello Internet.</span></span> <span data-ttu-id="1a89c-153">Você pode implantar um firewall separadas na sua borda que está conectada tooExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="1a89c-153">You deploy a separate firewall at your edge that is connected tooExpressRoute.</span></span> <span data-ttu-id="1a89c-154">Microsoft anuncia a rede de tooyour de prefixos mais específica sobre a rota expressa para serviços específicos.</span><span class="sxs-lookup"><span data-stu-id="1a89c-154">Microsoft advertises more specific prefixes tooyour network over ExpressRoute for specific services.</span></span> <span data-ttu-id="1a89c-155">Sua infraestrutura de roteamento escolhe a rota expressa como caminho de saudação preferencial para os prefixos.</span><span class="sxs-lookup"><span data-stu-id="1a89c-155">Your routing infrastructure chooses ExpressRoute as hello preferred path for those prefixes.</span></span> <span data-ttu-id="1a89c-156">Se você não é publicidade seu tooMicrosoft de endereços IP público por meio do ExpressRoute, a Microsoft se comunica com seus endereços IP públicos por meio de saudação da Internet.</span><span class="sxs-lookup"><span data-stu-id="1a89c-156">If you are not advertising your public IP addresses tooMicrosoft over ExpressRoute, Microsoft communicates with your public IP addresses via hello Internet.</span></span> <span data-ttu-id="1a89c-157">Encaminhar o tráfego de sua rede tooMicrosoft usa a rota expressa e tráfego inverso da Microsoft usa Olá da Internet.</span><span class="sxs-lookup"><span data-stu-id="1a89c-157">Forward traffic from your network tooMicrosoft uses ExpressRoute, and reverse traffic from Microsoft uses hello Internet.</span></span> <span data-ttu-id="1a89c-158">Quando o firewall Olá na borda Olá vê um pacote de resposta para um fluxo que não for encontrada na tabela de estado hello, descarta o tráfego de retorno hello.</span><span class="sxs-lookup"><span data-stu-id="1a89c-158">When hello firewall at hello edge sees a response packet for a flow that it does not find in hello state table, it drops hello return traffic.</span></span>

<span data-ttu-id="1a89c-159">Se você escolher Olá toouse mesmo conversão de endereços de rede (NAT) do pool do ExpressRoute e de saudação da Internet, você verá problemas semelhantes com clientes de saudação em sua rede em endereços IP privados.</span><span class="sxs-lookup"><span data-stu-id="1a89c-159">If you choose toouse hello same network address translation (NAT) pool for ExpressRoute and for hello Internet, you'll see similar issues with hello clients in your network on private IP addresses.</span></span> <span data-ttu-id="1a89c-160">Solicitações de serviços como o Windows Update vão via Olá Internet porque os endereços IP para esses serviços não são anunciados por meio de rota expressa.</span><span class="sxs-lookup"><span data-stu-id="1a89c-160">Requests for services like Windows Update go via hello Internet because IP addresses for these services are not advertised via ExpressRoute.</span></span> <span data-ttu-id="1a89c-161">No entanto, o tráfego de retorno Olá volta por meio de rota expressa.</span><span class="sxs-lookup"><span data-stu-id="1a89c-161">However, hello return traffic comes back via ExpressRoute.</span></span> <span data-ttu-id="1a89c-162">Se um endereço IP com a Microsoft recebe Olá a mesma máscara de sub-rede de saudação à Internet e rota expressa, ela prefere rota expressa a saudação da Internet.</span><span class="sxs-lookup"><span data-stu-id="1a89c-162">If Microsoft receives an IP address with hello same subnet mask from hello Internet and ExpressRoute, it prefers ExpressRoute over hello Internet.</span></span> <span data-ttu-id="1a89c-163">Se um firewall ou outro dispositivo com monitoração de estado que está em sua borda da rede e voltados para a rota expressa não possui anteriores informações sobre o fluxo de hello, descarta os pacotes de saudação que pertencem a toothat fluxo.</span><span class="sxs-lookup"><span data-stu-id="1a89c-163">If a firewall or another stateful device that is on your network edge and facing ExpressRoute has no prior information about hello flow, it drops hello packets that belong toothat flow.</span></span>

## <a name="asymmetric-routing-solutions"></a><span data-ttu-id="1a89c-164">Soluções do roteamento assimétrico</span><span class="sxs-lookup"><span data-stu-id="1a89c-164">Asymmetric routing solutions</span></span>
<span data-ttu-id="1a89c-165">Você tem duas opções principais toosolve Olá problema de roteamento assimétrico.</span><span class="sxs-lookup"><span data-stu-id="1a89c-165">You have two main options toosolve hello problem of asymmetric routing.</span></span> <span data-ttu-id="1a89c-166">Uma é por meio de roteamento e outros Olá é usando NAT na origem (SNAT).</span><span class="sxs-lookup"><span data-stu-id="1a89c-166">One is through routing, and hello other is by using source-based NAT (SNAT).</span></span>

### <a name="routing"></a><span data-ttu-id="1a89c-167">Roteamento</span><span class="sxs-lookup"><span data-stu-id="1a89c-167">Routing</span></span>
<span data-ttu-id="1a89c-168">Certifique-se de que os endereços IP públicos são links de rede de (longa distância WAN) de longa distância tooappropriate anunciado.</span><span class="sxs-lookup"><span data-stu-id="1a89c-168">Ensure that your public IP addresses are advertised tooappropriate wide area network (WAN) links.</span></span> <span data-ttu-id="1a89c-169">Por exemplo, se você quiser toouse Olá da Internet para o tráfego de autenticação e rota expressa para o tráfego de email, não deve anunciar seus endereços IP públicos de serviços de Federação do Active Directory (AD FS) por meio do ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="1a89c-169">For example, if you want toouse hello Internet for authentication traffic and ExpressRoute for your mail traffic, you should not advertise your Active Directory Federation Services (AD FS) public IP addresses over ExpressRoute.</span></span> <span data-ttu-id="1a89c-170">Da mesma forma, certifique-se não tooexpose um local endereços de tooIP do servidor do AD FS Olá roteador recebe pela rota expressa.</span><span class="sxs-lookup"><span data-stu-id="1a89c-170">Similarly, be sure not tooexpose an on-premises AD FS server tooIP addresses that hello router receives over ExpressRoute.</span></span> <span data-ttu-id="1a89c-171">Rotas recebidas pela rota expressa são mais específicas para que eles demarcador de rota expressa Olá preferencial para tooMicrosoft de tráfego de autenticação.</span><span class="sxs-lookup"><span data-stu-id="1a89c-171">Routes received over ExpressRoute are more specific so they make ExpressRoute hello preferred path for authentication traffic tooMicrosoft.</span></span> <span data-ttu-id="1a89c-172">Isso causa o roteamento assimétrico.</span><span class="sxs-lookup"><span data-stu-id="1a89c-172">This causes asymmetric routing.</span></span>

<span data-ttu-id="1a89c-173">Se você quiser toouse rota expressa para autenticação, certifique-se de que está anunciando os endereços IP públicos do AD FS através do ExpressRoute sem NAT.</span><span class="sxs-lookup"><span data-stu-id="1a89c-173">If you want toouse ExpressRoute for authentication, make sure that you are advertising AD FS public IP addresses over ExpressRoute without NAT.</span></span> <span data-ttu-id="1a89c-174">Dessa forma, o tráfego originado da Microsoft e vai tooan local do servidor AD FS enviados pela rota expressa.</span><span class="sxs-lookup"><span data-stu-id="1a89c-174">This way, traffic that originates from Microsoft and goes tooan on-premises AD FS server goes over ExpressRoute.</span></span> <span data-ttu-id="1a89c-175">Tráfego de retorno do cliente tooMicrosoft usa rota expressa porque é rota preferencial Olá em Olá da Internet.</span><span class="sxs-lookup"><span data-stu-id="1a89c-175">Return traffic from customer tooMicrosoft uses ExpressRoute because it's hello preferred route over hello Internet.</span></span>

### <a name="source-based-nat"></a><span data-ttu-id="1a89c-176">NAT com base em origem</span><span class="sxs-lookup"><span data-stu-id="1a89c-176">Source-based NAT</span></span>
<span data-ttu-id="1a89c-177">Outra maneira de solucionar os problemas do roteamento assimétrico é usando a SNAT.</span><span class="sxs-lookup"><span data-stu-id="1a89c-177">Another way of solving asymmetric routing issues is by using SNAT.</span></span> <span data-ttu-id="1a89c-178">Por exemplo, você não tenha anunciado endereço IP público de saudação de um servidor de SMTP Simple Mail Transfer Protocol () no local por meio do ExpressRoute porque você pretende toouse Olá esse tipo de comunicação na Internet.</span><span class="sxs-lookup"><span data-stu-id="1a89c-178">For example, you have not advertised hello public IP address of an on-premises Simple Mail Transfer Protocol (SMTP) server over ExpressRoute because you intend toouse hello Internet for this type of communication.</span></span> <span data-ttu-id="1a89c-179">Uma solicitação que se origina com a Microsoft e, em seguida, vai tooyour local do servidor SMTP atravessa Olá da Internet.</span><span class="sxs-lookup"><span data-stu-id="1a89c-179">A request that originates with Microsoft and then goes tooyour on-premises SMTP server traverses hello Internet.</span></span> <span data-ttu-id="1a89c-180">Você SNAT Olá entrada solicitação tooan endereço IP interno.</span><span class="sxs-lookup"><span data-stu-id="1a89c-180">You SNAT hello incoming request tooan internal IP address.</span></span> <span data-ttu-id="1a89c-181">Tráfego reverso do servidor de SMTP Olá vai toohello firewall de borda (que você usa para NAT) em vez de por meio de rota expressa.</span><span class="sxs-lookup"><span data-stu-id="1a89c-181">Reverse traffic from hello SMTP server goes toohello edge firewall (which you use for NAT) instead of through ExpressRoute.</span></span> <span data-ttu-id="1a89c-182">o tráfego de retorno Olá volta por meio de saudação à Internet.</span><span class="sxs-lookup"><span data-stu-id="1a89c-182">hello return traffic goes back via hello Internet.</span></span>

![Configuração de rede da NAT com base na origem](./media/expressroute-asymmetric-routing/AsymmetricRouting2.png)

## <a name="asymmetric-routing-detection"></a><span data-ttu-id="1a89c-184">Detecção de roteamento assimétrico</span><span class="sxs-lookup"><span data-stu-id="1a89c-184">Asymmetric routing detection</span></span>
<span data-ttu-id="1a89c-185">Rastreamento de rotas é Olá melhor maneira toomake-se de que o tráfego de rede está atravessando o caminho de saudação esperado.</span><span class="sxs-lookup"><span data-stu-id="1a89c-185">Traceroute is hello best way toomake sure that your network traffic is traversing hello expected path.</span></span> <span data-ttu-id="1a89c-186">Se você espera que o tráfego do seu caminho de Internet local SMTP server tooMicrosoft tootake hello, Olá esperado é de rastreamento de rotas de saudação SMTP server tooOffice 365.</span><span class="sxs-lookup"><span data-stu-id="1a89c-186">If you expect traffic from your on-premises SMTP server tooMicrosoft tootake hello Internet path, hello expected traceroute is from hello SMTP server tooOffice 365.</span></span> <span data-ttu-id="1a89c-187">resultado de saudação valida que o tráfego é realmente saiam da sua rede para saudação da Internet e não para a rota expressa.</span><span class="sxs-lookup"><span data-stu-id="1a89c-187">hello result validates that traffic is indeed leaving your network toward hello Internet and not toward ExpressRoute.</span></span>

