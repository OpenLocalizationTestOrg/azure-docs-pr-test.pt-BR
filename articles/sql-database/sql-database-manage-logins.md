---
title: "Usuários e logons do SQL do Azure | Microsoft Docs"
description: "Saiba mais sobre o gerenciamento de segurança de banco de dados SQL, especialmente sobre como gerenciar o acesso ao banco de dados e a segurança de logon por meio da conta de entidade de segurança no nível do servidor."
keywords: "segurança do banco de dados SQL, gerenciamento de segurança de banco de dados, segurança de logon, segurança de banco de dados, acesso ao banco de dados"
services: sql-database
documentationcenter: 
author: BYHAM
manager: jhubbard
editor: 
tags: 
ms.assetid: 0a65a93f-d5dc-424b-a774-7ed62d996f8c
ms.service: sql-database
ms.custom: security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-management
ms.date: 01/23/2017
ms.author: rickbyh
ms.openlocfilehash: 51edd390c065dd7312ecc54694b5a95ecc11eab8
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="controlling-and-granting-database-access"></a><span data-ttu-id="2a149-104">Controle e concessão de acesso de banco de dados</span><span class="sxs-lookup"><span data-stu-id="2a149-104">Controlling and granting database access</span></span>

<span data-ttu-id="2a149-105">Quando as regras de firewall tiverem sido configuradas, as pessoas podem se conectar a um Banco de Dados SQL como uma das contas de administrador, como o proprietário do banco de dados ou como um usuário do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="2a149-105">When firewall rules have been configured, people can connect to a SQL Database as one of the administrator accounts, as the database owner, or as a database user in the database.</span></span>  

>  [!NOTE]  
>  <span data-ttu-id="2a149-106">Este tópico aplica-se ao servidor SQL do Azure e aos bancos de dados SQL e SQL Data Warehouse criados no servidor do SQL do Azure.</span><span class="sxs-lookup"><span data-stu-id="2a149-106">This topic applies to Azure SQL server, and to both SQL Database and SQL Data Warehouse databases that are created on the Azure SQL server.</span></span> <span data-ttu-id="2a149-107">Para simplificar, o banco de dados SQL é usado quando se refere ao Banco de Dados SQL e ao SQL Data Warehouse.</span><span class="sxs-lookup"><span data-stu-id="2a149-107">For simplicity, SQL Database is used when referring to both SQL Database and SQL Data Warehouse.</span></span> 
>

> [!TIP]
> <span data-ttu-id="2a149-108">Para obter um tutorial, consulte [Proteger o Banco de Dados SQL do Azure](sql-database-security-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="2a149-108">For a tutorial, see [Secure your Azure SQL Database](sql-database-security-tutorial.md).</span></span>
>


## <a name="unrestricted-administrative-accounts"></a><span data-ttu-id="2a149-109">Contas administrativas irrestritas</span><span class="sxs-lookup"><span data-stu-id="2a149-109">Unrestricted administrative accounts</span></span>
<span data-ttu-id="2a149-110">Há duas contas administrativas (**Administrador do servidor** e **Administrador do Active Directory**) que agem como administradores.</span><span class="sxs-lookup"><span data-stu-id="2a149-110">There are two administrative accounts (**Server admin** and **Active Directory admin**) that act as administrators.</span></span> <span data-ttu-id="2a149-111">Para identificar essas contas de administrador do servidor SQL, abra o portal do Azure e navegue até as propriedades do servidor SQL.</span><span class="sxs-lookup"><span data-stu-id="2a149-111">To identify these administrator accounts for your SQL server, open the Azure portal, and navigate to the properties of your SQL server.</span></span>

![Administradores do SQL Server](./media/sql-database-manage-logins/sql-admins.png)

- <span data-ttu-id="2a149-113">**Administrador do servidor** </span><span class="sxs-lookup"><span data-stu-id="2a149-113">**Server admin** </span></span>  
<span data-ttu-id="2a149-114">Quando você cria um servidor SQL no Azure, você deve designar um **Logon de administrador do servidor**.</span><span class="sxs-lookup"><span data-stu-id="2a149-114">When you create an Azure SQL server, you must designate a **Server admin login**.</span></span> <span data-ttu-id="2a149-115">O servidor SQL cria essa conta como um logon no banco de dados mestre.</span><span class="sxs-lookup"><span data-stu-id="2a149-115">SQL server creates that account as a login in the master database.</span></span> <span data-ttu-id="2a149-116">Essa conta é conectada usando a autenticação do SQL Server (nome de usuário e senha).</span><span class="sxs-lookup"><span data-stu-id="2a149-116">This account connects using SQL Server authentication (user name and password).</span></span> <span data-ttu-id="2a149-117">Só pode existir uma dessas contas.</span><span class="sxs-lookup"><span data-stu-id="2a149-117">Only one of these accounts can exist.</span></span>   
- <span data-ttu-id="2a149-118">**Administrador do Azure Active Directory** </span><span class="sxs-lookup"><span data-stu-id="2a149-118">**Azure Active Directory admin** </span></span>  
<span data-ttu-id="2a149-119">Uma conta do Azure Active Directory, seja ela individual ou de grupo de segurança, também pode ser configurada como um administrador.</span><span class="sxs-lookup"><span data-stu-id="2a149-119">One Azure Active Directory account, either an individual or security group account, can also be configured as an administrator.</span></span> <span data-ttu-id="2a149-120">A configuração de um administrador do Azure AD é opcional, mas é necessário configurar um administrador do Azure AD a fim de usar as contas do Azure AD para se conectar ao Banco de Dados SQL.</span><span class="sxs-lookup"><span data-stu-id="2a149-120">It is optional to configure an Azure AD administrator, but an Azure AD administrator must be configured if you want to use Azure AD accounts to connect to SQL Database.</span></span> <span data-ttu-id="2a149-121">Para saber mais sobre como configurar o acesso ao Azure Active Directory, consulte [Conexão ao Banco de Dados SQL ou ao SQL Data Warehouse usando a autenticação do Azure Active Directory](sql-database-aad-authentication.md) e [Suporte do SSMS para MFA do Azure AD com o Banco de Dados SQL e o SQL Data Warehouse](sql-database-ssms-mfa-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="2a149-121">For more information about configuring Azure Active Directory access, see [Connecting to SQL Database or SQL Data Warehouse By Using Azure Active Directory Authentication](sql-database-aad-authentication.md) and [SSMS support for Azure AD MFA with SQL Database and SQL Data Warehouse](sql-database-ssms-mfa-authentication.md).</span></span>
 

<span data-ttu-id="2a149-122">As contas do **Administrador do servidor** e do **Administrador do Azure AD** têm as seguintes características:</span><span class="sxs-lookup"><span data-stu-id="2a149-122">The **Server admin** and **Azure AD admin** accounts has the following characteristics:</span></span>
- <span data-ttu-id="2a149-123">Essas são as únicas contas que podem se conectar automaticamente a qualquer Banco de Dados SQL no servidor.</span><span class="sxs-lookup"><span data-stu-id="2a149-123">These are the only accounts that can automatically connect to any SQL Database on the server.</span></span> <span data-ttu-id="2a149-124">(Para se conectar a um banco de dados do usuário, outras contas devem ser o proprietário do banco de dados, ou ter uma conta de usuário do banco de dados do usuário.)</span><span class="sxs-lookup"><span data-stu-id="2a149-124">(To connect to a user database, other accounts must either be the owner of the database, or have a user account in the user database.)</span></span>
- <span data-ttu-id="2a149-125">Essas contas inserem bancos de dados de usuário, pois o usuário `dbo` e elas têm todas as permissões nos bancos de dados do usuário.</span><span class="sxs-lookup"><span data-stu-id="2a149-125">These accounts enter user databases as the `dbo` user and they have all the permissions in the user databases.</span></span> <span data-ttu-id="2a149-126">(O proprietário de um banco de dados do usuário também insere o banco de dados como o usuário `dbo`.)</span><span class="sxs-lookup"><span data-stu-id="2a149-126">(The owner of a user database also enters the database as the `dbo` user.)</span></span> 
- <span data-ttu-id="2a149-127">Essas contas não inserem o banco de dados `master`, pois o usuário `dbo` e elas têm permissões limitadas no mestre.</span><span class="sxs-lookup"><span data-stu-id="2a149-127">These accounts do not enter the `master` database as the `dbo` user and they have limited permissions in master.</span></span> 
- <span data-ttu-id="2a149-128">Essas contas não são membros da função de servidor fixo do SQL Server padrão `sysadmin`, que não está disponível no Banco de Dados SQL.</span><span class="sxs-lookup"><span data-stu-id="2a149-128">These accounts are not members of the standard SQL Server `sysadmin` fixed server role, which is not available in SQL database.</span></span>  
- <span data-ttu-id="2a149-129">Essas contas podem criar, alterar e remover bancos de dados, logons, usuários nas regras de firewall mestre e de nível de servidor.</span><span class="sxs-lookup"><span data-stu-id="2a149-129">These accounts can create, alter, and drop databases, logins, users in master, and server-level firewall rules.</span></span>
- <span data-ttu-id="2a149-130">Essas contas podem adicionar e remover membros das funções `dbmanager` e `loginmanager`.</span><span class="sxs-lookup"><span data-stu-id="2a149-130">These accounts can add and remove members to the `dbmanager` and `loginmanager` roles.</span></span>
- <span data-ttu-id="2a149-131">Essas contas podem visualizar a tabela do sistema `sys.sql_logins`.</span><span class="sxs-lookup"><span data-stu-id="2a149-131">These accounts can view the `sys.sql_logins` system table.</span></span>

### <a name="configuring-the-firewall"></a><span data-ttu-id="2a149-132">Configuração do firewall</span><span class="sxs-lookup"><span data-stu-id="2a149-132">Configuring the firewall</span></span>
<span data-ttu-id="2a149-133">Quando o firewall no nível do servidor é configurado para um endereço IP individual ou para um intervalo de endereços IP, o **Administrador do servidor SQL** e o **Administrador do Azure Active Directory** podem se conectar ao banco de dados mestre e a todos os bancos de dados do usuário.</span><span class="sxs-lookup"><span data-stu-id="2a149-133">When the server-level firewall is configured for an individual IP address or range, the **SQL server admin** and the **Azure Active Directory admin** can connect to the master database and all the user databases.</span></span> <span data-ttu-id="2a149-134">O firewall no nível do servidor inicial pode ser configurado por meio do [portal do Azure](sql-database-get-started-portal.md), usando o [PowerShell](sql-database-get-started-powershell.md) ou usando a [API REST](https://msdn.microsoft.com/library/azure/dn505712.aspx).</span><span class="sxs-lookup"><span data-stu-id="2a149-134">The initial server-level firewall can be configured through the [Azure portal](sql-database-get-started-portal.md), using [PowerShell](sql-database-get-started-powershell.md) or using the [REST API](https://msdn.microsoft.com/library/azure/dn505712.aspx).</span></span> <span data-ttu-id="2a149-135">Depois que uma conexão é estabelecida, as regras de firewall adicionais no nível do servidor também podem ser configuradas usando o [Transact-SQL](sql-database-configure-firewall-settings.md).</span><span class="sxs-lookup"><span data-stu-id="2a149-135">Once a connection is made, additional server-level firewall rules can also be configured by using [Transact-SQL](sql-database-configure-firewall-settings.md).</span></span>

### <a name="administrator-access-path"></a><span data-ttu-id="2a149-136">Caminho de acesso do administrador</span><span class="sxs-lookup"><span data-stu-id="2a149-136">Administrator access path</span></span>
<span data-ttu-id="2a149-137">Quando o firewall no nível de servidor é configurado corretamente, o **Administrador do servidor SQL** e o **Administrador do Azure Active Directory** podem se conectar usando ferramentas de cliente, como o SQL Server Management Studio ou o SQL Server Data Tools.</span><span class="sxs-lookup"><span data-stu-id="2a149-137">When the server-level firewall is properly configured, the **SQL server admin** and the **Azure Active Directory admin** can connect using client tools such as SQL Server Management Studio or SQL Server Data Tools.</span></span> <span data-ttu-id="2a149-138">Somente as ferramentas mais recentes fornecem todos os recursos e capacidades.</span><span class="sxs-lookup"><span data-stu-id="2a149-138">Only the latest tools provide all the features and capabilities.</span></span> <span data-ttu-id="2a149-139">O diagrama a seguir mostra uma configuração típica para as duas contas de administrador.</span><span class="sxs-lookup"><span data-stu-id="2a149-139">The following diagram shows a typical configuration for the two administrator accounts.</span></span>

![Caminho de acesso do administrador](./media/sql-database-manage-logins/1sql-db-administrator-access.png)

<span data-ttu-id="2a149-141">Ao usar uma porta aberta no firewall no nível do servidor, os administradores podem se conectar a qualquer Banco de Dados SQL.</span><span class="sxs-lookup"><span data-stu-id="2a149-141">When using an open port in the server-level firewall, administrators can connect to any SQL Database.</span></span>

### <a name="connecting-to-a-database-by-using-sql-server-management-studio"></a><span data-ttu-id="2a149-142">Conectar-se a um banco de dados usando o SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="2a149-142">Connecting to a database by using SQL Server Management Studio</span></span>
<span data-ttu-id="2a149-143">Para obter uma explicação passo a passo da criação de um servidor, de um banco de dados, de regras de firewall no nível do servidor e do uso do SQL Server Management Studio para consultar um banco de dados, veja [Introdução aos servidores, bancos de dados e regras de firewall do Banco de Dados SQL usando o portal do Azure e o SQL Server Management Studio](sql-database-get-started-portal.md).</span><span class="sxs-lookup"><span data-stu-id="2a149-143">For a walk-through of creating a server, a database, server-level firewall rules, and using SQL Server Management Studio to query a database, see [Get started with Azure SQL Database servers, databases, and firewall rules by using the Azure portal and SQL Server Management Studio](sql-database-get-started-portal.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="2a149-144">Recomendamos que você sempre use a versão mais recente do Management Studio a fim de permanecer sincronizado com as atualizações no Microsoft Azure e no Banco de Dados SQL.</span><span class="sxs-lookup"><span data-stu-id="2a149-144">It is recommended that you always use the latest version of Management Studio to remain synchronized with updates to Microsoft Azure and SQL Database.</span></span> <span data-ttu-id="2a149-145">[Atualizar o SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).</span><span class="sxs-lookup"><span data-stu-id="2a149-145">[Update SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).</span></span>


## <a name="additional-server-level-administrative-roles"></a><span data-ttu-id="2a149-146">Funções administrativas no nível do servidor adicionais</span><span class="sxs-lookup"><span data-stu-id="2a149-146">Additional server-level administrative roles</span></span>
<span data-ttu-id="2a149-147">Além das funções administrativas no nível do servidor discutidas anteriormente, o Banco de Dados SQL fornece duas funções administrativas restritas no banco de dados mestre, às quais as contas de usuário podem ser adicionadas para a concessão de permissões para manter o banco de dados ou gerenciar logons.</span><span class="sxs-lookup"><span data-stu-id="2a149-147">In addition to the server-level administrative roles discussed previously, SQL Database provides two restricted administrative roles in the master database to which user accounts can be added that grant permissions to either create databases or manage logins.</span></span>

### <a name="database-creators"></a><span data-ttu-id="2a149-148">Criadores de Banco de Dados</span><span class="sxs-lookup"><span data-stu-id="2a149-148">Database creators</span></span>
<span data-ttu-id="2a149-149">Uma dessas funções administrativas é a função **dbmanager**.</span><span class="sxs-lookup"><span data-stu-id="2a149-149">One of these administrative roles is the **dbmanager** role.</span></span> <span data-ttu-id="2a149-150">Os membros dessa função podem criar novos bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="2a149-150">Members of this role can create new databases.</span></span> <span data-ttu-id="2a149-151">Para usar essa função, você cria um usuário no banco de dados `master` e, em seguida, adiciona o usuário à função de banco de dados **dbmanager**.</span><span class="sxs-lookup"><span data-stu-id="2a149-151">To use this role, you create a user in the `master` database and then add the user to the **dbmanager** database role.</span></span> <span data-ttu-id="2a149-152">Para criar um banco de dados, o usuário deve ser um usuário baseado em um logon do SQL Server no banco de dados mestre ou um usuário de banco de dados baseado em um usuário do Azure Active Directory independente.</span><span class="sxs-lookup"><span data-stu-id="2a149-152">To create a database, the user must be a user based on a SQL Server login in the master database or contained database user based on an Azure Active Directory user.</span></span>

1. <span data-ttu-id="2a149-153">Com uma conta de administrador, conecte-se ao banco de dados mestre.</span><span class="sxs-lookup"><span data-stu-id="2a149-153">Using an administrator account, connect to the master database.</span></span>
2. <span data-ttu-id="2a149-154">Etapa opcional: crie um logon de autenticação do SQL Server usando a instrução [CREATE LOGIN](https://msdn.microsoft.com/library/ms189751.aspx) .</span><span class="sxs-lookup"><span data-stu-id="2a149-154">Optional step: Create a SQL Server authentication login, using the [CREATE LOGIN](https://msdn.microsoft.com/library/ms189751.aspx) statement.</span></span> <span data-ttu-id="2a149-155">Exemplo de instrução:</span><span class="sxs-lookup"><span data-stu-id="2a149-155">Sample statement:</span></span>
   
   ```
   CREATE LOGIN Mary WITH PASSWORD = '<strong_password>';
   ```
   
   > [!NOTE]
   > <span data-ttu-id="2a149-156">Você deve usar uma senha forte ao criar um logon ou um usuário de banco de dados independente.</span><span class="sxs-lookup"><span data-stu-id="2a149-156">Use a strong password when creating a login or contained database user.</span></span> <span data-ttu-id="2a149-157">Para obter mais informações, consulte [Senhas fortes (a página pode estar em inglês)](https://msdn.microsoft.com/library/ms161962.aspx).</span><span class="sxs-lookup"><span data-stu-id="2a149-157">For more information, see [Strong Passwords](https://msdn.microsoft.com/library/ms161962.aspx).</span></span>
    
   <span data-ttu-id="2a149-158">Para melhorar o desempenho, logons (entidades de nível de servidor) são temporariamente armazenados em cache no nível do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="2a149-158">To improve performance, logins (server-level principals) are temporarily cached at the database level.</span></span> <span data-ttu-id="2a149-159">Para atualizar o cache de autenticação, veja [DBCC FLUSHAUTHCACHE](https://msdn.microsoft.com/library/mt627793.aspx).</span><span class="sxs-lookup"><span data-stu-id="2a149-159">To refresh the authentication cache, see [DBCC FLUSHAUTHCACHE](https://msdn.microsoft.com/library/mt627793.aspx).</span></span>

3. <span data-ttu-id="2a149-160">No banco de dados mestre, crie um usuário usando a instrução [CREATE USER](https://msdn.microsoft.com/library/ms173463.aspx).</span><span class="sxs-lookup"><span data-stu-id="2a149-160">In the master database, create a user by using the [CREATE USER](https://msdn.microsoft.com/library/ms173463.aspx) statement.</span></span> <span data-ttu-id="2a149-161">O usuário pode ser usuário de banco de dados independente de autenticação no Azure Active Directory (se você tiver configurado o ambiente para autenticação do Azure AD), ou um usuário de banco de dados independente de autenticação do SQL Server, ou um usuário de autenticação do SQL Server com base em um logon de autenticação do SQL Server (criado na etapa anterior). Exemplo de instruções:</span><span class="sxs-lookup"><span data-stu-id="2a149-161">The user can be an Azure Active Directory authentication contained database user (if you have configured your environment for Azure AD authentication), or a SQL Server authentication contained database user, or a SQL Server authentication user based on a SQL Server authentication login (created in the previous step.) Sample statements:</span></span>
   
   ```
   CREATE USER [mike@contoso.com] FROM EXTERNAL PROVIDER;
   CREATE USER Tran WITH PASSWORD = '<strong_password>';
   CREATE USER Mary FROM LOGIN Mary; 
   ```

4. <span data-ttu-id="2a149-162">Adicione o novo usuário à função do banco de dados **dbmanager** usando a instrução [ALTER ROLE](https://msdn.microsoft.com/library/ms189775.aspx) .</span><span class="sxs-lookup"><span data-stu-id="2a149-162">Add the new user, to the **dbmanager** database role by using the [ALTER ROLE](https://msdn.microsoft.com/library/ms189775.aspx) statement.</span></span> <span data-ttu-id="2a149-163">Exemplo de instruções:</span><span class="sxs-lookup"><span data-stu-id="2a149-163">Sample statements:</span></span>
   
   ```
   ALTER ROLE dbmanager ADD MEMBER Mary; 
   ALTER ROLE dbmanager ADD MEMBER [mike@contoso.com];
   ```
   
   > [!NOTE]
   > <span data-ttu-id="2a149-164">O dbmanager é uma função de banco de dados no banco de dados mestre, portanto, você só pode adicionar um usuário de banco de dados à função dbmanager.</span><span class="sxs-lookup"><span data-stu-id="2a149-164">The dbmanager is a database role in master database so you can only add a database user to the dbmanager role.</span></span> <span data-ttu-id="2a149-165">Não é possível adicionar um logon no nível do servidor à função no nível do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="2a149-165">You cannot add a server-level login to database-level role.</span></span>
    
5. <span data-ttu-id="2a149-166">Se for necessário, configure uma regra de firewall para permitir que o novo usuário se conecte.</span><span class="sxs-lookup"><span data-stu-id="2a149-166">If necessary, configure a firewall rule to allow the new user to connect.</span></span> <span data-ttu-id="2a149-167">(O novo usuário poderá ser coberto por uma regra de firewall existente.)</span><span class="sxs-lookup"><span data-stu-id="2a149-167">(The new user might be covered by an existing firewall rule.)</span></span>

<span data-ttu-id="2a149-168">Agora, o usuário pode se conectar ao banco de dados mestre e criar novos bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="2a149-168">Now the user can connect to the master database and can create new databases.</span></span> <span data-ttu-id="2a149-169">A conta de criação do banco de dados se torna o proprietário do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="2a149-169">The account creating the database becomes the owner of the database.</span></span>

### <a name="login-managers"></a><span data-ttu-id="2a149-170">Gerentes de logon</span><span class="sxs-lookup"><span data-stu-id="2a149-170">Login managers</span></span>
<span data-ttu-id="2a149-171">A outra função administrativa é a função de gerente de logon.</span><span class="sxs-lookup"><span data-stu-id="2a149-171">The other administrative role is the login manager role.</span></span> <span data-ttu-id="2a149-172">Os membros dessa função podem criar novos logons no banco de dados mestre.</span><span class="sxs-lookup"><span data-stu-id="2a149-172">Members of this role can create new logins in the master database.</span></span> <span data-ttu-id="2a149-173">Se quiser, você poderá concluir as mesmas etapas (criar um logon e usuário, e adicionar um usuário à função **loginmanager**) para permitir que um usuário crie novos logons no mestre.</span><span class="sxs-lookup"><span data-stu-id="2a149-173">If you wish, you can complete the same steps (create a login and user, and add a user to the **loginmanager** role) to enable a user to create new logins in the master.</span></span> <span data-ttu-id="2a149-174">Normalmente, os logons não são necessários, pois a Microsoft recomenda o uso de usuários de banco de dados independentes, que são autenticados no nível do banco de dados em vez de usar os usuários baseados em logons.</span><span class="sxs-lookup"><span data-stu-id="2a149-174">Usually logins are not necessary as Microsoft recommends using contained database users, which authenticate at the database-level instead of using users based on logins.</span></span> <span data-ttu-id="2a149-175">Para obter mais informações, consulte [Usuários do banco de dados independente - Tornando o banco de dados portátil](https://msdn.microsoft.com/library/ff929188.aspx).</span><span class="sxs-lookup"><span data-stu-id="2a149-175">For more information, see [Contained Database Users - Making Your Database Portable](https://msdn.microsoft.com/library/ff929188.aspx).</span></span>

## <a name="non-administrator-users"></a><span data-ttu-id="2a149-176">Usuários não administradores</span><span class="sxs-lookup"><span data-stu-id="2a149-176">Non-administrator users</span></span>
<span data-ttu-id="2a149-177">Em geral, as contas que não são de administrador não precisam de acesso ao banco de dados mestre.</span><span class="sxs-lookup"><span data-stu-id="2a149-177">Generally, non-administrator accounts do not need access to the master database.</span></span> <span data-ttu-id="2a149-178">Crie usuários do banco de dados independente no nível do banco de dados usando a instrução [CREATE USER (Transact-SQL)](https://msdn.microsoft.com/library/ms173463.aspx) .</span><span class="sxs-lookup"><span data-stu-id="2a149-178">Create contained database users at the database level using the [CREATE USER (Transact-SQL)](https://msdn.microsoft.com/library/ms173463.aspx) statement.</span></span> <span data-ttu-id="2a149-179">O usuário pode ser usuário de banco de dados independente de autenticação no Azure Active Directory (se você tiver configurado o ambiente para autenticação do Azure AD), ou um usuário de banco de dados independente de autenticação do SQL Server, ou um usuário de autenticação do SQL Server com base em um logon de autenticação do SQL Server (criado na etapa anterior). Para obter mais informações, consulte [Usuários do banco de dados independente - Tornando o banco de dados portátil](https://msdn.microsoft.com/library/ff929188.aspx).</span><span class="sxs-lookup"><span data-stu-id="2a149-179">The user can be an Azure Active Directory authentication contained database user (if you have configured your environment for Azure AD authentication), or a SQL Server authentication contained database user, or a SQL Server authentication user based on a SQL Server authentication login (created in the previous step.) For more information, see [Contained Database Users - Making Your Database Portable](https://msdn.microsoft.com/library/ff929188.aspx).</span></span> 

<span data-ttu-id="2a149-180">Para criar usuários, conectar-se ao banco de dados e executar instruções semelhantes aos exemplos a seguir:</span><span class="sxs-lookup"><span data-stu-id="2a149-180">To create users, connect to the database, and execute statements similar to the following examples:</span></span>

```
CREATE USER Mary FROM LOGIN Mary; 
CREATE USER [mike@contoso.com] FROM EXTERNAL PROVIDER;
```

<span data-ttu-id="2a149-181">Inicialmente, apenas um dos administradores ou o proprietário do banco de dados pode criar usuários.</span><span class="sxs-lookup"><span data-stu-id="2a149-181">Initially, only one of the administrators or the owner of the database can create users.</span></span> <span data-ttu-id="2a149-182">Para autorizar que outros usuários criem novos usuários, conceda ao usuário selecionado a permissão `ALTER ANY USER` usando uma instrução como:</span><span class="sxs-lookup"><span data-stu-id="2a149-182">To authorize additional users to create new users, grant that selected user the `ALTER ANY USER` permission, by using a statement such as:</span></span>

```
GRANT ALTER ANY USER TO Mary;
```

<span data-ttu-id="2a149-183">Para conceder a outros usuários o controle total do banco de dados, torne-os membros da função do banco de dados fixa **db_owner** usando a instrução `ALTER ROLE`.</span><span class="sxs-lookup"><span data-stu-id="2a149-183">To give additional users full control of the database, make them a member of the **db_owner** fixed database role using the `ALTER ROLE` statement.</span></span>

> [!NOTE]
> <span data-ttu-id="2a149-184">O motivo mais comum para criar usuários de banco de dados baseados em logons é quando você tem usuários de autenticação do SQL Server que precisam de acesso a vários bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="2a149-184">The most common reason to create database users based on logins, is when you have SQL Server authentication users that need access to multiple databases.</span></span> <span data-ttu-id="2a149-185">Usuários baseados em logons são vinculados ao logon, e somente uma senha é mantida para esse logon.</span><span class="sxs-lookup"><span data-stu-id="2a149-185">Users based on logins are tied to the login, and only one password that is maintained for that login.</span></span> <span data-ttu-id="2a149-186">Os usuários do banco de dados independente em bancos de dados individuais são cada entidade individual, e cada uma delas mantém sua própria senha.</span><span class="sxs-lookup"><span data-stu-id="2a149-186">Contained database users in individual databases are each individual entities and each maintains its own password.</span></span> <span data-ttu-id="2a149-187">Isso pode confundir os usuários de banco de dados independente se eles não mantiverem suas senhas idênticas.</span><span class="sxs-lookup"><span data-stu-id="2a149-187">This can confuse contained database users if they do not maintain their passwords as identical.</span></span>

### <a name="configuring-the-database-level-firewall"></a><span data-ttu-id="2a149-188">Configuração do firewall no nível do banco de dados</span><span class="sxs-lookup"><span data-stu-id="2a149-188">Configuring the database-level firewall</span></span>
<span data-ttu-id="2a149-189">Como prática recomendada, os usuários não administradores só devem ter acesso por meio do firewall aos bancos de dados que eles usam.</span><span class="sxs-lookup"><span data-stu-id="2a149-189">As a best practice, non-administrator users should only have access through the firewall to the databases that they use.</span></span> <span data-ttu-id="2a149-190">Em vez de autorizar seus endereços IP pelo firewall no nível do servidor e conceder acesso a todos os bancos de dados, use a instrução [sp_set_database_firewall_rule](https://msdn.microsoft.com/library/dn270010.aspx) para configurar o firewall no nível do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="2a149-190">Instead of authorizing their IP addresses through the server-level firewall and giving them access to all databases, use the [sp_set_database_firewall_rule](https://msdn.microsoft.com/library/dn270010.aspx) statement to configure the database-level firewall.</span></span> <span data-ttu-id="2a149-191">O firewall no nível de banco de dados não pode ser configurado usando o portal.</span><span class="sxs-lookup"><span data-stu-id="2a149-191">The database-level firewall cannot be configured by using the portal.</span></span>

### <a name="non-administrator-access-path"></a><span data-ttu-id="2a149-192">Caminho de acesso do não administrador</span><span class="sxs-lookup"><span data-stu-id="2a149-192">Non-administrator access path</span></span>
<span data-ttu-id="2a149-193">Quando o firewall no nível do banco de dados está configurado corretamente, os usuários do banco de dados podem se conectar usando as ferramentas de cliente como o SQL Server Management Studio ou o SQL Server Data Tools.</span><span class="sxs-lookup"><span data-stu-id="2a149-193">When the database-level firewall is properly configured, the database users can connect using client tools such as SQL Server Management Studio or SQL Server Data Tools.</span></span> <span data-ttu-id="2a149-194">Somente as ferramentas mais recentes fornecem todos os recursos e capacidades.</span><span class="sxs-lookup"><span data-stu-id="2a149-194">Only the latest tools provide all the features and capabilities.</span></span> <span data-ttu-id="2a149-195">O diagrama a seguir mostra um caminho de acesso não do administrador típico.</span><span class="sxs-lookup"><span data-stu-id="2a149-195">The following diagram shows a typical non-administrator access path.</span></span>

![Caminho de acesso do não administrador](./media/sql-database-manage-logins/2sql-db-nonadmin-access.png)

## <a name="groups-and-roles"></a><span data-ttu-id="2a149-197">Grupos e funções</span><span class="sxs-lookup"><span data-stu-id="2a149-197">Groups and roles</span></span>
<span data-ttu-id="2a149-198">O gerenciamento de acesso eficiente usa as permissões atribuídas a grupos e funções, em vez de usuários individuais.</span><span class="sxs-lookup"><span data-stu-id="2a149-198">Efficient access management uses permissions assigned to groups and roles instead of individual users.</span></span> 

- <span data-ttu-id="2a149-199">Ao usar a autenticação do Azure Active Directory, coloque os usuários do Azure Active Directory em um grupo do Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="2a149-199">When using Azure Active Directory authentication, put Azure Active Directory users into an Azure Active Directory group.</span></span> <span data-ttu-id="2a149-200">Crie um usuário de banco de dados independente para o grupo.</span><span class="sxs-lookup"><span data-stu-id="2a149-200">Create a contained database user for the group.</span></span> <span data-ttu-id="2a149-201">Coloque um ou mais usuários de banco de dados em uma [função de banco de dados](https://msdn.microsoft.com/library/ms189121) e então atribua [permissões](https://msdn.microsoft.com/library/ms191291.aspx) à função de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="2a149-201">Place one or more database users into a [database role](https://msdn.microsoft.com/library/ms189121) and then assign [permissions](https://msdn.microsoft.com/library/ms191291.aspx) to the database role.</span></span>

- <span data-ttu-id="2a149-202">Ao usar a autenticação do SQL Server, crie usuários de banco de dados independentes no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="2a149-202">When using SQL Server authentication, create contained database users in the database.</span></span> <span data-ttu-id="2a149-203">Coloque um ou mais usuários de banco de dados em uma [função de banco de dados](https://msdn.microsoft.com/library/ms189121) e então atribua [permissões](https://msdn.microsoft.com/library/ms191291.aspx) à função de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="2a149-203">Place one or more database users into a [database role](https://msdn.microsoft.com/library/ms189121) and then assign [permissions](https://msdn.microsoft.com/library/ms191291.aspx) to the database role.</span></span>

<span data-ttu-id="2a149-204">As funções do banco de dados podem ser funções internas, como **db_owner**, **db_ddladmin**, **db_datawriter**, **db_datareader**, **db_denydatawriter** e **db_denydatareader**.</span><span class="sxs-lookup"><span data-stu-id="2a149-204">The database roles can be the built-in roles such as **db_owner**, **db_ddladmin**, **db_datawriter**, **db_datareader**, **db_denydatawriter**, and **db_denydatareader**.</span></span> <span data-ttu-id="2a149-205">**db_owner** é usada normalmente para conceder permissão total a apenas alguns usuários.</span><span class="sxs-lookup"><span data-stu-id="2a149-205">**db_owner** is commonly used to grant full permission to only a few users.</span></span> <span data-ttu-id="2a149-206">As outras funções fixas de banco de dados são úteis para mover rapidamente um banco de dados simples para desenvolvimento, mas não são recomendadas para a maioria dos bancos de dados de produção.</span><span class="sxs-lookup"><span data-stu-id="2a149-206">The other fixed database roles are useful for getting a simple database in development quickly, but are not recommended for most production databases.</span></span> <span data-ttu-id="2a149-207">Por exemplo, a função do banco de dados fixa **db_datareader** concede acesso de leitura a todas as tabelas no banco de dados, sendo, em geral, mais do que é estritamente necessário.</span><span class="sxs-lookup"><span data-stu-id="2a149-207">For example, the **db_datareader** fixed database role grants read access to every table in the database, which is usually more than is strictly necessary.</span></span> <span data-ttu-id="2a149-208">É muito melhor usar a instrução [CREATE ROLE](https://msdn.microsoft.com/library/ms187936.aspx) para criar suas próprias funções do banco de dados definidas pelo usuário e conceder cuidadosamente a cada função as permissões mínimas necessárias para o negócio.</span><span class="sxs-lookup"><span data-stu-id="2a149-208">It is far better to use the [CREATE ROLE](https://msdn.microsoft.com/library/ms187936.aspx) statement to create your own user-defined database roles and carefully grant each role the least permissions necessary for the business need.</span></span> <span data-ttu-id="2a149-209">Quando um usuário for membro de várias funções, ele agregará as permissões de todas elas.</span><span class="sxs-lookup"><span data-stu-id="2a149-209">When a user is a member of multiple roles, they aggregate the permissions of them all.</span></span>

## <a name="permissions"></a><span data-ttu-id="2a149-210">Permissões</span><span class="sxs-lookup"><span data-stu-id="2a149-210">Permissions</span></span>
<span data-ttu-id="2a149-211">Há mais de 100 permissões que podem ser concedidas ou negadas individualmente no Banco de Dados SQL.</span><span class="sxs-lookup"><span data-stu-id="2a149-211">There are over 100 permissions that can be individually granted or denied in SQL Database.</span></span> <span data-ttu-id="2a149-212">Muitas dessas permissões são aninhadas.</span><span class="sxs-lookup"><span data-stu-id="2a149-212">Many of these permissions are nested.</span></span> <span data-ttu-id="2a149-213">Por exemplo, a permissão `UPDATE` em um esquema inclui a permissão `UPDATE` em cada tabela dentro desse esquema.</span><span class="sxs-lookup"><span data-stu-id="2a149-213">For example, the `UPDATE` permission on a schema includes the `UPDATE` permission on each table within that schema.</span></span> <span data-ttu-id="2a149-214">Assim como ocorre na maioria dos sistemas de permissão, a negação de uma permissão substitui uma concessão.</span><span class="sxs-lookup"><span data-stu-id="2a149-214">As in most permission systems, the denial of a permission overrides a grant.</span></span> <span data-ttu-id="2a149-215">Devido à natureza aninhada e ao número de permissões, talvez seja necessário realizar um estudo cuidadoso para criar um sistema de permissões apropriado a fim de proteger corretamente o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="2a149-215">Because of the nested nature and the number of permissions, it can take careful study to design an appropriate permission system to properly protect your database.</span></span> <span data-ttu-id="2a149-216">Comece com a lista de permissões em [Permissões (Mecanismo do Banco de Dados)](https://msdn.microsoft.com/library/ms191291.aspx) e examine o [gráfico com tamanho de pôster](http://go.microsoft.com/fwlink/?LinkId=229142) das permissões.</span><span class="sxs-lookup"><span data-stu-id="2a149-216">Start with the list of permissions at [Permissions (Database Engine)](https://msdn.microsoft.com/library/ms191291.aspx) and review the [poster size graphic](http://go.microsoft.com/fwlink/?LinkId=229142) of the permissions.</span></span>


### <a name="considerations-and-restrictions"></a><span data-ttu-id="2a149-217">Considerações e restrições</span><span class="sxs-lookup"><span data-stu-id="2a149-217">Considerations and restrictions</span></span>
<span data-ttu-id="2a149-218">Ao gerenciar logons e usuários no Banco de Dados SQL, considere o seguinte:</span><span class="sxs-lookup"><span data-stu-id="2a149-218">When managing logins and users in SQL Database, consider the following:</span></span>

* <span data-ttu-id="2a149-219">É necessário estar conectado ao banco de dados **mestre** ao executar as instruções `CREATE/ALTER/DROP DATABASE`.</span><span class="sxs-lookup"><span data-stu-id="2a149-219">You must be connected to the **master** database when executing the `CREATE/ALTER/DROP DATABASE` statements.</span></span>   
* <span data-ttu-id="2a149-220">O usuário de banco de dados correspondente para o logon do **Administrador do servidor** não pode ser alterado ou descartado.</span><span class="sxs-lookup"><span data-stu-id="2a149-220">The database user corresponding to the **Server admin** login cannot be altered or dropped.</span></span> 
* <span data-ttu-id="2a149-221">O inglês (EUA) é o idioma padrão do logon do **Administrador do servidor**.</span><span class="sxs-lookup"><span data-stu-id="2a149-221">US-English is the default language of the **Server admin** login.</span></span>
* <span data-ttu-id="2a149-222">Somente os administradores (Logon do **Administrador do servidor** ou do administrador do Azure AD) e os membros da função **dbmanager** de banco de dados no banco de dados **mestre** têm permissão para executar as instruções `CREATE DATABASE` e `DROP DATABASE`.</span><span class="sxs-lookup"><span data-stu-id="2a149-222">Only the administrators (**Server admin** login or Azure AD administrator) and the members of the **dbmanager** database role in the **master** database have permission to execute the `CREATE DATABASE` and `DROP DATABASE` statements.</span></span>
* <span data-ttu-id="2a149-223">Você deve estar conectado ao banco de dados mestre ao executar as instruções `CREATE/ALTER/DROP LOGIN` .</span><span class="sxs-lookup"><span data-stu-id="2a149-223">You must be connected to the master database when executing the `CREATE/ALTER/DROP LOGIN` statements.</span></span> <span data-ttu-id="2a149-224">No entanto, não é recomendado usar logons.</span><span class="sxs-lookup"><span data-stu-id="2a149-224">However using logins is discouraged.</span></span> <span data-ttu-id="2a149-225">Utilize os usuários de bancos de dados independentes.</span><span class="sxs-lookup"><span data-stu-id="2a149-225">Use contained database users instead.</span></span>
* <span data-ttu-id="2a149-226">Para se conectar a um banco de dados do usuário, é necessário fornecer o nome do banco de dados na cadeia de conexão.</span><span class="sxs-lookup"><span data-stu-id="2a149-226">To connect to a user database, you must provide the name of the database in the connection string.</span></span>
* <span data-ttu-id="2a149-227">Somente o logon da entidade de segurança no nível do servidor e os membros da função **loginmanager** do banco de dados no banco de dados **mestre** têm permissão para executar as instruções `CREATE LOGIN`, `ALTER LOGIN` e `DROP LOGIN`.</span><span class="sxs-lookup"><span data-stu-id="2a149-227">Only the server-level principal login and the members of the **loginmanager** database role in the **master** database have permission to execute the `CREATE LOGIN`, `ALTER LOGIN`, and `DROP LOGIN` statements.</span></span>
* <span data-ttu-id="2a149-228">Ao executar as instruções `CREATE/ALTER/DROP LOGIN` e `CREATE/ALTER/DROP DATABASE` em um aplicativo do ADO.NET, o uso de comandos parametrizados não é permitido.</span><span class="sxs-lookup"><span data-stu-id="2a149-228">When executing the `CREATE/ALTER/DROP LOGIN` and `CREATE/ALTER/DROP DATABASE` statements in an ADO.NET application, using parameterized commands is not allowed.</span></span> <span data-ttu-id="2a149-229">Para obter mais informações, veja [Comandos e parâmetros](https://msdn.microsoft.com/library/ms254953.aspx).</span><span class="sxs-lookup"><span data-stu-id="2a149-229">For more information, see [Commands and Parameters](https://msdn.microsoft.com/library/ms254953.aspx).</span></span>
* <span data-ttu-id="2a149-230">Ao executar as instruções `CREATE/ALTER/DROP DATABASE` e `CREATE/ALTER/DROP LOGIN`, cada uma dessas instruções deve ser a única instrução em um lote do Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="2a149-230">When executing the `CREATE/ALTER/DROP DATABASE` and `CREATE/ALTER/DROP LOGIN` statements, each of these statements must be the only statement in a Transact-SQL batch.</span></span> <span data-ttu-id="2a149-231">Caso contrário, ocorrerá um erro.</span><span class="sxs-lookup"><span data-stu-id="2a149-231">Otherwise, an error occurs.</span></span> <span data-ttu-id="2a149-232">Por exemplo, o Transact-SQL a seguir verifica se o banco de dados existe.</span><span class="sxs-lookup"><span data-stu-id="2a149-232">For example, the following Transact-SQL checks whether the database exists.</span></span> <span data-ttu-id="2a149-233">Se ele existir, uma instrução `DROP DATABASE` é chamada para remover o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="2a149-233">If it exists, a `DROP DATABASE` statement is called to remove the database.</span></span> <span data-ttu-id="2a149-234">Como a instrução `DROP DATABASE` não é a única instrução no lote, a execução da seguinte instrução Transact-SQL resulta em um erro.</span><span class="sxs-lookup"><span data-stu-id="2a149-234">Because the `DROP DATABASE` statement is not the only statement in the batch, executing the following Transact-SQL statement results in an error.</span></span>

  ```
  IF EXISTS (SELECT [name]
           FROM   [sys].[databases]
           WHERE  [name] = N'database_name')
  DROP DATABASE [database_name];
  GO
  ```

* <span data-ttu-id="2a149-235">Ao executar a instrução `CREATE USER` com a opção `FOR/FROM LOGIN`, ela deve ser a única instrução em um lote do Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="2a149-235">When executing the `CREATE USER` statement with the `FOR/FROM LOGIN` option, it must be the only statement in a Transact-SQL batch.</span></span>
* <span data-ttu-id="2a149-236">Ao executar a instrução `ALTER USER` com a opção `WITH LOGIN`, ela deve ser a única instrução em um lote do Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="2a149-236">When executing the `ALTER USER` statement with the `WITH LOGIN` option, it must be the only statement in a Transact-SQL batch.</span></span>
* <span data-ttu-id="2a149-237">Para o `CREATE/ALTER/DROP`, um usuário requer a permissão `ALTER ANY USER` no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="2a149-237">To `CREATE/ALTER/DROP` a user requires the `ALTER ANY USER` permission on the database.</span></span>
* <span data-ttu-id="2a149-238">Quando o proprietário de uma função de banco de dados tenta adicionar ou remover outro usuário de banco de dados de ou para essa função de banco de dados, pode ocorrer o seguinte erro: **O usuário ou a função “Nome” não existe neste banco de dados.**</span><span class="sxs-lookup"><span data-stu-id="2a149-238">When the owner of a database role tries to add or remove another database user to or from that database role, the following error may occur: **User or role 'Name' does not exist in this database.**</span></span> <span data-ttu-id="2a149-239">Esse erro ocorre porque o usuário não está visível para o proprietário.</span><span class="sxs-lookup"><span data-stu-id="2a149-239">This error occurs because the user is not visible to the owner.</span></span> <span data-ttu-id="2a149-240">Para resolver esse problema, conceda ao proprietário da função a permissão `VIEW DEFINITION` no usuário.</span><span class="sxs-lookup"><span data-stu-id="2a149-240">To resolve this issue, grant the role owner the `VIEW DEFINITION` permission on the user.</span></span> 


## <a name="next-steps"></a><span data-ttu-id="2a149-241">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="2a149-241">Next steps</span></span>

- <span data-ttu-id="2a149-242">Para saber mais sobre regras de firewall, veja [Firewall do Banco de Dados SQL do Azure](sql-database-firewall-configure.md).</span><span class="sxs-lookup"><span data-stu-id="2a149-242">To learn more about firewall rules, see [Azure SQL Database Firewall](sql-database-firewall-configure.md).</span></span>
- <span data-ttu-id="2a149-243">Para obter uma visão geral de todos os recursos de segurança do Banco de Dados SQL, veja a [visão geral de segurança do SQL](sql-database-security-overview.md).</span><span class="sxs-lookup"><span data-stu-id="2a149-243">For an overview of all the SQL Database security features, see [SQL security overview](sql-database-security-overview.md).</span></span>
- <span data-ttu-id="2a149-244">Para obter um tutorial, consulte [Proteger o Banco de Dados SQL do Azure](sql-database-security-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="2a149-244">For a tutorial, see [Secure your Azure SQL Database](sql-database-security-tutorial.md).</span></span>
- <span data-ttu-id="2a149-245">Para saber mais sobre exibições e procedimentos armazenados, veja [Criação de exibições e procedimentos armazenados](https://msdn.microsoft.com/library/ms365311.aspx)</span><span class="sxs-lookup"><span data-stu-id="2a149-245">For information about views and stored procedures, see [Creating views and stored procedures](https://msdn.microsoft.com/library/ms365311.aspx)</span></span>
- <span data-ttu-id="2a149-246">Para saber mais sobre como conceder acesso a um objeto de banco de dados, veja [Concessão de acesso a um objeto de banco de dados](https://msdn.microsoft.com/library/ms365327.aspx)</span><span class="sxs-lookup"><span data-stu-id="2a149-246">For information about granting access to a database object, see [Granting Access to a Database Object](https://msdn.microsoft.com/library/ms365327.aspx)</span></span>
