---
title: "atualizações de aplicativo aaaRolling - banco de dados do SQL Azure | Microsoft Docs"
description: "Saiba como toouse replicação geográfica do Azure SQL Database toosupport online atualizações do seu aplicativo na nuvem."
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: 58f42859-1e37-463c-a3d8-a3ca2e867148
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 07/16/2016
ms.author: sashan
ms.openlocfilehash: 18c56300916d129bff141624cc5c416b500408d4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="managing-rolling-upgrades-of-cloud-applications-using-sql-database-active-geo-replication"></a><span data-ttu-id="f5990-103">Gerenciando a rolagem de atualizações de aplicativos na nuvem usando a replicação geográfica ativa do Banco de dados SQL</span><span class="sxs-lookup"><span data-stu-id="f5990-103">Managing rolling upgrades of cloud applications using SQL Database active geo-replication</span></span>
> [!NOTE]
> <span data-ttu-id="f5990-104">A [replicação geográfica ativa](sql-database-geo-replication-overview.md) agora está disponível para todos os bancos de dados em todas as camadas.</span><span class="sxs-lookup"><span data-stu-id="f5990-104">[Active geo-replication](sql-database-geo-replication-overview.md) is now available for all databases in all tiers.</span></span>
> 

<span data-ttu-id="f5990-105">Saiba como toouse [georeplicação](sql-database-geo-replication-overview.md) no banco de dados SQL tooenable as atualizações sem interrupção do seu aplicativo na nuvem.</span><span class="sxs-lookup"><span data-stu-id="f5990-105">Learn how toouse [geo-replication](sql-database-geo-replication-overview.md) in SQL Database tooenable rolling upgrades of your cloud application.</span></span> <span data-ttu-id="f5990-106">Como a atualização é uma operação com interrupção, ele deve fazer parte de seu design e planejamento de continuidade dos negócios.</span><span class="sxs-lookup"><span data-stu-id="f5990-106">Because upgrade is a disruptive operation, it should be part of your business continuity planning and design.</span></span> <span data-ttu-id="f5990-107">Neste artigo, que vamos examinar dois métodos diferentes de orquestração Olá processo de atualização e discutir os benefícios de saudação e vantagens e desvantagens de cada opção.</span><span class="sxs-lookup"><span data-stu-id="f5990-107">In this article we look at two different methods of orchestrating hello upgrade process, and discuss hello benefits and trade-offs of each option.</span></span> <span data-ttu-id="f5990-108">Para fins de saudação deste artigo, usaremos um aplicativo simples que consiste em um site da web conectados tooa banco de dados como sua camada de dados.</span><span class="sxs-lookup"><span data-stu-id="f5990-108">For hello purposes of this article we will use a simple application that consists of a web site connected tooa single database as its data tier.</span></span> <span data-ttu-id="f5990-109">Nosso objetivo é tooupgrade versão 1 do hello aplicativo tooversion 2 sem qualquer impacto significativo na experiência do usuário final de saudação.</span><span class="sxs-lookup"><span data-stu-id="f5990-109">Our goal is tooupgrade version 1 of hello application tooversion 2 without any significant impact on hello end-user experience.</span></span> 

<span data-ttu-id="f5990-110">Ao avaliar as opções de atualização Olá considere Olá fatores a seguir:</span><span class="sxs-lookup"><span data-stu-id="f5990-110">When evaluating hello upgrade options you should consider hello following factors:</span></span>

* <span data-ttu-id="f5990-111">Impacto na disponibilidade do aplicativo durante atualizações.</span><span class="sxs-lookup"><span data-stu-id="f5990-111">Impact on application availability during upgrades.</span></span> <span data-ttu-id="f5990-112">A função de aplicativo hello quanto tempo pode ser limitada ou degradada.</span><span class="sxs-lookup"><span data-stu-id="f5990-112">How long hello application function may be limited or degraded.</span></span>
* <span data-ttu-id="f5990-113">Capacidade tooroll novamente em caso de uma falha de atualização.</span><span class="sxs-lookup"><span data-stu-id="f5990-113">Ability tooroll back in case of an upgrade failure.</span></span>
* <span data-ttu-id="f5990-114">Vulnerabilidade do aplicativo hello se ocorrer uma falha catastrófica relacionada durante a atualização de saudação.</span><span class="sxs-lookup"><span data-stu-id="f5990-114">Vulnerability of hello application if an unrelated catastrophic failure occurs during hello upgrade.</span></span>
* <span data-ttu-id="f5990-115">Custo total em dólares.</span><span class="sxs-lookup"><span data-stu-id="f5990-115">Total dollar cost.</span></span>  <span data-ttu-id="f5990-116">Isso inclui a redundância adicional e custos incrementais dos componentes de temporário Olá usados pelo processo de atualização de saudação.</span><span class="sxs-lookup"><span data-stu-id="f5990-116">This includes additional redundancy and incremental costs of hello temporary components  used by hello upgrade process.</span></span> 

## <a name="upgrading-applications-that-rely-on-database-backups-for-disaster-recovery"></a><span data-ttu-id="f5990-117">Atualizando aplicativos que dependem de backups de banco de dados para recuperação de desastre</span><span class="sxs-lookup"><span data-stu-id="f5990-117">Upgrading applications that rely on database backups for disaster recovery</span></span>
<span data-ttu-id="f5990-118">Se seu aplicativo depende de backups de banco de dados automática e usa a restauração geográfica para recuperação de desastres, é normalmente implantado tooa única região do Azure.</span><span class="sxs-lookup"><span data-stu-id="f5990-118">If your application relies on automatic database backups and uses geo-restore for disaster recovery, it is usually deployed tooa single Azure region.</span></span> <span data-ttu-id="f5990-119">Nesse caso o processo de atualização Olá envolve a criação de uma implantação de todos os componentes do aplicativo de backup envolvidos na atualização de saudação.</span><span class="sxs-lookup"><span data-stu-id="f5990-119">In this case hello upgrade process involves creating a backup deployment of all application components involved in hello upgrade.</span></span> <span data-ttu-id="f5990-120">interrupção do toominimize saudação do usuário final você aproveitará o Azure Traffic Manager (WATM) com o perfil de failover de saudação.</span><span class="sxs-lookup"><span data-stu-id="f5990-120">toominimize hello end-user disruption you will leverage Azure Traffic Manager (WATM) with hello failover profile.</span></span>  <span data-ttu-id="f5990-121">Olá diagrama a seguir ilustra o processo de atualização do hello ambiente operacional toohello anterior.</span><span class="sxs-lookup"><span data-stu-id="f5990-121">hello following diagram illustrates hello operational environment prior toohello upgrade process.</span></span> <span data-ttu-id="f5990-122">ponto de extremidade de Olá <i>1.azurewebsites.net contoso</i> representa um slot de produção do aplicativo hello que precisa toobe atualizado.</span><span class="sxs-lookup"><span data-stu-id="f5990-122">hello endpoint <i>contoso-1.azurewebsites.net</i> represents a production slot of hello application that needs toobe upgraded.</span></span> <span data-ttu-id="f5990-123">tooenable Olá capacidade tooroll volta Olá atualização, você precisa criar um slot de estágio com uma cópia totalmente sincronizada do aplicativo hello.</span><span class="sxs-lookup"><span data-stu-id="f5990-123">tooenable hello ability tooroll back hello upgrade, you need create a stage slot with a fully synchronized copy of hello application.</span></span> <span data-ttu-id="f5990-124">Olá etapas a seguir são necessárias tooprepare Olá aplicativo para atualização de saudação:</span><span class="sxs-lookup"><span data-stu-id="f5990-124">hello following steps are required tooprepare hello application for hello upgrade:</span></span>

1. <span data-ttu-id="f5990-125">Crie um slot de estágio para atualização de saudação.</span><span class="sxs-lookup"><span data-stu-id="f5990-125">Create a stage slot for hello upgrade.</span></span> <span data-ttu-id="f5990-126">toodo que criar um banco de dados secundário (1) e implantar um site idêntico em Olá mesma região do Azure.</span><span class="sxs-lookup"><span data-stu-id="f5990-126">toodo that create a secondary database (1) and deploy an identical web site in hello same Azure region.</span></span> <span data-ttu-id="f5990-127">Monitorar toosee secundário Olá se Olá processo de preparação foi concluída.</span><span class="sxs-lookup"><span data-stu-id="f5990-127">Monitor hello secondary toosee if hello seeding process is completed.</span></span>
2. <span data-ttu-id="f5990-128">Crie um perfil de failover no WATM com <i>contoso-1.azurewebsites.net</i> como ponto de extremidade online e <i>contoso-2.azurewebsites.net</i> como offline.</span><span class="sxs-lookup"><span data-stu-id="f5990-128">Create a failover profile in WATM with <i>contoso-1.azurewebsites.net</i> as online endpoint and <i>contoso-2.azurewebsites.net</i> as offline.</span></span> 

> [!NOTE]
> <span data-ttu-id="f5990-129">Etapas de preparação de saudação Observação não terá impacto sobre o aplicativo hello no slot de produção de hello e ele pode funcionar em modo de acesso completo.</span><span class="sxs-lookup"><span data-stu-id="f5990-129">Note hello preparation steps will not impact hello application in hello production slot and it can function in full access mode.</span></span>
>  

![Configuração da Replicação Geográfica do Banco de Dados SQL.](media/sql-database-manage-application-rolling-upgrade/Option1-1.png)

<span data-ttu-id="f5990-132">Depois que as etapas de preparação Olá forem concluídas aplicativo hello está pronto para atualização real hello.</span><span class="sxs-lookup"><span data-stu-id="f5990-132">Once hello preparation steps are completed hello application is ready for hello actual upgrade.</span></span> <span data-ttu-id="f5990-133">Olá diagrama a seguir ilustra as etapas de Olá envolvidas no processo de atualização de saudação.</span><span class="sxs-lookup"><span data-stu-id="f5990-133">hello following diagram illustrates hello steps involved in hello upgrade process.</span></span> 

1. <span data-ttu-id="f5990-134">Definir banco de dados primário Olá no hello slot tooread somente modo de produção (3).</span><span class="sxs-lookup"><span data-stu-id="f5990-134">Set hello primary database in hello production slot tooread-only mode (3).</span></span> <span data-ttu-id="f5990-135">Isso garantirá que Olá instância de produção do aplicativo hello (V1) permanecerá somente leitura durante a atualização de saudação impedindo divergência de dados Olá entre hello V1 e V2 instâncias de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f5990-135">This will guarantee that hello production instance of hello application (V1) will remain read-only during hello upgrade thus preventing hello data divergence between hello V1 and V2 database instances.</span></span>  
2. <span data-ttu-id="f5990-136">Desconecte o banco de dados secundário hello usando o modo de encerramento planejado hello (4).</span><span class="sxs-lookup"><span data-stu-id="f5990-136">Disconnect hello secondary database using hello planned termination mode (4).</span></span> <span data-ttu-id="f5990-137">Ele criará uma cópia independente totalmente sincronizada do banco de dados primário hello.</span><span class="sxs-lookup"><span data-stu-id="f5990-137">It will create a fully synchronized independent copy of hello primary database.</span></span> <span data-ttu-id="f5990-138">Este banco de dados será atualizado.</span><span class="sxs-lookup"><span data-stu-id="f5990-138">This database will be upgraded.</span></span>
3. <span data-ttu-id="f5990-139">Ativar o modo de gravação tooread Olá banco de dados primário e execute o script de atualização de saudação no slot de estágio da saudação (5).</span><span class="sxs-lookup"><span data-stu-id="f5990-139">Turn hello primary database tooread-write mode and run hello upgrade script in hello stage slot  (5).</span></span>     

![Configuração da replicação geográfica do banco de dados SQL.](media/sql-database-manage-application-rolling-upgrade/Option1-2.png)

<span data-ttu-id="f5990-142">Se Olá atualização concluída com êxito você, são agora pronto tooswitch Olá os usuários finais toohello preparado cópia Olá aplicativos.</span><span class="sxs-lookup"><span data-stu-id="f5990-142">If hello upgrade completed successfully you are now ready tooswitch hello end users toohello staged copy hello application.</span></span> <span data-ttu-id="f5990-143">Agora, ela ficará slot de produção de hello do aplicativo hello.</span><span class="sxs-lookup"><span data-stu-id="f5990-143">It will now become hello production slot of hello application.</span></span>  <span data-ttu-id="f5990-144">Isso envolve algumas etapas mais conforme ilustrado no diagrama a seguir de saudação.</span><span class="sxs-lookup"><span data-stu-id="f5990-144">This involves a few more steps as illustrated on hello following diagram.</span></span>

1. <span data-ttu-id="f5990-145">Alternar ponto de extremidade online Olá no perfil do WATM Olá muito<i>2.azurewebsites.net contoso</i>, qual versão de toohello V2 pontos do site da web de saudação (6).</span><span class="sxs-lookup"><span data-stu-id="f5990-145">Switch hello online endpoint in hello WATM profile too<i>contoso-2.azurewebsites.net</i>, which points toohello V2 version of hello web site (6).</span></span> <span data-ttu-id="f5990-146">Agora se torna slot de produção de hello com hello V2 aplicativo e o tráfego do usuário final Olá é tooit direcionado.</span><span class="sxs-lookup"><span data-stu-id="f5990-146">It now becomes hello production slot with hello V2 application and hello end-user traffic is directed tooit.</span></span>  
2. <span data-ttu-id="f5990-147">Se você não precisar mais componentes do aplicativo hello V1 forma você poderá removê-los (7).</span><span class="sxs-lookup"><span data-stu-id="f5990-147">If you no longer need hello V1 application components so you can safely remove them (7).</span></span>   

![Configuração da replicação geográfica do banco de dados SQL.](media/sql-database-manage-application-rolling-upgrade/Option1-3.png)

<span data-ttu-id="f5990-150">Se o processo de atualização de saudação for bem-sucedida, por exemplo devido a erro tooan no script de atualização hello, slot de estágio Olá deve ser considerada comprometida.</span><span class="sxs-lookup"><span data-stu-id="f5990-150">If hello upgrade process is unsuccessful, for example due tooan error in hello upgrade script, hello stage slot should be considered compromised.</span></span> <span data-ttu-id="f5990-151">tooroll fazer Olá toohello pré-atualização o estado do aplicativo simplesmente reverter o aplicativo hello no acesso de toofull de slot de produção de hello.</span><span class="sxs-lookup"><span data-stu-id="f5990-151">tooroll back hello application toohello pre-upgrade state you simply revert hello application in hello production slot toofull access.</span></span> <span data-ttu-id="f5990-152">etapas de Olá envolvidas são mostradas no diagrama seguinte hello.</span><span class="sxs-lookup"><span data-stu-id="f5990-152">hello steps involved are shown on hello next diagram.</span></span>    

1. <span data-ttu-id="f5990-153">Definir o modo de gravação tooread de cópia do hello banco de dados (8).</span><span class="sxs-lookup"><span data-stu-id="f5990-153">Set hello database copy tooread-write mode (8).</span></span> <span data-ttu-id="f5990-154">Isso irá restaurar Olá V1 completo funcionalmente no slot de produção de hello.</span><span class="sxs-lookup"><span data-stu-id="f5990-154">This will restore hello full V1 functionally in hello production slot.</span></span>
2. <span data-ttu-id="f5990-155">Executar a análise da causa raiz hello e remover componentes Olá comprometido no slot de estágio da saudação (9).</span><span class="sxs-lookup"><span data-stu-id="f5990-155">Perform hello root cause analysis and remove hello compromised components in hello stage slot (9).</span></span> 

<span data-ttu-id="f5990-156">Neste ponto aplicativo hello é totalmente funcional e etapas de atualização de saudação podem ser repetidas.</span><span class="sxs-lookup"><span data-stu-id="f5990-156">At this point hello application is fully functional and hello upgrade steps can be repeated.</span></span>

> [!NOTE]
> <span data-ttu-id="f5990-157">Olá reversão não requer alterações no perfil do WATM como aponta já muito<i>1.azurewebsites.net contoso</i> como Olá ponto de extremidade ativo.</span><span class="sxs-lookup"><span data-stu-id="f5990-157">hello rollback does not require changes in WATM profile as it already points too<i>contoso-1.azurewebsites.net</i> as hello active endpoint.</span></span>
> 
> 

![Configuração da replicação geográfica do banco de dados SQL.](media/sql-database-manage-application-rolling-upgrade/Option1-4.png)

<span data-ttu-id="f5990-160">chave de saudação **vantagem** dessa opção é que você pode atualizar um aplicativo em uma única região usando um conjunto de etapas simples.</span><span class="sxs-lookup"><span data-stu-id="f5990-160">hello key **advantage** of this option is that you can upgrade an application in a single region using a set of simple steps.</span></span> <span data-ttu-id="f5990-161">custo de dólar Olá de atualização de saudação é relativamente baixo.</span><span class="sxs-lookup"><span data-stu-id="f5990-161">hello dollar cost of hello upgrade is relatively low.</span></span> <span data-ttu-id="f5990-162">Olá principal **compensação** é que se ocorrer uma falha catastrófica durante o estado anterior à atualização do toohello Olá Olá atualização recuperação envolve a reimplantação do aplicativo hello em uma região diferente e restaurando banco de dados de saudação do backup usando a restauração geográfica.</span><span class="sxs-lookup"><span data-stu-id="f5990-162">hello main **tradeoff** is that if a catastrophic failure occurs during hello upgrade hello recovery toohello pre-upgrade state will involve re-deployment of hello application in a different region and restoring hello database from backup using geo-restore.</span></span> <span data-ttu-id="f5990-163">Esse processo resultará em um tempo de inatividade significativo.</span><span class="sxs-lookup"><span data-stu-id="f5990-163">This process will result in significant downtime.</span></span>   

## <a name="upgrading-applications-that-rely-on-database-geo-replication-for-disaster-recovery"></a><span data-ttu-id="f5990-164">Atualizando aplicativos que dependem de replicação geográfica de banco de dados para recuperação de desastre</span><span class="sxs-lookup"><span data-stu-id="f5990-164">Upgrading applications that rely on database geo-replication for disaster recovery</span></span>
<span data-ttu-id="f5990-165">Se seu aplicativo utiliza a replicação geográfica para continuidade de negócios, é tooat implantado pelo menos dois diferentes regiões com uma implantação ativa na região primária e uma implantação em espera na região de Backup.</span><span class="sxs-lookup"><span data-stu-id="f5990-165">If your application leverages geo-replication for business continuity, it is deployed  tooat least two different regions with an active deployment in Primary region and a standby deployment in Backup region.</span></span> <span data-ttu-id="f5990-166">Além disso toohello fatores mencionado anteriormente, o processo de atualização Olá deve garantir que:</span><span class="sxs-lookup"><span data-stu-id="f5990-166">In addition toohello factors mentioned earlier, hello upgrade process must guarantee that:</span></span>

* <span data-ttu-id="f5990-167">aplicativo Hello permanece protegido contra falhas catastróficas em todos os momentos durante o processo de atualização Olá</span><span class="sxs-lookup"><span data-stu-id="f5990-167">hello application remains protected from catastrophic failures at all times during hello upgrade process</span></span>
* <span data-ttu-id="f5990-168">componentes com redundância geográfica de saudação do aplicativo hello são atualizados em paralelo com componentes ativos Olá</span><span class="sxs-lookup"><span data-stu-id="f5990-168">hello geo-redundant components of hello application are upgraded in parallel with hello active components</span></span>

<span data-ttu-id="f5990-169">tooachieve esses objetivos otimizará o Traffic Manager WATM (Azure) usando failover Olá perfil com uma ativa e três pontos de extremidade de backup.</span><span class="sxs-lookup"><span data-stu-id="f5990-169">tooachieve these goals you will leverage Azure Traffic Manager (WATM) using hello failover profile with one active and three backup endpoints.</span></span>  <span data-ttu-id="f5990-170">Olá diagrama a seguir ilustra o processo de atualização do hello ambiente operacional toohello anterior.</span><span class="sxs-lookup"><span data-stu-id="f5990-170">hello following diagram illustrates hello operational environment prior toohello upgrade process.</span></span> <span data-ttu-id="f5990-171">Olá sites da web <i>contoso 1.azurewebsites.net</i> e <i>dr.azurewebsites.net contoso</i> representar um slot de produção do aplicativo hello com redundância geográfica.</span><span class="sxs-lookup"><span data-stu-id="f5990-171">hello web sites <i>contoso-1.azurewebsites.net</i> and <i>contoso-dr.azurewebsites.net</i> represent a production slot of hello application with full geographic redundancy.</span></span> <span data-ttu-id="f5990-172">tooenable Olá capacidade tooroll volta Olá atualização, você precisa criar um slot de estágio com uma cópia totalmente sincronizada do aplicativo hello.</span><span class="sxs-lookup"><span data-stu-id="f5990-172">tooenable hello ability tooroll back hello upgrade, you need create a stage slot with a fully synchronized copy of hello application.</span></span> <span data-ttu-id="f5990-173">Porque você precisa tooensure aplicativo hello pode recuperar rapidamente no caso de uma falha catastrófica ocorre durante o processo de atualização hello, slot de estágio Olá precisa toobe com redundância geográfica também.</span><span class="sxs-lookup"><span data-stu-id="f5990-173">Because you need tooensure that hello application can quickly recover in case a catastrophic failure occurs during hello upgrade process, hello stage slot needs toobe geo-redundant as well.</span></span> <span data-ttu-id="f5990-174">Olá etapas a seguir são necessárias tooprepare Olá aplicativo para atualização de saudação:</span><span class="sxs-lookup"><span data-stu-id="f5990-174">hello following steps are required tooprepare hello application for hello upgrade:</span></span>

1. <span data-ttu-id="f5990-175">Crie um slot de estágio para atualização de saudação.</span><span class="sxs-lookup"><span data-stu-id="f5990-175">Create a stage slot for hello upgrade.</span></span> <span data-ttu-id="f5990-176">toodo que criar um banco de dados secundário (1) e implantar uma cópia idêntica de site da web Olá Olá mesma região do Azure.</span><span class="sxs-lookup"><span data-stu-id="f5990-176">toodo that create a secondary database (1) and deploy an identical copy of hello web site in hello same Azure region.</span></span> <span data-ttu-id="f5990-177">Monitorar toosee secundário Olá se Olá processo de preparação foi concluída.</span><span class="sxs-lookup"><span data-stu-id="f5990-177">Monitor hello secondary toosee if hello seeding process is completed.</span></span>
2. <span data-ttu-id="f5990-178">Criar um banco de dados secundário com redundância geográfica no slot de estágio Olá por replicação geográfica Olá banco de dados secundário toohello backup região (Isso é chamado de "encadeados replicação geográfica").</span><span class="sxs-lookup"><span data-stu-id="f5990-178">Create a geo-redundant secondary database in hello stage slot by geo-replicating hello secondary database toohello backup region (this is called "chained geo-replication").</span></span> <span data-ttu-id="f5990-179">Monitorar toosee secundária do backup Olá se Olá propagação processo for concluído (3).</span><span class="sxs-lookup"><span data-stu-id="f5990-179">Monitor hello backup secondary toosee if hello seeding process is completed (3).</span></span>
3. <span data-ttu-id="f5990-180">Criar uma cópia em espera do site Olá na região backup hello e vinculá-lo toohello com redundância geográfica secundário (4).</span><span class="sxs-lookup"><span data-stu-id="f5990-180">Create a standby copy of hello web site in hello backup region and link it toohello geo-redundant secondary (4).</span></span>  
4. <span data-ttu-id="f5990-181">Adicionar pontos de extremidade adicionais Olá <i>contoso 2.azurewebsites.net</i> e <i>3.azurewebsites.net contoso</i> toohello perfil de failover no WATM como pontos de extremidade offline (5).</span><span class="sxs-lookup"><span data-stu-id="f5990-181">Add hello additional endpoints <i>contoso-2.azurewebsites.net</i> and <i>contoso-3.azurewebsites.net</i> toohello failover profile in WATM as offline endpoints (5).</span></span> 

> [!NOTE]
> <span data-ttu-id="f5990-182">Etapas de preparação de saudação Observação não terá impacto sobre o aplicativo hello no slot de produção de hello e ele pode funcionar em modo de acesso completo.</span><span class="sxs-lookup"><span data-stu-id="f5990-182">Note hello preparation steps will not impact hello application in hello production slot and it can function in full access mode.</span></span>
> 
> 

![Configuração da replicação geográfica do banco de dados SQL.](media/sql-database-manage-application-rolling-upgrade/Option2-1.png)

<span data-ttu-id="f5990-185">Depois que as etapas de preparação Olá forem concluídas, slot de estágio hello está pronto para atualização de saudação.</span><span class="sxs-lookup"><span data-stu-id="f5990-185">Once hello preparation steps are completed, hello stage slot is ready for hello upgrade.</span></span> <span data-ttu-id="f5990-186">Olá diagrama a seguir ilustra as etapas de atualização hello.</span><span class="sxs-lookup"><span data-stu-id="f5990-186">hello following diagram illustrates hello upgrade steps.</span></span>

1. <span data-ttu-id="f5990-187">Definir banco de dados primário Olá no hello slot tooread somente modo de produção (6).</span><span class="sxs-lookup"><span data-stu-id="f5990-187">Set hello primary database in hello production slot tooread-only mode (6).</span></span> <span data-ttu-id="f5990-188">Isso garantirá que Olá instância de produção do aplicativo hello (V1) permanecerá somente leitura durante a atualização de saudação impedindo divergência de dados Olá entre hello V1 e V2 instâncias de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f5990-188">This will guarantee that hello production instance of hello application (V1) will remain read-only during hello upgrade thus preventing hello data divergence between hello V1 and V2 database instances.</span></span>  
2. <span data-ttu-id="f5990-189">Desconecte o banco de dados secundário Olá no hello mesmo região usando Olá modo de encerramento planejado (7).</span><span class="sxs-lookup"><span data-stu-id="f5990-189">Disconnect hello secondary database in hello same region using hello planned termination mode (7).</span></span> <span data-ttu-id="f5990-190">Ele cria uma cópia independente totalmente sincronizada Olá banco de dados primário, que se tornará automaticamente um primário após o encerramento de saudação.</span><span class="sxs-lookup"><span data-stu-id="f5990-190">It will create a fully synchronized independent copy of hello primary database, which will automatically become a primary after hello termination.</span></span> <span data-ttu-id="f5990-191">Este banco de dados será atualizado.</span><span class="sxs-lookup"><span data-stu-id="f5990-191">This database will be upgraded.</span></span>
3. <span data-ttu-id="f5990-192">Ativar o banco de dados primário Olá no modo de gravação tooread de slot de estágio hello e execute o script de atualização de saudação (8).</span><span class="sxs-lookup"><span data-stu-id="f5990-192">Turn hello primary database in hello stage slot tooread-write mode and run hello upgrade script (8).</span></span>    

![Configuração da replicação geográfica do banco de dados SQL.](media/sql-database-manage-application-rolling-upgrade/Option2-2.png)

<span data-ttu-id="f5990-195">Se Olá atualização concluída com êxito agora você está pronto tooswitch Olá os usuários finais toohello V2 versão Olá aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f5990-195">If hello upgrade completed successfully you are now ready tooswitch hello end users toohello V2 version of hello application.</span></span> <span data-ttu-id="f5990-196">Olá diagrama a seguir ilustra as etapas de saudação envolvidas.</span><span class="sxs-lookup"><span data-stu-id="f5990-196">hello following diagram illustrates hello steps involved.</span></span>

1. <span data-ttu-id="f5990-197">Alternar ponto de extremidade ativo Olá no perfil do WATM Olá muito<i>2.azurewebsites.net contoso</i>, que agora aponta toohello V2 versão do site da web de saudação (9).</span><span class="sxs-lookup"><span data-stu-id="f5990-197">Switch hello active endpoint in hello WATM profile too<i>contoso-2.azurewebsites.net</i>, which now points toohello V2 version of hello web site (9).</span></span> <span data-ttu-id="f5990-198">Agora se torna um slot de produção com hello V2 aplicativo e o tráfego do usuário final é tooit direcionado.</span><span class="sxs-lookup"><span data-stu-id="f5990-198">It now becomes a production slot with hello V2 application and end-user traffic is directed tooit.</span></span> 
2. <span data-ttu-id="f5990-199">Se você não precisar mais aplicativos de V1 Olá para que você possa com segurança removido (10 e 11).</span><span class="sxs-lookup"><span data-stu-id="f5990-199">If you no longer need hello V1 application so you can safely remove it (10 and 11).</span></span>  

![Configuração da replicação geográfica do banco de dados SQL.](media/sql-database-manage-application-rolling-upgrade/Option2-3.png)

<span data-ttu-id="f5990-202">Se o processo de atualização de saudação for bem-sucedida, por exemplo devido a erro tooan no script de atualização hello, slot de estágio Olá deve ser considerada comprometida.</span><span class="sxs-lookup"><span data-stu-id="f5990-202">If hello upgrade process is unsuccessful, for example due tooan error in hello upgrade script, hello stage slot should be considered compromised.</span></span> <span data-ttu-id="f5990-203">tooroll fazer Olá toohello pré-atualização o estado do aplicativo simplesmente reverter o aplicativo de hello toousing no slot de produção de hello com acesso completo.</span><span class="sxs-lookup"><span data-stu-id="f5990-203">tooroll back hello application toohello pre-upgrade state you simply revert toousing hello application in hello production slot with full access.</span></span> <span data-ttu-id="f5990-204">etapas de Olá envolvidas são mostradas no diagrama seguinte hello.</span><span class="sxs-lookup"><span data-stu-id="f5990-204">hello steps involved are shown on hello next diagram.</span></span>    

1. <span data-ttu-id="f5990-205">Conjunto Olá cópia de banco de dados primário no modo de gravação de tooread de slot de produção de hello (12).</span><span class="sxs-lookup"><span data-stu-id="f5990-205">Set hello primary database copy in hello production slot tooread-write mode (12).</span></span> <span data-ttu-id="f5990-206">Isso irá restaurar Olá V1 completo funcionalmente no slot de produção de hello.</span><span class="sxs-lookup"><span data-stu-id="f5990-206">This will restore hello full V1 functionally in hello production slot.</span></span>
2. <span data-ttu-id="f5990-207">Executar a análise da causa raiz hello e remover componentes do hello comprometido no slot de estágio da saudação (13 e 14).</span><span class="sxs-lookup"><span data-stu-id="f5990-207">Perform hello root cause analysis and remove hello compromised components in hello stage slot (13 and 14).</span></span> 

<span data-ttu-id="f5990-208">Neste ponto aplicativo hello é totalmente funcional e etapas de atualização de saudação podem ser repetidas.</span><span class="sxs-lookup"><span data-stu-id="f5990-208">At this point hello application is fully functional and hello upgrade steps can be repeated.</span></span>

> [!NOTE]
> <span data-ttu-id="f5990-209">Olá reversão não requer alterações no perfil do WATM como aponta já muito <i>1.azurewebsites.net contoso</i> como Olá ponto de extremidade ativo.</span><span class="sxs-lookup"><span data-stu-id="f5990-209">hello rollback does not require changes in WATM profile as it already points too <i>contoso-1.azurewebsites.net</i> as hello active endpoint.</span></span>
> 
> 

![Configuração da replicação geográfica do banco de dados SQL.](media/sql-database-manage-application-rolling-upgrade/Option2-4.png)

<span data-ttu-id="f5990-212">chave de saudação **vantagem** dessa opção é que você pode atualizar o aplicativo hello e sua cópia com redundância geográfica em paralelo sem comprometer a continuidade dos negócios durante a atualização de saudação.</span><span class="sxs-lookup"><span data-stu-id="f5990-212">hello key **advantage** of this option is that you can upgrade both hello application and its geo-redundant copy in parallel without compromising your business continuity during hello upgrade.</span></span> <span data-ttu-id="f5990-213">Olá principal **compensação** é que ele requer redundância dupla de cada componente do aplicativo e, portanto, incorre em custo mais alto de dólares.</span><span class="sxs-lookup"><span data-stu-id="f5990-213">hello main **tradeoff** is that it requires double redundancy of each application component and therefore incurs higher dollar cost.</span></span> <span data-ttu-id="f5990-214">Ele também envolve um fluxo de trabalho mais complicado.</span><span class="sxs-lookup"><span data-stu-id="f5990-214">It also involves a more complicated workflow.</span></span> 

## <a name="summary"></a><span data-ttu-id="f5990-215">Resumo</span><span class="sxs-lookup"><span data-stu-id="f5990-215">Summary</span></span>
<span data-ttu-id="f5990-216">métodos de atualização Olá dois descritos no artigo Olá diferem em dólar hello e complexidade de custo, mas ambos se concentrar na minimização de tempo de saudação quando o usuário final de saudação é limitado de operações somente tooread.</span><span class="sxs-lookup"><span data-stu-id="f5990-216">hello two upgrade methods described in hello article differ in complexity and hello dollar cost but they both focus on minimizing hello time when hello end user is limited tooread-only operations.</span></span> <span data-ttu-id="f5990-217">Esse tempo é definido diretamente por duração Olá Olá do script de atualização.</span><span class="sxs-lookup"><span data-stu-id="f5990-217">That time is directly defined by hello duration of hello upgrade script.</span></span> <span data-ttu-id="f5990-218">Ele não depende de tamanho de banco de dados hello, Olá de camada de serviço você escolher, configuração de site da web hello e outros fatores que você não pode controlar facilmente.</span><span class="sxs-lookup"><span data-stu-id="f5990-218">It does not depend on hello database size, hello service tier you chose, hello web site configuration and other factors that you cannot easily control.</span></span> <span data-ttu-id="f5990-219">Isso ocorre porque todas as etapas de preparação de saudação são desacopladas etapas de atualização de saudação e podem ser feitas sem afetar o aplicativo de produção de hello.</span><span class="sxs-lookup"><span data-stu-id="f5990-219">This is because all hello preparation steps are decoupled from hello upgrade steps and can be done without impacting hello production application.</span></span> <span data-ttu-id="f5990-220">eficiência de Olá Olá do script de atualização é Olá fator-chave que determina a experiência do usuário final de saudação durante as atualizações.</span><span class="sxs-lookup"><span data-stu-id="f5990-220">hello efficiency of hello upgrade script is hello key factor that determines hello end-user experience during upgrades.</span></span> <span data-ttu-id="f5990-221">Portanto, Olá melhor maneira aprimorá-la é concentrando seus esforços em tornar o script de atualização hello mais eficiente possível.</span><span class="sxs-lookup"><span data-stu-id="f5990-221">So hello best way you can improve it is by focusing your efforts on making hello upgrade script as efficient as possible.</span></span>  

## <a name="next-steps"></a><span data-ttu-id="f5990-222">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="f5990-222">Next steps</span></span>
* <span data-ttu-id="f5990-223">Para obter uma visão geral e os cenários de continuidade dos negócios, consulte [Visão geral da continuidade dos negócios](sql-database-business-continuity.md).</span><span class="sxs-lookup"><span data-stu-id="f5990-223">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md).</span></span>
* <span data-ttu-id="f5990-224">toolearn sobre backups de banco de dados do SQL Azure automatizadas, consulte [backups automatizados de banco de dados SQL](sql-database-automated-backups.md).</span><span class="sxs-lookup"><span data-stu-id="f5990-224">toolearn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md).</span></span>
* <span data-ttu-id="f5990-225">toolearn sobre como usar backups automatizados para recuperação, consulte [restaurar um banco de dados de backups automatizados](sql-database-recovery-using-backups.md).</span><span class="sxs-lookup"><span data-stu-id="f5990-225">toolearn about using automated backups for recovery, see [restore a database from automated backups](sql-database-recovery-using-backups.md).</span></span>
* <span data-ttu-id="f5990-226">toolearn sobre as opções de recuperação mais rápidas, consulte [replicação geográfica ativa](sql-database-geo-replication-overview.md).</span><span class="sxs-lookup"><span data-stu-id="f5990-226">toolearn about faster recovery options, see [active geo-replication](sql-database-geo-replication-overview.md).</span></span>


