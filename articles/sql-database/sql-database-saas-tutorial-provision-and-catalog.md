---
title: "aaaProvision novos locatários em um aplicativo multilocatário que usa o banco de dados do SQL Azure | Microsoft Docs"
description: "Saiba como tooprovision e catálogo novo locatários no hello aplicativo SaaS Wingtip"
keywords: tutorial do banco de dados SQL
services: sql-database
documentationcenter: 
author: stevestein
manager: craigg
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/11/2017
ms.author: sstein
ms.openlocfilehash: eb26f523305650c2124e36707d187dfcdad06fcc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="provision-new-tenants-and-register-them-in-hello-catalog"></a><span data-ttu-id="8567c-104">Provisionar novos locatários e registrá-los no catálogo de saudação</span><span class="sxs-lookup"><span data-stu-id="8567c-104">Provision new tenants and register them in hello catalog</span></span>

<span data-ttu-id="8567c-105">Neste tutorial, você aprenderá sobre provisionar hello e padrões de SaaS do catálogo e como eles são implementados no hello aplicativo SaaS Wingtip.</span><span class="sxs-lookup"><span data-stu-id="8567c-105">In this tutorial, you learn about hello provision and catalog SaaS patterns, and how they are implemented in hello Wingtip SaaS application.</span></span> <span data-ttu-id="8567c-106">Criar e inicializar novos bancos de dados de locatário e registrá-los no catálogo de locatário do aplicativo hello.</span><span class="sxs-lookup"><span data-stu-id="8567c-106">You create and initialize new tenant databases, and register them in hello application’s tenant catalog.</span></span> <span data-ttu-id="8567c-107">Catálogo de saudação é um banco de dados que mantém o mapeamento de saudação entre vários locatários do aplicativo de SaaS hello e seus dados.</span><span class="sxs-lookup"><span data-stu-id="8567c-107">hello catalog is a database that maintains hello mapping between hello SaaS application's many tenants and their data.</span></span> <span data-ttu-id="8567c-108">Catálogo de saudação desempenha um papel importante direcionando aplicativo solicitações toohello banco de dados correto.</span><span class="sxs-lookup"><span data-stu-id="8567c-108">hello catalog plays an important role directing application requests toohello correct database.</span></span>  

<span data-ttu-id="8567c-109">Neste tutorial, você aprenderá como:</span><span class="sxs-lookup"><span data-stu-id="8567c-109">In this tutorial, you learn how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="8567c-110">Provisionar um novo locatário individual, o que inclui como isso é implementado</span><span class="sxs-lookup"><span data-stu-id="8567c-110">Provision a single new tenant, including stepping through how this is implemented</span></span>
> * <span data-ttu-id="8567c-111">Provisionar um lote de locatários adicionais</span><span class="sxs-lookup"><span data-stu-id="8567c-111">Provision a batch of additional tenants</span></span>


<span data-ttu-id="8567c-112">toocomplete neste tutorial, verifique Olá se os pré-requisitos a seguir são concluídas:</span><span class="sxs-lookup"><span data-stu-id="8567c-112">toocomplete this tutorial, make sure hello following prerequisites are completed:</span></span>

* <span data-ttu-id="8567c-113">Olá Wingtip SaaS aplicativo é implantado.</span><span class="sxs-lookup"><span data-stu-id="8567c-113">hello Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="8567c-114">toodeploy em menos de cinco minutos, consulte [implantar e explorar o aplicativo de SaaS Wingtip hello](sql-database-saas-tutorial.md)</span><span class="sxs-lookup"><span data-stu-id="8567c-114">toodeploy in less than five minutes, see [Deploy and explore hello Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="8567c-115">O Azure PowerShell está instalado.</span><span class="sxs-lookup"><span data-stu-id="8567c-115">Azure PowerShell is installed.</span></span> <span data-ttu-id="8567c-116">Para obter detalhes, consulte [Introdução ao Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span><span class="sxs-lookup"><span data-stu-id="8567c-116">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>

## <a name="introduction-toohello-saas-catalog-pattern"></a><span data-ttu-id="8567c-117">Introdução toohello padrão do catálogo de SaaS</span><span class="sxs-lookup"><span data-stu-id="8567c-117">Introduction toohello SaaS Catalog pattern</span></span>

<span data-ttu-id="8567c-118">Em um aplicativo de SaaS do backup de banco de dados multilocatário, é importante tooknow armazenamento de informações para cada locatário.</span><span class="sxs-lookup"><span data-stu-id="8567c-118">In a database-backed multi-tenant SaaS application, it's important tooknow where information for each tenant is stored.</span></span> <span data-ttu-id="8567c-119">No padrão de catálogo de SaaS hello, um banco de dados do catálogo é usado toohold Olá mapeamento entre cada locatário e onde seus dados estão armazenados.</span><span class="sxs-lookup"><span data-stu-id="8567c-119">In hello SaaS catalog pattern, a catalog database is used toohold hello mapping between each tenant and where their data is stored.</span></span> <span data-ttu-id="8567c-120">Olá Wingtip SaaS aplicativo usa um único locatário por arquitetura de banco de dados, mas o padrão básico de saudação do armazenamento de mapeamento de locatário no banco de dados em um catálogo aplica se um banco de dados multilocatário ou único locatário é usado.</span><span class="sxs-lookup"><span data-stu-id="8567c-120">hello Wingtip SaaS app uses a single-tenant per database architecture, but hello basic pattern of storing tenant-to-database mapping in a catalog applies whether a multi-tenant or single-tenant database is used.</span></span>

<span data-ttu-id="8567c-121">Cada locatário é atribuído a uma chave que identifica-los no catálogo de saudação e que é mapeado toohello local do banco de dados apropriado hello.</span><span class="sxs-lookup"><span data-stu-id="8567c-121">Each tenant is assigned a key that identifies them in hello catalog and which is mapped toohello location of hello appropriate database.</span></span> <span data-ttu-id="8567c-122">No aplicativo de SaaS Wingtip hello, chave Olá é formado de um hash do nome do locatário hello.</span><span class="sxs-lookup"><span data-stu-id="8567c-122">In hello Wingtip SaaS app, hello key is formed from a hash of hello tenant’s name.</span></span> <span data-ttu-id="8567c-123">Isso permite que a parte de nome de locatário Olá de toobe de URL do aplicativo hello usado como chave de saudação tooconstruct.</span><span class="sxs-lookup"><span data-stu-id="8567c-123">This allows hello tenant name portion of hello application URL toobe used tooconstruct hello key.</span></span> <span data-ttu-id="8567c-124">Outros esquemas de chave de locatário podem ser usados.</span><span class="sxs-lookup"><span data-stu-id="8567c-124">Other tenant key schemes could be used.</span></span>  

<span data-ttu-id="8567c-125">Catálogo de Olá permite que o nome de saudação ou local do hello toobe de banco de dados alterado com impacto mínimo sobre o aplicativo hello.</span><span class="sxs-lookup"><span data-stu-id="8567c-125">hello catalog allows hello name or location of hello database toobe changed with minimal impact on hello application.</span></span>  <span data-ttu-id="8567c-126">Em um modelo de banco de dados multilocatário, isso também acomoda a 'movimentação' de um locatário entre bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="8567c-126">In a multi-tenant database model, this also accommodates ‘moving’ a tenant between databases.</span></span>  <span data-ttu-id="8567c-127">Catálogo de saudação também pode ser usado tooindicate se um locatário ou banco de dados fica offline para manutenção ou outras ações.</span><span class="sxs-lookup"><span data-stu-id="8567c-127">hello catalog can also be used tooindicate whether a tenant or database is offline for maintenance or other actions.</span></span> <span data-ttu-id="8567c-128">Isso é explorado Olá [restauração do tutorial de locatário único](sql-database-saas-tutorial-restore-single-tenant.md).</span><span class="sxs-lookup"><span data-stu-id="8567c-128">This is explored in hello [restore single tenant tutorial](sql-database-saas-tutorial-restore-single-tenant.md).</span></span>

<span data-ttu-id="8567c-129">Além disso, o catálogo hello, que é na verdade um banco de dados de gerenciamento para um aplicativo SaaS, pode armazenar metadados adicionais de locatário ou o banco de dados, como Olá camada ou edição de um banco de dados, versão do esquema, o plano de serviço ou os SLAs oferecidos tootenants e outras informações que permite o gerenciamento de aplicativos, suporte ao cliente ou processos de devops.</span><span class="sxs-lookup"><span data-stu-id="8567c-129">In addition, hello catalog, which is in effect a management database for a SaaS application, can store additional tenant or database metadata, such as hello tier or edition of a database, schema version, service plan, or SLAs offered tootenants, and other info that enables application management, customer support, or devops processes.</span></span>  

<span data-ttu-id="8567c-130">Além da saudação aplicativo SaaS, catálogo Olá pode habilitar as ferramentas de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="8567c-130">Beyond hello SaaS application, hello catalog can enable database tools.</span></span>  <span data-ttu-id="8567c-131">No exemplo de SaaS Wingtip hello, catálogo Olá é consulta de entre locatários de tooenable usadas, explorada Olá [tutorial análise ad hoc](sql-database-saas-tutorial-adhoc-analytics.md).</span><span class="sxs-lookup"><span data-stu-id="8567c-131">In hello Wingtip SaaS sample, hello catalog is used tooenable cross-tenant query, explored in hello [ad hoc analytics tutorial](sql-database-saas-tutorial-adhoc-analytics.md).</span></span> <span data-ttu-id="8567c-132">Gerenciamento de trabalhos de bancos de dados é explorado em Olá [gerenciamento esquema](sql-database-saas-tutorial-schema-management.md) e [locatário análise](sql-database-saas-tutorial-tenant-analytics.md) tutoriais.</span><span class="sxs-lookup"><span data-stu-id="8567c-132">Cross-database job management is explored in hello [schema management](sql-database-saas-tutorial-schema-management.md) and [tenant analytics](sql-database-saas-tutorial-tenant-analytics.md) tutorials.</span></span> 

<span data-ttu-id="8567c-133">No aplicativo de SaaS Wingtip hello, catálogo Olá é implementado usando recursos de gerenciamento de fragmento de saudação do hello [biblioteca de cliente de banco de dados Elástico (EDCL)](sql-database-elastic-database-client-library.md).</span><span class="sxs-lookup"><span data-stu-id="8567c-133">In hello Wingtip SaaS app, hello catalog is implemented using hello Shard Management features of hello [Elastic Database Client Library (EDCL)](sql-database-elastic-database-client-library.md).</span></span> <span data-ttu-id="8567c-134">Olá EDCL permite que um aplicativo toocreate, gerenciar e usar um mapa do fragmento baseado no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="8567c-134">hello EDCL enables an application toocreate, manage, and use a database-backed shard map.</span></span> <span data-ttu-id="8567c-135">Um mapa do fragmento contém uma lista de fragmentos (bancos de dados) e o mapeamento de saudação entre chaves (locatários) e bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="8567c-135">A shard map contains a list of shards (databases) and hello mapping between keys (tenants) and databases.</span></span>  <span data-ttu-id="8567c-136">Funções EDCL podem ser usadas em aplicativos ou scripts do PowerShell durante provisionamento entradas de saudação toocreate no mapa de fragmento de saudação do locatário e de aplicativos tooefficiently conecte toohello banco de dados correto.</span><span class="sxs-lookup"><span data-stu-id="8567c-136">EDCL functions can be used from applications or PowerShell scripts during tenant provisioning toocreate hello entries in hello shard map, and from applications tooefficiently connect toohello correct database.</span></span> <span data-ttu-id="8567c-137">EDCL armazena em cache conexão informações toominimize Olá tráfego toohello catálogo banco de dados e acelerar o aplicativo hello.</span><span class="sxs-lookup"><span data-stu-id="8567c-137">EDCL caches connection information toominimize hello traffic toohello catalog database and speed up hello application.</span></span>  

> [!IMPORTANT]
> <span data-ttu-id="8567c-138">dados de mapeamento de saudação estão acessíveis no banco de dados de catálogo hello, mas *não editá-lo*!</span><span class="sxs-lookup"><span data-stu-id="8567c-138">hello mapping data is accessible in hello catalog database, but *don't edit it*!</span></span> <span data-ttu-id="8567c-139">Edite os dados de mapeamento somente com o uso de APIs da Biblioteca de Cliente do Banco de Dados Elástico.</span><span class="sxs-lookup"><span data-stu-id="8567c-139">Edit mapping data using Elastic Database Client Library APIs only.</span></span> <span data-ttu-id="8567c-140">Dados de mapeamento de saudação riscos saudação à corrupção do catálogo e não há suporte para a manipulação direta.</span><span class="sxs-lookup"><span data-stu-id="8567c-140">Directly manipulating hello mapping data risks corrupting hello catalog and is not supported.</span></span>


## <a name="introduction-toohello-saas-provisioning-pattern"></a><span data-ttu-id="8567c-141">Padrão de provisionamento de SaaS toohello de Introdução</span><span class="sxs-lookup"><span data-stu-id="8567c-141">Introduction toohello SaaS Provisioning pattern</span></span>

<span data-ttu-id="8567c-142">Ao integrar um novo locatário em um aplicativo SaaS que usa um modelo de banco de dados de locatário único, é necessário provisionar um novo banco de dados de locatário.</span><span class="sxs-lookup"><span data-stu-id="8567c-142">When onboarding a new tenant in a SaaS application that uses a single-tenant database model a new tenant database must be provisioned.</span></span>  <span data-ttu-id="8567c-143">Ele deve ser criado no local apropriado do hello e camada de serviço, inicializado com dados de referência e o esquema apropriado e, em seguida registrados no catálogo de Olá sob a chave de locatário apropriado de saudação.</span><span class="sxs-lookup"><span data-stu-id="8567c-143">It must be created in hello appropriate location and service tier, initialized with appropriate schema and reference data, and then registered in hello catalog under hello appropriate tenant key.</span></span>  

<span data-ttu-id="8567c-144">Abordagens diferentes podem ser usado toodatabase provisionamento, que pode incluir a execução de scripts SQL, implantando um bacpac ou copiando um banco de dados de modelo 'dourada'.</span><span class="sxs-lookup"><span data-stu-id="8567c-144">Different approaches can be used toodatabase provisioning, which could include executing SQL scripts, deploying a bacpac, or copying a 'golden' template database.</span></span>  

<span data-ttu-id="8567c-145">Olá provisionamento abordagem usada deve ser compreendida em sua estratégia de gerenciamento geral do esquema, que deve garantir que os novos bancos de dados são provisionados com esquema mais recente hello.</span><span class="sxs-lookup"><span data-stu-id="8567c-145">hello provisioning approach you use must be comprehended in your overall schema management strategy, which must ensure that new databases are provisioned with hello latest schema.</span></span>  <span data-ttu-id="8567c-146">Isso é explorado Olá [tutorial de gerenciamento de esquema](sql-database-saas-tutorial-schema-management.md).</span><span class="sxs-lookup"><span data-stu-id="8567c-146">This is explored in hello [schema management tutorial](sql-database-saas-tutorial-schema-management.md).</span></span>  

<span data-ttu-id="8567c-147">Olá Wingtip SaaS aplicativo provisionar novos locatários copiando um banco de dados dourado denominado basetenantdb, implantado no servidor de catálogo hello.</span><span class="sxs-lookup"><span data-stu-id="8567c-147">hello Wingtip SaaS app provisions new tenants by copying a golden database named basetenantdb, deployed on hello catalog server.</span></span>  <span data-ttu-id="8567c-148">Provisionamento pode ser integrado a aplicativo hello como parte de um processo de inscrição, e/ou suporte offline usando scripts.</span><span class="sxs-lookup"><span data-stu-id="8567c-148">Provisioning could be integrated into hello application as part of a sign-up experience, and/or supported offline using scripts.</span></span> <span data-ttu-id="8567c-149">Este tutorial explorará o provisionamento usando o PowerShell.</span><span class="sxs-lookup"><span data-stu-id="8567c-149">This tutorial will explore provisioning using PowerShell.</span></span> <span data-ttu-id="8567c-150">scripts de provisionamento de saudação copiar Olá basetenantdb toocreate um novo banco de dados de locatário em um pool Elástico, em seguida, inicialização-lo com informações específicas do locatário e registrá-lo no mapa de fragmento de catálogo hello.</span><span class="sxs-lookup"><span data-stu-id="8567c-150">hello provisioning scripts copy hello basetenantdb toocreate a new tenant database in an elastic pool, then initialize it with tenant-specific info and register it in hello catalog shard map.</span></span>  <span data-ttu-id="8567c-151">No aplicativo de exemplo hello, bancos de dados são fornecidos nomes com base no nome do locatário hello, mas isso não é uma parte crítica do padrão de hello – uso de saudação do catálogo de saudação permite que qualquer banco de dados do nome toobe atribuído toohello. +</span><span class="sxs-lookup"><span data-stu-id="8567c-151">In hello sample app, databases are given names based on hello tenant name, but this is not a critical part of hello pattern – hello use of hello catalog allows any name toobe assigned toohello database.+</span></span> 


## <a name="get-hello-wingtip-application-scripts"></a><span data-ttu-id="8567c-152">Obter scripts de aplicativo hello Wingtip</span><span class="sxs-lookup"><span data-stu-id="8567c-152">Get hello Wingtip application scripts</span></span>

<span data-ttu-id="8567c-153">Hello Wingtip SaaS scripts e código fonte do aplicativo estão disponíveis no hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) repositório github.</span><span class="sxs-lookup"><span data-stu-id="8567c-153">hello Wingtip SaaS scripts and application source code are available in hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="8567c-154">[As etapas de scripts de SaaS Wingtip Olá toodownload](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="8567c-154">[Steps toodownload hello Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>


## <a name="provision-and-catalog-detailed-walkthrough"></a><span data-ttu-id="8567c-155">Passo a passo detalhado para provisionar e catalogar</span><span class="sxs-lookup"><span data-stu-id="8567c-155">Provision and catalog detailed walkthrough</span></span>

<span data-ttu-id="8567c-156">como toounderstand Olá Wingtip aplicativo implementa o novo locatário de provisionamento, adicione um ponto de interrupção e percorrer o fluxo de trabalho Olá durante o provisionamento de um locatário:</span><span class="sxs-lookup"><span data-stu-id="8567c-156">toounderstand how hello Wingtip application implements new tenant provisioning, add a breakpoint and step through hello workflow while provisioning a tenant:</span></span>

1. <span data-ttu-id="8567c-157">Abrir... \\Módulos de aprendizado\\ProvisionAndCatalog\\_ProvisionAndCatalog.ps1 demonstração_ e saudação do conjunto de parâmetros a seguir:</span><span class="sxs-lookup"><span data-stu-id="8567c-157">Open ...\\Learning Modules\\ProvisionAndCatalog\\_Demo-ProvisionAndCatalog.ps1_ and set hello following parameters:</span></span>
   * <span data-ttu-id="8567c-158">**$TenantName** = nome de saudação do local novo hello (por exemplo, *Bushwillow azuis*).</span><span class="sxs-lookup"><span data-stu-id="8567c-158">**$TenantName** = hello name of hello new venue (for example, *Bushwillow Blues*).</span></span>
   * <span data-ttu-id="8567c-159">**$VenueType** = um dos tipos de local predefinido Olá: *azuis*, classicalmusic, dança, jazz, judo, motorracing, com várias finalidades, opera, rockmusic, futebol.</span><span class="sxs-lookup"><span data-stu-id="8567c-159">**$VenueType** = one of hello pre-defined venue types: *blues*, classicalmusic, dance, jazz, judo, motorracing, multipurpose, opera, rockmusic, soccer.</span></span>
   * <span data-ttu-id="8567c-160">**$DemoScenario** = **1**, defina muito**1** muito*provisionar um único locatário*.</span><span class="sxs-lookup"><span data-stu-id="8567c-160">**$DemoScenario** = **1**, Set too**1** too*Provision a single tenant*.</span></span>

1. <span data-ttu-id="8567c-161">Adicionar um ponto de interrupção colocando o cursor em qualquer lugar na linha hello 48, linha que diz: *novo locatário '*e pressione **F9**.</span><span class="sxs-lookup"><span data-stu-id="8567c-161">Add a breakpoint by putting your cursor anywhere on line 48, hello line that says: *New-Tenant \`*, and press **F9**.</span></span>

   ![ponto de interrupção](media/sql-database-saas-tutorial-provision-and-catalog/breakpoint.png)

1. <span data-ttu-id="8567c-163">Pressione de script hello toorun **F5**.</span><span class="sxs-lookup"><span data-stu-id="8567c-163">toorun hello script press **F5**.</span></span>

1. <span data-ttu-id="8567c-164">Após a execução do script hello for interrompida no ponto de interrupção hello, pressione **F11** toostep em código hello.</span><span class="sxs-lookup"><span data-stu-id="8567c-164">After hello script execution stops at hello breakpoint, press **F11** toostep into hello code.</span></span>

   ![ponto de interrupção](media/sql-database-saas-tutorial-provision-and-catalog/debug.png)



<span data-ttu-id="8567c-166">Rastreamento de execução do script hello com hello **depurar** opções de menu - **F10** e **F11** toostep pela ou em Olá chamadas de funções.</span><span class="sxs-lookup"><span data-stu-id="8567c-166">Trace hello script's execution using hello **Debug** menu options - **F10** and **F11** toostep over or into hello called functions.</span></span> <span data-ttu-id="8567c-167">Para saber mais sobre como depurar scripts do PowerShell, confira [Dicas sobre como trabalhar e depurar scripts do PowerShell](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise).</span><span class="sxs-lookup"><span data-stu-id="8567c-167">For more information about debugging PowerShell scripts, see [Tips on working with and debugging PowerShell scripts](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise).</span></span>


<span data-ttu-id="8567c-168">a seguir Olá não é as etapas a seguir tooexplicitly, mas uma explicação de fluxo de trabalho Olá que percorrer durante a depuração de script hello:</span><span class="sxs-lookup"><span data-stu-id="8567c-168">hello following are not steps tooexplicitly follow, but an explanation of hello workflow you step through while debugging hello script:</span></span>

1. <span data-ttu-id="8567c-169">**Saudação de importação SubscriptionManagement.psm1** módulo que contém funções para entrar tooAzure e selecionando Olá assinatura do Azure que você está trabalhando.</span><span class="sxs-lookup"><span data-stu-id="8567c-169">**Import hello SubscriptionManagement.psm1** module that contains functions for signing in tooAzure and selecting hello Azure subscription you are working with.</span></span>
1. <span data-ttu-id="8567c-170">**Saudação de importação CatalogAndDatabaseManagement.psm1** módulo que fornece um catálogo e o nível de locatário abstração sobre Olá [gerenciamento de fragmento](sql-database-elastic-scale-shard-map-management.md) funções.</span><span class="sxs-lookup"><span data-stu-id="8567c-170">**Import hello CatalogAndDatabaseManagement.psm1** module that provides a catalog and tenant-level abstraction over hello [Shard Management](sql-database-elastic-scale-shard-map-management.md) functions.</span></span> <span data-ttu-id="8567c-171">Este é um módulo importante que encapsula a maior parte do padrão de catálogo hello e vale a pena explorar.</span><span class="sxs-lookup"><span data-stu-id="8567c-171">This is an important module that encapsulates much of hello catalog pattern and is worth exploring.</span></span>
1. <span data-ttu-id="8567c-172">**Obter detalhes de configuração**.</span><span class="sxs-lookup"><span data-stu-id="8567c-172">**Get configuration details**.</span></span> <span data-ttu-id="8567c-173">Intervir Get-configuração (F11) e ver como a configuração de aplicativo hello é especificada.</span><span class="sxs-lookup"><span data-stu-id="8567c-173">Step into Get-Configuration (with F11) and see how hello app config is specified.</span></span> <span data-ttu-id="8567c-174">Nomes de recursos e outros valores específicos de aplicativo definidos aqui, mas não altere qualquer um desses valores até que você esteja familiarizado com os scripts de saudação.</span><span class="sxs-lookup"><span data-stu-id="8567c-174">Resource names and other app-specific values are defined here, but do not change any of these values until you are familiar with hello scripts.</span></span>
1. <span data-ttu-id="8567c-175">**Obter o objeto de catálogo Olá**.</span><span class="sxs-lookup"><span data-stu-id="8567c-175">**Get hello catalog object**.</span></span> <span data-ttu-id="8567c-176">Etapa para Get-catálogo que compõe e retorna um objeto de catálogo que é usado no script de nível mais alto de saudação.</span><span class="sxs-lookup"><span data-stu-id="8567c-176">Step into Get-Catalog which composes and returns a catalog object that is used in hello higher-level script.</span></span>  <span data-ttu-id="8567c-177">Essa função usa funções de Gerenciamento de Fragmentos importadas do **AzureShardManagement.psm1**.</span><span class="sxs-lookup"><span data-stu-id="8567c-177">This function uses Shard Management functions that are imported from **AzureShardManagement.psm1**.</span></span> <span data-ttu-id="8567c-178">o objeto de catálogo Olá é composto de seguir hello:</span><span class="sxs-lookup"><span data-stu-id="8567c-178">hello catalog object is composed of hello following:</span></span>
   * <span data-ttu-id="8567c-179">$catalogServerFullyQualifiedName é construído usando stem padrão hello mais seu nome de usuário: _catálogo -\<usuário\>. t_.</span><span class="sxs-lookup"><span data-stu-id="8567c-179">$catalogServerFullyQualifiedName is constructed using hello standard stem plus your User name: _catalog-\<user\>.database.windows.net_.</span></span>
   * <span data-ttu-id="8567c-180">$catalogDatabaseName é recuperado do config Olá: *tenantcatalog*.</span><span class="sxs-lookup"><span data-stu-id="8567c-180">$catalogDatabaseName is retrieved from hello config: *tenantcatalog*.</span></span>
   * <span data-ttu-id="8567c-181">objeto $shardMapManager foi inicializado de banco de dados de catálogo hello.</span><span class="sxs-lookup"><span data-stu-id="8567c-181">$shardMapManager object is initialized from hello catalog database.</span></span>
   * <span data-ttu-id="8567c-182">objeto $shardMap é inicializado de saudação *tenantcatalog* mapa do fragmento no banco de dados de catálogo hello.</span><span class="sxs-lookup"><span data-stu-id="8567c-182">$shardMap object is initialized from hello *tenantcatalog* shard map in hello catalog database.</span></span>
   <span data-ttu-id="8567c-183">Um objeto de catálogo é composto e retornado e usado no script de nível mais alto de saudação.</span><span class="sxs-lookup"><span data-stu-id="8567c-183">A catalog object is composed and returned, and used in hello higher-level script.</span></span>
1. <span data-ttu-id="8567c-184">**Calcular a nova chave de locatário Olá**.</span><span class="sxs-lookup"><span data-stu-id="8567c-184">**Calculate hello new tenant key**.</span></span> <span data-ttu-id="8567c-185">Uma função de hash é chave de locatário usado toocreate Olá do nome do locatário hello.</span><span class="sxs-lookup"><span data-stu-id="8567c-185">A hash function is used toocreate hello tenant key from hello tenant name.</span></span>
1. <span data-ttu-id="8567c-186">**Verifique se já existe uma chave de locatário Olá**.</span><span class="sxs-lookup"><span data-stu-id="8567c-186">**Check if hello tenant key already exists**.</span></span> <span data-ttu-id="8567c-187">Catálogo de saudação é verificado tooensure Olá chave está disponível.</span><span class="sxs-lookup"><span data-stu-id="8567c-187">hello catalog is checked tooensure hello key is available.</span></span>
1. <span data-ttu-id="8567c-188">**banco de dados de locatário Hello está provisionado com New-TenantDatabase.**</span><span class="sxs-lookup"><span data-stu-id="8567c-188">**hello tenant database is provisioned with New-TenantDatabase.**</span></span> <span data-ttu-id="8567c-189">Use **F11** toostep no e ver como é o banco de dados de saudação provisionados usando um [modelo do Azure Resource Manager](../azure-resource-manager/resource-manager-template-walkthrough.md).</span><span class="sxs-lookup"><span data-stu-id="8567c-189">Use **F11** toostep in and see how hello database is provisioned using an [Azure Resource Manager template](../azure-resource-manager/resource-manager-template-walkthrough.md).</span></span>

<span data-ttu-id="8567c-190">nome do banco de dados de saudação é construído com hello locatário nome toomake claro qual fragmento pertence toowhich locatário.</span><span class="sxs-lookup"><span data-stu-id="8567c-190">hello database name is constructed from hello tenant name toomake it clear which shard belongs toowhich tenant.</span></span> <span data-ttu-id="8567c-191">(Outras estratégias de nomeação do banco de dados facilmente usadas.) + Um modelo do Gerenciador de recursos é usado toocreate um banco de dados de locatário copiando um banco de dados ouro (baseTenantDB) no servidor de catálogo hello.</span><span class="sxs-lookup"><span data-stu-id="8567c-191">(Other strategies for database naming could easily be used.)+ A Resource Manager template is used toocreate a tenant database by copying a golden database (baseTenantDB) on hello catalog server.</span></span> <span data-ttu-id="8567c-192">Uma abordagem alternativa pode ser toocreate um banco de dados vazio e inicializá-lo com a importação de um bacpac ou tooexecute um script de inicialização de um local conhecido.</span><span class="sxs-lookup"><span data-stu-id="8567c-192">An alternative approach could be toocreate an empty database and then initialize it by importing a bacpac, or tooexecute an initialization script from a well-known location.</span></span>  

<span data-ttu-id="8567c-193">modelo do Gerenciador de recursos de saudação está na pasta do hello ...\Learning Modules\Common\: *tenantdatabasecopytemplate.json*</span><span class="sxs-lookup"><span data-stu-id="8567c-193">hello Resource Manager template is in hello …\Learning Modules\Common\ folder: *tenantdatabasecopytemplate.json*</span></span>

<span data-ttu-id="8567c-194">Após a criação do banco de dados de locatário hello, em seguida, é ainda mais **inicializada com o nome de local (Locatário) de saudação e o tipo de local de saudação**.</span><span class="sxs-lookup"><span data-stu-id="8567c-194">After hello tenant database is created, it is then further **initialized with hello venue (tenant) name and hello venue type**.</span></span> <span data-ttu-id="8567c-195">Outra inicialização também poderia ser feita aqui.</span><span class="sxs-lookup"><span data-stu-id="8567c-195">Other initialization could also be done here.</span></span>

<span data-ttu-id="8567c-196">Olá **banco de dados de locatário é registrado no catálogo de saudação** com *TenantDatabaseToCatalog adicionar* usando a chave de locatário hello.</span><span class="sxs-lookup"><span data-stu-id="8567c-196">hello **tenant database is registered in hello catalog** with *Add-TenantDatabaseToCatalog* using hello tenant key.</span></span> <span data-ttu-id="8567c-197">Use **F11** toostep detalhes hello:</span><span class="sxs-lookup"><span data-stu-id="8567c-197">Use **F11** toostep into hello details:</span></span>

* <span data-ttu-id="8567c-198">banco de dados de catálogo Olá é adicionado mapa do fragmento toohello (lista de saudação de bancos de dados conhecidos).</span><span class="sxs-lookup"><span data-stu-id="8567c-198">hello catalog database is added toohello shard map (hello list of known databases).</span></span>
* <span data-ttu-id="8567c-199">Olá mapeamento desse fragmento de toohello links Olá valor da chave é criada.</span><span class="sxs-lookup"><span data-stu-id="8567c-199">hello mapping that links hello key value toohello shard is created.</span></span>
* <span data-ttu-id="8567c-200">Dados adicionais meta (nome do local do evento Olá) sobre o locatário Olá são adicionados toohello tabela de locatários no catálogo de saudação.</span><span class="sxs-lookup"><span data-stu-id="8567c-200">Additional meta data (hello venue's name) about hello tenant is added toohello Tenants table in hello catalog.</span></span>  <span data-ttu-id="8567c-201">tabela de locatários Olá não faz parte do esquema de ShardManagement hello e não é instalada por Olá EDCL.</span><span class="sxs-lookup"><span data-stu-id="8567c-201">hello Tenants table is not part of hello ShardManagement schema and is not installed by hello EDCL.</span></span>  <span data-ttu-id="8567c-202">Esta tabela ilustra como banco de dados de catálogo Olá pode ser estendido dados do toosupport adicionais específicos do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="8567c-202">This table illustrates how hello Catalog database can be extended toosupport additional application-specific data.</span></span>   


<span data-ttu-id="8567c-203">Após a conclusão do provisionamento, execução retorna toohello original *demonstração ProvisionAndCatalog* script, o que abre Olá **eventos** página para o novo locatário Olá no navegador de saudação:</span><span class="sxs-lookup"><span data-stu-id="8567c-203">After provisioning completes, execution returns toohello original *Demo-ProvisionAndCatalog* script, which opens hello **Events** page for hello new tenant in hello browser:</span></span>

   ![events](media/sql-database-saas-tutorial-provision-and-catalog/new-tenant.png)


## <a name="provision-a-batch-of-tenants"></a><span data-ttu-id="8567c-205">Provisionar um lote de locatários</span><span class="sxs-lookup"><span data-stu-id="8567c-205">Provision a batch of tenants</span></span>

<span data-ttu-id="8567c-206">Este exercício provisiona um lote com 17 locatários.</span><span class="sxs-lookup"><span data-stu-id="8567c-206">This exercise provisions a batch of 17 tenants.</span></span> <span data-ttu-id="8567c-207">É recomendável que você provisionar este lote de locatários antes de iniciar outros tutoriais Wingtip SaaS, portanto, há mais do que apenas alguns toowork de bancos de dados com.</span><span class="sxs-lookup"><span data-stu-id="8567c-207">It’s recommended you provision this batch of tenants before starting other Wingtip SaaS tutorials, so there's more than just a few databases toowork with.</span></span>

1. <span data-ttu-id="8567c-208">Abrir... \\Módulos de aprendizado\\ProvisionAndCatalog\\*demonstração ProvisionAndCatalog.ps1* em Olá *PowerShell ISE* e alterar Olá *$ DemoScenario* too3 de parâmetro:</span><span class="sxs-lookup"><span data-stu-id="8567c-208">Open ...\\Learning Modules\\ProvisionAndCatalog\\*Demo-ProvisionAndCatalog.ps1* in hello *PowerShell ISE* and change hello *$DemoScenario* parameter too3:</span></span>
   * <span data-ttu-id="8567c-209">**$DemoScenario** = **3**, alterar muito**3** muito*provisionar um lote de locatários*.</span><span class="sxs-lookup"><span data-stu-id="8567c-209">**$DemoScenario** = **3**, change too**3** too*Provision a batch of tenants*.</span></span>
1. <span data-ttu-id="8567c-210">Pressione **F5** e execute o script hello.</span><span class="sxs-lookup"><span data-stu-id="8567c-210">Press **F5** and run hello script.</span></span>

<span data-ttu-id="8567c-211">script Hello implanta um lote de locatários adicionais.</span><span class="sxs-lookup"><span data-stu-id="8567c-211">hello script deploys a batch of additional tenants.</span></span> <span data-ttu-id="8567c-212">Ele usa um [modelo do Azure Resource Manager](../azure-resource-manager/resource-manager-template-walkthrough.md) que controla o lote hello e, em seguida, delega o provisionamento de cada modelo vinculado de tooa do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="8567c-212">It uses an [Azure Resource Manager template](../azure-resource-manager/resource-manager-template-walkthrough.md) that controls hello batch and then delegates provisioning of each database tooa linked template.</span></span> <span data-ttu-id="8567c-213">Usando modelos dessa maneira permite que o Azure Resource Manager toobroker Olá processo para o seu script de provisionamento.</span><span class="sxs-lookup"><span data-stu-id="8567c-213">Using templates in this way allows Azure Resource Manager toobroker hello provisioning process for your script.</span></span> <span data-ttu-id="8567c-214">Modelos de provisionar bancos de dados em paralelo, onde ele pode e manipula as repetições se necessário, otimizando Olá processo geral.</span><span class="sxs-lookup"><span data-stu-id="8567c-214">Templates provision databases in parallel where it can, and handles retries if needed, optimizing hello overall process.</span></span> <span data-ttu-id="8567c-215">Olá script é idempotente assim se ele falha, ou para por qualquer motivo, execute-o novamente.</span><span class="sxs-lookup"><span data-stu-id="8567c-215">hello script is idempotent so if it fails or stops for any reason, run it again.</span></span>

### <a name="verify-hello-batch-of-tenants-successfully-deployed"></a><span data-ttu-id="8567c-216">Verifique se o lote de saudação de locatários foi implantado com êxito</span><span class="sxs-lookup"><span data-stu-id="8567c-216">Verify hello batch of tenants successfully deployed</span></span>

* <span data-ttu-id="8567c-217">Olá abrir *tenants1* servidor navegando tooyour lista de servidores no hello [portal do Azure](https://portal.azure.com), clique em **bancos de dados SQL**e verifique se o lote de saudação de 17 bancos de dados adicionais são agora na lista de saudação:</span><span class="sxs-lookup"><span data-stu-id="8567c-217">Open hello *tenants1* server by browsing tooyour list of servers in hello [Azure portal](https://portal.azure.com), click **SQL databases**, and verify hello batch of 17 additional databases are now in hello list:</span></span>

   ![lista de banco de dados](media/sql-database-saas-tutorial-provision-and-catalog/database-list.png)



## <a name="other-provisioning-patterns"></a><span data-ttu-id="8567c-219">Outros padrões de provisionamento</span><span class="sxs-lookup"><span data-stu-id="8567c-219">Other provisioning patterns</span></span>

<span data-ttu-id="8567c-220">Outros padrões de provisionamento não mencionados nesse tutorial incluem:</span><span class="sxs-lookup"><span data-stu-id="8567c-220">Other provisioning patterns not included in this tutorial include:</span></span>

<span data-ttu-id="8567c-221">**Pré-provisionamento de bancos de dados.**</span><span class="sxs-lookup"><span data-stu-id="8567c-221">**Pre-provisioning databases.**</span></span> <span data-ttu-id="8567c-222">Olá previamente provisionamento padrão explora o fato de saudação que bancos de dados em um pool Elástico não adicionam custo extra.</span><span class="sxs-lookup"><span data-stu-id="8567c-222">hello pre-provisioning pattern exploits hello fact that databases in an elastic pool do not add extra cost.</span></span> <span data-ttu-id="8567c-223">A cobrança é para o pool Elástico hello, Olá não bancos de dados e bancos de dados ociosos não consomem nenhum recurso.</span><span class="sxs-lookup"><span data-stu-id="8567c-223">Billing is for hello elastic pool, not hello databases, and idle databases consume no resources.</span></span> <span data-ttu-id="8567c-224">Ao pré-provisionar bancos de dados em um pool e alocá-los quando necessário, o tempo de integração do locatário poderá ser reduzido consideravelmente.</span><span class="sxs-lookup"><span data-stu-id="8567c-224">By pre-provisioning databases in a pool and allocating them when needed, tenant onboarding time can be reduced significantly.</span></span> <span data-ttu-id="8567c-225">Olá número de bancos de dados previamente provisionado foi ajustado conforme necessário tookeep um buffer adequado para Olá antecipado de provisionamento taxa.</span><span class="sxs-lookup"><span data-stu-id="8567c-225">hello number of databases pre-provisioned could be adjusted as needed tookeep a buffer suitable for hello anticipated provisioning rate.</span></span>

<span data-ttu-id="8567c-226">**Provisionamento automático.**</span><span class="sxs-lookup"><span data-stu-id="8567c-226">**Auto-provisioning.**</span></span> <span data-ttu-id="8567c-227">No padrão de provisionamento automático Olá, um serviço de provisionamento dedicado é usado tooprovision servidores, pools e bancos de dados automaticamente conforme necessário – incluindo bancos de dados previamente provisionamento em pools Elásticos se desejado.</span><span class="sxs-lookup"><span data-stu-id="8567c-227">In hello auto-provisioning pattern, a dedicated provisioning service is used tooprovision servers, pools, and databases automatically as needed – including pre-provisioning databases in elastic pools if desired.</span></span> <span data-ttu-id="8567c-228">E se os bancos de dados são contratados eliminação e excluídos, intervalos de pools Elásticos podem ser preenchidos pelo Olá provisionamento de serviço conforme desejado.</span><span class="sxs-lookup"><span data-stu-id="8567c-228">And if databases are de-commissioned and deleted, gaps in elastic pools can be filled by hello provisioning service as desired.</span></span> <span data-ttu-id="8567c-229">Esse serviço poderá ser simples ou complexo – por exemplo, manipulação do provisionamento em várias áreas geográficas e poderá configurar a replicação geográfica automaticamente, caso essa estratégia esteja sendo usada para a recuperação de desastre.</span><span class="sxs-lookup"><span data-stu-id="8567c-229">Such a service could be simple or complex – for example, handling provisioning across multiple geographies, and could set up geo-replication automatically if that strategy is being used for disaster recovery.</span></span> <span data-ttu-id="8567c-230">Com padrão de provisionamento automático Olá, um script ou aplicativo cliente pode enviar um provisionamento toobe de fila de tooa solicitação processada pelo Olá provisionar um serviço e, em seguida, seria sondar a conclusão do hello serviço toodetermine.</span><span class="sxs-lookup"><span data-stu-id="8567c-230">With hello auto-provisioning pattern, a client application or script would submit a provisioning request tooa queue toobe processed by hello provisioning service, and would then poll hello service toodetermine completion.</span></span> <span data-ttu-id="8567c-231">Se for usado o provisionamento prévio, solicitações seriam manipuladas rapidamente com o serviço de saudação Gerenciando o provisionamento de um banco de dados de substituição em execução no plano de fundo de saudação.</span><span class="sxs-lookup"><span data-stu-id="8567c-231">If pre-provisioning is used, requests would be handled quickly with hello service managing provisioning of a replacement database running in hello background.</span></span>



## <a name="next-steps"></a><span data-ttu-id="8567c-232">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="8567c-232">Next steps</span></span>

<span data-ttu-id="8567c-233">Neste tutorial, você aprendeu a:</span><span class="sxs-lookup"><span data-stu-id="8567c-233">In this tutorial you learned how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="8567c-234">Provisionar um novo único locatário</span><span class="sxs-lookup"><span data-stu-id="8567c-234">Provision a single new tenant</span></span>
> * <span data-ttu-id="8567c-235">Provisionar um lote de locatários adicionais</span><span class="sxs-lookup"><span data-stu-id="8567c-235">Provision a batch of additional tenants</span></span>
> * <span data-ttu-id="8567c-236">Entrar em detalhes de saudação do provisionamento de locatários e registrando-os no catálogo de saudação</span><span class="sxs-lookup"><span data-stu-id="8567c-236">Step into hello details of provisioning tenants, and registering them into hello catalog</span></span>

<span data-ttu-id="8567c-237">Tente Olá [tutorial de monitoramento de desempenho](sql-database-saas-tutorial-performance-monitoring.md).</span><span class="sxs-lookup"><span data-stu-id="8567c-237">Try hello [Performance monitoring tutorial](sql-database-saas-tutorial-performance-monitoring.md).</span></span>

## <a name="additional-resources"></a><span data-ttu-id="8567c-238">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="8567c-238">Additional Resources</span></span>

* <span data-ttu-id="8567c-239">Adicionais [tutoriais que se baseiam na Olá aplicativo SaaS Wingtip](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span><span class="sxs-lookup"><span data-stu-id="8567c-239">Additional [tutorials that build upon hello Wingtip SaaS application](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span></span>
* [<span data-ttu-id="8567c-240">Biblioteca de cliente do banco de dados elástico</span><span class="sxs-lookup"><span data-stu-id="8567c-240">Elastic database client library</span></span>](https://docs.microsoft.com/azure/sql-database/sql-database-elastic-database-client-library)
* [<span data-ttu-id="8567c-241">Como tooDebug Scripts no ISE do Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="8567c-241">How tooDebug Scripts in Windows PowerShell ISE</span></span>](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise)
