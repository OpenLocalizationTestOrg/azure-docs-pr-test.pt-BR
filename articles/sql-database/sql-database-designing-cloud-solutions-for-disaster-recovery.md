---
title: "aaaDesign serviço altamente disponível usando o banco de dados do SQL Azure | Microsoft Docs"
description: "Saiba mais sobre a criação de um aplicativo para serviços altamente disponíveis usando o Banco de Dados SQL do Azure."
keywords: "recuperação de desastre em nuvem, soluções de recuperação de desastre, backup de dados de aplicativo, replicação geográfica, planejamento de continuidade de negócios"
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: e8a346ac-dd08-41e7-9685-46cebca04582
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-management
ms.date: 04/21/2017
ms.author: sashan
ms.openlocfilehash: 815f754ba7014cd8a1108a2d84c2a8f71d7030a5
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="designing-highly-available-services-using-azure-sql-database"></a><span data-ttu-id="53924-104">Criar serviços altamente disponíveis usando o Banco de Dados SQL do Azure</span><span class="sxs-lookup"><span data-stu-id="53924-104">Designing highly available services using Azure SQL Database</span></span>

<span data-ttu-id="53924-105">Ao criar e implantar serviços altamente disponíveis no banco de dados do SQL Azure, você usar [failover grupos e replicação geográfica ativa](sql-database-geo-replication-overview.md) tooprovide falhas de tooregional de resiliência e falhas catastróficas e habilitar recuperação rápida toohello bancos de dados secundários.</span><span class="sxs-lookup"><span data-stu-id="53924-105">When building and deploying highly available services on Azure SQL Database, you use [failover groups and active geo-replication](sql-database-geo-replication-overview.md) tooprovide resilience tooregional failures and catastrophic outages and enable fast recovery toohello secondary databases.</span></span> <span data-ttu-id="53924-106">Este artigo enfoca os padrões de aplicativo comuns e descreve benefícios hello e vantagens e desvantagens de cada opção, dependendo dos requisitos de implantação de aplicativo hello, contrato de nível de serviço do hello estiver direcionando, latência de tráfego e os custos.</span><span class="sxs-lookup"><span data-stu-id="53924-106">This article focuses on common application patterns and discusses hello benefits and trade-offs of each option depending on hello application deployment requirements, hello service level agreement you are targeting, traffic latency, and costs.</span></span> <span data-ttu-id="53924-107">Para obter informações sobre o uso da replicação geográfica ativa com Pools elásticos, confira [Estratégias de recuperação de desastres do pool elástico](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="53924-107">For information about active geo-replication with Elastic Pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>

## <a name="design-pattern-1-active-passive-deployment-for-cloud-disaster-recovery-with-a-co-located-database"></a><span data-ttu-id="53924-108">Padrão de design 1: Implantação ativa-passiva para recuperação de desastre em nuvem com banco de dados colocalizado</span><span class="sxs-lookup"><span data-stu-id="53924-108">Design pattern 1: Active-passive deployment for cloud disaster recovery with a co-located database</span></span>
<span data-ttu-id="53924-109">Essa opção é mais adequada para aplicativos com hello características a seguir:</span><span class="sxs-lookup"><span data-stu-id="53924-109">This option is best suited for applications with hello following characteristics:</span></span>

* <span data-ttu-id="53924-110">Instância ativa em uma única região do Azure</span><span class="sxs-lookup"><span data-stu-id="53924-110">Active instance in a single Azure region</span></span>
* <span data-ttu-id="53924-111">Dependência forte de leitura / gravação (RW) acesso toodata</span><span class="sxs-lookup"><span data-stu-id="53924-111">Strong dependency on read-write (RW) access toodata</span></span>
* <span data-ttu-id="53924-112">Conectividade entre regiões entre o aplicativo da web hello e banco de dados de saudação não é aceitável devido a custos de tráfego e toolatency</span><span class="sxs-lookup"><span data-stu-id="53924-112">Cross-region connectivity between hello web application and hello database is not acceptable due toolatency and traffic cost</span></span>    

<span data-ttu-id="53924-113">Nesse caso, a topologia de implantação de aplicativo hello é otimizada para lidar com desastres regionais quando todos os componentes de aplicativos são afetados e necessário toofailover como uma unidade.</span><span class="sxs-lookup"><span data-stu-id="53924-113">In this case, hello application deployment topology is optimized for handling regional disasters when all application components are impacted and need toofailover as a unit.</span></span> <span data-ttu-id="53924-114">Para redundância geográfica, a lógica do aplicativo hello e Olá são replicados tooanother região, mas não são usados para cargas de trabalho de aplicativo de saudação em condições normais de saudação.</span><span class="sxs-lookup"><span data-stu-id="53924-114">For geographic redundancy, hello application logic and hello database are replicated tooanother region but they are not used for hello application workload under hello normal conditions.</span></span> <span data-ttu-id="53924-115">o aplicativo Hello na região secundária Olá deve ser configurado toouse SQL conexão cadeia de caracteres toohello banco de dados secundário.</span><span class="sxs-lookup"><span data-stu-id="53924-115">hello application in hello secondary region should be configured toouse a SQL connection string toohello secondary database.</span></span> <span data-ttu-id="53924-116">Gerenciador de tráfego é configurar toouse [método de roteamento de failover](../traffic-manager/traffic-manager-configure-failover-routing-method.md).</span><span class="sxs-lookup"><span data-stu-id="53924-116">Traffic manager is set up toouse [failover routing method](../traffic-manager/traffic-manager-configure-failover-routing-method.md).</span></span>  

> [!NOTE]
> <span data-ttu-id="53924-117">O [gerenciador de tráfego do ](../traffic-manager/traffic-manager-overview.md) é usado em todo este artigo apenas para fins ilustrativos.</span><span class="sxs-lookup"><span data-stu-id="53924-117">[Azure traffic manager](../traffic-manager/traffic-manager-overview.md) is used throughout this article for illustration purposes only.</span></span> <span data-ttu-id="53924-118">Você pode usar qualquer solução de balanceamento de carga que dê suporte ao método de roteamento de failover.</span><span class="sxs-lookup"><span data-stu-id="53924-118">You can use any load-balancing solution that supports failover routing method.</span></span>    
>

<span data-ttu-id="53924-119">Olá diagrama a seguir mostra essa configuração antes de uma interrupção.</span><span class="sxs-lookup"><span data-stu-id="53924-119">hello following diagram shows this configuration before an outage.</span></span>

![Configuração da replicação geográfica do banco de dados SQL.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-1.png)

<span data-ttu-id="53924-122">Após uma interrupção na região primária hello, o serviço de banco de dados SQL do hello detecta banco de dados primário Olá não está acessível e disparar um failover toohello banco de dados secundário com base em parâmetros de saudação da política de failover automático de saudação.</span><span class="sxs-lookup"><span data-stu-id="53924-122">After an outage in hello primary region, hello SQL Database service detects that hello primary database is not accessible and trigger a failover toohello secondary database based on hello parameters of hello automatic failover policy.</span></span> <span data-ttu-id="53924-123">Dependendo de seu SLA de aplicativo, você pode decidir tooconfigure um período de cortesia entre detecção de saudação de interrupção hello e failover de saudação em si.</span><span class="sxs-lookup"><span data-stu-id="53924-123">Depending on your application SLA, you can decide tooconfigure a grace period between hello detection of hello outage and hello failover itself.</span></span> <span data-ttu-id="53924-124">Configurar um período de cortesia reduz o risco de saudação de casos de toohello de perda de dados onde interrupção Olá é grave e disponibilidade em Olá região não pode ser restaurada rapidamente.</span><span class="sxs-lookup"><span data-stu-id="53924-124">Configuring a grace period reduces hello risk of data loss toohello cases where hello outage is catastrophic and availability in hello region cannot be quickly restored.</span></span> <span data-ttu-id="53924-125">Se o failover do ponto de extremidade de saudação é iniciado pelo Gerenciador de tráfego de saudação antes dos gatilhos de failover do grupo Olá Olá failover de banco de dados Olá, aplicativo hello não é capaz de tooreconnect toohello.</span><span class="sxs-lookup"><span data-stu-id="53924-125">If hello endpoint failover is initiated by hello traffic manager before hello failover group triggers hello failover of hello database, hello web application is not able tooreconnect toohello database.</span></span> <span data-ttu-id="53924-126">tooreconnect de tentativa do aplicativo Hello terá êxito automaticamente assim que a conclusão do failover de banco de dados de saudação.</span><span class="sxs-lookup"><span data-stu-id="53924-126">hello application’s attempt tooreconnect automatically succeeds as soon as hello database failover completes.</span></span> 

> [!NOTE]
> <span data-ttu-id="53924-127">tooachieve totalmente coordenada failover de aplicativo hello e bancos de dados hello, você deve criar seu próprio método de monitoramento e usar o failover manual de pontos de extremidade de aplicativo de web hello e bancos de dados de saudação.</span><span class="sxs-lookup"><span data-stu-id="53924-127">tooachieve fully coordinated failover of hello application and hello databases, you should devise your own monitoring method and use manual failover of hello web application endpoints and hello databases.</span></span>
>

<span data-ttu-id="53924-128">Após a conclusão do failover de saudação de pontos de extremidade do aplicativo hello e banco de dados de saudação, aplicativo hello novamente iniciar o processamento de solicitações do usuário Olá na região Olá B e permanecerá localizado no mesmo banco de dados de saudação porque o banco de dados primário Olá agora está em região B. Neste cenário é ilustrado no diagrama a seguir de saudação.</span><span class="sxs-lookup"><span data-stu-id="53924-128">After hello failover of both hello application’s endpoints and hello database completes, hello application will re-start processing hello user requests in hello region B and will remain co-located with hello database because hello primary database is now in region B. This scenario is illustrated in hello following diagram.</span></span> <span data-ttu-id="53924-129">Em todos os diagramas, linhas sólidas indicam conexões ativas, linhas pontilhadas indicam conexões suspensas e pontos indicam gatilhos de ação.</span><span class="sxs-lookup"><span data-stu-id="53924-129">In all diagrams, solid lines indicate active connections, dotted lines indicate suspended connections, and stop signs indicate action triggers.</span></span>

![Replicação geográfica: Banco de dados Failover toosecondary.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-2.png)

<span data-ttu-id="53924-132">Se ocorrer uma interrupção na região secundária hello, Olá link de replicação entre hello primário e o banco de dados secundário Olá será suspenso, mas Olá failover não será disparado porque o banco de dados primário Olá não é afetado.</span><span class="sxs-lookup"><span data-stu-id="53924-132">If an outage happens in hello secondary region, hello replication link between hello primary and hello secondary database is suspended but hello failover is not triggered because hello primary database is not impacted.</span></span> <span data-ttu-id="53924-133">disponibilidade do aplicativo Hello nesse caso, não é alterada mas aplicativo hello opera exposto e, portanto, ambas as regiões corre risco em caso de falham em sucessão.</span><span class="sxs-lookup"><span data-stu-id="53924-133">hello application's availability is not changed in this case, but hello application operates exposed and therefore at higher risk in case both regions fail in succession.</span></span>

> [!NOTE]
> <span data-ttu-id="53924-134">Para recuperação de desastres, é recomendável configuração Olá com regiões de tootwo de limitado de implantação do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="53924-134">For disaster recovery we recommend hello configuration with application deployment limited tootwo regions.</span></span> <span data-ttu-id="53924-135">Isso ocorre porque a maioria de saudação regiões do Azure tem apenas duas regiões.</span><span class="sxs-lookup"><span data-stu-id="53924-135">This is because most of hello Azure geographies have only two regions.</span></span> <span data-ttu-id="53924-136">Essa configuração não protegerá seu aplicativo contra uma falha catastrófica simultânea nas duas regiões.</span><span class="sxs-lookup"><span data-stu-id="53924-136">This configuration will not protect your application from a simultaneous catastrophic failure of both regions.</span></span>  <span data-ttu-id="53924-137">Caso ocorra essa falha improvável, você poderá recuperar seus bancos de dados em uma terceira região usando a [operação de restauração geográfica](sql-database-disaster-recovery.md#recover-using-geo-restore).</span><span class="sxs-lookup"><span data-stu-id="53924-137">In an unlikely event of such a failure, you can recover your databases in a third region using [geo-restore operation](sql-database-disaster-recovery.md#recover-using-geo-restore).</span></span>
>

<span data-ttu-id="53924-138">Depois que a interrupção de saudação é reduzida, banco de dados secundário Olá automaticamente serão sincronizados novamente com hello primário.</span><span class="sxs-lookup"><span data-stu-id="53924-138">Once hello outage is mitigated, hello secondary database will automatically re-synchronize with hello primary.</span></span> <span data-ttu-id="53924-139">Durante a sincronização, o desempenho de saudação primária pode ser afetado ligeiramente dependendo da quantidade de saudação de dados que precisa toobe sincronizado.</span><span class="sxs-lookup"><span data-stu-id="53924-139">During synchronization, performance of hello primary could be slightly impacted depending on hello amount of data that needs toobe synchronized.</span></span> <span data-ttu-id="53924-140">Olá diagrama a seguir ilustra uma interrupção na região secundária hello.</span><span class="sxs-lookup"><span data-stu-id="53924-140">hello following diagram illustrates an outage in hello secondary region.</span></span>

![Banco de dados secundário sincronizado com o primário.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-3.png)

<span data-ttu-id="53924-143">chave de saudação **vantagens** de padrão de design são:</span><span class="sxs-lookup"><span data-stu-id="53924-143">hello key **advantages** of this design pattern are:</span></span>

* <span data-ttu-id="53924-144">Olá, mesmo aplicativo da web é implantado tooboth regiões sem qualquer configuração específica de região e failover de toohello de tooreact nenhuma lógica adicional.</span><span class="sxs-lookup"><span data-stu-id="53924-144">hello same web application is deployed tooboth regions without any region-specific configuration and no additional logic tooreact toohello failover.</span></span> 
* <span data-ttu-id="53924-145">desempenho do aplicativo Hello não é afetado por failover como aplicativo da web hello e banco de dados de saudação sempre estão localizados.</span><span class="sxs-lookup"><span data-stu-id="53924-145">hello application's performance is not impacted by failover as hello web application and hello database are always co-located.</span></span>

<span data-ttu-id="53924-146">Olá principal **compensação** é que o aplicativo redundantes hello instância na região secundária Olá só é usada para recuperação de desastres.</span><span class="sxs-lookup"><span data-stu-id="53924-146">hello main **tradeoff** is that hello redundant application instance in hello secondary region is only used for disaster recovery.</span></span>

## <a name="design-pattern-2-active-active-deployment-for-application-load-balancing"></a><span data-ttu-id="53924-147">Padrão de design 2: implantação ativa-ativa para balanceamento de carga de aplicativo</span><span class="sxs-lookup"><span data-stu-id="53924-147">Design pattern 2: Active-active deployment for application load balancing</span></span>
<span data-ttu-id="53924-148">Essa opção de recuperação de desastres de nuvem é ideal para aplicativos com hello características a seguir:</span><span class="sxs-lookup"><span data-stu-id="53924-148">This cloud disaster recovery option is best suited for applications with hello following characteristics:</span></span>

* <span data-ttu-id="53924-149">Alta taxa de banco de dados lê toowrites</span><span class="sxs-lookup"><span data-stu-id="53924-149">High ratio of database reads toowrites</span></span>
* <span data-ttu-id="53924-150">Banco de dados de latência de leitura é mais importante para a experiência do usuário final de saudação latência de gravação da saudação</span><span class="sxs-lookup"><span data-stu-id="53924-150">Database read latency is more critical for hello end-user experience than hello write latency</span></span> 
* <span data-ttu-id="53924-151">A lógica somente leitura pode ser separada da lógica de leitura/gravação usando uma cadeia de conexão diferente</span><span class="sxs-lookup"><span data-stu-id="53924-151">Read-only logic can be separated from read-write logic by using a different connection string</span></span>
* <span data-ttu-id="53924-152">Lógica de somente leitura não dependem de dados sendo totalmente sincronizados com as atualizações mais recentes de saudação</span><span class="sxs-lookup"><span data-stu-id="53924-152">Read-only logic does not depend on data being fully synchronized with hello latest updates</span></span>  

<span data-ttu-id="53924-153">Se seus aplicativos tenham essas características, balanceamento de carga conexões de usuário final Olá entre várias instâncias do aplicativo em diferentes regiões pode melhorar significativamente Olá experiência geral do usuário final.</span><span class="sxs-lookup"><span data-stu-id="53924-153">If your applications have these characteristics, load balancing hello end-user connections across multiple application instances in different regions can substantially improve hello overall end-user experience.</span></span> <span data-ttu-id="53924-154">Duas das regiões Olá devem ser selecionada como Olá par de recuperação de desastres e grupo de saudação de failover deve incluir bancos de dados de saudação nessas regiões.</span><span class="sxs-lookup"><span data-stu-id="53924-154">Two of hello regions should be selected as hello DR pair and hello failover group should include hello databases in these regions.</span></span> <span data-ttu-id="53924-155">tooimplement balanceamento de carga, cada região deve ter uma instância ativa do aplicativo hello com ponto de extremidade do hello leitura-gravação (RW) lógica conectada toohello ouvinte de leitura / gravação do grupo de failover de saudação.</span><span class="sxs-lookup"><span data-stu-id="53924-155">tooimplement load-balancing, each region should have an active instance of hello application with hello read-write (RW) logic connected toohello read-write listener endpoint of hello failover group.</span></span> <span data-ttu-id="53924-156">Ele garantirá que o failover Olá será iniciado automaticamente se o banco de dados primário Olá é afetado por uma interrupção.</span><span class="sxs-lookup"><span data-stu-id="53924-156">It will guarantee that hello failover will be automatically initiated if hello primary database is impacted by an outage.</span></span> <span data-ttu-id="53924-157">Olá somente leitura lógica (RO) no aplicativo da web hello deve se conectar diretamente toohello banco de dados nessa região.</span><span class="sxs-lookup"><span data-stu-id="53924-157">hello read-only logic (RO) in hello web application should connect directly toohello database in that region.</span></span> <span data-ttu-id="53924-158">Gerenciador de tráfego deve ser configurado toouse [desempenho roteamento](../traffic-manager/traffic-manager-configure-performance-routing-method.md) com [monitoramento de ponto de extremidade](../traffic-manager/traffic-manager-monitoring.md) habilitado para cada instância do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="53924-158">Traffic manager should be set up toouse [performance routing](../traffic-manager/traffic-manager-configure-performance-routing-method.md) with [end-point monitoring](../traffic-manager/traffic-manager-monitoring.md) enabled for each application instance.</span></span>

<span data-ttu-id="53924-159">Como no padrão 1, considere a implantação de um aplicativo de monitoramento semelhante.</span><span class="sxs-lookup"><span data-stu-id="53924-159">As in pattern #1, you should consider deploying a similar monitoring application.</span></span> <span data-ttu-id="53924-160">Mas, diferente do padrão #1, Olá monitoramento do aplicativo não será responsável por disparar um failover do ponto de extremidade de saudação.</span><span class="sxs-lookup"><span data-stu-id="53924-160">But unlike pattern #1, hello monitoring application will not be responsible for triggering hello end-point failover.</span></span>

> [!NOTE]
> <span data-ttu-id="53924-161">Enquanto esse padrão usa mais de um banco de dados secundário, somente Olá secundário na região B deve ser usado para failover e deve fazer parte do grupo de saudação de failover.</span><span class="sxs-lookup"><span data-stu-id="53924-161">While this pattern uses more than one secondary database, only hello secondary in Region B  would be used for failover and should be part of hello failover group.</span></span>
>

<span data-ttu-id="53924-162">Gerenciador de tráfego deve ser configurado para a localização geográfica do desempenho roteamento toodirect Olá usuário conexões toohello instância mais próxima toohello do usuário do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="53924-162">Traffic manager should be configured for performance routing toodirect hello user connections toohello application instance closest toohello user's geographic location.</span></span> <span data-ttu-id="53924-163">Olá diagrama a seguir ilustra essa configuração antes de uma interrupção.</span><span class="sxs-lookup"><span data-stu-id="53924-163">hello following diagram illustrates this configuration before an outage.</span></span>

![Nenhuma interrupção: aplicativo toonearest roteamento de desempenho.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-1.png)

<span data-ttu-id="53924-166">Se uma interrupção de banco de dados for detectada em uma região de hello, grupo de failover Olá iniciará automaticamente o failover de banco de dados primário no toohello região um secundário na região B. Olá Atualizará automaticamente tooregion de ponto de extremidade de escuta de leitura-gravação Olá B para que conexões de leitura / gravação no aplicativo web de saudação não serão afetados.</span><span class="sxs-lookup"><span data-stu-id="53924-166">If a database outage is detected in hello region A, hello failover group will automatically initiate failover of hello primary database in region A toohello secondary in region B. It will also automatically update hello read-write listener endpoint tooregion B so read-write connections in hello web application will not be impacted.</span></span> <span data-ttu-id="53924-167">Gerenciador de tráfego Olá excluirá o ponto de extremidade offline Olá da tabela de roteamento hello, mas continuará roteamento saudação do usuário final tráfego toohello online instâncias restantes.</span><span class="sxs-lookup"><span data-stu-id="53924-167">hello traffic manager will exclude hello offline end-point from hello routing table but will continue routing hello end-user traffic toohello remaining online instances.</span></span> <span data-ttu-id="53924-168">Olá cadeias de conexão SQL somente leitura não serão afetadas como eles sempre ponto toohello banco de dados na Olá mesma região.</span><span class="sxs-lookup"><span data-stu-id="53924-168">hello read-only SQL connection strings will not be impacted as they always point toohello database in hello same region.</span></span> 

<span data-ttu-id="53924-169">Olá diagrama a seguir ilustra a nova configuração Olá após o failover de saudação.</span><span class="sxs-lookup"><span data-stu-id="53924-169">hello following diagram illustrates hello new configuration after hello failover.</span></span>

![Configuração após o failover.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-2.png)

<span data-ttu-id="53924-172">No caso de uma interrupção em uma das regiões secundário Olá, Gerenciador de tráfego Olá removerá automaticamente pontos de extremidade offline Olá nessa região da tabela de roteamento de saudação.</span><span class="sxs-lookup"><span data-stu-id="53924-172">In case of an outage in one of hello secondary regions, hello traffic manager will automatically remove hello offline end-point in that region from hello routing table.</span></span> <span data-ttu-id="53924-173">Olá replicação canal toohello banco de dados secundário nessa região será suspenso.</span><span class="sxs-lookup"><span data-stu-id="53924-173">hello replication channel toohello secondary database in that region will be suspended.</span></span> <span data-ttu-id="53924-174">Porque regiões restantes Olá receber tráfego de usuário adicionais neste cenário, o desempenho do aplicativo hello será afetado durante a interrupção de saudação.</span><span class="sxs-lookup"><span data-stu-id="53924-174">Because hello remaining regions get additional user traffic in this scenario, hello application's performance will be impacted during hello outage.</span></span> <span data-ttu-id="53924-175">Depois que a interrupção de saudação é reduzida, hello banco de dados secundário na região afetada hello serão imediatamente sincronizado com hello primário.</span><span class="sxs-lookup"><span data-stu-id="53924-175">Once hello outage is mitigated, hello secondary database in hello impacted region will be immediately synchronized with hello primary.</span></span> <span data-ttu-id="53924-176">Durante a saudação desempenho da sincronização de saudação primária pode ser afetado ligeiramente dependendo da quantidade de saudação de dados que precisa toobe sincronizado.</span><span class="sxs-lookup"><span data-stu-id="53924-176">During hello synchronization performance of hello primary could be slightly impacted depending on hello amount of data that needs toobe synchronized.</span></span> <span data-ttu-id="53924-177">Olá diagrama a seguir ilustra uma interrupção na região B.</span><span class="sxs-lookup"><span data-stu-id="53924-177">hello following diagram illustrates an outage in region B.</span></span>

![Interrupção na região secundária.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-3.png)

<span data-ttu-id="53924-180">chave de saudação **vantagem** desse design padrão é que você pode dimensionar a carga de trabalho de aplicativo hello entre vários desempenho de usuário final ideal secundários tooachieve Olá.</span><span class="sxs-lookup"><span data-stu-id="53924-180">hello key **advantage** of this design pattern is that you can scale hello application workload across multiple secondaries tooachieve hello optimal end-user performance.</span></span> <span data-ttu-id="53924-181">Olá **compensações** dessa opção são:</span><span class="sxs-lookup"><span data-stu-id="53924-181">hello **tradeoffs** of this option are:</span></span>

* <span data-ttu-id="53924-182">Conexões de leitura / gravação entre instâncias do aplicativo hello e banco de dados têm diferentes latência e custo</span><span class="sxs-lookup"><span data-stu-id="53924-182">Read-write connections between hello application instances and database have varying latency and cost</span></span>
* <span data-ttu-id="53924-183">Desempenho do aplicativo é afetado durante a interrupção de saudação</span><span class="sxs-lookup"><span data-stu-id="53924-183">Application performance is impacted during hello outage</span></span>

> [!NOTE]
> <span data-ttu-id="53924-184">Uma abordagem semelhante pode ser usada toooffload especializado cargas de trabalho como trabalhos, ferramentas de business intelligence ou backups de emissão de relatórios.</span><span class="sxs-lookup"><span data-stu-id="53924-184">A similar approach can be used toooffload specialized workloads such as reporting jobs, business intelligence tools, or backups.</span></span> <span data-ttu-id="53924-185">Normalmente, essas cargas de trabalho consumam recursos significativos do banco de dados, portanto, é recomendável que você designar uma saudação bancos de dados secundários para eles com hello desempenho toohello correspondentes nível carga de trabalho prevista.</span><span class="sxs-lookup"><span data-stu-id="53924-185">Typically, these workloads consume significant database resources therefore it is recommended that you designate one of hello secondary databases for them with hello performance level matched toohello anticipated workload.</span></span>
>

## <a name="design-pattern-3-active-passive-deployment-for-data-preservation"></a><span data-ttu-id="53924-186">Padrão de design 3: implantação ativa-passiva para preservação dos dados</span><span class="sxs-lookup"><span data-stu-id="53924-186">Design pattern 3: Active-passive deployment for data preservation</span></span>
<span data-ttu-id="53924-187">Essa opção é mais adequada para aplicativos com hello características a seguir:</span><span class="sxs-lookup"><span data-stu-id="53924-187">This option is best suited for applications with hello following characteristics:</span></span>

* <span data-ttu-id="53924-188">Qualquer perda de dados é um risco comercial elevado.</span><span class="sxs-lookup"><span data-stu-id="53924-188">Any data loss is high business risk.</span></span> <span data-ttu-id="53924-189">Olá failover de banco de dados só pode ser usado como um último recurso se a interrupção de saudação for catastrófica.</span><span class="sxs-lookup"><span data-stu-id="53924-189">hello database failover can only be used as a last resort if hello outage is catastrophic.</span></span>
* <span data-ttu-id="53924-190">aplicativo Hello dá suporte aos modos de somente leitura e leitura / gravação de operações e pode operar em "modo somente leitura" por um período de tempo.</span><span class="sxs-lookup"><span data-stu-id="53924-190">hello application supports read-only and read-write modes of operations and can operate in "read-only mode" for a period of time.</span></span>

<span data-ttu-id="53924-191">Nesse padrão, o aplicativo hello Alterna modo somente tooread quando conexões de leitura / gravação da saudação comece a obter erros de tempo limite.</span><span class="sxs-lookup"><span data-stu-id="53924-191">In this pattern, hello application switches tooread-only mode when hello read-write connections start getting time-out errors.</span></span> <span data-ttu-id="53924-192">Olá aplicativo Web é implantado tooboth regiões e incluir um ponto de extremidade de escuta de leitura-gravação de toohello conexão e um ponto de extremidade de escuta de somente leitura de toohello conexão diferente.</span><span class="sxs-lookup"><span data-stu-id="53924-192">hello Web Application is deployed tooboth regions and include a connection toohello read-write listener endpoint and different connection toohello read-only listener endpoint.</span></span> <span data-ttu-id="53924-193">Gerenciador de tráfego Olá deve ser configurado toouse [failover roteamento](../traffic-manager/traffic-manager-configure-failover-routing-method.md) com [monitoramento de ponto de extremidade](../traffic-manager/traffic-manager-monitoring.md) habilitado para o ponto de extremidade de aplicativo de saudação em cada região.</span><span class="sxs-lookup"><span data-stu-id="53924-193">hello Traffic manager should be set up toouse [failover routing](../traffic-manager/traffic-manager-configure-failover-routing-method.md) with [end-point monitoring](../traffic-manager/traffic-manager-monitoring.md) enabled for hello application endpoint in each region.</span></span>

<span data-ttu-id="53924-194">Olá diagrama a seguir ilustra essa configuração antes de uma interrupção.</span><span class="sxs-lookup"><span data-stu-id="53924-194">hello following diagram illustrates this configuration before an outage.</span></span>

![Implantação ativo-passivo antes do failover.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-1.png)

<span data-ttu-id="53924-197">Quando o Gerenciador de tráfego Olá detecta uma falha de conectividade tooregion um, ele alternará automaticamente uma instância de aplicativo do usuário tráfego toohello na região B. Com esse padrão, é importante definir período de cortesia de saudação com um valor suficientemente alto do tooa do perda de dados, por exemplo, 24 horas.</span><span class="sxs-lookup"><span data-stu-id="53924-197">When hello traffic manager detects a connectivity failure tooregion A, it automatically switches user traffic toohello application instance in region B. With this pattern, it is important that you set hello grace period with data loss tooa sufficiently high value, e.g. 24 hours.</span></span> <span data-ttu-id="53924-198">Ele garantirá que a perda de dados é evitada se interrupção Olá mitigada nesse período.</span><span class="sxs-lookup"><span data-stu-id="53924-198">It will ensure that data loss is prevented if hello outage is mitigated within that time.</span></span> <span data-ttu-id="53924-199">Quando Olá aplicativo Web na região Olá B é ativado operações de leitura / gravação da saudação começam a falhar.</span><span class="sxs-lookup"><span data-stu-id="53924-199">When hello Web application in hello region B is activated hello read-write operations will start failing.</span></span> <span data-ttu-id="53924-200">Nesse ponto, ele deverá alternar toohello o modo somente leitura.</span><span class="sxs-lookup"><span data-stu-id="53924-200">At that point, it should switch toohello read-only mode.</span></span> <span data-ttu-id="53924-201">Olá esse modo solicitações será automaticamente roteado toohello banco de dados secundário.</span><span class="sxs-lookup"><span data-stu-id="53924-201">In this mode hello requests will be automatically routed toohello secondary database.</span></span> <span data-ttu-id="53924-202">No caso de saudação de saudação uma falha catastrófica interrupção não será atenuada dentro do período de cortesia hello e grupo de failover Olá irá disparar Olá failover.</span><span class="sxs-lookup"><span data-stu-id="53924-202">In hello case of a catastrophic failure hello outage will not be mitigated within hello grace period and hello failover group will trigger hello failover.</span></span> <span data-ttu-id="53924-203">Depois que Olá ouvinte de leitura-gravação ficará disponível e Olá chamadas tooit parará falhando.</span><span class="sxs-lookup"><span data-stu-id="53924-203">After that hello read-write listener will become available and hello calls tooit will stop failing.</span></span> <span data-ttu-id="53924-204">Isso é ilustrado pela Olá diagrama a seguir.</span><span class="sxs-lookup"><span data-stu-id="53924-204">This is illustrated by hello following diagram.</span></span>

![Interrupção: aplicativo em modo somente leitura.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-2.png)

<span data-ttu-id="53924-207">Se a interrupção de saudação na região primária Olá mitigada dentro do período de cortesia Olá, traffic manager detecta restauração Olá de conectividade na região primária hello e alterna a instância de aplicativo do usuário tráfego toohello Voltar na região A. Essa instância de aplicativo reinicia e opera no modo de leitura / gravação usando o banco de dados primário Olá na região A.</span><span class="sxs-lookup"><span data-stu-id="53924-207">If hello outage in hello primary region is mitigated within hello grace period, traffic manager detects hello restoration of connectivity in hello primary region and switches user traffic back toohello application instance in region A. That application instance resumes and operates in read-write mode using hello primary database in region A.</span></span>

<span data-ttu-id="53924-208">No caso de uma interrupção na região Olá B, Gerenciador de tráfego Olá detecta a falha de saudação do ponto de extremidade de aplicativo hello na região B e Olá failover grupo comutadores Olá ouvinte somente leitura tooregion A. Essa interrupção não afeta a experiência do usuário final de saudação mas o banco de dados primário hello será exposto durante a interrupção de saudação.</span><span class="sxs-lookup"><span data-stu-id="53924-208">In case of an outage in hello region B, hello traffic manager detects hello failure of hello application end-point in region B and hello failover group switches hello read-only listener tooregion A. This outage does not impact hello end-user experience but hello primary database will be exposed during hello outage.</span></span> <span data-ttu-id="53924-209">Isso é ilustrado pela Olá diagrama a seguir.</span><span class="sxs-lookup"><span data-stu-id="53924-209">This is illustrated by hello following diagram.</span></span>

![Interrupção: banco de dados secundário.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-3.png)

<span data-ttu-id="53924-212">Depois que a interrupção de saudação é reduzida, hello banco de dados secundário é imediatamente sincronizado com hello primário e ouvinte Olá de somente leitura é comutada toohello back o banco de dados secundário na região B. Durante a sincronização, desempenho de saudação primária pode ser afetado ligeiramente dependendo da quantidade de saudação de dados que precisa toobe sincronizado.</span><span class="sxs-lookup"><span data-stu-id="53924-212">Once hello outage is mitigated, hello secondary database is immediately synchronized with hello primary and hello read-only listener is switched back toohello secondary database in region B. During synchronization performance of hello primary could be slightly impacted depending on hello amount of data that needs toobe synchronized.</span></span>

<span data-ttu-id="53924-213">Esse padrão de design apresenta várias **vantagens**:</span><span class="sxs-lookup"><span data-stu-id="53924-213">This design pattern has several **advantages**:</span></span>

* <span data-ttu-id="53924-214">Isso evita a perda de dados durante interrupções temporárias hello.</span><span class="sxs-lookup"><span data-stu-id="53924-214">It avoids data loss during hello temporary outages.</span></span>
* <span data-ttu-id="53924-215">Tempo de inatividade depende apenas rapidez do traffic manager detecta a falha de conectividade hello, que é configurável.</span><span class="sxs-lookup"><span data-stu-id="53924-215">Downtime depends only on how quickly traffic manager detects hello connectivity failure, which is configurable.</span></span>

<span data-ttu-id="53924-216">Olá **compensação** é:</span><span class="sxs-lookup"><span data-stu-id="53924-216">hello **tradeoff** is:</span></span>

* <span data-ttu-id="53924-217">Aplicativo deve ser capaz de toooperate no modo somente leitura.</span><span class="sxs-lookup"><span data-stu-id="53924-217">Application must be able toooperate in read-only mode.</span></span>

> [!NOTE]
> <span data-ttu-id="53924-218">No caso de uma interrupção de serviço permanente na região hello, manualmente ativar o failover de banco de dados e perda de dados de saudação.</span><span class="sxs-lookup"><span data-stu-id="53924-218">In case of a permanent service outage in hello region, you manually activate database failover and accept hello data loss.</span></span> <span data-ttu-id="53924-219">aplicativo Hello estará funcional em região secundária do hello com banco de dados de toohello de acesso de leitura-gravação.</span><span class="sxs-lookup"><span data-stu-id="53924-219">hello application will be functional in hello secondary region with read-write access toohello database.</span></span>
>

## <a name="business-continuity-planning-choose-an-application-design-for-cloud-disaster-recovery"></a><span data-ttu-id="53924-220">Planejamento de continuidade de negócios: escolher um design de aplicativo para recuperação de desastre em nuvem</span><span class="sxs-lookup"><span data-stu-id="53924-220">Business continuity planning: Choose an application design for cloud disaster recovery</span></span>
<span data-ttu-id="53924-221">Sua estratégia de recuperação de desastres de nuvem específica pode combinar ou estender esses padrões de design necessidades de saudação atender toobest de seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="53924-221">Your specific cloud disaster recovery strategy can combine or extend these design patterns toobest meet hello needs of your application.</span></span>  <span data-ttu-id="53924-222">Como mencionado anteriormente, estratégia Olá que você escolher baseia Olá SLA desejado toooffer tooyour clientes e Olá topologia de implantação do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="53924-222">As mentioned earlier, hello strategy you choose is based on hello SLA you want toooffer tooyour customers and hello application deployment topology.</span></span> <span data-ttu-id="53924-223">toohelp orientar sua decisão, Olá a tabela a seguir compara opções de saudação com base em Olá dados estimada perda ou recuperação objetivo de ponto (RPO) e o tempo de recuperação estimado (ERTER).</span><span class="sxs-lookup"><span data-stu-id="53924-223">toohelp guide your decision, hello following table compares hello choices based on hello estimated data loss or recovery point objective (RPO) and estimated recovery time (ERT).</span></span>

| <span data-ttu-id="53924-224">Padrão</span><span class="sxs-lookup"><span data-stu-id="53924-224">Pattern</span></span> | <span data-ttu-id="53924-225">RPO</span><span class="sxs-lookup"><span data-stu-id="53924-225">RPO</span></span> | <span data-ttu-id="53924-226">ERT</span><span class="sxs-lookup"><span data-stu-id="53924-226">ERT</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="53924-227">Implantação ativa-passiva para recuperação de desastres com acesso de banco de dados colocalizado</span><span class="sxs-lookup"><span data-stu-id="53924-227">Active-passive deployment for disaster recovery with co-located database access</span></span> |<span data-ttu-id="53924-228">Acesso de leitura/gravação < 5 s</span><span class="sxs-lookup"><span data-stu-id="53924-228">Read-write access < 5 sec</span></span> |<span data-ttu-id="53924-229">Tempo de detecção de falha + TTL do DNS</span><span class="sxs-lookup"><span data-stu-id="53924-229">Failure detection time + DNS TTL</span></span> |
| <span data-ttu-id="53924-230">Implantação ativa-ativa para balanceamento de carga de aplicativo</span><span class="sxs-lookup"><span data-stu-id="53924-230">Active-active deployment for application load balancing</span></span> |<span data-ttu-id="53924-231">Acesso de leitura/gravação < 5 s</span><span class="sxs-lookup"><span data-stu-id="53924-231">Read-write access < 5 sec</span></span> |<span data-ttu-id="53924-232">Tempo de detecção de falha + TTL do DNS</span><span class="sxs-lookup"><span data-stu-id="53924-232">Failure detection time + DNS TTL</span></span> |
| <span data-ttu-id="53924-233">Implantação ativa-passiva para preservação de dados</span><span class="sxs-lookup"><span data-stu-id="53924-233">Active-passive deployment for data preservation</span></span> |<span data-ttu-id="53924-234">Acesso somente leitura < 5 seg</span><span class="sxs-lookup"><span data-stu-id="53924-234">Read-only access < 5 sec</span></span> | <span data-ttu-id="53924-235">Acesso somente leitura = 0</span><span class="sxs-lookup"><span data-stu-id="53924-235">Read-only access = 0</span></span> |
||<span data-ttu-id="53924-236">Acesso de leitura/gravação = zero</span><span class="sxs-lookup"><span data-stu-id="53924-236">Read-write access = zero</span></span> | <span data-ttu-id="53924-237">Acesso de leitura/gravação = Tempo de detecção de falha + período de carência de perda de dados</span><span class="sxs-lookup"><span data-stu-id="53924-237">Read-write access = Failure detection time + grace period with data loss</span></span> |
|||

## <a name="next-steps"></a><span data-ttu-id="53924-238">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="53924-238">Next steps</span></span>
* <span data-ttu-id="53924-239">toolearn sobre backups de banco de dados do SQL Azure automatizadas, consulte [backups automatizados de banco de dados SQL](sql-database-automated-backups.md)</span><span class="sxs-lookup"><span data-stu-id="53924-239">toolearn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md)</span></span>
* <span data-ttu-id="53924-240">Para obter uma visão geral e os cenários de continuidade dos negócios, confira [Visão geral da continuidade dos negócios](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="53924-240">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md)</span></span>
* <span data-ttu-id="53924-241">toolearn sobre como usar backups automatizados para recuperação, consulte [restaurar um banco de dados de backups de iniciadas pelo serviço de saudação](sql-database-recovery-using-backups.md)</span><span class="sxs-lookup"><span data-stu-id="53924-241">toolearn about using automated backups for recovery, see [restore a database from hello service-initiated backups](sql-database-recovery-using-backups.md)</span></span>
* <span data-ttu-id="53924-242">toolearn sobre as opções de recuperação mais rápidas, consulte [replicação geográfica ativa](sql-database-geo-replication-overview.md)</span><span class="sxs-lookup"><span data-stu-id="53924-242">toolearn about faster recovery options, see [active geo-replication](sql-database-geo-replication-overview.md)</span></span>  
* <span data-ttu-id="53924-243">toolearn sobre como usar backups automatizados para arquivamento, consulte [cópia de banco de dados](sql-database-copy.md)</span><span class="sxs-lookup"><span data-stu-id="53924-243">toolearn about using automated backups for archiving, see [database copy](sql-database-copy.md)</span></span>
* <span data-ttu-id="53924-244">Para obter informações sobre o uso da replicação geográfica ativa com Pools elásticos, confira [Estratégias de recuperação de desastres do pool elástico](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="53924-244">For information about active geo-replication with Elastic Pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>
