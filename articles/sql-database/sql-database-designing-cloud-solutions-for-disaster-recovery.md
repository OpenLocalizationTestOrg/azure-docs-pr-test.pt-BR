---
title: "Criar um serviço altamente disponível usando o Banco de Dados SQL do Azure | Microsoft Docs"
description: "Saiba mais sobre a criação de um aplicativo para serviços altamente disponíveis usando o Banco de Dados SQL do Azure."
keywords: "recuperação de desastre em nuvem, soluções de recuperação de desastre, backup de dados de aplicativo, replicação geográfica, planejamento de continuidade de negócios"
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: e8a346ac-dd08-41e7-9685-46cebca04582
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-management
ms.date: 04/21/2017
ms.author: sashan
ms.openlocfilehash: 40fe0ae04eb94322356ed19773512e3bc383639c
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="designing-highly-available-services-using-azure-sql-database"></a><span data-ttu-id="dd9af-104">Criar serviços altamente disponíveis usando o Banco de Dados SQL do Azure</span><span class="sxs-lookup"><span data-stu-id="dd9af-104">Designing highly available services using Azure SQL Database</span></span>

<span data-ttu-id="dd9af-105">Ao criar e implantar serviços altamente disponíveis no Banco de Dados SQL do Azure, use [grupos de failover e replicação geográfica ativa](sql-database-geo-replication-overview.md) para criar resistência a falhas regionais e interrupções catastróficas e permitir a recuperação rápida de bancos de dados secundários.</span><span class="sxs-lookup"><span data-stu-id="dd9af-105">When building and deploying highly available services on Azure SQL Database, you use [failover groups and active geo-replication](sql-database-geo-replication-overview.md) to provide resilience to regional failures and catastrophic outages and enable fast recovery to the secondary databases.</span></span> <span data-ttu-id="dd9af-106">Este artigo concentra-se em padrões de aplicativos comuns e descreve as vantagens e desvantagens de cada opção dependendo dos requisitos de implantação do aplicativo, do contrato de nível de serviço que você deseja, da latência de tráfego e dos custos.</span><span class="sxs-lookup"><span data-stu-id="dd9af-106">This article focuses on common application patterns and discusses the benefits and trade-offs of each option depending on the application deployment requirements, the service level agreement you are targeting, traffic latency, and costs.</span></span> <span data-ttu-id="dd9af-107">Para obter informações sobre o uso da replicação geográfica ativa com Pools elásticos, confira [Estratégias de recuperação de desastres do pool elástico](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="dd9af-107">For information about active geo-replication with Elastic Pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>

## <a name="design-pattern-1-active-passive-deployment-for-cloud-disaster-recovery-with-a-co-located-database"></a><span data-ttu-id="dd9af-108">Padrão de design 1: Implantação ativa-passiva para recuperação de desastre em nuvem com banco de dados colocalizado</span><span class="sxs-lookup"><span data-stu-id="dd9af-108">Design pattern 1: Active-passive deployment for cloud disaster recovery with a co-located database</span></span>
<span data-ttu-id="dd9af-109">Essa opção é mais adequada para aplicativos com as seguintes características:</span><span class="sxs-lookup"><span data-stu-id="dd9af-109">This option is best suited for applications with the following characteristics:</span></span>

* <span data-ttu-id="dd9af-110">Instância ativa em uma única região do Azure</span><span class="sxs-lookup"><span data-stu-id="dd9af-110">Active instance in a single Azure region</span></span>
* <span data-ttu-id="dd9af-111">Alta dependência do acesso de RW (leitura/gravação) aos dados</span><span class="sxs-lookup"><span data-stu-id="dd9af-111">Strong dependency on read-write (RW) access to data</span></span>
* <span data-ttu-id="dd9af-112">A conectividade entre regiões entre o aplicativo Web e o banco de dados não é aceitável devido ao custo de tráfego e à latência</span><span class="sxs-lookup"><span data-stu-id="dd9af-112">Cross-region connectivity between the web application and the database is not acceptable due to latency and traffic cost</span></span>    

<span data-ttu-id="dd9af-113">Nesse caso, a topologia de implantação do aplicativo é otimizada para lidar com desastres regionais quando todos os componentes do aplicativo são afetados e precisam fazer failover como uma unidade.</span><span class="sxs-lookup"><span data-stu-id="dd9af-113">In this case, the application deployment topology is optimized for handling regional disasters when all application components are impacted and need to failover as a unit.</span></span> <span data-ttu-id="dd9af-114">Para redundância geográfica, a lógica do aplicativo e o banco de dados são replicados para outra região, mas não são usados para a carga de trabalho de aplicativo sob as condições normais.</span><span class="sxs-lookup"><span data-stu-id="dd9af-114">For geographic redundancy, the application logic and the database are replicated to another region but they are not used for the application workload under the normal conditions.</span></span> <span data-ttu-id="dd9af-115">O aplicativo na região secundária deve ser configurado para usar uma cadeia de conexão SQL para o banco de dados secundário.</span><span class="sxs-lookup"><span data-stu-id="dd9af-115">The application in the secondary region should be configured to use a SQL connection string to the secondary database.</span></span> <span data-ttu-id="dd9af-116">O gerenciador de tráfego é configurado para usar o [método de roteamento de failover](../traffic-manager/traffic-manager-configure-failover-routing-method.md).</span><span class="sxs-lookup"><span data-stu-id="dd9af-116">Traffic manager is set up to use [failover routing method](../traffic-manager/traffic-manager-configure-failover-routing-method.md).</span></span>  

> [!NOTE]
> <span data-ttu-id="dd9af-117">O [gerenciador de tráfego do ](../traffic-manager/traffic-manager-overview.md) é usado em todo este artigo apenas para fins ilustrativos.</span><span class="sxs-lookup"><span data-stu-id="dd9af-117">[Azure traffic manager](../traffic-manager/traffic-manager-overview.md) is used throughout this article for illustration purposes only.</span></span> <span data-ttu-id="dd9af-118">Você pode usar qualquer solução de balanceamento de carga que dê suporte ao método de roteamento de failover.</span><span class="sxs-lookup"><span data-stu-id="dd9af-118">You can use any load-balancing solution that supports failover routing method.</span></span>    
>

<span data-ttu-id="dd9af-119">O diagrama a seguir mostra essa configuração antes de uma interrupção.</span><span class="sxs-lookup"><span data-stu-id="dd9af-119">The following diagram shows this configuration before an outage.</span></span>

![Configuração da replicação geográfica do banco de dados SQL.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-1.png)

<span data-ttu-id="dd9af-122">Após uma interrupção na região primária, o serviço do Banco de dados SQL detecta que o banco de dados primário não está acessível e dispara um failover para o banco de dados secundário, com base nos parâmetros da política de failover automático.</span><span class="sxs-lookup"><span data-stu-id="dd9af-122">After an outage in the primary region, the SQL Database service detects that the primary database is not accessible and trigger a failover to the secondary database based on the parameters of the automatic failover policy.</span></span> <span data-ttu-id="dd9af-123">Dependendo do SLA do seu aplicativo, você pode optar por configurar um período de carência entre a detecção de interrupção e o failover em si.</span><span class="sxs-lookup"><span data-stu-id="dd9af-123">Depending on your application SLA, you can decide to configure a grace period between the detection of the outage and the failover itself.</span></span> <span data-ttu-id="dd9af-124">Configurar um período de carência reduz o risco de perda de dados para os casos em que a interrupção é catastrófica e a disponibilidade na região não pode ser restaurada rapidamente.</span><span class="sxs-lookup"><span data-stu-id="dd9af-124">Configuring a grace period reduces the risk of data loss to the cases where the outage is catastrophic and availability in the region cannot be quickly restored.</span></span> <span data-ttu-id="dd9af-125">Se o failover do ponto de extremidade for iniciado pelo Gerenciador de Tráfego antes de o grupo de failover disparar o failover do banco de dados, o aplicativo Web não poderá se reconectar ao banco de dados.</span><span class="sxs-lookup"><span data-stu-id="dd9af-125">If the endpoint failover is initiated by the traffic manager before the failover group triggers the failover of the database, the web application is not able to reconnect to the database.</span></span> <span data-ttu-id="dd9af-126">A tentativa do aplicativo de reconectar-se automaticamente terá êxito assim que o failover de banco de dados for concluído.</span><span class="sxs-lookup"><span data-stu-id="dd9af-126">The application’s attempt to reconnect automatically succeeds as soon as the database failover completes.</span></span> 

> [!NOTE]
> <span data-ttu-id="dd9af-127">Para conseguir um failover totalmente coordenado do aplicativo e dos bancos de dados, você deve planejar seu próprio método de monitoramento e usar o failover manual dos pontos de extremidade do aplicativo Web e dos bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="dd9af-127">To achieve fully coordinated failover of the application and the databases, you should devise your own monitoring method and use manual failover of the web application endpoints and the databases.</span></span>
>

<span data-ttu-id="dd9af-128">Após o failover dos pontos de extremidade do aplicativo e do banco de dados ser concluído, o aplicativo reiniciará o processamento das solicitações de usuário na região B e permanecerá co-localizado com o banco de dados porque o banco de dados primário está agora na região B. Esse cenário é ilustrado no diagrama a seguir.</span><span class="sxs-lookup"><span data-stu-id="dd9af-128">After the failover of both the application’s endpoints and the database completes, the application will re-start processing the user requests in the region B and will remain co-located with the database because the primary database is now in region B. This scenario is illustrated in the following diagram.</span></span> <span data-ttu-id="dd9af-129">Em todos os diagramas, linhas sólidas indicam conexões ativas, linhas pontilhadas indicam conexões suspensas e pontos indicam gatilhos de ação.</span><span class="sxs-lookup"><span data-stu-id="dd9af-129">In all diagrams, solid lines indicate active connections, dotted lines indicate suspended connections, and stop signs indicate action triggers.</span></span>

![Replicação geográfica: failover para banco de dados secundário.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-2.png)

<span data-ttu-id="dd9af-132">Se ocorrer uma interrupção na região secundária, o link de replicação entre os bancos de dados primário e secundário é suspenso, mas o failover não é disparado pois banco de dados primário não foi afetado.</span><span class="sxs-lookup"><span data-stu-id="dd9af-132">If an outage happens in the secondary region, the replication link between the primary and the secondary database is suspended but the failover is not triggered because the primary database is not impacted.</span></span> <span data-ttu-id="dd9af-133">A disponibilidade do aplicativo não é afetada neste caso, mas ele funcionará exposto e, portanto, correrá um risco mais elevado caso ambas as regiões falhem sucessivamente.</span><span class="sxs-lookup"><span data-stu-id="dd9af-133">The application's availability is not changed in this case, but the application operates exposed and therefore at higher risk in case both regions fail in succession.</span></span>

> [!NOTE]
> <span data-ttu-id="dd9af-134">Para recuperação de desastres, recomendamos a configuração com implantação de aplicativo limitada a duas regiões.</span><span class="sxs-lookup"><span data-stu-id="dd9af-134">For disaster recovery we recommend the configuration with application deployment limited to two regions.</span></span> <span data-ttu-id="dd9af-135">Isso ocorre porque a maioria das regiões geográficas do Azure tem somente duas regiões.</span><span class="sxs-lookup"><span data-stu-id="dd9af-135">This is because most of the Azure geographies have only two regions.</span></span> <span data-ttu-id="dd9af-136">Essa configuração não protegerá seu aplicativo contra uma falha catastrófica simultânea nas duas regiões.</span><span class="sxs-lookup"><span data-stu-id="dd9af-136">This configuration will not protect your application from a simultaneous catastrophic failure of both regions.</span></span>  <span data-ttu-id="dd9af-137">Caso ocorra essa falha improvável, você poderá recuperar seus bancos de dados em uma terceira região usando a [operação de restauração geográfica](sql-database-disaster-recovery.md#recover-using-geo-restore).</span><span class="sxs-lookup"><span data-stu-id="dd9af-137">In an unlikely event of such a failure, you can recover your databases in a third region using [geo-restore operation](sql-database-disaster-recovery.md#recover-using-geo-restore).</span></span>
>

<span data-ttu-id="dd9af-138">Depois que a interrupção for atenuada, o banco de dados secundário será sincronizado automaticamente com o primário.</span><span class="sxs-lookup"><span data-stu-id="dd9af-138">Once the outage is mitigated, the secondary database will automatically re-synchronize with the primary.</span></span> <span data-ttu-id="dd9af-139">Durante a sincronização, o desempenho do primário poderá ser ligeiramente afetado, dependendo da quantidade de dados que precisam ser sincronizados.</span><span class="sxs-lookup"><span data-stu-id="dd9af-139">During synchronization, performance of the primary could be slightly impacted depending on the amount of data that needs to be synchronized.</span></span> <span data-ttu-id="dd9af-140">O diagrama a seguir ilustra uma interrupção na região secundária.</span><span class="sxs-lookup"><span data-stu-id="dd9af-140">The following diagram illustrates an outage in the secondary region.</span></span>

![Banco de dados secundário sincronizado com o primário.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-3.png)

<span data-ttu-id="dd9af-143">As principais **vantagens** desse padrão de design são:</span><span class="sxs-lookup"><span data-stu-id="dd9af-143">The key **advantages** of this design pattern are:</span></span>

* <span data-ttu-id="dd9af-144">O mesmo aplicativo Web é implantado em ambas as regiões sem qualquer configuração específica de região e nenhuma lógica adicional para reagir ao failover.</span><span class="sxs-lookup"><span data-stu-id="dd9af-144">The same web application is deployed to both regions without any region-specific configuration and no additional logic to react to the failover.</span></span> 
* <span data-ttu-id="dd9af-145">O desempenho do aplicativo não é afetado pelo failover, pois o aplicativo Web e o banco de dados sempre estão co-localizados.</span><span class="sxs-lookup"><span data-stu-id="dd9af-145">The application's performance is not impacted by failover as the web application and the database are always co-located.</span></span>

<span data-ttu-id="dd9af-146">A principal **desvantagem** é que a instância do aplicativo redundante na região secundária é usada apenas para recuperação de desastres.</span><span class="sxs-lookup"><span data-stu-id="dd9af-146">The main **tradeoff** is that the redundant application instance in the secondary region is only used for disaster recovery.</span></span>

## <a name="design-pattern-2-active-active-deployment-for-application-load-balancing"></a><span data-ttu-id="dd9af-147">Padrão de design 2: implantação ativa-ativa para balanceamento de carga de aplicativo</span><span class="sxs-lookup"><span data-stu-id="dd9af-147">Design pattern 2: Active-active deployment for application load balancing</span></span>
<span data-ttu-id="dd9af-148">Essa opção de recuperação de desastre em nuvem é mais adequada para aplicativos com as seguintes características:</span><span class="sxs-lookup"><span data-stu-id="dd9af-148">This cloud disaster recovery option is best suited for applications with the following characteristics:</span></span>

* <span data-ttu-id="dd9af-149">Alta taxa de leituras de banco de dados em relação às gravações</span><span class="sxs-lookup"><span data-stu-id="dd9af-149">High ratio of database reads to writes</span></span>
* <span data-ttu-id="dd9af-150">A latência de leitura do banco de dados é mais importante para a experiência do usuário final que a latência de gravação</span><span class="sxs-lookup"><span data-stu-id="dd9af-150">Database read latency is more critical for the end-user experience than the write latency</span></span> 
* <span data-ttu-id="dd9af-151">A lógica somente leitura pode ser separada da lógica de leitura/gravação usando uma cadeia de conexão diferente</span><span class="sxs-lookup"><span data-stu-id="dd9af-151">Read-only logic can be separated from read-write logic by using a different connection string</span></span>
* <span data-ttu-id="dd9af-152">A lógica somente leitura não requer que os dados sejam totalmente sincronizados com as últimas atualizações</span><span class="sxs-lookup"><span data-stu-id="dd9af-152">Read-only logic does not depend on data being fully synchronized with the latest updates</span></span>  

<span data-ttu-id="dd9af-153">Se seus aplicativos tiverem essas características, o balanceamento de carga de conexões de usuário final em várias instâncias do aplicativo em regiões diferentes pode melhorar de forma significativa a experiência geral do usuário final.</span><span class="sxs-lookup"><span data-stu-id="dd9af-153">If your applications have these characteristics, load balancing the end-user connections across multiple application instances in different regions can substantially improve the overall end-user experience.</span></span> <span data-ttu-id="dd9af-154">Duas das regiões devem ser selecionadas como o par de recuperação de desastres e o grupo de failover deve incluir os bancos de dados nessas regiões.</span><span class="sxs-lookup"><span data-stu-id="dd9af-154">Two of the regions should be selected as the DR pair and the failover group should include the databases in these regions.</span></span> <span data-ttu-id="dd9af-155">Para implementar o balanceamento de carga, cada região deve ter uma instância ativa do aplicativo com a lógica de leitura-gravação (RW) conectada ao ponto de extremidade do ouvinte de leitura/gravação do grupo de failover.</span><span class="sxs-lookup"><span data-stu-id="dd9af-155">To implement load-balancing, each region should have an active instance of the application with the read-write (RW) logic connected to the read-write listener endpoint of the failover group.</span></span> <span data-ttu-id="dd9af-156">Isso garante que o failover será iniciado automaticamente se o banco de dados primário for afetado por uma interrupção.</span><span class="sxs-lookup"><span data-stu-id="dd9af-156">It will guarantee that the failover will be automatically initiated if the primary database is impacted by an outage.</span></span> <span data-ttu-id="dd9af-157">A lógica de somente leitura (RO) no aplicativo Web deve se conectar diretamente ao banco de dados nessa região.</span><span class="sxs-lookup"><span data-stu-id="dd9af-157">The read-only logic (RO) in the web application should connect directly to the database in that region.</span></span> <span data-ttu-id="dd9af-158">O gerenciador de tráfego deve ser configurado para usar o [roteamento de desempenho](../traffic-manager/traffic-manager-configure-performance-routing-method.md) com o [monitoramento de ponto de extremidade](../traffic-manager/traffic-manager-monitoring.md) habilitado para cada instância do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="dd9af-158">Traffic manager should be set up to use [performance routing](../traffic-manager/traffic-manager-configure-performance-routing-method.md) with [end-point monitoring](../traffic-manager/traffic-manager-monitoring.md) enabled for each application instance.</span></span>

<span data-ttu-id="dd9af-159">Como no padrão 1, considere a implantação de um aplicativo de monitoramento semelhante.</span><span class="sxs-lookup"><span data-stu-id="dd9af-159">As in pattern #1, you should consider deploying a similar monitoring application.</span></span> <span data-ttu-id="dd9af-160">Porém, diferentemente do padrão n. 1, o aplicativo de monitoramento não será responsável por disparar o failover de ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="dd9af-160">But unlike pattern #1, the monitoring application will not be responsible for triggering the end-point failover.</span></span>

> [!NOTE]
> <span data-ttu-id="dd9af-161">Embora esse padrão use mais de um banco de dados secundário, apenas o banco de dados secundário na Região B seria usado para o failover devendo fazer parte do grupo de failover.</span><span class="sxs-lookup"><span data-stu-id="dd9af-161">While this pattern uses more than one secondary database, only the secondary in Region B  would be used for failover and should be part of the failover group.</span></span>
>

<span data-ttu-id="dd9af-162">O gerenciador de tráfego deve ser configurado para roteamento de desempenho para direcionar as conexões de usuário à instância do aplicativo mais próxima da localização geográfica do usuário.</span><span class="sxs-lookup"><span data-stu-id="dd9af-162">Traffic manager should be configured for performance routing to direct the user connections to the application instance closest to the user's geographic location.</span></span> <span data-ttu-id="dd9af-163">O diagrama a seguir ilustra essa configuração antes de uma interrupção.</span><span class="sxs-lookup"><span data-stu-id="dd9af-163">The following diagram illustrates this configuration before an outage.</span></span>

![Nenhuma interrupção: roteamento de desempenho para o aplicativo mais próximo.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-1.png)

<span data-ttu-id="dd9af-166">Se for detectada uma interrupção no banco de dados na região, o grupo de failover iniciará automaticamente o failover do banco de dados primário na região A para o secundário na região B. Ele também atualizará automaticamente o ponto de extremidade do ouvinte de leitura/gravação para a região B para que as conexões de leitura/gravação no aplicativo Web não sejam afetados.</span><span class="sxs-lookup"><span data-stu-id="dd9af-166">If a database outage is detected in the region A, the failover group will automatically initiate failover of the primary database in region A to the secondary in region B. It will also automatically update the read-write listener endpoint to region B so read-write connections in the web application will not be impacted.</span></span> <span data-ttu-id="dd9af-167">O gerenciador de tráfego exclui o ponto de extremidade offline da tabela de roteamento, mas continua a rotear o tráfego do usuário final para as instâncias online restantes.</span><span class="sxs-lookup"><span data-stu-id="dd9af-167">The traffic manager will exclude the offline end-point from the routing table but will continue routing the end-user traffic to the remaining online instances.</span></span> <span data-ttu-id="dd9af-168">As cadeias de conexão do SQL de somente leitura não serão afetadas, pois elas sempre apontam para o banco de dados na mesma região.</span><span class="sxs-lookup"><span data-stu-id="dd9af-168">The read-only SQL connection strings will not be impacted as they always point to the database in the same region.</span></span> 

<span data-ttu-id="dd9af-169">O diagrama a seguir ilustra a nova configuração após o failover.</span><span class="sxs-lookup"><span data-stu-id="dd9af-169">The following diagram illustrates the new configuration after the failover.</span></span>

![Configuração após o failover.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-2.png)

<span data-ttu-id="dd9af-172">No caso de uma interrupção em uma das regiões secundários, o gerenciador de tráfego removerá automaticamente da tabela de roteamento o ponto de extremidade offline nessa região.</span><span class="sxs-lookup"><span data-stu-id="dd9af-172">In case of an outage in one of the secondary regions, the traffic manager will automatically remove the offline end-point in that region from the routing table.</span></span> <span data-ttu-id="dd9af-173">O canal de replicação para o banco de dados secundário nessa região será suspenso.</span><span class="sxs-lookup"><span data-stu-id="dd9af-173">The replication channel to the secondary database in that region will be suspended.</span></span> <span data-ttu-id="dd9af-174">Como as demais regiões recebem tráfego de usuário adicional, o desempenho do aplicativo será afetado durante a interrupção.</span><span class="sxs-lookup"><span data-stu-id="dd9af-174">Because the remaining regions get additional user traffic in this scenario, the application's performance will be impacted during the outage.</span></span> <span data-ttu-id="dd9af-175">Depois que a interrupção é atenuada, o banco de dados secundário na região afetada será imediatamente sincronizado com o primário.</span><span class="sxs-lookup"><span data-stu-id="dd9af-175">Once the outage is mitigated, the secondary database in the impacted region will be immediately synchronized with the primary.</span></span> <span data-ttu-id="dd9af-176">Durante a sincronização, o desempenho do primário poderá ser ligeiramente afetado, dependendo da quantidade de dados que precisam ser sincronizados.</span><span class="sxs-lookup"><span data-stu-id="dd9af-176">During the synchronization performance of the primary could be slightly impacted depending on the amount of data that needs to be synchronized.</span></span> <span data-ttu-id="dd9af-177">O diagrama a seguir ilustra uma interrupção na região B.</span><span class="sxs-lookup"><span data-stu-id="dd9af-177">The following diagram illustrates an outage in region B.</span></span>

![Interrupção na região secundária.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-3.png)

<span data-ttu-id="dd9af-180">A principal **vantagem** desse padrão de design é que você pode dimensionar a carga de trabalho do aplicativo em vários secundários para obter o desempenho ideal para o usuário final.</span><span class="sxs-lookup"><span data-stu-id="dd9af-180">The key **advantage** of this design pattern is that you can scale the application workload across multiple secondaries to achieve the optimal end-user performance.</span></span> <span data-ttu-id="dd9af-181">As **desvantagens** dessa opção são:</span><span class="sxs-lookup"><span data-stu-id="dd9af-181">The **tradeoffs** of this option are:</span></span>

* <span data-ttu-id="dd9af-182">As conexões de leitura e gravação entre as instâncias do aplicativo e o banco de dados têm latência e custos variáveis</span><span class="sxs-lookup"><span data-stu-id="dd9af-182">Read-write connections between the application instances and database have varying latency and cost</span></span>
* <span data-ttu-id="dd9af-183">O desempenho do aplicativo é afetado durante a interrupção</span><span class="sxs-lookup"><span data-stu-id="dd9af-183">Application performance is impacted during the outage</span></span>

> [!NOTE]
> <span data-ttu-id="dd9af-184">Uma abordagem semelhante pode ser usada para descarregar cargas de trabalho especializadas, como trabalhos de geração de relatórios, ferramentas de business intelligence ou backups.</span><span class="sxs-lookup"><span data-stu-id="dd9af-184">A similar approach can be used to offload specialized workloads such as reporting jobs, business intelligence tools, or backups.</span></span> <span data-ttu-id="dd9af-185">Normalmente, essas cargas de trabalho consomem recursos significativos do banco de dados. Portanto, é recomendável que você designe um dos bancos de dados secundários para elas com o nível de desempenho correspondente à carga de trabalho antecipada.</span><span class="sxs-lookup"><span data-stu-id="dd9af-185">Typically, these workloads consume significant database resources therefore it is recommended that you designate one of the secondary databases for them with the performance level matched to the anticipated workload.</span></span>
>

## <a name="design-pattern-3-active-passive-deployment-for-data-preservation"></a><span data-ttu-id="dd9af-186">Padrão de design 3: implantação ativa-passiva para preservação dos dados</span><span class="sxs-lookup"><span data-stu-id="dd9af-186">Design pattern 3: Active-passive deployment for data preservation</span></span>
<span data-ttu-id="dd9af-187">Essa opção é mais adequada para aplicativos com as seguintes características:</span><span class="sxs-lookup"><span data-stu-id="dd9af-187">This option is best suited for applications with the following characteristics:</span></span>

* <span data-ttu-id="dd9af-188">Qualquer perda de dados é um risco comercial elevado.</span><span class="sxs-lookup"><span data-stu-id="dd9af-188">Any data loss is high business risk.</span></span> <span data-ttu-id="dd9af-189">O failover de banco de dados só poderá ser usado como último recurso, se a interrupção for catastrófica.</span><span class="sxs-lookup"><span data-stu-id="dd9af-189">The database failover can only be used as a last resort if the outage is catastrophic.</span></span>
* <span data-ttu-id="dd9af-190">O aplicativo oferece suporte aos modos somente leitura e leitura/gravação de operações e pode operar em “modo somente leitura” por um período de tempo específico.</span><span class="sxs-lookup"><span data-stu-id="dd9af-190">The application supports read-only and read-write modes of operations and can operate in "read-only mode" for a period of time.</span></span>

<span data-ttu-id="dd9af-191">Nesse padrão, o aplicativo alterna para o modo somente leitura quando as conexões de leitura/gravação começam a receber erros de tempo limite.</span><span class="sxs-lookup"><span data-stu-id="dd9af-191">In this pattern, the application switches to read-only mode when the read-write connections start getting time-out errors.</span></span> <span data-ttu-id="dd9af-192">O aplicativo Web é implantado em ambas as regiões e inclui uma conexão para o ponto de extremidade do ouvinte de leitura/gravação e uma conexão diferente para o ponto de extremidade do ouvinte de somente leitura.</span><span class="sxs-lookup"><span data-stu-id="dd9af-192">The Web Application is deployed to both regions and include a connection to the read-write listener endpoint and different connection to the read-only listener endpoint.</span></span> <span data-ttu-id="dd9af-193">O gerenciador de tráfego deve ser configurado para usar o [roteamento de failover](../traffic-manager/traffic-manager-configure-failover-routing-method.md) com o [monitoramento do ponto de extremidade](../traffic-manager/traffic-manager-monitoring.md) habilitado o ponto de extremidade do aplicativo em cada região.</span><span class="sxs-lookup"><span data-stu-id="dd9af-193">The Traffic manager should be set up to use [failover routing](../traffic-manager/traffic-manager-configure-failover-routing-method.md) with [end-point monitoring](../traffic-manager/traffic-manager-monitoring.md) enabled for the application endpoint in each region.</span></span>

<span data-ttu-id="dd9af-194">O diagrama a seguir ilustra essa configuração antes de uma interrupção.</span><span class="sxs-lookup"><span data-stu-id="dd9af-194">The following diagram illustrates this configuration before an outage.</span></span>

![Implantação ativo-passivo antes do failover.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-1.png)

<span data-ttu-id="dd9af-197">Quando o gerenciador de tráfego detecta uma falha de conectividade para região A, ele alternará automaticamente o tráfego de usuário para a instância do aplicativo na região B. Com esse padrão, é importante definir o período de carência de perda de dados com um valor suficientemente alto, por exemplo, 24 horas.</span><span class="sxs-lookup"><span data-stu-id="dd9af-197">When the traffic manager detects a connectivity failure to region A, it automatically switches user traffic to the application instance in region B. With this pattern, it is important that you set the grace period with data loss to a sufficiently high value, e.g. 24 hours.</span></span> <span data-ttu-id="dd9af-198">Ele garantirá que a perda de dados é impedida se a interrupção for atenuada dentro desse período.</span><span class="sxs-lookup"><span data-stu-id="dd9af-198">It will ensure that data loss is prevented if the outage is mitigated within that time.</span></span> <span data-ttu-id="dd9af-199">Quando o aplicativo Web na região B é ativado as operações de leitura/gravação começarão a falhar.</span><span class="sxs-lookup"><span data-stu-id="dd9af-199">When the Web application in the region B is activated the read-write operations will start failing.</span></span> <span data-ttu-id="dd9af-200">Nesse ponto, ele deve alternar para o modo somente leitura.</span><span class="sxs-lookup"><span data-stu-id="dd9af-200">At that point, it should switch to the read-only mode.</span></span> <span data-ttu-id="dd9af-201">Nesse modo as solicitações serão roteadas para o banco de dados secundário automaticamente.</span><span class="sxs-lookup"><span data-stu-id="dd9af-201">In this mode the requests will be automatically routed to the secondary database.</span></span> <span data-ttu-id="dd9af-202">No caso de uma falha catastrófica a interrupção não será atenuada dentro do período de carência e o grupo de failover irá disparar o failover.</span><span class="sxs-lookup"><span data-stu-id="dd9af-202">In the case of a catastrophic failure the outage will not be mitigated within the grace period and the failover group will trigger the failover.</span></span> <span data-ttu-id="dd9af-203">Depois disso o ouvinte de leitura/gravação ficará disponível e as chamadas para ele não irão mais falhar.</span><span class="sxs-lookup"><span data-stu-id="dd9af-203">After that the read-write listener will become available and the calls to it will stop failing.</span></span> <span data-ttu-id="dd9af-204">Isso é ilustrado pelo diagrama a seguir.</span><span class="sxs-lookup"><span data-stu-id="dd9af-204">This is illustrated by the following diagram.</span></span>

![Interrupção: aplicativo em modo somente leitura.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-2.png)

<span data-ttu-id="dd9af-207">Se a interrupção na região primária for atenuada dentro do período de carência, o gerenciador de tráfego detecta a restauração da conectividade na região primária e alterna o tráfego do usuário de volta para a instância do aplicativo na região A. Essa instância do aplicativo continua e opera em modo leitura/gravação usando o banco de dados primário na região A.</span><span class="sxs-lookup"><span data-stu-id="dd9af-207">If the outage in the primary region is mitigated within the grace period, traffic manager detects the restoration of connectivity in the primary region and switches user traffic back to the application instance in region A. That application instance resumes and operates in read-write mode using the primary database in region A.</span></span>

<span data-ttu-id="dd9af-208">No caso de uma interrupção na região B, o Gerenciador de Tráfego detecta a falha do ponto de extremidade do aplicativo na região B e o grupo de failover troca o ouvinte de somente leitura para a região A. Essa interrupção não afeta a experiência do usuário final, mas o banco de dados primário ficará exposto durante a interrupção.</span><span class="sxs-lookup"><span data-stu-id="dd9af-208">In case of an outage in the region B, the traffic manager detects the failure of the application end-point in region B and the failover group switches the read-only listener to region A. This outage does not impact the end-user experience but the primary database will be exposed during the outage.</span></span> <span data-ttu-id="dd9af-209">Isso é ilustrado pelo diagrama a seguir.</span><span class="sxs-lookup"><span data-stu-id="dd9af-209">This is illustrated by the following diagram.</span></span>

![Interrupção: banco de dados secundário.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-3.png)

<span data-ttu-id="dd9af-212">Após a interrupção ser atenuada, o banco de dados secundário é sincronizado imediatamente com o primário e o ouvinte de somente leitura é revertido para o banco de dados secundário na região B. Durante a sincronização, o desempenho do banco de dados primário pode ser afetado ligeiramente dependendo da quantidade de dados que precisam ser sincronizados.</span><span class="sxs-lookup"><span data-stu-id="dd9af-212">Once the outage is mitigated, the secondary database is immediately synchronized with the primary and the read-only listener is switched back to the secondary database in region B. During synchronization performance of the primary could be slightly impacted depending on the amount of data that needs to be synchronized.</span></span>

<span data-ttu-id="dd9af-213">Esse padrão de design apresenta várias **vantagens**:</span><span class="sxs-lookup"><span data-stu-id="dd9af-213">This design pattern has several **advantages**:</span></span>

* <span data-ttu-id="dd9af-214">Ele evita a perda de dados durante as interrupções temporárias.</span><span class="sxs-lookup"><span data-stu-id="dd9af-214">It avoids data loss during the temporary outages.</span></span>
* <span data-ttu-id="dd9af-215">O tempo de inatividade depende somente da velocidade com a qual o gerenciador de tráfego detecta a falha de conectividade, o que pode ser configurado.</span><span class="sxs-lookup"><span data-stu-id="dd9af-215">Downtime depends only on how quickly traffic manager detects the connectivity failure, which is configurable.</span></span>

<span data-ttu-id="dd9af-216">As **desvantagens** são:</span><span class="sxs-lookup"><span data-stu-id="dd9af-216">The **tradeoff** is:</span></span>

* <span data-ttu-id="dd9af-217">O aplicativo deve ser capaz de operar no modo somente leitura.</span><span class="sxs-lookup"><span data-stu-id="dd9af-217">Application must be able to operate in read-only mode.</span></span>

> [!NOTE]
> <span data-ttu-id="dd9af-218">No caso de uma interrupção de serviço permanente na região, ative manualmente o failover de banco de dados e aceite a perda de dados.</span><span class="sxs-lookup"><span data-stu-id="dd9af-218">In case of a permanent service outage in the region, you manually activate database failover and accept the data loss.</span></span> <span data-ttu-id="dd9af-219">O aplicativo será funcional na região secundária com acesso de leitura e gravação ao banco de dados.</span><span class="sxs-lookup"><span data-stu-id="dd9af-219">The application will be functional in the secondary region with read-write access to the database.</span></span>
>

## <a name="business-continuity-planning-choose-an-application-design-for-cloud-disaster-recovery"></a><span data-ttu-id="dd9af-220">Planejamento de continuidade de negócios: escolher um design de aplicativo para recuperação de desastre em nuvem</span><span class="sxs-lookup"><span data-stu-id="dd9af-220">Business continuity planning: Choose an application design for cloud disaster recovery</span></span>
<span data-ttu-id="dd9af-221">A estratégia específica de recuperação de desastre em nuvem pode combinar ou estender esses padrões de design para atender da melhor forma às necessidades do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="dd9af-221">Your specific cloud disaster recovery strategy can combine or extend these design patterns to best meet the needs of your application.</span></span>  <span data-ttu-id="dd9af-222">Como mencionado anteriormente, a estratégia escolhida é baseada no SLA que você deseja oferecer a seus clientes e na topologia de implantação do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="dd9af-222">As mentioned earlier, the strategy you choose is based on the SLA you want to offer to your customers and the application deployment topology.</span></span> <span data-ttu-id="dd9af-223">Para ajudar a orientar sua decisão, a tabela a seguir compara as opções com base na perda de dados estimada ou no RPO (objetivo de ponto de recuperação) e no ERT (tempo de recuperação estimado).</span><span class="sxs-lookup"><span data-stu-id="dd9af-223">To help guide your decision, the following table compares the choices based on the estimated data loss or recovery point objective (RPO) and estimated recovery time (ERT).</span></span>

| <span data-ttu-id="dd9af-224">Padrão</span><span class="sxs-lookup"><span data-stu-id="dd9af-224">Pattern</span></span> | <span data-ttu-id="dd9af-225">RPO</span><span class="sxs-lookup"><span data-stu-id="dd9af-225">RPO</span></span> | <span data-ttu-id="dd9af-226">ERT</span><span class="sxs-lookup"><span data-stu-id="dd9af-226">ERT</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="dd9af-227">Implantação ativa-passiva para recuperação de desastres com acesso de banco de dados colocalizado</span><span class="sxs-lookup"><span data-stu-id="dd9af-227">Active-passive deployment for disaster recovery with co-located database access</span></span> |<span data-ttu-id="dd9af-228">Acesso de leitura/gravação < 5 s</span><span class="sxs-lookup"><span data-stu-id="dd9af-228">Read-write access < 5 sec</span></span> |<span data-ttu-id="dd9af-229">Tempo de detecção de falha + TTL do DNS</span><span class="sxs-lookup"><span data-stu-id="dd9af-229">Failure detection time + DNS TTL</span></span> |
| <span data-ttu-id="dd9af-230">Implantação ativa-ativa para balanceamento de carga de aplicativo</span><span class="sxs-lookup"><span data-stu-id="dd9af-230">Active-active deployment for application load balancing</span></span> |<span data-ttu-id="dd9af-231">Acesso de leitura/gravação < 5 s</span><span class="sxs-lookup"><span data-stu-id="dd9af-231">Read-write access < 5 sec</span></span> |<span data-ttu-id="dd9af-232">Tempo de detecção de falha + TTL do DNS</span><span class="sxs-lookup"><span data-stu-id="dd9af-232">Failure detection time + DNS TTL</span></span> |
| <span data-ttu-id="dd9af-233">Implantação ativa-passiva para preservação de dados</span><span class="sxs-lookup"><span data-stu-id="dd9af-233">Active-passive deployment for data preservation</span></span> |<span data-ttu-id="dd9af-234">Acesso somente leitura < 5 seg</span><span class="sxs-lookup"><span data-stu-id="dd9af-234">Read-only access < 5 sec</span></span> | <span data-ttu-id="dd9af-235">Acesso somente leitura = 0</span><span class="sxs-lookup"><span data-stu-id="dd9af-235">Read-only access = 0</span></span> |
||<span data-ttu-id="dd9af-236">Acesso de leitura/gravação = zero</span><span class="sxs-lookup"><span data-stu-id="dd9af-236">Read-write access = zero</span></span> | <span data-ttu-id="dd9af-237">Acesso de leitura/gravação = Tempo de detecção de falha + período de carência de perda de dados</span><span class="sxs-lookup"><span data-stu-id="dd9af-237">Read-write access = Failure detection time + grace period with data loss</span></span> |
|||

## <a name="next-steps"></a><span data-ttu-id="dd9af-238">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="dd9af-238">Next steps</span></span>
* <span data-ttu-id="dd9af-239">Para saber mais sobre backups automatizados do Banco de Dados SQL do Azure, consulte [Backups automatizados do Banco de Dados SQL](sql-database-automated-backups.md)</span><span class="sxs-lookup"><span data-stu-id="dd9af-239">To learn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md)</span></span>
* <span data-ttu-id="dd9af-240">Para obter uma visão geral e os cenários de continuidade dos negócios, confira [Visão geral da continuidade dos negócios](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="dd9af-240">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md)</span></span>
* <span data-ttu-id="dd9af-241">Para saber mais sobre como usar backups automatizados de recuperação, veja [Restaurar um banco de dados de backups iniciados pelo serviço](sql-database-recovery-using-backups.md)</span><span class="sxs-lookup"><span data-stu-id="dd9af-241">To learn about using automated backups for recovery, see [restore a database from the service-initiated backups](sql-database-recovery-using-backups.md)</span></span>
* <span data-ttu-id="dd9af-242">Para saber mais sobre opções de recuperação mais rápidas, confira [replicação geográfica ativa](sql-database-geo-replication-overview.md)</span><span class="sxs-lookup"><span data-stu-id="dd9af-242">To learn about faster recovery options, see [active geo-replication](sql-database-geo-replication-overview.md)</span></span>  
* <span data-ttu-id="dd9af-243">Para saber mais sobre como usar backups automatizados para arquivamento, consulte [cópia de banco de dados](sql-database-copy.md)</span><span class="sxs-lookup"><span data-stu-id="dd9af-243">To learn about using automated backups for archiving, see [database copy](sql-database-copy.md)</span></span>
* <span data-ttu-id="dd9af-244">Para obter informações sobre o uso da replicação geográfica ativa com Pools elásticos, confira [Estratégias de recuperação de desastres do pool elástico](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="dd9af-244">For information about active geo-replication with Elastic Pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>
