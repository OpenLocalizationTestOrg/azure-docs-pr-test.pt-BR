---
title: "Transações distribuídas entre bancos de dados na nuvem"
description: "Visão Geral das Transações de Banco de Dados Elástico com o Banco de Dados SQL do Azure"
services: sql-database
documentationcenter: 
author: torsteng
manager: jhubbard
editor: torsteng
ms.assetid: e14df7a3-7788-4cfb-bcd1-7ad6433ef1f9
ms.service: sql-database
ms.custom: scale out apps
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: sql-database
ms.date: 05/27/2016
ms.author: torsteng
ms.openlocfilehash: f7f1ad3f1933b39a0030a784cae40521254037d6
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="distributed-transactions-across-cloud-databases"></a><span data-ttu-id="d99a6-103">Transações distribuídas entre bancos de dados na nuvem</span><span class="sxs-lookup"><span data-stu-id="d99a6-103">Distributed transactions across cloud databases</span></span>
<span data-ttu-id="d99a6-104">As transações de banco de dados elástico para Banco de dados SQL (BD SQL) do Azure permitem que você execute transações que abranjam vários bancos de dados no BD SQL.</span><span class="sxs-lookup"><span data-stu-id="d99a6-104">Elastic database transactions for Azure SQL Database (SQL DB) allow you to run transactions that span several databases in SQL DB.</span></span> <span data-ttu-id="d99a6-105">As transações de banco de dados elástico do BD SQL estão disponíveis para aplicativos .NET usando ADO .NET e se integram à experiência de programação conhecida usando as classes [System.Transaction](https://msdn.microsoft.com/library/system.transactions.aspx) .</span><span class="sxs-lookup"><span data-stu-id="d99a6-105">Elastic database transactions for SQL DB are available for .NET applications using ADO .NET and integrate with the familiar programming experience using the [System.Transaction](https://msdn.microsoft.com/library/system.transactions.aspx) classes.</span></span> <span data-ttu-id="d99a6-106">Para obter a biblioteca, confira [.NET Framework 4.6.1 (Web Installer)](https://www.microsoft.com/download/details.aspx?id=49981).</span><span class="sxs-lookup"><span data-stu-id="d99a6-106">To get the library, see [.NET Framework 4.6.1 (Web Installer)](https://www.microsoft.com/download/details.aspx?id=49981).</span></span>

<span data-ttu-id="d99a6-107">No local, esse cenário normalmente exigiria a execução do recurso MSDTC (Coordenador de Transações Distribuídas da Microsoft).</span><span class="sxs-lookup"><span data-stu-id="d99a6-107">On premises, such a scenario usually required running Microsoft Distributed Transaction Coordinator (MSDTC).</span></span> <span data-ttu-id="d99a6-108">Como o MSDTC não está disponível para aplicativos de plataforma como serviço no Azure, a capacidade de coordenar transações distribuídas agora foi diretamente integrada ao BD SQL.</span><span class="sxs-lookup"><span data-stu-id="d99a6-108">Since MSDTC is not available for Platform-as-a-Service application in Azure, the ability to coordinate distributed transactions has now been directly integrated into SQL DB.</span></span> <span data-ttu-id="d99a6-109">Os aplicativos podem se conectar a qualquer Banco de Dados SQL para iniciar transações distribuídas, e um dos bancos de dados coordenará de forma transparente a transação distribuída, como mostra a figura a seguir.</span><span class="sxs-lookup"><span data-stu-id="d99a6-109">Applications can connect to any SQL Database to launch distributed transactions, and one of the databases will transparently coordinate the distributed transaction, as shown in the following figure.</span></span> 

  ![<span data-ttu-id="d99a6-110">Transações distribuídas com o Banco de Dados SQL do Azure usando transações de banco de dados elástico</span><span class="sxs-lookup"><span data-stu-id="d99a6-110">Distributed transactions with Azure SQL Database using elastic database transactions</span></span> ][1]

## <a name="common-scenarios"></a><span data-ttu-id="d99a6-111">Cenários comuns</span><span class="sxs-lookup"><span data-stu-id="d99a6-111">Common scenarios</span></span>
<span data-ttu-id="d99a6-112">As transações de banco de dados elástico do BD SQL permitem que os aplicativos façam alterações atômicas nos dados armazenados em vários Bancos de Dados SQL diferentes.</span><span class="sxs-lookup"><span data-stu-id="d99a6-112">Elastic database transactions for SQL DB enable applications to make atomic changes to data stored in several different SQL Databases.</span></span> <span data-ttu-id="d99a6-113">A visualização se concentra nas experiências de desenvolvimento do lado do cliente em C# e .NET.</span><span class="sxs-lookup"><span data-stu-id="d99a6-113">The preview focuses on client-side development experiences in C# and .NET.</span></span> <span data-ttu-id="d99a6-114">Há planos para uma experiência do lado do servidor usando o T-SQL para um momento posterior.</span><span class="sxs-lookup"><span data-stu-id="d99a6-114">A server-side experience using T-SQL is planned for a later time.</span></span>  
<span data-ttu-id="d99a6-115">As transações de banco de dados elástico têm como objetivo os seguintes cenários:</span><span class="sxs-lookup"><span data-stu-id="d99a6-115">Elastic database transactions targets the following scenarios:</span></span>

* <span data-ttu-id="d99a6-116">Aplicativos de vários bancos de dados no Azure: com esse cenário, os dados são particionados verticalmente em vários bancos de dados no BD SQL, de modo que os diferentes tipos de dados residam em bancos de dados diferentes.</span><span class="sxs-lookup"><span data-stu-id="d99a6-116">Multi-database applications in Azure: With this scenario, data is vertically partitioned across several databases in SQL DB such that different kinds of data reside on different databases.</span></span> <span data-ttu-id="d99a6-117">Algumas operações exigem alterações nos dados, que são mantidos em dois ou mais bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="d99a6-117">Some operations require changes to data which is kept in two or more databases.</span></span> <span data-ttu-id="d99a6-118">O aplicativo usa transações de banco de dados elástico para coordenar as alterações nos bancos de dados e garantir a atomicidade.</span><span class="sxs-lookup"><span data-stu-id="d99a6-118">The application uses elastic database transactions to coordinate the changes across databases and ensure atomicity.</span></span>
* <span data-ttu-id="d99a6-119">Aplicativos de banco de dados fragmentado no Azure: com esse cenário, a camada de dados usa a [biblioteca de cliente do Banco de Dados Elástico](sql-database-elastic-database-client-library.md) ou a autofragmentação para particionar horizontalmente os dados em vários bancos de dados no Banco de Dados SQL.</span><span class="sxs-lookup"><span data-stu-id="d99a6-119">Sharded database applications in Azure: With this scenario, the data tier uses the [Elastic Database client library](sql-database-elastic-database-client-library.md) or self-sharding to horizontally partition the data across many databases in SQL DB.</span></span> <span data-ttu-id="d99a6-120">Um caso de uso importante é a necessidade de realizar mudanças atômicas em um aplicativo multilocatário fragmentado quando as alterações se estendem aos locatários.</span><span class="sxs-lookup"><span data-stu-id="d99a6-120">One prominent use case is the need to perform atomic changes for a sharded multi-tenant application when changes span tenants.</span></span> <span data-ttu-id="d99a6-121">Pense, por exemplo, em uma transferência de um locatário para outro, ambos residentes em bancos de dados diferentes.</span><span class="sxs-lookup"><span data-stu-id="d99a6-121">Think for instance of a transfer from one tenant to another, both residing on different databases.</span></span> <span data-ttu-id="d99a6-122">Um segundo caso é a fragmentação refinada para acomodar as necessidades de capacidade de um locatário grande, o que, por sua vez, geralmente implica na necessidade de extensão de algumas operações atômicas em vários bancos de dados usados para o mesmo locatário.</span><span class="sxs-lookup"><span data-stu-id="d99a6-122">A second case is fine-grained sharding to accommodate capacity needs for a large tenant which in turn typically implies that some atomic operations needs to stretch across several databases used for the same tenant.</span></span> <span data-ttu-id="d99a6-123">Um terceiro caso são as atualizações atômicas de dados de referência que são replicados nos bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="d99a6-123">A third case is atomic updates to reference data that are replicated across databases.</span></span> <span data-ttu-id="d99a6-124">As operações atômicas e transacionadas, juntamente com estas linhas, agora podem ser coordenadas em vários bancos de dados usando a visualização.</span><span class="sxs-lookup"><span data-stu-id="d99a6-124">Atomic, transacted, operations along these lines can now be coordinated across several databases using the preview.</span></span>
  <span data-ttu-id="d99a6-125">As transações de banco de dados elástico usam o protocolo 2PC para garantir a atomicidade das transações nos bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="d99a6-125">Elastic database transactions use two-phase commit to ensure transaction atomicity across databases.</span></span> <span data-ttu-id="d99a6-126">É uma boa opção para as transações que envolvem menos de 100 bancos de dados por vez em uma única transação.</span><span class="sxs-lookup"><span data-stu-id="d99a6-126">It is a good fit for transactions that involve less than 100 databases at a time within a single transaction.</span></span> <span data-ttu-id="d99a6-127">Esses limites não são impostos, mas o desempenho e as taxas de êxito das transações de banco de dados elástico provavelmente serão prejudicados se eles forem ultrapassados.</span><span class="sxs-lookup"><span data-stu-id="d99a6-127">These limits are not enforced, but one should expect performance and success rates for elastic database transactions to suffer when exceeding these limits.</span></span>

## <a name="installation-and-migration"></a><span data-ttu-id="d99a6-128">Instalação e migração</span><span class="sxs-lookup"><span data-stu-id="d99a6-128">Installation and migration</span></span>
<span data-ttu-id="d99a6-129">Os recursos das transações de banco de dados elástico no BD SQL são fornecidos por meio de atualizações das bibliotecas .NET System.Data.dll e System.Transactions.dll.</span><span class="sxs-lookup"><span data-stu-id="d99a6-129">The capabilities for elastic database transactions in SQL DB are provided through updates to the .NET libraries System.Data.dll and System.Transactions.dll.</span></span> <span data-ttu-id="d99a6-130">As DLLs garantem que o protocolo 2PC seja usado quando necessário para garantir a atomicidade.</span><span class="sxs-lookup"><span data-stu-id="d99a6-130">The DLLs ensure that two-phase commit is used where necessary to ensure atomicity.</span></span> <span data-ttu-id="d99a6-131">Para começar a desenvolver aplicativos usando as transações de banco de dados elástico, instale o [.NET Framework 4.6.1](https://www.microsoft.com/download/details.aspx?id=49981) ou uma versão posterior.</span><span class="sxs-lookup"><span data-stu-id="d99a6-131">To start developing applications using elastic database transactions, install [.NET Framework 4.6.1](https://www.microsoft.com/download/details.aspx?id=49981) or a later version.</span></span> <span data-ttu-id="d99a6-132">Quando executadas em uma versão anterior do .NET Framework, as transações não serão promovidas a uma transação distribuída, e uma exceção será gerada.</span><span class="sxs-lookup"><span data-stu-id="d99a6-132">When running on an earlier version of the .NET framework, transactions will fail to promote to a distributed transaction and an exception will be raised.</span></span>

<span data-ttu-id="d99a6-133">Após a instalação, você pode usar as APIs de transação distribuída em System.Transactions com conexões ao BD SQL.</span><span class="sxs-lookup"><span data-stu-id="d99a6-133">After installation, you can use the distributed transaction APIs in System.Transactions with connections to SQL DB.</span></span> <span data-ttu-id="d99a6-134">Se você já tiver aplicativos do MSDTC usando essas APIs, basta recompilar os aplicativos existentes para o .NET 4.6 depois de instalar o .NET Framework 4.6.1.</span><span class="sxs-lookup"><span data-stu-id="d99a6-134">If you have existing MSDTC applications using these APIs, simply rebuild your existing applications for .NET 4.6 after installing the 4.6.1 Framework.</span></span> <span data-ttu-id="d99a6-135">Se seus projetos visam o .NET 4.6, eles usarão automaticamente as DLLs atualizadas da nova versão do Framework, e as chamadas à API de transação distribuída em conjunto com as conexões ao BD SQL passarão a funcionar.</span><span class="sxs-lookup"><span data-stu-id="d99a6-135">If your projects target .NET 4.6, they will automatically use the updated DLLs from the new Framework version and distributed transaction API calls in combination with connections to SQL DB will now succeed.</span></span>

<span data-ttu-id="d99a6-136">Lembre-se de que as transações de banco de dados elástico não requerem a instalação do MSDTC.</span><span class="sxs-lookup"><span data-stu-id="d99a6-136">Remember that elastic database transactions do not require installing MSDTC.</span></span> <span data-ttu-id="d99a6-137">Em vez disso, as transações de banco de dados elástico são gerenciadas diretamente pelo BD SQL, dentro dele.</span><span class="sxs-lookup"><span data-stu-id="d99a6-137">Instead, elastic database transactions are directly managed by and within SQL DB.</span></span> <span data-ttu-id="d99a6-138">Isso simplifica significativamente os cenários de nuvem, já que a implantação de um MSDTC não é necessária para o uso das transações distribuídas com o BD SQL.</span><span class="sxs-lookup"><span data-stu-id="d99a6-138">This significantly simplifies cloud scenarios since a deployment of MSDTC is not necessary to use distributed transactions with SQL DB.</span></span> <span data-ttu-id="d99a6-139">A Seção 4 explica detalhadamente como implantar as transações de banco de dados elástico e o .NET Framework necessário juntamente com seus aplicativos em nuvem no Azure.</span><span class="sxs-lookup"><span data-stu-id="d99a6-139">Section 4 explains in more detail how to deploy elastic database transactions and the required .NET framework together with your cloud applications to Azure.</span></span>

## <a name="development-experience"></a><span data-ttu-id="d99a6-140">Experiência de desenvolvimento</span><span class="sxs-lookup"><span data-stu-id="d99a6-140">Development experience</span></span>
### <a name="multi-database-applications"></a><span data-ttu-id="d99a6-141">Aplicativos de vários bancos de dados</span><span class="sxs-lookup"><span data-stu-id="d99a6-141">Multi-database applications</span></span>
<span data-ttu-id="d99a6-142">O exemplo de código a seguir usa a experiência de programação conhecida com o .NET System.Transactions.</span><span class="sxs-lookup"><span data-stu-id="d99a6-142">The following sample code uses the familiar programming experience with .NET System.Transactions.</span></span> <span data-ttu-id="d99a6-143">A classe TransactionScope estabelece uma transação de ambiente no .NET.</span><span class="sxs-lookup"><span data-stu-id="d99a6-143">The TransactionScope class establishes an ambient transaction in .NET.</span></span> <span data-ttu-id="d99a6-144">Uma “transação de ambiente” é aquela que reside no thread atual. Todas as conexões abertas no TransactionScope participam da transação.</span><span class="sxs-lookup"><span data-stu-id="d99a6-144">(An “ambient transaction” is one that lives in the current thread.) All connections opened within the TransactionScope participate in the transaction.</span></span> <span data-ttu-id="d99a6-145">Se diferentes bancos de dados participarem, a transação será elevada automaticamente a uma transação distribuída.</span><span class="sxs-lookup"><span data-stu-id="d99a6-145">If different databases participate, the transaction is automatically elevated to a distributed transaction.</span></span> <span data-ttu-id="d99a6-146">O resultado da transação é controlado pela definição do escopo a concluir para indicar uma confirmação.</span><span class="sxs-lookup"><span data-stu-id="d99a6-146">The outcome of the transaction is controlled by setting the scope to complete to indicate a commit.</span></span>

    using (var scope = new TransactionScope())
    {
        using (var conn1 = new SqlConnection(connStrDb1))
        {
            conn1.Open();
            SqlCommand cmd1 = conn1.CreateCommand();
            cmd1.CommandText = string.Format("insert into T1 values(1)");
            cmd1.ExecuteNonQuery();
        }

        using (var conn2 = new SqlConnection(connStrDb2))
        {
            conn2.Open();
            var cmd2 = conn2.CreateCommand();
            cmd2.CommandText = string.Format("insert into T2 values(2)");
            cmd2.ExecuteNonQuery();
        }

        scope.Complete();
    }

### <a name="sharded-database-applications"></a><span data-ttu-id="d99a6-147">Aplicativos de banco de dados fragmentado</span><span class="sxs-lookup"><span data-stu-id="d99a6-147">Sharded database applications</span></span>
<span data-ttu-id="d99a6-148">As transações de banco de dados elástico do BD SQL também oferecem suporte a coordenação de transações distribuídas, em que você usa o método OpenConnectionForKey da biblioteca do cliente de banco de dados elástico para abrir conexões para uma camada de dados escalados horizontalmente.</span><span class="sxs-lookup"><span data-stu-id="d99a6-148">Elastic database transactions for SQL DB also support coordinating distributed transactions where you use the OpenConnectionForKey method of the elastic database client library to open connections for a scaled out data tier.</span></span> <span data-ttu-id="d99a6-149">Considere os casos em que você precisa garantir a consistência transacional das alterações em vários valores-chave de fragmentação diferentes.</span><span class="sxs-lookup"><span data-stu-id="d99a6-149">Consider cases where you need to guarantee transactional consistency for changes across several different sharding key values.</span></span> <span data-ttu-id="d99a6-150">As conexões com os fragmentos que hospedam os diferentes valores-chave de fragmentação são intermediadas usando o OpenConnectionForKey.</span><span class="sxs-lookup"><span data-stu-id="d99a6-150">Connections to the shards hosting the different sharding key values are brokered using OpenConnectionForKey.</span></span> <span data-ttu-id="d99a6-151">Em geral, as conexões podem ocorrer para diferentes fragmentos, de modo que para assegurar as garantias transacionais seja necessária uma transação distribuída.</span><span class="sxs-lookup"><span data-stu-id="d99a6-151">In the general case, the connections can be to different shards such that ensuring transactional guarantees requires a distributed transaction.</span></span> <span data-ttu-id="d99a6-152">O exemplo de código a seguir ilustra essa abordagem.</span><span class="sxs-lookup"><span data-stu-id="d99a6-152">The following code sample illustrates this approach.</span></span> <span data-ttu-id="d99a6-153">Ele pressupõe que uma variável chamada shardmap seja usada para representar um mapa do fragmento na biblioteca do cliente de banco de dados elástico:</span><span class="sxs-lookup"><span data-stu-id="d99a6-153">It assumes that a variable called shardmap is used to represent a shard map from the elastic database client library:</span></span>

    using (var scope = new TransactionScope())
    {
        using (var conn1 = shardmap.OpenConnectionForKey(tenantId1, credentialsStr))
        {
            conn1.Open();
            SqlCommand cmd1 = conn1.CreateCommand();
            cmd1.CommandText = string.Format("insert into T1 values(1)");
            cmd1.ExecuteNonQuery();
        }

        using (var conn2 = shardmap.OpenConnectionForKey(tenantId2, credentialsStr))
        {
            conn2.Open();
            var cmd2 = conn2.CreateCommand();
            cmd2.CommandText = string.Format("insert into T1 values(2)");
            cmd2.ExecuteNonQuery();
        }

        scope.Complete();
    }


## <a name="net-installation-for-azure-cloud-services"></a><span data-ttu-id="d99a6-154">Instalação do .NET para os Serviços de Nuvem do Azure</span><span class="sxs-lookup"><span data-stu-id="d99a6-154">.NET installation for Azure Cloud Services</span></span>
<span data-ttu-id="d99a6-155">O Azure fornece várias ofertas para hospedar aplicativos .NET.</span><span class="sxs-lookup"><span data-stu-id="d99a6-155">Azure provides several offerings to host .NET applications.</span></span> <span data-ttu-id="d99a6-156">Uma comparação entre as diferentes ofertas está disponível em [Comparação entre o Serviço de Aplicativo do Azure, os Serviços de Nuvem e as Máquinas Virtuais](../app-service-web/choose-web-site-cloud-service-vm.md).</span><span class="sxs-lookup"><span data-stu-id="d99a6-156">A comparison of the different offerings is available in [Azure App Service, Cloud Services, and Virtual Machines comparison](../app-service-web/choose-web-site-cloud-service-vm.md).</span></span> <span data-ttu-id="d99a6-157">Se o SO convidado da oferta for inferior ao .NET 4.6.1 exigido para transações elásticas, será necessário atualizar o SO para 4.6.1.</span><span class="sxs-lookup"><span data-stu-id="d99a6-157">If the guest OS of the offering is smaller than .NET 4.6.1 required for elastic transactions, you need to upgrade the guest OS to 4.6.1.</span></span> 

<span data-ttu-id="d99a6-158">Para os Serviços de Aplicativos do Azure, não há suporte para atualizações para o SO convidado.</span><span class="sxs-lookup"><span data-stu-id="d99a6-158">For Azure App Services, upgrades to the guest OS are currently not supported.</span></span> <span data-ttu-id="d99a6-159">Para as Máquinas virtuais do Azure, basta fazer logon na VM e executar o instalador do .NET Framework mais recente.</span><span class="sxs-lookup"><span data-stu-id="d99a6-159">For Azure Virtual Machines, simply log into the VM and run the installer for the latest .NET framework.</span></span> <span data-ttu-id="d99a6-160">Para os Serviços de Nuvem do Azure, você precisará incluir a instalação de uma versão mais recente do .NET em tarefas de inicialização da sua implantação.</span><span class="sxs-lookup"><span data-stu-id="d99a6-160">For Azure Cloud Services, you need to include the installation of a newer .NET version into the startup tasks of your deployment.</span></span> <span data-ttu-id="d99a6-161">Os conceitos e as etapas estão documentados em [Instalar o .NET em uma Função do Serviço de Nuvem](../cloud-services/cloud-services-dotnet-install-dotnet.md).</span><span class="sxs-lookup"><span data-stu-id="d99a6-161">The concepts and steps are documented in [Install .NET on a Cloud Service Role](../cloud-services/cloud-services-dotnet-install-dotnet.md).</span></span>  

<span data-ttu-id="d99a6-162">Observe que o instalador do .NET 4.6.1 pode exigir mais armazenamento temporário durante o processo de inicialização nos Serviços de Nuvem do Azure que o instalador do .NET 4.6.</span><span class="sxs-lookup"><span data-stu-id="d99a6-162">Note that the installer for .NET 4.6.1 may require more temporary storage during the bootstrapping process on Azure cloud services than the installer for .NET 4.6.</span></span> <span data-ttu-id="d99a6-163">Para garantir uma instalação bem-sucedida, você precisa aumentar o armazenamento temporário para o serviço de nuvem do Azure no seu arquivo ServiceDefinition.csdef na seção LocalResources e nas configurações do ambiente de sua tarefa de inicialização, conforme mostrado no exemplo a seguir:</span><span class="sxs-lookup"><span data-stu-id="d99a6-163">To ensure a successful installation, you need to increase temporary storage for your Azure cloud service in your ServiceDefinition.csdef file in the LocalResources section and the environment settings of your startup task, as shown in the following sample:</span></span>

    <LocalResources>
    ...
        <LocalStorage name="TEMP" sizeInMB="5000" cleanOnRoleRecycle="false" />
        <LocalStorage name="TMP" sizeInMB="5000" cleanOnRoleRecycle="false" />
    </LocalResources>
    <Startup>
        <Task commandLine="install.cmd" executionContext="elevated" taskType="simple">
            <Environment>
        ...
                <Variable name="TEMP">
                    <RoleInstanceValue xpath="/RoleEnvironment/CurrentInstance/LocalResources/LocalResource[@name='TEMP']/@path" />
                </Variable>
                <Variable name="TMP">
                    <RoleInstanceValue xpath="/RoleEnvironment/CurrentInstance/LocalResources/LocalResource[@name='TMP']/@path" />
                </Variable>
            </Environment>
        </Task>
    </Startup>

## <a name="transactions-across-multiple-servers"></a><span data-ttu-id="d99a6-164">Transações entre vários servidores</span><span class="sxs-lookup"><span data-stu-id="d99a6-164">Transactions across multiple servers</span></span>
<span data-ttu-id="d99a6-165">Há suporte para transações de Banco de Dados Elástico entre diferentes servidores lógicos no Banco de Dados SQL do Azure.</span><span class="sxs-lookup"><span data-stu-id="d99a6-165">Elastic database transactions are supported across different logical servers in Azure SQL Database.</span></span> <span data-ttu-id="d99a6-166">Quando as transações cruzam os limites do servidor lógico, os servidores participantes precisam primeiro serem inseridos em uma relação de comunicação comum.</span><span class="sxs-lookup"><span data-stu-id="d99a6-166">When transactions cross logical server boundaries, the participating servers first need to be entered into a mutual communication relationship.</span></span> <span data-ttu-id="d99a6-167">Após a relação de comunicação ser estabelecida, qualquer banco de dados em qualquer um dos dois servidores poderá participar de transações elásticas com bancos de dados do outro servidor.</span><span class="sxs-lookup"><span data-stu-id="d99a6-167">Once the communication relationship has been established, any database in any of the two servers can participate in elastic transactions with databases from the other server.</span></span> <span data-ttu-id="d99a6-168">Com transações abrangendo mais de dois servidores lógicos, uma relação de comunicação deve estar em vigor para qualquer par de servidores lógicos.</span><span class="sxs-lookup"><span data-stu-id="d99a6-168">With transactions spanning more than two logical servers, a communication relationship needs to be in place for any pair of logical servers.</span></span>

<span data-ttu-id="d99a6-169">Use os cmdlets do PowerShell a seguir para gerenciar as relações de comunicação entre servidores para transações de Banco de Dados Elástico:</span><span class="sxs-lookup"><span data-stu-id="d99a6-169">Use the following PowerShell cmdlets to manage cross-server communication relationships for elastic database transactions:</span></span>

* <span data-ttu-id="d99a6-170">**New-AzureRmSqlServerCommunicationLink**: use esse cmdlet para criar uma nova relação de comunicação entre dois servidores lógicos no Banco de Dados SQL do Azure.</span><span class="sxs-lookup"><span data-stu-id="d99a6-170">**New-AzureRmSqlServerCommunicationLink**: Use this cmdlet to create a new communication relationship between two logical servers in Azure SQL DB.</span></span> <span data-ttu-id="d99a6-171">A relação é simétrica, o que significa que ambos os servidores podem iniciar transações com outro.</span><span class="sxs-lookup"><span data-stu-id="d99a6-171">The relationship is symmetric which means both servers can initiate transactions with the other server.</span></span>
* <span data-ttu-id="d99a6-172">**Get-AzureRmSqlServerCommunicationLink**: use esse cmdlet para recuperar as relações de comunicação existentes e suas propriedades.</span><span class="sxs-lookup"><span data-stu-id="d99a6-172">**Get-AzureRmSqlServerCommunicationLink**: Use this cmdlet to retrieve existing communication relationships and their properties.</span></span>
* <span data-ttu-id="d99a6-173">**Remove-AzureRmSqlServerCommunicationLink**: use esse cmdlet para remover as relações de comunicação existentes.</span><span class="sxs-lookup"><span data-stu-id="d99a6-173">**Remove-AzureRmSqlServerCommunicationLink**: Use this cmdlet to remove an existing communication relationship.</span></span> 

## <a name="monitoring-transaction-status"></a><span data-ttu-id="d99a6-174">Monitorando o status da transação</span><span class="sxs-lookup"><span data-stu-id="d99a6-174">Monitoring transaction status</span></span>
<span data-ttu-id="d99a6-175">Use as DMVs (Exibições de Gerenciamento Dinâmico) no BD SQL para monitorar o status e o progresso das transações de banco de dados elástico em andamento.</span><span class="sxs-lookup"><span data-stu-id="d99a6-175">Use Dynamic Management Views (DMVs) in SQL DB to monitor status and progress of your ongoing elastic database transactions.</span></span> <span data-ttu-id="d99a6-176">Todas as DMVs relacionadas com transações são relevantes para as transações distribuídas no BD SQL.</span><span class="sxs-lookup"><span data-stu-id="d99a6-176">All DMVs related to transactions are relevant for distributed transactions in SQL DB.</span></span> <span data-ttu-id="d99a6-177">Você pode encontrar a lista correspondente de DMVs aqui: [Funções e exibições de gerenciamento dinâmico relacionadas a transações (Transact-SQL)](https://msdn.microsoft.com/library/ms178621.aspx).</span><span class="sxs-lookup"><span data-stu-id="d99a6-177">You can find the corresponding list of DMVs here: [Transaction Related Dynamic Management Views and Functions (Transact-SQL)](https://msdn.microsoft.com/library/ms178621.aspx).</span></span>

<span data-ttu-id="d99a6-178">Estas DMVs são especialmente úteis:</span><span class="sxs-lookup"><span data-stu-id="d99a6-178">These DMVs are particularly useful:</span></span>

* <span data-ttu-id="d99a6-179">**sys.dm\_tran\_active\_transactions**: lista as transações atualmente ativas e seu status.</span><span class="sxs-lookup"><span data-stu-id="d99a6-179">**sys.dm\_tran\_active\_transactions**: Lists currently active transactions and their status.</span></span> <span data-ttu-id="d99a6-180">A coluna UOW (Unidade de Trabalho) pode identificar as diferentes transações filho que pertencem à mesma transação distribuída.</span><span class="sxs-lookup"><span data-stu-id="d99a6-180">The UOW (Unit Of Work) column can identify the different child transactions that belong to the same distributed transaction.</span></span> <span data-ttu-id="d99a6-181">Todas as transações dentro da mesma transação distribuída carregam o mesmo valor UOW.</span><span class="sxs-lookup"><span data-stu-id="d99a6-181">All transactions within the same distributed transaction carry the same UOW value.</span></span> <span data-ttu-id="d99a6-182">Consulte a [documentação da DMV](https://msdn.microsoft.com/library/ms174302.aspx) para obter mais detalhes.</span><span class="sxs-lookup"><span data-stu-id="d99a6-182">See the [DMV documentation](https://msdn.microsoft.com/library/ms174302.aspx) for more details.</span></span>
* <span data-ttu-id="d99a6-183">**sys.dm\_tran\_database\_transactions**: fornece informações adicionais sobre as transações, como a colocação da transação no log.</span><span class="sxs-lookup"><span data-stu-id="d99a6-183">**sys.dm\_tran\_database\_transactions**: Provides additional information about transactions, such as placement of the transaction in the log.</span></span> <span data-ttu-id="d99a6-184">Consulte a [documentação da DMV](https://msdn.microsoft.com/library/ms186957.aspx) para obter mais detalhes.</span><span class="sxs-lookup"><span data-stu-id="d99a6-184">See the [DMV documentation](https://msdn.microsoft.com/library/ms186957.aspx) for more details.</span></span>
* <span data-ttu-id="d99a6-185">**sys.dm\_tran\_locks**: fornece informações sobre os bloqueios que são atualmente mantidos por transações em andamento.</span><span class="sxs-lookup"><span data-stu-id="d99a6-185">**sys.dm\_tran\_locks**: Provides information about the locks that are currently held by ongoing transactions.</span></span> <span data-ttu-id="d99a6-186">Consulte a [documentação da DMV](https://msdn.microsoft.com/library/ms190345.aspx) para obter mais detalhes.</span><span class="sxs-lookup"><span data-stu-id="d99a6-186">See the [DMV documentation](https://msdn.microsoft.com/library/ms190345.aspx) for more details.</span></span>

## <a name="limitations"></a><span data-ttu-id="d99a6-187">Limitações</span><span class="sxs-lookup"><span data-stu-id="d99a6-187">Limitations</span></span>
<span data-ttu-id="d99a6-188">As seguintes limitações se aplicam atualmente para as transações de banco de dados elástico no BD SQL:</span><span class="sxs-lookup"><span data-stu-id="d99a6-188">The following limitations currently apply to elastic database transactions in SQL DB:</span></span>

* <span data-ttu-id="d99a6-189">Há suporte somente para transações em bancos de dados no BD SQL.</span><span class="sxs-lookup"><span data-stu-id="d99a6-189">Only transactions across databases in SQL DB are supported.</span></span> <span data-ttu-id="d99a6-190">Outros provedores de recursos [X/Open XA](https://en.wikipedia.org/wiki/X/Open_XA) e bancos de dados fora do BD SQL não podem participar de transações de banco de dados elástico.</span><span class="sxs-lookup"><span data-stu-id="d99a6-190">Other [X/Open XA](https://en.wikipedia.org/wiki/X/Open_XA) resource providers and databases outside of SQL DB cannot participate in elastic database transactions.</span></span> <span data-ttu-id="d99a6-191">Isso significa que as transações de banco de dados elástico não podem se estender para o SQL Server e o Banco de Dados SQL do Azure no local.</span><span class="sxs-lookup"><span data-stu-id="d99a6-191">That means that elastic database transactions cannot stretch across on premises SQL Server and Azure SQL Databases.</span></span> <span data-ttu-id="d99a6-192">Para transações distribuídas no local, continue a usar o MSDTC.</span><span class="sxs-lookup"><span data-stu-id="d99a6-192">For distributed transactions on premises, continue to use MSDTC.</span></span> 
* <span data-ttu-id="d99a6-193">Há suporte somente para transações coordenadas pelo cliente a partir de um aplicativo .NET.</span><span class="sxs-lookup"><span data-stu-id="d99a6-193">Only client-coordinated transactions from a .NET application are supported.</span></span> <span data-ttu-id="d99a6-194">Há planos para suporte do lado do servidor para o T-SQL, como INICIAR TRANSAÇÃO DISTRIBUÍDA, mas ainda não está disponível.</span><span class="sxs-lookup"><span data-stu-id="d99a6-194">Server-side support for T-SQL such as BEGIN DISTRIBUTED TRANSACTION is planned, but not yet available.</span></span> 
* <span data-ttu-id="d99a6-195">Não há suporte para transações em serviços WCF.</span><span class="sxs-lookup"><span data-stu-id="d99a6-195">Transactions across WCF services are not supported.</span></span> <span data-ttu-id="d99a6-196">Por exemplo, você tem um método de serviço WCF que executa uma transação.</span><span class="sxs-lookup"><span data-stu-id="d99a6-196">For example, you have a WCF service method that executes a transaction.</span></span> <span data-ttu-id="d99a6-197">Colocar a chamada dentro de um escopo de transação falhará como [System.ServiceModel.ProtocolException](https://msdn.microsoft.com/library/system.servicemodel.protocolexception).</span><span class="sxs-lookup"><span data-stu-id="d99a6-197">Enclosing the call within a transaction scope will fail as a [System.ServiceModel.ProtocolException](https://msdn.microsoft.com/library/system.servicemodel.protocolexception).</span></span>

## <a name="next-steps"></a><span data-ttu-id="d99a6-198">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="d99a6-198">Next steps</span></span>
<span data-ttu-id="d99a6-199">Em caso de dúvidas, entre em contato conosco pelo [fórum do Banco de Dados SQL](http://social.msdn.microsoft.com/forums/azure/home?forum=ssdsgetstarted) e, para solicitações de recursos, adicione-as ao [fórum de comentários sobre o Banco de Dados SQL](https://feedback.azure.com/forums/217321-sql-database/).</span><span class="sxs-lookup"><span data-stu-id="d99a6-199">For questions, please reach out to us on the [SQL Database forum](http://social.msdn.microsoft.com/forums/azure/home?forum=ssdsgetstarted) and for feature requests, please add them to the [SQL Database feedback forum](https://feedback.azure.com/forums/217321-sql-database/).</span></span>

<!--Image references-->
[1]: ./media/sql-database-elastic-transactions-overview/distributed-transactions.png



