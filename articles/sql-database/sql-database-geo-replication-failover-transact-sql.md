---
title: 'TSQL: Iniciar failover para o Banco de Dados SQL do Azure | Microsoft Docs'
description: "Iniciar um failover planejado ou não planejado para o Banco de Dados SQL do Azure usando o Transact-SQL"
services: sql-database
documentationcenter: 
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: 5eb2d256-025d-4f5a-99d4-17f702b37f14
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-management
ms.date: 01/10/2017
ms.author: carlrab
ms.openlocfilehash: 418953e044ba84ce758063d56a371af45d5cdfe1
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="initiate-a-planned-or-unplanned-failover-for-azure-sql-database-with-transact-sql"></a><span data-ttu-id="4a1e4-103">Iniciar um failover planejado ou não planejado para o Banco de Dados SQL do Azure com o Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="4a1e4-103">Initiate a planned or unplanned failover for Azure SQL Database with Transact-SQL</span></span>

<span data-ttu-id="4a1e4-104">Este artigo mostra como tooinitiate failover tooa banco de dados SQL secundário usando Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-104">This article shows you how tooinitiate failover tooa secondary SQL Database using Transact-SQL.</span></span> <span data-ttu-id="4a1e4-105">tooconfigure replicação geográfica, consulte [configurar a replicação geográfica para o banco de dados do Azure SQL](sql-database-geo-replication-transact-sql.md).</span><span class="sxs-lookup"><span data-stu-id="4a1e4-105">tooconfigure geo-replication, see [Configure geo-replication for Azure SQL Database](sql-database-geo-replication-transact-sql.md).</span></span>

<span data-ttu-id="4a1e4-106">tooinitiate failover, você precisa seguir hello:</span><span class="sxs-lookup"><span data-stu-id="4a1e4-106">tooinitiate failover, you need hello following:</span></span>

* <span data-ttu-id="4a1e4-107">Um logon que seja DBManager em Olá primário</span><span class="sxs-lookup"><span data-stu-id="4a1e4-107">A login that is DBManager on hello primary</span></span>
* <span data-ttu-id="4a1e4-108">Ter db_ownership do banco de dados local Olá que você irá replicar geograficamente</span><span class="sxs-lookup"><span data-stu-id="4a1e4-108">Have db_ownership of hello local database that you will geo-replicate</span></span>
* <span data-ttu-id="4a1e4-109">Ser DBManager em toowhich de servidores de parceiro Olá você irá configurar a replicação geográfica</span><span class="sxs-lookup"><span data-stu-id="4a1e4-109">Be DBManager on hello partner server(s) toowhich you will configure geo-replication</span></span>
* <span data-ttu-id="4a1e4-110">A versão mais recente do SQL Server Management Studio (SSMS)</span><span class="sxs-lookup"><span data-stu-id="4a1e4-110">Newest version of SQL Server Management Studio (SSMS)</span></span>

> [!IMPORTANT]
> <span data-ttu-id="4a1e4-111">É recomendável que você sempre use Olá versão mais recente do Management Studio tooremain sincronizado com atualizações tooMicrosoft Azure e banco de dados SQL.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-111">It is recommended that you always use hello latest version of Management Studio tooremain synchronized with updates tooMicrosoft Azure and SQL Database.</span></span> <span data-ttu-id="4a1e4-112">[Atualizar o SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).</span><span class="sxs-lookup"><span data-stu-id="4a1e4-112">[Update SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).</span></span>
>  

## <a name="initiate-a-planned-failover-promoting-a-secondary-database-toobecome-hello-new-primary"></a><span data-ttu-id="4a1e4-113">Inicie um failover planejado, promovendo um banco de dados secundário toobecome Olá novo primário</span><span class="sxs-lookup"><span data-stu-id="4a1e4-113">Initiate a planned failover promoting a secondary database toobecome hello new primary</span></span>
<span data-ttu-id="4a1e4-114">Você pode usar o hello **ALTER DATABASE** instrução toopromote um banco de dados secundário toobecome Olá novo primário do banco de dados de modo planejado, rebaixar toobecome primária existente de saudação um secundário.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-114">You can use hello **ALTER DATABASE** statement toopromote a secondary database toobecome hello new primary database in a planned fashion, demoting hello existing primary toobecome a secondary.</span></span> <span data-ttu-id="4a1e4-115">Essa instrução é executada no banco de dados mestre no servidor lógico do banco de dados do Azure SQL Olá no qual Olá replicado geograficamente banco de dados secundário que está sendo promovido reside hello.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-115">This statement is executed on hello master database on hello Azure SQL Database logical server in which hello geo-replicated secondary database that is being promoted resides.</span></span> <span data-ttu-id="4a1e4-116">Essa funcionalidade foi projetada para o failover planejado, como durante detalhada Olá DR e requer o que banco de dados primário Olá estar disponível.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-116">This functionality is designed for planned failover, such as during hello DR drills, and requires that hello primary database be available.</span></span>

<span data-ttu-id="4a1e4-117">saudação de comando executa Olá fluxo de trabalho a seguir:</span><span class="sxs-lookup"><span data-stu-id="4a1e4-117">hello command performs hello following workflow:</span></span>

1. <span data-ttu-id="4a1e4-118">Temporariamente o modo de toosynchronous replicação comutadores, fazendo com que todos os toobe de transações pendentes liberado toohello secundário e o bloqueio de todas as novas transações;</span><span class="sxs-lookup"><span data-stu-id="4a1e4-118">Temporarily switches replication toosynchronous mode, causing all outstanding transactions toobe flushed toohello secondary and blocking all new transactions;</span></span>
2. <span data-ttu-id="4a1e4-119">Comutadores Olá funções de dois bancos de dados de saudação na parceria de replicação geográfica hello.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-119">Switches hello roles of hello two databases in hello geo-replication partnership.</span></span>  

<span data-ttu-id="4a1e4-120">Esta sequência garante que Olá dois bancos de dados são sincronizados antes de alternar funções hello e, portanto, nenhuma perda de dados.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-120">This sequence guarantees that hello two databases are synchronized before hello roles switch and therefore no data loss will occur.</span></span> <span data-ttu-id="4a1e4-121">Há um curto período durante o qual ambos os bancos de dados não estão disponíveis (em ordem de saudação de 0 segundos too25) enquanto a troca de funções hello.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-121">There is a short period during which both databases are unavailable (on hello order of 0 too25 seconds) while hello roles are switched.</span></span> <span data-ttu-id="4a1e4-122">Se o banco de dados primário Olá tem vários bancos de dados secundários, o comando hello serão automaticamente reconfigure Olá novo primário outros secundários tooconnect toohello.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-122">If hello primary database has multiple secondary databases, hello command will automatically reconfigure hello other secondaries tooconnect toohello new primary.</span></span>  <span data-ttu-id="4a1e4-123">saudação de toda a operação deve levar menos de um minuto toocomplete em circunstâncias normais.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-123">hello entire operation should take less than a minute toocomplete under normal circumstances.</span></span> <span data-ttu-id="4a1e4-124">Para saber mais, confira [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) e [Camadas de Serviço](sql-database-service-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="4a1e4-124">For more information, see [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) and [Service Tiers](sql-database-service-tiers.md).</span></span>

<span data-ttu-id="4a1e4-125">Use Olá seguindo as etapas tooinitiate um failover planejado.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-125">Use hello following steps tooinitiate a planned failover.</span></span>

1. <span data-ttu-id="4a1e4-126">No Management Studio, conecte o servidor lógico do banco de dados do Azure SQL toohello replicado geograficamente banco de dados secundário reside.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-126">In Management Studio, connect toohello Azure SQL Database logical server in which a geo-replicated secondary database resides.</span></span>
2. <span data-ttu-id="4a1e4-127">Abra a pasta de bancos de dados hello, expanda Olá **bancos de dados do sistema** com o botão direito na pasta **mestre**e, em seguida, clique em **nova consulta**.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-127">Open hello Databases folder, expand hello **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="4a1e4-128">Use os seguintes Olá **ALTER DATABASE** função primária do toohello de banco de dados secundário de saudação do instrução tooswitch.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-128">Use hello following **ALTER DATABASE** statement tooswitch hello secondary database toohello primary role.</span></span>
   
        ALTER DATABASE <MyDB> FAILOVER;
4. <span data-ttu-id="4a1e4-129">Clique em **Execute** toorun consulta de saudação.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-129">Click **Execute** toorun hello query.</span></span>

> [!NOTE]
> <span data-ttu-id="4a1e4-130">Em casos raros, é possível que a operação de saudação não pode ser concluída e pode aparecer presa.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-130">In rare cases, it is possible that hello operation cannot complete and may appear stuck.</span></span> <span data-ttu-id="4a1e4-131">Nesse caso, usuário Olá pode executar o comando para forçar o failover hello e aceitar a perda de dados.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-131">In this case, hello user can execute hello force failover command and accept data loss.</span></span>
> 
> 

## <a name="initiate-an-unplanned-failover-from-hello-primary-database-toohello-secondary-database"></a><span data-ttu-id="4a1e4-132">Iniciar um failover não planejado do hello banco de dados primário toohello banco de dados secundário</span><span class="sxs-lookup"><span data-stu-id="4a1e4-132">Initiate an unplanned failover from hello primary database toohello secondary database</span></span>
<span data-ttu-id="4a1e4-133">Você pode usar o hello **ALTER DATABASE** instrução toopromote um banco de dados secundário toobecome Olá novo primário do banco de dados de forma não planejada, forçar o rebaixamento de saudação do toobecome primária existente de saudação um secundário em um momento quando Olá banco de dados primário não está mais disponível.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-133">You can use hello **ALTER DATABASE** statement toopromote a secondary database toobecome hello new primary database in an unplanned fashion, forcing hello demotion of hello existing primary toobecome a secondary at a time when hello primary database is no longer available.</span></span> <span data-ttu-id="4a1e4-134">Essa instrução é executada no banco de dados mestre no servidor lógico do banco de dados do Azure SQL Olá no qual Olá replicado geograficamente banco de dados secundário que está sendo promovido reside hello.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-134">This statement is executed on hello master database on hello Azure SQL Database logical server in which hello geo-replicated secondary database that is being promoted resides.</span></span>

<span data-ttu-id="4a1e4-135">Essa funcionalidade destina-se a recuperação de desastres quando restaurando a disponibilidade do banco de dados de saudação é crítica e perda de dados é aceitável.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-135">This functionality is designed for disaster recovery when restoring availability of hello database is critical and some data loss is acceptable.</span></span> <span data-ttu-id="4a1e4-136">Quando o failover forçado é invocado, Olá especificado banco de dados secundário se torna o banco de dados primário Olá imediatamente e começa a aceitar transações de gravação.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-136">When forced failover is invoked, hello specified secondary database immediately becomes hello primary database and begins accepting write transactions.</span></span> <span data-ttu-id="4a1e4-137">Como Olá principal banco de dados original é capaz de tooreconnect com esse novo banco de dados primário, um backup incremental é tomado em Olá principal banco de dados original e Olá principal banco de dados antigo é feito em um banco de dados secundário Olá novo banco de dados primário; em seguida, é simplesmente uma réplica de sincronização do novo primário de saudação.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-137">As soon as hello original primary database is able tooreconnect with this new primary database, an incremental backup is taken on hello original primary database and hello old primary database is made into a secondary database for hello new primary database; subsequently, it is merely a synchronizing replica of hello new primary.</span></span>

<span data-ttu-id="4a1e4-138">No entanto, porque a restauração pontual não tem suporte em bancos de dados secundários hello, se o usuário Olá deseja toorecover dados confirmados toohello antigo banco de dados primário que não tivesse sido toohello novo principal banco de dados replicado antes de ocorrer failover Olá forçado, Olá usuário precisará tooengage suporte toorecover essa perda de dados.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-138">However, because Point In Time Restore is not supported on hello secondary databases, if hello user wishes toorecover data committed toohello old primary database that had not been replicated toohello new primary database before hello forced failover occurred, hello user will need tooengage support toorecover this lost data.</span></span>

<span data-ttu-id="4a1e4-139">Se o banco de dados primário Olá tem vários bancos de dados secundários, o comando hello serão automaticamente reconfigure Olá novo primário outros secundários tooconnect toohello.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-139">If hello primary database has multiple secondary databases, hello command will automatically reconfigure hello other secondaries tooconnect toohello new primary.</span></span>

<span data-ttu-id="4a1e4-140">Use Olá seguindo as etapas tooinitiate um failover não planejado.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-140">Use hello following steps tooinitiate an unplanned failover.</span></span>

1. <span data-ttu-id="4a1e4-141">No Management Studio, conecte o servidor lógico do banco de dados do Azure SQL toohello replicado geograficamente banco de dados secundário reside.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-141">In Management Studio, connect toohello Azure SQL Database logical server in which a geo-replicated secondary database resides.</span></span>
2. <span data-ttu-id="4a1e4-142">Abra a pasta de bancos de dados hello, expanda Olá **bancos de dados do sistema** com o botão direito na pasta **mestre**e, em seguida, clique em **nova consulta**.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-142">Open hello Databases folder, expand hello **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="4a1e4-143">Use os seguintes Olá **ALTER DATABASE** função primária do toohello de banco de dados secundário de saudação do instrução tooswitch.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-143">Use hello following **ALTER DATABASE** statement tooswitch hello secondary database toohello primary role.</span></span>
   
        ALTER DATABASE <MyDB>   FORCE_FAILOVER_ALLOW_DATA_LOSS;
4. <span data-ttu-id="4a1e4-144">Clique em **Execute** toorun consulta de saudação.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-144">Click **Execute** toorun hello query.</span></span>

> [!NOTE]
> <span data-ttu-id="4a1e4-145">Se o comando de saudação é emitido quando o primário e secundário estão online tornará primário antigo Olá Olá novo secundário imediatamente sem a sincronização de dados.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-145">If hello command is issued when both primary and secondary are online hello old primary will become hello new secondary immediately without data synchronization.</span></span> <span data-ttu-id="4a1e4-146">Se for Olá primário transações de confirmação quando o comando Olá é emitido alguma perda de dados podem ocorrer.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-146">If hello primary is committing transactions when hello command is issued some data loss may occur.</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="4a1e4-147">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="4a1e4-147">Next steps</span></span>
* <span data-ttu-id="4a1e4-148">Após o failover, certifique-se de requisitos de autenticação de saudação de seu servidor e banco de dados são definidos no novo primário de saudação.</span><span class="sxs-lookup"><span data-stu-id="4a1e4-148">After failover, ensure hello authentication requirements for your server and database are configured on hello new primary.</span></span> <span data-ttu-id="4a1e4-149">Para obter detalhes, consulte [Segurança do Banco de Dados SQL do Azure após a recuperação de desastre](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="4a1e4-149">For details, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span>
* <span data-ttu-id="4a1e4-150">toolearn recuperação após um desastre usando replicação geográfica ativa, incluindo as etapas de recuperação de pré e pós- e executar uma simulação de recuperação de desastres, consulte [a recuperação de desastres](sql-database-disaster-recovery.md)</span><span class="sxs-lookup"><span data-stu-id="4a1e4-150">toolearn recovering after a disaster using active geo-replication, including pre-recovery and post-recovery steps and performing a disaster recovery drill, see [Disaster Recovery](sql-database-disaster-recovery.md)</span></span>
* <span data-ttu-id="4a1e4-151">Para ver uma postagem de blog de Sasha Nosov sobre a replicação geográfica ativa, confira [Destaque sobre novos recursos de replicação geográfica](https://azure.microsoft.com/blog/spotlight-on-new-capabilities-of-azure-sql-database-geo-replication/)</span><span class="sxs-lookup"><span data-stu-id="4a1e4-151">For a Sasha Nosov blog post about active geo-replication, see [Spotlight on new geo-replication capabilities](https://azure.microsoft.com/blog/spotlight-on-new-capabilities-of-azure-sql-database-geo-replication/)</span></span>
* <span data-ttu-id="4a1e4-152">Para obter informações sobre a criação de nuvem aplicativos toouse replicação geográfica, consulte [criação de aplicativos de nuvem para continuidade de negócios usando a replicação geográfica](sql-database-designing-cloud-solutions-for-disaster-recovery.md)</span><span class="sxs-lookup"><span data-stu-id="4a1e4-152">For information about designing cloud applications toouse active geo-replication, see [Designing cloud applications for business continuity using geo-replication](sql-database-designing-cloud-solutions-for-disaster-recovery.md)</span></span>
* <span data-ttu-id="4a1e4-153">Para obter informações sobre o uso da replicação geográfica ativa com pools elásticos, consulte [Estratégias de recuperação de desastre do pool elástico](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="4a1e4-153">For information about using active geo-replication with elastic pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>
* <span data-ttu-id="4a1e4-154">Para obter uma visão geral sobre a continuidade dos negócios, confira [Visão geral de continuidade dos negócios](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="4a1e4-154">For an overview of business continuity, see [Business Continuity Overview](sql-database-business-continuity.md)</span></span>

