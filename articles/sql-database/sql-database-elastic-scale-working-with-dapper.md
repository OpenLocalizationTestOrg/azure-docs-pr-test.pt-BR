---
title: "biblioteca de cliente de banco de dados Elástico aaaUsing com Dapper | Microsoft Docs"
description: "Usar a biblioteca de cliente de banco de dados elástico com Dapper."
services: sql-database
documentationcenter: 
manager: jhubbard
author: torsteng
ms.assetid: 463d2676-3b19-47c2-83df-f8c50492c9d2
ms.service: sql-database
ms.custom: scale out apps
ms.workload: sql-database
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/27/2016
ms.author: torsteng
ms.openlocfilehash: c22ece2a977265e93850f0ad3f3ca48f0a8733ac
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="using-elastic-database-client-library-with-dapper"></a><span data-ttu-id="78035-103">Usando a biblioteca de cliente do banco de dados elástico com Dapper</span><span class="sxs-lookup"><span data-stu-id="78035-103">Using elastic database client library with Dapper</span></span>
<span data-ttu-id="78035-104">Este documento é para desenvolvedores que dependem de aplicativos toobuild Dapper, mas também quer tooembrace [ferramentas de banco de dados Elástico](sql-database-elastic-scale-introduction.md) toocreate aplicativos que implementam a camada de dados de fragmentação tooscale-out.</span><span class="sxs-lookup"><span data-stu-id="78035-104">This document is for developers that rely on Dapper toobuild applications, but also want tooembrace [elastic database tooling](sql-database-elastic-scale-introduction.md) toocreate applications that implement sharding tooscale-out their data tier.</span></span>  <span data-ttu-id="78035-105">Este documento ilustra as alterações de saudação em aplicativos baseados em Dapper que são necessária toointegrate com ferramentas de banco de dados Elástico.</span><span class="sxs-lookup"><span data-stu-id="78035-105">This document illustrates hello changes in Dapper-based applications that are necessary toointegrate with elastic database tools.</span></span> <span data-ttu-id="78035-106">Nosso foco está na composição de dados dependentes e gerenciamento de fragmento de banco de dados Elástico Olá roteamento com Dapper.</span><span class="sxs-lookup"><span data-stu-id="78035-106">Our focus is on composing hello elastic database shard management and data dependent routing with Dapper.</span></span> 

<span data-ttu-id="78035-107">**Código de exemplo**: [ferramentas de banco de dados elástico para o Banco de Dados SQL do Azure - integração com o Dapper](https://code.msdn.microsoft.com/Elastic-Scale-with-Azure-e19fc77f).</span><span class="sxs-lookup"><span data-stu-id="78035-107">**Sample Code**: [Elastic database tools for Azure SQL Database - Dapper integration](https://code.msdn.microsoft.com/Elastic-Scale-with-Azure-e19fc77f).</span></span>

<span data-ttu-id="78035-108">Integrando **Dapper** e **DapperExtensions** com hello biblioteca de cliente do banco de dados Elástico de banco de dados do SQL Azure é fácil.</span><span class="sxs-lookup"><span data-stu-id="78035-108">Integrating **Dapper** and **DapperExtensions** with hello elastic database client library for Azure SQL Database is easy.</span></span> <span data-ttu-id="78035-109">Os aplicativos podem usar dados dependentes de roteamento alterando criação hello e abertura de novos [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) Olá de toouse objetos [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) chamar de saudação [cliente biblioteca](http://msdn.microsoft.com/library/azure/dn765902.aspx).</span><span class="sxs-lookup"><span data-stu-id="78035-109">Your applications can use data dependent routing by changing hello creation and opening of new [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects toouse hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call from hello [client library](http://msdn.microsoft.com/library/azure/dn765902.aspx).</span></span> <span data-ttu-id="78035-110">Isso limita as alterações no seu tooonly de aplicativo em que novas conexões são criadas e abertos.</span><span class="sxs-lookup"><span data-stu-id="78035-110">This limits changes in your application tooonly where new connections are created and opened.</span></span> 

## <a name="dapper-overview"></a><span data-ttu-id="78035-111">Visão geral do Dapper</span><span class="sxs-lookup"><span data-stu-id="78035-111">Dapper overview</span></span>
<span data-ttu-id="78035-112">**Dapper** é um mapeador relacional de objetos.</span><span class="sxs-lookup"><span data-stu-id="78035-112">**Dapper** is an object-relational mapper.</span></span> <span data-ttu-id="78035-113">Ele mapeia objetos do .NET Framework do aplicativo tooa banco de dados relacional (e vice-versa).</span><span class="sxs-lookup"><span data-stu-id="78035-113">It maps .NET objects from your application tooa relational database (and vice versa).</span></span> <span data-ttu-id="78035-114">a primeira parte Olá Olá códigos de exemplo ilustra como você pode integrar a biblioteca de cliente do banco de dados Elástico Olá com aplicativos baseados em Dapper.</span><span class="sxs-lookup"><span data-stu-id="78035-114">hello first part of hello sample code illustrates how you can integrate hello elastic database client library with Dapper-based applications.</span></span> <span data-ttu-id="78035-115">Olá segunda parte do código de exemplo hello ilustra como toointegrate ao usar Dapper e DapperExtensions.</span><span class="sxs-lookup"><span data-stu-id="78035-115">hello second part of hello sample code illustrates how toointegrate when using both Dapper and DapperExtensions.</span></span>  

<span data-ttu-id="78035-116">funcionalidade de mapeador de saudação em Dapper fornece métodos de extensão em conexões de banco de dados que simplificam enviando instruções T-SQL para execução ou consultar banco de dados de saudação.</span><span class="sxs-lookup"><span data-stu-id="78035-116">hello mapper functionality in Dapper provides extension methods on database connections that simplify submitting T-SQL statements for execution or querying hello database.</span></span> <span data-ttu-id="78035-117">Por exemplo, Dapper torna fácil toomap entre seus objetos .NET e os parâmetros de saudação de instruções SQL para **Execute** chamadas ou resultados de saudação tooconsume de suas consultas SQL em objetos .NET usando **consulta**chamadas de Dapper.</span><span class="sxs-lookup"><span data-stu-id="78035-117">For instance, Dapper makes it easy toomap between your .NET objects and hello parameters of SQL statements for **Execute** calls, or tooconsume hello results of your SQL queries into .NET objects using **Query** calls from Dapper.</span></span> 

<span data-ttu-id="78035-118">Ao usar DapperExtensions, você não precisa mais instruções de SQL tooprovide hello.</span><span class="sxs-lookup"><span data-stu-id="78035-118">When using DapperExtensions, you no longer need tooprovide hello SQL statements.</span></span> <span data-ttu-id="78035-119">Métodos de extensões como **GetList** ou **inserir** pela conexão de banco de dados de saudação criar hello instruções SQL em segundo plano da saudação.</span><span class="sxs-lookup"><span data-stu-id="78035-119">Extensions methods such as **GetList** or **Insert** over hello database connection create hello SQL statements behind hello scenes.</span></span>

<span data-ttu-id="78035-120">Outro benefício de Dapper e também DapperExtensions é controles de aplicativo Olá Olá criação de conexão de banco de dados de saudação.</span><span class="sxs-lookup"><span data-stu-id="78035-120">Another benefit of Dapper and also DapperExtensions is that hello application controls hello creation of hello database connection.</span></span> <span data-ttu-id="78035-121">Isso ajuda a interagir com a biblioteca de cliente do banco de dados Elástico Olá qual agentes com base no mapeamento de saudação do toodatabases shardlets de conexões de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="78035-121">This helps interact with hello elastic database client library which brokers database connections based on hello mapping of shardlets toodatabases.</span></span>

<span data-ttu-id="78035-122">tooget Olá Dapper módulos (assemblies), consulte [Dapper dot net](http://www.nuget.org/packages/Dapper/).</span><span class="sxs-lookup"><span data-stu-id="78035-122">tooget hello Dapper assemblies, see [Dapper dot net](http://www.nuget.org/packages/Dapper/).</span></span> <span data-ttu-id="78035-123">Para as extensões de saudação Dapper, consulte [DapperExtensions](http://www.nuget.org/packages/DapperExtensions).</span><span class="sxs-lookup"><span data-stu-id="78035-123">For hello Dapper extensions, see [DapperExtensions](http://www.nuget.org/packages/DapperExtensions).</span></span>

## <a name="a-quick-look-at-hello-elastic-database-client-library"></a><span data-ttu-id="78035-124">Uma visão geral de biblioteca de cliente do banco de dados Elástico Olá</span><span class="sxs-lookup"><span data-stu-id="78035-124">A quick Look at hello elastic database client library</span></span>
<span data-ttu-id="78035-125">Com a biblioteca de cliente do banco de dados Elástico Olá, você definir partições de dados do aplicativo chamados *shardlets* , mapeá-los toodatabases e identificá-los por *as chaves de fragmentação*.</span><span class="sxs-lookup"><span data-stu-id="78035-125">With hello elastic database client library, you define partitions of your application data called *shardlets* , map them toodatabases, and identify them by *sharding keys*.</span></span> <span data-ttu-id="78035-126">Você pode ter quantos bancos de dados conforme necessário e distribuir seu shardlets entre esses bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="78035-126">You can have as many databases as you need and distribute your shardlets across these databases.</span></span> <span data-ttu-id="78035-127">mapeamento de saudação de bancos de dados de toohello de valores de chave fragmentação é armazenado por um mapa do fragmento fornecido pelas APIs da biblioteca hello.</span><span class="sxs-lookup"><span data-stu-id="78035-127">hello mapping of sharding key values toohello databases is stored by a shard map provided by hello library’s APIs.</span></span> <span data-ttu-id="78035-128">Essa funcionalidade é chamada de **gerenciamento de mapa de fragmentos**.</span><span class="sxs-lookup"><span data-stu-id="78035-128">This capability is called **shard map management**.</span></span> <span data-ttu-id="78035-129">mapa do fragmento Olá também serve como agente de saudação de conexões de banco de dados para solicitações que contêm uma chave de fragmentação.</span><span class="sxs-lookup"><span data-stu-id="78035-129">hello shard map also serves as hello broker of database connections for requests that carry a sharding key.</span></span> <span data-ttu-id="78035-130">Esse recurso é chamado de tooas **roteamento dependente de dados**.</span><span class="sxs-lookup"><span data-stu-id="78035-130">This capability is referred tooas **data dependent routing**.</span></span>

![Mapas de fragmentos e roteamento dependente de dados][1]

<span data-ttu-id="78035-132">Gerenciador do mapa de fragmentos Olá protege os usuários contra modos de exibição inconsistente em dados de shardlet que podem ocorrer quando as operações de gerenciamento de shardlet simultâneas estão ocorrendo nos bancos de dados de saudação.</span><span class="sxs-lookup"><span data-stu-id="78035-132">hello shard map manager protects users from inconsistent views into shardlet data that can occur when concurrent shardlet management operations are happening on hello databases.</span></span> <span data-ttu-id="78035-133">toodo Olá assim, mapas de fragmento broker conexões de banco de dados Olá para um aplicativo compilado com a biblioteca de saudação.</span><span class="sxs-lookup"><span data-stu-id="78035-133">toodo so, hello shard maps broker hello database connections for an application built with hello library.</span></span> <span data-ttu-id="78035-134">Olá shardlet podem afetar as operações de gerenciamento de fragmento, permite que kill do hello fragmento mapa funcionalidade tooautomatically uma conexão de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="78035-134">When shard management operations could impact hello shardlet, this allows hello shard map functionality tooautomatically kill a database connection.</span></span> 

<span data-ttu-id="78035-135">Em vez de usar conexões de toocreate de maneira tradicional de saudação para Dapper, precisamos Olá toouse [OpenConnectionForKey método](http://msdn.microsoft.com/library/azure/dn824099.aspx).</span><span class="sxs-lookup"><span data-stu-id="78035-135">Instead of using hello traditional way toocreate connections for Dapper, we need toouse hello [OpenConnectionForKey method](http://msdn.microsoft.com/library/azure/dn824099.aspx).</span></span> <span data-ttu-id="78035-136">Isso garante que todas as validações de saudação ocorre e conexões são gerenciadas corretamente quando nenhum dado é movido entre fragmentos.</span><span class="sxs-lookup"><span data-stu-id="78035-136">This ensures that all hello validation takes place and connections are managed properly when any data moves between shards.</span></span>

### <a name="requirements-for-dapper-integration"></a><span data-ttu-id="78035-137">Requisitos para a integração do Dapper</span><span class="sxs-lookup"><span data-stu-id="78035-137">Requirements for Dapper integration</span></span>
<span data-ttu-id="78035-138">Ao trabalhar com a biblioteca de cliente do banco de dados Elástico hello e Olá APIs Dapper, queremos Olá tooretain propriedades a seguir:</span><span class="sxs-lookup"><span data-stu-id="78035-138">When working with both hello elastic database client library and hello Dapper APIs, we want tooretain hello following properties:</span></span>

* <span data-ttu-id="78035-139">**Expansão**: deseja tooadd ou remover bancos de dados Olá da camada de dados do aplicativo fragmentados Olá conforme necessário para atender às demandas de capacidade de saudação do aplicativo hello.</span><span class="sxs-lookup"><span data-stu-id="78035-139">**Scaleout**: We want tooadd or remove databases from hello data tier of hello sharded application as necessary for hello capacity demands of hello application.</span></span> 
* <span data-ttu-id="78035-140">**Consistência**: desde que o aplicativo é expandido usando a fragmentação, precisamos de roteamento dependente de dados do tooperform.</span><span class="sxs-lookup"><span data-stu-id="78035-140">**Consistency**: Since our application is scaled out using sharding, we need tooperform data dependent routing.</span></span> <span data-ttu-id="78035-141">Queremos toouse Olá dados dependentes capacidades de roteamento de saudação biblioteca toodo assim.</span><span class="sxs-lookup"><span data-stu-id="78035-141">We want toouse hello Data dependent routing capabilities of hello library toodo so.</span></span> <span data-ttu-id="78035-142">Em particular, queremos que a validação de saudação tooretain e garante a consistência fornecida pelas conexões que são orientadas por meio do Gerenciador do mapa de fragmentos Olá nos resultados de consulta incorreto ou corrupção de tooavoid de ordem.</span><span class="sxs-lookup"><span data-stu-id="78035-142">In particular, we want tooretain hello validation and consistency guarantees provided by connections that are brokered through hello shard map manager in order tooavoid corruption or wrong query results.</span></span> <span data-ttu-id="78035-143">Isso garante que tooa conexões dado shardlet são rejeitadas ou interrompido se (por exemplo) Olá shardlet está sendo movido tooa fragmento diferente usando APIs de divisão/mesclagem.</span><span class="sxs-lookup"><span data-stu-id="78035-143">This ensures that connections tooa given shardlet are rejected or stopped if (for instance) hello shardlet is currently moved tooa different shard using Split/Merge APIs.</span></span>
* <span data-ttu-id="78035-144">**Mapeamento de objeto**: queremos tooretain conveniência de saudação de mapeamentos de saudação fornecidos pelo tootranslate Dapper entre classes no aplicativo hello e hello subjacente estruturas de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="78035-144">**Object Mapping**: We want tooretain hello convenience of hello mappings provided by Dapper tootranslate between classes in hello application and hello underlying database structures.</span></span> 

<span data-ttu-id="78035-145">Olá, seção a seguir fornece orientação para esses requisitos para aplicativos com base em **Dapper** e **DapperExtensions**.</span><span class="sxs-lookup"><span data-stu-id="78035-145">hello following section provides guidance for these requirements for applications based on **Dapper** and **DapperExtensions**.</span></span>

## <a name="technical-guidance"></a><span data-ttu-id="78035-146">Orientações técnicas</span><span class="sxs-lookup"><span data-stu-id="78035-146">Technical Guidance</span></span>
### <a name="data-dependent-routing-with-dapper"></a><span data-ttu-id="78035-147">Roteamento dependente de dados com Dapper</span><span class="sxs-lookup"><span data-stu-id="78035-147">Data dependent routing with Dapper</span></span>
<span data-ttu-id="78035-148">Com Dapper, o aplicativo hello é geralmente, responsável por criar e abrir Olá conexões toohello subjacente do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="78035-148">With Dapper, hello application is typically responsible for creating and opening hello connections toohello underlying database.</span></span> <span data-ttu-id="78035-149">Dado um tipo T pelo aplicativo hello, Dapper retorna resultados da consulta como coleções de .NET do tipo T. Dapper executa o mapeamento de saudação de objetos Olá T-SQL resultado linhas toohello do tipo T. Da mesma forma, Dapper mapeia objetos .NET em valores SQL ou parâmetros para instruções de DML (linguagem) de manipulação de dados.</span><span class="sxs-lookup"><span data-stu-id="78035-149">Given a type T by hello application, Dapper returns query results as .NET collections of type T. Dapper performs hello mapping from hello T-SQL result rows toohello objects of type T. Similarly, Dapper maps .NET objects into SQL values or parameters for data manipulation language (DML) statements.</span></span> <span data-ttu-id="78035-150">Dapper oferece essa funcionalidade por meio de métodos de extensão em Olá regular [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objeto das bibliotecas de cliente de SQL do ADO .NET hello.</span><span class="sxs-lookup"><span data-stu-id="78035-150">Dapper offers this functionality via extension methods on hello regular [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) object from hello ADO .NET SQL Client libraries.</span></span> <span data-ttu-id="78035-151">Olá conexão SQL retornado pelo Olá APIs de dimensionamento Elástico para DDR também são regular [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objetos.</span><span class="sxs-lookup"><span data-stu-id="78035-151">hello SQL connection returned by hello Elastic Scale APIs for DDR are also regular [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects.</span></span> <span data-ttu-id="78035-152">Isso nos permite toodirectly use Dapper extensões sobre o tipo de saudação retornado pela API de DDR da biblioteca de cliente hello, como também é uma conexão de cliente SQL simple.</span><span class="sxs-lookup"><span data-stu-id="78035-152">This allows us toodirectly use Dapper extensions over hello type returned by hello client library’s DDR API, as it is also a simple SQL Client connection.</span></span>

<span data-ttu-id="78035-153">Essas observações tornam toouse simples conexões orientadas pela biblioteca de cliente do banco de dados Elástico Olá para Dapper.</span><span class="sxs-lookup"><span data-stu-id="78035-153">These observations make it straightforward toouse connections brokered by hello elastic database client library for Dapper.</span></span>

<span data-ttu-id="78035-154">Este exemplo de código (de saudação que acompanha o exemplo) ilustra a abordagem de saudação onde chave de fragmentação de saudação é fornecido por Olá aplicativo toohello biblioteca toobroker Olá conexão toohello direita fragmento.</span><span class="sxs-lookup"><span data-stu-id="78035-154">This code example (from hello accompanying sample) illustrates hello approach where hello sharding key is provided by hello application toohello library toobroker hello connection toohello right shard.</span></span>   

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                     key: tenantId1, 
                     connectionString: connStrBldr.ConnectionString, 
                     options: ConnectionOptions.Validate))
    {
        var blog = new Blog { Name = name };
        sqlconn.Execute(@"
                      INSERT INTO
                            Blog (Name)
                            VALUES (@name)", new { name = blog.Name }
                        );
    }

<span data-ttu-id="78035-155">Olá chamada toohello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) API substitui a criação de padrão de saudação e abertura de uma conexão de cliente SQL.</span><span class="sxs-lookup"><span data-stu-id="78035-155">hello call toohello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) API replaces hello default creation and opening of a SQL Client connection.</span></span> <span data-ttu-id="78035-156">Olá [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) chamada utiliza argumentos de saudação que são necessários para encaminhamento dependente de dados:</span><span class="sxs-lookup"><span data-stu-id="78035-156">hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call takes hello arguments that are required for data dependent routing:</span></span> 

* <span data-ttu-id="78035-157">tooaccess de mapa do fragmento Olá Olá interfaces de roteamento dependente de dados</span><span class="sxs-lookup"><span data-stu-id="78035-157">hello shard map tooaccess hello data dependent routing interfaces</span></span>
* <span data-ttu-id="78035-158">Olá fragmentação tooidentify chave Olá shardlet</span><span class="sxs-lookup"><span data-stu-id="78035-158">hello sharding key tooidentify hello shardlet</span></span>
* <span data-ttu-id="78035-159">fragmento de toohello de tooconnect Olá credenciais (nome de usuário e senha)</span><span class="sxs-lookup"><span data-stu-id="78035-159">hello credentials (user name and password) tooconnect toohello shard</span></span>

<span data-ttu-id="78035-160">objeto de mapa do fragmento Olá cria um fragmento de toohello de conexão que contém o shardlet Olá para Olá recebe a chave de fragmentação.</span><span class="sxs-lookup"><span data-stu-id="78035-160">hello shard map object creates a connection toohello shard that holds hello shardlet for hello given sharding key.</span></span> <span data-ttu-id="78035-161">APIs de cliente de banco de dados Elástico Olá também marca Olá conexão tooimplement garante sua consistência.</span><span class="sxs-lookup"><span data-stu-id="78035-161">hello elastic database client APIs also tag hello connection tooimplement its consistency guarantees.</span></span> <span data-ttu-id="78035-162">Desde Olá chamar muito[OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) retorna um objeto de conexão SQL Client regular, Olá chamada subsequente toohello **Execute** método de extensão de maneira Dapper Olá Dapper padrão prática.</span><span class="sxs-lookup"><span data-stu-id="78035-162">Since hello call too[OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) returns a regular SQL Client connection object, hello subsequent call toohello **Execute** extension method from Dapper follows hello standard Dapper practice.</span></span>

<span data-ttu-id="78035-163">Consultas de trabalho muito Olá mesmo maneira - você primeiro abre Olá conexão usando [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) da API do cliente hello.</span><span class="sxs-lookup"><span data-stu-id="78035-163">Queries work very much hello same way - you first open hello connection using [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) from hello client API.</span></span> <span data-ttu-id="78035-164">Em seguida, usar o hello regular extensão Dapper métodos toomap Olá resultados sua consulta SQL em objetos .NET:</span><span class="sxs-lookup"><span data-stu-id="78035-164">Then you use hello regular Dapper extension methods toomap hello results of your SQL query into .NET objects:</span></span>

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId1, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate ))
    {    
           // Display all Blogs for tenant 1
           IEnumerable<Blog> result = sqlconn.Query<Blog>(@"
                                SELECT * 
                                FROM Blog
                                ORDER BY Name");

           Console.WriteLine("All blogs for tenant id {0}:", tenantId1);
           foreach (var item in result)
           {
                Console.WriteLine(item.Name);
            }
    }

<span data-ttu-id="78035-165">Observe que Olá **usando** bloco com escopos de conexão de DDR Olá todas as operações de banco de dados dentro de saudação bloco toohello um fragmento onde tenantId1 é mantida.</span><span class="sxs-lookup"><span data-stu-id="78035-165">Note that hello **using** block with hello DDR connection scopes all database operations within hello block toohello one shard where tenantId1 is kept.</span></span> <span data-ttu-id="78035-166">consulta de saudação somente retorna blogs armazenado no fragmento atual hello, mas não Olá arquivos armazenados em quaisquer outros fragmentos.</span><span class="sxs-lookup"><span data-stu-id="78035-166">hello query only returns blogs stored on hello current shard, but not hello ones stored on any other shards.</span></span> 

## <a name="data-dependent-routing-with-dapper-and-dapperextensions"></a><span data-ttu-id="78035-167">Roteamento dependente de dados com Dapper e DapperExtensions</span><span class="sxs-lookup"><span data-stu-id="78035-167">Data dependent routing with Dapper and DapperExtensions</span></span>
<span data-ttu-id="78035-168">Dapper vem com um ecossistema de extensões adicionais que podem fornecer mais conveniência e a abstração de banco de dados de saudação ao desenvolver aplicativos de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="78035-168">Dapper comes with an ecosystem of additional extensions that can provide further convenience and abstraction from hello database when developing database applications.</span></span> <span data-ttu-id="78035-169">O DapperExtensions é um exemplo.</span><span class="sxs-lookup"><span data-stu-id="78035-169">DapperExtensions is an example.</span></span> 

<span data-ttu-id="78035-170">O uso do DapperExtensions em seu aplicativo não muda como conexões de banco de dados são criadas e gerenciadas.</span><span class="sxs-lookup"><span data-stu-id="78035-170">Using DapperExtensions in your application does not change how database connections are created and managed.</span></span> <span data-ttu-id="78035-171">Ainda é conexões de tooopen de responsabilidade do aplicativo hello e objetos de conexão SQL Client regulares são esperados pelos métodos de extensão de saudação.</span><span class="sxs-lookup"><span data-stu-id="78035-171">It is still hello application’s responsibility tooopen connections, and regular SQL Client connection objects are expected by hello extension methods.</span></span> <span data-ttu-id="78035-172">Podemos contar com hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) conforme descrito acima.</span><span class="sxs-lookup"><span data-stu-id="78035-172">We can rely on hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) as outlined above.</span></span> <span data-ttu-id="78035-173">Como Olá exemplos de código seguintes mostram, Olá única alteração é que não temos mais toowrite instruções de saudação T-SQL:</span><span class="sxs-lookup"><span data-stu-id="78035-173">As hello following code samples show, hello only change is that we do no longer have toowrite hello T-SQL statements:</span></span>

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId2, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate))
    {
           var blog = new Blog { Name = name2 };
           sqlconn.Insert(blog);
    }

<span data-ttu-id="78035-174">E aqui está o exemplo de código Olá para consulta hello:</span><span class="sxs-lookup"><span data-stu-id="78035-174">And here is hello code sample for hello query:</span></span> 

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId2, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate))
    {
           // Display all Blogs for tenant 2
           IEnumerable<Blog> result = sqlconn.GetList<Blog>();
           Console.WriteLine("All blogs for tenant id {0}:", tenantId2);
           foreach (var item in result)
           {
               Console.WriteLine(item.Name);
           }
    }

### <a name="handling-transient-faults"></a><span data-ttu-id="78035-175">Tratamento de falhas transitórias</span><span class="sxs-lookup"><span data-stu-id="78035-175">Handling transient faults</span></span>
<span data-ttu-id="78035-176">Olá Microsoft Patterns & Practices equipe Olá publicado [Transient Fault Handling Application Block](http://msdn.microsoft.com/library/hh680934.aspx) os desenvolvedores de aplicativos toohelp reduzir condições comuns de falha transitória durante a execução na nuvem hello.</span><span class="sxs-lookup"><span data-stu-id="78035-176">hello Microsoft Patterns & Practices team published hello [Transient Fault Handling Application Block](http://msdn.microsoft.com/library/hh680934.aspx) toohelp application developers mitigate common transient fault conditions encountered when running in hello cloud.</span></span> <span data-ttu-id="78035-177">Para obter mais informações, consulte [Perseverance, o segredo de todos os Triumphs: usando Olá Transient Fault Handling Application Block](http://msdn.microsoft.com/library/dn440719.aspx).</span><span class="sxs-lookup"><span data-stu-id="78035-177">For more information, see [Perseverance, Secret of All Triumphs: Using hello Transient Fault Handling Application Block](http://msdn.microsoft.com/library/dn440719.aspx).</span></span>

<span data-ttu-id="78035-178">exemplo de código Hello depende Olá falhas transitórias biblioteca tooprotect contra falhas transitórias.</span><span class="sxs-lookup"><span data-stu-id="78035-178">hello code sample relies on hello transient fault library tooprotect against transient faults.</span></span> 

    SqlDatabaseUtils.SqlRetryPolicy.ExecuteAction(() =>
    {
       using (SqlConnection sqlconn = 
          shardingLayer.ShardMap.OpenConnectionForKey(tenantId2, connStrBldr.ConnectionString, ConnectionOptions.Validate))
          {
              var blog = new Blog { Name = name2 };
              sqlconn.Insert(blog);
          }
    });

<span data-ttu-id="78035-179">**SqlDatabaseUtils.SqlRetryPolicy** Olá código acima é definido como um **SqlDatabaseTransientErrorDetectionStrategy** com uma contagem de repetição de 10 e 5 segundos tempo de espera entre as repetições.</span><span class="sxs-lookup"><span data-stu-id="78035-179">**SqlDatabaseUtils.SqlRetryPolicy** in hello code above is defined as a **SqlDatabaseTransientErrorDetectionStrategy** with a retry count of 10, and 5 seconds wait time between retries.</span></span> <span data-ttu-id="78035-180">Se você estiver usando transações, certifique-se de que o escopo de repetição vai voltar toohello início da transação Olá no caso de saudação de uma falha temporária.</span><span class="sxs-lookup"><span data-stu-id="78035-180">If you are using transactions, make sure that your retry scope goes back toohello beginning of hello transaction in hello case of a transient fault.</span></span>

## <a name="limitations"></a><span data-ttu-id="78035-181">Limitações</span><span class="sxs-lookup"><span data-stu-id="78035-181">Limitations</span></span>
<span data-ttu-id="78035-182">abordagens de saudação descritas neste documento envolvem algumas limitações:</span><span class="sxs-lookup"><span data-stu-id="78035-182">hello approaches outlined in this document entail a couple of limitations:</span></span>

* <span data-ttu-id="78035-183">código de exemplo Hello para este documento demonstra como esquema toomanage em fragmentos.</span><span class="sxs-lookup"><span data-stu-id="78035-183">hello sample code for this document does not demonstrate how toomanage schema across shards.</span></span>
* <span data-ttu-id="78035-184">Recebe uma solicitação, vamos supor que todo o processamento de seu banco de dados está contido em um único fragmento conforme identificado pela chave de fragmentação Olá fornecida por solicitação hello.</span><span class="sxs-lookup"><span data-stu-id="78035-184">Given a request, we assume that all its database processing is contained within a single shard as identified by hello sharding key provided by hello request.</span></span> <span data-ttu-id="78035-185">No entanto, essa suposição sempre mantém, por exemplo, quando não é possível toomake uma chave de fragmentação disponível.</span><span class="sxs-lookup"><span data-stu-id="78035-185">However, this assumption does not always hold, for example, when it is not possible toomake a sharding key available.</span></span> <span data-ttu-id="78035-186">tooaddress, Olá biblioteca de cliente do banco de dados Elástico inclui Olá [MultiShardQuery classe](http://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardexception.aspx).</span><span class="sxs-lookup"><span data-stu-id="78035-186">tooaddress this, hello elastic database client library includes hello [MultiShardQuery class](http://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardexception.aspx).</span></span> <span data-ttu-id="78035-187">classe Olá implementa uma abstração de conexão para consultas em vários fragmentos.</span><span class="sxs-lookup"><span data-stu-id="78035-187">hello class implements a connection abstraction for querying over several shards.</span></span> <span data-ttu-id="78035-188">Usar MultiShardQuery em combinação com Dapper está além do escopo deste documento hello.</span><span class="sxs-lookup"><span data-stu-id="78035-188">Using MultiShardQuery in combination with Dapper is beyond hello scope of this document.</span></span>

## <a name="conclusion"></a><span data-ttu-id="78035-189">Conclusão</span><span class="sxs-lookup"><span data-stu-id="78035-189">Conclusion</span></span>
<span data-ttu-id="78035-190">Aplicativos que usam Dapper e DapperExtensions podem aproveitar facilmente as ferramentas de banco de dados elástico para o Banco de Dados SQL do Azure.</span><span class="sxs-lookup"><span data-stu-id="78035-190">Applications using Dapper and DapperExtensions can easily benefit from elastic database tools for Azure SQL Database.</span></span> <span data-ttu-id="78035-191">Por meio de Olá as etapas descritas neste documento, esses aplicativos podem usar recurso da ferramenta Olá para dados dependentes de roteamento alterando criação hello e abertura de novos [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) Olá de toouse objetos [ OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) chamada da biblioteca de cliente do banco de dados Elástico hello.</span><span class="sxs-lookup"><span data-stu-id="78035-191">Through hello steps outlined in this document, those applications can use hello tool's capability for data dependent routing by changing hello creation and opening of new [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects toouse hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call of hello elastic database client library.</span></span> <span data-ttu-id="78035-192">Isso limita Olá aplicativo alterações toothose necessário locais onde novas conexões são criadas e abertos.</span><span class="sxs-lookup"><span data-stu-id="78035-192">This limits hello application changes required toothose places where new connections are created and opened.</span></span> 

[!INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]

<!--Image references-->
[1]: ./media/sql-database-elastic-scale-working-with-dapper/dapperimage1.png
