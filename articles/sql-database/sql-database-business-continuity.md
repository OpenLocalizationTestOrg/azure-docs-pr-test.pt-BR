---
title: "Continuidade dos negócios em nuvem - recuperação de banco de dados - Banco de Dados SQL | Microsoft Docs"
description: "Saiba como o Banco de Dados SQL do Azure dá suporte para a continuidade dos negócios em nuvem e para a recuperação de banco de dados, além de ajudar a manter os aplicativos em nuvem críticos em execução."
keywords: "continuidade dos negócios, continuidade dos negócios em nuvem, recuperação de desastre do banco de dados, recuperação de banco de dados"
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: 
ms.assetid: 18e5d3f1-bfe5-4089-b6fd-76988ab29822
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 05/15/2017
ms.author: sashan
ms.openlocfilehash: cc93ee34a37a4a8688fa2eca338126c13b9940c0
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/29/2017
---
# <a name="overview-of-business-continuity-with-azure-sql-database"></a><span data-ttu-id="86ee6-104">Visão geral da continuidade dos negócios com o Banco de Dados SQL do Azure</span><span class="sxs-lookup"><span data-stu-id="86ee6-104">Overview of business continuity with Azure SQL Database</span></span>

<span data-ttu-id="86ee6-105">Esta visão geral descreve os recursos que o Banco de Dados SQL do Azure fornece para a continuidade dos negócios e a recuperação de desastre.</span><span class="sxs-lookup"><span data-stu-id="86ee6-105">This overview describes the capabilities that Azure SQL Database provides for business continuity and disaster recovery.</span></span> <span data-ttu-id="86ee6-106">Saiba mais sobre as opções, recomendações e tutoriais para recuperação de eventos com interrupção que poderiam causar a perda dos dados ou fazer com que o banco de dados e o aplicativo se tornassem indisponíveis.</span><span class="sxs-lookup"><span data-stu-id="86ee6-106">Learn about options, recommendations, and tutorials for recovering from disruptive events that could cause data loss or cause your database and application to become unavailable.</span></span> <span data-ttu-id="86ee6-107">Aprenda o que fazer quando um erro de usuário ou de aplicativo afeta a integridade dos dados, quando uma região do Azure tem uma interrupção ou quando seu aplicativo necessita de manutenção.</span><span class="sxs-lookup"><span data-stu-id="86ee6-107">Learn what to do when a user or application error affects data integrity, an Azure region has an outage, or your application requires maintenance.</span></span>

## <a name="sql-database-features-that-you-can-use-to-provide-business-continuity"></a><span data-ttu-id="86ee6-108">Recursos do Banco de Dados SQL que você pode usar para proporcionar a continuidade dos negócios</span><span class="sxs-lookup"><span data-stu-id="86ee6-108">SQL Database features that you can use to provide business continuity</span></span>

<span data-ttu-id="86ee6-109">O Banco de Dados SQL fornece vários recursos de continuidade dos negócios, incluindo backups automatizados e replicação opcional do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="86ee6-109">SQL Database provides several business continuity features, including automated backups and optional database replication.</span></span> <span data-ttu-id="86ee6-110">Cada um deles tem características diferentes para o ERT (tempo de recuperação estimado) e para a perda potencial de dados em transações recentes.</span><span class="sxs-lookup"><span data-stu-id="86ee6-110">Each has different characteristics for estimated recovery time (ERT) and potential data loss for recent transactions.</span></span> <span data-ttu-id="86ee6-111">Depois de compreender essas opções, você poderá escolher entre elas e, na maioria dos cenários, usá-las simultaneamente em cenários diferentes.</span><span class="sxs-lookup"><span data-stu-id="86ee6-111">Once you understand these options, you can choose among them - and, in most scenarios, use them together for different scenarios.</span></span> <span data-ttu-id="86ee6-112">À medida que desenvolve seu plano de continuidade de negócios, você precisará compreender o tempo máximo aceitável antes que o aplicativo se recupere totalmente após um evento de interrupção - este é o RTO (objetivo do tempo de recuperação).</span><span class="sxs-lookup"><span data-stu-id="86ee6-112">As you develop your business continuity plan, you need to understand the maximum acceptable time before the application fully recovers after the disruptive event - this is your recovery time objective (RTO).</span></span> <span data-ttu-id="86ee6-113">Você também precisará compreender a quantidade máxima de atualizações de dados recentes (intervalo de tempo) que o aplicativo poderá tolerar perder durante a recuperação após um evento de interrupção - esse é seu RPO (objetivo de ponto de recuperação).</span><span class="sxs-lookup"><span data-stu-id="86ee6-113">You also need to understand the maximum amount of recent data updates (time interval) the application can tolerate losing when recovering after the disruptive event - this is your recovery point objective (RPO).</span></span>

<span data-ttu-id="86ee6-114">A tabela a seguir compara o ERT e RPO para os três cenários mais comuns.</span><span class="sxs-lookup"><span data-stu-id="86ee6-114">The following table compares the ERT and RPO for the three most common scenarios.</span></span>

| <span data-ttu-id="86ee6-115">Recurso</span><span class="sxs-lookup"><span data-stu-id="86ee6-115">Capability</span></span> | <span data-ttu-id="86ee6-116">Camada básica</span><span class="sxs-lookup"><span data-stu-id="86ee6-116">Basic tier</span></span> | <span data-ttu-id="86ee6-117">Camada padrão</span><span class="sxs-lookup"><span data-stu-id="86ee6-117">Standard tier</span></span> | <span data-ttu-id="86ee6-118">Camada premium</span><span class="sxs-lookup"><span data-stu-id="86ee6-118">Premium tier</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="86ee6-119">Recuperação Pontual do backup</span><span class="sxs-lookup"><span data-stu-id="86ee6-119">Point in Time Restore from backup</span></span> |<span data-ttu-id="86ee6-120">Qualquer ponto de restauração dentro de 7 dias</span><span class="sxs-lookup"><span data-stu-id="86ee6-120">Any restore point within 7 days</span></span> |<span data-ttu-id="86ee6-121">Qualquer ponto de restauração dentro de 35 dias</span><span class="sxs-lookup"><span data-stu-id="86ee6-121">Any restore point within 35 days</span></span> |<span data-ttu-id="86ee6-122">Qualquer ponto de restauração dentro de 35 dias</span><span class="sxs-lookup"><span data-stu-id="86ee6-122">Any restore point within 35 days</span></span> |
| <span data-ttu-id="86ee6-123">Restauração geográfica de backups replicados geograficamente</span><span class="sxs-lookup"><span data-stu-id="86ee6-123">Geo-restore from geo-replicated backups</span></span> |<span data-ttu-id="86ee6-124">ERT < 12h, RPO < 1h</span><span class="sxs-lookup"><span data-stu-id="86ee6-124">ERT < 12h, RPO < 1h</span></span> |<span data-ttu-id="86ee6-125">ERT < 12h, RPO < 1h</span><span class="sxs-lookup"><span data-stu-id="86ee6-125">ERT < 12h, RPO < 1h</span></span> |<span data-ttu-id="86ee6-126">ERT < 12h, RPO < 1h</span><span class="sxs-lookup"><span data-stu-id="86ee6-126">ERT < 12h, RPO < 1h</span></span> |
| <span data-ttu-id="86ee6-127">Restaurar Cofre de Backup do Azure</span><span class="sxs-lookup"><span data-stu-id="86ee6-127">Restore from Azure Backup Vault</span></span> |<span data-ttu-id="86ee6-128">ERT < 12h, RPO < 1 semana</span><span class="sxs-lookup"><span data-stu-id="86ee6-128">ERT < 12h, RPO < 1 wk</span></span> |<span data-ttu-id="86ee6-129">ERT < 12h, RPO < 1 semana</span><span class="sxs-lookup"><span data-stu-id="86ee6-129">ERT < 12h, RPO < 1 wk</span></span> |<span data-ttu-id="86ee6-130">ERT < 12h, RPO < 1 semana</span><span class="sxs-lookup"><span data-stu-id="86ee6-130">ERT < 12h, RPO < 1 wk</span></span> |
| <span data-ttu-id="86ee6-131">Replicação geográfica ativa</span><span class="sxs-lookup"><span data-stu-id="86ee6-131">Active geo-replication</span></span> |<span data-ttu-id="86ee6-132">ERT < 30s, RPO < 5s</span><span class="sxs-lookup"><span data-stu-id="86ee6-132">ERT < 30s, RPO < 5s</span></span> |<span data-ttu-id="86ee6-133">ERT < 30s, RPO < 5s</span><span class="sxs-lookup"><span data-stu-id="86ee6-133">ERT < 30s, RPO < 5s</span></span> |<span data-ttu-id="86ee6-134">ERT < 30s, RPO < 5s</span><span class="sxs-lookup"><span data-stu-id="86ee6-134">ERT < 30s, RPO < 5s</span></span> |

### <a name="use-database-backups-to-recover-a-database"></a><span data-ttu-id="86ee6-135">Usar backups de banco de dados para recuperar um banco de dados</span><span class="sxs-lookup"><span data-stu-id="86ee6-135">Use database backups to recover a database</span></span>

<span data-ttu-id="86ee6-136">O Banco de Dados SQL executa automaticamente uma combinação de backups de banco de dados semanais, backups de bancos de dados diferenciais por hora e backups de logs de transação a cada cinco a dez minutos para proteger sua empresa contra a perda de dados.</span><span class="sxs-lookup"><span data-stu-id="86ee6-136">SQL Database automatically performs a combination of full database backups weekly, differential database backups hourly, and transaction log backups every five - ten minutes to protect your business from data loss.</span></span> <span data-ttu-id="86ee6-137">Esses backups são armazenados no armazenamento com redundância geográfica por 35 dias, no caso dos bancos de dados das camadas de serviço Standard e Premium, e por sete dias no caso dos bancos de dados da camada de serviço Básica.</span><span class="sxs-lookup"><span data-stu-id="86ee6-137">These backups are stored in geo-redundant storage for 35 days for databases in the Standard and Premium service tiers and 7 days for databases in the Basic service tier.</span></span> <span data-ttu-id="86ee6-138">Para saber mais, consulte [Camadas de serviço](sql-database-service-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="86ee6-138">For more information, see [service tiers](sql-database-service-tiers.md).</span></span> <span data-ttu-id="86ee6-139">Se o período de retenção para a camada de serviço não atender seus requisitos de negócios, você poderá aumentar o período de retenção ao [alterar a camada de serviço](sql-database-service-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="86ee6-139">If the retention period for your service tier does not meet your business requirements, you can increase the retention period by [changing the service tier](sql-database-service-tiers.md).</span></span> <span data-ttu-id="86ee6-140">Os backups de banco de dados completos e diferenciais também são replicados para um [data center emparelhado](../best-practices-availability-paired-regions.md) para proteção contra uma interrupção do data center.</span><span class="sxs-lookup"><span data-stu-id="86ee6-140">The full and differential database backups are also replicated to a [paired data center](../best-practices-availability-paired-regions.md) for protection against a data center outage.</span></span> <span data-ttu-id="86ee6-141">Para saber mais, consulte [backups de banco de dados automáticos](sql-database-automated-backups.md).</span><span class="sxs-lookup"><span data-stu-id="86ee6-141">For more information, see [automatic database backups](sql-database-automated-backups.md).</span></span>

<span data-ttu-id="86ee6-142">Se o período de retenção interno não for suficiente para seu aplicativo, você pode estendê-lo configurando a política de retenção de longo prazo de bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="86ee6-142">If the built-in retention period is not sufficient for your application, you can extend it by configuring a database long-term retention policy.</span></span> <span data-ttu-id="86ee6-143">Para saber mais, confira [Retenção de longo prazo](sql-database-long-term-retention.md).</span><span class="sxs-lookup"><span data-stu-id="86ee6-143">For more information, see [long-term retention](sql-database-long-term-retention.md).</span></span>

<span data-ttu-id="86ee6-144">Você pode usar esses backups automáticos do banco de dados para recuperar um banco de dados de diversos eventos de interrupção, tanto em seu data center quanto em outro.</span><span class="sxs-lookup"><span data-stu-id="86ee6-144">You can use these automatic database backups to recover a database from various disruptive events, both within your data center and to another data center.</span></span> <span data-ttu-id="86ee6-145">Ao usar os backups automáticos de banco de dados, o tempo estimado de recuperação dependerá de vários fatores, incluindo o número total de bancos de dados de recuperação na mesma região e ao mesmo tempo, o tamanho do banco de dados, o tamanho do log de transações e a largura de banda da rede.</span><span class="sxs-lookup"><span data-stu-id="86ee6-145">Using automatic database backups, the estimated time of recovery depends on several factors including the total number of databases recovering in the same region at the same time, the database size, the transaction log size, and network bandwidth.</span></span> <span data-ttu-id="86ee6-146">Normalmente, o tempo de recuperação é menor do que 12 horas.</span><span class="sxs-lookup"><span data-stu-id="86ee6-146">The recovery time is usually less than 12 hours.</span></span> <span data-ttu-id="86ee6-147">Ao recuperar em outra região de dados, a perda de dados potencial será limitada a uma hora pelo armazenamento com redundância geográfica dos backups de banco de dados diferenciais por hora.</span><span class="sxs-lookup"><span data-stu-id="86ee6-147">When recovering to another data region, the potential data loss is limited to 1 hour by the geo-redundant storage of hourly differential database backups.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="86ee6-148">Para recuperar usando os backups automáticos, você deverá ser um membro da função Colaborador do SQL Server ou o proprietário da assinatura, consulte [RBAC: funções internas](../active-directory/role-based-access-built-in-roles.md).</span><span class="sxs-lookup"><span data-stu-id="86ee6-148">To recover using automated backups, you must be a member of the SQL Server Contributor role or the subscription owner - see [RBAC: Built-in roles](../active-directory/role-based-access-built-in-roles.md).</span></span> <span data-ttu-id="86ee6-149">Você pode recuperar usando o Portal do Azure, o PowerShell ou a API REST.</span><span class="sxs-lookup"><span data-stu-id="86ee6-149">You can recover using the Azure portal, PowerShell, or the REST API.</span></span> <span data-ttu-id="86ee6-150">Você não pode usar o Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="86ee6-150">You cannot use Transact-SQL.</span></span>
>

<span data-ttu-id="86ee6-151">Use os backups automatizados como o mecanismo de continuidade e recuperação dos negócios se seu aplicativo:</span><span class="sxs-lookup"><span data-stu-id="86ee6-151">Use automated backups as your business continuity and recovery mechanism if your application:</span></span>

* <span data-ttu-id="86ee6-152">Não for considerado crítico.</span><span class="sxs-lookup"><span data-stu-id="86ee6-152">Is not considered mission critical.</span></span>
* <span data-ttu-id="86ee6-153">Não tem um SLA associado - um tempo de inatividade de 24 horas ou mais não resulta em responsabilidade financeira.</span><span class="sxs-lookup"><span data-stu-id="86ee6-153">Doesn't have a binding SLA - a downtime of 24 hours or longer does not result in financial liability.</span></span>
* <span data-ttu-id="86ee6-154">Tiver uma taxa baixa de alteração de dados (poucas transações por hora), uma vez que perder até uma hora de alterações é uma perda de dados aceitável.</span><span class="sxs-lookup"><span data-stu-id="86ee6-154">Has a low rate of data change (low transactions per hour) and losing up to an hour of change is an acceptable data loss.</span></span>
* <span data-ttu-id="86ee6-155">Seja suscetível aos custos.</span><span class="sxs-lookup"><span data-stu-id="86ee6-155">Is cost sensitive.</span></span>

<span data-ttu-id="86ee6-156">Se você precisar de uma recuperação mais rápida, use a [replicação geográfica ativa](sql-database-geo-replication-overview.md) (discutida a seguir).</span><span class="sxs-lookup"><span data-stu-id="86ee6-156">If you need faster recovery, use [active geo-replication](sql-database-geo-replication-overview.md) (discussed next).</span></span> <span data-ttu-id="86ee6-157">Se você precisar recuperar dados de um período superior a 35 dias, use a [retenção de backup de longo prazo](sql-database-long-term-retention.md).</span><span class="sxs-lookup"><span data-stu-id="86ee6-157">If you need to be able to recover data from a period older than 35 days, use [long-term backup retention](sql-database-long-term-retention.md).</span></span> 

### <a name="use-active-geo-replication-and-auto-failover-groups-in-preview-to-reduce-recovery-time-and-limit-data-loss-associated-with-a-recovery"></a><span data-ttu-id="86ee6-158">Usar a replicação geográfica ativa e os grupos de failover automático (em versão prévia) para reduzir o tempo de recuperação e limitar a perda de dados associada a uma recuperação</span><span class="sxs-lookup"><span data-stu-id="86ee6-158">Use active geo-replication and auto-failover groups (in-preview) to reduce recovery time and limit data loss associated with a recovery</span></span>

<span data-ttu-id="86ee6-159">Além de usar os backups de banco de dados para a recuperação de banco de dados no caso de uma interrupção de negócios, você poderá usar a [replicação geográfica ativa](sql-database-geo-replication-overview.md) para configurar um banco de dados para ter até quatro bancos de dados secundários legíveis em regiões de sua escolha.</span><span class="sxs-lookup"><span data-stu-id="86ee6-159">In addition to using database backups for database recovery if a business disruption occurs, you can use [active geo-replication](sql-database-geo-replication-overview.md) to configure a database to have up to four readable secondary databases in the regions of your choice.</span></span> <span data-ttu-id="86ee6-160">Esses bancos de dados secundários são mantidos sincronizados com o banco de dados primário usando um mecanismo de replicação assíncrona.</span><span class="sxs-lookup"><span data-stu-id="86ee6-160">These secondary databases are kept synchronized with the primary database using an asynchronous replication mechanism.</span></span> <span data-ttu-id="86ee6-161">Esse recurso é usado para proteger contra interrupções de negócios, no caso de uma interrupção do data center, ou durante uma atualização de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="86ee6-161">This feature is used to protect against business disruption if a data center outage occurs or during an application upgrade.</span></span> <span data-ttu-id="86ee6-162">A replicação geográfica ativa pode ser usada para fornecer melhor desempenho em consultas do tipo somente leitura para usuários geograficamente dispersos.</span><span class="sxs-lookup"><span data-stu-id="86ee6-162">Active geo-replication can also be used to provide better query performance for read-only queries to geographically dispersed users.</span></span>

<span data-ttu-id="86ee6-163">Para habilitar o failover transparente e automatizado, você deve organizar seus bancos de dados replicados geograficamente em grupos, usando o recurso [grupo de failover automático](sql-database-geo-replication-overview.md) do Banco de Dados SQL (em versão prévia).</span><span class="sxs-lookup"><span data-stu-id="86ee6-163">To enable automated and transparent failover you should organize your geo-replicated databases into groups using the [auto-failover group](sql-database-geo-replication-overview.md) feature of SQL Database (in-preview).</span></span>

<span data-ttu-id="86ee6-164">Se o banco de dados primário ficar offline inesperadamente ou se precisar colocá-lo offline para atividades de manutenção, você poderá promover rapidamente um secundário para se tornar o primário (também chamado de failover) e configurar os aplicativos para se conectarem ao primário promovido.</span><span class="sxs-lookup"><span data-stu-id="86ee6-164">If the primary database goes offline unexpectedly or you need to take it offline for maintenance activities, you can quickly promote a secondary to become the primary (also called a failover) and configure applications to connect to the promoted primary.</span></span> <span data-ttu-id="86ee6-165">Se seu aplicativo estiver se conectando aos bancos de dados usando o ouvinte de grupo de failover, você não precisará alterar a configuração de cadeia de conexão do SQL após o failover.</span><span class="sxs-lookup"><span data-stu-id="86ee6-165">If your application is connecting to the databases using the failover group listener, you don’t need to change the SQL connection string configuration after failover.</span></span> <span data-ttu-id="86ee6-166">Com um failover planejado, não há nenhuma perda de dados.</span><span class="sxs-lookup"><span data-stu-id="86ee6-166">With a planned failover, there is no data loss.</span></span> <span data-ttu-id="86ee6-167">Com um failover não planejado, há uma pequena perda de dados em transações muito recentes devido à natureza da replicação assíncrona.</span><span class="sxs-lookup"><span data-stu-id="86ee6-167">With an unplanned failover, there may be some small amount of data loss for very recent transactions due to the nature of asynchronous replication.</span></span> <span data-ttu-id="86ee6-168">Usando grupos de failover automático (em versão prévia), você pode personalizar a política de failover para minimizar a possível perda de dados.</span><span class="sxs-lookup"><span data-stu-id="86ee6-168">Using auto-failover groups (in-preview), you can customize the failover policy to minimize the potential data loss.</span></span> <span data-ttu-id="86ee6-169">Depois de um failover, você poderá fazer o failback posteriormente, ou de acordo com um plano ou quando o data center voltar a ficar online.</span><span class="sxs-lookup"><span data-stu-id="86ee6-169">After a failover, you can later failback - either according to a plan or when the data center comes back online.</span></span> <span data-ttu-id="86ee6-170">Em todos os casos, os usuários enfrentam um breve tempo de inatividade e precisarão ser reconectados.</span><span class="sxs-lookup"><span data-stu-id="86ee6-170">In all cases, users experience a small amount of downtime and need to reconnect.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="86ee6-171">Para usar a replicação geográfica ativa e grupos de failover automático (em versão prévia), você deverá ser o proprietário da assinatura ou ter permissões administrativas no SQL Server.</span><span class="sxs-lookup"><span data-stu-id="86ee6-171">To use active geo-replication and auto-failover groups (in-preview), you must either be the subscription owner or have administrative permissions in SQL Server.</span></span> <span data-ttu-id="86ee6-172">Você pode configurar e fazer failover usando o Portal do Azure, o PowerShell ou a API REST utilizando permissões da assinatura do Azure, ou utilizando o Transact-SQL com permissões no SQL Server.</span><span class="sxs-lookup"><span data-stu-id="86ee6-172">You can configure and fail over using the Azure portal, PowerShell, or the REST API using Azure subscription permissions or using Transact-SQL with SQL Server permissions.</span></span>
> 

<span data-ttu-id="86ee6-173">Use a replicação geográfica ativa e os grupos de failover automático (em versão prévia), caso seu aplicativo atenda a qualquer um desses critérios:</span><span class="sxs-lookup"><span data-stu-id="86ee6-173">Use active geo-replication and auto-failover groups (in preview) if your application meets any of these criteria:</span></span>

* <span data-ttu-id="86ee6-174">Seja crítico.</span><span class="sxs-lookup"><span data-stu-id="86ee6-174">Is mission critical.</span></span>
* <span data-ttu-id="86ee6-175">Tenha um SLA (Contrato de Nível de Serviço) que não permita um tempo de inatividade de 24 horas ou superior.</span><span class="sxs-lookup"><span data-stu-id="86ee6-175">Has a service level agreement (SLA) that does not allow for 24 hours or more of downtime.</span></span>
* <span data-ttu-id="86ee6-176">O tempo de inatividade pode resultar em responsabilidade financeira.</span><span class="sxs-lookup"><span data-stu-id="86ee6-176">Downtime may result in financial liability.</span></span>
* <span data-ttu-id="86ee6-177">Tenha uma alta taxa de alteração de dados e que a perda de uma hora de dados não seja aceitável.</span><span class="sxs-lookup"><span data-stu-id="86ee6-177">Has a high rate of data change is high and losing an hour of data is not acceptable.</span></span>
* <span data-ttu-id="86ee6-178">Que o custo adicional da replicação geográfica ativa seja menor que a responsabilidade financeira potencial e das perdas associadas do negócio.</span><span class="sxs-lookup"><span data-stu-id="86ee6-178">The additional cost of active geo-replication is lower than the potential financial liability and associated loss of business.</span></span>

>
> [!VIDEO https://channel9.msdn.com/Blogs/Azure/Azure-SQL-Database-protecting-important-DBs-from-regional-disasters-is-easy/player]
>

## <a name="recover-a-database-after-a-user-or-application-error"></a><span data-ttu-id="86ee6-179">Recuperar um banco de dados após um erro de usuário ou de aplicativo</span><span class="sxs-lookup"><span data-stu-id="86ee6-179">Recover a database after a user or application error</span></span>
<span data-ttu-id="86ee6-180">*Ninguém é perfeito!</span><span class="sxs-lookup"><span data-stu-id="86ee6-180">*No one is perfect!</span></span> <span data-ttu-id="86ee6-181">Um usuário pode acidentalmente excluir alguns dados, remover uma tabela importante inadvertidamente ou até mesmo um banco de dados inteiro.</span><span class="sxs-lookup"><span data-stu-id="86ee6-181">A user might accidentally delete some data, inadvertently drop an important table, or even drop an entire database.</span></span> <span data-ttu-id="86ee6-182">Ou, um aplicativo pode acidentalmente substituir dados corretos por incorretos por causa de um defeito.</span><span class="sxs-lookup"><span data-stu-id="86ee6-182">Or, an application might accidentally overwrite good data with bad data due to an application defect.</span></span>

<span data-ttu-id="86ee6-183">Neste cenário, estas são as opções de recuperação.</span><span class="sxs-lookup"><span data-stu-id="86ee6-183">In this scenario, these are your recovery options.</span></span>

### <a name="perform-a-point-in-time-restore"></a><span data-ttu-id="86ee6-184">Executar uma recuperação pontual</span><span class="sxs-lookup"><span data-stu-id="86ee6-184">Perform a point-in-time restore</span></span>
<span data-ttu-id="86ee6-185">Você pode usar os backups automatizados para recuperar uma cópia do banco de dados para um momento adequado e conhecido, desde que este momento esteja dentro do período de retenção do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="86ee6-185">You can use the automated backups to recover a copy of your database to a known good point in time, provided that time is within the database retention period.</span></span> <span data-ttu-id="86ee6-186">Depois que o banco de dados for restaurado, você poderá substituir o banco de dados original pelo banco de dados restaurado ou copiar os dados necessários dos dados restaurados para o banco de dados original.</span><span class="sxs-lookup"><span data-stu-id="86ee6-186">After the database is restored, you can either replace the original database with the restored database or copy the needed data from the restored data into the original database.</span></span> <span data-ttu-id="86ee6-187">Se o banco de dados usar a replicação geográfica ativa, será recomendável copiar os dados necessários da cópia restaurada para o banco de dados original.</span><span class="sxs-lookup"><span data-stu-id="86ee6-187">If the database uses active geo-replication, we recommend copying the required data from the restored copy into the original database.</span></span> <span data-ttu-id="86ee6-188">Se substituir o banco de dados original pelo banco de dados restaurado, você precisará reconfigurar e ressincronizar a replicação geográfica ativa (o que poderá levar algum tempo em um banco de dados grande).</span><span class="sxs-lookup"><span data-stu-id="86ee6-188">If you replace the original database with the restored database, you need to reconfigure and resynchronize active geo-replication (which can take quite some time for a large database).</span></span>

<span data-ttu-id="86ee6-189">Para obter mais informações e as etapas detalhadas para restaurar um banco de dados para determinado momento usando o Portal do Azure ou o PowerShell, confira [Recuperação pontual](sql-database-recovery-using-backups.md#point-in-time-restore).</span><span class="sxs-lookup"><span data-stu-id="86ee6-189">For more information and for detailed steps for restoring a database to a point in time using the Azure portal or using PowerShell, see [point-in-time restore](sql-database-recovery-using-backups.md#point-in-time-restore).</span></span> <span data-ttu-id="86ee6-190">Você não pode recuperar usando o Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="86ee6-190">You cannot recover using Transact-SQL.</span></span>

### <a name="restore-a-deleted-database"></a><span data-ttu-id="86ee6-191">Restaurar um banco de dados excluído</span><span class="sxs-lookup"><span data-stu-id="86ee6-191">Restore a deleted database</span></span>
<span data-ttu-id="86ee6-192">Se o banco de dados tiver sido excluído, mas o servidor lógico não, você poderá restaurar o banco de dados excluído para o momento da sua exclusão.</span><span class="sxs-lookup"><span data-stu-id="86ee6-192">If the database is deleted but the logical server has not been deleted, you can restore the deleted database to the point at which it was deleted.</span></span> <span data-ttu-id="86ee6-193">Isso restaura um backup do banco de dados para o mesmo SQL Server lógico do qual ele foi excluído.</span><span class="sxs-lookup"><span data-stu-id="86ee6-193">This restores a database backup to the same logical SQL server from which it was deleted.</span></span> <span data-ttu-id="86ee6-194">Você pode restaurá-lo usando o nome original, fornecendo um novo nome ou o banco de dados restaurado.</span><span class="sxs-lookup"><span data-stu-id="86ee6-194">You can restore it using the original name or provide a new name or the restored database.</span></span>

<span data-ttu-id="86ee6-195">Para obter mais informações e as etapas detalhadas para restaurar um banco de dados excluído usando o Portal do Azure ou o PowerShell, confira [Restaurar um banco de dados excluído](sql-database-recovery-using-backups.md#deleted-database-restore).</span><span class="sxs-lookup"><span data-stu-id="86ee6-195">For more information and for detailed steps for restoring a deleted database using the Azure portal or using PowerShell, see [restore a deleted database](sql-database-recovery-using-backups.md#deleted-database-restore).</span></span> <span data-ttu-id="86ee6-196">Você não pode restaurar usando o Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="86ee6-196">You cannot restore using Transact-SQL.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="86ee6-197">Se o servidor lógico for excluído, você não poderá recuperar um banco de dados excluído.</span><span class="sxs-lookup"><span data-stu-id="86ee6-197">If the logical server is deleted, you cannot recover a deleted database.</span></span>
>
>

### <a name="restore-from-azure-backup-vault"></a><span data-ttu-id="86ee6-198">Restaurar Cofre de Backup do Azure</span><span class="sxs-lookup"><span data-stu-id="86ee6-198">Restore from Azure Backup Vault</span></span>
<span data-ttu-id="86ee6-199">Se a perda de dados ocorreu fora do período de retenção atual para backups automatizados e seu banco de dados estiver configurado para retenção de longo prazo, você pode restaurar de um backup semanal no Cofre de Backup do Azure para um novo banco de dados.</span><span class="sxs-lookup"><span data-stu-id="86ee6-199">If the data loss occurred outside the current retention period for automated backups and your database is configured for long-term retention, you can restore from a weekly backup in Azure Backup Vault to a new database.</span></span> <span data-ttu-id="86ee6-200">Nesse ponto, você poderá substituir o banco de dados original pelo banco de dados restaurado ou copiar os dados necessários do banco de dados restaurado para o original.</span><span class="sxs-lookup"><span data-stu-id="86ee6-200">At this point, you can either replace the original database with the restored database or copy the needed data from the restored database into the original database.</span></span> <span data-ttu-id="86ee6-201">Se precisar recuperar uma versão antiga do banco de dados antes de uma grande atualização do aplicativo, atender a uma solicitação de auditores ou a uma sentença judicial, você pode criar um banco de dados usando um backup completo salvo no Cofre de Backup do Azure.</span><span class="sxs-lookup"><span data-stu-id="86ee6-201">If you need to retrieve an old version of your database prior to a major application upgrade, satisfy a request from auditors or a legal order, you can create a database using a full backup saved in the Azure Backup Vault.</span></span>  <span data-ttu-id="86ee6-202">Para obter mais informações, consulte [Retenção de longo prazo](sql-database-long-term-retention.md).</span><span class="sxs-lookup"><span data-stu-id="86ee6-202">For more information, see [Long-term retention](sql-database-long-term-retention.md).</span></span>

## <a name="recover-a-database-to-another-region-from-an-azure-regional-data-center-outage"></a><span data-ttu-id="86ee6-203">Recuperar um banco de dados para outra região de uma interrupção no centro de dados regionais do Azure</span><span class="sxs-lookup"><span data-stu-id="86ee6-203">Recover a database to another region from an Azure regional data center outage</span></span>
<!-- Explain this scenario -->

<span data-ttu-id="86ee6-204">Embora seja raro, um data center do Azure pode ter uma interrupção.</span><span class="sxs-lookup"><span data-stu-id="86ee6-204">Although rare, an Azure data center can have an outage.</span></span> <span data-ttu-id="86ee6-205">Quando uma interrupção ocorre, ela causa uma parada nos negócios, que pode durar alguns minutos ou horas.</span><span class="sxs-lookup"><span data-stu-id="86ee6-205">When an outage occurs, it causes a business disruption that might only last a few minutes or might last for hours.</span></span>

* <span data-ttu-id="86ee6-206">Uma opção é esperar que seu banco de dados volte a ficar online quando a interrupção do data center terminar.</span><span class="sxs-lookup"><span data-stu-id="86ee6-206">One option is to wait for your database to come back online when the data center outage is over.</span></span> <span data-ttu-id="86ee6-207">Isso funciona para aplicativos que podem manter o banco de dados offline.</span><span class="sxs-lookup"><span data-stu-id="86ee6-207">This works for applications that can afford to have the database offline.</span></span> <span data-ttu-id="86ee6-208">Por exemplo, um projeto de desenvolvimento ou uma avaliação gratuita não precisam funcionar constantemente.</span><span class="sxs-lookup"><span data-stu-id="86ee6-208">For example, a development project or free trial you don't need to work on constantly.</span></span> <span data-ttu-id="86ee6-209">Quando um data center tiver uma interrupção, você não saberá quanto tempo ela durará. Portanto, essa opção só funcionará se o banco de dados não for necessário por um tempo.</span><span class="sxs-lookup"><span data-stu-id="86ee6-209">When a data center has an outage, you do not know how long the outage might last, so this option only works if you don't need your database for a while.</span></span>
* <span data-ttu-id="86ee6-210">Outra opção será fazer failover em outra região de dados, se você estiver usando a replicação geográfica ativa, ou recuperar um banco de dados usando os backups de banco de dados com redundância geográfica (restauração geográfica).</span><span class="sxs-lookup"><span data-stu-id="86ee6-210">Another option is to either fail over to another data region if you are using active geo-replication or the recover a database using geo-redundant database backups (geo-restore).</span></span> <span data-ttu-id="86ee6-211">O failover demora apenas alguns segundos, enquanto a recuperação de banco de dados de backups demora horas.</span><span class="sxs-lookup"><span data-stu-id="86ee6-211">Failover takes only a few seconds while database recovery from backups takes hours.</span></span>

<span data-ttu-id="86ee6-212">Ao executar uma ação, o tempo que levará para você recuperar e a quantidade de dados perdidos dependerá de como você decide usar os recursos de continuidade dos negócios em seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="86ee6-212">When you take action, how long it takes you to recover, and how much data loss you incur depends upon how you decide to use these business continuity features in your application.</span></span> <span data-ttu-id="86ee6-213">Na verdade, você poderá escolher por usar uma combinação de backups de banco de dados e a replicação geográfica ativa dependendo dos requisitos do seus aplicativo.</span><span class="sxs-lookup"><span data-stu-id="86ee6-213">Indeed, you may choose to use a combination of database backups and active geo-replication depending upon your application requirements.</span></span> <span data-ttu-id="86ee6-214">Para uma discussão sobre as considerações de design do aplicativo para bancos de dados independentes e pools elásticos que usam esses recursos de continuidade de negócios, consulte [Criar um aplicativo para recuperação de desastre na nuvem](sql-database-designing-cloud-solutions-for-disaster-recovery.md) e [Estratégias de recuperação de desastre para Pool Elástico](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="86ee6-214">For a discussion of application design considerations for stand-alone databases and for elastic pools using these business continuity features, see [Design an application for cloud disaster recovery](sql-database-designing-cloud-solutions-for-disaster-recovery.md) and [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>

<span data-ttu-id="86ee6-215">As seções a seguir fornecem uma visão geral das etapas para recuperar usando os backups de banco de dados ou a replicação geográfica ativa.</span><span class="sxs-lookup"><span data-stu-id="86ee6-215">The following sections provide an overview of the steps to recover using either database backups or active geo-replication.</span></span> <span data-ttu-id="86ee6-216">Para obter as etapas detalhadas, incluindo os requisitos de planejamento, as etapas pós-recuperação e as informações sobre como simular uma interrupção para executar uma análise de recuperação de desastre, confira [Recover a SQL Database from an outage (Recuperar um Banco de Dados SQL de uma interrupção)](sql-database-disaster-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="86ee6-216">For detailed steps including planning requirements, post recovery steps, and information about how to simulate an outage to perform a disaster recovery drill, see [Recover a SQL Database from an outage](sql-database-disaster-recovery.md).</span></span>

### <a name="prepare-for-an-outage"></a><span data-ttu-id="86ee6-217">Prepare-se para uma interrupção</span><span class="sxs-lookup"><span data-stu-id="86ee6-217">Prepare for an outage</span></span>
<span data-ttu-id="86ee6-218">Independentemente do recurso de continuidade de negócios usados, você deve:</span><span class="sxs-lookup"><span data-stu-id="86ee6-218">Regardless of the business continuity feature you use, you must:</span></span>

* <span data-ttu-id="86ee6-219">Identificar e preparar o servidor de destino, incluindo as regras de firewall no nível do servidor, logons e permissões de nível de banco de dados mestre.</span><span class="sxs-lookup"><span data-stu-id="86ee6-219">Identify and prepare the target server, including server-level firewall rules, logins, and master database level permissions.</span></span>
* <span data-ttu-id="86ee6-220">Determinar como redirecionar os clientes e aplicativos de cliente para o novo servidor</span><span class="sxs-lookup"><span data-stu-id="86ee6-220">Determine how to redirect clients and client applications to the new server</span></span>
* <span data-ttu-id="86ee6-221">Documentar outras dependências, como as configurações e alertas de auditoria</span><span class="sxs-lookup"><span data-stu-id="86ee6-221">Document other dependencies, such as auditing settings and alerts</span></span>

<span data-ttu-id="86ee6-222">Se você não se preparar corretamente, colocar seus aplicativos online após um failover ou uma recuperação de banco de dados exigirá um tempo adicional e, provavelmente, a solução de problemas também será exigida em um momento de estresse, ou seja, uma combinação ruim.</span><span class="sxs-lookup"><span data-stu-id="86ee6-222">If you do not prepare properly, bringing your applications online after a failover or a database recovery takes additional time and likely also require troubleshooting at a time of stress - a bad combination.</span></span>

### <a name="fail-over-to-a-geo-replicated-secondary-database"></a><span data-ttu-id="86ee6-223">Fazer failover em um banco de dados secundário com replicação geográfica</span><span class="sxs-lookup"><span data-stu-id="86ee6-223">Fail over to a geo-replicated secondary database</span></span>
<span data-ttu-id="86ee6-224">Se você estiver usando a replicação geográfica ativa e os grupos de failover automático (em versão prévia) como mecanismos de recuperação, você poderá configurar uma política de failover automático ou usar o [failover manual](sql-database-disaster-recovery.md#fail-over-to-geo-replicated-secondary-database).</span><span class="sxs-lookup"><span data-stu-id="86ee6-224">If you are using active geo-replication and auto-failover groups (in-preview) as your recovery mechanism, you can configure an automatic failover policy or use [manual failover](sql-database-disaster-recovery.md#fail-over-to-geo-replicated-secondary-database).</span></span> <span data-ttu-id="86ee6-225">Depois de iniciado, o failover faz com que o secundário se torne o novo primário e fique pronto para registrar novas transações e responder à consultas, com perda mínima de dados, para os dados que ainda não foram replicados.</span><span class="sxs-lookup"><span data-stu-id="86ee6-225">Once initiated, the failover causes the secondary to become the new primary and ready to record new transactions and respond to queries - with minimal data loss for the data not yet replicated.</span></span> <span data-ttu-id="86ee6-226">Para obter informações sobre como criar o processo de failover, confira [Criar um aplicativo para recuperação de desastre na nuvem](sql-database-designing-cloud-solutions-for-disaster-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="86ee6-226">For information on designing the failover process, see [Design an application for cloud disaster recovery](sql-database-designing-cloud-solutions-for-disaster-recovery.md).</span></span>

> [!NOTE]
> <span data-ttu-id="86ee6-227">Quando o data center volta a ficar online, os primários antigos reconectam-se automaticamente ao novo primário e se tornam bancos de dados secundários.</span><span class="sxs-lookup"><span data-stu-id="86ee6-227">When the data center comes back online the old primaries automatically reconnect to the new primary and become secondary databases.</span></span> <span data-ttu-id="86ee6-228">Se você precisar realocar o primário de volta para a região original, poderá iniciar um failover planejado manualmente (failback).</span><span class="sxs-lookup"><span data-stu-id="86ee6-228">If you need to relocate the primary back to the original region, you can initiate a planned failover manually (failback).</span></span> 
> 

### <a name="perform-a-geo-restore"></a><span data-ttu-id="86ee6-229">Executar uma restauração geográfica</span><span class="sxs-lookup"><span data-stu-id="86ee6-229">Perform a geo-restore</span></span>
<span data-ttu-id="86ee6-230">Se você estiver usando backups automatizados com a replicação de armazenamento com redundância geográfica como o mecanismo de recuperação, [inicie uma recuperação de banco de dados usando a restauração geográfica](sql-database-disaster-recovery.md#recover-using-geo-restore).</span><span class="sxs-lookup"><span data-stu-id="86ee6-230">If you are using automated backups with geo-redundant storage replication as your recovery mechanism, [initiate a database recovery using geo-restore](sql-database-disaster-recovery.md#recover-using-geo-restore).</span></span> <span data-ttu-id="86ee6-231">A recuperação normalmente ocorre em 12 horas, com perda de dados de até uma hora determinada pela ocasião em que o último backup diferencial ocorreu e foi replicado.</span><span class="sxs-lookup"><span data-stu-id="86ee6-231">Recovery usually takes place within 12 hours - with data loss of up to one hour determined by when the last hourly differential backup with taken and replicated.</span></span> <span data-ttu-id="86ee6-232">Até que a recuperação seja concluída, o banco de dados não poderá registrar nenhuma transação ou responder a qualquer consulta.</span><span class="sxs-lookup"><span data-stu-id="86ee6-232">Until the recovery completes, the database is unable to record any transactions or respond to any queries.</span></span> <span data-ttu-id="86ee6-233">Embora isso restaure um banco de dados para o último ponto disponível no tempo, atualmente, não há suporte para a restauração do geográfico secundário em qualquer ponto no tempo.</span><span class="sxs-lookup"><span data-stu-id="86ee6-233">While this restores a database to the last available point in time, restoring the geo-secondary to any point in time is not currently supported.</span></span>

> [!NOTE]
> <span data-ttu-id="86ee6-234">Se o data center voltar a ficar online antes de você transferir seu aplicativo para o banco de dados recuperado, você poderá cancelar a recuperação.</span><span class="sxs-lookup"><span data-stu-id="86ee6-234">If the data center comes back online before you switch your application over to the recovered database, you can cancel the recovery.</span></span>  
>
>

### <a name="perform-post-failover--recovery-tasks"></a><span data-ttu-id="86ee6-235">Executar pós-failover / tarefas de recuperação</span><span class="sxs-lookup"><span data-stu-id="86ee6-235">Perform post failover / recovery tasks</span></span>
<span data-ttu-id="86ee6-236">Após recuperar de um dos mecanismos de recuperação, você deverá executar as seguintes tarefas adicionais antes que os usuários e aplicativos entrem em funcionamento novamente:</span><span class="sxs-lookup"><span data-stu-id="86ee6-236">After recovery from either recovery mechanism, you must perform the following additional tasks before your users and applications are back up and running:</span></span>

* <span data-ttu-id="86ee6-237">Redirecionar clientes e aplicativos de cliente para o novo servidor e banco de dados restaurado</span><span class="sxs-lookup"><span data-stu-id="86ee6-237">Redirect clients and client applications to the new server and restored database</span></span>
* <span data-ttu-id="86ee6-238">Verificar se as regras de firewall de nível de servidor apropriadas estão em vigor para que os usuários se conectem (ou use os [firewalls de nível de banco de dados](sql-database-firewall-configure.md#creating-and-managing-firewall-rules))</span><span class="sxs-lookup"><span data-stu-id="86ee6-238">Ensure appropriate server-level firewall rules are in place for users to connect (or use [database-level firewalls](sql-database-firewall-configure.md#creating-and-managing-firewall-rules))</span></span>
* <span data-ttu-id="86ee6-239">Verificar se os logons apropriados e as permissões nível de banco de dados mestre estão em vigor (ou usar os [usuários independentes](https://msdn.microsoft.com/library/ff929188.aspx))</span><span class="sxs-lookup"><span data-stu-id="86ee6-239">Ensure appropriate logins and master database level permissions are in place (or use [contained users](https://msdn.microsoft.com/library/ff929188.aspx))</span></span>
* <span data-ttu-id="86ee6-240">Configurar a auditoria, conforme apropriado</span><span class="sxs-lookup"><span data-stu-id="86ee6-240">Configure auditing, as appropriate</span></span>
* <span data-ttu-id="86ee6-241">Configurar os alertas, conforme apropriado</span><span class="sxs-lookup"><span data-stu-id="86ee6-241">Configure alerts, as appropriate</span></span>

## <a name="upgrade-an-application-with-minimal-downtime"></a><span data-ttu-id="86ee6-242">Atualize um aplicativo com tempo de inatividade mínimo</span><span class="sxs-lookup"><span data-stu-id="86ee6-242">Upgrade an application with minimal downtime</span></span>
<span data-ttu-id="86ee6-243">Às vezes, um aplicativo deve ser colocado offline devido à manutenção planejada, como uma atualização do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="86ee6-243">Sometimes an application must be taken offline because of planned maintenance such as an application upgrade.</span></span> <span data-ttu-id="86ee6-244">[Gerenciar atualizações de aplicativos](sql-database-manage-application-rolling-upgrade.md) descreve como usar a replicação geográfica ativa para habilitar as atualizações sem interrupção do seu aplicativo em nuvem para minimizar o tempo de inatividade durante as atualizações e fornecer um caminho de recuperação caso algo saia errado.</span><span class="sxs-lookup"><span data-stu-id="86ee6-244">[Manage application upgrades](sql-database-manage-application-rolling-upgrade.md) describes how to use active geo-replication to enable rolling upgrades of your cloud application to minimize downtime during upgrades and provide a recovery path if something goes wrong.</span></span> 

## <a name="next-steps"></a><span data-ttu-id="86ee6-245">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="86ee6-245">Next steps</span></span>
<span data-ttu-id="86ee6-246">Para uma discussão sobre as considerações de design de aplicativo para bancos de dados independentes em pools elásticos, confira [Criar um aplicativo para recuperação de desastre na nuvem](sql-database-designing-cloud-solutions-for-disaster-recovery.md) e [Estratégias de recuperação de desastre para Pool Elástico](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="86ee6-246">For a discussion of application design considerations for stand-alone databases and for elastic pools, see [Design an application for cloud disaster recovery](sql-database-designing-cloud-solutions-for-disaster-recovery.md) and [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>
