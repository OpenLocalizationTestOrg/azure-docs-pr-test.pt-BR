---
title: Gerenciando bancos de dados de nuvem com escala horizontal | Microsoft Docs
description: "Ilustra o serviço do trabalho de banco de dados elástico"
metakeywords: azure sql database elastic databases
services: sql-database
documentationcenter: 
manager: jhubbard
author: ddove
ms.assetid: 6fa47cf2-1162-4534-a206-6e2d95b78580
ms.service: sql-database
ms.custom: scale out apps
ms.workload: sql-database
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/24/2016
ms.author: ddove
ms.openlocfilehash: 8e84562115a866c0df5e0dee6c7f66c036a74737
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="managing-scaled-out-cloud-databases"></a><span data-ttu-id="fc957-103">Gerenciando bancos de dados de nuvem com escalonamento horizontal</span><span class="sxs-lookup"><span data-stu-id="fc957-103">Managing scaled-out cloud databases</span></span>
<span data-ttu-id="fc957-104">Para gerenciar bancos de dados fragmentados escalados horizontalmente, o recurso de **Trabalhos do Banco de Dados Elástico** (visualização) permite executar um script Transact-SQL (T-SQL) confiável em um grupo de bancos de dados, incluindo:</span><span class="sxs-lookup"><span data-stu-id="fc957-104">To manage scaled-out sharded databases, the **Elastic Database jobs** feature (preview) enables you to reliably execute a Transact-SQL (T-SQL) script across a group of databases, including:</span></span>

* <span data-ttu-id="fc957-105">um conjunto personalizado de bancos de dados (explicado abaixo)</span><span class="sxs-lookup"><span data-stu-id="fc957-105">a custom-defined collection of databases (explained below)</span></span>
* <span data-ttu-id="fc957-106">todos os bancos de dados em um [pool elástico](sql-database-elastic-pool.md)</span><span class="sxs-lookup"><span data-stu-id="fc957-106">all databases in an [elastic pool](sql-database-elastic-pool.md)</span></span>
* <span data-ttu-id="fc957-107">um conjunto de fragmentos (criado usando a [biblioteca de cliente do Banco de Dados Elástico](sql-database-elastic-database-client-library.md)).</span><span class="sxs-lookup"><span data-stu-id="fc957-107">a shard set (created using [Elastic Database client library](sql-database-elastic-database-client-library.md)).</span></span> 

## <a name="documentation"></a><span data-ttu-id="fc957-108">Documentação</span><span class="sxs-lookup"><span data-stu-id="fc957-108">Documentation</span></span>
* <span data-ttu-id="fc957-109">[Instalar os componentes de trabalho de Banco de Dados Elástico](sql-database-elastic-jobs-service-installation.md).</span><span class="sxs-lookup"><span data-stu-id="fc957-109">[Install the Elastic Database job components](sql-database-elastic-jobs-service-installation.md).</span></span> 
* <span data-ttu-id="fc957-110">[Introdução aos trabalhos do Banco de Dados Elástico](sql-database-elastic-jobs-getting-started.md).</span><span class="sxs-lookup"><span data-stu-id="fc957-110">[Get started with Elastic Database jobs](sql-database-elastic-jobs-getting-started.md).</span></span>
* <span data-ttu-id="fc957-111">[Criar e gerenciar trabalhos usando o PowerShell](sql-database-elastic-jobs-powershell.md).</span><span class="sxs-lookup"><span data-stu-id="fc957-111">[Create and manage jobs using PowerShell](sql-database-elastic-jobs-powershell.md).</span></span>
* [<span data-ttu-id="fc957-112">Criar e gerenciar Bancos de Dados SQL do Azure com escala horizontal</span><span class="sxs-lookup"><span data-stu-id="fc957-112">Create and manage scaled out Azure SQL Databases</span></span>](sql-database-elastic-jobs-getting-started.md)

<span data-ttu-id="fc957-113">Os **trabalhos de Banco de Dados Elástico** atualmente são um serviço de nuvem do Azure hospedado pelo cliente, que permite a execução de tarefas administrativas ad hoc e agendadas, as quais são chamadas de **trabalhos**.</span><span class="sxs-lookup"><span data-stu-id="fc957-113">**Elastic Database jobs** is currently a customer-hosted Azure Cloud Service that enables the execution of ad-hoc and scheduled administrative tasks, which are called **jobs**.</span></span> <span data-ttu-id="fc957-114">Com os trabalhos, você pode gerenciar de maneira fácil e confiável grandes grupos de Bancos de Dados do Azure SQL executando scripts Transact-SQL para executar operações administrativas.</span><span class="sxs-lookup"><span data-stu-id="fc957-114">With jobs, you can easily and reliably manage large groups of Azure SQL Databases by running Transact-SQL scripts to perform administrative operations.</span></span> 

![Serviço do trabalho de banco de dados elástico][1]

## <a name="why-use-jobs"></a><span data-ttu-id="fc957-116">Por que usar os trabalhos?</span><span class="sxs-lookup"><span data-stu-id="fc957-116">Why use jobs?</span></span>
<span data-ttu-id="fc957-117">**Gerenciar**</span><span class="sxs-lookup"><span data-stu-id="fc957-117">**Manage**</span></span>

<span data-ttu-id="fc957-118">Realize facilmente alterações de esquema, gerenciamento de credenciais, atualizações de dados de referência, desempenho de coleta de dados ou coleção de telemetria do locatário (cliente).</span><span class="sxs-lookup"><span data-stu-id="fc957-118">Easily do schema changes, credentials management, reference data updates, performance data collection or tenant (customer) telemetry collection.</span></span>

<span data-ttu-id="fc957-119">**Relatórios**</span><span class="sxs-lookup"><span data-stu-id="fc957-119">**Reports**</span></span>

<span data-ttu-id="fc957-120">Agregue dados de uma coleção de Bancos de Dados SQL do Azure em uma tabela de destino único.</span><span class="sxs-lookup"><span data-stu-id="fc957-120">Aggregate data from a collection of Azure SQL Databases into a single destination table.</span></span>

<span data-ttu-id="fc957-121">**Reduzir a sobrecarga**</span><span class="sxs-lookup"><span data-stu-id="fc957-121">**Reduce overhead**</span></span>

<span data-ttu-id="fc957-122">Normalmente, você deve se conectar a cada banco de dados de forma independente a fim de executar instruções Transact-SQL ou realizar outras tarefas administrativas.</span><span class="sxs-lookup"><span data-stu-id="fc957-122">Normally, you must connect to each database independently in order to run Transact-SQL statements or perform other administrative tasks.</span></span> <span data-ttu-id="fc957-123">Um trabalho lida com a tarefa de fazer logon em cada banco de dados no grupo de destino.</span><span class="sxs-lookup"><span data-stu-id="fc957-123">A job handles the task of logging in to each database in the target group.</span></span> <span data-ttu-id="fc957-124">Você também define, mantém e persiste em scripts T-SQL que serão executados em um grupo de Bancos de Dados SQL do Azure.</span><span class="sxs-lookup"><span data-stu-id="fc957-124">You also define, maintain and persist Transact-SQL scripts to be executed across a group of Azure SQL Databases.</span></span>

<span data-ttu-id="fc957-125">**Contabilização**</span><span class="sxs-lookup"><span data-stu-id="fc957-125">**Accounting**</span></span>

<span data-ttu-id="fc957-126">Os trabalhos executam o script e registram em log o status de execução para cada banco de dados.</span><span class="sxs-lookup"><span data-stu-id="fc957-126">Jobs run the script and log the status of execution for each database.</span></span> <span data-ttu-id="fc957-127">Você também tem a repetição automática quando ocorrem falhas.</span><span class="sxs-lookup"><span data-stu-id="fc957-127">You also get automatic retry when failures occur.</span></span>

<span data-ttu-id="fc957-128">**Flexibilidade**</span><span class="sxs-lookup"><span data-stu-id="fc957-128">**Flexibility**</span></span>

<span data-ttu-id="fc957-129">Defina grupos personalizados de Bancos de Dados SQL do Azure e defina agendas para executar um trabalho.</span><span class="sxs-lookup"><span data-stu-id="fc957-129">Define custom groups of Azure SQL Databases, and define schedules for running a job.</span></span>

> [!NOTE]
> <span data-ttu-id="fc957-130">No portal do Azure, apenas um conjunto reduzido de funções limitadas aos pools elásticos do SQL Azure está disponível.</span><span class="sxs-lookup"><span data-stu-id="fc957-130">In the Azure portal, only a reduced set of functions limited to SQL Azure elastic pools is available.</span></span> <span data-ttu-id="fc957-131">Use as APIs do PowerShell para acessar o conjunto completo de funcionalidades atuais.</span><span class="sxs-lookup"><span data-stu-id="fc957-131">Use the PowerShell APIs to access the full set of current functionality.</span></span>
> 
> 

## <a name="applications"></a><span data-ttu-id="fc957-132">Aplicativos</span><span class="sxs-lookup"><span data-stu-id="fc957-132">Applications</span></span>
* <span data-ttu-id="fc957-133">Realize tarefas administrativas, como a implantação de um novo esquema.</span><span class="sxs-lookup"><span data-stu-id="fc957-133">Perform administrative tasks, such as deploying a new schema.</span></span>
* <span data-ttu-id="fc957-134">Atualize informações de dados de referência do produto comuns a todos os bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="fc957-134">Update reference data-product information common across all databases.</span></span> <span data-ttu-id="fc957-135">Ou agende atualizações automáticas a cada dia da semana, após o expediente.</span><span class="sxs-lookup"><span data-stu-id="fc957-135">Or schedules automatic updates every weekday, after hours.</span></span>
* <span data-ttu-id="fc957-136">Recompilar índices para melhorar o desempenho da consulta.</span><span class="sxs-lookup"><span data-stu-id="fc957-136">Rebuild indexes to improve query performance.</span></span> <span data-ttu-id="fc957-137">A recriação pode ser configurada para executar em um conjunto de bancos de dados de modo recorrente, como fora dos horários de pico.</span><span class="sxs-lookup"><span data-stu-id="fc957-137">The rebuilding can be configured to execute across a collection of databases on a recurring basis, such as during off-peak hours.</span></span>
* <span data-ttu-id="fc957-138">Coletar resultados de consulta de um conjunto de bancos de dados em uma tabela central em uma base contínua.</span><span class="sxs-lookup"><span data-stu-id="fc957-138">Collect query results from a set of databases into a central table on an on-going basis.</span></span> <span data-ttu-id="fc957-139">Consultas de desempenho podem ser executadas continuamente e configuradas para disparar tarefas adicionais a serem executadas.</span><span class="sxs-lookup"><span data-stu-id="fc957-139">Performance queries can be continually executed and configured to trigger additional tasks to be executed.</span></span>
* <span data-ttu-id="fc957-140">Executar consultas de processamento de dados mais longas em um grande conjunto de bancos de dados, por exemplo, a coleta de telemetria do cliente.</span><span class="sxs-lookup"><span data-stu-id="fc957-140">Execute longer running data processing queries across a large set of databases, for example the collection of customer telemetry.</span></span> <span data-ttu-id="fc957-141">Resultados são coletados em uma única tabela de destino para análise posterior.</span><span class="sxs-lookup"><span data-stu-id="fc957-141">Results are collected into a single destination table for further analysis.</span></span>

## <a name="elastic-database-jobs-end-to-end"></a><span data-ttu-id="fc957-142">Trabalhos de Banco de Dados Elástico: ponta a ponta</span><span class="sxs-lookup"><span data-stu-id="fc957-142">Elastic Database jobs: end-to-end</span></span>
1. <span data-ttu-id="fc957-143">Instalar os componentes de **trabalhos de banco de dados elástico** .</span><span class="sxs-lookup"><span data-stu-id="fc957-143">Install the **Elastic Database jobs** components.</span></span> <span data-ttu-id="fc957-144">Para saber mais informações, consulte [Instalando trabalhos de banco de dados elástico](sql-database-elastic-jobs-service-installation.md).</span><span class="sxs-lookup"><span data-stu-id="fc957-144">For more information, see [Installing Elastic Database jobs](sql-database-elastic-jobs-service-installation.md).</span></span> <span data-ttu-id="fc957-145">Se a instalação falhar, confira [como desinstalar](sql-database-elastic-jobs-uninstall.md).</span><span class="sxs-lookup"><span data-stu-id="fc957-145">If the installation fails, see [how to uninstall](sql-database-elastic-jobs-uninstall.md).</span></span>
2. <span data-ttu-id="fc957-146">Use as APIs do PowerShell para acessar mais funcionalidades, por exemplo, criando coleções de bancos de dados personalizadas, adicionando agendas e/ou coletando conjuntos de resultados.</span><span class="sxs-lookup"><span data-stu-id="fc957-146">Use the PowerShell APIs to access more functionality, for example creating custom-defined database collections, adding schedules and/or gathering results sets.</span></span> <span data-ttu-id="fc957-147">Use o portal para instalação simples e criação/monitoramento de trabalhos limitados para execução em um **pool elástico**.</span><span class="sxs-lookup"><span data-stu-id="fc957-147">Use the portal for simple installation and creation/monitoring of jobs limited to execution against a **elastic pool**.</span></span> 
3. <span data-ttu-id="fc957-148">Criar credenciais criptografadas para execução do trabalho e [adicionar o usuário (ou função) para cada banco de dados no grupo](sql-database-security-overview.md).</span><span class="sxs-lookup"><span data-stu-id="fc957-148">Create encrypted credentials for job execution and [add the user (or role) to each database in the group](sql-database-security-overview.md).</span></span>
4. <span data-ttu-id="fc957-149">Criar um script T-SQL idempotente que pode ser executado em cada banco de dados no grupo.</span><span class="sxs-lookup"><span data-stu-id="fc957-149">Create an idempotent T-SQL script that can be run against every database in the group.</span></span> 
5. <span data-ttu-id="fc957-150">Siga estas etapas para criar trabalhos usando o portal do Azure: [Criando e gerenciando trabalhos do Banco de Dados Elástico](sql-database-elastic-jobs-create-and-manage.md).</span><span class="sxs-lookup"><span data-stu-id="fc957-150">Follow these steps to create jobs using the Azure portal: [Creating and managing Elastic Database jobs](sql-database-elastic-jobs-create-and-manage.md).</span></span> 
6. <span data-ttu-id="fc957-151">Ou use scripts do PowerShell: [Criar e gerenciar trabalhos de banco de dados elástico de Banco de Dados SQL usando o PowerShell (visualização)](sql-database-elastic-jobs-powershell.md).</span><span class="sxs-lookup"><span data-stu-id="fc957-151">Or use PowerShell scripts: [Create and manage a SQL Database elastic database jobs using PowerShell (preview)](sql-database-elastic-jobs-powershell.md).</span></span>

## <a name="idempotent-scripts"></a><span data-ttu-id="fc957-152">Scripts idempotentes</span><span class="sxs-lookup"><span data-stu-id="fc957-152">Idempotent scripts</span></span>
<span data-ttu-id="fc957-153">Os scripts devem ser [idempotentes](https://en.wikipedia.org/wiki/Idempotence).</span><span class="sxs-lookup"><span data-stu-id="fc957-153">The scripts must be [idempotent](https://en.wikipedia.org/wiki/Idempotence).</span></span> <span data-ttu-id="fc957-154">Em termos simples, "idempotente" significa que, se o script tiver êxito e for executado novamente, o mesmo resultado ocorrerá.</span><span class="sxs-lookup"><span data-stu-id="fc957-154">In simple terms, "idempotent" means that if the script succeeds, and it is run again, the same result occurs.</span></span> <span data-ttu-id="fc957-155">Um script pode falhar devido a problemas de rede transitórios.</span><span class="sxs-lookup"><span data-stu-id="fc957-155">A script may fail due to transient network issues.</span></span> <span data-ttu-id="fc957-156">Nesse caso, o trabalho repetirá automaticamente a execução do script por um número predefinido de vezes antes de desistir.</span><span class="sxs-lookup"><span data-stu-id="fc957-156">In that case, the job will automatically retry running the script a preset number of times before desisting.</span></span> <span data-ttu-id="fc957-157">Um script idempotente tem o mesmo resultado, mesmo que tenha sido executado com êxito duas vezes.</span><span class="sxs-lookup"><span data-stu-id="fc957-157">An idempotent script has the same result even if has been successfully run twice.</span></span> 

<span data-ttu-id="fc957-158">É uma tática simples para testar a existência de um objeto antes de criá-lo.</span><span class="sxs-lookup"><span data-stu-id="fc957-158">A simple tactic is to test for the existence of an object before creating it.</span></span>  

    IF NOT EXIST (some_object)
    -- Create the object 
    -- If it exists, drop the object before recreating it.

<span data-ttu-id="fc957-159">Da mesma forma, um script deve ser capaz de realizar a execução com êxito testando e combatendo logicamente quaisquer condições que encontrar.</span><span class="sxs-lookup"><span data-stu-id="fc957-159">Similarly, a script must be able to execute successfully by logically testing for and countering any conditions it finds.</span></span>

## <a name="failures-and-logs"></a><span data-ttu-id="fc957-160">Falhas e logs</span><span class="sxs-lookup"><span data-stu-id="fc957-160">Failures and logs</span></span>
<span data-ttu-id="fc957-161">Se um script falhar após várias tentativas, o trabalho registrará em log o erro e continuará.</span><span class="sxs-lookup"><span data-stu-id="fc957-161">If a script fails after multiple attempts, the job logs the error and continues.</span></span> <span data-ttu-id="fc957-162">Após o término de um trabalho (ou seja, uma execução em relação a todos os bancos de dados no grupo), você pode verificar sua lista de tentativas com falha.</span><span class="sxs-lookup"><span data-stu-id="fc957-162">After a job ends (meaning a run against all databases in the group), you can check its list of failed attempts.</span></span> <span data-ttu-id="fc957-163">Os logs fornecem detalhes para depurar scripts com erros.</span><span class="sxs-lookup"><span data-stu-id="fc957-163">The logs provide details to debug faulty scripts.</span></span> 

## <a name="group-types-and-creation"></a><span data-ttu-id="fc957-164">Tipos de grupos e criação</span><span class="sxs-lookup"><span data-stu-id="fc957-164">Group types and creation</span></span>
<span data-ttu-id="fc957-165">Há dois tipos de grupos:</span><span class="sxs-lookup"><span data-stu-id="fc957-165">There are two kinds of groups:</span></span> 

1. <span data-ttu-id="fc957-166">Conjuntos de fragmento</span><span class="sxs-lookup"><span data-stu-id="fc957-166">Shard sets</span></span>
2. <span data-ttu-id="fc957-167">Grupos personalizados</span><span class="sxs-lookup"><span data-stu-id="fc957-167">Custom groups</span></span>

<span data-ttu-id="fc957-168">Grupos de conjuntos de fragmentos são criados usando as [ferramentas de Banco de Dados Elástico](sql-database-elastic-scale-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="fc957-168">Shard set groups are created using the [Elastic Database tools](sql-database-elastic-scale-introduction.md).</span></span> <span data-ttu-id="fc957-169">Quando você cria um grupo de conjunto de fragmentos, bancos de dados são adicionados ou removidos do grupo automaticamente.</span><span class="sxs-lookup"><span data-stu-id="fc957-169">When you create a shard set group, databases are added or removed from the group automatically.</span></span> <span data-ttu-id="fc957-170">Por exemplo, um novo fragmento estará automaticamente no grupo quando você adicioná-lo ao mapa de fragmentos.</span><span class="sxs-lookup"><span data-stu-id="fc957-170">For example, a new shard will be automatically in the group when you add it to the shard map.</span></span> <span data-ttu-id="fc957-171">Um trabalho pode, então, ser executado no grupo.</span><span class="sxs-lookup"><span data-stu-id="fc957-171">A job can then be run against the group.</span></span>

<span data-ttu-id="fc957-172">Os grupos personalizados, por outro lado, são definidos rigidamente.</span><span class="sxs-lookup"><span data-stu-id="fc957-172">Custom groups, on the other hand, are rigidly defined.</span></span> <span data-ttu-id="fc957-173">Você deve adicionar ou remover explicitamente bancos de dados de grupos personalizados.</span><span class="sxs-lookup"><span data-stu-id="fc957-173">You must explicitly add or remove databases from custom groups.</span></span> <span data-ttu-id="fc957-174">Se um banco de dados no grupo for interrompido, o trabalho tentará executar o script em relação ao banco de dados, resultando em uma eventual falha.</span><span class="sxs-lookup"><span data-stu-id="fc957-174">If a database in the group is dropped, the job will attempt to run the script against the database resulting in an eventual failure.</span></span> <span data-ttu-id="fc957-175">No momento, grupos criados usando o portal do Azure são grupos personalizados.</span><span class="sxs-lookup"><span data-stu-id="fc957-175">Groups created using the Azure portal currently are custom groups.</span></span> 

## <a name="components-and-pricing"></a><span data-ttu-id="fc957-176">Componentes e preços</span><span class="sxs-lookup"><span data-stu-id="fc957-176">Components and pricing</span></span>
<span data-ttu-id="fc957-177">Os seguintes componentes trabalham juntos para criar um Serviço de Nuvem do Azure que permite a execução ad hoc de trabalhos administrativos.</span><span class="sxs-lookup"><span data-stu-id="fc957-177">The following components work together to create an Azure Cloud service that enables ad-hoc execution of administrative jobs.</span></span> <span data-ttu-id="fc957-178">Os componentes são instalados e configurados automaticamente durante a configuração, em sua assinatura.</span><span class="sxs-lookup"><span data-stu-id="fc957-178">The components are installed and configured automatically during setup, in your subscription.</span></span> <span data-ttu-id="fc957-179">Você pode identificar os serviços, uma vez que todos têm o mesmo nome gerado automaticamente.</span><span class="sxs-lookup"><span data-stu-id="fc957-179">You can identify the services as they all have the same auto-generated name.</span></span> <span data-ttu-id="fc957-180">O nome é exclusivo e é formado pelo prefixo "edj" seguido por 21 caracteres gerados aleatoriamente.</span><span class="sxs-lookup"><span data-stu-id="fc957-180">The name is unique, and consists of the prefix "edj" followed by 21 randomly generated characters.</span></span>

* <span data-ttu-id="fc957-181">**Serviço de Nuvem do Azure**: os trabalhos de banco de dados elástico (visualização) são fornecidos como um Serviço de Nuvem do Azure hospedado pelo cliente para a execução das tarefas solicitadas.</span><span class="sxs-lookup"><span data-stu-id="fc957-181">**Azure Cloud Service**: elastic database jobs (preview) is delivered as a customer-hosted Azure Cloud service to perform execution of the requested tasks.</span></span> <span data-ttu-id="fc957-182">No portal, o serviço é implantado e hospedado em sua assinatura do Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="fc957-182">From the portal, the service is deployed and hosted in your Microsoft Azure subscription.</span></span> <span data-ttu-id="fc957-183">O serviço implantado por padrão é executado com o mínimo de duas funções de trabalho a fim de manter a alta disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="fc957-183">The default deployed service runs with the minimum of two worker roles for high availability.</span></span> <span data-ttu-id="fc957-184">O tamanho padrão de cada função de trabalho (ElasticDatabaseJobWorker) é executado em uma instância de A0.</span><span class="sxs-lookup"><span data-stu-id="fc957-184">The default size of each worker role (ElasticDatabaseJobWorker) runs on an A0 instance.</span></span> <span data-ttu-id="fc957-185">Para obter os preços, confira [preços dos serviços de Nuvem](https://azure.microsoft.com/pricing/details/cloud-services/).</span><span class="sxs-lookup"><span data-stu-id="fc957-185">For pricing, see [Cloud services pricing](https://azure.microsoft.com/pricing/details/cloud-services/).</span></span> 
* <span data-ttu-id="fc957-186">**Banco de dados SQL do Azure**: O serviço usa um Banco de Dados SQL do Azure conhecido como o **banco de dados de controle** para armazenar todos os metadados de trabalho.</span><span class="sxs-lookup"><span data-stu-id="fc957-186">**Azure SQL Database**: The service uses an Azure SQL Database known as the **control database** to store all of the job metadata.</span></span> <span data-ttu-id="fc957-187">A camada de serviço padrão é S0.</span><span class="sxs-lookup"><span data-stu-id="fc957-187">The default service tier is a S0.</span></span> <span data-ttu-id="fc957-188">Para obter os preços, confira [Preços de Banco de Dados SQL](https://azure.microsoft.com/pricing/details/sql-database/).</span><span class="sxs-lookup"><span data-stu-id="fc957-188">For pricing, see [SQL Database Pricing](https://azure.microsoft.com/pricing/details/sql-database/).</span></span>
* <span data-ttu-id="fc957-189">**Barramento de Serviço do Azure**: um Barramento de Serviço do Azure serve para coordenação do trabalho no Serviço de Nuvem do Azure.</span><span class="sxs-lookup"><span data-stu-id="fc957-189">**Azure Service Bus**: An Azure Service Bus is for coordination of the work within the Azure Cloud Service.</span></span> <span data-ttu-id="fc957-190">Consulte [Preços de Barramento de Serviço](https://azure.microsoft.com/pricing/details/service-bus/).</span><span class="sxs-lookup"><span data-stu-id="fc957-190">See [Service Bus Pricing](https://azure.microsoft.com/pricing/details/service-bus/).</span></span>
* <span data-ttu-id="fc957-191">**Armazenamento do Azure**: uma conta de Armazenamento do Azure é usada para armazenar o log de saída de diagnóstico no caso em que um problema exige mais depuração (consulte [Habilitando o diagnóstico nos Serviços de Nuvem do Azure e em máquinas virtuais](../cloud-services/cloud-services-dotnet-diagnostics.md)).</span><span class="sxs-lookup"><span data-stu-id="fc957-191">**Azure Storage**: An Azure Storage account is used to store diagnostic output logging in the event that an issue requires further debugging (see [Enabling Diagnostics in Azure Cloud Services and Virtual Machines](../cloud-services/cloud-services-dotnet-diagnostics.md)).</span></span> <span data-ttu-id="fc957-192">Para obter os preços, confira [Preços de Armazenamento do Azure](https://azure.microsoft.com/pricing/details/storage/).</span><span class="sxs-lookup"><span data-stu-id="fc957-192">For pricing, see [Azure Storage Pricing](https://azure.microsoft.com/pricing/details/storage/).</span></span>

## <a name="how-elastic-database-jobs-work"></a><span data-ttu-id="fc957-193">Como os trabalhos de banco de dados elástico funcionam</span><span class="sxs-lookup"><span data-stu-id="fc957-193">How Elastic Database jobs work</span></span>
1. <span data-ttu-id="fc957-194">Um **banco de dados de controle** , que armazena todos os dados de estado e metadados, é atribuído a um banco de dados SQL do Azure.</span><span class="sxs-lookup"><span data-stu-id="fc957-194">An Azure SQL Database is designated a **control database** which stores all meta-data and state data.</span></span>
2. <span data-ttu-id="fc957-195">O banco de dados de controle é acessado pelo **serviço de trabalhos** para iniciar e acompanhar os trabalhos a serem executados.</span><span class="sxs-lookup"><span data-stu-id="fc957-195">The control database is accessed by the **job service** to launch and track jobs to execute.</span></span>
3. <span data-ttu-id="fc957-196">Duas funções diferentes se comunicam com o banco de dados de controle:</span><span class="sxs-lookup"><span data-stu-id="fc957-196">Two different roles communicate with the control database:</span></span> 
   * <span data-ttu-id="fc957-197">Controlador: determina quais trabalhos necessitam de tarefas para executar o trabalho solicitado e faz novas tentativas com aqueles trabalhos com falha, criando novas tarefas de trabalho.</span><span class="sxs-lookup"><span data-stu-id="fc957-197">Controller: Determines which jobs require tasks to perform the requested job, and retries failed jobs by creating new job tasks.</span></span>
   * <span data-ttu-id="fc957-198">Execução de tarefas de trabalho: executa as tarefas de trabalho.</span><span class="sxs-lookup"><span data-stu-id="fc957-198">Job Task Execution: Carries out the job tasks.</span></span>

### <a name="job-task-types"></a><span data-ttu-id="fc957-199">Tipos de tarefa de trabalho</span><span class="sxs-lookup"><span data-stu-id="fc957-199">Job task types</span></span>
<span data-ttu-id="fc957-200">Há vários tipos de tarefas de trabalho que realizarão a execução de trabalhos:</span><span class="sxs-lookup"><span data-stu-id="fc957-200">There are multiple types of job tasks that carry out execution of jobs:</span></span>

* <span data-ttu-id="fc957-201">ShardMapRefresh: consulta o mapa do fragmentos para determinar todos os bancos de dados usados como fragmentos</span><span class="sxs-lookup"><span data-stu-id="fc957-201">ShardMapRefresh: Queries the shard map to determine all the databases used as shards</span></span>
* <span data-ttu-id="fc957-202">ScriptSplit: divide o script contido em instruções “GO” em lotes</span><span class="sxs-lookup"><span data-stu-id="fc957-202">ScriptSplit: Splits the script across ‘GO’ statements into batches</span></span>
* <span data-ttu-id="fc957-203">ExpandJob: cria trabalhos filho para cada banco de dados de um trabalho que se destina a um grupo de bancos de dados</span><span class="sxs-lookup"><span data-stu-id="fc957-203">ExpandJob: Creates child jobs for each database from a job that targets a group of databases</span></span>
* <span data-ttu-id="fc957-204">ScriptExecution: executa um script em um banco de dados específico usando credenciais definidas</span><span class="sxs-lookup"><span data-stu-id="fc957-204">ScriptExecution: Executes a script against a particular database using defined credentials</span></span>
* <span data-ttu-id="fc957-205">Dacpac: aplica um DACPAC a um banco de dados específico usando credenciais específicas</span><span class="sxs-lookup"><span data-stu-id="fc957-205">Dacpac: Applies a DACPAC to a particular database using particular credentials</span></span>

## <a name="end-to-end-job-execution-work-flow"></a><span data-ttu-id="fc957-206">Fluxo de trabalho de execução de trabalho de ponta a ponta</span><span class="sxs-lookup"><span data-stu-id="fc957-206">End-to-end job execution work-flow</span></span>
1. <span data-ttu-id="fc957-207">Usando o Portal ou a API do PowerShell, um trabalho é inserido no **banco de dados de controle**.</span><span class="sxs-lookup"><span data-stu-id="fc957-207">Using either the Portal or the PowerShell API, a job is inserted into the  **control database**.</span></span> <span data-ttu-id="fc957-208">O trabalho solicita a execução de um script Transact-SQL em um grupo de bancos de dados usando credenciais específicas.</span><span class="sxs-lookup"><span data-stu-id="fc957-208">The job requests execution of a Transact-SQL script against a group of databases using specific credentials.</span></span>
2. <span data-ttu-id="fc957-209">O controlador identifica o novo trabalho.</span><span class="sxs-lookup"><span data-stu-id="fc957-209">The controller identifies the new job.</span></span> <span data-ttu-id="fc957-210">Tarefas de trabalho são criadas e executadas para dividir o script e para atualizar os bancos de dados do grupo.</span><span class="sxs-lookup"><span data-stu-id="fc957-210">Job tasks are created and executed to split the script and to refresh the group’s databases.</span></span> <span data-ttu-id="fc957-211">Por fim, um novo trabalho é criado e executado para expandir o trabalho e criar novos trabalhos filho; cada um desses trabalhos filho é especificado para executar o script Transact-SQL em um banco de dados individual no grupo.</span><span class="sxs-lookup"><span data-stu-id="fc957-211">Lastly, a new job is created and executed to expand the job and create new child jobs where each child job is specified to execute the Transact-SQL script against an individual database in the group.</span></span>
3. <span data-ttu-id="fc957-212">O controlador identifica os trabalhos filho criados.</span><span class="sxs-lookup"><span data-stu-id="fc957-212">The controller identifies the created child jobs.</span></span> <span data-ttu-id="fc957-213">Para cada trabalho, o controlador cria e dispara uma tarefa de trabalho para executar o script em um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="fc957-213">For each job, the controller creates and triggers a job task to execute the script against a database.</span></span> 
4. <span data-ttu-id="fc957-214">Depois de concluir todas as tarefas de trabalho, o controlador atualiza os trabalhos para um estado concluído.</span><span class="sxs-lookup"><span data-stu-id="fc957-214">After all job tasks have completed, the controller updates the jobs to a completed state.</span></span> 
   <span data-ttu-id="fc957-215">A qualquer momento durante a execução do trabalho, a API do PowerShell pode ser usada para exibir o estado atual dessa execução.</span><span class="sxs-lookup"><span data-stu-id="fc957-215">At any point during job execution, the PowerShell API can be used to view the current state of job execution.</span></span> <span data-ttu-id="fc957-216">Todos os tempos retornados pelas APIs do PowerShell são representados em formato UTC.</span><span class="sxs-lookup"><span data-stu-id="fc957-216">All times returned by the PowerShell APIs are represented in UTC.</span></span> <span data-ttu-id="fc957-217">Se desejado, uma solicitação de cancelamento pode ser iniciada para interromper um trabalho.</span><span class="sxs-lookup"><span data-stu-id="fc957-217">If desired, a cancellation request can be initiated to stop a job.</span></span> 

## <a name="next-steps"></a><span data-ttu-id="fc957-218">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="fc957-218">Next steps</span></span>
<span data-ttu-id="fc957-219">[Instale os componentes](sql-database-elastic-jobs-service-installation.md) e [crie e adicione um log a cada banco de dados no grupo de bancos de dados](sql-database-manage-logins.md).</span><span class="sxs-lookup"><span data-stu-id="fc957-219">[Install the components](sql-database-elastic-jobs-service-installation.md), then [create and add a log in to each database in the group of databases](sql-database-manage-logins.md).</span></span> <span data-ttu-id="fc957-220">Para entender mais a criação de trabalho e o gerenciamento, consulte [criar e gerenciar trabalhos do banco de dados elástico](sql-database-elastic-jobs-create-and-manage.md).</span><span class="sxs-lookup"><span data-stu-id="fc957-220">To further understand job creation and management, see [creating and managing elastic database jobs](sql-database-elastic-jobs-create-and-manage.md).</span></span> <span data-ttu-id="fc957-221">Consulte também a [Introdução aos trabalhos de Banco de Dados Elástico](sql-database-elastic-jobs-getting-started.md).</span><span class="sxs-lookup"><span data-stu-id="fc957-221">See also [Getting started with Elastic Database jobs](sql-database-elastic-jobs-getting-started.md).</span></span>

[!INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]

<!--Image references-->
[1]: ./media/sql-database-elastic-jobs-overview/elastic-jobs.png
<!--anchors-->


