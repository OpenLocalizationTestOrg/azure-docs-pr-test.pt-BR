---
title: "recuperação de desastres de banco de dados de aaaSQL | Microsoft Docs"
description: "Saiba como toorecover um banco de dados de uma interrupção do datacenter regional ou a falha com hello Azure SQL Database replicação geográfica e recursos de restauração geográfica."
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: 4800960e-3f9d-40ce-9e55-fb7f2784c067
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/14/2017
ms.author: sashan
ms.openlocfilehash: bae08485863067748107ec4808e52d8e88e2de0d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="restore-an-azure-sql-database-or-failover-tooa-secondary"></a><span data-ttu-id="ff320-103">Restaurar um banco de dados do SQL Azure ou failover tooa secundário</span><span class="sxs-lookup"><span data-stu-id="ff320-103">Restore an Azure SQL Database or failover tooa secondary</span></span>
<span data-ttu-id="ff320-104">Banco de dados do SQL Azure oferece Olá recursos para a recuperação de uma interrupção a seguir:</span><span class="sxs-lookup"><span data-stu-id="ff320-104">Azure SQL Database offers hello following capabilities for recovering from an outage:</span></span>

* [<span data-ttu-id="ff320-105">Replicação geográfica ativa</span><span class="sxs-lookup"><span data-stu-id="ff320-105">Active geo-replication</span></span>](sql-database-geo-replication-overview.md)
* [<span data-ttu-id="ff320-106">Restauração geográfica</span><span class="sxs-lookup"><span data-stu-id="ff320-106">Geo-restore</span></span>](sql-database-recovery-using-backups.md#point-in-time-restore)

<span data-ttu-id="ff320-107">toolearn sobre cenários de continuidade de negócios e recursos de saudação dando suporte a esses cenários, consulte [continuidade dos negócios](sql-database-business-continuity.md).</span><span class="sxs-lookup"><span data-stu-id="ff320-107">toolearn about business continuity scenarios and hello features supporting these scenarios, see [Business continuity](sql-database-business-continuity.md).</span></span>

### <a name="prepare-for-hello-event-of-an-outage"></a><span data-ttu-id="ff320-108">Preparar-se para eventos de saudação de uma interrupção</span><span class="sxs-lookup"><span data-stu-id="ff320-108">Prepare for hello event of an outage</span></span>
<span data-ttu-id="ff320-109">Para o êxito da região de dados tooanother de recuperação usando replicação geográfica ativa ou backups com redundância geográfica, você precisa tooprepare um servidor em outro data center interrupção toobecome Olá novo servidor primário deve Olá necessário surgir bem como ter etapas bem definidas testado e documentado tooensure uma recuperação simples.</span><span class="sxs-lookup"><span data-stu-id="ff320-109">For success with recovery tooanother data region using either active geo-replication or geo-redundant backups, you need tooprepare a server in another data center outage toobecome hello new primary server should hello need arise as well as have well-defined steps documented and tested tooensure a smooth recovery.</span></span> <span data-ttu-id="ff320-110">Essas etapas de preparação incluem:</span><span class="sxs-lookup"><span data-stu-id="ff320-110">These preparation steps include:</span></span>

* <span data-ttu-id="ff320-111">Identifique o servidor lógico de saudação em outra região toobecome Olá novo servidor primário.</span><span class="sxs-lookup"><span data-stu-id="ff320-111">Identify hello logical server in another region toobecome hello new primary server.</span></span> <span data-ttu-id="ff320-112">Com replicação geográfica, essa será a pelo menos um e talvez cada um dos servidores secundários hello.</span><span class="sxs-lookup"><span data-stu-id="ff320-112">With active geo-replication, this will be at least one and perhaps each of hello secondary servers.</span></span> <span data-ttu-id="ff320-113">Para a restauração geográfica, isso geralmente será um servidor de saudação [região emparelhada](../best-practices-availability-paired-regions.md) para região Olá na qual o banco de dados está localizado.</span><span class="sxs-lookup"><span data-stu-id="ff320-113">For geo-restore, this will generally be a server in hello [paired region](../best-practices-availability-paired-regions.md) for hello region in which your database is located.</span></span>
* <span data-ttu-id="ff320-114">Identificar e, opcionalmente, definir, regras de firewall no nível de servidor de saudação necessário em usuários tooaccess Olá novo banco de dados primário.</span><span class="sxs-lookup"><span data-stu-id="ff320-114">Identify, and optionally define, hello server-level firewall rules needed on for users tooaccess hello new primary database.</span></span>
* <span data-ttu-id="ff320-115">Determine como você vai tooredirect usuários toohello novo servidor primário, como alterando cadeias de caracteres de conexão ou alterar as entradas DNS.</span><span class="sxs-lookup"><span data-stu-id="ff320-115">Determine how you are going tooredirect users toohello new primary server, such as by changing connection strings or by changing DNS entries.</span></span>
* <span data-ttu-id="ff320-116">Identificar e, opcionalmente, criar, Olá logons que devem estar presente no banco de dados mestre no servidor primário Olá Olá e certifique-se a que esses logons têm as permissões apropriadas no banco de dados mestre hello, se houver.</span><span class="sxs-lookup"><span data-stu-id="ff320-116">Identify, and optionally create, hello logins that must be present in hello master database on hello new primary server, and ensure these logins have appropriate permissions in hello master database, if any.</span></span> <span data-ttu-id="ff320-117">Para obter mais informações, confira [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md)</span><span class="sxs-lookup"><span data-stu-id="ff320-117">For more information, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md)</span></span>
* <span data-ttu-id="ff320-118">Identificar as regras de alerta que serão necessário toobe toomap atualizado toohello novo banco de dados primário.</span><span class="sxs-lookup"><span data-stu-id="ff320-118">Identify alert rules that will need toobe updated toomap toohello new primary database.</span></span>
* <span data-ttu-id="ff320-119">Configuração de auditoria do documento hello em Olá principal banco de dados atual</span><span class="sxs-lookup"><span data-stu-id="ff320-119">Document hello auditing configuration on hello current primary database</span></span>
* <span data-ttu-id="ff320-120">Executar uma [análise de recuperação de desastre](sql-database-disaster-recovery-drills.md).</span><span class="sxs-lookup"><span data-stu-id="ff320-120">Perform a [disaster recovery drill](sql-database-disaster-recovery-drills.md).</span></span> <span data-ttu-id="ff320-121">toosimulate uma interrupção para restauração geográfica, você pode excluir ou renomear a falha de conectividade de aplicativo hello fonte banco de dados toocause.</span><span class="sxs-lookup"><span data-stu-id="ff320-121">toosimulate an outage for geo-restore, you can delete or rename hello source database toocause application connectivity failure.</span></span> <span data-ttu-id="ff320-122">toosimulate uma interrupção de replicação geográfica ativa, você pode desabilitar o aplicativo da web hello ou máquina virtual conectada toohello banco de dados ou failover Olá banco de dados toocause aplicativo falhas de conectividade.</span><span class="sxs-lookup"><span data-stu-id="ff320-122">toosimulate an outage for active geo-replication, you can disable hello web application or virtual machine connected toohello database or failover hello database toocause application connectivity failures.</span></span>

## <a name="when-tooinitiate-recovery"></a><span data-ttu-id="ff320-123">Quando tooinitiate recuperação</span><span class="sxs-lookup"><span data-stu-id="ff320-123">When tooinitiate recovery</span></span>
<span data-ttu-id="ff320-124">operação de recuperação Olá afeta o aplicativo hello.</span><span class="sxs-lookup"><span data-stu-id="ff320-124">hello recovery operation impacts hello application.</span></span> <span data-ttu-id="ff320-125">Ele requer a alteração de cadeia de conexão SQL hello ou redirecionamento usando o DNS e pode resultar em perda de dados permanente.</span><span class="sxs-lookup"><span data-stu-id="ff320-125">It requires changing hello SQL connection string or redirection using DNS and could result in permanent data loss.</span></span> <span data-ttu-id="ff320-126">Portanto, ele deve ser feito apenas quando a interrupção de saudação for provavelmente toolast mais de objetivo de tempo de recuperação do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ff320-126">Therefore, it should be done only when hello outage is likely toolast longer than your application's recovery time objective.</span></span> <span data-ttu-id="ff320-127">Quando o aplicativo hello é implantado tooproduction devem executar o monitoramento regular da integridade do aplicativo hello e usar hello está garantido tooassert pontos que Olá recuperação de dados a seguir:</span><span class="sxs-lookup"><span data-stu-id="ff320-127">When hello application is deployed tooproduction you should perform regular monitoring of hello application health and use hello following data points tooassert that hello recovery is warranted:</span></span>

1. <span data-ttu-id="ff320-128">Falha de conectividade permanente do banco de dados do aplicativo da camada toohello hello.</span><span class="sxs-lookup"><span data-stu-id="ff320-128">Permanent connectivity failure from hello application tier toohello database.</span></span>
2. <span data-ttu-id="ff320-129">Olá portal do Azure mostra um alerta sobre um incidente na região de saudação com grande impacto.</span><span class="sxs-lookup"><span data-stu-id="ff320-129">hello Azure portal shows an alert about an incident in hello region with broad impact.</span></span>
3. <span data-ttu-id="ff320-130">servidor de banco de dados do Azure SQL Hello está marcado como degradado.</span><span class="sxs-lookup"><span data-stu-id="ff320-130">hello Azure SQL Database server is marked as degraded.</span></span>

<span data-ttu-id="ff320-131">Dependendo de responsabilidade de negócios seu aplicativo tolerância toodowntime e possíveis, você pode considerar Olá as opções de recuperação a seguir.</span><span class="sxs-lookup"><span data-stu-id="ff320-131">Depending on your application tolerance toodowntime and possible business liability you can consider hello following recovery options.</span></span>

<span data-ttu-id="ff320-132">Saudação de uso [obter banco de dados recuperável](https://msdn.microsoft.com/library/dn800985.aspx) (*LastAvailableBackupDate*) ponto de restauração replicado geograficamente tooget hello mais recente.</span><span class="sxs-lookup"><span data-stu-id="ff320-132">Use hello [Get Recoverable Database](https://msdn.microsoft.com/library/dn800985.aspx) (*LastAvailableBackupDate*) tooget hello latest Geo-replicated restore point.</span></span>

## <a name="wait-for-service-recovery"></a><span data-ttu-id="ff320-133">Aguarde a recuperação de serviço</span><span class="sxs-lookup"><span data-stu-id="ff320-133">Wait for service recovery</span></span>
<span data-ttu-id="ff320-134">Olá equipes do Azure funcionam cuidadosamente disponibilidade do serviço toorestore como rapidamente possível, mas dependendo da causa raiz de saudação pode levar horas ou dias.</span><span class="sxs-lookup"><span data-stu-id="ff320-134">hello Azure teams work diligently toorestore service availability as quickly as possible but depending on hello root cause it can take hours or days.</span></span>  <span data-ttu-id="ff320-135">Se seu aplicativo pode tolerar tempo de inatividade significativo, que você pode simplesmente aguardar Olá toocomplete de recuperação.</span><span class="sxs-lookup"><span data-stu-id="ff320-135">If your application can tolerate significant downtime you can simply wait for hello recovery toocomplete.</span></span> <span data-ttu-id="ff320-136">Nesse caso, nenhuma ação sua é necessária.</span><span class="sxs-lookup"><span data-stu-id="ff320-136">In this case, no action on your part is required.</span></span> <span data-ttu-id="ff320-137">Você pode ver o status atual do serviço Olá no nosso [painel de integridade do serviço Azure](https://azure.microsoft.com/status/).</span><span class="sxs-lookup"><span data-stu-id="ff320-137">You can see hello current service status on our [Azure Service Health Dashboard](https://azure.microsoft.com/status/).</span></span> <span data-ttu-id="ff320-138">Após a recuperação de saudação da região de saudação de disponibilidade do aplicativo será restaurada.</span><span class="sxs-lookup"><span data-stu-id="ff320-138">After hello recovery of hello region your application’s availability will be restored.</span></span>

## <a name="fail-over-toogeo-replicated-secondary-database"></a><span data-ttu-id="ff320-139">Failover replicadas toogeo banco de dados secundário</span><span class="sxs-lookup"><span data-stu-id="ff320-139">Fail over toogeo-replicated secondary database</span></span>
<span data-ttu-id="ff320-140">Se o tempo de inatividade do aplicativo puder resultar em responsabilidade comercial, você deverá usar bancos de dados replicados geograficamente em seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ff320-140">If your application’s downtime can result in business liability you should be using geo-replicated database(s) in your application.</span></span> <span data-ttu-id="ff320-141">Ele permite disponibilidade de restauração de tooquickly Olá aplicativos em uma região diferente no caso de uma interrupção.</span><span class="sxs-lookup"><span data-stu-id="ff320-141">It will enable hello application tooquickly restore availability in a different region in case of an outage.</span></span> <span data-ttu-id="ff320-142">Saiba como muito[configurar a replicação geográfica](sql-database-geo-replication-portal.md).</span><span class="sxs-lookup"><span data-stu-id="ff320-142">Learn how too[configure geo-replication](sql-database-geo-replication-portal.md).</span></span>

<span data-ttu-id="ff320-143">disponibilidade de toorestore de saudação bancos de dados você precisa tooinitiate Olá failover toohello replicado geograficamente secundário usando um dos métodos de saudação com suporte.</span><span class="sxs-lookup"><span data-stu-id="ff320-143">toorestore availability of hello database(s) you need tooinitiate hello failover toohello geo-replicated secondary using one of hello supported methods.</span></span>

<span data-ttu-id="ff320-144">Use uma saudação toofail guias a seguir sobre tooa replicado geograficamente banco de dados secundário:</span><span class="sxs-lookup"><span data-stu-id="ff320-144">Use one of hello following guides toofail over tooa geo-replicated secondary database:</span></span>

* [<span data-ttu-id="ff320-145">Failover tooa secundário de replicação geográfica usando o Portal do Azure</span><span class="sxs-lookup"><span data-stu-id="ff320-145">Fail over tooa geo-replicated secondary using Azure Portal</span></span>](sql-database-geo-replication-portal.md)
* [<span data-ttu-id="ff320-146">Failover tooa replicado geograficamente secundário usando o PowerShell</span><span class="sxs-lookup"><span data-stu-id="ff320-146">Fail over tooa geo-replicated secondary using PowerShell</span></span>](scripts/sql-database-setup-geodr-and-failover-database-powershell.md)
* [<span data-ttu-id="ff320-147">Failover tooa secundário de replicação geográfica usando o T-SQL</span><span class="sxs-lookup"><span data-stu-id="ff320-147">Fail over tooa geo-replicated secondary using T-SQL</span></span>](sql-database-geo-replication-transact-sql.md)

## <a name="recover-using-geo-restore"></a><span data-ttu-id="ff320-148">Recuperação usando a restauração geográfica</span><span class="sxs-lookup"><span data-stu-id="ff320-148">Recover using geo-restore</span></span>
<span data-ttu-id="ff320-149">Se o tempo de inatividade do aplicativo não resulta em responsabilidade de negócios que você pode usar [restauração geográfica](sql-database-recovery-using-backups.md) como um método toorecover seus bancos de dados do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ff320-149">If your application’s downtime does not result in business liability you can use [geo-restore](sql-database-recovery-using-backups.md) as a method toorecover your application database(s).</span></span> <span data-ttu-id="ff320-150">Ele cria uma cópia do banco de dados de saudação de seu último backup com redundância geográfica.</span><span class="sxs-lookup"><span data-stu-id="ff320-150">It creates a copy of hello database from its latest geo-redundant backup.</span></span>

## <a name="configure-your-database-after-recovery"></a><span data-ttu-id="ff320-151">Configurar o banco de dados após a recuperação</span><span class="sxs-lookup"><span data-stu-id="ff320-151">Configure your database after recovery</span></span>
<span data-ttu-id="ff320-152">Se você estiver usando replicação geográfica failover ou restauração geográfica toorecover de uma interrupção, você deve verificar se Olá conectividade toohello novos bancos de dados está configurado corretamente para que a função de aplicativo normal Olá poderá ser retomada.</span><span class="sxs-lookup"><span data-stu-id="ff320-152">If you are using either geo-replication failover or geo-restore toorecover from an outage, you must make sure that hello connectivity toohello new databases is properly configured so that hello normal application function can be resumed.</span></span> <span data-ttu-id="ff320-153">Isso é uma lista de verificação de tarefas tooget preparado para produção seu banco de dados recuperado.</span><span class="sxs-lookup"><span data-stu-id="ff320-153">This is a checklist of tasks tooget your recovered database production ready.</span></span>

### <a name="update-connection-strings"></a><span data-ttu-id="ff320-154">Atualizar cadeias de conexão</span><span class="sxs-lookup"><span data-stu-id="ff320-154">Update connection strings</span></span>
<span data-ttu-id="ff320-155">Porque o banco de dados recuperado residem em um servidor diferente, você precisa tooupdate toopoint toothat servidor do seu aplicativo conexão cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="ff320-155">Because your recovered database will reside in a different server, you need tooupdate your application’s connection string toopoint toothat server.</span></span>

<span data-ttu-id="ff320-156">Para obter mais informações sobre como alterar as cadeias de caracteres de conexão, consulte o idioma de desenvolvimento apropriadas Olá para sua [biblioteca de conexão](sql-database-libraries.md).</span><span class="sxs-lookup"><span data-stu-id="ff320-156">For more information about changing connection strings, see hello appropriate development language for your [connection library](sql-database-libraries.md).</span></span>

### <a name="configure-firewall-rules"></a><span data-ttu-id="ff320-157">Configurar regras de firewall</span><span class="sxs-lookup"><span data-stu-id="ff320-157">Configure Firewall Rules</span></span>
<span data-ttu-id="ff320-158">Você precisa toomake-se de que Olá regras de firewall configuradas no servidor e na correspondência de banco de dados de saudação aqueles que foram configurados no servidor primário hello e banco de dados primário.</span><span class="sxs-lookup"><span data-stu-id="ff320-158">You need toomake sure that hello firewall rules configured on server and on hello database match those that were configured on hello primary server and primary database.</span></span> <span data-ttu-id="ff320-159">Para saber mais, consulte [Como definir configurações de firewall (Banco de Dados SQL do Azure)](sql-database-configure-firewall-settings.md).</span><span class="sxs-lookup"><span data-stu-id="ff320-159">For more information, see [How to: Configure Firewall Settings (Azure SQL Database)](sql-database-configure-firewall-settings.md).</span></span>

### <a name="configure-logins-and-database-users"></a><span data-ttu-id="ff320-160">Configurar logons e usuários do banco de dados</span><span class="sxs-lookup"><span data-stu-id="ff320-160">Configure logins and database users</span></span>
<span data-ttu-id="ff320-161">Você precisa toomake-se de que todos os logons de saudação usados pelo seu aplicativo existem no servidor de saudação que está hospedando o banco de dados recuperado.</span><span class="sxs-lookup"><span data-stu-id="ff320-161">You need toomake sure that all hello logins used by your application exist on hello server which is hosting your recovered database.</span></span> <span data-ttu-id="ff320-162">Para saber mais, confira [Configuração de segurança para replicação geográfica](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="ff320-162">For more information, see [Security Configuration for geo-replication](sql-database-geo-replication-security-config.md).</span></span>

> [!NOTE]
> <span data-ttu-id="ff320-163">Você deve configurar e testar suas regras de firewall de servidor e logons (e suas permissões) durante uma análise de recuperação de desastre.</span><span class="sxs-lookup"><span data-stu-id="ff320-163">You should configure and test your server firewall rules and logins (and their permissions) during a disaster recovery drill.</span></span> <span data-ttu-id="ff320-164">Esses objetos de nível de servidor e suas configurações podem não estar disponíveis durante a interrupção de saudação.</span><span class="sxs-lookup"><span data-stu-id="ff320-164">These server-level objects and their configuration may not be available during hello outage.</span></span>
> 
> 

### <a name="setup-telemetry-alerts"></a><span data-ttu-id="ff320-165">Configurar alertas de telemetria</span><span class="sxs-lookup"><span data-stu-id="ff320-165">Setup telemetry alerts</span></span>
<span data-ttu-id="ff320-166">É necessário toomake se que as configurações de regra de alerta existentes são atualizados toomap toohello banco de dados e hello diferente servidor recuperado.</span><span class="sxs-lookup"><span data-stu-id="ff320-166">You need toomake sure your existing alert rule settings are updated toomap toohello recovered database and hello different server.</span></span>

<span data-ttu-id="ff320-167">Para obter mais informações sobre regras de alerta de banco de dados, consulte [Receber notificações de alerta](../monitoring-and-diagnostics/insights-receive-alert-notifications.md) e [Acompanhar a integridade do serviço](../monitoring-and-diagnostics/insights-service-health.md).</span><span class="sxs-lookup"><span data-stu-id="ff320-167">For more information about database alert rules, see [Receive Alert Notifications](../monitoring-and-diagnostics/insights-receive-alert-notifications.md) and [Track Service Health](../monitoring-and-diagnostics/insights-service-health.md).</span></span>

### <a name="enable-auditing"></a><span data-ttu-id="ff320-168">Habilitar a auditoria</span><span class="sxs-lookup"><span data-stu-id="ff320-168">Enable auditing</span></span>
<span data-ttu-id="ff320-169">Se a auditoria é necessário tooaccess seu banco de dados, você precisa tooenable auditoria após a recuperação de banco de dados de saudação.</span><span class="sxs-lookup"><span data-stu-id="ff320-169">If auditing is required tooaccess your database, you need tooenable Auditing after hello database recovery.</span></span> <span data-ttu-id="ff320-170">Para obter mais informações, consulte [Auditoria de banco de dados](sql-database-auditing.md).</span><span class="sxs-lookup"><span data-stu-id="ff320-170">For more information, see [Database auditing](sql-database-auditing.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="ff320-171">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="ff320-171">Next steps</span></span>
* <span data-ttu-id="ff320-172">toolearn sobre backups de banco de dados do SQL Azure automatizadas, consulte [backups automatizados de banco de dados SQL](sql-database-automated-backups.md)</span><span class="sxs-lookup"><span data-stu-id="ff320-172">toolearn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md)</span></span>
* <span data-ttu-id="ff320-173">toolearn sobre continuidade design e recuperação de cenários de negócios, consulte [cenários de continuidade](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="ff320-173">toolearn about business continuity design and recovery scenarios, see [Continuity scenarios](sql-database-business-continuity.md)</span></span>
* <span data-ttu-id="ff320-174">toolearn sobre como usar backups automatizados para recuperação, consulte [restaurar um banco de dados de backups de iniciadas pelo serviço de saudação](sql-database-recovery-using-backups.md)</span><span class="sxs-lookup"><span data-stu-id="ff320-174">toolearn about using automated backups for recovery, see [restore a database from hello service-initiated backups](sql-database-recovery-using-backups.md)</span></span>

