---
title: aaaMonitoring desempenho de banco de dados SQL do Azure | Microsoft Docs
description: "Saiba mais sobre opções de saudação para o monitoramento de banco de dados com as ferramentas do Azure e exibições de gerenciamento dinâmico."
keywords: monitoramento de banco de dados, desempenho do banco de dados em nuvem
services: sql-database
documentationcenter: 
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: a2e47475-c955-4a8d-a65c-cbef9a6d9b9f
ms.service: sql-database
ms.custom: monitor & tune
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-management
ms.date: 01/10/2017
ms.author: carlrab
ms.openlocfilehash: b13771183d4ccf37f58e2fc518b9b14de38212dc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="monitoring-database-performance-in-azure-sql-database"></a><span data-ttu-id="cc15d-104">Monitorar o desempenho do banco de dados no Banco de Dados SQL do Azure</span><span class="sxs-lookup"><span data-stu-id="cc15d-104">Monitoring database performance in Azure SQL Database</span></span>
<span data-ttu-id="cc15d-105">Monitorando o desempenho de saudação do banco de dados SQL no Azure inicia com o monitoramento de nível de toohello relativo de utilização de recursos de saudação de desempenho de banco de dados que você escolher.</span><span class="sxs-lookup"><span data-stu-id="cc15d-105">Monitoring hello performance of a SQL database in Azure starts with monitoring hello resource utilization relative toohello level of database performance you choose.</span></span> <span data-ttu-id="cc15d-106">Monitoramento ajuda a determinar se seu banco de dados tem excesso de capacidade ou está tendo problemas para porque os recursos são maximizados e, em seguida, decidir se ele é o nível de desempenho do tempo tooadjust hello e [camada de serviço](sql-database-service-tiers.md) do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="cc15d-106">Monitoring helps you  determine whether your database has excess capacity or is having trouble because resources are maxed out, and then decide whether it's time tooadjust hello performance level and [service tier](sql-database-service-tiers.md) of your database.</span></span> <span data-ttu-id="cc15d-107">Você pode monitorar seu banco de dados usando ferramentas gráficas Olá [portal do Azure](https://portal.azure.com) ou usando o SQL [exibições de gerenciamento dinâmico](https://msdn.microsoft.com/library/ms188754.aspx).</span><span class="sxs-lookup"><span data-stu-id="cc15d-107">You can monitor your database using graphical tools in hello [Azure portal](https://portal.azure.com) or using SQL [dynamic management views](https://msdn.microsoft.com/library/ms188754.aspx).</span></span>

## <a name="monitor-databases-using-hello-azure-portal"></a><span data-ttu-id="cc15d-108">Monitorar bancos de dados usando Olá portal do Azure</span><span class="sxs-lookup"><span data-stu-id="cc15d-108">Monitor databases using hello Azure portal</span></span>
<span data-ttu-id="cc15d-109">Em Olá [portal do Azure](https://portal.azure.com/), você pode monitorar a utilização de um único banco de dados selecionando-o e clicando em Olá **monitoramento** gráfico.</span><span class="sxs-lookup"><span data-stu-id="cc15d-109">In hello [Azure portal](https://portal.azure.com/), you can monitor a single database’s utilization by selecting your database and clicking hello **Monitoring** chart.</span></span> <span data-ttu-id="cc15d-110">Isso abre uma **métrica** janela que pode ser alterado clicando Olá **Editar gráfico** botão.</span><span class="sxs-lookup"><span data-stu-id="cc15d-110">This brings up a **Metric** window that you can change by clicking hello **Edit chart** button.</span></span> <span data-ttu-id="cc15d-111">Adicione Olá métricas a seguir:</span><span class="sxs-lookup"><span data-stu-id="cc15d-111">Add hello following metrics:</span></span>

* <span data-ttu-id="cc15d-112">Percentual de CPU</span><span class="sxs-lookup"><span data-stu-id="cc15d-112">CPU percentage</span></span>
* <span data-ttu-id="cc15d-113">Porcentagem de DTU</span><span class="sxs-lookup"><span data-stu-id="cc15d-113">DTU percentage</span></span>
* <span data-ttu-id="cc15d-114">Porcentagem de E/S de dados</span><span class="sxs-lookup"><span data-stu-id="cc15d-114">Data IO percentage</span></span>
* <span data-ttu-id="cc15d-115">Percentual de tamanho do banco de dados</span><span class="sxs-lookup"><span data-stu-id="cc15d-115">Database size percentage</span></span>

<span data-ttu-id="cc15d-116">Depois de adicionar essas métricas, você pode continuar tooview em Olá **monitoramento** gráfico com mais detalhes sobre Olá **métrica** janela.</span><span class="sxs-lookup"><span data-stu-id="cc15d-116">Once you’ve added these metrics, you can continue tooview them in hello **Monitoring** chart with more details on hello **Metric** window.</span></span> <span data-ttu-id="cc15d-117">Todas as métricas de quatro mostram Olá utilização média porcentagem relativa toohello **DTU** do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="cc15d-117">All four metrics show hello average utilization percentage relative toohello **DTU** of your database.</span></span> <span data-ttu-id="cc15d-118">Consulte Olá [camadas de serviço](sql-database-service-tiers.md) artigo para obter detalhes sobre DTUs.</span><span class="sxs-lookup"><span data-stu-id="cc15d-118">See hello [service tiers](sql-database-service-tiers.md) article for details about DTUs.</span></span>

![Monitoramento da camada de serviço do desempenho do banco de dados.](./media/sql-database-service-tiers/sqldb_service_tier_monitoring.png)

<span data-ttu-id="cc15d-120">Você também pode configurar alertas em métricas de desempenho de saudação.</span><span class="sxs-lookup"><span data-stu-id="cc15d-120">You can also configure alerts on hello performance metrics.</span></span> <span data-ttu-id="cc15d-121">Clique em Olá **adicionar alerta** botão Olá **métrica** janela.</span><span class="sxs-lookup"><span data-stu-id="cc15d-121">Click hello **Add alert** button in hello **Metric** window.</span></span> <span data-ttu-id="cc15d-122">Siga Olá Assistente tooconfigure o alerta.</span><span class="sxs-lookup"><span data-stu-id="cc15d-122">Follow hello wizard tooconfigure your alert.</span></span> <span data-ttu-id="cc15d-123">Você tem Olá opção tooalert se métricas Olá excederem um determinado limite ou se Olá ficarem abaixo de determinado limite.</span><span class="sxs-lookup"><span data-stu-id="cc15d-123">You have hello option tooalert if hello metrics exceed a certain threshold or if hello metric falls below a certain threshold.</span></span>

<span data-ttu-id="cc15d-124">Por exemplo, se você espera que a carga de trabalho de saudação em toogrow seu banco de dados, você pode escolher tooconfigure um alerta por email sempre que seu banco de dados atinge 80% em qualquer uma das métricas de desempenho de saudação.</span><span class="sxs-lookup"><span data-stu-id="cc15d-124">For example, if you expect hello workload on your database toogrow, you can choose tooconfigure an email alert whenever your database reaches 80% on any of hello performance metrics.</span></span> <span data-ttu-id="cc15d-125">Você pode usar isso como um toofigure aviso antecipado out quando você pode ter tooswitch toohello próximo nível mais alto desempenho.</span><span class="sxs-lookup"><span data-stu-id="cc15d-125">You can use this as an early warning toofigure out when you might have tooswitch toohello next higher performance level.</span></span>

<span data-ttu-id="cc15d-126">métricas de desempenho de saudação também podem ajudar a determinar se são capazes de toodowngrade tooa nível de desempenho inferior.</span><span class="sxs-lookup"><span data-stu-id="cc15d-126">hello performance metrics can also help you determine if you are able toodowngrade tooa lower performance level.</span></span> <span data-ttu-id="cc15d-127">Suponha que você estiver usando um banco de dados em Standard S2 e todas as mostram de métricas de desempenho que Olá em média o banco de dados não usa mais de 10% a qualquer momento.</span><span class="sxs-lookup"><span data-stu-id="cc15d-127">Assume you are using a Standard S2 database and all performance metrics show that hello database on average does not use more than 10% at any given time.</span></span> <span data-ttu-id="cc15d-128">É provável que esse banco de dados Olá funcionará bem no Standard S1.</span><span class="sxs-lookup"><span data-stu-id="cc15d-128">It is likely that hello database will work well in Standard S1.</span></span> <span data-ttu-id="cc15d-129">No entanto, lembre-se de cargas de trabalho que apresentam picos ou oscilam antes de fazer Olá decisão toomove tooa nível de desempenho inferior.</span><span class="sxs-lookup"><span data-stu-id="cc15d-129">However, be aware of workloads that spike or fluctuate before making hello decision toomove tooa lower performance level.</span></span>

## <a name="monitor-databases-using-dmvs"></a><span data-ttu-id="cc15d-130">Monitorar bancos de dados usando DMVs</span><span class="sxs-lookup"><span data-stu-id="cc15d-130">Monitor databases using DMVs</span></span>
<span data-ttu-id="cc15d-131">Olá mesmas métricas que são expostas no portal de saudação também estão disponíveis por meio de exibições do sistema: [sys. resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) em Olá lógica **mestre** banco de dados do servidor, e [sys.dm_db_ resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) no banco de dados de usuário de saudação.</span><span class="sxs-lookup"><span data-stu-id="cc15d-131">hello same metrics that are exposed in hello portal are also available through system views: [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) in hello logical **master** database of your server, and [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) in hello user database.</span></span> <span data-ttu-id="cc15d-132">Use **sys. resource_stats** se você precisar toomonitor menos dados granulares em um período de tempo maior.</span><span class="sxs-lookup"><span data-stu-id="cc15d-132">Use **sys.resource_stats** if you need toomonitor less granular data across a longer period of time.</span></span> <span data-ttu-id="cc15d-133">Use **sys.DM db_resource_stats** se você precisar toomonitor dados mais granulares em um período de tempo menor.</span><span class="sxs-lookup"><span data-stu-id="cc15d-133">Use **sys.dm_db_resource_stats** if you need toomonitor more granular data within a smaller time frame.</span></span> <span data-ttu-id="cc15d-134">Para obter mais informações, veja [Orientação sobre o desempenho do Banco de Dados SQL do Azure](sql-database-single-database-monitor.md#monitor-resource-use).</span><span class="sxs-lookup"><span data-stu-id="cc15d-134">For more information, see [Azure SQL Database Performance Guidance](sql-database-single-database-monitor.md#monitor-resource-use).</span></span>

> [!NOTE]
> <span data-ttu-id="cc15d-135">**sys.dm_db_resource_stats** retorna um conjunto de resultados vazio quando usado em bancos de dados Web e Business Edition, que estão desativados.</span><span class="sxs-lookup"><span data-stu-id="cc15d-135">**sys.dm_db_resource_stats** returns an empty result set when used in Web and Business edition databases, which are retired.</span></span>
>
>

### <a name="monitor-resource-use"></a><span data-ttu-id="cc15d-136">Monitorar o uso de recursos</span><span class="sxs-lookup"><span data-stu-id="cc15d-136">Monitor resource use</span></span>

<span data-ttu-id="cc15d-137">Você pode monitorar o uso de recursos usando a [Análise de Desempenho de Consultas de Banco de Dados SQL](sql-database-query-performance.md) e [Repositório de Consultas](https://msdn.microsoft.com/library/dn817826.aspx).</span><span class="sxs-lookup"><span data-stu-id="cc15d-137">You can monitor resource usage using [SQL Database Query Performance Insight](sql-database-query-performance.md) and [Query Store](https://msdn.microsoft.com/library/dn817826.aspx).</span></span>

<span data-ttu-id="cc15d-138">Você também pode monitorar o uso com estes dois modos de exibição:</span><span class="sxs-lookup"><span data-stu-id="cc15d-138">You can also monitor usage using these two views:</span></span>

* [<span data-ttu-id="cc15d-139">sys.dm_db_resource_stats</span><span class="sxs-lookup"><span data-stu-id="cc15d-139">sys.dm_db_resource_stats</span></span>](https://msdn.microsoft.com/library/dn800981.aspx)
* [<span data-ttu-id="cc15d-140">sys.resource_stats</span><span class="sxs-lookup"><span data-stu-id="cc15d-140">sys.resource_stats</span></span>](https://msdn.microsoft.com/library/dn269979.aspx)

#### <a name="sysdmdbresourcestats"></a><span data-ttu-id="cc15d-141">sys.dm_db_resource_stats</span><span class="sxs-lookup"><span data-stu-id="cc15d-141">sys.dm_db_resource_stats</span></span>
<span data-ttu-id="cc15d-142">Você pode usar o hello [sys.DM db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) exibição em cada banco de dados SQL.</span><span class="sxs-lookup"><span data-stu-id="cc15d-142">You can use hello [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) view in every SQL database.</span></span> <span data-ttu-id="cc15d-143">Olá **sys.DM db_resource_stats** exibição mostra a camada de serviço de toohello relativo de dados do recurso uso recente.</span><span class="sxs-lookup"><span data-stu-id="cc15d-143">hello **sys.dm_db_resource_stats** view shows recent resource use data relative toohello service tier.</span></span> <span data-ttu-id="cc15d-144">A porcentagem média de CPU, E/S de dados, gravações de log e memória é registrada a cada 15 segundos e armazenada por 1 hora.</span><span class="sxs-lookup"><span data-stu-id="cc15d-144">Average percentages for CPU, data I/O, log writes, and memory are recorded every 15 seconds and are maintained for 1 hour.</span></span>

<span data-ttu-id="cc15d-145">Como essa exibição oferece uma visão mais granular do uso de recursos, use **sys.dm_db_resource_stats** primeiro para qualquer análise de estado atual ou para solução de problemas.</span><span class="sxs-lookup"><span data-stu-id="cc15d-145">Because this view provides a more granular look at resource use, use **sys.dm_db_resource_stats** first for any current-state analysis or troubleshooting.</span></span> <span data-ttu-id="cc15d-146">Por exemplo, esta consulta mostra recursos máximo e média de saudação usam para banco de dados atual Olá Olá última hora:</span><span class="sxs-lookup"><span data-stu-id="cc15d-146">For example, this query shows hello average and maximum resource use for hello current database over hello past hour:</span></span>

    SELECT  
        AVG(avg_cpu_percent) AS 'Average CPU use in percent',
        MAX(avg_cpu_percent) AS 'Maximum CPU use in percent',
        AVG(avg_data_io_percent) AS 'Average data I/O in percent',
        MAX(avg_data_io_percent) AS 'Maximum data I/O in percent',
        AVG(avg_log_write_percent) AS 'Average log write use in percent',
        MAX(avg_log_write_percent) AS 'Maximum log write use in percent',
        AVG(avg_memory_usage_percent) AS 'Average memory use in percent',
        MAX(avg_memory_usage_percent) AS 'Maximum memory use in percent'
    FROM sys.dm_db_resource_stats;  

<span data-ttu-id="cc15d-147">Para outras consultas, consulte os exemplos de saudação em [sys.DM db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx).</span><span class="sxs-lookup"><span data-stu-id="cc15d-147">For other queries, see hello examples in [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx).</span></span>

#### <a name="sysresourcestats"></a><span data-ttu-id="cc15d-148">sys.resource_stats</span><span class="sxs-lookup"><span data-stu-id="cc15d-148">sys.resource_stats</span></span>
<span data-ttu-id="cc15d-149">Olá [sys. resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) exibição no hello **mestre** banco de dados tem informações adicionais que podem ajudá-lo a monitorar o desempenho de saudação do banco de dados SQL em seu nível de desempenho e da camada de serviço específico .</span><span class="sxs-lookup"><span data-stu-id="cc15d-149">hello [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) view in hello **master** database has additional information that can help you monitor hello performance of your SQL database at its specific service tier and performance level.</span></span> <span data-ttu-id="cc15d-150">Olá dados são coletados a cada 5 minutos e são mantidos por aproximadamente 35 dias.</span><span class="sxs-lookup"><span data-stu-id="cc15d-150">hello data is collected every 5 minutes and is maintained for approximately 35 days.</span></span> <span data-ttu-id="cc15d-151">Essa exibição é útil para uma análise de histórico de longo prazo de como seu banco de dados SQL usa recursos.</span><span class="sxs-lookup"><span data-stu-id="cc15d-151">This view is useful for a longer-term historical analysis of how your SQL database uses resources.</span></span>

<span data-ttu-id="cc15d-152">Olá gráfico a seguir mostra uso de recursos de CPU Olá para um banco de dados Premium Olá nível de desempenho P2 para cada hora em uma semana.</span><span class="sxs-lookup"><span data-stu-id="cc15d-152">hello following graph shows hello CPU resource use for a Premium database with hello P2 performance level for each hour in a week.</span></span> <span data-ttu-id="cc15d-153">Esse gráfico começa na segunda-feira, mostra 5 dias de trabalho e, em seguida, exibe um fim de semana, quando muito menos acontece no aplicativo hello.</span><span class="sxs-lookup"><span data-stu-id="cc15d-153">This graph starts on a Monday, shows 5 work days, and then shows a weekend, when much less happens on hello application.</span></span>

![Uso de recursos de banco de dados SQL](./media/sql-database-performance-guidance/sql_db_resource_utilization.png)

<span data-ttu-id="cc15d-155">Olá pelos dados do, este banco de dados atualmente tem um pico de carga de CPU de pouco mais de 50% CPU usam o nível de desempenho relativo toohello P2 (meio-dia de terça-feira).</span><span class="sxs-lookup"><span data-stu-id="cc15d-155">From hello data, this database currently has a peak CPU load of just over 50 percent CPU use relative toohello P2 performance level (midday on Tuesday).</span></span> <span data-ttu-id="cc15d-156">Se a CPU é o fator dominante no perfil de recursos do aplicativo hello de hello, você pode decidir que P2 é hello direito tooguarantee de nível de desempenho que Olá a carga de trabalho sempre se ajuste.</span><span class="sxs-lookup"><span data-stu-id="cc15d-156">If CPU is hello dominant factor in hello application’s resource profile, then you might decide that P2 is hello right performance level tooguarantee that hello workload always fits.</span></span> <span data-ttu-id="cc15d-157">Se você espera que um aplicativo toogrow ao longo do tempo, é uma boa ideia toohave um buffer adicional do recurso para que o aplicativo hello já não atinge o limite de nível de desempenho de saudação.</span><span class="sxs-lookup"><span data-stu-id="cc15d-157">If you expect an application toogrow over time, it's a good idea toohave an extra resource buffer so that hello application doesn't ever reach hello performance-level limit.</span></span> <span data-ttu-id="cc15d-158">Se você aumentar o nível de desempenho hello, você pode ajudar a evitar erros visíveis para os clientes que podem ocorrer quando um banco de dados não tem suficiente solicitações de tooprocess power efetivamente, especialmente em ambientes sensíveis à latência.</span><span class="sxs-lookup"><span data-stu-id="cc15d-158">If you increase hello performance level, you can help avoid customer-visible errors that might occur when a database doesn't have enough power tooprocess requests effectively, especially in latency-sensitive environments.</span></span> <span data-ttu-id="cc15d-159">Um exemplo é um banco de dados que oferece suporte a um aplicativo que pinta páginas da Web com base nos resultados de saudação de chamadas de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="cc15d-159">An example is a database that supports an application that paints webpages based on hello results of database calls.</span></span>

<span data-ttu-id="cc15d-160">Outros tipos de aplicativos podem interpretar Olá mesmo gráfico de forma diferente.</span><span class="sxs-lookup"><span data-stu-id="cc15d-160">Other application types might interpret hello same graph differently.</span></span> <span data-ttu-id="cc15d-161">Por exemplo, se um aplicativo tenta tooprocess dados de folha de pagamento por dia e tem Olá mesmo gráfico, nesse tipo de modelo de "trabalho em lotes" pode fazer bem com um nível de desempenho P1.</span><span class="sxs-lookup"><span data-stu-id="cc15d-161">For example, if an application tries tooprocess payroll data each day and has hello same chart, this kind of "batch job" model might do fine at a P1 performance level.</span></span> <span data-ttu-id="cc15d-162">Olá nível de desempenho P1 tem 100 DTUs em relação too200 DTUs no hello nível de desempenho P2.</span><span class="sxs-lookup"><span data-stu-id="cc15d-162">hello P1 performance level has 100 DTUs compared too200 DTUs at hello P2 performance level.</span></span> <span data-ttu-id="cc15d-163">Olá nível de desempenho P1 oferece metade desempenho de saudação de Olá nível de desempenho P2.</span><span class="sxs-lookup"><span data-stu-id="cc15d-163">hello P1 performance level provides half hello performance of hello P2 performance level.</span></span> <span data-ttu-id="cc15d-164">Portanto, 50% de uso da CPU em P2 equivale a 100% de uso da CPU em P1.</span><span class="sxs-lookup"><span data-stu-id="cc15d-164">So, 50 percent of CPU use in P2 equals 100 percent CPU use in P1.</span></span> <span data-ttu-id="cc15d-165">Se o aplicativo hello não têm tempo limite, ele pode não importa se um trabalho demorar 2 horas ou 2,5 horas toofinish, a se seja feito hoje.</span><span class="sxs-lookup"><span data-stu-id="cc15d-165">If hello application does not have timeouts, it might not matter if a job takes 2 hours or 2.5 hours toofinish, if it gets done today.</span></span> <span data-ttu-id="cc15d-166">Um aplicativo dessa categoria provavelmente pode usar um nível de desempenho P1.</span><span class="sxs-lookup"><span data-stu-id="cc15d-166">An application in this category probably can use a P1 performance level.</span></span> <span data-ttu-id="cc15d-167">Você pode tirar proveito do fato de saudação que há períodos de tempo durante o dia hello quando o uso de recursos é menor, para que um "pico maior" poderá extrapolar para um dos ciclos de hello mais tarde no dia hello.</span><span class="sxs-lookup"><span data-stu-id="cc15d-167">You can take advantage of hello fact that there are periods of time during hello day when resource use is lower, so that any "big peak" might spill over into one of hello troughs later in hello day.</span></span> <span data-ttu-id="cc15d-168">saudação de nível de desempenho P1 pode ser válida para esse tipo de aplicativo (e economizar dinheiro), como trabalhos Olá podem terminar no tempo por dia.</span><span class="sxs-lookup"><span data-stu-id="cc15d-168">hello P1 performance level might be good for that kind of application (and save money), as long as hello jobs can finish on time each day.</span></span>

<span data-ttu-id="cc15d-169">Expõe de banco de dados SQL do Azure consumido informações de recursos para cada banco de dados ativo no hello **sys. resource_stats** exibição de saudação **mestre** banco de dados em cada servidor.</span><span class="sxs-lookup"><span data-stu-id="cc15d-169">Azure SQL Database exposes consumed resource information for each active database in hello **sys.resource_stats** view of hello **master** database in each server.</span></span> <span data-ttu-id="cc15d-170">dados de saudação na tabela de saudação são agregados para intervalos de 5 minutos.</span><span class="sxs-lookup"><span data-stu-id="cc15d-170">hello data in hello table is aggregated for 5-minute intervals.</span></span> <span data-ttu-id="cc15d-171">Com camadas de serviço de Basic, Standard e Premium da saudação, Olá dados podem demorar mais de 5 minutos tooappear na tabela hello, para que esses dados são mais úteis para análise histórica em vez de análise em tempo quase real.</span><span class="sxs-lookup"><span data-stu-id="cc15d-171">With hello Basic, Standard, and Premium service tiers, hello data can take more than 5 minutes tooappear in hello table, so this data is more useful for historical analysis rather than near-real-time analysis.</span></span> <span data-ttu-id="cc15d-172">Saudação de consulta **sys. resource_stats** exibição toosee Olá histórico recente de um banco de dados e toovalidate se reserva Olá que você escolheu entregues desempenho Olá desejados quando necessário.</span><span class="sxs-lookup"><span data-stu-id="cc15d-172">Query hello **sys.resource_stats** view toosee hello recent history of a database and toovalidate whether hello reservation you chose delivered hello performance you want when needed.</span></span>

> [!NOTE]
> <span data-ttu-id="cc15d-173">Você deve ser conectado toohello **mestre** banco de dados de sua lógica tooquery de servidor de banco de dados SQL **sys. resource_stats** em Olá exemplos a seguir.</span><span class="sxs-lookup"><span data-stu-id="cc15d-173">You must be connected toohello **master** database of your logical SQL database server tooquery **sys.resource_stats** in hello following examples.</span></span>
> 
> 

<span data-ttu-id="cc15d-174">Este exemplo mostra como os dados de saudação nesta exibição são expostos:</span><span class="sxs-lookup"><span data-stu-id="cc15d-174">This example shows you how hello data in this view is exposed:</span></span>

    SELECT TOP 10 *
    FROM sys.resource_stats
    WHERE database_name = 'resource1'
    ORDER BY start_time DESC

![exibição do catálogo sys. resource_stats Olá](./media/sql-database-performance-guidance/sys_resource_stats.png)

<span data-ttu-id="cc15d-176">Olá próximo exemplo mostra diferentes maneiras que você pode usar o hello **sys. resource_stats** tooget de exibir informações sobre como o banco de dados SQL usa recursos do catálogo:</span><span class="sxs-lookup"><span data-stu-id="cc15d-176">hello next example shows you different ways that you can use hello **sys.resource_stats** catalog view tooget information about how your SQL database uses resources:</span></span>

1. <span data-ttu-id="cc15d-177">toolook em Olá após os recursos da semana usado para Olá userdb1 de banco de dados, você pode executar esta consulta:</span><span class="sxs-lookup"><span data-stu-id="cc15d-177">toolook at hello past week’s resource use for hello database userdb1, you can run this query:</span></span>
   
        SELECT *
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND
              start_time > DATEADD(day, -7, GETDATE())
        ORDER BY start_time DESC;
2. <span data-ttu-id="cc15d-178">tooevaluate quão bem sua carga de trabalho se ajusta o nível de desempenho hello, você precisa toodrill para baixo em cada aspecto das métricas de recurso Olá: CPU, leituras, gravações, número de trabalhadores e número de sessões.</span><span class="sxs-lookup"><span data-stu-id="cc15d-178">tooevaluate how well your workload fits hello performance level, you need toodrill down into each aspect of hello resource metrics: CPU, reads, writes, number of workers, and number of sessions.</span></span> <span data-ttu-id="cc15d-179">Aqui está um revisado consultar usando **sys. resource_stats** tooreport Olá valores médio e máximo dessas métricas de recurso:</span><span class="sxs-lookup"><span data-stu-id="cc15d-179">Here's a revised query using **sys.resource_stats** tooreport hello average and maximum values of these resource metrics:</span></span>
   
        SELECT
            avg(avg_cpu_percent) AS 'Average CPU use in percent',
            max(avg_cpu_percent) AS 'Maximum CPU use in percent',
            avg(avg_data_io_percent) AS 'Average physical data I/O use in percent',
            max(avg_data_io_percent) AS 'Maximum physical data I/O use in percent',
            avg(avg_log_write_percent) AS 'Average log write use in percent',
            max(avg_log_write_percent) AS 'Maximum log write use in percent',
            avg(max_session_percent) AS 'Average % of sessions',
            max(max_session_percent) AS 'Maximum % of sessions',
            avg(max_worker_percent) AS 'Average % of workers',
            max(max_worker_percent) AS 'Maximum % of workers'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
3. <span data-ttu-id="cc15d-180">Com essas informações sobre os valores médio e máximo de saudação de cada métrica de recurso, você pode avaliar como sua carga de trabalho se encaixa no nível de desempenho Olá escolhido.</span><span class="sxs-lookup"><span data-stu-id="cc15d-180">With this information about hello average and maximum values of each resource metric, you can assess how well your workload fits into hello performance level you chose.</span></span> <span data-ttu-id="cc15d-181">Geralmente, os valores médios de **sys. resource_stats** lhe toouse uma boa linha de base no tamanho do destino hello.</span><span class="sxs-lookup"><span data-stu-id="cc15d-181">Usually, average values from **sys.resource_stats** give you a good baseline toouse against hello target size.</span></span> <span data-ttu-id="cc15d-182">Deve ser seu cartão de medida principal.</span><span class="sxs-lookup"><span data-stu-id="cc15d-182">It should be your primary measurement stick.</span></span> <span data-ttu-id="cc15d-183">Por exemplo, talvez você esteja usando camada de serviço Standard Olá com nível de desempenho S2.</span><span class="sxs-lookup"><span data-stu-id="cc15d-183">For an example, you might be using hello Standard service tier with S2 performance level.</span></span> <span data-ttu-id="cc15d-184">Média Olá usar porcentagens de CPU e e/s de leituras e gravações estão abaixo 40 por cento, número médio de saudação de trabalhadores for inferior a 50 e número médio de saudação de sessões for inferior a 200.</span><span class="sxs-lookup"><span data-stu-id="cc15d-184">hello average use percentages for CPU and I/O reads and writes are below 40 percent, hello average number of workers is below 50, and hello average number of sessions is below 200.</span></span> <span data-ttu-id="cc15d-185">A carga de trabalho talvez se enquadre no hello nível de desempenho S1.</span><span class="sxs-lookup"><span data-stu-id="cc15d-185">Your workload might fit into hello S1 performance level.</span></span> <span data-ttu-id="cc15d-186">É fácil toosee se seu banco de dados se encaixa no trabalho hello e limites de sessão.</span><span class="sxs-lookup"><span data-stu-id="cc15d-186">It's easy toosee whether your database fits in hello worker and session limits.</span></span> <span data-ttu-id="cc15d-187">toosee se um banco de dados se adapta a um nível de desempenho inferior com considera tooCPU, leituras e gravações, divida o número DTU de saudação do nível de desempenho inferior Olá por Olá número DTU de nível de desempenho atual e, em seguida, multiplique o resultado de saudação por 100:</span><span class="sxs-lookup"><span data-stu-id="cc15d-187">toosee whether a database fits into a lower performance level with regards tooCPU, reads, and writes, divide hello DTU number of hello lower performance level by hello DTU number of your current performance level, and then multiply hello result by 100:</span></span>
   
    <span data-ttu-id="cc15d-188">**S1 DTU / S2 DTU * 100 = 20 / 50 * 100 = 40**</span><span class="sxs-lookup"><span data-stu-id="cc15d-188">**S1 DTU / S2 DTU * 100 = 20 / 50 * 100 = 40**</span></span>
   
    <span data-ttu-id="cc15d-189">resultado de Olá é a diferença de desempenho relativo de saudação entre dois níveis de desempenho hello, em porcentagem.</span><span class="sxs-lookup"><span data-stu-id="cc15d-189">hello result is hello relative performance difference between hello two performance levels in percentage.</span></span> <span data-ttu-id="cc15d-190">Se o uso de recursos não exceder esse valor, a carga de trabalho talvez se enquadre no nível de desempenho inferior hello.</span><span class="sxs-lookup"><span data-stu-id="cc15d-190">If your resource use doesn't exceed this amount, your workload might fit into hello lower performance level.</span></span> <span data-ttu-id="cc15d-191">No entanto, você precisa toolook todos os intervalos de valores de uso de recursos e determinar, por percentual, quantas vezes sua carga de trabalho do banco de dados se enquadraria no nível de desempenho inferior Olá.</span><span class="sxs-lookup"><span data-stu-id="cc15d-191">However, you need toolook at all ranges of resource use values, and determine, by percentage, how often your database workload would fit into hello lower performance level.</span></span> <span data-ttu-id="cc15d-192">Olá consulta a seguir produz Olá ajustar percentual por dimensão de recurso com base no limite de saudação de 40 por cento calculado neste exemplo:</span><span class="sxs-lookup"><span data-stu-id="cc15d-192">hello following query outputs hello fit percentage per resource dimension, based on hello threshold of 40 percent that we calculated in this example:</span></span>
   
        SELECT
            (COUNT(database_name) - SUM(CASE WHEN avg_cpu_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'CPU Fit Percent'
            ,(COUNT(database_name) - SUM(CASE WHEN avg_log_write_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Log Write Fit Percent'
            ,(COUNT(database_name) - SUM(CASE WHEN avg_data_io_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Physical Data IO Fit Percent'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
   
    <span data-ttu-id="cc15d-193">Com base no seu objetivo de nível de serviço (SLO) do banco de dados, você pode decidir se sua carga de trabalho se encaixa no nível de desempenho inferior hello.</span><span class="sxs-lookup"><span data-stu-id="cc15d-193">Based on your database service level objective (SLO), you can decide whether your workload fits into hello lower performance level.</span></span> <span data-ttu-id="cc15d-194">Se sua carga de trabalho do banco de dados SLO é de 99,9% e hello consulta acima retorna valores superiores a 99,9% de todas as três dimensões de recurso, sua carga de trabalho provavelmente se enquadra no nível de desempenho inferior hello.</span><span class="sxs-lookup"><span data-stu-id="cc15d-194">If your database workload SLO is 99.9 percent and hello preceding query returns values greater than 99.9 percent for all three resource dimensions, your workload likely fits into hello lower performance level.</span></span>
   
    <span data-ttu-id="cc15d-195">Observando a porcentagem de saudação ajustar também oferece informações sobre se deve-se mover toohello próximo maior toomeet da nível do desempenho seu SLO.</span><span class="sxs-lookup"><span data-stu-id="cc15d-195">Looking at hello fit percentage also gives you insight into whether you should move toohello next higher performance level toomeet your SLO.</span></span> <span data-ttu-id="cc15d-196">Por exemplo, userdb1 mostra Olá uso da CPU para Olá semana passada a seguir:</span><span class="sxs-lookup"><span data-stu-id="cc15d-196">For example, userdb1 shows hello following CPU use for hello past week:</span></span>
   
   | <span data-ttu-id="cc15d-197">Percentual médio da CPU</span><span class="sxs-lookup"><span data-stu-id="cc15d-197">Average CPU percent</span></span> | <span data-ttu-id="cc15d-198">Percentual máximo da CPU</span><span class="sxs-lookup"><span data-stu-id="cc15d-198">Maximum CPU percent</span></span> |
   | --- | --- |
   | <span data-ttu-id="cc15d-199">24,5</span><span class="sxs-lookup"><span data-stu-id="cc15d-199">24.5</span></span> |<span data-ttu-id="cc15d-200">100,00</span><span class="sxs-lookup"><span data-stu-id="cc15d-200">100.00</span></span> |
   
    <span data-ttu-id="cc15d-201">Olá média de CPU é aproximadamente um quarto do limite de saudação do nível de desempenho hello, que se ajusta bem ao nível de desempenho de saudação do banco de dados de saudação.</span><span class="sxs-lookup"><span data-stu-id="cc15d-201">hello average CPU is about a quarter of hello limit of hello performance level, which would fit well into hello performance level of hello database.</span></span> <span data-ttu-id="cc15d-202">Mas, o valor máximo Olá mostra que esse banco de dados Olá atinge o limite de saudação de nível de desempenho de saudação.</span><span class="sxs-lookup"><span data-stu-id="cc15d-202">But, hello maximum value shows that hello database reaches hello limit of hello performance level.</span></span> <span data-ttu-id="cc15d-203">Você precisa toomove toohello próximo nível mais alto desempenho?</span><span class="sxs-lookup"><span data-stu-id="cc15d-203">Do you need toomove toohello next higher performance level?</span></span> <span data-ttu-id="cc15d-204">Analisar quantas vezes sua carga de trabalho atinge 100 por cento e, em seguida, compare-a carga de trabalho do banco de dados do tooyour SLO.</span><span class="sxs-lookup"><span data-stu-id="cc15d-204">Look at how many times your workload reaches 100 percent, and then compare it tooyour database workload SLO.</span></span>
   
        SELECT
        (COUNT(database_name) - SUM(CASE WHEN avg_cpu_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'CPU fit percent'
        ,(COUNT(database_name) - SUM(CASE WHEN avg_log_write_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Log write fit percent'
        ,(COUNT(database_name) - SUM(CASE WHEN avg_data_io_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Physical data I/O fit percent'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
   
    <span data-ttu-id="cc15d-205">Se esta consulta retorna um valor inferior a 99,9% para qualquer uma das dimensões de recurso Olá três, considere qualquer movimentação toohello próximo nível mais alto desempenho ou usar o ajuste de aplicativo de técnicas tooreduce Olá carga no banco de dados SQL hello.</span><span class="sxs-lookup"><span data-stu-id="cc15d-205">If this query returns a value less than 99.9 percent for any of hello three resource dimensions, consider either moving toohello next higher performance level or use application-tuning techniques tooreduce hello load on hello SQL database.</span></span>
4. <span data-ttu-id="cc15d-206">Este exercício também considera o aumento da carga de trabalho projetada no hello futuras.</span><span class="sxs-lookup"><span data-stu-id="cc15d-206">This exercise also considers your projected workload increase in hello future.</span></span>

<span data-ttu-id="cc15d-207">Para pools Elásticos, você pode monitorar os bancos de dados individuais no pool de saudação com técnicas de saudação descritas nesta seção.</span><span class="sxs-lookup"><span data-stu-id="cc15d-207">For elastic pools, you can monitor individual databases in hello pool with hello techniques described in this section.</span></span> <span data-ttu-id="cc15d-208">Mas você também pode monitorar o pool hello como um todo.</span><span class="sxs-lookup"><span data-stu-id="cc15d-208">But you can also monitor hello pool as a whole.</span></span> <span data-ttu-id="cc15d-209">Para saber mais, veja [Monitorar e gerenciar um pool elásticos](sql-database-elastic-pool-manage-portal.md).</span><span class="sxs-lookup"><span data-stu-id="cc15d-209">For information, see [Monitor and manage an elastic pool](sql-database-elastic-pool-manage-portal.md).</span></span>


### <a name="maximum-concurrent-requests"></a><span data-ttu-id="cc15d-210">Máximo de solicitações simultâneas</span><span class="sxs-lookup"><span data-stu-id="cc15d-210">Maximum concurrent requests</span></span>
<span data-ttu-id="cc15d-211">número de saudação toosee de solicitações simultâneas, execute esta consulta Transact-SQL no banco de dados SQL:</span><span class="sxs-lookup"><span data-stu-id="cc15d-211">toosee hello number of concurrent requests, run this Transact-SQL query on your SQL database:</span></span>

    SELECT COUNT(*) AS [Concurrent_Requests]
    FROM sys.dm_exec_requests R

<span data-ttu-id="cc15d-212">carga de trabalho do tooanalyze Olá de um banco de dados local do SQL Server, modificar essa consulta toofilter no banco de dados específico Olá você deseja tooanalyze.</span><span class="sxs-lookup"><span data-stu-id="cc15d-212">tooanalyze hello workload of an on-premises SQL Server database, modify this query toofilter on hello specific database you want tooanalyze.</span></span> <span data-ttu-id="cc15d-213">Por exemplo, se você tiver um banco de dados local denominado MyDatabase, essa consulta Transact-SQL retorna contagem de saudação de solicitações simultâneas no banco de dados:</span><span class="sxs-lookup"><span data-stu-id="cc15d-213">For example, if you have an on-premises database named MyDatabase, this Transact-SQL query returns hello count of concurrent requests in that database:</span></span>

    SELECT COUNT(*) AS [Concurrent_Requests]
    FROM sys.dm_exec_requests R
    INNER JOIN sys.databases D ON D.database_id = R.database_id
    AND D.name = 'MyDatabase'

<span data-ttu-id="cc15d-214">Isso é apenas um instantâneo em um único ponto no tempo.</span><span class="sxs-lookup"><span data-stu-id="cc15d-214">This is just a snapshot at a single point in time.</span></span> <span data-ttu-id="cc15d-215">tooget melhor compreensão de seus requisitos de solicitações simultâneas e a carga de trabalho, você precisará toocollect muitas amostras ao longo do tempo.</span><span class="sxs-lookup"><span data-stu-id="cc15d-215">tooget a better understanding of your workload and concurrent request requirements, you'll need toocollect many samples over time.</span></span>

### <a name="maximum-concurrent-logins"></a><span data-ttu-id="cc15d-216">Máximo de logons simultâneos</span><span class="sxs-lookup"><span data-stu-id="cc15d-216">Maximum concurrent logins</span></span>
<span data-ttu-id="cc15d-217">Você pode analisar seu tooget de padrões de usuário e aplicativo uma ideia de frequência de saudação de logons.</span><span class="sxs-lookup"><span data-stu-id="cc15d-217">You can analyze your user and application patterns tooget an idea of hello frequency of logins.</span></span> <span data-ttu-id="cc15d-218">Você também pode executar cargas reais em um toomake do ambiente de teste-se de que você não está atingindo isso ou outros limites que discutimos neste artigo.</span><span class="sxs-lookup"><span data-stu-id="cc15d-218">You also can run real-world loads in a test environment toomake sure that you're not hitting this or other limits we discuss in this article.</span></span> <span data-ttu-id="cc15d-219">Não há uma única consulta ou DMV (exibição de gerenciamento dinâmico) que mostre a contagem de logons simultâneos ou o histórico.</span><span class="sxs-lookup"><span data-stu-id="cc15d-219">There isn’t a single query or dynamic management view (DMV) that can show you concurrent login counts or history.</span></span>

<span data-ttu-id="cc15d-220">Se usam vários clientes Olá a mesma cadeia de caracteres de conexão, hello serviço autentica a cada logon.</span><span class="sxs-lookup"><span data-stu-id="cc15d-220">If multiple clients use hello same connection string, hello service authenticates each login.</span></span> <span data-ttu-id="cc15d-221">Se 10 usuários se conectar simultaneamente Olá de tooa banco de dados usando o mesmo nome de usuário e senha, seria 10 logons simultâneos.</span><span class="sxs-lookup"><span data-stu-id="cc15d-221">If 10 users simultaneously connect tooa database by using hello same username and password, there would be 10 concurrent logins.</span></span> <span data-ttu-id="cc15d-222">Esse limite se aplica apenas toohello duração de logon hello e autenticação.</span><span class="sxs-lookup"><span data-stu-id="cc15d-222">This limit applies only toohello duration of hello login and authentication.</span></span> <span data-ttu-id="cc15d-223">Se Olá mesmo 10 usuários se conectam a banco de dados toohello sequencialmente, número de saudação de logons simultâneos nunca ser maior que 1.</span><span class="sxs-lookup"><span data-stu-id="cc15d-223">If hello same 10 users connect toohello database sequentially, hello number of concurrent logins would never be greater than 1.</span></span>

> [!NOTE]
> <span data-ttu-id="cc15d-224">Atualmente, esse limite não se aplica a toodatabases em pools elásticos.</span><span class="sxs-lookup"><span data-stu-id="cc15d-224">Currently, this limit does not apply toodatabases in elastic pools.</span></span>
> 
> 

### <a name="maximum-sessions"></a><span data-ttu-id="cc15d-225">Máximo de sessões</span><span class="sxs-lookup"><span data-stu-id="cc15d-225">Maximum sessions</span></span>
<span data-ttu-id="cc15d-226">número de saudação toosee de sessões ativas atuais, execute esta consulta de Transact-SQL no banco de dados SQL:</span><span class="sxs-lookup"><span data-stu-id="cc15d-226">toosee hello number of current active sessions, run this Transact-SQL query on your SQL database:</span></span>

    SELECT COUNT(*) AS [Sessions]
    FROM sys.dm_exec_connections

<span data-ttu-id="cc15d-227">Se você estiver analisando uma carga de trabalho do SQL Server local, modifique Olá toofocus de consulta em um banco de dados específico.</span><span class="sxs-lookup"><span data-stu-id="cc15d-227">If you're analyzing an on-premises SQL Server workload, modify hello query toofocus on a specific database.</span></span> <span data-ttu-id="cc15d-228">Essa consulta ajuda a determinar as necessidades de sessão possíveis para o banco de dados de saudação se você estiver considerando movê-lo tooAzure banco de dados SQL.</span><span class="sxs-lookup"><span data-stu-id="cc15d-228">This query helps you determine possible session needs for hello database if you are considering moving it tooAzure SQL Database.</span></span>

    SELECT COUNT(*)  AS [Sessions]
    FROM sys.dm_exec_connections C
    INNER JOIN sys.dm_exec_sessions S ON (S.session_id = C.session_id)
    INNER JOIN sys.databases D ON (D.database_id = S.database_id)
    WHERE D.name = 'MyDatabase'

<span data-ttu-id="cc15d-229">Novamente, essas consultas retornam uma contagem pontual.</span><span class="sxs-lookup"><span data-stu-id="cc15d-229">Again, these queries return a point-in-time count.</span></span> <span data-ttu-id="cc15d-230">Se você coletar várias amostras ao longo do tempo, você terá melhor compreensão de saudação da sessão de usar.</span><span class="sxs-lookup"><span data-stu-id="cc15d-230">If you collect multiple samples over time, you’ll have hello best understanding of your session use.</span></span>

<span data-ttu-id="cc15d-231">Para análise de banco de dados SQL, você pode obter estatísticas históricas sobre as sessões consultando Olá [sys. resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) exibir e revisar Olá **active_session_count** coluna.</span><span class="sxs-lookup"><span data-stu-id="cc15d-231">For SQL Database analysis, you can get historical statistics on sessions by querying hello [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) view and reviewing hello **active_session_count** column.</span></span> 
