---
title: "Visão geral da consulta elástica do Banco de Dados SQL do Azure | Microsoft Docs"
description: "Visão geral do recurso de consulta elástica"
services: sql-database
documentationcenter: 
manager: jhubbard
author: MladjoA
ms.assetid: a8bf0e2c-bc74-44d0-9b1e-bcc9a6aa2e33
ms.service: sql-database
ms.custom: scale out apps
ms.workload: sql-database
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/27/2016
ms.author: mlandzic
ms.openlocfilehash: 9b3151248a1d036117bbdc9af03a98dff71ca535
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/18/2017
---
# <a name="azure-sql-database-elastic-query-overview-preview"></a><span data-ttu-id="f0016-103">Visão geral da consulta elástica do Banco de Dados SQL do Azure (visualização)</span><span class="sxs-lookup"><span data-stu-id="f0016-103">Azure SQL Database elastic query overview (preview)</span></span>
<span data-ttu-id="f0016-104">O recurso de consulta elástica (em visualização) permite que você execute uma consulta Transact-SQL que abrange vários bancos de dados no Banco de Dados SQL do Azure.</span><span class="sxs-lookup"><span data-stu-id="f0016-104">The elastic query feature (in preview) enables you to run a Transact-SQL query that spans multiple databases in Azure SQL Database.</span></span> <span data-ttu-id="f0016-105">Ele permite que você realize consultas entre bancos de dados para acessar tabelas remotas e se conectar a ferramentas da Microsoft e de terceiros (Excel, Power BI, Tableau, etc.) para consultar em diferentes camadas de dados com vários bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="f0016-105">It allows you to perform cross-database queries to access remote tables, and to connect Microsoft and third party tools (Excel, PowerBI, Tableau, etc.) to query across data tiers with multiple databases.</span></span> <span data-ttu-id="f0016-106">Usando esse recurso, você pode escalar horizontalmente para camadas de dados grandes no Banco de Dados SQL e visualizar os resultados em relatórios do BI (business intelligence).</span><span class="sxs-lookup"><span data-stu-id="f0016-106">Using this feature, you can scale out queries to large data tiers in SQL Database and visualize the results in business intelligence (BI) reports.</span></span>


## <a name="why-use-elastic-queries"></a><span data-ttu-id="f0016-107">Por que usar consultas elásticas?</span><span class="sxs-lookup"><span data-stu-id="f0016-107">Why use elastic queries?</span></span>

<span data-ttu-id="f0016-108">**Banco de Dados SQL do Azure**</span><span class="sxs-lookup"><span data-stu-id="f0016-108">**Azure SQL Database**</span></span>

<span data-ttu-id="f0016-109">Consulte em bancos de dados SQL do Azure totalmente em T-SQL.</span><span class="sxs-lookup"><span data-stu-id="f0016-109">Query across Azure SQL databases completely in T-SQL.</span></span> <span data-ttu-id="f0016-110">Isso permite consultas somente leitura de bancos de dados remotos.</span><span class="sxs-lookup"><span data-stu-id="f0016-110">This allows for read-only querying of remote databases.</span></span> <span data-ttu-id="f0016-111">Isso fornece uma opção para que os clientes atuais do SQL Server local migrem aplicativos que usam nomes de três e quatro partes ou um servidor vinculado ao Banco de Dados SQL.</span><span class="sxs-lookup"><span data-stu-id="f0016-111">This provides an option for current on-premises SQL Server customers to migrate applications using three- and four-part names or linked server to SQL DB.</span></span>

<span data-ttu-id="f0016-112">**Disponível no nível Standard**</span><span class="sxs-lookup"><span data-stu-id="f0016-112">**Available on standard tier**</span></span>

<span data-ttu-id="f0016-113">Há suporte para a consulta elástica no nível de desempenho Standard, além do nível de desempenho Premium.</span><span class="sxs-lookup"><span data-stu-id="f0016-113">Elastic query is supported on the Standard performance tier in addition to the Premium performance tier.</span></span> <span data-ttu-id="f0016-114">Veja a seção sobre Limitações da Preview abaixo sobre os limitações de desempenho para os níveis de desempenho inferiores.</span><span class="sxs-lookup"><span data-stu-id="f0016-114">See the section on Preview Limitations below on performance limitations for lower performance tiers.</span></span>

<span data-ttu-id="f0016-115">**Enviar por push para bancos de dados remotos**</span><span class="sxs-lookup"><span data-stu-id="f0016-115">**Push to remote databases**</span></span>

<span data-ttu-id="f0016-116">As consultas elásticas agora podem enviar por push parâmetros SQL para os bancos de dados remotos para execução.</span><span class="sxs-lookup"><span data-stu-id="f0016-116">Elastic queries can now push SQL parameters to the remote databases for execution.</span></span>

<span data-ttu-id="f0016-117">**Execução de procedimento armazenado**</span><span class="sxs-lookup"><span data-stu-id="f0016-117">**Stored procedure execution**</span></span>

<span data-ttu-id="f0016-118">Execute chamadas remotas de procedimento armazenado ou funções remotas usando [sp\_execute \_remote](https://msdn.microsoft.com/library/mt703714).</span><span class="sxs-lookup"><span data-stu-id="f0016-118">Execute remote stored procedure calls or remote functions using [sp\_execute \_remote](https://msdn.microsoft.com/library/mt703714).</span></span>

<span data-ttu-id="f0016-119">**Flexibilidade**</span><span class="sxs-lookup"><span data-stu-id="f0016-119">**Flexibility**</span></span>

<span data-ttu-id="f0016-120">Tabelas externas com elástica consulta agora podem fazer referência a tabelas remotas com um nome de tabela ou um esquema diferente.</span><span class="sxs-lookup"><span data-stu-id="f0016-120">External tables with elastic query can now refer to remote tables with a different schema or table name.</span></span>

## <a name="elastic-query-scenarios"></a><span data-ttu-id="f0016-121">Cenários de consulta elástica</span><span class="sxs-lookup"><span data-stu-id="f0016-121">Elastic query scenarios</span></span>

<span data-ttu-id="f0016-122">O objetivo é facilitar cenários de consultas em que vários bancos de dados acrescentam linhas em um único resultado geral.</span><span class="sxs-lookup"><span data-stu-id="f0016-122">The goal is to facilitate querying scenarios where multiple databases contribute rows into a single overall result.</span></span> <span data-ttu-id="f0016-123">A consulta pode ser redigida pelo usuário ou pelo aplicativo diretamente, ou indiretamente por meio de ferramentas conectadas ao banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f0016-123">The query can either be composed by the user or application directly, or indirectly through tools that are connected to the database.</span></span> <span data-ttu-id="f0016-124">Isso é especialmente útil ao criar relatórios usando as ferramentas comerciais de BI ou de integração de dados, ou então qualquer aplicativo que não possa ser alterado.</span><span class="sxs-lookup"><span data-stu-id="f0016-124">This is especially useful when creating reports, using commercial BI or data integration tools—or any application that cannot be changed.</span></span> <span data-ttu-id="f0016-125">Com uma consulta elástica, é possível consultar vários bancos de dados usando a experiência familiar de conectividade do SQL Server em ferramentas como o Excel, Power BI, Tableau ou Cognos.</span><span class="sxs-lookup"><span data-stu-id="f0016-125">With an elastic query, you can query across several databases using the familiar SQL Server connectivity experience in tools such as Excel, PowerBI, Tableau, or Cognos.</span></span>
<span data-ttu-id="f0016-126">Uma consulta elástica facilita o acesso a um conjunto inteiro de bancos de dados por meio de consultas emitidas pelo SQL Server Management Studio ou Visual Studio, além de facilitar a consulta entre bancos de dados do Entity Framework ou de outros ambientes de ORM.</span><span class="sxs-lookup"><span data-stu-id="f0016-126">An elastic query allows easy access to an entire collection of databases through queries issued by SQL Server Management Studio or Visual Studio, and facilitates cross-database querying from Entity Framework or other ORM environments.</span></span> <span data-ttu-id="f0016-127">A Figura 1 mostra um cenário em que um aplicativo de nuvem existente (que usa a [biblioteca de clientes do banco de dados elástico](sql-database-elastic-database-client-library.md)) se baseia em uma camada de dados escalonável, e uma consulta elástica é usada para os relatórios entre bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="f0016-127">Figure 1 shows a scenario where an existing cloud application (which uses the [elastic database client library](sql-database-elastic-database-client-library.md)) builds on a scaled-out data tier, and an elastic query is used for cross-database reporting.</span></span>

<span data-ttu-id="f0016-128">**Figura 1** Consulta elástica usada na camada de dados escalada horizontalmente</span><span class="sxs-lookup"><span data-stu-id="f0016-128">**Figure 1** Elastic query used on scaled-out data tier</span></span>

![Consulta elástica usada na camada de dados escalada horizontalmente][1]

<span data-ttu-id="f0016-130">Os cenários do cliente para a consulta elástica são caracterizados pelas seguintes topologias:</span><span class="sxs-lookup"><span data-stu-id="f0016-130">Customer scenarios for elastic query are characterized by the following topologies:</span></span>

* <span data-ttu-id="f0016-131">**Particionamento vertical – consultas entre bancos de dados** (Topologia 1): os dados são particionados verticalmente entre vários bancos de dados em uma camada de dados.</span><span class="sxs-lookup"><span data-stu-id="f0016-131">**Vertical partitioning - Cross-database queries** (Topology 1): The data is partitioned vertically between a number of databases in a data tier.</span></span> <span data-ttu-id="f0016-132">Geralmente, diferentes conjuntos de tabelas residem em bancos de dados diferentes.</span><span class="sxs-lookup"><span data-stu-id="f0016-132">Typically, different sets of tables reside on different databases.</span></span> <span data-ttu-id="f0016-133">Isso significa que o esquema é diferente em bancos de dados diferentes.</span><span class="sxs-lookup"><span data-stu-id="f0016-133">That means that the schema is different on different databases.</span></span> <span data-ttu-id="f0016-134">Por exemplo, todas as tabelas de inventário estão em um banco de dados, enquanto todas as tabelas relacionadas à contabilidade estão em um segundo banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f0016-134">For instance, all tables for inventory are on one database while all accounting-related tables are on a second database.</span></span> <span data-ttu-id="f0016-135">Casos de uso comuns com esta topologia exigem uma consulta ou compilação de relatórios entre tabelas em vários bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="f0016-135">Common use cases with this topology require one to query across or to compile reports across tables in several databases.</span></span>
* <span data-ttu-id="f0016-136">**Particionamento horizontal – Fragmentação** (Topologia 2): os dados são particionados horizontalmente para distribuir as linhas em uma camada de dados escalada horizontalmente.</span><span class="sxs-lookup"><span data-stu-id="f0016-136">**Horizontal Partitioning - Sharding** (Topology 2): Data is partitioned horizontally to distribute rows across a scaled out data tier.</span></span> <span data-ttu-id="f0016-137">Com essa abordagem, o esquema é idêntico em todos os bancos de dados participantes.</span><span class="sxs-lookup"><span data-stu-id="f0016-137">With this approach, the schema is identical on all participating databases.</span></span> <span data-ttu-id="f0016-138">Essa abordagem também é chamada de “fragmentação”.</span><span class="sxs-lookup"><span data-stu-id="f0016-138">This approach is also called “sharding”.</span></span> <span data-ttu-id="f0016-139">A fragmentação pode ser executada e gerenciada com (1) as bibliotecas de ferramentas do banco de dados elástico ou com (2) a autofragmentação.</span><span class="sxs-lookup"><span data-stu-id="f0016-139">Sharding can be performed and managed using (1) the elastic database tools libraries or (2) self-sharding.</span></span> <span data-ttu-id="f0016-140">Uma consulta elástica é usada para consultar ou compilar relatórios em vários fragmentos.</span><span class="sxs-lookup"><span data-stu-id="f0016-140">An elastic query is used to query or compile reports across many shards.</span></span>

> [!NOTE]
> <span data-ttu-id="f0016-141">A consulta elástica funciona melhor em cenários de relatórios ocasionais em que a maior parte do processamento pode ser executada na camada de dados.</span><span class="sxs-lookup"><span data-stu-id="f0016-141">Elastic query works best for occasional reporting scenarios where most of the processing can be performed on the data tier.</span></span> <span data-ttu-id="f0016-142">Para os cenários de cargas de trabalho de relatórios pesadas ou data warehouse com consultas mais complexas, considere também usar o [SQL Data Warehouse do Azure](https://azure.microsoft.com/services/sql-data-warehouse/).</span><span class="sxs-lookup"><span data-stu-id="f0016-142">For heavy reporting workloads or data warehousing scenarios with more complex queries, also consider using [Azure SQL Data Warehouse](https://azure.microsoft.com/services/sql-data-warehouse/).</span></span>
>  

## <a name="vertical-partitioning---cross-database-queries"></a><span data-ttu-id="f0016-143">Particionamento vertical - consultas entre bancos de dados</span><span class="sxs-lookup"><span data-stu-id="f0016-143">Vertical partitioning - cross-database queries</span></span>

<span data-ttu-id="f0016-144">Para começar a codificar, veja [Introdução à consulta entre bancos de dados (particionamento vertical)](sql-database-elastic-query-getting-started-vertical.md).</span><span class="sxs-lookup"><span data-stu-id="f0016-144">To begin coding, see [Getting started with cross-database query (vertical partitioning)](sql-database-elastic-query-getting-started-vertical.md).</span></span>

<span data-ttu-id="f0016-145">Uma consulta elástica pode ser usada para disponibilizar os dados localizados em um Banco de Dados SQL para outros Bancos de Dados SQL.</span><span class="sxs-lookup"><span data-stu-id="f0016-145">An elastic query can be used to make data located in a SQL database available to other SQL databases.</span></span> <span data-ttu-id="f0016-146">Isso permite que consultas de um banco de dados façam referência a tabelas em qualquer outro Banco de Dados SQL remoto.</span><span class="sxs-lookup"><span data-stu-id="f0016-146">This allows queries from one database to refer to tables in any other remote SQL database.</span></span> <span data-ttu-id="f0016-147">A primeira etapa é definir uma fonte de dados externa para cada banco de dados remoto.</span><span class="sxs-lookup"><span data-stu-id="f0016-147">The first step is to define an external data source for each remote database.</span></span> <span data-ttu-id="f0016-148">A fonte de dados externa é definida no banco de dados local do qual você deseja obter acesso às tabelas localizadas no banco de dados remoto.</span><span class="sxs-lookup"><span data-stu-id="f0016-148">The external data source is defined in the local database from which you want to gain access to tables located on the remote database.</span></span> <span data-ttu-id="f0016-149">Não são necessárias alterações no banco de dados remoto.</span><span class="sxs-lookup"><span data-stu-id="f0016-149">No changes are necessary on the remote database.</span></span> <span data-ttu-id="f0016-150">Para cenários típicos de particionamento vertical em que bancos de dados diferentes têm esquemas diferentes, as consultas elásticas podem ser usadas para implementar casos de uso comuns, como o acesso aos dados de referência e consulta entre bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="f0016-150">For typical vertical partitioning scenarios where different databases have different schemas, elastic queries can be used to implement common use cases such as access to reference data and cross-database querying.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="f0016-151">Você deve ter a permissão para ALTERAR QUALQUER FONTE DE DADOS EXTERNA.</span><span class="sxs-lookup"><span data-stu-id="f0016-151">You must possess ALTER ANY EXTERNAL DATA SOURCE permission.</span></span> <span data-ttu-id="f0016-152">Essa permissão está incluída na permissão ALTERAR BANCO DE DADOS.</span><span class="sxs-lookup"><span data-stu-id="f0016-152">This permission is included with the ALTER DATABASE permission.</span></span> <span data-ttu-id="f0016-153">As permissões para ALTERAR QUALQUER FONTE DE DADOS EXTERNA são necessárias para referenciar a fonte de dados subjacente.</span><span class="sxs-lookup"><span data-stu-id="f0016-153">ALTER ANY EXTERNAL DATA SOURCE permissions are needed to refer to the underlying data source.</span></span>
>

<span data-ttu-id="f0016-154">**Dados de referência**: a topologia é usada para o gerenciamento de dados de referência.</span><span class="sxs-lookup"><span data-stu-id="f0016-154">**Reference data**: The topology is used for reference data management.</span></span> <span data-ttu-id="f0016-155">Na figura abaixo, as duas tabelas (T1 e T2) com dados de referência são mantidas em um banco de dados dedicado.</span><span class="sxs-lookup"><span data-stu-id="f0016-155">In the figure below, two tables (T1 and T2) with reference data are kept on a dedicated database.</span></span> <span data-ttu-id="f0016-156">Com uma consulta elástica, agora você pode acessar as tabelas T1 e T2 remotamente em outros bancos de dados, como mostrado na figura.</span><span class="sxs-lookup"><span data-stu-id="f0016-156">Using an elastic query, you can now access tables T1 and T2 remotely from other databases, as shown in the figure.</span></span> <span data-ttu-id="f0016-157">Use a topologia 1 se as tabelas de referência forem pequenas ou se as consultas remotas na tabela de referência tiverem predicados seletivos.</span><span class="sxs-lookup"><span data-stu-id="f0016-157">Use topology 1 if reference tables are small or remote queries into reference table have selective predicates.</span></span>

<span data-ttu-id="f0016-158">**Figura 2** Particionamento vertical - Usando a consulta elástica para consultar dados de referência</span><span class="sxs-lookup"><span data-stu-id="f0016-158">**Figure 2** Vertical partitioning - Using elastic query to query reference data</span></span>

![Particionamento vertical - Usando a consulta elástica para consultar dados de referência][3]

<span data-ttu-id="f0016-160">**Consultas entre bancos de dados**: as consultas elásticas habilitam casos de uso que exigem consultas em vários Bancos de Dados SQL.</span><span class="sxs-lookup"><span data-stu-id="f0016-160">**Cross-database querying**: Elastic queries enable use cases that require querying across several SQL databases.</span></span> <span data-ttu-id="f0016-161">A Figura 3 mostra quatro bancos de dados diferentes: CRM, Inventário, RH e Produtos.</span><span class="sxs-lookup"><span data-stu-id="f0016-161">Figure 3 shows four different databases: CRM, Inventory, HR and Products.</span></span> <span data-ttu-id="f0016-162">As consultas executadas em um banco de dados também precisam ter acesso a um ou todos os outros bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="f0016-162">Queries performed in one of the databases also need access to one or all the other databases.</span></span> <span data-ttu-id="f0016-163">Com uma consulta elástica, é possível configurar o banco de dados para esse caso, executando algumas instruções DDL simples em cada um dos quatro bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="f0016-163">Using an elastic query, you can configure your database for this case by running a few simple DDL statements on each of the four databases.</span></span> <span data-ttu-id="f0016-164">Após essa configuração única, o acesso a uma tabela remota é tão simples quanto fazer referência a uma tabela local de suas consultas T-SQL ou de suas ferramentas de BI.</span><span class="sxs-lookup"><span data-stu-id="f0016-164">After this one-time configuration, access to a remote table is as simple as referring to a local table from your T-SQL queries or from your BI tools.</span></span> <span data-ttu-id="f0016-165">Essa abordagem é recomendada se as consultas remotas não retornam grandes resultados.</span><span class="sxs-lookup"><span data-stu-id="f0016-165">This approach is recommended if the remote queries do not return large results.</span></span>

<span data-ttu-id="f0016-166">**Figura 3** Particionamento vertical - Usando a consulta elástica para consultar vários bancos de dados</span><span class="sxs-lookup"><span data-stu-id="f0016-166">**Figure 3** Vertical partitioning - Using elastic query to query across various databases</span></span>

![Particionamento vertical - Usando a consulta elástica para consultar vários bancos de dados][4]

<span data-ttu-id="f0016-168">As seguintes etapas configuram consultas de banco de dados elástico para cenários de particionamento vertical que exigem o acesso a uma tabela localizada em um Banco de Dados SQL remoto com o mesmo esquema:</span><span class="sxs-lookup"><span data-stu-id="f0016-168">The following steps configure elastic database queries for vertical partitioning scenarios that require access to a table located on remote SQL databases with the same schema:</span></span>

* <span data-ttu-id="f0016-169">[CREATE MASTER KEY](https://msdn.microsoft.com/library/ms174382.aspx) mymasterkey</span><span class="sxs-lookup"><span data-stu-id="f0016-169">[CREATE MASTER KEY](https://msdn.microsoft.com/library/ms174382.aspx) mymasterkey</span></span>
* <span data-ttu-id="f0016-170">[CREATE DATABASE SCOPED CREDENTIAL](https://msdn.microsoft.com/library/mt270260.aspx) mycredential</span><span class="sxs-lookup"><span data-stu-id="f0016-170">[CREATE DATABASE SCOPED CREDENTIAL](https://msdn.microsoft.com/library/mt270260.aspx) mycredential</span></span>
* <span data-ttu-id="f0016-171">[CREATE/DROP EXTERNAL DATA SOURCE](https://msdn.microsoft.com/library/dn935022.aspx) mydatasource do tipo **RDBMS**</span><span class="sxs-lookup"><span data-stu-id="f0016-171">[CREATE/DROP EXTERNAL DATA SOURCE](https://msdn.microsoft.com/library/dn935022.aspx) mydatasource of type **RDBMS**</span></span>
* <span data-ttu-id="f0016-172">[CREATE/DROP EXTERNAL TABLE](https://msdn.microsoft.com/library/dn935021.aspx) mytable</span><span class="sxs-lookup"><span data-stu-id="f0016-172">[CREATE/DROP EXTERNAL TABLE](https://msdn.microsoft.com/library/dn935021.aspx) mytable</span></span>

<span data-ttu-id="f0016-173">Depois de executar as instruções DDL, você pode acessar a tabela remota “mytable” como se ela fosse uma tabela local.</span><span class="sxs-lookup"><span data-stu-id="f0016-173">After running the DDL statements, you can access the remote table “mytable” as though it were a local table.</span></span> <span data-ttu-id="f0016-174">O Banco de Dados SQL do Azure automaticamente abre uma conexão com o banco de dados remoto, processa a solicitação no banco de dados remoto e retorna os resultados.</span><span class="sxs-lookup"><span data-stu-id="f0016-174">Azure SQL Database automatically opens a connection to the remote database, processes your request on the remote database, and returns the results.</span></span>

## <a name="horizontal-partitioning---sharding"></a><span data-ttu-id="f0016-175">Particionamento horizontal - fragmentação</span><span class="sxs-lookup"><span data-stu-id="f0016-175">Horizontal partitioning - sharding</span></span>
<span data-ttu-id="f0016-176">O uso de uma consulta elástica para executar tarefas de relatórios em uma camada de dados fragmentados, ou seja, particionados horizontalmente requer um [mapa de fragmentos de banco de dados elástico](sql-database-elastic-scale-shard-map-management.md) para representar os bancos de dados da camada de dados.</span><span class="sxs-lookup"><span data-stu-id="f0016-176">Using elastic query to perform reporting tasks over a sharded, i.e., horizontally partitioned, data tier requires an [elastic database shard map](sql-database-elastic-scale-shard-map-management.md) to represent the databases of the data tier .</span></span> <span data-ttu-id="f0016-177">Normalmente, apenas um único mapa de fragmentos é usado neste cenário, e um banco de dados dedicado com recursos de consulta elástica (nó de cabeçalho) serve como o ponto de entrada para consultas de relatórios.</span><span class="sxs-lookup"><span data-stu-id="f0016-177">Typically, only a single shard map is used in this scenario and a dedicated database with elastic query capabilities (head node) serves as the entry point for reporting queries.</span></span> <span data-ttu-id="f0016-178">Somente este banco de dados dedicado precisa ter acesso ao mapa de fragmentos.</span><span class="sxs-lookup"><span data-stu-id="f0016-178">Only this dedicated database needs access to the shard map.</span></span> <span data-ttu-id="f0016-179">A Figura 4 ilustra essa topologia e sua configuração com o banco de dados de consulta elástica e o mapa de fragmentos.</span><span class="sxs-lookup"><span data-stu-id="f0016-179">Figure 4 illustrates this topology and its configuration with the elastic query database and shard map.</span></span> <span data-ttu-id="f0016-180">Os bancos de dados na camada de dados podem ser de qualquer versão ou edição do Banco de Dados SQL do Azure.</span><span class="sxs-lookup"><span data-stu-id="f0016-180">The databases in the data tier can be of any Azure SQL Database version or edition.</span></span> <span data-ttu-id="f0016-181">Para obter mais informações sobre a biblioteca de clientes do banco de dados elástico e sobre como criar mapas de fragmentos, veja [Gerenciamento do mapa de fragmentos](sql-database-elastic-scale-shard-map-management.md).</span><span class="sxs-lookup"><span data-stu-id="f0016-181">For more information about the elastic database client library and creating shard maps, see [Shard map management](sql-database-elastic-scale-shard-map-management.md).</span></span>

<span data-ttu-id="f0016-182">**Figura 4** Particionamento horizontal - Usando a consulta elástica para relatórios de camadas de dados fragmentados</span><span class="sxs-lookup"><span data-stu-id="f0016-182">**Figure 4** Horizontal partitioning - Using elastic query for reporting over sharded data tiers</span></span>

![Particionamento horizontal - Usando a consulta elástica para relatórios de camadas de dados fragmentados][5]

> [!NOTE]
> <span data-ttu-id="f0016-184">Consulta de banco de dados Elástico (nó principal) pode ser separado do banco de dados, ou pode ser o mesmo banco de dados que hospeda o mapa do fragmento.</span><span class="sxs-lookup"><span data-stu-id="f0016-184">Elastic Query Database (head node) can be separate database, or it can be the same database that hosts the shard map.</span></span> <span data-ttu-id="f0016-185">Qualquer configuração que você escolher, verifique se essa camada de serviço e o desempenho do banco de dados for alta o suficiente para lidar com o valor esperado de solicitações de logon/consulta.</span><span class="sxs-lookup"><span data-stu-id="f0016-185">Whatever configuration you choose, make sure that service and performance tier of that database is high enough to handle the expected  amount of login/query requests.</span></span>

<span data-ttu-id="f0016-186">As seguintes etapas configuram consultas de banco de dados elástico para cenários de particionamento horizontal que exigem o acesso a um conjunto de tabelas que estão localizadas (normalmente) em vários Bancos de Dados SQL remotos:</span><span class="sxs-lookup"><span data-stu-id="f0016-186">The following steps configure elastic database queries for horizontal partitioning scenarios that require access to a set of table that are located on (typically) several remote SQL databases:</span></span>

* <span data-ttu-id="f0016-187">[CREATE MASTER KEY](https://msdn.microsoft.com/library/ms174382.aspx) mymasterkey</span><span class="sxs-lookup"><span data-stu-id="f0016-187">[CREATE MASTER KEY](https://msdn.microsoft.com/library/ms174382.aspx) mymasterkey</span></span>
* <span data-ttu-id="f0016-188">[CREATE DATABASE SCOPED CREDENTIAL](https://msdn.microsoft.com/library/mt270260.aspx) mycredential</span><span class="sxs-lookup"><span data-stu-id="f0016-188">[CREATE DATABASE SCOPED CREDENTIAL](https://msdn.microsoft.com/library/mt270260.aspx) mycredential</span></span>
* <span data-ttu-id="f0016-189">Crie um [mapa de fragmentos](sql-database-elastic-scale-shard-map-management.md) que representa sua camada de dados usando a biblioteca de clientes do banco de dados elástico.</span><span class="sxs-lookup"><span data-stu-id="f0016-189">Create a [shard map](sql-database-elastic-scale-shard-map-management.md) representing your data tier using the elastic database client library.</span></span>   
* <span data-ttu-id="f0016-190">[CREATE/DROP EXTERNAL DATA SOURCE](https://msdn.microsoft.com/library/dn935022.aspx) mydatasource do tipo **SHARD_MAP_MANAGER**</span><span class="sxs-lookup"><span data-stu-id="f0016-190">[CREATE/DROP EXTERNAL DATA SOURCE](https://msdn.microsoft.com/library/dn935022.aspx) mydatasource of type **SHARD_MAP_MANAGER**</span></span>
* <span data-ttu-id="f0016-191">[CREATE/DROP EXTERNAL TABLE](https://msdn.microsoft.com/library/dn935021.aspx) mytable</span><span class="sxs-lookup"><span data-stu-id="f0016-191">[CREATE/DROP EXTERNAL TABLE](https://msdn.microsoft.com/library/dn935021.aspx) mytable</span></span>

<span data-ttu-id="f0016-192">Depois de realizar essas etapas, você pode acessar a tabela particionada horizontalmente “mytable” como se ela fosse uma tabela local.</span><span class="sxs-lookup"><span data-stu-id="f0016-192">Once you have performed these steps, you can access the horizontally partitioned table “mytable” as though it were a local table.</span></span> <span data-ttu-id="f0016-193">O Banco de Dados SQL do Azure automaticamente abre várias conexões paralelas com os bancos de dados remotos nos quais as tabelas estão armazenadas fisicamente, processa as solicitações nos bancos de dados remotos e retorna os resultados.</span><span class="sxs-lookup"><span data-stu-id="f0016-193">Azure SQL Database automatically opens multiple parallel connections to the remote databases where the tables are physically stored, processes the requests on the remote databases, and returns the results.</span></span>
<span data-ttu-id="f0016-194">Mais informações sobre as etapas necessárias para o cenário de particionamento horizontal podem ser encontradas em [consulta elástica para o particionamento horizontal](sql-database-elastic-query-horizontal-partitioning.md).</span><span class="sxs-lookup"><span data-stu-id="f0016-194">More information on the steps required for the horizontal partitioning scenario can be found in [elastic query for horizontal partitioning](sql-database-elastic-query-horizontal-partitioning.md).</span></span>

<span data-ttu-id="f0016-195">Para começar a codificar, veja [Introdução à consulta elástica para particionamento horizontal (fragmentação)](sql-database-elastic-query-getting-started.md).</span><span class="sxs-lookup"><span data-stu-id="f0016-195">To begin coding, see [Getting started with elastic query for horizontal partitioning (sharding)](sql-database-elastic-query-getting-started.md).</span></span>

## <a name="t-sql-querying"></a><span data-ttu-id="f0016-196">Consultas T-SQL</span><span class="sxs-lookup"><span data-stu-id="f0016-196">T-SQL querying</span></span>
<span data-ttu-id="f0016-197">Depois de definir as fontes de dados externas e as tabelas externas, é possível usar cadeias de conexão regulares do SQL Server para se conectar aos bancos de dados em que você definiu as tabelas externas.</span><span class="sxs-lookup"><span data-stu-id="f0016-197">Once you have defined your external data sources and your external tables, you can use regular SQL Server connection strings to connect to the databases where you defined your external tables.</span></span> <span data-ttu-id="f0016-198">Você pode então executar instruções T-SQL em suas tabelas externas nessa conexão com as limitações descritas abaixo.</span><span class="sxs-lookup"><span data-stu-id="f0016-198">You can then run T-SQL statements over your external tables on that connection with the limitations outlined below.</span></span> <span data-ttu-id="f0016-199">Você pode encontrar mais informações e exemplos de consultas do T-SQL em tópicos da documentação para [particionamento horizontal](sql-database-elastic-query-horizontal-partitioning.md) e [particionamento vertical](sql-database-elastic-query-vertical-partitioning.md).</span><span class="sxs-lookup"><span data-stu-id="f0016-199">You can find more information and examples of T-SQL queries in the documentation topics for [horizontal partitioning](sql-database-elastic-query-horizontal-partitioning.md) and [vertical partitioning](sql-database-elastic-query-vertical-partitioning.md).</span></span>

## <a name="connectivity-for-tools"></a><span data-ttu-id="f0016-200">Conectividade de ferramentas</span><span class="sxs-lookup"><span data-stu-id="f0016-200">Connectivity for tools</span></span>
<span data-ttu-id="f0016-201">Você pode usar cadeias de conexão regulares do SQL Server para conectar seus aplicativos e ferramentas de BI ou de integração de dados a bancos de dados que têm tabelas externas.</span><span class="sxs-lookup"><span data-stu-id="f0016-201">You can use regular SQL Server connection strings to connect your applications and BI or data integration tools to databases that have external tables.</span></span> <span data-ttu-id="f0016-202">Certifique-se de que o SQL Server tem suporte como uma fonte de dados para a ferramenta.</span><span class="sxs-lookup"><span data-stu-id="f0016-202">Make sure that SQL Server is supported as a data source for your tool.</span></span> <span data-ttu-id="f0016-203">Depois de conectado, consulte o banco de dados de consulta elástica e as tabelas externas nesse banco de dados exatamente como você faria com qualquer outro banco de dados do SQL Server ao qual você se conecta com a sua ferramenta.</span><span class="sxs-lookup"><span data-stu-id="f0016-203">Once connected, refer to the elastic query database and the external tables in that database just like you would do with any other SQL Server database that you connect to with your tool.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="f0016-204">Atualmente não há suporte para a autenticação usando o Azure Active Directory com consultas elásticas.</span><span class="sxs-lookup"><span data-stu-id="f0016-204">Authentication using Azure Active Directory with elastic queries is not currently supported.</span></span>
> 
> 

## <a name="cost"></a><span data-ttu-id="f0016-205">Custo</span><span class="sxs-lookup"><span data-stu-id="f0016-205">Cost</span></span>
<span data-ttu-id="f0016-206">A consulta elástica está incluída no custo dos bancos de dados do Banco de Dados SQL do Azure.</span><span class="sxs-lookup"><span data-stu-id="f0016-206">Elastic query is included into the cost of Azure SQL Database databases.</span></span> <span data-ttu-id="f0016-207">Observe que há suporte para as topologias nas quais os bancos de dados remotos residem em um datacenter diferente que o ponto de extremidade da consulta elástica, mas a saída de dados dos bancos de dados remotos é cobrada [às taxas normais do Azure](https://azure.microsoft.com/pricing/details/data-transfers/).</span><span class="sxs-lookup"><span data-stu-id="f0016-207">Note that topologies where your remote databases are in a different data center than the elastic query endpoint are supported, but data egress from remote databases are charged regular [Azure rates](https://azure.microsoft.com/pricing/details/data-transfers/).</span></span>

## <a name="preview-limitations"></a><span data-ttu-id="f0016-208">Limitações de visualização</span><span class="sxs-lookup"><span data-stu-id="f0016-208">Preview limitations</span></span>
* <span data-ttu-id="f0016-209">A execução da primeira consulta elástica pode levar alguns minutos no nível de desempenho Standard.</span><span class="sxs-lookup"><span data-stu-id="f0016-209">Running your first elastic query can take up to a few minutes on the Standard performance tier.</span></span> <span data-ttu-id="f0016-210">Esse tempo é necessário para carregar a funcionalidade de consulta elástica; o desempenho do carregamento melhora com níveis mais altos de desempenho.</span><span class="sxs-lookup"><span data-stu-id="f0016-210">This time is necessary to load the elastic query functionality; loading performance improves with higher performance tiers.</span></span>
* <span data-ttu-id="f0016-211">Ainda não há suporte para scripts de fontes de dados externas ou de tabelas externas do SSMS ou SSDT.</span><span class="sxs-lookup"><span data-stu-id="f0016-211">Scripting of external data sources or external tables from SSMS or SSDT is not yet supported.</span></span>
* <span data-ttu-id="f0016-212">A Importação/Exportação do Banco de Dados SQL ainda não dá suporte a tabelas externas e fontes de dados externas.</span><span class="sxs-lookup"><span data-stu-id="f0016-212">Import/Export for SQL DB does not yet support external data sources and external tables.</span></span> <span data-ttu-id="f0016-213">Se precisar usar a função Importação/Exportação, remova esses objetos antes da exportação e depois recrie-os após a importação.</span><span class="sxs-lookup"><span data-stu-id="f0016-213">If you need to use Import/Export, drop these objects before exporting and then re-create them after importing.</span></span>
* <span data-ttu-id="f0016-214">Atualmente, a consulta elástica dá suporte apenas ao acesso somente leitura para tabelas externas.</span><span class="sxs-lookup"><span data-stu-id="f0016-214">Elastic query currently only supports read-only access to external tables.</span></span> <span data-ttu-id="f0016-215">Você pode, no entanto, usar a funcionalidade completa do T-SQL no banco de dados no qual a tabela externa é definida.</span><span class="sxs-lookup"><span data-stu-id="f0016-215">You can, however, use full T-SQL functionality on the database where the external table is defined.</span></span> <span data-ttu-id="f0016-216">Isso pode ser útil para, por exemplo, manter os resultados temporários usando, por exemplo, SELECT <column_list> INTO <local_table>, ou para definir os procedimentos armazenados no banco de dados de consulta elástica que se referem a tabelas externas.</span><span class="sxs-lookup"><span data-stu-id="f0016-216">This can be useful to, e.g., persist temporary results using, e.g., SELECT <column_list> INTO <local_table>, or to define stored procedures on the elastic query database which refer to external tables.</span></span>
* <span data-ttu-id="f0016-217">Exceto nvarchar(max), não há suporte para tipos LOB em definições de tabela externa.</span><span class="sxs-lookup"><span data-stu-id="f0016-217">Except for nvarchar(max), LOB types are not supported in external table definitions.</span></span> <span data-ttu-id="f0016-218">Como uma solução alternativa, você pode criar uma exibição no banco de dados remoto que converte o tipo LOB em nvarchar(max), definir sua tabela externa na exibição em vez da tabela base e, em seguida, convertê-la novamente no tipo LOB original em suas consultas.</span><span class="sxs-lookup"><span data-stu-id="f0016-218">As a workaround, you can create a view on the remote database that casts the LOB type into nvarchar(max), define your external table over the view instead of the base table and then cast it back into the original LOB type in your queries.</span></span>
* <span data-ttu-id="f0016-219">Atualmente, não há suporte para estatísticas de coluna em tabelas externas.</span><span class="sxs-lookup"><span data-stu-id="f0016-219">Column statistics over external tables are currently not supported.</span></span> <span data-ttu-id="f0016-220">Há suporte para as estatísticas de tabelas, mas elas precisam ser criadas manualmente.</span><span class="sxs-lookup"><span data-stu-id="f0016-220">Tables statistics are supported, but need to be created manually.</span></span>

## <a name="feedback"></a><span data-ttu-id="f0016-221">Comentários</span><span class="sxs-lookup"><span data-stu-id="f0016-221">Feedback</span></span>
<span data-ttu-id="f0016-222">Compartilhe conosco seus comentários sobre sua experiência com as consultas elásticas no Disqus abaixo, nos fóruns do MSDN ou no Stackoverflow.</span><span class="sxs-lookup"><span data-stu-id="f0016-222">Please share feedback on your experience with elastic queries with us on Disqus below, the MSDN forums, or on Stackoverflow.</span></span> <span data-ttu-id="f0016-223">Estamos interessados em todos os tipos de comentários sobre o serviço (defeitos, pontos em aberto, lacunas do recurso).</span><span class="sxs-lookup"><span data-stu-id="f0016-223">We are interested in all kinds of feedback about the service (defects, rough edges, feature gaps).</span></span>

## <a name="next-steps"></a><span data-ttu-id="f0016-224">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="f0016-224">Next steps</span></span>

* <span data-ttu-id="f0016-225">Para obter um tutorial sobre particionamento vertical, consulte [Introdução à consulta entre bancos de dados (particionamento vertical)](sql-database-elastic-query-getting-started-vertical.md).</span><span class="sxs-lookup"><span data-stu-id="f0016-225">For a vertical partitioning tutorial, see [Getting started with cross-database query (vertical partitioning)](sql-database-elastic-query-getting-started-vertical.md).</span></span>
* <span data-ttu-id="f0016-226">Para sintaxe e amostras de consultas para dados particionados verticalmente, consulte [Consultando dados particionados verticalmente)](sql-database-elastic-query-vertical-partitioning.md)</span><span class="sxs-lookup"><span data-stu-id="f0016-226">For syntax and sample queries for vertically partitioned data, see [Querying vertically partitioned data)](sql-database-elastic-query-vertical-partitioning.md)</span></span>
* <span data-ttu-id="f0016-227">Para um tutorial sobre particionamento horizontal (fragmentação), consulte [Introdução à consulta elástica para particionamento horizontal (fragmentação)](sql-database-elastic-query-getting-started.md).</span><span class="sxs-lookup"><span data-stu-id="f0016-227">For a horizontal partitioning (sharding) tutorial, see [Getting started with elastic query for horizontal partitioning (sharding)](sql-database-elastic-query-getting-started.md).</span></span>
* <span data-ttu-id="f0016-228">Para sintaxe e amostras de consultas para dados particionados horizontalmente, consulte [Consultando dados particionados horizontalmente)](sql-database-elastic-query-horizontal-partitioning.md)</span><span class="sxs-lookup"><span data-stu-id="f0016-228">For syntax and sample queries for horizontally partitioned data, see [Querying horizontally partitioned data)](sql-database-elastic-query-horizontal-partitioning.md)</span></span>
* <span data-ttu-id="f0016-229">Consulte [sp\_execute \_remote](https://msdn.microsoft.com/library/mt703714) para um procedimento armazenado que executa uma instrução Transact-SQL em um único Banco de Dados SQL do Azure remoto ou um conjunto de bancos de dados que serve como fragmentos em um esquema de particionamento horizontal.</span><span class="sxs-lookup"><span data-stu-id="f0016-229">See [sp\_execute \_remote](https://msdn.microsoft.com/library/mt703714) for a stored procedure that executes a Transact-SQL statement on a single remote Azure SQL Database or set of databases serving as shards in a horizontal partitioning scheme.</span></span>

<!--Image references-->
[1]: ./media/sql-database-elastic-query-overview/overview.png
[2]: ./media/sql-database-elastic-query-overview/topology1.png
[3]: ./media/sql-database-elastic-query-overview/vertpartrrefdata.png
[4]: ./media/sql-database-elastic-query-overview/verticalpartitioning.png
[5]: ./media/sql-database-elastic-query-overview/horizontalpartitioning.png

<!--anchors-->
