---
title: "aaaOperating repositório de consultas no banco de dados do SQL Azure"
description: "Saiba como toooperate Olá repositório de consultas no banco de dados do SQL Azure"
keywords: 
services: sql-database
documentationcenter: 
author: bonova
manager: jhubbard
editor: 
ms.assetid: 0cccf6bd-1327-44f7-a6f9-8eff0c210463
ms.service: sql-database
ms.custom: monitor & tune
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: sqldb-performance
ms.workload: data-management
ms.date: 11/08/2016
ms.author: bonova
ms.openlocfilehash: ab741e49685bf6df3bceab219aaf57ea51cdb25d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="operating-hello-query-store-in-azure-sql-database"></a><span data-ttu-id="25262-103">Olá operacional repositório de consultas no banco de dados do SQL Azure</span><span class="sxs-lookup"><span data-stu-id="25262-103">Operating hello Query Store in Azure SQL Database</span></span>
<span data-ttu-id="25262-104">O Repositório de Consultas no Azure é um recurso de banco de dados totalmente gerenciado que continuamente coleta e apresenta informações históricas sobre todas as consultas.</span><span class="sxs-lookup"><span data-stu-id="25262-104">Query Store in Azure is a fully managed database feature that continuously collects and presents detailed historic information about all queries.</span></span> <span data-ttu-id="25262-105">Você pode pensar sobre o repositório de consultas como gravador de dados de voo do avião tooan semelhante que significativamente simplifica a solução de problemas para a nuvem de desempenho de consulta e os clientes no local.</span><span class="sxs-lookup"><span data-stu-id="25262-105">You can think about Query Store as similar tooan airplane's flight data recorder that significantly simplifies query performance troubleshooting both for cloud and on-premises customers.</span></span> <span data-ttu-id="25262-106">Este artigo explica os aspectos específicos da operação de Repositório de Consultas no Azure.</span><span class="sxs-lookup"><span data-stu-id="25262-106">This article explains specific aspects of operating Query Store in Azure.</span></span> <span data-ttu-id="25262-107">Usando esta consulta de dados previamente coletados, você pode diagnosticar e resolver problemas de desempenho rapidamente e, portanto, gastar mais tempo concentrando-se em seus negócios.</span><span class="sxs-lookup"><span data-stu-id="25262-107">Using this pre-collected query data, you can quickly diagnose and resolve performance problems and thus spend more time focusing on their business.</span></span> 

<span data-ttu-id="25262-108">O Repositório de Consultas ficou [disponível globalmente](https://azure.microsoft.com/updates/general-availability-azure-sql-database-query-store/) no Banco de Dados SQL do Azure desde novembro de 2015.</span><span class="sxs-lookup"><span data-stu-id="25262-108">Query Store has been [globally available](https://azure.microsoft.com/updates/general-availability-azure-sql-database-query-store/) in Azure SQL Database since November, 2015.</span></span> <span data-ttu-id="25262-109">Repositório de consultas é a base de saudação para análise de desempenho e otimização de recursos, tais como [orientador de banco de dados SQL e painel de desempenho](https://azure.microsoft.com/updates/sqldatabaseadvisorga/).</span><span class="sxs-lookup"><span data-stu-id="25262-109">Query Store is hello foundation for performance analysis and tuning features, such as [SQL Database Advisor and Performance Dashboard](https://azure.microsoft.com/updates/sqldatabaseadvisorga/).</span></span> <span data-ttu-id="25262-110">No momento de saudação da publicação deste artigo, o repositório de consultas está em execução em mais de 200.000 bancos de dados de usuário no Azure, coletando informações relacionadas à consulta para vários meses, sem interrupção.</span><span class="sxs-lookup"><span data-stu-id="25262-110">At hello moment of publishing this article, Query Store is running in more than 200,000 user databases in Azure, collecting query-related information for several months, without interruption.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="25262-111">A Microsoft está no processo de saudação de ativação de repositório de consultas para bancos de dados do SQL Azure todos (novos e existentes).</span><span class="sxs-lookup"><span data-stu-id="25262-111">Microsoft is in hello process of activating Query Store for all Azure SQL databases (existing and new).</span></span> 
> 
> 

## <a name="optimal-query-store-configuration"></a><span data-ttu-id="25262-112">Configuração do Repositório de Consulta ideais</span><span class="sxs-lookup"><span data-stu-id="25262-112">Optimal Query Store Configuration</span></span>
<span data-ttu-id="25262-113">Esta seção descreve os padrões de configuração ideal que são uma operação confiável tooensure projetado de repositório de consultas hello e recursos dependentes, tais como [orientador de banco de dados SQL e painel de desempenho](https://azure.microsoft.com/updates/sqldatabaseadvisorga/).</span><span class="sxs-lookup"><span data-stu-id="25262-113">This section describes optimal configuration defaults that are designed tooensure reliable operation of hello Query Store and dependent features, such as [SQL Database Advisor and Performance Dashboard](https://azure.microsoft.com/updates/sqldatabaseadvisorga/).</span></span> <span data-ttu-id="25262-114">A configuração padrão é otimizada para coleta de dados contínua, ou seja, tempo mínimo gasto nos estados OFF/READ_ONLY.</span><span class="sxs-lookup"><span data-stu-id="25262-114">Default configuration is optimized for continuous data collection, that is minimal time spent in OFF/READ_ONLY states.</span></span>

| <span data-ttu-id="25262-115">Configuração</span><span class="sxs-lookup"><span data-stu-id="25262-115">Configuration</span></span> | <span data-ttu-id="25262-116">Descrição</span><span class="sxs-lookup"><span data-stu-id="25262-116">Description</span></span> | <span data-ttu-id="25262-117">Padrão</span><span class="sxs-lookup"><span data-stu-id="25262-117">Default</span></span> | <span data-ttu-id="25262-118">Comentário</span><span class="sxs-lookup"><span data-stu-id="25262-118">Comment</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="25262-119">MAX_STORAGE_SIZE_MB</span><span class="sxs-lookup"><span data-stu-id="25262-119">MAX_STORAGE_SIZE_MB</span></span> |<span data-ttu-id="25262-120">Especifica o limite de saudação para espaço de dados de saudação que pode levar o repositório de consultas no banco de dados de cliente z</span><span class="sxs-lookup"><span data-stu-id="25262-120">Specifies hello limit for hello data space that Query Store can take inside z customer database</span></span> |<span data-ttu-id="25262-121">100</span><span class="sxs-lookup"><span data-stu-id="25262-121">100</span></span> |<span data-ttu-id="25262-122">Imposto para novos bancos de dados</span><span class="sxs-lookup"><span data-stu-id="25262-122">Enforced for new databases</span></span> |
| <span data-ttu-id="25262-123">INTERVAL_LENGTH_MINUTES</span><span class="sxs-lookup"><span data-stu-id="25262-123">INTERVAL_LENGTH_MINUTES</span></span> |<span data-ttu-id="25262-124">Define o tamanho da janela de tempo durante o qual as estatísticas de tempo de execução coletadas para planos de consulta são agregadas e persistidas.</span><span class="sxs-lookup"><span data-stu-id="25262-124">Defines size of time window during which collected runtime statistics for query plans are aggregated and persisted.</span></span> <span data-ttu-id="25262-125">Cada plano de consulta ativa tem no máximo uma linha por um período de tempo definido com esta configuração</span><span class="sxs-lookup"><span data-stu-id="25262-125">Every active query plan has at most one row for a period of time defined with this configuration</span></span> |<span data-ttu-id="25262-126">60</span><span class="sxs-lookup"><span data-stu-id="25262-126">60</span></span> |<span data-ttu-id="25262-127">Imposto para novos bancos de dados</span><span class="sxs-lookup"><span data-stu-id="25262-127">Enforced for new databases</span></span> |
| <span data-ttu-id="25262-128">STALE_QUERY_THRESHOLD_DAYS</span><span class="sxs-lookup"><span data-stu-id="25262-128">STALE_QUERY_THRESHOLD_DAYS</span></span> |<span data-ttu-id="25262-129">Política de limpeza com base no tempo que controla o período de retenção de saudação de estatísticas de tempo de execução persistentes e consultas inativas</span><span class="sxs-lookup"><span data-stu-id="25262-129">Time-based cleanup policy that controls hello retention period of persisted runtime statistics and inactive queries</span></span> |<span data-ttu-id="25262-130">30</span><span class="sxs-lookup"><span data-stu-id="25262-130">30</span></span> |<span data-ttu-id="25262-131">Imposto para novos bancos de dados e bancos de dados padrão anteriores (367)</span><span class="sxs-lookup"><span data-stu-id="25262-131">Enforced for new databases and databases with previous default (367)</span></span> |
| <span data-ttu-id="25262-132">SIZE_BASED_CLEANUP_MODE</span><span class="sxs-lookup"><span data-stu-id="25262-132">SIZE_BASED_CLEANUP_MODE</span></span> |<span data-ttu-id="25262-133">Especifica se a limpeza automática de dados ocorre quando o limite de saudação se aproximar do tamanho de dados de repositório de consultas</span><span class="sxs-lookup"><span data-stu-id="25262-133">Specifies whether automatic data cleanup takes place when Query Store data size approaches hello limit</span></span> |<span data-ttu-id="25262-134">AUTO</span><span class="sxs-lookup"><span data-stu-id="25262-134">AUTO</span></span> |<span data-ttu-id="25262-135">Imposto para todos os bancos de dados</span><span class="sxs-lookup"><span data-stu-id="25262-135">Enforced for all databases</span></span> |
| <span data-ttu-id="25262-136">QUERY_CAPTURE_MODE</span><span class="sxs-lookup"><span data-stu-id="25262-136">QUERY_CAPTURE_MODE</span></span> |<span data-ttu-id="25262-137">Especifica se todas as consultas ou apenas um subconjunto de consultas será controlado</span><span class="sxs-lookup"><span data-stu-id="25262-137">Specifies whether all queries or only a subset of queries are tracked</span></span> |<span data-ttu-id="25262-138">AUTO</span><span class="sxs-lookup"><span data-stu-id="25262-138">AUTO</span></span> |<span data-ttu-id="25262-139">Imposto para todos os bancos de dados</span><span class="sxs-lookup"><span data-stu-id="25262-139">Enforced for all databases</span></span> |
| <span data-ttu-id="25262-140">FLUSH_INTERVAL_SECONDS</span><span class="sxs-lookup"><span data-stu-id="25262-140">FLUSH_INTERVAL_SECONDS</span></span> |<span data-ttu-id="25262-141">Especifica o período máximo durante o qual estatísticas capturadas de tempo de execução são mantidas na memória, antes de liberar toodisk</span><span class="sxs-lookup"><span data-stu-id="25262-141">Specifies maximum period during which captured runtime statistics are kept in memory, before flushing toodisk</span></span> |<span data-ttu-id="25262-142">900</span><span class="sxs-lookup"><span data-stu-id="25262-142">900</span></span> |<span data-ttu-id="25262-143">Imposto para novos bancos de dados</span><span class="sxs-lookup"><span data-stu-id="25262-143">Enforced for new databases</span></span> |
|  | | | |

> [!IMPORTANT]
> <span data-ttu-id="25262-144">Esses padrões são aplicados automaticamente no estágio final de saudação de ativação de repositório de consultas em todos os bancos de dados do SQL Azure (consulte a observação importante anterior).</span><span class="sxs-lookup"><span data-stu-id="25262-144">These defaults are automatically applied in hello final stage of Query Store activation in all Azure SQL databases (see preceding important note).</span></span> <span data-ttu-id="25262-145">Após essa luz backup, banco de dados do SQL Azure não será alterada valores de configuração definidos por clientes, a menos que eles afetarem negativamente a carga de trabalho primária ou operações confiáveis de saudação repositório de consultas.</span><span class="sxs-lookup"><span data-stu-id="25262-145">After this light up, Azure SQL Database won’t be changing configuration values set by customers, unless they negatively impact primary workload or reliable operations of hello Query Store.</span></span>
> 
> 

<span data-ttu-id="25262-146">Se você quiser toostay com as configurações personalizadas, use [ALTER DATABASE com as opções de repositório de consultas](https://msdn.microsoft.com/library/bb522682.aspx) estado anterior da configuração do toorevert toohello.</span><span class="sxs-lookup"><span data-stu-id="25262-146">If you want toostay with your custom settings, use [ALTER DATABASE with Query Store options](https://msdn.microsoft.com/library/bb522682.aspx) toorevert configuration toohello previous state.</span></span> <span data-ttu-id="25262-147">Check-out [práticas recomendadas com hello repositório de consultas](https://msdn.microsoft.com/library/mt604821.aspx) em ordem toolearn superior como escolher parâmetros de configuração ideal.</span><span class="sxs-lookup"><span data-stu-id="25262-147">Check out [Best Practices with hello Query Store](https://msdn.microsoft.com/library/mt604821.aspx) in order toolearn how top chose optimal configuration parameters.</span></span>

## <a name="next-steps"></a><span data-ttu-id="25262-148">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="25262-148">Next steps</span></span>
[<span data-ttu-id="25262-149">Análise de Desempenho de Banco de Dados SQL</span><span class="sxs-lookup"><span data-stu-id="25262-149">SQL Database Performance Insight</span></span>](sql-database-performance.md)

## <a name="additional-resources"></a><span data-ttu-id="25262-150">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="25262-150">Additional resources</span></span>
<span data-ttu-id="25262-151">Para mais informações, consulte Olá artigos a seguir:</span><span class="sxs-lookup"><span data-stu-id="25262-151">For more information check out hello following articles:</span></span>

* [<span data-ttu-id="25262-152">Uma caixa-preta de bordo para seu banco de dados</span><span class="sxs-lookup"><span data-stu-id="25262-152">A flight data recorder for your database</span></span>](https://azure.microsoft.com/blog/query-store-a-flight-data-recorder-for-your-database) 
* [<span data-ttu-id="25262-153">Monitoramento de desempenho, usando o repositório de consultas Olá</span><span class="sxs-lookup"><span data-stu-id="25262-153">Monitoring Performance By Using hello Query Store</span></span>](https://msdn.microsoft.com/library/dn817826.aspx)
* [<span data-ttu-id="25262-154">Cenários de Uso do Repositório de Consultas</span><span class="sxs-lookup"><span data-stu-id="25262-154">Query Store Usage Scenarios</span></span>](https://msdn.microsoft.com/library/mt614796.aspx)
* [<span data-ttu-id="25262-155">Monitoramento de desempenho, usando o repositório de consultas Olá</span><span class="sxs-lookup"><span data-stu-id="25262-155">Monitoring Performance By Using hello Query Store</span></span>](https://msdn.microsoft.com/library/dn817826.aspx) 

