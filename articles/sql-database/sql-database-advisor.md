---
title: "Recomendações de desempenho - Banco de dados SQL do Azure | Microsoft Docs"
description: "O Banco de Dados SQL do Azure fornece recomendações para seus Bancos de Dados SQL que podem melhorar o desempenho de consulta atual."
services: sql-database
documentationcenter: 
author: stevestein
manager: jhubbard
editor: monicar
ms.assetid: 1db441ff-58f5-45da-8d38-b54dc2aa6145
ms.service: sql-database
ms.custom: monitor & tune
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-management
ms.date: 07/05/2017
ms.author: sstein
ms.openlocfilehash: 357a25a665894c86ddb0f93beeb4dd59d8837489
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="performance-recommendations"></a><span data-ttu-id="e57fd-103">Recomendações do desempenho</span><span class="sxs-lookup"><span data-stu-id="e57fd-103">Performance recommendations</span></span>

<span data-ttu-id="e57fd-104">O Banco de Dados SQL do Azure aprende e adapta-se ao seu aplicativo e fornece recomendações personalizadas permitindo que você maximize o desempenho dos bancos de dados SQL.</span><span class="sxs-lookup"><span data-stu-id="e57fd-104">Azure SQL Database learns and adapts with your application and provides customized recommendations enabling you to maximize the performance of your SQL databases.</span></span> <span data-ttu-id="e57fd-105">O desempenho é avaliado continuamente analisando seu histórico de uso do Banco de Dados SQL.</span><span class="sxs-lookup"><span data-stu-id="e57fd-105">Your performance is continuously assessed by analyzing your SQL Database usage history.</span></span> <span data-ttu-id="e57fd-106">As recomendações fornecidas são baseadas em um padrão de carga de trabalho exclusiva do banco de dados e ajudam a melhorar o desempenho.</span><span class="sxs-lookup"><span data-stu-id="e57fd-106">The recommendations that are provided are based on a database unique workload pattern and help improve its performance.</span></span>

> [!NOTE]
> <span data-ttu-id="e57fd-107">A maneira recomendada de usar as recomendações é habilitar o 'Ajuste automático' no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="e57fd-107">Recommended way of using recommendations is by enabling ‘Automatic tuning’ on your database.</span></span> <span data-ttu-id="e57fd-108">Para obter detalhes, confira [Ajuste automático](sql-database-automatic-tuning.md).</span><span class="sxs-lookup"><span data-stu-id="e57fd-108">For details, see [Automatic tuning](sql-database-automatic-tuning.md).</span></span>
>

## <a name="create-index-recommendations"></a><span data-ttu-id="e57fd-109">Criar recomendações de índice</span><span class="sxs-lookup"><span data-stu-id="e57fd-109">Create index recommendations</span></span>
<span data-ttu-id="e57fd-110">O Banco de Dados SQL do Azure monitora continuamente as consultas que estão sendo executadas e identifica os índices que podem melhorar o desempenho.</span><span class="sxs-lookup"><span data-stu-id="e57fd-110">Azure SQL Database continuously monitors the queries being executed and identifies the indexes that could improve the performance.</span></span> <span data-ttu-id="e57fd-111">Após haver certeza suficiente de que determinado índice está ausente, uma nova recomendação **Criar índice** será criada.</span><span class="sxs-lookup"><span data-stu-id="e57fd-111">Once enough confidence is built that a certain index is missing, a new **Create index** recommendation will be created.</span></span> <span data-ttu-id="e57fd-112">O Banco de Dados SQL do Azure aumenta a confiança estimando o ganho de desempenho que o índice trará ao longo do tempo.</span><span class="sxs-lookup"><span data-stu-id="e57fd-112">Azure SQL Database builds confidence by estimating performance gain the index would bring through time.</span></span> <span data-ttu-id="e57fd-113">Dependendo do ganho de desempenho estimado, as recomendações são categorizadas como alta, média ou baixa.</span><span class="sxs-lookup"><span data-stu-id="e57fd-113">Depending on the estimated performance gain, recommendations are categorized as High, Medium,  or Low.</span></span> 

<span data-ttu-id="e57fd-114">Índices criados usando as recomendações sempre são sinalizados como índices auto_created.</span><span class="sxs-lookup"><span data-stu-id="e57fd-114">Indexes created using recommendations are always flagged as auto_created indexes.</span></span> <span data-ttu-id="e57fd-115">Você pode ver quais índices são auto_created examinando a exibição sys.indexes.</span><span class="sxs-lookup"><span data-stu-id="e57fd-115">You can see which indexes are auto_created by looking at sys.indexes view.</span></span> <span data-ttu-id="e57fd-116">Índices criados automaticamente não bloqueiam os comandos ALTER/RENAME.</span><span class="sxs-lookup"><span data-stu-id="e57fd-116">Auto created indexes don’t block ALTER/RENAME commands.</span></span> <span data-ttu-id="e57fd-117">Se você tentar remover a coluna que tem um índice criado automaticamente, o comando passará o índice criado automaticamente será descartado com o comando também.</span><span class="sxs-lookup"><span data-stu-id="e57fd-117">If you try to drop the column that has an auto created index over it, the command passes and the auto created index is dropped with the command as well.</span></span> <span data-ttu-id="e57fd-118">Índices regulares bloqueariam o comando ALTER/RENAME em colunas que são indexadas.</span><span class="sxs-lookup"><span data-stu-id="e57fd-118">Regular indexes would block the ALTER/RENAME command on columns that are indexed.</span></span>

<span data-ttu-id="e57fd-119">Depois que a recomendação para criar índice for aplicada, o Banco de Dados do Azure SQL comparará o desempenho das consultas ao desempenho de linha de base.</span><span class="sxs-lookup"><span data-stu-id="e57fd-119">Once the create index recommendation is applied, Azure SQL Database will compare performance of the queries with the baseline performance.</span></span> <span data-ttu-id="e57fd-120">Se o novo índice tiver oferecido melhorias de desempenho, a recomendação será sinalizada como bem-sucedida e o relatório de impacto estará disponível.</span><span class="sxs-lookup"><span data-stu-id="e57fd-120">If new index brought improvements in the performance, recommendation will be flagged as successful and impact report will be available.</span></span> <span data-ttu-id="e57fd-121">Caso o índice não traga os benefícios, ele será revertido automaticamente.</span><span class="sxs-lookup"><span data-stu-id="e57fd-121">In case the index didn’t bring the benefits, it will be automatically reverted.</span></span> <span data-ttu-id="e57fd-122">Dessa forma, o Banco de Dados SQL do Azure garante que o uso das recomendações só melhore o desempenho do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="e57fd-122">This way Azure SQL Database ensures that using recommendations will only improve the database performance.</span></span>

<span data-ttu-id="e57fd-123">Qualquer recomendação **Criar Índice** tem uma política que não permite aplicar a recomendação se o uso de DTU do banco de dados ou o pool estiver acima de 80% nos últimos 20 minutos ou se o armazenamento estiver acima de 90% de uso.</span><span class="sxs-lookup"><span data-stu-id="e57fd-123">Any **Create index** recommendation has a back off policy that won’t allow applying the recommendation if the database or pool DTU usage was above 80% in last 20 minutes or if the storage is above 90% of usage.</span></span> <span data-ttu-id="e57fd-124">Nesse caso, a recomendação será adiada.</span><span class="sxs-lookup"><span data-stu-id="e57fd-124">In this case, the recommendation will be postponed.</span></span>

## <a name="drop-index-recommendations"></a><span data-ttu-id="e57fd-125">Recomendações para Remover Índice</span><span class="sxs-lookup"><span data-stu-id="e57fd-125">Drop index recommendations</span></span>
<span data-ttu-id="e57fd-126">Além de detectar um índice ausente, o banco de dados do SQL Azure analisa continuamente o desempenho dos índices existentes.</span><span class="sxs-lookup"><span data-stu-id="e57fd-126">In addition to detecting a missing index, Azure SQL Database continuously analyzes the performance of existing indexes.</span></span> <span data-ttu-id="e57fd-127">Se o índice não for usado, o banco de dados do SQL Azure recomendará cancelá-lo.</span><span class="sxs-lookup"><span data-stu-id="e57fd-127">If index is not used, Azure SQL Database will recommend dropping it.</span></span> <span data-ttu-id="e57fd-128">Descartar um índice é recomendado em dois casos:</span><span class="sxs-lookup"><span data-stu-id="e57fd-128">Dropping an index is recommended in two cases:</span></span>
* <span data-ttu-id="e57fd-129">O índice é uma duplicata de outro índice (mesma coluna indexada e incluída, esquema de partição e filtros)</span><span class="sxs-lookup"><span data-stu-id="e57fd-129">Index is a duplicate of another index (same indexed and included column, partition schema, and filters)</span></span>
* <span data-ttu-id="e57fd-130">O índice é não utilizado por um período prolongado (93 dias)</span><span class="sxs-lookup"><span data-stu-id="e57fd-130">Index is unused for a prolonged period (93 days)</span></span>

<span data-ttu-id="e57fd-131">Recomendações para Remover Índice também passam por verificação após a implementação.</span><span class="sxs-lookup"><span data-stu-id="e57fd-131">Drop index recommendations also go through the verification after implementation.</span></span> <span data-ttu-id="e57fd-132">Se o desempenho for melhorado, o relatório de impacto estará disponível.</span><span class="sxs-lookup"><span data-stu-id="e57fd-132">If the performance is improved the impact report will be available.</span></span> <span data-ttu-id="e57fd-133">Caso uma degradação do desempenho seja detectada, a recomendação será revertida.</span><span class="sxs-lookup"><span data-stu-id="e57fd-133">In case performance degradation is detected, recommendation will be reverted.</span></span>


## <a name="parameterize-queries-recommendations"></a><span data-ttu-id="e57fd-134">Recomendações para parametrizar consultas</span><span class="sxs-lookup"><span data-stu-id="e57fd-134">Parameterize queries recommendations</span></span>
<span data-ttu-id="e57fd-135">Recomendações para **Parametrizar consultas** aparecem quando o serviço de Banco de Dados SQL detecta que você tem uma ou mais consultas que estão constantemente sendo recompiladas, mas terminam com o mesmo plano de execução de consulta.</span><span class="sxs-lookup"><span data-stu-id="e57fd-135">**Parameterize queries** recommendations appear when you have one or more queries that are constantly being recompiled but end up with the same query execution plan.</span></span> <span data-ttu-id="e57fd-136">Essa condição abre uma oportunidade de aplicar parametrização forçada, o que permitirá que os planos de consulta sejam armazenados em cache e reutilizados no futuro, melhorando o desempenho e reduzindo o uso de recursos.</span><span class="sxs-lookup"><span data-stu-id="e57fd-136">This condition opens up an opportunity to apply forced parameterization, which will allow query plans to be cached and reused in the future improving performance and reducing resource usage.</span></span> 

<span data-ttu-id="e57fd-137">Cada consulta emitida para o servidor SQL inicialmente precisa ser compilada para gerar um plano de execução.</span><span class="sxs-lookup"><span data-stu-id="e57fd-137">Every query issued against SQL Server initially needs to be compiled to generate an execution plan.</span></span> <span data-ttu-id="e57fd-138">Cada plano gerado é adicionado ao cache do plano e as execuções subsequentes da mesma consulta poderão reutilizar esse plano pelo cache, eliminando a necessidade de compilações adicionais.</span><span class="sxs-lookup"><span data-stu-id="e57fd-138">Each generated plan is added to the plan cache and subsequent executions of the same query can reuse this plan from the cache, eliminating the need for additional compilation.</span></span> 

<span data-ttu-id="e57fd-139">Aplicativos que enviam consultas, que incluem valores sem parâmetros, podem causar uma sobrecarga de desempenho, no qual o plano de execução é compilado novamente para cada consulta com valores de parâmetros diferentes.</span><span class="sxs-lookup"><span data-stu-id="e57fd-139">Applications that send queries, which include non-parameterized values, can lead to a performance overhead, where for every such query with different parameter values the execution plan is compiled again.</span></span> <span data-ttu-id="e57fd-140">Em muitos casos, as mesmas consultas com valores de parâmetros diferentes geram os mesmos planos de execução, mas esses planos são adicionados separadamente ao cache do plano.</span><span class="sxs-lookup"><span data-stu-id="e57fd-140">In many cases the same queries with different parameter values generate the same execution plans, but these plans are still separately added to the plan cache.</span></span> <span data-ttu-id="e57fd-141">Os planos de execução de recompilação usam recursos do banco de dados, aumentam o tempo de duração da consulta e sobrecarregam o cache do plano, fazendo com que planos sejam removidos do cache.</span><span class="sxs-lookup"><span data-stu-id="e57fd-141">Recompiling execution plans use database resources, increase the query duration time and overflow the plan cache causing plans to be evicted from the cache.</span></span> <span data-ttu-id="e57fd-142">Esse comportamento do servidor SQL pode ser alterado ao definir a opção de parametrização forçada no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="e57fd-142">This behavior of SQL Server can be altered by setting the forced parameterization option on the database.</span></span> 

<span data-ttu-id="e57fd-143">Para ajudá-lo a estimar o impacto dessa recomendação, você receberá uma comparação entre o uso real da CPU e o uso projetado da CPU (como se a recomendação tivesse sido aplicada).</span><span class="sxs-lookup"><span data-stu-id="e57fd-143">To help you estimate the impact of this recommendation, you are provided with a comparison between the actual CPU usage and the projected CPU usage (as if the recommendation was applied).</span></span> <span data-ttu-id="e57fd-144">Além poupar a CPU, a duração da consulta diminui pelo tempo gasto na compilação.</span><span class="sxs-lookup"><span data-stu-id="e57fd-144">In addition to CPU savings, your query duration decreases for the time spent in compilation.</span></span> <span data-ttu-id="e57fd-145">A sobrecarga no cache do plano também será significativamente reduzida, permitindo que a maioria dos planos permaneça no cache e seja reutilizada.</span><span class="sxs-lookup"><span data-stu-id="e57fd-145">There will also be much less overhead on plan cache, allowing majority of the plans to stay in cache and be reused.</span></span> <span data-ttu-id="e57fd-146">Você pode aplicar essa recomendação com rapidez e facilidade clicando no comando **Aplicar**.</span><span class="sxs-lookup"><span data-stu-id="e57fd-146">You can apply this recommendation quickly and easily by clicking on the **Apply** command.</span></span> 

<span data-ttu-id="e57fd-147">Depois de aplicar essa recomendação, ela habilitará a parametrização forçada em seu banco de dados em minutos e iniciará o processo de monitoramento, que dura aproximadamente 24 horas.</span><span class="sxs-lookup"><span data-stu-id="e57fd-147">Once you apply this recommendation, it will enable forced parameterization within minutes on your database and it starts the monitoring process which approximately lasts for 24 hours.</span></span> <span data-ttu-id="e57fd-148">Após esse período, você poderá ver o relatório de validação que mostra o uso da CPU do seu banco de dados 24 horas antes e depois da aplicação da recomendação.</span><span class="sxs-lookup"><span data-stu-id="e57fd-148">After this period, you will be able to see the validation report that shows CPU usage of your database 24 hours before and after the recommendation has been applied.</span></span> <span data-ttu-id="e57fd-149">O Assistente do Banco de Dados SQL tem um mecanismo de segurança que reverte a recomendação aplicada automaticamente caso uma redução de desempenho seja detectada.</span><span class="sxs-lookup"><span data-stu-id="e57fd-149">SQL Database Advisor has a safety mechanism that automatically reverts the applied recommendation in case a performance regression has been detected.</span></span>

## <a name="fix-schema-issues-recommendations"></a><span data-ttu-id="e57fd-150">Recomendações para corrigir problemas do esquema</span><span class="sxs-lookup"><span data-stu-id="e57fd-150">Fix schema issues recommendations</span></span>
<span data-ttu-id="e57fd-151">Recomendações para **Corrigir problemas do esquema** aparecem quando o serviço de Banco de Dados SQL observa uma anomalia no número erros de SQL relacionados ao esquema ocorrendo no Banco de Dados SQL do Azure.</span><span class="sxs-lookup"><span data-stu-id="e57fd-151">**Fix schema issues** recommendations appear when the SQL Database service notices an anomaly in the number of schema-related SQL errors happening on your Azure SQL Database.</span></span> <span data-ttu-id="e57fd-152">Essa recomendação normalmente aparece quando seu banco de dados encontra vários erros relacionados ao esquema (nome da coluna inválido, nome do objeto inválido etc.) no período de uma hora.</span><span class="sxs-lookup"><span data-stu-id="e57fd-152">This recommendation typically appears when your database encounters multiple schema-related errors (invalid column name, invalid object name, etc.) within an hour.</span></span>

<span data-ttu-id="e57fd-153">"Problemas de esquema" são uma classe de erros de sintaxe no servidor SQL que ocorrem quando a definição da consulta SQL e a definição do esquema do banco de dados não estão alinhadas.</span><span class="sxs-lookup"><span data-stu-id="e57fd-153">“Schema issues” are a class of syntax errors in SQL Server that happen when the definition of the SQL query and the definition of the database schema are not aligned.</span></span> <span data-ttu-id="e57fd-154">Por exemplo, uma das colunas esperadas pela consulta pode estar ausente na tabela de destino ou vice-versa.</span><span class="sxs-lookup"><span data-stu-id="e57fd-154">For example, one of the columns expected by the query may be missing in the target table, or vice versa.</span></span> 

<span data-ttu-id="e57fd-155">Recomendações para “Corrigir problemas do esquema” aparecem quando o serviço de Banco de Dados SQL do Azure observa uma anomalia no número erros de SQL relacionados ao esquema ocorrendo no Banco de Dados SQL do Azure.</span><span class="sxs-lookup"><span data-stu-id="e57fd-155">“Fix schema issue” recommendation appears when Azure SQL Database service notices an anomaly in the number of schema-related SQL errors happening on your Azure SQL Database.</span></span> <span data-ttu-id="e57fd-156">A tabela a seguir mostra os erros relacionados a problemas de esquema:</span><span class="sxs-lookup"><span data-stu-id="e57fd-156">The following table shows the errors that are related to schema issues:</span></span>

| <span data-ttu-id="e57fd-157">Código do Erro SQL</span><span class="sxs-lookup"><span data-stu-id="e57fd-157">SQL Error Code</span></span> | <span data-ttu-id="e57fd-158">Mensagem</span><span class="sxs-lookup"><span data-stu-id="e57fd-158">Message</span></span> |
| --- | --- |
| <span data-ttu-id="e57fd-159">201</span><span class="sxs-lookup"><span data-stu-id="e57fd-159">201</span></span> |<span data-ttu-id="e57fd-160">Procedimento ou função '*' espera o parâmetro '*', que não foi fornecido.</span><span class="sxs-lookup"><span data-stu-id="e57fd-160">Procedure or function '*' expects parameter '*', which was not supplied.</span></span> |
| <span data-ttu-id="e57fd-161">207</span><span class="sxs-lookup"><span data-stu-id="e57fd-161">207</span></span> |<span data-ttu-id="e57fd-162">Nome de coluna inválido '*'.</span><span class="sxs-lookup"><span data-stu-id="e57fd-162">Invalid column name '*'.</span></span> |
| <span data-ttu-id="e57fd-163">208</span><span class="sxs-lookup"><span data-stu-id="e57fd-163">208</span></span> |<span data-ttu-id="e57fd-164">Nome de objeto inválido '*'.</span><span class="sxs-lookup"><span data-stu-id="e57fd-164">Invalid object name '*'.</span></span> |
| <span data-ttu-id="e57fd-165">213</span><span class="sxs-lookup"><span data-stu-id="e57fd-165">213</span></span> |<span data-ttu-id="e57fd-166">O nome da coluna ou o número de valores fornecidos não corresponde à definição da tabela.</span><span class="sxs-lookup"><span data-stu-id="e57fd-166">Column name or number of supplied values does not match table definition.</span></span> |
| <span data-ttu-id="e57fd-167">2812</span><span class="sxs-lookup"><span data-stu-id="e57fd-167">2812</span></span> |<span data-ttu-id="e57fd-168">Não foi possível encontrar o procedimento armazenado '*'.</span><span class="sxs-lookup"><span data-stu-id="e57fd-168">Could not find stored procedure '*'.</span></span> |
| <span data-ttu-id="e57fd-169">8144</span><span class="sxs-lookup"><span data-stu-id="e57fd-169">8144</span></span> |<span data-ttu-id="e57fd-170">Função ou procedimento * tem muitos argumentos especificados.</span><span class="sxs-lookup"><span data-stu-id="e57fd-170">Procedure or function * has too many arguments specified.</span></span> |

## <a name="next-steps"></a><span data-ttu-id="e57fd-171">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="e57fd-171">Next steps</span></span>
<span data-ttu-id="e57fd-172">Monitore suas recomendações e continue a aplicá-las para refinar o desempenho.</span><span class="sxs-lookup"><span data-stu-id="e57fd-172">Monitor your recommendations and continue to apply them to refine performance.</span></span> <span data-ttu-id="e57fd-173">Cargas de trabalho de banco de dados são dinâmicas e mudam continuamente.</span><span class="sxs-lookup"><span data-stu-id="e57fd-173">Database workloads are dynamic and change continuously.</span></span> <span data-ttu-id="e57fd-174">O assistente do Banco de Dados SQL continua a monitorar e fornecer recomendações que podem potencialmente melhorar o desempenho do seu banco de dados.</span><span class="sxs-lookup"><span data-stu-id="e57fd-174">SQL Database advisor continues to monitor and provide recommendations that can potentially improve your database's performance.</span></span> 

* <span data-ttu-id="e57fd-175">Confira [Recomendações de desempenho no portal do Azure](sql-database-advisor-portal.md) para obter etapas sobre como usar as recomendações de desempenho no portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="e57fd-175">See [Performance recommendations in the Azure portal](sql-database-advisor-portal.md) for steps on how to use performance recommendations in the Azure portal.</span></span>
* <span data-ttu-id="e57fd-176">Consulte [Análise de desempenho de consultas](sql-database-query-performance.md) para saber mais e visualizar o impacto no desempenho de suas principais consultas.</span><span class="sxs-lookup"><span data-stu-id="e57fd-176">See [Query Performance Insights](sql-database-query-performance.md) to learn about and view the performance impact of your top queries.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="e57fd-177">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="e57fd-177">Additional resources</span></span>
* [<span data-ttu-id="e57fd-178">Repositório de Consultas</span><span class="sxs-lookup"><span data-stu-id="e57fd-178">Query Store</span></span>](https://msdn.microsoft.com/library/dn817826.aspx)
* [<span data-ttu-id="e57fd-179">CREATE INDEX</span><span class="sxs-lookup"><span data-stu-id="e57fd-179">CREATE INDEX</span></span>](https://msdn.microsoft.com/library/ms188783.aspx)
* [<span data-ttu-id="e57fd-180">Controle de acesso baseado em função</span><span class="sxs-lookup"><span data-stu-id="e57fd-180">Role-based access control</span></span>](../active-directory/role-based-access-control-what-is.md)

