---
title: "Gerenciar o esquema de Banco de Dados Azure SQL em um aplicativo multilocatário | Microsoft Docs"
description: "Gerenciar o esquema para vários locatários em um aplicativo multilocatário que usa o Banco de Dados SQL do Azure"
keywords: tutorial do banco de dados SQL
services: sql-database
documentationcenter: 
author: stevestein
manager: jhubbard
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/28/2017
ms.author: billgib; sstein
ms.openlocfilehash: 78d76efb88bf11fa18a416b59e6f881539141232
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/03/2017
---
# <a name="manage-schema-for-multiple-tenants-in-the-wingtip-saas-application"></a><span data-ttu-id="6b8f8-104">Gerenciamento do esquema para vários locatários no aplicativo de SaaS do Wingtip</span><span class="sxs-lookup"><span data-stu-id="6b8f8-104">Manage schema for multiple tenants in the Wingtip SaaS application</span></span>

<span data-ttu-id="6b8f8-105">O [primeiro tutorial de SaaS do Wingtip](sql-database-saas-tutorial.md) mostra como o aplicativo pode provisionar um banco de dados do locatário e registrá-lo no catálogo.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-105">The [first Wingtip SaaS tutorial](sql-database-saas-tutorial.md) shows how the app can provision a tenant database and register it in the catalog.</span></span> <span data-ttu-id="6b8f8-106">Como qualquer aplicativo, o aplicativo de SaaS do Wingtip evoluirá ao longo do tempo e, às vezes, exigirá alterações no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-106">Like any application, the Wingtip SaaS app will evolve over time, and at times will require changes to the database.</span></span> <span data-ttu-id="6b8f8-107">As alterações podem incluir um esquema novo ou alterado, dados de referência novos ou alterados e tarefas de manutenção de rotina do banco de dados para garantir o desempenho ideal do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-107">Changes may include new or changed schema, new or changed reference data, and routine database maintenance tasks to ensure optimal app performance.</span></span> <span data-ttu-id="6b8f8-108">Com um aplicativo SaaS, essas alterações precisam ser implantadas de maneira coordenada em uma frota potencialmente grande de bancos de dados de locatário.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-108">With a SaaS application, these changes need to be deployed in a coordinated manner across a potentially massive fleet of tenant databases.</span></span> <span data-ttu-id="6b8f8-109">Para que essas alterações estejam em bancos de dados de locatário futuros, elas precisam ser incorporadas ao processo de provisionamento.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-109">For these changes to be in future tenant databases, they need to be incorporated into the provisioning process.</span></span>

<span data-ttu-id="6b8f8-110">Este tutorial explora dois cenários: implantação de atualizações de dados de referência para todos os locatários e reajuste de um índice na tabela que contém os dados de referência.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-110">This tutorial explores two scenarios - deploying reference data updates for all tenants, and retuning an index on the table containing the reference data.</span></span> <span data-ttu-id="6b8f8-111">Para executar essas operações em todos os locatários é usado o recurso [Trabalhos elásticos](sql-database-elastic-jobs-overview.md) e também um banco de dados de locatário *golden*, que é usado como um modelo para novos bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-111">The [Elastic jobs](sql-database-elastic-jobs-overview.md) feature is used to execute these operations across all tenants, and the *golden* tenant database that is used as a template for new databases.</span></span>

<span data-ttu-id="6b8f8-112">Neste tutorial, você aprenderá a:</span><span class="sxs-lookup"><span data-stu-id="6b8f8-112">In this tutorial you learn how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="6b8f8-113">Criar uma conta de trabalho</span><span class="sxs-lookup"><span data-stu-id="6b8f8-113">Create a job account</span></span>
> * <span data-ttu-id="6b8f8-114">Consultar vários locatários</span><span class="sxs-lookup"><span data-stu-id="6b8f8-114">Query across multiple tenants</span></span>
> * <span data-ttu-id="6b8f8-115">Atualizar dados em todos os bancos de dados de locatário</span><span class="sxs-lookup"><span data-stu-id="6b8f8-115">Update data in all tenant databases</span></span>
> * <span data-ttu-id="6b8f8-116">Criar um índice em uma tabela em todos os bancos de dados de locatário</span><span class="sxs-lookup"><span data-stu-id="6b8f8-116">Create an index on a table in all tenant databases</span></span>


<span data-ttu-id="6b8f8-117">Para concluir este tutorial, certifique-se de atender a todos os seguintes pré-requisitos:</span><span class="sxs-lookup"><span data-stu-id="6b8f8-117">To complete this tutorial, make sure the following prerequisites are met:</span></span>

* <span data-ttu-id="6b8f8-118">O aplicativo SaaS Wingtip é implantado.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-118">The Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="6b8f8-119">Para implantar em menos de cinco minutos, confira [Implantar e explorar o aplicativo de SaaS do Wingtip](sql-database-saas-tutorial.md)</span><span class="sxs-lookup"><span data-stu-id="6b8f8-119">To deploy in less than five minutes, see [Deploy and explore the Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="6b8f8-120">O Azure PowerShell está instalado.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-120">Azure PowerShell is installed.</span></span> <span data-ttu-id="6b8f8-121">Para obter detalhes, consulte [Introdução ao Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span><span class="sxs-lookup"><span data-stu-id="6b8f8-121">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>
* <span data-ttu-id="6b8f8-122">A última versão do SQL Server Management Studio (SSMS) está instalada.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-122">The latest version of SQL Server Management Studio (SSMS) is installed.</span></span> [<span data-ttu-id="6b8f8-123">Baixar e Instalar o SSMS</span><span class="sxs-lookup"><span data-stu-id="6b8f8-123">Download and Install SSMS</span></span>](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms)

<span data-ttu-id="6b8f8-124">*Este tutorial usa funcionalidades do serviço do Banco de Dados SQL que estão em uma versão prévia limitada (trabalhos de Banco de Dados Elástico). Se você quiser fazer este tutorial, forneça sua ID de assinatura para SaaSFeedback@microsoft.com com o assunto = Elastic Jobs Preview. Após receber a confirmação de que sua assinatura foi habilitada, [baixe e instale as versões de pré-lançamento mais recentes dos cmdlets de trabalhos](https://github.com/jaredmoo/azure-powershell/releases). Esta é uma versão prévia limitada, então contate SaaSFeedback@microsoft.com para conferir perguntas relacionadas ou para obter suporte.*</span><span class="sxs-lookup"><span data-stu-id="6b8f8-124">*This tutorial uses features of the SQL Database service that are in a limited preview (Elastic Database jobs). If you wish to do this tutorial, provide your subscription id to SaaSFeedback@microsoft.com with subject=Elastic Jobs Preview. After you receive confirmation that your subscription has been enabled, [download and install the latest pre-release jobs cmdlets](https://github.com/jaredmoo/azure-powershell/releases). This preview is limited, so contact SaaSFeedback@microsoft.com for related questions or support.*</span></span>


## <a name="introduction-to-saas-schema-management-patterns"></a><span data-ttu-id="6b8f8-125">Introdução aos padrões de gerenciamento de esquema de SaaS</span><span class="sxs-lookup"><span data-stu-id="6b8f8-125">Introduction to SaaS Schema Management patterns</span></span>

<span data-ttu-id="6b8f8-126">O padrão de SaaS de único locatário por banco de dados se beneficia, de muitas maneiras, do isolamento de dados resultante, mas, ao mesmo tempo, apresenta a complexidade adicional de manter e gerenciar vários bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-126">The single tenant per database SaaS pattern benefits in many ways from the data isolation that results, but at the same time introduces the additional complexity of maintaining and managing many databases.</span></span> <span data-ttu-id="6b8f8-127">Os [Trabalhos Elásticos](sql-database-elastic-jobs-overview.md) facilitam a administração e o gerenciamento da camada de dados do SQL.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-127">[Elastic Jobs](sql-database-elastic-jobs-overview.md) facilitates administration and management of the SQL data tier.</span></span> <span data-ttu-id="6b8f8-128">Os trabalhos permitem que você execute tarefas (scripts T-SQL) de maneira segura e confiável, independentes da interação ou da entrada do usuário, em relação a um grupo de bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-128">Jobs enable you to securely and reliably, run tasks (T-SQL scripts) independent of user interaction or input, against a group of databases.</span></span> <span data-ttu-id="6b8f8-129">Esse método pode ser usado para implantar esquemas e alterações de dados de referência comum em todos os locatários em um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-129">This method can be used to deploy schema and common reference data changes across all tenants in an application.</span></span> <span data-ttu-id="6b8f8-130">Os Trabalhos Elásticos também podem ser usados para manter uma cópia *golden* do banco de dados usado para criar novos locatários, garantindo que ela sempre tenha os dados de esquema e de referência mais recentes.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-130">Elastic Jobs can also be used to maintain a *golden* copy of the database used to create new tenants, ensuring it always has the latest schema and reference data.</span></span>

![tela](media/sql-database-saas-tutorial-schema-management/schema-management.png)


## <a name="elastic-jobs-limited-preview"></a><span data-ttu-id="6b8f8-132">Versão prévia limitada dos Trabalhos Elásticos</span><span class="sxs-lookup"><span data-stu-id="6b8f8-132">Elastic Jobs limited preview</span></span>

<span data-ttu-id="6b8f8-133">Há uma nova versão dos Trabalhos Elásticos, que agora é um recurso integrado do Banco de Dados SQL do Azure (que não requer serviços ou componentes adicionais).</span><span class="sxs-lookup"><span data-stu-id="6b8f8-133">There is a new version of Elastic Jobs that is now an integrated feature of Azure SQL Database (that requires no additional services or components).</span></span> <span data-ttu-id="6b8f8-134">Essa nova versão dos Trabalhos Elásticos está em versão prévia limitada atualmente.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-134">This new version of Elastic Jobs is currently in limited preview.</span></span> <span data-ttu-id="6b8f8-135">Essa versão prévia limitada atualmente dá suporte ao PowerShell para criar contas de trabalho e ao T-SQL para criar e gerenciar trabalhos.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-135">This limited preview currently supports PowerShell to create job accounts, and T-SQL to create and manage jobs.</span></span>

> [!NOTE]
> <span data-ttu-id="6b8f8-136">*Este tutorial usa funcionalidades do serviço do Banco de Dados SQL que estão em uma versão prévia limitada (trabalhos de Banco de Dados Elástico). Se você quiser fazer este tutorial, forneça sua ID de assinatura para SaaSFeedback@microsoft.com com o assunto = Elastic Jobs Preview. Após receber a confirmação de que sua assinatura foi habilitada, [baixe e instale as versões de pré-lançamento mais recentes dos cmdlets de trabalhos](https://github.com/jaredmoo/azure-powershell/releases). Esta é uma versão prévia limitada, então contate SaaSFeedback@microsoft.com para conferir perguntas relacionadas ou para obter suporte.*</span><span class="sxs-lookup"><span data-stu-id="6b8f8-136">*This tutorial uses features of the SQL Database service that are in a limited preview (Elastic Database jobs). If you wish to do this tutorial, provide your subscription id to SaaSFeedback@microsoft.com with subject=Elastic Jobs Preview. After you receive confirmation that your subscription has been enabled, [download and install the latest pre-release jobs cmdlets](https://github.com/jaredmoo/azure-powershell/releases). This preview is limited, so contact SaaSFeedback@microsoft.com for related questions or support.*</span></span>

## <a name="get-the-wingtip-application-scripts"></a><span data-ttu-id="6b8f8-137">Obter os scripts do aplicativo Wingtip</span><span class="sxs-lookup"><span data-stu-id="6b8f8-137">Get the Wingtip application scripts</span></span>

<span data-ttu-id="6b8f8-138">Os scripts de SaaS do Wingtip e o código-fonte do aplicativo estão disponíveis no repositório GitHub [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS).</span><span class="sxs-lookup"><span data-stu-id="6b8f8-138">The Wingtip SaaS scripts and application source code are available in the [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="6b8f8-139">[Etapas para baixar os scripts do SaaS Wingtip](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="6b8f8-139">[Steps to download the Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>

## <a name="create-a-job-account-database-and-new-job-account"></a><span data-ttu-id="6b8f8-140">Criar um banco de dados de conta de trabalho e uma nova conta de trabalho</span><span class="sxs-lookup"><span data-stu-id="6b8f8-140">Create a job account database and new job account</span></span>

<span data-ttu-id="6b8f8-141">Este tutorial exige que você use o PowerShell para criar o banco de dados de conta de trabalho e a conta de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-141">This tutorial requires you use PowerShell to create the job account database and job account.</span></span> <span data-ttu-id="6b8f8-142">Como no MSDB e no SQL Agent, os Trabalhos Elásticos usam um Banco de Dados SQL do Azure para armazenar definições de trabalho, status de trabalho e o histórico.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-142">Like MSDB and SQL Agent, Elastic Jobs uses an Azure SQL database to store job definitions, job status, and history.</span></span> <span data-ttu-id="6b8f8-143">Depois que a conta de trabalho é criada, você pode criar e monitorar trabalhos imediatamente.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-143">Once the job account is created, you can create and monitor jobs immediately.</span></span>

1. <span data-ttu-id="6b8f8-144">Abra ...\\Módulos de aprendizado\\Gerenciamento de esquema\\*Demo-SchemaManagement.ps1* no **ISE do PowerShell**.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-144">Open …\\Learning Modules\\Schema Management\\*Demo-SchemaManagement.ps1* in the **PowerShell ISE**.</span></span>
1. <span data-ttu-id="6b8f8-145">Pressione **F5** para executar o script.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-145">Press **F5** to run the script.</span></span>

<span data-ttu-id="6b8f8-146">O script *Demo-SchemaManagement.ps1* chama o script *Deploy-SchemaManagement.ps1* para criar um banco de dados *S2* denominado **jobaccount** no servidor de catálogo.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-146">The *Demo-SchemaManagement.ps1* script calls the *Deploy-SchemaManagement.ps1* script to create an *S2* database named **jobaccount** on the catalog server.</span></span> <span data-ttu-id="6b8f8-147">Em seguida, ele cria a conta de trabalho, passando o banco de dados jobaccount como um parâmetro para a chamada de criação da conta de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-147">It then creates the job account, passing the jobaccount database as a parameter to the job account creation call.</span></span>

## <a name="create-a-job-to-deploy-new-reference-data-to-all-tenants"></a><span data-ttu-id="6b8f8-148">Criar um trabalho para implantar novos dados de referência para todos os locatários</span><span class="sxs-lookup"><span data-stu-id="6b8f8-148">Create a job to deploy new reference data to all tenants</span></span>

<span data-ttu-id="6b8f8-149">Cada banco de dados de locatário inclui um conjunto de tipos de local que define os tipos de eventos que são sediados em um local.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-149">Each tenant database includes a set of venue types that define the kind of events that are hosted at a venue.</span></span> <span data-ttu-id="6b8f8-150">Neste exercício, você implanta uma atualização em todos os bancos de dados de locatário para adicionar dois tipos de local: *Motorcycle Racing* e *Swimming Club*.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-150">In this exercise, you deploy an update to all the tenant databases to add two additional venue types: *Motorcycle Racing* and *Swimming Club*.</span></span> <span data-ttu-id="6b8f8-151">Esses tipos de local correspondem à imagem de tela de fundo que você vê no aplicativo de eventos de locatário.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-151">These venue types correspond to the background image you see in the tenant events app.</span></span>

<span data-ttu-id="6b8f8-152">Clique no menu suspenso Tipo de Local e verifique se apenas 10 opções de tipo de local estão disponíveis e, especificamente, se "Motorcycle Racing" e "Swimming Club" não são incluídos na lista.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-152">Click the Venue Type drop down menu and validate that only 10 venue type options are available, and specifically that ‘Motorcycle Racing’ and ‘Swimming Club’ are not included in the list.</span></span>

<span data-ttu-id="6b8f8-153">Agora vamos criar um trabalho para atualizar a tabela *VenueTypes* em todos os bancos de dados de locatário e adicionar os novos tipos de local.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-153">Now let’s create a job to update the *VenueTypes* table in all the tenant databases and add the new venue types.</span></span>

<span data-ttu-id="6b8f8-154">Para criar um novo trabalho, usamos um conjunto de trabalhos que os procedimentos armazenados do sistema criou no banco de dados jobaccount quando a conta de trabalho foi criada.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-154">To create a new job, we use a set of jobs system stored procedures created in the jobaccount database when the job account was created.</span></span>

1. <span data-ttu-id="6b8f8-155">Abra o SSMS e conecte-se ao servidor de catálogo: catalog-\<usuário\>.database.windows.net</span><span class="sxs-lookup"><span data-stu-id="6b8f8-155">Open SSMS and connect to the catalog server: catalog-\<user\>.database.windows.net server</span></span>
1. <span data-ttu-id="6b8f8-156">Conecte-se também ao servidor de locatário: tenants1-\<usuário\>.database.windows.net</span><span class="sxs-lookup"><span data-stu-id="6b8f8-156">Also connect to the tenant server: tenants1-\<user\>.database.windows.net</span></span>
1. <span data-ttu-id="6b8f8-157">Navegue até o banco de dados *contosoconcerthall* do servidor *tenants1* e consulte a tabela *VenueTypes* para confirmar que *Motorcycle Racing* e *Swimming Club* **não estão** na lista de resultados.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-157">Browse to the *contosoconcerthall* database on the *tenants1* server and query the *VenueTypes* table to confirm that *Motorcycle Racing* and *Swimming Club* **are not** in the results list.</span></span>
1. <span data-ttu-id="6b8f8-158">Abra o arquivo ...\\Módulos de aprendizado\\Gerenciamento de esquema\\DeployReferenceData.sql</span><span class="sxs-lookup"><span data-stu-id="6b8f8-158">Open the file …\\Learning Modules\\Schema Management\\DeployReferenceData.sql</span></span>
1. <span data-ttu-id="6b8f8-159">Modifique a instrução: SET @wtpUser = &lt;user&gt; e substitua o valor User usado na implantação do aplicativo Wingtip</span><span class="sxs-lookup"><span data-stu-id="6b8f8-159">Modify the statement: SET @wtpUser = &lt;user&gt; and substitute the User value used when you deployed the Wingtip app</span></span>
1. <span data-ttu-id="6b8f8-160">Verifique se está conectado ao banco de dados jobaccount e pressione **F5** para executar o script</span><span class="sxs-lookup"><span data-stu-id="6b8f8-160">Ensure you are connected to the jobaccount database and press **F5** to run the script</span></span>

* <span data-ttu-id="6b8f8-161">**sp\_add\_target\_group** cria o nome do grupo de destino DemoServerGroup, agora é preciso adicionar os membros de destino.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-161">**sp\_add\_target\_group** creates the target group name DemoServerGroup, now we need to add target members.</span></span>
* <span data-ttu-id="6b8f8-162">**sp\_add\_target\_group\_member** adiciona um tipo de membro de destino do *servidor*, o que considera todos os bancos de dados neste servidor (observe que esse é o servidor tenants1-&lt;User&gt; que contém os bancos de dados do locatário) na hora em que a execução de trabalho deve ser incluída no trabalho. O segundo está adicionando um tipo de membro de destino de *banco de dados*, especificamente banco de dados "golden", basetenantdb, que reside no servidor catalog-&lt;User&gt; e, por fim, outro tipo de membro de grupo de destino de *banco de dados* para incluir o banco de dados adhocanalytics que será usado em um tutorial posterior.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-162">**sp\_add\_target\_group\_member** adds a *server* target member type, which deems all databases within that server (note this is the tenants1-&lt;User&gt; server containing the tenant databases) at time of job execution should be included in the job, the second is adding a *database* target member type, specifically the ‘golden’ database (basetenantdb) that resides on catalog-&lt;User&gt; server, and lastly another *database* target group member type to include the adhocanalytics database that is used in a later tutorial.</span></span>
* <span data-ttu-id="6b8f8-163">**sp\_add\_job** cria um trabalho chamado “Reference Data Deployment”</span><span class="sxs-lookup"><span data-stu-id="6b8f8-163">**sp\_add\_job** creates a job called “Reference Data Deployment”</span></span>
* <span data-ttu-id="6b8f8-164">**sp\_add\_jobstep** cria a etapa de trabalho que contém o texto do comando T-SQL para atualizar a tabela de referência, VenueTypes</span><span class="sxs-lookup"><span data-stu-id="6b8f8-164">**sp\_add\_jobstep** creates the job step containing T-SQL command text to update the reference table, VenueTypes</span></span>
* <span data-ttu-id="6b8f8-165">As exibições restantes no script exibem a existência dos objetos e monitoram a execução do trabalho.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-165">The remaining views in the script display the existence of the objects and monitor job execution.</span></span> <span data-ttu-id="6b8f8-166">Use essas consultas para examinar o valor de status na coluna **lifecycle** para determinar quando o trabalho foi concluído com êxito em todos os bancos de dados de locatário, e os dois bancos de dados adicionais que contêm a tabela de referência.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-166">Use these queries to review the status value in the **lifecycle** column to determine when the job has successfully finished on all tenant databases and the two additional databases containing the reference table.</span></span>

1. <span data-ttu-id="6b8f8-167">No SSMS, navegue até o banco de dados *contosoconcerthall* do servidor *tenants1* e consulte a tabela *VenueTypes* para confirmar que *Motorcycle Racing* e *Swimming Club* **estão** na lista de resultados.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-167">In SSMS, browse to the *contosoconcerthall* database on the *tenants1* server and query the *VenueTypes* table to confirm that *Motorcycle Racing* and *Swimming Club* **are** now in the results list.</span></span>


## <a name="create-a-job-to-manage-the-reference-table-index"></a><span data-ttu-id="6b8f8-168">Criar um trabalho para gerenciar o índice da tabela de referência</span><span class="sxs-lookup"><span data-stu-id="6b8f8-168">Create a job to manage the reference table index</span></span>

<span data-ttu-id="6b8f8-169">De maneira semelhante ao exercício anterior, este exercício cria um trabalho para recompilar o índice na chave primária da tabela de referência, uma operação típica de gerenciamento de banco de dados que um administrador deve executar após um carregamento de grandes volumes de dados em uma tabela.</span><span class="sxs-lookup"><span data-stu-id="6b8f8-169">Similar to the previous exercise, this exercise creates a job to rebuild the index on the reference table primary key, a typical database management operation an administrator might perform after a large data load into a table.</span></span>

<span data-ttu-id="6b8f8-170">Crie um trabalho usando os mesmos trabalhos dos procedimentos armazenados do "sistema".</span><span class="sxs-lookup"><span data-stu-id="6b8f8-170">Create a job using the same jobs 'system' stored procedures.</span></span>

1. <span data-ttu-id="6b8f8-171">Abra o SSMS e conecte-se ao servidor catalog-&lt;user&gt;.database.windows.net</span><span class="sxs-lookup"><span data-stu-id="6b8f8-171">Open SSMS and connect to the catalog-&lt;User&gt;.database.windows.net server</span></span>
1. <span data-ttu-id="6b8f8-172">Abra o arquivo ...\\Módulos de aprendizado\\Gerenciamento de esquema\\OnlineReindex.sql</span><span class="sxs-lookup"><span data-stu-id="6b8f8-172">Open the file …\\Learning Modules\\Schema Management\\OnlineReindex.sql</span></span>
1. <span data-ttu-id="6b8f8-173">Clique o botão direito do mouse, selecione Conexão e conecte-se ao servidor catalog-&lt;User&gt;.database.windows.net, se ainda não estiver conectado</span><span class="sxs-lookup"><span data-stu-id="6b8f8-173">Right click, select Connection, and connect to the catalog-&lt;User&gt;.database.windows.net server, if not already connected</span></span>
1. <span data-ttu-id="6b8f8-174">Verifique se está conectado ao banco de dados jobaccount e pressione F5 para executar o script</span><span class="sxs-lookup"><span data-stu-id="6b8f8-174">Ensure you are connected to the jobaccount database and press F5 to run the script</span></span>

* <span data-ttu-id="6b8f8-175">sp\_add\_job cria um novo trabalho chamado “Online Reindex PK\_\_VenueTyp\_\_265E44FD7FD4C885”</span><span class="sxs-lookup"><span data-stu-id="6b8f8-175">sp\_add\_job creates a new job called “Online Reindex PK\_\_VenueTyp\_\_265E44FD7FD4C885”</span></span>
* <span data-ttu-id="6b8f8-176">sp\_add\_jobstep cria a etapa de trabalho que contém o texto do comando T-SQL para atualizar o índice</span><span class="sxs-lookup"><span data-stu-id="6b8f8-176">sp\_add\_jobstep creates the job step containing T-SQL command text to update the index</span></span>




## <a name="next-steps"></a><span data-ttu-id="6b8f8-177">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="6b8f8-177">Next steps</span></span>

<span data-ttu-id="6b8f8-178">Neste tutorial, você aprendeu a:</span><span class="sxs-lookup"><span data-stu-id="6b8f8-178">In this tutorial you learned how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="6b8f8-179">Criar uma conta de trabalho para consultar em vários locatários</span><span class="sxs-lookup"><span data-stu-id="6b8f8-179">Create a job account to query across multiple tenants</span></span>
> * <span data-ttu-id="6b8f8-180">Atualizar dados em todos os bancos de dados de locatário</span><span class="sxs-lookup"><span data-stu-id="6b8f8-180">Update data in all tenant databases</span></span>
> * <span data-ttu-id="6b8f8-181">Criar um índice em uma tabela em todos os bancos de dados de locatário</span><span class="sxs-lookup"><span data-stu-id="6b8f8-181">Create an index on a table in all tenant databases</span></span>

[<span data-ttu-id="6b8f8-182">Tutorial de análise ad hoc</span><span class="sxs-lookup"><span data-stu-id="6b8f8-182">Ad-hoc analytics tutorial</span></span>](sql-database-saas-tutorial-adhoc-analytics.md)


## <a name="additional-resources"></a><span data-ttu-id="6b8f8-183">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="6b8f8-183">Additional resources</span></span>

* [<span data-ttu-id="6b8f8-184">Tutoriais adicionais que aproveitam a implantação de aplicativo de SaaS do Wingtip</span><span class="sxs-lookup"><span data-stu-id="6b8f8-184">Additional tutorials that build upon the Wingtip SaaS application deployment</span></span>](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)
* [<span data-ttu-id="6b8f8-185">Gerenciando bancos de dados de nuvem com escalonamento horizontal</span><span class="sxs-lookup"><span data-stu-id="6b8f8-185">Managing scaled-out cloud databases</span></span>](sql-database-elastic-jobs-overview.md)
* [<span data-ttu-id="6b8f8-186">Criar e gerenciar bancos de dados de nuvem com escalonamento horizontal</span><span class="sxs-lookup"><span data-stu-id="6b8f8-186">Create and manage scaled-out cloud databases</span></span>](sql-database-elastic-jobs-create-and-manage.md)
