---
title: aaaHow toouse gerenciamento de API do Azure com redes virtuais
description: "Saiba como toosetup uma rede virtual de tooa de conexão de acesso e gerenciamento do Azure API web services por meio dele."
services: api-management
documentationcenter: 
author: antonba
manager: erikre
editor: 
ms.assetid: 64b58f7b-ca22-47dc-89c0-f6bb0af27a48
ms.service: api-management
ms.workload: mobile
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/15/2016
ms.author: apimpm
ms.openlocfilehash: 426b3974e4fed7daffdb0c3f02381edbc326dc28
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="how-toouse-azure-api-management-with-virtual-networks"></a><span data-ttu-id="4a7ff-103">Como toouse gerenciamento de API do Azure com redes virtuais</span><span class="sxs-lookup"><span data-stu-id="4a7ff-103">How toouse Azure API Management with virtual networks</span></span>
<span data-ttu-id="4a7ff-104">Redes virtuais do Azure (VNETs) permitem que você tooplace qualquer um dos recursos do Azure em uma rede de internet não routeable que você controle de acesso para.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-104">Azure Virtual Networks (VNETs) allow you tooplace any of your Azure resources in a non-internet routeable network that you control access to.</span></span> <span data-ttu-id="4a7ff-105">Essas redes podem ser redes locais de tooyour conectado usando diversas tecnologias VPN.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-105">These networks can then be connected tooyour on-premises networks using various VPN technologies.</span></span> <span data-ttu-id="4a7ff-106">toolearn mais sobre redes virtuais do Azure iniciar com informações de saudação aqui: [visão geral da rede Virtual do Azure](../virtual-network/virtual-networks-overview.md).</span><span class="sxs-lookup"><span data-stu-id="4a7ff-106">toolearn more about Azure Virtual Networks start with hello information here: [Azure Virtual Network Overview](../virtual-network/virtual-networks-overview.md).</span></span>

<span data-ttu-id="4a7ff-107">Gerenciamento de API do Azure pode ser implantado dentro da rede virtual da saudação (VNET), para que ele pode acessar os serviços de back-end em rede hello.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-107">Azure API Management can be deployed inside hello virtual network (VNET), so it can access backend services within hello network.</span></span> <span data-ttu-id="4a7ff-108">Olá portal do desenvolvedor e o gateway de API, pode ser configurado toobe acessível de saudação da Internet ou dentro de rede virtual hello.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-108">hello developer portal and API gateway, can be configured toobe accessible either from hello Internet or only within hello virtual network.</span></span>

> [!NOTE]
> <span data-ttu-id="4a7ff-109">O Gerenciamento de API do Azure oferece suporte às VNets clássicas e do Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-109">Azure API Management supports both classic and Azure Resource Manager VNets.</span></span>
>
>

## <span data-ttu-id="4a7ff-110"><a name="enable-vpn"> </a>Habilitar conexão de VNET</span><span class="sxs-lookup"><span data-stu-id="4a7ff-110"><a name="enable-vpn"> </a>Enable VNET connection</span></span>
> [!NOTE]
> <span data-ttu-id="4a7ff-111">Conectividade de rede virtual está disponível no hello **Premium** e **desenvolvedor** camadas.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-111">VNET connectivity is available in hello **Premium** and **Developer** tiers.</span></span> <span data-ttu-id="4a7ff-112">tooswitch entre camadas hello, abra seu serviço de gerenciamento de API no portal do Azure de saudação e Olá **escala e preços** guia. Em Olá **preço** seção, selecione a camada Premium ou o desenvolvedor de saudação e clique em Salvar.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-112">tooswitch between hello tiers, open your API Management service in hello Azure portal and then open hello **Scale and pricing** tab. Under hello **Pricing tier** section, select hello Premium or Developer tier and click Save.</span></span>
>

<span data-ttu-id="4a7ff-113">conectividade de rede virtual tooenable, abra seu serviço de gerenciamento de API no portal do Azure de saudação e Olá **rede Virtual** página.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-113">tooenable VNET connectivity, open your API Management service in hello Azure portal and open hello **Virtual network** page.</span></span>

![Menu de rede virtual de Gerenciamento de API][api-management-using-vnet-menu]

<span data-ttu-id="4a7ff-115">Selecione o tipo de acesso de saudação desejado:</span><span class="sxs-lookup"><span data-stu-id="4a7ff-115">Select hello desired access type:</span></span>

* <span data-ttu-id="4a7ff-116">**Externa**: portal de desenvolvedor e o gateway de gerenciamento de API Olá são acessíveis de Olá internet pública por meio de um balanceador externo.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-116">**External**: hello API Management gateway and developer portal are accessible from hello public internet via an external load balancer.</span></span> <span data-ttu-id="4a7ff-117">gateway Olá pode acessar recursos na rede virtual hello.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-117">hello gateway can access resources within hello virtual network.</span></span>

![Emparelhamento público][api-management-vnet-public]

* <span data-ttu-id="4a7ff-119">**Interno**: portal de desenvolvedor e o gateway de gerenciamento de API Olá são acessíveis somente de dentro da rede virtual de saudação por meio de um balanceador de carga interno.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-119">**Internal**: hello API Management gateway and developer portal are accessible only from within hello virtual network via an internal load balancer.</span></span> <span data-ttu-id="4a7ff-120">gateway Olá pode acessar recursos na rede virtual hello.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-120">hello gateway can access resources within hello virtual network.</span></span>

![Emparelhamento privado][api-management-vnet-private]

<span data-ttu-id="4a7ff-122">Agora você verá uma lista de todas as regiões em que o serviço de Gerenciamento de API é disponibilizado.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-122">You will now see a list of all regions where your API Management service is provisioned.</span></span> <span data-ttu-id="4a7ff-123">Selecione uma VNET e uma sub-rede para cada região.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-123">Select a VNET and subnet for every region.</span></span> <span data-ttu-id="4a7ff-124">Olá lista é preenchida com clássico e redes virtuais do Gerenciador de recursos disponíveis em suas assinaturas do Azure que são configurados na região de saudação que você está configurando.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-124">hello list is populated with both classic and Resource Manager virtual networks available in your Azure subscriptions that are setup in hello region you are configuring.</span></span>

> [!NOTE]
> <span data-ttu-id="4a7ff-125">**Ponto de extremidade de serviço** Olá acima diagrama inclui/Proxy de Gateway, Portal do publicador, Portal do desenvolvedor, GIT e Olá ponto de extremidade de gerenciamento direto.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-125">**Service Endpoint** in hello above diagram includes Gateway/Proxy, Publisher Portal, Developer Portal, GIT, and hello Direct Management Endpoint.</span></span>
> <span data-ttu-id="4a7ff-126">**Ponto de extremidade de gerenciamento** em Olá acima diagrama é o ponto de extremidade de saudação hospedado Olá configuração de serviço toomanage por meio do portal do Azure e o Powershell.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-126">**Management Endpoint** in hello above diagram is hello endpoint hosted on hello service toomanage configuration via Azure portal and Powershell.</span></span>
> <span data-ttu-id="4a7ff-127">Além disso, observe que, mesmo que o diagrama de saudação mostra endereços IP para seus vários pontos de extremidade, o serviço de gerenciamento de API **somente** responde em seus nomes de host configurado.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-127">Also, note, that, even though, hello diagram shows IP Addresses for its various endpoints, API Management service **only** responds on its configured Hostnames.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="4a7ff-128">Ao implantar uma instância de gerenciamento de API do Azure tooa VNET Gerenciador de recursos, o serviço de saudação deve estar em uma sub-rede dedicada que não contém outros recursos, exceto as instâncias de gerenciamento de API do Azure.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-128">When deploying an Azure API Management instance tooa Resource Manager VNET, hello service must be in a dedicated subnet that contains no other resources except for Azure API Management instances.</span></span> <span data-ttu-id="4a7ff-129">Se uma tentativa for feita toodeploy uma instância de gerenciamento de API do Azure tooa sub-rede VNET Gerenciador de recursos que contém outros recursos, a implantação de saudação falhará.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-129">If an attempt is made toodeploy an Azure API Management instance tooa Resource Manager VNET subnet that contains other resources, hello deployment will fail.</span></span>
>
>

![Selecionar VPN][api-management-setup-vpn-select]

<span data-ttu-id="4a7ff-131">Clique em **salvar** na parte superior de saudação da tela hello.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-131">Click **Save** at hello top of hello screen.</span></span>

> [!NOTE]
> <span data-ttu-id="4a7ff-132">Olá endereço VIP da instância de gerenciamento de API Olá mudará sempre VNET está habilitado ou desabilitado.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-132">hello VIP address of hello API Management instance will change each time VNET is enabled or disabled.</span></span>  
> <span data-ttu-id="4a7ff-133">Olá endereço VIP também será alterada quando o gerenciamento de API é movido de **externo** muito**interno** ou vice-versa</span><span class="sxs-lookup"><span data-stu-id="4a7ff-133">hello VIP address will also change when API Management is moved from **External** too**Internal** or vice-versa</span></span>
>


> [!IMPORTANT]
> <span data-ttu-id="4a7ff-134">Se você remove o gerenciamento de API de uma rede virtual ou alterar Olá um em que é implantado, Olá redes usadas anteriormente podem permanecer bloqueados por backup too4 horas.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-134">If you remove API Management from a VNET or change hello one it is deployed in, hello previously used VNET can remain locked for up too4 hours.</span></span> <span data-ttu-id="4a7ff-135">Durante esse período ele não serão possíveis toodelete Olá VNET ou implantar um novo tooit de recursos.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-135">During this period it will not be possible toodelete hello VNET or deploy a new resource tooit.</span></span>

## <span data-ttu-id="4a7ff-136"><a name="enable-vnet-powershell"> </a>Habilitar a conexão de VNET usando cmdlets do PowerShell</span><span class="sxs-lookup"><span data-stu-id="4a7ff-136"><a name="enable-vnet-powershell"> </a>Enable VNET connection using PowerShell cmdlets</span></span>
<span data-ttu-id="4a7ff-137">Você também pode habilitar a conectividade de rede virtual usando cmdlets do PowerShell Olá</span><span class="sxs-lookup"><span data-stu-id="4a7ff-137">You can also enable VNET connectivity using hello PowerShell cmdlets</span></span>

* <span data-ttu-id="4a7ff-138">**Criar um serviço de gerenciamento de API dentro de uma rede virtual**: usar o cmdlet Olá [AzureRmApiManagement novo](/powershell/module/azurerm.apimanagement/new-azurermapimanagement) toocreate um serviço de gerenciamento de API do Azure dentro de uma rede virtual.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-138">**Create an API Management service inside a VNET**: Use hello cmdlet [New-AzureRmApiManagement](/powershell/module/azurerm.apimanagement/new-azurermapimanagement) toocreate an Azure API Management service inside a VNET.</span></span>

* <span data-ttu-id="4a7ff-139">**Implantar um serviço de gerenciamento de API existente dentro de uma rede virtual**: usar o cmdlet Olá [AzureRmApiManagementDeployment atualização](/powershell/module/azurerm.apimanagement/update-azurermapimanagementdeployment) toomove um serviço de gerenciamento de API do Azure existente dentro de uma rede Virtual.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-139">**Deploy an existing API Management service inside a VNET**: Use hello cmdlet [Update-AzureRmApiManagementDeployment](/powershell/module/azurerm.apimanagement/update-azurermapimanagementdeployment) toomove an existing Azure API Management service inside a Virtual Network.</span></span>

## <span data-ttu-id="4a7ff-140"><a name="connect-vnet"></a>Conectar tooa web serviço hospedado em uma rede virtual</span><span class="sxs-lookup"><span data-stu-id="4a7ff-140"><a name="connect-vnet"> </a>Connect tooa web service hosted within a virtual Network</span></span>
<span data-ttu-id="4a7ff-141">Depois que o serviço de gerenciamento de API é conectado toohello VNET, acessar os serviços de back-end dentro dele não é diferente de acessar serviços públicos.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-141">After your API Management service is connected toohello VNET, accessing backend services within it is no different than accessing public services.</span></span> <span data-ttu-id="4a7ff-142">Basta digitar no endereço IP local de saudação ou Olá nome de host (se um servidor DNS está configurado para Olá rede virtual) do seu serviço web na Olá **URL do serviço Web** campo ao criar uma nova API ou editando uma existente.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-142">Just type in hello local IP address or hello host name (if a DNS server is configured for hello VNET) of your web service into hello **Web service URL** field when creating a new API or editing an existing one.</span></span>

![Adicionar a API da VPN][api-management-setup-vpn-add-api]

## <span data-ttu-id="4a7ff-144"><a name="network-configuration-issues"> </a>Problemas comuns de configuração de rede</span><span class="sxs-lookup"><span data-stu-id="4a7ff-144"><a name="network-configuration-issues"> </a>Common Network Configuration Issues</span></span>
<span data-ttu-id="4a7ff-145">Veja a seguir uma lista de problemas comuns de erro de configuração que podem ocorrer ao implantar o serviço de Gerenciamento de API em uma rede virtual.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-145">Following is a list of common misconfiguration issues that can occur while deploying API Management service into a Virtual Network.</span></span>

* <span data-ttu-id="4a7ff-146">**Instalação de servidor DNS personalizado**: Olá serviço de gerenciamento de API depende de vários serviços do Azure.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-146">**Custom DNS server setup**: hello API Management service depends on several Azure services.</span></span> <span data-ttu-id="4a7ff-147">Quando o gerenciamento de API é hospedado em uma rede virtual com um servidor DNS personalizado, ele precisa tooresolve Olá nomes de host dos serviços do Azure.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-147">When API Management is hosted in a VNET with a custom DNS server, it needs tooresolve hello hostnames of those Azure services.</span></span> <span data-ttu-id="4a7ff-148">Siga [estas](../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server) orientações sobre a configuração de DNS personalizada.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-148">Please follow [this](../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server) guidance on custom DNS setup.</span></span> <span data-ttu-id="4a7ff-149">Consulte abaixo da tabela de portas de saudação e outros requisitos de rede para referência.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-149">See hello ports table below and other network requirements for reference.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="4a7ff-150">É recomendável que, se você estiver usando um servidores de DNS personalizados para Olá VNET, você configurar que **antes de** Implantando um serviço de gerenciamento de API para ele.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-150">It is recommended that, if you are using a Custom DNS Server(s) for hello VNET, you set that up **before** deploying an API Management service into it.</span></span> <span data-ttu-id="4a7ff-151">Caso contrário, você precisa muito atualizar serviço de gerenciamento de API Olá cada vez que você alterar os servidores DNS hello (s) executando Olá [aplicar operação de configuração de rede](https://docs.microsoft.com/en-us/rest/api/apimanagement/apimanagementservice#ApiManagementService_ApplyNetworkConfigurationUpdates)</span><span class="sxs-lookup"><span data-stu-id="4a7ff-151">Otherwise you need too update hello API Management service each time you change hello DNS Servers(s) by running hello [Apply Network Configuration Operation](https://docs.microsoft.com/en-us/rest/api/apimanagement/apimanagementservice#ApiManagementService_ApplyNetworkConfigurationUpdates)</span></span>

* <span data-ttu-id="4a7ff-152">**Portas necessárias para o gerenciamento de API**: tráfego de entrada e saído no hello sub-rede na qual o gerenciamento de API é implantado pode ser controlado usando [grupo de segurança de rede][Network Security Group].</span><span class="sxs-lookup"><span data-stu-id="4a7ff-152">**Ports required for API Management**: Inbound and Outbound traffic into hello Subnet in which API Management is deployed can be controlled using [Network Security Group][Network Security Group].</span></span> <span data-ttu-id="4a7ff-153">Se qualquer uma dessas portas estiver indisponível, o Gerenciamento de API poderá não funcionar corretamente e poderá se tornar inacessível.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-153">If any of these ports are unavailable, API Management may not operate properly and may become inaccessible.</span></span> <span data-ttu-id="4a7ff-154">A existência de uma ou mais dessas portas bloqueadas é outro problema de configuração incorreta no uso do Gerenciamento de API em uma VNET.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-154">Having one or more of these ports blocked is another common misconfiguration issue when using API Management with a VNET.</span></span>

<span data-ttu-id="4a7ff-155">Quando uma instância do serviço de gerenciamento de API é hospedada em uma rede virtual, portas Olá Olá a tabela a seguir são usadas.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-155">When an API Management service instance is hosted in a VNET, hello ports in hello following table are used.</span></span>

| <span data-ttu-id="4a7ff-156">Porta(s) de Origem/Destino</span><span class="sxs-lookup"><span data-stu-id="4a7ff-156">Source / Destination Port(s)</span></span> | <span data-ttu-id="4a7ff-157">Direção</span><span class="sxs-lookup"><span data-stu-id="4a7ff-157">Direction</span></span> | <span data-ttu-id="4a7ff-158">Protocolo de transporte</span><span class="sxs-lookup"><span data-stu-id="4a7ff-158">Transport protocol</span></span> | <span data-ttu-id="4a7ff-159">Finalidade</span><span class="sxs-lookup"><span data-stu-id="4a7ff-159">Purpose</span></span> | <span data-ttu-id="4a7ff-160">Origem/Destino</span><span class="sxs-lookup"><span data-stu-id="4a7ff-160">Source / Destination</span></span> | <span data-ttu-id="4a7ff-161">Tipo de acesso</span><span class="sxs-lookup"><span data-stu-id="4a7ff-161">Access type</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="4a7ff-162">* / 80, 443</span><span class="sxs-lookup"><span data-stu-id="4a7ff-162">* / 80, 443</span></span> |<span data-ttu-id="4a7ff-163">Entrada</span><span class="sxs-lookup"><span data-stu-id="4a7ff-163">Inbound</span></span> |<span data-ttu-id="4a7ff-164">TCP</span><span class="sxs-lookup"><span data-stu-id="4a7ff-164">TCP</span></span> |<span data-ttu-id="4a7ff-165">Comunicação de cliente tooAPI gerenciamento</span><span class="sxs-lookup"><span data-stu-id="4a7ff-165">Client communication tooAPI Management</span></span> |<span data-ttu-id="4a7ff-166">INTERNET / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="4a7ff-166">INTERNET / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="4a7ff-167">Externo</span><span class="sxs-lookup"><span data-stu-id="4a7ff-167">External</span></span> |
| <span data-ttu-id="4a7ff-168">* / 3443</span><span class="sxs-lookup"><span data-stu-id="4a7ff-168">* / 3443</span></span> |<span data-ttu-id="4a7ff-169">Entrada</span><span class="sxs-lookup"><span data-stu-id="4a7ff-169">Inbound</span></span> |<span data-ttu-id="4a7ff-170">TCP</span><span class="sxs-lookup"><span data-stu-id="4a7ff-170">TCP</span></span> |<span data-ttu-id="4a7ff-171">Ponto de extremidade de gerenciamento para o Portal do Azure e o Powershell</span><span class="sxs-lookup"><span data-stu-id="4a7ff-171">Management endpoint for Azure portal and Powershell</span></span> |<span data-ttu-id="4a7ff-172">INTERNET / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="4a7ff-172">INTERNET / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="4a7ff-173">Interno e externo</span><span class="sxs-lookup"><span data-stu-id="4a7ff-173">External & Internal</span></span> |
| <span data-ttu-id="4a7ff-174">* / 80, 443</span><span class="sxs-lookup"><span data-stu-id="4a7ff-174">* / 80, 443</span></span> |<span data-ttu-id="4a7ff-175">Saída</span><span class="sxs-lookup"><span data-stu-id="4a7ff-175">Outbound</span></span> |<span data-ttu-id="4a7ff-176">TCP</span><span class="sxs-lookup"><span data-stu-id="4a7ff-176">TCP</span></span> |<span data-ttu-id="4a7ff-177">Dependência do Armazenamento do Azure e do Barramento de Serviço do Azure</span><span class="sxs-lookup"><span data-stu-id="4a7ff-177">Dependency on Azure Storage and Azure Service Bus</span></span> |<span data-ttu-id="4a7ff-178">VIRTUAL_NETWORK/INTERNET</span><span class="sxs-lookup"><span data-stu-id="4a7ff-178">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="4a7ff-179">Interno e externo</span><span class="sxs-lookup"><span data-stu-id="4a7ff-179">External & Internal</span></span> |
| <span data-ttu-id="4a7ff-180">* / 1433</span><span class="sxs-lookup"><span data-stu-id="4a7ff-180">* / 1433</span></span> |<span data-ttu-id="4a7ff-181">Saída</span><span class="sxs-lookup"><span data-stu-id="4a7ff-181">Outbound</span></span> |<span data-ttu-id="4a7ff-182">TCP</span><span class="sxs-lookup"><span data-stu-id="4a7ff-182">TCP</span></span> |<span data-ttu-id="4a7ff-183">Dependência no SQL Azure</span><span class="sxs-lookup"><span data-stu-id="4a7ff-183">Dependency on Azure SQL</span></span> |<span data-ttu-id="4a7ff-184">VIRTUAL_NETWORK/INTERNET</span><span class="sxs-lookup"><span data-stu-id="4a7ff-184">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="4a7ff-185">Interno e externo</span><span class="sxs-lookup"><span data-stu-id="4a7ff-185">External & Internal</span></span> |
| <span data-ttu-id="4a7ff-186">* / 11000 - 11999</span><span class="sxs-lookup"><span data-stu-id="4a7ff-186">* / 11000 - 11999</span></span> |<span data-ttu-id="4a7ff-187">Saída</span><span class="sxs-lookup"><span data-stu-id="4a7ff-187">Outbound</span></span> |<span data-ttu-id="4a7ff-188">TCP</span><span class="sxs-lookup"><span data-stu-id="4a7ff-188">TCP</span></span> |<span data-ttu-id="4a7ff-189">Dependência do SQL V12 do Azure</span><span class="sxs-lookup"><span data-stu-id="4a7ff-189">Dependency on Azure SQL V12</span></span> |<span data-ttu-id="4a7ff-190">VIRTUAL_NETWORK/INTERNET</span><span class="sxs-lookup"><span data-stu-id="4a7ff-190">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="4a7ff-191">Interno e externo</span><span class="sxs-lookup"><span data-stu-id="4a7ff-191">External & Internal</span></span> |
| <span data-ttu-id="4a7ff-192">* / 14000 - 14999</span><span class="sxs-lookup"><span data-stu-id="4a7ff-192">* / 14000 - 14999</span></span> |<span data-ttu-id="4a7ff-193">Saída</span><span class="sxs-lookup"><span data-stu-id="4a7ff-193">Outbound</span></span> |<span data-ttu-id="4a7ff-194">TCP</span><span class="sxs-lookup"><span data-stu-id="4a7ff-194">TCP</span></span> |<span data-ttu-id="4a7ff-195">Dependência do SQL V12 do Azure</span><span class="sxs-lookup"><span data-stu-id="4a7ff-195">Dependency on Azure SQL V12</span></span> |<span data-ttu-id="4a7ff-196">VIRTUAL_NETWORK/INTERNET</span><span class="sxs-lookup"><span data-stu-id="4a7ff-196">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="4a7ff-197">Interno e externo</span><span class="sxs-lookup"><span data-stu-id="4a7ff-197">External & Internal</span></span> |
| <span data-ttu-id="4a7ff-198">* / 5671</span><span class="sxs-lookup"><span data-stu-id="4a7ff-198">* / 5671</span></span> |<span data-ttu-id="4a7ff-199">Saída</span><span class="sxs-lookup"><span data-stu-id="4a7ff-199">Outbound</span></span> |<span data-ttu-id="4a7ff-200">AMQP</span><span class="sxs-lookup"><span data-stu-id="4a7ff-200">AMQP</span></span> |<span data-ttu-id="4a7ff-201">Dependência de política de Hub tooEvent Log e agente de monitoramento</span><span class="sxs-lookup"><span data-stu-id="4a7ff-201">Dependency for Log tooEvent Hub policy and monitoring agent</span></span> |<span data-ttu-id="4a7ff-202">VIRTUAL_NETWORK/INTERNET</span><span class="sxs-lookup"><span data-stu-id="4a7ff-202">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="4a7ff-203">Interno e externo</span><span class="sxs-lookup"><span data-stu-id="4a7ff-203">External & Internal</span></span> |
| <span data-ttu-id="4a7ff-204">6381 - 6383 / 6381 - 6383</span><span class="sxs-lookup"><span data-stu-id="4a7ff-204">6381 - 6383 / 6381 - 6383</span></span> |<span data-ttu-id="4a7ff-205">Entrada e Saída</span><span class="sxs-lookup"><span data-stu-id="4a7ff-205">Inbound & Outbound</span></span> |<span data-ttu-id="4a7ff-206">UDP</span><span class="sxs-lookup"><span data-stu-id="4a7ff-206">UDP</span></span> |<span data-ttu-id="4a7ff-207">Dependência de Cache Redis</span><span class="sxs-lookup"><span data-stu-id="4a7ff-207">Dependency on Redis Cache</span></span> |<span data-ttu-id="4a7ff-208">VIRTUAL_NETWORK / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="4a7ff-208">VIRTUAL_NETWORK / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="4a7ff-209">Interno e externo</span><span class="sxs-lookup"><span data-stu-id="4a7ff-209">External & Internal</span></span> |-
| <span data-ttu-id="4a7ff-210">* / 445</span><span class="sxs-lookup"><span data-stu-id="4a7ff-210">* / 445</span></span> |<span data-ttu-id="4a7ff-211">Saída</span><span class="sxs-lookup"><span data-stu-id="4a7ff-211">Outbound</span></span> |<span data-ttu-id="4a7ff-212">TCP</span><span class="sxs-lookup"><span data-stu-id="4a7ff-212">TCP</span></span> |<span data-ttu-id="4a7ff-213">Dependência do Compartilhamento de Arquivos do Azure para GIT</span><span class="sxs-lookup"><span data-stu-id="4a7ff-213">Dependency on Azure File Share for GIT</span></span> |<span data-ttu-id="4a7ff-214">VIRTUAL_NETWORK/INTERNET</span><span class="sxs-lookup"><span data-stu-id="4a7ff-214">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="4a7ff-215">Interno e externo</span><span class="sxs-lookup"><span data-stu-id="4a7ff-215">External & Internal</span></span> |
| <span data-ttu-id="4a7ff-216">* / *</span><span class="sxs-lookup"><span data-stu-id="4a7ff-216">* / *</span></span> | <span data-ttu-id="4a7ff-217">Entrada</span><span class="sxs-lookup"><span data-stu-id="4a7ff-217">Inbound</span></span> |<span data-ttu-id="4a7ff-218">TCP</span><span class="sxs-lookup"><span data-stu-id="4a7ff-218">TCP</span></span> |<span data-ttu-id="4a7ff-219">Balanceador de carga de infraestrutura do Azure</span><span class="sxs-lookup"><span data-stu-id="4a7ff-219">Azure Infrastructure Load Balancer</span></span> | <span data-ttu-id="4a7ff-220">AZURE_LOAD_BALANCER / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="4a7ff-220">AZURE_LOAD_BALANCER / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="4a7ff-221">Interno e externo</span><span class="sxs-lookup"><span data-stu-id="4a7ff-221">External & Internal</span></span> |

* <span data-ttu-id="4a7ff-222">**Funcionalidade SSL**: certificado SSL tooenable serviço de gerenciamento de API de saudação de compilação e validação de cadeia precisa tooocsp.msocsp.com de conectividade de rede de saída, mscrl.microsoft.com e crl.microsoft.com. Essa dependência não for necessária, se qualquer certificado que você carregar tooAPI gerenciamento conter raiz do hello cadeia completa toohello da autoridade de certificação.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-222">**SSL functionality**: tooenable SSL certificate chain building and validation hello API Management service needs Outbound network connectivity tooocsp.msocsp.com, mscrl.microsoft.com and crl.microsoft.com. This dependency is not required, if any certificate you upload tooAPI Management contain hello full chain toohello CA root.</span></span>

* <span data-ttu-id="4a7ff-223">**Acesos de DNS**: O acesso de saída na porta 53 é necessário para a comunicação com servidores DNS.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-223">**DNS Access**: Outbound access on port 53 is required for communication with DNS servers.</span></span> <span data-ttu-id="4a7ff-224">Se um servidor DNS personalizado existir no Olá outra extremidade de um gateway VPN, servidor DNS Olá deve ser acessível da sub-rede Olá gerenciamento de API de hospedagem.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-224">If a custom DNS server exists on hello other end of a VPN gateway, hello DNS server must be reachable from hello subnet hosting API Management.</span></span>

* <span data-ttu-id="4a7ff-225">**Monitoramento de integridade e métricas**: saída de rede conectividade tooAzure monitoramento pontos de extremidade, resolver em Olá domínios a seguir: global.metrics.nsatc.net, shoebox2.metrics.nsatc.net, prod3.metrics.nsatc.net.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-225">**Metrics and Health Monitoring**: Outbound network connectivity tooAzure Monitoring endpoints, which resolve under hello following domains: global.metrics.nsatc.net, shoebox2.metrics.nsatc.net, prod3.metrics.nsatc.net.</span></span>

* <span data-ttu-id="4a7ff-226">**Configuração de rota expressa**: uma configuração de cliente comum é toodefine seu próprios rota padrão (0.0.0.0/0), que força a saída da Internet tráfego tooinstead fluxo local.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-226">**Express Route Setup**: A common customer configuration is toodefine their own default route (0.0.0.0/0) which forces outbound Internet traffic tooinstead flow on-premises.</span></span> <span data-ttu-id="4a7ff-227">Este fluxo de tráfego invariavelmente quebras de conectividade com o gerenciamento de API do Azure porque o tráfego de saída hello está bloqueado no local ou NAT por conjunto de irreconhecível tooan de endereços que não funcionam com vários pontos de extremidade do Azure.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-227">This traffic flow invariably breaks connectivity with Azure API Management because hello outbound traffic is either blocked on-premises, or NAT'd tooan unrecognizable set of addresses that no longer work with various Azure endpoints.</span></span> <span data-ttu-id="4a7ff-228">solução Hello é toodefine uma (ou mais) definidos pelo usuário rotas ([UDRs][UDRs]) na sub-rede Olá que contém Olá gerenciamento de API do Azure.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-228">hello solution is toodefine one (or more) user-defined routes ([UDRs][UDRs]) on hello subnet that contains hello Azure API Management.</span></span> <span data-ttu-id="4a7ff-229">Um UDR define as rotas de sub-rede que serão cumpridas em vez de rota padrão de saudação.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-229">A UDR defines subnet-specific routes that will be honored instead of hello default route.</span></span>
  <span data-ttu-id="4a7ff-230">Se possível, é recomendável Olá toouse seguinte configuração:</span><span class="sxs-lookup"><span data-stu-id="4a7ff-230">If possible, it is recommended toouse hello following configuration:</span></span>
 * <span data-ttu-id="4a7ff-231">configuração de rota expressa Olá anuncia 0.0.0.0/0 e todo o tráfego de saída no local de túneis de força por padrão.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-231">hello ExpressRoute configuration advertises 0.0.0.0/0 and by default force tunnels all outbound traffic on-premises.</span></span>
 * <span data-ttu-id="4a7ff-232">Olá UDR aplicada toohello sub-rede contendo Olá gerenciamento de API do Azure define 0.0.0.0/0 com um tipo de próximo salto da Internet.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-232">hello UDR applied toohello subnet containing hello Azure API Management defines 0.0.0.0/0 with a next hop type of Internet.</span></span>
 <span data-ttu-id="4a7ff-233">Olá efeito combinado dessas etapas é que o nível de sub-rede Olá UDR tem precedência sobre Olá ExpressRoute forçada de túneis, garantindo, assim, o acesso de Internet de saída de saudação gerenciamento de API do Azure.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-233">hello combined effect of these steps is that hello subnet level UDR takes precedence over hello ExpressRoute forced tunneling, thus ensuring outbound Internet access from hello Azure API Management.</span></span>

>[!WARNING]  
><span data-ttu-id="4a7ff-234">Não há suporte para o gerenciamento de API do Azure com configurações de rota expressa que **incorretamente entre-anunciar rotas de saudação emparelhamento caminho toohello privada caminho emparelhamento público**.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-234">Azure API Management is not supported with ExpressRoute configurations that **incorrectly cross-advertise routes from hello public peering path toohello private peering path**.</span></span> <span data-ttu-id="4a7ff-235">As configurações de ExpressRoute com emparelhamento público definido receberão anúncios de rota da Microsoft para um grande conjunto de intervalos de endereços IP do Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-235">ExpressRoute configurations that have public peering configured, will receive route advertisements from Microsoft for a large set of Microsoft Azure IP address ranges.</span></span> <span data-ttu-id="4a7ff-236">Se esses intervalos de endereços incorretamente entre anunciados no caminho de emparelhamento privado hello, Olá final significa que todos os pacotes de saída de rede da sub-rede da instância de gerenciamento de API do Azure Olá estão rede do local do cliente tooa incorretamente túnel de força infraestrutura.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-236">If these address ranges are incorrectly cross-advertised on hello private peering path, hello end result is that all outbound network packets from hello Azure API Management instance's subnet are incorrectly force-tunneled tooa customer's on-premises network infrastructure.</span></span> <span data-ttu-id="4a7ff-237">Esse fluxo de rede interrompe o Gerenciamento de API do Azure.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-237">This network flow breaks Azure API Management.</span></span> <span data-ttu-id="4a7ff-238">problema de toothis solução Olá é toostop as rotas entre publicidade Olá emparelhamento caminho toohello privada caminho emparelhamento público.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-238">hello solution toothis problem is toostop cross-advertising routes from hello public peering path toohello private peering path.</span></span>


## <span data-ttu-id="4a7ff-239"><a name="troubleshooting"> </a>Solução de problemas</span><span class="sxs-lookup"><span data-stu-id="4a7ff-239"><a name="troubleshooting"> </a>Troubleshooting</span></span>
<span data-ttu-id="4a7ff-240">Ao fazer a rede de tooyour de alterações, consulte muito[NetworkStatus API](https://docs.microsoft.com/en-us/rest/api/apimanagement/networkstatus), toovalidate se Olá serviço de gerenciamento de API não perdeu acesso tooany de saudação recursos críticos que ele depende.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-240">When making changes tooyour network, refer too[NetworkStatus API](https://docs.microsoft.com/en-us/rest/api/apimanagement/networkstatus), toovalidate if hello API Management service has not lost access tooany of hello critical resources which it depends upon.</span></span> <span data-ttu-id="4a7ff-241">status da conectividade Olá devem ser atualizados a cada 15 minutos.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-241">hello connectivity status should be updated every 15 minutes.</span></span>

## <span data-ttu-id="4a7ff-242"><a name="limitations"> </a>Limitações</span><span class="sxs-lookup"><span data-stu-id="4a7ff-242"><a name="limitations"> </a>Limitations</span></span>
* <span data-ttu-id="4a7ff-243">Uma sub-rede que contém instâncias de Gerenciamento de API não pode conter outros tipos de recursos do Azure.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-243">A subnet containing API Management instances cannot contain any other Azure resource types.</span></span>
* <span data-ttu-id="4a7ff-244">subrede Hello e hello gerenciamento de API do serviço deve estar no Olá a mesma assinatura.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-244">hello subnet and hello API Management service must be in hello same subscription.</span></span>
* <span data-ttu-id="4a7ff-245">Uma sub-rede que contém instâncias de Gerenciamento de API não pode ser movida entre assinaturas.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-245">A subnet containing API Management instances cannot be moved across subscriptions.</span></span>
* <span data-ttu-id="4a7ff-246">Ao usar uma rede virtual interna, somente um endereço IP interno estará disponível no intervalo de saudação indicado na [RFC 1918](https://tools.ietf.org/html/rfc1918), não é possível fornecer um endereço IP público.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-246">When using an internal virtual network, only an internal IP address will be available from hello range stated in [RFC 1918](https://tools.ietf.org/html/rfc1918), a public IP address cannot be provided.</span></span>
* <span data-ttu-id="4a7ff-247">Para implantações de gerenciamento de API de várias regiões, com redes virtuais internas configuradas, os usuários são responsáveis por gerenciar sua próprias conforme eles possuem Olá DNS de balanceamento de carga.</span><span class="sxs-lookup"><span data-stu-id="4a7ff-247">For multi-region API Management deployments, with Internal virtual networks configured, users are responsible for managing their own load balancing as they own hello DNS.</span></span>


## <span data-ttu-id="4a7ff-248"><a name="related-content"> </a>Conteúdo relacionado</span><span class="sxs-lookup"><span data-stu-id="4a7ff-248"><a name="related-content"> </a>Related content</span></span>
* [<span data-ttu-id="4a7ff-249">Conectando um toobackend de rede Virtual usando o Gateway de Vpn</span><span class="sxs-lookup"><span data-stu-id="4a7ff-249">Connecting a Virtual Network toobackend using Vpn Gateway</span></span>](../vpn-gateway/vpn-gateway-about-vpngateways.md#s2smulti)
* [<span data-ttu-id="4a7ff-250">Conectar uma rede virtual de diferentes modelos de implantação</span><span class="sxs-lookup"><span data-stu-id="4a7ff-250">Connecting a Virtual Network from different deployment models</span></span>](../vpn-gateway/vpn-gateway-connect-different-deployment-models-powershell.md)
* [<span data-ttu-id="4a7ff-251">Como toouse Olá Inspetor API tootrace chama no gerenciamento de API do Azure</span><span class="sxs-lookup"><span data-stu-id="4a7ff-251">How toouse hello API Inspector tootrace calls in Azure API Management</span></span>](api-management-howto-api-inspector.md)

[api-management-using-vnet-menu]: ./media/api-management-using-with-vnet/api-management-menu-vnet.png
[api-management-setup-vpn-select]: ./media/api-management-using-with-vnet/api-management-using-vnet-type.png
[api-management-setup-vpn-select]: ./media/api-management-using-with-vnet/api-management-using-vnet-select.png
[api-management-setup-vpn-add-api]: ./media/api-management-using-with-vnet/api-management-using-vnet-add-api.png
[api-management-vnet-private]: ./media/api-management-using-with-vnet/api-management-vnet-private.png
[api-management-vnet-public]: ./media/api-management-using-with-vnet/api-management-vnet-public.png

[Enable VPN connections]: #enable-vpn
[Connect tooa web service behind VPN]: #connect-vpn
[Related content]: #related-content

[UDRs]: ../virtual-network/virtual-networks-udr-overview.md
[Network Security Group]: ../virtual-network/virtual-networks-nsg.md
