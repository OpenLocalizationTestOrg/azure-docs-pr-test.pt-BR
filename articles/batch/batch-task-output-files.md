---
title: "aaaPersist trabalhos e tarefas de saída tooAzure armazenamento com hello API do serviço de lote do Azure | Microsoft Docs"
description: "Saiba como o trabalho e tarefa de lote toopersist toouse API do serviço de lote saída tooAzure armazenamento."
services: batch
author: tamram
manager: timlt
editor: 
ms.service: batch
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: big-compute
ms.date: 06/16/2017
ms.author: tamram
ms.openlocfilehash: 71b3f7c0dda2d2a9d8eb3eef83229873c70ca22c
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="persist-task-data-tooazure-storage-with-hello-batch-service-api"></a><span data-ttu-id="e6b3f-103">Manter os dados de tarefa tooAzure armazenamento com hello API do serviço de lote</span><span class="sxs-lookup"><span data-stu-id="e6b3f-103">Persist task data tooAzure Storage with hello Batch service API</span></span>

[!INCLUDE [batch-task-output-include](../../includes/batch-task-output-include.md)]

<span data-ttu-id="e6b3f-104">Começando com a versão de 2017-05-01, Olá API do serviço de lote dá suporte a tooAzure de dados persistentes saída armazenamento de tarefas e tarefas de Gerenciador de trabalho que são executados em pools de configuração de máquina virtual de saudação.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-104">Starting with version 2017-05-01, hello Batch service API supports persisting output data tooAzure Storage for tasks and job manager tasks that run on pools with hello virtual machine configuration.</span></span> <span data-ttu-id="e6b3f-105">Quando você adiciona uma tarefa, você pode especificar um contêiner no armazenamento do Azure como destino Olá para a saída da tarefa hello.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-105">When you add a task, you can specify a container in Azure Storage as hello destination for hello task's output.</span></span> <span data-ttu-id="e6b3f-106">serviço de lote Hello, em seguida, grava qualquer contêiner de toothat de dados de saída quando Olá tarefa seja concluída.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-106">hello Batch service then writes any output data toothat container when hello task is complete.</span></span>

<span data-ttu-id="e6b3f-107">Saudação de toousing uma vantagem em lotes é de saída da tarefa serviço API toopersist que você não precisa de aplicativo hello toomodify que Olá tarefa está em execução.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-107">An advantage toousing hello Batch service API toopersist task output is that you do not need toomodify hello application that hello task is running.</span></span> <span data-ttu-id="e6b3f-108">Em vez disso, com poucas modificações simples tooyour aplicativo cliente, você pode persistir saída da tarefa de saudação de dentro do código de saudação que cria a tarefa de saudação.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-108">Instead, with a few simple modifications tooyour client application, you can persist hello task's output from within hello code that creates hello task.</span></span>   

## <a name="when-do-i-use-hello-batch-service-api-toopersist-task-output"></a><span data-ttu-id="e6b3f-109">Quando usar a saída da tarefa toopersist Olá API do serviço de lote?</span><span class="sxs-lookup"><span data-stu-id="e6b3f-109">When do I use hello Batch service API toopersist task output?</span></span>

<span data-ttu-id="e6b3f-110">Lote do Azure fornece uma maneira toopersist a saída da tarefa.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-110">Azure Batch provides more than one way toopersist task output.</span></span> <span data-ttu-id="e6b3f-111">Usando a API do serviço de lote de saudação é uma abordagem conveniente que é melhor cenários de toothese adequada:</span><span class="sxs-lookup"><span data-stu-id="e6b3f-111">Using hello Batch service API is a convenient approach that's best suited toothese scenarios:</span></span>

- <span data-ttu-id="e6b3f-112">Você deseja saída da tarefa toopersist toowrite código de dentro de seu aplicativo cliente, sem modificar o aplicativo hello que a tarefa está em execução.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-112">You want toowrite code toopersist task output from within your client application, without modifying hello application that your task is running.</span></span>
- <span data-ttu-id="e6b3f-113">Você deseja toopersist saída das tarefas de lote e o Gerenciador de tarefas em pools criados com a configuração de máquina virtual de saudação.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-113">You want toopersist output from Batch tasks and job manager tasks in pools created with hello virtual machine configuration.</span></span>
- <span data-ttu-id="e6b3f-114">Deseja que o contêiner de armazenamento do Azure de tooan toopersist saída com um nome arbitrário.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-114">You want toopersist output tooan Azure Storage container with an arbitrary name.</span></span>
- <span data-ttu-id="e6b3f-115">Você deseja que o contêiner de armazenamento do Azure toopersist saída tooan chamado acordo toohello [padrão de convenções de arquivo em lotes](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span><span class="sxs-lookup"><span data-stu-id="e6b3f-115">You want toopersist output tooan Azure Storage container named according toohello [Batch File Conventions standard](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span></span> 

<span data-ttu-id="e6b3f-116">Se seu cenário diferente daqueles listados acima, talvez seja necessário tooconsider uma abordagem diferente.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-116">If your scenario differs from those listed above, you may need tooconsider a different approach.</span></span> <span data-ttu-id="e6b3f-117">Por exemplo, API de serviço de lote de saudação não atualmente suporte a streaming saída tooAzure armazenamento enquanto Olá tarefa está em execução.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-117">For example, hello Batch service API does not currently support streaming output tooAzure Storage while hello task is running.</span></span> <span data-ttu-id="e6b3f-118">toostream de saída, considere o uso de biblioteca de convenções de arquivo em lotes hello, disponível para .NET.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-118">toostream output, consider using hello Batch File Conventions library, available for .NET.</span></span> <span data-ttu-id="e6b3f-119">Para outros idiomas, você precisará tooimplement sua própria solução.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-119">For other languages, you'll need tooimplement your own solution.</span></span> <span data-ttu-id="e6b3f-120">Para obter mais informações sobre outras opções para persistir a saída da tarefa, consulte [Persist trabalhos e tarefas de saída tooAzure armazenamento](batch-task-output.md).</span><span class="sxs-lookup"><span data-stu-id="e6b3f-120">For more information on other options for persisting task output, see [Persist job and task output tooAzure Storage](batch-task-output.md).</span></span> 

## <a name="create-a-container-in-azure-storage"></a><span data-ttu-id="e6b3f-121">Criar um contêiner no Armazenamento do Azure</span><span class="sxs-lookup"><span data-stu-id="e6b3f-121">Create a container in Azure Storage</span></span>

<span data-ttu-id="e6b3f-122">saída da tarefa de toopersist tooAzure armazenamento, você precisará toocreate um contêiner que serve como o destino de saudação para os arquivos de saída.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-122">toopersist task output tooAzure Storage, you'll need toocreate a container that serves as hello destination for your output files.</span></span> <span data-ttu-id="e6b3f-123">Crie contêiner de saudação antes de executar a tarefa, preferencialmente antes de enviar seu trabalho.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-123">Create hello container before you run your task, preferably before you submit your job.</span></span> <span data-ttu-id="e6b3f-124">contêiner de saudação toocreate, biblioteca de cliente de armazenamento do Azure apropriada do uso hello ou SDK.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-124">toocreate hello container, use hello appropriate Azure Storage client library or SDK.</span></span> <span data-ttu-id="e6b3f-125">Para obter mais informações sobre as APIs de armazenamento do Azure, consulte Olá [documentação de armazenamento do Azure](https://docs.microsoft.com/azure/storage/).</span><span class="sxs-lookup"><span data-stu-id="e6b3f-125">For more information about Azure Storage APIs, see hello [Azure Storage documentation](https://docs.microsoft.com/azure/storage/).</span></span>

<span data-ttu-id="e6b3f-126">Por exemplo, se você estiver escrevendo seu aplicativo em c#, use Olá [biblioteca de cliente de armazenamento do Azure para .NET](https://www.nuget.org/packages/WindowsAzure.Storage/).</span><span class="sxs-lookup"><span data-stu-id="e6b3f-126">For example, if you are writing your application in C#, use hello [Azure Storage client library for .NET](https://www.nuget.org/packages/WindowsAzure.Storage/).</span></span> <span data-ttu-id="e6b3f-127">Olá mostrado no exemplo a seguir como um contêiner de toocreate:</span><span class="sxs-lookup"><span data-stu-id="e6b3f-127">hello following example shows how toocreate a container:</span></span>

```csharp
CloudBlobContainer container = storageAccount.CreateCloudBlobClient().GetContainerReference(containerName);
await conainer.CreateIfNotExists();
```

## <a name="get-a-shared-access-signature-for-hello-container"></a><span data-ttu-id="e6b3f-128">Obter uma assinatura de acesso compartilhado para o contêiner de saudação</span><span class="sxs-lookup"><span data-stu-id="e6b3f-128">Get a shared access signature for hello container</span></span>

<span data-ttu-id="e6b3f-129">Depois de criar o contêiner de hello, obtenha uma assinatura de acesso compartilhado (SAS) com acesso de gravação toohello contêiner.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-129">After you create hello container, get a shared access signature (SAS) with write access toohello container.</span></span> <span data-ttu-id="e6b3f-130">Uma SAS fornece um contêiner de toohello acesso delegado.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-130">A SAS provides delegated access toohello container.</span></span> <span data-ttu-id="e6b3f-131">Olá SAS concede acesso com um conjunto especificado de permissões e em um intervalo de tempo especificado.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-131">hello SAS grants access with a specified set of permissions and over a specified time interval.</span></span> <span data-ttu-id="e6b3f-132">Olá serviço de lote precisa de uma SAS com contêiner de toohello da saída de tarefa gravação permissões toowrite.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-132">hello Batch service needs a SAS with write permissions toowrite task output toohello container.</span></span> <span data-ttu-id="e6b3f-133">Para saber mais sobre SAS, confira [Uso de assinaturas de acesso compartilhado \(SAS\) no Armazenamento do Azure](../storage/common/storage-dotnet-shared-access-signature-part-1.md).</span><span class="sxs-lookup"><span data-stu-id="e6b3f-133">For more information about SAS, see [Using shared access signatures \(SAS\) in Azure Storage](../storage/common/storage-dotnet-shared-access-signature-part-1.md).</span></span>

<span data-ttu-id="e6b3f-134">Quando você receber uma SAS usando Olá APIs de armazenamento do Azure, Olá API retorna uma cadeia de caracteres de token SAS.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-134">When you get a SAS using hello Azure Storage APIs, hello API returns a SAS token string.</span></span> <span data-ttu-id="e6b3f-135">Essa cadeia de caracteres de token inclui todos os parâmetros de saudação SAS, incluindo permissões hello e intervalo de saudação sobre quais Olá SAS é válido.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-135">This token string includes all parameters of hello SAS, including hello permissions and hello interval over which hello SAS is valid.</span></span> <span data-ttu-id="e6b3f-136">toouse Olá SAS tooaccess um contêiner no armazenamento do Azure, você precisa tooappend Olá SAS caracteres token toohello URI do recurso.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-136">toouse hello SAS tooaccess a container in Azure Storage, you need tooappend hello SAS token string toohello resource URI.</span></span> <span data-ttu-id="e6b3f-137">Olá URI recurso, junto com hello acrescentado token SAS, fornece acesso autenticado tooAzure armazenamento.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-137">hello resource URI, together with hello appended SAS token, provides authenticated access tooAzure Storage.</span></span>

<span data-ttu-id="e6b3f-138">Olá exemplo a seguir mostra como cadeia de caracteres para o contêiner de saudação do token tooget um SAS somente gravação e acrescenta Olá SAS toohello URI do contêiner:</span><span class="sxs-lookup"><span data-stu-id="e6b3f-138">hello following example shows how tooget a write-only SAS token string for hello container, then appends hello SAS toohello container URI:</span></span>

```csharp
string containerSasToken = container.GetSharedAccessSignature(new SharedAccessBlobPolicy()
{
    SharedAccessExpiryTime = DateTimeOffset.UtcNow.AddDays(1),
    Permissions = SharedAccessBlobPermissions.Write
});

string containerSasUrl = container.Uri.AbsoluteUri + containerSasToken; 
```

## <a name="specify-output-files-for-task-output"></a><span data-ttu-id="e6b3f-139">Especificar arquivos de saída para a saída da tarefa</span><span class="sxs-lookup"><span data-stu-id="e6b3f-139">Specify output files for task output</span></span>

<span data-ttu-id="e6b3f-140">toospecify arquivos de saída para uma tarefa, criar uma coleção de [OutputFile](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile) objetos e atribuí-la toohello [CloudTask.OutputFiles](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudtask.outputfiles#Microsoft_Azure_Batch_CloudTask_OutputFiles) propriedade ao criar tarefa hello.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-140">toospecify output files for a task, create a collection of [OutputFile](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile) objects and assign it toohello [CloudTask.OutputFiles](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudtask.outputfiles#Microsoft_Azure_Batch_CloudTask_OutputFiles) property when you create hello task.</span></span> 

<span data-ttu-id="e6b3f-141">exemplo de código a seguir .NET Hello cria uma tarefa que grava o arquivo de tooa de números aleatórios chamado `output.txt`.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-141">hello following .NET code example creates a task that writes random numbers tooa file named `output.txt`.</span></span> <span data-ttu-id="e6b3f-142">exemplo Hello cria um arquivo de saída para `output.txt` toobe gravado toohello contêiner.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-142">hello example creates an output file for `output.txt` toobe written toohello container.</span></span> <span data-ttu-id="e6b3f-143">exemplo Hello também cria arquivos de saída para os arquivos de log que corresponde ao padrão de arquivo hello `std*.txt` (_, por exemplo,_, `stdout.txt` e `stderr.txt`).</span><span class="sxs-lookup"><span data-stu-id="e6b3f-143">hello example also creates output files for any log files that match hello file pattern `std*.txt` (_e.g._, `stdout.txt` and `stderr.txt`).</span></span> <span data-ttu-id="e6b3f-144">URL do contêiner Olá requer Olá SAS que foi criado anteriormente para o contêiner de saudação.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-144">hello container URL requires hello SAS that was created previously for hello container.</span></span> <span data-ttu-id="e6b3f-145">Olá serviço de lote usa o contêiner de toohello do hello SAS tooauthenticate acesso:</span><span class="sxs-lookup"><span data-stu-id="e6b3f-145">hello Batch service uses hello SAS tooauthenticate access toohello container:</span></span> 

```csharp
new CloudTask(taskId, "cmd /v:ON /c \"echo off && set && (FOR /L %i IN (1,1,100000) DO (ECHO !RANDOM!)) > output.txt\"")
{
    OutputFiles = new List<OutputFile>
    {
        new OutputFile(
            filePattern: @"..\std*.txt",
            destination: new OutputFileDestination(
         new OutputFileBlobContainerDestination(
                    containerUrl: containerSasUrl,
                    path: taskId)),
            uploadOptions: new OutputFileUploadOptions(
            uploadCondition: OutputFileUploadCondition.TaskCompletion)),
        new OutputFile(
            filePattern: @"output.txt",
            destination: 
         new OutputFileDestination(new OutputFileBlobContainerDestination(
                    containerUrl: containerSasUrl,
                    path: taskId + @"\output.txt")),
            uploadOptions: new OutputFileUploadOptions(
            uploadCondition: OutputFileUploadCondition.TaskCompletion)),
}
```

### <a name="specify-a-file-pattern-for-matching"></a><span data-ttu-id="e6b3f-146">Especifique um padrão de arquivo para correspondência</span><span class="sxs-lookup"><span data-stu-id="e6b3f-146">Specify a file pattern for matching</span></span>

<span data-ttu-id="e6b3f-147">Quando você especificar um arquivo de saída, você pode usar o hello [OutputFile.FilePattern](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile.filepattern#Microsoft_Azure_Batch_OutputFile_FilePattern) propriedade toospecify um padrão de arquivo para correspondência.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-147">When you specify an output file, you can use hello [OutputFile.FilePattern](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile.filepattern#Microsoft_Azure_Batch_OutputFile_FilePattern) property toospecify a file pattern for matching.</span></span> <span data-ttu-id="e6b3f-148">padrão de arquivo Hello pode corresponder a zero arquivos, um único arquivo ou um conjunto de arquivos que são criados pela tarefa de saudação.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-148">hello file pattern may match zero files, a single file, or a set of files that are created by hello task.</span></span>

<span data-ttu-id="e6b3f-149">Olá **FilePattern** propriedade oferece suporte a caracteres curinga do sistema de arquivos padrão como `*` (para não-recursivo corresponde) e `**` (para corresponde recursivo).</span><span class="sxs-lookup"><span data-stu-id="e6b3f-149">hello **FilePattern** property supports standard filesystem wildcards such as `*` (for non-recursive matches) and `**` (for recursive matches).</span></span> <span data-ttu-id="e6b3f-150">Por exemplo, o exemplo de código hello acima Especifica Olá arquivo padrão toomatch `std*.txt` não recursiva:</span><span class="sxs-lookup"><span data-stu-id="e6b3f-150">For example, hello code sample above specifies hello file pattern toomatch `std*.txt` non-recursively:</span></span> 

`filePattern: @"..\std*.txt"`

<span data-ttu-id="e6b3f-151">tooupload um único arquivo, especifique um padrão de arquivo sem curingas.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-151">tooupload a single file, specify a file pattern with no wildcards.</span></span> <span data-ttu-id="e6b3f-152">Por exemplo, o exemplo de código hello acima Especifica Olá arquivo padrão toomatch `output.txt`:</span><span class="sxs-lookup"><span data-stu-id="e6b3f-152">For example, hello code sample above specifies hello file pattern toomatch `output.txt`:</span></span>

`filePattern: @"output.txt"`

### <a name="specify-an-upload-condition"></a><span data-ttu-id="e6b3f-153">Especificar uma condição de upload</span><span class="sxs-lookup"><span data-stu-id="e6b3f-153">Specify an upload condition</span></span>

<span data-ttu-id="e6b3f-154">Olá [OutputFileUploadOptions.UploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileuploadoptions.uploadcondition#Microsoft_Azure_Batch_OutputFileUploadOptions_UploadCondition) propriedade permite o carregamento condicional de arquivos de saída.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-154">hello [OutputFileUploadOptions.UploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileuploadoptions.uploadcondition#Microsoft_Azure_Batch_OutputFileUploadOptions_UploadCondition) property permits conditional uploading of output files.</span></span> <span data-ttu-id="e6b3f-155">Um cenário comum é tooupload um conjunto de arquivos se Olá tarefa tiver êxito e um conjunto diferente de arquivos se ele falhar.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-155">A common scenario is tooupload one set of files if hello task succeeds, and a different set of files if it fails.</span></span> <span data-ttu-id="e6b3f-156">Por exemplo, talvez você queira arquivos de log detalhados tooupload somente quando a tarefa de saudação falhará e será encerrado com um código de saída diferente de zero.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-156">For example, you may want tooupload verbose log files only when hello task fails and exits with a nonzero exit code.</span></span> <span data-ttu-id="e6b3f-157">Da mesma forma, talvez você queira arquivos de resultado tooupload somente se a tarefa de saudação tiver êxito, como esses arquivos podem estar ausentes ou incompletos se Olá tarefa falhar.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-157">Similarly, you may want tooupload result files only if hello task succeeds, as those files may be missing or incomplete if hello task fails.</span></span>

<span data-ttu-id="e6b3f-158">exemplo de código acima Hello define Olá **UploadCondition** propriedade muito**TaskCompletion**.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-158">hello code sample above sets hello **UploadCondition** property too**TaskCompletion**.</span></span> <span data-ttu-id="e6b3f-159">Essa configuração especifica que se o arquivo hello está toobe carregado após a conclusão de tarefas hello, independentemente do valor de saudação do código de saída de hello.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-159">This setting specifies that hello file is toobe uploaded after hello tasks completes, regardless of hello value of hello exit code.</span></span> 

`uploadCondition: OutputFileUploadCondition.TaskCompletion`

<span data-ttu-id="e6b3f-160">Para outras configurações, consulte Olá [OutputFileUploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.common.outputfileuploadcondition) enum.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-160">For other settings, see hello [OutputFileUploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.common.outputfileuploadcondition) enum.</span></span>

### <a name="disambiguate-files-with-hello-same-name"></a><span data-ttu-id="e6b3f-161">Desfazer a ambiguidade de arquivos com hello mesmo nome</span><span class="sxs-lookup"><span data-stu-id="e6b3f-161">Disambiguate files with hello same name</span></span>

<span data-ttu-id="e6b3f-162">tarefas de saudação em um trabalho podem produzir arquivos que têm Olá mesmo nome.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-162">hello tasks in a job may produce files that have hello same name.</span></span> <span data-ttu-id="e6b3f-163">Por exemplo, `stdout.txt` e `stderr.txt` são criados para cada tarefa que executa em um trabalho.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-163">For example, `stdout.txt` and `stderr.txt` are created for every task that runs in a job.</span></span> <span data-ttu-id="e6b3f-164">Como cada tarefa é executada em seu próprio contexto, esses arquivos não estão em conflito no sistema de arquivos do nó hello.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-164">Because each task runs in its own context, these files don't conflict on hello node's file system.</span></span> <span data-ttu-id="e6b3f-165">No entanto, quando você carrega arquivos de contêiner compartilhadas do várias tarefas tooa, você precisará toodisambiguate arquivos com hello mesmo nome.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-165">However, when you upload files from multiple tasks tooa shared container, you'll need toodisambiguate files with hello same name.</span></span>

<span data-ttu-id="e6b3f-166">Olá [OutputFileBlobContainerDestination.Path](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination.path#Microsoft_Azure_Batch_OutputFileBlobContainerDestination_Path) propriedade especifica o blob de destino hello ou diretório virtual para arquivos de saída.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-166">hello [OutputFileBlobContainerDestination.Path](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination.path#Microsoft_Azure_Batch_OutputFileBlobContainerDestination_Path) property specifies hello destination blob or virtual directory for output files.</span></span> <span data-ttu-id="e6b3f-167">Você pode usar o hello **caminho** blob de saudação do tooname de propriedade ou o diretório virtual de forma que arquivos de saída com hello mesmo nome são nomeadas exclusivamente no armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-167">You can use hello **Path** property tooname hello blob or virtual directory in such a way that output files with hello same name are uniquely named in Azure Storage.</span></span> <span data-ttu-id="e6b3f-168">Usando a ID da tarefa Olá no caminho de saudação é uma boa maneira tooensure os nomes exclusivos e identificar facilmente os arquivos.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-168">Using hello task ID in hello path is a good way tooensure unique names and easily identify files.</span></span>

<span data-ttu-id="e6b3f-169">Se hello **FilePattern** propriedade é definida tooa expressão de caractere curinga, todos os arquivos que correspondem a saudação padrão são o diretório virtual toohello carregado, especificado pelo Olá **caminho** propriedade.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-169">If hello **FilePattern** property is set tooa wildcard expression, then all files that match hello pattern are uploaded toohello virtual directory specified by hello **Path** property.</span></span> <span data-ttu-id="e6b3f-170">Por exemplo, se hello contêiner é `mycontainer`, tarefa Olá ID é `mytask`, e é o padrão do arquivo hello `..\std*.txt`, então Olá absoluto URIs toohello arquivos de saída no armazenamento do Azure será semelhantes a:</span><span class="sxs-lookup"><span data-stu-id="e6b3f-170">For example, if hello container is `mycontainer`, hello task ID is `mytask`, and hello file pattern is `..\std*.txt`, then hello absolute URIs toohello output files in Azure Storage will be similar to:</span></span>

```
https://myaccount.blob.core.windows.net/mycontainer/mytask/stderr.txt
https://myaccount.blob.core.windows.net/mycontainer/mytask/stdout.txt
```

<span data-ttu-id="e6b3f-171">Se hello **FilePattern** é toomatch de conjunto de um único nome de arquivo, em seguida, o que significa que ele não contém caracteres curinga, Olá valor Olá **caminho** propriedade especifica o nome de blob totalmente qualificado de saudação .</span><span class="sxs-lookup"><span data-stu-id="e6b3f-171">If hello **FilePattern** property is set toomatch a single file name, meaning it does not contain any wildcard characters, then hello value of hello **Path** property specifies hello fully qualified blob name.</span></span> <span data-ttu-id="e6b3f-172">Se você antecipar conflitos de nomes com um único arquivo de várias tarefas, em seguida, inclua nome de saudação do diretório virtual hello como parte do toodisambiguate de nome de arquivo hello esses arquivos.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-172">If you anticipate naming conflicts with a single file from multiple tasks, then include hello name of hello virtual directory as part of hello file name toodisambiguate those files.</span></span> <span data-ttu-id="e6b3f-173">Por exemplo, o conjunto Olá **caminho** ID da tarefa propriedade tooinclude hello, caractere delimitador de saudação (normalmente uma barra invertida) e o nome de arquivo hello:</span><span class="sxs-lookup"><span data-stu-id="e6b3f-173">For example, set hello **Path** property tooinclude hello task ID, hello delimiter character (typically a forward slash), and hello file name:</span></span>

`path: taskId + @"/output.txt"`

<span data-ttu-id="e6b3f-174">Olá absoluto URIs toohello arquivos de saída para um conjunto de tarefas será semelhantes a:</span><span class="sxs-lookup"><span data-stu-id="e6b3f-174">hello absolute URIs toohello output files for a set of tasks will be similar to:</span></span>

```
https://myaccount.blob.core.windows.net/mycontainer/task1/output.txt
https://myaccount.blob.core.windows.net/mycontainer/task2/output.txt
```

<span data-ttu-id="e6b3f-175">Para obter mais informações sobre diretórios virtuais no armazenamento do Azure, consulte [lista Olá blobs em um contêiner](../storage/blobs/storage-dotnet-how-to-use-blobs.md#list-the-blobs-in-a-container).</span><span class="sxs-lookup"><span data-stu-id="e6b3f-175">For more information about virtual directories in Azure Storage, see [List hello blobs in a container](../storage/blobs/storage-dotnet-how-to-use-blobs.md#list-the-blobs-in-a-container).</span></span>


## <a name="diagnose-file-upload-errors"></a><span data-ttu-id="e6b3f-176">Diagnosticar erros de carregamento de arquivo</span><span class="sxs-lookup"><span data-stu-id="e6b3f-176">Diagnose file upload errors</span></span>

<span data-ttu-id="e6b3f-177">Se carregar saída arquivos tooAzure armazenamento falhar, tarefa Olá move toohello **concluído** estado e hello [TaskExecutionInformation.FailureInformation](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.taskexecutioninformation.failureinformation#Microsoft_Azure_Batch_TaskExecutionInformation_FailureInformation) está definida.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-177">If uploading output files tooAzure Storage fails, then hello task moves toohello **Completed** state and hello [TaskExecutionInformation.FailureInformation](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.taskexecutioninformation.failureinformation#Microsoft_Azure_Batch_TaskExecutionInformation_FailureInformation) property is set.</span></span> <span data-ttu-id="e6b3f-178">Examine Olá **FailureInformation** toodetermine de propriedade, o erro.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-178">Examine hello **FailureInformation** property toodetermine what error occurred.</span></span> <span data-ttu-id="e6b3f-179">Por exemplo, aqui está um erro que ocorre no carregamento do arquivo se Olá contêiner não pode ser encontrado:</span><span class="sxs-lookup"><span data-stu-id="e6b3f-179">For example, here is an error that occurs on file upload if hello container cannot be found:</span></span> 

```
Category: UserError
Code: FileUploadContainerNotFound
Message: One of hello specified Azure container(s) was not found while attempting tooupload an output file
```

<span data-ttu-id="e6b3f-180">Em cada carregamento de arquivo em lote grava dois nós de computação de toohello de arquivos, de log `fileuploadout.txt` e `fileuploaderr.txt`.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-180">On every file upload, Batch writes two log files toohello compute node, `fileuploadout.txt` and `fileuploaderr.txt`.</span></span> <span data-ttu-id="e6b3f-181">Você pode examinar esses toolearn de arquivos de log mais sobre uma falha específica.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-181">You can examine these log files toolearn more about a specific failure.</span></span> <span data-ttu-id="e6b3f-182">Em casos onde Olá arquivo nunca tentativa de upload, por exemplo, porque não foi possível executar a própria tarefa hello, em seguida, esses arquivos de log não existirá.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-182">In cases where hello file upload was never attempted, for example because hello task itself couldn’t run, then these log files will not exist.</span></span>

## <a name="diagnose-file-upload-performance"></a><span data-ttu-id="e6b3f-183">Diagnosticar desempenho de carregamento de arquivo</span><span class="sxs-lookup"><span data-stu-id="e6b3f-183">Diagnose file upload performance</span></span>

<span data-ttu-id="e6b3f-184">Olá `fileuploadout.txt` arquivo registra em log o progresso de carregamento.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-184">hello `fileuploadout.txt` file logs upload progress.</span></span> <span data-ttu-id="e6b3f-185">Você pode examinar este toolearn de arquivo mais sobre o quanto o arquivo carrega estão demorando.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-185">You can examine this file toolearn more about how long your file uploads are taking.</span></span> <span data-ttu-id="e6b3f-186">Tenha em mente que há muitos fatores desempenho tooupload, incluindo o tamanho de saudação do nó hello, outra atividade no nó de saudação em tempo de saudação do carregamento de hello, se o contêiner de destino hello está em Olá mesma região que o pool do lote hello, quantos nós são Carregando a conta de armazenamento toohello em Olá ao mesmo tempo e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-186">Keep in mind that there are many contributing factors tooupload performance, including hello size of hello node, other activity on hello node at hello time of hello upload, whether hello target container is in hello same region as hello Batch pool, how many nodes are uploading toohello storage account at hello same time, and so on.</span></span>

## <a name="use-hello-batch-service-api-with-hello-batch-file-conventions-standard"></a><span data-ttu-id="e6b3f-187">Usar a API do serviço de lote de saudação com hello convenções padrão de arquivo de lote</span><span class="sxs-lookup"><span data-stu-id="e6b3f-187">Use hello Batch service API with hello Batch File Conventions standard</span></span>

<span data-ttu-id="e6b3f-188">Quando você mantiver a saída da tarefa com hello API do serviço de lote, você pode nomear o contêiner de destino e você quiser os blobs.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-188">When you persist task output with hello Batch service API, you can name your destination container and blobs however you like.</span></span> <span data-ttu-id="e6b3f-189">Você também pode escolher tooname-los de acordo com toohello [padrão de convenções de arquivo em lotes](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span><span class="sxs-lookup"><span data-stu-id="e6b3f-189">You can also choose tooname them according toohello [Batch File Conventions standard](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span></span> <span data-ttu-id="e6b3f-190">padrão de convenções de arquivo Hello determina os nomes de saudação do contêiner de destino de saudação e blob no armazenamento do Azure para um arquivo de saída determinada com base nos nomes de saudação do hello trabalhos e tarefas.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-190">hello File Conventions standard determines hello names of hello destination container and blob in Azure Storage for a given output file based on hello names of hello job and task.</span></span> <span data-ttu-id="e6b3f-191">Se você usar Olá convenções de arquivo padrão de nomeação de arquivos de saída, os arquivos de saída estão disponíveis para exibição no hello [portal do Azure](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="e6b3f-191">If you do use hello File Conventions standard for naming output files, then your output files are available for viewing in hello [Azure portal](https://portal.azure.com).</span></span>

<span data-ttu-id="e6b3f-192">Se você estiver desenvolvendo em c#, você pode usar métodos de saudação incorporados Olá [biblioteca convenções de arquivo em lotes para .NET](https://www.nuget.org/packages/Microsoft.Azure.Batch.Conventions.Files).</span><span class="sxs-lookup"><span data-stu-id="e6b3f-192">If you are developing in C#, you can use hello methods built into hello [Batch File Conventions library for .NET](https://www.nuget.org/packages/Microsoft.Azure.Batch.Conventions.Files).</span></span> <span data-ttu-id="e6b3f-193">Essa biblioteca cria Olá chamados corretamente contêineres e caminhos de blob para você.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-193">This library creates hello properly named containers and blob paths for you.</span></span> <span data-ttu-id="e6b3f-194">Por exemplo, você pode chamar o nome correto do hello API tooget Olá para contêiner hello, com base no nome do trabalho hello:</span><span class="sxs-lookup"><span data-stu-id="e6b3f-194">For example, you can call hello API tooget hello correct name for hello container, based on hello job name:</span></span>

```csharp
string containerName = job.OutputStorageContainerName();
```

<span data-ttu-id="e6b3f-195">Você pode usar o hello [CloudJobExtensions.GetOutputStorageContainerUrl](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.conventions.files.cloudjobextensions.getoutputstoragecontainerurl) método tooreturn uma URL de SAS (assinatura) de acesso compartilhado que é usado toowrite toohello contêiner.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-195">You can use hello [CloudJobExtensions.GetOutputStorageContainerUrl](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.conventions.files.cloudjobextensions.getoutputstoragecontainerurl) method tooreturn a shared access signature (SAS) URL that is used toowrite toohello container.</span></span> <span data-ttu-id="e6b3f-196">Você pode passar esse SAS toohello [OutputFileBlobContainerDestination](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination) construtor.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-196">You can then pass this SAS toohello [OutputFileBlobContainerDestination](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination) constructor.</span></span>

<span data-ttu-id="e6b3f-197">Se você estiver desenvolvendo em um idioma diferente do c#, você precisará padrão de convenções de arquivo hello tooimplement por conta própria.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-197">If you are developing in a language other than C#, you will need tooimplement hello File Conventions standard yourself.</span></span>

## <a name="code-sample"></a><span data-ttu-id="e6b3f-198">Exemplo de código</span><span class="sxs-lookup"><span data-stu-id="e6b3f-198">Code sample</span></span>

<span data-ttu-id="e6b3f-199">Olá [PersistOutputs] [ github_persistoutputs] projeto de exemplo é uma saudação [exemplos de código do Azure Batch] [ github_samples] no GitHub.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-199">hello [PersistOutputs][github_persistoutputs] sample project is one of hello [Azure Batch code samples][github_samples] on GitHub.</span></span> <span data-ttu-id="e6b3f-200">Essa solução do Visual Studio demonstra como a biblioteca de cliente de lote toouse Olá para tarefas do .NET toopersist saída toodurable armazenamento.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-200">This Visual Studio solution demonstrates how toouse hello Batch client library for .NET toopersist task output toodurable storage.</span></span> <span data-ttu-id="e6b3f-201">Olá toorun de exemplo, siga estas etapas:</span><span class="sxs-lookup"><span data-stu-id="e6b3f-201">toorun hello sample, follow these steps:</span></span>

1. <span data-ttu-id="e6b3f-202">Projeto aberto Olá no **Visual Studio 2015 ou mais recente**.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-202">Open hello project in **Visual Studio 2015 or newer**.</span></span>
2. <span data-ttu-id="e6b3f-203">Adicionar o lote e o armazenamento **as credenciais de conta** muito**AccountSettings.settings** no projeto de Microsoft.Azure.Batch.Samples.Common hello.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-203">Add your Batch and Storage **account credentials** too**AccountSettings.settings** in hello Microsoft.Azure.Batch.Samples.Common project.</span></span>
3. <span data-ttu-id="e6b3f-204">**Criar** (mas não executam) Olá solução.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-204">**Build** (but do not run) hello solution.</span></span> <span data-ttu-id="e6b3f-205">Restaure todos os pacotes NuGet, se solicitado.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-205">Restore any NuGet packages if prompted.</span></span>
4. <span data-ttu-id="e6b3f-206">Saudação de uso do Azure tooupload portal um [pacote de aplicativo](batch-application-packages.md) para **PersistOutputsTask**.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-206">Use hello Azure portal tooupload an [application package](batch-application-packages.md) for **PersistOutputsTask**.</span></span> <span data-ttu-id="e6b3f-207">Incluir Olá `PersistOutputsTask.exe` e seus assemblies dependentes no pacote. zip de hello, ID do conjunto de aplicativo hello muito "PersistOutputsTask" e o aplicativo hello pacote versão muito "1.0".</span><span class="sxs-lookup"><span data-stu-id="e6b3f-207">Include hello `PersistOutputsTask.exe` and its dependent assemblies in hello .zip package, set hello application ID too"PersistOutputsTask", and hello application package version too"1.0".</span></span>
5. <span data-ttu-id="e6b3f-208">**Iniciar** hello (Executar) **PersistOutputs** projeto.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-208">**Start** (run) hello **PersistOutputs** project.</span></span>
6. <span data-ttu-id="e6b3f-209">Quando solicitadas toochoose Olá persistência tecnologia toouse para execução do exemplo hello, digite **2** exemplo hello de toorun usando a saída da tarefa toopersist Olá API do serviço de lote.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-209">When prompted toochoose hello persistence technology toouse for running hello sample, enter **2** toorun hello sample using hello Batch service API toopersist task output.</span></span>
7. <span data-ttu-id="e6b3f-210">Se desejar, execute exemplo hello novamente, inserindo **3** toopersist saída com hello API do serviço de lote e também tooname Olá contêiner e blob de caminho de destino de acordo com o toohello convenções de arquivo padrão.</span><span class="sxs-lookup"><span data-stu-id="e6b3f-210">If desired, run hello sample again, entering **3** toopersist output with hello Batch service API, and also tooname hello destination container and blob path according toohello File Conventions standard.</span></span>

## <a name="next-steps"></a><span data-ttu-id="e6b3f-211">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="e6b3f-211">Next steps</span></span>

- <span data-ttu-id="e6b3f-212">Para obter mais informações sobre a saída da tarefa persistentes com biblioteca de convenções de arquivo hello para .NET, consulte [Manter trabalhos e tarefas tooAzure de dados armazenamento com biblioteca de convenções de arquivo em lotes Olá para .NET toopersist ](batch-task-output-file-conventions.md).</span><span class="sxs-lookup"><span data-stu-id="e6b3f-212">For more information on persisting task output with hello File Conventions library for .NET, see [Persist job and task data tooAzure Storage with hello Batch File Conventions library for .NET toopersist ](batch-task-output-file-conventions.md).</span></span>
- <span data-ttu-id="e6b3f-213">Para obter informações sobre outras abordagens para persistir dados de saída em lote do Azure, consulte [Persist trabalhos e tarefas de saída tooAzure armazenamento](batch-task-output.md).</span><span class="sxs-lookup"><span data-stu-id="e6b3f-213">For information on other approaches for persisting output data in Azure Batch, see [Persist job and task output tooAzure Storage](batch-task-output.md).</span></span>

[github_persistoutputs]: https://github.com/Azure/azure-batch-samples/tree/master/CSharp/ArticleProjects/PersistOutputs
[github_samples]: https://github.com/Azure/azure-batch-samples
