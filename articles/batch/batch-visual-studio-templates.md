---
title: "Começar a criar soluções em lote com modelos de projeto do Visual Studio - Azure | Microsoft Docs"
description: "Saiba como os modelos de projeto do Visual Studio podem ajudar você a implementar e executar suas cargas de trabalho de computação intensa no Lote do Azure."
services: batch
documentationcenter: .net
author: fayora
manager: timlt
editor: 
ms.assetid: 5e041ae2-25af-4882-a79e-3aa63c4bfb20
ms.service: batch
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: big-compute
ms.date: 02/27/2017
ms.author: tamram
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: da77ce827c65deb18d9d84ce5cf768d89788e205
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="use-visual-studio-project-templates-to-jump-start-batch-solutions"></a><span data-ttu-id="d47c3-103">Usar modelos de projeto do Visual Studio para iniciar rapidamente soluções em lote</span><span class="sxs-lookup"><span data-stu-id="d47c3-103">Use Visual Studio project templates to jump-start Batch solutions</span></span>

<span data-ttu-id="d47c3-104">O **Gerenciador de Trabalho** e os **modelos do Visual Studio do Processador de Tarefa** para o Lote fornecem código para ajudar você a implementar e executar suas cargas de trabalho de computação intensa no Lote com o mínimo de esforço.</span><span class="sxs-lookup"><span data-stu-id="d47c3-104">The **Job Manager** and **Task Processor Visual Studio templates** for Batch provide code to help you to implement and run your compute-intensive workloads on Batch with the least amount of effort.</span></span> <span data-ttu-id="d47c3-105">Este documento descreve esses modelos e fornece diretrizes sobre como usá-los.</span><span class="sxs-lookup"><span data-stu-id="d47c3-105">This document describes these templates and provides guidance for how to use them.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="d47c3-106">Este artigo discute apenas as informações aplicáveis a esses dois modelos e pressupõe que você esteja familiarizado com o serviço do Lote e os principais conceitos relacionados a ele: pools, nós de computação, trabalhos e tarefas, tarefas do gerenciador de trabalho, variáveis de ambiente e outras informações relevantes.</span><span class="sxs-lookup"><span data-stu-id="d47c3-106">This article discusses only information applicable to these two templates, and assumes that you are familiar with the Batch service and key concepts related to it: pools, compute nodes, jobs and tasks, job manager tasks, environment variables, and other relevant information.</span></span> <span data-ttu-id="d47c3-107">Encontre mais informações em [Noções básicas do Lote do Azure](batch-technical-overview.md), [Visão geral do recurso Lote para desenvolvedores](batch-api-basics.md) e [Introdução à biblioteca do Lote do Azure para .NET](batch-dotnet-get-started.md).</span><span class="sxs-lookup"><span data-stu-id="d47c3-107">You can find more information in [Basics of Azure Batch](batch-technical-overview.md), [Batch feature overview for developers](batch-api-basics.md), and [Get started with the Azure Batch library for .NET](batch-dotnet-get-started.md).</span></span>
> 
> 

## <a name="high-level-overview"></a><span data-ttu-id="d47c3-108">Visão geral de alto nível</span><span class="sxs-lookup"><span data-stu-id="d47c3-108">High-level overview</span></span>
<span data-ttu-id="d47c3-109">Os modelos do Gerenciador de Trabalho e do Processador de Tarefa podem ser usados para criar dois componentes úteis:</span><span class="sxs-lookup"><span data-stu-id="d47c3-109">The Job Manager and Task Processor templates can be used to create two useful components:</span></span>

* <span data-ttu-id="d47c3-110">Uma tarefa do gerenciador de trabalho que implementa um divisor de trabalho que pode, por sua vez, dividir um trabalho em várias tarefas que podem ser executadas de forma independente, em paralelo.</span><span class="sxs-lookup"><span data-stu-id="d47c3-110">A job manager task that implements a job splitter that can break a job down into multiple tasks that can run independently, in parallel.</span></span>
* <span data-ttu-id="d47c3-111">Um processador de tarefa que pode ser usado para executar o pré-processamento e o pós-processamento em uma linha de comando do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d47c3-111">A task processor that can be used to perform pre-processing and post-processing around an application command line.</span></span>

<span data-ttu-id="d47c3-112">Por exemplo, em um cenário de renderização de filme, o divisor de trabalho transformaria um trabalho único de filme em centenas ou milhares de tarefas separadas que processam quadros individuais separadamente.</span><span class="sxs-lookup"><span data-stu-id="d47c3-112">For example, in a movie rendering scenario, the job splitter would turn a single movie job into hundreds or thousands of separate tasks that would process individual frames separately.</span></span> <span data-ttu-id="d47c3-113">Do mesmo modo, o processador de tarefa invocaria o aplicativo de renderização e todos os processos dependentes exigidos para processar cada quadro, bem como executar quaisquer ações adicionais (por exemplo, copiar o quadro processado em um local de armazenamento).</span><span class="sxs-lookup"><span data-stu-id="d47c3-113">Correspondingly, the task processor would invoke the rendering application and all dependent processes that are needed to render each frame, as well as perform any additional actions (for example, copying the rendered frame to a storage location).</span></span>

> [!NOTE]
> <span data-ttu-id="d47c3-114">Os modelos do Gerenciador de Trabalho e do Processador de Tarefa são independentes, para que você possa optar por usar ambos ou apenas um deles, dependendo dos requisitos do seu trabalho de computação e de suas preferências.</span><span class="sxs-lookup"><span data-stu-id="d47c3-114">The Job Manager and Task Processor templates are independent of each other, so you can choose to use both, or only one of them, depending on the requirements of your compute job and on your preferences.</span></span>
> 
> 

<span data-ttu-id="d47c3-115">Conforme mostrado no diagrama a seguir, um trabalho de computação que usa esses modelos passará por três estágios:</span><span class="sxs-lookup"><span data-stu-id="d47c3-115">As shown in the diagram below, a compute job that uses these templates will go through three stages:</span></span>

1. <span data-ttu-id="d47c3-116">O código do cliente (por exemplo, aplicativo, serviço Web etc.) envia um trabalho ao serviço do Lote no Azure, especificando como sua tarefa de gerenciamento de trabalho o programa Gerenciador de trabalho.</span><span class="sxs-lookup"><span data-stu-id="d47c3-116">The client code (e.g., application, web service, etc.) submits a job to the Batch service on Azure, specifying as its job manager task the job manager program.</span></span>
2. <span data-ttu-id="d47c3-117">O serviço do Lote executa a tarefa do Gerenciador de trabalho em um nó de computação, e o divisor de trabalho inicia o número especificado de tarefas do processador de tarefas, na quantidade de nós de computação necessária, com base nos parâmetros e especificações no código do divisor de trabalho.</span><span class="sxs-lookup"><span data-stu-id="d47c3-117">The Batch service runs the job manager task on a compute node and the job splitter launches the specified number of task processor tasks, on as many compute nodes as required, based on the parameters and specifications in the job splitter code.</span></span>
3. <span data-ttu-id="d47c3-118">As tarefas do processador de tarefas são executadas de forma independente, em paralelo, a fim de processar os dados de entrada e gerar os dados de saída.</span><span class="sxs-lookup"><span data-stu-id="d47c3-118">The task processor tasks run independently, in parallel, to process the input data and generate the output data.</span></span>

![Diagrama mostrando como o código do cliente interage com o serviço do Lote][diagram01]

## <a name="prerequisites"></a><span data-ttu-id="d47c3-120">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="d47c3-120">Prerequisites</span></span>
<span data-ttu-id="d47c3-121">Para usar os modelos do Lote, você precisará do seguinte:</span><span class="sxs-lookup"><span data-stu-id="d47c3-121">To use the Batch templates, you will need the following:</span></span>

* <span data-ttu-id="d47c3-122">Um computador com o Visual Studio 2015 instalado.</span><span class="sxs-lookup"><span data-stu-id="d47c3-122">A computer with Visual Studio 2015 installed.</span></span> <span data-ttu-id="d47c3-123">Modelos de lote atualmente só têm suporte para o Visual Studio 2015.</span><span class="sxs-lookup"><span data-stu-id="d47c3-123">Batch templates are currently only supported for Visual Studio 2015.</span></span>
* <span data-ttu-id="d47c3-124">Os modelos do Lote, disponíveis na [Galeria do Visual Studio][vs_gallery] como extensões do Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="d47c3-124">The Batch templates, which are available from the [Visual Studio Gallery][vs_gallery] as Visual Studio extensions.</span></span> <span data-ttu-id="d47c3-125">Há duas maneiras de obter os modelos:</span><span class="sxs-lookup"><span data-stu-id="d47c3-125">There are two ways to get the templates:</span></span>
  
  * <span data-ttu-id="d47c3-126">Instalar os modelos usando a caixa de diálogo **Extensões e Atualizações** no Visual Studio (para saber mais, confira [Localizando e usando extensões do Visual Studio][vs_find_use_ext]).</span><span class="sxs-lookup"><span data-stu-id="d47c3-126">Install the templates using the **Extensions and Updates** dialog box in Visual Studio (for more information, see [Finding and Using Visual Studio Extensions][vs_find_use_ext]).</span></span> <span data-ttu-id="d47c3-127">Na caixa de diálogo **Extensões e Atualizações** , procure e baixe as duas extensões a seguir:</span><span class="sxs-lookup"><span data-stu-id="d47c3-127">In the **Extensions and Updates** dialog box, search and download the following two extensions:</span></span>
    
    * <span data-ttu-id="d47c3-128">Gerenciador de Trabalhos do Lote do Azure com o Divisor de Trabalho</span><span class="sxs-lookup"><span data-stu-id="d47c3-128">Azure Batch Job Manager with Job Splitter</span></span>
    * <span data-ttu-id="d47c3-129">Processador de Tarefas do Lote do Azure</span><span class="sxs-lookup"><span data-stu-id="d47c3-129">Azure Batch Task Processor</span></span>
  * <span data-ttu-id="d47c3-130">Baixe os modelos da galeria online para o Visual Studio: [Modelos de projeto do Lote do Microsoft Azure][vs_gallery_templates]</span><span class="sxs-lookup"><span data-stu-id="d47c3-130">Download the templates from the online gallery for Visual Studio: [Microsoft Azure Batch Project Templates][vs_gallery_templates]</span></span>
* <span data-ttu-id="d47c3-131">Se você planeja usar o recurso [Pacotes de aplicativos](batch-application-packages.md) para implantar o Gerenciador de trabalho e o processador de tarefas nos nós de computação do Lote, será necessário vincular uma conta de armazenamento à sua conta do Lote.</span><span class="sxs-lookup"><span data-stu-id="d47c3-131">If you plan to use the [Application Packages](batch-application-packages.md) feature to deploy the job manager and task processor to the Batch compute nodes, you need to link a storage account to your Batch account.</span></span>

## <a name="preparation"></a><span data-ttu-id="d47c3-132">Preparação</span><span class="sxs-lookup"><span data-stu-id="d47c3-132">Preparation</span></span>
<span data-ttu-id="d47c3-133">Recomendamos a criação de uma solução que pode conter seu Gerenciador de trabalho, bem como o processador de tarefas, pois isso pode facilitar o compartilhamento do código entre os programas Gerenciador de trabalho e Processador de tarefas.</span><span class="sxs-lookup"><span data-stu-id="d47c3-133">We recommend creating a solution that can contain your job manager as well as your task processor, because this can make it easier to share code between your job manager and task processor programs.</span></span> <span data-ttu-id="d47c3-134">Para criar essa solução, execute estas etapas:</span><span class="sxs-lookup"><span data-stu-id="d47c3-134">To create this solution, follow these steps:</span></span>

1. <span data-ttu-id="d47c3-135">Abra o Visual Studio e selecione **Arquivo** > **Novo** > **Projeto**.</span><span class="sxs-lookup"><span data-stu-id="d47c3-135">Open Visual Studio and select **File** > **New** > **Project**.</span></span>
2. <span data-ttu-id="d47c3-136">Em **Modelos**, expanda **Outros Tipos de Projeto**, clique em **Soluções do Visual Studio** e, em seguida, selecione **Solução em Branco**.</span><span class="sxs-lookup"><span data-stu-id="d47c3-136">Under **Templates**, expand **Other Project Types**, click **Visual Studio Solutions**, and then select **Blank Solution**.</span></span>
3. <span data-ttu-id="d47c3-137">Digite um nome que descreva seu aplicativo e a finalidade dessa solução (por exemplo, "ProgramasDeTarefasdoLoteLitware").</span><span class="sxs-lookup"><span data-stu-id="d47c3-137">Type a name that describes your application and the purpose of this solution (e.g., "LitwareBatchTaskPrograms").</span></span>
4. <span data-ttu-id="d47c3-138">Para criar a nova solução, clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="d47c3-138">To create the new solution, click **OK**.</span></span>

## <a name="job-manager-template"></a><span data-ttu-id="d47c3-139">Modelo do Gerenciador de trabalho</span><span class="sxs-lookup"><span data-stu-id="d47c3-139">Job Manager template</span></span>
<span data-ttu-id="d47c3-140">O modelo do Gerenciador de trabalho ajuda você a implementar uma tarefa do Gerenciador de trabalho que pode executar as seguintes ações:</span><span class="sxs-lookup"><span data-stu-id="d47c3-140">The Job Manager template helps you to implement a job manager task that can perform the following actions:</span></span>

* <span data-ttu-id="d47c3-141">Dividir um trabalho em várias tarefas.</span><span class="sxs-lookup"><span data-stu-id="d47c3-141">Split a job into multiple tasks.</span></span>
* <span data-ttu-id="d47c3-142">Enviar essas tarefas para execução no Lote.</span><span class="sxs-lookup"><span data-stu-id="d47c3-142">Submit those tasks to run on Batch.</span></span>

> [!NOTE]
> <span data-ttu-id="d47c3-143">Para saber mais sobre as tarefas do Gerenciador de trabalho, confira [Visão geral do recurso Lote para desenvolvedores](batch-api-basics.md#job-manager-task).</span><span class="sxs-lookup"><span data-stu-id="d47c3-143">For more information about job manager tasks, see [Batch feature overview for developers](batch-api-basics.md#job-manager-task).</span></span>
> 
> 

### <a name="create-a-job-manager-using-the-template"></a><span data-ttu-id="d47c3-144">Criar um Gerenciador de trabalho usando o modelo</span><span class="sxs-lookup"><span data-stu-id="d47c3-144">Create a Job Manager using the template</span></span>
<span data-ttu-id="d47c3-145">Para adicionar um Gerenciador de trabalho à solução que você criou anteriormente, execute estas etapas:</span><span class="sxs-lookup"><span data-stu-id="d47c3-145">To add a job manager to the solution that you created earlier, follow these steps:</span></span>

1. <span data-ttu-id="d47c3-146">Abra sua solução existente no Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="d47c3-146">Open your existing solution in Visual Studio.</span></span>
2. <span data-ttu-id="d47c3-147">No Gerenciador de Soluções, clique com o botão direito do mouse na solução e clique em **Adicionar** > **Novo Projeto**.</span><span class="sxs-lookup"><span data-stu-id="d47c3-147">In Solution Explorer, right-click the solution, click **Add** > **New Project**.</span></span>
3. <span data-ttu-id="d47c3-148">No **Visual C#**, clique em **Nuvem** e em **Gerenciador de trabalho do Lote do Azure com o Divisor de trabalho**.</span><span class="sxs-lookup"><span data-stu-id="d47c3-148">Under **Visual C#**, click **Cloud**, and then click **Azure Batch Job Manager with Job Splitter**.</span></span>
4. <span data-ttu-id="d47c3-149">Digite um nome que descreva o aplicativo e identifique esse projeto como o Gerenciador de trabalho (por exemplo, "GerenciadorDeTrabalhoLitware").</span><span class="sxs-lookup"><span data-stu-id="d47c3-149">Type a name that describes your application and identifies this project as the job manager (e.g. "LitwareJobManager").</span></span>
5. <span data-ttu-id="d47c3-150">Para criar o projeto, clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="d47c3-150">To create the project, click **OK**.</span></span>
6. <span data-ttu-id="d47c3-151">Por fim, compile o projeto para forçar o Visual Studio a carregar todos os pacotes NuGet referenciados e verificar se o projeto é válido antes de você começar a modificá-lo.</span><span class="sxs-lookup"><span data-stu-id="d47c3-151">Finally, build the project to force Visual Studio to load all referenced NuGet packages and to verify that the project is valid before you start modifying it.</span></span>

### <a name="job-manager-template-files-and-their-purpose"></a><span data-ttu-id="d47c3-152">Arquivos do modelo do Gerenciador de trabalho e suas finalidades</span><span class="sxs-lookup"><span data-stu-id="d47c3-152">Job Manager template files and their purpose</span></span>
<span data-ttu-id="d47c3-153">Quando você cria um projeto usando o modelo do Gerenciador de trabalho, ele gera três grupos de arquivos de código:</span><span class="sxs-lookup"><span data-stu-id="d47c3-153">When you create a project using the Job Manager template, it generates three groups of code files:</span></span>

* <span data-ttu-id="d47c3-154">O arquivo de programa principal (Program.cs).</span><span class="sxs-lookup"><span data-stu-id="d47c3-154">The main program file (Program.cs).</span></span> <span data-ttu-id="d47c3-155">Esse arquivo contém o ponto de entrada do programa e a manipulação de exceção de nível superior.</span><span class="sxs-lookup"><span data-stu-id="d47c3-155">This contains the program entry point and top-level exception handling.</span></span> <span data-ttu-id="d47c3-156">Normalmente, não é necessário modificar isso.</span><span class="sxs-lookup"><span data-stu-id="d47c3-156">You shouldn't normally need to modify this.</span></span>
* <span data-ttu-id="d47c3-157">O diretório Framework.</span><span class="sxs-lookup"><span data-stu-id="d47c3-157">The Framework directory.</span></span> <span data-ttu-id="d47c3-158">Esse diretório contém os arquivos responsáveis pelo trabalho “clichê” realizado pelo programa Gerenciador de trabalho – desempacotar parâmetros, adicionar tarefas ao trabalho do Lote etc. Normalmente, não é necessário modificar esses arquivos.</span><span class="sxs-lookup"><span data-stu-id="d47c3-158">This contains the files responsible for the 'boilerplate' work done by the job manager program – unpacking parameters, adding tasks to the Batch job, etc. You shouldn't normally need to modify these files.</span></span>
* <span data-ttu-id="d47c3-159">O arquivo do Divisor de trabalho (JobSplitter.cs).</span><span class="sxs-lookup"><span data-stu-id="d47c3-159">The job splitter file (JobSplitter.cs).</span></span> <span data-ttu-id="d47c3-160">É nesse arquivo que você colocará a lógica específica ao aplicativo para a divisão de um trabalho em tarefas.</span><span class="sxs-lookup"><span data-stu-id="d47c3-160">This is where you will put your application-specific logic for splitting a job into tasks.</span></span>

<span data-ttu-id="d47c3-161">Obviamente você pode adicionar outros arquivos conforme o necessário a fim de oferecer suporte ao código do divisor de trabalho, dependendo da complexidade da lógica de divisão do trabalho.</span><span class="sxs-lookup"><span data-stu-id="d47c3-161">Of course you can add additional files as required to support your job splitter code, depending on the complexity of the job splitting logic.</span></span>

<span data-ttu-id="d47c3-162">O modelo também gera arquivos de projeto padrão do .NET, como um arquivo .csproj, app.config, packages.config etc.</span><span class="sxs-lookup"><span data-stu-id="d47c3-162">The template also generates standard .NET project files such as a .csproj file, app.config, packages.config, etc.</span></span>

<span data-ttu-id="d47c3-163">O restante desta seção descreve os diferentes arquivos e sua estrutura de código, e explica o que cada classe faz.</span><span class="sxs-lookup"><span data-stu-id="d47c3-163">The rest of this section describes the different files and their code structure, and explains what each class does.</span></span>

![Visual Studio Solution Explorer mostrando a solução do modelo do Gerenciador de trabalhos][solution_explorer01]

<span data-ttu-id="d47c3-165">**Arquivos do Framework**</span><span class="sxs-lookup"><span data-stu-id="d47c3-165">**Framework files**</span></span>

* <span data-ttu-id="d47c3-166">`Configuration.cs`: encapsula o carregamento de dados de configuração de trabalho, como detalhes da conta do Lote, credenciais da conta de armazenamento vinculada, informações sobre o trabalho e as tarefas e parâmetros do trabalho.</span><span class="sxs-lookup"><span data-stu-id="d47c3-166">`Configuration.cs`: Encapsulates the loading of job configuration data such as Batch account details, linked storage account credentials, job and task information, and job parameters.</span></span> <span data-ttu-id="d47c3-167">Ele também fornece acesso a variáveis de ambiente definidas pelo Lote (consulte Configurações de ambiente para tarefas, na documentação do Lote) por meio da classe Configuration.EnvironmentVariable.</span><span class="sxs-lookup"><span data-stu-id="d47c3-167">It also provides access to Batch-defined environment variables (see Environment settings for tasks, in the Batch documentation) via the Configuration.EnvironmentVariable class.</span></span>
* <span data-ttu-id="d47c3-168">`IConfiguration.cs`: abstrai a implementação da classe Configuration, para que você possa testar a unidade de seu divisor de trabalho usando um objeto de configuração falso ou fictício.</span><span class="sxs-lookup"><span data-stu-id="d47c3-168">`IConfiguration.cs`: Abstracts the implementation of the Configuration class, so that you can unit test your job splitter using a fake or mock configuration object.</span></span>
* <span data-ttu-id="d47c3-169">`JobManager.cs`: coordena os componentes do programa Gerenciador de trabalho.</span><span class="sxs-lookup"><span data-stu-id="d47c3-169">`JobManager.cs`: Orchestrates the components of the job manager program.</span></span> <span data-ttu-id="d47c3-170">Ele é responsável pela inicialização do divisor de trabalho, invocação do divisor de trabalho e distribuição de tarefas retornadas pelo divisor de trabalho para o emissor de tarefas.</span><span class="sxs-lookup"><span data-stu-id="d47c3-170">It is responsible for the initializing the job splitter, invoking the job splitter, and dispatching the tasks returned by the job splitter to the task submitter.</span></span>
* <span data-ttu-id="d47c3-171">`JobManagerException.cs`: representa um erro que exige o encerramento do Gerenciador de trabalho.</span><span class="sxs-lookup"><span data-stu-id="d47c3-171">`JobManagerException.cs`: Represents an error that requires the job manager to terminate.</span></span> <span data-ttu-id="d47c3-172">JobManagerException é usado para encapsular erros “esperados”, em que as informações de diagnóstico específicas podem ser fornecidas como parte do encerramento.</span><span class="sxs-lookup"><span data-stu-id="d47c3-172">JobManagerException is used to wrap 'expected' errors where specific diagnostic information can be provided as part of termination.</span></span>
* <span data-ttu-id="d47c3-173">`TaskSubmitter.cs`: essa classe é responsável por adicionar tarefas retornadas pelo divisor de trabalho para o trabalho do Lote.</span><span class="sxs-lookup"><span data-stu-id="d47c3-173">`TaskSubmitter.cs`: This class is responsible to adding tasks returned by the job splitter to the Batch job.</span></span> <span data-ttu-id="d47c3-174">A classe JobManager agrega a sequência de tarefas em lotes para uma adição eficiente, e em tempo hábil, ao trabalho. Em seguida, ela chama TaskSubmitter.SubmitTasks em um thread em segundo plano para cada lote.</span><span class="sxs-lookup"><span data-stu-id="d47c3-174">The JobManager class aggregates the sequence of tasks into batches for efficient but timely addition to the job, then calls TaskSubmitter.SubmitTasks on a background thread for each batch.</span></span>

<span data-ttu-id="d47c3-175">**Divisor de trabalho**</span><span class="sxs-lookup"><span data-stu-id="d47c3-175">**Job Splitter**</span></span>

<span data-ttu-id="d47c3-176">`JobSplitter.cs`: essa classe contém uma lógica específica ao aplicativo para dividir o trabalho em tarefas.</span><span class="sxs-lookup"><span data-stu-id="d47c3-176">`JobSplitter.cs`: This class contains application-specific logic for splitting the job into tasks.</span></span> <span data-ttu-id="d47c3-177">O framework invoca o método JobSplitter.Split para obter uma sequência de tarefas, a qual ele adiciona ao trabalho à medida que o método as retorna.</span><span class="sxs-lookup"><span data-stu-id="d47c3-177">The framework invokes the JobSplitter.Split method to obtain a sequence of tasks, which it adds to the job as the method returns them.</span></span> <span data-ttu-id="d47c3-178">Essa é a classe na qual você injetará a lógica de seu trabalho.</span><span class="sxs-lookup"><span data-stu-id="d47c3-178">This is the class where you will inject the logic of your job.</span></span> <span data-ttu-id="d47c3-179">Implemente o método Split para retornar uma sequência de instâncias CloudTask representando as tarefas nas quais você deseja dividir o trabalho.</span><span class="sxs-lookup"><span data-stu-id="d47c3-179">Implement the Split method to return a sequence of CloudTask instances representing the tasks into which you want to partition the job.</span></span>

<span data-ttu-id="d47c3-180">**Arquivos de projeto de linha de comando .NET padrão**</span><span class="sxs-lookup"><span data-stu-id="d47c3-180">**Standard .NET command line project files**</span></span>

* <span data-ttu-id="d47c3-181">`App.config`: arquivo de configuração padrão de aplicativo .NET.</span><span class="sxs-lookup"><span data-stu-id="d47c3-181">`App.config`: Standard .NET application configuration file.</span></span>
* <span data-ttu-id="d47c3-182">`Packages.config`: arquivo de dependência padrão do pacote NuGet.</span><span class="sxs-lookup"><span data-stu-id="d47c3-182">`Packages.config`: Standard NuGet package dependency file.</span></span>
* <span data-ttu-id="d47c3-183">`Program.cs`contém o ponto de entrada do programa e a manipulação de exceção de nível superior.</span><span class="sxs-lookup"><span data-stu-id="d47c3-183">`Program.cs`: Contains the program entry point and top-level exception handling.</span></span>

### <a name="implementing-the-job-splitter"></a><span data-ttu-id="d47c3-184">Implementação do divisor de trabalho</span><span class="sxs-lookup"><span data-stu-id="d47c3-184">Implementing the job splitter</span></span>
<span data-ttu-id="d47c3-185">Quando você abre o projeto de modelo do Gerenciador de trabalhos, o projeto fará o arquivo JobSplitter.cs ser aberto por padrão.</span><span class="sxs-lookup"><span data-stu-id="d47c3-185">When you open the Job Manager template project, the project will have the JobSplitter.cs file open by default.</span></span> <span data-ttu-id="d47c3-186">Você pode implementar a lógica de divisão para as tarefas em sua carga de trabalho usando o método Split() exibido abaixo:</span><span class="sxs-lookup"><span data-stu-id="d47c3-186">You can implement the split logic for the tasks in your workload by using the Split() method show below:</span></span>

```csharp
/// <summary>
/// Gets the tasks into which to split the job. This is where you inject
/// your application-specific logic for decomposing the job into tasks.
///
/// The job manager framework invokes the Split method for you; you need
/// only to implement it, not to call it yourself. Typically, your
/// implementation should return tasks lazily, for example using a C#
/// iterator and the "yield return" statement; this allows tasks to be added
/// and to start running while splitting is still in progress.
/// </summary>
/// <returns>The tasks to be added to the job. Tasks are added automatically
/// by the job manager framework as they are returned by this method.</returns>
public IEnumerable<CloudTask> Split()
{
    // Your code for the split logic goes here.
    int startFrame = Convert.ToInt32(_parameters["StartFrame"]);
    int endFrame = Convert.ToInt32(_parameters["EndFrame"]);

    for (int i = startFrame; i <= endFrame; i++)
    {
        yield return new CloudTask("myTask" + i, "cmd /c dir");
    }
}
```

> [!NOTE]
> <span data-ttu-id="d47c3-187">A seção anotada nos métodos `Split()` é a única seção do código do modelo do Gerenciador de trabalho que você pode modificar adicionando a lógica para dividir os trabalhos em tarefas diferentes.</span><span class="sxs-lookup"><span data-stu-id="d47c3-187">The annotated section in the `Split()` method is the only section of the Job Manager template code that is intended for you to modify by adding the logic to split your jobs into different tasks.</span></span> <span data-ttu-id="d47c3-188">Se você quiser modificar uma seção diferente do modelo, primeiro você precisará ter certeza de que está familiarizado com o funcionamento do Lote e experimente alguns dos [exemplos de código do Lote][github_samples].</span><span class="sxs-lookup"><span data-stu-id="d47c3-188">If you want to modify a different section of the template, please ensure you are familiarized with how Batch works, and try out a few of the [Batch code samples][github_samples].</span></span>
> 
> 

<span data-ttu-id="d47c3-189">Sua implementação de Split() tem acesso a:</span><span class="sxs-lookup"><span data-stu-id="d47c3-189">Your Split() implementation has access to:</span></span>

* <span data-ttu-id="d47c3-190">Os parâmetros do trabalho, por meio do campo `_parameters` .</span><span class="sxs-lookup"><span data-stu-id="d47c3-190">The job parameters, via the `_parameters` field.</span></span>
* <span data-ttu-id="d47c3-191">O objeto CloudJob que representa o trabalho, por meio do campo `_job` .</span><span class="sxs-lookup"><span data-stu-id="d47c3-191">The CloudJob object representing the job, via the `_job` field.</span></span>
* <span data-ttu-id="d47c3-192">O objeto CloudTask que representa a tarefa do gerenciador de trabalho, por meio do campo `_jobManagerTask` .</span><span class="sxs-lookup"><span data-stu-id="d47c3-192">The CloudTask object representing the job manager task, via the `_jobManagerTask` field.</span></span>

<span data-ttu-id="d47c3-193">Sua implementação do `Split()` não precisa adicionar tarefas diretamente ao trabalho.</span><span class="sxs-lookup"><span data-stu-id="d47c3-193">Your `Split()` implementation does not need to add tasks to the job directly.</span></span> <span data-ttu-id="d47c3-194">Em vez disso, seu código deve retornar uma sequência de objetos CloudTask, e eles serão adicionados ao trabalho automaticamente pelas classes do framework que invocam o divisor de trabalho.</span><span class="sxs-lookup"><span data-stu-id="d47c3-194">Instead, your code should return a sequence of CloudTask objects, and these will be added to the job automatically by the framework classes that invoke the job splitter.</span></span> <span data-ttu-id="d47c3-195">É comum usar o recurso do iterador do C# (`yield return`) para implementar divisores de trabalho, pois isso permite o início da execução das tarefas assim que é possível, em vez de esperar que todas as tarefas sejam calculadas.</span><span class="sxs-lookup"><span data-stu-id="d47c3-195">It's common to use C#'s iterator (`yield return`) feature to implement job splitters as this allows the tasks to start running as soon as possible rather than waiting for all tasks to be calculated.</span></span>

<span data-ttu-id="d47c3-196">**Falha do divisor de trabalho**</span><span class="sxs-lookup"><span data-stu-id="d47c3-196">**Job splitter failure**</span></span>

<span data-ttu-id="d47c3-197">Se o divisor de trabalho encontrar um erro, ele deverá:</span><span class="sxs-lookup"><span data-stu-id="d47c3-197">If your job splitter encounters an error, it should either:</span></span>

* <span data-ttu-id="d47c3-198">Encerrar a sequência usando a instrução em C# `yield break` Nesse caso, o Gerenciador de trabalho será tratado como bem-sucedido; ou</span><span class="sxs-lookup"><span data-stu-id="d47c3-198">Terminate the sequence using the C# `yield break` statement, in which case the job manager will be treated as successful; or</span></span>
* <span data-ttu-id="d47c3-199">Lançar uma exceção. Nesse caso, o Gerenciador de trabalho será tratado como se tivesse apresentado uma falha e poderá repetir dependendo do modo de configuração do cliente).</span><span class="sxs-lookup"><span data-stu-id="d47c3-199">Throw an exception, in which case the job manager will be treated as failed and may be retried depending on how the client has configured it).</span></span>

<span data-ttu-id="d47c3-200">Em ambos os casos, quaisquer tarefas que já foram retornadas pelo divisor de trabalho e adicionadas ao trabalho do Lote poderão ser executadas.</span><span class="sxs-lookup"><span data-stu-id="d47c3-200">In both cases, any tasks already returned by the job splitter and added to the Batch job will be eligible to run.</span></span> <span data-ttu-id="d47c3-201">Se você não quiser que isso aconteça, você poderá:</span><span class="sxs-lookup"><span data-stu-id="d47c3-201">If you don't want this to happen, then you could:</span></span>

* <span data-ttu-id="d47c3-202">Encerrar o trabalho antes de retornar do divisor de trabalho</span><span class="sxs-lookup"><span data-stu-id="d47c3-202">Terminate the job before returning from the job splitter</span></span>
* <span data-ttu-id="d47c3-203">Foumular toda a coleção de tarefas inteira antes de retouná-la (ou seja, retouna um `ICollection<CloudTask>` ou `IList<CloudTask>` instead of implementing your job splitter using a C# iteratou)</span><span class="sxs-lookup"><span data-stu-id="d47c3-203">Formulate the entire task collection before returning it (that is, return an `ICollection<CloudTask>` or `IList<CloudTask>` instead of implementing your job splitter using a C# iterator)</span></span>
* <span data-ttu-id="d47c3-204">Usar dependências de tarefas para fazer com que todas as tarefas dependam da conclusão bem-sucedida do Gerenciador de trabalho</span><span class="sxs-lookup"><span data-stu-id="d47c3-204">Use task dependencies to make all tasks depend on the successful completion of the job manager</span></span>

<span data-ttu-id="d47c3-205">**Novas tentativas do Gerenciador de trabalho**</span><span class="sxs-lookup"><span data-stu-id="d47c3-205">**Job manager retries**</span></span>

<span data-ttu-id="d47c3-206">Se o gerenciador de trabalho falhar, o serviço do Lote poderá tentar executá-lo outra vez, dependendo das configurações de repetição do cliente.</span><span class="sxs-lookup"><span data-stu-id="d47c3-206">If the job manager fails, it may be retried by the Batch service depending on the client retry settings.</span></span> <span data-ttu-id="d47c3-207">Em geral, isso é seguro, pois quando o framework adiciona tarefas ao trabalho, ele ignora quaisquer tarefas já existentes.</span><span class="sxs-lookup"><span data-stu-id="d47c3-207">In general, this is safe, because when the framework adds tasks to the job, it ignores any tasks that already exist.</span></span> <span data-ttu-id="d47c3-208">No entanto, se o cálculo de tarefas for caro, talvez você não queira incorrer em custos de recálculo de tarefas que já foram adicionadas ao trabalho; por outro lado, se não houver garantia de que a nova execução gerará as mesmas IDs de tarefa , o comportamento de “ignorar duplicatas” será não iniciado.</span><span class="sxs-lookup"><span data-stu-id="d47c3-208">However, if calculating tasks is expensive, you may not wish to incur the cost of recalculating tasks that have already been added to the job; conversely, if the re-run is not guaranteed to generate the same task IDs then the 'ignore duplicates' behavior will not kick in.</span></span> <span data-ttu-id="d47c3-209">Nesses casos, projete o divisor de trabalho para detectar o trabalho que já foi realizado e não repeti-lo, por exemplo, executando um CloudJob.ListTasks antes de começar a gerar tarefas.</span><span class="sxs-lookup"><span data-stu-id="d47c3-209">In these cases you should design your job splitter to detect the work that has already been done and not repeat it, for example by performing a CloudJob.ListTasks before starting to yield tasks.</span></span>

### <a name="exit-codes-and-exceptions-in-the-job-manager-template"></a><span data-ttu-id="d47c3-210">Códigos de saída e exceções no modelo do Gerenciador de trabalho</span><span class="sxs-lookup"><span data-stu-id="d47c3-210">Exit codes and exceptions in the Job Manager template</span></span>
<span data-ttu-id="d47c3-211">Os códigos de saída e exceções fornecem um mecanismo para determinar o resultado da execução de um programa, e podem ajudar a identificar problemas com a execução do programa.</span><span class="sxs-lookup"><span data-stu-id="d47c3-211">Exit codes and exceptions provide a mechanism to determine the outcome of running a program, and they can help to identify any problems with the execution of the program.</span></span> <span data-ttu-id="d47c3-212">O modelo do Gerenciador de trabalho implementa os códigos e exceções de saída descritos nesta seção.</span><span class="sxs-lookup"><span data-stu-id="d47c3-212">The Job Manager template implements the exit codes and exceptions described in this section.</span></span>

<span data-ttu-id="d47c3-213">Uma tarefa do Gerenciador de trabalho implementada com o modelo do Gerenciador de trabalho pode retornar três códigos de saída possíveis:</span><span class="sxs-lookup"><span data-stu-id="d47c3-213">A job manager task that is implemented with the Job Manager template can return three possible exit codes:</span></span>

| <span data-ttu-id="d47c3-214">Código</span><span class="sxs-lookup"><span data-stu-id="d47c3-214">Code</span></span> | <span data-ttu-id="d47c3-215">Descrição</span><span class="sxs-lookup"><span data-stu-id="d47c3-215">Description</span></span> |
| --- | --- |
| <span data-ttu-id="d47c3-216">0</span><span class="sxs-lookup"><span data-stu-id="d47c3-216">0</span></span> |<span data-ttu-id="d47c3-217">O Gerenciador de trabalho foi concluído com sucesso.</span><span class="sxs-lookup"><span data-stu-id="d47c3-217">The job manager completed successfully.</span></span> <span data-ttu-id="d47c3-218">O código do divisor de trabalho executou até a conclusão, e todas as tarefas foram adicionadas ao trabalho.</span><span class="sxs-lookup"><span data-stu-id="d47c3-218">Your job splitter code ran to completion, and all tasks were added to the job.</span></span> |
| <span data-ttu-id="d47c3-219">1</span><span class="sxs-lookup"><span data-stu-id="d47c3-219">1</span></span> |<span data-ttu-id="d47c3-220">A tarefa do Gerenciador de trabalho falhou com uma exceção em uma parte “esperada” do programa.</span><span class="sxs-lookup"><span data-stu-id="d47c3-220">The job manager task failed with an exception in an 'expected' part of the program.</span></span> <span data-ttu-id="d47c3-221">A exceção foi convertida para um JobManagerException com informações de diagnóstico e, quando possível, sugestões para resolver a falha.</span><span class="sxs-lookup"><span data-stu-id="d47c3-221">The exception was translated to a JobManagerException with diagnostic information and, where possible, suggestions for resolving the failure.</span></span> |
| <span data-ttu-id="d47c3-222">2</span><span class="sxs-lookup"><span data-stu-id="d47c3-222">2</span></span> |<span data-ttu-id="d47c3-223">A tarefa do Gerenciador de trabalho falhou com uma exceção “inesperada”.</span><span class="sxs-lookup"><span data-stu-id="d47c3-223">The job manager task failed with an 'unexpected' exception.</span></span> <span data-ttu-id="d47c3-224">A exceção foi registrada na saída padrão, mas o Gerenciador de trabalho não conseguiu adicionar informações de diagnóstico ou correção adicionais.</span><span class="sxs-lookup"><span data-stu-id="d47c3-224">The exception was logged to standard output, but the job manager was unable to add any additional diagnostic or remediation information.</span></span> |

<span data-ttu-id="d47c3-225">No caso de falha da tarefa do Gerenciador de trabalho, algumas tarefas ainda podem ter sido adicionadas ao serviço antes do erro ocorrer.</span><span class="sxs-lookup"><span data-stu-id="d47c3-225">In the case of job manager task failure, some tasks may still have been added to the service before the error occurred.</span></span> <span data-ttu-id="d47c3-226">Essas tarefas serão executadas normalmente.</span><span class="sxs-lookup"><span data-stu-id="d47c3-226">These tasks will run as normal.</span></span> <span data-ttu-id="d47c3-227">Consulte "Falha do divisor de trabalho" acima para conferir uma discussão desse caminho de código.</span><span class="sxs-lookup"><span data-stu-id="d47c3-227">See "Job Splitter Failure" above for discussion of this code path.</span></span>

<span data-ttu-id="d47c3-228">Todas as informações retornadas pelas exceções são gravadas nos arquivos stdout.txt e stderr.txt.</span><span class="sxs-lookup"><span data-stu-id="d47c3-228">All the information returned by exceptions is written into stdout.txt and stderr.txt files.</span></span> <span data-ttu-id="d47c3-229">Para saber mais, confira [Manipulação de erro](batch-api-basics.md#error-handling).</span><span class="sxs-lookup"><span data-stu-id="d47c3-229">For more information, see [Error Handling](batch-api-basics.md#error-handling).</span></span>

### <a name="client-considerations"></a><span data-ttu-id="d47c3-230">Considerações do cliente</span><span class="sxs-lookup"><span data-stu-id="d47c3-230">Client considerations</span></span>
<span data-ttu-id="d47c3-231">Esta seção descreve alguns requisitos de implementação do cliente ao invocar um Gerenciador de trabalho com base nesse modelo.</span><span class="sxs-lookup"><span data-stu-id="d47c3-231">This section describes some client implementation requirements when invoking a job manager based on this template.</span></span> <span data-ttu-id="d47c3-232">Consulte [Como passar parâmetros e variáveis de ambiente no código do cliente](#pass-environment-settings) para obter detalhes sobre como passar parâmetros e configurações de ambiente.</span><span class="sxs-lookup"><span data-stu-id="d47c3-232">See [How to pass parameters and environment variables from the client code](#pass-environment-settings) for details on passing parameters and environment settings.</span></span>

<span data-ttu-id="d47c3-233">**Credenciais obrigatórias**</span><span class="sxs-lookup"><span data-stu-id="d47c3-233">**Mandatory credentials**</span></span>

<span data-ttu-id="d47c3-234">Para adicionar tarefas ao trabalho do Lote do Azure, a tarefa do Gerenciador de trabalho exige a URL e a chave da conta do Lote do Azure.</span><span class="sxs-lookup"><span data-stu-id="d47c3-234">In order to add tasks to the Azure Batch job, the job manager task requires your Azure Batch account URL and key.</span></span> <span data-ttu-id="d47c3-235">Você deve passá-la nas variáveis de ambiente chamadas YOUR_BATCH_URL e YOUR_BATCH_KEY.</span><span class="sxs-lookup"><span data-stu-id="d47c3-235">You must pass these in environment variables named YOUR_BATCH_URL and YOUR_BATCH_KEY.</span></span> <span data-ttu-id="d47c3-236">Defina-as nas configurações de ambiente da tarefa do Gerenciador de trabalho.</span><span class="sxs-lookup"><span data-stu-id="d47c3-236">You can set these in the Job Manager task environment settings.</span></span> <span data-ttu-id="d47c3-237">Por exemplo, em um cliente C#:</span><span class="sxs-lookup"><span data-stu-id="d47c3-237">For example, in a C# client:</span></span>

```csharp
job.JobManagerTask.EnvironmentSettings = new [] {
    new EnvironmentSetting("YOUR_BATCH_URL", "https://account.region.batch.azure.com"),
    new EnvironmentSetting("YOUR_BATCH_KEY", "{your_base64_encoded_account_key}"),
};
```
<span data-ttu-id="d47c3-238">**Credenciais de armazenamento**</span><span class="sxs-lookup"><span data-stu-id="d47c3-238">**Storage credentials**</span></span>

<span data-ttu-id="d47c3-239">Normalmente, o cliente não precisa fornecer as credenciais da conta de armazenamento vinculado à tarefa do Gerenciador de trabalho, pois (a) a maioria dos gerenciadores de trabalho não precisa acessar explicitamente a conta de armazenamento vinculado e (b) a conta de armazenamento vinculado normalmente é fornecida para todas as tarefas como uma configuração de ambiente comum para o trabalho.</span><span class="sxs-lookup"><span data-stu-id="d47c3-239">Typically, the client does not need to provide the linked storage account credentials to the job manager task because (a) most job managers do not need to explicitly access the linked storage account and (b) the linked storage account is often provided to all tasks as a common environment setting for the job.</span></span> <span data-ttu-id="d47c3-240">Se você não estiver fornecendo a conta de armazenamento vinculada por meio das configurações de ambiente comum, e o Gerenciador de trabalho exigir acesso ao armazenamento vinculado, você deverá fornecer as credenciais de armazenamento vinculado da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="d47c3-240">If you are not providing the linked storage account via the common environment settings, and the job manager requires access to linked storage, then you should supply the linked storage credentials as follows:</span></span>

```csharp
job.JobManagerTask.EnvironmentSettings = new [] {
    /* other environment settings */
    new EnvironmentSetting("LINKED_STORAGE_ACCOUNT", "{storageAccountName}"),
    new EnvironmentSetting("LINKED_STORAGE_KEY", "{storageAccountKey}"),
};
```

<span data-ttu-id="d47c3-241">**Configurações da tarefa do Gerenciador de trabalho**</span><span class="sxs-lookup"><span data-stu-id="d47c3-241">**Job manager task settings**</span></span>

<span data-ttu-id="d47c3-242">O cliente deve definir o sinalizador *killJobOnCompletion* do Gerenciador de trabalho como **false**.</span><span class="sxs-lookup"><span data-stu-id="d47c3-242">The client should set the job manager *killJobOnCompletion* flag to **false**.</span></span>

<span data-ttu-id="d47c3-243">Normalmente, é seguro para o cliente definir *runExclusive* como **false**.</span><span class="sxs-lookup"><span data-stu-id="d47c3-243">It is usually safe for the client to set *runExclusive* to **false**.</span></span>

<span data-ttu-id="d47c3-244">O cliente deve usar a coleção *resourceFiles* ou *applicationPackageReferences* para que o executável do Gerenciador de trabalho (e suas DLLs necessárias) seja implantado no nó de computação.</span><span class="sxs-lookup"><span data-stu-id="d47c3-244">The client should use the *resourceFiles* or *applicationPackageReferences* collection to have the job manager executable (and its required DLLs) deployed to the compute node.</span></span>

<span data-ttu-id="d47c3-245">Por padrão, o Gerenciador de trabalho não será repetido em caso de falha.</span><span class="sxs-lookup"><span data-stu-id="d47c3-245">By default, the job manager will not be retried if it fails.</span></span> <span data-ttu-id="d47c3-246">Dependendo de sua lógica do Gerenciador de trabalho, talvez o cliente queira habilitar novas tentativas por meio de *constraints*/*maxTaskRetryCount*.</span><span class="sxs-lookup"><span data-stu-id="d47c3-246">Depending on your job manager logic, the client may want to enable retries via *constraints*/*maxTaskRetryCount*.</span></span>

<span data-ttu-id="d47c3-247">**Configurações do trabalho**</span><span class="sxs-lookup"><span data-stu-id="d47c3-247">**Job settings**</span></span>

<span data-ttu-id="d47c3-248">Se o divisor de trabalho emitir tarefas com dependências, o cliente deverá definir usesTaskDependencies do trabalho como true.</span><span class="sxs-lookup"><span data-stu-id="d47c3-248">If the job splitter emits tasks with dependencies, the client must set the job's usesTaskDependencies to true.</span></span>

<span data-ttu-id="d47c3-249">No modelo do divisor de trabalho, não é comum os clientes quererem adicionar tarefas a trabalhos além do que foi criado pelo divisor de trabalho.</span><span class="sxs-lookup"><span data-stu-id="d47c3-249">In the job splitter model, it is unusual for clients to wish to add tasks to jobs over and above what the job splitter creates.</span></span> <span data-ttu-id="d47c3-250">Portanto, o cliente deve definir normalmente o *onAllTasksComplete* do trabalho como **terminatejob**.</span><span class="sxs-lookup"><span data-stu-id="d47c3-250">The client should therefore normally set the job's *onAllTasksComplete* to **terminatejob**.</span></span>

## <a name="task-processor-template"></a><span data-ttu-id="d47c3-251">Modelo de Processador de tarefas</span><span class="sxs-lookup"><span data-stu-id="d47c3-251">Task Processor template</span></span>
<span data-ttu-id="d47c3-252">Um modelo do Processador de tarefas ajuda você a implementar um processador de tarefas que pode executar as seguintes ações:</span><span class="sxs-lookup"><span data-stu-id="d47c3-252">A Task Processor template helps you to implement a task processor that can perform the following actions:</span></span>

* <span data-ttu-id="d47c3-253">Configurar as informações exigidas para a execução de cada tarefa do Lote.</span><span class="sxs-lookup"><span data-stu-id="d47c3-253">Set up the information required by each Batch task to run.</span></span>
* <span data-ttu-id="d47c3-254">Executar todas as ações exigidas por cada tarefa do Lote.</span><span class="sxs-lookup"><span data-stu-id="d47c3-254">Run all actions required by each Batch task.</span></span>
* <span data-ttu-id="d47c3-255">Salvar as saídas da tarefa no armazenamento persistente.</span><span class="sxs-lookup"><span data-stu-id="d47c3-255">Save task outputs to persistent storage.</span></span>

<span data-ttu-id="d47c3-256">Apesar de um Processador de tarefas não ser exigido para a execução de tarefas do Lote, a principal vantagem de usar um Processador de tarefas é que ele fornece um wrapper para implementar todas as ações de execução de tarefas em um único local.</span><span class="sxs-lookup"><span data-stu-id="d47c3-256">Although a task processor is not required to run tasks on Batch, the key advantage of using a task processor is that it provides a wrapper to implement all task execution actions in one location.</span></span> <span data-ttu-id="d47c3-257">Por exemplo, se você precisar executar vários aplicativos no contexto de cada tarefa, ou se você precisar copiar dados no armazenamento persistente após a conclusão de cada tarefa.</span><span class="sxs-lookup"><span data-stu-id="d47c3-257">For example, if you need to run several applications in the context of each task, or if you need to copy data to persistent storage after completing each task.</span></span>

<span data-ttu-id="d47c3-258">As ações executadas pelo Processador de tarefas podem simples ou complexas, e muitas ou poucas, conforme a exigência de sua carga de trabalho.</span><span class="sxs-lookup"><span data-stu-id="d47c3-258">The actions performed by the task processor can be as simple or complex, and as many or as few, as required by your workload.</span></span> <span data-ttu-id="d47c3-259">Além disso, ao implementar todas as ações de tarefa em um processador de tarefa, você pode atualizar ou adicionar ações prontamente com base em alterações nos requisitos dos aplicativos ou da carga de trabalho.</span><span class="sxs-lookup"><span data-stu-id="d47c3-259">Additionally, by implementing all task actions into one task processor, you can readily update or add actions based on changes to applications or workload requirements.</span></span> <span data-ttu-id="d47c3-260">No entanto, em alguns casos, talvez um Processador de tarefas não seja a solução ideal para sua implementação, pois ele pode adicionar uma complexidade desnecessária, por exemplo, ao executar trabalhos que podem ser iniciados rapidamente em uma linha de comando simples.</span><span class="sxs-lookup"><span data-stu-id="d47c3-260">However, in some cases a task processor might not be the optimal solution for your implementation as it can add unnecessary complexity, for example when running jobs that can be quickly started from a simple command line.</span></span>

### <a name="create-a-task-processor-using-the-template"></a><span data-ttu-id="d47c3-261">Criar um Processador de tarefas usando o modelo</span><span class="sxs-lookup"><span data-stu-id="d47c3-261">Create a Task Processor using the template</span></span>
<span data-ttu-id="d47c3-262">Para adicionar um Processador de tarefas à solução que você criou anteriormente, execute estas etapas:</span><span class="sxs-lookup"><span data-stu-id="d47c3-262">To add a task processor to the solution that you created earlier, follow these steps:</span></span>

1. <span data-ttu-id="d47c3-263">Abra sua solução existente no Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="d47c3-263">Open your existing solution in Visual Studio.</span></span>
2. <span data-ttu-id="d47c3-264">No Gerenciador de Soluções, clique com o botão direito na solução, clique em **Adicionar** e em **Novo Projeto**.</span><span class="sxs-lookup"><span data-stu-id="d47c3-264">In Solution Explorer, right-click the solution, click **Add**, and then click **New Project**.</span></span>
3. <span data-ttu-id="d47c3-265">No **Visual C#**, clique em **Nuvem** e em **Processador de Tarefas do Lote do Azure**.</span><span class="sxs-lookup"><span data-stu-id="d47c3-265">Under **Visual C#**, click **Cloud**, and then click **Azure Batch Task Processor**.</span></span>
4. <span data-ttu-id="d47c3-266">Digite um nome que descreva o aplicativo e identifique esse projeto como o Processador de tarefas (por exemplo, "ProcessadorDeTarefasLitware").</span><span class="sxs-lookup"><span data-stu-id="d47c3-266">Type a name that describes your application and identifies this project as the task processor (e.g. "LitwareTaskProcessor").</span></span>
5. <span data-ttu-id="d47c3-267">Para criar o projeto, clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="d47c3-267">To create the project, click **OK**.</span></span>
6. <span data-ttu-id="d47c3-268">Por fim, compile o projeto para forçar o Visual Studio a carregar todos os pacotes NuGet referenciados e verificar se o projeto é válido antes de você começar a modificá-lo.</span><span class="sxs-lookup"><span data-stu-id="d47c3-268">Finally, build the project to force Visual Studio to load all referenced NuGet packages and to verify that the project is valid before you start modifying it.</span></span>

### <a name="task-processor-template-files-and-their-purpose"></a><span data-ttu-id="d47c3-269">Arquivos do modelo do Processador de tarefas e suas finalidades</span><span class="sxs-lookup"><span data-stu-id="d47c3-269">Task Processor template files and their purpose</span></span>
<span data-ttu-id="d47c3-270">Quando você cria um projeto usando o modelo do Processador de tarefas, ele gera três grupos de arquivos de código:</span><span class="sxs-lookup"><span data-stu-id="d47c3-270">When you create a project using the task processor template, it generates three groups of code files:</span></span>

* <span data-ttu-id="d47c3-271">O arquivo de programa principal (Program.cs).</span><span class="sxs-lookup"><span data-stu-id="d47c3-271">The main program file (Program.cs).</span></span> <span data-ttu-id="d47c3-272">Esse arquivo contém o ponto de entrada do programa e a manipulação de exceção de nível superior.</span><span class="sxs-lookup"><span data-stu-id="d47c3-272">This contains the program entry point and top-level exception handling.</span></span> <span data-ttu-id="d47c3-273">Normalmente, não é necessário modificar isso.</span><span class="sxs-lookup"><span data-stu-id="d47c3-273">You shouldn't normally need to modify this.</span></span>
* <span data-ttu-id="d47c3-274">O diretório Framework.</span><span class="sxs-lookup"><span data-stu-id="d47c3-274">The Framework directory.</span></span> <span data-ttu-id="d47c3-275">Esse diretório contém os arquivos responsáveis pelo trabalho “clichê” realizado pelo programa Gerenciador de trabalho – desempacotar parâmetros, adicionar tarefas ao trabalho do Lote etc. Normalmente, não é necessário modificar esses arquivos.</span><span class="sxs-lookup"><span data-stu-id="d47c3-275">This contains the files responsible for the 'boilerplate' work done by the job manager program – unpacking parameters, adding tasks to the Batch job, etc. You shouldn't normally need to modify these files.</span></span>
* <span data-ttu-id="d47c3-276">O arquivo do Processador de tarefas (TaskProcessor.cs).</span><span class="sxs-lookup"><span data-stu-id="d47c3-276">The task processor file (TaskProcessor.cs).</span></span> <span data-ttu-id="d47c3-277">É nele que você colocará a lógica específica ao aplicativo para execução de uma tarefa (normalmente chamando um executável existente).</span><span class="sxs-lookup"><span data-stu-id="d47c3-277">This is where you will put your application-specific logic for executing a task (typically by calling out to an existing executable).</span></span> <span data-ttu-id="d47c3-278">Código de pré e pós-processamento, como o download dos dados adicionais ou upload de arquivos de resultados, também é colocado nesse local.</span><span class="sxs-lookup"><span data-stu-id="d47c3-278">Pre- and post-processing code, such as downloading additional data or uploading result files, also goes here.</span></span>

<span data-ttu-id="d47c3-279">Obviamente você pode adicionar outros arquivos conforme o necessário a fim de oferecer suporte ao código do Processador de tarefas, dependendo da complexidade da lógica de divisão do trabalho.</span><span class="sxs-lookup"><span data-stu-id="d47c3-279">Of course you can add additional files as required to support your task processor code, depending on the complexity of the job splitting logic.</span></span>

<span data-ttu-id="d47c3-280">O modelo também gera arquivos de projeto padrão do .NET, como um arquivo .csproj, app.config, packages.config etc.</span><span class="sxs-lookup"><span data-stu-id="d47c3-280">The template also generates standard .NET project files such as a .csproj file, app.config, packages.config, etc.</span></span>

<span data-ttu-id="d47c3-281">O restante desta seção descreve os diferentes arquivos e sua estrutura de código, e explica o que cada classe faz.</span><span class="sxs-lookup"><span data-stu-id="d47c3-281">The rest of this section describes the different files and their code structure, and explains what each class does.</span></span>

![Visual Studio Solution Explorer mostrando a solução do modelo do Processador de tarefas][solution_explorer02]

<span data-ttu-id="d47c3-283">**Arquivos do Framework**</span><span class="sxs-lookup"><span data-stu-id="d47c3-283">**Framework files**</span></span>

* <span data-ttu-id="d47c3-284">`Configuration.cs`: encapsula o carregamento de dados de configuração de trabalho, como detalhes da conta do Lote, credenciais da conta de armazenamento vinculada, informações sobre o trabalho e as tarefas e parâmetros do trabalho.</span><span class="sxs-lookup"><span data-stu-id="d47c3-284">`Configuration.cs`: Encapsulates the loading of job configuration data such as Batch account details, linked storage account credentials, job and task information, and job parameters.</span></span> <span data-ttu-id="d47c3-285">Ele também fornece acesso a variáveis de ambiente definidas pelo Lote (consulte Configurações de ambiente para tarefas, na documentação do Lote) por meio da classe Configuration.EnvironmentVariable.</span><span class="sxs-lookup"><span data-stu-id="d47c3-285">It also provides access to Batch-defined environment variables (see Environment settings for tasks, in the Batch documentation) via the Configuration.EnvironmentVariable class.</span></span>
* <span data-ttu-id="d47c3-286">`IConfiguration.cs`: abstrai a implementação da classe Configuration, para que você possa testar a unidade de seu divisor de trabalho usando um objeto de configuração falso ou fictício.</span><span class="sxs-lookup"><span data-stu-id="d47c3-286">`IConfiguration.cs`: Abstracts the implementation of the Configuration class, so that you can unit test your job splitter using a fake or mock configuration object.</span></span>
* <span data-ttu-id="d47c3-287">`TaskProcessorException.cs`: representa um erro que exige o encerramento do Gerenciador de trabalho.</span><span class="sxs-lookup"><span data-stu-id="d47c3-287">`TaskProcessorException.cs`: Represents an error that requires the job manager to terminate.</span></span> <span data-ttu-id="d47c3-288">TaskProcessorException é usado para encapsular erros “esperados”, em que as informações de diagnóstico específicas podem ser fornecidas como parte do encerramento.</span><span class="sxs-lookup"><span data-stu-id="d47c3-288">TaskProcessorException is used to wrap 'expected' errors where specific diagnostic information can be provided as part of termination.</span></span>

<span data-ttu-id="d47c3-289">**Processador de tarefas**</span><span class="sxs-lookup"><span data-stu-id="d47c3-289">**Task Processor**</span></span>

* <span data-ttu-id="d47c3-290">`TaskProcessor.cs`: executa a tarefa.</span><span class="sxs-lookup"><span data-stu-id="d47c3-290">`TaskProcessor.cs`: Runs the task.</span></span> <span data-ttu-id="d47c3-291">O framework invoca o método TaskProcessor.Run.</span><span class="sxs-lookup"><span data-stu-id="d47c3-291">The framework invokes the TaskProcessor.Run method.</span></span> <span data-ttu-id="d47c3-292">Essa é a classe na qual você injetará a lógica específica ao aplicativo de sua tarefa.</span><span class="sxs-lookup"><span data-stu-id="d47c3-292">This is the class where you will inject the application-specific logic of your task.</span></span> <span data-ttu-id="d47c3-293">Implemente o método Run para:</span><span class="sxs-lookup"><span data-stu-id="d47c3-293">Implement the Run method to:</span></span>
  * <span data-ttu-id="d47c3-294">Analisar e validar qualquer parâmetro de tarefa</span><span class="sxs-lookup"><span data-stu-id="d47c3-294">Parse and validate any task parameters</span></span>
  * <span data-ttu-id="d47c3-295">Compor a linha de comando para qualquer programa externo que você deseja invocar</span><span class="sxs-lookup"><span data-stu-id="d47c3-295">Compose the command line for any external program you want to invoke</span></span>
  * <span data-ttu-id="d47c3-296">Registrar quaisquer informações de diagnóstico que você possa precisar para fins de depuração</span><span class="sxs-lookup"><span data-stu-id="d47c3-296">Log any diagnostic information you may require for debugging purposes</span></span>
  * <span data-ttu-id="d47c3-297">Iniciar um processo usando a linha de comando</span><span class="sxs-lookup"><span data-stu-id="d47c3-297">Start a process using that command line</span></span>
  * <span data-ttu-id="d47c3-298">Aguardar o processo sair</span><span class="sxs-lookup"><span data-stu-id="d47c3-298">Wait for the process to exit</span></span>
  * <span data-ttu-id="d47c3-299">Capturar o código de saída do processo para determinar se ele teve êxito ou falhou</span><span class="sxs-lookup"><span data-stu-id="d47c3-299">Capture the exit code of the process to determine if it succeeded or failed</span></span>
  * <span data-ttu-id="d47c3-300">Salvar os arquivos de saída que você deseja manter no armazenamento persistente</span><span class="sxs-lookup"><span data-stu-id="d47c3-300">Save any output files you want to keep to persistent storage</span></span>

<span data-ttu-id="d47c3-301">**Arquivos de projeto de linha de comando .NET padrão**</span><span class="sxs-lookup"><span data-stu-id="d47c3-301">**Standard .NET command line project files**</span></span>

* <span data-ttu-id="d47c3-302">`App.config`: arquivo de configuração padrão de aplicativo .NET.</span><span class="sxs-lookup"><span data-stu-id="d47c3-302">`App.config`: Standard .NET application configuration file.</span></span>
* <span data-ttu-id="d47c3-303">`Packages.config`: arquivo de dependência padrão do pacote NuGet.</span><span class="sxs-lookup"><span data-stu-id="d47c3-303">`Packages.config`: Standard NuGet package dependency file.</span></span>
* <span data-ttu-id="d47c3-304">`Program.cs`contém o ponto de entrada do programa e a manipulação de exceção de nível superior.</span><span class="sxs-lookup"><span data-stu-id="d47c3-304">`Program.cs`: Contains the program entry point and top-level exception handling.</span></span>

## <a name="implementing-the-task-processor"></a><span data-ttu-id="d47c3-305">Implementação do Processador de tarefa</span><span class="sxs-lookup"><span data-stu-id="d47c3-305">Implementing the task processor</span></span>
<span data-ttu-id="d47c3-306">Quando você abre o projeto de modelo do Processador de tarefas, o projeto fará o arquivo TaskProcessor.cs ser aberto por padrão.</span><span class="sxs-lookup"><span data-stu-id="d47c3-306">When you open the Task Processor template project, the project will have the TaskProcessor.cs file open by default.</span></span> <span data-ttu-id="d47c3-307">Você pode implementar a lógica de execução para as tarefas em sua carga de trabalho usando o método Run() exibido abaixo:</span><span class="sxs-lookup"><span data-stu-id="d47c3-307">You can implement the run logic for the tasks in your workload by using the Run() method shown below:</span></span>

```csharp
/// <summary>
/// Runs the task processing logic. This is where you inject
/// your application-specific logic for decomposing the job into tasks.
///
/// The task processor framework invokes the Run method for you; you need
/// only to implement it, not to call it yourself. Typically, your
/// implementation will execute an external program (from resource files or
/// an application package), check the exit code of that program and
/// save output files to persistent storage.
/// </summary>
public async Task<int> Run()

{
    try
    {
        //Your code for the task processor goes here.
        var command = $"compare {_parameters["Frame1"]} {_parameters["Frame2"]} compare.gif";
        using (var process = Process.Start($"cmd /c {command}"))
        {
            process.WaitForExit();
            var taskOutputStorage = new TaskOutputStorage(
            _configuration.StorageAccount,
            _configuration.JobId,
            _configuration.TaskId
            );
            await taskOutputStorage.SaveAsync(
            TaskOutputKind.TaskOutput,
            @"..\stdout.txt",
            @"stdout.txt"
            );
            return process.ExitCode;
        }
    }
    catch (Exception ex)
    {
        throw new TaskProcessorException(
        $"{ex.GetType().Name} exception in run task processor: {ex.Message}",
        ex
        );
    }
}
```
> [!NOTE]
> <span data-ttu-id="d47c3-308">A seção anotada no método Run() é a única seção do código do modelo do Processador de tarefas que você pode modificar adicionando a lógica de execução às tarefas em sua carga de trabalho.</span><span class="sxs-lookup"><span data-stu-id="d47c3-308">The annotated section in the Run() method is the only section of the Task Processor template code that is intended for you to modify by adding the run logic for the tasks in your workload.</span></span> <span data-ttu-id="d47c3-309">Se você quiser modificar uma seção diferente do modelo, primeiro você precisa ter certeza de que está familiarizado com o funcionamento do Lote revisando a documentação do Lote e experimentando alguns dos exemplos de código do Lote.</span><span class="sxs-lookup"><span data-stu-id="d47c3-309">If you want to modify a different section of the template, please first familiarize yourself with how Batch works by reviewing the Batch documentation and trying out a few of the Batch code samples.</span></span>
> 
> 

<span data-ttu-id="d47c3-310">O método Run() é responsável por iniciar a linha de comando, iniciar um ou mais processos, aguardar a conclusão de todos os processos, salvar os resultados e, finalmente, retornar um código de saída.</span><span class="sxs-lookup"><span data-stu-id="d47c3-310">The Run() method is responsible for launching the command line, starting one or more processes, waiting for all process to complete, saving the results, and finally returning with an exit code.</span></span> <span data-ttu-id="d47c3-311">O método Run() é onde você implementa a lógica de processamento das tarefas.</span><span class="sxs-lookup"><span data-stu-id="d47c3-311">The Run() method is where you implement the processing logic for your tasks.</span></span> <span data-ttu-id="d47c3-312">A estrutura do Processador de tarefas invoca o método Run() para você. Não é necessário chamá-lo.</span><span class="sxs-lookup"><span data-stu-id="d47c3-312">The task processor framework invokes the Run() method for you; you do not need to call it yourself.</span></span>

<span data-ttu-id="d47c3-313">Sua implementação de Run() tem acesso a:</span><span class="sxs-lookup"><span data-stu-id="d47c3-313">Your Run() implementation has access to:</span></span>

* <span data-ttu-id="d47c3-314">Os parâmetros da tarefa, por meio do campo `_parameters`.</span><span class="sxs-lookup"><span data-stu-id="d47c3-314">The task parameters, via the `_parameters` field.</span></span>
* <span data-ttu-id="d47c3-315">As IDs do trabalho e da tarefa, por meio dos campos `_jobId` e `_taskId`.</span><span class="sxs-lookup"><span data-stu-id="d47c3-315">The job and task ids, via the `_jobId` and `_taskId` fields.</span></span>
* <span data-ttu-id="d47c3-316">A configuração da tarefa, por meio do campo `_configuration` .</span><span class="sxs-lookup"><span data-stu-id="d47c3-316">The task configuration, via the `_configuration` field.</span></span>

<span data-ttu-id="d47c3-317">**Falha da tarefa**</span><span class="sxs-lookup"><span data-stu-id="d47c3-317">**Task failure**</span></span>

<span data-ttu-id="d47c3-318">Em caso de falha, você poderá sair do método Run() lançando uma exceção, mas isso deixa o manipulador de exceção de nível superior no controle do código de saída da tarefa.</span><span class="sxs-lookup"><span data-stu-id="d47c3-318">In case of failure, you can exit the Run() method by throwing an exception, but this leaves the top level exception handler in control of the task exit code.</span></span> <span data-ttu-id="d47c3-319">Se você precisar controlar o código de saída para que possa diferenciar tipos diferentes de falha, por exemplo, para fins de diagnóstico ou porque alguns modos de falha devem encerrar o trabalho e outros não, saia do método Run() retornando um código de saída diferente de zero.</span><span class="sxs-lookup"><span data-stu-id="d47c3-319">If you need to control the exit code so that you can distinguish different types of failure, for example for diagnostic purposes or because some failure modes should terminate the job and others should not, then you should exit the Run() method by returning a non-zero exit code.</span></span> <span data-ttu-id="d47c3-320">Isso se torna o código de saída da tarefa.</span><span class="sxs-lookup"><span data-stu-id="d47c3-320">This becomes the task exit code.</span></span>

### <a name="exit-codes-and-exceptions-in-the-task-processor-template"></a><span data-ttu-id="d47c3-321">Códigos e exceções de saída no modelo do Processador de tarefas</span><span class="sxs-lookup"><span data-stu-id="d47c3-321">Exit codes and exceptions in the Task Processor template</span></span>
<span data-ttu-id="d47c3-322">Os códigos de saída e exceções fornecem um mecanismo para determinar o resultado da execução de um programa, e podem ajudar a identificar problemas com a execução do programa.</span><span class="sxs-lookup"><span data-stu-id="d47c3-322">Exit codes and exceptions provide a mechanism to determine the outcome of running a program, and they can help identify any problems with the execution of the program.</span></span> <span data-ttu-id="d47c3-323">O modelo do Processador de tarefas implementa os códigos e exceções de saída descritos nesta seção.</span><span class="sxs-lookup"><span data-stu-id="d47c3-323">The Task Processor template implements the exit codes and exceptions described in this section.</span></span>

<span data-ttu-id="d47c3-324">Uma tarefa do Processador de tarefas implementada com o modelo do Processador de tarefas pode retornar três códigos de saída possíveis:</span><span class="sxs-lookup"><span data-stu-id="d47c3-324">A task processor task that is implemented with the Task Processor template can return three possible exit codes:</span></span>

| <span data-ttu-id="d47c3-325">Código</span><span class="sxs-lookup"><span data-stu-id="d47c3-325">Code</span></span> | <span data-ttu-id="d47c3-326">Descrição</span><span class="sxs-lookup"><span data-stu-id="d47c3-326">Description</span></span> |
| --- | --- |
| <span data-ttu-id="d47c3-327">[Process.ExitCode][process_exitcode]</span><span class="sxs-lookup"><span data-stu-id="d47c3-327">[Process.ExitCode][process_exitcode]</span></span> |<span data-ttu-id="d47c3-328">O Processador de tarefas foi executado até a conclusão.</span><span class="sxs-lookup"><span data-stu-id="d47c3-328">The task processor ran to completion.</span></span> <span data-ttu-id="d47c3-329">Observe que isso não significa que o programa invocado foi bem-sucedida, apenas que o Processador de tarefas o invocou e executou com êxito qualquer pós-processamento sem exceções.</span><span class="sxs-lookup"><span data-stu-id="d47c3-329">Note that this does not imply that the program you invoked was successful – only that the task processor invoked it successfully and performed any post-processing without exceptions.</span></span> <span data-ttu-id="d47c3-330">O significado do código de saída depende do programa invocado, normalmente o código de saída 0 significa que o programa foi bem-sucedido e qualquer outro código de saída significa que o programa falhou.</span><span class="sxs-lookup"><span data-stu-id="d47c3-330">The meaning of the exit code depends on the invoked program – typically exit code 0 means the program succeeded and any other exit code means the program failed.</span></span> |
| <span data-ttu-id="d47c3-331">1</span><span class="sxs-lookup"><span data-stu-id="d47c3-331">1</span></span> |<span data-ttu-id="d47c3-332">A tarefa do Processador de tarefas falhou com uma exceção em uma parte “esperada” do programa.</span><span class="sxs-lookup"><span data-stu-id="d47c3-332">The task processor failed with an exception in an 'expected' part of the program.</span></span> <span data-ttu-id="d47c3-333">A exceção foi convertida para um `TaskProcessorException` com informações de diagnóstico e, quando possível, sugestões para resolver a falha.</span><span class="sxs-lookup"><span data-stu-id="d47c3-333">The exception was translated to a `TaskProcessorException` with diagnostic information and, where possible, suggestions for resolving the failure.</span></span> |
| <span data-ttu-id="d47c3-334">2</span><span class="sxs-lookup"><span data-stu-id="d47c3-334">2</span></span> |<span data-ttu-id="d47c3-335">A tarefa do Processador de tarefas falhou com uma exceção “inesperada”.</span><span class="sxs-lookup"><span data-stu-id="d47c3-335">The task processor failed with an 'unexpected' exception.</span></span> <span data-ttu-id="d47c3-336">A exceção foi registrada na saída padrão, mas o Processador de tarefas não conseguiu adicionar informações de diagnóstico ou correção adicionais.</span><span class="sxs-lookup"><span data-stu-id="d47c3-336">The exception was logged to standard output, but the task processor was unable to add any additional diagnostic or remediation information.</span></span> |

> [!NOTE]
> <span data-ttu-id="d47c3-337">Se o programa que você invocar usar códigos de saída 1 e 2 para indicar modos de falha específicos, o uso de códigos de saída 1 e 2 para erros do processador de tarefas é ambíguo.</span><span class="sxs-lookup"><span data-stu-id="d47c3-337">If the program you invoke uses exit codes 1 and 2 to indicate specific failure modes, then using exit codes 1 and 2 for task processor errors is ambiguous.</span></span> <span data-ttu-id="d47c3-338">Você pode alterar esses códigos de erro do Processador de tarefas para códigos de saída diferentes, editando os casos de exceção no arquivo Program.cs.</span><span class="sxs-lookup"><span data-stu-id="d47c3-338">You can change these task processor error codes to distinctive exit codes by editing the exception cases in the Program.cs file.</span></span>
> 
> 

<span data-ttu-id="d47c3-339">Todas as informações retornadas pelas exceções são gravadas nos arquivos stdout.txt e stderr.txt.</span><span class="sxs-lookup"><span data-stu-id="d47c3-339">All the information returned by exceptions is written into stdout.txt and stderr.txt files.</span></span> <span data-ttu-id="d47c3-340">Para saber mais, confira Manipulação de erros na documentação do Lote.</span><span class="sxs-lookup"><span data-stu-id="d47c3-340">For more information, see Error Handling, in the Batch documentation.</span></span>

### <a name="client-considerations"></a><span data-ttu-id="d47c3-341">Considerações do cliente</span><span class="sxs-lookup"><span data-stu-id="d47c3-341">Client considerations</span></span>
<span data-ttu-id="d47c3-342">**Credenciais de armazenamento**</span><span class="sxs-lookup"><span data-stu-id="d47c3-342">**Storage credentials**</span></span>

<span data-ttu-id="d47c3-343">Se o seu Processador de tarefas usa o Armazenamento de Blobs do Azure para persistir saídas, por exemplo, usando a biblioteca do auxiliar de convenções de arquivo, ele precisará acessar *ou* as credenciais da conta de armazenamento de nuvem *ou* uma URL do contêiner de blobs que inclui uma SAS (assinatura de acesso compartilhado).</span><span class="sxs-lookup"><span data-stu-id="d47c3-343">If your task processor uses Azure blob storage to persist outputs, for example using the file conventions helper library, then it needs access to *either* the cloud storage account credentials *or* a blob container URL that includes a shared access signature (SAS).</span></span> <span data-ttu-id="d47c3-344">O modelo inclui suporte para o fornecimento das credenciais por meio de variáveis de ambiente comuns.</span><span class="sxs-lookup"><span data-stu-id="d47c3-344">The template includes support for providing credentials via common environment variables.</span></span> <span data-ttu-id="d47c3-345">O cliente pode passar as credenciais de armazenamento da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="d47c3-345">Your client can pass the storage credentials as follows:</span></span>

```csharp
job.CommonEnvironmentSettings = new [] {
    new EnvironmentSetting("LINKED_STORAGE_ACCOUNT", "{storageAccountName}"),
    new EnvironmentSetting("LINKED_STORAGE_KEY", "{storageAccountKey}"),
};
```

<span data-ttu-id="d47c3-346">Assim, a conta de armazenamento fica disponível na classe TaskProcessor por meio da propriedade `_configuration.StorageAccount` .</span><span class="sxs-lookup"><span data-stu-id="d47c3-346">The storage account is then available in the TaskProcessor class via the `_configuration.StorageAccount` property.</span></span>

<span data-ttu-id="d47c3-347">Se você preferir usar uma URL de contêiner com a SAS, também será possível passar isso por meio de uma configuração de ambiente de trabalho comum, mas o modelo do Processador de tarefas não inclui suporte interno para isso no momento.</span><span class="sxs-lookup"><span data-stu-id="d47c3-347">If you prefer to use a container URL with SAS, you can also pass this via an job common environment setting, but the task processor template does not currently include built-in support for this.</span></span>

<span data-ttu-id="d47c3-348">**Configuração de armazenamento**</span><span class="sxs-lookup"><span data-stu-id="d47c3-348">**Storage setup**</span></span>

<span data-ttu-id="d47c3-349">Recomendamos que o cliente ou a tarefa do Gerenciador de trabalho crie os contêineres exigidos pelas tarefas antes de adicionar as tarefas ao trabalho.</span><span class="sxs-lookup"><span data-stu-id="d47c3-349">It is recommended that the client or job manager task create any containers required by tasks before adding the tasks to the job.</span></span> <span data-ttu-id="d47c3-350">Isso será obrigatório se você usar uma URL de contêiner com SAS, pois essa URL não inclui a permissão para criar o contêiner.</span><span class="sxs-lookup"><span data-stu-id="d47c3-350">This is mandatory if you use a container URL with SAS, as such a URL does not include permission to create the container.</span></span> <span data-ttu-id="d47c3-351">Isso é recomendado mesmo se você passar as credenciais da conta de armazenamento, pois libera cada tarefa de precisar chamar CloudBlobContainer.CreateIfNotExistsAsync no contêiner.</span><span class="sxs-lookup"><span data-stu-id="d47c3-351">It is recommended even if you pass storage account credentials, as it saves every task having to call CloudBlobContainer.CreateIfNotExistsAsync on the container.</span></span>

## <a name="pass-parameters-and-environment-variables"></a><span data-ttu-id="d47c3-352">Passar parâmetros e variáveis de ambiente</span><span class="sxs-lookup"><span data-stu-id="d47c3-352">Pass parameters and environment variables</span></span>
### <a name="pass-environment-settings"></a><span data-ttu-id="d47c3-353">Passar configurações de ambiente</span><span class="sxs-lookup"><span data-stu-id="d47c3-353">Pass environment settings</span></span>
<span data-ttu-id="d47c3-354">Um cliente pode passar informações para a tarefa do Gerenciador de trabalho na forma de configurações de ambiente.</span><span class="sxs-lookup"><span data-stu-id="d47c3-354">A client can pass information to the job manager task in the form of environment settings.</span></span> <span data-ttu-id="d47c3-355">Assim, essas informações podem ser usadas pelo Gerenciador de trabalho ao gerar as tarefas do Processador de tarefas que serão executadas como parte do trabalho de computação.</span><span class="sxs-lookup"><span data-stu-id="d47c3-355">This information can then be used by the job manager task when generating the task processor tasks that will run as part of the compute job.</span></span> <span data-ttu-id="d47c3-356">Veja alguns exemplos das informações que você pode passar como configurações de ambiente:</span><span class="sxs-lookup"><span data-stu-id="d47c3-356">Examples of the information that you can pass as environment settings are:</span></span>

* <span data-ttu-id="d47c3-357">Nome da conta de armazenamento e chaves da conta</span><span class="sxs-lookup"><span data-stu-id="d47c3-357">Storage account name and account keys</span></span>
* <span data-ttu-id="d47c3-358">URL da conta do Lote</span><span class="sxs-lookup"><span data-stu-id="d47c3-358">Batch account URL</span></span>
* <span data-ttu-id="d47c3-359">Chave da conta do Lote</span><span class="sxs-lookup"><span data-stu-id="d47c3-359">Batch account key</span></span>

<span data-ttu-id="d47c3-360">O serviço do Lote tem um mecanismo simples para passar configurações de ambiente para uma tarefa do Gerenciador de trabalho usando a propriedade `EnvironmentSettings` em [Microsoft.Azure.Batch.JobManagerTask][net_jobmanagertask].</span><span class="sxs-lookup"><span data-stu-id="d47c3-360">The Batch service has a simple mechanism to pass environment settings to a job manager task by using the `EnvironmentSettings` property in [Microsoft.Azure.Batch.JobManagerTask][net_jobmanagertask].</span></span>

<span data-ttu-id="d47c3-361">Por exemplo, para obter a instância do `BatchClient` para uma conta do Lote, você pode passar a URL e credenciais de chave compartilhadas como variáveis do ambiente a partir do código do cliente para a conta do Lote.</span><span class="sxs-lookup"><span data-stu-id="d47c3-361">For example, to get the `BatchClient` instance for a Batch account, you can pass as environment variables from the client code the URL and shared key credentials for the Batch account.</span></span> <span data-ttu-id="d47c3-362">Da mesma forma, para acessar a conta de armazenamento vinculada à conta do Lote, você pode passar o nome da conta de armazenamento e a chave da conta de armazenamento como variáveis de ambiente.</span><span class="sxs-lookup"><span data-stu-id="d47c3-362">Likewise, to access the storage account that is linked to the Batch account, you can pass the storage account name and the storage account key as environment variables.</span></span>

### <a name="pass-parameters-to-the-job-manager-template"></a><span data-ttu-id="d47c3-363">Passar parâmetros para o modelo do Gerenciador de trabalho</span><span class="sxs-lookup"><span data-stu-id="d47c3-363">Pass parameters to the Job Manager template</span></span>
<span data-ttu-id="d47c3-364">Em muitos casos, é útil passar parâmetros por trabalho para a tarefa de Gerenciador de trabalho, a fim de controlar o processo de divisão de trabalho ou configurar as tarefas do trabalho.</span><span class="sxs-lookup"><span data-stu-id="d47c3-364">In many cases, it's useful to pass per-job parameters to the job manager task, either to control the job splitting process or to configure the tasks for the job.</span></span> <span data-ttu-id="d47c3-365">Faça isso carregando um arquivo JSON chamado parameters.json como um arquivo de recurso para a tarefa do Gerenciador de trabalho.</span><span class="sxs-lookup"><span data-stu-id="d47c3-365">You can do this by uploading a JSON file named parameters.json as a resource file for the job manager task.</span></span> <span data-ttu-id="d47c3-366">Assim, os parâmetros podem ser disponibilizados no campo `JobSplitter._parameters` no modelo do Gerenciador de trabalho.</span><span class="sxs-lookup"><span data-stu-id="d47c3-366">The parameters can then become available in the `JobSplitter._parameters` field in the Job Manager template.</span></span>

> [!NOTE]
> <span data-ttu-id="d47c3-367">O manipulador de parâmetro interno oferece suporte somente aos dicionários de cadeia de caracteres para cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="d47c3-367">The built-in parameter handler supports only string-to-string dictionaries.</span></span> <span data-ttu-id="d47c3-368">Se você quiser passar valores JSON complexos como valores de parâmetro, será necessário passá-los como cadeias de caracteres e analisá-los no divisor de trabalho, ou modificar o método `Configuration.GetJobParameters` do framework.</span><span class="sxs-lookup"><span data-stu-id="d47c3-368">If you want to pass complex JSON values as parameter values, you will need to pass these as strings and parse them in the job splitter, or modify the framework's `Configuration.GetJobParameters` method.</span></span>
> 
> 

### <a name="pass-parameters-to-the-task-processor-template"></a><span data-ttu-id="d47c3-369">Passar parâmetros para o modelo de Processador de tarefas</span><span class="sxs-lookup"><span data-stu-id="d47c3-369">Pass parameters to the Task Processor template</span></span>
<span data-ttu-id="d47c3-370">Você também pode passar parâmetros para tarefas individuais implementadas usando o modelo do Processador de tarefas.</span><span class="sxs-lookup"><span data-stu-id="d47c3-370">You can also pass parameters to individual tasks implemented using the Task Processor template.</span></span> <span data-ttu-id="d47c3-371">Assim como acontece com o modelo do Gerenciador de trabalho, o modelo do Processador de tarefas procura um arquivo de recurso chamado</span><span class="sxs-lookup"><span data-stu-id="d47c3-371">Just as with the job manager template, the task processor template looks for a resource file named</span></span>

<span data-ttu-id="d47c3-372">parameters.json e, se o encontrar, o carrega como o dicionário de parâmetros.</span><span class="sxs-lookup"><span data-stu-id="d47c3-372">parameters.json, and if found it loads it as the parameters dictionary.</span></span> <span data-ttu-id="d47c3-373">Há algumas opções de como passar parâmetros para as tarefas do Processador de tarefa:</span><span class="sxs-lookup"><span data-stu-id="d47c3-373">There are a couple of options for how to pass parameters to the task processor tasks:</span></span>

* <span data-ttu-id="d47c3-374">Reutilize os parâmetros de trabalho JSON.</span><span class="sxs-lookup"><span data-stu-id="d47c3-374">Reuse the job parameters JSON.</span></span> <span data-ttu-id="d47c3-375">Isso funciona bem se os únicos parâmetros forem de todo o trabalho (por exemplo, uma renderização de altura e largura).</span><span class="sxs-lookup"><span data-stu-id="d47c3-375">This works well if the only parameters are job-wide ones (for example, a render height and width).</span></span> <span data-ttu-id="d47c3-376">Para fazer isso, durante a criação de um CloudTask no divisor de trabalho, adicione uma referência ao objeto do arquivo de recurso parameters.json do ResourceFiles da tarefa do Gerenciador de trabalho (`JobSplitter._jobManagerTask.ResourceFiles`) à coleção de ResourceFiles do CloudTask.</span><span class="sxs-lookup"><span data-stu-id="d47c3-376">To do this, when creating a CloudTask in the job splitter, add a reference to the parameters.json resource file object from the job manager task's ResourceFiles (`JobSplitter._jobManagerTask.ResourceFiles`) to the CloudTask's ResourceFiles collection.</span></span>
* <span data-ttu-id="d47c3-377">Gere e carregue um documento parameters.json específico à tarefa como parte da execução do divisor de trabalho, e faça referência a esse blob na coleção de arquivos de recursos da tarefa.</span><span class="sxs-lookup"><span data-stu-id="d47c3-377">Generate and upload a task-specific parameters.json document as part of job splitter execution, and reference that blob in the task's resource files collection.</span></span> <span data-ttu-id="d47c3-378">Isso é necessário se tarefas diferentes tiverem parâmetros diferentes.</span><span class="sxs-lookup"><span data-stu-id="d47c3-378">This is necessary if different tasks have different parameters.</span></span> <span data-ttu-id="d47c3-379">Um exemplo seria um cenário de renderização 3D no qual o índice do quadro é passado para a tarefa como um parâmetro.</span><span class="sxs-lookup"><span data-stu-id="d47c3-379">An example might be a 3D rendering scenario where the frame index is passed to the task as a parameter.</span></span>

> [!NOTE]
> <span data-ttu-id="d47c3-380">O manipulador de parâmetro interno oferece suporte somente aos dicionários de cadeia de caracteres para cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="d47c3-380">The built-in parameter handler supports only string-to-string dictionaries.</span></span> <span data-ttu-id="d47c3-381">Se você quiser passar valores JSON complexos como valores de parâmetro, será necessário passá-los como cadeias de caracteres e analisá-los no Processador de tarefas, ou modificar o método `Configuration.GetTaskParameters` do framework.</span><span class="sxs-lookup"><span data-stu-id="d47c3-381">If you want to pass complex JSON values as parameter values, you will need to pass these as strings and parse them in the task processor, or modify the framework's `Configuration.GetTaskParameters` method.</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="d47c3-382">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="d47c3-382">Next steps</span></span>
### <a name="persist-job-and-task-output-to-azure-storage"></a><span data-ttu-id="d47c3-383">Persistir saída de tarefa e de trabalho no Armazenamento do Azure</span><span class="sxs-lookup"><span data-stu-id="d47c3-383">Persist job and task output to Azure Storage</span></span>
<span data-ttu-id="d47c3-384">Outra ferramenta útil no desenvolvimento de soluções do Lote são as [Convenções de Arquivo do Lote do Azure][nuget_package].</span><span class="sxs-lookup"><span data-stu-id="d47c3-384">Another helpful tool in Batch solution development is [Azure Batch File Conventions][nuget_package].</span></span> <span data-ttu-id="d47c3-385">Use essa biblioteca de classes .NET (em versão de visualização) em seus aplicativos .NET do Lote para armazenar e recuperar com facilidade as saídas de tarefas no Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="d47c3-385">Use this .NET class library (currently in preview) in your Batch .NET applications to easily store and retrieve task outputs to and from Azure Storage.</span></span> <span data-ttu-id="d47c3-386">[Persistir e saída de tarefa e de trabalho do Lote do Azure](batch-task-output.md) contém uma discussão completa sobre a biblioteca e seu uso.</span><span class="sxs-lookup"><span data-stu-id="d47c3-386">[Persist Azure Batch job and task output](batch-task-output.md) contains a full discussion of the library and its usage.</span></span>

### <a name="batch-forum"></a><span data-ttu-id="d47c3-387">Fórum do Lote</span><span class="sxs-lookup"><span data-stu-id="d47c3-387">Batch Forum</span></span>
<span data-ttu-id="d47c3-388">O [Fórum do Lote do Azure][forum] no MSDN é um ótimo lugar para discutir sobre o Lote e fazer perguntas sobre o serviço.</span><span class="sxs-lookup"><span data-stu-id="d47c3-388">The [Azure Batch Forum][forum] on MSDN is a great place to discuss Batch and ask questions about the service.</span></span> <span data-ttu-id="d47c3-389">Acesse diretamente as postagens “fixas” úteis e poste suas dúvidas conforme elas surgirem enquanto você cria suas soluções do Lote.</span><span class="sxs-lookup"><span data-stu-id="d47c3-389">Head on over for helpful "sticky" posts, and post your questions as they arise while you build your Batch solutions.</span></span>

[forum]: https://social.msdn.microsoft.com/forums/azure/en-US/home?forum=azurebatch
[net_jobmanagertask]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.jobmanagertask.aspx
[github_samples]: https://github.com/Azure/azure-batch-samples
[nuget_package]: https://www.nuget.org/packages/Microsoft.Azure.Batch.Conventions.Files
[process_exitcode]: https://msdn.microsoft.com/library/system.diagnostics.process.exitcode.aspx
[vs_gallery]: https://visualstudiogallery.msdn.microsoft.com/
[vs_gallery_templates]: https://go.microsoft.com/fwlink/?linkid=820714
[vs_find_use_ext]: https://msdn.microsoft.com/library/dd293638.aspx

[diagram01]: ./media/batch-visual-studio-templates/diagram01.png
[solution_explorer01]: ./media/batch-visual-studio-templates/solution_explorer01.png
[solution_explorer02]: ./media/batch-visual-studio-templates/solution_explorer02.png
