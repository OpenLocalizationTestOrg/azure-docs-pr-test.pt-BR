---
title: "Monitorar o andamento de um trabalho pela contagem de tarefas por estado – Lote do Azure | Microsoft Docs"
description: "Monitorar o andamento de um trabalho chamando a operação Obter Contagens de Tarefas para contar as tarefas de um trabalho. Você pode obter uma contagem de tarefas ativas, em execução e concluídas e das tarefas que tiveram êxito ou falharam."
services: batch
author: tamram
manager: timlt
ms.service: batch
ms.topic: article
ms.date: 08/02/2017
ms.author: tamram
ms.openlocfilehash: ceff59d7063b60a1344a47489d3d73e0e8ee07df
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/18/2017
---
# <a name="count-tasks-by-state-to-monitor-a-jobs-progress-preview"></a><span data-ttu-id="d29ef-104">Contagem de tarefas por estado para monitorar o andamento de um trabalho (versão prévia)</span><span class="sxs-lookup"><span data-stu-id="d29ef-104">Count tasks by state to monitor a job's progress (Preview)</span></span>

<span data-ttu-id="d29ef-105">O Lote do Azure fornece uma maneira eficiente para monitorar o progresso de um trabalho conforme ele executa suas tarefas.</span><span class="sxs-lookup"><span data-stu-id="d29ef-105">Azure Batch provides an efficient way to monitor the progress of a job as it runs its tasks.</span></span> <span data-ttu-id="d29ef-106">Você pode chamar a operação [Obter Contagens de Tarefas][rest_get_task_counts] para descobrir quantas tarefas estão em um estado ativo, em execução ou concluído e quantas tiveram êxito ou falharam.</span><span class="sxs-lookup"><span data-stu-id="d29ef-106">You can call the [Get Task Counts][rest_get_task_counts] operation to find out how many tasks are in an active, running, or completed state, and how many have succeeded or failed.</span></span> <span data-ttu-id="d29ef-107">Contando o número de tarefas em cada estado, você pode exibir mais facilmente o andamento do trabalho para um usuário ou detectar atrasos inesperados ou falhas que podem afetar o trabalho.</span><span class="sxs-lookup"><span data-stu-id="d29ef-107">By counting the number of tasks in each state, you can more easily display the job's progress to a user, or detect unexpected delays or failures that may affect the job.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="d29ef-108">A operação Obter Contagens de Tarefas está atualmente em versão prévia e ainda não está disponível no Azure Governamental, no Azure China e no Azure Alemanha.</span><span class="sxs-lookup"><span data-stu-id="d29ef-108">The Get Task Counts operation is currently in preview, and is not yet available in Azure Government, Azure China, and Azure Germany.</span></span> 
>
>

## <a name="how-tasks-are-counted"></a><span data-ttu-id="d29ef-109">Como as tarefas são contadas</span><span class="sxs-lookup"><span data-stu-id="d29ef-109">How tasks are counted</span></span>

<span data-ttu-id="d29ef-110">A operação Obter Contagens de Tarefas conta tarefas por estado, da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="d29ef-110">The Get Task Counts operation counts tasks by state, as follows:</span></span>

- <span data-ttu-id="d29ef-111">Uma tarefa é contabilizada como **ativa** quando está na fila e é capaz de executar, mas não está atualmente atribuída a um nó de computação.</span><span class="sxs-lookup"><span data-stu-id="d29ef-111">A task is counted as **active** when it is queued and able to run, but is not currently assigned to a compute node.</span></span> <span data-ttu-id="d29ef-112">Uma tarefa também é contada como **ativa** se depende de uma tarefa pai que ainda não foi concluída.</span><span class="sxs-lookup"><span data-stu-id="d29ef-112">A task is also counted as **active** if it is dependent on a parent task that has not yet completed.</span></span> <span data-ttu-id="d29ef-113">Para obter mais informações sobre dependências de tarefas, consulte [Criar dependências de tarefas para executar tarefas que dependem de outras tarefas](batch-task-dependencies.md).</span><span class="sxs-lookup"><span data-stu-id="d29ef-113">For more information on task dependencies, see [Create task dependencies to run tasks that depend on other tasks](batch-task-dependencies.md).</span></span> 
- <span data-ttu-id="d29ef-114">Uma tarefa é contabilizada como **executando** quando foi atribuída a um nó de computação, mas ainda não foi concluída.</span><span class="sxs-lookup"><span data-stu-id="d29ef-114">A task is counted as **running** when it has been assigned to a compute node, but has not yet completed.</span></span> <span data-ttu-id="d29ef-115">Uma tarefa é contabilizada como **executando** quando seu estado é `preparing` ou `running`, conforme indicado pela operação [Obter informações sobre uma tarefa][rest_get_task].</span><span class="sxs-lookup"><span data-stu-id="d29ef-115">A task is counted as **running** when its state is either `preparing` or `running`, as indicated by the [Get information about a task][rest_get_task] operation.</span></span>
- <span data-ttu-id="d29ef-116">Uma tarefa é contabilizada como **concluída** quando não está mais qualificada para executar.</span><span class="sxs-lookup"><span data-stu-id="d29ef-116">A task is counted as **completed** when it is no longer eligible to run.</span></span> <span data-ttu-id="d29ef-117">Uma tarefa contabilizada como **concluída** normalmente foi concluída com êxito ou foi concluída sem êxito e também esgotou o seu limite de repetições.</span><span class="sxs-lookup"><span data-stu-id="d29ef-117">A task counted as **completed** has typically either finished successfully, or has finished unsuccessfully and has also exhausted its retry limit.</span></span> 

<span data-ttu-id="d29ef-118">A operação Obter Contagens de Tarefas também informa quantas tarefas tiveram êxito ou falharam.</span><span class="sxs-lookup"><span data-stu-id="d29ef-118">The Get Task Counts operation also reports how many tasks have succeeded or failed.</span></span> <span data-ttu-id="d29ef-119">O Lote determina se uma tarefa teve êxito ou falhou ao verificar a propriedade **result** da propriedade [executionInfo] [https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-task#executionInfo]:</span><span class="sxs-lookup"><span data-stu-id="d29ef-119">Batch determines whether a task has succeeded or failed by checking the **result** property of the [executionInfo][https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-task#executionInfo] property:</span></span>

    - <span data-ttu-id="d29ef-120">Uma tarefa será contabilizada como **bem-sucedida** se o resultado da execução da tarefa for `success`.</span><span class="sxs-lookup"><span data-stu-id="d29ef-120">A task is counted as **succeeded** if the result of task execution is `success`.</span></span>
    - <span data-ttu-id="d29ef-121">Uma tarefa será contabilizada como **com falha** se o resultado da execução da tarefa for `failure`.</span><span class="sxs-lookup"><span data-stu-id="d29ef-121">A task is counted as **failed** if the result of task execution is `failure`.</span></span>

<span data-ttu-id="d29ef-122">Para obter mais informações sobre estados de tarefa, consulte [Obter informações sobre uma tarefa][rest_get_task].</span><span class="sxs-lookup"><span data-stu-id="d29ef-122">For more information about task states, see [Get information about a task][rest_get_task].</span></span>

<span data-ttu-id="d29ef-123">O exemplo de código .NET a seguir mostra como recuperar contagens de tarefas por estado:</span><span class="sxs-lookup"><span data-stu-id="d29ef-123">The following .NET code sample shows how to retrieve task counts by state:</span></span> 

```csharp
var taskCounts = await batchClient.JobOperations.GetTaskCountsAsync("job-1");

Console.WriteLine("Task count in active state: {0}", taskCounts.Active);
Console.WriteLine("Task count in preparing or running state: {0}", taskCounts.Running);
Console.WriteLine("Task count in completed state: {0}", taskCounts.Completed);
Console.WriteLine("Succeeded task count: {0}", taskCounts.Succeeded);
Console.WriteLine("Failed task count: {0}", taskCounts.Failed);
Console.WriteLine("ValidationStatus: {0}", taskCounts.ValidationStatus);
```

> [!NOTE]
> <span data-ttu-id="d29ef-124">Você pode usar um padrão semelhante para REST e outras linguagens com suporte para obter as contagens de tarefa para um trabalho.</span><span class="sxs-lookup"><span data-stu-id="d29ef-124">You can use a similar pattern for REST and other supported languages to get task counts for a job.</span></span> 
> 
> 

## <a name="consistency-checking-for-task-counts"></a><span data-ttu-id="d29ef-125">Verificação de consistência para contagens de tarefas</span><span class="sxs-lookup"><span data-stu-id="d29ef-125">Consistency checking for task counts</span></span>

<span data-ttu-id="d29ef-126">O serviço de Lote agrega as contagens de tarefa ao coletar dados de várias partes de um sistema distribuído assíncrono.</span><span class="sxs-lookup"><span data-stu-id="d29ef-126">The Batch service aggregates task counts by gathering data from multiple parts of an asynchronous distributed system.</span></span> <span data-ttu-id="d29ef-127">Para garantir que as contagens de tarefa estão corretas, o Lote fornece validação adicional para contagens de estado executando verificações de consistência em vários componentes do sistema.</span><span class="sxs-lookup"><span data-stu-id="d29ef-127">To ensure that task counts are correct, Batch provides additional validation for state counts by performing consistency checks against multiple components of the system.</span></span> <span data-ttu-id="d29ef-128">O Lote executa essas verificações de consistência, como há menos de 200.000 tarefas no trabalho.</span><span class="sxs-lookup"><span data-stu-id="d29ef-128">Batch performs these consistency checks as long as there are fewer than 200,000 tasks in the job.</span></span> <span data-ttu-id="d29ef-129">No evento improvável de a verificação de consistência encontrar erros, o Lote corrige o resultado da operação de obter contagens de tarefas com base nos resultados da verificação de consistência.</span><span class="sxs-lookup"><span data-stu-id="d29ef-129">In the unlikely event that the consistency check finds errors, Batch corrects the result of the Get Tasks Counts operation based on the results of the consistency check.</span></span> <span data-ttu-id="d29ef-130">A verificação de consistência é uma medida extra para garantir que os clientes que utilizam a operação Obter Contagens de Tarefas obtenham as informações corretas de que precisam para a solução deles.</span><span class="sxs-lookup"><span data-stu-id="d29ef-130">The consistency check is an extra measure to ensure that customers who rely on the Get Task Counts operation get the right information they need for their solution.</span></span>

<span data-ttu-id="d29ef-131">A propriedade **validationStatus** na resposta indica se o Lote executou a verificação de consistência.</span><span class="sxs-lookup"><span data-stu-id="d29ef-131">The **validationStatus** property in the response indicates whether Batch has performed the consistency check.</span></span> <span data-ttu-id="d29ef-132">Se o lote não é capaz de verificar contagens de estado contra os estados reais mantidos no sistema, a propriedade **validationStatus** é definida como `unvalidated`.</span><span class="sxs-lookup"><span data-stu-id="d29ef-132">If Batch has not been able to check state counts against the actual states held in the system, then the **validationStatus** property is set to `unvalidated`.</span></span> <span data-ttu-id="d29ef-133">Por motivos de desempenho, o Lote não executará a verificação de consistência se o trabalho inclui mais de 200.000 tarefas; portanto, a propriedade **validationStatus** pode ser definida como `unvalidated` nesse caso.</span><span class="sxs-lookup"><span data-stu-id="d29ef-133">For performance reasons, Batch will not perform the consistency check if the job includes more than 200,000 tasks, so the **validationStatus** property may be set to `unvalidated` in this case.</span></span> <span data-ttu-id="d29ef-134">No entanto, a contagem de tarefas não é necessariamente errada nesse caso, pois até mesmo uma perda de dados muito limitada é muito improvável.</span><span class="sxs-lookup"><span data-stu-id="d29ef-134">However, the task count is not necessarily wrong in this case, as even a very limited data loss is highly unlikely.</span></span> 

<span data-ttu-id="d29ef-135">Quando uma tarefa muda de estado, o pipeline de agregação processa a alteração dentro de alguns segundos.</span><span class="sxs-lookup"><span data-stu-id="d29ef-135">When a task changes state, the aggregation pipeline processes the change within few seconds.</span></span> <span data-ttu-id="d29ef-136">A operação Obter Contagens de Tarefas reflete as contagens de tarefas atualizadas dentro desse período.</span><span class="sxs-lookup"><span data-stu-id="d29ef-136">The Get Task Counts operation reflects the updated task counts within that period.</span></span> <span data-ttu-id="d29ef-137">No entanto, se o pipeline de agregação perder uma alteração em um estado de tarefa, essa alteração não será registrada até a próxima passagem de validação.</span><span class="sxs-lookup"><span data-stu-id="d29ef-137">However, if the aggregation pipeline misses a change in a task state, then that change is not registered until the next validation pass.</span></span> <span data-ttu-id="d29ef-138">Durante esse tempo, contagens de tarefa podem ser ligeiramente imprecisas devido ao evento perdido, mas elas serão corrigidas na próxima passagem de validação.</span><span class="sxs-lookup"><span data-stu-id="d29ef-138">During this time, task counts may be slightly inaccurate due to the missed event, but they are corrected on the next validation pass.</span></span>

## <a name="best-practices-for-counting-a-jobs-tasks"></a><span data-ttu-id="d29ef-139">Melhores práticas para contagem de tarefas de um trabalho</span><span class="sxs-lookup"><span data-stu-id="d29ef-139">Best practices for counting a job's tasks</span></span>

<span data-ttu-id="d29ef-140">Chamar a operação Obter Contagens de Tarefas é a maneira mais eficiente para retornar uma contagem básica das tarefas de um trabalho por estado.</span><span class="sxs-lookup"><span data-stu-id="d29ef-140">Calling the Get Task Counts operation is the most efficient way to return a basic count of a job's tasks by state.</span></span> <span data-ttu-id="d29ef-141">Se você estiver usando a versão 2017-06-01.5.1 do serviço de Lote, é recomendável escrever ou atualizar o código para usar Obter Contagens de Tarefas.</span><span class="sxs-lookup"><span data-stu-id="d29ef-141">If you are using Batch service version 2017-06-01.5.1, we recommend writing or updating your code to use Get Task Counts.</span></span>

<span data-ttu-id="d29ef-142">A operação obter contagens de tarefa não está disponível em versões do serviço de Lote anteriores a 2017-06-01.5.1.</span><span class="sxs-lookup"><span data-stu-id="d29ef-142">The Get Task Counts operation is not available in Batch service versions earlier than 2017-06-01.5.1.</span></span> <span data-ttu-id="d29ef-143">Se você estiver usando uma versão mais antiga do serviço, use uma consulta de lista para contar tarefas em um trabalho em vez disso.</span><span class="sxs-lookup"><span data-stu-id="d29ef-143">If you are using an older version of the service, then use a list query to count tasks in a job instead.</span></span> <span data-ttu-id="d29ef-144">Para obter mais informações, consulte [Criar consultas para listar recursos do Lote com eficiência](batch-efficient-list-queries.md).</span><span class="sxs-lookup"><span data-stu-id="d29ef-144">For more information, see [Create queries to list Batch resources efficiently](batch-efficient-list-queries.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="d29ef-145">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="d29ef-145">Next steps</span></span>

* <span data-ttu-id="d29ef-146">Veja a [visão geral dos recursos do Lote](batch-api-basics.md) para saber mais sobre os conceitos e os recursos do serviço do Lote.</span><span class="sxs-lookup"><span data-stu-id="d29ef-146">See the [Batch feature overview](batch-api-basics.md) to learn more about Batch service concepts and features.</span></span> <span data-ttu-id="d29ef-147">O artigo aborda os recursos principais do Lote, como pools, nós de computação, trabalhos e tarefas, e fornece uma visão geral dos recursos do serviço.</span><span class="sxs-lookup"><span data-stu-id="d29ef-147">The article discusses the primary Batch resources such as pools, compute nodes, jobs, and tasks, and provides an overview of the service's features.</span></span>
* <span data-ttu-id="d29ef-148">Obtenha as noções básicas sobre o desenvolvimento de um aplicativo habilitado para o Lote usando a [biblioteca de cliente .NET do Lote](batch-dotnet-get-started.md) ou do [Python](batch-python-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="d29ef-148">Learn the basics of developing a Batch-enabled application using the [Batch .NET client library](batch-dotnet-get-started.md) or [Python](batch-python-tutorial.md).</span></span> <span data-ttu-id="d29ef-149">O artigo introdutório orienta você por meio de um aplicativo de trabalho que usa o serviço em Lotes para executar uma carga de trabalho em vários nós de computação.</span><span class="sxs-lookup"><span data-stu-id="d29ef-149">These introductory articles guide you through a working application that uses the Batch service to execute a workload on multiple compute nodes.</span></span>


[rest_get_task_counts]: https://docs.microsoft.com/rest/api/batchservice/get-the-task-counts-for-a-job
[rest_get_task]: https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-task
[rest_list_tasks]: https://docs.microsoft.com/rest/api/batchservice/list-the-tasks-associated-with-a-job
