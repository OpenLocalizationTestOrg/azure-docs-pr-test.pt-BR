---
title: "Depurando um serviço de nuvem ou uma máquina virtual do Azure no Visual Studio | Microsoft Docs"
description: "Depuração de um Serviço de Nuvem ou Máquina Virtual no Visual Studio"
services: visual-studio-online
documentationcenter: na
author: kraigb
manager: ghogen
editor: 
ms.assetid: 945e06e0-2100-41af-b218-72347367ddab
ms.service: visual-studio-online
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: multiple
ms.workload: na
ms.date: 11/11/2016
ms.author: kraigb
ms.openlocfilehash: 2ea3a9d6b3bdd873c139064b3c400eff5977eda4
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/29/2017
---
# <a name="debugging-an-azure-cloud-service-or-virtual-machine-in-visual-studio"></a><span data-ttu-id="22bad-103">Depurando um serviço de nuvem ou máquina virtual do Azure no Visual Studio</span><span class="sxs-lookup"><span data-stu-id="22bad-103">Debugging an Azure cloud service or virtual machine in Visual Studio</span></span>
<span data-ttu-id="22bad-104">O Visual Studio oferece a você opções diferentes de depuração dos serviços de nuvem e das máquinas virtuais do Azure.</span><span class="sxs-lookup"><span data-stu-id="22bad-104">Visual Studio gives you different options for debugging Azure cloud services and virtual machines.</span></span>

## <a name="debug-your-cloud-service-on-your-local-computer"></a><span data-ttu-id="22bad-105">Depurar o serviço de nuvem no computador local</span><span class="sxs-lookup"><span data-stu-id="22bad-105">Debug your cloud service on your local computer</span></span>
<span data-ttu-id="22bad-106">Você pode economizar tempo e dinheiro usando o emulador de computação para depurar o serviço de nuvem em um computador local.</span><span class="sxs-lookup"><span data-stu-id="22bad-106">You can save time and money by using the Azure compute emulator to debug your cloud service on a local machine.</span></span> <span data-ttu-id="22bad-107">Ao depurar um serviço localmente antes de implantá-lo, você pode aprimorar a confiabilidade e o desempenho sem pagar pelo tempo de computação.</span><span class="sxs-lookup"><span data-stu-id="22bad-107">By debugging a service locally before you deploy it, you can improve reliability and performance without paying for compute time.</span></span> <span data-ttu-id="22bad-108">No entanto, alguns erros podem ocorrer somente quando você executa um serviço de nuvem no Azure em si.</span><span class="sxs-lookup"><span data-stu-id="22bad-108">However, some errors might occur only when you run a cloud service in Azure itself.</span></span> <span data-ttu-id="22bad-109">Você poderá depurar esses erros se habilitar a depuração remota quando publica o serviço e depois anexar o depurador a uma instância de função.</span><span class="sxs-lookup"><span data-stu-id="22bad-109">You can debug these errors if you enable remote debugging when you publish your service and then attach the debugger to a role instance.</span></span>

<span data-ttu-id="22bad-110">O emulador simula o serviço de computação do Azure e o executa no ambiente local para que você possa testar e depurar o serviço de nuvem antes de implantá-lo.</span><span class="sxs-lookup"><span data-stu-id="22bad-110">The emulator simulates the Azure Compute service and runs in your local environment so that you can test and debug your cloud service before you deploy it.</span></span> <span data-ttu-id="22bad-111">O emulador trata o ciclo de vida das instâncias de função e fornece acesso a recursos simulados, como armazenamento local.</span><span class="sxs-lookup"><span data-stu-id="22bad-111">The emulator handles the lifecycle of your role instances and provides access to simulated resources, such as local storage.</span></span> <span data-ttu-id="22bad-112">Quando você depura ou executa seu serviço no Visual Studio, ele inicia automaticamente o emulador como um aplicativo em segundo plano e, em seguida, implanta o serviço para o emulador.</span><span class="sxs-lookup"><span data-stu-id="22bad-112">When you debug or run your service from Visual Studio, it automatically starts the emulator as a background application and then deploys your service to the emulator.</span></span> <span data-ttu-id="22bad-113">É possível usar o emulador para exibir o serviço quando ele é executado no ambiente local.</span><span class="sxs-lookup"><span data-stu-id="22bad-113">You can use the emulator to view your service when it runs in the local environment.</span></span> <span data-ttu-id="22bad-114">Você pode executar a versão completa ou a versão expressa do emulador.</span><span class="sxs-lookup"><span data-stu-id="22bad-114">You can run the full version or the express version of the emulator.</span></span> <span data-ttu-id="22bad-115">(A partir do Azure 2.3, a versão expressa do emulador é o padrão). Consulte [Usando o Emulator Expresso para executar e depurar um serviço de nuvem localmente](https://msdn.microsoft.com/library/dn339018.aspx).</span><span class="sxs-lookup"><span data-stu-id="22bad-115">(Starting with Azure 2.3, the express version of the emulator is the default.) See [Using Emulator Express to Run and Debug a Cloud Service Locally](https://msdn.microsoft.com/library/dn339018.aspx).</span></span>

### <a name="to-debug-your-cloud-service-on-your-local-computer"></a><span data-ttu-id="22bad-116">Para depurar o serviço de nuvem no computador local</span><span class="sxs-lookup"><span data-stu-id="22bad-116">To debug your cloud service on your local computer</span></span>
1. <span data-ttu-id="22bad-117">Na barra de menus, escolha **Depurar**, **Iniciar Depuração** para executar o projeto de serviço de nuvem do Azure.</span><span class="sxs-lookup"><span data-stu-id="22bad-117">On the menu bar, choose **Debug**, **Start Debugging** to run your Azure cloud service project.</span></span> <span data-ttu-id="22bad-118">Como alternativa, você pode pressionar F5.</span><span class="sxs-lookup"><span data-stu-id="22bad-118">As an alternative, you can press F5.</span></span> <span data-ttu-id="22bad-119">Será exibida uma mensagem informando que o Emulador de Computação está sendo iniciado.</span><span class="sxs-lookup"><span data-stu-id="22bad-119">You’ll see a message that the Compute Emulator is starting.</span></span> <span data-ttu-id="22bad-120">Quando o emulador é iniciado, o ícone da bandeja do sistema o confirma.</span><span class="sxs-lookup"><span data-stu-id="22bad-120">When the emulator starts, the system tray icon confirms it.</span></span>

    ![Emulador do Azure na bandeja do sistema](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC783828.png)
2. <span data-ttu-id="22bad-122">Exiba a interface do usuário do emulador de computação abrindo o menu de atalho do ícone do Azure na área de notificação e selecione **Mostrar Interface do Usuário do Emulador de Computação**.</span><span class="sxs-lookup"><span data-stu-id="22bad-122">Display the user interface for the compute emulator by opening the shortcut menu for the Azure icon in the notification area, and then select **Show Compute Emulator UI**.</span></span>

    <span data-ttu-id="22bad-123">O painel esquerdo da IU usuário mostra os serviços que estão implantados no momento no emulador de computação e as instâncias de função que cada serviço está executando.</span><span class="sxs-lookup"><span data-stu-id="22bad-123">The left pane of the UI shows the services that are currently deployed to the compute emulator and the role instances that each service is running.</span></span> <span data-ttu-id="22bad-124">É possível escolher o serviço ou as funções para exibir o ciclo de vida, o registro em log e as informações de diagnóstico no painel direito.</span><span class="sxs-lookup"><span data-stu-id="22bad-124">You can choose the service or roles to display lifecycle, logging, and diagnostic information in the right pane.</span></span> <span data-ttu-id="22bad-125">Se você colocar o foco na margem superior de uma janela incluída, ela se expandirá, preenchendo o painel direito.</span><span class="sxs-lookup"><span data-stu-id="22bad-125">If you put the focus in the top margin of an included window, it expands to fill the right pane.</span></span>
3. <span data-ttu-id="22bad-126">Percorra o aplicativo selecionando os comandos no menu **Depurar** e definindo pontos de interrupção no código.</span><span class="sxs-lookup"><span data-stu-id="22bad-126">Step through the application by selecting commands on the **Debug** menu and setting breakpoints in your code.</span></span> <span data-ttu-id="22bad-127">À medida que você percorre o aplicativo no depurador, os painéis são atualizados com o status atual do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="22bad-127">As you step through the application in the debugger, the panes are updated with the current status of the application.</span></span> <span data-ttu-id="22bad-128">Quando você interrompe a depuração, a implantação do aplicativo é excluída.</span><span class="sxs-lookup"><span data-stu-id="22bad-128">When you stop debugging, the application deployment is deleted.</span></span> <span data-ttu-id="22bad-129">Se seu aplicativo incluir uma função Web e você tiver definido a propriedade de ação de Inicialização para iniciar o navegador da Web, o Visual Studio iniciará o aplicativo Web no navegador.</span><span class="sxs-lookup"><span data-stu-id="22bad-129">If your application includes a web role and you've set the Startup action property to start the web browser, Visual Studio starts your web application in the browser.</span></span> <span data-ttu-id="22bad-130">Se você alterar o número de instâncias de uma função na configuração do serviço, deverá parar o serviço de nuvem e reiniciar a depuração de modo que você pode depurar essas novas instâncias da função.</span><span class="sxs-lookup"><span data-stu-id="22bad-130">If you change the number of instances of a role in the service configuration, you must stop your cloud service and then restart debugging so that you can debug these new instances of the role.</span></span>

    <span data-ttu-id="22bad-131">**Observação:** quando você interrompe a execução ou a depuração do serviço, o emulador de computação local e o emulador de armazenamento não são interrompidos.</span><span class="sxs-lookup"><span data-stu-id="22bad-131">**Note:** When you stop running or debugging your service, the local compute emulator and storage emulator aren't stopped.</span></span> <span data-ttu-id="22bad-132">Também é preciso pará-los explicitamente na área de notificação.</span><span class="sxs-lookup"><span data-stu-id="22bad-132">You must stop them explicitly from the notification area.</span></span>

## <a name="debug-a-cloud-service-in-azure"></a><span data-ttu-id="22bad-133">Depurar um perfil de serviço de nuvem no Azure</span><span class="sxs-lookup"><span data-stu-id="22bad-133">Debug a cloud service in Azure</span></span>
<span data-ttu-id="22bad-134">Para depurar um serviço de nuvem em um computador remoto, você deve habilitar essa funcionalidade explicitamente quando implanta o serviço de nuvem para que os serviços exigidos (msvsmon.exe, por exemplo) sejam instalados nas máquinas virtuais que executam suas instâncias de função.</span><span class="sxs-lookup"><span data-stu-id="22bad-134">To debug a cloud service from a remote machine, you must enable that functionality explicitly when you deploy your cloud service so that required services (msvsmon.exe, for example) are installed on the virtual machines that run your role instances.</span></span> <span data-ttu-id="22bad-135">Se você não habilitou a depuração remota quando publicou o serviço, será preciso publicar novamente o serviço com a depuração remota habilitada.</span><span class="sxs-lookup"><span data-stu-id="22bad-135">If you didn't enable remote debugging when you published the service, you have to republish the service with remote debugging enabled.</span></span>

<span data-ttu-id="22bad-136">Se você habilitar a depuração remota para um serviço de nuvem, ela não mostrará degradação de desempenho nem incorrerá em cobranças adicionais.</span><span class="sxs-lookup"><span data-stu-id="22bad-136">If you enable remote debugging for a cloud service, it doesn't exhibit degraded performance or incur additional charges.</span></span> <span data-ttu-id="22bad-137">Você não deve usar a depuração remota em um serviço de produção, pois os clientes que usam o serviço podem ser negativamente afetados.</span><span class="sxs-lookup"><span data-stu-id="22bad-137">You shouldn't use remote debugging on a production service, because clients who use the service might be adversely affected.</span></span>

> [!NOTE]
> <span data-ttu-id="22bad-138">Ao publicar um serviço de nuvem no Visual Studio, você pode habilitar o **IntelliTrace** para qualquer função nesse serviço que se destine ao .NET Framework 4 ou .NET Framework 4.5.</span><span class="sxs-lookup"><span data-stu-id="22bad-138">When you publish a cloud service from Visual Studio, you can enable **IntelliTrace** for any roles in that service that target the .NET Framework 4 or the .NET Framework 4.5.</span></span> <span data-ttu-id="22bad-139">Usando o **IntelliTrace**, você pode examinar os eventos que ocorreram em uma instância de função no passado e reproduzir o contexto no tempo em que ocorreu.</span><span class="sxs-lookup"><span data-stu-id="22bad-139">By using **IntelliTrace**, you can examine events that occurred in a role instance in the past and reproduce the context from that time.</span></span> <span data-ttu-id="22bad-140">Consulte [Depurando um serviço de nuvem publicado com o IntelliTrace e o Visual Studio](http://go.microsoft.com/fwlink/?LinkID=623016) e [Usando o IntelliTrace](https://msdn.microsoft.com/library/dd264915.aspx).</span><span class="sxs-lookup"><span data-stu-id="22bad-140">See [Debugging a published cloud service with IntelliTrace and Visual Studio](http://go.microsoft.com/fwlink/?LinkID=623016) and [Using IntelliTrace](https://msdn.microsoft.com/library/dd264915.aspx).</span></span>
>
>

### <a name="to-enable-remote-debugging-for-a-cloud-service"></a><span data-ttu-id="22bad-141">Para habilitar a depuração remota para um serviço de nuvem</span><span class="sxs-lookup"><span data-stu-id="22bad-141">To enable remote debugging for a cloud service</span></span>
1. <span data-ttu-id="22bad-142">Abra o menu de atalho do projeto do Azure e selecione **Publicar**.</span><span class="sxs-lookup"><span data-stu-id="22bad-142">Open the shortcut menu for the Azure project, and then select **Publish**.</span></span>
2. <span data-ttu-id="22bad-143">Selecione o ambiente de **Preparo** e a configuração de **Depuração**.</span><span class="sxs-lookup"><span data-stu-id="22bad-143">Select the **Staging** environment and the **Debug** configuration.</span></span>

    <span data-ttu-id="22bad-144">Isso é apenas uma diretriz.</span><span class="sxs-lookup"><span data-stu-id="22bad-144">This is only a guideline.</span></span> <span data-ttu-id="22bad-145">Você pode optar por executar ambientes de teste em um ambiente de Produção.</span><span class="sxs-lookup"><span data-stu-id="22bad-145">You can opt to run your test environments in a Production environment.</span></span> <span data-ttu-id="22bad-146">No entanto, você poderá afetar negativamente os usuários ao habilitar a depuração remota no ambiente de Produção.</span><span class="sxs-lookup"><span data-stu-id="22bad-146">However, you may adversely affect users if you enable remote debugging on the Production environment.</span></span> <span data-ttu-id="22bad-147">É possível escolher a configuração de Versão, mas a configuração de Depuração facilita a depuração.</span><span class="sxs-lookup"><span data-stu-id="22bad-147">You can choose the Release configuration, but the Debug configuration makes debugging easier.</span></span>

    ![Escolher a configuração de Depuração](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746717.gif)
3. <span data-ttu-id="22bad-149">Siga as etapas comuns, mas marque a caixa de seleção **Habilitar depurador remoto para todas as funções** na guia **Configurações Avançadas**.</span><span class="sxs-lookup"><span data-stu-id="22bad-149">Follow the usual steps, but select the **Enable Remote Debugger for all roles** check box on the **Advanced Settings** tab.</span></span>

    ![Configuração de Depuração](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746718.gif)

### <a name="to-attach-the-debugger-to-a-cloud-service-in-azure"></a><span data-ttu-id="22bad-151">Para anexar o depurador a um serviço de nuvem no Azure</span><span class="sxs-lookup"><span data-stu-id="22bad-151">To attach the debugger to a cloud service in Azure</span></span>
1. <span data-ttu-id="22bad-152">No Gerenciador de Servidores, expanda o nó do seu serviço de nuvem.</span><span class="sxs-lookup"><span data-stu-id="22bad-152">In Server Explorer, expand the node for your cloud service.</span></span>
2. <span data-ttu-id="22bad-153">Abra o menu de atalho da função ou da instância de função à qual você deseja anexar e selecione **Anexar Depurador**.</span><span class="sxs-lookup"><span data-stu-id="22bad-153">Open the shortcut menu for the role or role instance to which you want to attach, and then select **Attach Debugger**.</span></span>

    <span data-ttu-id="22bad-154">Se você depurar uma função, o depurador do Visual Studio anexará a cada instância dessa função.</span><span class="sxs-lookup"><span data-stu-id="22bad-154">If you debug a role, the Visual Studio debugger attaches to each instance of that role.</span></span> <span data-ttu-id="22bad-155">O depurador será interrompido em um ponto de interrupção da primeira instância de função que executa essa linha de código e atende a todas as condições desse ponto de interrupção.</span><span class="sxs-lookup"><span data-stu-id="22bad-155">The debugger will break on a breakpoint for the first role instance that runs that line of code and meets any conditions of that breakpoint.</span></span> <span data-ttu-id="22bad-156">Se você depurar uma instância, o depurador será anexado apenas a essa instância e interrompido em um ponto de interrupção somente quando essa instância específica executar essa linha de código e atender às condições do ponto de interrupção.</span><span class="sxs-lookup"><span data-stu-id="22bad-156">If you debug an instance, the debugger attaches to only that instance and breaks on a breakpoint only when that specific instance runs that line of code and meets the breakpoint's conditions.</span></span>

    ![Anexar Depurador](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746719.gif)
3. <span data-ttu-id="22bad-158">Depois que o depurador é anexado a uma instância, a depuração ocorre como de costume.</span><span class="sxs-lookup"><span data-stu-id="22bad-158">After the debugger attaches to an instance, debug as usual.</span></span> <span data-ttu-id="22bad-159">O depurador é anexado automaticamente ao processo de host apropriado para sua função.</span><span class="sxs-lookup"><span data-stu-id="22bad-159">The debugger automatically attaches to the appropriate host process for your role.</span></span> <span data-ttu-id="22bad-160">Dependo da função, o depurador será anexado a w3wp.exe, a WaWorkerHost.exe ou a WaIISHost.exe.</span><span class="sxs-lookup"><span data-stu-id="22bad-160">Depending on what the role is, the debugger attaches to w3wp.exe, WaWorkerHost.exe, or WaIISHost.exe.</span></span> <span data-ttu-id="22bad-161">Para verificar o processo ao qual o depurador é anexado, expanda o nó da instância no Gerenciador de Servidores.</span><span class="sxs-lookup"><span data-stu-id="22bad-161">To verify the process to which the debugger is attached, expand the instance node in Server Explorer.</span></span> <span data-ttu-id="22bad-162">Consulte [Arquitetura de função do Azure](http://blogs.msdn.com/b/kwill/archive/2011/05/05/windows-azure-role-architecture.aspx) para obter mais informações sobre os processos do Azure.</span><span class="sxs-lookup"><span data-stu-id="22bad-162">See [Azure Role Architecture](http://blogs.msdn.com/b/kwill/archive/2011/05/05/windows-azure-role-architecture.aspx) for more information about Azure processes.</span></span>

    ![Caixa de diálogo Selecionar tipo de código](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC718346.png)
4. <span data-ttu-id="22bad-164">Para identificar os processos aos quais o depurador é anexado, abra a caixa de diálogo Processos escolhendo, na barra de menus, Depurar, Windows, Processos.</span><span class="sxs-lookup"><span data-stu-id="22bad-164">To identify the processes to which the debugger is attached, open the Processes dialog box by, on the menu bar, choosing Debug, Windows, Processes.</span></span> <span data-ttu-id="22bad-165">(Teclado: Ctrl+Alt+Z) Para desanexar um processo específico, abra o menu de atalho correspondente e clique em **Desanexar Processo**.</span><span class="sxs-lookup"><span data-stu-id="22bad-165">(Keyboard: Ctrl+Alt+Z)To detach a specific process, open its shortcut menu, and then select **Detach Process**.</span></span> <span data-ttu-id="22bad-166">Se preferir, localize o nó da instância no Gerenciador de Servidores, encontre o processo, abra o respectivo menu de atalho e clique em **Desanexar Processo**.</span><span class="sxs-lookup"><span data-stu-id="22bad-166">Or, locate the instance node in Server Explorer, find the process, open its shortcut menu, and then select **Detach Process**.</span></span>

    ![Processos de depuração](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC690787.gif)

> [!WARNING]
> <span data-ttu-id="22bad-168">Evite paradas longas em pontos de interrupção durante a depuração remota.</span><span class="sxs-lookup"><span data-stu-id="22bad-168">Avoid long stops at breakpoints when remote debugging.</span></span> <span data-ttu-id="22bad-169">O Azure trata um processo que foi interrompido por um pouco mais de alguns minutos como sem resposta e para de enviar tráfego para essa instância.</span><span class="sxs-lookup"><span data-stu-id="22bad-169">Azure treats a process that's stopped for longer than a few minutes as unresponsive and stops sending traffic to that instance.</span></span> <span data-ttu-id="22bad-170">Se você parar por muito tempo, o msvsmon.exe será desanexado do processo.</span><span class="sxs-lookup"><span data-stu-id="22bad-170">If you stop for too long, msvsmon.exe detaches from the process.</span></span>
>
>

<span data-ttu-id="22bad-171">Para desanexar o depurador de todos os processos em sua instância ou função, abra o menu de atalho da função ou instância que você está depurando e selecione **Desanexar Depurador**.</span><span class="sxs-lookup"><span data-stu-id="22bad-171">To detach the debugger from all processes in your instance or role, open the shortcut menu for the role or instance that you're debugging, and then select **Detach Debugger**.</span></span>

## <a name="limitations-of-remote-debugging-in-azure"></a><span data-ttu-id="22bad-172">Limitações da depuração remota no Azure</span><span class="sxs-lookup"><span data-stu-id="22bad-172">Limitations of remote debugging in Azure</span></span>
<span data-ttu-id="22bad-173">No SDK 2.3 do Azure, a depuração remota tem as limitações a seguir.</span><span class="sxs-lookup"><span data-stu-id="22bad-173">From Azure SDK 2.3, remote debugging has the following limitations.</span></span>

* <span data-ttu-id="22bad-174">Com a depuração remota habilitada, você não pode publicar um serviço de nuvem no qual qualquer função tenha mais de 25 instâncias.</span><span class="sxs-lookup"><span data-stu-id="22bad-174">With remote debugging enabled, you can't publish a cloud service in which any role has more than 25 instances.</span></span>
* <span data-ttu-id="22bad-175">O depurador usa as portas 30400 a 30424, 31400 a 31424 e 32400 a 32424.</span><span class="sxs-lookup"><span data-stu-id="22bad-175">The debugger uses ports 30400 to 30424, 31400 to 31424 and 32400 to 32424.</span></span> <span data-ttu-id="22bad-176">Se você tentar usar algumas delas, não será possível publicar o serviço e uma das seguintes mensagens de erro aparecerá no log de atividades do Azure:</span><span class="sxs-lookup"><span data-stu-id="22bad-176">If you try to use any of these ports, you won't be able to publish your service, and one of the following error messages will appear in the activity log for Azure:</span></span>

  * <span data-ttu-id="22bad-177">Erro ao validar o arquivo .cscfg em relação ao arquivo .csdef.</span><span class="sxs-lookup"><span data-stu-id="22bad-177">Error validating the .cscfg file against the .csdef file.</span></span>
    <span data-ttu-id="22bad-178">O intervalo de portas reservado 'range' para o ponto de extremidade Microsoft.WindowsAzure.Plugins.RemoteDebugger.Connector da função 'role' é sobreposto por uma porta ou um intervalo já definido.</span><span class="sxs-lookup"><span data-stu-id="22bad-178">The reserved port range 'range' for endpoint Microsoft.WindowsAzure.Plugins.RemoteDebugger.Connector of role 'role' overlaps with an already defined port or range.</span></span>
  * <span data-ttu-id="22bad-179">Falha na alocação.</span><span class="sxs-lookup"><span data-stu-id="22bad-179">Allocation failed.</span></span> <span data-ttu-id="22bad-180">Tente novamente mais tarde, reduzindo o tamanho da VM ou o número de instâncias de função, ou tente implantar em uma região diferente.</span><span class="sxs-lookup"><span data-stu-id="22bad-180">Please retry later, try reducing the VM size or number of role instances, or try deploying to a different region.</span></span>

## <a name="debugging-azure-virtual-machines"></a><span data-ttu-id="22bad-181">Depurando máquinas virtuais do Azure</span><span class="sxs-lookup"><span data-stu-id="22bad-181">Debugging Azure virtual machines</span></span>
<span data-ttu-id="22bad-182">Você pode depurar programas que são executados em máquinas virtuais do Azure usando o Gerenciador de Servidores no Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="22bad-182">You can debug programs that run on Azure virtual machines by using Server Explorer in Visual Studio.</span></span> <span data-ttu-id="22bad-183">Quando você habilita a depuração remota em uma máquina virtual do Azure, o Azure instala a extensão da depuração remota na máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="22bad-183">When you enable remote debugging on an Azure virtual machine, Azure installs the remote debugging extension on the virtual machine.</span></span> <span data-ttu-id="22bad-184">Em seguida, você poderá anexá-la a processos na máquina virtual e depurar normalmente.</span><span class="sxs-lookup"><span data-stu-id="22bad-184">Then, you can attach to processes on the virtual machine and debug as you normally would.</span></span>

> [!NOTE]
> <span data-ttu-id="22bad-185">As máquina virtuais criadas por meio da pilha do gerenciador de recursos do Azure podem ser remotamente depuradas usando o Cloud Explorer no Visual Studio 2015.</span><span class="sxs-lookup"><span data-stu-id="22bad-185">Virtual machines created through the Azure resource manager stack can be remotely debugged by using Cloud Explorer in Visual Studio 2015.</span></span> <span data-ttu-id="22bad-186">Para saber mais, consulte [Gerenciando recursos do Azure com o Cloud Explorer](http://go.microsoft.com/fwlink/?LinkId=623031).</span><span class="sxs-lookup"><span data-stu-id="22bad-186">For more information, see [Managing Azure Resources with Cloud Explorer](http://go.microsoft.com/fwlink/?LinkId=623031).</span></span>
>
>

### <a name="to-debug-an-azure-virtual-machine"></a><span data-ttu-id="22bad-187">Para depurar uma máquina virtual do Azure</span><span class="sxs-lookup"><span data-stu-id="22bad-187">To debug an Azure virtual machine</span></span>
1. <span data-ttu-id="22bad-188">No Gerenciador de Servidores, expanda o nó Máquinas Virtuais e selecione o nó da máquina virtual que deseja depurar.</span><span class="sxs-lookup"><span data-stu-id="22bad-188">In Server Explorer, expand the Virtual Machines node and select the node of the virtual machine that you want to debug.</span></span>
2. <span data-ttu-id="22bad-189">Abra o menu de contexto e selecione **Habilitar Depuração**.</span><span class="sxs-lookup"><span data-stu-id="22bad-189">Open the context menu and select **Enable Debugging**.</span></span> <span data-ttu-id="22bad-190">Quando perguntado se você tem certeza de que deseja habilitar a depuração na máquina virtual, selecione **Sim**.</span><span class="sxs-lookup"><span data-stu-id="22bad-190">When asked if you're sure if you want to enable debugging on the virtual machine, select **Yes**.</span></span>

    <span data-ttu-id="22bad-191">O Azure instala a extensão da depuração remota na máquina virtual para habilitar a depuração.</span><span class="sxs-lookup"><span data-stu-id="22bad-191">Azure installs the remote debugging extension on the virtual machine to enable debugging.</span></span>

    ![Comando Depuração habilitada para máquina virtual](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746720.png)

    ![Log de atividades do Azure](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746721.png)
3. <span data-ttu-id="22bad-194">Depois que a extensão de depuração remota concluir a instalação, abra o menu de contexto da máquina virtual e selecione **Anexar Depurador...**</span><span class="sxs-lookup"><span data-stu-id="22bad-194">After the remote debugging extension finishes installing, open the virtual machine's context menu and select **Attach Debugger...**</span></span>

    <span data-ttu-id="22bad-195">O Azure obtém uma lista dos processos na máquina virtual e os mostra na caixa de diálogo Anexar ao Processo.</span><span class="sxs-lookup"><span data-stu-id="22bad-195">Azure gets a list of the processes on the virtual machine and shows them in the Attach to Process dialog box.</span></span>

    ![Comando Anexar depurador](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746722.png)
4. <span data-ttu-id="22bad-197">Na caixa de diálogo **Anexar ao Processo**, escolha **Selecionar** a fim de limitar a lista de resultados para mostrar apenas os tipos de código que você deseja depurar.</span><span class="sxs-lookup"><span data-stu-id="22bad-197">In the **Attach to Process** dialog box, select **Select** to limit the results list to show only the types of code you want to debug.</span></span> <span data-ttu-id="22bad-198">Você pode depurar um código gerenciado de 32 ou 64 bits, código nativo ou ambos.</span><span class="sxs-lookup"><span data-stu-id="22bad-198">You can debug 32- or 64-bit managed code, native code, or both.</span></span>

    ![Caixa de diálogo Selecionar tipo de código](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC718346.png)
5. <span data-ttu-id="22bad-200">Clique nos processos que você deseja depurar na máquina virtual e selecione **Anexar**.</span><span class="sxs-lookup"><span data-stu-id="22bad-200">Select the processes you want to debug on the virtual machine and then select **Attach**.</span></span> <span data-ttu-id="22bad-201">Por exemplo, você pode escolher o processo w3wp.exe se quiser depurar um aplicativo Web na máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="22bad-201">For example, you might choose the w3wp.exe process if you wanted to debug a web app on the virtual machine.</span></span> <span data-ttu-id="22bad-202">Consulte [Depurar um ou mais processos no Visual Studio](https://msdn.microsoft.com/library/jj919165.aspx) e [Arquitetura de função do Azure](http://blogs.msdn.com/b/kwill/archive/2011/05/05/windows-azure-role-architecture.aspx) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="22bad-202">See [Debug One or More Processes in Visual Studio](https://msdn.microsoft.com/library/jj919165.aspx) and [Azure Role Architecture](http://blogs.msdn.com/b/kwill/archive/2011/05/05/windows-azure-role-architecture.aspx) for more information.</span></span>

## <a name="create-a-web-project-and-a-virtual-machine-for-debugging"></a><span data-ttu-id="22bad-203">Criar um projeto da Web e uma máquina virtual para depuração</span><span class="sxs-lookup"><span data-stu-id="22bad-203">Create a web project and a virtual machine for debugging</span></span>
<span data-ttu-id="22bad-204">Antes de publicar seu projeto do Azure, talvez seja útil testá-lo em um ambiente independente que ofereça suporte a cenários de teste e depuração, e onde seja possível instalar programas de teste e monitoramento.</span><span class="sxs-lookup"><span data-stu-id="22bad-204">Before publishing your Azure project, you might find it useful to test it in a contained environment that supports debugging and testing scenarios, and where you can install testing and monitoring programs.</span></span> <span data-ttu-id="22bad-205">Uma maneira de fazer isso é depurar remotamente seu aplicativo em uma máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="22bad-205">One way to do this is to remotely debug your app on a virtual machine.</span></span>

<span data-ttu-id="22bad-206">Os projetos ASP.NET do Visual Studio oferecem uma opção para criar uma máquina virtual útil que você pode usar para teste de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="22bad-206">Visual Studio ASP.NET projects offer an option to create a handy virtual machine that you can use for app testing.</span></span> <span data-ttu-id="22bad-207">A máquina virtual inclui pontos de extremidade que geralmente são necessários, como PowerShell, área de trabalho remota e Implantação da Web.</span><span class="sxs-lookup"><span data-stu-id="22bad-207">The virtual machine includes commonly-needed endpoints such as PowerShell, remote desktop, and WebDeploy.</span></span>

### <a name="to-create-a-web-project-and-a-virtual-machine-for-debugging"></a><span data-ttu-id="22bad-208">Para criar um projeto da Web e uma máquina virtual para depuração</span><span class="sxs-lookup"><span data-stu-id="22bad-208">To create a web project and a virtual machine for debugging</span></span>
1. <span data-ttu-id="22bad-209">No Visual Studio, crie um novo aplicativo Web do ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="22bad-209">In Visual Studio, create a new ASP.NET Web Application.</span></span>
2. <span data-ttu-id="22bad-210">Na caixa de diálogo Novo Projeto do ASP.NET, na seção Azure, escolha **Máquina Virtual** na caixa de listagem suspensa.</span><span class="sxs-lookup"><span data-stu-id="22bad-210">In the New ASP.NET Project dialog, in the Azure section, choose **Virtual Machine** in the dropdown list box.</span></span> <span data-ttu-id="22bad-211">Deixe a caixa de seleção **Criar recursos remotos** marcada.</span><span class="sxs-lookup"><span data-stu-id="22bad-211">Leave the **Create remote resources** check box selected.</span></span> <span data-ttu-id="22bad-212">Selecione **OK** para continuar.</span><span class="sxs-lookup"><span data-stu-id="22bad-212">Select **OK** to proceed.</span></span>

    <span data-ttu-id="22bad-213">A caixa de diálogo **Criar máquina virtual no Azure** é exibida.</span><span class="sxs-lookup"><span data-stu-id="22bad-213">The **Create virtual machine on Azure** dialog box appears.</span></span>

    ![Caixa de diálogo Criar projeto da Web do ASP.NET](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746723.png)

    <span data-ttu-id="22bad-215">**Observação:** você será solicitado a entrar na conta do Azure, caso ainda não tenha entrado.</span><span class="sxs-lookup"><span data-stu-id="22bad-215">**Note:** You'll be asked to sign in to your Azure account if you're not already signed in.</span></span>

1. <span data-ttu-id="22bad-216">Selecione as diversas configurações para a máquina virtual e escolha **OK**.</span><span class="sxs-lookup"><span data-stu-id="22bad-216">Select the various settings for the virtual machine and then select **OK**.</span></span> <span data-ttu-id="22bad-217">Consulte [Máquinas Virtuais](http://go.microsoft.com/fwlink/?LinkId=623033) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="22bad-217">See [Virtual Machines](http://go.microsoft.com/fwlink/?LinkId=623033) for more information.</span></span>

    <span data-ttu-id="22bad-218">Insira o nome DNS que será o nome da máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="22bad-218">The name you enter for DNS name will be the name of the virtual machine.</span></span>

    ![Caixa de diálogo Criar máquina virtual no Azure](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746724.png)

    <span data-ttu-id="22bad-220">O Azure cria a máquina virtual e provisiona e configura os pontos de extremidade, como Área de Trabalho Remota e Implantação da Web.</span><span class="sxs-lookup"><span data-stu-id="22bad-220">Azure creates the virtual machine and then provisions and configures the endpoints, such as Remote Desktop and Web Deploy</span></span>
2. <span data-ttu-id="22bad-221">Depois que a máquina virtual estiver totalmente configurada, selecione o nó da máquina virtual no Gerenciador de Servidores.</span><span class="sxs-lookup"><span data-stu-id="22bad-221">After the virtual machine is fully configured, select the virtual machine’s node in Server Explorer.</span></span>
3. <span data-ttu-id="22bad-222">Abra o menu de contexto e selecione **Habilitar Depuração**.</span><span class="sxs-lookup"><span data-stu-id="22bad-222">Open the context menu and select **Enable Debugging**.</span></span> <span data-ttu-id="22bad-223">Quando perguntado se você tem certeza de que deseja habilitar a depuração na máquina virtual, selecione **Sim**.</span><span class="sxs-lookup"><span data-stu-id="22bad-223">When asked if you're sure if you want to enable debugging on the virtual machine, select **Yes**.</span></span>

    <span data-ttu-id="22bad-224">O Azure instala a extensão da depuração remota na máquina virtual para habilitar a depuração.</span><span class="sxs-lookup"><span data-stu-id="22bad-224">Azure installs the remote debugging extension to the virtual machine to enable debugging.</span></span>

    ![Comando Depuração habilitada para máquina virtual](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746720.png)

    ![Log de atividades do Azure](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746721.png)
4. <span data-ttu-id="22bad-227">Publique seu projeto, como descrito em [Como implantar um projeto Web usando a publicação de um clique no Visual Studio](https://msdn.microsoft.com/library/dd465337.aspx).</span><span class="sxs-lookup"><span data-stu-id="22bad-227">Publish your project as outlined in [How to: Deploy a Web Project Using One-Click Publish in Visual Studio](https://msdn.microsoft.com/library/dd465337.aspx).</span></span> <span data-ttu-id="22bad-228">Como você deseja depurar na máquina virtual, na página **Configurações** do assistente **Publicar Web**, selecione **Depurar** como a configuração.</span><span class="sxs-lookup"><span data-stu-id="22bad-228">Because you want to debug on the virtual machine, on the **Settings** page of the **Publish Web** wizard, select **Debug** as the configuration.</span></span> <span data-ttu-id="22bad-229">Isso garante que os símbolos de código estejam disponíveis durante a depuração.</span><span class="sxs-lookup"><span data-stu-id="22bad-229">This makes sure that code symbols are available while debugging.</span></span>

    ![Configurações de publicação](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC718349.png)
5. <span data-ttu-id="22bad-231">Em **Opções de Publicação de Arquivo**, selecione **Remover arquivos adicionais no destino** se o projeto já tiver sido implantado anteriormente.</span><span class="sxs-lookup"><span data-stu-id="22bad-231">In the **File Publish Options**, select **Remove additional files at destination** if the project was already deployed at an earlier time.</span></span>
6. <span data-ttu-id="22bad-232">Depois de publicar o projeto, no menu de contexto da máquina virtual no Gerenciador de Servidores, selecione **Anexar depurador...**</span><span class="sxs-lookup"><span data-stu-id="22bad-232">After the project publishes, on the virtual machine's context menu in Server Explorer, select **Attach Debugger...**</span></span>

    <span data-ttu-id="22bad-233">O Azure obtém uma lista dos processos na máquina virtual e os mostra na caixa de diálogo Anexar ao Processo.</span><span class="sxs-lookup"><span data-stu-id="22bad-233">Azure gets a list of the processes on the virtual machine and shows them in the Attach to Process dialog box.</span></span>

    ![Comando Anexar depurador](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746722.png)
7. <span data-ttu-id="22bad-235">Na caixa de diálogo **Anexar ao Processo**, escolha **Selecionar** a fim de limitar a lista de resultados para mostrar apenas os tipos de código que você deseja depurar.</span><span class="sxs-lookup"><span data-stu-id="22bad-235">In the **Attach to Process** dialog box, select **Select** to limit the results list to show only the types of code you want to debug.</span></span> <span data-ttu-id="22bad-236">Você pode depurar um código gerenciado de 32 ou 64 bits, código nativo ou ambos.</span><span class="sxs-lookup"><span data-stu-id="22bad-236">You can debug 32- or 64-bit managed code, native code, or both.</span></span>

    ![Caixa de diálogo Selecionar tipo de código](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC718346.png)
8. <span data-ttu-id="22bad-238">Clique nos processos que você deseja depurar na máquina virtual e selecione **Anexar**.</span><span class="sxs-lookup"><span data-stu-id="22bad-238">Select the processes you want to debug on the virtual machine and then select **Attach**.</span></span> <span data-ttu-id="22bad-239">Por exemplo, você pode escolher o processo w3wp.exe se quiser depurar um aplicativo Web na máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="22bad-239">For example, you might choose the w3wp.exe process if you wanted to debug a web app on the virtual machine.</span></span> <span data-ttu-id="22bad-240">Consulte [Depurar um o mais processos no Visual Studio](https://msdn.microsoft.com/library/jj919165.aspx) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="22bad-240">See [Debug One or More Processes in Visual Studio](https://msdn.microsoft.com/library/jj919165.aspx) for more information.</span></span>

## <a name="next-steps"></a><span data-ttu-id="22bad-241">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="22bad-241">Next steps</span></span>
* <span data-ttu-id="22bad-242">Use o **Intellitrace** para coletar um log de chamadas e eventos de um servidor de liberação.</span><span class="sxs-lookup"><span data-stu-id="22bad-242">Use **Intellitrace** to collect a log of calls and events from a release server.</span></span> <span data-ttu-id="22bad-243">Consulte [Depurando um serviço de nuvem publicado com o IntelliTrace e o Visual Studio](http://go.microsoft.com/fwlink/?LinkID=623016).</span><span class="sxs-lookup"><span data-stu-id="22bad-243">See [Debugging a Published Cloud Service with IntelliTrace and Visual Studio](http://go.microsoft.com/fwlink/?LinkID=623016).</span></span>
* <span data-ttu-id="22bad-244">Use o **Diagnóstico do Azure** para registrar em log informações detalhadas do código em execução nas funções, estejam elas em execução no ambiente de desenvolvimento ou no Azure.</span><span class="sxs-lookup"><span data-stu-id="22bad-244">Use **Azure Diagnostics** to log detailed information from code running within roles, whether the roles are running in the development environment or in Azure.</span></span> <span data-ttu-id="22bad-245">Consulte [Coletando dados de log usando o Diagnóstico do Azure](http://go.microsoft.com/fwlink/p/?LinkId=400450).</span><span class="sxs-lookup"><span data-stu-id="22bad-245">See [Collecting logging data by using Azure Diagnostics](http://go.microsoft.com/fwlink/p/?LinkId=400450).</span></span>
