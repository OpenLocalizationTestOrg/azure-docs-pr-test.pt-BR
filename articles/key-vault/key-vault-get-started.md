---
title: "Introdução ao Cofre de Chaves do Azure | Microsoft Docs"
description: "Use este tutorial para ajudá-lo a começar a usar o Cofre da Chave do Azure para criar um contêiner de proteção avançado no Azure, para armazenar e gerenciar chaves de criptografia e segredos no Azure."
services: key-vault
documentationcenter: 
author: cabailey
manager: mbaldwin
tags: azure-resource-manager
ms.assetid: 36721e1d-38b8-4a15-ba6f-14ed5be4de79
ms.service: key-vault
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: hero-article
ms.date: 07/19/2017
ms.author: cabailey
ms.openlocfilehash: 0299d931c5bf21775b68069afaa106279270226a
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/03/2017
---
# <a name="get-started-with-azure-key-vault"></a><span data-ttu-id="b8426-103">Introdução ao Cofre da Chave do Azure</span><span class="sxs-lookup"><span data-stu-id="b8426-103">Get started with Azure Key Vault</span></span>
<span data-ttu-id="b8426-104">O Cofre da Chave do Azure está disponível na maioria das regiões.</span><span class="sxs-lookup"><span data-stu-id="b8426-104">Azure Key Vault is available in most regions.</span></span> <span data-ttu-id="b8426-105">Para obter mais informações, consulte a [Página de preços do Cofre da Chave](https://azure.microsoft.com/pricing/details/key-vault/).</span><span class="sxs-lookup"><span data-stu-id="b8426-105">For more information, see the [Key Vault pricing page](https://azure.microsoft.com/pricing/details/key-vault/).</span></span>

## <a name="introduction"></a><span data-ttu-id="b8426-106">Introdução</span><span class="sxs-lookup"><span data-stu-id="b8426-106">Introduction</span></span>
<span data-ttu-id="b8426-107">Use este tutorial para ajudá-lo a começar a usar o Cofre da Chave do Azure para criar um contêiner de proteção avançado (um cofre) no Azure, para armazenar e gerenciar chaves de criptografia e segredos no Azure.</span><span class="sxs-lookup"><span data-stu-id="b8426-107">Use this tutorial to help you get started with Azure Key Vault to create a hardened container (a vault) in Azure, to store and manage cryptographic keys and secrets in Azure.</span></span> <span data-ttu-id="b8426-108">Ele percorre o processo de uso do Azure PowerShell para criar um cofre que contém uma chave ou senha que você pode usar com um aplicativo do Azure.</span><span class="sxs-lookup"><span data-stu-id="b8426-108">It walks you through the process of using Azure PowerShell to create a vault that contains a key or password that you can then use with an Azure application.</span></span> <span data-ttu-id="b8426-109">Em seguida, ele mostra como um aplicativo pode usar essa chave ou senha.</span><span class="sxs-lookup"><span data-stu-id="b8426-109">It then shows you how an application can use that key or password.</span></span>

<span data-ttu-id="b8426-110">**Tempo estimado para conclusão:** 20 minutos</span><span class="sxs-lookup"><span data-stu-id="b8426-110">**Estimated time to complete:** 20 minutes</span></span>

> [!NOTE]
> <span data-ttu-id="b8426-111">Este tutorial não inclui instruções sobre como escrever o aplicativo do Azure que uma das etapas inclui, ou seja, como autorizar um aplicativo para usar uma chave ou um segredo no cofre da chave.</span><span class="sxs-lookup"><span data-stu-id="b8426-111">This tutorial does not include instructions for how to write the Azure application that one of the steps includes, namely how to authorize an application to use a key or secret in the key vault.</span></span>
>
> <span data-ttu-id="b8426-112">Este tutorial usa o Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b8426-112">This tutorial uses Azure PowerShell.</span></span> <span data-ttu-id="b8426-113">Para obter instruções de interface de linha de comando entre diferentes plataformas, consulte [este tutorial equivalente](key-vault-manage-with-cli2.md).</span><span class="sxs-lookup"><span data-stu-id="b8426-113">For Cross-Platform Command-Line Interface instructions, see [this equivalent tutorial](key-vault-manage-with-cli2.md).</span></span>
>
>

<span data-ttu-id="b8426-114">Para obter informações gerais sobre o Cofre da Chave do Azure, consulte [O que é o Cofre da Chave do Azure?](key-vault-whatis.md)</span><span class="sxs-lookup"><span data-stu-id="b8426-114">For overview information about Azure Key Vault, see [What is Azure Key Vault?](key-vault-whatis.md)</span></span>

## <a name="prerequisites"></a><span data-ttu-id="b8426-115">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="b8426-115">Prerequisites</span></span>
<span data-ttu-id="b8426-116">Para concluir este tutorial, você precisará do seguinte:</span><span class="sxs-lookup"><span data-stu-id="b8426-116">To complete this tutorial, you must have the following:</span></span>

* <span data-ttu-id="b8426-117">Uma assinatura do Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="b8426-117">A subscription to Microsoft Azure.</span></span> <span data-ttu-id="b8426-118">Se você não tiver uma, poderá se inscrever em uma [conta gratuita](https://azure.microsoft.com/pricing/free-trial/).</span><span class="sxs-lookup"><span data-stu-id="b8426-118">If you do not have one, you can sign up for a [free account](https://azure.microsoft.com/pricing/free-trial/).</span></span>
* <span data-ttu-id="b8426-119">Azure PowerShell, **versão mínima: 1.1.0**.</span><span class="sxs-lookup"><span data-stu-id="b8426-119">Azure PowerShell, **minimum version of 1.1.0**.</span></span> <span data-ttu-id="b8426-120">Para instalar o Azure PowerShell e associá-lo à sua assinatura do Azure, consulte [Como instalar e configurar o Azure PowerShell](/powershell/azure/overview).</span><span class="sxs-lookup"><span data-stu-id="b8426-120">To install Azure PowerShell and associate it with your Azure subscription, see [How to install and configure Azure PowerShell](/powershell/azure/overview).</span></span> <span data-ttu-id="b8426-121">Se você já tiver instalado o Azure PowerShell e não souber a versão, no console do Azure PowerShell, digite `(Get-Module azure -ListAvailable).Version`.</span><span class="sxs-lookup"><span data-stu-id="b8426-121">If you have already installed Azure PowerShell and do not know the version, from the Azure PowerShell console, type `(Get-Module azure -ListAvailable).Version`.</span></span> <span data-ttu-id="b8426-122">Quando você tiver o Azure PowerShell versão 0.9.1 até 0.9.8 instalado, ainda poderá usar este tutorial com algumas pequenas alterações.</span><span class="sxs-lookup"><span data-stu-id="b8426-122">When you have Azure PowerShell version 0.9.1 through 0.9.8 installed, you can still use this tutorial with some minor changes.</span></span> <span data-ttu-id="b8426-123">Por exemplo, você deverá usar o comando `Switch-AzureMode AzureResourceManager` ; alguns dos comandos do Cofre da Chave do Azure foram alterados.</span><span class="sxs-lookup"><span data-stu-id="b8426-123">For example, you must use the `Switch-AzureMode AzureResourceManager` command and some of the Azure Key Vault commands have changed.</span></span> <span data-ttu-id="b8426-124">Para obter uma lista dos cmdlets do Cofre de Chaves para as versões 0.9.1 até 0.9.8, consulte [Cmdlets do Cofre de Chaves do Azure](/powershell/module/azurerm.keyvault/#key_vault).</span><span class="sxs-lookup"><span data-stu-id="b8426-124">For a list of the Key Vault cmdlets for versions 0.9.1 through 0.9.8, see [Azure Key Vault Cmdlets](/powershell/module/azurerm.keyvault/#key_vault).</span></span>
* <span data-ttu-id="b8426-125">Um aplicativo que será configurado para usar a chave ou senha que você criará neste tutorial.</span><span class="sxs-lookup"><span data-stu-id="b8426-125">An application that will be configured to use the key or password that you create in this tutorial.</span></span> <span data-ttu-id="b8426-126">Um aplicativo de exemplo está disponível no [Centro de Download da Microsoft](http://www.microsoft.com/en-us/download/details.aspx?id=45343).</span><span class="sxs-lookup"><span data-stu-id="b8426-126">A sample application is available from the [Microsoft Download Center](http://www.microsoft.com/en-us/download/details.aspx?id=45343).</span></span> <span data-ttu-id="b8426-127">Para obter instruções, consulte o arquivo Leiame.</span><span class="sxs-lookup"><span data-stu-id="b8426-127">For instructions, see the accompanying Readme file.</span></span>

<span data-ttu-id="b8426-128">Este tutorial foi criado para iniciantes do Azure PowerShell, mas pressupõe que você compreende os conceitos básicos, como módulos, cmdlets e sessões.</span><span class="sxs-lookup"><span data-stu-id="b8426-128">This tutorial is designed for Azure PowerShell beginners, but it assumes that you understand the basic concepts, such as modules, cmdlets, and sessions.</span></span> <span data-ttu-id="b8426-129">Para obter mais informações, consulte [Introdução ao Windows PowerShell](https://technet.microsoft.com/library/hh857337.aspx).</span><span class="sxs-lookup"><span data-stu-id="b8426-129">For more information, see [Getting started with Windows PowerShell](https://technet.microsoft.com/library/hh857337.aspx).</span></span>

<span data-ttu-id="b8426-130">Para obter ajuda detalhada sobre qualquer cmdlet que você vir neste tutorial, use o cmdlet **Get-Help** .</span><span class="sxs-lookup"><span data-stu-id="b8426-130">To get detailed help for any cmdlet that you see in this tutorial, use the **Get-Help** cmdlet.</span></span>

    Get-Help <cmdlet-name> -Detailed

<span data-ttu-id="b8426-131">Por exemplo, para obter ajuda para o cmdlet **AzureRmAccount Login** , digite:</span><span class="sxs-lookup"><span data-stu-id="b8426-131">For example, to get help for the **Login-AzureRmAccount** cmdlet, type:</span></span>

    Get-Help Login-AzureRmAccount -Detailed

<span data-ttu-id="b8426-132">Leia também os tutoriais a seguir para se familiarizar com o Gerenciador de Recursos do Azure no Azure PowerShell:</span><span class="sxs-lookup"><span data-stu-id="b8426-132">You can also read the following tutorials to get familiar with Azure Resource Manager in Azure PowerShell:</span></span>

* [<span data-ttu-id="b8426-133">Como instalar e configurar o PowerShell do Azure</span><span class="sxs-lookup"><span data-stu-id="b8426-133">How to install and configure Azure PowerShell</span></span>](/powershell/azure/overview)
* [<span data-ttu-id="b8426-134">Usando o PowerShell do Azure com o Gerenciador de Recursos</span><span class="sxs-lookup"><span data-stu-id="b8426-134">Using Azure PowerShell with Resource Manager</span></span>](../powershell-azure-resource-manager.md)

## <span data-ttu-id="b8426-135"><a id="connect"></a>Conectar-se a suas assinaturas</span><span class="sxs-lookup"><span data-stu-id="b8426-135"><a id="connect"></a>Connect to your subscriptions</span></span>
<span data-ttu-id="b8426-136">Inicie uma sessão do PowerShell do Azure e entre em sua conta do Azure com o seguinte comando:</span><span class="sxs-lookup"><span data-stu-id="b8426-136">Start an Azure PowerShell session and sign in to your Azure account with the following command:</span></span>  

    Login-AzureRmAccount

<span data-ttu-id="b8426-137">Observe que, se você estiver usando uma instância específica do Azure, por exemplo, o Azure Governamental, deve usar o parâmetro -Environment com o comando.</span><span class="sxs-lookup"><span data-stu-id="b8426-137">Note that if you are using a specific instance of Azure, for example, Azure Government, use the -Environment parameter with this command.</span></span> <span data-ttu-id="b8426-138">Por exemplo: `Login-AzureRmAccount –Environment (Get-AzureRmEnvironment –Name AzureUSGovernment)`</span><span class="sxs-lookup"><span data-stu-id="b8426-138">For example: `Login-AzureRmAccount –Environment (Get-AzureRmEnvironment –Name AzureUSGovernment)`</span></span>

<span data-ttu-id="b8426-139">Na janela pop-up do navegador, insira o nome de usuário e a senha da sua conta do Azure.</span><span class="sxs-lookup"><span data-stu-id="b8426-139">In the pop-up browser window, enter your Azure account user name and password.</span></span> <span data-ttu-id="b8426-140">O Azure PowerShell obtém todas as assinaturas que estão associadas a essa conta e, por padrão, usa a primeira.</span><span class="sxs-lookup"><span data-stu-id="b8426-140">Azure PowerShell gets all the subscriptions that are associated with this account and by default, uses the first one.</span></span>

<span data-ttu-id="b8426-141">Se você tem várias assinaturas e quer especificar uma a ser usada para o Cofre de Chaves do Azure, digite o seguinte para ver as assinaturas da sua conta:</span><span class="sxs-lookup"><span data-stu-id="b8426-141">If you have multiple subscriptions and want to specify a specific one to use for Azure Key Vault, type the following to see the subscriptions for your account:</span></span>

    Get-AzureRmSubscription

<span data-ttu-id="b8426-142">Depois, para especificar a assinatura a ser usada, digite:</span><span class="sxs-lookup"><span data-stu-id="b8426-142">Then, to specify the subscription to use, type:</span></span>

    Set-AzureRmContext -SubscriptionId <subscription ID>

<span data-ttu-id="b8426-143">Para saber mais sobre a configuração PowerShell do Azure, consulte [Como instalar e configurar o PowerShell do Azure](/powershell/azure/overview).</span><span class="sxs-lookup"><span data-stu-id="b8426-143">For more information about configuring Azure PowerShell, see [How to install and configure Azure PowerShell](/powershell/azure/overview).</span></span>

## <span data-ttu-id="b8426-144"><a id="resource"></a>Criar um novo grupo de recursos</span><span class="sxs-lookup"><span data-stu-id="b8426-144"><a id="resource"></a>Create a new resource group</span></span>
<span data-ttu-id="b8426-145">Quando você usa o Gerenciador de Recursos do Azure, todos os recursos relacionados são criados dentro de um grupo de recursos.</span><span class="sxs-lookup"><span data-stu-id="b8426-145">When you use Azure Resource Manager, all related resources are created inside a resource group.</span></span> <span data-ttu-id="b8426-146">Nós criaremos um novo grupo de recursos chamado **ContosoResourceGroup** para este tutorial:</span><span class="sxs-lookup"><span data-stu-id="b8426-146">We will create a new resource group named **ContosoResourceGroup** for this tutorial:</span></span>

    New-AzureRmResourceGroup –Name 'ContosoResourceGroup' –Location 'East Asia'


## <span data-ttu-id="b8426-147"><a id="vault"></a>Criar um cofre de chave</span><span class="sxs-lookup"><span data-stu-id="b8426-147"><a id="vault"></a>Create a key vault</span></span>
<span data-ttu-id="b8426-148">Use o cmdlet [New-AzureRmKeyVault](/powershell/module/azurerm.keyvault/new-azurermkeyvault) para criar um cofre de chaves.</span><span class="sxs-lookup"><span data-stu-id="b8426-148">Use the [New-AzureRmKeyVault](/powershell/module/azurerm.keyvault/new-azurermkeyvault) cmdlet to create a key vault.</span></span> <span data-ttu-id="b8426-149">Esse cmdlet tem três parâmetros obrigatórios: um **nome do grupo de recursos**, um **nome do cofre de chaves** e a **localização geográfica**.</span><span class="sxs-lookup"><span data-stu-id="b8426-149">This cmdlet has three mandatory parameters: a **resource group name**, a **key vault name**, and the **geographic location**.</span></span>

<span data-ttu-id="b8426-150">Por exemplo, se você usar o nome do cofre **ContosoKeyVault**, o nome do grupo de recursos **ContosoResourceGroup** e a localização **Ásia Oriental**, digite:</span><span class="sxs-lookup"><span data-stu-id="b8426-150">For example, if you use the vault name of **ContosoKeyVault**, the resource group name of **ContosoResourceGroup**, and the location of **East Asia**, type:</span></span>

    New-AzureRmKeyVault -VaultName 'ContosoKeyVault' -ResourceGroupName 'ContosoResourceGroup' -Location 'East Asia'

<span data-ttu-id="b8426-151">A saída deste cmdlet mostra as propriedades do cofre de chave que você acabou de criar.</span><span class="sxs-lookup"><span data-stu-id="b8426-151">The output of this cmdlet shows properties of the key vault that you’ve just created.</span></span> <span data-ttu-id="b8426-152">As duas propriedades mais importantes são:</span><span class="sxs-lookup"><span data-stu-id="b8426-152">The two most important properties are:</span></span>

* <span data-ttu-id="b8426-153">**Nome do Cofre**: no exemplo, isso é **ContosoKeyVault**.</span><span class="sxs-lookup"><span data-stu-id="b8426-153">**Vault Name**: In the example, this is **ContosoKeyVault**.</span></span> <span data-ttu-id="b8426-154">Você usará esse nome para outros cmdlets do Cofre da Chave.</span><span class="sxs-lookup"><span data-stu-id="b8426-154">You will use this name for other Key Vault cmdlets.</span></span>
* <span data-ttu-id="b8426-155">**URI do Cofre**: no exemplo, isso é https://contosokeyvault.vault.azure.net/.</span><span class="sxs-lookup"><span data-stu-id="b8426-155">**Vault URI**: In the example, this is https://contosokeyvault.vault.azure.net/.</span></span> <span data-ttu-id="b8426-156">Aplicativos que usam seu cofre via API REST devem usar esse URI.</span><span class="sxs-lookup"><span data-stu-id="b8426-156">Applications that use your vault through its REST API must use this URI.</span></span>

<span data-ttu-id="b8426-157">Sua conta do Azure agora está autorizada a executar qualquer operação neste cofre de chave.</span><span class="sxs-lookup"><span data-stu-id="b8426-157">Your Azure account is now authorized to perform any operations on this key vault.</span></span> <span data-ttu-id="b8426-158">Até o momento, ninguém mais está.</span><span class="sxs-lookup"><span data-stu-id="b8426-158">As yet, nobody else is.</span></span>

> [!NOTE]
> <span data-ttu-id="b8426-159">Se você vir o erro **A assinatura não está registrada para usar o namespace 'Microsoft.KeyVault'** ao tentar criar o novo cofre de chaves, execute `Register-AzureRmResourceProvider -ProviderNamespace "Microsoft.KeyVault"`, em seguida, execute novamente o comando New-AzureRmKeyVault.</span><span class="sxs-lookup"><span data-stu-id="b8426-159">If you see the error **The subscription is not registered to use namespace 'Microsoft.KeyVault'** when you try to create your new key vault, run `Register-AzureRmResourceProvider -ProviderNamespace "Microsoft.KeyVault"` and then rerun your New-AzureRmKeyVault command.</span></span> <span data-ttu-id="b8426-160">Para obter mais informações, consulte [Register-AzureRmResourceProvider](/powershell/module/azurerm.resources/register-azurermresourceprovider).</span><span class="sxs-lookup"><span data-stu-id="b8426-160">For more information, see [Register-AzureRmResourceProvider](/powershell/module/azurerm.resources/register-azurermresourceprovider).</span></span>
>
>

## <span data-ttu-id="b8426-161"><a id="add"></a>Adicionar uma chave ou segredo ao cofre de chave</span><span class="sxs-lookup"><span data-stu-id="b8426-161"><a id="add"></a>Add a key or secret to the key vault</span></span>
<span data-ttu-id="b8426-162">Se você quiser que o Cofre de Chaves do Azure crie uma chave protegida por software para você, use o cmdlet [Add-AzureKeyVaultKey](/powershell/module/azurerm.keyvault/add-azurekeyvaultkey) e digite o seguinte:</span><span class="sxs-lookup"><span data-stu-id="b8426-162">If you want Azure Key Vault to create a software-protected key for you, use the [Add-AzureKeyVaultKey](/powershell/module/azurerm.keyvault/add-azurekeyvaultkey) cmdlet, and type the following:</span></span>

    $key = Add-AzureKeyVaultKey -VaultName 'ContosoKeyVault' -Name 'ContosoFirstKey' -Destination 'Software'

<span data-ttu-id="b8426-163">No entanto, se você tiver uma chave protegida por software existente em um arquivo .PFX salvo na unidade C:\ em um arquivo denominado softkey.pfx que você deseja carregar no Cofre de Chaves do Azure, digite o seguinte para definir a variável **securepfxpwd** para uma senha **123** do arquivo .PFX:</span><span class="sxs-lookup"><span data-stu-id="b8426-163">However, if you have an existing software-protected key in a .PFX file saved to your C:\ drive in a file named softkey.pfx that you want to upload to Azure Key Vault, type the following to set the variable **securepfxpwd** for a password of **123** for the .PFX file:</span></span>

    $securepfxpwd = ConvertTo-SecureString –String '123' –AsPlainText –Force

<span data-ttu-id="b8426-164">Depois, digite o seguinte para importar a chave do arquivo .PFX, que protege a chave com um software no serviço de Cofre da Chave:</span><span class="sxs-lookup"><span data-stu-id="b8426-164">Then type the following to import the key from the .PFX file, which protects the key by software in the Key Vault service:</span></span>

    $key = Add-AzureKeyVaultKey -VaultName 'ContosoKeyVault' -Name 'ContosoFirstKey' -KeyFilePath 'c:\softkey.pfx' -KeyFilePassword $securepfxpwd


<span data-ttu-id="b8426-165">Agora, você pode fazer referência à chave que foi criada ou carregada no Cofre da Chave do Azure, usando seu URI.</span><span class="sxs-lookup"><span data-stu-id="b8426-165">You can now reference this key that you created or uploaded to Azure Key Vault, by using its URI.</span></span> <span data-ttu-id="b8426-166">Use **https://ContosoKeyVault.vault.azure.net/keys/ContosoFirstKey** para sempre obter a versão atual e use **https://ContosoKeyVault.vault.azure.net/keys/ContosoFirstKey/cgacf4f763ar42ffb0a1gca546aygd87** para obter esta versão específica.</span><span class="sxs-lookup"><span data-stu-id="b8426-166">Use **https://ContosoKeyVault.vault.azure.net/keys/ContosoFirstKey** to always get the current version, and use **https://ContosoKeyVault.vault.azure.net/keys/ContosoFirstKey/cgacf4f763ar42ffb0a1gca546aygd87** to get this specific version.</span></span>  

<span data-ttu-id="b8426-167">Para exibir o URI dessa chave, digite:</span><span class="sxs-lookup"><span data-stu-id="b8426-167">To display the URI for this key, type:</span></span>

    $Key.key.kid

<span data-ttu-id="b8426-168">Para adicionar um segredo ao cofre, que é uma senha chamada SQLPassword e que tem o valor Pa$$w0rd no Cofre da Chave do Azure, converta o valor Pa$$w0rd para uma cadeia de caracteres segura digitando o seguinte:</span><span class="sxs-lookup"><span data-stu-id="b8426-168">To add a secret to the vault, which is a password named SQLPassword and has the value of Pa$$w0rd to Azure Key Vault, first convert the value of Pa$$w0rd to a secure string by typing the following:</span></span>

    $secretvalue = ConvertTo-SecureString 'Pa$$w0rd' -AsPlainText -Force

<span data-ttu-id="b8426-169">Em seguida, digite o seguinte:</span><span class="sxs-lookup"><span data-stu-id="b8426-169">Then, type the following:</span></span>

    $secret = Set-AzureKeyVaultSecret -VaultName 'ContosoKeyVault' -Name 'SQLPassword' -SecretValue $secretvalue

<span data-ttu-id="b8426-170">Agora, você pode fazer referência a essa senha que foi adicionada ao Cofre da Chave do Azure usando seu URI.</span><span class="sxs-lookup"><span data-stu-id="b8426-170">You can now reference this password that you added to Azure Key Vault, by using its URI.</span></span> <span data-ttu-id="b8426-171">Use **https://ContosoVault.vault.azure.net/secrets/SQLPassword** para sempre obter a versão atual e use **https://ContosoVault.vault.azure.net/secrets/SQLPassword/90018dbb96a84117a0d2847ef8e7189d** para obter esta versão específica.</span><span class="sxs-lookup"><span data-stu-id="b8426-171">Use **https://ContosoVault.vault.azure.net/secrets/SQLPassword** to always get the current version, and use **https://ContosoVault.vault.azure.net/secrets/SQLPassword/90018dbb96a84117a0d2847ef8e7189d** to get this specific version.</span></span>

<span data-ttu-id="b8426-172">Para exibir o URI do segredo, digite:</span><span class="sxs-lookup"><span data-stu-id="b8426-172">To display the URI for this secret, type:</span></span>

    $secret.Id

<span data-ttu-id="b8426-173">Vejamos a chave ou o segredo que você acabou de criar:</span><span class="sxs-lookup"><span data-stu-id="b8426-173">Let’s view the key or secret that you just created:</span></span>

* <span data-ttu-id="b8426-174">Para exibir a chave, digite: `Get-AzureKeyVaultKey –VaultName 'ContosoKeyVault'`</span><span class="sxs-lookup"><span data-stu-id="b8426-174">To view your key, type: `Get-AzureKeyVaultKey –VaultName 'ContosoKeyVault'`</span></span>
* <span data-ttu-id="b8426-175">Para exibir o segredo, digite: `Get-AzureKeyVaultSecret –VaultName 'ContosoKeyVault'`</span><span class="sxs-lookup"><span data-stu-id="b8426-175">To view your secret, type: `Get-AzureKeyVaultSecret –VaultName 'ContosoKeyVault'`</span></span>

<span data-ttu-id="b8426-176">Agora, seu cofre de chave e a chave ou o segredo estão prontos para serem usados pelos aplicativos.</span><span class="sxs-lookup"><span data-stu-id="b8426-176">Now, your key vault and key or secret is ready for applications to use.</span></span> <span data-ttu-id="b8426-177">Você precisa autorizar os aplicativos a usá-los.</span><span class="sxs-lookup"><span data-stu-id="b8426-177">You must authorize applications to use them.</span></span>  

## <span data-ttu-id="b8426-178"><a id="register"></a>Registrar um aplicativo com o Active Directory do Azure</span><span class="sxs-lookup"><span data-stu-id="b8426-178"><a id="register"></a>Register an application with Azure Active Directory</span></span>
<span data-ttu-id="b8426-179">Esta etapa geralmente seria feita por um desenvolvedor, em um computador separado.</span><span class="sxs-lookup"><span data-stu-id="b8426-179">This step would usually be done by a developer, on a separate computer.</span></span> <span data-ttu-id="b8426-180">Ela não é específica ao Cofre da Chave do Azure, mas é incluída aqui para que as informações fiquem completas.</span><span class="sxs-lookup"><span data-stu-id="b8426-180">It is not specific to Azure Key Vault, but is included here for completeness.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="b8426-181">Para concluir o tutorial, sua conta, o cofre e o aplicativo que você registrará nesta etapa devem todos estar no mesmo diretório do Azure.</span><span class="sxs-lookup"><span data-stu-id="b8426-181">To complete the tutorial, your account, the vault, and the application that you will register in this step must all be in the same Azure directory.</span></span>
>
>

<span data-ttu-id="b8426-182">Aplicativos que usam um cofre de chave devem ser autenticados usando um token do Active Directory do Azure.</span><span class="sxs-lookup"><span data-stu-id="b8426-182">Applications that use a key vault must authenticate by using a token from Azure Active Directory.</span></span> <span data-ttu-id="b8426-183">Para fazer isso, o proprietário do aplicativo deve primeiro registrar o aplicativo no seu Active Directory do Azure.</span><span class="sxs-lookup"><span data-stu-id="b8426-183">To do this, the owner of the application must first register the application in their Azure Active Directory.</span></span> <span data-ttu-id="b8426-184">No final do registro, o proprietário do aplicativo obtém os seguintes valores:</span><span class="sxs-lookup"><span data-stu-id="b8426-184">At the end of registration, the application owner gets the following values:</span></span>

* <span data-ttu-id="b8426-185">Uma **ID do Aplicativo** (também conhecida como ID do Cliente) e a **chave de autenticação** (também conhecida como segredo compartilhado).</span><span class="sxs-lookup"><span data-stu-id="b8426-185">An **Application ID** (also known as a Client ID) and **authentication key** (also known as the shared secret).</span></span> <span data-ttu-id="b8426-186">O aplicativo deve apresentar esses dois valores ao Active Directory do Azure para obter um token.</span><span class="sxs-lookup"><span data-stu-id="b8426-186">The application must present both these values to Azure Active Directory, to get a token.</span></span> <span data-ttu-id="b8426-187">Como o aplicativo é configurado para fazer isso depende do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b8426-187">How the application is configured to do this depends on the application.</span></span> <span data-ttu-id="b8426-188">Para o aplicativo de exemplo do Cofre da Chave, o proprietário do aplicativo define esses valores no arquivo app.config.</span><span class="sxs-lookup"><span data-stu-id="b8426-188">For the Key Vault sample application, the application owner sets these values in the app.config file.</span></span>

<span data-ttu-id="b8426-189">Para registrar seu aplicativo com o Active Directory do Azure:</span><span class="sxs-lookup"><span data-stu-id="b8426-189">To register the application in Azure Active Directory:</span></span>

1. <span data-ttu-id="b8426-190">Entre no portal clássico do Azure.</span><span class="sxs-lookup"><span data-stu-id="b8426-190">Sign in to the Azure classic portal.</span></span>
2. <span data-ttu-id="b8426-191">À esquerda, clique em **Active Directory**e selecione o diretório no qual você registrará o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b8426-191">On the left, click **Active Directory**, and then select the directory in which you will register your application.</span></span> <br> <br> <span data-ttu-id="b8426-192">**Observação:** você deve selecionar o mesmo diretório que contém a assinatura do Azure com a qual você criou o cofre de chaves.</span><span class="sxs-lookup"><span data-stu-id="b8426-192">**Note:** You must select the same directory that contains the Azure subscription with which you created your key vault.</span></span> <span data-ttu-id="b8426-193">Se você não souber qual é o diretório, clique em **Configurações**, identifique a assinatura com a qual você criou o cofre de chaves e anote o nome do diretório exibido na última coluna.</span><span class="sxs-lookup"><span data-stu-id="b8426-193">If you do not know which directory this is, click **Settings**, identify the subscription with which you created your key vault, and note the name of the directory displayed in the last column.</span></span>
3. <span data-ttu-id="b8426-194">Clique em **APLICATIVOS**.</span><span class="sxs-lookup"><span data-stu-id="b8426-194">Click **APPLICATIONS**.</span></span> <span data-ttu-id="b8426-195">Se nenhum aplicativo tiver sido adicionado ao seu diretório, essa página mostrará somente o link **Adicionar um aplicativo** .</span><span class="sxs-lookup"><span data-stu-id="b8426-195">If no apps have been added to your directory, this page shows only the **Add an App** link.</span></span> <span data-ttu-id="b8426-196">Clique no link ou, se preferir, em **ADICIONAR** na barra de comandos.</span><span class="sxs-lookup"><span data-stu-id="b8426-196">Click the link, or alternatively, you can click **ADD** on the command bar.</span></span>
4. <span data-ttu-id="b8426-197">No assistente **ADICIONAR APLICATIVO** na página **O que você deseja fazer?**, clique em **Adicionar um aplicativo que minha organização está desenvolvendo**.</span><span class="sxs-lookup"><span data-stu-id="b8426-197">In the **ADD APPLICATION** wizard, on the **What do you want to do?** page, click **Add an application my organization is developing**.</span></span>
5. <span data-ttu-id="b8426-198">Na página **Conte-nos sobre seu aplicativo**, especifique um nome para seu aplicativo, em seguida, selecione **APLICATIVO WEB E/OU API WEB** (o padrão).</span><span class="sxs-lookup"><span data-stu-id="b8426-198">On the **Tell us about your application** page, specify a name for your application, and then select **WEB APPLICATION AND/OR WEB API** (the default).</span></span> <span data-ttu-id="b8426-199">Clique no ícone **Avançar** .</span><span class="sxs-lookup"><span data-stu-id="b8426-199">Click the **Next** icon.</span></span>
6. <span data-ttu-id="b8426-200">Na página **Propriedades do aplicativo**, especifique a **URL DE LOGON** e o **URI DA ID DO aplicativo** para seu aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="b8426-200">On the **App properties** page, specify the **SIGN-ON URL** and **APP ID URI** for your web application.</span></span> <span data-ttu-id="b8426-201">Se seu aplicativo não tiver esses valores, você pode inventá-los para esta etapa (por exemplo, você poderia especificar http://test1.contoso.com para as duas caixas).</span><span class="sxs-lookup"><span data-stu-id="b8426-201">If your application does not have these values, you can make them up for this step (for example, you could specify http://test1.contoso.com for both boxes).</span></span> <span data-ttu-id="b8426-202">Não importa se os sites existem.</span><span class="sxs-lookup"><span data-stu-id="b8426-202">It does not matter if these sites exist.</span></span> <span data-ttu-id="b8426-203">O importante é que o URI de ID de cada aplicativo é diferente para todos os aplicativos no diretório.</span><span class="sxs-lookup"><span data-stu-id="b8426-203">What is important is that the app ID URI for each application is different for every application in your directory.</span></span> <span data-ttu-id="b8426-204">O diretório usa essa cadeia de caracteres para identificar seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b8426-204">The directory uses this string to identify your app.</span></span>
7. <span data-ttu-id="b8426-205">Clique no ícone **Concluído** para salvar suas alterações no assistente.</span><span class="sxs-lookup"><span data-stu-id="b8426-205">Click the **Complete** icon to save your changes in the wizard.</span></span>
8. <span data-ttu-id="b8426-206">Na página **Início Rápido**, clique em **CONFIGURAR**.</span><span class="sxs-lookup"><span data-stu-id="b8426-206">On the **Quick Start** page, click **CONFIGURE**.</span></span>
9. <span data-ttu-id="b8426-207">Role até a seção **chaves**, selecione a duração, em seguida, clique em **SALVAR**.</span><span class="sxs-lookup"><span data-stu-id="b8426-207">Scroll to the **keys** section, select the duration, and then click **SAVE**.</span></span> <span data-ttu-id="b8426-208">A página é atualizada e passa a mostrar um valor de chave.</span><span class="sxs-lookup"><span data-stu-id="b8426-208">The page refreshes and now shows a key value.</span></span> <span data-ttu-id="b8426-209">Você deve configurar seu aplicativo com esse valor de chave e o valor da **ID DO CLIENTE** .</span><span class="sxs-lookup"><span data-stu-id="b8426-209">You must configure your application with this key value and the **CLIENT ID** value.</span></span> <span data-ttu-id="b8426-210">(As instruções para esta configuração são específicas do aplicativo.)</span><span class="sxs-lookup"><span data-stu-id="b8426-210">(Instructions for this configuration are application-specific.)</span></span>
10. <span data-ttu-id="b8426-211">Copie o valor da ID do cliente desta página, que você usará na próxima etapa para definir as permissões no cofre.</span><span class="sxs-lookup"><span data-stu-id="b8426-211">Copy the client ID value from this page, which you will use in the next step to set permissions on your vault.</span></span>

## <span data-ttu-id="b8426-212"><a id="authorize"></a>Autorizar o aplicativo a usar a chave ou segredo</span><span class="sxs-lookup"><span data-stu-id="b8426-212"><a id="authorize"></a>Authorize the application to use the key or secret</span></span>
<span data-ttu-id="b8426-213">Para autorizar o aplicativo para acessar a chave ou o segredo no cofre, use o cmdlet [Set-AzureRmKeyVaultAccessPolicy](/powershell/module/azurerm.keyvault/set-azurermkeyvaultaccesspolicy).</span><span class="sxs-lookup"><span data-stu-id="b8426-213">To authorize the application to access the key or secret in the vault, use the [Set-AzureRmKeyVaultAccessPolicy](/powershell/module/azurerm.keyvault/set-azurermkeyvaultaccesspolicy) cmdlet.</span></span>

<span data-ttu-id="b8426-214">Por exemplo, se o nome do cofre for **ContosoKeyVault** e o aplicativo que você quer autorizar tiver a ID de cliente 8f8c4bbd-485b-45fd-98f7-ec6300b7b4ed, e você quiser autorizar o aplicativo a descriptografar e assinar com chaves em seu cofre, execute o seguinte:</span><span class="sxs-lookup"><span data-stu-id="b8426-214">For example, if your vault name is **ContosoKeyVault** and the application you want to authorize has a client ID of 8f8c4bbd-485b-45fd-98f7-ec6300b7b4ed, and you want to authorize the application to decrypt and sign with keys in your vault, run the following:</span></span>

    Set-AzureRmKeyVaultAccessPolicy -VaultName 'ContosoKeyVault' -ServicePrincipalName 8f8c4bbd-485b-45fd-98f7-ec6300b7b4ed -PermissionsToKeys decrypt,sign

<span data-ttu-id="b8426-215">Se você deseja autorizar que o mesmo aplicativo leia segredos em seu cofre, execute o seguinte:</span><span class="sxs-lookup"><span data-stu-id="b8426-215">If you want to authorize that same application to read secrets in your vault, run the following:</span></span>

    Set-AzureRmKeyVaultAccessPolicy -VaultName 'ContosoKeyVault' -ServicePrincipalName 8f8c4bbd-485b-45fd-98f7-ec6300b7b4ed -PermissionsToSecrets Get

## <span data-ttu-id="b8426-216"><a id="HSM"></a>Se quiser usar um HSM (módulo de segurança de hardware)</span><span class="sxs-lookup"><span data-stu-id="b8426-216"><a id="HSM"></a>If you want to use a hardware security module (HSM)</span></span>
<span data-ttu-id="b8426-217">Para garantia extra, você pode importar ou gerar chaves em HSMs (módulos de segurança de hardware) que nunca deixam os limites do HSM.</span><span class="sxs-lookup"><span data-stu-id="b8426-217">For added assurance, you can import or generate keys in hardware security modules (HSMs) that never leave the HSM boundary.</span></span> <span data-ttu-id="b8426-218">Os HSMs têm certificação FIPS 140-2 Nível 2.</span><span class="sxs-lookup"><span data-stu-id="b8426-218">The HSMs are FIPS 140-2 Level 2 validated.</span></span> <span data-ttu-id="b8426-219">Se esse requisito não se aplicar a você, ignore esta seção e vá para [Excluir o cofre de chave e chaves e segredos associados](#delete).</span><span class="sxs-lookup"><span data-stu-id="b8426-219">If this requirement doesn't apply to you, skip this section and go to [Delete the key vault and associated keys and secrets](#delete).</span></span>

<span data-ttu-id="b8426-220">Para criar essas chaves protegidas por HSM, você deverá usar a [Camada de serviço Premium do Cofre de Chaves do Azure para dar suporte a chaves protegidas por HSM](https://azure.microsoft.com/pricing/free-trial/).</span><span class="sxs-lookup"><span data-stu-id="b8426-220">To create these HSM-protected keys, you must use the [Azure Key Vault Premium service tier to support HSM-protected keys](https://azure.microsoft.com/pricing/free-trial/).</span></span> <span data-ttu-id="b8426-221">Além disso, observe que essa funcionalidade não está disponível para o Azure China.</span><span class="sxs-lookup"><span data-stu-id="b8426-221">In addition, note that this functionality is not available for Azure China.</span></span>

<span data-ttu-id="b8426-222">Ao criar o cofre de chaves, adicione o parâmetro **-SKU**:</span><span class="sxs-lookup"><span data-stu-id="b8426-222">When you create the key vault, add the **-SKU** parameter:</span></span>

    New-AzureRmKeyVault -VaultName 'ContosoKeyVaultHSM' -ResourceGroupName 'ContosoResourceGroup' -Location 'East Asia' -SKU 'Premium'



<span data-ttu-id="b8426-223">Você pode adicionar chaves protegidas por software (conforme mostrado anteriormente) e por HSM a este cofre de chaves.</span><span class="sxs-lookup"><span data-stu-id="b8426-223">You can add software-protected keys (as shown earlier) and HSM-protected keys to this key vault.</span></span> <span data-ttu-id="b8426-224">Para criar uma chave protegida por HSM, defina o parâmetro **-Destination** como 'HSM':</span><span class="sxs-lookup"><span data-stu-id="b8426-224">To create an HSM-protected key, set the **-Destination** parameter to 'HSM':</span></span>

    $key = Add-AzureKeyVaultKey -VaultName 'ContosoKeyVaultHSM' -Name 'ContosoFirstHSMKey' -Destination 'HSM'

<span data-ttu-id="b8426-225">Você pode usar o comando a seguir para importar uma chave de um arquivo .PFX para seu computador.</span><span class="sxs-lookup"><span data-stu-id="b8426-225">You can use the following command to import a key from a .PFX file on your computer.</span></span> <span data-ttu-id="b8426-226">Esse comando importa a chave para os HSMs no serviço de Cofre da Chave:</span><span class="sxs-lookup"><span data-stu-id="b8426-226">This command imports the key into HSMs in the Key Vault service:</span></span>

    $key = Add-AzureKeyVaultKey -VaultName 'ContosoKeyVaultHSM' -Name 'ContosoFirstHSMKey' -KeyFilePath 'c:\softkey.pfx' -KeyFilePassword $securepfxpwd -Destination 'HSM'


<span data-ttu-id="b8426-227">O próximo comando importa um pacote de BYOK ("traga sua própria chave").</span><span class="sxs-lookup"><span data-stu-id="b8426-227">The next command imports a “bring your own key" (BYOK) package.</span></span> <span data-ttu-id="b8426-228">Esse cenário permite gerar sua chave no HSM local e transferi-la para os HSMs no serviço de Cofre de Chaves, sem que a chave deixe os limites do HSM:</span><span class="sxs-lookup"><span data-stu-id="b8426-228">This scenario lets you generate your key in your local HSM, and transfer it to HSMs in the Key Vault service, without the key leaving the HSM boundary:</span></span>

    $key = Add-AzureKeyVaultKey -VaultName 'ContosoKeyVaultHSM' -Name 'ContosoFirstHSMKey' -KeyFilePath 'c:\ITByok.byok' -Destination 'HSM'

<span data-ttu-id="b8426-229">Para obter instruções detalhadas sobre como gerar esse pacote BYOK, confira [Como gerar e transferir chaves protegidas por HSM para o Cofre da Chave do Azure](key-vault-hsm-protected-keys.md).</span><span class="sxs-lookup"><span data-stu-id="b8426-229">For more detailed instructions about how to generate this BYOK package, see [How to generate and transfer HSM-protected keys for Azure Key Vault](key-vault-hsm-protected-keys.md).</span></span>

## <span data-ttu-id="b8426-230"><a id="delete"></a>Excluir o cofre de chave e as chaves e segredos associados</span><span class="sxs-lookup"><span data-stu-id="b8426-230"><a id="delete"></a>Delete the key vault and associated keys and secrets</span></span>
<span data-ttu-id="b8426-231">Se você não precisar mais do cofre de chaves e da chave ou segredo que ele contém, poderá excluir o cofre de chaves usando o cmdlet [Remove-AzureRmKeyVault](/powershell/module/azurerm.keyvault/remove-azurermkeyvault):</span><span class="sxs-lookup"><span data-stu-id="b8426-231">If you no longer need the key vault and the key or secret that it contains, you can delete the key vault by using the [Remove-AzureRmKeyVault](/powershell/module/azurerm.keyvault/remove-azurermkeyvault) cmdlet:</span></span>

    Remove-AzureRmKeyVault -VaultName 'ContosoKeyVault'

<span data-ttu-id="b8426-232">Ou você pode excluir um grupo de recursos do Azure inteiro, que inclui o cofre de chave e quaisquer outros recursos incluídos nesse grupo:</span><span class="sxs-lookup"><span data-stu-id="b8426-232">Or, you can delete an entire Azure resource group, which includes the key vault and any other resources that you included in that group:</span></span>

    Remove-AzureRmResourceGroup -ResourceGroupName 'ContosoResourceGroup'


## <span data-ttu-id="b8426-233"><a id="other"></a>Outros cmdlets do PowerShell do Azure</span><span class="sxs-lookup"><span data-stu-id="b8426-233"><a id="other"></a>Other Azure PowerShell Cmdlets</span></span>
<span data-ttu-id="b8426-234">Outros comandos que podem ser úteis para gerenciar o Cofre da Chave do Azure.</span><span class="sxs-lookup"><span data-stu-id="b8426-234">Other commands that you might find useful for managing Azure Key Vault:</span></span>

* <span data-ttu-id="b8426-235">`$Keys = Get-AzureKeyVaultKey -VaultName 'ContosoKeyVault'`: este comando obtém uma exibição em tabela de todas as chaves e propriedades selecionadas.</span><span class="sxs-lookup"><span data-stu-id="b8426-235">`$Keys = Get-AzureKeyVaultKey -VaultName 'ContosoKeyVault'`: This command gets a tabular display of all keys and selected properties.</span></span>
* <span data-ttu-id="b8426-236">`$Keys[0]`: este comando exibe uma lista completa de propriedades para a chave especificada</span><span class="sxs-lookup"><span data-stu-id="b8426-236">`$Keys[0]`: This command displays a full list of properties for the specified key</span></span>
* <span data-ttu-id="b8426-237">`Get-AzureKeyVaultSecret`: este comando lista uma exibição em tabela de todos os nomes de segredos e propriedades selecionadas.</span><span class="sxs-lookup"><span data-stu-id="b8426-237">`Get-AzureKeyVaultSecret`: This command lists a tabular display of all secret names and selected properties.</span></span>
* <span data-ttu-id="b8426-238">`Remove-AzureKeyVaultKey -VaultName 'ContosoKeyVault' -Name 'ContosoFirstKey'`: exemplo de como remover uma chave específica.</span><span class="sxs-lookup"><span data-stu-id="b8426-238">`Remove-AzureKeyVaultKey -VaultName 'ContosoKeyVault' -Name 'ContosoFirstKey'`: Example how to remove a specific key.</span></span>
* <span data-ttu-id="b8426-239">`Remove-AzureKeyVaultSecret -VaultName 'ContosoKeyVault' -Name 'SQLPassword'`: exemplo de como remover um segredo específico.</span><span class="sxs-lookup"><span data-stu-id="b8426-239">`Remove-AzureKeyVaultSecret -VaultName 'ContosoKeyVault' -Name 'SQLPassword'`: Example how to remove a specific secret.</span></span>

## <span data-ttu-id="b8426-240"><a id="next"></a>Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="b8426-240"><a id="next"></a>Next steps</span></span>
<span data-ttu-id="b8426-241">Para um tutorial de acompanhamento que usa o Cofre da Chave do Azure em um aplicativo Web, confira [Usar o Cofre da Chave do Azure em um Aplicativo Web](key-vault-use-from-web-application.md).</span><span class="sxs-lookup"><span data-stu-id="b8426-241">For a follow-up tutorial that uses Azure Key Vault in a web application, see [Use Azure Key Vault from a Web Application](key-vault-use-from-web-application.md).</span></span>

<span data-ttu-id="b8426-242">Para ver como o cofre de chaves está sendo usado, confira [Log do Cofre de Chaves do Azure](key-vault-logging.md).</span><span class="sxs-lookup"><span data-stu-id="b8426-242">To see how your key vault is being used, see [Azure Key Vault Logging](key-vault-logging.md).</span></span>

<span data-ttu-id="b8426-243">Para obter uma lista dos cmdlets do Azure PowerShell mais recentes para o Cofre de Chaves do Azure, consulte [Cmdlets do Cofre de Chaves do Azure](/powershell/module/azurerm.keyvault/#key_vault).</span><span class="sxs-lookup"><span data-stu-id="b8426-243">For a list of the latest Azure PowerShell cmdlets for Azure Key Vault, see [Azure Key Vault Cmdlets](/powershell/module/azurerm.keyvault/#key_vault).</span></span>

<span data-ttu-id="b8426-244">Para referências de programação, consulte [Guia do desenvolvedor do Cofre da Chave do Azure](key-vault-developers-guide.md).</span><span class="sxs-lookup"><span data-stu-id="b8426-244">For programming references, see [the Azure Key Vault developer's guide](key-vault-developers-guide.md).</span></span>
