---
ms.assetid: 
title: "Exclusão reversível do Azure Key Vault | Microsoft Docs"
ms.service: key-vault
author: BrucePerlerMS
ms.author: bruceper
manager: mbaldwin
ms.date: 07/10/2017
ms.openlocfilehash: c873b153ef9c7d5f55672a5918c9dc4fb7256701
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/03/2017
---
# <a name="azure-key-vault-soft-delete-overview"></a><span data-ttu-id="679e2-102">Visão geral de exclusão reversível do Azure Key Vault</span><span class="sxs-lookup"><span data-stu-id="679e2-102">Azure Key Vault soft-delete overview</span></span>

<span data-ttu-id="679e2-103">O recurso de exclusão reversível do Azure Key Vault permite a recuperação de cofres e objetos de cofre excluídos, o que é conhecido como exclusão reversível.</span><span class="sxs-lookup"><span data-stu-id="679e2-103">Key Vault's soft delete feature allows recovery of the deleted vaults and vault objects, known as soft-delete.</span></span> <span data-ttu-id="679e2-104">Especificamente, abordamos os seguintes cenários:</span><span class="sxs-lookup"><span data-stu-id="679e2-104">Specifically, we address the following scenarios:</span></span>

- <span data-ttu-id="679e2-105">Suporte à exclusão reversível de cofres de chaves</span><span class="sxs-lookup"><span data-stu-id="679e2-105">Support for recoverable deletion of a key vault</span></span>
- <span data-ttu-id="679e2-106">Suporte à exclusão recuperável de objetos do cofre de chaves (por exemplo,</span><span class="sxs-lookup"><span data-stu-id="679e2-106">Support for recoverable deletion of key vault objects (ex.</span></span> <span data-ttu-id="679e2-107">chaves, segredos, certificados)</span><span class="sxs-lookup"><span data-stu-id="679e2-107">keys, secrets, certificates)</span></span>

## <a name="supporting-interfaces"></a><span data-ttu-id="679e2-108">Interfaces de suporte</span><span class="sxs-lookup"><span data-stu-id="679e2-108">Supporting interfaces</span></span>

<span data-ttu-id="679e2-109">O recurso de exclusão reversível está inicialmente disponível por meio das interfaces da REST, do .NET/C# e do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="679e2-109">The soft-delete feature is initially available through the REST, .NET/C# and PowerShell interfaces.</span></span> <span data-ttu-id="679e2-110">Consulte as referências para obter esses e mais detalhes, [Referência do Key Vault](https://docs.microsoft.com/azure/key-vault/).</span><span class="sxs-lookup"><span data-stu-id="679e2-110">Refer to the references for these for more details, [Key Vault Reference](https://docs.microsoft.com/azure/key-vault/).</span></span>

## <a name="scenarios"></a><span data-ttu-id="679e2-111">Cenários</span><span class="sxs-lookup"><span data-stu-id="679e2-111">Scenarios</span></span>

<span data-ttu-id="679e2-112">Os Azure Key Vaults são recursos controlados, gerenciados pelo Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="679e2-112">Azure Key Vaults are tracked resources, managed by Azure Resource Manager.</span></span> <span data-ttu-id="679e2-113">O Azure Resource Manager também especifica um comportamento bem definido para a exclusão, que exige que uma operação DELETE bem-sucedida faça com que esse recurso não esteja mais acessível.</span><span class="sxs-lookup"><span data-stu-id="679e2-113">Azure Resource Manager also specifies a well-defined behavior for deletion, which requires that a successful DELETE operation must result in that resource not being accessible anymore.</span></span> <span data-ttu-id="679e2-114">O recurso de exclusão reversível aborda a recuperação do objeto excluído, independentemente se a exclusão foi acidental ou intencional.</span><span class="sxs-lookup"><span data-stu-id="679e2-114">The soft-delete feature addresses the recovery of the deleted object, whether the deletion was accidental or intentional.</span></span>

1. <span data-ttu-id="679e2-115">No cenário típico, um usuário pode ter acidentalmente excluído um cofre de chaves ou um objeto do cofre de chaves; se esse cofre de chaves ou objeto do cofre de chaves precisar ser recuperável por um período predeterminado, o usuário poderá desfazer a exclusão e recuperar seus dados.</span><span class="sxs-lookup"><span data-stu-id="679e2-115">In the typical scenario, a user may have inadvertently deleted a key vault or a key vault object; if that key vault or key vault object were to be recoverable for a predetermined period, the user may undo the deletion and recover their data.</span></span>

2. <span data-ttu-id="679e2-116">Em um cenário diferente, um usuário mal-intencionado pode tentar excluir um cofre de chaves ou um objeto do cofre de chaves, como uma chave dentro de um cofre, para causar uma interrupção dos negócios.</span><span class="sxs-lookup"><span data-stu-id="679e2-116">In a different scenario, a rogue user may attempt to delete a key vault or a key vault object, such as a key inside a vault, to cause a business disruption.</span></span> <span data-ttu-id="679e2-117">A separação da exclusão do cofre de chaves ou do objeto do cofre de chaves da exclusão real dos dados subjacentes pode ser usada como uma medida de segurança, por exemplo, restringindo as permissões de exclusão de dados a outra função confiável.</span><span class="sxs-lookup"><span data-stu-id="679e2-117">Separating the deletion of the key vault or key vault object from the actual deletion of the underlying data can be used as a safety measure by, for instance, restricting permissions on data deletion to a different, trusted role.</span></span> <span data-ttu-id="679e2-118">Essa abordagem efetivamente exige quorum para uma operação que, de outro modo, poderá resultar em uma perda de dados imediata.</span><span class="sxs-lookup"><span data-stu-id="679e2-118">This approach effectively requires quorum for an operation which might otherwise result in an immediate data loss.</span></span>

### <a name="soft-delete-behavior"></a><span data-ttu-id="679e2-119">Comportamento de exclusão reversível</span><span class="sxs-lookup"><span data-stu-id="679e2-119">Soft-delete behavior</span></span>

<span data-ttu-id="679e2-120">Com esse recurso, a operação DELETE em um cofre de chaves ou objeto do cofre de chaves é uma exclusão reversível, efetivamente mantendo os recursos por um período de retenção especificado, ao mesmo tempo aparentando ter excluído o objeto.</span><span class="sxs-lookup"><span data-stu-id="679e2-120">With this feature, the DELETE operation on a key vault or key vault object is a soft-delete, effectively holding the resources for a given retention period, while giving the appearance that the object is deleted.</span></span> <span data-ttu-id="679e2-121">Além disso, o serviço fornece um mecanismo para recuperar o objeto excluído, basicamente, desfazendo a exclusão.</span><span class="sxs-lookup"><span data-stu-id="679e2-121">The service further provides a mechanism for recovering the deleted object, essentially undoing the deletion.</span></span> 

<span data-ttu-id="679e2-122">A exclusão reversível é um comportamento opcional do Key Vault e **não está habilitado por padrão** nesta versão.</span><span class="sxs-lookup"><span data-stu-id="679e2-122">Soft-delete is an optional Key Vault behavior and is **not enabled by default** in this release.</span></span> <span data-ttu-id="679e2-123">Para obter detalhes sobre como habilitar a exclusão reversível em seu cofre de chaves, consulte as diretrizes específicas na referência da interface de sua escolha, [Referência do Key Vault](https://docs.microsoft.com/azure/key-vault/).</span><span class="sxs-lookup"><span data-stu-id="679e2-123">For details on enabling soft-delete for your key vault, see the specific guidance in the reference for the interface of your choice, [Key Vault Reference](https://docs.microsoft.com/azure/key-vault/).</span></span>

### <a name="key-vault-recovery"></a><span data-ttu-id="679e2-124">Recuperação do cofre de chaves</span><span class="sxs-lookup"><span data-stu-id="679e2-124">Key vault recovery</span></span>

<span data-ttu-id="679e2-125">Ao excluir um cofre de chaves, o serviço cria um recurso de proxy na assinatura, adicionando metadados suficientes para recuperação.</span><span class="sxs-lookup"><span data-stu-id="679e2-125">Upon deleting a key vault, the service creates a proxy resource under the subscription, adding sufficient metadata for recovery.</span></span> <span data-ttu-id="679e2-126">O recurso de proxy é um objeto armazenado, disponível na mesma localização do cofre de chaves excluído.</span><span class="sxs-lookup"><span data-stu-id="679e2-126">The proxy resource is a stored object, available in the same location as the deleted key vault.</span></span> 

### <a name="key-vault-object-recovery"></a><span data-ttu-id="679e2-127">Recuperação de objetos do cofre de chaves</span><span class="sxs-lookup"><span data-stu-id="679e2-127">Key vault object recovery</span></span>

<span data-ttu-id="679e2-128">Depois de excluir um objeto do cofre de chaves, como uma chave, o serviço colocará o objeto em um estado excluído, tornando-o inacessível para todas as operações de recuperação.</span><span class="sxs-lookup"><span data-stu-id="679e2-128">Upon deleting a key vault object, such as a key, the service will place the object in a deleted state, thus making it inaccessible to any retrieval operations.</span></span> <span data-ttu-id="679e2-129">Nesse estado, o objeto do cofre de chaves só poderá ser listado, recuperado ou excluído permanentemente/de maneira forçada.</span><span class="sxs-lookup"><span data-stu-id="679e2-129">While in this state, the key vault object can only be listed, recovered, or forcefully/permanently deleted.</span></span> 

<span data-ttu-id="679e2-130">Ao mesmo tempo, o Key Vault agendará a exclusão dos dados subjacentes correspondentes ao cofre de chaves ou objeto do cofre de chaves excluído para execução após um intervalo de retenção predeterminado.</span><span class="sxs-lookup"><span data-stu-id="679e2-130">At the same time, Key Vault will schedule the deletion of the underlying data corresponding to the deleted key vault or key vault object for execution after a predetermined retention interval.</span></span> <span data-ttu-id="679e2-131">O registro DNS correspondente ao cofre também é mantido durante o intervalo de retenção.</span><span class="sxs-lookup"><span data-stu-id="679e2-131">The DNS record corresponding to the vault is also retained for the duration of the retention interval.</span></span>

### <a name="soft-delete-retention-period"></a><span data-ttu-id="679e2-132">Período de retenção da exclusão reversível</span><span class="sxs-lookup"><span data-stu-id="679e2-132">Soft-delete retention period</span></span>

<span data-ttu-id="679e2-133">Os recursos excluídos de maneira reversível são mantidos por um período definido de tempo, 90 dias.</span><span class="sxs-lookup"><span data-stu-id="679e2-133">Soft deleted resources are retained for a set period of time, 90 days.</span></span> <span data-ttu-id="679e2-134">Durante o intervalo de retenção da exclusão reversível, o seguinte se aplica:</span><span class="sxs-lookup"><span data-stu-id="679e2-134">During the soft-delete retention interval, the following apply:</span></span>

- <span data-ttu-id="679e2-135">É possível listar todos os cofres de chaves e objetos do cofre de chaves no estado de exclusão reversível de sua assinatura, bem como informações de exclusão e recuperação de acesso sobre eles.</span><span class="sxs-lookup"><span data-stu-id="679e2-135">You may list all of the key vaults and key vault objects in the soft-delete state for your subscription as well as access deletion and recovery information about them.</span></span>
    - <span data-ttu-id="679e2-136">Somente usuários com permissões especiais podem listar os cofres excluídos.</span><span class="sxs-lookup"><span data-stu-id="679e2-136">Only users with special permissions can list deleted vaults.</span></span> <span data-ttu-id="679e2-137">Recomendamos que nossos usuários criem uma função personalizada com essas permissões especiais para a manipulação dos cofres excluídos.</span><span class="sxs-lookup"><span data-stu-id="679e2-137">We recommend that our users create a custom role with these special permissions for handling deleted vaults.</span></span>
- <span data-ttu-id="679e2-138">Não é possível criar um cofre de chaves com o mesmo nome na mesma localização; do mesmo modo, não é possível criar um objeto do cofre de chaves em determinado cofre se esse cofre de chaves contém um objeto com o mesmo nome e que está no estado excluído</span><span class="sxs-lookup"><span data-stu-id="679e2-138">A key vault with the same name cannot be created in the same location; correspondingly, a key vault object cannot be created in a given vault if that key vault contains an object with the same name and which is in a deleted state</span></span> 
- <span data-ttu-id="679e2-139">Somente um usuário com privilégios específicos pode restaurar um cofre de chaves ou objeto do cofre de chaves emitindo um comando de recuperação no recurso de proxy correspondente.</span><span class="sxs-lookup"><span data-stu-id="679e2-139">Only a specifically privileged user may restore a key vault or key vault object by issuing a recover command on the corresponding proxy resource.</span></span>
    - <span data-ttu-id="679e2-140">O usuário, membro da função personalizada, que tem o privilégio para criar um cofre de chaves no grupo de recursos pode restaurar o cofre.</span><span class="sxs-lookup"><span data-stu-id="679e2-140">The user, member of the custom role, who has the privilege to create a key vault under the resource group can restore the vault.</span></span>
- <span data-ttu-id="679e2-141">Somente um usuário com privilégios específicos pode excluir por imposição um cofre de chaves ou objeto do cofre de chaves emitindo um comando de exclusão no recurso de proxy correspondente.</span><span class="sxs-lookup"><span data-stu-id="679e2-141">Only a specifically privileged user may forcibly delete a key vault or key vault object by issuing a delete command on the corresponding proxy resource.</span></span>

<span data-ttu-id="679e2-142">A menos que um cofre de chaves ou objeto do cofre de chaves seja recuperado, ao final do intervalo de retenção, o serviço realizará uma limpeza do cofre de chaves ou do objeto do cofre de chaves de excluídos de maneira reversível e de seu conteúdo.</span><span class="sxs-lookup"><span data-stu-id="679e2-142">Unless a key vault or key vault object is recovered, at the end of the retention interval the service performs a purge of the soft-deleted key vault or key vault object and its content.</span></span> <span data-ttu-id="679e2-143">A exclusão de recursos não pode ser reagendada.</span><span class="sxs-lookup"><span data-stu-id="679e2-143">Resource deletion may not be rescheduled.</span></span>

### <a name="permitted-purge"></a><span data-ttu-id="679e2-144">Limpeza permitida</span><span class="sxs-lookup"><span data-stu-id="679e2-144">Permitted purge</span></span>

<span data-ttu-id="679e2-145">A exclusão permanente, limpeza, de um cofre de chaves é possível por meio de uma operação POST no recurso de proxy e exige privilégios especiais.</span><span class="sxs-lookup"><span data-stu-id="679e2-145">Permanently deleting, purging, a key vault is possible via a POST operation on the proxy resource and requires special privileges.</span></span> <span data-ttu-id="679e2-146">Geralmente, apenas o proprietário da assinatura poderá limpar um cofre de chaves.</span><span class="sxs-lookup"><span data-stu-id="679e2-146">Generally, only the subscription owner will be able to purge a key vault.</span></span> <span data-ttu-id="679e2-147">A operação POST dispara a exclusão imediata e irrecuperável desse cofre.</span><span class="sxs-lookup"><span data-stu-id="679e2-147">The POST operation triggers the immediate and irrecoverable deletion of that vault.</span></span> 

<span data-ttu-id="679e2-148">Uma exceção é quando a assinatura do Azure foi marcada como *não excluível*.</span><span class="sxs-lookup"><span data-stu-id="679e2-148">An exception to this is the case when the Azure subscription has been marked as *undeletable*.</span></span> <span data-ttu-id="679e2-149">Neste caso, apenas o serviço pode executar a exclusão real e ele o fará como um processo agendado.</span><span class="sxs-lookup"><span data-stu-id="679e2-149">In this case, only the service may then perform the actual deletion, and does so as a scheduled process.</span></span> 



