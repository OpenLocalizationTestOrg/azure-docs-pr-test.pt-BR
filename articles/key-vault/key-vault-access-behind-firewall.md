---
title: "Acessar o Key Vault por trás do firewall | Microsoft Docs"
description: "Saiba como acessar o Azure Key Vault de um aplicativo por trás de um firewall"
services: key-vault
documentationcenter: 
author: amitbapat
manager: mbaldwin
tags: azure-resource-manager
ms.assetid: 50d21774-2ee1-4212-8995-570c9de603c5
ms.service: key-vault
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: hero-article
ms.date: 01/07/2017
ms.author: ambapat
ms.openlocfilehash: d00c6e0acf437d2bfc3c27e948f4646a6685b08f
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="access-azure-key-vault-behind-a-firewall"></a><span data-ttu-id="eb593-103">Acessar o Cofre de Chaves do Azure por trás de um firewall</span><span class="sxs-lookup"><span data-stu-id="eb593-103">Access Azure Key Vault behind a firewall</span></span>
### <a name="q-my-key-vault-client-application-needs-to-be-behind-a-firewall-what-ports-hosts-or-ip-addresses-should-i-open-to-enable-access-to-a-key-vault"></a><span data-ttu-id="eb593-104">P: meu aplicativo de cliente do cofre de chaves precisa estar por trás de um firewall.</span><span class="sxs-lookup"><span data-stu-id="eb593-104">Q: My key vault client application needs to be behind a firewall.</span></span> <span data-ttu-id="eb593-105">Quais portas, hosts ou endereços IP devo abrir para permitir o acesso a um cofre de chaves?</span><span class="sxs-lookup"><span data-stu-id="eb593-105">What ports, hosts, or IP addresses should I open to enable access to a key vault?</span></span>
<span data-ttu-id="eb593-106">Para acessar um cofre de chaves, o aplicativo de cliente do cofre de chaves precisa acessar vários pontos de extremidade para várias funcionalidades:</span><span class="sxs-lookup"><span data-stu-id="eb593-106">To access a key vault, your key vault client application has to access multiple endpoints for various functionalities:</span></span>

* <span data-ttu-id="eb593-107">Autenticação via Azure AD (Azure Active Directory)</span><span class="sxs-lookup"><span data-stu-id="eb593-107">Authentication via Azure Active Directory (Azure AD).</span></span>
* <span data-ttu-id="eb593-108">Gerenciamento do Cofre de Chaves do Azure.</span><span class="sxs-lookup"><span data-stu-id="eb593-108">Management of Azure Key Vault.</span></span> <span data-ttu-id="eb593-109">Isso inclui criar, ler, atualizar, excluir e definir políticas de acesso por meio do Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="eb593-109">This includes creating, reading, updating, deleting, and setting access policies through Azure Resource Manager.</span></span>
* <span data-ttu-id="eb593-110">O acesso e o gerenciamento de objetos (chaves e segredos) armazenados no cofre de chaves em si passa pelo ponto de extremidade específico do cofre de chaves (por exemplo, [https://yourvaultname.vault.azure.net](https://yourvaultname.vault.azure.net)).</span><span class="sxs-lookup"><span data-stu-id="eb593-110">Accessing and managing objects (keys and secrets) stored in Key Vault itself, going through the Key Vault-specific endpoint (for example, [https://yourvaultname.vault.azure.net](https://yourvaultname.vault.azure.net)).</span></span>  

<span data-ttu-id="eb593-111">Dependendo do ambiente e configuração, há algumas variações.</span><span class="sxs-lookup"><span data-stu-id="eb593-111">Depending on your configuration and environment, there are some variations.</span></span>   

## <a name="ports"></a><span data-ttu-id="eb593-112">Portas</span><span class="sxs-lookup"><span data-stu-id="eb593-112">Ports</span></span>
<span data-ttu-id="eb593-113">Todo o tráfego para o cofre de chaves de todas as três funções (autenticação, gerenciamento e acesso ao plano de dados) passa por HTTPS: porta 443.</span><span class="sxs-lookup"><span data-stu-id="eb593-113">All traffic to a key vault for all three functions (authentication, management, and data plane access) goes over HTTPS: port 443.</span></span> <span data-ttu-id="eb593-114">No entanto, ocasionalmente, haverá tráfego HTTP (porta 80) para CRL.</span><span class="sxs-lookup"><span data-stu-id="eb593-114">However, there will occasionally be HTTP (port 80) traffic for CRL.</span></span> <span data-ttu-id="eb593-115">Os clientes que dão suporte a OCSP não devem chegar a CRL, mas ocasionalmente podem chegar a [http://cdp1.public-trust.com/CRL/Omniroot2025.crl](http://cdp1.public-trust.com/CRL/Omniroot2025.crl).</span><span class="sxs-lookup"><span data-stu-id="eb593-115">Clients that support OCSP shouldn't reach CRL, but may occasionally reach [http://cdp1.public-trust.com/CRL/Omniroot2025.crl](http://cdp1.public-trust.com/CRL/Omniroot2025.crl).</span></span>  

## <a name="authentication"></a><span data-ttu-id="eb593-116">Autenticação</span><span class="sxs-lookup"><span data-stu-id="eb593-116">Authentication</span></span>
<span data-ttu-id="eb593-117">Os aplicativos cliente do cofre de chaves precisarão acessar os pontos de extremidade do Azure Active Directory para autenticação.</span><span class="sxs-lookup"><span data-stu-id="eb593-117">Key vault client applications will need to access Azure Active Directory endpoints for authentication.</span></span> <span data-ttu-id="eb593-118">O ponto de extremidade usado depende da configuração de locatário do Azure AD, o tipo de entidade (UPN ou entidade de serviço) e o tipo de conta (por exemplo, uma conta da Microsoft ou uma conta corporativa ou de estudante).</span><span class="sxs-lookup"><span data-stu-id="eb593-118">The endpoint used depends on the Azure AD tenant configuration, the type of principal (user principal or service principal), and the type of account--for example, a Microsoft account or a work or school account.</span></span>  

| <span data-ttu-id="eb593-119">Tipo de entidade</span><span class="sxs-lookup"><span data-stu-id="eb593-119">Principal type</span></span> | <span data-ttu-id="eb593-120">Ponto de extremidade:porta</span><span class="sxs-lookup"><span data-stu-id="eb593-120">Endpoint:port</span></span> |
| --- | --- |
| <span data-ttu-id="eb593-121">Usuário usando a conta da Microsoft</span><span class="sxs-lookup"><span data-stu-id="eb593-121">User using Microsoft account</span></span><br> <span data-ttu-id="eb593-122">(por exemplo, user@hotmail.com)</span><span class="sxs-lookup"><span data-stu-id="eb593-122">(for example, user@hotmail.com)</span></span> |<span data-ttu-id="eb593-123">**Global:**</span><span class="sxs-lookup"><span data-stu-id="eb593-123">**Global:**</span></span><br> <span data-ttu-id="eb593-124">login.microsoftonline.com:443</span><span class="sxs-lookup"><span data-stu-id="eb593-124">login.microsoftonline.com:443</span></span><br><br> <span data-ttu-id="eb593-125">**Azure China:**</span><span class="sxs-lookup"><span data-stu-id="eb593-125">**Azure China:**</span></span><br> <span data-ttu-id="eb593-126">login.chinacloudapi.cn:443</span><span class="sxs-lookup"><span data-stu-id="eb593-126">login.chinacloudapi.cn:443</span></span><br><br><span data-ttu-id="eb593-127">**Azure Governo dos EUA:**</span><span class="sxs-lookup"><span data-stu-id="eb593-127">**Azure US Government:**</span></span><br> <span data-ttu-id="eb593-128">login-us.microsoftonline.com:443</span><span class="sxs-lookup"><span data-stu-id="eb593-128">login-us.microsoftonline.com:443</span></span><br><br><span data-ttu-id="eb593-129">**Azure Alemanha:**</span><span class="sxs-lookup"><span data-stu-id="eb593-129">**Azure Germany:**</span></span><br> <span data-ttu-id="eb593-130">login.microsoftonline.de:443</span><span class="sxs-lookup"><span data-stu-id="eb593-130">login.microsoftonline.de:443</span></span><br><br> <span data-ttu-id="eb593-131">e</span><span class="sxs-lookup"><span data-stu-id="eb593-131">and</span></span> <br><span data-ttu-id="eb593-132">login.live.com:443</span><span class="sxs-lookup"><span data-stu-id="eb593-132">login.live.com:443</span></span> |
| <span data-ttu-id="eb593-133">Usuário ou entidade de serviço usando uma conta corporativa ou de Estudante com o Azure AD (por exemplo, user@contoso.com)</span><span class="sxs-lookup"><span data-stu-id="eb593-133">User or service principal using a work or school account with Azure AD (for example, user@contoso.com)</span></span> |<span data-ttu-id="eb593-134">**Global:**</span><span class="sxs-lookup"><span data-stu-id="eb593-134">**Global:**</span></span><br> <span data-ttu-id="eb593-135">login.microsoftonline.com:443</span><span class="sxs-lookup"><span data-stu-id="eb593-135">login.microsoftonline.com:443</span></span><br><br> <span data-ttu-id="eb593-136">**Azure China:**</span><span class="sxs-lookup"><span data-stu-id="eb593-136">**Azure China:**</span></span><br> <span data-ttu-id="eb593-137">login.chinacloudapi.cn:443</span><span class="sxs-lookup"><span data-stu-id="eb593-137">login.chinacloudapi.cn:443</span></span><br><br><span data-ttu-id="eb593-138">**Azure Governo dos EUA:**</span><span class="sxs-lookup"><span data-stu-id="eb593-138">**Azure US Government:**</span></span><br> <span data-ttu-id="eb593-139">login-us.microsoftonline.com:443</span><span class="sxs-lookup"><span data-stu-id="eb593-139">login-us.microsoftonline.com:443</span></span><br><br><span data-ttu-id="eb593-140">**Azure Alemanha:**</span><span class="sxs-lookup"><span data-stu-id="eb593-140">**Azure Germany:**</span></span><br> <span data-ttu-id="eb593-141">login.microsoftonline.de:443</span><span class="sxs-lookup"><span data-stu-id="eb593-141">login.microsoftonline.de:443</span></span> |
| <span data-ttu-id="eb593-142">Usuário ou entidade de serviço usando um trabalho ou conta de estudante, além de serviços de Federação do Active Directory (AD FS) ou outro ponto de extremidade federado (por exemplo, user@contoso.com)</span><span class="sxs-lookup"><span data-stu-id="eb593-142">User or service principal using a work or school account, plus Active Directory Federation Services (AD FS) or other federated endpoint (for example, user@contoso.com)</span></span> |<span data-ttu-id="eb593-143">Todos os pontos de extremidade de uma conta corporativa ou de estudante, além do AD FS ou outros pontos de extremidade federados</span><span class="sxs-lookup"><span data-stu-id="eb593-143">All endpoints for a work or school account, plus AD FS or other federated endpoints</span></span> |

<span data-ttu-id="eb593-144">Há outros cenários complexos possíveis.</span><span class="sxs-lookup"><span data-stu-id="eb593-144">There are other possible complex scenarios.</span></span> <span data-ttu-id="eb593-145">Confira [Fluxo de autenticação do Azure Active Directory](/documentation/articles/active-directory-authentication-scenarios/), [Integrar aplicativos com o Azure Active Directory](/documentation/articles/active-directory-integrating-applications/) e [Protocolos de autenticação do Active Directory](https://msdn.microsoft.com/library/azure/dn151124.aspx) para saber mais.</span><span class="sxs-lookup"><span data-stu-id="eb593-145">Refer to [Azure Active Directory Authentication Flow](/documentation/articles/active-directory-authentication-scenarios/), [Integrating Applications with Azure Active Directory](/documentation/articles/active-directory-integrating-applications/), and [Active Directory Authentication Protocols](https://msdn.microsoft.com/library/azure/dn151124.aspx) for additional information.</span></span>  

## <a name="key-vault-management"></a><span data-ttu-id="eb593-146">Gerenciamento do Cofre de Chaves</span><span class="sxs-lookup"><span data-stu-id="eb593-146">Key Vault management</span></span>
<span data-ttu-id="eb593-147">Para o gerenciamento do Cofre de Chaves (CRUD e configuração de política de acesso), o aplicativo cliente do cofre de chaves precisa acessar um ponto de extremidade do Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="eb593-147">For Key Vault management (CRUD and setting access policy), the key vault client application needs to access an Azure Resource Manager endpoint.</span></span>  

| <span data-ttu-id="eb593-148">Tipo de operação</span><span class="sxs-lookup"><span data-stu-id="eb593-148">Type of operation</span></span> | <span data-ttu-id="eb593-149">Ponto de extremidade:porta</span><span class="sxs-lookup"><span data-stu-id="eb593-149">Endpoint:port</span></span> |
| --- | --- |
| <span data-ttu-id="eb593-150">Operações do plano de controle do cofre de chaves</span><span class="sxs-lookup"><span data-stu-id="eb593-150">Key Vault control plane operations</span></span><br> <span data-ttu-id="eb593-151">por meio do Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="eb593-151">via Azure Resource Manager</span></span> |<span data-ttu-id="eb593-152">**Global:**</span><span class="sxs-lookup"><span data-stu-id="eb593-152">**Global:**</span></span><br> <span data-ttu-id="eb593-153">management.azure.com:443</span><span class="sxs-lookup"><span data-stu-id="eb593-153">management.azure.com:443</span></span><br><br> <span data-ttu-id="eb593-154">**Azure China:**</span><span class="sxs-lookup"><span data-stu-id="eb593-154">**Azure China:**</span></span><br> <span data-ttu-id="eb593-155">management.chinacloudapi.cn:443</span><span class="sxs-lookup"><span data-stu-id="eb593-155">management.chinacloudapi.cn:443</span></span><br><br> <span data-ttu-id="eb593-156">**Azure Governo dos EUA:**</span><span class="sxs-lookup"><span data-stu-id="eb593-156">**Azure US Government:**</span></span><br> <span data-ttu-id="eb593-157">management.usgovcloudapi.net:443</span><span class="sxs-lookup"><span data-stu-id="eb593-157">management.usgovcloudapi.net:443</span></span><br><br> <span data-ttu-id="eb593-158">**Azure Alemanha:**</span><span class="sxs-lookup"><span data-stu-id="eb593-158">**Azure Germany:**</span></span><br> <span data-ttu-id="eb593-159">management.microsoftazure.de:443</span><span class="sxs-lookup"><span data-stu-id="eb593-159">management.microsoftazure.de:443</span></span> |
| <span data-ttu-id="eb593-160">Graph API do Active Directory do Azure</span><span class="sxs-lookup"><span data-stu-id="eb593-160">Azure Active Directory Graph API</span></span> |<span data-ttu-id="eb593-161">**Global:**</span><span class="sxs-lookup"><span data-stu-id="eb593-161">**Global:**</span></span><br> <span data-ttu-id="eb593-162">graph.windows.net:443</span><span class="sxs-lookup"><span data-stu-id="eb593-162">graph.windows.net:443</span></span><br><br> <span data-ttu-id="eb593-163">**Azure China:**</span><span class="sxs-lookup"><span data-stu-id="eb593-163">**Azure China:**</span></span><br> <span data-ttu-id="eb593-164">graph.chinacloudapi.cn:443</span><span class="sxs-lookup"><span data-stu-id="eb593-164">graph.chinacloudapi.cn:443</span></span><br><br> <span data-ttu-id="eb593-165">**Azure Governo dos EUA:**</span><span class="sxs-lookup"><span data-stu-id="eb593-165">**Azure US Government:**</span></span><br> <span data-ttu-id="eb593-166">graph.windows.net:443</span><span class="sxs-lookup"><span data-stu-id="eb593-166">graph.windows.net:443</span></span><br><br> <span data-ttu-id="eb593-167">**Azure Alemanha:**</span><span class="sxs-lookup"><span data-stu-id="eb593-167">**Azure Germany:**</span></span><br> <span data-ttu-id="eb593-168">graph.cloudapi.de:443</span><span class="sxs-lookup"><span data-stu-id="eb593-168">graph.cloudapi.de:443</span></span> |

## <a name="key-vault-operations"></a><span data-ttu-id="eb593-169">Operações do cofre de chaves</span><span class="sxs-lookup"><span data-stu-id="eb593-169">Key Vault operations</span></span>
<span data-ttu-id="eb593-170">Para todas as operações de criptografia e gerenciamento de objetos (chaves e segredos) do cofre de chaves, o cliente do cofre de chaves precisa acessar o ponto de extremidade do cofre de chaves.</span><span class="sxs-lookup"><span data-stu-id="eb593-170">For all key vault object (keys and secrets) management and cryptographic operations, the key vault client needs to access the key vault endpoint.</span></span> <span data-ttu-id="eb593-171">O sufixo DNS do ponto de extremidade varia de acordo com o local de seu cofre de chaves.</span><span class="sxs-lookup"><span data-stu-id="eb593-171">The endpoint DNS suffix varies depending on the location of your key vault.</span></span> <span data-ttu-id="eb593-172">O ponto de extremidade do Cofre de Chaves está no formato: *nome-do-cofre*.*sufixo-dns-específico-da-região*, conforme descrito na tabela a seguir.</span><span class="sxs-lookup"><span data-stu-id="eb593-172">The key vault endpoint is of the format *vault-name*.*region-specific-dns-suffix*, as described in the following table.</span></span>  

| <span data-ttu-id="eb593-173">Tipo de operação</span><span class="sxs-lookup"><span data-stu-id="eb593-173">Type of operation</span></span> | <span data-ttu-id="eb593-174">Ponto de extremidade:porta</span><span class="sxs-lookup"><span data-stu-id="eb593-174">Endpoint:port</span></span> |
| --- | --- |
| <span data-ttu-id="eb593-175">Operações, incluindo operações criptográficas em chaves; criar, ler, atualizar e excluir chaves e segredos; definir ou obter marcas e outros atributos em objetos de cofre de chaves (chaves ou segredos)</span><span class="sxs-lookup"><span data-stu-id="eb593-175">Operations including cryptographic operations on keys; creating, reading, updating, and deleting keys and secrets; setting or getting tags and other attributes on key vault objects (keys or secrets)</span></span> |<span data-ttu-id="eb593-176">**Global:**</span><span class="sxs-lookup"><span data-stu-id="eb593-176">**Global:**</span></span><br> <span data-ttu-id="eb593-177">&lt;vault-name&gt;.vault.azure.net:443</span><span class="sxs-lookup"><span data-stu-id="eb593-177">&lt;vault-name&gt;.vault.azure.net:443</span></span><br><br> <span data-ttu-id="eb593-178">**Azure China:**</span><span class="sxs-lookup"><span data-stu-id="eb593-178">**Azure China:**</span></span><br> <span data-ttu-id="eb593-179">&lt;vault-name&gt;.vault.azure.cn:443</span><span class="sxs-lookup"><span data-stu-id="eb593-179">&lt;vault-name&gt;.vault.azure.cn:443</span></span><br><br> <span data-ttu-id="eb593-180">**Azure Governo dos EUA:**</span><span class="sxs-lookup"><span data-stu-id="eb593-180">**Azure US Government:**</span></span><br> <span data-ttu-id="eb593-181">&lt;vault-name&gt;.vault.usgovcloudapi.net:443</span><span class="sxs-lookup"><span data-stu-id="eb593-181">&lt;vault-name&gt;.vault.usgovcloudapi.net:443</span></span><br><br> <span data-ttu-id="eb593-182">**Azure Alemanha:**</span><span class="sxs-lookup"><span data-stu-id="eb593-182">**Azure Germany:**</span></span><br> <span data-ttu-id="eb593-183">&lt;vault-name&gt;.vault.microsoftazure.de:443</span><span class="sxs-lookup"><span data-stu-id="eb593-183">&lt;vault-name&gt;.vault.microsoftazure.de:443</span></span> |

## <a name="ip-address-ranges"></a><span data-ttu-id="eb593-184">Intervalos de endereços IP</span><span class="sxs-lookup"><span data-stu-id="eb593-184">IP address ranges</span></span>
<span data-ttu-id="eb593-185">O serviço de Cofre de Chaves usa outros recursos do Azure, como infraestrutura PaaS.</span><span class="sxs-lookup"><span data-stu-id="eb593-185">The Key Vault service uses other Azure resources like PaaS infrastructure.</span></span> <span data-ttu-id="eb593-186">Portanto, não é possível fornecer um intervalo específico de endereços IP que pontos de extremidade do serviço de Cofre de Chaves terão em determinado momento.</span><span class="sxs-lookup"><span data-stu-id="eb593-186">So it's not possible to provide a specific range of IP addresses that Key Vault service endpoints will have at any particular time.</span></span> <span data-ttu-id="eb593-187">Se o firewall dá suporte apenas a intervalos de endereços IP, confira o documento [Intervalos IP do Microsoft Azure Datacenter](https://www.microsoft.com/download/details.aspx?id=41653).</span><span class="sxs-lookup"><span data-stu-id="eb593-187">If your firewall supports only IP address ranges, refer to the [Microsoft Azure Datacenter IP Ranges](https://www.microsoft.com/download/details.aspx?id=41653) document.</span></span> <span data-ttu-id="eb593-188">Para autenticação e identidade (Azure Active Directory), seu aplicativo deve ser capaz de se conectar aos pontos de extremidade descritos em [Endereços de autenticação e identidade](https://support.office.com/article/Office-365-URLs-and-IP-address-ranges-8548a211-3fe7-47cb-abb1-355ea5aa88a2).</span><span class="sxs-lookup"><span data-stu-id="eb593-188">For authentication and identity (Azure Active Directory), your application must be able to connect to the endpoints described in [Authentication and identity addresses](https://support.office.com/article/Office-365-URLs-and-IP-address-ranges-8548a211-3fe7-47cb-abb1-355ea5aa88a2).</span></span>

## <a name="next-steps"></a><span data-ttu-id="eb593-189">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="eb593-189">Next steps</span></span>
<span data-ttu-id="eb593-190">Se você tiver dúvidas sobre o Cofre de Chaves, visite os [Fóruns do Cofre de Chaves do Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=AzureKeyVault).</span><span class="sxs-lookup"><span data-stu-id="eb593-190">If you have questions about Key Vault, visit the [Azure Key Vault Forums](https://social.msdn.microsoft.com/forums/azure/home?forum=AzureKeyVault).</span></span>

