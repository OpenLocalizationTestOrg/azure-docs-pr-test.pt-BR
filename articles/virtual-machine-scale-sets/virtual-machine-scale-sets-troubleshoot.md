---
title: "dimensionamento automático de aaaTroubleshoot com conjuntos de escala de máquinas virtuais | Microsoft Docs"
description: "Solução de problemas de dimensionamento automático com conjuntos de escala de máquina virtual. Entender os problemas comuns encontrados e como tooresolve-los."
services: virtual-machine-scale-sets
documentationcenter: 
author: gbowerman
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: c7d87b72-ee24-4e52-9377-a42f337f76fa
ms.service: virtual-machine-scale-sets
ms.workload: na
ms.tgt_pltfrm: windows
ms.devlang: na
ms.topic: article
ms.date: 10/28/2016
ms.author: guybo
ms.openlocfilehash: 4c9a70992348d87fb43646421a90a027bf400a17
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="troubleshooting-autoscale-with-virtual-machine-scale-sets"></a><span data-ttu-id="cc841-104">Solução de problemas do dimensionamento automático com conjuntos de escala de máquina virtual</span><span class="sxs-lookup"><span data-stu-id="cc841-104">Troubleshooting autoscale with Virtual Machine Scale Sets</span></span>
<span data-ttu-id="cc841-105">**Problema** – que você criou uma infraestrutura de dimensionamento automático no Azure Resource Manager usando conjuntos de escala de VM – por exemplo, ao implantar um modelo como este: https://github.com/Azure/azure-quickstart-templates/tree/master/201- garrafa de AutoEscala vmss – você tem suas regras de escala definidas e funciona muito bem, exceto que, independentemente de quanto é colocado no hello VMs de carga, não se preocupe dimensionamento automático.</span><span class="sxs-lookup"><span data-stu-id="cc841-105">**Problem** – you’ve created an autoscaling infrastructure in Azure Resource Manager using VM Scale Sets –  for example by deploying a template like this: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale  – you have your scale rules defined and it works great, except that no matter how much load you put on hello VMs, it won’t autoscale.</span></span>

## <a name="troubleshooting-steps"></a><span data-ttu-id="cc841-106">Etapas para solucionar problemas</span><span class="sxs-lookup"><span data-stu-id="cc841-106">Troubleshooting steps</span></span>
<span data-ttu-id="cc841-107">Algumas coisas tooconsider incluem:</span><span class="sxs-lookup"><span data-stu-id="cc841-107">Some things tooconsider include:</span></span>

* <span data-ttu-id="cc841-108">O número de núcleos cada VM tem e você estiver carregando cada núcleo? modelo de início rápido do Azure de exemplo Hello acima tem um script de do_work.php, que carrega um único núcleo.</span><span class="sxs-lookup"><span data-stu-id="cc841-108">How many cores does each VM have, and are you loading each core? hello example Azure Quickstart template above has a do_work.php script, which loads a single core.</span></span> <span data-ttu-id="cc841-109">Se você estiver usando uma VM maior do que um único núcleo de tamanho da VM como Standard_A1 ou D1 e em seguida, você precisaria toorun load várias vezes.</span><span class="sxs-lookup"><span data-stu-id="cc841-109">If you’re using a VM bigger than a single core VM size like Standard_A1 or D1 then you’d need toorun this load multiple times.</span></span> <span data-ttu-id="cc841-110">Verifique quantos núcleos suas VMs têm conferindo [Tamanhos para máquinas virtuais do Windows no Azure](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span><span class="sxs-lookup"><span data-stu-id="cc841-110">Check how many cores your VMs by reviewing [Sizes for Windows virtual machines in Azure](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span></span>
* <span data-ttu-id="cc841-111">Como muitas máquinas virtuais em Olá conjunto de escala de VM, você está fazendo o trabalho em cada um deles?</span><span class="sxs-lookup"><span data-stu-id="cc841-111">How many VMs in hello VM Scale Set, are you doing work on each one?</span></span>
  
    <span data-ttu-id="cc841-112">Um evento de expansão só ocorrerá quando Olá a média de CPU em **todos os** Olá VMs em um conjunto de escala excede Olá valor de limite, ao longo do tempo de saudação interno definido nas regras de AutoEscala hello.</span><span class="sxs-lookup"><span data-stu-id="cc841-112">A scale out event will only take place when hello average CPU across **all** hello VMs in a scale set exceeds hello threshold value, over hello time internal defined in hello autoscale rules.</span></span>
* <span data-ttu-id="cc841-113">Você perdeu algum evento de escala?</span><span class="sxs-lookup"><span data-stu-id="cc841-113">Did you miss any scale events?</span></span>
  
    <span data-ttu-id="cc841-114">Verifique os logs de auditoria de saudação em Olá portal do Azure para eventos de escala.</span><span class="sxs-lookup"><span data-stu-id="cc841-114">Check hello audit logs in hello Azure portal for scale events.</span></span> <span data-ttu-id="cc841-115">Pode ter ocorrido uma escala ou redução vertical que foi perdida.</span><span class="sxs-lookup"><span data-stu-id="cc841-115">Maybe there was a scale up and a scale down which was missed.</span></span> <span data-ttu-id="cc841-116">Você pode filtrar por “Escala”.</span><span class="sxs-lookup"><span data-stu-id="cc841-116">You can filter by “Scale”..</span></span>
  
    ![Logs de Auditoria][audit]
* <span data-ttu-id="cc841-118">Os limites de escala e redução são diferentes o suficiente?</span><span class="sxs-lookup"><span data-stu-id="cc841-118">Are your scale-in and scale-out thresholds sufficiently different?</span></span>
  
    <span data-ttu-id="cc841-119">Suponha que você defina uma regra tooscale out quando média de CPU é maior que 50% mais de 5 minutos e tooscale no quando a média de CPU for inferior a 50%.</span><span class="sxs-lookup"><span data-stu-id="cc841-119">Suppose you set a rule tooscale out when average CPU is greater than 50% over 5 minutes, and tooscale in when average CPU is less than 50%.</span></span> <span data-ttu-id="cc841-120">Isso faria com que um problema de "falta de sincronismo" quando o uso da CPU é o limite de fechamento toothis, com ações de escala Olá constantemente aumentar e diminuir o tamanho do conjunto de saudação.</span><span class="sxs-lookup"><span data-stu-id="cc841-120">This would cause a “flapping” problem when CPU usage is close toothis threshold, with scale actions constantly increasing and decreasing hello size of hello set.</span></span> <span data-ttu-id="cc841-121">Por isso, Olá AutoEscala serviço tenta tooprevent "oscilando", que podem se manifestar como dimensionamento não.</span><span class="sxs-lookup"><span data-stu-id="cc841-121">Because of this, hello autoscale service tries tooprevent “flapping”, which can manifest as not scaling.</span></span> <span data-ttu-id="cc841-122">Portanto, certifique-se de sua expansão e limites de escala são suficientemente diferente tooallow algum espaço entre o dimensionamento.</span><span class="sxs-lookup"><span data-stu-id="cc841-122">Therefore make sure your scale-out and scale-in thresholds are sufficiently different tooallow some space in between scaling.</span></span>
* <span data-ttu-id="cc841-123">Você criou seu próprio modelo JSON?</span><span class="sxs-lookup"><span data-stu-id="cc841-123">Did you write your own JSON template?</span></span>
  
    <span data-ttu-id="cc841-124">É fácil toomake erros, portanto iniciar com um modelo como Olá um acima do qual é aprovado toowork e fazer pequenas alterações incrementais.</span><span class="sxs-lookup"><span data-stu-id="cc841-124">It is easy toomake mistakes, so start with a template like hello one above which is proven toowork, and make small incremental changes.</span></span> 
* <span data-ttu-id="cc841-125">Você consegue aumentar ou reduzir horizontalmente?</span><span class="sxs-lookup"><span data-stu-id="cc841-125">Can you manually scale in or out?</span></span>
  
    <span data-ttu-id="cc841-126">Tente Olá reimplantação recurso conjunto de escala de VM com um número de saudação diferentes "capacidade" configuração toochange de máquinas virtuais manualmente.</span><span class="sxs-lookup"><span data-stu-id="cc841-126">Try redeploying hello VM Scale Set resource with a different “capacity” setting toochange hello number of VMs manually.</span></span> <span data-ttu-id="cc841-127">Um toodo do modelo de exemplo aqui: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing – talvez seja necessário tooedit Olá modelo toomake se ele tem Olá mesmo tamanho de máquina usando o conjunto de escala.</span><span class="sxs-lookup"><span data-stu-id="cc841-127">An example template toodo this is here: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing – you may need tooedit hello template toomake sure it has hello same machine size as your Scale Set is using.</span></span> <span data-ttu-id="cc841-128">Se com êxito é possível alterar o número de saudação de VMs manualmente, em seguida, você sabe Olá problema tooautoscale isolado.</span><span class="sxs-lookup"><span data-stu-id="cc841-128">If you can successfully change hello number of VMs manually, then you know hello problem is isolated tooautoscale.</span></span>
* <span data-ttu-id="cc841-129">Verifique seu Microsoft.Compute/virtualMachineScaleSet e recursos Insights Olá [Gerenciador de recursos do Azure](https://resources.azure.com/)</span><span class="sxs-lookup"><span data-stu-id="cc841-129">Check your Microsoft.Compute/virtualMachineScaleSet, and Microsoft.Insights resources in hello [Azure Resource Explorer](https://resources.azure.com/)</span></span>
  
    <span data-ttu-id="cc841-130">Este é um indispensáveis Solucionando problemas de ferramenta que mostra Olá o estado de seus recursos do Gerenciador de recursos do Azure.</span><span class="sxs-lookup"><span data-stu-id="cc841-130">This is an indispensable troubleshooting tool which shows you hello state of your Azure Resource Manager resources.</span></span> <span data-ttu-id="cc841-131">Clique em sua assinatura e examinar Olá grupo de recursos de solução de problemas.</span><span class="sxs-lookup"><span data-stu-id="cc841-131">Click on your subscription and look at hello Resource Group you are troubleshooting.</span></span> <span data-ttu-id="cc841-132">Em um provedor de recursos de computação Olá Observe Olá conjunto de escala de VM é criada e verifique Olá exibição de instância, que mostra Olá o estado de uma implantação.</span><span class="sxs-lookup"><span data-stu-id="cc841-132">Under hello Compute resource provider look at hello VM Scale Set you created and check hello Instance View, which shows you hello state of a deployment.</span></span> <span data-ttu-id="cc841-133">Verifique também a exibição de instância Olá de VMs em Olá conjunto de escala de VM.</span><span class="sxs-lookup"><span data-stu-id="cc841-133">Also check hello instance view of VMs in hello VM Scale Set.</span></span> <span data-ttu-id="cc841-134">Em seguida, vá para o provedor de recursos do hello Insights e verifique regras de AutoEscala Olá uma boas aparência.</span><span class="sxs-lookup"><span data-stu-id="cc841-134">Then go into hello Microsoft.Insights resource provider and check hello autoscale rules look good.</span></span>
* <span data-ttu-id="cc841-135">Olá extensão de diagnóstico está trabalhando e emissão de dados de desempenho?</span><span class="sxs-lookup"><span data-stu-id="cc841-135">Is hello Diagnostic extension working and emitting performance data?</span></span>
  
    <span data-ttu-id="cc841-136">**Atualização:** dimensionamento automático do Azure foi aprimorado toouse pipeline de métricas que não requer mais um toobe de extensão de diagnóstico instalado com base em um host.</span><span class="sxs-lookup"><span data-stu-id="cc841-136">**Update:** Azure autoscale has been enhanced toouse a host based metrics pipeline which no longer requires a diagnostics extension toobe installed.</span></span> <span data-ttu-id="cc841-137">Isso significa Olá Avançar alguns parágrafos já não se aplicam se você criar um aplicativo de dimensionamento automático usando o novo pipeline de saudação.</span><span class="sxs-lookup"><span data-stu-id="cc841-137">This means hello next few paragraphs no longer apply if you create an autoscaling application using hello new pipeline.</span></span> <span data-ttu-id="cc841-138">É um exemplo de modelos do Azure que tenha sido convertido toouse pipeline de host de saudação: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale.</span><span class="sxs-lookup"><span data-stu-id="cc841-138">An example of Azure templates which have been converted toouse hello host pipeline is: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale.</span></span> 
  
    <span data-ttu-id="cc841-139">Uso de métricas de baseado em host para dimensionamento automático é melhor para Olá motivos a seguir:</span><span class="sxs-lookup"><span data-stu-id="cc841-139">Using host based metrics for autoscale is better for hello following reasons:</span></span>
  
  * <span data-ttu-id="cc841-140">Menos partes móveis como nenhuma extensão de diagnóstico necessário toobe instalado.</span><span class="sxs-lookup"><span data-stu-id="cc841-140">Fewer moving parts as no diagnostics extensions need toobe installed.</span></span>
  * <span data-ttu-id="cc841-141">Modelos mais simples.</span><span class="sxs-lookup"><span data-stu-id="cc841-141">Simpler templates.</span></span> <span data-ttu-id="cc841-142">Basta adicione o modelo de conjunto de escala existentes do insights AutoEscala regras tooan.</span><span class="sxs-lookup"><span data-stu-id="cc841-142">Just add insights autoscale rules tooan existing scale set template.</span></span>
  * <span data-ttu-id="cc841-143">Relatórios mais confiáveis e inicialização mais rápida de novas VMs.</span><span class="sxs-lookup"><span data-stu-id="cc841-143">More reliable reporting and faster launching of new VMs.</span></span>
    
    <span data-ttu-id="cc841-144">Olá apenas os motivos que talvez você queira tookeep usando uma extensão de diagnóstica seria se você precisa de memória diagnóstico reporting/dimensionamento.</span><span class="sxs-lookup"><span data-stu-id="cc841-144">hello only reasons you might want tookeep using a diagnostic extension would be if you need memory diagnostics reporting/scaling.</span></span> <span data-ttu-id="cc841-145">Métricas baseadas em host não fornecem relatório de memória.</span><span class="sxs-lookup"><span data-stu-id="cc841-145">Host based metrics doesn't report memory.</span></span>
    
    <span data-ttu-id="cc841-146">Com isso em mente, execute somente restante Olá deste artigo se você ainda estiver usando extensões de diagnósticas para o dimensionamento automático.</span><span class="sxs-lookup"><span data-stu-id="cc841-146">With that in mind, only follow hello rest of this article if you are still using diagnostic extensions for your autoscaling.</span></span>
    
    <span data-ttu-id="cc841-147">Dimensionamento automático no Gerenciador de recursos do Azure pode funcionar (mas não precisa mais) por meio de uma extensão de VM chamada hello extensão de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="cc841-147">Autoscale in Azure Resource Manager can work (but no longer has to) by means of a VM extension called hello Diagnostics Extension.</span></span> <span data-ttu-id="cc841-148">Emite conta de armazenamento do desempenho dados tooa que você define no modelo de saudação.</span><span class="sxs-lookup"><span data-stu-id="cc841-148">It emits performance data tooa storage account you define in hello template.</span></span> <span data-ttu-id="cc841-149">Esses dados são agregados, em seguida, pelo serviço do Monitor do Azure hello.</span><span class="sxs-lookup"><span data-stu-id="cc841-149">This data is then aggregated by hello Azure Monitor service.</span></span>
    
    <span data-ttu-id="cc841-150">Se Olá serviço Insights não é possível ler dados de saudação VMs, ele deve toosend um email – por exemplo se Olá VMs, portanto, verifique seu email (Olá especificada ao criar hello conta do Azure).</span><span class="sxs-lookup"><span data-stu-id="cc841-150">If hello Insights service can’t read data from hello VMs, it is supposed toosend you an email – for example if hello VMs were down, so check your email (hello one you specified when creating hello Azure account).</span></span>
    
    <span data-ttu-id="cc841-151">Também pode ir e examinar dados saudação por conta própria.</span><span class="sxs-lookup"><span data-stu-id="cc841-151">You can also go and look at hello data yourself.</span></span> <span data-ttu-id="cc841-152">Examinar Olá conta de armazenamento do Azure usando um Gerenciador de nuvem.</span><span class="sxs-lookup"><span data-stu-id="cc841-152">Look at hello Azure storage account using a cloud explorer.</span></span> <span data-ttu-id="cc841-153">Por exemplo, usando Olá [Visual Studio Cloud Explorer](https://visualstudiogallery.msdn.microsoft.com/aaef6e67-4d99-40bc-aacf-662237db85a2), faça logon no e escolha Olá assinatura do Azure que você está usando e Olá nome referenciado no hello definição de extensão de diagnóstico em sua implantação de conta de armazenamento de diagnóstico modelo.</span><span class="sxs-lookup"><span data-stu-id="cc841-153">For example using hello [Visual Studio Cloud Explorer](https://visualstudiogallery.msdn.microsoft.com/aaef6e67-4d99-40bc-aacf-662237db85a2), log in and pick hello Azure subscription you’re using, and hello Diagnostics storage account name referenced in hello Diagnostics extension definition in your deployment template..</span></span>
    
    ![Gerenciador de Nuvem][explorer]
    
    <span data-ttu-id="cc841-155">Aqui, você verá uma série de tabelas onde os dados de saudação de cada VM estão sendo armazenados.</span><span class="sxs-lookup"><span data-stu-id="cc841-155">Here you will see a bunch of tables where hello data from each VM is being stored.</span></span> <span data-ttu-id="cc841-156">Colocar o Linux e Olá métrica de CPU como um exemplo, examine linhas mais recentes hello.</span><span class="sxs-lookup"><span data-stu-id="cc841-156">Taking Linux and hello CPU metric as an example, look at hello most recent rows.</span></span> <span data-ttu-id="cc841-157">Gerenciador de nuvem do Visual Studio Olá dá suporte a uma linguagem de consulta, você pode executar uma consulta como "Timestamp gt datetime'2016-02-02T21:20:00Z'" toomake-se de obter eventos mais recentes de saudação (supondo que o tempo é em UTC).</span><span class="sxs-lookup"><span data-stu-id="cc841-157">hello Visual Studio cloud explorer supports a query language so you can run a query like “Timestamp gt datetime’2016-02-02T21:20:00Z’” toomake sure you get hello most recent events (assume time is in UTC).</span></span> <span data-ttu-id="cc841-158">Dados Olá que consulte em existe correspondem toohello dimensionar regras configuradas por você?</span><span class="sxs-lookup"><span data-stu-id="cc841-158">Does hello data you see in there correspond toohello scale rules you set up?</span></span> <span data-ttu-id="cc841-159">O exemplo hello abaixo, Olá da CPU para a máquina 20 iniciado aumentando too100% ao longo de saudação últimos 5 minutos.</span><span class="sxs-lookup"><span data-stu-id="cc841-159">In hello example below, hello CPU for machine 20 started increasing too100% over hello last 5 minutes..</span></span>
    
    ![Tabelas de Armazenamento][tables]
    
    <span data-ttu-id="cc841-161">Se dados saudação não estiverem lá, isso significa problema Olá está com a extensão de diagnóstico Olá em execução no hello VMs.</span><span class="sxs-lookup"><span data-stu-id="cc841-161">If hello data is not there, then it implies hello problem is with hello diagnostic extension running in hello VMs.</span></span> <span data-ttu-id="cc841-162">Se dados saudação estiverem lá, significa que há um problema com as regras de escala, ou com o serviço de Insights hello.</span><span class="sxs-lookup"><span data-stu-id="cc841-162">If hello data is there, it implies there is either a problem with your scale rules, or with hello Insights service.</span></span> <span data-ttu-id="cc841-163">Verifique o [Status do Azure](https://azure.microsoft.com/status/).</span><span class="sxs-lookup"><span data-stu-id="cc841-163">Check [Azure Status](https://azure.microsoft.com/status/).</span></span>
    
    <span data-ttu-id="cc841-164">Depois de ter sido através dessas etapas, se você ainda estiver tendo problemas de dimensionamento automático tente fóruns Olá [MSDN](https://social.msdn.microsoft.com/forums/azure/home?category=windowsazureplatform%2Cazuremarketplace%2Cwindowsazureplatformctp), ou [estouro de pilha](http://stackoverflow.com/questions/tagged/azure), ou uma chamada de suporte de log.</span><span class="sxs-lookup"><span data-stu-id="cc841-164">Once you’ve been through these steps, if you are still having autoscale problems you could try hello forums on [MSDN](https://social.msdn.microsoft.com/forums/azure/home?category=windowsazureplatform%2Cazuremarketplace%2Cwindowsazureplatformctp), or [Stack overflow](http://stackoverflow.com/questions/tagged/azure), or log a support call.</span></span> <span data-ttu-id="cc841-165">Ser o modelo de saudação tooshare preparada e uma exibição de dados de desempenho de saudação.</span><span class="sxs-lookup"><span data-stu-id="cc841-165">Be prepared tooshare hello template and a view of hello performance data.</span></span>

[audit]: ./media/virtual-machine-scale-sets-troubleshoot/image3.png
[explorer]: ./media/virtual-machine-scale-sets-troubleshoot/image1.png
[tables]: ./media/virtual-machine-scale-sets-troubleshoot/image4.png
