---
title: "Trabalhando com conjuntos de dimensionamento grandes de máquinas virtuais do Azure | Microsoft Docs"
description: "O que você precisa saber para usar conjuntos de dimensionamento grandes de máquinas virtuais do Azure"
services: virtual-machine-scale-sets
documentationcenter: 
author: gbowerman
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 76ac7fd7-2e05-4762-88ca-3b499e87906e
ms.service: virtual-machine-scale-sets
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 2/7/2017
ms.author: guybo
ms.openlocfilehash: 9e9eae1623e55c1c05e97aa0b836819ce5dc16f9
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/03/2017
---
# <a name="working-with-large-virtual-machine-scale-sets"></a><span data-ttu-id="d3712-103">Trabalhando com conjuntos de dimensionamento grandes de máquinas virtuais</span><span class="sxs-lookup"><span data-stu-id="d3712-103">Working with large virtual machine scale sets</span></span>
<span data-ttu-id="d3712-104">Agora você pode criar [conjuntos de dimensionamento de máquina virtual](/azure/virtual-machine-scale-sets/) do Azure com uma capacidade de até 1.000 VMs.</span><span class="sxs-lookup"><span data-stu-id="d3712-104">You can now create Azure [virtual machine scale sets](/azure/virtual-machine-scale-sets/) with a capacity of up to 1,000 VMs.</span></span> <span data-ttu-id="d3712-105">Neste documento, um _conjunto de dimensionamento de máquinas virtuais grande_ é definido como um conjunto de dimensionamento capaz de ser redimensionado para mais de 100 VMs.</span><span class="sxs-lookup"><span data-stu-id="d3712-105">In this document, a _large virtual machine scale set_ is defined as a scale set capable of scaling to greater than 100 VMs.</span></span> <span data-ttu-id="d3712-106">Esse recurso é definido por uma propriedade de conjunto de dimensionamento (_singlePlacementGroup=False_).</span><span class="sxs-lookup"><span data-stu-id="d3712-106">This capability is set by a scale set property (_singlePlacementGroup=False_).</span></span> 

<span data-ttu-id="d3712-107">Certos aspectos de conjuntos de dimensionamento grandes, como domínios de falhas e balanceamento de carga, se comportam de maneira diferente de um conjunto de dimensionamento padrão.</span><span class="sxs-lookup"><span data-stu-id="d3712-107">Certain aspects of large scale sets, such as load balancing and fault domains behave differently to a standard scale set.</span></span> <span data-ttu-id="d3712-108">Este documento explica as características de conjuntos de dimensionamento grandes e descreve o que você precisa saber para usá-los com êxito nos aplicativos.</span><span class="sxs-lookup"><span data-stu-id="d3712-108">This document explains the characteristics of large scale sets, and describes what you need to know to successfully use them in your applications.</span></span> 

<span data-ttu-id="d3712-109">Uma abordagem comum para implantar a infraestrutura de nuvem em grande escala é criar um conjunto de _unidades de dimensionamento_, por exemplo, criando vários conjuntos de dimensionamento de VMs em várias VNETs e contas de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="d3712-109">A common approach for deploying cloud infrastructure at large scale is to create a set of _scale units_, for example by creating multiple VMs scale sets across multiple VNETs and storage accounts.</span></span> <span data-ttu-id="d3712-110">Essa abordagem fornece gerenciamento mais fácil em comparação com VMs únicas, e várias unidades de escala são úteis para muitos aplicativos, especialmente aqueles que exigem outros componentes empilháveis, como várias redes virtuais e pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="d3712-110">This approach provides easier management compared to single VMs, and multiple scale units are useful for many applications, particularly those that require other stackable components like multiple virtual networks and endpoints.</span></span> <span data-ttu-id="d3712-111">No entanto, se o aplicativo requer um único cluster grande, pode ser mais fácil implantar um único conjunto de dimensionamento com até 1.000 VMs.</span><span class="sxs-lookup"><span data-stu-id="d3712-111">If your application requires a single large cluster however, it can be more straightforward to deploy a single scale set of up to 1,000 VMs.</span></span> <span data-ttu-id="d3712-112">Cenários de exemplo incluem implantações de big data centralizadas ou grades de computação que exigem o gerenciamento simples de um grande pool de nós de trabalho.</span><span class="sxs-lookup"><span data-stu-id="d3712-112">Example scenarios include centralized big data deployments, or compute grids requiring simple management of a large pool of worker nodes.</span></span> <span data-ttu-id="d3712-113">Combinado aos [discos de dados conectados](virtual-machine-scale-sets-attached-disks.md) de conjunto de dimensionamento de VM, os conjuntos de dimensionamento de grande escala o habilitam a implantar uma infraestrutura escalonável que consiste em milhares de núcleos e petabytes de armazenamento, como uma única operação.</span><span class="sxs-lookup"><span data-stu-id="d3712-113">Combined with VM scale set [attached data disks](virtual-machine-scale-sets-attached-disks.md), large scale sets enable you to deploy a scalable infrastructure consisting of thousands of cores and petabytes of storage, as a single operation.</span></span>

## <a name="placement-groups"></a><span data-ttu-id="d3712-114">Grupos de posicionamento</span><span class="sxs-lookup"><span data-stu-id="d3712-114">Placement groups</span></span> 
<span data-ttu-id="d3712-115">O que torna um conjunto de dimensionamento _grande_ especial não é o número de VMs, mas o número de _grupos de posicionamento_ que ele contém.</span><span class="sxs-lookup"><span data-stu-id="d3712-115">What makes a _large_ scale set special is not the number of VMs, but the number of _placement groups_ it contains.</span></span> <span data-ttu-id="d3712-116">Um grupo de posicionamento é uma construção semelhante a um conjunto de disponibilidade do Azure, com seus próprios domínios de falha e domínios de atualização.</span><span class="sxs-lookup"><span data-stu-id="d3712-116">A placement group is a construct similar to an Azure availability set, with its own fault domains and upgrade domains.</span></span> <span data-ttu-id="d3712-117">Por padrão, um conjunto de dimensionamento consiste em um único grupo de posicionamento com tamanho máximo de 100 VMs.</span><span class="sxs-lookup"><span data-stu-id="d3712-117">By default, a scale set consists of a single placement group with a maximum size of 100 VMs.</span></span> <span data-ttu-id="d3712-118">Se uma propriedade de conjunto de dimensionamento chamada _singlePlacementGroup_ for definido como _false_, o conjunto de dimensionamento poderá ser composto de vários grupos de posicionamento e ter um intervalo de 0-1.000 VMs.</span><span class="sxs-lookup"><span data-stu-id="d3712-118">If a scale set property called _singlePlacementGroup_ is set to _false_, the scale set can be composed of multiple placement groups and has a range of 0-1,000 VMs.</span></span> <span data-ttu-id="d3712-119">Quando definido com o valor padrão _true_, um conjunto de dimensionamento é composto de um grupo único posicionamento e tem um intervalo de 0 a 100 VMs.</span><span class="sxs-lookup"><span data-stu-id="d3712-119">When set to the default value of _true_, a scale set is composed of a single placement group, and has a range of 0-100 VMs.</span></span>

## <a name="checklist-for-using-large-scale-sets"></a><span data-ttu-id="d3712-120">Lista de verificação para uso em conjuntos de dimensionamento grandes</span><span class="sxs-lookup"><span data-stu-id="d3712-120">Checklist for using large scale sets</span></span>
<span data-ttu-id="d3712-121">Para decidir se o aplicativo pode fazer uso eficiente de conjuntos de dimensionamento grandes, considere os seguintes requisitos:</span><span class="sxs-lookup"><span data-stu-id="d3712-121">To decide whether your application can make effective use of large scale sets, consider the following requirements:</span></span>

- <span data-ttu-id="d3712-122">Conjuntos de dimensionamento grandes exigem Discos Gerenciados do Azure.</span><span class="sxs-lookup"><span data-stu-id="d3712-122">Large scale sets require Azure Managed Disks.</span></span> <span data-ttu-id="d3712-123">Conjuntos de dimensionamento que não são criados com Discos Gerenciados exigem várias contas de armazenamento (uma para cada 20 VMs).</span><span class="sxs-lookup"><span data-stu-id="d3712-123">Scale sets that are not created with Managed Disks require multiple storage accounts (one for every 20 VMs).</span></span> <span data-ttu-id="d3712-124">Conjuntos de dimensionamento grandes são projetados para trabalhar exclusivamente com Discos Gerenciados para reduzir a sobrecarga de gerenciamento de armazenamento e evitar o risco de execução em limites de assinatura para contas de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="d3712-124">Large scale sets are designed to work exclusively with Managed Disks to reduce your storage management overhead, and to avoid the risk of running into subscription limits for storage accounts.</span></span> <span data-ttu-id="d3712-125">Se você não usar discos gerenciados, o conjunto de dimensionamento será limitado a 100 VMs.</span><span class="sxs-lookup"><span data-stu-id="d3712-125">If you do not use Managed Disks, your scale set is limited to 100 VMs.</span></span>
- <span data-ttu-id="d3712-126">Conjuntos de dimensionamento criados com base em imagens do Azure Marketplace podem ser dimensionados para até 1.000 VMs.</span><span class="sxs-lookup"><span data-stu-id="d3712-126">Scale sets created from Azure Marketplace images can scale up to 1,000 VMs.</span></span>
- <span data-ttu-id="d3712-127">Conjuntos de dimensionamento criados com base em imagens personalizadas (imagens de VM que você cria e carrega por conta própria) atualmente podem ser dimensionados para até 100 VMs.</span><span class="sxs-lookup"><span data-stu-id="d3712-127">Scale sets created from custom images (VM images you create and upload yourself) can currently scale up to 100 VMs.</span></span>
- <span data-ttu-id="d3712-128">O balanceamento de carga da camada 4 com o Azure Load Balancer ainda não tem suporte em conjuntos de dimensionamento compostos de vários grupos de posicionamento.</span><span class="sxs-lookup"><span data-stu-id="d3712-128">Layer-4 load balancing with the Azure Load Balancer is not yet supported for scale sets composed of multiple placement groups.</span></span> <span data-ttu-id="d3712-129">Se precisar usar o Azure Load Balancer, verifique se o conjunto de dimensionamento está configurado para usar um único grupo de posicionamento, que é a configuração padrão.</span><span class="sxs-lookup"><span data-stu-id="d3712-129">If you need to use the Azure Load Balancer make sure the scale set is configured to use a single placement group, which is the default setting.</span></span>
- <span data-ttu-id="d3712-130">O balanceamento de carga da camada 7 com o Gateway de Aplicativo do Azure tem suporte para todos os conjuntos de dimensionamento.</span><span class="sxs-lookup"><span data-stu-id="d3712-130">Layer-7 load balancing with the Azure Application Gateway is supported for all scale sets.</span></span>
- <span data-ttu-id="d3712-131">Um conjunto de dimensionamento é definido com uma única sub-rede. Verifique se a sub-rede tem um espaço de endereço grande o suficiente para todas as VMs de que você precisa.</span><span class="sxs-lookup"><span data-stu-id="d3712-131">A scale set is defined with a single subnet - make sure your subnet has an address space large enough for all the VMs you need.</span></span> <span data-ttu-id="d3712-132">Por padrão, um conjunto de dimensionamento superprovisiona (cria VMs extras no momento da implantação ou expansão, pelas quais você não é cobrado) para melhorar o desempenho e a confiabilidade da implantação.</span><span class="sxs-lookup"><span data-stu-id="d3712-132">By default a scale set overprovisions (creates extra VMs at deployment time or when scaling out, which you are not charged for) to improve deployment reliability and performance.</span></span> <span data-ttu-id="d3712-133">Permita um espaço de endereço 20% maior do que o número de VMs para as quais você planeja dimensionar.</span><span class="sxs-lookup"><span data-stu-id="d3712-133">Allow for an address space 20% greater than the number of VMs you plan to scale to.</span></span>
- <span data-ttu-id="d3712-134">Se estiver planejando implantar várias VMs, seus limites de cota de Núcleos de computação precisarão ser aumentados.</span><span class="sxs-lookup"><span data-stu-id="d3712-134">If you are planning to deploy many VMs, your Compute core quota limits may need to be increased.</span></span>
- <span data-ttu-id="d3712-135">Domínios de falha e domínios de atualização só são consistentes dentro de um grupo de posicionamento.</span><span class="sxs-lookup"><span data-stu-id="d3712-135">Fault domains and upgrade domains are only consistent within a placement group.</span></span> <span data-ttu-id="d3712-136">Essa arquitetura não altera a disponibilidade geral do conjunto de dimensionamento, pois as VMs são distribuídas uniformemente por hardware físico distinto, mas significa que, se você precisar garantir que duas VMs estejam em um hardware diferente, verifique se elas estão em domínios de falha diferentes no mesmo grupo de posicionamento.</span><span class="sxs-lookup"><span data-stu-id="d3712-136">This architecture does not change the overall availability of a scale set, as VMs are evenly distributed across distinct physical hardware, but it does means that if you need to guarantee two VMs are on different hardware, make sure they are in different fault domains in the same placement group.</span></span> <span data-ttu-id="d3712-137">A ID de grupo de posicionamento e o domínio de falhas são mostrados na _exibição da instância_ de uma VM de conjunto de dimensionamento.</span><span class="sxs-lookup"><span data-stu-id="d3712-137">Fault domain and placement group ID are shown in the _instance view_ of a scale set VM.</span></span> <span data-ttu-id="d3712-138">Você pode exibir a instância do modo de exibição de uma VM de conjunto de dimensionamento no [Gerenciador de Recursos do Azure](https://resources.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="d3712-138">You can view the instance view of a scale set VM in the [Azure Resource Explorer](https://resources.azure.com/).</span></span>


## <a name="creating-a-large-scale-set"></a><span data-ttu-id="d3712-139">Criando um conjunto de dimensionamento grande</span><span class="sxs-lookup"><span data-stu-id="d3712-139">Creating a large scale set</span></span>
<span data-ttu-id="d3712-140">Ao criar um conjunto de dimensionamento no portal do Azure, você pode permitir que ele seja dimensionado para vários grupos de posicionamento definindo a opção _Limite para um grupo posicionamento de único_ como _Falso_ na folha _Noções básicas_.</span><span class="sxs-lookup"><span data-stu-id="d3712-140">When you create a scale set in the Azure portal, you can allow it to scale to multiple placement groups by setting the _Limit to a single placement group_ option to _False_ in the _Basics_ blade.</span></span> <span data-ttu-id="d3712-141">Com essa opção definida como _Falso_, você pode especificar um valor de _contagem de instâncias_ de até 1.000.</span><span class="sxs-lookup"><span data-stu-id="d3712-141">With this option set to _False_, you can specify an _Instance count_ value of up to 1,000.</span></span>

![](./media/virtual-machine-scale-sets-placement-groups/portal-large-scale.png)

<span data-ttu-id="d3712-142">Você pode criar um conjunto de dimensionamento grande de VM usando o comando da [CLI do Azure](https://github.com/Azure/azure-cli) _az vmss create_.</span><span class="sxs-lookup"><span data-stu-id="d3712-142">You can create a large VM scale set using the [Azure CLI](https://github.com/Azure/azure-cli) _az vmss create_ command.</span></span> <span data-ttu-id="d3712-143">Esse comando define padrões inteligentes, como tamanho da sub-rede com base no argumento _instance-count_:</span><span class="sxs-lookup"><span data-stu-id="d3712-143">This command sets intelligent defaults such as subnet size based on the _instance-count_ argument:</span></span>

```bash
az group create -l southcentralus -n biginfra
az vmss create -g biginfra -n bigvmss --image ubuntults --instance-count 1000
```
<span data-ttu-id="d3712-144">Observe que o comando _vmss create_ usará determinados valores de configuração como padrão se você não especificá-los.</span><span class="sxs-lookup"><span data-stu-id="d3712-144">Note that the _vmss create_ command defaults certain configuration values if you do not specify them.</span></span> <span data-ttu-id="d3712-145">Para ver as opções disponíveis que você pode substituir, experimente:</span><span class="sxs-lookup"><span data-stu-id="d3712-145">To see the available options that you can override, try:</span></span>
```bash
az vmss create --help
```

<span data-ttu-id="d3712-146">Se estiver criando um conjunto de dimensionamento grande por meio da composição de um modelo do Azure Resource Manager, verifique se o modelo cria um conjunto de dimensionamento com base em Discos Gerenciados do Azure.</span><span class="sxs-lookup"><span data-stu-id="d3712-146">If you are creating a large scale set by composing an Azure Resource Manager template, make sure the template creates a scale set based on Azure Managed Disks.</span></span> <span data-ttu-id="d3712-147">Você pode definir a propriedade _singlePlacementGroup_ como _false_ na seção _Propriedades_ do recurso _Microsoft.Compute/virtualMAchineScaleSets_.</span><span class="sxs-lookup"><span data-stu-id="d3712-147">You can set the _singlePlacementGroup_ property to _false_ in the _properties_ section of the _Microsoft.Compute/virtualMAchineScaleSets_ resource.</span></span> <span data-ttu-id="d3712-148">O seguinte fragmento JSON mostra o início de um modelo de conjunto de dimensionamento, incluindo a capacidade de 1.000 VMs e a configuração _"singlePlacementGroup": false_:</span><span class="sxs-lookup"><span data-stu-id="d3712-148">The following JSON fragment shows the beginning of a scale set template, including the 1,000 VM capacity and the _"singlePlacementGroup" : false_ setting:</span></span>
```json
{
  "type": "Microsoft.Compute/virtualMachineScaleSets",
  "location": "australiaeast",
  "name": "bigvmss",
  "sku": {
    "name": "Standard_DS1_v2",
    "tier": "Standard",
    "capacity": 1000
  },
  "properties": {
    "singlePlacementGroup": false,
    "upgradePolicy": {
      "mode": "Automatic"
    }
```
<span data-ttu-id="d3712-149">Para obter um exemplo completo de modelo de conjunto de dimensionamento grande, confira [https://github.com/gbowerman/azure-myriad/blob/master/bigtest/bigbottle.json](https://github.com/gbowerman/azure-myriad/blob/master/bigtest/bigbottle.json).</span><span class="sxs-lookup"><span data-stu-id="d3712-149">For a complete example of a large scale set template, refer to [https://github.com/gbowerman/azure-myriad/blob/master/bigtest/bigbottle.json](https://github.com/gbowerman/azure-myriad/blob/master/bigtest/bigbottle.json).</span></span>

## <a name="converting-an-existing-scale-set-to-span-multiple-placement-groups"></a><span data-ttu-id="d3712-150">Converter um conjunto de dimensionamento existente para abranger vários grupos de posicionamento</span><span class="sxs-lookup"><span data-stu-id="d3712-150">Converting an existing scale set to span multiple placement groups</span></span>
<span data-ttu-id="d3712-151">Para tornar um conjunto de dimensionamento de VM existente capaz de ser redimensionado para mais de 100 VMs, você precisa alterar a propriedade _singplePlacementGroup_ para _false_ no modelo de conjunto de dimensionamento.</span><span class="sxs-lookup"><span data-stu-id="d3712-151">To make an existing VM scale set capable of scaling to more than 100 VMs, you need to change the _singplePlacementGroup_ property to _false_ in the scale set model.</span></span> <span data-ttu-id="d3712-152">Você pode testar a alteração dessa propriedade com o [Gerenciador de Recursos do Azure](https://resources.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="d3712-152">You can test changing this property with the [Azure Resource Explorer](https://resources.azure.com/).</span></span> <span data-ttu-id="d3712-153">Localize um conjunto de dimensionamento existente, selecione _Editar_ e altere a propriedade _singlePlacementGroup_.</span><span class="sxs-lookup"><span data-stu-id="d3712-153">Find an existing scale set, select _Edit_ and change the _singlePlacementGroup_ property.</span></span> <span data-ttu-id="d3712-154">Se não vir essa propriedade, talvez você esteja exibindo o conjunto de dimensionamento com uma versão mais antiga da API Microsoft.Compute.</span><span class="sxs-lookup"><span data-stu-id="d3712-154">If you do not see this property, you may be viewing the scale set with an older version of the Microsoft.Compute API.</span></span>

>[!NOTE] 
<span data-ttu-id="d3712-155">Você pode alterar um conjunto de dimensionamento de oferecer suporte a apenas um único grupo de posicionamento (o comportamento padrão) para dar suporte a vários grupos de posicionamento, mas não é possível fazer o oposto.</span><span class="sxs-lookup"><span data-stu-id="d3712-155">You can change a scale set from supporting a single placement group only (the default behavior) to a supporting multiple placement groups, but you cannot convert the other way around.</span></span> <span data-ttu-id="d3712-156">Portanto, entenda as propriedades de conjuntos de dimensionamento grandes antes da conversão.</span><span class="sxs-lookup"><span data-stu-id="d3712-156">Therefore make sure you understand the properties of large scale sets before converting.</span></span> <span data-ttu-id="d3712-157">Em particular, verifique se você não precisa de balanceamento de carga da camada 4 com o Azure Load Balancer.</span><span class="sxs-lookup"><span data-stu-id="d3712-157">In particular, make sure you do not need layer-4 load balancing with the Azure Load Balancer.</span></span>


