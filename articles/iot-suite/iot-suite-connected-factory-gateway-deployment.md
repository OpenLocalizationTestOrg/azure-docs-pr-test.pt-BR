---
title: "aaaDeploy o Azure IoT Suite conectado gateway fábrica | Microsoft Docs"
description: "Como toodeploy um gateway no Windows ou Linux toohello de conectividade tooenable conectadas fábrica pré-configurado a solução."
services: 
suite: iot-suite
documentationcenter: na
author: dominicbetts
manager: timlt
editor: 
ms.service: iot-suite
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/24/2017
ms.author: dobett
ms.openlocfilehash: 72436dec60eda0de20143f362fe740b0c4412f36
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="deploy-a-gateway-on-windows-or-linux-for-hello-connected-factory-preconfigured-solution"></a><span data-ttu-id="fe006-103">Implantar um gateway no Windows ou Linux para solução de fábrica pré-configurado Olá conectado</span><span class="sxs-lookup"><span data-stu-id="fe006-103">Deploy a gateway on Windows or Linux for hello connected factory preconfigured solution</span></span>

<span data-ttu-id="fe006-104">Olá software necessário toodeploy um gateway para a solução de fábrica pré-configurado Olá conectado tem dois componentes:</span><span class="sxs-lookup"><span data-stu-id="fe006-104">hello software required toodeploy a gateway for hello connected factory preconfigured solution has two components:</span></span>

* <span data-ttu-id="fe006-105">Olá *OPC Proxy* estabelece uma conexão tooIoT Hub.</span><span class="sxs-lookup"><span data-stu-id="fe006-105">hello *OPC Proxy* establishes a connection tooIoT Hub.</span></span> <span data-ttu-id="fe006-106">Olá *OPC Proxy* , em seguida, aguarda o comando e controle de mensagens de saudação integrado OPC navegador que é executado no portal de solução de fábrica conectado hello.</span><span class="sxs-lookup"><span data-stu-id="fe006-106">hello *OPC Proxy* then waits for command and control messages from hello integrated OPC Browser that runs in hello connected factory solution portal.</span></span>
* <span data-ttu-id="fe006-107">Olá *OPC publicador* conecta tooexisting local OPC UA servidores e encaminha mensagens de telemetria deles tooIoT Hub.</span><span class="sxs-lookup"><span data-stu-id="fe006-107">hello *OPC Publisher* connects tooexisting on-premises OPC UA servers and forwards telemetry messages from them tooIoT Hub.</span></span>

<span data-ttu-id="fe006-108">Ambos os componentes são de código livre e estão disponíveis como origem no GitHub e nos contêineres do Docker:</span><span class="sxs-lookup"><span data-stu-id="fe006-108">Both components are open-source and are available as source on GitHub and as Docker containers:</span></span>

| <span data-ttu-id="fe006-109">GitHub</span><span class="sxs-lookup"><span data-stu-id="fe006-109">GitHub</span></span> | <span data-ttu-id="fe006-110">DockerHub</span><span class="sxs-lookup"><span data-stu-id="fe006-110">DockerHub</span></span> |
| ------ | --------- |
| <span data-ttu-id="fe006-111">[Publicador OPC][lnk-publisher-github]</span><span class="sxs-lookup"><span data-stu-id="fe006-111">[OPC Publisher][lnk-publisher-github]</span></span> | <span data-ttu-id="fe006-112">[Publicador OPC][lnk-publisher-docker]</span><span class="sxs-lookup"><span data-stu-id="fe006-112">[OPC Publisher][lnk-publisher-docker]</span></span> |
| <span data-ttu-id="fe006-113">[Proxy OPC][lnk-proxy-github]</span><span class="sxs-lookup"><span data-stu-id="fe006-113">[OPC Proxy][lnk-proxy-github]</span></span> | <span data-ttu-id="fe006-114">[Proxy OPC][lnk-proxy-docker]</span><span class="sxs-lookup"><span data-stu-id="fe006-114">[OPC Proxy][lnk-proxy-docker]</span></span> |

<span data-ttu-id="fe006-115">Nenhum endereço IP de público ou falhas no firewall do gateway Olá são necessárias para o componente.</span><span class="sxs-lookup"><span data-stu-id="fe006-115">No public-facing IP address or holes in hello gateway firewall are required for either component.</span></span> <span data-ttu-id="fe006-116">Olá OPC Proxy e o publicador de OPC usam somente saídas portas 443, 5671 e 8883.</span><span class="sxs-lookup"><span data-stu-id="fe006-116">hello OPC Proxy and OPC Publisher use only outbound ports 443, 5671, and 8883.</span></span>

<span data-ttu-id="fe006-117">Olá etapas neste artigo mostram como toodeploy um gateway usando o Docker [Windows](#windows-deployment) ou [Linux](#linux-deployment).</span><span class="sxs-lookup"><span data-stu-id="fe006-117">hello steps in this article show you how toodeploy a gateway using Docker on either [Windows](#windows-deployment) or [Linux](#linux-deployment).</span></span> <span data-ttu-id="fe006-118">gateway de Olá permite que a solução de fábrica pré-configurado conectividade toohello conectado.</span><span class="sxs-lookup"><span data-stu-id="fe006-118">hello gateway enables connectivity toohello connected factory preconfigured solution.</span></span>

> [!NOTE]
> <span data-ttu-id="fe006-119">Olá gateway software que é executado no contêiner do Docker Olá [Azure IoT borda].</span><span class="sxs-lookup"><span data-stu-id="fe006-119">hello gateway software that runs in hello Docker container is [Azure IoT Edge].</span></span>

## <a name="windows-deployment"></a><span data-ttu-id="fe006-120">Implantação no Windows</span><span class="sxs-lookup"><span data-stu-id="fe006-120">Windows deployment</span></span>

> [!NOTE]
> <span data-ttu-id="fe006-121">Se você ainda não tem um dispositivo de gateway, a Microsoft aconselha a comprar um gateway comercial de um de nossos parceiros.</span><span class="sxs-lookup"><span data-stu-id="fe006-121">If you don't yet have a gateway device, Microsoft recommends you buy a commercial gateway from one of our partners.</span></span> <span data-ttu-id="fe006-122">Visite Olá [catálogo de dispositivo IoT do Azure] para obter uma lista de dispositivos de gateway compatíveis com hello conectado a solução de fábrica.</span><span class="sxs-lookup"><span data-stu-id="fe006-122">Visit hello [Azure IoT device catalog] for a list of gateway devices compatible with hello connected factory solution.</span></span> <span data-ttu-id="fe006-123">Siga as instruções de saudação que vêm com hello dispositivo tooset o gateway de saudação.</span><span class="sxs-lookup"><span data-stu-id="fe006-123">Follow hello instructions that come with hello device tooset up hello gateway.</span></span> <span data-ttu-id="fe006-124">Como alternativa, use Olá seguindo as instruções toomanually definir um dos seus gateways existentes.</span><span class="sxs-lookup"><span data-stu-id="fe006-124">Alternatively, use hello following instructions toomanually set up one of your existing gateways.</span></span>

### <a name="install-docker"></a><span data-ttu-id="fe006-125">Instalar o Docker</span><span class="sxs-lookup"><span data-stu-id="fe006-125">Install Docker</span></span>

<span data-ttu-id="fe006-126">Instale o [Docker para Windows] no seu dispositivo de gateway baseado no Windows.</span><span class="sxs-lookup"><span data-stu-id="fe006-126">Install [Docker for Windows] on your Windows-based gateway device.</span></span> <span data-ttu-id="fe006-127">Durante a instalação do Windows Docker, selecione uma unidade no seu tooshare da máquina de host com o Docker.</span><span class="sxs-lookup"><span data-stu-id="fe006-127">During Windows Docker setup, select a drive on your host machine tooshare with Docker.</span></span> <span data-ttu-id="fe006-128">Olá captura de tela mostra a unidade Olá D no seu sistema Windows de compartilhamento a seguir:</span><span class="sxs-lookup"><span data-stu-id="fe006-128">hello following screenshot shows sharing hello D drive on your Windows system:</span></span>

![Instalar o Docker][img-install-docker]

<span data-ttu-id="fe006-130">Em seguida, crie uma pasta chamada **docker** na raiz de saudação da saudação unidade compartilhada.</span><span class="sxs-lookup"><span data-stu-id="fe006-130">Then create a folder called **docker** in hello root of hello shared drive.</span></span>
<span data-ttu-id="fe006-131">Você também pode executar essa etapa depois de instalar o docker Olá **configurações** menu.</span><span class="sxs-lookup"><span data-stu-id="fe006-131">You can also perform this step after installing docker from hello **Settings** menu.</span></span>

### <a name="configure-hello-gateway"></a><span data-ttu-id="fe006-132">Configurar o gateway de saudação</span><span class="sxs-lookup"><span data-stu-id="fe006-132">Configure hello gateway</span></span>

1. <span data-ttu-id="fe006-133">Você precisa Olá **iothubowner** cadeia de caracteres de conexão de seu Azure IoT Suite conectado fábrica implantação toocomplete Olá gateway implantação.</span><span class="sxs-lookup"><span data-stu-id="fe006-133">You need hello **iothubowner** connection string of your Azure IoT Suite connected factory deployment toocomplete hello gateway deployment.</span></span> <span data-ttu-id="fe006-134">Em Olá [portal do Azure], navegar tooyour IoT Hub no grupo de recursos de saudação criado quando você implantou a solução de fábrica Olá conectado.</span><span class="sxs-lookup"><span data-stu-id="fe006-134">In hello [Azure portal], navigate tooyour IoT Hub in hello resource group created when you deployed hello connected factory solution.</span></span> <span data-ttu-id="fe006-135">Clique em **políticas de acesso compartilhado** tooaccess Olá **iothubowner** cadeia de caracteres de conexão:</span><span class="sxs-lookup"><span data-stu-id="fe006-135">Click **Shared access policies** tooaccess hello **iothubowner** connection string:</span></span>

    ![Localize Olá cadeia de caracteres de conexão de IoT Hub][img-hub-connection]

    <span data-ttu-id="fe006-137">Saudação de cópia **cadeia de caracteres de Conexão - chave primária** valor.</span><span class="sxs-lookup"><span data-stu-id="fe006-137">Copy hello **Connection string--primary key** value.</span></span>

1. <span data-ttu-id="fe006-138">Configurar o gateway de saudação para o IoT Hub executando módulos de gateway Olá dois **quando** em um prompt de comando com:</span><span class="sxs-lookup"><span data-stu-id="fe006-138">Configure hello gateway for your IoT Hub by running hello two gateway modules **once** from a command prompt with:</span></span>

    `docker run -it --rm -h <ApplicationName> -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v //D/docker:/root/.dotnet/corefx/cryptography/x509stores microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName> "<IoTHubOwnerConnectionString>"`

    `docker run -it --rm -v //D/docker:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -i -c "<IoTHubOwnerConnectionString>" -D /mapped/cs.db`

    * <span data-ttu-id="fe006-139">**&lt;ApplicationName&gt;**  é Olá nome toogive tooyour OPC UA publicador em formato de saudação **publisher.&lt; o nome de domínio totalmente qualificado&gt;**.</span><span class="sxs-lookup"><span data-stu-id="fe006-139">**&lt;ApplicationName&gt;** is hello name toogive tooyour OPC UA Publisher in hello format **publisher.&lt;your fully qualified domain name&gt;**.</span></span> <span data-ttu-id="fe006-140">Por exemplo, se sua rede de fábrica é chamado **myfactorynetwork.com**, Olá **ApplicationName** valor é **publisher.myfactorynetwork.com**.</span><span class="sxs-lookup"><span data-stu-id="fe006-140">For example, if your factory network is called **myfactorynetwork.com**, hello **ApplicationName** value is **publisher.myfactorynetwork.com**.</span></span>
    * <span data-ttu-id="fe006-141">**&lt;IoTHubOwnerConnectionString&gt;**  é hello **iothubowner** cadeia de caracteres de conexão que você copiou na etapa anterior hello.</span><span class="sxs-lookup"><span data-stu-id="fe006-141">**&lt;IoTHubOwnerConnectionString&gt;** is hello **iothubowner** connection string you copied in hello previous step.</span></span> <span data-ttu-id="fe006-142">Essa cadeia de conexão só é usada nesta etapa, ele não é necessário no hello etapas a seguir:</span><span class="sxs-lookup"><span data-stu-id="fe006-142">This connection string is only used in this step, you don’t need it in hello following steps:</span></span>

    <span data-ttu-id="fe006-143">Você usa Olá mapeado d:\\pasta docker (Olá `-v` argumento) toopersist posterior Olá dois certificados x. 509 que usam módulos de gateway de saudação.</span><span class="sxs-lookup"><span data-stu-id="fe006-143">You use hello mapped D:\\docker folder (hello `-v` argument) later toopersist hello two X.509 certificates that hello gateway modules use.</span></span>

### <a name="run-hello-gateway"></a><span data-ttu-id="fe006-144">Executar Olá gateway</span><span class="sxs-lookup"><span data-stu-id="fe006-144">Run hello gateway</span></span>

1. <span data-ttu-id="fe006-145">Reinicie o gateway hello usando Olá comandos a seguir:</span><span class="sxs-lookup"><span data-stu-id="fe006-145">Restart hello gateway using hello following commands:</span></span>

    `docker run -it --rm -h <ApplicationName> --expose 62222 -p 62222:62222 -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/Logs -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v //D/docker:/shared -v //D/docker:/root/.dotnet/corefx/cryptography/x509stores -e _GW_PNFP="/shared/publishednodes.JSON" microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName>`

    `docker run -it --rm -v //D/docker:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -D /mapped/cs.db`

1. <span data-ttu-id="fe006-146">Por motivos de segurança, certificados x. 509 de saudação dois persistentes no hello d:\\pasta docker contém a chave privada Olá.</span><span class="sxs-lookup"><span data-stu-id="fe006-146">For security reasons, hello two X.509 certificates persisted in hello D:\\docker folder contain hello private key.</span></span> <span data-ttu-id="fe006-147">Limitar acesso toothis pasta toohello credenciais (normalmente **administradores**) use o contêiner do Docker toorun hello.</span><span class="sxs-lookup"><span data-stu-id="fe006-147">Limit access toothis folder toohello credentials (typically **Administrators**) you use toorun hello Docker container.</span></span> <span data-ttu-id="fe006-148">Com o botão direito Olá d:\\pasta docker, escolha **propriedades**, em seguida, **segurança**e, em seguida, **editar**.</span><span class="sxs-lookup"><span data-stu-id="fe006-148">Right-click hello D:\\docker folder, choose **Properties**, then **Security**, and then **Edit**.</span></span> <span data-ttu-id="fe006-149">Dê aos **Administradores** controle total e remova todas as outras pessoas:</span><span class="sxs-lookup"><span data-stu-id="fe006-149">Give **Administrators** full control and remove everyone else:</span></span>

    ![Compartilhamento de tooDocker conceder permissões][img-docker-share]

1. <span data-ttu-id="fe006-151">Verifique a conectividade de rede.</span><span class="sxs-lookup"><span data-stu-id="fe006-151">Verify network connectivity.</span></span> <span data-ttu-id="fe006-152">Em um prompt de comando, digite o comando de saudação `ping publisher.<your fully qualified domain name>` tooping seu gateway.</span><span class="sxs-lookup"><span data-stu-id="fe006-152">From a command prompt, enter hello command `ping publisher.<your fully qualified domain name>` tooping your gateway.</span></span> <span data-ttu-id="fe006-153">Se o destino de saudação está inacessível, adicione o endereço IP de saudação e nome do seu arquivo de hosts do gateway toohello no gateway.</span><span class="sxs-lookup"><span data-stu-id="fe006-153">If hello destination is unreachable, add hello IP address and name of your gateway toohello hosts file on your gateway.</span></span> <span data-ttu-id="fe006-154">arquivo de hosts de saudação está localizado em Olá **Windows\\System32\\drivers\\etc** pasta.</span><span class="sxs-lookup"><span data-stu-id="fe006-154">hello hosts file is located in hello **Windows\\System32\\drivers\\etc** folder.</span></span>

1. <span data-ttu-id="fe006-155">Em seguida, tente tooconnect toohello publisher usando um cliente OPC UA local em execução no gateway de saudação.</span><span class="sxs-lookup"><span data-stu-id="fe006-155">Next, try tooconnect toohello publisher using a local OPC UA client running on hello gateway.</span></span> <span data-ttu-id="fe006-156">Olá ponto de extremidade de OPC UA URL é `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span><span class="sxs-lookup"><span data-stu-id="fe006-156">hello OPC UA endpoint URL is `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span></span> <span data-ttu-id="fe006-157">Caso não tenha um cliente OPC UA, você poderá baixar e usar um [cliente OPC UA de software livre].</span><span class="sxs-lookup"><span data-stu-id="fe006-157">If you don't have an OPC UA client, you can download and use an [open-source OPC UA client].</span></span>

1. <span data-ttu-id="fe006-158">Quando esses testes locais foi concluído com êxito, procure toohello **conectar seu próprio servidor de UA OPC** página no portal de solução de fábrica conectado hello.</span><span class="sxs-lookup"><span data-stu-id="fe006-158">When you have successfully completed these local tests, browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="fe006-159">Insira a URL de ponto de extremidade do publicador hello (`tcp://publisher.<your fully qualified domain name>:62222`) e clique em **conectar**.</span><span class="sxs-lookup"><span data-stu-id="fe006-159">Enter hello publisher endpoint URL (`tcp://publisher.<your fully qualified domain name>:62222`) and click **Connect**.</span></span> <span data-ttu-id="fe006-160">Você recebe um aviso de certificado. Clique em **Continuar.**</span><span class="sxs-lookup"><span data-stu-id="fe006-160">You get a certificate warning, then click **Proceed.**</span></span> <span data-ttu-id="fe006-161">Em seguida você receber um erro que Olá publisher não confia Olá UA Web cliente.</span><span class="sxs-lookup"><span data-stu-id="fe006-161">Next you get an error that hello publisher doesn’t trust hello UA Web Client.</span></span> <span data-ttu-id="fe006-162">tooresolve este erro, a saudação de cópia **UA Web cliente** certificado da saudação **unidade d:\\docker\\certificados rejeitadas\\certificados** pasta toohello **Unidade d:\\docker\\UA aplicativos\\certificados** pasta no gateway hello.</span><span class="sxs-lookup"><span data-stu-id="fe006-162">tooresolve this error, copy hello **UA Web Client** certificate from hello **D:\\docker\\Rejected Certificates\\certs** folder toohello **D:\\docker\\UA Applications\\certs** folder on hello gateway.</span></span> <span data-ttu-id="fe006-163">Não é necessário toorestart do gateway de saudação.</span><span class="sxs-lookup"><span data-stu-id="fe006-163">You do not need toorestart of hello gateway.</span></span> <span data-ttu-id="fe006-164">Repita esta etapa.</span><span class="sxs-lookup"><span data-stu-id="fe006-164">Repeat this step.</span></span> <span data-ttu-id="fe006-165">Agora você pode conectar o gateway toohello da nuvem hello e você está pronto tooadd solução de toohello servidores OPC UA.</span><span class="sxs-lookup"><span data-stu-id="fe006-165">You can now connect toohello gateway from hello cloud, and you are ready tooadd OPC UA servers toohello solution.</span></span>

### <a name="add-your-opc-ua-servers"></a><span data-ttu-id="fe006-166">Adicionar os servidores OPC UA</span><span class="sxs-lookup"><span data-stu-id="fe006-166">Add your OPC UA servers</span></span>

1. <span data-ttu-id="fe006-167">Procurar toohello **conectar seu próprio servidor de UA OPC** página no portal de solução de fábrica conectado hello.</span><span class="sxs-lookup"><span data-stu-id="fe006-167">Browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="fe006-168">Siga as mesmas etapas Olá anterior tooestablish seção confiança entre Olá portal fábrica conectado e Olá servidor OPC UA de saudação.</span><span class="sxs-lookup"><span data-stu-id="fe006-168">Follow hello same steps as in hello preceding section tooestablish trust between hello connected factory portal and hello OPC UA server.</span></span> <span data-ttu-id="fe006-169">Essa etapa estabelece uma relação de confiança mútua de certificados de saudação do hello conectado o portal de fábrica e hello servidor OPC UA e cria uma conexão.</span><span class="sxs-lookup"><span data-stu-id="fe006-169">This step establishes a mutual trust of hello certificates from hello connected factory portal and hello OPC UA server and creates a connection.</span></span>

1. <span data-ttu-id="fe006-170">Procurar Olá árvore de nós de OPC UA do seu servidor de OPC UA, nós OPC hello e selecione **publicar**.</span><span class="sxs-lookup"><span data-stu-id="fe006-170">Browse hello OPC UA nodes tree of your OPC UA server, right-click hello OPC nodes, and select **publish**.</span></span> <span data-ttu-id="fe006-171">Para publicação toowork dessa maneira, Olá servidor OPC UA e Olá publicador deve ser em Olá mesma rede.</span><span class="sxs-lookup"><span data-stu-id="fe006-171">For publishing toowork this way, hello OPC UA server and hello publisher must be on hello same network.</span></span> <span data-ttu-id="fe006-172">Em outras palavras, se Olá totalmente qualificado nome de domínio do publicador Olá for **publisher.mydomain.com** e nome de domínio totalmente qualificado de saudação da saudação OPC UA servidor deve ser, por exemplo, **myopcuaserver.mydomain.com**. Se sua configuração for diferente, você pode adicionar manualmente arquivos de publishesnodes.json toohello de nós encontrado no hello **unidade d:\\docker** pasta.</span><span class="sxs-lookup"><span data-stu-id="fe006-172">In other words, if hello fully qualified domain name of hello publisher is **publisher.mydomain.com** then hello fully qualified domain name of hello OPC UA server must be, for example, **myopcuaserver.mydomain.com**. If your setup is different, you can manually add nodes toohello publishesnodes.json file found in hello **D:\\docker** folder.</span></span> <span data-ttu-id="fe006-173">Olá publishesnodes.json arquivo é gerado automaticamente em Olá primeiro bem-sucedida de publicação de um nó OPC.</span><span class="sxs-lookup"><span data-stu-id="fe006-173">hello publishesnodes.json file is automatically generated on hello first successful publish of an OPC node.</span></span>

1. <span data-ttu-id="fe006-174">Telemetria agora flui de dispositivo de gateway de saudação.</span><span class="sxs-lookup"><span data-stu-id="fe006-174">Telemetry now flows from hello gateway device.</span></span> <span data-ttu-id="fe006-175">Você pode exibir a telemetria Olá no hello **locais de fábrica** exibir do portal de fábrica conectado Olá em **nova fábrica**.</span><span class="sxs-lookup"><span data-stu-id="fe006-175">You can view hello telemetry in hello **Factory Locations** view of hello connected factory portal under **New Factory**.</span></span>

## <a name="linux-deployment"></a><span data-ttu-id="fe006-176">Implantação no Linux</span><span class="sxs-lookup"><span data-stu-id="fe006-176">Linux deployment</span></span>

> [!NOTE]
> <span data-ttu-id="fe006-177">Se você ainda não tem um dispositivo de gateway, a Microsoft aconselha a comprar um gateway comercial de um de nossos parceiros.</span><span class="sxs-lookup"><span data-stu-id="fe006-177">If you don't yet have a gateway device, Microsoft recommends you buy a commercial gateway from one of our partners.</span></span> <span data-ttu-id="fe006-178">Visite Olá [catálogo de dispositivo IoT do Azure] para obter uma lista de dispositivos de gateway compatíveis com hello conectado a solução de fábrica.</span><span class="sxs-lookup"><span data-stu-id="fe006-178">Visit hello [Azure IoT device catalog] for a list of gateway devices compatible with hello connected factory solution.</span></span> <span data-ttu-id="fe006-179">Siga as instruções de saudação que vêm com hello dispositivo tooset o gateway de saudação.</span><span class="sxs-lookup"><span data-stu-id="fe006-179">Follow hello instructions that come with hello device tooset up hello gateway.</span></span> <span data-ttu-id="fe006-180">Como alternativa, use Olá seguindo as instruções toomanually definir um dos seus gateways existentes.</span><span class="sxs-lookup"><span data-stu-id="fe006-180">Alternatively, use hello following instructions toomanually set up one of your existing gateways.</span></span>

<span data-ttu-id="fe006-181">[Instale o Docker] em seu dispositivo de gateway Linux.</span><span class="sxs-lookup"><span data-stu-id="fe006-181">[Install Docker] on your Linux gateway device.</span></span>

### <a name="configure-hello-gateway"></a><span data-ttu-id="fe006-182">Configurar o gateway de saudação</span><span class="sxs-lookup"><span data-stu-id="fe006-182">Configure hello gateway</span></span>

1. <span data-ttu-id="fe006-183">Você precisa Olá **iothubowner** cadeia de caracteres de conexão de seu Azure IoT Suite conectado fábrica implantação toocomplete Olá gateway implantação.</span><span class="sxs-lookup"><span data-stu-id="fe006-183">You need hello **iothubowner** connection string of your Azure IoT Suite connected factory deployment toocomplete hello gateway deployment.</span></span> <span data-ttu-id="fe006-184">Em Olá [portal do Azure], navegar tooyour IoT Hub no grupo de recursos de saudação criado quando você implantou a solução de fábrica Olá conectado.</span><span class="sxs-lookup"><span data-stu-id="fe006-184">In hello [Azure portal], navigate tooyour IoT Hub in hello resource group created when you deployed hello connected factory solution.</span></span> <span data-ttu-id="fe006-185">Clique em **políticas de acesso compartilhado** tooaccess Olá **iothubowner** cadeia de caracteres de conexão:</span><span class="sxs-lookup"><span data-stu-id="fe006-185">Click **Shared access policies** tooaccess hello **iothubowner** connection string:</span></span>

    ![Localize Olá cadeia de caracteres de conexão de IoT Hub][img-hub-connection]

    <span data-ttu-id="fe006-187">Saudação de cópia **cadeia de caracteres de Conexão - chave primária** valor.</span><span class="sxs-lookup"><span data-stu-id="fe006-187">Copy hello **Connection string--primary key** value.</span></span>

1. <span data-ttu-id="fe006-188">Configurar o gateway de saudação para o IoT Hub executando módulos de gateway Olá dois **quando** de um shell com:</span><span class="sxs-lookup"><span data-stu-id="fe006-188">Configure hello gateway for your IoT Hub by running hello two gateway modules **once** from a shell with:</span></span>

    `sudo docker run -it --rm -h <ApplicationName> -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/ -v /shared:/root/.dotnet/corefx/cryptography/x509stores microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName> "<IoTHubOwnerConnectionString>"`

    `sudo docker run --rm -it -v /shared:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -i -c "<IoTHubOwnerConnectionString>" -D /mapped/cs.db`

    * <span data-ttu-id="fe006-189">**&lt;ApplicationName&gt;**  é Olá nome de gateway do OPC UA aplicativo hello cria no formato de saudação do hello **publisher.&lt; o nome de domínio totalmente qualificado&gt;**.</span><span class="sxs-lookup"><span data-stu-id="fe006-189">**&lt;ApplicationName&gt;** is hello name of hello OPC UA application hello gateway creates in hello format **publisher.&lt;your fully qualified domain name&gt;**.</span></span> <span data-ttu-id="fe006-190">Por exemplo, **publicador.microsoft.com**.</span><span class="sxs-lookup"><span data-stu-id="fe006-190">For example, **publisher.microsoft.com**.</span></span>
    * <span data-ttu-id="fe006-191">**&lt;IoTHubOwnerConnectionString&gt;**  é hello **iothubowner** cadeia de caracteres de conexão que você copiou na etapa anterior hello.</span><span class="sxs-lookup"><span data-stu-id="fe006-191">**&lt;IoTHubOwnerConnectionString&gt;** is hello **iothubowner** connection string you copied in hello previous step.</span></span> <span data-ttu-id="fe006-192">Essa cadeia de conexão só é usada nesta etapa, ele não é necessário no hello etapas a seguir:</span><span class="sxs-lookup"><span data-stu-id="fe006-192">This connection string is only used in this step, you don’t need it in hello following steps:</span></span>

    <span data-ttu-id="fe006-193">Use Olá **/ compartilhado** pasta (Olá `-v` argumento) toopersist posterior Olá dois certificados x. 509 que usam módulos de gateway hello.</span><span class="sxs-lookup"><span data-stu-id="fe006-193">You use hello **/shared** folder (hello `-v` argument) later toopersist hello two X.509 certificates that hello gateway modules use.</span></span>

### <a name="run-hello-gateway"></a><span data-ttu-id="fe006-194">Executar Olá gateway</span><span class="sxs-lookup"><span data-stu-id="fe006-194">Run hello gateway</span></span>

1. <span data-ttu-id="fe006-195">Reinicie o gateway hello usando Olá comandos a seguir:</span><span class="sxs-lookup"><span data-stu-id="fe006-195">Restart hello gateway using hello following commands:</span></span>

    `sudo docker run -it -h <ApplicationName> --expose 62222 -p 62222:62222 –-rm -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/Logs -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v /shared:/shared -v /shared:/root/.dotnet/corefx/cryptography/x509stores -e _GW_PNFP="/shared/publishednodes.JSON" microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName>`

    `sudo docker run -it -v /shared:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -D /mapped/cs.db`

1. <span data-ttu-id="fe006-196">Por motivos de segurança, certificados x. 509 de saudação dois persistentes no hello **/ compartilhado** pasta contém a chave privada hello.</span><span class="sxs-lookup"><span data-stu-id="fe006-196">For security reasons, hello two X.509 certificates persisted in hello **/shared** folder contain hello private key.</span></span> <span data-ttu-id="fe006-197">Limitar acesso toothis pasta toohello credenciais usadas toorun Olá contêiner do Docker.</span><span class="sxs-lookup"><span data-stu-id="fe006-197">Limit access toothis folder toohello credentials you use toorun hello Docker container.</span></span> <span data-ttu-id="fe006-198">permissões de saudação tooset para **raiz** apenas, use Olá `chmod` shell de comando na pasta hello.</span><span class="sxs-lookup"><span data-stu-id="fe006-198">tooset hello permissions for **root** only, use hello `chmod` shell command on hello folder.</span></span>

1. <span data-ttu-id="fe006-199">Verifique a conectividade de rede.</span><span class="sxs-lookup"><span data-stu-id="fe006-199">Verify network connectivity.</span></span> <span data-ttu-id="fe006-200">Em um shell, digite o comando de saudação `ping publisher.<your fully qualified domain name>` tooping seu gateway.</span><span class="sxs-lookup"><span data-stu-id="fe006-200">From a shell, enter hello command `ping publisher.<your fully qualified domain name>` tooping your gateway.</span></span> <span data-ttu-id="fe006-201">Se o destino de saudação está inacessível, adicione o endereço IP de saudação e nome do seu arquivo de hosts do gateway tooyour no gateway.</span><span class="sxs-lookup"><span data-stu-id="fe006-201">If hello destination is unreachable, add hello IP address and name of your gateway tooyour hosts file on your gateway.</span></span> <span data-ttu-id="fe006-202">arquivo de hosts de saudação está localizado em Olá **/etc** pasta.</span><span class="sxs-lookup"><span data-stu-id="fe006-202">hello hosts file is located in hello **/etc** folder.</span></span>

1. <span data-ttu-id="fe006-203">Em seguida, tente tooconnect toohello publisher usando um cliente OPC UA local em execução no gateway de saudação.</span><span class="sxs-lookup"><span data-stu-id="fe006-203">Next, try tooconnect toohello publisher using a local OPC UA client running on hello gateway.</span></span> <span data-ttu-id="fe006-204">Olá ponto de extremidade de OPC UA URL é `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span><span class="sxs-lookup"><span data-stu-id="fe006-204">hello OPC UA endpoint URL is `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span></span> <span data-ttu-id="fe006-205">Caso não tenha um cliente OPC UA, você poderá baixar e usar um [cliente OPC UA de software livre].</span><span class="sxs-lookup"><span data-stu-id="fe006-205">If you don't have an OPC UA client, you can download and use an [open-source OPC UA client].</span></span>

1. <span data-ttu-id="fe006-206">Quando esses testes locais foi concluído com êxito, procure toohello **conectar seu próprio servidor de UA OPC** página no portal de solução de fábrica conectado hello.</span><span class="sxs-lookup"><span data-stu-id="fe006-206">When you have successfully completed these local tests, browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="fe006-207">Insira a URL de ponto de extremidade do publicador hello (`tcp://publisher.<your fully qualified domain name>:62222`) e clique em **conectar**.</span><span class="sxs-lookup"><span data-stu-id="fe006-207">Enter hello publisher endpoint URL (`tcp://publisher.<your fully qualified domain name>:62222`) and click **Connect**.</span></span> <span data-ttu-id="fe006-208">Você recebe um aviso de certificado. Clique em **Continuar.**</span><span class="sxs-lookup"><span data-stu-id="fe006-208">You get a certificate warning, then click **Proceed.**</span></span> <span data-ttu-id="fe006-209">Em seguida você receber um erro que Olá publisher não confia Olá UA Web cliente.</span><span class="sxs-lookup"><span data-stu-id="fe006-209">Next you get an error that hello publisher doesn’t trust hello UA Web Client.</span></span> <span data-ttu-id="fe006-210">tooresolve este erro, a saudação de cópia **UA Web cliente** certificado da saudação **compartilhados/rejeitado certificados/certificados** pasta toohello **/shared/UA aplicativos/certificados** pasta no gateway hello.</span><span class="sxs-lookup"><span data-stu-id="fe006-210">tooresolve this error, copy hello **UA Web Client** certificate from hello **/shared/Rejected Certificates/certs** folder toohello **/shared/UA Applications/certs** folder on hello gateway.</span></span> <span data-ttu-id="fe006-211">Não é necessário toorestart do gateway de saudação.</span><span class="sxs-lookup"><span data-stu-id="fe006-211">You do not need toorestart of hello gateway.</span></span> <span data-ttu-id="fe006-212">Repita esta etapa.</span><span class="sxs-lookup"><span data-stu-id="fe006-212">Repeat this step.</span></span> <span data-ttu-id="fe006-213">Agora você pode conectar o gateway toohello da nuvem hello e você está pronto tooadd solução de toohello servidores OPC UA.</span><span class="sxs-lookup"><span data-stu-id="fe006-213">You can now connect toohello gateway from hello cloud, and you are ready tooadd OPC UA servers toohello solution.</span></span>

### <a name="add-your-opc-ua-servers"></a><span data-ttu-id="fe006-214">Adicionar os servidores OPC UA</span><span class="sxs-lookup"><span data-stu-id="fe006-214">Add your OPC UA servers</span></span>

1. <span data-ttu-id="fe006-215">Procurar toohello **conectar seu próprio servidor de UA OPC** página no portal de solução de fábrica conectado hello.</span><span class="sxs-lookup"><span data-stu-id="fe006-215">Browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="fe006-216">Siga as mesmas etapas Olá anterior tooestablish seção confiança entre Olá portal fábrica conectado e Olá servidor OPC UA de saudação.</span><span class="sxs-lookup"><span data-stu-id="fe006-216">Follow hello same steps as in hello preceding section tooestablish trust between hello connected factory portal and hello OPC UA server.</span></span> <span data-ttu-id="fe006-217">Essa etapa estabelece uma relação de confiança mútua de certificados de saudação do hello conectado o portal de fábrica e hello servidor OPC UA e cria uma conexão.</span><span class="sxs-lookup"><span data-stu-id="fe006-217">This step establishes a mutual trust of hello certificates from hello connected factory portal and hello OPC UA server and creates a connection.</span></span>

1. <span data-ttu-id="fe006-218">Procurar Olá árvore de nós de OPC UA do seu servidor de OPC UA, nós OPC hello e selecione **publicar**.</span><span class="sxs-lookup"><span data-stu-id="fe006-218">Browse hello OPC UA nodes tree of your OPC UA server, right-click hello OPC nodes, and select **publish**.</span></span> <span data-ttu-id="fe006-219">Para publicação toowork dessa maneira, Olá servidor OPC UA e Olá publicador deve ser em Olá mesma rede.</span><span class="sxs-lookup"><span data-stu-id="fe006-219">For publishing toowork this way, hello OPC UA server and hello publisher must be on hello same network.</span></span> <span data-ttu-id="fe006-220">Em outras palavras, se Olá totalmente qualificado nome de domínio do publicador Olá for **publisher.mydomain.com** e nome de domínio totalmente qualificado de saudação da saudação OPC UA servidor deve ser, por exemplo, **myopcuaserver.mydomain.com**. Se sua configuração for diferente, você pode adicionar manualmente arquivos de publishesnodes.json toohello de nós encontrado no hello **/ compartilhado** pasta.</span><span class="sxs-lookup"><span data-stu-id="fe006-220">In other words, if hello fully qualified domain name of hello publisher is **publisher.mydomain.com** then hello fully qualified domain name of hello OPC UA server must be, for example, **myopcuaserver.mydomain.com**. If your setup is different, you can manually add nodes toohello publishesnodes.json file found in hello **/shared** folder.</span></span> <span data-ttu-id="fe006-221">Olá publishesnodes.json é gerada automaticamente no hello primeiro bem-sucedida de publicação de um nó OPC.</span><span class="sxs-lookup"><span data-stu-id="fe006-221">hello publishesnodes.json is automatically generated on hello first successful publish of an OPC node.</span></span>

1. <span data-ttu-id="fe006-222">Telemetria agora flui de dispositivo de gateway de saudação.</span><span class="sxs-lookup"><span data-stu-id="fe006-222">Telemetry now flows from hello gateway device.</span></span> <span data-ttu-id="fe006-223">Você pode exibir a telemetria Olá no hello **locais de fábrica** exibir do portal de fábrica conectado Olá em **nova fábrica**.</span><span class="sxs-lookup"><span data-stu-id="fe006-223">You can view hello telemetry in hello **Factory Locations** view of hello connected factory portal under **New Factory**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="fe006-224">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="fe006-224">Next steps</span></span>

<span data-ttu-id="fe006-225">toolearn mais sobre a arquitetura de saudação de fábrica conectado Olá pré-configurado solução, consulte [conectada fábrica pré-configurado passo a passo de solução][lnk-walkthrough].</span><span class="sxs-lookup"><span data-stu-id="fe006-225">toolearn more about hello architecture of hello connected factory preconfigured solution, see [Connected factory preconfigured solution walkthrough][lnk-walkthrough].</span></span>

[img-install-docker]: ./media/iot-suite-connected-factory-gateway-deployment/image1.png
[img-hub-connection]: ./media/iot-suite-connected-factory-gateway-deployment/image2.png
[img-docker-share]: ./media/iot-suite-connected-factory-gateway-deployment/image3.png

[Docker para Windows]: https://www.docker.com/docker-windows
[catálogo de dispositivo IoT do Azure]: https://catalog.azureiotsuite.com/?q=opc
[portal do Azure]: http://portal.azure.com/
[cliente OPC UA de software livre]: https://github.com/OPCFoundation/UA-.NETStandardLibrary/tree/master/SampleApplications/Samples/Client.Net4
[Instale o Docker]: https://www.docker.com/community-edition#/download
[lnk-walkthrough]: iot-suite-connected-factory-sample-walkthrough.md
[Azure IoT borda]: https://github.com/Azure/iot-edge

[lnk-publisher-github]: https://github.com/Azure/iot-edge-opc-publisher
[lnk-publisher-docker]: https://hub.docker.com/r/microsoft/iot-gateway-opc-ua
[lnk-proxy-github]: https://github.com/Azure/iot-edge-opc-proxy
[lnk-proxy-docker]: https://hub.docker.com/r/microsoft/iot-gateway-opc-ua-proxy