---
title: dicas de aaaPerformance - Azure Cosmos banco de dados NoSQL | Microsoft Docs
description: "Saiba o desempenho do banco de dados do cliente configuração Opções tooimprove Azure Cosmos DB"
keywords: como tooimprove desempenho banco de dados
services: cosmos-db
author: mimig1
manager: jhubbard
editor: 
documentationcenter: 
ms.assetid: 94ff155e-f9bc-488f-8c7a-5e7037091bb9
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/23/2017
ms.author: mimig
ms.openlocfilehash: 4f3e82ae5048e3dbc20b0fd891a2d3aa22adf3fc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="performance-tips-for-azure-cosmos-db"></a><span data-ttu-id="464dc-104">Dicas de desempenho para o Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="464dc-104">Performance tips for Azure Cosmos DB</span></span>
<span data-ttu-id="464dc-105">O Azure Cosmos DB é um banco de dados distribuído rápido e flexível que pode ser dimensionado perfeitamente com garantia de latência e produtividade.</span><span class="sxs-lookup"><span data-stu-id="464dc-105">Azure Cosmos DB is a fast and flexible distributed database that scales seamlessly with guaranteed latency and throughput.</span></span> <span data-ttu-id="464dc-106">Você não tem alterações de arquitetura principais toomake ou escrever códigos complexos tooscale seu banco de dados com o banco de dados do Cosmos.</span><span class="sxs-lookup"><span data-stu-id="464dc-106">You do not have toomake major architecture changes or write complex code tooscale your database with Cosmos DB.</span></span> <span data-ttu-id="464dc-107">Aumentar e reduzir é tão fácil quanto fazer uma única chamada da API ou uma [chamada do método do SDK](set-throughput.md#set-throughput-sdk).</span><span class="sxs-lookup"><span data-stu-id="464dc-107">Scaling up and down is as easy as making a single API call or [SDK method call](set-throughput.md#set-throughput-sdk).</span></span> <span data-ttu-id="464dc-108">No entanto, porque Cosmos DB é acessado por meio de chamadas de rede existe são otimizações do lado do cliente pode fazer tooachieve máximo desempenho.</span><span class="sxs-lookup"><span data-stu-id="464dc-108">However, because Cosmos DB is accessed via network calls there are client-side optimizations you can make tooachieve peak performance.</span></span>

<span data-ttu-id="464dc-109">Assim, se você estiver se perguntando "Como posso melhorar o desempenho do meu banco de dados?",</span><span class="sxs-lookup"><span data-stu-id="464dc-109">So if you're asking "How can I improve my database performance?"</span></span> <span data-ttu-id="464dc-110">Considere Olá as opções a seguir:</span><span class="sxs-lookup"><span data-stu-id="464dc-110">consider hello following options:</span></span>

## <a name="networking"></a><span data-ttu-id="464dc-111">Rede</span><span class="sxs-lookup"><span data-stu-id="464dc-111">Networking</span></span>
<a id="direct-connection"></a>

1. <span data-ttu-id="464dc-112">**Política de conexão: usar o modo de conexão direta**</span><span class="sxs-lookup"><span data-stu-id="464dc-112">**Connection policy: Use direct connection mode**</span></span>

    <span data-ttu-id="464dc-113">Como um cliente se conecta tooCosmos banco de dados tem implicações importantes sobre o desempenho, especialmente em termos de latência do cliente observado.</span><span class="sxs-lookup"><span data-stu-id="464dc-113">How a client connects tooCosmos DB has important implications on performance, especially in terms of observed client-side latency.</span></span> <span data-ttu-id="464dc-114">Há duas configurações de chave de configuração disponíveis para configurar a diretiva de Conexão-conexão de saudação do cliente *modo* e hello [conexão *protocolo*](#connection-protocol).</span><span class="sxs-lookup"><span data-stu-id="464dc-114">There are two key configuration settings available for configuring client Connection Policy – hello connection *mode* and hello [connection *protocol*](#connection-protocol).</span></span>  <span data-ttu-id="464dc-115">Olá dois modos disponíveis são:</span><span class="sxs-lookup"><span data-stu-id="464dc-115">hello two available modes are:</span></span>

   1. <span data-ttu-id="464dc-116">Modo Gateway (padrão)</span><span class="sxs-lookup"><span data-stu-id="464dc-116">Gateway Mode (default)</span></span>
   2. <span data-ttu-id="464dc-117">Modo Direto</span><span class="sxs-lookup"><span data-stu-id="464dc-117">Direct Mode</span></span>

      <span data-ttu-id="464dc-118">Modo de gateway tem suporte em todas as plataformas do SDK e é Olá configurado padrão.</span><span class="sxs-lookup"><span data-stu-id="464dc-118">Gateway Mode is supported on all SDK platforms and is hello configured default.</span></span>  <span data-ttu-id="464dc-119">Se seu aplicativo é executado em uma rede corporativa com restrições de firewall estrita, o modo de Gateway é Olá melhor opção porque ele usa a porta HTTPS padrão de saudação e um ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="464dc-119">If your application runs within a corporate network with strict firewall restrictions, Gateway Mode is hello best choice since it uses hello standard HTTPS port and a single endpoint.</span></span> <span data-ttu-id="464dc-120">Olá compensação de desempenho, no entanto, é que o modo de Gateway envolve um salto de rede adicionais sempre que dados é lida ou gravados tooCosmos banco de dados.</span><span class="sxs-lookup"><span data-stu-id="464dc-120">hello performance tradeoff, however, is that Gateway Mode involves an additional network hop every time data is read or written tooCosmos DB.</span></span> <span data-ttu-id="464dc-121">Por isso, o modo direto oferece melhor desempenho devido toofewer saltos de rede.</span><span class="sxs-lookup"><span data-stu-id="464dc-121">Because of this, Direct Mode offers better performance due toofewer network hops.</span></span>
<a id="use-tcp"></a>
2. <span data-ttu-id="464dc-122">**Diretiva de Conexão: usar o protocolo TCP Olá**</span><span class="sxs-lookup"><span data-stu-id="464dc-122">**Connection policy: Use hello TCP protocol**</span></span>

    <span data-ttu-id="464dc-123">Ao usar o Modo Direto, há duas opções de protocolo disponíveis:</span><span class="sxs-lookup"><span data-stu-id="464dc-123">When using Direct Mode, there are two protocol options available:</span></span>

   * <span data-ttu-id="464dc-124">TCP</span><span class="sxs-lookup"><span data-stu-id="464dc-124">TCP</span></span>
   * <span data-ttu-id="464dc-125">HTTPS</span><span class="sxs-lookup"><span data-stu-id="464dc-125">HTTPS</span></span>

     <span data-ttu-id="464dc-126">O Cosmos DB oferece um modelo de programação RESTful simples e aberto por HTTPS.</span><span class="sxs-lookup"><span data-stu-id="464dc-126">Cosmos DB offers a simple and open RESTful programming model over HTTPS.</span></span> <span data-ttu-id="464dc-127">Além disso, ele oferece um protocolo TCP eficiente, que também é RESTful no seu modelo de comunicação e está disponível por meio do SDK de cliente .NET hello.</span><span class="sxs-lookup"><span data-stu-id="464dc-127">Additionally, it offers an efficient TCP protocol, which is also RESTful in its communication model and is available through hello .NET client SDK.</span></span> <span data-ttu-id="464dc-128">Tanto TCP direto quanto HTTPS usam SSL para criptografar tráfego e autenticação inicial.</span><span class="sxs-lookup"><span data-stu-id="464dc-128">Both Direct TCP and HTTPS use SSL for initial authentication and encrypting traffic.</span></span> <span data-ttu-id="464dc-129">Para melhor desempenho, use o protocolo TCP hello quando possível.</span><span class="sxs-lookup"><span data-stu-id="464dc-129">For best performance, use hello TCP protocol when possible.</span></span>

     <span data-ttu-id="464dc-130">Ao usar TCP no modo de Gateway, porta TCP 443 é Olá porta DB Cosmos e 10255 é a porta de API do MongoDB hello.</span><span class="sxs-lookup"><span data-stu-id="464dc-130">When using TCP in Gateway Mode, TCP Port 443 is hello Cosmos DB port, and 10255 is hello MongoDB API port.</span></span> <span data-ttu-id="464dc-131">Ao usar TCP em modo direto, em portas do Gateway toohello adição, você deve tooensure porta de saudação entre 10000 e 20000 está aberto como banco de dados do Cosmos usa portas TCP dinâmicas.</span><span class="sxs-lookup"><span data-stu-id="464dc-131">When using TCP in Direct Mode, in addition toohello Gateway ports, you need tooensure hello port range between 10000 and 20000 is open because Cosmos DB uses dynamic TCP ports.</span></span> <span data-ttu-id="464dc-132">Se essas portas não estão abertas e você tentar toouse TCP, você receberá o erro 503 Serviço indisponível.</span><span class="sxs-lookup"><span data-stu-id="464dc-132">If these ports are not open and you attempt toouse TCP, you receive a 503 Service Unavailable error.</span></span>

     <span data-ttu-id="464dc-133">Olá modo de conectividade é configurado durante a construção de saudação da instância de DocumentClient Olá com parâmetro de ConnectionPolicy hello.</span><span class="sxs-lookup"><span data-stu-id="464dc-133">hello Connectivity Mode is configured during hello construction of hello DocumentClient instance with hello ConnectionPolicy parameter.</span></span> <span data-ttu-id="464dc-134">Se for usado o modo direto, Olá protocolo também pode definir no parâmetro de ConnectionPolicy hello.</span><span class="sxs-lookup"><span data-stu-id="464dc-134">If Direct Mode is used, hello Protocol can also be set within hello ConnectionPolicy parameter.</span></span>

    ```C#
    var serviceEndpoint = new Uri("https://contoso.documents.net");
    var authKey = new "your authKey from hello Azure portal";
    DocumentClient client = new DocumentClient(serviceEndpoint, authKey,
    new ConnectionPolicy
    {
        ConnectionMode = ConnectionMode.Direct,
        ConnectionProtocol = Protocol.Tcp
    });
    ```

    <span data-ttu-id="464dc-135">Como TCP só tem suporte em modo direto, se o modo de Gateway é usado, em seguida, Olá protocolo HTTPS é sempre usado toocommunicate com hello Gateway e hello valor do protocolo em Olá que connectionpolicy será ignorado.</span><span class="sxs-lookup"><span data-stu-id="464dc-135">Because TCP is only supported in Direct Mode, if Gateway Mode is used, then hello HTTPS protocol is always used toocommunicate with hello Gateway and hello Protocol value in hello ConnectionPolicy is ignored.</span></span>

    ![Ilustração de saudação diretiva de conexão de banco de dados do Azure Cosmos](./media/performance-tips/connection-policy.png)

3. <span data-ttu-id="464dc-137">**Chame a latência de inicialização tooavoid OpenAsync na primeira solicitação**</span><span class="sxs-lookup"><span data-stu-id="464dc-137">**Call OpenAsync tooavoid startup latency on first request**</span></span>

    <span data-ttu-id="464dc-138">Por padrão, a primeira solicitação de saudação tem uma latência mais alta porque ele tem a tabela de roteamento de endereço do toofetch hello.</span><span class="sxs-lookup"><span data-stu-id="464dc-138">By default, hello first request has a higher latency because it has toofetch hello address routing table.</span></span> <span data-ttu-id="464dc-139">essa latência de inicialização em Olá tooavoid primeiro solicitar, você deve chamar OpenAsync() uma vez durante a inicialização da seguinte maneira.</span><span class="sxs-lookup"><span data-stu-id="464dc-139">tooavoid this startup latency on hello first request, you should call OpenAsync() once during initialization as follows.</span></span>

        await client.OpenAsync();
   <a id="same-region"></a>
4. <span data-ttu-id="464dc-140">**Colocar os clientes na mesma região do Azure para o desempenho**</span><span class="sxs-lookup"><span data-stu-id="464dc-140">**Collocate clients in same Azure region for performance**</span></span>

    <span data-ttu-id="464dc-141">Quando possível, coloque Olá de quaisquer aplicativos que chamam Cosmos DB mesma região Olá banco de dados do banco de dados do Cosmos.</span><span class="sxs-lookup"><span data-stu-id="464dc-141">When possible, place any applications calling Cosmos DB in hello same region as hello Cosmos DB database.</span></span> <span data-ttu-id="464dc-142">Para obter uma comparação aproximada, chama tooCosmos DB dentro Olá concluir a mesma região dentro de 1 a 2 ms, mas a latência de saudação entre hello Oeste e Costa Leste de saudação dos EUA é > 50 ms.</span><span class="sxs-lookup"><span data-stu-id="464dc-142">For an approximate comparison, calls tooCosmos DB within hello same region complete within 1-2 ms, but hello latency between hello West and East coast of hello US is >50 ms.</span></span> <span data-ttu-id="464dc-143">Essa latência provavelmente pode variar de solicitação toorequest dependendo da rota Olá tomada por solicitação Olá conforme ele passa de limite do hello cliente toohello datacenter do Azure.</span><span class="sxs-lookup"><span data-stu-id="464dc-143">This latency can likely vary from request toorequest depending on hello route taken by hello request as it passes from hello client toohello Azure datacenter boundary.</span></span> <span data-ttu-id="464dc-144">Olá menor latência possível é obtida, garantindo chamada hello aplicativo está localizado em Olá mesma região do Azure Olá provisionado ponto de extremidade do banco de dados do Cosmos.</span><span class="sxs-lookup"><span data-stu-id="464dc-144">hello lowest possible latency is achieved by ensuring hello calling application is located within hello same Azure region as hello provisioned Cosmos DB endpoint.</span></span> <span data-ttu-id="464dc-145">Para obter uma lista de regiões disponíveis, consulte [Regiões do Azure](https://azure.microsoft.com/regions/#services).</span><span class="sxs-lookup"><span data-stu-id="464dc-145">For a list of available regions, see [Azure Regions](https://azure.microsoft.com/regions/#services).</span></span>

    <span data-ttu-id="464dc-146">![Ilustração de saudação diretiva de conexão de banco de dados do Azure Cosmos](./media/performance-tips/same-region.png)
   <a id="increase-threads"></a></span><span class="sxs-lookup"><span data-stu-id="464dc-146">![Illustration of hello Azure Cosmos DB connection policy](./media/performance-tips/same-region.png)
<a id="increase-threads"></a></span></span>
5. <span data-ttu-id="464dc-147">**Aumentar o número de threads/tarefas**</span><span class="sxs-lookup"><span data-stu-id="464dc-147">**Increase number of threads/tasks**</span></span>

    <span data-ttu-id="464dc-148">Como chamadas tooAzure Cosmos DB são feitas pela rede hello, talvez seja necessário toovary grau de saudação de paralelismo de suas solicitações para que o aplicativo de cliente hello gasta muito pouco tempo de espera entre solicitações.</span><span class="sxs-lookup"><span data-stu-id="464dc-148">Since calls tooAzure Cosmos DB are made over hello network, you may need toovary hello degree of parallelism of your requests so that hello client application spends very little time waiting between requests.</span></span> <span data-ttu-id="464dc-149">Por exemplo, se você estiver usando. Do NET [biblioteca paralela de tarefas](https://msdn.microsoft.com//library/dd460717.aspx), criar na ordem de saudação de 100 tarefas ler ou gravar tooCosmos banco de dados.</span><span class="sxs-lookup"><span data-stu-id="464dc-149">For example, if you're using .NET's [Task Parallel Library](https://msdn.microsoft.com//library/dd460717.aspx), create in hello order of 100s of Tasks reading or writing tooCosmos DB.</span></span>

## <a name="sdk-usage"></a><span data-ttu-id="464dc-150">Uso do SDK</span><span class="sxs-lookup"><span data-stu-id="464dc-150">SDK Usage</span></span>
1. <span data-ttu-id="464dc-151">**Instalar o SDK mais recente de Olá**</span><span class="sxs-lookup"><span data-stu-id="464dc-151">**Install hello most recent SDK**</span></span>

    <span data-ttu-id="464dc-152">Olá Cosmos SDKs do banco de dados estão sendo constantemente tooprovide aprimorado Olá melhor desempenho.</span><span class="sxs-lookup"><span data-stu-id="464dc-152">hello Cosmos DB SDKs are constantly being improved tooprovide hello best performance.</span></span> <span data-ttu-id="464dc-153">Consulte Olá [Cosmos DB SDK](documentdb-sdk-dotnet.md) páginas toodetermine Olá SDK mais recente e examine melhorias.</span><span class="sxs-lookup"><span data-stu-id="464dc-153">See hello [Cosmos DB SDK](documentdb-sdk-dotnet.md) pages toodetermine hello most recent SDK and review improvements.</span></span>
2. <span data-ttu-id="464dc-154">**Usar um cliente de banco de dados do Cosmos singleton para o tempo de vida de saudação do seu aplicativo**</span><span class="sxs-lookup"><span data-stu-id="464dc-154">**Use a singleton Cosmos DB client for hello lifetime of your application**</span></span>

    <span data-ttu-id="464dc-155">Observe que cada instância do DocumentClient tem um thread seguro e realiza um gerenciamento de conexão eficiente e o cache de endereço ao operar no Modo Direto.</span><span class="sxs-lookup"><span data-stu-id="464dc-155">Note that each DocumentClient instance is thread-safe and performs efficient connection management and address caching when operating in Direct Mode.</span></span> <span data-ttu-id="464dc-156">gerenciamento de conexão eficiente tooallow e melhor desempenho por DocumentClient, é recomendável toouse uma única instância de DocumentClient por AppDomain para o tempo de vida de saudação do aplicativo hello.</span><span class="sxs-lookup"><span data-stu-id="464dc-156">tooallow efficient connection management and better performance by DocumentClient, it is recommended toouse a single instance of DocumentClient per AppDomain for hello lifetime of hello application.</span></span>

   <a id="max-connection"></a>
3. <span data-ttu-id="464dc-157">**Aumentar System.Net MaxConnections por host usando o modo de Gateway**</span><span class="sxs-lookup"><span data-stu-id="464dc-157">**Increase System.Net MaxConnections per host when using Gateway mode**</span></span>

    <span data-ttu-id="464dc-158">Cosmos DB solicitações feitas por HTTPS/REST ao usar o modo de Gateway e estão sujeitos toohello limite de conexão padrão por nome de host ou endereço IP.</span><span class="sxs-lookup"><span data-stu-id="464dc-158">Cosmos DB requests are made over HTTPS/REST when using Gateway mode, and are subjected toohello default connection limit per hostname or IP address.</span></span> <span data-ttu-id="464dc-159">Talvez seja necessário tooset Olá MaxConnections tooa maior valor (100-1000) para que hello biblioteca de cliente pode utilizar várias conexões simultâneas tooCosmos banco de dados.</span><span class="sxs-lookup"><span data-stu-id="464dc-159">You may need tooset hello MaxConnections tooa higher value (100-1000) so that hello client library can utilize multiple simultaneous connections tooCosmos DB.</span></span> <span data-ttu-id="464dc-160">Olá .NET SDK 1.8.0 e acima, Olá valor padrão para [ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit.aspx) é 50 e toochange Olá valor, você pode definir Olá [Documents.Client.ConnectionPolicy.MaxConnectionLimit ](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.connectionpolicy.maxconnectionlimit.aspx) tooa maior valor.</span><span class="sxs-lookup"><span data-stu-id="464dc-160">In hello .NET SDK 1.8.0 and above, hello default value for [ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit.aspx) is 50 and toochange hello value, you can set hello [Documents.Client.ConnectionPolicy.MaxConnectionLimit](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.connectionpolicy.maxconnectionlimit.aspx) tooa higher value.</span></span>   
4. <span data-ttu-id="464dc-161">**Ajustar consultas paralelas para coleções particionadas**</span><span class="sxs-lookup"><span data-stu-id="464dc-161">**Tuning parallel queries for partitioned collections**</span></span>

     <span data-ttu-id="464dc-162">SDK do DocumentDB .NET versão 1.9.0 e acima de consultas paralelas suporte, que permitem que você tooquery uma coleção particionada em paralelo (consulte [trabalhando com hello SDKs](documentdb-partition-data.md#working-with-the-azure-cosmos-db-sdks) e hello relacionadas [exemplos de código](https://github.com/Azure/azure-documentdb-dotnet/blob/master/samples/code-samples/Queries/Program.cs) para mais informações).</span><span class="sxs-lookup"><span data-stu-id="464dc-162">DocumentDB .NET SDK version 1.9.0 and above support parallel queries, which enable you tooquery a partitioned collection in parallel (see [Working with hello SDKs](documentdb-partition-data.md#working-with-the-azure-cosmos-db-sdks) and hello related [code samples](https://github.com/Azure/azure-documentdb-dotnet/blob/master/samples/code-samples/Queries/Program.cs) for more info).</span></span> <span data-ttu-id="464dc-163">Consultas paralelas são a latência da consulta tooimprove projetado e taxa de transferência sobre sua contraparte serial.</span><span class="sxs-lookup"><span data-stu-id="464dc-163">Parallel queries are designed tooimprove query latency and throughput over their serial counterpart.</span></span> <span data-ttu-id="464dc-164">Consultas paralelas fornecem dois parâmetros que os usuários podem ajustar toocustom ajustar seus requisitos, (a) MaxDegreeOfParallelism: número de máximo de saudação do toocontrol de partições, em seguida, pode ser consultado em paralelo e (b) MaxBufferedItemCount: toocontrol Olá inúmeros pré-busca de resultados.</span><span class="sxs-lookup"><span data-stu-id="464dc-164">Parallel queries provide two parameters that users can tune toocustom-fit their requirements, (a) MaxDegreeOfParallelism: toocontrol hello maximum number of partitions then can be queried in parallel, and (b) MaxBufferedItemCount: toocontrol hello number of pre-fetched results.</span></span>

    <span data-ttu-id="464dc-165">(a) ***Ajuste de MaxDegreeOfParallelism\:*** a consulta paralela funciona consultando várias partições em paralelo.</span><span class="sxs-lookup"><span data-stu-id="464dc-165">(a) ***Tuning MaxDegreeOfParallelism\:*** Parallel query works by querying multiple partitions in parallel.</span></span> <span data-ttu-id="464dc-166">No entanto, dados de uma coleta particionada individual são buscados em série com respeito toohello consulta.</span><span class="sxs-lookup"><span data-stu-id="464dc-166">However, data from an individual partitioned collect is fetched serially with respect toohello query.</span></span> <span data-ttu-id="464dc-167">Assim, definindo Olá MaxDegreeOfParallelism toohello o número de partições tem a chance de máximo de saudação de atingir Olá a maioria das consultas de alto desempenho, desde que todas as outras condições do sistema permanecem Olá mesmo.</span><span class="sxs-lookup"><span data-stu-id="464dc-167">So, setting hello MaxDegreeOfParallelism toohello number of partitions has hello maximum chance of achieving hello most performant query, provided all other system conditions remain hello same.</span></span> <span data-ttu-id="464dc-168">Se você não souber o número de saudação de partições, você pode definir o número alto da saudação MaxDegreeOfParallelism tooa e sistema Olá escolhe mínimo hello (número de partições, a entrada fornecida pelo usuário) como Olá MaxDegreeOfParallelism.</span><span class="sxs-lookup"><span data-stu-id="464dc-168">If you don't know hello number of partitions, you can set hello MaxDegreeOfParallelism tooa high number, and hello system chooses hello minimum (number of partitions, user provided input) as hello MaxDegreeOfParallelism.</span></span>

    <span data-ttu-id="464dc-169">É importante toonote que paralelo de consultas produzir Olá melhores benefícios se Olá dados forem distribuídos uniformemente em todas as partições com respeito toohello consulta.</span><span class="sxs-lookup"><span data-stu-id="464dc-169">It is important toonote that parallel queries produce hello best benefits if hello data is evenly distributed across all partitions with respect toohello query.</span></span> <span data-ttu-id="464dc-170">Se Olá particionada coleção é particionada forma que todos ou a maior parte dos dados hello retornados por uma consulta é concentrada em algumas partições (na pior das hipóteses, uma partição) e desempenho Olá de consulta Olá seria um afunilamento por essas partições.</span><span class="sxs-lookup"><span data-stu-id="464dc-170">If hello partitioned collection is partitioned such a way that all or a majority of hello data returned by a query is concentrated in a few partitions (one partition in worst case), then hello performance of hello query would be bottlenecked by those partitions.</span></span>

    <span data-ttu-id="464dc-171">(b) ***ajuste MaxBufferedItemCount\: *** consulta paralela é resultados de busca de toopre projetado enquanto o lote atual de saudação de resultados está sendo processada pelo cliente hello.</span><span class="sxs-lookup"><span data-stu-id="464dc-171">(b) ***Tuning MaxBufferedItemCount\:*** Parallel query is designed toopre-fetch results while hello current batch of results is being processed by hello client.</span></span> <span data-ttu-id="464dc-172">Olá pré-leitura ajuda a melhoria de latência geral de uma consulta.</span><span class="sxs-lookup"><span data-stu-id="464dc-172">hello pre-fetching helps in overall latency improvement of a query.</span></span> <span data-ttu-id="464dc-173">MaxBufferedItemCount é Olá parâmetro toolimit Olá número de resultados pré-buscados.</span><span class="sxs-lookup"><span data-stu-id="464dc-173">MaxBufferedItemCount is hello parameter toolimit hello number of pre-fetched results.</span></span> <span data-ttu-id="464dc-174">Configuração MaxBufferedItemCount toohello esperado número de resultados retornados (ou um número mais alto) permite Olá consulta tooreceive máximo benefício de busca prévia.</span><span class="sxs-lookup"><span data-stu-id="464dc-174">Setting MaxBufferedItemCount toohello expected number of results returned (or a higher number) allows hello query tooreceive maximum benefit from pre-fetching.</span></span>

    <span data-ttu-id="464dc-175">Observe que funciona pré-busca Olá mesmo maneira independentemente da saudação MaxDegreeOfParallelism e há um único buffer para dados de saudação de todas as partições.</span><span class="sxs-lookup"><span data-stu-id="464dc-175">Note that pre-fetching works hello same way irrespective of hello MaxDegreeOfParallelism, and there is a single buffer for hello data from all partitions.</span></span>  
5. <span data-ttu-id="464dc-176">**Ativar o GC no lado do servidor**</span><span class="sxs-lookup"><span data-stu-id="464dc-176">**Turn on server-side GC**</span></span>

    <span data-ttu-id="464dc-177">Reduzir Olá frequência da coleta de lixo pode ajudar em alguns casos.</span><span class="sxs-lookup"><span data-stu-id="464dc-177">Reducing hello frequency of garbage collection may help in some cases.</span></span> <span data-ttu-id="464dc-178">No .NET, defina [gcServer](https://msdn.microsoft.com/library/ms229357.aspx) tootrue.</span><span class="sxs-lookup"><span data-stu-id="464dc-178">In .NET, set [gcServer](https://msdn.microsoft.com/library/ms229357.aspx) tootrue.</span></span>
6. <span data-ttu-id="464dc-179">**Implementar a retirada em intervalos de RetryAfter**</span><span class="sxs-lookup"><span data-stu-id="464dc-179">**Implement backoff at RetryAfter intervals**</span></span>

    <span data-ttu-id="464dc-180">Durante o teste de desempenho, você deve aumentar a carga até que uma pequena taxa de solicitações seja restringida.</span><span class="sxs-lookup"><span data-stu-id="464dc-180">During performance testing, you should increase load until a small rate of requests get throttled.</span></span> <span data-ttu-id="464dc-181">Se limitada, o aplicativo de cliente hello deve retirada na limitação para o intervalo de repetição especificada pelo servidor de saudação.</span><span class="sxs-lookup"><span data-stu-id="464dc-181">If throttled, hello client application should backoff on throttle for hello server-specified retry interval.</span></span> <span data-ttu-id="464dc-182">Respeitar Olá retirada garante que você passe a quantidade mínima de tempo de espera entre as repetições.</span><span class="sxs-lookup"><span data-stu-id="464dc-182">Respecting hello backoff ensures that you spend minimal amount of time waiting between retries.</span></span> <span data-ttu-id="464dc-183">Suporte de política de repetição está incluído na versão 1.8.0 e posterior da saudação documentos [.NET](documentdb-sdk-dotnet.md) e [Java](documentdb-sdk-java.md), versão 1.9.0 e acima de saudação [Node.js](documentdb-sdk-node.md) e [ Python](documentdb-sdk-python.md), e todas as versões com suporte do hello [.NET Core](documentdb-sdk-dotnet-core.md) SDKs.</span><span class="sxs-lookup"><span data-stu-id="464dc-183">Retry policy support is included in Version 1.8.0 and above of hello DocumentDB [.NET](documentdb-sdk-dotnet.md) and [Java](documentdb-sdk-java.md), version 1.9.0 and above of hello [Node.js](documentdb-sdk-node.md) and [Python](documentdb-sdk-python.md), and all supported versions of hello [.NET Core](documentdb-sdk-dotnet-core.md) SDKs.</span></span> <span data-ttu-id="464dc-184">Para saber mais, confira [Exceder os limites da taxa de transferência reservada](request-units.md#RequestRateTooLarge) e [RetryAfter](https://msdn.microsoft.com/library/microsoft.azure.documents.documentclientexception.retryafter.aspx).</span><span class="sxs-lookup"><span data-stu-id="464dc-184">For more information, see [Exceeding reserved throughput limits](request-units.md#RequestRateTooLarge) and [RetryAfter](https://msdn.microsoft.com/library/microsoft.azure.documents.documentclientexception.retryafter.aspx).</span></span>
7. <span data-ttu-id="464dc-185">**Escalar horizontalmente sua carga de trabalho do cliente**</span><span class="sxs-lookup"><span data-stu-id="464dc-185">**Scale out your client-workload**</span></span>

    <span data-ttu-id="464dc-186">Se você estiver testando em níveis de alta taxa de transferência (> 50.000 RU/s), aplicativo de cliente hello pode se tornar um afunilamento Olá devido toohello máquina limitar na utilização da CPU ou de rede.</span><span class="sxs-lookup"><span data-stu-id="464dc-186">If you are testing at high throughput levels (>50,000 RU/s), hello client application may become hello bottleneck due toohello machine capping out on CPU or Network utilization.</span></span> <span data-ttu-id="464dc-187">Se você chegar a este ponto, você pode continuar a conta de banco de dados do Cosmos de saudação toopush mais expandindo seus aplicativos de cliente em vários servidores.</span><span class="sxs-lookup"><span data-stu-id="464dc-187">If you reach this point, you can continue toopush hello Cosmos DB account further by scaling out your client applications across multiple servers.</span></span>
8. <span data-ttu-id="464dc-188">**Armazenar em cache os URIs do documento para uma menor latência de leitura**</span><span class="sxs-lookup"><span data-stu-id="464dc-188">**Cache document URIs for lower read latency**</span></span>

    <span data-ttu-id="464dc-189">Documento URIs sempre que possível para melhor desempenho de leitura de saudação do cache.</span><span class="sxs-lookup"><span data-stu-id="464dc-189">Cache document URIs whenever possible for hello best read performance.</span></span>
   <a id="tune-page-size"></a>
9. <span data-ttu-id="464dc-190">**Ajustar o tamanho da página Olá para feeds de consultas/leitura para melhorar o desempenho**</span><span class="sxs-lookup"><span data-stu-id="464dc-190">**Tune hello page size for queries/read feeds for better performance**</span></span>

    <span data-ttu-id="464dc-191">Quando executar a maior parte de leitura de documentos usando leitura feed funcionalidade (por exemplo, ReadDocumentFeedAsync) ou ao emitir uma consulta SQL do DocumentDB, os resultados de saudação são retornados de modo segmentado se Olá conjunto de resultados for muito grande.</span><span class="sxs-lookup"><span data-stu-id="464dc-191">When performing a bulk read of documents using read feed functionality (for example, ReadDocumentFeedAsync) or when issuing a DocumentDB SQL query, hello results are returned in a segmented fashion if hello result set is too large.</span></span> <span data-ttu-id="464dc-192">Por padrão, os resultados são retornados em blocos de 100 itens ou 1 MB, o limite que for atingido primeiro.</span><span class="sxs-lookup"><span data-stu-id="464dc-192">By default, results are returned in chunks of 100 items or 1 MB, whichever limit is hit first.</span></span>

    <span data-ttu-id="464dc-193">tooreduce número de saudação de rede tooretrieve de viagens de ida e necessárias todos os resultados aplicável, você pode aumentar o tamanho da página hello usando too1000 de tooup de cabeçalho de solicitação x-ms-max-item-count.</span><span class="sxs-lookup"><span data-stu-id="464dc-193">tooreduce hello number of network round trips required tooretrieve all applicable results, you can increase hello page size using x-ms-max-item-count request header tooup too1000.</span></span> <span data-ttu-id="464dc-194">Em casos em que você precisa toodisplay apenas alguns resultados, por exemplo, se sua API de aplicativo ou de interface do usuário retorna apenas 10 resultados de um tempo, você também pode diminuir Olá tamanho too10 tooreduce Olá taxa de transferência página consumida para leituras e consultas.</span><span class="sxs-lookup"><span data-stu-id="464dc-194">In cases where you need toodisplay only a few results, for example, if your user interface or application API returns only 10 results a time, you can also decrease hello page size too10 tooreduce hello throughput consumed for reads and queries.</span></span>

    <span data-ttu-id="464dc-195">Você também pode definir o tamanho da página hello usando Olá disponível SDKs de banco de dados do Cosmos.</span><span class="sxs-lookup"><span data-stu-id="464dc-195">You may also set hello page size using hello available Cosmos DB SDKs.</span></span>  <span data-ttu-id="464dc-196">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="464dc-196">For example:</span></span>

        IQueryable<dynamic> authorResults = client.CreateDocumentQuery(documentCollection.SelfLink, "SELECT p.Author FROM Pages p WHERE p.Title = 'About Seattle'", new FeedOptions { MaxItemCount = 1000 });
10. <span data-ttu-id="464dc-197">**Aumentar o número de threads/tarefas**</span><span class="sxs-lookup"><span data-stu-id="464dc-197">**Increase number of threads/tasks**</span></span>

    <span data-ttu-id="464dc-198">Consulte [aumentar o número de threads/tarefas](#increase-threads) em Olá seção de rede.</span><span class="sxs-lookup"><span data-stu-id="464dc-198">See [Increase number of threads/tasks](#increase-threads) in hello Networking section.</span></span>

11. <span data-ttu-id="464dc-199">**Usar o processamento do host de 64 bits**</span><span class="sxs-lookup"><span data-stu-id="464dc-199">**Use 64-bit host processing**</span></span>

    <span data-ttu-id="464dc-200">Olá SDK do DocumentDB funciona em um processo de host de 32 bits quando você estiver usando o SDK do DocumentDB .NET versão 1.11.4 e posterior.</span><span class="sxs-lookup"><span data-stu-id="464dc-200">hello DocumentDB SDK works in a 32-bit host process when you are using DocumentDB .NET SDK version 1.11.4 and above.</span></span> <span data-ttu-id="464dc-201">No entanto, se você usa consultas entre partições, recomenda-se o processamento de host de 64 bits para melhorar o desempenho.</span><span class="sxs-lookup"><span data-stu-id="464dc-201">However, if you are using cross partition queries, 64-bit host processing is recommended for improved performance.</span></span> <span data-ttu-id="464dc-202">Olá seguintes tipos de aplicativos que o host de 32 bits processar como padrão hello, portanto em ordem toochange ou too64 bits, siga estas etapas com base no tipo de saudação do seu aplicativo:</span><span class="sxs-lookup"><span data-stu-id="464dc-202">hello following types of applications have 32-bit host process as hello default, so in order toochange that too64-bit, follow these steps based on hello type of your application:</span></span>

    - <span data-ttu-id="464dc-203">Para aplicativos do executável, isso pode ser feito por Olá desmarcando **preferir 32-bit** opção Olá **propriedades do projeto** janela Olá **criar** guia.</span><span class="sxs-lookup"><span data-stu-id="464dc-203">For Executable applications, this can be done by unchecking hello **Prefer 32-bit** option in hello **Project Properties** window, on hello **Build** tab.</span></span>

    - <span data-ttu-id="464dc-204">Para projetos de teste com base em VSTest, isso pode ser feito selecionando **teste**->**configurações do teste**->**padrão arquitetura de processador X64**, de saudação **Visual Studio Test** opção de menu.</span><span class="sxs-lookup"><span data-stu-id="464dc-204">For VSTest based test projects, this can be done by selecting **Test**->**Test Settings**->**Default Processor Architecture as X64**, from hello **Visual Studio Test** menu option.</span></span>

    - <span data-ttu-id="464dc-205">Para aplicativos Web ASP.NET implantados localmente, isso pode ser feito verificando Olá **versão de 64 bits de saudação uso do IIS Express para sites e projetos**, em **ferramentas** ->  **Opções de**->**projetos e soluções**->**projetos Web**.</span><span class="sxs-lookup"><span data-stu-id="464dc-205">For locally deployed ASP.NET Web applications, this can be done by checking hello **Use hello 64-bit version of IIS Express for web sites and projects**, under **Tools**->**Options**->**Projects and Solutions**->**Web Projects**.</span></span>

    - <span data-ttu-id="464dc-206">Para aplicativos Web ASP.NET implantados no Azure, isso pode ser feito escolhendo Olá **plataforma de 64 bits** em Olá **configurações de aplicativo** em Olá portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="464dc-206">For ASP.NET Web applications deployed on Azure, this can be done by choosing hello **Platform as 64-bit** in hello **Application Settings** on hello Azure portal.</span></span>

## <a name="indexing-policy"></a><span data-ttu-id="464dc-207">Política de indexação</span><span class="sxs-lookup"><span data-stu-id="464dc-207">Indexing Policy</span></span>
1. <span data-ttu-id="464dc-208">**Usar a indexação lenta para as taxas de ingestão de tempo máximo mais rápidas**</span><span class="sxs-lookup"><span data-stu-id="464dc-208">**Use lazy indexing for faster peak time ingestion rates**</span></span>

    <span data-ttu-id="464dc-209">Banco de dados do cosmos permite toospecify – no nível de coleção hello – uma política de indexação, o que permite que você toochoose se desejar Olá documentos em um toobe coleção indexada automaticamente ou não.</span><span class="sxs-lookup"><span data-stu-id="464dc-209">Cosmos DB allows you toospecify – at hello collection level – an indexing policy, which enables you toochoose if you want hello documents in a collection toobe automatically indexed or not.</span></span>  <span data-ttu-id="464dc-210">Além disso, você também pode escolher entre as atualizações do índice síncronas (Consistentes) e assíncronas (Lentas).</span><span class="sxs-lookup"><span data-stu-id="464dc-210">In addition, you may also choose between synchronous (Consistent) and asynchronous (Lazy) index updates.</span></span> <span data-ttu-id="464dc-211">Por padrão, o índice de saudação é atualizado de forma síncrona em cada inserção, substituir ou excluir de uma coleção de toohello do documento.</span><span class="sxs-lookup"><span data-stu-id="464dc-211">By default, hello index is updated synchronously on each insert, replace, or delete of a document toohello collection.</span></span> <span data-ttu-id="464dc-212">Modo síncrono toohonor de consultas do modo habilita Olá Olá mesmo [nível de consistência](consistency-levels.md) da saudação documento lê sem qualquer atraso de índice Olá muito "atualizado".</span><span class="sxs-lookup"><span data-stu-id="464dc-212">Synchronously mode enables hello queries toohonor hello same [consistency level](consistency-levels.md) as that of hello document reads without any delay for hello index too“catch up".</span></span>

    <span data-ttu-id="464dc-213">A indexação lenta pode ser considerada para cenários em que os dados são gravados em intermitências e deseja tooamortize Olá trabalho necessário tooindex conteúdo em um período mais longo de tempo.</span><span class="sxs-lookup"><span data-stu-id="464dc-213">Lazy indexing may be considered for scenarios in which data is written in bursts, and you want tooamortize hello work required tooindex content over a longer period of time.</span></span> <span data-ttu-id="464dc-214">A indexação lenta também permite que você toouse sua provisionado a taxa de transferência com eficiência e atender solicitações de gravação em horários de pico com latência mínima.</span><span class="sxs-lookup"><span data-stu-id="464dc-214">Lazy indexing also allows you toouse your provisioned throughput effectively and serve write requests at peak times with minimal latency.</span></span> <span data-ttu-id="464dc-215">É importante toonote, no entanto, que, quando a indexação lento está habilitada, resultados da consulta são eventualmente consistentes, independentemente do nível de consistência de saudação configurado para conta de banco de dados do Cosmos hello.</span><span class="sxs-lookup"><span data-stu-id="464dc-215">It is important toonote, however, that when lazy indexing is enabled, query results are eventually consistent regardless of hello consistency level configured for hello Cosmos DB account.</span></span>

    <span data-ttu-id="464dc-216">Portanto, modo consistente de indexação (IndexingPolicy.IndexingMode é definido tooConsistent) incorre em custos unidade solicitação de hello mais alto por gravação enquanto Lazy indexação modo (IndexingPolicy.IndexingMode é definido tooLazy) e nenhum indexação (IndexingPolicy.Automatic é definido tooFalse) tenha o custo zero indexação Olá tempo de gravação.</span><span class="sxs-lookup"><span data-stu-id="464dc-216">Hence, Consistent indexing mode (IndexingPolicy.IndexingMode is set tooConsistent) incurs hello highest request unit charge per write, while Lazy indexing mode (IndexingPolicy.IndexingMode is set tooLazy) and no indexing (IndexingPolicy.Automatic is set tooFalse) have zero indexing cost at hello time of write.</span></span>
2. <span data-ttu-id="464dc-217">**Excluir caminhos não utilizados da indexação para ter gravações mais rápidas**</span><span class="sxs-lookup"><span data-stu-id="464dc-217">**Exclude unused paths from indexing for faster writes**</span></span>

    <span data-ttu-id="464dc-218">Política de indexação do cosmos do banco de dados também permite que você toospecify que tooinclude caminhos de documento ou excluídos da indexação, aproveitando os caminhos de indexação (IndexingPolicy.IncludedPaths e IndexingPolicy.ExcludedPaths).</span><span class="sxs-lookup"><span data-stu-id="464dc-218">Cosmos DB’s indexing policy also allows you toospecify which document paths tooinclude or exclude from indexing by leveraging Indexing Paths (IndexingPolicy.IncludedPaths and IndexingPolicy.ExcludedPaths).</span></span> <span data-ttu-id="464dc-219">use Olá dos caminhos de indexação pode oferecer desempenho aprimorado de gravação e armazenamento de índice inferior para cenários que Olá padrões de consulta são conhecidos com antecedência, assim como os custos de indexação diretamente correlacionado toohello número exclusivo caminhos indexados.</span><span class="sxs-lookup"><span data-stu-id="464dc-219">hello use of indexing paths can offer improved write performance and lower index storage for scenarios in which hello query patterns are known beforehand, as indexing costs are directly correlated toohello number of unique paths indexed.</span></span>  <span data-ttu-id="464dc-220">Por exemplo, a saudação de código a seguir mostra como tooexclude uma seção inteira de saudação documentos (também conhecido como</span><span class="sxs-lookup"><span data-stu-id="464dc-220">For example, hello following code shows how tooexclude an entire section of hello documents (a.k.a.</span></span> <span data-ttu-id="464dc-221">uma subárvore) de indexação usando hello "*" curinga.</span><span class="sxs-lookup"><span data-stu-id="464dc-221">a subtree) from indexing using hello "*" wildcard.</span></span>

    ```C#
    var collection = new DocumentCollection { Id = "excludedPathCollection" };
    collection.IndexingPolicy.IncludedPaths.Add(new IncludedPath { Path = "/*" });
    collection.IndexingPolicy.ExcludedPaths.Add(new ExcludedPath { Path = "/nonIndexedContent/*");
    collection = await client.CreateDocumentCollectionAsync(UriFactory.CreateDatabaseUri("db"), excluded);
    ```

    <span data-ttu-id="464dc-222">Para obter mais informações, consulte [Políticas de indexação do Azure Cosmos DB](indexing-policies.md).</span><span class="sxs-lookup"><span data-stu-id="464dc-222">For more information, see [Azure Cosmos DB indexing policies](indexing-policies.md).</span></span>

## <a name="throughput"></a><span data-ttu-id="464dc-223">Taxa de transferência</span><span class="sxs-lookup"><span data-stu-id="464dc-223">Throughput</span></span>
<a id="measure-rus"></a>

1. <span data-ttu-id="464dc-224">**Medir e ajustar para o uso mais baixo de unidades/segundo da solicitação**</span><span class="sxs-lookup"><span data-stu-id="464dc-224">**Measure and tune for lower request units/second usage**</span></span>

    <span data-ttu-id="464dc-225">Cosmos banco de dados oferece um conjunto avançado de operações de banco de dados, incluindo consultas relacionais e hierárquicas com UDFs, procedimentos armazenados e gatilhos – todos os controles em documentos hello dentro de uma coleção de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="464dc-225">Cosmos DB offers a rich set of database operations including relational and hierarchical queries with UDFs, stored procedures, and triggers – all operating on hello documents within a database collection.</span></span> <span data-ttu-id="464dc-226">custo de saudação associado a cada uma dessas operações varia de acordo com hello da CPU, e/s e memória necessária toocomplete Olá operação.</span><span class="sxs-lookup"><span data-stu-id="464dc-226">hello cost associated with each of these operations varies based on hello CPU, IO, and memory required toocomplete hello operation.</span></span> <span data-ttu-id="464dc-227">Em vez de pensar sobre e gerenciamento de recursos de hardware, você pode pensar uma unidade de solicitação (RU) como uma única medida para Olá recursos necessários tooperform várias operações de banco de dados e o serviço de uma solicitação de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="464dc-227">Instead of thinking about and managing hardware resources, you can think of a request unit (RU) as a single measure for hello resources required tooperform various database operations and service an application request.</span></span>

    <span data-ttu-id="464dc-228">[Unidades de solicitação](request-units.md) são provisionados para cada conta de banco de dados com base no número de saudação de unidades de capacidade que você comprar.</span><span class="sxs-lookup"><span data-stu-id="464dc-228">[Request units](request-units.md) are provisioned for each database account based on hello number of capacity units that you purchase.</span></span> <span data-ttu-id="464dc-229">O consumo da unidade de solicitação é avaliado em termos de taxa por segundo.</span><span class="sxs-lookup"><span data-stu-id="464dc-229">Request unit consumption is evaluated as a rate per second.</span></span> <span data-ttu-id="464dc-230">Aplicativos que excedem a unidade de solicitação provisionado Olá taxa para sua conta é limitada até que a taxa de saudação fique abaixo Olá nível reservado para a conta de saudação.</span><span class="sxs-lookup"><span data-stu-id="464dc-230">Applications that exceed hello provisioned request unit rate for their account is limited until hello rate drops below hello reserved level for hello account.</span></span> <span data-ttu-id="464dc-231">Se o seu aplicativo exigir um nível mais alto de taxa de transferência, você pode comprar unidades de capacidade adicionais.</span><span class="sxs-lookup"><span data-stu-id="464dc-231">If your application requires a higher level of throughput, you can purchase additional capacity units.</span></span>

    <span data-ttu-id="464dc-232">complexidade de saudação de uma consulta afeta quantas unidades de solicitação são consumidas para uma operação.</span><span class="sxs-lookup"><span data-stu-id="464dc-232">hello complexity of a query impacts how many Request Units are consumed for an operation.</span></span> <span data-ttu-id="464dc-233">número de Olá de predicados, natureza de predicados hello, número de UDFs e tamanho de saudação do conjunto de dados de origem Olá todos influenciam o custo de saudação de operações de consulta.</span><span class="sxs-lookup"><span data-stu-id="464dc-233">hello number of predicates, nature of hello predicates, number of UDFs, and hello size of hello source data set all influence hello cost of query operations.</span></span>

    <span data-ttu-id="464dc-234">sobrecarga de saudação toomeasure de qualquer operação (criar, atualizar ou excluir), inspecionar o cabeçalho x-ms-taxa de solicitação de saudação (ou Olá propriedade RequestCharge equivalente em ResourceResponse<T> ou FeedResponse<T> em Olá .NET SDK) toomeasure número de saudação de unidades de solicitação consumida por essas operações.</span><span class="sxs-lookup"><span data-stu-id="464dc-234">toomeasure hello overhead of any operation (create, update, or delete), inspect hello x-ms-request-charge header (or hello equivalent RequestCharge property in ResourceResponse<T> or FeedResponse<T> in hello .NET SDK) toomeasure hello number of request units consumed by these operations.</span></span>

    ```C#
    // Measure hello performance (request units) of writes
    ResourceResponse<Document> response = await client.CreateDocumentAsync(collectionSelfLink, myDocument);
    Console.WriteLine("Insert of document consumed {0} request units", response.RequestCharge);
    // Measure hello performance (request units) of queries
    IDocumentQuery<dynamic> queryable = client.CreateDocumentQuery(collectionSelfLink, queryString).AsDocumentQuery();
    while (queryable.HasMoreResults)
         {
              FeedResponse<dynamic> queryResponse = await queryable.ExecuteNextAsync<dynamic>();
              Console.WriteLine("Query batch consumed {0} request units", queryResponse.RequestCharge);
         }
    ```             

    <span data-ttu-id="464dc-235">taxa de solicitação retornada nesse cabeçalho Hello é uma fração de sua taxa de transferência fornecida (ou seja, 2000 RUs / segundo).</span><span class="sxs-lookup"><span data-stu-id="464dc-235">hello request charge returned in this header is a fraction of your provisioned throughput (i.e., 2000 RUs / second).</span></span> <span data-ttu-id="464dc-236">Por exemplo, se hello consulta anterior retorna 1KB de 1000 documentos, o custo de saudação da operação de saudação é 1000.</span><span class="sxs-lookup"><span data-stu-id="464dc-236">For example, if hello preceding query returns 1000 1KB-documents, hello cost of hello operation is 1000.</span></span> <span data-ttu-id="464dc-237">Como tal, dentro de um segundo, servidor de saudação honra apenas dois tais solicitações antes da limitação de solicitações subsequentes.</span><span class="sxs-lookup"><span data-stu-id="464dc-237">As such, within one second, hello server honors only two such requests before throttling subsequent requests.</span></span> <span data-ttu-id="464dc-238">Para obter mais informações, consulte [unidades de solicitação](request-units.md) e hello [Calculadora de unidade de solicitação](https://www.documentdb.com/capacityplanner).</span><span class="sxs-lookup"><span data-stu-id="464dc-238">For more information, see [Request units](request-units.md) and hello [request unit calculator](https://www.documentdb.com/capacityplanner).</span></span>
<a id="429"></a>
2. <span data-ttu-id="464dc-239">**Lidar com uma limitação da taxa/taxa de solicitação muito grande**</span><span class="sxs-lookup"><span data-stu-id="464dc-239">**Handle rate limiting/request rate too large**</span></span>

    <span data-ttu-id="464dc-240">Quando um cliente tenta tooexceed Olá taxa de transferência reservada para uma conta, não há sem degradação do desempenho no servidor de saudação e sem uso da capacidade da taxa de transferência além do nível de saudação reservada.</span><span class="sxs-lookup"><span data-stu-id="464dc-240">When a client attempts tooexceed hello reserved throughput for an account, there is no performance degradation at hello server and no use of throughput capacity beyond hello reserved level.</span></span> <span data-ttu-id="464dc-241">servidor de saudação preventivamente terminará solicitação Olá com RequestRateTooLarge (código de status HTTP 429) e retorno Olá o cabeçalho x-ms-repetição-após-ms indicando de saudação período de tempo, em milissegundos, que Olá usuário deve aguardar antes de tentar novamente a solicitação de saudação.</span><span class="sxs-lookup"><span data-stu-id="464dc-241">hello server will preemptively end hello request with RequestRateTooLarge (HTTP status code 429) and return hello x-ms-retry-after-ms header indicating hello amount of time, in milliseconds, that hello user must wait before reattempting hello request.</span></span>

        HTTP Status 429,
        Status Line: RequestRateTooLarge
        x-ms-retry-after-ms :100

    <span data-ttu-id="464dc-242">Olá SDKs implicitamente todos os catch essa resposta, respeitam Olá servidor especificado cabeçalho retry-after e repita a solicitação hello.</span><span class="sxs-lookup"><span data-stu-id="464dc-242">hello SDKs all implicitly catch this response, respect hello server-specified retry-after header, and retry hello request.</span></span> <span data-ttu-id="464dc-243">A menos que sua conta está sendo acessada simultaneamente por vários clientes, a próxima repetição de saudação terá êxito.</span><span class="sxs-lookup"><span data-stu-id="464dc-243">Unless your account is being accessed concurrently by multiple clients, hello next retry will succeed.</span></span>

    <span data-ttu-id="464dc-244">Se você tiver mais de um cliente cumulativamente funcionando consistentemente acima de taxa de solicitação hello, Olá contagem de repetições padrão atualmente too9 conjunto internamente pelo cliente Olá pode não ser suficiente; Nesse caso, o cliente hello gera um DocumentClientException com o aplicativo de 429 toohello status código.</span><span class="sxs-lookup"><span data-stu-id="464dc-244">If you have more than one client cumulatively operating consistently above hello request rate, hello default retry count currently set too9 internally by hello client may not suffice; in this case, hello client throws a DocumentClientException with status code 429 toohello application.</span></span> <span data-ttu-id="464dc-245">Contagem de repetições saudação padrão pode ser alterada por Olá configuração RetryOptions na instância de ConnectionPolicy hello.</span><span class="sxs-lookup"><span data-stu-id="464dc-245">hello default retry count can be changed by setting hello RetryOptions on hello ConnectionPolicy instance.</span></span> <span data-ttu-id="464dc-246">Por padrão, Olá DocumentClientException com código de status 429 será retornado após um tempo de espera cumulativo de 30 segundos se solicitação Olá continua toooperate acima a taxa de solicitação de saudação.</span><span class="sxs-lookup"><span data-stu-id="464dc-246">By default, hello DocumentClientException with status code 429 is returned after a cumulative wait time of 30 seconds if hello request continues toooperate above hello request rate.</span></span> <span data-ttu-id="464dc-247">Isso ocorre mesmo quando Olá repetir contagem atual é menor que a contagem de repetição máxima Olá, seja padrão Olá 9 ou um valor definido pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="464dc-247">This occurs even when hello current retry count is less than hello max retry count, be it hello default of 9 or a user-defined value.</span></span>

    <span data-ttu-id="464dc-248">Enquanto automatizada hello comportamento de repetição ajuda tooimprove flexibilidade e facilidade de uso para Olá a maioria dos aplicativos, pode vir oposto ao fazer as avaliações de desempenho, especialmente quando medindo a latência.</span><span class="sxs-lookup"><span data-stu-id="464dc-248">While hello automated retry behavior helps tooimprove resiliency and usability for hello most applications, it might come at odds when doing performance benchmarks, especially when measuring latency.</span></span>  <span data-ttu-id="464dc-249">latência de cliente observado Hello serão apresentam picos se experimento Olá atinge a limitação do servidor de saudação e faz com que o cliente Olá repetição de toosilently do SDK.</span><span class="sxs-lookup"><span data-stu-id="464dc-249">hello client-observed latency will spike if hello experiment hits hello server throttle and causes hello client SDK toosilently retry.</span></span> <span data-ttu-id="464dc-250">latência de tooavoid picos durante testes de desempenho, medidas Olá custos retornado por cada operação e garantir que as solicitações são operando abaixo de taxa de solicitação reservado hello.</span><span class="sxs-lookup"><span data-stu-id="464dc-250">tooavoid latency spikes during performance experiments, measure hello charge returned by each operation and ensure that requests are operating below hello reserved request rate.</span></span> <span data-ttu-id="464dc-251">Para saber mais, consulte [Unidades de solicitação](request-units.md).</span><span class="sxs-lookup"><span data-stu-id="464dc-251">For more information, see [Request units](request-units.md).</span></span>
3. <span data-ttu-id="464dc-252">**Design de documentos menores para uma maior taxa de transferência**</span><span class="sxs-lookup"><span data-stu-id="464dc-252">**Design for smaller documents for higher throughput**</span></span>

    <span data-ttu-id="464dc-253">Olá a carga de solicitação (ou seja, o custo de processamento de solicitação) de uma determinada operação é diretamente correlacionado toohello tamanho do documento hello.</span><span class="sxs-lookup"><span data-stu-id="464dc-253">hello request charge (i.e. request processing cost) of a given operation is directly correlated toohello size of hello document.</span></span> <span data-ttu-id="464dc-254">As operações em documentos grandes custam mais que as operações de documentos pequenos.</span><span class="sxs-lookup"><span data-stu-id="464dc-254">Operations on large documents cost more than operations for small documents.</span></span>

## <a name="next-steps"></a><span data-ttu-id="464dc-255">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="464dc-255">Next steps</span></span>
<span data-ttu-id="464dc-256">Para um tooevaluate do aplicativo usado de exemplo Cosmos DB para cenários de alto desempenho em algumas máquinas cliente, consulte [desempenho e dimensionamento de teste com o banco de dados do Cosmos](performance-testing.md).</span><span class="sxs-lookup"><span data-stu-id="464dc-256">For a sample application used tooevaluate Cosmos DB for high-performance scenarios on a few client machines, see [Performance and scale testing with Cosmos DB](performance-testing.md).</span></span>

<span data-ttu-id="464dc-257">Além disso, toolearn mais sobre como criar seu aplicativo de escala e de alto desempenho, consulte [particionamento e escala no banco de dados do Azure Cosmos](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="464dc-257">Also, toolearn more about designing your application for scale and high performance, see [Partitioning and scaling in Azure Cosmos DB](partition-data.md).</span></span>
