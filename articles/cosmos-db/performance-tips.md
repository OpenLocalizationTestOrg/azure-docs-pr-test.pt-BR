---
title: "Dicas de desempenho – NoSQL do Azure Cosmos DB | Microsoft Docs"
description: "Saiba mais sobre as opções de configuração do cliente para melhorar o desempenho de banco de dados do Azure Cosmos DB"
keywords: como melhorar o desempenho do banco de dados
services: cosmos-db
author: mimig1
manager: jhubbard
editor: 
documentationcenter: 
ms.assetid: 94ff155e-f9bc-488f-8c7a-5e7037091bb9
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/23/2017
ms.author: mimig
ms.openlocfilehash: a94cda90eca9dca2b93adb8f5091d829e7375aa5
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/03/2017
---
# <a name="performance-tips-for-azure-cosmos-db"></a><span data-ttu-id="26ce6-104">Dicas de desempenho para o Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="26ce6-104">Performance tips for Azure Cosmos DB</span></span>
<span data-ttu-id="26ce6-105">O Azure Cosmos DB é um banco de dados distribuído rápido e flexível que pode ser dimensionado perfeitamente com garantia de latência e produtividade.</span><span class="sxs-lookup"><span data-stu-id="26ce6-105">Azure Cosmos DB is a fast and flexible distributed database that scales seamlessly with guaranteed latency and throughput.</span></span> <span data-ttu-id="26ce6-106">Você não precisa fazer alterações importantes de arquitetura nem escrever um código complexo para dimensionar seu banco de dados com o Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="26ce6-106">You do not have to make major architecture changes or write complex code to scale your database with Cosmos DB.</span></span> <span data-ttu-id="26ce6-107">Aumentar e reduzir é tão fácil quanto fazer uma única chamada da API ou uma [chamada do método do SDK](set-throughput.md#set-throughput-sdk).</span><span class="sxs-lookup"><span data-stu-id="26ce6-107">Scaling up and down is as easy as making a single API call or [SDK method call](set-throughput.md#set-throughput-sdk).</span></span> <span data-ttu-id="26ce6-108">No entanto, como o Cosmos DB é acessado por meio de chamadas de rede, há otimizações do lado do cliente que você pode fazer para obter o desempenho máximo.</span><span class="sxs-lookup"><span data-stu-id="26ce6-108">However, because Cosmos DB is accessed via network calls there are client-side optimizations you can make to achieve peak performance.</span></span>

<span data-ttu-id="26ce6-109">Assim, se você estiver se perguntando "Como posso melhorar o desempenho do meu banco de dados?",</span><span class="sxs-lookup"><span data-stu-id="26ce6-109">So if you're asking "How can I improve my database performance?"</span></span> <span data-ttu-id="26ce6-110">considere as seguintes opções:</span><span class="sxs-lookup"><span data-stu-id="26ce6-110">consider the following options:</span></span>

## <a name="networking"></a><span data-ttu-id="26ce6-111">Rede</span><span class="sxs-lookup"><span data-stu-id="26ce6-111">Networking</span></span>
<a id="direct-connection"></a>

1. <span data-ttu-id="26ce6-112">**Política de conexão: usar o modo de conexão direta**</span><span class="sxs-lookup"><span data-stu-id="26ce6-112">**Connection policy: Use direct connection mode**</span></span>

    <span data-ttu-id="26ce6-113">Como um cliente se conecta ao Cosmos DB tem implicações importantes no desempenho, especialmente em termos da latência do lado do cliente observada.</span><span class="sxs-lookup"><span data-stu-id="26ce6-113">How a client connects to Cosmos DB has important implications on performance, especially in terms of observed client-side latency.</span></span> <span data-ttu-id="26ce6-114">Há duas definições principais da configuração disponíveis para configurar a Política de conexão do cliente – o *modo* da conexão e o [protocolo da *conexão*](#connection-protocol).</span><span class="sxs-lookup"><span data-stu-id="26ce6-114">There are two key configuration settings available for configuring client Connection Policy – the connection *mode* and the [connection *protocol*](#connection-protocol).</span></span>  <span data-ttu-id="26ce6-115">Os dois modos disponíveis são:</span><span class="sxs-lookup"><span data-stu-id="26ce6-115">The two available modes are:</span></span>

   1. <span data-ttu-id="26ce6-116">Modo Gateway (padrão)</span><span class="sxs-lookup"><span data-stu-id="26ce6-116">Gateway Mode (default)</span></span>
   2. <span data-ttu-id="26ce6-117">Modo Direto</span><span class="sxs-lookup"><span data-stu-id="26ce6-117">Direct Mode</span></span>

      <span data-ttu-id="26ce6-118">O Modo Gateway é suportado em todas as plataformas SDK e é o padrão configurado.</span><span class="sxs-lookup"><span data-stu-id="26ce6-118">Gateway Mode is supported on all SDK platforms and is the configured default.</span></span>  <span data-ttu-id="26ce6-119">Se seu aplicativo for executado em uma rede corporativa com restrições de firewall rígidas, o Modo Gateway será a melhor opção, já que ele usa a porta HTTPS padrão e um único ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="26ce6-119">If your application runs within a corporate network with strict firewall restrictions, Gateway Mode is the best choice since it uses the standard HTTPS port and a single endpoint.</span></span> <span data-ttu-id="26ce6-120">Porém, a compensação do desempenho é que o Modo Gateway envolve um salto de rede adicional sempre que os dados são lidos ou gravados no Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="26ce6-120">The performance tradeoff, however, is that Gateway Mode involves an additional network hop every time data is read or written to Cosmos DB.</span></span> <span data-ttu-id="26ce6-121">Por isso, o Modo Direto oferece um melhor desempenho devido a menos saltos de rede.</span><span class="sxs-lookup"><span data-stu-id="26ce6-121">Because of this, Direct Mode offers better performance due to fewer network hops.</span></span>
<a id="use-tcp"></a>
2. <span data-ttu-id="26ce6-122">**Política de conexão: usar o protocolo TCP**</span><span class="sxs-lookup"><span data-stu-id="26ce6-122">**Connection policy: Use the TCP protocol**</span></span>

    <span data-ttu-id="26ce6-123">Ao usar o Modo Direto, há duas opções de protocolo disponíveis:</span><span class="sxs-lookup"><span data-stu-id="26ce6-123">When using Direct Mode, there are two protocol options available:</span></span>

   * <span data-ttu-id="26ce6-124">TCP</span><span class="sxs-lookup"><span data-stu-id="26ce6-124">TCP</span></span>
   * <span data-ttu-id="26ce6-125">HTTPS</span><span class="sxs-lookup"><span data-stu-id="26ce6-125">HTTPS</span></span>

     <span data-ttu-id="26ce6-126">O Cosmos DB oferece um modelo de programação RESTful simples e aberto por HTTPS.</span><span class="sxs-lookup"><span data-stu-id="26ce6-126">Cosmos DB offers a simple and open RESTful programming model over HTTPS.</span></span> <span data-ttu-id="26ce6-127">Além disso, ele oferece um protocolo TCP eficiente que também é RESTful em seu modelo de comunicação e está disponível por meio do SDK do cliente .NET.</span><span class="sxs-lookup"><span data-stu-id="26ce6-127">Additionally, it offers an efficient TCP protocol, which is also RESTful in its communication model and is available through the .NET client SDK.</span></span> <span data-ttu-id="26ce6-128">Tanto TCP direto quanto HTTPS usam SSL para criptografar tráfego e autenticação inicial.</span><span class="sxs-lookup"><span data-stu-id="26ce6-128">Both Direct TCP and HTTPS use SSL for initial authentication and encrypting traffic.</span></span> <span data-ttu-id="26ce6-129">Para ter um melhor desempenho, use o protocolo TCP quando possível.</span><span class="sxs-lookup"><span data-stu-id="26ce6-129">For best performance, use the TCP protocol when possible.</span></span>

     <span data-ttu-id="26ce6-130">Ao usar o TCP no Modo Gateway, a Porta TCP 443 é a porta do Cosmos DB e 10255 é a porta da API do MongoDB.</span><span class="sxs-lookup"><span data-stu-id="26ce6-130">When using TCP in Gateway Mode, TCP Port 443 is the Cosmos DB port, and 10255 is the MongoDB API port.</span></span> <span data-ttu-id="26ce6-131">Ao usar o TCP no Modo Direto, além das portas do Gateway, você precisa garantir que o intervalo de portas de 10000 a 20000 está aberto, pois o Cosmos DB usa portas TCP dinâmicas.</span><span class="sxs-lookup"><span data-stu-id="26ce6-131">When using TCP in Direct Mode, in addition to the Gateway ports, you need to ensure the port range between 10000 and 20000 is open because Cosmos DB uses dynamic TCP ports.</span></span> <span data-ttu-id="26ce6-132">Se essas portas não estiverem abertas e você tentar usar TCP, você receberá o erro 503 Serviço indisponível.</span><span class="sxs-lookup"><span data-stu-id="26ce6-132">If these ports are not open and you attempt to use TCP, you receive a 503 Service Unavailable error.</span></span>

     <span data-ttu-id="26ce6-133">O Modo Conectividade é configurado durante a construção da instância do DocumentClient com o parâmetro ConnectionPolicy.</span><span class="sxs-lookup"><span data-stu-id="26ce6-133">The Connectivity Mode is configured during the construction of the DocumentClient instance with the ConnectionPolicy parameter.</span></span> <span data-ttu-id="26ce6-134">Se o Modo Direto for usado, o Protocolo também poderá ser definido no parâmetro ConnectionPolicy.</span><span class="sxs-lookup"><span data-stu-id="26ce6-134">If Direct Mode is used, the Protocol can also be set within the ConnectionPolicy parameter.</span></span>

    ```C#
    var serviceEndpoint = new Uri("https://contoso.documents.net");
    var authKey = new "your authKey from the Azure portal";
    DocumentClient client = new DocumentClient(serviceEndpoint, authKey,
    new ConnectionPolicy
    {
        ConnectionMode = ConnectionMode.Direct,
        ConnectionProtocol = Protocol.Tcp
    });
    ```

    <span data-ttu-id="26ce6-135">Como o TCP tem suporte apenas no Modo Direto, se o Modo Gateway for usado, o protocolo HTTPS será sempre utilizado para se comunicar com o Gateway e o valor do Protocolo na ConnectionPolicy será ignorado.</span><span class="sxs-lookup"><span data-stu-id="26ce6-135">Because TCP is only supported in Direct Mode, if Gateway Mode is used, then the HTTPS protocol is always used to communicate with the Gateway and the Protocol value in the ConnectionPolicy is ignored.</span></span>

    ![Ilustração da política de conexão do Azure Cosmos DB](./media/performance-tips/connection-policy.png)

3. <span data-ttu-id="26ce6-137">**Chamar OpenAsync para evitar a latência de inicialização na primeira solicitação**</span><span class="sxs-lookup"><span data-stu-id="26ce6-137">**Call OpenAsync to avoid startup latency on first request**</span></span>

    <span data-ttu-id="26ce6-138">Por padrão, a primeira solicitação tem uma latência maior porque tem que buscar a tabela de roteamento de endereço.</span><span class="sxs-lookup"><span data-stu-id="26ce6-138">By default, the first request has a higher latency because it has to fetch the address routing table.</span></span> <span data-ttu-id="26ce6-139">Para evitar essa latência de inicialização na primeira solicitação, você deve chamar OpenAsync() uma vez durante a inicialização da seguinte maneira.</span><span class="sxs-lookup"><span data-stu-id="26ce6-139">To avoid this startup latency on the first request, you should call OpenAsync() once during initialization as follows.</span></span>

        await client.OpenAsync();
   <a id="same-region"></a>
4. <span data-ttu-id="26ce6-140">**Colocar os clientes na mesma região do Azure para o desempenho**</span><span class="sxs-lookup"><span data-stu-id="26ce6-140">**Collocate clients in same Azure region for performance**</span></span>

    <span data-ttu-id="26ce6-141">Quando possível, coloque aplicativos que chamam o Cosmos DB na mesma região do banco de dados do Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="26ce6-141">When possible, place any applications calling Cosmos DB in the same region as the Cosmos DB database.</span></span> <span data-ttu-id="26ce6-142">Para obter uma comparação aproximada, as chamadas ao Cosmos DB na mesma região são concluídas de 1 a 2 ms, mas a latência entre a Costa Leste e a Oeste dos EUA é > 50 ms.</span><span class="sxs-lookup"><span data-stu-id="26ce6-142">For an approximate comparison, calls to Cosmos DB within the same region complete within 1-2 ms, but the latency between the West and East coast of the US is >50 ms.</span></span> <span data-ttu-id="26ce6-143">Provavelmente, essa latência pode variar entre as solicitações dependendo da rota seguida pela solicitação conforme ela passa do cliente para o limite de datacenter do Azure.</span><span class="sxs-lookup"><span data-stu-id="26ce6-143">This latency can likely vary from request to request depending on the route taken by the request as it passes from the client to the Azure datacenter boundary.</span></span> <span data-ttu-id="26ce6-144">A menor latência possível é alcançada garantindo que o aplicativo de chamada estará localizado na mesma região do Azure do ponto de extremidade do Cosmos DB provisionado.</span><span class="sxs-lookup"><span data-stu-id="26ce6-144">The lowest possible latency is achieved by ensuring the calling application is located within the same Azure region as the provisioned Cosmos DB endpoint.</span></span> <span data-ttu-id="26ce6-145">Para obter uma lista de regiões disponíveis, consulte [Regiões do Azure](https://azure.microsoft.com/regions/#services).</span><span class="sxs-lookup"><span data-stu-id="26ce6-145">For a list of available regions, see [Azure Regions](https://azure.microsoft.com/regions/#services).</span></span>

    <span data-ttu-id="26ce6-146">![Ilustração da política de conexão do Azure Cosmos DB](./media/performance-tips/same-region.png)
   <a id="increase-threads"></a></span><span class="sxs-lookup"><span data-stu-id="26ce6-146">![Illustration of the Azure Cosmos DB connection policy](./media/performance-tips/same-region.png)
<a id="increase-threads"></a></span></span>
5. <span data-ttu-id="26ce6-147">**Aumentar o número de threads/tarefas**</span><span class="sxs-lookup"><span data-stu-id="26ce6-147">**Increase number of threads/tasks**</span></span>

    <span data-ttu-id="26ce6-148">Como as chamadas ao Azure Cosmos DB são feitas pela rede, talvez seja necessário variar o grau de paralelismo das solicitações, de forma que o aplicativo cliente aguarde um tempo mínimo entre as solicitações.</span><span class="sxs-lookup"><span data-stu-id="26ce6-148">Since calls to Azure Cosmos DB are made over the network, you may need to vary the degree of parallelism of your requests so that the client application spends very little time waiting between requests.</span></span> <span data-ttu-id="26ce6-149">Por exemplo, se você estiver usando a [Biblioteca de Paralelismo de Tarefas](https://msdn.microsoft.com//library/dd460717.aspx)do .NET, crie centenas de tarefas de leitura ou gravação no Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="26ce6-149">For example, if you're using .NET's [Task Parallel Library](https://msdn.microsoft.com//library/dd460717.aspx), create in the order of 100s of Tasks reading or writing to Cosmos DB.</span></span>

## <a name="sdk-usage"></a><span data-ttu-id="26ce6-150">Uso do SDK</span><span class="sxs-lookup"><span data-stu-id="26ce6-150">SDK Usage</span></span>
1. <span data-ttu-id="26ce6-151">**Instalar o SDK mais recente**</span><span class="sxs-lookup"><span data-stu-id="26ce6-151">**Install the most recent SDK**</span></span>

    <span data-ttu-id="26ce6-152">Os SDKs do Cosmos DB estão constantemente sendo aprimorados para fornecer o melhor desempenho.</span><span class="sxs-lookup"><span data-stu-id="26ce6-152">The Cosmos DB SDKs are constantly being improved to provide the best performance.</span></span> <span data-ttu-id="26ce6-153">Consulte as páginas do [SDK do Cosmos DB](documentdb-sdk-dotnet.md) para determinar o SDK mais recente e examinar as melhorias.</span><span class="sxs-lookup"><span data-stu-id="26ce6-153">See the [Cosmos DB SDK](documentdb-sdk-dotnet.md) pages to determine the most recent SDK and review improvements.</span></span>
2. <span data-ttu-id="26ce6-154">**Usar um cliente do Cosmos DB singleton para obter o tempo de vida do aplicativo**</span><span class="sxs-lookup"><span data-stu-id="26ce6-154">**Use a singleton Cosmos DB client for the lifetime of your application**</span></span>

    <span data-ttu-id="26ce6-155">Observe que cada instância do DocumentClient tem um thread seguro e realiza um gerenciamento de conexão eficiente e o cache de endereço ao operar no Modo Direto.</span><span class="sxs-lookup"><span data-stu-id="26ce6-155">Note that each DocumentClient instance is thread-safe and performs efficient connection management and address caching when operating in Direct Mode.</span></span> <span data-ttu-id="26ce6-156">Para permitir o gerenciamento de conexão eficiente e o melhor desempenho por DocumentClient, é recomendável usar uma única instância de DocumentClient por AppDomain durante a vida útil do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="26ce6-156">To allow efficient connection management and better performance by DocumentClient, it is recommended to use a single instance of DocumentClient per AppDomain for the lifetime of the application.</span></span>

   <a id="max-connection"></a>
3. <span data-ttu-id="26ce6-157">**Aumentar System.Net MaxConnections por host usando o modo de Gateway**</span><span class="sxs-lookup"><span data-stu-id="26ce6-157">**Increase System.Net MaxConnections per host when using Gateway mode**</span></span>

    <span data-ttu-id="26ce6-158">As solicitações do Cosmos DB são feitas por HTTPS/REST durante o uso do modo Gateway e estão sujeitas ao limite de conexão padrão por nome do host ou endereço IP.</span><span class="sxs-lookup"><span data-stu-id="26ce6-158">Cosmos DB requests are made over HTTPS/REST when using Gateway mode, and are subjected to the default connection limit per hostname or IP address.</span></span> <span data-ttu-id="26ce6-159">Talvez seja necessário definir MaxConnections com um valor mais alto (100-1000), de forma que a biblioteca de cliente possa utilizar várias conexões simultâneas ao Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="26ce6-159">You may need to set the MaxConnections to a higher value (100-1000) so that the client library can utilize multiple simultaneous connections to Cosmos DB.</span></span> <span data-ttu-id="26ce6-160">No SDK do .NET 1.8.0 e posterior, o valor padrão para [ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit.aspx) é 50 e para alterar o valor, você pode definir o [Documents.Client.ConnectionPolicy.MaxConnectionLimit](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.connectionpolicy.maxconnectionlimit.aspx) para um valor mais alto.</span><span class="sxs-lookup"><span data-stu-id="26ce6-160">In the .NET SDK 1.8.0 and above, the default value for [ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit.aspx) is 50 and to change the value, you can set the [Documents.Client.ConnectionPolicy.MaxConnectionLimit](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.connectionpolicy.maxconnectionlimit.aspx) to a higher value.</span></span>   
4. <span data-ttu-id="26ce6-161">**Ajustar consultas paralelas para coleções particionadas**</span><span class="sxs-lookup"><span data-stu-id="26ce6-161">**Tuning parallel queries for partitioned collections**</span></span>

     <span data-ttu-id="26ce6-162">O SDK .NET do DocumentDB versão 1.9.0 e superiores oferecem suporte a consultas paralelas, o que permite a consulta a uma coleção particionada em paralelo (confira [Trabalhando com SDKs](documentdb-partition-data.md#working-with-the-azure-cosmos-db-sdks) e os [exemplos de código](https://github.com/Azure/azure-documentdb-dotnet/blob/master/samples/code-samples/Queries/Program.cs) relacionados para saber mais).</span><span class="sxs-lookup"><span data-stu-id="26ce6-162">DocumentDB .NET SDK version 1.9.0 and above support parallel queries, which enable you to query a partitioned collection in parallel (see [Working with the SDKs](documentdb-partition-data.md#working-with-the-azure-cosmos-db-sdks) and the related [code samples](https://github.com/Azure/azure-documentdb-dotnet/blob/master/samples/code-samples/Queries/Program.cs) for more info).</span></span> <span data-ttu-id="26ce6-163">Consultas paralelas são projetadas para melhorar a latência da consulta e a produtividade em relação à contraparte serial.</span><span class="sxs-lookup"><span data-stu-id="26ce6-163">Parallel queries are designed to improve query latency and throughput over their serial counterpart.</span></span> <span data-ttu-id="26ce6-164">Consultas paralelas fornecem dois parâmetros que os usuários podem ajustar para atender aos próprios requisitos, (a) MaxDegreeOfParallelism: para controlar o número máximo de partições que podem ser consultadas em paralelo e (b) MaxBufferedItemCount: para controlar o número de resultados de pré-obtidos.</span><span class="sxs-lookup"><span data-stu-id="26ce6-164">Parallel queries provide two parameters that users can tune to custom-fit their requirements, (a) MaxDegreeOfParallelism: to control the maximum number of partitions then can be queried in parallel, and (b) MaxBufferedItemCount: to control the number of pre-fetched results.</span></span>

    <span data-ttu-id="26ce6-165">(a) ***Ajuste de MaxDegreeOfParallelism\:*** a consulta paralela funciona consultando várias partições em paralelo.</span><span class="sxs-lookup"><span data-stu-id="26ce6-165">(a) ***Tuning MaxDegreeOfParallelism\:*** Parallel query works by querying multiple partitions in parallel.</span></span> <span data-ttu-id="26ce6-166">No entanto, os dados de uma coleta particionada individual são buscados em série com relação à consulta.</span><span class="sxs-lookup"><span data-stu-id="26ce6-166">However, data from an individual partitioned collect is fetched serially with respect to the query.</span></span> <span data-ttu-id="26ce6-167">Então, definir MaxDegreeOfParallelism como o número de partições representa o máximo de chance de conseguir uma consulta com o melhor desempenho, desde que todas as outras condições do sistema permaneçam as mesmas.</span><span class="sxs-lookup"><span data-stu-id="26ce6-167">So, setting the MaxDegreeOfParallelism to the number of partitions has the maximum chance of achieving the most performant query, provided all other system conditions remain the same.</span></span> <span data-ttu-id="26ce6-168">Se você não souber o número de partições, defina MaxDegreeOfParallelism como um número alto, e o sistema escolherá o mínimo (número de partições, entrada fornecida pelo usuário) como o MaxDegreeOfParallelism.</span><span class="sxs-lookup"><span data-stu-id="26ce6-168">If you don't know the number of partitions, you can set the MaxDegreeOfParallelism to a high number, and the system chooses the minimum (number of partitions, user provided input) as the MaxDegreeOfParallelism.</span></span>

    <span data-ttu-id="26ce6-169">É importante observar que as consultas paralelas produzirão os melhores benefícios se os dados forem distribuídos uniformemente em todas as partições com relação à consulta.</span><span class="sxs-lookup"><span data-stu-id="26ce6-169">It is important to note that parallel queries produce the best benefits if the data is evenly distributed across all partitions with respect to the query.</span></span> <span data-ttu-id="26ce6-170">Se a coleção particionada for particionada de uma forma que todos ou a maioria dos dados retornados por uma consulta ficarem concentrados em algumas partições (uma partição, na pior das hipóteses), o desempenho da consulta seria um afunilamento dessas partições.</span><span class="sxs-lookup"><span data-stu-id="26ce6-170">If the partitioned collection is partitioned such a way that all or a majority of the data returned by a query is concentrated in a few partitions (one partition in worst case), then the performance of the query would be bottlenecked by those partitions.</span></span>

    <span data-ttu-id="26ce6-171">(b) ***Ajuste MaxBufferedItemCount\:*** a consulta paralela destina-se a buscar previamente resultados enquanto o lote atual de resultados está sendo processado pelo cliente.</span><span class="sxs-lookup"><span data-stu-id="26ce6-171">(b) ***Tuning MaxBufferedItemCount\:*** Parallel query is designed to pre-fetch results while the current batch of results is being processed by the client.</span></span> <span data-ttu-id="26ce6-172">A busca prévia ajuda a melhorar a latência geral de uma consulta.</span><span class="sxs-lookup"><span data-stu-id="26ce6-172">The pre-fetching helps in overall latency improvement of a query.</span></span> <span data-ttu-id="26ce6-173">MaxBufferedItemCount é o parâmetro para limitar o número de resultados pré-obtidos.</span><span class="sxs-lookup"><span data-stu-id="26ce6-173">MaxBufferedItemCount is the parameter to limit the number of pre-fetched results.</span></span> <span data-ttu-id="26ce6-174">Configurar MaxBufferedItemCount para o número esperado de resultados retornados (ou um número mais alto) permite que a consulta receba o benefício máximo da busca prévia.</span><span class="sxs-lookup"><span data-stu-id="26ce6-174">Setting MaxBufferedItemCount to the expected number of results returned (or a higher number) allows the query to receive maximum benefit from pre-fetching.</span></span>

    <span data-ttu-id="26ce6-175">Observe que a busca prévia funciona da mesma forma independentemente do MaxDegreeOfParallelism, e há um único buffer para os dados de todas as partições.</span><span class="sxs-lookup"><span data-stu-id="26ce6-175">Note that pre-fetching works the same way irrespective of the MaxDegreeOfParallelism, and there is a single buffer for the data from all partitions.</span></span>  
5. <span data-ttu-id="26ce6-176">**Ativar o GC no lado do servidor**</span><span class="sxs-lookup"><span data-stu-id="26ce6-176">**Turn on server-side GC**</span></span>

    <span data-ttu-id="26ce6-177">A redução da frequência da coleta de lixo pode ajudar em alguns casos.</span><span class="sxs-lookup"><span data-stu-id="26ce6-177">Reducing the frequency of garbage collection may help in some cases.</span></span> <span data-ttu-id="26ce6-178">No .NET, defina [gcServer](https://msdn.microsoft.com/library/ms229357.aspx) como true.</span><span class="sxs-lookup"><span data-stu-id="26ce6-178">In .NET, set [gcServer](https://msdn.microsoft.com/library/ms229357.aspx) to true.</span></span>
6. <span data-ttu-id="26ce6-179">**Implementar a retirada em intervalos de RetryAfter**</span><span class="sxs-lookup"><span data-stu-id="26ce6-179">**Implement backoff at RetryAfter intervals**</span></span>

    <span data-ttu-id="26ce6-180">Durante o teste de desempenho, você deve aumentar a carga até que uma pequena taxa de solicitações seja restringida.</span><span class="sxs-lookup"><span data-stu-id="26ce6-180">During performance testing, you should increase load until a small rate of requests get throttled.</span></span> <span data-ttu-id="26ce6-181">Se restringida, o aplicativo cliente deve retirar a limitação no intervalo de nova tentativa do servidor especificado.</span><span class="sxs-lookup"><span data-stu-id="26ce6-181">If throttled, the client application should backoff on throttle for the server-specified retry interval.</span></span> <span data-ttu-id="26ce6-182">Respeitar a retirada garante que você perca o mínimo de tempo de espera entre as tentativas.</span><span class="sxs-lookup"><span data-stu-id="26ce6-182">Respecting the backoff ensures that you spend minimal amount of time waiting between retries.</span></span> <span data-ttu-id="26ce6-183">O suporte da política de repetição está incluído na Versão 1.8.0 e posterior do DocumentDB [.NET](documentdb-sdk-dotnet.md) e [Java](documentdb-sdk-java.md), na versão 1.9.0 e posterior do [Node.js](documentdb-sdk-node.md) e [Python](documentdb-sdk-python.md) e em todas as versões com suporte dos SDKs do [.NET Core](documentdb-sdk-dotnet-core.md).</span><span class="sxs-lookup"><span data-stu-id="26ce6-183">Retry policy support is included in Version 1.8.0 and above of the DocumentDB [.NET](documentdb-sdk-dotnet.md) and [Java](documentdb-sdk-java.md), version 1.9.0 and above of the [Node.js](documentdb-sdk-node.md) and [Python](documentdb-sdk-python.md), and all supported versions of the [.NET Core](documentdb-sdk-dotnet-core.md) SDKs.</span></span> <span data-ttu-id="26ce6-184">Para saber mais, confira [Exceder os limites da taxa de transferência reservada](request-units.md#RequestRateTooLarge) e [RetryAfter](https://msdn.microsoft.com/library/microsoft.azure.documents.documentclientexception.retryafter.aspx).</span><span class="sxs-lookup"><span data-stu-id="26ce6-184">For more information, see [Exceeding reserved throughput limits](request-units.md#RequestRateTooLarge) and [RetryAfter](https://msdn.microsoft.com/library/microsoft.azure.documents.documentclientexception.retryafter.aspx).</span></span>
7. <span data-ttu-id="26ce6-185">**Escalar horizontalmente sua carga de trabalho do cliente**</span><span class="sxs-lookup"><span data-stu-id="26ce6-185">**Scale out your client-workload**</span></span>

    <span data-ttu-id="26ce6-186">Se você estiver testando em altos níveis da taxa de transferência (>50.000 RU/s), o aplicativo cliente poderá fazer um afunilamento devido à limitação do computador na utilização da CPU ou da Rede.</span><span class="sxs-lookup"><span data-stu-id="26ce6-186">If you are testing at high throughput levels (>50,000 RU/s), the client application may become the bottleneck due to the machine capping out on CPU or Network utilization.</span></span> <span data-ttu-id="26ce6-187">Se você chegar a este ponto, poderá continuar expandindo a conta do Cosmos DB ainda mais escalando seus aplicativos cliente horizontalmente entre vários servidores.</span><span class="sxs-lookup"><span data-stu-id="26ce6-187">If you reach this point, you can continue to push the Cosmos DB account further by scaling out your client applications across multiple servers.</span></span>
8. <span data-ttu-id="26ce6-188">**Armazenar em cache os URIs do documento para uma menor latência de leitura**</span><span class="sxs-lookup"><span data-stu-id="26ce6-188">**Cache document URIs for lower read latency**</span></span>

    <span data-ttu-id="26ce6-189">Armazene em cache os URIs do documento sempre que possível para ter o melhor desempenho de leitura.</span><span class="sxs-lookup"><span data-stu-id="26ce6-189">Cache document URIs whenever possible for the best read performance.</span></span>
   <a id="tune-page-size"></a>
9. <span data-ttu-id="26ce6-190">**Ajustar o tamanho da página para os feeds de leitura/consultas para ter o melhor desempenho**</span><span class="sxs-lookup"><span data-stu-id="26ce6-190">**Tune the page size for queries/read feeds for better performance**</span></span>

    <span data-ttu-id="26ce6-191">Ao executar uma grande quantidade de leitura dos documentos utilizando a funcionalidade do feed de leitura (por exemplo, ReadDocumentFeedAsync) ou ao enviar uma consulta SQL do DocumentDB, os resultados serão retornados de uma maneira segmentada se o conjunto de resultados for muito grande.</span><span class="sxs-lookup"><span data-stu-id="26ce6-191">When performing a bulk read of documents using read feed functionality (for example, ReadDocumentFeedAsync) or when issuing a DocumentDB SQL query, the results are returned in a segmented fashion if the result set is too large.</span></span> <span data-ttu-id="26ce6-192">Por padrão, os resultados são retornados em blocos de 100 itens ou 1 MB, o limite que for atingido primeiro.</span><span class="sxs-lookup"><span data-stu-id="26ce6-192">By default, results are returned in chunks of 100 items or 1 MB, whichever limit is hit first.</span></span>

    <span data-ttu-id="26ce6-193">Para reduzir o número idas e vindas na rede necessárias para recuperar todos os resultados aplicáveis, você pode aumentar o tamanho da página usando o cabeçalho de solicitação x-ms-max-item-count para até 1000.</span><span class="sxs-lookup"><span data-stu-id="26ce6-193">To reduce the number of network round trips required to retrieve all applicable results, you can increase the page size using x-ms-max-item-count request header to up to 1000.</span></span> <span data-ttu-id="26ce6-194">Nos casos em que você precisa exibir apenas alguns resultados, por exemplo, se a interface do usuário ou a API do aplicativo retornar apenas dez resultados de uma vez, também será possível diminuir o tamanho da página para dez para reduzir a taxa de transferência consumida pelas leituras e consultas.</span><span class="sxs-lookup"><span data-stu-id="26ce6-194">In cases where you need to display only a few results, for example, if your user interface or application API returns only 10 results a time, you can also decrease the page size to 10 to reduce the throughput consumed for reads and queries.</span></span>

    <span data-ttu-id="26ce6-195">Você também poderá definir o tamanho da página usando os SDKs do Cosmos DB disponíveis.</span><span class="sxs-lookup"><span data-stu-id="26ce6-195">You may also set the page size using the available Cosmos DB SDKs.</span></span>  <span data-ttu-id="26ce6-196">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="26ce6-196">For example:</span></span>

        IQueryable<dynamic> authorResults = client.CreateDocumentQuery(documentCollection.SelfLink, "SELECT p.Author FROM Pages p WHERE p.Title = 'About Seattle'", new FeedOptions { MaxItemCount = 1000 });
10. <span data-ttu-id="26ce6-197">**Aumentar o número de threads/tarefas**</span><span class="sxs-lookup"><span data-stu-id="26ce6-197">**Increase number of threads/tasks**</span></span>

    <span data-ttu-id="26ce6-198">Consulte [Aumentar o número de threads/tarefas](#increase-threads) na seção Rede.</span><span class="sxs-lookup"><span data-stu-id="26ce6-198">See [Increase number of threads/tasks](#increase-threads) in the Networking section.</span></span>

11. <span data-ttu-id="26ce6-199">**Usar o processamento do host de 64 bits**</span><span class="sxs-lookup"><span data-stu-id="26ce6-199">**Use 64-bit host processing**</span></span>

    <span data-ttu-id="26ce6-200">O SDK do DocumentDB funciona em um processo de host de 32 bits quando você usa o SDK do .NET do DocumentDB versão 1.11.4 e superior.</span><span class="sxs-lookup"><span data-stu-id="26ce6-200">The DocumentDB SDK works in a 32-bit host process when you are using DocumentDB .NET SDK version 1.11.4 and above.</span></span> <span data-ttu-id="26ce6-201">No entanto, se você usa consultas entre partições, recomenda-se o processamento de host de 64 bits para melhorar o desempenho.</span><span class="sxs-lookup"><span data-stu-id="26ce6-201">However, if you are using cross partition queries, 64-bit host processing is recommended for improved performance.</span></span> <span data-ttu-id="26ce6-202">Os seguintes tipos de aplicativos têm o processo de host de 32 bits como o padrão, portanto para alterá-los para 64 bits, siga estas etapas com base no tipo de seu aplicativo:</span><span class="sxs-lookup"><span data-stu-id="26ce6-202">The following types of applications have 32-bit host process as the default, so in order to change that to 64-bit, follow these steps based on the type of your application:</span></span>

    - <span data-ttu-id="26ce6-203">Para aplicativos executáveis, isso pode ser feito desmarcando a opção **Preferir 32 bits** na janela **Propriedades do Projeto**, na guia **Compilar**.</span><span class="sxs-lookup"><span data-stu-id="26ce6-203">For Executable applications, this can be done by unchecking the **Prefer 32-bit** option in the **Project Properties** window, on the **Build** tab.</span></span>

    - <span data-ttu-id="26ce6-204">Para projetos de teste com base em VSTest, isso pode ser feito selecionando **teste**->**configurações de teste**->**padrão arquitetura de processador X64**, do **Visual Studio Test** opção de menu.</span><span class="sxs-lookup"><span data-stu-id="26ce6-204">For VSTest based test projects, this can be done by selecting **Test**->**Test Settings**->**Default Processor Architecture as X64**, from the **Visual Studio Test** menu option.</span></span>

    - <span data-ttu-id="26ce6-205">Para aplicativos Web ASP.NET implantados localmente, isso pode ser feito verificando o **usar a versão de 64 bits do IIS Express para sites da web e projetos**, em **ferramentas**->**opções**->**projetos e soluções**->**projetos da Web**.</span><span class="sxs-lookup"><span data-stu-id="26ce6-205">For locally deployed ASP.NET Web applications, this can be done by checking the **Use the 64-bit version of IIS Express for web sites and projects**, under **Tools**->**Options**->**Projects and Solutions**->**Web Projects**.</span></span>

    - <span data-ttu-id="26ce6-206">Para aplicativos Web ASP.NET implantados no Azure, isso pode ser feito escolhendo o **plataforma de 64 bits** no **configurações do aplicativo** no portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="26ce6-206">For ASP.NET Web applications deployed on Azure, this can be done by choosing the **Platform as 64-bit** in the **Application Settings** on the Azure portal.</span></span>

## <a name="indexing-policy"></a><span data-ttu-id="26ce6-207">Política de indexação</span><span class="sxs-lookup"><span data-stu-id="26ce6-207">Indexing Policy</span></span>
1. <span data-ttu-id="26ce6-208">**Usar a indexação lenta para as taxas de ingestão de tempo máximo mais rápidas**</span><span class="sxs-lookup"><span data-stu-id="26ce6-208">**Use lazy indexing for faster peak time ingestion rates**</span></span>

    <span data-ttu-id="26ce6-209">O Cosmos DB permite que você especifique – no nível da coleção – uma política de indexação, que possibilita escolher se você deseja que os documentos em uma coleção sejam indexados automaticamente.</span><span class="sxs-lookup"><span data-stu-id="26ce6-209">Cosmos DB allows you to specify – at the collection level – an indexing policy, which enables you to choose if you want the documents in a collection to be automatically indexed or not.</span></span>  <span data-ttu-id="26ce6-210">Além disso, você também pode escolher entre as atualizações do índice síncronas (Consistentes) e assíncronas (Lentas).</span><span class="sxs-lookup"><span data-stu-id="26ce6-210">In addition, you may also choose between synchronous (Consistent) and asynchronous (Lazy) index updates.</span></span> <span data-ttu-id="26ce6-211">Por padrão, o índice é atualizado sincronamente em cada inserção, substituição ou exclusão de um documento para a coleção.</span><span class="sxs-lookup"><span data-stu-id="26ce6-211">By default, the index is updated synchronously on each insert, replace, or delete of a document to the collection.</span></span> <span data-ttu-id="26ce6-212">O modo síncrono permite que as consultas obedeçam ao mesmo [nível de consistência](consistency-levels.md) das leituras de documentos sem demora para o índice “atualizado”.</span><span class="sxs-lookup"><span data-stu-id="26ce6-212">Synchronously mode enables the queries to honor the same [consistency level](consistency-levels.md) as that of the document reads without any delay for the index to “catch up".</span></span>

    <span data-ttu-id="26ce6-213">A indexação lenta pode ser considerada para os cenários em que os dados são gravados em picos e você deseja reduzir o trabalho necessário para indexar o conteúdo em um período de tempo maior.</span><span class="sxs-lookup"><span data-stu-id="26ce6-213">Lazy indexing may be considered for scenarios in which data is written in bursts, and you want to amortize the work required to index content over a longer period of time.</span></span> <span data-ttu-id="26ce6-214">A indexação lenta permite que você use a taxa de transferência provisionada com eficiência e atenda as solicitações de gravação em horários de pico com latência mínima.</span><span class="sxs-lookup"><span data-stu-id="26ce6-214">Lazy indexing also allows you to use your provisioned throughput effectively and serve write requests at peak times with minimal latency.</span></span> <span data-ttu-id="26ce6-215">Porém, é importante observar que, quando a indexação lenta estiver habilitada, os resultados da consulta, em última análise, serão consistentes, independentemente do nível de consistência configurado para a conta do Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="26ce6-215">It is important to note, however, that when lazy indexing is enabled, query results are eventually consistent regardless of the consistency level configured for the Cosmos DB account.</span></span>

    <span data-ttu-id="26ce6-216">Portanto, o modo de indexação Consistente (IndexingPolicy.IndexingMode é definido para Consistente) incorre no maior custo de unidade de solicitação por gravação, enquanto o modo de indexação Lento (IndexingPolicy.IndexingMode é definido para Lento) e nenhuma indexação (IndexingPolicy.Automatic é definido para False) têm um custo zero de indexação no momento da gravação.</span><span class="sxs-lookup"><span data-stu-id="26ce6-216">Hence, Consistent indexing mode (IndexingPolicy.IndexingMode is set to Consistent) incurs the highest request unit charge per write, while Lazy indexing mode (IndexingPolicy.IndexingMode is set to Lazy) and no indexing (IndexingPolicy.Automatic is set to False) have zero indexing cost at the time of write.</span></span>
2. <span data-ttu-id="26ce6-217">**Excluir caminhos não utilizados da indexação para ter gravações mais rápidas**</span><span class="sxs-lookup"><span data-stu-id="26ce6-217">**Exclude unused paths from indexing for faster writes**</span></span>

    <span data-ttu-id="26ce6-218">A política de indexação do Cosmos DB também permite que você especifique quais caminhos de documento serão incluídos ou excluídos da indexação, aproveitando os Caminhos de Indexação (IndexingPolicy.IncludedPaths e IndexingPolicy.ExcludedPaths).</span><span class="sxs-lookup"><span data-stu-id="26ce6-218">Cosmos DB’s indexing policy also allows you to specify which document paths to include or exclude from indexing by leveraging Indexing Paths (IndexingPolicy.IncludedPaths and IndexingPolicy.ExcludedPaths).</span></span> <span data-ttu-id="26ce6-219">O uso dos caminhos de indexação pode oferecer um melhor desempenho de gravação e menor armazenamento de índices para os cenários nos quais os padrões da consulta são conhecidos com antecedência, pois os custos da indexação estão correlacionados diretamente com o número de caminhos exclusivos indexados.</span><span class="sxs-lookup"><span data-stu-id="26ce6-219">The use of indexing paths can offer improved write performance and lower index storage for scenarios in which the query patterns are known beforehand, as indexing costs are directly correlated to the number of unique paths indexed.</span></span>  <span data-ttu-id="26ce6-220">Por exemplo, o código a seguir mostra como excluir uma seção inteira de documentos (também conhecida como</span><span class="sxs-lookup"><span data-stu-id="26ce6-220">For example, the following code shows how to exclude an entire section of the documents (a.k.a.</span></span> <span data-ttu-id="26ce6-221">uma subárvore) de indexação usando o curinga "*".</span><span class="sxs-lookup"><span data-stu-id="26ce6-221">a subtree) from indexing using the "*" wildcard.</span></span>

    ```C#
    var collection = new DocumentCollection { Id = "excludedPathCollection" };
    collection.IndexingPolicy.IncludedPaths.Add(new IncludedPath { Path = "/*" });
    collection.IndexingPolicy.ExcludedPaths.Add(new ExcludedPath { Path = "/nonIndexedContent/*");
    collection = await client.CreateDocumentCollectionAsync(UriFactory.CreateDatabaseUri("db"), excluded);
    ```

    <span data-ttu-id="26ce6-222">Para obter mais informações, consulte [Políticas de indexação do Azure Cosmos DB](indexing-policies.md).</span><span class="sxs-lookup"><span data-stu-id="26ce6-222">For more information, see [Azure Cosmos DB indexing policies](indexing-policies.md).</span></span>

## <a name="throughput"></a><span data-ttu-id="26ce6-223">Taxa de transferência</span><span class="sxs-lookup"><span data-stu-id="26ce6-223">Throughput</span></span>
<a id="measure-rus"></a>

1. <span data-ttu-id="26ce6-224">**Medir e ajustar para o uso mais baixo de unidades/segundo da solicitação**</span><span class="sxs-lookup"><span data-stu-id="26ce6-224">**Measure and tune for lower request units/second usage**</span></span>

    <span data-ttu-id="26ce6-225">O Cosmos DB oferece um conjunto avançado de operações do banco de dados, incluindo consultas relacionais e hierárquicas com UDFs, procedimentos armazenados e gatilhos – todos operando nos documentos em uma coleção de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="26ce6-225">Cosmos DB offers a rich set of database operations including relational and hierarchical queries with UDFs, stored procedures, and triggers – all operating on the documents within a database collection.</span></span> <span data-ttu-id="26ce6-226">O custo associado a cada uma dessas operações varia com base na CPU, E/S e memória necessárias para concluir a operação.</span><span class="sxs-lookup"><span data-stu-id="26ce6-226">The cost associated with each of these operations varies based on the CPU, IO, and memory required to complete the operation.</span></span> <span data-ttu-id="26ce6-227">Em vez de pensar em e gerenciar recursos de hardware, você pode pensar em uma RU (unidade de solicitação) como uma medida única para os recursos necessários para realizar várias operações de bancos de dados e atender a uma solicitação do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="26ce6-227">Instead of thinking about and managing hardware resources, you can think of a request unit (RU) as a single measure for the resources required to perform various database operations and service an application request.</span></span>

    <span data-ttu-id="26ce6-228">[unidades de solicitação](request-units.md) são provisionados para cada conta do banco de dados com base no número de unidades de capacidade que você compra.</span><span class="sxs-lookup"><span data-stu-id="26ce6-228">[Request units](request-units.md) are provisioned for each database account based on the number of capacity units that you purchase.</span></span> <span data-ttu-id="26ce6-229">O consumo da unidade de solicitação é avaliado em termos de taxa por segundo.</span><span class="sxs-lookup"><span data-stu-id="26ce6-229">Request unit consumption is evaluated as a rate per second.</span></span> <span data-ttu-id="26ce6-230">Os aplicativos que excedem a taxa das unidades de solicitação provisionada para sua conta serão limitados até que a taxa fique abaixo do nível reservado da conta.</span><span class="sxs-lookup"><span data-stu-id="26ce6-230">Applications that exceed the provisioned request unit rate for their account is limited until the rate drops below the reserved level for the account.</span></span> <span data-ttu-id="26ce6-231">Se o seu aplicativo exigir um nível mais alto de taxa de transferência, você pode comprar unidades de capacidade adicionais.</span><span class="sxs-lookup"><span data-stu-id="26ce6-231">If your application requires a higher level of throughput, you can purchase additional capacity units.</span></span>

    <span data-ttu-id="26ce6-232">A complexidade de uma consulta afeta a quantidade de Unidades de Solicitação que são consumidas para uma operação.</span><span class="sxs-lookup"><span data-stu-id="26ce6-232">The complexity of a query impacts how many Request Units are consumed for an operation.</span></span> <span data-ttu-id="26ce6-233">O número de predicados, natureza dos predicados, número de UDFs e tamanho do conjunto de dados de origem influenciam o custo das operações de consulta.</span><span class="sxs-lookup"><span data-stu-id="26ce6-233">The number of predicates, nature of the predicates, number of UDFs, and the size of the source data set all influence the cost of query operations.</span></span>

    <span data-ttu-id="26ce6-234">Para medir a sobrecarga de qualquer operação (criar, atualizar ou excluir), examine o cabeçalho x-ms-request-charge (ou a propriedade RequestCharge equivalente em ResourceResponse<T> ou FeedResponse<T> no SDK do .NET) para medir o número de unidades de solicitação consumidas por essas operações.</span><span class="sxs-lookup"><span data-stu-id="26ce6-234">To measure the overhead of any operation (create, update, or delete), inspect the x-ms-request-charge header (or the equivalent RequestCharge property in ResourceResponse<T> or FeedResponse<T> in the .NET SDK) to measure the number of request units consumed by these operations.</span></span>

    ```C#
    // Measure the performance (request units) of writes
    ResourceResponse<Document> response = await client.CreateDocumentAsync(collectionSelfLink, myDocument);
    Console.WriteLine("Insert of document consumed {0} request units", response.RequestCharge);
    // Measure the performance (request units) of queries
    IDocumentQuery<dynamic> queryable = client.CreateDocumentQuery(collectionSelfLink, queryString).AsDocumentQuery();
    while (queryable.HasMoreResults)
         {
              FeedResponse<dynamic> queryResponse = await queryable.ExecuteNextAsync<dynamic>();
              Console.WriteLine("Query batch consumed {0} request units", queryResponse.RequestCharge);
         }
    ```             

    <span data-ttu-id="26ce6-235">A carga de solicitação retornada nesse cabeçalho é uma fração de sua taxa de transferência provisionada (ou seja, 2000 RUs/segundo).</span><span class="sxs-lookup"><span data-stu-id="26ce6-235">The request charge returned in this header is a fraction of your provisioned throughput (i.e., 2000 RUs / second).</span></span> <span data-ttu-id="26ce6-236">Por exemplo, se a consulta anterior retornar 1.000 documentos de 1 KB, o custo da operação será 1.000.</span><span class="sxs-lookup"><span data-stu-id="26ce6-236">For example, if the preceding query returns 1000 1KB-documents, the cost of the operation is 1000.</span></span> <span data-ttu-id="26ce6-237">Assim, em um segundo, o servidor mantém apenas duas dessas solicitações antes de limitar as solicitações subsequentes.</span><span class="sxs-lookup"><span data-stu-id="26ce6-237">As such, within one second, the server honors only two such requests before throttling subsequent requests.</span></span> <span data-ttu-id="26ce6-238">Para saber mais, consulte [Unidades de solicitação](request-units.md) e a [calculadora das unidades de solicitação](https://www.documentdb.com/capacityplanner).</span><span class="sxs-lookup"><span data-stu-id="26ce6-238">For more information, see [Request units](request-units.md) and the [request unit calculator](https://www.documentdb.com/capacityplanner).</span></span>
<a id="429"></a>
2. <span data-ttu-id="26ce6-239">**Lidar com uma limitação da taxa/taxa de solicitação muito grande**</span><span class="sxs-lookup"><span data-stu-id="26ce6-239">**Handle rate limiting/request rate too large**</span></span>

    <span data-ttu-id="26ce6-240">Quando um cliente tentar exceder a taxa de transferência reservada para uma conta, não haverá nenhuma degradação de desempenho no servidor e nenhum uso da capacidade da taxa além do nível reservado.</span><span class="sxs-lookup"><span data-stu-id="26ce6-240">When a client attempts to exceed the reserved throughput for an account, there is no performance degradation at the server and no use of throughput capacity beyond the reserved level.</span></span> <span data-ttu-id="26ce6-241">O servidor encerrará antecipadamente a solicitação com RequestRateTooLarge (código de status HTTP 429) e retornará o cabeçalho x-ms-retry-after-ms indicando a quantidade de tempo, em milissegundos, que o usuário deve aguardar antes de tentar novamente a solicitação.</span><span class="sxs-lookup"><span data-stu-id="26ce6-241">The server will preemptively end the request with RequestRateTooLarge (HTTP status code 429) and return the x-ms-retry-after-ms header indicating the amount of time, in milliseconds, that the user must wait before reattempting the request.</span></span>

        HTTP Status 429,
        Status Line: RequestRateTooLarge
        x-ms-retry-after-ms :100

    <span data-ttu-id="26ce6-242">Os SDKs irão capturar implicitamente essa resposta, respeitarão o cabeçalho server-specified retry-after e repetirão a solicitação.</span><span class="sxs-lookup"><span data-stu-id="26ce6-242">The SDKs all implicitly catch this response, respect the server-specified retry-after header, and retry the request.</span></span> <span data-ttu-id="26ce6-243">A menos que sua conta esteja sendo acessada simultaneamente por vários clientes, a próxima tentativa será bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="26ce6-243">Unless your account is being accessed concurrently by multiple clients, the next retry will succeed.</span></span>

    <span data-ttu-id="26ce6-244">Se você tiver mais de um cliente operando cumulativamente de como consistente acima da taxa de solicitação, a contagem de repetição padrão atualmente definida para 9 internamente pelo cliente poderá não ser suficiente. Nesse caso, o cliente irá gerar uma DocumentClientException com o código de status 429 para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="26ce6-244">If you have more than one client cumulatively operating consistently above the request rate, the default retry count currently set to 9 internally by the client may not suffice; in this case, the client throws a DocumentClientException with status code 429 to the application.</span></span> <span data-ttu-id="26ce6-245">A contagem de repetição padrão pode ser alterada definindo RetryOptions na instância de ConnectionPolicy.</span><span class="sxs-lookup"><span data-stu-id="26ce6-245">The default retry count can be changed by setting the RetryOptions on the ConnectionPolicy instance.</span></span> <span data-ttu-id="26ce6-246">Por padrão, a DocumentClientException com o código de status 429 será retornada após uma espera cumulativa de 30 segundos se a solicitação continuar a operar acima da taxa de solicitação.</span><span class="sxs-lookup"><span data-stu-id="26ce6-246">By default, the DocumentClientException with status code 429 is returned after a cumulative wait time of 30 seconds if the request continues to operate above the request rate.</span></span> <span data-ttu-id="26ce6-247">Isso ocorre mesmo quando a contagem de repetição atual é menor que a contagem de repetição máxima, seja o padrão 9 seja um valor definido pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="26ce6-247">This occurs even when the current retry count is less than the max retry count, be it the default of 9 or a user-defined value.</span></span>

    <span data-ttu-id="26ce6-248">Embora o comportamento de repetição automática ajude a melhorar a resiliência e a utilidade da maioria dos aplicativos, ela pode entrar em conflito ao fazer comparações de desempenho, especialmente ao medir a latência.</span><span class="sxs-lookup"><span data-stu-id="26ce6-248">While the automated retry behavior helps to improve resiliency and usability for the most applications, it might come at odds when doing performance benchmarks, especially when measuring latency.</span></span>  <span data-ttu-id="26ce6-249">A latência observada pelo cliente terá um pico se o teste atingir a limitação do servidor e fizer com que o SDK do cliente repita silenciosamente.</span><span class="sxs-lookup"><span data-stu-id="26ce6-249">The client-observed latency will spike if the experiment hits the server throttle and causes the client SDK to silently retry.</span></span> <span data-ttu-id="26ce6-250">Para evitar picos de latência durante os testes de desempenho, meça o custo retornado por cada operação e verifique se as solicitações estão operando abaixo da taxa de solicitação reservada.</span><span class="sxs-lookup"><span data-stu-id="26ce6-250">To avoid latency spikes during performance experiments, measure the charge returned by each operation and ensure that requests are operating below the reserved request rate.</span></span> <span data-ttu-id="26ce6-251">Para saber mais, consulte [Unidades de solicitação](request-units.md).</span><span class="sxs-lookup"><span data-stu-id="26ce6-251">For more information, see [Request units](request-units.md).</span></span>
3. <span data-ttu-id="26ce6-252">**Design de documentos menores para uma maior taxa de transferência**</span><span class="sxs-lookup"><span data-stu-id="26ce6-252">**Design for smaller documents for higher throughput**</span></span>

    <span data-ttu-id="26ce6-253">O custo da solicitação (ou seja, o custo de processamento da solicitação) de uma determinada operação está correlacionado diretamente com o tamanho do documento.</span><span class="sxs-lookup"><span data-stu-id="26ce6-253">The request charge (i.e. request processing cost) of a given operation is directly correlated to the size of the document.</span></span> <span data-ttu-id="26ce6-254">As operações em documentos grandes custam mais que as operações de documentos pequenos.</span><span class="sxs-lookup"><span data-stu-id="26ce6-254">Operations on large documents cost more than operations for small documents.</span></span>

## <a name="next-steps"></a><span data-ttu-id="26ce6-255">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="26ce6-255">Next steps</span></span>
<span data-ttu-id="26ce6-256">Para obter um aplicativo de exemplo usado para avaliar o Cosmos DB para cenários de alto desempenho em alguns computadores cliente, consulte [Teste de desempenho e escala com o Cosmos DB](performance-testing.md).</span><span class="sxs-lookup"><span data-stu-id="26ce6-256">For a sample application used to evaluate Cosmos DB for high-performance scenarios on a few client machines, see [Performance and scale testing with Cosmos DB](performance-testing.md).</span></span>

<span data-ttu-id="26ce6-257">Além disso, para saber mais sobre como projetar seu aplicativo para escala e alto desempenho, consulte [Particionamento e escala no Azure Cosmos DB](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="26ce6-257">Also, to learn more about designing your application for scale and high performance, see [Partitioning and scaling in Azure Cosmos DB](partition-data.md).</span></span>
