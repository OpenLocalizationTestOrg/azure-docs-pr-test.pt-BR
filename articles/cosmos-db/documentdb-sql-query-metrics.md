---
title: "aaaSQL métricas de consulta para a API DocumentDB do Azure Cosmos DB | Microsoft Docs"
description: "Saiba mais sobre como tooinstrument e depuração Olá desempenho da consulta SQL de banco de dados do Azure Cosmos solicitações."
keywords: "sintaxe sql, consulta sql, consultas sql, linguagem de consulta json, conceitos de banco de dados e consultas sql, funções agregadas"
services: cosmos-db
documentationcenter: 
author: arramac
manager: jhubbard
editor: monicar
ms.assetid: b2fa8e8f-7291-45a3-9bd1-7284ed9077f8
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/15/2017
ms.author: arramac
ms.openlocfilehash: 2fee3786b7d48d254162699471943e316764b003
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="tuning-query-performance-with-azure-cosmos-db"></a><span data-ttu-id="9a596-104">Ajustando o desempenho de consulta com o Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="9a596-104">Tuning query performance with Azure Cosmos DB</span></span>
<span data-ttu-id="9a596-105">O Azure Cosmos DB fornece um [API do SQL para consultar dados](documentdb-sql-query.md), sem a necessidade de esquema ou índices secundários.</span><span class="sxs-lookup"><span data-stu-id="9a596-105">Azure Cosmos DB provides a [SQL API for querying data](documentdb-sql-query.md), without requiring schema or secondary indexes.</span></span> <span data-ttu-id="9a596-106">Este artigo fornece as seguintes informações para desenvolvedores de saudação:</span><span class="sxs-lookup"><span data-stu-id="9a596-106">This article provides hello following information for developers:</span></span>

* <span data-ttu-id="9a596-107">Detalhes de alto nível sobre como funciona a execução da consulta SQL do Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="9a596-107">High-level details on how Azure Cosmos DB's SQL query execution works</span></span>
* <span data-ttu-id="9a596-108">Obter detalhes sobre cabeçalhos de solicitação e resposta de consulta e opções do SDK do cliente</span><span class="sxs-lookup"><span data-stu-id="9a596-108">Details on query request and response headers, and client SDK options</span></span>
* <span data-ttu-id="9a596-109">Algumas dicas e práticas recomendadas para desempenho de consulta</span><span class="sxs-lookup"><span data-stu-id="9a596-109">Tips and best practices for query performance</span></span>
* <span data-ttu-id="9a596-110">Exemplos de como o desempenho de consulta tooutilize toodebug de estatísticas de execução de SQL</span><span class="sxs-lookup"><span data-stu-id="9a596-110">Examples of how tooutilize SQL execution statistics toodebug query performance</span></span>

## <a name="about-sql-query-execution"></a><span data-ttu-id="9a596-111">Sobre execução de consulta SQL</span><span class="sxs-lookup"><span data-stu-id="9a596-111">About SQL query execution</span></span>

<span data-ttu-id="9a596-112">No banco de dados do Azure Cosmos, armazenar dados em contêineres, que podem aumentar tooany [throughput de solicitação ou o tamanho do armazenamento](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="9a596-112">In Azure Cosmos DB, you store data in containers, which can grow tooany [storage size or request throughput](partition-data.md).</span></span> <span data-ttu-id="9a596-113">Banco de dados do Azure Cosmos perfeitamente dimensiona os dados em partições físicas em toohandle Olá abrange o crescimento de dados ou o aumento na taxa de transferência fornecida.</span><span class="sxs-lookup"><span data-stu-id="9a596-113">Azure Cosmos DB seamlessly scales data across physical partitions under hello covers toohandle data growth or increase in provisioned throughput.</span></span> <span data-ttu-id="9a596-114">Você pode emitir consultas tooany contêiner de dados SQL usando Olá API REST ou um de saudação suportada [SDKs do DocumentDB](documentdb-sdk-dotnet.md).</span><span class="sxs-lookup"><span data-stu-id="9a596-114">You can issue SQL queries tooany container using hello REST API or one of hello supported [DocumentDB SDKs](documentdb-sdk-dotnet.md).</span></span>

<span data-ttu-id="9a596-115">Uma visão geral de particionamento: definir uma chave de partição como "city", que determina como os dados são divididos em partições físicas.</span><span class="sxs-lookup"><span data-stu-id="9a596-115">A brief overview of partitioning: you define a partition key like "city", which determines how data is split across physical partitions.</span></span> <span data-ttu-id="9a596-116">Chave de partição única dados pertencentes tooa (por exemplo, "city" = = "Seattle") é armazenado em uma partição física, mas normalmente uma única partição física tem várias chaves de partição.</span><span class="sxs-lookup"><span data-stu-id="9a596-116">Data belonging tooa single partition key (for example, "city" == "Seattle") is stored within a physical partition, but typically a single physical partition has multiple partition keys.</span></span> <span data-ttu-id="9a596-117">Quando uma partição atinge seu tamanho de armazenamento, o serviço de saudação perfeitamente partição Olá será dividida em duas novas partições e divide a chave de partição Olá uniformemente entre essas partições.</span><span class="sxs-lookup"><span data-stu-id="9a596-117">When a partition reaches its storage size, hello service seamlessly splits hello partition into two new partitions, and divides hello partition key evenly across these partitions.</span></span> <span data-ttu-id="9a596-118">Como as partições são transitórias, hello APIs usam uma abstração de uma "chave intervalo de partição", que indica os intervalos de saudação de hashes de chave de partição.</span><span class="sxs-lookup"><span data-stu-id="9a596-118">Since partitions are transient, hello APIs use an abstraction of a "partition key range", which denotes hello ranges of partition key hashes.</span></span> 

<span data-ttu-id="9a596-119">Quando você emitir uma consulta tooAzure Cosmos DB, Olá SDK executa essas etapas lógicas:</span><span class="sxs-lookup"><span data-stu-id="9a596-119">When you issue a query tooAzure Cosmos DB, hello SDK performs these logical steps:</span></span>

* <span data-ttu-id="9a596-120">Analise o plano de execução Olá SQL consulta toodetermine Olá consulta.</span><span class="sxs-lookup"><span data-stu-id="9a596-120">Parse hello SQL query toodetermine hello query execution plan.</span></span> 
* <span data-ttu-id="9a596-121">Se a consulta de saudação inclui um filtro com a chave de partição hello, como `SELECT * FROM c WHERE c.city = "Seattle"`, é roteado tooa partição única.</span><span class="sxs-lookup"><span data-stu-id="9a596-121">If hello query includes a filter against hello partition key, like `SELECT * FROM c WHERE c.city = "Seattle"`, it is routed tooa single partition.</span></span> <span data-ttu-id="9a596-122">Se a consulta Olá não tem um filtro na chave de partição, em seguida, ele é executado em todas as partições e resultados são mesclados do lado do cliente.</span><span class="sxs-lookup"><span data-stu-id="9a596-122">If hello query does not have a filter on partition key, then it is executed in all partitions, and results are merged client side.</span></span>
* <span data-ttu-id="9a596-123">consulta de saudação é executada dentro de cada partição em série ou em paralelo, com base na configuração do cliente.</span><span class="sxs-lookup"><span data-stu-id="9a596-123">hello query is executed within each partition in series or parallel, based on client configuration.</span></span> <span data-ttu-id="9a596-124">Dentro de cada partição, consulta Olá pode tornar um ou mais viagens de ida e dependendo da complexidade da consulta hello, configurado o tamanho da página e provisionado a taxa de transferência da coleção de saudação.</span><span class="sxs-lookup"><span data-stu-id="9a596-124">Within each partition, hello query might make one or more round trips depending on hello query complexity, configured page size, and provisioned throughput of hello collection.</span></span> <span data-ttu-id="9a596-125">Cada execução retorna o número de saudação do [unidades de solicitação](request-units.md) consumido pela execução da consulta e, opcionalmente, as estatísticas de execução de consulta.</span><span class="sxs-lookup"><span data-stu-id="9a596-125">Each execution returns hello number of [request units](request-units.md) consumed by query execution, and optionally, query execution statistics.</span></span> 
* <span data-ttu-id="9a596-126">Olá SDK executa um resumo dos resultados de consulta de saudação entre partições.</span><span class="sxs-lookup"><span data-stu-id="9a596-126">hello SDK performs a summarization of hello query results across partitions.</span></span> <span data-ttu-id="9a596-127">Por exemplo, se a consulta Olá envolve um ORDER BY em partições, resultados de partições individuais são classificados mesclagem tooreturn resultados em ordem classificada globalmente.</span><span class="sxs-lookup"><span data-stu-id="9a596-127">For example, if hello query involves an ORDER BY across partitions, then results from individual partitions are merge-sorted tooreturn results in globally sorted order.</span></span> <span data-ttu-id="9a596-128">Se a consulta de saudação é uma agregação como `COUNT`, Olá contagens de partições individuais são tooproduce somado Olá contagem geral.</span><span class="sxs-lookup"><span data-stu-id="9a596-128">If hello query is an aggregation like `COUNT`, hello counts from individual partitions are summed tooproduce hello overall count.</span></span>

<span data-ttu-id="9a596-129">Olá SDKs fornecem várias opções para a execução da consulta.</span><span class="sxs-lookup"><span data-stu-id="9a596-129">hello SDKs provide various options for query execution.</span></span> <span data-ttu-id="9a596-130">Por exemplo, essas opções estão disponíveis em Olá no .NET `FeedOptions` classe.</span><span class="sxs-lookup"><span data-stu-id="9a596-130">For example, in .NET these options are available in hello `FeedOptions` class.</span></span> <span data-ttu-id="9a596-131">Olá tabela a seguir descreve essas opções e como elas afetam o tempo de execução de consulta.</span><span class="sxs-lookup"><span data-stu-id="9a596-131">hello following table describes these options and how they impact query execution time.</span></span> 

| <span data-ttu-id="9a596-132">Opção</span><span class="sxs-lookup"><span data-stu-id="9a596-132">Option</span></span> | <span data-ttu-id="9a596-133">Descrição</span><span class="sxs-lookup"><span data-stu-id="9a596-133">Description</span></span> |
| ------ | ----------- |
| `EnableCrossPartitionQuery` | <span data-ttu-id="9a596-134">Deve ser definido tootrue para qualquer consulta que requer toobe executado em mais de uma partição.</span><span class="sxs-lookup"><span data-stu-id="9a596-134">Must be set tootrue for any query that requires toobe executed across more than one partition.</span></span> <span data-ttu-id="9a596-135">Este é um sinalizador explícita tooenable você compensações de desempenho consciente toomake durante o tempo de desenvolvimento.</span><span class="sxs-lookup"><span data-stu-id="9a596-135">This is an explicit flag tooenable you toomake conscious performance tradeoffs during development time.</span></span> |
| `EnableScanInQuery` | <span data-ttu-id="9a596-136">Deve ser definido tootrue se você rejeitou a indexação, mas desejar consulta de saudação toorun por meio de uma verificação mesmo assim.</span><span class="sxs-lookup"><span data-stu-id="9a596-136">Must be set tootrue if you have opted out of indexing, but want toorun hello query via a scan anyway.</span></span> <span data-ttu-id="9a596-137">Só aplicável se a indexação para Olá solicitado caminho de filtro está desabilitado.</span><span class="sxs-lookup"><span data-stu-id="9a596-137">Only applicable if indexing for hello requested filter path is disabled.</span></span> | 
| `MaxItemCount` | <span data-ttu-id="9a596-138">número máximo de saudação de itens tooreturn por servidor de toohello de ida e volta.</span><span class="sxs-lookup"><span data-stu-id="9a596-138">hello maximum number of items tooreturn per round trip toohello server.</span></span> <span data-ttu-id="9a596-139">Definindo muito-1, você pode deixar o servidor de saudação gerenciar Olá número de itens.</span><span class="sxs-lookup"><span data-stu-id="9a596-139">By setting too-1, you can let hello server manage hello number of items.</span></span> <span data-ttu-id="9a596-140">Ou, você pode diminuir esse valor tooretrieve somente um pequeno número de itens por viagem de ida e.</span><span class="sxs-lookup"><span data-stu-id="9a596-140">Or, you can lower this value tooretrieve only a small number of items per round trip.</span></span> 
| `MaxBufferedItemCount` | <span data-ttu-id="9a596-141">Isso é uma opção do lado do cliente e usado o consumo de memória Olá toolimit ao executar entre partições ORDER BY.</span><span class="sxs-lookup"><span data-stu-id="9a596-141">This is a client-side option, and used toolimit hello memory consumption when performing cross-partition ORDER BY.</span></span> <span data-ttu-id="9a596-142">Um valor mais alto ajuda a reduzir a latência de saudação de classificação entre partições.</span><span class="sxs-lookup"><span data-stu-id="9a596-142">A higher value helps reduce hello latency of cross-partition sorting.</span></span> |
| `MaxDegreeOfParallelism` | <span data-ttu-id="9a596-143">Obtém ou define o número de saudação de operações simultâneas executados do lado do cliente durante a execução de consulta paralelos em Olá serviço de banco de dados do DocumentDB do Azure.</span><span class="sxs-lookup"><span data-stu-id="9a596-143">Gets or sets hello number of concurrent operations run client side during parallel query execution in hello Azure DocumentDB database service.</span></span> <span data-ttu-id="9a596-144">Um valor de propriedade positivo limita o número de saudação do valor de conjunto de toohello operações simultâneas.</span><span class="sxs-lookup"><span data-stu-id="9a596-144">A positive property value limits hello number of concurrent operations toohello set value.</span></span> <span data-ttu-id="9a596-145">Se estiver definido como tooless que 0, o sistema de saudação decide automaticamente número de saudação de toorun operações simultâneas.</span><span class="sxs-lookup"><span data-stu-id="9a596-145">If it is set tooless than 0, hello system automatically decides hello number of concurrent operations toorun.</span></span> |
| `PopulateQueryMetrics` | <span data-ttu-id="9a596-146">Habilita o log detalhado de estatísticas de tempo gasto em várias fases de execução da consulta como tempo de compilação, o tempo de loop de índice e o documento de tempo de carregamento.</span><span class="sxs-lookup"><span data-stu-id="9a596-146">Enables detailed logging of statistics of time spent in various phases of query execution like compilation time, index loop time, and document load time.</span></span> <span data-ttu-id="9a596-147">Você pode compartilhar a saída de estatísticas de consulta com problemas de desempenho de consulta de toodiagnose de suporte do Azure.</span><span class="sxs-lookup"><span data-stu-id="9a596-147">You can share output from query statistics with Azure Support toodiagnose query performance issues.</span></span> |
| `RequestContinuation` | <span data-ttu-id="9a596-148">Você pode retomar a execução de consulta, passando no token de continuação opaco Olá retornado por qualquer consulta.</span><span class="sxs-lookup"><span data-stu-id="9a596-148">You can resume query execution by passing in hello opaque continuation token returned by any query.</span></span> <span data-ttu-id="9a596-149">o token de continuação Olá encapsula todos os estados necessários para a execução de consulta.</span><span class="sxs-lookup"><span data-stu-id="9a596-149">hello continuation token encapsulates all state required for query execution.</span></span> |
| `ResponseContinuationTokenLimitInKb` | <span data-ttu-id="9a596-150">Você pode limitar o tamanho máximo de saudação do token de continuação Olá retornado pelo servidor de saudação.</span><span class="sxs-lookup"><span data-stu-id="9a596-150">You can limit hello maximum size of hello continuation token returned by hello server.</span></span> <span data-ttu-id="9a596-151">Talvez seja necessário tooset isso se seu host de aplicativo tem limites de tamanho do cabeçalho de resposta.</span><span class="sxs-lookup"><span data-stu-id="9a596-151">You might need tooset this if your application host has limits on response header size.</span></span> <span data-ttu-id="9a596-152">Essa configuração pode aumentar Olá RUs consumidos para consulta hello e duração geral.</span><span class="sxs-lookup"><span data-stu-id="9a596-152">Setting this may increase hello overall duration and RUs consumed for hello query.</span></span>  |

<span data-ttu-id="9a596-153">Por exemplo, vamos usar uma consulta de exemplo na chave de partição solicitada em uma coleção com `/city` como partição Olá chave e provisionada com 100.000 RU/s de taxa de transferência.</span><span class="sxs-lookup"><span data-stu-id="9a596-153">For example, let's take an example query on partition key requested on a collection with `/city` as hello partition key and provisioned with 100,000 RU/s of throughput.</span></span> <span data-ttu-id="9a596-154">Solicitar esta consulta usando `CreateDocumentQuery<T>` no .NET como Olá a seguir:</span><span class="sxs-lookup"><span data-stu-id="9a596-154">You request this query using `CreateDocumentQuery<T>` in .NET like hello following:</span></span>

```cs
IDocumentQuery<dynamic> query = client.CreateDocumentQuery(
    UriFactory.CreateDocumentCollectionUri(DatabaseName, CollectionName), 
    "SELECT * FROM c WHERE c.city = 'Seattle'", 
    new FeedOptions 
    { 
        PopulateQueryMetrics = true, 
        MaxItemCount = -1, 
        MaxDegreeOfParallelism = -1, 
        EnableCrossPartitionQuery = true 
    }).AsDocumentQuery();

FeedResponse<dynamic> result = await query.ExecuteNextAsync();
```

<span data-ttu-id="9a596-155">Olá trecho SDK mostrado acima, corresponde toohello solicitação de API de REST a seguir:</span><span class="sxs-lookup"><span data-stu-id="9a596-155">hello SDK snippet shown above, corresponds toohello following REST API request:</span></span>

```
POST https://arramacquerymetrics-westus.documents.azure.com/dbs/db/colls/sample/docs HTTP/1.1
x-ms-continuation: 
x-ms-documentdb-isquery: True
x-ms-max-item-count: -1
x-ms-documentdb-query-enablecrosspartition: True
x-ms-documentdb-query-parallelizecrosspartitionquery: True
x-ms-documentdb-query-iscontinuationexpected: True
x-ms-documentdb-populatequerymetrics: True
x-ms-date: Tue, 27 Jun 2017 21:52:18 GMT
authorization: type%3dmaster%26ver%3d1.0%26sig%3drp1Hi83Y8aVV5V6LzZ6xhtQVXRAMz0WNMnUuvriUv%2b4%3d
x-ms-session-token: 7:8,6:2008,5:8,4:2008,3:8,2:2008,1:8,0:8,9:8,8:4008
Cache-Control: no-cache
x-ms-consistency-level: Session
User-Agent: documentdb-dotnet-sdk/1.14.1 Host/32-bit MicrosoftWindowsNT/6.2.9200.0
x-ms-version: 2017-02-22
Accept: application/json
Content-Type: application/query+json
Host: arramacquerymetrics-westus.documents.azure.com
Content-Length: 52
Expect: 100-continue

{"query":"SELECT * FROM c WHERE c.city = 'Seattle'"}
```

<span data-ttu-id="9a596-156">Cada página de execução de consulta corresponde tooa API REST `POST` com hello `Accept: application/query+json` cabeçalho e consulta SQL Olá no corpo de saudação.</span><span class="sxs-lookup"><span data-stu-id="9a596-156">Each query execution page corresponds tooa REST API `POST` with hello `Accept: application/query+json` header, and hello SQL query in hello body.</span></span> <span data-ttu-id="9a596-157">Cada consulta faz com que um ou mais arredondar o servidor de toohello viagens com hello `x-ms-continuation` token ecoada entre a execução de tooresume de cliente e servidor de saudação.</span><span class="sxs-lookup"><span data-stu-id="9a596-157">Each query makes one or more round trips toohello server with hello `x-ms-continuation` token echoed between hello client and server tooresume execution.</span></span> <span data-ttu-id="9a596-158">Opções de configuração de saudação do FeedOptions são passadas toohello servidor na forma de saudação de cabeçalhos de solicitação.</span><span class="sxs-lookup"><span data-stu-id="9a596-158">hello configuration options in FeedOptions are passed toohello server in hello form of request headers.</span></span> <span data-ttu-id="9a596-159">Por exemplo, `MaxItemCount` corresponde muito`x-ms-max-item-count`.</span><span class="sxs-lookup"><span data-stu-id="9a596-159">For example, `MaxItemCount` corresponds too`x-ms-max-item-count`.</span></span> 

<span data-ttu-id="9a596-160">Olá, solicitação retorna seguinte hello (truncados para legibilidade) resposta:</span><span class="sxs-lookup"><span data-stu-id="9a596-160">hello request returns hello following (truncated for readability) response:</span></span>

```
HTTP/1.1 200 Ok
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Server: Microsoft-HTTPAPI/2.0
Strict-Transport-Security: max-age=31536000
x-ms-last-state-change-utc: Tue, 27 Jun 2017 21:01:57.561 GMT
x-ms-resource-quota: documentSize=10240;documentsSize=10485760;documentsCount=-1;collectionSize=10485760;
x-ms-resource-usage: documentSize=1;documentsSize=884;documentsCount=2000;collectionSize=1408;
x-ms-item-count: 2000
x-ms-schemaversion: 1.3
x-ms-alt-content-path: dbs/db/colls/sample
x-ms-content-path: +9kEANVq0wA=
x-ms-xp-role: 1
x-ms-documentdb-query-metrics: totalExecutionTimeInMs=33.67;queryCompileTimeInMs=0.06;queryLogicalPlanBuildTimeInMs=0.02;queryPhysicalPlanBuildTimeInMs=0.10;queryOptimizationTimeInMs=0.00;VMExecutionTimeInMs=32.56;indexLookupTimeInMs=0.36;documentLoadTimeInMs=9.58;systemFunctionExecuteTimeInMs=0.00;userFunctionExecuteTimeInMs=0.00;retrievedDocumentCount=2000;retrievedDocumentSize=1125600;outputDocumentCount=2000;writeOutputTimeInMs=18.10;indexUtilizationRatio=1.00
x-ms-request-charge: 604.42
x-ms-serviceversion: version=1.14.34.4
x-ms-activity-id: 0df8b5f6-83b9-4493-abda-cce6d0f91486
x-ms-session-token: 2:2008
x-ms-gatewayversion: version=1.14.33.2
Date: Tue, 27 Jun 2017 21:59:49 GMT
```

<span data-ttu-id="9a596-161">cabeçalhos de resposta de chave Olá retornados da consulta Olá incluem o seguinte hello:</span><span class="sxs-lookup"><span data-stu-id="9a596-161">hello key response headers returned from hello query include hello following:</span></span>

| <span data-ttu-id="9a596-162">Opção</span><span class="sxs-lookup"><span data-stu-id="9a596-162">Option</span></span> | <span data-ttu-id="9a596-163">Descrição</span><span class="sxs-lookup"><span data-stu-id="9a596-163">Description</span></span> |
| ------ | ----------- |
| `x-ms-item-count` | <span data-ttu-id="9a596-164">número de saudação de itens retornados na resposta de saudação.</span><span class="sxs-lookup"><span data-stu-id="9a596-164">hello number of items returned in hello response.</span></span> <span data-ttu-id="9a596-165">Isso é dependente de saudação fornecida `x-ms-max-item-count`, Olá o número de itens que podem se ajustar no tamanho da carga Olá máximo de resposta, taxa de transferência fornecida hello e tempo de execução de consulta.</span><span class="sxs-lookup"><span data-stu-id="9a596-165">This is dependent on hello supplied `x-ms-max-item-count`, hello number of items that can be fit within hello maximum response payload size, hello provisioned throughput, and query execution time.</span></span> |  
| `x-ms-continuation:` | <span data-ttu-id="9a596-166">Olá continuação token tooresume a execução de consulta hello, se houver mais resultados disponíveis.</span><span class="sxs-lookup"><span data-stu-id="9a596-166">hello continuation token tooresume execution of hello query, if additional results are available.</span></span> | 
| `x-ms-documentdb-query-metrics` | <span data-ttu-id="9a596-167">estatísticas de consulta Olá para execução de saudação.</span><span class="sxs-lookup"><span data-stu-id="9a596-167">hello query statistics for hello execution.</span></span> <span data-ttu-id="9a596-168">Isso é uma cadeia de caracteres delimitada que contém as estatísticas de tempo gasto em Olá várias fases de execução da consulta.</span><span class="sxs-lookup"><span data-stu-id="9a596-168">This is a delimited string containing statistics of time spent in hello various phases of query execution.</span></span> <span data-ttu-id="9a596-169">Retornado se `x-ms-documentdb-populatequerymetrics` está definido muito`True`.</span><span class="sxs-lookup"><span data-stu-id="9a596-169">Returned if `x-ms-documentdb-populatequerymetrics` is set too`True`.</span></span> | 
| `x-ms-request-charge` | <span data-ttu-id="9a596-170">Olá inúmeros [unidades de solicitação](request-units.md) consumidos pela consulta hello.</span><span class="sxs-lookup"><span data-stu-id="9a596-170">hello number of [request units](request-units.md) consumed by hello query.</span></span> | 

<span data-ttu-id="9a596-171">Para obter detalhes sobre cabeçalhos de solicitação de API REST do hello e opções, consulte [consultar recursos usando Olá API REST do DocumentDB](https://docs.microsoft.com/rest/api/documentdb/querying-documentdb-resources-using-the-rest-api).</span><span class="sxs-lookup"><span data-stu-id="9a596-171">For details on hello REST API request headers and options, see [Querying resources using hello DocumentDB REST API](https://docs.microsoft.com/rest/api/documentdb/querying-documentdb-resources-using-the-rest-api).</span></span>

## <a name="best-practices-for-query-performance"></a><span data-ttu-id="9a596-172">Práticas recomendadas para desempenho de consulta</span><span class="sxs-lookup"><span data-stu-id="9a596-172">Best practices for query performance</span></span>
<span data-ttu-id="9a596-173">Olá seguem fatores mais comuns de saudação que afetam o desempenho de consulta de banco de dados do Azure Cosmos.</span><span class="sxs-lookup"><span data-stu-id="9a596-173">hello following are hello most common factors that impact Azure Cosmos DB query performance.</span></span> <span data-ttu-id="9a596-174">Podemos obter detalhes de cada um desses tópicos neste artigo.</span><span class="sxs-lookup"><span data-stu-id="9a596-174">We dig deeper into each of these topics in this article.</span></span>

| <span data-ttu-id="9a596-175">Fator</span><span class="sxs-lookup"><span data-stu-id="9a596-175">Factor</span></span> | <span data-ttu-id="9a596-176">Dica</span><span class="sxs-lookup"><span data-stu-id="9a596-176">Tip</span></span> | 
| ------ | -----| 
| <span data-ttu-id="9a596-177">Taxa de transferência provisionada</span><span class="sxs-lookup"><span data-stu-id="9a596-177">Provisioned throughput</span></span> | <span data-ttu-id="9a596-178">Medir RU por consulta e verifique se você tem Olá provisionado taxa de transferência necessária para que suas consultas.</span><span class="sxs-lookup"><span data-stu-id="9a596-178">Measure RU per query, and ensure that you have hello required provisioned throughput for your queries.</span></span> | 
| <span data-ttu-id="9a596-179">Particionamento e chaves de partição</span><span class="sxs-lookup"><span data-stu-id="9a596-179">Partitioning and partition keys</span></span> | <span data-ttu-id="9a596-180">Favorecer consultas com valor de chave de partição Olá na cláusula de filtro de saudação de baixa latência.</span><span class="sxs-lookup"><span data-stu-id="9a596-180">Favor queries with hello partition key value in hello filter clause for low latency.</span></span> |
| <span data-ttu-id="9a596-181">Opções de consulta e de SDK</span><span class="sxs-lookup"><span data-stu-id="9a596-181">SDK and query options</span></span> | <span data-ttu-id="9a596-182">Siga as práticas recomendadas do SDK com conectividade direta e ajuste as opções de execução de consulta do lado do cliente.</span><span class="sxs-lookup"><span data-stu-id="9a596-182">Follow SDK best practices like direct connectivity, and tune client-side query execution options.</span></span> |
| <span data-ttu-id="9a596-183">Latência da rede</span><span class="sxs-lookup"><span data-stu-id="9a596-183">Network latency</span></span> | <span data-ttu-id="9a596-184">Conta para a rede sobrecarga em medidas e usar tooread APIs de hospedagem múltipla de saudação mais próximo de região.</span><span class="sxs-lookup"><span data-stu-id="9a596-184">Account for network overhead in measurement, and use multi-homing APIs tooread from hello nearest region.</span></span> |
| <span data-ttu-id="9a596-185">Política de indexação</span><span class="sxs-lookup"><span data-stu-id="9a596-185">Indexing Policy</span></span> | <span data-ttu-id="9a596-186">Certifique-se de que você tenha Olá necessário caminhos/política de indexação para consulta hello.</span><span class="sxs-lookup"><span data-stu-id="9a596-186">Ensure that you have hello required indexing paths/policy for hello query.</span></span> |
| <span data-ttu-id="9a596-187">Métricas de execução da consulta</span><span class="sxs-lookup"><span data-stu-id="9a596-187">Query execution metrics</span></span> | <span data-ttu-id="9a596-188">Analise Olá consulta execução métricas tooidentify potencial regravações de formas de consulta e dados.</span><span class="sxs-lookup"><span data-stu-id="9a596-188">Analyze hello query execution metrics tooidentify potential rewrites of query and data shapes.</span></span>  |

### <a name="provisioned-throughput"></a><span data-ttu-id="9a596-189">Taxa de transferência provisionada</span><span class="sxs-lookup"><span data-stu-id="9a596-189">Provisioned throughput</span></span>
<span data-ttu-id="9a596-190">No Cosmos DB, você cria contêineres de dados, cada um com a taxa de transferência reservada expressa em RUs (unidades de solicitação) por segundo.</span><span class="sxs-lookup"><span data-stu-id="9a596-190">In Cosmos DB, you create containers of data, each with reserved throughput expressed in request units (RU) per-second.</span></span> <span data-ttu-id="9a596-191">Uma leitura de um documento de 1 KB é 1 RU e cada operação (incluindo consultas) é normalizado tooa número fixo de RUs com base em sua complexidade.</span><span class="sxs-lookup"><span data-stu-id="9a596-191">A read of a 1-KB document is 1 RU, and every operation (including queries) is normalized tooa fixed number of RUs based on its complexity.</span></span> <span data-ttu-id="9a596-192">Por exemplo, se você tiver 1000 RU/s provisionado para o contêiner, e você tiver uma consulta como `SELECT * FROM c WHERE c.city = 'Seattle'` que consome 5 RUs, em seguida, você pode executar (1000 RU/s) / (RU/consulta 5) = 200 consulta/s tais consultas por segundo.</span><span class="sxs-lookup"><span data-stu-id="9a596-192">For example, if you have 1000 RU/s provisioned for your container, and you have a query like `SELECT * FROM c WHERE c.city = 'Seattle'` that consumes 5 RUs, then you can perform (1000 RU/s) / (5 RU/query) = 200 query/s such queries per second.</span></span> 

<span data-ttu-id="9a596-193">Se você enviar consultas/s mais de 200, o serviço de Olá inicia a limitação de taxa de solicitações de entrada acima 200/s.</span><span class="sxs-lookup"><span data-stu-id="9a596-193">If you submit more than 200 queries/sec, hello service starts rate-limiting incoming requests above 200/s.</span></span> <span data-ttu-id="9a596-194">Olá SDKs automaticamente lidar com isso, executando uma repetição/retirada, portanto, você poderá notar uma latência mais alta para essas consultas.</span><span class="sxs-lookup"><span data-stu-id="9a596-194">hello SDKs automatically handle this case by performing a backoff/retry, therefore you might notice a higher latency for these queries.</span></span> <span data-ttu-id="9a596-195">Aumentar Olá provisionado taxa de transferência toohello necessário valor aumenta a latência da consulta e a taxa de transferência.</span><span class="sxs-lookup"><span data-stu-id="9a596-195">Increasing hello provisioned throughput toohello required value improves your query latency and throughput.</span></span> 

<span data-ttu-id="9a596-196">toolearn mais informações sobre unidades de solicitação, consulte [unidades de solicitação](request-units.md).</span><span class="sxs-lookup"><span data-stu-id="9a596-196">toolearn more about request units, see [Request units](request-units.md).</span></span>

### <a name="partitioning-and-partition-keys"></a><span data-ttu-id="9a596-197">Particionamento e chaves de partição</span><span class="sxs-lookup"><span data-stu-id="9a596-197">Partitioning and partition keys</span></span>
<span data-ttu-id="9a596-198">Com o banco de dados do Azure Cosmos, normalmente consultas executam na ordem do mais rápido mais eficiente tooslower/menos eficiente de saudação.</span><span class="sxs-lookup"><span data-stu-id="9a596-198">With Azure Cosmos DB, typically queries perform in hello following order from fastest/most efficient tooslower/less efficient.</span></span> 

* <span data-ttu-id="9a596-199">OBTER em uma chave de partição única e a chave de item</span><span class="sxs-lookup"><span data-stu-id="9a596-199">GET on a single partition key and item key</span></span>
* <span data-ttu-id="9a596-200">Consulta com uma cláusula de filtro em uma chave de partição única</span><span class="sxs-lookup"><span data-stu-id="9a596-200">Query with a filter clause on a single partition key</span></span>
* <span data-ttu-id="9a596-201">Consulta sem uma cláusula de filtro de igualdade ou um intervalo em qualquer propriedade</span><span class="sxs-lookup"><span data-stu-id="9a596-201">Query without an equality or range filter clause on any property</span></span>
* <span data-ttu-id="9a596-202">Consulta sem filtros</span><span class="sxs-lookup"><span data-stu-id="9a596-202">Query without filters</span></span>

<span data-ttu-id="9a596-203">Consultas que tooconsult necessidade todas as partições necessidade maior latência e pode consumir RUs superior.</span><span class="sxs-lookup"><span data-stu-id="9a596-203">Queries that need tooconsult all partitions need higher latency, and can consume higher RUs.</span></span> <span data-ttu-id="9a596-204">Como cada partição tem indexação automática em relação a todas as propriedades, consulta Olá pode ser atendida com eficiência do índice Olá nesse caso.</span><span class="sxs-lookup"><span data-stu-id="9a596-204">Since each partition has automatic indexing against all properties, hello query can be served efficiently from hello index in this case.</span></span> <span data-ttu-id="9a596-205">Você pode fazer consultas que abrangem mais rápido de partições usando opções de paralelismo hello.</span><span class="sxs-lookup"><span data-stu-id="9a596-205">You can make queries that span partitions faster by using hello parallelism options.</span></span>

<span data-ttu-id="9a596-206">toolearn mais informações sobre particionamento e chaves de partição, consulte [particionamento no banco de dados do Azure Cosmos](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="9a596-206">toolearn more about partitioning and partition keys, see [Partitioning in Azure Cosmos DB](partition-data.md).</span></span>

### <a name="sdk-and-query-options"></a><span data-ttu-id="9a596-207">Opções de consulta e de SDK</span><span class="sxs-lookup"><span data-stu-id="9a596-207">SDK and query options</span></span>
<span data-ttu-id="9a596-208">Consulte [dicas de desempenho](performance-tips.md) e [testes de desempenho](performance-testing.md) para como tooget Olá melhor desempenho no cliente do banco de dados do Azure Cosmos.</span><span class="sxs-lookup"><span data-stu-id="9a596-208">See [Performance Tips](performance-tips.md) and [Performance testing](performance-testing.md) for how tooget hello best client-side performance from Azure Cosmos DB.</span></span> <span data-ttu-id="9a596-209">Isso inclui usar Olá SDKs mais recentes, configurando as configurações de específico de plataforma como o número padrão de conexões, a frequência da coleta de lixo e usando as opções de conectividade leve como Direct/TCP.</span><span class="sxs-lookup"><span data-stu-id="9a596-209">This includes using hello latest SDKs, configuring platform-specific configurations like default number of connections, frequency of garbage collection, and using lightweight connectivity options like Direct/TCP.</span></span> 


#### <a name="max-item-count"></a><span data-ttu-id="9a596-210">Contagem máxima de itens</span><span class="sxs-lookup"><span data-stu-id="9a596-210">Max Item Count</span></span>
<span data-ttu-id="9a596-211">Para consultas, Olá valor `MaxItemCount` pode ter um impacto significativo no tempo de consulta de ponta a ponta.</span><span class="sxs-lookup"><span data-stu-id="9a596-211">For queries, hello value of `MaxItemCount` can have a significant impact on end-to-end query time.</span></span> <span data-ttu-id="9a596-212">Cada viagem de ida e retornará não mais do que o número de saudação de itens no servidor toohello `MaxItemCount` (padrão de 100 itens).</span><span class="sxs-lookup"><span data-stu-id="9a596-212">Each round trip toohello server will return no more than hello number of items in `MaxItemCount` (Default of 100 items).</span></span> <span data-ttu-id="9a596-213">Definir esse valor mais alto tooa (-1 é recomendado e máximo) melhorará a duração de consulta geral limitando Olá número de idas e voltas entre servidor e cliente, especialmente para consultas com grandes conjuntos de resultados.</span><span class="sxs-lookup"><span data-stu-id="9a596-213">Setting this tooa higher value (-1 is maximum, and recommended) will improve your query duration overall by limiting hello number of round trips between server and client, especially for queries with large result sets.</span></span>

```cs
IDocumentQuery<dynamic> query = client.CreateDocumentQuery(
    UriFactory.CreateDocumentCollectionUri(DatabaseName, CollectionName), 
    "SELECT * FROM c WHERE c.city = 'Seattle'", 
    new FeedOptions 
    { 
        MaxItemCount = -1, 
    }).AsDocumentQuery();
```

#### <a name="max-degree-of-parallelism"></a><span data-ttu-id="9a596-214">Grau máximo de paralelismo</span><span class="sxs-lookup"><span data-stu-id="9a596-214">Max Degree of Parallelism</span></span>
<span data-ttu-id="9a596-215">Para consultas, ajustar Olá `MaxDegreeOfParallelism` tooidentify Olá melhores configurações para seu aplicativo, especialmente se você executar consultas entre partições (sem um filtro no valor de chave de partição Olá).</span><span class="sxs-lookup"><span data-stu-id="9a596-215">For queries, tune hello `MaxDegreeOfParallelism` tooidentify hello best configurations for your application, especially if you perform cross-partition queries (without a filter on hello partition-key value).</span></span> <span data-ttu-id="9a596-216">`MaxDegreeOfParallelism`Controla o número máximo de saudação de tarefas em paralelo, ou seja, no máximo Olá toobe partições visitado em paralelo.</span><span class="sxs-lookup"><span data-stu-id="9a596-216">`MaxDegreeOfParallelism`  controls hello maximum number of parallel tasks, i.e., hello maximum of partitions toobe visited in parallel.</span></span> 

```cs
IDocumentQuery<dynamic> query = client.CreateDocumentQuery(
    UriFactory.CreateDocumentCollectionUri(DatabaseName, CollectionName), 
    "SELECT * FROM c WHERE c.city = 'Seattle'", 
    new FeedOptions 
    { 
        MaxDegreeOfParallelism = -1, 
        EnableCrossPartitionQuery = true 
    }).AsDocumentQuery();
```

<span data-ttu-id="9a596-217">Vamos supor que</span><span class="sxs-lookup"><span data-stu-id="9a596-217">Let’s assume that</span></span>
* <span data-ttu-id="9a596-218">D = padrão máximo número de tarefas paralelas (= número total de processador na máquina do cliente Olá)</span><span class="sxs-lookup"><span data-stu-id="9a596-218">D = Default Maximum number of parallel tasks (= total number of processor in hello client machine)</span></span>
* <span data-ttu-id="9a596-219">P = número máximo especificado pelo usuário de tarefas paralelas</span><span class="sxs-lookup"><span data-stu-id="9a596-219">P = User-specified maximum number of parallel tasks</span></span>
* <span data-ttu-id="9a596-220">N = número de partições que precisa toobe visitado para responder a uma consulta</span><span class="sxs-lookup"><span data-stu-id="9a596-220">N = Number of partitions that needs  toobe visited for answering a query</span></span>

<span data-ttu-id="9a596-221">A seguir é as implicações de como consultas paralelas Olá se comportem de valores diferentes de P.</span><span class="sxs-lookup"><span data-stu-id="9a596-221">Following are implications of how hello parallel queries would behave for different values of P.</span></span>
* <span data-ttu-id="9a596-222">(P == 0) => Modo serial</span><span class="sxs-lookup"><span data-stu-id="9a596-222">(P == 0) => Serial Mode</span></span>
* <span data-ttu-id="9a596-223">(P == 1) => Máximo de uma tarefa</span><span class="sxs-lookup"><span data-stu-id="9a596-223">(P == 1) => Maximum of one task</span></span>
* <span data-ttu-id="9a596-224">(P > 1) => Mín. (P, N) de tarefas paralelas</span><span class="sxs-lookup"><span data-stu-id="9a596-224">(P > 1) => Min (P, N) parallel tasks</span></span> 
* <span data-ttu-id="9a596-225">(P < 1) => Mín. (N, D) de tarefas paralelas</span><span class="sxs-lookup"><span data-stu-id="9a596-225">(P < 1) => Min (N, D) parallel tasks</span></span>

<span data-ttu-id="9a596-226">Notas de versão do SDK e detalhes sobre classes e métodos implementados, consulte [SDKs do DocumentDB](documentdb-sdk-dotnet.md)</span><span class="sxs-lookup"><span data-stu-id="9a596-226">For SDK release notes, and details on implemented classes and methods see [DocumentDB SDKs](documentdb-sdk-dotnet.md)</span></span>

### <a name="network-latency"></a><span data-ttu-id="9a596-227">Latência da rede</span><span class="sxs-lookup"><span data-stu-id="9a596-227">Network latency</span></span>
<span data-ttu-id="9a596-228">Consulte [distribuição global do banco de dados do Azure Cosmos](tutorial-global-distribution-documentdb.md) como tooset até distribuição global e conectar-se a região mais próxima toohello.</span><span class="sxs-lookup"><span data-stu-id="9a596-228">See [Azure Cosmos DB global distribution](tutorial-global-distribution-documentdb.md) for how tooset up global distribution, and connect toohello closest region.</span></span> <span data-ttu-id="9a596-229">Latência de rede tem um impacto significativo no desempenho da consulta quando precisar toomake várias viagens ou recuperar um grande conjunto de resultados de consulta de saudação.</span><span class="sxs-lookup"><span data-stu-id="9a596-229">Network latency has a significant impact on query performance when you need toomake multiple round-trips or retrieve a large result set from hello query.</span></span> 

<span data-ttu-id="9a596-230">Olá seção em métricas de execução de consulta explica como tooretrieve Olá servidor de tempo de execução de consultas ( `totalExecutionTimeInMs`), de modo que você pode diferenciar entre o tempo gasto na execução da consulta e o tempo gasto em trânsito de rede.</span><span class="sxs-lookup"><span data-stu-id="9a596-230">hello section on query execution metrics explains how tooretrieve hello server execution time of queries ( `totalExecutionTimeInMs`), so that you can differentiate between time spent in query execution and time spent in network transit.</span></span>

### <a name="indexing-policy"></a><span data-ttu-id="9a596-231">Política de indexação</span><span class="sxs-lookup"><span data-stu-id="9a596-231">Indexing policy</span></span>
<span data-ttu-id="9a596-232">Consulte [Configurando a política de indexação](indexing-policies.md) para indexação de caminhos, tipos e os modos e como elas afetam a execução da consulta.</span><span class="sxs-lookup"><span data-stu-id="9a596-232">See [Configuring indexing policy](indexing-policies.md) for indexing paths, kinds, and modes, and how they impact query execution.</span></span> <span data-ttu-id="9a596-233">Por padrão, Olá política de indexação usa a indexação de Hash para cadeias de caracteres, que é eficiente para consultas de igualdade, mas não para consultas de intervalo/ordem através de consultas.</span><span class="sxs-lookup"><span data-stu-id="9a596-233">By default, hello indexing policy uses Hash indexing for strings, which is effective for equality queries, but not for range queries/order by queries.</span></span> <span data-ttu-id="9a596-234">Se você precisar de consultas de intervalo para cadeias de caracteres, é recomendável especificar Olá tipo de índice de intervalo para todas as cadeias de caracteres.</span><span class="sxs-lookup"><span data-stu-id="9a596-234">If you need range queries for strings, we recommend specifying hello Range index type for all strings.</span></span> 

## <a name="query-execution-metrics"></a><span data-ttu-id="9a596-235">Métricas de execução da consulta</span><span class="sxs-lookup"><span data-stu-id="9a596-235">Query execution metrics</span></span>
<span data-ttu-id="9a596-236">Você pode obter métricas detalhadas na execução da consulta, passando Olá opcional `x-ms-documentdb-populatequerymetrics` cabeçalho (`FeedOptions.PopulateQueryMetrics` no hello .NET SDK).</span><span class="sxs-lookup"><span data-stu-id="9a596-236">You can obtain detailed metrics on query execution by passing in hello optional `x-ms-documentdb-populatequerymetrics` header (`FeedOptions.PopulateQueryMetrics` in hello .NET SDK).</span></span> <span data-ttu-id="9a596-237">Olá valor retornado em `x-ms-documentdb-query-metrics` tem Olá destinadas para solução de problemas de execução de consulta avançada de pares de chave-valor a seguir.</span><span class="sxs-lookup"><span data-stu-id="9a596-237">hello value returned in `x-ms-documentdb-query-metrics` has hello following key-value pairs meant for advanced troubleshooting of query execution.</span></span> 

```cs
IDocumentQuery<dynamic> query = client.CreateDocumentQuery(
    UriFactory.CreateDocumentCollectionUri(DatabaseName, CollectionName), 
    "SELECT * FROM c WHERE c.city = 'Seattle'", 
    new FeedOptions 
    { 
        PopulateQueryMetrics = true, 
    }).AsDocumentQuery();

FeedResponse<dynamic> result = await query.ExecuteNextAsync();

// Returns metrics by partition key range Id
IReadOnlyDictionary<string, QueryMetrics> metrics = result.QueryMetrics;

```

| <span data-ttu-id="9a596-238">Métrica</span><span class="sxs-lookup"><span data-stu-id="9a596-238">Metric</span></span> | <span data-ttu-id="9a596-239">Unidade</span><span class="sxs-lookup"><span data-stu-id="9a596-239">Unit</span></span> | <span data-ttu-id="9a596-240">Descrição</span><span class="sxs-lookup"><span data-stu-id="9a596-240">Description</span></span> | 
| ------ | -----| ----------- |
| `totalExecutionTimeInMs` | <span data-ttu-id="9a596-241">milissegundos</span><span class="sxs-lookup"><span data-stu-id="9a596-241">milliseconds</span></span> | <span data-ttu-id="9a596-242">Tempo de execução da consulta</span><span class="sxs-lookup"><span data-stu-id="9a596-242">Query execution time</span></span> | 
| `queryCompileTimeInMs` | <span data-ttu-id="9a596-243">milissegundos</span><span class="sxs-lookup"><span data-stu-id="9a596-243">milliseconds</span></span> | <span data-ttu-id="9a596-244">Tempo de compilação de consulta</span><span class="sxs-lookup"><span data-stu-id="9a596-244">Query compile time</span></span>  | 
| `queryLogicalPlanBuildTimeInMs` | <span data-ttu-id="9a596-245">milissegundos</span><span class="sxs-lookup"><span data-stu-id="9a596-245">milliseconds</span></span> | <span data-ttu-id="9a596-246">Plano de consulta lógica tempo toobuild</span><span class="sxs-lookup"><span data-stu-id="9a596-246">Time toobuild logical query plan</span></span> | 
| `queryPhysicalPlanBuildTimeInMs` | <span data-ttu-id="9a596-247">milissegundos</span><span class="sxs-lookup"><span data-stu-id="9a596-247">milliseconds</span></span> | <span data-ttu-id="9a596-248">Plano de consulta físico toobuild tempo</span><span class="sxs-lookup"><span data-stu-id="9a596-248">Time toobuild physical query plan</span></span> | 
| `queryOptimizationTimeInMs` | <span data-ttu-id="9a596-249">milissegundos</span><span class="sxs-lookup"><span data-stu-id="9a596-249">milliseconds</span></span> | <span data-ttu-id="9a596-250">Tempo gasto na otimização de consulta</span><span class="sxs-lookup"><span data-stu-id="9a596-250">Time spent in optimizing query</span></span> | 
| `VMExecutionTimeInMs` | <span data-ttu-id="9a596-251">milissegundos</span><span class="sxs-lookup"><span data-stu-id="9a596-251">milliseconds</span></span> | <span data-ttu-id="9a596-252">Tempo gasto em tempo de execução de consulta</span><span class="sxs-lookup"><span data-stu-id="9a596-252">Time spent in query runtime</span></span> | 
| `indexLookupTimeInMs` | <span data-ttu-id="9a596-253">milissegundos</span><span class="sxs-lookup"><span data-stu-id="9a596-253">milliseconds</span></span> | <span data-ttu-id="9a596-254">Tempo gasto na camada física de índice</span><span class="sxs-lookup"><span data-stu-id="9a596-254">Time spent in physical index layer</span></span> | 
| `documentLoadTimeInMs` | <span data-ttu-id="9a596-255">milissegundos</span><span class="sxs-lookup"><span data-stu-id="9a596-255">milliseconds</span></span> | <span data-ttu-id="9a596-256">Tempo gasto no carregamento de documentos</span><span class="sxs-lookup"><span data-stu-id="9a596-256">Time spent in loading documents</span></span>  | 
| `systemFunctionExecuteTimeInMs` | <span data-ttu-id="9a596-257">milissegundos</span><span class="sxs-lookup"><span data-stu-id="9a596-257">milliseconds</span></span> | <span data-ttu-id="9a596-258">Tempo total gasto executando funções de sistema (interno) em milissegundos</span><span class="sxs-lookup"><span data-stu-id="9a596-258">Total time spent executing system (built-in) functions in milliseconds</span></span>  | 
| `userFunctionExecuteTimeInMs` | <span data-ttu-id="9a596-259">milissegundos</span><span class="sxs-lookup"><span data-stu-id="9a596-259">milliseconds</span></span> | <span data-ttu-id="9a596-260">Tempo total gasto executando funções definidas pelo usuário (interno) em milissegundos</span><span class="sxs-lookup"><span data-stu-id="9a596-260">Total time spent executing user-defined functions in milliseconds</span></span> | 
| `retrievedDocumentCount` | <span data-ttu-id="9a596-261">milissegundos</span><span class="sxs-lookup"><span data-stu-id="9a596-261">milliseconds</span></span> | <span data-ttu-id="9a596-262">Número total de documentos recuperados</span><span class="sxs-lookup"><span data-stu-id="9a596-262">Total number of retrieved documents</span></span>  | 
| `retrievedDocumentSize` | <span data-ttu-id="9a596-263">bytes</span><span class="sxs-lookup"><span data-stu-id="9a596-263">bytes</span></span> | <span data-ttu-id="9a596-264">Tamanho total dos documentos recuperados em bytes</span><span class="sxs-lookup"><span data-stu-id="9a596-264">Total size of retrieved documents in bytes</span></span>  | 
| `outputDocumentCount` | <span data-ttu-id="9a596-265">count</span><span class="sxs-lookup"><span data-stu-id="9a596-265">count</span></span> | <span data-ttu-id="9a596-266">Número de documentos de saída</span><span class="sxs-lookup"><span data-stu-id="9a596-266">Number of output documents</span></span> | 
| `writeOutputTimeInMs` | <span data-ttu-id="9a596-267">milissegundos</span><span class="sxs-lookup"><span data-stu-id="9a596-267">milliseconds</span></span> | <span data-ttu-id="9a596-268">Tempo de execução da consulta em milissegundos</span><span class="sxs-lookup"><span data-stu-id="9a596-268">Query execution time in milliseconds</span></span> | 
| `indexUtilizationRatio` | <span data-ttu-id="9a596-269">taxa de (< = 1)</span><span class="sxs-lookup"><span data-stu-id="9a596-269">ratio (<=1)</span></span> | <span data-ttu-id="9a596-270">Taxa do número de documentos correspondida Olá filtro toohello quantos documentos carregados</span><span class="sxs-lookup"><span data-stu-id="9a596-270">Ratio of number of documents matched by hello filter toohello number of documents loaded</span></span>  | 

<span data-ttu-id="9a596-271">Olá cliente SDKs podem internamente fazer várias operações tooserve Olá consulta dentro de cada partição.</span><span class="sxs-lookup"><span data-stu-id="9a596-271">hello client SDKs may internally make multiple query operations tooserve hello query within each partition.</span></span> <span data-ttu-id="9a596-272">cliente Olá torna mais de uma chamada por partição se resultados totais Olá excederem `x-ms-max-item-count`, se consulta Olá excede a taxa de transferência fornecida para partição de Olá Olá se hello carga de consulta atinge o tamanho máximo de saudação por página ou se hello consulta atinge Olá sistema alocados tempo limite.</span><span class="sxs-lookup"><span data-stu-id="9a596-272">hello client makes more than one call per-partition if hello total results exceed `x-ms-max-item-count`, if hello query exceeds hello provisioned throughput for hello partition, or if hello query payload reaches hello maximum size per page, or if hello query reaches hello system allocated timeout limit.</span></span> <span data-ttu-id="9a596-273">Cada execução da consulta parcial retorna um `x-ms-documentdb-query-metrics` para a página.</span><span class="sxs-lookup"><span data-stu-id="9a596-273">Each partial query execution returns a `x-ms-documentdb-query-metrics` for that page.</span></span> 

<span data-ttu-id="9a596-274">Aqui estão alguns exemplos de consultas e como toointerpret algumas das métricas de saudação retornadas da execução da consulta:</span><span class="sxs-lookup"><span data-stu-id="9a596-274">Here are some sample queries, and how toointerpret some of hello metrics returned from query execution:</span></span> 

| <span data-ttu-id="9a596-275">Consultar</span><span class="sxs-lookup"><span data-stu-id="9a596-275">Query</span></span> | <span data-ttu-id="9a596-276">Métrica de exemplo</span><span class="sxs-lookup"><span data-stu-id="9a596-276">Sample Metric</span></span> | <span data-ttu-id="9a596-277">Descrição</span><span class="sxs-lookup"><span data-stu-id="9a596-277">Description</span></span> | 
| ------ | -----| ----------- |
| `SELECT TOP 100 * FROM c` | `"RetrievedDocumentCount": 101` | <span data-ttu-id="9a596-278">Olá número de documentos recuperados é 100 + 1 cláusula TOP Olá de toomatch.</span><span class="sxs-lookup"><span data-stu-id="9a596-278">hello number of documents retrieved is 100+1 toomatch hello TOP clause.</span></span> <span data-ttu-id="9a596-279">Tempo de consulta é gasto principalmente `WriteOutputTime` e `DocumentLoadTime` porque é uma verificação.</span><span class="sxs-lookup"><span data-stu-id="9a596-279">Query time is mostly spent in `WriteOutputTime` and `DocumentLoadTime` since it is a scan.</span></span> | 
| `SELECT TOP 500 * FROM c` | `"RetrievedDocumentCount": 501` | <span data-ttu-id="9a596-280">RetrievedDocumentCount agora é mais alto (500 + 1 toomatch Olá cláusula TOP).</span><span class="sxs-lookup"><span data-stu-id="9a596-280">RetrievedDocumentCount is now higher (500+1 toomatch hello TOP clause).</span></span> | 
| `SELECT * FROM c WHERE c.N = 55` | `"IndexLookupTime": "00:00:00.0009500"` | <span data-ttu-id="9a596-281">Cerca de 0,9 ms é gasto na IndexLookupTime para uma pesquisa de chave, porque ele é um índice de pesquisa `/N/?`.</span><span class="sxs-lookup"><span data-stu-id="9a596-281">About 0.9 ms is spent in IndexLookupTime for a key lookup, because it's an index lookup on `/N/?`.</span></span> | 
| `SELECT * FROM c WHERE c.N > 55` | `"IndexLookupTime": "00:00:00.0017700"` | <span data-ttu-id="9a596-282">Um pouco mais de tempo (ms 1.7) é gasto em IndexLookupTime por um exame de intervalo, porque ele é um índice de pesquisa `/N/?`.</span><span class="sxs-lookup"><span data-stu-id="9a596-282">Slightly more time (1.7 ms) spent in IndexLookupTime over a range scan, because it's an index lookup on `/N/?`.</span></span> | 
| `SELECT TOP 500 c.N FROM c` | `"IndexLookupTime": "00:00:00.0017700"` | <span data-ttu-id="9a596-283">Mesmo tempo gasto em `DocumentLoadTime` como consultas anteriores, mas inferior `WriteOutputTime` porque estamos projetando apenas uma propriedade.</span><span class="sxs-lookup"><span data-stu-id="9a596-283">Same time spent on `DocumentLoadTime` as previous queries, but lower `WriteOutputTime` because we're projecting only one property.</span></span> | 
| `SELECT TOP 500 udf.toPercent(c.N) FROM c` | `"UserDefinedFunctionExecutionTime": "00:00:00.2136500"` | <span data-ttu-id="9a596-284">Sobre 213 ms é gasto na `UserDefinedFunctionExecutionTime` executar Olá UDF em cada valor de `c.N`.</span><span class="sxs-lookup"><span data-stu-id="9a596-284">About 213 ms is spent in `UserDefinedFunctionExecutionTime` executing hello UDF on each value of `c.N`.</span></span> |
| `SELECT TOP 500 c.Name FROM c WHERE STARTSWITH(c.Name, 'Den')` | `"IndexLookupTime": "00:00:00.0006400", "SystemFunctionExecutionTime": "00:00:00.0074100"` | <span data-ttu-id="9a596-285">Cerca de 0,6 ms é gasto na `IndexLookupTime` em `/Name/?`.</span><span class="sxs-lookup"><span data-stu-id="9a596-285">About 0.6 ms is spent in `IndexLookupTime` on `/Name/?`.</span></span> <span data-ttu-id="9a596-286">A maioria das Olá consulta tempo de execução (ms ~ 7) em `SystemFunctionExecutionTime`.</span><span class="sxs-lookup"><span data-stu-id="9a596-286">Most of hello query execution time (~7 ms) in `SystemFunctionExecutionTime`.</span></span> |
| `SELECT TOP 500 c.Name FROM c WHERE STARTSWITH(LOWER(c.Name), 'den')` | `"IndexLookupTime": "00:00:00", "RetrievedDocumentCount": 2491,  "OutputDocumentCount": 500` | <span data-ttu-id="9a596-287">A consulta é executada como uma verificação, pois ela usa `LOWER`, e 500 de 2491 documentos recuperados são retornados.</span><span class="sxs-lookup"><span data-stu-id="9a596-287">Query is performed as a scan because it uses `LOWER`, and 500 out of 2491 retrieved documents are returned.</span></span> |


## <a name="next-steps"></a><span data-ttu-id="9a596-288">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="9a596-288">Next steps</span></span>
* <span data-ttu-id="9a596-289">toolearn sobre operadores de consulta SQL Olá com suporte e palavras-chave, consulte [consulta SQL](documentdb-sql-query.md).</span><span class="sxs-lookup"><span data-stu-id="9a596-289">toolearn about hello supported SQL query operators and keywords, see [SQL query](documentdb-sql-query.md).</span></span> 
* <span data-ttu-id="9a596-290">toolearn sobre unidades de solicitação, consulte [unidades de solicitação](request-units.md).</span><span class="sxs-lookup"><span data-stu-id="9a596-290">toolearn about request units, see [request units](request-units.md).</span></span>
* <span data-ttu-id="9a596-291">toolearn sobre a política de indexação, consulte [política de indexação](indexing-policies.md)</span><span class="sxs-lookup"><span data-stu-id="9a596-291">toolearn about indexing policy, see [indexing policy](indexing-policies.md)</span></span> 


