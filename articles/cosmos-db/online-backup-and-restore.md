---
title: "Backup e restauração online com o Azure Cosmos DB | Microsoft Docs"
description: "Saiba como executar o backup e a restauração automáticos em um banco de dados do Azure Cosmos DB."
keywords: "backup e restauração, backup online"
services: cosmos-db
documentationcenter: 
author: RahulPrasad16
manager: jhubbard
editor: monicar
ms.assetid: 98eade4a-7ef4-4667-b167-6603ecd80b79
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: multiple
ms.topic: article
ms.date: 08/11/2017
ms.author: raprasa
ms.openlocfilehash: 130f0eb259621737d6dbdb151e363915fb334ce1
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/18/2017
---
# <a name="automatic-online-backup-and-restore-with-azure-cosmos-db"></a><span data-ttu-id="82322-104">Backup e restauração online automáticos com o Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="82322-104">Automatic online backup and restore with Azure Cosmos DB</span></span>
<span data-ttu-id="82322-105">O Azure Cosmos DB faz backup automaticamente de todos os seus dados em intervalos regulares.</span><span class="sxs-lookup"><span data-stu-id="82322-105">Azure Cosmos DB automatically takes backups of all your data at regular intervals.</span></span> <span data-ttu-id="82322-106">Os backups automáticos são feitos sem afetar o desempenho nem a disponibilidade das operações de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="82322-106">The automatic backups are taken without affecting the performance or availability of your database operations.</span></span> <span data-ttu-id="82322-107">Todos os backups são armazenados separadamente em outro serviço de armazenamento, e esses backups são replicados globalmente para resiliência contra desastres regionais.</span><span class="sxs-lookup"><span data-stu-id="82322-107">All your backups are stored separately in another storage service, and those backups are globally replicated for resiliency against regional disasters.</span></span> <span data-ttu-id="82322-108">Os backups automáticos são destinados a cenários em que você exclui acidentalmente seu contêiner do Cosmos DB e, mais tarde, precisa de uma solução de recuperação de desastre ou de dados.</span><span class="sxs-lookup"><span data-stu-id="82322-108">The automatic backups are intended for scenarios when you accidentally delete your Comos DB container and later require data recovery or a disaster recovery solution.</span></span>  

<span data-ttu-id="82322-109">Este artigo começa com uma recapitulação rápida da redundância e disponibilidade de dados no Cosmos DB e, em seguida, aborda os backups.</span><span class="sxs-lookup"><span data-stu-id="82322-109">This article starts with a quick recap of the data redundancy and availability in Cosmos DB, and then discusses backups.</span></span> 

## <a name="high-availability-with-cosmos-db---a-recap"></a><span data-ttu-id="82322-110">Alta disponibilidade com o Cosmos DB – recapitulação</span><span class="sxs-lookup"><span data-stu-id="82322-110">High availability with Cosmos DB - a recap</span></span>
<span data-ttu-id="82322-111">O Cosmos DB foi desenvolvido para ser [distribuído globalmente](distribute-data-globally.md) – ele permite que você dimensione a produtividade em várias regiões do Azure, juntamente com failover controlado por política e APIs transparentes de hospedagem múltipla.</span><span class="sxs-lookup"><span data-stu-id="82322-111">Cosmos DB is designed to be [globally distributed](distribute-data-globally.md) – it allows you to scale throughput across multiple Azure regions along with policy driven failover and transparent multi-homing APIs.</span></span> <span data-ttu-id="82322-112">Como um sistema de banco de dados que oferece [SLAs de disponibilidade de 99,99%](https://azure.microsoft.com/support/legal/sla/cosmos-db), todas as gravações no Cosmos DB são permanentemente confirmadas em discos locais por um quorum de réplicas em um data center local antes de serem confirmadas no cliente.</span><span class="sxs-lookup"><span data-stu-id="82322-112">As a database system offering [99.99% availability SLAs](https://azure.microsoft.com/support/legal/sla/cosmos-db), all the writes in Cosmos DB are durably committed to local disks by a quorum of replicas within a local data center before acknowledging to the client.</span></span> <span data-ttu-id="82322-113">Observe que a alta disponibilidade do Cosmos DB se baseia no armazenamento local e não depende de nenhuma tecnologia de armazenamento externo.</span><span class="sxs-lookup"><span data-stu-id="82322-113">Note that the high availability of Cosmos DB relies on local storage and does not depend on any external storage technologies.</span></span> <span data-ttu-id="82322-114">Além disso, se sua conta de banco de dados está associada a mais de uma região do Azure, suas gravações são replicadas em outras regiões também.</span><span class="sxs-lookup"><span data-stu-id="82322-114">Additionally, if your database account is associated with more than one Azure region, your writes are replicated across other regions as well.</span></span> <span data-ttu-id="82322-115">Para dimensionar seus dados de produtividade e acesso em latências menores, você pode ter quantas regiões de leitura associadas à sua conta de banco de dados quantas quiser.</span><span class="sxs-lookup"><span data-stu-id="82322-115">To scale your throughput and access data at low latencies, you can have as many read regions associated with your database account as you like.</span></span> <span data-ttu-id="82322-116">Em cada região de leitura, os dados (replicados) são persistidos em um conjunto de réplicas.</span><span class="sxs-lookup"><span data-stu-id="82322-116">In each read region, the (replicated) data is durably persisted across a replica set.</span></span>  

<span data-ttu-id="82322-117">Conforme ilustrado no diagrama a seguir, um único contêiner do Cosmos DB é [particionado horizontalmente](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="82322-117">As illustrated in the following diagram, a single Cosmos DB container is [horizontally partitioned](partition-data.md).</span></span> <span data-ttu-id="82322-118">Uma “partição” é indicada por um círculo no diagrama a seguir, e cada partição torna-se altamente disponível por meio de um conjunto de réplicas.</span><span class="sxs-lookup"><span data-stu-id="82322-118">A “partition” is denoted by a circle in the following diagram, and each partition is made highly available via a replica set.</span></span> <span data-ttu-id="82322-119">Essa é a distribuição local dentro de uma única região do Azure (indicada pelo eixo X).</span><span class="sxs-lookup"><span data-stu-id="82322-119">This is the local distribution within a single Azure region (denoted by the X axis).</span></span> <span data-ttu-id="82322-120">Além disso, cada partição (com seu conjunto de réplicas correspondente) é distribuída globalmente entre várias regiões associadas à sua conta de banco de dados (por exemplo, neste caso, três regiões: Leste dos EUA, Oeste dos EUA e Índia Central).</span><span class="sxs-lookup"><span data-stu-id="82322-120">Further, each partition (with its corresponding replica set) is then globally distributed across multiple regions associated with your database account (for example, in this illustration the three regions – East US, West US and Central India).</span></span> <span data-ttu-id="82322-121">O "conjunto de partição" é uma entidade distribuída globalmente que consiste em várias cópias de seus dados em cada região (indicado pelo eixo Y).</span><span class="sxs-lookup"><span data-stu-id="82322-121">The “partition set” is a globally distributed entity comprising of multiple copies of your data in each region (denoted by the Y axis).</span></span> <span data-ttu-id="82322-122">Você pode atribuir prioridade às regiões associadas à conta de banco de dados e o Cosmos DB fará failover de forma transparente para a próxima região em caso de desastre.</span><span class="sxs-lookup"><span data-stu-id="82322-122">You can assign priority to the regions associated with your database account and Cosmos DB will transparently failover to the next region in case of disaster.</span></span> <span data-ttu-id="82322-123">Você pode simular o failover manualmente para testar a disponibilidade de ponta a ponta de seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="82322-123">You can also manually simulate failover to test the end-to-end availability of your application.</span></span>  

<span data-ttu-id="82322-124">A imagem a seguir ilustra o alto grau de redundância com o Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="82322-124">The following image illustrates the high degree of redundancy with Cosmos DB.</span></span>

![Alto grau de redundância com o Cosmos DB](./media/online-backup-and-restore/redundancy.png)

![Alto grau de redundância com o Cosmos DB](./media/online-backup-and-restore/global-distribution.png)

## <a name="full-automatic-online-backups"></a><span data-ttu-id="82322-127">Backups online completos, automáticos</span><span class="sxs-lookup"><span data-stu-id="82322-127">Full, automatic, online backups</span></span>
<span data-ttu-id="82322-128">Opa, excluí meu contêiner ou banco de dados!</span><span class="sxs-lookup"><span data-stu-id="82322-128">Oops, I deleted my container or database!</span></span> <span data-ttu-id="82322-129">Com o Cosmos DB, não apenas os dados, mas também os backups dos dados ficam altamente redundantes e resilientes em desastres regionais.</span><span class="sxs-lookup"><span data-stu-id="82322-129">With Cosmos DB, not only your data, but the backups of your data are also made highly redundant and resilient to regional disasters.</span></span> <span data-ttu-id="82322-130">Esses backups automatizados são feitos atualmente a cada quatro horas, aproximadamente, e os últimos 2 backups são armazenados o tempo todo.</span><span class="sxs-lookup"><span data-stu-id="82322-130">These automated backups are currently taken approximately every four hours and latest 2 backups are stored at all times.</span></span> <span data-ttu-id="82322-131">Se os dados forem acidentalmente descartados ou estiverem corrompidos, [entre em contato com o suporte do Azure](https://azure.microsoft.com/support/options/) em até 8 horas.</span><span class="sxs-lookup"><span data-stu-id="82322-131">If the data is accidently dropped or corrupted, please [contact Azure support](https://azure.microsoft.com/support/options/) within 8 hours.</span></span> 

<span data-ttu-id="82322-132">Os backups são feitos sem afetar o desempenho ou a disponibilidade de suas operações de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="82322-132">The backups are taken without affecting the performance or availability of your database operations.</span></span> <span data-ttu-id="82322-133">O Cosmos DB faz o backup em segundo plano, sem consumir as RUs provisionadas nem afetar o desempenho e sem afetar a disponibilidade do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="82322-133">Cosmos DB takes the backup in the background without consuming your provisioned RUs or affecting the performance and without affecting the availability of your database.</span></span> 

<span data-ttu-id="82322-134">Ao contrário dos dados que são armazenados no Cosmos DB, os backups automáticos são armazenados no serviço Armazenamento de Blobs do Azure.</span><span class="sxs-lookup"><span data-stu-id="82322-134">Unlike your data that is stored inside Cosmos DB, the automatic backups are stored in Azure Blob Storage service.</span></span> <span data-ttu-id="82322-135">Para garantir um upload eficiente e a baixa latência, o instantâneo do backup é carregado em uma instância do Armazenamento de blobs do Azure na mesma região da região de gravação atual de sua conta de banco de dados do Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="82322-135">To guarantee the low latency/efficient upload, the snapshot of your backup is uploaded to an instance of Azure Blob storage in the same region as the current write region of your Cosmos DB database account.</span></span> <span data-ttu-id="82322-136">Para resiliência contra desastres regionais, cada instantâneo dos seus dados de backup no Armazenamento de Blobs do Azure é replicado novamente via GRS (armazenamento com redundância geográfica) para outra região.</span><span class="sxs-lookup"><span data-stu-id="82322-136">For resiliency against regional disaster, each snapshot of your backup data in Azure Blob Storage is again replicated via geo-redundant storage (GRS) to another region.</span></span> <span data-ttu-id="82322-137">O diagrama a seguir mostra que o contêiner inteiro do Cosmos DB (com todas as três partições primárias no Oeste dos EUA, neste exemplo) é copiado em backup para uma conta remota de Armazenamento de Blobs do Azure no Oeste dos EUA e, então, replicadas por GRS no Leste dos EUA.</span><span class="sxs-lookup"><span data-stu-id="82322-137">The following diagram shows that the entire Cosmos DB container (with all three primary partitions in West US, in this example) is backed up in a remote Azure Blob Storage account in West US and then GRS replicated to East US.</span></span> 

<span data-ttu-id="82322-138">A imagem a seguir ilustra os backups completos periódicos de todas as entidades do Cosmos DB no Armazenamento do Azure GRS.</span><span class="sxs-lookup"><span data-stu-id="82322-138">The following image illustrates periodic full backups of all Cosmos DB entities in GRS Azure Storage.</span></span>

![Backups completos periódicos de todas as entidades do Cosmos DB no Armazenamento do Azure GRS](./media/online-backup-and-restore/automatic-backup.png)

## <a name="backup-retention-period"></a><span data-ttu-id="82322-140">Período de retenção do backup</span><span class="sxs-lookup"><span data-stu-id="82322-140">Backup retention period</span></span>
<span data-ttu-id="82322-141">Conforme descrito acima, o Azure Cosmos DB usa instantâneos dos seus dados a cada quatro horas e retém os últimos dois instantâneos de cada partição por 30 dias.</span><span class="sxs-lookup"><span data-stu-id="82322-141">As described above, Azure Cosmos DB takes snapshots of your data every four hours and retains the last two snapshots of every partition for 30 days.</span></span> <span data-ttu-id="82322-142">De acordo com nossas regulamentações de conformidade, os instantâneos são limpos após 90 dias.</span><span class="sxs-lookup"><span data-stu-id="82322-142">Per our compliance regulations, snapshots are purged after 90 days.</span></span>

<span data-ttu-id="82322-143">Se você quiser manter seus próprios instantâneos, pode usar o opção Exportar para JSON na [ferramenta de Migração de Dados](import-data.md#export-to-json-file) do Azure Cosmos DB para agendar backups adicionais.</span><span class="sxs-lookup"><span data-stu-id="82322-143">If you want to maintain your own snapshots, you can use the export to JSON option in the Azure Cosmos DB [Data Migration tool](import-data.md#export-to-json-file) to schedule additional backups.</span></span> 

## <a name="restoring-a-database-from-an-online-backup"></a><span data-ttu-id="82322-144">Restauração de um banco de dados de um backup online</span><span class="sxs-lookup"><span data-stu-id="82322-144">Restoring a database from an online backup</span></span>
<span data-ttu-id="82322-145">Caso exclua seu banco de dados ou coleção acidentalmente, você pode [criar um tíquete de suporte](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) ou [ligar para o suporte do Azure](https://azure.microsoft.com/support/options/) a fim de restaurar os dados usando o último backup automático.</span><span class="sxs-lookup"><span data-stu-id="82322-145">If you accidentally delete your database or collection, you can [file a support ticket](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) or [call Azure support](https://azure.microsoft.com/support/options/) to restore the data from the last automatic backup.</span></span> <span data-ttu-id="82322-146">Se você precisar restaurar seu banco de dados devido a problema de corrupção de dados, veja [tratamento corrupção de dados](#handling-data-corruption) conforme necessário executar etapas adicionais para impedir que os dados corrompidos penetrem os backups.</span><span class="sxs-lookup"><span data-stu-id="82322-146">If you need to restore your database because of data corruption issue, see [Handling data corruption](#handling-data-corruption) as you need to take additional steps to prevent the corrupted data from penetrating the backups.</span></span> <span data-ttu-id="82322-147">Para que um instantâneo específico do backup seja restaurado, o Cosmos DB exige que os dados estejam disponíveis durante o ciclo de backup do instantâneo.</span><span class="sxs-lookup"><span data-stu-id="82322-147">For a specific snapshot of your backup to be restored, Cosmos DB requires that the data was available for the duration of the backup cycle for that snapshot.</span></span>

## <a name="handling-data-corruption"></a><span data-ttu-id="82322-148">Manipulação de dados corrompidos</span><span class="sxs-lookup"><span data-stu-id="82322-148">Handling data corruption</span></span>
<span data-ttu-id="82322-149">O Azure Cosmos DB retém os últimos dois backups de todas as partições no sistema.</span><span class="sxs-lookup"><span data-stu-id="82322-149">Azure Cosmos DB retains the last two backups of every partition in the system.</span></span> <span data-ttu-id="82322-150">Esse modelo funciona muito bem quando um contêiner (coleção de documentos, grafo, tabela) ou um banco de dados forem excluído acidentalmente desde que uma das últimas versões pode ser restaurada.</span><span class="sxs-lookup"><span data-stu-id="82322-150">This model works very well when a container (collection of documents, graph, table) or a database is accidentally deleted since one of the last versions can be restored.</span></span> <span data-ttu-id="82322-151">No entanto, no caso de quando os usuários podem apresentar um problema de corrupção de dados, o Azure Cosmos DB pode não estar ciente de que a corrupção de dados, e é possível que o dano pode entram os backups.</span><span class="sxs-lookup"><span data-stu-id="82322-151">However, in the case when when users may introduce a data corruption issue, Azure Cosmos DB may be unaware of the data corruption, and it is possible that the corruption may have penetrated the backups.</span></span> <span data-ttu-id="82322-152">Assim que estiver corrompido, você deve excluir o contêiner corrompido (coleção/grafo/tabela) para que os backups sejam protegidos sejam substituídos com dados corrompidos.</span><span class="sxs-lookup"><span data-stu-id="82322-152">As soon as corruption is detected, you should delete the corrupted container (collection/graph/table) so that backups are protected from being overwritten with corrupted data.</span></span> <span data-ttu-id="82322-153">Desde o último backup pode ser antiga de quatro horas, o usuário pode empregar [alterar feed](change-feed.md) para capturar e armazenar as últimas quatro horas vale a pena de dados antes de excluir o contêiner.</span><span class="sxs-lookup"><span data-stu-id="82322-153">Since the last backup could be four hours old, the user can employ [change feed](change-feed.md) to capture and store the last four hours worth of data before deleting the container.</span></span>

## <a name="next-steps"></a><span data-ttu-id="82322-154">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="82322-154">Next steps</span></span>

<span data-ttu-id="82322-155">Para replicar o banco de dados em vários data centers, consulte [Distribuir os dados globalmente com o Cosmos DB](distribute-data-globally.md).</span><span class="sxs-lookup"><span data-stu-id="82322-155">To replicate your database in multiple data centers, see [distribute your data globally with Cosmos DB](distribute-data-globally.md).</span></span> 

<span data-ttu-id="82322-156">Para entrar em contato com o Suporte do Azure, [crie um tíquete no portal do Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).</span><span class="sxs-lookup"><span data-stu-id="82322-156">To file contact Azure Support, [file a ticket from the Azure portal](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).</span></span>

