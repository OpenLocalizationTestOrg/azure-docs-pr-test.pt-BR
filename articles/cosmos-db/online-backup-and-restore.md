---
title: "aaaOnline backup e restauração com o banco de dados do Azure Cosmos | Microsoft Docs"
description: "Saiba como tooperform automático de backup e restauração em um banco de dados do banco de dados do Azure Cosmos."
keywords: "backup e restauração, backup online"
services: cosmos-db
documentationcenter: 
author: RahulPrasad16
manager: jhubbard
editor: monicar
ms.assetid: 98eade4a-7ef4-4667-b167-6603ecd80b79
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: multiple
ms.topic: article
ms.date: 08/11/2017
ms.author: raprasa
ms.openlocfilehash: a0b464c95681dfc7b5462b02bf04c2c43d6bc16f
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="automatic-online-backup-and-restore-with-azure-cosmos-db"></a><span data-ttu-id="44fc9-104">Backup e restauração online automáticos com o Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="44fc9-104">Automatic online backup and restore with Azure Cosmos DB</span></span>
<span data-ttu-id="44fc9-105">O Azure Cosmos DB faz backup automaticamente de todos os seus dados em intervalos regulares.</span><span class="sxs-lookup"><span data-stu-id="44fc9-105">Azure Cosmos DB automatically takes backups of all your data at regular intervals.</span></span> <span data-ttu-id="44fc9-106">backups automáticos de saudação são feitos sem afetar o desempenho de saudação ou disponibilidade de suas operações de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="44fc9-106">hello automatic backups are taken without affecting hello performance or availability of your database operations.</span></span> <span data-ttu-id="44fc9-107">Todos os backups são armazenados separadamente em outro serviço de armazenamento, e esses backups são replicados globalmente para resiliência contra desastres regionais.</span><span class="sxs-lookup"><span data-stu-id="44fc9-107">All your backups are stored separately in another storage service, and those backups are globally replicated for resiliency against regional disasters.</span></span> <span data-ttu-id="44fc9-108">backups automáticos Olá destinam-se para cenários quando você acidentalmente excluir o contêiner de banco de dados Comos e posteriores exige a recuperação de dados ou uma solução de recuperação de desastres.</span><span class="sxs-lookup"><span data-stu-id="44fc9-108">hello automatic backups are intended for scenarios when you accidentally delete your Comos DB container and later require data recovery or a disaster recovery solution.</span></span>  

<span data-ttu-id="44fc9-109">Este artigo começa com uma recapitulação rápida de redundância de dados hello e a disponibilidade de banco de dados do Cosmos e discute backups.</span><span class="sxs-lookup"><span data-stu-id="44fc9-109">This article starts with a quick recap of hello data redundancy and availability in Cosmos DB, and then discusses backups.</span></span> 

## <a name="high-availability-with-cosmos-db---a-recap"></a><span data-ttu-id="44fc9-110">Alta disponibilidade com o Cosmos DB – recapitulação</span><span class="sxs-lookup"><span data-stu-id="44fc9-110">High availability with Cosmos DB - a recap</span></span>
<span data-ttu-id="44fc9-111">Cosmos banco de dados é projetado toobe [globalmente distribuídos](distribute-data-globally.md) – permite a você tooscale taxa de transferência em várias regiões do Azure junto com a política controlada por failover e as APIs de hospedagem múltipla transparentes.</span><span class="sxs-lookup"><span data-stu-id="44fc9-111">Cosmos DB is designed toobe [globally distributed](distribute-data-globally.md) – it allows you tooscale throughput across multiple Azure regions along with policy driven failover and transparent multi-homing APIs.</span></span> <span data-ttu-id="44fc9-112">Como uma oferta de sistema de banco de dados [disponibilidade de 99,99% SLAs](https://azure.microsoft.com/support/legal/sla/cosmos-db), todas as gravações Olá no banco de dados do Cosmos são discos toolocal permanentemente confirmado por um quorum de réplicas dentro de um data center local antes de confirmar toohello cliente.</span><span class="sxs-lookup"><span data-stu-id="44fc9-112">As a database system offering [99.99% availability SLAs](https://azure.microsoft.com/support/legal/sla/cosmos-db), all hello writes in Cosmos DB are durably committed toolocal disks by a quorum of replicas within a local data center before acknowledging toohello client.</span></span> <span data-ttu-id="44fc9-113">Observe que a alta disponibilidade de saudação do Cosmos DB depende do armazenamento local e não depende de qualquer tecnologia de armazenamento externo.</span><span class="sxs-lookup"><span data-stu-id="44fc9-113">Note that hello high availability of Cosmos DB relies on local storage and does not depend on any external storage technologies.</span></span> <span data-ttu-id="44fc9-114">Além disso, se sua conta de banco de dados está associada a mais de uma região do Azure, suas gravações são replicadas em outras regiões também.</span><span class="sxs-lookup"><span data-stu-id="44fc9-114">Additionally, if your database account is associated with more than one Azure region, your writes are replicated across other regions as well.</span></span> <span data-ttu-id="44fc9-115">tooscale seus dados em latências de baixas taxa de transferência e acesso, você pode ter muitos ler regiões associados à sua conta de banco de dados como desejar.</span><span class="sxs-lookup"><span data-stu-id="44fc9-115">tooscale your throughput and access data at low latencies, you can have as many read regions associated with your database account as you like.</span></span> <span data-ttu-id="44fc9-116">Em cada região de leitura, dados saudação (replicada) forma durável são mantidos em um conjunto de réplicas.</span><span class="sxs-lookup"><span data-stu-id="44fc9-116">In each read region, hello (replicated) data is durably persisted across a replica set.</span></span>  

<span data-ttu-id="44fc9-117">Conforme ilustrado no diagrama a seguir de saudação, é um único contêiner de banco de dados do Cosmos [particionado horizontalmente](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="44fc9-117">As illustrated in hello following diagram, a single Cosmos DB container is [horizontally partitioned](partition-data.md).</span></span> <span data-ttu-id="44fc9-118">Uma partição"" é indicada por um círculo em Olá diagrama a seguir, e cada partição é feita altamente disponível por meio de um conjunto de réplicas.</span><span class="sxs-lookup"><span data-stu-id="44fc9-118">A “partition” is denoted by a circle in hello following diagram, and each partition is made highly available via a replica set.</span></span> <span data-ttu-id="44fc9-119">Isso é a distribuição local hello dentro de uma única região do Azure (indicada pelo eixo X de saudação).</span><span class="sxs-lookup"><span data-stu-id="44fc9-119">This is hello local distribution within a single Azure region (denoted by hello X axis).</span></span> <span data-ttu-id="44fc9-120">Além disso, cada partição (com seu conjunto de réplica correspondente) globalmente, em seguida, é distribuída entre várias regiões associados à sua conta de banco de dados (por exemplo, nesta ilustração Olá três regiões – Leste dos EUA, oeste dos EUA e Índia Central).</span><span class="sxs-lookup"><span data-stu-id="44fc9-120">Further, each partition (with its corresponding replica set) is then globally distributed across multiple regions associated with your database account (for example, in this illustration hello three regions – East US, West US and Central India).</span></span> <span data-ttu-id="44fc9-121">Olá "conjunto de partições" é distribuída globalmente entidade que consiste de várias cópias de seus dados em cada região (indicado pelo eixo Y da saudação).</span><span class="sxs-lookup"><span data-stu-id="44fc9-121">hello “partition set” is a globally distributed entity comprising of multiple copies of your data in each region (denoted by hello Y axis).</span></span> <span data-ttu-id="44fc9-122">Você pode atribuir prioridade regiões toohello associados à sua conta de banco de dados e banco de dados do Cosmos será transparente failover toohello próxima área em caso de desastre.</span><span class="sxs-lookup"><span data-stu-id="44fc9-122">You can assign priority toohello regions associated with your database account and Cosmos DB will transparently failover toohello next region in case of disaster.</span></span> <span data-ttu-id="44fc9-123">Manualmente, você pode simular disponibilidade de ponta a ponta do failover tootest saudação do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="44fc9-123">You can also manually simulate failover tootest hello end-to-end availability of your application.</span></span>  

<span data-ttu-id="44fc9-124">Olá imagem a seguir ilustra alto grau de saudação de redundância de banco de dados do Cosmos.</span><span class="sxs-lookup"><span data-stu-id="44fc9-124">hello following image illustrates hello high degree of redundancy with Cosmos DB.</span></span>

![Alto grau de redundância com o Cosmos DB](./media/online-backup-and-restore/redundancy.png)

![Alto grau de redundância com o Cosmos DB](./media/online-backup-and-restore/global-distribution.png)

## <a name="full-automatic-online-backups"></a><span data-ttu-id="44fc9-127">Backups online completos, automáticos</span><span class="sxs-lookup"><span data-stu-id="44fc9-127">Full, automatic, online backups</span></span>
<span data-ttu-id="44fc9-128">Opa, excluí meu contêiner ou banco de dados!</span><span class="sxs-lookup"><span data-stu-id="44fc9-128">Oops, I deleted my container or database!</span></span> <span data-ttu-id="44fc9-129">Com o banco de dados do Cosmos, não apenas a dados, mas backups Olá dos seus dados também são feitas desastres tooregional altamente resiliente e redundantes.</span><span class="sxs-lookup"><span data-stu-id="44fc9-129">With Cosmos DB, not only your data, but hello backups of your data are also made highly redundant and resilient tooregional disasters.</span></span> <span data-ttu-id="44fc9-130">Esses backups automatizados são feitos atualmente a cada quatro horas, aproximadamente, e os últimos 2 backups são armazenados o tempo todo.</span><span class="sxs-lookup"><span data-stu-id="44fc9-130">These automated backups are currently taken approximately every four hours and latest 2 backups are stored at all times.</span></span> <span data-ttu-id="44fc9-131">Se os dados de saudação acidentalmente descartado ou corrompido [entre em contato com o suporte do Azure](https://azure.microsoft.com/support/options/) dentro de 8 horas.</span><span class="sxs-lookup"><span data-stu-id="44fc9-131">If hello data is accidently dropped or corrupted, please [contact Azure support](https://azure.microsoft.com/support/options/) within 8 hours.</span></span> 

<span data-ttu-id="44fc9-132">Olá backups são feitos sem afetar o desempenho de saudação ou disponibilidade de suas operações de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="44fc9-132">hello backups are taken without affecting hello performance or availability of your database operations.</span></span> <span data-ttu-id="44fc9-133">Cosmos banco de dados faz backup de saudação no plano de fundo de saudação sem consumindo os RUs provisionados ou afetar o desempenho da saudação e sem afetar a disponibilidade de saudação do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="44fc9-133">Cosmos DB takes hello backup in hello background without consuming your provisioned RUs or affecting hello performance and without affecting hello availability of your database.</span></span> 

<span data-ttu-id="44fc9-134">Ao contrário de seus dados são armazenados no banco de dados do Cosmos, backups automáticos Olá são armazenados no serviço de armazenamento de BLOBs do Azure.</span><span class="sxs-lookup"><span data-stu-id="44fc9-134">Unlike your data that is stored inside Cosmos DB, hello automatic backups are stored in Azure Blob Storage service.</span></span> <span data-ttu-id="44fc9-135">carregamento de latência baixa/eficiente de saudação tooguarantee, instantâneo de saudação do backup é instância tooan carregados do armazenamento de BLOBs do Azure em Olá mesma região que a região de gravação atual Olá da sua conta de banco de dados do banco de dados do Cosmos.</span><span class="sxs-lookup"><span data-stu-id="44fc9-135">tooguarantee hello low latency/efficient upload, hello snapshot of your backup is uploaded tooan instance of Azure Blob storage in hello same region as hello current write region of your Cosmos DB database account.</span></span> <span data-ttu-id="44fc9-136">Para garantir a resiliência contra desastres regionais, cada instantâneo de seus dados de backup no armazenamento de BLOBs do Azure é replicado novamente por meio de região de tooanother de armazenamento com redundância geográfica (GRS).</span><span class="sxs-lookup"><span data-stu-id="44fc9-136">For resiliency against regional disaster, each snapshot of your backup data in Azure Blob Storage is again replicated via geo-redundant storage (GRS) tooanother region.</span></span> <span data-ttu-id="44fc9-137">Olá diagrama a seguir mostra que todo banco de dados do Cosmos contêiner hello (com todas as três partições primárias no Oeste dos EUA, neste exemplo) é feito em uma conta de armazenamento de BLOBs do Azure remota no Oeste dos EUA e, em seguida, GRS replicados tooEast nós.</span><span class="sxs-lookup"><span data-stu-id="44fc9-137">hello following diagram shows that hello entire Cosmos DB container (with all three primary partitions in West US, in this example) is backed up in a remote Azure Blob Storage account in West US and then GRS replicated tooEast US.</span></span> 

<span data-ttu-id="44fc9-138">Olá imagem a seguir ilustra a backups completos periódicos de todas as entidades de banco de dados do Cosmos no armazenamento do Azure GRS.</span><span class="sxs-lookup"><span data-stu-id="44fc9-138">hello following image illustrates periodic full backups of all Cosmos DB entities in GRS Azure Storage.</span></span>

![Backups completos periódicos de todas as entidades do Cosmos DB no Armazenamento do Azure GRS](./media/online-backup-and-restore/automatic-backup.png)

## <a name="backup-retention-period"></a><span data-ttu-id="44fc9-140">Período de retenção do backup</span><span class="sxs-lookup"><span data-stu-id="44fc9-140">Backup retention period</span></span>
<span data-ttu-id="44fc9-141">Conforme descrito acima, o banco de dados do Azure Cosmos usa instantâneos dos seus dados a cada quatro horas e retém os últimos dois instantâneos Olá de todas as partições por 30 dias.</span><span class="sxs-lookup"><span data-stu-id="44fc9-141">As described above, Azure Cosmos DB takes snapshots of your data every four hours and retains hello last two snapshots of every partition for 30 days.</span></span> <span data-ttu-id="44fc9-142">De acordo com nossas regulamentações de conformidade, os instantâneos são limpos após 90 dias.</span><span class="sxs-lookup"><span data-stu-id="44fc9-142">Per our compliance regulations, snapshots are purged after 90 days.</span></span>

<span data-ttu-id="44fc9-143">Se você quiser toomaintain seus próprios instantâneos, você pode usar tooJSON opção de exportação de saudação em hello Azure Cosmos DB [ferramenta de migração de dados](import-data.md#export-to-json-file) tooschedule outros backups.</span><span class="sxs-lookup"><span data-stu-id="44fc9-143">If you want toomaintain your own snapshots, you can use hello export tooJSON option in hello Azure Cosmos DB [Data Migration tool](import-data.md#export-to-json-file) tooschedule additional backups.</span></span> 

## <a name="restoring-a-database-from-an-online-backup"></a><span data-ttu-id="44fc9-144">Restauração de um banco de dados de um backup online</span><span class="sxs-lookup"><span data-stu-id="44fc9-144">Restoring a database from an online backup</span></span>
<span data-ttu-id="44fc9-145">Se você acidentalmente excluir seu banco de dados ou uma coleção, você pode [um tíquete de suporte de arquivo](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) ou [ligar para o suporte do Azure](https://azure.microsoft.com/support/options/) toorestore dados de saudação do último backup automático de saudação.</span><span class="sxs-lookup"><span data-stu-id="44fc9-145">If you accidentally delete your database or collection, you can [file a support ticket](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) or [call Azure support](https://azure.microsoft.com/support/options/) toorestore hello data from hello last automatic backup.</span></span> <span data-ttu-id="44fc9-146">Se você precisar toorestore seu banco de dados devido a problema de corrupção de dados, consulte [tratamento corrupção de dados](#handling-data-corruption) precisar tootake adicional etapas tooprevent Olá corrompido dados de backups de penetração hello.</span><span class="sxs-lookup"><span data-stu-id="44fc9-146">If you need toorestore your database because of data corruption issue, see [Handling data corruption](#handling-data-corruption) as you need tootake additional steps tooprevent hello corrupted data from penetrating hello backups.</span></span> <span data-ttu-id="44fc9-147">Para obter um instantâneo específico do seu toobe backup restaurado, Cosmos DB requer dados saudação estavam disponíveis para a duração de saudação do ciclo de backup Olá para esse instantâneo.</span><span class="sxs-lookup"><span data-stu-id="44fc9-147">For a specific snapshot of your backup toobe restored, Cosmos DB requires that hello data was available for hello duration of hello backup cycle for that snapshot.</span></span>

## <a name="handling-data-corruption"></a><span data-ttu-id="44fc9-148">Manipulação de dados corrompidos</span><span class="sxs-lookup"><span data-stu-id="44fc9-148">Handling data corruption</span></span>
<span data-ttu-id="44fc9-149">Banco de dados do Azure Cosmos retém backups de dois últimos de saudação de todas as partições no sistema de saudação.</span><span class="sxs-lookup"><span data-stu-id="44fc9-149">Azure Cosmos DB retains hello last two backups of every partition in hello system.</span></span> <span data-ttu-id="44fc9-150">Esse modelo funciona muito bem quando um contêiner (coleção de documentos, gráfico, tabela) ou um banco de dados forem excluído acidentalmente desde que uma das versões do último Olá pode ser restaurada.</span><span class="sxs-lookup"><span data-stu-id="44fc9-150">This model works very well when a container (collection of documents, graph, table) or a database is accidentally deleted since one of hello last versions can be restored.</span></span> <span data-ttu-id="44fc9-151">No entanto, em hello quando quando os usuários podem apresentar um problema de corrupção de dados, o banco de dados do Azure Cosmos pode não estar ciente Olá corrupção de dados, e é possível que o hello corrupção pode entram backups hello.</span><span class="sxs-lookup"><span data-stu-id="44fc9-151">However, in hello case when when users may introduce a data corruption issue, Azure Cosmos DB may be unaware of hello data corruption, and it is possible that hello corruption may have penetrated hello backups.</span></span> <span data-ttu-id="44fc9-152">Assim que estiver corrompido, você deve excluir o contêiner Olá corrompido (coleção/gráfico/tabela) para que os backups sejam protegidos sejam substituídos com dados corrompidos.</span><span class="sxs-lookup"><span data-stu-id="44fc9-152">As soon as corruption is detected, you should delete hello corrupted container (collection/graph/table) so that backups are protected from being overwritten with corrupted data.</span></span> <span data-ttu-id="44fc9-153">Desde o último backup de saudação pode ser antiga de quatro horas, o usuário Olá pode empregar [alterar feed](change-feed.md) toocapture e repositório Olá últimas quatro horas vale a pena de dados antes de excluir o contêiner de saudação.</span><span class="sxs-lookup"><span data-stu-id="44fc9-153">Since hello last backup could be four hours old, hello user can employ [change feed](change-feed.md) toocapture and store hello last four hours worth of data before deleting hello container.</span></span>

## <a name="next-steps"></a><span data-ttu-id="44fc9-154">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="44fc9-154">Next steps</span></span>

<span data-ttu-id="44fc9-155">tooreplicate seu banco de dados em vários data centers, consulte [distribuir os dados global com o banco de dados do Cosmos](distribute-data-globally.md).</span><span class="sxs-lookup"><span data-stu-id="44fc9-155">tooreplicate your database in multiple data centers, see [distribute your data globally with Cosmos DB](distribute-data-globally.md).</span></span> 

<span data-ttu-id="44fc9-156">toofile entre em contato com o suporte do Azure, [emitir um ticket de saudação do portal Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).</span><span class="sxs-lookup"><span data-stu-id="44fc9-156">toofile contact Azure Support, [file a ticket from hello Azure portal](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).</span></span>

