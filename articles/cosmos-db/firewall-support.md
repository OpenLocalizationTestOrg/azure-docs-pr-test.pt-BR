---
title: Controle de acesso IP e suporte ao firewall do Azure Cosmos DB | Microsoft Docs
description: "Saiba como usar políticas de controle de acesso de IP para suporte ao firewall em contas de banco de dados do Azure Cosmos DB."
keywords: Controle de acesso de IP, suporte ao firewall
services: cosmos-db
author: shahankur11
manager: jhubbard
editor: 
tags: azure-resource-manager
documentationcenter: 
ms.assetid: c1b9ede0-ed93-411a-ac9a-62c113a8e887
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/22/2017
ms.author: ankshah
ms.openlocfilehash: e08c0ba9c1fc0bab72ae8c1158aafaad4f66920e
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="azure-cosmos-db-firewall-support"></a><span data-ttu-id="104fa-104">Suporte ao firewall do Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="104fa-104">Azure Cosmos DB firewall support</span></span>
<span data-ttu-id="104fa-105">Para proteger os dados armazenados em uma conta de banco de dados do Azure Cosmos DB, o Azure Cosmos DB forneceu suporte para um [modelo de autorização](https://msdn.microsoft.com/library/azure/dn783368.aspx) baseado em segredo que utiliza um HMAC (código de autenticação de mensagem baseado em hash) forte.</span><span class="sxs-lookup"><span data-stu-id="104fa-105">To secure data stored in an Azure Cosmos DB database account, Azure Cosmos DB has provided support for a secret based [authorization model](https://msdn.microsoft.com/library/azure/dn783368.aspx) that utilizes a strong Hash-based message authentication code (HMAC).</span></span> <span data-ttu-id="104fa-106">Agora, além do modelo de autorização baseado em segredo, o Azure Cosmos DB dá suporte a controles de acesso baseados em IP controlados por política para suporte ao firewall de entrada.</span><span class="sxs-lookup"><span data-stu-id="104fa-106">Now, in addition to the secret based authorization model, Azure Cosmos DB supports policy driven IP-based access controls for inbound firewall support.</span></span> <span data-ttu-id="104fa-107">Esse modelo é muito semelhante às regras de firewall de um sistema de banco de dados tradicional e fornece um nível adicional de segurança à conta de banco de dados do Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="104fa-107">This model is very similar to the firewall rules of a traditional database system and provides an additional level of security to the Azure Cosmos DB database account.</span></span> <span data-ttu-id="104fa-108">Com esse modelo, agora você pode configurar uma conta de banco de dados do Azure Cosmos DB para que ela possa ser acessada somente em um conjunto aprovado de computadores e/ou serviços de nuvem.</span><span class="sxs-lookup"><span data-stu-id="104fa-108">With this model, you can now configure an Azure Cosmos DB database account to be accessible only from an approved set of machines and/or cloud services.</span></span> <span data-ttu-id="104fa-109">O acesso aos recursos do Azure Cosmos DB nesses conjuntos aprovados de computadores e serviços ainda exige que o chamador apresente um token de autorização válido.</span><span class="sxs-lookup"><span data-stu-id="104fa-109">Access to Azure Cosmos DB resources from these approved sets of machines and services still require the caller to present a valid authorization token.</span></span>

## <a name="ip-access-control-overview"></a><span data-ttu-id="104fa-110">Visão geral do controle de acesso de IP</span><span class="sxs-lookup"><span data-stu-id="104fa-110">IP access control overview</span></span>
<span data-ttu-id="104fa-111">Por padrão, uma conta de banco de dados do Azure Cosmos DB é acessível pela Internet pública, desde que a solicitação venha acompanhada por um token de autorização válido.</span><span class="sxs-lookup"><span data-stu-id="104fa-111">By default, an Azure Cosmos DB database account is accessible from public internet as long as the request is accompanied by a valid authorization token.</span></span> <span data-ttu-id="104fa-112">Para configurar o controle de acesso baseado em política IP, o usuário deve fornecer o conjunto de endereços IP, ou intervalos de endereços IP, no formato CIDR a serem incluídos como a lista de permissões de IPs de clientes para uma conta de banco de dados especificada.</span><span class="sxs-lookup"><span data-stu-id="104fa-112">To configure IP policy-based access control, the user must provide the set of IP addresses or IP address ranges in CIDR form to be included as the allowed list of client IPs for a given database account.</span></span> <span data-ttu-id="104fa-113">Quando essa configuração é aplicada, todas as solicitações provenientes de computadores fora dessa lista de permissão serão bloqueados pelo servidor.</span><span class="sxs-lookup"><span data-stu-id="104fa-113">Once this configuration is applied, all requests originating from machines outside this allowed list will be blocked by the server.</span></span>  <span data-ttu-id="104fa-114">O fluxo de processamento de conexão para o controle de acesso baseado em IP está descrito no diagrama a seguir.</span><span class="sxs-lookup"><span data-stu-id="104fa-114">The connection processing flow for the IP-based access control is described in the following diagram.</span></span>

![Diagrama mostrando o processo de conexão para controle de acesso baseado em IP](./media/firewall-support/firewall-support-flow.png)

## <a name="connections-from-cloud-services"></a><span data-ttu-id="104fa-116">Conexões dos serviços de nuvem</span><span class="sxs-lookup"><span data-stu-id="104fa-116">Connections from cloud services</span></span>
<span data-ttu-id="104fa-117">No Azure, os serviços de nuvem são uma maneira muito comum de hospedar a lógica do serviço de camada intermediária usando o Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="104fa-117">In Azure, cloud services are a very common way for hosting middle tier service logic using Azure Cosmos DB.</span></span> <span data-ttu-id="104fa-118">Para habilitar o acesso a uma conta de banco de dados do Azure Cosmos DB em um serviço de nuvem, o endereço IP público do serviço de nuvem deve ser adicionado à lista de permissões de endereços IP associados à sua conta de banco de dados do Azure Cosmos DB com a [configuração da política de controle de acesso de IP](#configure-ip-policy).</span><span class="sxs-lookup"><span data-stu-id="104fa-118">To enable access to an Azure Cosmos DB database account from a cloud service, the public IP address of the cloud service must be added to the allowed list of IP addresses associated with your Azure Cosmos DB database account by [configuring the IP access control policy](#configure-ip-policy).</span></span>  <span data-ttu-id="104fa-119">Isso garante que todas as instâncias de função dos serviços de nuvem têm acesso à sua conta de banco de dados do Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="104fa-119">This ensures that all role instances of cloud services have access to your Azure Cosmos DB database account.</span></span> <span data-ttu-id="104fa-120">Você pode recuperar endereços IP de seus serviços de nuvem no Portal do Azure, conforme mostra a captura de tela a seguir.</span><span class="sxs-lookup"><span data-stu-id="104fa-120">You can retrieve IP addresses for your cloud services in the Azure portal, as shown in the following screenshot.</span></span>

![Captura de tela mostrando o endereço IP público de um serviço de nuvem exibido no Portal do Azure](./media/firewall-support/public-ip-addresses.png)

<span data-ttu-id="104fa-122">Quando você escala horizontalmente seu serviço de nuvem adicionando outras instâncias de função, essas novas instâncias terão acesso automaticamente à conta de banco de dados do Azure Cosmos DB, desde que façam parte do mesmo serviço de nuvem.</span><span class="sxs-lookup"><span data-stu-id="104fa-122">When you scale out your cloud service by adding additional role instance(s), those new instances will automatically have access to the Azure Cosmos DB database account since they are part of the same cloud service.</span></span>

## <a name="connections-from-virtual-machines"></a><span data-ttu-id="104fa-123">Conexões de máquinas virtuais</span><span class="sxs-lookup"><span data-stu-id="104fa-123">Connections from virtual machines</span></span>
<span data-ttu-id="104fa-124">[Máquinas virtuais](https://azure.microsoft.com/services/virtual-machines/) ou [conjuntos de dimensionamento de máquinas virtuais](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md) também podem ser usados para hospedar serviços de camada intermediária usando o Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="104fa-124">[Virtual machines](https://azure.microsoft.com/services/virtual-machines/) or [virtual machine scale sets](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md) can also be used to host middle tier services using Azure Cosmos DB.</span></span>  <span data-ttu-id="104fa-125">Para configurar a conta de banco de dados do Azure Cosmos DB para permitir o acesso em máquinas virtuais, endereços IP públicos da máquina virtual e/ou conjuntos de dimensionamento de máquinas virtuais devem ser configurados como um dos endereços IP permitidos da conta de banco de dados do Azure Cosmos DB com a [configuração da política de controle de acesso de IP](#configure-ip-policy).</span><span class="sxs-lookup"><span data-stu-id="104fa-125">To configure the Azure Cosmos DB database account to allow access from virtual machines, public IP addresses of virtual machine and/or virtual machine scale set must be configured as one of the allowed IP addresses for your Azure Cosmos DB database account by [configuring the IP access control policy](#configure-ip-policy).</span></span> <span data-ttu-id="104fa-126">Você pode recuperar endereços IP de máquinas virtuais no Portal do Azure, conforme mostra a captura de tela a seguir.</span><span class="sxs-lookup"><span data-stu-id="104fa-126">You can retrieve IP addresses for virtual machines in the Azure portal, as shown in the following screenshot.</span></span>

![Captura de tela mostrando o endereço IP público de uma máquina virtual exibida no Portal do Azure](./media/firewall-support/public-ip-addresses-dns.png)

<span data-ttu-id="104fa-128">Quando você adiciona outras instâncias de máquina virtual ao grupo, elas recebem automaticamente o acesso à sua conta de banco de dados do Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="104fa-128">When you add additional virtual machine instances to the group, they are automatically provided access to your Azure Cosmos DB database account.</span></span>

## <a name="connections-from-the-internet"></a><span data-ttu-id="104fa-129">Conexões pela Internet</span><span class="sxs-lookup"><span data-stu-id="104fa-129">Connections from the internet</span></span>
<span data-ttu-id="104fa-130">Quando você acessa uma conta de banco de dados do Azure Cosmos DB em um computador na Internet, o endereço IP do cliente ou o intervalo de endereços IP do computador deve ser adicionado à lista de permissões de endereços IP da conta de banco de dados do Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="104fa-130">When you access an Azure Cosmos DB database account from a computer on the internet, the client IP address or IP address range of the machine must be added to the allowed list of IP address for the Azure Cosmos DB database account.</span></span> 

## <span data-ttu-id="104fa-131"><a id="configure-ip-policy"></a> Configuração da política de controle de acesso de IP</span><span class="sxs-lookup"><span data-stu-id="104fa-131"><a id="configure-ip-policy"></a> Configuring the IP access control policy</span></span>
<span data-ttu-id="104fa-132">A política de controle de acesso por IP pode ser definida no Portal do Azure ou programaticamente na [CLI do Azure](cli-samples.md), no [Azure PowerShell](powershell-samples.md) ou na [API REST](/rest/api/documentdb/) atualizando a propriedade `ipRangeFilter`.</span><span class="sxs-lookup"><span data-stu-id="104fa-132">The IP access control policy can be set in the Azure portal, or programmatically through [Azure CLI](cli-samples.md), [Azure Powershell](powershell-samples.md), or the [REST API](/rest/api/documentdb/) by updating the `ipRangeFilter` property.</span></span> <span data-ttu-id="104fa-133">Os intervalos/endereços IP devem ser separados por vírgula e não devem conter espaços.</span><span class="sxs-lookup"><span data-stu-id="104fa-133">IP addresses/ranges must be comma separated and must not contain any spaces.</span></span> <span data-ttu-id="104fa-134">Exemplo: "13.91.6.132,13.91.6.1/24".</span><span class="sxs-lookup"><span data-stu-id="104fa-134">Example: "13.91.6.132,13.91.6.1/24".</span></span> <span data-ttu-id="104fa-135">Ao atualizar sua conta do banco de dados por meio desses métodos, preencha todas as propriedades para evitar a restauração para as configurações padrão.</span><span class="sxs-lookup"><span data-stu-id="104fa-135">When updating your database account through these methods, be sure to populate all of the properties to prevent resetting to default settings.</span></span>

> [!NOTE]
> <span data-ttu-id="104fa-136">Ao habilitar uma política de controle de acesso de IP para sua conta de banco de dados do Azure Cosmos DB, todo o acesso à conta de banco de dados do Azure Cosmos DB proveniente de computadores fora da lista de permissões configurada de intervalos de endereços IP é bloqueado.</span><span class="sxs-lookup"><span data-stu-id="104fa-136">By enabling an IP access control policy for your Azure Cosmos DB database account, all access to your Azure Cosmos DB database account from machines outside the configured allowed list of IP address ranges are blocked.</span></span> <span data-ttu-id="104fa-137">Em virtude nesse modelo, a pesquisa da operação do plano de dados a partir do portal também será bloqueada para garantir a integridade do controle de acesso.</span><span class="sxs-lookup"><span data-stu-id="104fa-137">By virtue of this model, browsing the data plane operation from the portal will also be blocked to ensure the integrity of access control.</span></span>

<span data-ttu-id="104fa-138">Para simplificar o desenvolvimento, o portal do Azure ajuda você a identificar e adicionar o IP de seu computador cliente à lista de permissões, de forma que os aplicativos em execução no computador possam acessar a conta do Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="104fa-138">To simplify development, the Azure portal helps you identify and add the IP of your client machine to the allowed list, so that apps running your machine can access the Azure Cosmos DB account.</span></span> <span data-ttu-id="104fa-139">Observe que o endereço IP cliente aqui é detectado como visto pelo portal.</span><span class="sxs-lookup"><span data-stu-id="104fa-139">Note that the client IP address here is detected as seen by the portal.</span></span> <span data-ttu-id="104fa-140">Pode ser o endereço IP cliente de seu computador, mas também pode ser o endereço IP de seu gateway de rede.</span><span class="sxs-lookup"><span data-stu-id="104fa-140">It may be the client IP address of your machine, but it could also be the IP address of your network gateway.</span></span> <span data-ttu-id="104fa-141">Não se esqueça de removê-lo antes de passar para produção.</span><span class="sxs-lookup"><span data-stu-id="104fa-141">Do not forget to remove it before going to production.</span></span>

<span data-ttu-id="104fa-142">Para definir a política de controle de acesso de IP no portal do Azure, navegue para a folha da conta do Azure Cosmos DB, clique em **Firewall** no menu de navegação e, depois, em **ATIVADO**</span><span class="sxs-lookup"><span data-stu-id="104fa-142">To set the IP access control policy in the Azure portal, navigate to the Azure Cosmos DB account blade, click **Firewall** in the navigation menu, then click **ON**</span></span> 

![Captura de tela mostrando como abrir a folha do Firewall no Portal do Azure](./media/firewall-support/azure-portal-firewall.png)

<span data-ttu-id="104fa-144">No novo painel, especifique se o Portal do Azure pode acessar a conta e adicione outros endereços e intervalos conforme for apropriado, depois clique em **Salvar**.</span><span class="sxs-lookup"><span data-stu-id="104fa-144">In the new pane, specify whether the Azure portal can access the account, and add other addresses and ranges as appropriate, then click **Save**.</span></span>  

> [!NOTE]
> <span data-ttu-id="104fa-145">Quando você habilita uma política de controle de acesso IP, você precisa adicionar o endereço IP do Portal do Azure para manter o acesso.</span><span class="sxs-lookup"><span data-stu-id="104fa-145">When you enable an IP access control policy, you need to add the IP address for the Azure portal to maintain access.</span></span> <span data-ttu-id="104fa-146">Os endereços IP do portal são:</span><span class="sxs-lookup"><span data-stu-id="104fa-146">The portal IP addresses are:</span></span>
> |<span data-ttu-id="104fa-147">Região</span><span class="sxs-lookup"><span data-stu-id="104fa-147">Region</span></span>|<span data-ttu-id="104fa-148">Endereço IP</span><span class="sxs-lookup"><span data-stu-id="104fa-148">IP address</span></span>|
> |------|----------|
> |<span data-ttu-id="104fa-149">Todas as regiões, exceto aquelas especificadas abaixo</span><span class="sxs-lookup"><span data-stu-id="104fa-149">All regions except those specified below</span></span>| <span data-ttu-id="104fa-150">104.42.195.92</span><span class="sxs-lookup"><span data-stu-id="104fa-150">104.42.195.92</span></span>|
> |<span data-ttu-id="104fa-151">Alemanha</span><span class="sxs-lookup"><span data-stu-id="104fa-151">Germany</span></span>|<span data-ttu-id="104fa-152">51.4.229.218</span><span class="sxs-lookup"><span data-stu-id="104fa-152">51.4.229.218</span></span>|
> |<span data-ttu-id="104fa-153">China</span><span class="sxs-lookup"><span data-stu-id="104fa-153">China</span></span>|<span data-ttu-id="104fa-154">139.217.8.252</span><span class="sxs-lookup"><span data-stu-id="104fa-154">139.217.8.252</span></span>|
> |<span data-ttu-id="104fa-155">Governo dos EUA do Arizona</span><span class="sxs-lookup"><span data-stu-id="104fa-155">US Gov Arizona</span></span>|<span data-ttu-id="104fa-156">52.244.48.71</span><span class="sxs-lookup"><span data-stu-id="104fa-156">52.244.48.71</span></span>|
>

![Captura de tela mostrando como definir as configurações de firewall no Portal do Azure](./media/firewall-support/azure-portal-firewall-configure.png)

## <a name="troubleshooting-the-ip-access-control-policy"></a><span data-ttu-id="104fa-158">Solução de problemas da política de controle de acesso de IP</span><span class="sxs-lookup"><span data-stu-id="104fa-158">Troubleshooting the IP access control policy</span></span>
### <a name="portal-operations"></a><span data-ttu-id="104fa-159">Operações no Portal</span><span class="sxs-lookup"><span data-stu-id="104fa-159">Portal operations</span></span>
<span data-ttu-id="104fa-160">Ao habilitar uma política de controle de acesso de IP para sua conta de banco de dados do Azure Cosmos DB, todo o acesso à conta de banco de dados do Azure Cosmos DB proveniente de computadores fora da lista de permissões configurada de intervalos de endereços IP é bloqueado.</span><span class="sxs-lookup"><span data-stu-id="104fa-160">By enabling an IP access control policy for your Azure Cosmos DB database account, all access to your Azure Cosmos DB database account from machines outside the configured allowed list of IP address ranges are blocked.</span></span> <span data-ttu-id="104fa-161">Portanto se você quiser habilitar operações no plano de dados do portal, como navegar por coleções e consultar documentos, permita explicitamente o acesso ao Portal do Azure usando a folha **Firewall** no portal.</span><span class="sxs-lookup"><span data-stu-id="104fa-161">Therefore if you want to enable portal data plane operations like browsing collections and query documents, you need to explicitly allow Azure portal access using the **Firewall** blade in the portal.</span></span> 

![Captura de tela mostrando como habilitar o acesso ao Portal do Azure](./media/firewall-support/azure-portal-access-firewall.png)

### <a name="sdk--rest-api"></a><span data-ttu-id="104fa-163">SDK e API Rest</span><span class="sxs-lookup"><span data-stu-id="104fa-163">SDK & Rest API</span></span>
<span data-ttu-id="104fa-164">Por motivos de segurança, o acesso via SDK ou API REST proveniente de máquinas que não estão na lista de permissão retornará um resposta genérica 404 Não Encontrado sem detalhes adicionais.</span><span class="sxs-lookup"><span data-stu-id="104fa-164">For security reasons, access via SDK or REST API from machines not on the allowed list will return a generic 404 Not Found response with no additional details.</span></span> <span data-ttu-id="104fa-165">Verifique a lista de IPs permitidos configurada para a conta de banco de dados do Azure Cosmos DB para garantir que a configuração de política correta é aplicada à sua conta de banco de dados do Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="104fa-165">Please verify the IP allowed list configured for your Azure Cosmos DB database account to ensure the correct policy configuration is applied to your Azure Cosmos DB database account.</span></span>

## <a name="next-steps"></a><span data-ttu-id="104fa-166">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="104fa-166">Next steps</span></span>
<span data-ttu-id="104fa-167">Para obter informações sobre dicas de desempenho relacionadas à rede, consulte [Dicas de desempenho](performance-tips.md).</span><span class="sxs-lookup"><span data-stu-id="104fa-167">For information about network related performance tips, see [Performance tips](performance-tips.md).</span></span>

