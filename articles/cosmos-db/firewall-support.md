---
title: controle de acesso de suporte ao firewall de banco de dados do Cosmos aaaAzure & IP | Microsoft Docs
description: "Saiba como suportam a políticas de controle de acesso toouse IP para o firewall em contas de banco de dados do banco de dados do Azure Cosmos."
keywords: Controle de acesso de IP, suporte ao firewall
services: cosmos-db
author: shahankur11
manager: jhubbard
editor: 
tags: azure-resource-manager
documentationcenter: 
ms.assetid: c1b9ede0-ed93-411a-ac9a-62c113a8e887
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/22/2017
ms.author: ankshah
ms.openlocfilehash: b5cdbdb28e9d7ee0fd0ea54aad277167b699929f
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="azure-cosmos-db-firewall-support"></a><span data-ttu-id="4e26b-104">Suporte ao firewall do Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="4e26b-104">Azure Cosmos DB firewall support</span></span>
<span data-ttu-id="4e26b-105">toosecure dados armazenados em uma conta de banco de dados do banco de dados do Azure Cosmos Cosmos do Azure DB forneceu suporte para um segredo com base em [modelo de autorização](https://msdn.microsoft.com/library/azure/dn783368.aspx) que utiliza um código de autenticação de alta segurança de mensagens baseada em Hash (HMAC).</span><span class="sxs-lookup"><span data-stu-id="4e26b-105">toosecure data stored in an Azure Cosmos DB database account, Azure Cosmos DB has provided support for a secret based [authorization model](https://msdn.microsoft.com/library/azure/dn783368.aspx) that utilizes a strong Hash-based message authentication code (HMAC).</span></span> <span data-ttu-id="4e26b-106">Agora, além de segredo toohello com base em modelo de autorização, o banco de dados do Azure Cosmos dá suporte à política controlada por controles de acesso baseado em IP para suporte de firewall de entrada.</span><span class="sxs-lookup"><span data-stu-id="4e26b-106">Now, in addition toohello secret based authorization model, Azure Cosmos DB supports policy driven IP-based access controls for inbound firewall support.</span></span> <span data-ttu-id="4e26b-107">Esse modelo é muito semelhante regras de firewall toohello de um sistema de banco de dados tradicional e fornece um nível adicional de segurança toohello conta de banco de dados do banco de dados do Azure Cosmos.</span><span class="sxs-lookup"><span data-stu-id="4e26b-107">This model is very similar toohello firewall rules of a traditional database system and provides an additional level of security toohello Azure Cosmos DB database account.</span></span> <span data-ttu-id="4e26b-108">Com esse modelo, você pode agora configurar toobe de conta de banco de dados um banco de dados do Azure Cosmos acessível somente a partir de um conjunto aprovado das máquinas e/ou serviços em nuvem.</span><span class="sxs-lookup"><span data-stu-id="4e26b-108">With this model, you can now configure an Azure Cosmos DB database account toobe accessible only from an approved set of machines and/or cloud services.</span></span> <span data-ttu-id="4e26b-109">Acessar recursos de banco de dados do Cosmos de tooAzure desses conjuntos aprovados de serviços e máquinas exigirão Olá chamador toopresent um token de autorização válido.</span><span class="sxs-lookup"><span data-stu-id="4e26b-109">Access tooAzure Cosmos DB resources from these approved sets of machines and services still require hello caller toopresent a valid authorization token.</span></span>

## <a name="ip-access-control-overview"></a><span data-ttu-id="4e26b-110">Visão geral do controle de acesso de IP</span><span class="sxs-lookup"><span data-stu-id="4e26b-110">IP access control overview</span></span>
<span data-ttu-id="4e26b-111">Por padrão, uma conta de banco de dados do banco de dados do Azure Cosmos é acessível pela internet pública, como solicitação de saudação é acompanhada por um token de autorização válido.</span><span class="sxs-lookup"><span data-stu-id="4e26b-111">By default, an Azure Cosmos DB database account is accessible from public internet as long as hello request is accompanied by a valid authorization token.</span></span> <span data-ttu-id="4e26b-112">tooconfigure controle de acesso baseado em política IP, o usuário Olá deve fornecer o conjunto de saudação de endereços IP ou intervalos de endereços IP no toobe de formulário CIDR incluídos como Olá permitido a lista de IPs de cliente para uma conta de banco de dados especificado.</span><span class="sxs-lookup"><span data-stu-id="4e26b-112">tooconfigure IP policy-based access control, hello user must provide hello set of IP addresses or IP address ranges in CIDR form toobe included as hello allowed list of client IPs for a given database account.</span></span> <span data-ttu-id="4e26b-113">Quando essa configuração for aplicada, todas as solicitações originadas máquinas fora essa lista permitida serão bloqueadas pelo servidor de saudação.</span><span class="sxs-lookup"><span data-stu-id="4e26b-113">Once this configuration is applied, all requests originating from machines outside this allowed list will be blocked by hello server.</span></span>  <span data-ttu-id="4e26b-114">conexão Olá fluxo de processamento para hello controle de acesso baseado em IP está descrito nos Olá diagrama a seguir.</span><span class="sxs-lookup"><span data-stu-id="4e26b-114">hello connection processing flow for hello IP-based access control is described in hello following diagram.</span></span>

![Diagrama mostrando o processo de conexão Olá para controle de acesso baseado em IP](./media/firewall-support/firewall-support-flow.png)

## <a name="connections-from-cloud-services"></a><span data-ttu-id="4e26b-116">Conexões dos serviços de nuvem</span><span class="sxs-lookup"><span data-stu-id="4e26b-116">Connections from cloud services</span></span>
<span data-ttu-id="4e26b-117">No Azure, os serviços de nuvem são uma maneira muito comum de hospedar a lógica do serviço de camada intermediária usando o Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="4e26b-117">In Azure, cloud services are a very common way for hosting middle tier service logic using Azure Cosmos DB.</span></span> <span data-ttu-id="4e26b-118">tooenable acesso tooan conta de banco de dados do banco de dados do Azure Cosmos de um serviço de nuvem, o endereço IP público de Olá Olá do serviço de nuvem deve ser adicionado toohello permitido a lista de endereços IP associados à sua conta de banco de dados do banco de dados do Azure Cosmos por [Configurando Olá política de controle de acesso IP](#configure-ip-policy).</span><span class="sxs-lookup"><span data-stu-id="4e26b-118">tooenable access tooan Azure Cosmos DB database account from a cloud service, hello public IP address of hello cloud service must be added toohello allowed list of IP addresses associated with your Azure Cosmos DB database account by [configuring hello IP access control policy](#configure-ip-policy).</span></span>  <span data-ttu-id="4e26b-119">Isso garante que todas as instâncias de função dos serviços de nuvem tenham acesso tooyour conta de banco de dados do banco de dados do Azure Cosmos.</span><span class="sxs-lookup"><span data-stu-id="4e26b-119">This ensures that all role instances of cloud services have access tooyour Azure Cosmos DB database account.</span></span> <span data-ttu-id="4e26b-120">Você pode recuperar endereços IP para os serviços de nuvem em Olá portal do Azure, conforme mostrado no hello captura de tela a seguir.</span><span class="sxs-lookup"><span data-stu-id="4e26b-120">You can retrieve IP addresses for your cloud services in hello Azure portal, as shown in hello following screenshot.</span></span>

![Captura de tela mostrando o endereço IP público de saudação para um serviço de nuvem exibido no portal do Azure de saudação](./media/firewall-support/public-ip-addresses.png)

<span data-ttu-id="4e26b-122">Quando você expandir seu serviço de nuvem adicionando instâncias de função adicionais, essas novas instâncias terão conta de banco de dados do access toohello Azure Cosmos DB automaticamente desde que fazem parte da saudação mesmo serviço de nuvem.</span><span class="sxs-lookup"><span data-stu-id="4e26b-122">When you scale out your cloud service by adding additional role instance(s), those new instances will automatically have access toohello Azure Cosmos DB database account since they are part of hello same cloud service.</span></span>

## <a name="connections-from-virtual-machines"></a><span data-ttu-id="4e26b-123">Conexões de máquinas virtuais</span><span class="sxs-lookup"><span data-stu-id="4e26b-123">Connections from virtual machines</span></span>
<span data-ttu-id="4e26b-124">[Máquinas virtuais](https://azure.microsoft.com/services/virtual-machines/) ou [conjuntos de escala de máquina virtual](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md) também pode ser usado toohost serviços de camada intermediária usando o banco de dados do Azure Cosmos.</span><span class="sxs-lookup"><span data-stu-id="4e26b-124">[Virtual machines](https://azure.microsoft.com/services/virtual-machines/) or [virtual machine scale sets](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md) can also be used toohost middle tier services using Azure Cosmos DB.</span></span>  <span data-ttu-id="4e26b-125">Olá tooconfigure acesso à tooallow de conta de banco de dados do banco de dados do Azure Cosmos de máquinas virtuais, os endereços IP públicos de máquina virtual e/ou conjunto de escalas da máquina virtual deve ser configurado como uma saudação endereços IP para a sua conta de banco de dados do banco de dados do Azure Cosmos por permitidos [configurar política de controle de acesso IP hello](#configure-ip-policy).</span><span class="sxs-lookup"><span data-stu-id="4e26b-125">tooconfigure hello Azure Cosmos DB database account tooallow access from virtual machines, public IP addresses of virtual machine and/or virtual machine scale set must be configured as one of hello allowed IP addresses for your Azure Cosmos DB database account by [configuring hello IP access control policy](#configure-ip-policy).</span></span> <span data-ttu-id="4e26b-126">Você pode recuperar endereços IP para máquinas virtuais no hello portal do Azure, conforme mostrado no hello captura de tela a seguir.</span><span class="sxs-lookup"><span data-stu-id="4e26b-126">You can retrieve IP addresses for virtual machines in hello Azure portal, as shown in hello following screenshot.</span></span>

![Captura de tela mostrando um endereço IP público para uma máquina virtual exibida em Olá portal do Azure](./media/firewall-support/public-ip-addresses-dns.png)

<span data-ttu-id="4e26b-128">Quando você adiciona o grupo de toohello de instâncias de máquinas virtuais adicionais, eles são fornecidos automaticamente conta de banco de dados do access tooyour Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="4e26b-128">When you add additional virtual machine instances toohello group, they are automatically provided access tooyour Azure Cosmos DB database account.</span></span>

## <a name="connections-from-hello-internet"></a><span data-ttu-id="4e26b-129">Olá de conexões da internet</span><span class="sxs-lookup"><span data-stu-id="4e26b-129">Connections from hello internet</span></span>
<span data-ttu-id="4e26b-130">Quando você acessa um banco de dados do Azure Cosmos conta banco de dados de um computador em hello da internet, hello endereço IP do cliente ou o intervalo de endereços IP da máquina Olá deve ser adicionado toohello lista de endereços IP do hello conta de banco de dados do banco de dados do Azure Cosmos permitido.</span><span class="sxs-lookup"><span data-stu-id="4e26b-130">When you access an Azure Cosmos DB database account from a computer on hello internet, hello client IP address or IP address range of hello machine must be added toohello allowed list of IP address for hello Azure Cosmos DB database account.</span></span> 

## <span data-ttu-id="4e26b-131"><a id="configure-ip-policy"></a>Configurar política de controle de acesso IP Olá</span><span class="sxs-lookup"><span data-stu-id="4e26b-131"><a id="configure-ip-policy"></a> Configuring hello IP access control policy</span></span>
<span data-ttu-id="4e26b-132">política de controle de acesso IP Hello pode ser definida em Olá portal do Azure, ou programaticamente por meio [CLI do Azure](cli-samples.md), [Azure Powershell](powershell-samples.md), ou hello [API REST](/rest/api/documentdb/) atualizando Olá `ipRangeFilter` propriedade.</span><span class="sxs-lookup"><span data-stu-id="4e26b-132">hello IP access control policy can be set in hello Azure portal, or programmatically through [Azure CLI](cli-samples.md), [Azure Powershell](powershell-samples.md), or hello [REST API](/rest/api/documentdb/) by updating hello `ipRangeFilter` property.</span></span> <span data-ttu-id="4e26b-133">Os intervalos/endereços IP devem ser separados por vírgula e não devem conter espaços.</span><span class="sxs-lookup"><span data-stu-id="4e26b-133">IP addresses/ranges must be comma separated and must not contain any spaces.</span></span> <span data-ttu-id="4e26b-134">Exemplo: "13.91.6.132,13.91.6.1/24".</span><span class="sxs-lookup"><span data-stu-id="4e26b-134">Example: "13.91.6.132,13.91.6.1/24".</span></span> <span data-ttu-id="4e26b-135">Ao atualizar sua conta do banco de dados por meio desses métodos, ser toopopulate-se de que todos os Olá propriedades tooprevent redefinir as configurações de toodefault.</span><span class="sxs-lookup"><span data-stu-id="4e26b-135">When updating your database account through these methods, be sure toopopulate all of hello properties tooprevent resetting toodefault settings.</span></span>

> [!NOTE]
> <span data-ttu-id="4e26b-136">Habilitando uma política de controle de acesso IP para sua conta de banco de dados do banco de dados do Azure Cosmos, todo acesso tooyour conta de banco de dados do banco de dados do Azure Cosmos máquinas fora Olá configurado permitido lista de intervalos de endereços IP estão bloqueados.</span><span class="sxs-lookup"><span data-stu-id="4e26b-136">By enabling an IP access control policy for your Azure Cosmos DB database account, all access tooyour Azure Cosmos DB database account from machines outside hello configured allowed list of IP address ranges are blocked.</span></span> <span data-ttu-id="4e26b-137">Em virtude de nesse modelo, a navegação de operação de plano de dados de saudação do portal de saudação também será bloqueado tooensure Olá integridade de controle de acesso.</span><span class="sxs-lookup"><span data-stu-id="4e26b-137">By virtue of this model, browsing hello data plane operation from hello portal will also be blocked tooensure hello integrity of access control.</span></span>

<span data-ttu-id="4e26b-138">desenvolvimento de toosimplify, Olá portal do Azure ajuda a identificar e adicionar IP de saudação do seu toohello de máquina do cliente, lista de permitidos para que aplicativos em execução de seu computador podem acessar Olá conta de banco de dados do Azure Cosmos.</span><span class="sxs-lookup"><span data-stu-id="4e26b-138">toosimplify development, hello Azure portal helps you identify and add hello IP of your client machine toohello allowed list, so that apps running your machine can access hello Azure Cosmos DB account.</span></span> <span data-ttu-id="4e26b-139">Observe que Olá endereço IP do cliente aqui é detectado como visto pelo portal de saudação.</span><span class="sxs-lookup"><span data-stu-id="4e26b-139">Note that hello client IP address here is detected as seen by hello portal.</span></span> <span data-ttu-id="4e26b-140">Ele pode ser um endereço IP do cliente de saudação do seu computador, mas também pode ser um endereço IP de saudação do seu gateway de rede.</span><span class="sxs-lookup"><span data-stu-id="4e26b-140">It may be hello client IP address of your machine, but it could also be hello IP address of your network gateway.</span></span> <span data-ttu-id="4e26b-141">Não se esqueça de tooremove antes tooproduction contínuo.</span><span class="sxs-lookup"><span data-stu-id="4e26b-141">Do not forget tooremove it before going tooproduction.</span></span>

<span data-ttu-id="4e26b-142">política de controle de acesso tooset Olá IP em Olá portal do Azure, navegue folha de conta do banco de dados do Azure Cosmos toohello, clique em **Firewall** no menu de navegação hello, em seguida, clique em **ON**</span><span class="sxs-lookup"><span data-stu-id="4e26b-142">tooset hello IP access control policy in hello Azure portal, navigate toohello Azure Cosmos DB account blade, click **Firewall** in hello navigation menu, then click **ON**</span></span> 

![Captura de tela mostrando como tooopen Olá folha de Firewall no hello portal do Azure](./media/firewall-support/azure-portal-firewall.png)

<span data-ttu-id="4e26b-144">No painel de novo hello, especifique se hello portal do Azure pode acessar a conta de hello, adicione outros intervalos e endereços conforme apropriado e clique em **salvar**.</span><span class="sxs-lookup"><span data-stu-id="4e26b-144">In hello new pane, specify whether hello Azure portal can access hello account, and add other addresses and ranges as appropriate, then click **Save**.</span></span>  

> [!NOTE]
> <span data-ttu-id="4e26b-145">Quando você habilita uma política de controle de acesso IP, é necessário o endereço IP de saudação do tooadd para Olá acesso toomaintain portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="4e26b-145">When you enable an IP access control policy, you need tooadd hello IP address for hello Azure portal toomaintain access.</span></span> <span data-ttu-id="4e26b-146">Olá portais endereços IP são:</span><span class="sxs-lookup"><span data-stu-id="4e26b-146">hello portal IP addresses are:</span></span>
> |<span data-ttu-id="4e26b-147">Região</span><span class="sxs-lookup"><span data-stu-id="4e26b-147">Region</span></span>|<span data-ttu-id="4e26b-148">Endereço IP</span><span class="sxs-lookup"><span data-stu-id="4e26b-148">IP address</span></span>|
> |------|----------|
> |<span data-ttu-id="4e26b-149">Todas as regiões, exceto aquelas especificadas abaixo</span><span class="sxs-lookup"><span data-stu-id="4e26b-149">All regions except those specified below</span></span>| <span data-ttu-id="4e26b-150">104.42.195.92</span><span class="sxs-lookup"><span data-stu-id="4e26b-150">104.42.195.92</span></span>|
> |<span data-ttu-id="4e26b-151">Alemanha</span><span class="sxs-lookup"><span data-stu-id="4e26b-151">Germany</span></span>|<span data-ttu-id="4e26b-152">51.4.229.218</span><span class="sxs-lookup"><span data-stu-id="4e26b-152">51.4.229.218</span></span>|
> |<span data-ttu-id="4e26b-153">China</span><span class="sxs-lookup"><span data-stu-id="4e26b-153">China</span></span>|<span data-ttu-id="4e26b-154">139.217.8.252</span><span class="sxs-lookup"><span data-stu-id="4e26b-154">139.217.8.252</span></span>|
> |<span data-ttu-id="4e26b-155">Governo dos EUA do Arizona</span><span class="sxs-lookup"><span data-stu-id="4e26b-155">US Gov Arizona</span></span>|<span data-ttu-id="4e26b-156">52.244.48.71</span><span class="sxs-lookup"><span data-stu-id="4e26b-156">52.244.48.71</span></span>|
>

![Captura de tela mostrando um como configurações de firewall tooconfigure em Olá portal do Azure](./media/firewall-support/azure-portal-firewall-configure.png)

## <a name="troubleshooting-hello-ip-access-control-policy"></a><span data-ttu-id="4e26b-158">Solucionando problemas de política de controle de acesso IP Olá</span><span class="sxs-lookup"><span data-stu-id="4e26b-158">Troubleshooting hello IP access control policy</span></span>
### <a name="portal-operations"></a><span data-ttu-id="4e26b-159">Operações no Portal</span><span class="sxs-lookup"><span data-stu-id="4e26b-159">Portal operations</span></span>
<span data-ttu-id="4e26b-160">Habilitando uma política de controle de acesso IP para sua conta de banco de dados do banco de dados do Azure Cosmos, todo acesso tooyour conta de banco de dados do banco de dados do Azure Cosmos máquinas fora Olá configurado permitido lista de intervalos de endereços IP estão bloqueados.</span><span class="sxs-lookup"><span data-stu-id="4e26b-160">By enabling an IP access control policy for your Azure Cosmos DB database account, all access tooyour Azure Cosmos DB database account from machines outside hello configured allowed list of IP address ranges are blocked.</span></span> <span data-ttu-id="4e26b-161">Portanto, se você quiser tooenable dados portal plano operações, como coleções e documentos de consulta de navegação, você precisa tooexplicitly permitir acesso ao portal do Azure usando Olá **Firewall** folha no portal de saudação.</span><span class="sxs-lookup"><span data-stu-id="4e26b-161">Therefore if you want tooenable portal data plane operations like browsing collections and query documents, you need tooexplicitly allow Azure portal access using hello **Firewall** blade in hello portal.</span></span> 

![Captura de tela mostrando um como tooenable acesso toohello portal do Azure](./media/firewall-support/azure-portal-access-firewall.png)

### <a name="sdk--rest-api"></a><span data-ttu-id="4e26b-163">SDK e API Rest</span><span class="sxs-lookup"><span data-stu-id="4e26b-163">SDK & Rest API</span></span>
<span data-ttu-id="4e26b-164">Para motivos de segurança, o acesso por meio de SDK ou a API REST de máquinas não Olá lista de permitidos retornará uma genérico 404 não encontrado resposta sem detalhes adicionais.</span><span class="sxs-lookup"><span data-stu-id="4e26b-164">For security reasons, access via SDK or REST API from machines not on hello allowed list will return a generic 404 Not Found response with no additional details.</span></span> <span data-ttu-id="4e26b-165">Verifique se o que IP hello permitido lista configurada seu banco de dados do Azure Cosmos banco de dados conta tooensure Olá correta de configuração de política é aplicada tooyour conta de banco de dados do banco de dados do Azure Cosmos.</span><span class="sxs-lookup"><span data-stu-id="4e26b-165">Please verify hello IP allowed list configured for your Azure Cosmos DB database account tooensure hello correct policy configuration is applied tooyour Azure Cosmos DB database account.</span></span>

## <a name="next-steps"></a><span data-ttu-id="4e26b-166">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="4e26b-166">Next steps</span></span>
<span data-ttu-id="4e26b-167">Para obter informações sobre dicas de desempenho relacionadas à rede, consulte [Dicas de desempenho](performance-tips.md).</span><span class="sxs-lookup"><span data-stu-id="4e26b-167">For information about network related performance tips, see [Performance tips](performance-tips.md).</span></span>

