---
title: "Considerações de rede com um ambiente do Serviço de Aplicativo do Azure"
description: "Explica o tráfego de rede do ASE e como definir NSGs e UDRs com seu ASE"
services: app-service
documentationcenter: na
author: ccompy
manager: stefsch
ms.assetid: 955a4d84-94ca-418d-aa79-b57a5eb8cb85
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/08/2017
ms.author: ccompy
ms.openlocfilehash: 3be0d7a202ff53f5532fd7169a50a04cfaf88832
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/29/2017
---
# <a name="networking-considerations-for-an-app-service-environment"></a><span data-ttu-id="2b068-103">Considerações de rede para um ambiente do Serviço de Aplicativo</span><span class="sxs-lookup"><span data-stu-id="2b068-103">Networking considerations for an App Service environment</span></span> #

## <a name="overview"></a><span data-ttu-id="2b068-104">Visão geral</span><span class="sxs-lookup"><span data-stu-id="2b068-104">Overview</span></span> ##

 <span data-ttu-id="2b068-105">O [Ambiente do Serviço de Aplicativo][Intro] do Azure é uma implantação do Serviço de Aplicativo do Azure em uma sub-rede da sua VNet (VNet) do Azure.</span><span class="sxs-lookup"><span data-stu-id="2b068-105">Azure [App Service Environment][Intro] is a deployment of Azure App Service into a subnet in your Azure virtual network (VNet).</span></span> <span data-ttu-id="2b068-106">Há dois tipos de implantação para um ASE (ambiente de Serviço de Aplicativo):</span><span class="sxs-lookup"><span data-stu-id="2b068-106">There are two deployment types for an App Service environment (ASE):</span></span>

- <span data-ttu-id="2b068-107">**ASE externo**: expõe os aplicativos ASE hospedados em um endereço IP acessado pela Internet.</span><span class="sxs-lookup"><span data-stu-id="2b068-107">**External ASE**: Exposes the ASE-hosted apps on an internet-accessible IP address.</span></span> <span data-ttu-id="2b068-108">Para saber mais, confira [Criar um ASE externo][MakeExternalASE].</span><span class="sxs-lookup"><span data-stu-id="2b068-108">For more information, see [Create an External ASE][MakeExternalASE].</span></span>
- <span data-ttu-id="2b068-109">**ILB ASE**: expõe os aplicativos hospedados do ASE em um endereço IP dentro da sua VNet.</span><span class="sxs-lookup"><span data-stu-id="2b068-109">**ILB ASE**: Exposes the ASE-hosted apps on an IP address inside your VNet.</span></span> <span data-ttu-id="2b068-110">O ponto de extremidade interno é um ILB (balanceador de carga interno) e, por isso, ele é chamado de ASE do ILB.</span><span class="sxs-lookup"><span data-stu-id="2b068-110">The internal endpoint is an internal load balancer (ILB), which is why it's called an ILB ASE.</span></span> <span data-ttu-id="2b068-111">Para saber mais, confira [Criar e usar um ASE ILB][MakeILBASE].</span><span class="sxs-lookup"><span data-stu-id="2b068-111">For more information, see [Create and use an ILB ASE][MakeILBASE].</span></span>

<span data-ttu-id="2b068-112">Agora há duas versões do Ambiente do Serviço de Aplicativo: ASEv1 e ASEv2.</span><span class="sxs-lookup"><span data-stu-id="2b068-112">There are now two versions of App Service Environment: ASEv1 and ASEv2.</span></span> <span data-ttu-id="2b068-113">Para saber mais sobre o ASEv1, consulte [Introdução ao Ambiente do Serviço de Aplicativo v1][ASEv1Intro].</span><span class="sxs-lookup"><span data-stu-id="2b068-113">For information on ASEv1, see [Introduction to App Service Environment v1][ASEv1Intro].</span></span> <span data-ttu-id="2b068-114">O ASEv1 pode ser implantado em uma VNet clássica ou do Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="2b068-114">ASEv1 can be deployed in a classic or Resource Manager VNet.</span></span> <span data-ttu-id="2b068-115">Um ASEv2 só pode ser implantado em uma VNet do Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="2b068-115">ASEv2 can only be deployed into a Resource Manager VNet.</span></span>

<span data-ttu-id="2b068-116">Todas as chamadas de um ASE que vão para a Internet deixam a rede virtual por meio de um VIP atribuído ao ASE.</span><span class="sxs-lookup"><span data-stu-id="2b068-116">All calls from an ASE that go to the internet leave the VNet through a VIP assigned for the ASE.</span></span> <span data-ttu-id="2b068-117">O IP público desse VIP é o IP de origem para todas as chamadas do ASE que vão para a Internet.</span><span class="sxs-lookup"><span data-stu-id="2b068-117">The public IP of this VIP is then the source IP for all calls from the ASE that go to the internet.</span></span> <span data-ttu-id="2b068-118">Se os aplicativos em seu ASE fizerem chamadas a recursos na sua VNet ou por uma VPN, o IP de origem será um dos IPs na sub-rede usada pelo ASE.</span><span class="sxs-lookup"><span data-stu-id="2b068-118">If the apps in your ASE make calls to resources in your VNet or across a VPN, the source IP is one of the IPs in the subnet used by your ASE.</span></span> <span data-ttu-id="2b068-119">Como o ASE é na VNet, também pode acessar recursos na VNet sem nenhuma configuração adicional.</span><span class="sxs-lookup"><span data-stu-id="2b068-119">Because the ASE is within the VNet, it can also access resources within the VNet without any additional configuration.</span></span> <span data-ttu-id="2b068-120">Se a VNet estiver conectada à sua rede local, os aplicativos em seu ASE também terão acesso aos recursos de lá.</span><span class="sxs-lookup"><span data-stu-id="2b068-120">If the VNet is connected to your on-premises network, apps in your ASE also have access to resources there.</span></span> <span data-ttu-id="2b068-121">Você não precisa fazer amais nenhuma configuração no seu aplicativo ou o ASE.</span><span class="sxs-lookup"><span data-stu-id="2b068-121">You don't need to configure the ASE or your app any further.</span></span>

![ASE externo][1] 

<span data-ttu-id="2b068-123">Se você tiver um ASE externo, o VIP público também será o ponto de extremidade para o qual seus aplicativos ASE resolvem:</span><span class="sxs-lookup"><span data-stu-id="2b068-123">If you have an External ASE, the public VIP is also the endpoint that your ASE apps resolve to for:</span></span>

* <span data-ttu-id="2b068-124">HTTP/S.</span><span class="sxs-lookup"><span data-stu-id="2b068-124">HTTP/S.</span></span> 
* <span data-ttu-id="2b068-125">FTP/S.</span><span class="sxs-lookup"><span data-stu-id="2b068-125">FTP/S.</span></span> 
* <span data-ttu-id="2b068-126">Implantação da Web.</span><span class="sxs-lookup"><span data-stu-id="2b068-126">Web deployment.</span></span>
* <span data-ttu-id="2b068-127">Depuração remota.</span><span class="sxs-lookup"><span data-stu-id="2b068-127">Remote debugging.</span></span>

![ILB ASE][2]

<span data-ttu-id="2b068-129">Se você tiver um ASE ILB, o endereço IP do ILB será o ponto de extremidade para HTTP/S, FTP/S, implantação da Web e depuração remota.</span><span class="sxs-lookup"><span data-stu-id="2b068-129">If you have an ILB ASE, the IP address of the ILB is the endpoint for HTTP/S, FTP/S, web deployment, and remote debugging.</span></span>

<span data-ttu-id="2b068-130">As portas de acesso normais do aplicativo são:</span><span class="sxs-lookup"><span data-stu-id="2b068-130">The normal app access ports are:</span></span>

| <span data-ttu-id="2b068-131">Uso</span><span class="sxs-lookup"><span data-stu-id="2b068-131">Use</span></span> | <span data-ttu-id="2b068-132">Da</span><span class="sxs-lookup"><span data-stu-id="2b068-132">From</span></span> | <span data-ttu-id="2b068-133">Para</span><span class="sxs-lookup"><span data-stu-id="2b068-133">To</span></span> |
|----------|---------|-------------|
|  <span data-ttu-id="2b068-134">HTTP/HTTPS</span><span class="sxs-lookup"><span data-stu-id="2b068-134">HTTP/HTTPS</span></span>  | <span data-ttu-id="2b068-135">Configurável pelo usuário</span><span class="sxs-lookup"><span data-stu-id="2b068-135">User configurable</span></span> |  <span data-ttu-id="2b068-136">80, 443</span><span class="sxs-lookup"><span data-stu-id="2b068-136">80, 443</span></span> |
|  <span data-ttu-id="2b068-137">FTP/FTPS</span><span class="sxs-lookup"><span data-stu-id="2b068-137">FTP/FTPS</span></span>    | <span data-ttu-id="2b068-138">Configurável pelo usuário</span><span class="sxs-lookup"><span data-stu-id="2b068-138">User configurable</span></span> |  <span data-ttu-id="2b068-139">21, 990, 10001-10020</span><span class="sxs-lookup"><span data-stu-id="2b068-139">21, 990, 10001-10020</span></span> |
|  <span data-ttu-id="2b068-140">Depuração remota no Visual Studio</span><span class="sxs-lookup"><span data-stu-id="2b068-140">Visual Studio remote debugging</span></span>  |  <span data-ttu-id="2b068-141">Configurável pelo usuário</span><span class="sxs-lookup"><span data-stu-id="2b068-141">User configurable</span></span> |  <span data-ttu-id="2b068-142">4016, 4018, 4020, 4022</span><span class="sxs-lookup"><span data-stu-id="2b068-142">4016, 4018, 4020, 4022</span></span> |

<span data-ttu-id="2b068-143">Isso será verdadeiro se você estiver em um ASE externo ou em um ASE ILB.</span><span class="sxs-lookup"><span data-stu-id="2b068-143">This is true if you're on an External ASE or on an ILB ASE.</span></span> <span data-ttu-id="2b068-144">Se você estiver em um ASE externo, chegará a essas portas no VIP público.</span><span class="sxs-lookup"><span data-stu-id="2b068-144">If you're on an External ASE, you hit those ports on the public VIP.</span></span> <span data-ttu-id="2b068-145">Se você estiver em um ASE ILB, chegará a essas portas no ILB.</span><span class="sxs-lookup"><span data-stu-id="2b068-145">If you're on an ILB ASE, you hit those ports on the ILB.</span></span> <span data-ttu-id="2b068-146">Se você bloquear a porta 443, poderá haver um efeito sobre alguns recursos expostos no portal.</span><span class="sxs-lookup"><span data-stu-id="2b068-146">If you lock down port 443, there can be an effect on some features exposed in the portal.</span></span> <span data-ttu-id="2b068-147">Para saber mais, confira [Dependências do portal](#portaldep).</span><span class="sxs-lookup"><span data-stu-id="2b068-147">For more information, see [Portal dependencies](#portaldep).</span></span>

## <a name="ase-dependencies"></a><span data-ttu-id="2b068-148">Dependências do ASE</span><span class="sxs-lookup"><span data-stu-id="2b068-148">ASE dependencies</span></span> ##

<span data-ttu-id="2b068-149">Uma dependência de acesso de entrada do ASE é:</span><span class="sxs-lookup"><span data-stu-id="2b068-149">An ASE inbound access dependency is:</span></span>

| <span data-ttu-id="2b068-150">Uso</span><span class="sxs-lookup"><span data-stu-id="2b068-150">Use</span></span> | <span data-ttu-id="2b068-151">Da</span><span class="sxs-lookup"><span data-stu-id="2b068-151">From</span></span> | <span data-ttu-id="2b068-152">Para</span><span class="sxs-lookup"><span data-stu-id="2b068-152">To</span></span> |
|-----|------|----|
| <span data-ttu-id="2b068-153">Gerenciamento</span><span class="sxs-lookup"><span data-stu-id="2b068-153">Management</span></span> | <span data-ttu-id="2b068-154">Endereços de gerenciamento do Serviço de Aplicativo</span><span class="sxs-lookup"><span data-stu-id="2b068-154">App Service management addresses</span></span> | <span data-ttu-id="2b068-155">Sub-rede ASE: 454, 455</span><span class="sxs-lookup"><span data-stu-id="2b068-155">ASE subnet: 454, 455</span></span> |
|  <span data-ttu-id="2b068-156">Comunicação interna ASE</span><span class="sxs-lookup"><span data-stu-id="2b068-156">ASE internal communication</span></span> | <span data-ttu-id="2b068-157">Sub-rede ASE: todas as portas</span><span class="sxs-lookup"><span data-stu-id="2b068-157">ASE subnet: All ports</span></span> | <span data-ttu-id="2b068-158">Sub-rede ASE: todas as portas</span><span class="sxs-lookup"><span data-stu-id="2b068-158">ASE subnet: All ports</span></span>
|  <span data-ttu-id="2b068-159">Permitir a entrada do Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="2b068-159">Allow Azure load balancer inbound</span></span> | <span data-ttu-id="2b068-160">Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="2b068-160">Azure load balancer</span></span> | <span data-ttu-id="2b068-161">Sub-rede ASE: todas as portas</span><span class="sxs-lookup"><span data-stu-id="2b068-161">ASE subnet: All ports</span></span>
|  <span data-ttu-id="2b068-162">Endereços IP atribuídos ao aplicativo</span><span class="sxs-lookup"><span data-stu-id="2b068-162">App assigned IP addresses</span></span> | <span data-ttu-id="2b068-163">Endereços atribuído de aplicativo</span><span class="sxs-lookup"><span data-stu-id="2b068-163">App assigned addresses</span></span> | <span data-ttu-id="2b068-164">Sub-rede ASE: todas as portas</span><span class="sxs-lookup"><span data-stu-id="2b068-164">ASE subnet: All ports</span></span>

<span data-ttu-id="2b068-165">O tráfego de entrada fornece o comando e o controle do ASE, além de monitoramento do sistema.</span><span class="sxs-lookup"><span data-stu-id="2b068-165">The inbound traffic provides command and control of the ASE in addition to system monitoring.</span></span> <span data-ttu-id="2b068-166">Os IPs de origem para esse tráfego são listadas no documento [Endereços de gerenciamento do ASE endereços][ASEManagement].</span><span class="sxs-lookup"><span data-stu-id="2b068-166">The source IPs for this traffic are listed in the [ASE Management addresses][ASEManagement] document.</span></span> <span data-ttu-id="2b068-167">A configuração de segurança de rede deve permitir o acesso de todos os IPs nas portas 454 e 455.</span><span class="sxs-lookup"><span data-stu-id="2b068-167">The network security configuration needs to allow access from all IPs on ports 454 and 455.</span></span>

<span data-ttu-id="2b068-168">Dentro da sub-rede ASE há muitas portas usadas para a comunicação interna do componente e elas podem mudar.</span><span class="sxs-lookup"><span data-stu-id="2b068-168">Within the ASE subnet there are many ports used for internal component communication and they can change.</span></span>  <span data-ttu-id="2b068-169">Isso exige que todas as portas na sub-rede ASE estejam acessíveis por meio da sub-rede ASE.</span><span class="sxs-lookup"><span data-stu-id="2b068-169">This requires all of the ports in the ASE subnet to be accessible from the ASE subnet.</span></span> 

<span data-ttu-id="2b068-170">Para a comunicação entre o balanceador de carga do Azure e a sub-rede do ASE, as portas mínimas que precisam ser abertas são 454 e 455 de 16001.</span><span class="sxs-lookup"><span data-stu-id="2b068-170">For the communication between the Azure load balancer and the ASE subnet the minimum ports that need to be open are 454, 455 and 16001.</span></span> <span data-ttu-id="2b068-171">A porta 16001 é usada para tráfego de keep alive entre o balanceador de carga e o ASE.</span><span class="sxs-lookup"><span data-stu-id="2b068-171">The 16001 port is used for keep alive traffic between the load balancer and the ASE.</span></span> <span data-ttu-id="2b068-172">Se você estiver usando um ASE ILB, poderá restringir o tráfego somente para as portas 454, 455, 16001.</span><span class="sxs-lookup"><span data-stu-id="2b068-172">If you are using an ILB ASE then you can lock traffic down to just the 454, 455, 16001 ports.</span></span>  <span data-ttu-id="2b068-173">Se você estiver usando um ASE externo, então precisará levar em conta as portas de acesso do aplicativo normal.</span><span class="sxs-lookup"><span data-stu-id="2b068-173">If you are using an External ASE then you need to take into account the normal app access ports.</span></span>  <span data-ttu-id="2b068-174">Se você estiver usando endereços atribuídos de aplicativo, será necessário abri-los para todas as portas.</span><span class="sxs-lookup"><span data-stu-id="2b068-174">If you are using app assigned addresses you need to open it to all ports.</span></span>  <span data-ttu-id="2b068-175">Quando um endereço é atribuído a um aplicativo específico, o balanceador de carga usa as portas que não são conhecidas com antecedência para enviar o tráfego HTTP e HTTPS para o ASE.</span><span class="sxs-lookup"><span data-stu-id="2b068-175">When an address is assigned to a specific app, then the load balancer will use ports that are not known of in advance to send HTTP and HTTPS traffic to the ASE.</span></span>

<span data-ttu-id="2b068-176">Se você estiver usando os endereços IP atribuídos pelo aplicativo, será necessário permitir o tráfego dos IPs atribuídos a seus aplicativos à sub-rede do ASE.</span><span class="sxs-lookup"><span data-stu-id="2b068-176">If you are using app assigned IP addresses you need to allow traffic from the IPs assigned to your apps to the ASE subnet.</span></span>

<span data-ttu-id="2b068-177">Para acesso de saída, um ASE depende de vários sistemas externos.</span><span class="sxs-lookup"><span data-stu-id="2b068-177">For outbound access, an ASE depends on multiple external systems.</span></span> <span data-ttu-id="2b068-178">Essas dependências de sistema são definidas com nomes DNS e não são mapeadas para um conjunto fixo de endereços IP.</span><span class="sxs-lookup"><span data-stu-id="2b068-178">Those system dependencies are defined with DNS names and don't map to a fixed set of IP addresses.</span></span> <span data-ttu-id="2b068-179">Assim, o ASE requer acesso de saída da sub-rede do ASE para todos os IPs externos em uma variedade de portas.</span><span class="sxs-lookup"><span data-stu-id="2b068-179">Thus, the ASE requires outbound access from the ASE subnet to all external IPs across a variety of ports.</span></span> <span data-ttu-id="2b068-180">Um ASE tem as seguintes dependências de saída:</span><span class="sxs-lookup"><span data-stu-id="2b068-180">An ASE has the following outbound dependencies:</span></span>

| <span data-ttu-id="2b068-181">Uso</span><span class="sxs-lookup"><span data-stu-id="2b068-181">Use</span></span> | <span data-ttu-id="2b068-182">Da</span><span class="sxs-lookup"><span data-stu-id="2b068-182">From</span></span> | <span data-ttu-id="2b068-183">Para</span><span class="sxs-lookup"><span data-stu-id="2b068-183">To</span></span> |
|-----|------|----|
| <span data-ttu-id="2b068-184">Armazenamento do Azure</span><span class="sxs-lookup"><span data-stu-id="2b068-184">Azure Storage</span></span> | <span data-ttu-id="2b068-185">Sub-rede ASE</span><span class="sxs-lookup"><span data-stu-id="2b068-185">ASE subnet</span></span> | <span data-ttu-id="2b068-186">table.core.windows.net, blob.core.windows.net, queue.core.windows.net, file.core.windows.net: 80, 443, 445 (445 só é necessário para o ASEv1).</span><span class="sxs-lookup"><span data-stu-id="2b068-186">table.core.windows.net, blob.core.windows.net, queue.core.windows.net, file.core.windows.net: 80, 443, 445 (445 is only needed for ASEv1.)</span></span> |
| <span data-ttu-id="2b068-187">Banco de Dados SQL do Azure</span><span class="sxs-lookup"><span data-stu-id="2b068-187">Azure SQL Database</span></span> | <span data-ttu-id="2b068-188">Sub-rede ASE</span><span class="sxs-lookup"><span data-stu-id="2b068-188">ASE subnet</span></span> | <span data-ttu-id="2b068-189">database.windows.net: 1433, 11000-11999, 14000-14999 (Para saber mais, confira [Uso da porta do Banco de Dados SQL V12](../../sql-database/sql-database-develop-direct-route-ports-adonet-v12.md).)</span><span class="sxs-lookup"><span data-stu-id="2b068-189">database.windows.net: 1433, 11000-11999, 14000-14999 (For more information, see [SQL Database V12 port usage](../../sql-database/sql-database-develop-direct-route-ports-adonet-v12.md).)</span></span>|
| <span data-ttu-id="2b068-190">Gerenciamento do Azure</span><span class="sxs-lookup"><span data-stu-id="2b068-190">Azure management</span></span> | <span data-ttu-id="2b068-191">Sub-rede ASE</span><span class="sxs-lookup"><span data-stu-id="2b068-191">ASE subnet</span></span> | <span data-ttu-id="2b068-192">management.core.windows.net, management.azure.com: 443</span><span class="sxs-lookup"><span data-stu-id="2b068-192">management.core.windows.net, management.azure.com: 443</span></span> 
| <span data-ttu-id="2b068-193">Verificação de certificado SSL</span><span class="sxs-lookup"><span data-stu-id="2b068-193">SSL certificate verification</span></span> |  <span data-ttu-id="2b068-194">Sub-rede ASE</span><span class="sxs-lookup"><span data-stu-id="2b068-194">ASE subnet</span></span>            |  <span data-ttu-id="2b068-195">ocsp.msocsp.com, mscrl.microsoft.com, crl.microsoft.com: 443</span><span class="sxs-lookup"><span data-stu-id="2b068-195">ocsp.msocsp.com, mscrl.microsoft.com, crl.microsoft.com: 443</span></span>
| <span data-ttu-id="2b068-196">Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="2b068-196">Azure Active Directory</span></span>        | <span data-ttu-id="2b068-197">Sub-rede ASE</span><span class="sxs-lookup"><span data-stu-id="2b068-197">ASE subnet</span></span>            |  <span data-ttu-id="2b068-198">Internet: 443</span><span class="sxs-lookup"><span data-stu-id="2b068-198">Internet: 443</span></span>
| <span data-ttu-id="2b068-199">Gerenciamento do Serviço de Aplicativo</span><span class="sxs-lookup"><span data-stu-id="2b068-199">App Service management</span></span>        | <span data-ttu-id="2b068-200">Sub-rede ASE</span><span class="sxs-lookup"><span data-stu-id="2b068-200">ASE subnet</span></span>            |  <span data-ttu-id="2b068-201">Internet: 443</span><span class="sxs-lookup"><span data-stu-id="2b068-201">Internet: 443</span></span>
| <span data-ttu-id="2b068-202">DNS do Azure</span><span class="sxs-lookup"><span data-stu-id="2b068-202">Azure DNS</span></span>                     | <span data-ttu-id="2b068-203">Sub-rede ASE</span><span class="sxs-lookup"><span data-stu-id="2b068-203">ASE subnet</span></span>            |  <span data-ttu-id="2b068-204">Internet: 53</span><span class="sxs-lookup"><span data-stu-id="2b068-204">Internet: 53</span></span>
| <span data-ttu-id="2b068-205">Comunicação interna ASE</span><span class="sxs-lookup"><span data-stu-id="2b068-205">ASE internal communication</span></span>    | <span data-ttu-id="2b068-206">Sub-rede ASE: todas as portas</span><span class="sxs-lookup"><span data-stu-id="2b068-206">ASE subnet: All ports</span></span> |  <span data-ttu-id="2b068-207">Sub-rede ASE: todas as portas</span><span class="sxs-lookup"><span data-stu-id="2b068-207">ASE subnet: All ports</span></span>

<span data-ttu-id="2b068-208">Se o ASE perde o acesso a essas dependências, ele deixa de funcionar.</span><span class="sxs-lookup"><span data-stu-id="2b068-208">If the ASE loses access to these dependencies, it stops working.</span></span> <span data-ttu-id="2b068-209">Quando isso acontece por tempo suficiente, o ASE fica suspenso.</span><span class="sxs-lookup"><span data-stu-id="2b068-209">When that happens long enough, the ASE is suspended.</span></span>

### <a name="customer-dns"></a><span data-ttu-id="2b068-210">DNS do cliente</span><span class="sxs-lookup"><span data-stu-id="2b068-210">Customer DNS</span></span> ###

<span data-ttu-id="2b068-211">Se a VNet for configurada com um servidor DNS definido pelo cliente, as cargas de trabalho de locatário usarão esse servidor DNS.</span><span class="sxs-lookup"><span data-stu-id="2b068-211">If the VNet is configured with a customer-defined DNS server, the tenant workloads use it.</span></span> <span data-ttu-id="2b068-212">O ASE ainda precisa se comunicar com o DNS do Azure para fins de gerenciamento.</span><span class="sxs-lookup"><span data-stu-id="2b068-212">The ASE still needs to communicate with Azure DNS for management purposes.</span></span> 

<span data-ttu-id="2b068-213">Se a VNet for configurada com um DNS de cliente no outro lado de uma VPN, o servidor DNS deverá poder ser acessado da sub-rede que contém o ASE.</span><span class="sxs-lookup"><span data-stu-id="2b068-213">If the VNet is configured with a customer DNS on the other side of a VPN, the DNS server must be reachable from the subnet that contains the ASE.</span></span>

<a name="portaldep"></a>

## <a name="portal-dependencies"></a><span data-ttu-id="2b068-214">Dependências do portal</span><span class="sxs-lookup"><span data-stu-id="2b068-214">Portal dependencies</span></span> ##

<span data-ttu-id="2b068-215">Além das dependências funcionais do ASE, há alguns itens adicionais relacionados à experiência do portal.</span><span class="sxs-lookup"><span data-stu-id="2b068-215">In addition to the ASE functional dependencies, there are a few extra items related to the portal experience.</span></span> <span data-ttu-id="2b068-216">Alguns dos recursos no portal do Azure dependem do acesso direto ao _site do SCM_.</span><span class="sxs-lookup"><span data-stu-id="2b068-216">Some of the capabilities in the Azure portal depend on direct access to _SCM site_.</span></span> <span data-ttu-id="2b068-217">Para cada aplicativo no Serviço de Aplicativo do Azure, há duas URLs.</span><span class="sxs-lookup"><span data-stu-id="2b068-217">For every app in Azure App Service, there are two URLs.</span></span> <span data-ttu-id="2b068-218">A primeira URL é para acessar seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2b068-218">The first URL is to access your app.</span></span> <span data-ttu-id="2b068-219">A segunda URL é para acessar o site do SCM, que também é chamado de _console Kudu_.</span><span class="sxs-lookup"><span data-stu-id="2b068-219">The second URL is to access the SCM site, which is also called the _Kudu console_.</span></span> <span data-ttu-id="2b068-220">Recursos que usam o site do SCM incluem:</span><span class="sxs-lookup"><span data-stu-id="2b068-220">Features that use the SCM site include:</span></span>

-   <span data-ttu-id="2b068-221">Trabalhos da Web</span><span class="sxs-lookup"><span data-stu-id="2b068-221">Web jobs</span></span>
-   <span data-ttu-id="2b068-222">Funções</span><span class="sxs-lookup"><span data-stu-id="2b068-222">Functions</span></span>
-   <span data-ttu-id="2b068-223">Streaming de log</span><span class="sxs-lookup"><span data-stu-id="2b068-223">Log streaming</span></span>
-   <span data-ttu-id="2b068-224">Kudu</span><span class="sxs-lookup"><span data-stu-id="2b068-224">Kudu</span></span>
-   <span data-ttu-id="2b068-225">Extensões</span><span class="sxs-lookup"><span data-stu-id="2b068-225">Extensions</span></span>
-   <span data-ttu-id="2b068-226">Gerenciador de Processos</span><span class="sxs-lookup"><span data-stu-id="2b068-226">Process Explorer</span></span>
-   <span data-ttu-id="2b068-227">Console</span><span class="sxs-lookup"><span data-stu-id="2b068-227">Console</span></span>

<span data-ttu-id="2b068-228">Quando você usa uma ASE ILB, o site SCM não é acessível pela Internet de fora da VNet.</span><span class="sxs-lookup"><span data-stu-id="2b068-228">When you use an ILB ASE, the SCM site isn't internet accessible from outside the VNet.</span></span> <span data-ttu-id="2b068-229">Quando o aplicativo estiver hospedado em um ILB ASE, algumas funcionalidades não funcionarão no portal.</span><span class="sxs-lookup"><span data-stu-id="2b068-229">When your app is hosted on an ILB ASE, some capabilities will not work from the portal.</span></span>  

<span data-ttu-id="2b068-230">Muitos desses recursos que dependem do site do SCM também estão disponíveis diretamente no console Kudu.</span><span class="sxs-lookup"><span data-stu-id="2b068-230">Many of those capabilities that depend upon the SCM site are also available directly in the Kudu console.</span></span> <span data-ttu-id="2b068-231">Você pode se conectar a ele diretamente, em vez de por meio do portal.</span><span class="sxs-lookup"><span data-stu-id="2b068-231">You can connect to it directly rather than by using the portal.</span></span> <span data-ttu-id="2b068-232">Se o seu aplicativo estiver hospedado em um ASE ILB, use suas credenciais de publicação para entrar.</span><span class="sxs-lookup"><span data-stu-id="2b068-232">If your app is hosted in an ILB ASE, use your publishing credentials to sign in.</span></span> <span data-ttu-id="2b068-233">A URL para acessar o site do SCM de um aplicativo hospedado em um ASE ILB tem o seguinte formato:</span><span class="sxs-lookup"><span data-stu-id="2b068-233">The URL to access the SCM site of an app hosted in an ILB ASE has the following format:</span></span> 

```
<appname>.scm.<domain name the ILB ASE was created with> 
```

<span data-ttu-id="2b068-234">Se seu ASE ILB for o nome de domínio *contoso.net* e o nome do aplicativo for *testapp*, o aplicativo será alcançado em *testapp.contoso.net*.</span><span class="sxs-lookup"><span data-stu-id="2b068-234">If your ILB ASE is the domain name *contoso.net* and your app name is *testapp*, the app is reached at *testapp.contoso.net*.</span></span> <span data-ttu-id="2b068-235">O site SCM que o acompanha é alcançado em *testapp.scm.contoso.net*.</span><span class="sxs-lookup"><span data-stu-id="2b068-235">The SCM site that goes with it is reached at *testapp.scm.contoso.net*.</span></span>

### <a name="functions-and-web-jobs"></a><span data-ttu-id="2b068-236">Funções e trabalhos Web</span><span class="sxs-lookup"><span data-stu-id="2b068-236">Functions and Web jobs</span></span> ###

<span data-ttu-id="2b068-237">As Funções e os trabalhos Web dependem do site do SCM, mas há suporte para eles para uso no portal, mesmo que os aplicativos estiverem em um ILB ASE, desde que o navegador possa acessar o site do SCM.</span><span class="sxs-lookup"><span data-stu-id="2b068-237">Both Functions and Web jobs depend on the SCM site but are supported for use in the portal, even if your apps are in an ILB ASE, so long as your browser can reach the SCM site.</span></span>  <span data-ttu-id="2b068-238">Se você estiver usando um certificado autoassinado com o ILB ASE, precisará habilitar o navegador para que ele confie no certificado.</span><span class="sxs-lookup"><span data-stu-id="2b068-238">If you are using a self-signed certificate with your ILB ASE, you will need to enable your browser to trust that certificate.</span></span>  <span data-ttu-id="2b068-239">Para o IE e o Edge, isso significa que o certificado deve estar no repositório de confiança do computador.</span><span class="sxs-lookup"><span data-stu-id="2b068-239">For IE and Edge that means the certificate has to be in the computer trust store.</span></span>  <span data-ttu-id="2b068-240">Se você estiver usando o Chrome, isso significa que você aceitou o certificado no navegador anteriormente supostamente visitando o site do SCM diretamente.</span><span class="sxs-lookup"><span data-stu-id="2b068-240">If you are using Chrome then that means you accepted the certificate in the browser earlier by presumably hitting the scm site directly.</span></span>  <span data-ttu-id="2b068-241">A melhor solução é usar um certificado comercial que está na cadeia de confiança do navegador.</span><span class="sxs-lookup"><span data-stu-id="2b068-241">The best solution is to use a commercial certificate that is in the browser chain of trust.</span></span>  

## <a name="ase-ip-addresses"></a><span data-ttu-id="2b068-242">Endereços IP do ASE</span><span class="sxs-lookup"><span data-stu-id="2b068-242">ASE IP addresses</span></span> ##

<span data-ttu-id="2b068-243">Um ASE tem alguns endereços IP para reconhecer.</span><span class="sxs-lookup"><span data-stu-id="2b068-243">An ASE has a few IP addresses to be aware of.</span></span> <span data-ttu-id="2b068-244">Eles são:</span><span class="sxs-lookup"><span data-stu-id="2b068-244">They are:</span></span>

- <span data-ttu-id="2b068-245">**Endereço IP público de entrada**: usado para o tráfego de aplicativo em um ASE externo e o tráfego de gerenciamento em um ASE externo e em um ASE ILB.</span><span class="sxs-lookup"><span data-stu-id="2b068-245">**Public inbound IP address**: Used for app traffic in an External ASE, and management traffic in both an External ASE and an ILB ASE.</span></span>
- <span data-ttu-id="2b068-246">**IP público de saída**: usado como o IP “de” das conexões de saída do ASE que saem da VNet, que não são roteadas por uma VPN.</span><span class="sxs-lookup"><span data-stu-id="2b068-246">**Outbound public IP**: Used as the "from" IP for outbound connections from the ASE that leave the VNet, which aren't routed down a VPN.</span></span>
- <span data-ttu-id="2b068-247">**Endereço IP do ILB**: se você usar um ASE ILB.</span><span class="sxs-lookup"><span data-stu-id="2b068-247">**ILB IP address**: If you use an ILB ASE.</span></span>
- <span data-ttu-id="2b068-248">**Endereços SSL com base em IP atribuídos ao aplicativo**: possível somente com um ASE externo e quando o SSL baseado em IP está configurado.</span><span class="sxs-lookup"><span data-stu-id="2b068-248">**App-assigned IP-based SSL addresses**: Only possible with an External ASE and when IP-based SSL is configured.</span></span>

<span data-ttu-id="2b068-249">Todos esses endereços IP ficam visíveis em um ASEv2 no portal do Azure, na interface do usuário do ASE.</span><span class="sxs-lookup"><span data-stu-id="2b068-249">All these IP addresses are easily visible in an ASEv2 in the Azure portal from the ASE UI.</span></span> <span data-ttu-id="2b068-250">Se você tiver um ASE ILB, o IP para o ILB estará listado.</span><span class="sxs-lookup"><span data-stu-id="2b068-250">If you have an ILB ASE, the IP for the ILB is listed.</span></span>

![Endereços IP][3]

### <a name="app-assigned-ip-addresses"></a><span data-ttu-id="2b068-252">Endereços IP atribuídos ao aplicativo</span><span class="sxs-lookup"><span data-stu-id="2b068-252">App-assigned IP addresses</span></span> ###

<span data-ttu-id="2b068-253">Com um ASE externo, você pode atribuir endereços IP a aplicativos individuais.</span><span class="sxs-lookup"><span data-stu-id="2b068-253">With an External ASE, you can assign IP addresses to individual apps.</span></span> <span data-ttu-id="2b068-254">Você não pode fazer isso com um ASE ILB.</span><span class="sxs-lookup"><span data-stu-id="2b068-254">You can't do that with an ILB ASE.</span></span> <span data-ttu-id="2b068-255">Para saber mais sobre como configurar seu aplicativo para ter o próprio endereço IP, confira [Associar um certificado SSL personalizado existente a aplicativos Web do Azure](../../app-service-web/app-service-web-tutorial-custom-ssl.md).</span><span class="sxs-lookup"><span data-stu-id="2b068-255">For more information on how to configure your app to have its own IP address, see [Bind an existing custom SSL certificate to Azure web apps](../../app-service-web/app-service-web-tutorial-custom-ssl.md).</span></span>

<span data-ttu-id="2b068-256">Quando um aplicativo tem seu próprio endereço SSL com base em IP, o ASE reserva duas portas para mapear para esse endereço IP.</span><span class="sxs-lookup"><span data-stu-id="2b068-256">When an app has its own IP-based SSL address, the ASE reserves two ports to map to that IP address.</span></span> <span data-ttu-id="2b068-257">Uma porta é para o tráfego HTTP e a outra porta é para HTTPS.</span><span class="sxs-lookup"><span data-stu-id="2b068-257">One port is for HTTP traffic, and the other port is for HTTPS.</span></span> <span data-ttu-id="2b068-258">Essas portas estão listadas na interface de usuário do ASE na seção de endereços IP.</span><span class="sxs-lookup"><span data-stu-id="2b068-258">Those ports are listed in the ASE UI in the IP addresses section.</span></span> <span data-ttu-id="2b068-259">O tráfego deverá ser capaz de alcançar essas portas do VIP ou os aplicativos ficarão inacessíveis.</span><span class="sxs-lookup"><span data-stu-id="2b068-259">Traffic must be able to reach those ports from the VIP or the apps are inaccessible.</span></span> <span data-ttu-id="2b068-260">É importante lembrar-se desse requisito ao configurar NSGs (grupos de segurança de rede).</span><span class="sxs-lookup"><span data-stu-id="2b068-260">This requirement is important to remember when you configure Network Security Groups (NSGs).</span></span>

## <a name="network-security-groups"></a><span data-ttu-id="2b068-261">Grupos de segurança de rede</span><span class="sxs-lookup"><span data-stu-id="2b068-261">Network Security Groups</span></span> ##

<span data-ttu-id="2b068-262">Os [Grupos de Segurança de Rede][NSGs] permitem controlar o acesso de rede em uma VNet.</span><span class="sxs-lookup"><span data-stu-id="2b068-262">[Network Security Groups][NSGs] provide the ability to control network access within a VNet.</span></span> <span data-ttu-id="2b068-263">Quando você usa o portal, há uma regra de negação implícita a prioridade mais baixa para negar tudo.</span><span class="sxs-lookup"><span data-stu-id="2b068-263">When you use the portal, there's an implicit deny rule at the lowest priority to deny everything.</span></span> <span data-ttu-id="2b068-264">O que você cria são suas regras de permissão.</span><span class="sxs-lookup"><span data-stu-id="2b068-264">What you build are your allow rules.</span></span>

<span data-ttu-id="2b068-265">Em um ASE, você não tem acesso às VMs usadas para hospedar o ASE em si.</span><span class="sxs-lookup"><span data-stu-id="2b068-265">In an ASE, you don't have access to the VMs used to host the ASE itself.</span></span> <span data-ttu-id="2b068-266">Elas estão em uma assinatura gerenciada pela Microsoft.</span><span class="sxs-lookup"><span data-stu-id="2b068-266">They're in a Microsoft-managed subscription.</span></span> <span data-ttu-id="2b068-267">Se você quiser restringir o acesso aos aplicativos no ASE, defina NSGs na sub-rede do ASE.</span><span class="sxs-lookup"><span data-stu-id="2b068-267">If you want to restrict access to the apps on the ASE, set NSGs on the ASE subnet.</span></span> <span data-ttu-id="2b068-268">Ao fazer isso, preste muita atenção às dependências do ASE.</span><span class="sxs-lookup"><span data-stu-id="2b068-268">In doing so, pay careful attention to the ASE dependencies.</span></span> <span data-ttu-id="2b068-269">Se você bloquear qualquer dependência, o ASE deixará de funcionar.</span><span class="sxs-lookup"><span data-stu-id="2b068-269">If you block any dependencies, the ASE stops working.</span></span>

<span data-ttu-id="2b068-270">Os NSGs podem ser configurados por meio do portal do Azure ou por meio do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="2b068-270">NSGs can be configured through the Azure portal or via PowerShell.</span></span> <span data-ttu-id="2b068-271">As informações aqui mostram o portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="2b068-271">The information here shows the Azure portal.</span></span> <span data-ttu-id="2b068-272">Crie e gerencie os NSGs no portal como um recurso de nível superior em **Rede**.</span><span class="sxs-lookup"><span data-stu-id="2b068-272">You create and manage NSGs in the portal as a top-level resource under **Networking**.</span></span>

<span data-ttu-id="2b068-273">Quando os requisitos de entrada e saída são levados em conta, os NSGs devem ser semelhantes aos NSGs mostrados neste exemplo.</span><span class="sxs-lookup"><span data-stu-id="2b068-273">When the inbound and outbound requirements are taken into account, the NSGs should look similar to the NSGs shown in this example.</span></span> <span data-ttu-id="2b068-274">O intervalo de endereços da VNet é _192.168.250.0/16_ e a sub-rede em que o ASE está é _192.168.251.128/25_.</span><span class="sxs-lookup"><span data-stu-id="2b068-274">The VNet address range is _192.168.250.0/16_, and the subnet that the ASE is in is _192.168.251.128/25_.</span></span>

<span data-ttu-id="2b068-275">Os primeiro dois requisitos de entrada para que o ASE funcione são mostrados no alto da lista neste exemplo.</span><span class="sxs-lookup"><span data-stu-id="2b068-275">The first two inbound requirements for the ASE to function are shown at the top of the list in this example.</span></span> <span data-ttu-id="2b068-276">Eles habilitam o gerenciamento do ASE e permitem que o ASE se comunique com ele mesmo.</span><span class="sxs-lookup"><span data-stu-id="2b068-276">They enable ASE management and allow the ASE to communicate with itself.</span></span> <span data-ttu-id="2b068-277">As outras entradas todas podem ser configuradas pelo locatário e podem controlar o acesso de rede aos aplicativos hospedados pelo ASE.</span><span class="sxs-lookup"><span data-stu-id="2b068-277">The other entries are all tenant configurable and can govern network access to the ASE-hosted applications.</span></span> 

![Regras de segurança de entrada][4]

<span data-ttu-id="2b068-279">Uma regra padrão permite que os IPs na VNet comuniquem-e com a sub-rede do ASE.</span><span class="sxs-lookup"><span data-stu-id="2b068-279">A default rule enables the IPs in the VNet to talk to the ASE subnet.</span></span> <span data-ttu-id="2b068-280">Outra regra padrão permite que o balanceador de carga, também conhecido como o VIP público, comunique-se com o ASE.</span><span class="sxs-lookup"><span data-stu-id="2b068-280">Another default rule enables the load balancer, also known as the public VIP, to communicate with the ASE.</span></span> <span data-ttu-id="2b068-281">Para ver as regras padrão, selecione **Regras padrão** ao lado do ícone **Adicionar**.</span><span class="sxs-lookup"><span data-stu-id="2b068-281">To see the default rules, select **Default rules** next to the **Add** icon.</span></span> <span data-ttu-id="2b068-282">Se você colocar uma regra para negar tudo após as regras do NSG mostradas, você impedirá o tráfego entre o VIP e o ASE.</span><span class="sxs-lookup"><span data-stu-id="2b068-282">If you put a deny everything else rule after the NSG rules shown, you prevent traffic between the VIP and the ASE.</span></span> <span data-ttu-id="2b068-283">Para evitar o tráfego proveniente de dentro da VNet, adicione suas próprias regras para permitir a entrada.</span><span class="sxs-lookup"><span data-stu-id="2b068-283">To prevent traffic coming from inside the VNet, add your own rule to allow inbound.</span></span> <span data-ttu-id="2b068-284">Usar uma fonte igual ao AzureLoadBalancer com um destino de **Qualquer** e um intervalo de portas de **\***.</span><span class="sxs-lookup"><span data-stu-id="2b068-284">Use a source equal to AzureLoadBalancer with a destination of **Any** and a port range of **\***.</span></span> <span data-ttu-id="2b068-285">Como a regra NSG é aplicada à sub-rede do ASE, você não precisa ser específico quanto ao destino.</span><span class="sxs-lookup"><span data-stu-id="2b068-285">Because the NSG rule is applied to the ASE subnet, you don't need to be specific in the destination.</span></span>

<span data-ttu-id="2b068-286">Se você tiver atribuído um endereço IP ao seu aplicativo, mantenha as portas abertas.</span><span class="sxs-lookup"><span data-stu-id="2b068-286">If you assigned an IP address to your app, make sure you keep the ports open.</span></span> <span data-ttu-id="2b068-287">Para ver as portas, selecione **Ambiente de Serviço de Aplicativo** > **Endereços IP**.</span><span class="sxs-lookup"><span data-stu-id="2b068-287">To see the ports, select **App Service Environment** > **IP addresses**.</span></span>  

<span data-ttu-id="2b068-288">Todos os itens mostrados nas regras de saída a seguir são necessários, exceto pelo último item.</span><span class="sxs-lookup"><span data-stu-id="2b068-288">All the items shown in the following outbound rules are needed, except for the last item.</span></span> <span data-ttu-id="2b068-289">Isso permite o acesso de rede às dependências do ASE que foram observadas anteriormente neste artigo.</span><span class="sxs-lookup"><span data-stu-id="2b068-289">They enable network access to the ASE dependencies that were noted earlier in this article.</span></span> <span data-ttu-id="2b068-290">Se você bloquear qualquer uma delas, o ASE deixará de funcionar.</span><span class="sxs-lookup"><span data-stu-id="2b068-290">If you block any of them, your ASE stops working.</span></span> <span data-ttu-id="2b068-291">O último item na lista permite que seu ASE se comunique com outros recursos em sua VNet.</span><span class="sxs-lookup"><span data-stu-id="2b068-291">The last item in the list enables your ASE to communicate with other resources in your VNet.</span></span>

![Regras de segurança de saída][5]

<span data-ttu-id="2b068-293">Depois que seus NSGs estiverem definidos, atribua-os à sub-rede em que está seu ASE.</span><span class="sxs-lookup"><span data-stu-id="2b068-293">After your NSGs are defined, assign them to the subnet that your ASE is on.</span></span> <span data-ttu-id="2b068-294">Se você não lembrar a rede ou sub-rede do ASE, poderá ver isso no portal de gerenciamento do ASE.</span><span class="sxs-lookup"><span data-stu-id="2b068-294">If you don’t remember the ASE VNet or subnet, you can see it from the ASE management portal.</span></span> <span data-ttu-id="2b068-295">Para atribuir o NSG à sua sub-rede, vá para a sub-rede da interface do usuário e selecione o NSG.</span><span class="sxs-lookup"><span data-stu-id="2b068-295">To assign the NSG to your subnet, go to the subnet UI and select the NSG.</span></span>

## <a name="routes"></a><span data-ttu-id="2b068-296">Rotas</span><span class="sxs-lookup"><span data-stu-id="2b068-296">Routes</span></span> ##

<span data-ttu-id="2b068-297">As rotas costumam se tornar problemáticas principalmente quando você configura a VNet com o Azure ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2b068-297">Routes become problematic most commonly when you configure your VNet with Azure ExpressRoute.</span></span> <span data-ttu-id="2b068-298">Há três tipos de rotas em uma VNet:</span><span class="sxs-lookup"><span data-stu-id="2b068-298">There are three types of routes in a VNet:</span></span>

-   <span data-ttu-id="2b068-299">Rotas do sistema</span><span class="sxs-lookup"><span data-stu-id="2b068-299">System routes</span></span>
-   <span data-ttu-id="2b068-300">Rotas BGP</span><span class="sxs-lookup"><span data-stu-id="2b068-300">BGP routes</span></span>
-   <span data-ttu-id="2b068-301">UDRs (Rotas Definidas pelo Usuário)</span><span class="sxs-lookup"><span data-stu-id="2b068-301">User-defined routes (UDRs)</span></span>

<span data-ttu-id="2b068-302">Rotas de BGP que substituem as rotas do sistema.</span><span class="sxs-lookup"><span data-stu-id="2b068-302">BGP routes override system routes.</span></span> <span data-ttu-id="2b068-303">UDRs que substituem as rotas de BGP.</span><span class="sxs-lookup"><span data-stu-id="2b068-303">UDRs override BGP routes.</span></span> <span data-ttu-id="2b068-304">Para saber mais sobre rotas em redes virtuais do Azure, confira [Visão geral das rotas definidas pelo usuário][UDRs].</span><span class="sxs-lookup"><span data-stu-id="2b068-304">For more information about routes in Azure virtual networks, see [User-defined routes overview][UDRs].</span></span>

<span data-ttu-id="2b068-305">O banco de dados SQL do Azure que usa o ASE para gerenciar o sistema tem um firewall.</span><span class="sxs-lookup"><span data-stu-id="2b068-305">The Azure SQL database that the ASE uses to manage the system has a firewall.</span></span> <span data-ttu-id="2b068-306">Ele exige que a comunicação origine-se do VIP público do ASE.</span><span class="sxs-lookup"><span data-stu-id="2b068-306">It requires communication to originate from the ASE public VIP.</span></span> <span data-ttu-id="2b068-307">Conexões ao banco de dados SQL do ASE serão negadas se forem enviadas para a conexão do ExpressRoute e outro endereço IP.</span><span class="sxs-lookup"><span data-stu-id="2b068-307">Connections to the SQL database from the ASE will be denied if they are sent down the ExpressRoute connection and out another IP address.</span></span>

<span data-ttu-id="2b068-308">Se as respostas a solicitações de gerenciamento recebidas forem enviadas para o ExpressRoute, o endereço de resposta será diferente do destino original.</span><span class="sxs-lookup"><span data-stu-id="2b068-308">If replies to incoming management requests are sent down the ExpressRoute, the reply address is different than the original destination.</span></span> <span data-ttu-id="2b068-309">Essa incompatibilidade interrompe a comunicação TCP.</span><span class="sxs-lookup"><span data-stu-id="2b068-309">This mismatch breaks the TCP communication.</span></span>

<span data-ttu-id="2b068-310">Para o ASE funcionar enquanto a VNet está configurada com um ExpressRoute, o mais fácil é:</span><span class="sxs-lookup"><span data-stu-id="2b068-310">For your ASE to work while your VNet is configured with an ExpressRoute, the easiest thing to do is:</span></span>

-   <span data-ttu-id="2b068-311">Configurar o ExpressRoute para anunciar _0.0.0.0/0_.</span><span class="sxs-lookup"><span data-stu-id="2b068-311">Configure ExpressRoute to advertise _0.0.0.0/0_.</span></span> <span data-ttu-id="2b068-312">Por padrão, ele forçar túneis para todo o tráfego de saída local.</span><span class="sxs-lookup"><span data-stu-id="2b068-312">By default, it force tunnels all outbound traffic on-premises.</span></span>
-   <span data-ttu-id="2b068-313">Crie um UDR.</span><span class="sxs-lookup"><span data-stu-id="2b068-313">Create a UDR.</span></span> <span data-ttu-id="2b068-314">Aplique-o à sub-rede que contém o ASE com um prefixo de endereço _0.0.0.0/0_ e um tipo de próximo salto de _Internet_.</span><span class="sxs-lookup"><span data-stu-id="2b068-314">Apply it to the subnet that contains the ASE with an address prefix of _0.0.0.0/0_ and a next hop type of _Internet_.</span></span>

<span data-ttu-id="2b068-315">Se você fizer essas duas alterações, tráfego destinado à Internet proveniente da sub-rede do ASE não será forçado a ir para o ExpressRoute e o ASE funcionará.</span><span class="sxs-lookup"><span data-stu-id="2b068-315">If you make these two changes, internet-destined traffic that originates from the ASE subnet isn't forced down the ExpressRoute and the ASE works.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="2b068-316">As rotas definidas em uma UDR devem ser específicas o suficiente para ter precedência sobre todas as rotas anunciadas pela configuração do ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2b068-316">The routes defined in a UDR must be specific enough to take precedence over any routes advertised by the ExpressRoute configuration.</span></span> <span data-ttu-id="2b068-317">O exemplo anterior usa o intervalo de endereços amplo 0.0.0.0/0.</span><span class="sxs-lookup"><span data-stu-id="2b068-317">The preceding example uses the broad 0.0.0.0/0 address range.</span></span> <span data-ttu-id="2b068-318">É possível que ele seja acidentalmente substituído pelos anúncios de rota que usam intervalos de endereços mais específicos.</span><span class="sxs-lookup"><span data-stu-id="2b068-318">It can potentially be accidentally overridden by route advertisements that use more specific address ranges.</span></span>
>
> <span data-ttu-id="2b068-319">Não há suporte para ASEs com configurações do ExpressRoute que façam anúncio cruzado de rotas do caminho de emparelhamento público para o caminho de emparelhamento privado.</span><span class="sxs-lookup"><span data-stu-id="2b068-319">ASEs aren't supported with ExpressRoute configurations that cross-advertise routes from the public-peering path to the private-peering path.</span></span> <span data-ttu-id="2b068-320">Configurações do ExpressRoute com emparelhamento público configurado recebem anúncios de rota da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="2b068-320">ExpressRoute configurations with public peering configured receive route advertisements from Microsoft.</span></span> <span data-ttu-id="2b068-321">Os anúncios contêm um grande conjunto de intervalos de endereços IP do Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="2b068-321">The advertisements contain a large set of Microsoft Azure IP address ranges.</span></span> <span data-ttu-id="2b068-322">Se os intervalos de endereços forem anunciados de modo cruzado no caminho de emparelhamento privado, todos os pacotes de rede de saída da sub-rede do ASE serão enviados em túnel de modo forçado a uma infraestrutura de rede local do cliente.</span><span class="sxs-lookup"><span data-stu-id="2b068-322">If the address ranges are cross-advertised on the private-peering path, all outbound network packets from the ASE's subnet are force tunneled to a customer's on-premises network infrastructure.</span></span> <span data-ttu-id="2b068-323">No momento, não há suporte para esse fluxo de rede com ASEs.</span><span class="sxs-lookup"><span data-stu-id="2b068-323">This network flow is currently not supported with ASEs.</span></span> <span data-ttu-id="2b068-324">Uma solução para esse problema é parar as rotas de anúncios cruzados do caminho de emparelhamento público para o caminho de emparelhamento privado.</span><span class="sxs-lookup"><span data-stu-id="2b068-324">One solution to this problem is to stop cross-advertising routes from the public-peering path to the private-peering path.</span></span>

<span data-ttu-id="2b068-325">Para criar UDR, siga estas etapas:</span><span class="sxs-lookup"><span data-stu-id="2b068-325">To create a UDR, follow these steps:</span></span>

1. <span data-ttu-id="2b068-326">Vá para o portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="2b068-326">Go to the Azure portal.</span></span> <span data-ttu-id="2b068-327">Selecione **Rede** > **Tabelas de Rota**.</span><span class="sxs-lookup"><span data-stu-id="2b068-327">Select **Networking** > **Route Tables**.</span></span>

2. <span data-ttu-id="2b068-328">Crie uma nova tabela de rota na mesma região da sua VNet.</span><span class="sxs-lookup"><span data-stu-id="2b068-328">Create a new route table in the same region as your VNet.</span></span>

3. <span data-ttu-id="2b068-329">Dentro da interface do usuário da tabela de rota, selecione **Rotas** > **Adicionar**.</span><span class="sxs-lookup"><span data-stu-id="2b068-329">From within your route table UI, select **Routes** > **Add**.</span></span>

4. <span data-ttu-id="2b068-330">Defina o **Tipo do próximo salto** como **Internet** e o **Prefixo de endereço** como **0.0.0.0/0**.</span><span class="sxs-lookup"><span data-stu-id="2b068-330">Set the **Next hop type** to **Internet** and the **Address prefix** to **0.0.0.0/0**.</span></span> <span data-ttu-id="2b068-331">Selecione **Salvar**.</span><span class="sxs-lookup"><span data-stu-id="2b068-331">Select **Save**.</span></span>

    <span data-ttu-id="2b068-332">Então você verá algo semelhante ao que se segue:</span><span class="sxs-lookup"><span data-stu-id="2b068-332">You then see something like the following:</span></span>

    ![Rotas funcionais][6]

5. <span data-ttu-id="2b068-334">Depois de criar a nova tabela de rota, vá para a sub-rede que contém seu ASE.</span><span class="sxs-lookup"><span data-stu-id="2b068-334">After you create the new route table, go to the subnet that contains your ASE.</span></span> <span data-ttu-id="2b068-335">Selecione sua tabela de rota na lista do portal.</span><span class="sxs-lookup"><span data-stu-id="2b068-335">Select your route table from the list in the portal.</span></span> <span data-ttu-id="2b068-336">Depois de salvar a alteração, você deve ver os NSGs e as rotas anotadas com a sua sub-rede.</span><span class="sxs-lookup"><span data-stu-id="2b068-336">After you save the change, you should then see the NSGs and routes noted with your subnet.</span></span>

    ![NSGs e rotas][7]

### <a name="deploy-into-existing-azure-virtual-networks-that-are-integrated-with-expressroute"></a><span data-ttu-id="2b068-338">Implantar em redes virtuais existentes do Azure integradas ao ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="2b068-338">Deploy into existing Azure virtual networks that are integrated with ExpressRoute</span></span> ###

<span data-ttu-id="2b068-339">Para implantar seu ASE em uma VNet integrada ao ExpressRoute, pré-configure a sub-rede do ExpressRoute em que você deseja que o ASE seja implantado.</span><span class="sxs-lookup"><span data-stu-id="2b068-339">To deploy your ASE into a VNet that's integrated with ExpressRoute, preconfigure the subnet where you want the ASE deployed.</span></span> <span data-ttu-id="2b068-340">Então use um modelo do Resource Manager para implantá-lo.</span><span class="sxs-lookup"><span data-stu-id="2b068-340">Then use a Resource Manager template to deploy it.</span></span> <span data-ttu-id="2b068-341">Para criar um ASE em uma rede virtual que já tem o ExpressRoute configurado:</span><span class="sxs-lookup"><span data-stu-id="2b068-341">To create an ASE in a VNet that already has ExpressRoute configured:</span></span>

- <span data-ttu-id="2b068-342">Crie uma sub-rede para hospedar o ASE.</span><span class="sxs-lookup"><span data-stu-id="2b068-342">Create a subnet to host the ASE.</span></span>

    > [!NOTE]
    > <span data-ttu-id="2b068-343">Nada mais pode existir na sub-rede além do ASE.</span><span class="sxs-lookup"><span data-stu-id="2b068-343">Nothing else can be in the subnet but the ASE.</span></span> <span data-ttu-id="2b068-344">Escolha um espaço de endereço que possibilite crescimento futuro.</span><span class="sxs-lookup"><span data-stu-id="2b068-344">Be sure to choose an address space that allows for future growth.</span></span> <span data-ttu-id="2b068-345">Você não poderá alterar essa configuração mais tarde.</span><span class="sxs-lookup"><span data-stu-id="2b068-345">You can't change this setting later.</span></span> <span data-ttu-id="2b068-346">Recomendamos um tamanho de `/25` com endereços de 128.</span><span class="sxs-lookup"><span data-stu-id="2b068-346">We recommend a size of `/25` with 128 addresses.</span></span>

- <span data-ttu-id="2b068-347">Crie UDRs (por exemplo, tabelas de rota) conforme descrito anteriormente e defina-as na sub-rede.</span><span class="sxs-lookup"><span data-stu-id="2b068-347">Create UDRs (for example, route tables) as described earlier, and set that on the subnet.</span></span>
- <span data-ttu-id="2b068-348">Criar o ASE usando um modelo do Resource Manager conforme descrito em [Criar um ASE usando um modelo do Resource Manager][MakeASEfromTemplate].</span><span class="sxs-lookup"><span data-stu-id="2b068-348">Create the ASE by using a Resource Manager template as described in [Create an ASE by using a Resource Manager template][MakeASEfromTemplate].</span></span>

<!--Image references-->
[1]: ./media/network_considerations_with_an_app_service_environment/networkase-overflow.png
[2]: ./media/network_considerations_with_an_app_service_environment/networkase-overflow2.png
[3]: ./media/network_considerations_with_an_app_service_environment/networkase-ipaddresses.png
[4]: ./media/network_considerations_with_an_app_service_environment/networkase-inboundnsg.png
[5]: ./media/network_considerations_with_an_app_service_environment/networkase-outboundnsg.png
[6]: ./media/network_considerations_with_an_app_service_environment/networkase-udr.png
[7]: ./media/network_considerations_with_an_app_service_environment/networkase-subnet.png

<!--Links-->
[Intro]: ./intro.md
[MakeExternalASE]: ./create-external-ase.md
[MakeASEfromTemplate]: ./create-from-template.md
[MakeILBASE]: ./create-ilb-ase.md
[ASENetwork]: ./network-info.md
[ASEReadme]: ./readme.md
[UsingASE]: ./using-an-ase.md
[UDRs]: ../../virtual-network/virtual-networks-udr-overview.md
[NSGs]: ../../virtual-network/virtual-networks-nsg.md
[ConfigureASEv1]: ../../app-service-web/app-service-web-configure-an-app-service-environment.md
[ASEv1Intro]: ../../app-service-web/app-service-app-service-environment-intro.md
[webapps]: ../../app-service-web/app-service-web-overview.md
[mobileapps]: ../../app-service-mobile/app-service-mobile-value-prop.md
[APIapps]: ../../app-service-api/app-service-api-apps-why-best-platform.md
[Functions]: ../../azure-functions/index.yml
[Pricing]: http://azure.microsoft.com/pricing/details/app-service/
[ARMOverview]: ../../azure-resource-manager/resource-group-overview.md
[ConfigureSSL]: ../../app-service-web/web-sites-purchase-ssl-web-site.md
[Kudu]: http://azure.microsoft.com/resources/videos/super-secret-kudu-debug-console-for-azure-web-sites/
[AppDeploy]: ../../app-service-web/web-sites-deploy.md
[ASEWAF]: ../../app-service-web/app-service-app-service-environment-web-application-firewall.md
[AppGW]: ../../application-gateway/application-gateway-web-application-firewall-overview.md
[ASEManagement]: ./management-addresses.md
