---
title: testes personalizadas do balanceador de aaaLoad e monitorar o status de integridade | Microsoft Docs
description: "Saiba como toouse personalizado sondas para instâncias do balanceador de carga do Azure toomonitor por trás do balanceador de carga"
services: load-balancer
documentationcenter: na
author: kumudd
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 46b152c5-6a27-4bfc-bea3-05de9ce06a57
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/24/2016
ms.author: kumud
ms.openlocfilehash: 3dfcfcd2d5cffa58b160cb38d63acffbd997d452
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="understand-load-balancer-probes"></a><span data-ttu-id="a6f63-103">Entender as investigações do balanceador de carga</span><span class="sxs-lookup"><span data-stu-id="a6f63-103">Understand load balancer probes</span></span>

<span data-ttu-id="a6f63-104">O balanceador de carga do Azure oferece integridade de saudação do hello recurso toomonitor das instâncias de servidor por meio de testes.</span><span class="sxs-lookup"><span data-stu-id="a6f63-104">Azure Load Balancer offers hello capability toomonitor hello health of server instances by using probes.</span></span> <span data-ttu-id="a6f63-105">Quando um teste falha toorespond, balanceador de carga para enviar a nova instância não íntegro toohello de conexões.</span><span class="sxs-lookup"><span data-stu-id="a6f63-105">When a probe fails toorespond, Load Balancer stops sending new connections toohello unhealthy instance.</span></span> <span data-ttu-id="a6f63-106">as conexões existentes Olá não são afetadas e novas conexões são enviadas toohealthy instâncias.</span><span class="sxs-lookup"><span data-stu-id="a6f63-106">hello existing connections are not affected, and new connections are sent toohealthy instances.</span></span>

<span data-ttu-id="a6f63-107">Funções do serviço de nuvem (funções de trabalho e da Web) usam um agente convidado para o monitoramento de investigação.</span><span class="sxs-lookup"><span data-stu-id="a6f63-107">Cloud service roles (worker roles and web roles) use a guest agent for probe monitoring.</span></span> <span data-ttu-id="a6f63-108">As investigações personalizadas de TCP ou HTTP devem ser configuradas quando você usa máquinas virtuais por trás de um Balanceador de Carga.</span><span class="sxs-lookup"><span data-stu-id="a6f63-108">TCP or HTTP custom probes must be configured when you use virtual machines behind Load Balancer.</span></span>

## <a name="understand-probe-count-and-timeout"></a><span data-ttu-id="a6f63-109">Noções básicas sobre contagem da investigação e tempo limite</span><span class="sxs-lookup"><span data-stu-id="a6f63-109">Understand probe count and timeout</span></span>

<span data-ttu-id="a6f63-110">O comportamento de investigação depende do seguinte:</span><span class="sxs-lookup"><span data-stu-id="a6f63-110">Probe behavior depends on:</span></span>

* <span data-ttu-id="a6f63-111">número de saudação de investigações bem-sucedida que permitem um toobe instância rotulada como.</span><span class="sxs-lookup"><span data-stu-id="a6f63-111">hello number of successful probes that allow an instance toobe labeled as up.</span></span>
* <span data-ttu-id="a6f63-112">número de saudação de testes com falha que causam um toobe instância rotulada como desativado.</span><span class="sxs-lookup"><span data-stu-id="a6f63-112">hello number of failed probes that cause an instance toobe labeled as down.</span></span>

<span data-ttu-id="a6f63-113">valor de tempo limite e a frequência de saudação definido em SuccessFailCount determinar se uma instância é confirmada toobe em execução ou não está em execução.</span><span class="sxs-lookup"><span data-stu-id="a6f63-113">hello timeout and frequency value set in  SuccessFailCount determine whether an instance is confirmed toobe running or not running.</span></span> <span data-ttu-id="a6f63-114">No hello portal do Azure, tempo limite de saudação é definida tootwo vezes Olá valor de frequência de saudação.</span><span class="sxs-lookup"><span data-stu-id="a6f63-114">In hello Azure portal, hello timeout is set tootwo times hello value of hello frequency.</span></span>

<span data-ttu-id="a6f63-115">configuração de teste de saudação de todas as instâncias do serviço de balanceamento de carga para um ponto de extremidade (ou seja, um conjunto com balanceamento de carga) deve ser Olá mesmo.</span><span class="sxs-lookup"><span data-stu-id="a6f63-115">hello probe configuration of all load-balanced instances for an endpoint (that is, a load-balanced set) must be hello same.</span></span> <span data-ttu-id="a6f63-116">Isso significa que você não pode ter uma configuração de teste diferentes para cada instância de função ou máquina virtual no hello mesmo hospedado serviço para uma combinação de ponto de extremidade específico.</span><span class="sxs-lookup"><span data-stu-id="a6f63-116">This means you cannot have a different probe configuration for each role instance or virtual machine in hello same hosted service for a particular endpoint combination.</span></span> <span data-ttu-id="a6f63-117">Por exemplo, cada instância deve ter portas locais e tempos limite idênticos.</span><span class="sxs-lookup"><span data-stu-id="a6f63-117">For example, each instance must have identical local ports and timeouts.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a6f63-118">Uma investigação do balanceador de carga usa o endereço IP de saudação 168.63.129.16.</span><span class="sxs-lookup"><span data-stu-id="a6f63-118">A Load Balancer probe uses hello IP address 168.63.129.16.</span></span> <span data-ttu-id="a6f63-119">Este endereço IP público facilita a recursos de plataforma de toointernal de comunicação para Olá colocar seu-proprietário-IP cenário de rede Virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="a6f63-119">This public IP address facilitates communication toointernal platform resources for hello bring-your-own-IP Azure Virtual Network scenario.</span></span> <span data-ttu-id="a6f63-120">endereço IP público 168.63.129.16 virtual Olá é usado em todas as regiões e não será alterado.</span><span class="sxs-lookup"><span data-stu-id="a6f63-120">hello virtual public IP address 168.63.129.16 is used in all regions and will not change.</span></span> <span data-ttu-id="a6f63-121">Recomendamos que você permita esse endereço IP em todas as políticas de firewall local.</span><span class="sxs-lookup"><span data-stu-id="a6f63-121">We recommend that you allow this IP address in any local firewall policies.</span></span> <span data-ttu-id="a6f63-122">Ele não deve ser considerado um risco de segurança porque uma mensagem desse endereço de origem pode apenas Olá interno plataforma Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="a6f63-122">It should not be considered a security risk because only hello internal Azure platform can source a message from that address.</span></span> <span data-ttu-id="a6f63-123">Se você não fizer isso, haverá um comportamento inesperado em uma variedade de cenários de como configurar Olá mesmo intervalo de endereços IP de 168.63.129.16 e ter duplicado endereços IP.</span><span class="sxs-lookup"><span data-stu-id="a6f63-123">If you do not do this, there will be unexpected behavior in a variety of scenarios like configuring hello same IP address range of 168.63.129.16 and having duplicated IP addresses.</span></span>

## <a name="learn-about-hello-types-of-probes"></a><span data-ttu-id="a6f63-124">Saiba mais sobre os tipos de saudação de testes</span><span class="sxs-lookup"><span data-stu-id="a6f63-124">Learn about hello types of probes</span></span>

### <a name="guest-agent-probe"></a><span data-ttu-id="a6f63-125">Investigação do agente convidado</span><span class="sxs-lookup"><span data-stu-id="a6f63-125">Guest agent probe</span></span>

<span data-ttu-id="a6f63-126">Essa investigação só está disponível para os Serviços de Nuvem do Azure.</span><span class="sxs-lookup"><span data-stu-id="a6f63-126">This probe is available for Azure Cloud Services only.</span></span> <span data-ttu-id="a6f63-127">Balanceador de carga utiliza o agente de convidado Olá Olá máquina de virtual e, em seguida, escuta e responde com uma resposta HTTP 200 Okey somente quando hello instância está no estado pronto do hello (ou seja, não em outro estado como ocupado, Reciclando ou parando).</span><span class="sxs-lookup"><span data-stu-id="a6f63-127">Load Balancer utilizes hello guest agent inside hello virtual machine, and then listens and responds with an HTTP 200 OK response only when hello instance is in hello Ready state (that is, not in another state such as Busy, Recycling, or Stopping).</span></span>

<span data-ttu-id="a6f63-128">Para obter mais informações, consulte [Configurando Olá arquivo de definição serviço (csdef) para investigações de integridade](https://msdn.microsoft.com/library/azure/ee758710.aspx) ou [começar a criar um balanceador de carga para serviços de nuvem voltados para Internet](load-balancer-get-started-internet-classic-cloud.md#check-load-balancer-health-status-for-cloud-services).</span><span class="sxs-lookup"><span data-stu-id="a6f63-128">For more information, see [Configuring hello service definition file (csdef) for health probes](https://msdn.microsoft.com/library/azure/ee758710.aspx) or [Get started creating an Internet-facing load balancer for cloud services](load-balancer-get-started-internet-classic-cloud.md#check-load-balancer-health-status-for-cloud-services).</span></span>

### <a name="what-makes-a-guest-agent-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="a6f63-129">O que faz uma investigação de agente convidado marcar uma instância como não íntegra?</span><span class="sxs-lookup"><span data-stu-id="a6f63-129">What makes a guest agent probe mark an instance as unhealthy?</span></span>

<span data-ttu-id="a6f63-130">Se o agente convidado Olá falhar toorespond com HTTP 200 Okey, marcas de Balanceador de carga Olá Olá instância como sem resposta e deixa de enviar a instância de toothat de tráfego.</span><span class="sxs-lookup"><span data-stu-id="a6f63-130">If hello guest agent fails toorespond with HTTP 200 OK, hello load balancer marks hello instance as unresponsive and stops sending traffic toothat instance.</span></span> <span data-ttu-id="a6f63-131">o balanceador de carga Olá continua a instância de saudação do tooping.</span><span class="sxs-lookup"><span data-stu-id="a6f63-131">hello load balancer continues tooping hello instance.</span></span> <span data-ttu-id="a6f63-132">Se o agente de convidado Olá responder com HTTP 200, o balanceador de carga Olá envia instância de toothat tráfego novamente.</span><span class="sxs-lookup"><span data-stu-id="a6f63-132">If hello guest agent responds with an HTTP 200, hello load balancer sends traffic toothat instance again.</span></span>

<span data-ttu-id="a6f63-133">Quando você usa uma função web, código de site Olá será executado normalmente em w3wp.exe, que não é monitorada por Olá malha do Azure ou o agente convidado.</span><span class="sxs-lookup"><span data-stu-id="a6f63-133">When you use a web role, hello website code typically runs in w3wp.exe, which is not monitored by hello Azure fabric or guest agent.</span></span> <span data-ttu-id="a6f63-134">Isso significa que falhas no w3wp.exe (por exemplo, respostas HTTP 500) não será relatado toohello agente de convidado e o balanceador de carga Olá não terão essa instância fora de rotação.</span><span class="sxs-lookup"><span data-stu-id="a6f63-134">This means that failures in w3wp.exe (for example, HTTP 500 responses) will not be reported toohello guest agent, and hello load balancer will not take that instance out of rotation.</span></span>

### <a name="http-custom-probe"></a><span data-ttu-id="a6f63-135">Investigação personalizada do HTTP</span><span class="sxs-lookup"><span data-stu-id="a6f63-135">HTTP custom probe</span></span>

<span data-ttu-id="a6f63-136">investigação de Balanceador de carga de HTTP personalizada Olá substitui saudação padrão convidado investigação de agente, que significa que você pode criar seu próprios integridade do lógica personalizada toodetermine Olá Olá da instância de função.</span><span class="sxs-lookup"><span data-stu-id="a6f63-136">hello custom HTTP Load Balancer probe overrides hello default guest agent probe, which means that you can create your own custom logic toodetermine hello health of hello role instance.</span></span> <span data-ttu-id="a6f63-137">o balanceador de carga Olá sondas de seu ponto de extremidade a cada 15 segundos, por padrão.</span><span class="sxs-lookup"><span data-stu-id="a6f63-137">hello load balancer probes your endpoint every 15 seconds, by default.</span></span> <span data-ttu-id="a6f63-138">instância de saudação é considerada toobe na rotação do balanceador de carga Olá se ele responde com HTTP 200 dentro do período de tempo limite da saudação (31 segundos por padrão).</span><span class="sxs-lookup"><span data-stu-id="a6f63-138">hello instance is considered toobe in hello load balancer rotation if it responds with an HTTP 200 within hello timeout period (31 seconds by default).</span></span>

<span data-ttu-id="a6f63-139">Isso pode ser útil se você quiser tooimplement instâncias de tooremove sua própria lógica de rotação do balanceador de carga.</span><span class="sxs-lookup"><span data-stu-id="a6f63-139">This can be useful if you want tooimplement your own logic tooremove instances from load balancer rotation.</span></span> <span data-ttu-id="a6f63-140">Por exemplo, você pode decidir tooremove uma instância se ele estiver acima de 90% de CPU e retorna um status de 200 não.</span><span class="sxs-lookup"><span data-stu-id="a6f63-140">For example, you could decide tooremove an instance if it is above 90% CPU and returns a non-200 status.</span></span> <span data-ttu-id="a6f63-141">Se você tiver funções da web que usam w3wp.exe, isso também significa você obter automática de monitoramento do seu site, porque falhas no código do site retornará uma sonda do balanceador de carga toohello status de 200 não.</span><span class="sxs-lookup"><span data-stu-id="a6f63-141">If you have web roles that use w3wp.exe, this also means you get automatic monitoring of your website, because failures in your website code will return a non-200 status toohello load balancer probe.</span></span>

> [!NOTE]
> <span data-ttu-id="a6f63-142">investigação personalizada do Hello HTTP dá suporte a caminhos relativos e somente ao protocolo HTTP.</span><span class="sxs-lookup"><span data-stu-id="a6f63-142">hello HTTP custom probe supports relative paths and HTTP protocol only.</span></span> <span data-ttu-id="a6f63-143">Não há suporte para HTTPS.</span><span class="sxs-lookup"><span data-stu-id="a6f63-143">HTTPS is not supported.</span></span>

### <a name="what-makes-an-http-custom-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="a6f63-144">O que faz uma investigação personalizada HTTP marcar uma instância como não íntegra?</span><span class="sxs-lookup"><span data-stu-id="a6f63-144">What makes an HTTP custom probe mark an instance as unhealthy?</span></span>

* <span data-ttu-id="a6f63-145">Olá aplicativo HTTP retorna um código de resposta HTTP diferente de 200 (por exemplo, 403, 404 ou 500).</span><span class="sxs-lookup"><span data-stu-id="a6f63-145">hello HTTP application returns an HTTP response code other than 200 (for example, 403, 404, or 500).</span></span> <span data-ttu-id="a6f63-146">Isso é uma confirmação positiva que Olá aplicativo instância deve ser retirada de serviço imediatamente.</span><span class="sxs-lookup"><span data-stu-id="a6f63-146">This is a positive acknowledgment that hello application instance should be taken out of service right away.</span></span>
* <span data-ttu-id="a6f63-147">Olá HTTP servidor não responder em todos os após o período de tempo limite de saudação.</span><span class="sxs-lookup"><span data-stu-id="a6f63-147">hello HTTP server does not respond at all after hello timeout period.</span></span> <span data-ttu-id="a6f63-148">Dependendo do valor de tempo limite de saudação é definido, isso pode significar que teste várias solicitações go sem resposta antes de investigação de saudação é marcada como não está em execução (ou seja, antes de SuccessFailCount testes são enviados).</span><span class="sxs-lookup"><span data-stu-id="a6f63-148">Depending on hello timeout value that is set, this might mean that multiple probe requests go unanswered before hello probe gets marked as not running (that is, before SuccessFailCount probes are sent).</span></span>
* <span data-ttu-id="a6f63-149">servidor de saudação fecha a conexão Olá por meio de uma redefinição TCP.</span><span class="sxs-lookup"><span data-stu-id="a6f63-149">hello server closes hello connection via a TCP reset.</span></span>

### <a name="tcp-custom-probe"></a><span data-ttu-id="a6f63-150">Investigação personalizada do TCP</span><span class="sxs-lookup"><span data-stu-id="a6f63-150">TCP custom probe</span></span>

<span data-ttu-id="a6f63-151">Testes TCP iniciam uma conexão executando um handshake de três vias com a porta Olá definido.</span><span class="sxs-lookup"><span data-stu-id="a6f63-151">TCP probes initiate a connection by performing a three-way handshake with hello defined port.</span></span>

### <a name="what-makes-a-tcp-custom-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="a6f63-152">O que faz uma investigação personalizada TCP marcar uma instância como não íntegra?</span><span class="sxs-lookup"><span data-stu-id="a6f63-152">What makes a TCP custom probe mark an instance as unhealthy?</span></span>

* <span data-ttu-id="a6f63-153">Olá TCP servidor não responder em todos os após o período de tempo limite de saudação.</span><span class="sxs-lookup"><span data-stu-id="a6f63-153">hello TCP server does not respond at all after hello timeout period.</span></span> <span data-ttu-id="a6f63-154">Quando o teste de saudação estiver marcado como não está em execução depende do número de saudação do teste com falha solicitações que foram configurado toogo sem resposta antes de marcar Olá investigação como não está em execução.</span><span class="sxs-lookup"><span data-stu-id="a6f63-154">When hello probe is marked as not running depends on hello number of failed probe requests that were configured toogo unanswered before marking hello probe as not running.</span></span>
* <span data-ttu-id="a6f63-155">investigação de saudação recebe um TCP redefinir Olá da instância de função.</span><span class="sxs-lookup"><span data-stu-id="a6f63-155">hello probe receives a TCP reset from hello role instance.</span></span>

<span data-ttu-id="a6f63-156">Para saber mais sobre como configurar uma investigação de integridade HTTP ou uma investigação de TCP, confira [Introdução à criação de um balanceador de carga para a Internet no Resource Manager usando o PowerShell](load-balancer-get-started-internet-arm-ps.md).</span><span class="sxs-lookup"><span data-stu-id="a6f63-156">For more information about configuring an HTTP health probe or a TCP probe, see [Get started creating an Internet-facing load balancer in Resource Manager using PowerShell](load-balancer-get-started-internet-arm-ps.md).</span></span>

## <a name="add-healthy-instances-back-into-load-balancer-rotation"></a><span data-ttu-id="a6f63-157">Adicionar instâncias íntegras de volta à rotação do balanceador de carga</span><span class="sxs-lookup"><span data-stu-id="a6f63-157">Add healthy instances back into load balancer rotation</span></span>

<span data-ttu-id="a6f63-158">Testes TCP e HTTP são considerados íntegros e marcar a instância de função hello como Íntegro quando:</span><span class="sxs-lookup"><span data-stu-id="a6f63-158">TCP and HTTP probes are considered healthy and mark hello role instance as healthy when:</span></span>

* <span data-ttu-id="a6f63-159">o balanceador de carga Olá obtém uma investigação positivo Olá primeiro tempo Olá que VM é inicializado.</span><span class="sxs-lookup"><span data-stu-id="a6f63-159">hello load balancer gets a positive probe hello first time hello VM boots.</span></span>
* <span data-ttu-id="a6f63-160">número Olá SuccessFailCount (descrito anteriormente) define o valor de saudação do bem-sucedida investigações que são necessário toomark instância de função hello como íntegro.</span><span class="sxs-lookup"><span data-stu-id="a6f63-160">hello number SuccessFailCount (described earlier) defines hello value of successful probes that are required toomark hello role instance as healthy.</span></span> <span data-ttu-id="a6f63-161">Se uma instância de função foi removida, o número de Olá de investigações bem-sucedida, sucessivas deve igual a ou exceder o valor Olá SuccessFailCount toomark Olá da instância de função como em execução.</span><span class="sxs-lookup"><span data-stu-id="a6f63-161">If a role instance was removed, hello number of successful, successive probes must equal or exceed hello value of SuccessFailCount toomark hello role instance as running.</span></span>

> [!NOTE]
> <span data-ttu-id="a6f63-162">Se a integridade de saudação de uma instância de função está flutuando, balanceador de carga Olá aguarda mais tempo antes de colocar a instância de função hello novamente em estado íntegro hello.</span><span class="sxs-lookup"><span data-stu-id="a6f63-162">If hello health of a role instance is fluctuating, hello load balancer waits longer before putting hello role instance back in hello healthy state.</span></span> <span data-ttu-id="a6f63-163">Isso é feito por meio de usuário de saudação tooprotect política e a infraestrutura de saudação.</span><span class="sxs-lookup"><span data-stu-id="a6f63-163">This is done via policy tooprotect hello user and hello infrastructure.</span></span>

## <a name="use-log-analytics-for-load-balancer"></a><span data-ttu-id="a6f63-164">Usar análise de log para o Balanceador de Carga</span><span class="sxs-lookup"><span data-stu-id="a6f63-164">Use log analytics for Load Balancer</span></span>

<span data-ttu-id="a6f63-165">Você pode usar [de análise de log para o balanceador de carga](load-balancer-monitor-log.md) toocheck na contagem de status e a investigação de integridade de investigação do hello.</span><span class="sxs-lookup"><span data-stu-id="a6f63-165">You can use [log analytics for Load Balancer](load-balancer-monitor-log.md) toocheck on hello probe health status and probe count.</span></span> <span data-ttu-id="a6f63-166">Registro em log pode ser usado com as estatísticas de tooprovide Power BI ou o Azure Operational Insights sobre o status de integridade do balanceador de carga.</span><span class="sxs-lookup"><span data-stu-id="a6f63-166">Logging can be used with Power BI or Azure Operational Insights tooprovide statistics about Load Balancer health status.</span></span>
