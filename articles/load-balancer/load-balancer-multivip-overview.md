---
title: "Múltiplos VIPs para o Azure Load Balancer | Microsoft Docs"
description: "Visão geral de Vários VIPs no Azure Load Balancer"
services: load-balancer
documentationcenter: na
author: chkuhtz
manager: narayan
editor: 
ms.assetid: 748e50cd-3087-4c2e-a9e1-ac0ecce4f869
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 08/11/2016
ms.author: chkuhtz
ms.openlocfilehash: d9e88b859020be2a96a57a01e5624052ed134b64
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="multiple-vips-for-azure-load-balancer"></a><span data-ttu-id="5f32b-103">Múltiplos VIPs para o Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="5f32b-103">Multiple VIPs for Azure Load Balancer</span></span>

<span data-ttu-id="5f32b-104">O Azure Load Balancer permite que você equilibre a carga de serviços em várias portas, vários endereços IP ou ambos.</span><span class="sxs-lookup"><span data-stu-id="5f32b-104">Azure Load Balancer allows you to load balance services on multiple ports, multiple IP addresses, or both.</span></span> <span data-ttu-id="5f32b-105">Você pode usar definições de balanceador de carga públicas e internas para fluxos de balanceamento de carga em um conjunto de VMs.</span><span class="sxs-lookup"><span data-stu-id="5f32b-105">You can use public and internal load balancer definitions to load balance flows across a set of VMs.</span></span>

<span data-ttu-id="5f32b-106">Este artigo descreve os conceitos básicos dessa capacidade, conceitos importantes e restrições.</span><span class="sxs-lookup"><span data-stu-id="5f32b-106">This article describes the fundamentals of this ability, important concepts, and constraints.</span></span> <span data-ttu-id="5f32b-107">Se você pretende expor serviços em um endereço IP, encontre instruções simplificadas para configurações do balanceador de carga [público](load-balancer-get-started-internet-portal.md) ou [interno](load-balancer-get-started-ilb-arm-portal.md).</span><span class="sxs-lookup"><span data-stu-id="5f32b-107">If you only intend to expose services on one IP address, you can find simplified instructions for [public](load-balancer-get-started-internet-portal.md) or [internal](load-balancer-get-started-ilb-arm-portal.md) load balancer configurations.</span></span> <span data-ttu-id="5f32b-108">A adição de vários VIPs é um complemento a uma única configuração de VIP.</span><span class="sxs-lookup"><span data-stu-id="5f32b-108">Adding Multiple VIPs is incremental to a single VIP configuration.</span></span> <span data-ttu-id="5f32b-109">Com os conceitos deste artigo, você pode expandir uma configuração simplificada quanto quiser.</span><span class="sxs-lookup"><span data-stu-id="5f32b-109">Using the concepts in this article, you can expand a simplified configuration at any time.</span></span>

<span data-ttu-id="5f32b-110">Quando você define um Azure Load Balancer, uma configuração front-end e back-end são conectadas às regras.</span><span class="sxs-lookup"><span data-stu-id="5f32b-110">When you define an Azure Load Balancer, a frontend and a backend configuration are connected with rules.</span></span> <span data-ttu-id="5f32b-111">A investigação de integridade referenciada pela regra é usada para determinar como os novos fluxos serão enviados para um nó no pool de back-end.</span><span class="sxs-lookup"><span data-stu-id="5f32b-111">The health probe referenced by the rule is used to determine how new flows are sent to a node in the backend pool.</span></span> <span data-ttu-id="5f32b-112">O front-end é definido por um VIP (IP Virtual), que é uma tupla de 3 composta por um endereço IP (público ou interno), um protocolo de transporte (UDP ou TCP) e um número de porta.</span><span class="sxs-lookup"><span data-stu-id="5f32b-112">The frontend is defined by a Virtual IP (VIP), which is a 3-tuple comprised of an IP address (public or internal), a transport protocol (UDP or TCP), and a port number.</span></span> <span data-ttu-id="5f32b-113">Um DIP é um endereço IP em uma NIC virtual do Azure anexado a uma VM no pool de back-end.</span><span class="sxs-lookup"><span data-stu-id="5f32b-113">A DIP is an IP address on an Azure virtual NIC attached to a VM in the backend pool.</span></span>

<span data-ttu-id="5f32b-114">A tabela a seguir contém alguns exemplos de configurações de front-end:</span><span class="sxs-lookup"><span data-stu-id="5f32b-114">The following table contains some example frontend configurations:</span></span>

| <span data-ttu-id="5f32b-115">VIP</span><span class="sxs-lookup"><span data-stu-id="5f32b-115">VIP</span></span> | <span data-ttu-id="5f32b-116">Endereço IP</span><span class="sxs-lookup"><span data-stu-id="5f32b-116">IP address</span></span> | <span data-ttu-id="5f32b-117">protocol</span><span class="sxs-lookup"><span data-stu-id="5f32b-117">protocol</span></span> | <span data-ttu-id="5f32b-118">porta</span><span class="sxs-lookup"><span data-stu-id="5f32b-118">port</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="5f32b-119">1</span><span class="sxs-lookup"><span data-stu-id="5f32b-119">1</span></span> |<span data-ttu-id="5f32b-120">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="5f32b-120">65.52.0.1</span></span> |<span data-ttu-id="5f32b-121">TCP</span><span class="sxs-lookup"><span data-stu-id="5f32b-121">TCP</span></span> |<span data-ttu-id="5f32b-122">80</span><span class="sxs-lookup"><span data-stu-id="5f32b-122">80</span></span> |
| <span data-ttu-id="5f32b-123">2</span><span class="sxs-lookup"><span data-stu-id="5f32b-123">2</span></span> |<span data-ttu-id="5f32b-124">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="5f32b-124">65.52.0.1</span></span> |<span data-ttu-id="5f32b-125">TCP</span><span class="sxs-lookup"><span data-stu-id="5f32b-125">TCP</span></span> |<span data-ttu-id="5f32b-126">*8080*</span><span class="sxs-lookup"><span data-stu-id="5f32b-126">*8080*</span></span> |
| <span data-ttu-id="5f32b-127">3</span><span class="sxs-lookup"><span data-stu-id="5f32b-127">3</span></span> |<span data-ttu-id="5f32b-128">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="5f32b-128">65.52.0.1</span></span> |<span data-ttu-id="5f32b-129">*UDP*</span><span class="sxs-lookup"><span data-stu-id="5f32b-129">*UDP*</span></span> |<span data-ttu-id="5f32b-130">80</span><span class="sxs-lookup"><span data-stu-id="5f32b-130">80</span></span> |
| <span data-ttu-id="5f32b-131">4</span><span class="sxs-lookup"><span data-stu-id="5f32b-131">4</span></span> |<span data-ttu-id="5f32b-132">*65.52.0.2*</span><span class="sxs-lookup"><span data-stu-id="5f32b-132">*65.52.0.2*</span></span> |<span data-ttu-id="5f32b-133">TCP</span><span class="sxs-lookup"><span data-stu-id="5f32b-133">TCP</span></span> |<span data-ttu-id="5f32b-134">80</span><span class="sxs-lookup"><span data-stu-id="5f32b-134">80</span></span> |

<span data-ttu-id="5f32b-135">A tabela mostra quatro front-ends diferentes.</span><span class="sxs-lookup"><span data-stu-id="5f32b-135">The table shows four different frontends.</span></span> <span data-ttu-id="5f32b-136">Os front-ends 1, 2 e 3 são um único VIP com várias regras.</span><span class="sxs-lookup"><span data-stu-id="5f32b-136">Frontends #1, #2 and #3 are a single VIP with multiple rules.</span></span> <span data-ttu-id="5f32b-137">O mesmo endereço IP é usado, mas a porta ou o protocolo é diferente para cada front-end.</span><span class="sxs-lookup"><span data-stu-id="5f32b-137">The same IP address is used but the port or protocol is different for each frontend.</span></span> <span data-ttu-id="5f32b-138">Os front-ends 1 e 4 são um exemplo de Vários VIPs, onde o mesmo protocolo de front-end e porta são reutilizados em vários VIPs.</span><span class="sxs-lookup"><span data-stu-id="5f32b-138">Frontends #1 and #4 are an example of Multiple VIPs, where the same frontend protocol and port are reused across multiple VIPs.</span></span>

<span data-ttu-id="5f32b-139">O Azure Load Balancer fornece flexibilidade na definição de regras de balanceamento de carga.</span><span class="sxs-lookup"><span data-stu-id="5f32b-139">Azure Load Balancer provides flexibility in defining the load balancing rules.</span></span> <span data-ttu-id="5f32b-140">Uma regra declara como um endereço e porta no front-end são mapeados para o endereço de destino e porta no back-end.</span><span class="sxs-lookup"><span data-stu-id="5f32b-140">A rule declares how an address and port on the frontend is mapped to the destination address and port on the backend.</span></span> <span data-ttu-id="5f32b-141">A reutilização de portas de back-end nas regras depende do tipo de regra.</span><span class="sxs-lookup"><span data-stu-id="5f32b-141">Whether or not backend ports are reused across rules depends on the type of the rule.</span></span> <span data-ttu-id="5f32b-142">Cada tipo de regra tem requisitos específicos que podem afetar a configuração do host o design da investigação.</span><span class="sxs-lookup"><span data-stu-id="5f32b-142">Each type of rule has specific requirements that can affect host configuration and probe design.</span></span> <span data-ttu-id="5f32b-143">Há dois tipos de regras:</span><span class="sxs-lookup"><span data-stu-id="5f32b-143">There are two types of rules:</span></span>

1. <span data-ttu-id="5f32b-144">A regra padrão sem reutilização de porta de back-end</span><span class="sxs-lookup"><span data-stu-id="5f32b-144">The default rule with no backend port reuse</span></span>
2. <span data-ttu-id="5f32b-145">A regra de IP Flutuante onde as portas de back-end são reutilizadas</span><span class="sxs-lookup"><span data-stu-id="5f32b-145">The Floating IP rule where backend ports are reused</span></span>

<span data-ttu-id="5f32b-146">O Azure Load Balancer permite que você misture os dois tipos de regra na mesma configuração de balanceador de carga.</span><span class="sxs-lookup"><span data-stu-id="5f32b-146">Azure Load Balancer allows you to mix both rule types on the same load balancer configuration.</span></span> <span data-ttu-id="5f32b-147">O balanceador de carga pode usá-los simultaneamente para uma determinada VM ou qualquer combinação, desde que você concorde com as restrições da regra.</span><span class="sxs-lookup"><span data-stu-id="5f32b-147">The load balancer can use them simultaneously for a given VM, or any combination, as long as you abide by the constraints of the rule.</span></span> <span data-ttu-id="5f32b-148">O tipo de regra que você escolhe depende dos requisitos de seu aplicativo e da complexidade do suporte a essa configuração.</span><span class="sxs-lookup"><span data-stu-id="5f32b-148">Which rule type you choose depends on the requirements of your application and the complexity of supporting that configuration.</span></span> <span data-ttu-id="5f32b-149">Você deve avaliar quais tipos de regras são melhores para seu cenário.</span><span class="sxs-lookup"><span data-stu-id="5f32b-149">You should evaluate which rule types are best for your scenario.</span></span>

<span data-ttu-id="5f32b-150">Vamos explorar esses cenários ainda mais, começando com o comportamento padrão.</span><span class="sxs-lookup"><span data-stu-id="5f32b-150">We explore these scenarios further by starting with the default behavior.</span></span>

## <a name="rule-type-1-no-backend-port-reuse"></a><span data-ttu-id="5f32b-151">Tipo de regra 1: nenhuma reutilização de porta de back-end</span><span class="sxs-lookup"><span data-stu-id="5f32b-151">Rule type #1: No backend port reuse</span></span>

![Ilustração de vários VIPs](./media/load-balancer-multivip-overview/load-balancer-multivip.png)

<span data-ttu-id="5f32b-153">Nesse cenário, os VIPs de front-end serão configurados da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="5f32b-153">In this scenario, the frontend VIPs are configured as follows:</span></span>

| <span data-ttu-id="5f32b-154">VIP</span><span class="sxs-lookup"><span data-stu-id="5f32b-154">VIP</span></span> | <span data-ttu-id="5f32b-155">Endereço IP</span><span class="sxs-lookup"><span data-stu-id="5f32b-155">IP address</span></span> | <span data-ttu-id="5f32b-156">protocol</span><span class="sxs-lookup"><span data-stu-id="5f32b-156">protocol</span></span> | <span data-ttu-id="5f32b-157">porta</span><span class="sxs-lookup"><span data-stu-id="5f32b-157">port</span></span> |
| --- | --- | --- | --- |
| ![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="5f32b-159">1</span><span class="sxs-lookup"><span data-stu-id="5f32b-159">1</span></span> |<span data-ttu-id="5f32b-160">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="5f32b-160">65.52.0.1</span></span> |<span data-ttu-id="5f32b-161">TCP</span><span class="sxs-lookup"><span data-stu-id="5f32b-161">TCP</span></span> |<span data-ttu-id="5f32b-162">80</span><span class="sxs-lookup"><span data-stu-id="5f32b-162">80</span></span> |
| ![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="5f32b-164">2</span><span class="sxs-lookup"><span data-stu-id="5f32b-164">2</span></span> |<span data-ttu-id="5f32b-165">*65.52.0.2*</span><span class="sxs-lookup"><span data-stu-id="5f32b-165">*65.52.0.2*</span></span> |<span data-ttu-id="5f32b-166">TCP</span><span class="sxs-lookup"><span data-stu-id="5f32b-166">TCP</span></span> |<span data-ttu-id="5f32b-167">80</span><span class="sxs-lookup"><span data-stu-id="5f32b-167">80</span></span> |

<span data-ttu-id="5f32b-168">O DIP é o destino do fluxo de entrada.</span><span class="sxs-lookup"><span data-stu-id="5f32b-168">The DIP is the destination of the inbound flow.</span></span> <span data-ttu-id="5f32b-169">No pool de back-end, cada VM expõe o serviço desejado em uma porta exclusiva em um DIP.</span><span class="sxs-lookup"><span data-stu-id="5f32b-169">In the backend pool, each VM exposes the desired service on a unique port on a DIP.</span></span> <span data-ttu-id="5f32b-170">Esse serviço é associado ao front-end por meio de uma definição de regra.</span><span class="sxs-lookup"><span data-stu-id="5f32b-170">This service is associated with the frontend through a rule definition.</span></span>

<span data-ttu-id="5f32b-171">Definimos duas regras:</span><span class="sxs-lookup"><span data-stu-id="5f32b-171">We define two rules:</span></span>

| <span data-ttu-id="5f32b-172">Regra</span><span class="sxs-lookup"><span data-stu-id="5f32b-172">Rule</span></span> | <span data-ttu-id="5f32b-173">Mapear front-end</span><span class="sxs-lookup"><span data-stu-id="5f32b-173">Map frontend</span></span> | <span data-ttu-id="5f32b-174">Para pool de back-end</span><span class="sxs-lookup"><span data-stu-id="5f32b-174">To backend pool</span></span> |
| --- | --- | --- |
| <span data-ttu-id="5f32b-175">1</span><span class="sxs-lookup"><span data-stu-id="5f32b-175">1</span></span> |![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="5f32b-177">VIP1:80</span><span class="sxs-lookup"><span data-stu-id="5f32b-177">VIP1:80</span></span> |![back-end](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="5f32b-179">DIP1:80,</span><span class="sxs-lookup"><span data-stu-id="5f32b-179">DIP1:80,</span></span> ![back-end](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="5f32b-181">DIP2:80</span><span class="sxs-lookup"><span data-stu-id="5f32b-181">DIP2:80</span></span> |
| <span data-ttu-id="5f32b-182">2</span><span class="sxs-lookup"><span data-stu-id="5f32b-182">2</span></span> |![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="5f32b-184">VIP2:80</span><span class="sxs-lookup"><span data-stu-id="5f32b-184">VIP2:80</span></span> |![back-end](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="5f32b-186">DIP1:81,</span><span class="sxs-lookup"><span data-stu-id="5f32b-186">DIP1:81,</span></span> ![back-end](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="5f32b-188">DIP2:81</span><span class="sxs-lookup"><span data-stu-id="5f32b-188">DIP2:81</span></span> |

<span data-ttu-id="5f32b-189">O mapeamento completo no Azure Load Balancer agora é o seguinte:</span><span class="sxs-lookup"><span data-stu-id="5f32b-189">The complete mapping in Azure Load Balancer is now as follows:</span></span>

| <span data-ttu-id="5f32b-190">Regra</span><span class="sxs-lookup"><span data-stu-id="5f32b-190">Rule</span></span> | <span data-ttu-id="5f32b-191">Endereço IP VIP</span><span class="sxs-lookup"><span data-stu-id="5f32b-191">VIP IP address</span></span> | <span data-ttu-id="5f32b-192">protocol</span><span class="sxs-lookup"><span data-stu-id="5f32b-192">protocol</span></span> | <span data-ttu-id="5f32b-193">porta</span><span class="sxs-lookup"><span data-stu-id="5f32b-193">port</span></span> | <span data-ttu-id="5f32b-194">Destino</span><span class="sxs-lookup"><span data-stu-id="5f32b-194">Destination</span></span> | <span data-ttu-id="5f32b-195">porta</span><span class="sxs-lookup"><span data-stu-id="5f32b-195">port</span></span> |
| --- | --- | --- | --- | --- | --- |
| ![Regra](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="5f32b-197">1</span><span class="sxs-lookup"><span data-stu-id="5f32b-197">1</span></span> |<span data-ttu-id="5f32b-198">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="5f32b-198">65.52.0.1</span></span> |<span data-ttu-id="5f32b-199">TCP</span><span class="sxs-lookup"><span data-stu-id="5f32b-199">TCP</span></span> |<span data-ttu-id="5f32b-200">80</span><span class="sxs-lookup"><span data-stu-id="5f32b-200">80</span></span> |<span data-ttu-id="5f32b-201">Endereço IP DIP</span><span class="sxs-lookup"><span data-stu-id="5f32b-201">DIP IP Address</span></span> |<span data-ttu-id="5f32b-202">80</span><span class="sxs-lookup"><span data-stu-id="5f32b-202">80</span></span> |
| ![Regra](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="5f32b-204">2</span><span class="sxs-lookup"><span data-stu-id="5f32b-204">2</span></span> |<span data-ttu-id="5f32b-205">65.52.0.2</span><span class="sxs-lookup"><span data-stu-id="5f32b-205">65.52.0.2</span></span> |<span data-ttu-id="5f32b-206">TCP</span><span class="sxs-lookup"><span data-stu-id="5f32b-206">TCP</span></span> |<span data-ttu-id="5f32b-207">80</span><span class="sxs-lookup"><span data-stu-id="5f32b-207">80</span></span> |<span data-ttu-id="5f32b-208">Endereço IP DIP</span><span class="sxs-lookup"><span data-stu-id="5f32b-208">DIP IP Address</span></span> |<span data-ttu-id="5f32b-209">81</span><span class="sxs-lookup"><span data-stu-id="5f32b-209">81</span></span> |

<span data-ttu-id="5f32b-210">Cada regra deve produzir um fluxo com uma combinação exclusiva de endereço IP de destino e porta de destino.</span><span class="sxs-lookup"><span data-stu-id="5f32b-210">Each rule must produce a flow with a unique combination of destination IP address and destination port.</span></span> <span data-ttu-id="5f32b-211">Ao variar a porta de destino do fluxo, várias regras podem proporcionar fluxos ao mesmo DIP em portas diferentes.</span><span class="sxs-lookup"><span data-stu-id="5f32b-211">By varying the destination port of the flow, multiple rules can deliver flows to the same DIP on different ports.</span></span>

<span data-ttu-id="5f32b-212">Investigações de integridade são sempre direcionadas ao DIP de uma VM.</span><span class="sxs-lookup"><span data-stu-id="5f32b-212">Health probes are always directed to the DIP of a VM.</span></span> <span data-ttu-id="5f32b-213">É necessário garantir que sua investigação reflita a integridade da VM.</span><span class="sxs-lookup"><span data-stu-id="5f32b-213">You must ensure you that your probe reflects the health of the VM.</span></span>

## <a name="rule-type-2-backend-port-reuse-by-using-floating-ip"></a><span data-ttu-id="5f32b-214">Tipo de regra 2: reutilização de porta de back-end usando o IP Flutuante</span><span class="sxs-lookup"><span data-stu-id="5f32b-214">Rule type #2: backend port reuse by using Floating IP</span></span>

<span data-ttu-id="5f32b-215">O Azure Load Balancer oferece a flexibilidade para reutilizar a porta front-end em vários VIPs, independentemente do tipo de regra usado.</span><span class="sxs-lookup"><span data-stu-id="5f32b-215">Azure Load Balancer provides the flexibility to reuse the frontend port across multiple VIPs regardless of the rule type used.</span></span> <span data-ttu-id="5f32b-216">Além disso, alguns cenários de aplicativos preferem ou exigem a utilização da mesma porta por várias instâncias do aplicativo em uma única VM no pool de back-end.</span><span class="sxs-lookup"><span data-stu-id="5f32b-216">Additionally, some application scenarios prefer or require the same port to be used by multiple application instances on a single VM in the backend pool.</span></span> <span data-ttu-id="5f32b-217">Exemplos comuns de reutilização de porta incluem clusters de alta disponibilidade, dispositivos virtuais de rede e exposição de vários pontos de extremidade TLS sem nova criptografia.</span><span class="sxs-lookup"><span data-stu-id="5f32b-217">Common examples of port reuse include clustering for high availability, network virtual appliances, and exposing multiple TLS endpoints without re-encryption.</span></span>

<span data-ttu-id="5f32b-218">Se você quiser reutilizar a porta de back-end em várias regras, habilite o IP Flutuante na definição da regra.</span><span class="sxs-lookup"><span data-stu-id="5f32b-218">If you want to reuse the backend port across multiple rules, you must enable Floating IP in the rule definition.</span></span>

<span data-ttu-id="5f32b-219">IP Flutuante é uma parte do que é conhecido como DSR (retorno de servidor direto).</span><span class="sxs-lookup"><span data-stu-id="5f32b-219">Floating IP is a portion of what is known as Direct Server Return (DSR).</span></span> <span data-ttu-id="5f32b-220">O DSR é formado por duas partes: uma topologia de fluxo e um esquema de mapeamento de endereço IP.</span><span class="sxs-lookup"><span data-stu-id="5f32b-220">DSR consists of two parts: a flow topology and an IP address mapping scheme.</span></span> <span data-ttu-id="5f32b-221">Em um nível de plataforma, o Azure Load Balancer sempre opera em uma topologia de fluxo de DSR, independentemente de o IP Flutuante estar habilitado ou não.</span><span class="sxs-lookup"><span data-stu-id="5f32b-221">At a platform level, Azure Load Balancer always operates in a DSR flow topology regardless of whether Floating IP is enabled or not.</span></span> <span data-ttu-id="5f32b-222">Isso significa que a parte de saída de um fluxo é sempre reescrita corretamente para fluir diretamente de volta para a origem.</span><span class="sxs-lookup"><span data-stu-id="5f32b-222">This means that the outbound part of a flow is always correctly rewritten to flow directly back to the origin.</span></span>

<span data-ttu-id="5f32b-223">Com o tipo de regra padrão, o Azure expõe um esquema de mapeamento de endereço IP de balanceamento de carga tradicional para facilitar o uso.</span><span class="sxs-lookup"><span data-stu-id="5f32b-223">With the default rule type, Azure exposes a traditional load balancing IP address mapping scheme for ease of use.</span></span> <span data-ttu-id="5f32b-224">A habilitação do IP Flutuante altera o esquema de mapeamento de endereço IP a fim de permitir flexibilidade adicional, conforme explicado abaixo.</span><span class="sxs-lookup"><span data-stu-id="5f32b-224">Enabling Floating IP changes the IP address mapping scheme to allow for additional flexibility as explained below.</span></span>

<span data-ttu-id="5f32b-225">O diagrama a seguir ilustra essa configuração:</span><span class="sxs-lookup"><span data-stu-id="5f32b-225">The following diagram illustrates this configuration:</span></span>

![Ilustração de vários VIPs](./media/load-balancer-multivip-overview/load-balancer-multivip-dsr.png)

<span data-ttu-id="5f32b-227">Para este cenário, todas as VMs no pool de back-end têm três interfaces de rede:</span><span class="sxs-lookup"><span data-stu-id="5f32b-227">For this scenario, every VM in the backend pool has three network interfaces:</span></span>

* <span data-ttu-id="5f32b-228">DIP: uma NIC Virtual associada à VM (configuração de IP do recurso NIC do Azure)</span><span class="sxs-lookup"><span data-stu-id="5f32b-228">DIP: a Virtual NIC associated with the VM (IP configuration of Azure's NIC resource)</span></span>
* <span data-ttu-id="5f32b-229">VIP1: uma interface de loopback no sistema operacional convidado que está configurado com o endereço IP do VIP1</span><span class="sxs-lookup"><span data-stu-id="5f32b-229">VIP1: a loopback interface within guest OS that is configured with IP address of VIP1</span></span>
* <span data-ttu-id="5f32b-230">VIP2: uma interface de loopback no sistema operacional convidado que está configurado com o endereço IP do VIP2</span><span class="sxs-lookup"><span data-stu-id="5f32b-230">VIP2: a loopback interface within guest OS that is configured with IP address of VIP2</span></span>

> [!IMPORTANT]
> <span data-ttu-id="5f32b-231">A configuração das interfaces de lógica é executada no sistema operacional convidado.</span><span class="sxs-lookup"><span data-stu-id="5f32b-231">The configuration of the logical interfaces is performed within the guest OS.</span></span> <span data-ttu-id="5f32b-232">Essa configuração não é executada ou gerenciada pelo Azure.</span><span class="sxs-lookup"><span data-stu-id="5f32b-232">This configuration is not performed or managed by Azure.</span></span> <span data-ttu-id="5f32b-233">Sem essa configuração, as regras não funcionarão.</span><span class="sxs-lookup"><span data-stu-id="5f32b-233">Without this configuration, the rules will not function.</span></span> <span data-ttu-id="5f32b-234">As definições de investigação de integridade usam o DIP da VM em vez do VIP lógico.</span><span class="sxs-lookup"><span data-stu-id="5f32b-234">Health probe definitions use the DIP of the VM rather than the logical VIP.</span></span> <span data-ttu-id="5f32b-235">Portanto, o serviço deve fornecer respostas de investigação em uma porta DIP que refletem o status do serviço oferecido no VIP lógico.</span><span class="sxs-lookup"><span data-stu-id="5f32b-235">Therefore, your service must provide probe responses on a DIP port that reflect the status of the service offered on the logical VIP.</span></span>

<span data-ttu-id="5f32b-236">Vamos supor a mesma configuração de front-end que no cenário anterior:</span><span class="sxs-lookup"><span data-stu-id="5f32b-236">Let's assume the same frontend configuration as in the previous scenario:</span></span>

| <span data-ttu-id="5f32b-237">VIP</span><span class="sxs-lookup"><span data-stu-id="5f32b-237">VIP</span></span> | <span data-ttu-id="5f32b-238">Endereço IP</span><span class="sxs-lookup"><span data-stu-id="5f32b-238">IP address</span></span> | <span data-ttu-id="5f32b-239">protocol</span><span class="sxs-lookup"><span data-stu-id="5f32b-239">protocol</span></span> | <span data-ttu-id="5f32b-240">porta</span><span class="sxs-lookup"><span data-stu-id="5f32b-240">port</span></span> |
| --- | --- | --- | --- |
| ![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="5f32b-242">1</span><span class="sxs-lookup"><span data-stu-id="5f32b-242">1</span></span> |<span data-ttu-id="5f32b-243">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="5f32b-243">65.52.0.1</span></span> |<span data-ttu-id="5f32b-244">TCP</span><span class="sxs-lookup"><span data-stu-id="5f32b-244">TCP</span></span> |<span data-ttu-id="5f32b-245">80</span><span class="sxs-lookup"><span data-stu-id="5f32b-245">80</span></span> |
| ![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="5f32b-247">2</span><span class="sxs-lookup"><span data-stu-id="5f32b-247">2</span></span> |<span data-ttu-id="5f32b-248">*65.52.0.2*</span><span class="sxs-lookup"><span data-stu-id="5f32b-248">*65.52.0.2*</span></span> |<span data-ttu-id="5f32b-249">TCP</span><span class="sxs-lookup"><span data-stu-id="5f32b-249">TCP</span></span> |<span data-ttu-id="5f32b-250">80</span><span class="sxs-lookup"><span data-stu-id="5f32b-250">80</span></span> |

<span data-ttu-id="5f32b-251">Definimos duas regras:</span><span class="sxs-lookup"><span data-stu-id="5f32b-251">We define two rules:</span></span>

| <span data-ttu-id="5f32b-252">Regra</span><span class="sxs-lookup"><span data-stu-id="5f32b-252">Rule</span></span> | <span data-ttu-id="5f32b-253">Mapear front-end</span><span class="sxs-lookup"><span data-stu-id="5f32b-253">Map frontend</span></span> | <span data-ttu-id="5f32b-254">Para pool de back-end</span><span class="sxs-lookup"><span data-stu-id="5f32b-254">To backend pool</span></span> |
| --- | --- | --- |
| <span data-ttu-id="5f32b-255">1</span><span class="sxs-lookup"><span data-stu-id="5f32b-255">1</span></span> |![Regra](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="5f32b-257">VIP1:80</span><span class="sxs-lookup"><span data-stu-id="5f32b-257">VIP1:80</span></span> |![back-end](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="5f32b-259">VIP1:80 (na VM1 e VM2)</span><span class="sxs-lookup"><span data-stu-id="5f32b-259">VIP1:80 (in VM1 and VM2)</span></span> |
| <span data-ttu-id="5f32b-260">2</span><span class="sxs-lookup"><span data-stu-id="5f32b-260">2</span></span> |![Regra](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="5f32b-262">VIP2:80</span><span class="sxs-lookup"><span data-stu-id="5f32b-262">VIP2:80</span></span> |![back-end](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="5f32b-264">VIP2:80 (na VM1 e VM2)</span><span class="sxs-lookup"><span data-stu-id="5f32b-264">VIP2:80 (in VM1 and VM2)</span></span> |

<span data-ttu-id="5f32b-265">A tabela a seguir mostra o mapeamento completo no balanceador de carga:</span><span class="sxs-lookup"><span data-stu-id="5f32b-265">The following table shows the complete mapping in the load balancer:</span></span>

| <span data-ttu-id="5f32b-266">Regra</span><span class="sxs-lookup"><span data-stu-id="5f32b-266">Rule</span></span> | <span data-ttu-id="5f32b-267">Endereço IP VIP</span><span class="sxs-lookup"><span data-stu-id="5f32b-267">VIP IP address</span></span> | <span data-ttu-id="5f32b-268">protocol</span><span class="sxs-lookup"><span data-stu-id="5f32b-268">protocol</span></span> | <span data-ttu-id="5f32b-269">porta</span><span class="sxs-lookup"><span data-stu-id="5f32b-269">port</span></span> | <span data-ttu-id="5f32b-270">Destino</span><span class="sxs-lookup"><span data-stu-id="5f32b-270">Destination</span></span> | <span data-ttu-id="5f32b-271">porta</span><span class="sxs-lookup"><span data-stu-id="5f32b-271">port</span></span> |
| --- | --- | --- | --- | --- | --- |
| ![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="5f32b-273">1</span><span class="sxs-lookup"><span data-stu-id="5f32b-273">1</span></span> |<span data-ttu-id="5f32b-274">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="5f32b-274">65.52.0.1</span></span> |<span data-ttu-id="5f32b-275">TCP</span><span class="sxs-lookup"><span data-stu-id="5f32b-275">TCP</span></span> |<span data-ttu-id="5f32b-276">80</span><span class="sxs-lookup"><span data-stu-id="5f32b-276">80</span></span> |<span data-ttu-id="5f32b-277">mesmo que o VIP (65.52.0.1)</span><span class="sxs-lookup"><span data-stu-id="5f32b-277">same as VIP (65.52.0.1)</span></span> |<span data-ttu-id="5f32b-278">mesmo que o VIP (80)</span><span class="sxs-lookup"><span data-stu-id="5f32b-278">same as VIP (80)</span></span> |
| ![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="5f32b-280">2</span><span class="sxs-lookup"><span data-stu-id="5f32b-280">2</span></span> |<span data-ttu-id="5f32b-281">65.52.0.2</span><span class="sxs-lookup"><span data-stu-id="5f32b-281">65.52.0.2</span></span> |<span data-ttu-id="5f32b-282">TCP</span><span class="sxs-lookup"><span data-stu-id="5f32b-282">TCP</span></span> |<span data-ttu-id="5f32b-283">80</span><span class="sxs-lookup"><span data-stu-id="5f32b-283">80</span></span> |<span data-ttu-id="5f32b-284">mesmo que o VIP (65.52.0.2)</span><span class="sxs-lookup"><span data-stu-id="5f32b-284">same as VIP (65.52.0.2)</span></span> |<span data-ttu-id="5f32b-285">mesmo que o VIP (80)</span><span class="sxs-lookup"><span data-stu-id="5f32b-285">same as VIP (80)</span></span> |

<span data-ttu-id="5f32b-286">O destino do fluxo de entrada é o endereço VIP na interface de loopback na VM.</span><span class="sxs-lookup"><span data-stu-id="5f32b-286">The destination of the inbound flow is the VIP address on the loopback interface in the VM.</span></span> <span data-ttu-id="5f32b-287">Cada regra deve produzir um fluxo com uma combinação exclusiva de endereço IP de destino e porta de destino.</span><span class="sxs-lookup"><span data-stu-id="5f32b-287">Each rule must produce a flow with a unique combination of destination IP address and destination port.</span></span> <span data-ttu-id="5f32b-288">Ao variar o endereço IP de destino do fluxo, a reutilização de porta é possível na mesma VM.</span><span class="sxs-lookup"><span data-stu-id="5f32b-288">By varying the destination IP address of the flow, port reuse is possible on the same VM.</span></span> <span data-ttu-id="5f32b-289">O serviço é exposto ao balanceador de carga vinculando-o ao endereço IP do VIP e à porta da interface de loopback respectiva.</span><span class="sxs-lookup"><span data-stu-id="5f32b-289">Your service is exposed to the load balancer by binding it to the VIP’s IP address and port of the respective loopback interface.</span></span>

<span data-ttu-id="5f32b-290">Observe que este exemplo não altera a porta de destino.</span><span class="sxs-lookup"><span data-stu-id="5f32b-290">Notice that this example does not change the destination port.</span></span> <span data-ttu-id="5f32b-291">Embora esse seja um cenário de IP Flutuante, o Azure Load Balancer também oferece suporte à definição de uma regra para reescrever a porta de destino de back-end e diferenciar da porta de destino do front-end.</span><span class="sxs-lookup"><span data-stu-id="5f32b-291">Even though this is a Floating IP scenario, Azure Load Balancer also supports defining a rule to rewrite the backend destination port and to make it different from the frontend destination port.</span></span>

<span data-ttu-id="5f32b-292">O tipo de regra de IP Flutuante é a base de vários padrões de configuração do balanceador de carga.</span><span class="sxs-lookup"><span data-stu-id="5f32b-292">The Floating IP rule type is the foundation of several load balancer configuration patterns.</span></span> <span data-ttu-id="5f32b-293">Um exemplo disponível atualmente é a configuração [AlwaysOn com vários ouvintes](../virtual-machines/windows/sql/virtual-machines-windows-portal-sql-ps-alwayson-int-listener.md) .</span><span class="sxs-lookup"><span data-stu-id="5f32b-293">One example that is currently available is the [SQL AlwaysOn with Multiple Listeners](../virtual-machines/windows/sql/virtual-machines-windows-portal-sql-ps-alwayson-int-listener.md) configuration.</span></span> <span data-ttu-id="5f32b-294">Ao longo do tempo, documentaremos mais esses cenários.</span><span class="sxs-lookup"><span data-stu-id="5f32b-294">Over time, we will document more of these scenarios.</span></span>

## <a name="limitations"></a><span data-ttu-id="5f32b-295">Limitações</span><span class="sxs-lookup"><span data-stu-id="5f32b-295">Limitations</span></span>

* <span data-ttu-id="5f32b-296">Há suporte para várias configurações de VIP apenas com VMs de IaaS.</span><span class="sxs-lookup"><span data-stu-id="5f32b-296">Multiple VIP configurations are only supported with IaaS VMs.</span></span>
* <span data-ttu-id="5f32b-297">Com a regra de IP flutuante, seu aplicativo deve usar o DIP para fluxos de saída.</span><span class="sxs-lookup"><span data-stu-id="5f32b-297">With the Floating IP rule, your application must use the DIP for outbound flows.</span></span> <span data-ttu-id="5f32b-298">Se o seu aplicativo se associar ao endereço VIP configurado na interface de loopback no sistema operacional convidado, SNAT não estará disponível para reescrever o fluxo de saída e o fluxo falhará.</span><span class="sxs-lookup"><span data-stu-id="5f32b-298">If your application binds to the VIP address configured on the loopback interface in the guest OS, then SNAT is not available to rewrite the outbound flow and the flow fails.</span></span>
* <span data-ttu-id="5f32b-299">Endereços IP públicos têm um efeito sobre a cobrança.</span><span class="sxs-lookup"><span data-stu-id="5f32b-299">Public IP addresses have an effect on billing.</span></span> <span data-ttu-id="5f32b-300">Para saber mais, confira [Preços de endereço IP](https://azure.microsoft.com/pricing/details/ip-addresses/)</span><span class="sxs-lookup"><span data-stu-id="5f32b-300">For more information, see [IP Address pricing](https://azure.microsoft.com/pricing/details/ip-addresses/)</span></span>
* <span data-ttu-id="5f32b-301">Limites de assinatura são aplicados.</span><span class="sxs-lookup"><span data-stu-id="5f32b-301">Subscription limits apply.</span></span> <span data-ttu-id="5f32b-302">Para saber mais, confira [Limites de serviço](../azure-subscription-service-limits.md#networking-limits) .</span><span class="sxs-lookup"><span data-stu-id="5f32b-302">For more information, see [Service limits](../azure-subscription-service-limits.md#networking-limits) for details.</span></span>
