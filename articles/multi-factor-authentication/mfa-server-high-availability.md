---
title: aaaConfigure servidor Azure MFA para alta disponibilidade | Microsoft Docs
description: "Implante várias instâncias do Servidor de Autenticação Multifator do Azure em configurações que fornecem alta disponibilidade."
services: multi-factor-authentication
keywords: MFA do Azure,
documentationcenter: 
author: MicrosoftGuyJFlo
manager: femila
ms.assetid: 
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/23/2017
ms.author: joflore
ms.reviewer: alexwe
ms.custom: it-pro
ms.openlocfilehash: 8c6b1921c734c7a7273e443b3591fbbb15cd5e6c
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="configure-azure-multi-factor-authentication-server-for-high-availability"></a><span data-ttu-id="e2b76-104">Configurar o Servidor de Autenticação Multifator do Azure para alta disponibilidade</span><span class="sxs-lookup"><span data-stu-id="e2b76-104">Configure Azure Multi-Factor Authentication Server for high availability</span></span>

<span data-ttu-id="e2b76-105">tooachieve alta disponibilidade com a implantação do Azure MFA de servidor, você precisa toodeploy vários servidores MFA.</span><span class="sxs-lookup"><span data-stu-id="e2b76-105">tooachieve high-availability with your Azure Server MFA deployment, you need toodeploy multiple MFA servers.</span></span> <span data-ttu-id="e2b76-106">Esta seção fornece informações sobre um design com balanceamento de carga tooachieve seus destinos de alta disponibilidade na implantação de servidor do Azure MFS.</span><span class="sxs-lookup"><span data-stu-id="e2b76-106">This section provides information on a load-balanced design tooachieve your high availability targets in you Azure MFS Server deployment.</span></span>

## <a name="mfa-server-overview"></a><span data-ttu-id="e2b76-107">Visão geral do Servidor do MFA</span><span class="sxs-lookup"><span data-stu-id="e2b76-107">MFA Server overview</span></span>

<span data-ttu-id="e2b76-108">Olá arquitetura de serviço do servidor Azure MFA consiste em vários componentes, conforme mostrado no diagrama a seguir de saudação:</span><span class="sxs-lookup"><span data-stu-id="e2b76-108">hello Azure MFA Server service architecture comprises several components as shown in hello following diagram:</span></span>

 ![Arquitetura do Servidor do MFA](./media/mfa-server-high-availability/mfa-ha-architecture.png)

<span data-ttu-id="e2b76-110">Um servidor de MFA é um servidor do Windows que tenha hello Azure multi-Factor Authentication software instalado.</span><span class="sxs-lookup"><span data-stu-id="e2b76-110">An MFA Server is a Windows Server that has hello Azure Multi-Factor Authentication software installed.</span></span> <span data-ttu-id="e2b76-111">instância de servidor MFA Olá deve ser ativada por Olá serviço MFA em toofunction do Azure.</span><span class="sxs-lookup"><span data-stu-id="e2b76-111">hello MFA Server instance must be activated by hello MFA Service in Azure toofunction.</span></span> <span data-ttu-id="e2b76-112">Mais de um Servidor do MFA pode ser instalado localmente.</span><span class="sxs-lookup"><span data-stu-id="e2b76-112">More than one MFA Server can be installed on-premises.</span></span>

<span data-ttu-id="e2b76-113">Olá primeiro servidor MFA instalado é Olá servidor mestre de MFA durante a ativação por hello Azure MFA serviço por padrão.</span><span class="sxs-lookup"><span data-stu-id="e2b76-113">hello first MFA Server that is installed is hello master MFA Server upon activation by hello Azure MFA Service by default.</span></span> <span data-ttu-id="e2b76-114">servidor MFA mestre de saudação tem uma cópia gravável do banco de dados de PhoneFactor.pfdata hello.</span><span class="sxs-lookup"><span data-stu-id="e2b76-114">hello master MFA server has a writeable copy of hello PhoneFactor.pfdata database.</span></span> <span data-ttu-id="e2b76-115">As instalações posteriores de instâncias do Servidor do MFA são conhecidas como servidores subordinados.</span><span class="sxs-lookup"><span data-stu-id="e2b76-115">Subsequent installations of instances of MFA Server are known as slaves.</span></span> <span data-ttu-id="e2b76-116">secundários MFA de saudação tem uma cópia replicada somente leitura do banco de dados de PhoneFactor.pfdata hello.</span><span class="sxs-lookup"><span data-stu-id="e2b76-116">hello MFA slaves have a replicated read-only copy of hello PhoneFactor.pfdata database.</span></span> <span data-ttu-id="e2b76-117">Os servidores do MFA replicam informações usando a RPC (Chamada de Procedimento Remoto).</span><span class="sxs-lookup"><span data-stu-id="e2b76-117">MFA servers replicate information using Remote Procedure Call (RPC).</span></span> <span data-ttu-id="e2b76-118">Todos os servidores de MFA deve coletivamente ser ingressado no domínio ou autônomo tooreplicate informações.</span><span class="sxs-lookup"><span data-stu-id="e2b76-118">All MFA Severs must collectively either be domain joined or standalone tooreplicate information.</span></span>

<span data-ttu-id="e2b76-119">MFA mestre e escravo servidores MFA para se comunicar com hello serviço MFA quando a autenticação de dois fatores é necessária.</span><span class="sxs-lookup"><span data-stu-id="e2b76-119">Both MFA master and slave MFA Servers communicate with hello MFA Service when two-factor authentication is required.</span></span> <span data-ttu-id="e2b76-120">Por exemplo, quando um usuário tenta toogain aplicativos de tooan de acesso que requer autenticação de dois fatores, Olá usuário primeiro será autenticado por um provedor de identidade, como o Active Directory (AD).</span><span class="sxs-lookup"><span data-stu-id="e2b76-120">For example, when a user attempts toogain access tooan application that requires two-factor authentication, hello user will first be authenticated by an identity provider, such as Active Directory (AD).</span></span>

<span data-ttu-id="e2b76-121">Após a autenticação bem-sucedida com o AD, Olá servidor MFA comunicará Olá serviço MFA.</span><span class="sxs-lookup"><span data-stu-id="e2b76-121">After successful authentication with AD, hello MFA Server will communicate with hello MFA Service.</span></span> <span data-ttu-id="e2b76-122">Olá servidor MFA aguarda a notificação de saudação serviço MFA tooallow ou negar o aplicativo de toohello de acesso de usuário hello.</span><span class="sxs-lookup"><span data-stu-id="e2b76-122">hello MFA Server waits for notification from hello MFA Service tooallow or deny hello user access toohello application.</span></span>

<span data-ttu-id="e2b76-123">Se o servidor mestre do MFA Olá ficar offline, autenticações ainda podem ser processadas, mas as operações que exigem alterações toohello MFA banco de dados não podem ser processadas.</span><span class="sxs-lookup"><span data-stu-id="e2b76-123">If hello MFA master server goes offline, authentications can still be processed, but operations that require changes toohello MFA database cannot be processed.</span></span> <span data-ttu-id="e2b76-124">(Exemplos: Olá a adição de usuários, autoatendimento mudanças de PIN e alterar as informações de usuário)</span><span class="sxs-lookup"><span data-stu-id="e2b76-124">(Examples include: hello addition of users, self-service PIN changes, and changing user information)</span></span>

## <a name="deployment"></a><span data-ttu-id="e2b76-125">Implantação</span><span class="sxs-lookup"><span data-stu-id="e2b76-125">Deployment</span></span>

<span data-ttu-id="e2b76-126">Considere Olá pontos importantes para balanceamento de carga do Azure MFA Server e seus componentes relacionados a seguir.</span><span class="sxs-lookup"><span data-stu-id="e2b76-126">Consider hello following important points for load balancing Azure MFA Server and its related components.</span></span>

* <span data-ttu-id="e2b76-127">**Usando a alta disponibilidade do RADIUS tooachieve padrão**.</span><span class="sxs-lookup"><span data-stu-id="e2b76-127">**Using RADIUS standard tooachieve high availability**.</span></span> <span data-ttu-id="e2b76-128">Se estiver usando Servidores do MFA do Azure como servidores RADIUS, poderá configurar potencialmente um Servidor do MFA como um destino de autenticação primária RADIUS e outros Servidores do MFA do Azure como destinos de autenticação secundária.</span><span class="sxs-lookup"><span data-stu-id="e2b76-128">If you are using Azure MFA Servers as RADIUS servers, you can potentially configure one MFA Server as a primary RADIUS authentication target and other Azure MFA Servers as secondary authentication targets.</span></span> <span data-ttu-id="e2b76-129">No entanto, essa alta disponibilidade do método tooachieve pode não ser prática porque você deve aguardar um toooccur de período de tempo limite quando a autenticação falha no destino de autenticação primária Olá antes de você pode ser autenticados em relação a autenticação secundária Olá destino.</span><span class="sxs-lookup"><span data-stu-id="e2b76-129">However, this method tooachieve high availability may not be practical because you must wait for a time-out period toooccur when authentication fails on hello primary authentication target before you can be authenticated against hello secondary authentication target.</span></span> <span data-ttu-id="e2b76-130">É mais eficiente tooload saldo Olá tráfego RADIUS entre cliente RADIUS de saudação e servidores RADIUS de saudação (nesse caso, hello Azure MFA servidores atuando como servidores RADIUS) para que você pode configurar clientes RADIUS de saudação com uma única URL, eles podem apontar para.</span><span class="sxs-lookup"><span data-stu-id="e2b76-130">It is more efficient tooload balance hello RADIUS traffic between hello RADIUS client and hello RADIUS Servers (in this case, hello Azure MFA Servers acting as RADIUS servers) so that you can configure hello RADIUS clients with a single URL that they can point to.</span></span>
* <span data-ttu-id="e2b76-131">**Necessário toomanually promover secundários MFA**.</span><span class="sxs-lookup"><span data-stu-id="e2b76-131">**Need toomanually promote MFA slaves**.</span></span> <span data-ttu-id="e2b76-132">Se o servidor mestre de Azure MFA Olá ficar offline, hello Azure MFA servidores secundários continuam tooprocess MFA solicitações.</span><span class="sxs-lookup"><span data-stu-id="e2b76-132">If hello master Azure MFA server goes offline, hello secondary Azure MFA Servers continue tooprocess MFA requests.</span></span> <span data-ttu-id="e2b76-133">No entanto, até que um servidor mestre do MFA estiver disponível, administradores não podem adicionar usuários ou modificar as configurações de MFA, e os usuários não podem fazer alterações usando o portal do usuário hello.</span><span class="sxs-lookup"><span data-stu-id="e2b76-133">However, until a master MFA server is available, admins can not add users or modify MFA settings, and users can not make changes using hello user portal.</span></span> <span data-ttu-id="e2b76-134">Promover uma função de mestre de toohello do MFA subordinado sempre é um processo manual.</span><span class="sxs-lookup"><span data-stu-id="e2b76-134">Promoting an MFA slave toohello master role is always a manual process.</span></span>
* <span data-ttu-id="e2b76-135">**Separabilidade de componentes**.</span><span class="sxs-lookup"><span data-stu-id="e2b76-135">**Separability of components**.</span></span> <span data-ttu-id="e2b76-136">Olá servidor MFA do Azure consiste em vários componentes que podem ser instalados em Olá a mesma instância do servidor do Windows ou em instâncias diferentes.</span><span class="sxs-lookup"><span data-stu-id="e2b76-136">hello Azure MFA Server comprises several components that can be installed on hello same Windows Server instance or on different instances.</span></span> <span data-ttu-id="e2b76-137">Esses componentes incluem hello Portal do usuário, o serviço Web aplicativos móveis e o adaptador ADFS de saudação (agente).</span><span class="sxs-lookup"><span data-stu-id="e2b76-137">These components include hello User Portal, Mobile App Web Service, and hello ADFS adapter (agent).</span></span> <span data-ttu-id="e2b76-138">Este Separabilidade torna possível toouse Olá Olá de toopublish Proxy de aplicativo Web Portal do usuário e servidor de Web do aplicativo móvel da rede de perímetro hello.</span><span class="sxs-lookup"><span data-stu-id="e2b76-138">This separability makes it possible toouse hello Web Application Proxy toopublish hello User Portal and Mobile App Web Server from hello perimeter network.</span></span> <span data-ttu-id="e2b76-139">Essa configuração adiciona toohello geral de segurança do seu design, conforme mostrado no diagrama a seguir de saudação.</span><span class="sxs-lookup"><span data-stu-id="e2b76-139">Such a configuration adds toohello overall security of your design, as shown in hello following diagram.</span></span> <span data-ttu-id="e2b76-140">Olá MFA Portal do usuário e o servidor de Web do aplicativo móvel também podem ser implantados em configurações de balanceamento de carga de alta disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="e2b76-140">hello MFA User Portal and Mobile App Web Server may also be deployed in HA load-balanced configurations.</span></span>

   ![Servidor do MFA com uma rede de perímetro](./media/mfa-server-high-availability/mfasecurity.png)

* <span data-ttu-id="e2b76-142">**Senha única (OTP) no SMS (também conhecido como SMS unidirecional) requer o uso de saudação de sessões Autoadesivas se o tráfego de balanceamento de carga**.</span><span class="sxs-lookup"><span data-stu-id="e2b76-142">**One-time password (OTP) over SMS (aka one-way SMS) requires hello use of sticky sessions if traffic is load-balanced**.</span></span> <span data-ttu-id="e2b76-143">SMS unidirecional é uma opção de autenticação que faz com que os usuários o Olá Olá servidor MFA toosend uma mensagem de texto que contém uma OTP.</span><span class="sxs-lookup"><span data-stu-id="e2b76-143">One-way SMS is an authentication option that causes hello MFA Server toosend hello users a text message containing an OTP.</span></span> <span data-ttu-id="e2b76-144">usuário de Olá insere Olá OTP em uma saudação de toocomplete da janela de prompt desafio MFA.</span><span class="sxs-lookup"><span data-stu-id="e2b76-144">hello user enters hello OTP in a prompt window toocomplete hello MFA challenge.</span></span> <span data-ttu-id="e2b76-145">Se você Azure MFA servidores de balanceamento de carga, hello mesmo servidor que serviu a solicitação de autenticação inicial Olá deve ser Olá servidor que recebe uma mensagem OTP de saudação do usuário Olá; Se outro servidor MFA recebe Olá resposta OTP, o desafio de autenticação Olá falhará.</span><span class="sxs-lookup"><span data-stu-id="e2b76-145">If you load balance Azure MFA Servers, hello same server that served hello initial authentication request must be hello server that receives hello OTP message from hello user; if another MFA Server receives hello OTP reply, hello authentication challenge fails.</span></span> <span data-ttu-id="e2b76-146">Para obter mais informações, consulte [senha por SMS adicionados tooAzure servidor MFA](https://blogs.technet.microsoft.com/enterprisemobility/2015/03/02/one-time-password-over-sms-added-to-azure-mfa-server).</span><span class="sxs-lookup"><span data-stu-id="e2b76-146">For more information, see [One Time Password over SMS Added tooAzure MFA Server](https://blogs.technet.microsoft.com/enterprisemobility/2015/03/02/one-time-password-over-sms-added-to-azure-mfa-server).</span></span>
* <span data-ttu-id="e2b76-147">**As implantações de balanceamento de carga de saudação Portal do usuário e o serviço Web aplicativos móveis requerem sessões Autoadesivas**.</span><span class="sxs-lookup"><span data-stu-id="e2b76-147">**Load-Balanced deployments of hello User Portal and Mobile App Web Service require sticky sessions**.</span></span> <span data-ttu-id="e2b76-148">Se você balanceamento de carga Olá MFA Portal do usuário e saudação do serviço Web de aplicativo móvel, cada sessão precisa toostay em Olá mesmo servidor.</span><span class="sxs-lookup"><span data-stu-id="e2b76-148">If you are load-balancing hello MFA User Portal and hello Mobile App Web Service, each session needs toostay on hello same server.</span></span>

## <a name="high-availability-deployment"></a><span data-ttu-id="e2b76-149">Implantação de alta disponibilidade</span><span class="sxs-lookup"><span data-stu-id="e2b76-149">High-availability deployment</span></span>

<span data-ttu-id="e2b76-150">Olá diagrama a seguir mostra uma implementação de balanceamento de carga de alta disponibilidade completa do Azure MFA e seus componentes, juntamente com o AD FS para referência.</span><span class="sxs-lookup"><span data-stu-id="e2b76-150">hello following diagram shows a complete HA load-balanced implementation of Azure MFA and its components, along with ADFS for reference.</span></span>

 ![Implementação de HA do Servidor do MFA do Azure](./media/mfa-server-high-availability/mfa-ha-deployment.png)

<span data-ttu-id="e2b76-152">Observe Olá itens para a área de saudação numerada de forma correspondente de saudação precede o diagrama a seguir.</span><span class="sxs-lookup"><span data-stu-id="e2b76-152">Note hello following items for hello correspondingly numbered area of hello preceding diagram.</span></span>

1. <span data-ttu-id="e2b76-153">Olá são dois servidores do Azure MFA (MFA1 e MFA2) (mfaapp.contoso.com) com balanceamento de carga e são toouse configurado um banco de dados de PhoneFactor.pfdata de saudação do tooreplicate (4443) de porta estática.</span><span class="sxs-lookup"><span data-stu-id="e2b76-153">hello two Azure MFA Servers (MFA1 and MFA2) are load balanced (mfaapp.contoso.com) and are configured toouse a static port (4443) tooreplicate hello PhoneFactor.pfdata database.</span></span> <span data-ttu-id="e2b76-154">Olá SDK do serviço Web está instalado em cada um de comunicação de tooenable do servidor MFA Olá pela porta TCP 443 com servidores do ADFS hello.</span><span class="sxs-lookup"><span data-stu-id="e2b76-154">hello Web Service SDK is installed on each of hello MFA Server tooenable communication over TCP port 443 with hello ADFS servers.</span></span> <span data-ttu-id="e2b76-155">servidores MFA de saudação são implantados em uma configuração de balanceamento de carga sem monitoração de estado.</span><span class="sxs-lookup"><span data-stu-id="e2b76-155">hello MFA servers are deployed in a stateless load-balanced configuration.</span></span> <span data-ttu-id="e2b76-156">No entanto, se você quisesse toouse OTP no SMS, você deve usar o balanceamento de carga com monitoração de estado.</span><span class="sxs-lookup"><span data-stu-id="e2b76-156">However, if you wanted toouse OTP over SMS, you must use stateful load balancing.</span></span>
   <span data-ttu-id="e2b76-157">![Servidor do MFA do Azure – HA do servidor de aplicativos](./media/mfa-server-high-availability/mfaapp.png)</span><span class="sxs-lookup"><span data-stu-id="e2b76-157">![Azure MFA Server - App server HA](./media/mfa-server-high-availability/mfaapp.png)</span></span>

   > [!NOTE]
   > <span data-ttu-id="e2b76-158">Como o RPC usa portas dinâmicas, é recomendável não firewalls tooopen toohello o intervalo de portas dinâmicas RPC pode potencialmente usar.</span><span class="sxs-lookup"><span data-stu-id="e2b76-158">Because RPC uses dynamic ports, it is not recommended tooopen firewalls up toohello range of dynamic ports that RPC can potentially use.</span></span> <span data-ttu-id="e2b76-159">Se você tiver um firewall **entre** seus servidores de aplicativo de MFA, você deve configurar Olá servidor MFA toocommunicate em uma porta estática para Olá tráfego de replicação entre servidores mestre e subordinado e abra a porta no firewall.</span><span class="sxs-lookup"><span data-stu-id="e2b76-159">If you have a firewall **between** your MFA application servers, you should configure hello MFA Server toocommunicate on a static port for hello replication traffic between slave and master servers and open that port on your firewall.</span></span> <span data-ttu-id="e2b76-160">Você pode forçar a porta estática hello, criando um valor de Registro DWORD em ```HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Positive Networks\PhoneFactor``` chamado ```Pfsvc_ncan_ip_tcp_port``` e definindo o valor de saudação tooan porta estática.</span><span class="sxs-lookup"><span data-stu-id="e2b76-160">You can force hello static port by creating a DWORD registry value at ```HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Positive Networks\PhoneFactor``` called ```Pfsvc_ncan_ip_tcp_port``` and setting hello value tooan available static port.</span></span> <span data-ttu-id="e2b76-161">Conexões sempre são iniciadas pelo mestre de toohello Olá subordinado servidores MFA, porta estática Olá só é necessário no mestre hello, mas desde que você pode promover um mestre de saudação toobe subordinado a qualquer momento, você deve definir a porta estática Olá em todos os servidores de MFA.</span><span class="sxs-lookup"><span data-stu-id="e2b76-161">Connections are always initiated by hello slave MFA Servers toohello master, hello static port is only required on hello master, but since you can promote a slave toobe hello master at any time, you should set hello static port on all MFA Servers.</span></span>

2. <span data-ttu-id="e2b76-162">servidores de aplicativo do usuário MFA do Portal móvel Olá dois (MFA-UP-MAS1 e MFA-UP-MAS2) têm a carga balanceada em um **com monitoração de estado** configuração (mfa.contoso.com).</span><span class="sxs-lookup"><span data-stu-id="e2b76-162">hello two User Portal/MFA Mobile App servers (MFA-UP-MAS1 and MFA-UP-MAS2) are load balanced in a **stateful** configuration (mfa.contoso.com).</span></span> <span data-ttu-id="e2b76-163">Lembre-se de que as sessões Autoadesivas são um requisito para balanceamento de carga Olá MFA Portal do usuário e o serviço de aplicativo móvel.</span><span class="sxs-lookup"><span data-stu-id="e2b76-163">Recall that sticky sessions are a requirement for load balancing hello MFA User Portal and Mobile App Service.</span></span>
   <span data-ttu-id="e2b76-164">![Servidor do MFA do Azure – HA do Portal do Usuário e do Serviço de Aplicativo Móvel](./media/mfa-server-high-availability/mfaportal.png)</span><span class="sxs-lookup"><span data-stu-id="e2b76-164">![Azure MFA Server - User Portal and Mobile App Service HA](./media/mfa-server-high-availability/mfaportal.png)</span></span>
3. <span data-ttu-id="e2b76-165">farm de servidor ADFS Olá é carga balanceada e publicados toohello da Internet por meio de proxies do AD FS com balanceamento de carga na rede de perímetro hello.</span><span class="sxs-lookup"><span data-stu-id="e2b76-165">hello ADFS Server farm is load balanced and published toohello Internet through load-balanced ADFS proxies in hello perimeter network.</span></span> <span data-ttu-id="e2b76-166">Cada servidor do AD FS usa Olá ADFS agente toocommunicate com hello Azure MFA servidores usando uma URL de única com balanceamento de carga (mfaapp.contoso.com) pela porta TCP 443.</span><span class="sxs-lookup"><span data-stu-id="e2b76-166">Each ADFS Server uses hello ADFS agent toocommunicate with hello Azure MFA Servers using a single load-balanced URL (mfaapp.contoso.com) over TCP port 443.</span></span>

## <a name="next-steps"></a><span data-ttu-id="e2b76-167">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="e2b76-167">Next steps</span></span>

* [<span data-ttu-id="e2b76-168">Instalar e configurar o Servidor do MFA do Azure</span><span class="sxs-lookup"><span data-stu-id="e2b76-168">Install and configure Azure MFA Server</span></span>](multi-factor-authentication-get-started-server.md)
