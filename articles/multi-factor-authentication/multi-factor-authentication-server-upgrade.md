---
title: "Atualização do Servidor do Azure MFA | Microsoft Docs"
description: "Etapas e diretrizes para atualizar o Servidor de Autenticação Multifator do Azure para uma versão mais nova."
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 50bb8ac3-5559-4d8b-a96a-799a74978b14
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/16/2017
ms.author: kgremban
ms.reviewer: yossib
ms.custom: it-pro
ms.openlocfilehash: 6e4e09f8539aad56f92ad9137f4a6b9eb0d82370
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="upgrade-to-the-latest-azure-multi-factor-authentication-server"></a><span data-ttu-id="e2d8b-103">Atualizar para o último Servidor de Autenticação Multifator do Azure</span><span class="sxs-lookup"><span data-stu-id="e2d8b-103">Upgrade to the latest Azure Multi-Factor Authentication Server</span></span>

<span data-ttu-id="e2d8b-104">Este artigo descreve o processo de atualização do Servidor do Azure MFA (Autenticação Multifator) v6.0 ou superior.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-104">This article walks you through the process of upgrading Azure Multi-Factor Authentication (MFA) Server v6.0 or higher.</span></span> <span data-ttu-id="e2d8b-105">Se precisar atualizar uma versão antiga do Agente PhoneFactor, consulte [Atualizar o Agente PhoneFactor para o Servidor de Autenticação Multifator do Azure](multi-factor-authentication-get-started-server-upgrade.md).</span><span class="sxs-lookup"><span data-stu-id="e2d8b-105">If you need to upgrade an old version of the PhoneFactor Agent, refer to [Upgrade the PhoneFactor Agent to Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server-upgrade.md).</span></span>

<span data-ttu-id="e2d8b-106">Se estiver atualizando da v6.x ou anterior para a v7.x ou mais nova, todos os componentes serão alterados do .NET 2.0 para o .NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-106">If you're upgrading from v6.x or older to v7.x or newer, all components change from .NET 2.0 to .NET 4.5.</span></span> <span data-ttu-id="e2d8b-107">Todos os componentes também exigem os Pacotes Redistribuíveis do Microsoft Visual C++ 2015 Atualização 1 ou posterior.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-107">All components also require Microsoft Visual C++ 2015 Redistributable Update 1 or higher.</span></span> <span data-ttu-id="e2d8b-108">O instalador do Servidor MFA instala as versões x86 e x64 desses componentes, caso ainda não estejam instalados.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-108">The MFA Server installer installs both the x86 and x64 versions of these components if they aren't already installed.</span></span> <span data-ttu-id="e2d8b-109">Se o Portal do Usuário e o Serviço Web do Aplicativo Móvel forem executados em servidores separados, você precisará instalar esses pacotes antes de atualizar esses componentes.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-109">If the User Portal and Mobile App Web Service run on separate servers, you need to install those packages before upgrading those components.</span></span> <span data-ttu-id="e2d8b-110">É possível pesquisar a última atualização dos Pacotes Redistribuíveis do Microsoft Visual C++ 2015 no [Centro de Download da Microsoft](https://www.microsoft.com/en-us/download/).</span><span class="sxs-lookup"><span data-stu-id="e2d8b-110">You can search for the latest Microsoft Visual C++ 2015 Redistributable update on the [Microsoft Download Center](https://www.microsoft.com/en-us/download/).</span></span> 

## <a name="install-the-latest-version-of-azure-mfa-server"></a><span data-ttu-id="e2d8b-111">Instalar a última versão do Servidor do Azure MFA</span><span class="sxs-lookup"><span data-stu-id="e2d8b-111">Install the latest version of Azure MFA Server</span></span>

1. <span data-ttu-id="e2d8b-112">Use as instruções descritas em [Baixar o Servidor de Autenticação Multifator do Azure](multi-factor-authentication-get-started-server.md#download-the-azure-multi-factor-authentication-server) para obter a última versão do Servidor do Azure MFA.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-112">Use the instructions in [Download the Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server.md#download-the-azure-multi-factor-authentication-server) to get the latest version of the Azure MFA Server.</span></span>
2. <span data-ttu-id="e2d8b-113">Faça um backup do arquivo de dados do Servidor MFA localizado em C:\Program Files\Multi-Factor Authentication Server\Data\PhoneFactor.pfdata (considerando o local de instalação padrão) no Servidor mestre do MFA.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-113">Make a backup of the MFA Server data file located at C:\Program Files\Multi-Factor Authentication Server\Data\PhoneFactor.pfdata (assuming the default install location) on your master MFA Server.</span></span>
3. <span data-ttu-id="e2d8b-114">Se você executar vários servidores para alta disponibilidade, altere os sistemas cliente que se autenticam no Servidor MFA, para que eles interrompam o envio de tráfego para os servidores que estão sendo atualizados.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-114">If you run multiple servers for high availability, change the client systems that authenticate to the MFA Server so that they stop sending traffic to the servers that are upgrading.</span></span> <span data-ttu-id="e2d8b-115">Se você usar um balanceador de carga, remova um Servidor MFA do balanceador de carga, faça a atualização e, em seguida, adicione o servidor novamente ao farm.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-115">If you use a load balancer, remove a MFA Server from the load balancer, do the upgrade, and then add the server back into the farm.</span></span>
4. <span data-ttu-id="e2d8b-116">Execute o novo instalador em cada Servidor MFA.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-116">Run the new installer on each MFA Server.</span></span> <span data-ttu-id="e2d8b-117">Atualize os servidores subordinados primeiro, pois eles poderão ler o arquivo de dados antigo que está sendo replicado pelo mestre.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-117">Upgrade subordinate servers first because they can read the old data file being replicated by the master.</span></span> 

  <span data-ttu-id="e2d8b-118">Não é necessário desinstalar o Servidor MFA atual antes de executar o instalador.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-118">You do not need to uninstall your current MFA Server before running the installer.</span></span> <span data-ttu-id="e2d8b-119">O instalador executa uma atualização in-loco.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-119">The installer performs an in-place upgrade.</span></span> <span data-ttu-id="e2d8b-120">O caminho de instalação é obtido do Registro da instalação anterior, para que ele seja instalado no mesmo local (por exemplo, C:\Program Files\Multi-Factor Authentication Server).</span><span class="sxs-lookup"><span data-stu-id="e2d8b-120">The installation path is picked up from the registry from the previous installation, so it installs in the same location (for example, C:\Program Files\Multi-Factor Authentication Server).</span></span> 
  
5. <span data-ttu-id="e2d8b-121">Se você for solicitado a instalar uma atualização dos Pacotes Redistribuíveis do Microsoft Visual C++ 2015, aceite o prompt.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-121">If you're prompted to install a Microsoft Visual C++ 2015 Redistributable update package, accept the prompt.</span></span> <span data-ttu-id="e2d8b-122">As versões x86 e x64 do pacote são instaladas.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-122">Both the x86 and x64 versions of the package are installed.</span></span>
5. <span data-ttu-id="e2d8b-123">Se você usar o SDK do serviço Web, precisará instalar o novo SDK do serviço Web.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-123">If you use the Web Service SDK, you are prompted to install the new Web Service SDK.</span></span> <span data-ttu-id="e2d8b-124">Ao instalar o novo SDK do Serviço Web, verifique se o nome do diretório virtual corresponde ao diretório virtual instalado anteriormente (por exemplo, MultiFactorAuthWebServiceSdk).</span><span class="sxs-lookup"><span data-stu-id="e2d8b-124">When you install the new Web Service SDK, make sure that the virtual directory name matches the previously installed virtual directory (for example, MultiFactorAuthWebServiceSdk).</span></span>
6. <span data-ttu-id="e2d8b-125">Repita as etapas em todos os servidores subordinados.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-125">Repeat the steps on all subordinate servers.</span></span> <span data-ttu-id="e2d8b-126">Promova um dos subordinados para ser o novo mestre e, em seguida, atualize o servidor mestre antigo.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-126">Promote one of the subordinates to be the new master, then upgrade the old master server.</span></span> 

## <a name="upgrade-the-user-portal"></a><span data-ttu-id="e2d8b-127">Atualizar o Portal do Usuário</span><span class="sxs-lookup"><span data-stu-id="e2d8b-127">Upgrade the User Portal</span></span>

1. <span data-ttu-id="e2d8b-128">Faça um backup do arquivo web.config que está no diretório virtual do local de instalação do Portal do Usuário (por exemplo, C:\inetpub\wwwroot\MultiFactorAuth).</span><span class="sxs-lookup"><span data-stu-id="e2d8b-128">Make a backup of the web.config file that is in the virtual directory of the User Portal installation location (for example, C:\inetpub\wwwroot\MultiFactorAuth).</span></span> <span data-ttu-id="e2d8b-129">Se alguma alteração foi feita no tema padrão, faça um backup da pasta App_Themes\Default também.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-129">If any changes were made to the default theme, make a backup of the App_Themes\Default folder as well.</span></span> <span data-ttu-id="e2d8b-130">É melhor criar uma cópia da pasta Default e criar um novo tema do que alterar o tema Padrão.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-130">It is better to create a copy of the Default folder and create a new theme than to change the Default theme.</span></span>
2. <span data-ttu-id="e2d8b-131">Se o Portal do Usuário for executado no mesmo servidor que os outros componentes do Servidor MFA, a instalação do Servidor MFA solicitará a atualização do Portal do Usuário.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-131">If the User Portal runs on the same server as the other MFA Server components, the MFA Server installation prompts you to update the User Portal.</span></span> <span data-ttu-id="e2d8b-132">Aceite a solicitação e instale a atualização do Portal do Usuário.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-132">Accept the prompt and install the User Portal update.</span></span> <span data-ttu-id="e2d8b-133">Verifique se o nome do diretório virtual corresponde ao diretório virtual instalado anteriormente (por exemplo, MultiFactorAuth).</span><span class="sxs-lookup"><span data-stu-id="e2d8b-133">Check that the virtual directory name matches the previously installed virtual directory (for example, MultiFactorAuth).</span></span>
3. <span data-ttu-id="e2d8b-134">Se o Portal do Usuário estiver em seu próprio servidor, copie o arquivo MultiFactorAuthenticationUserPortalSetup64.msi do local de instalação de um dos Servidores do MFA e coloque-o no servidor Web do Portal do Usuário.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-134">If the User Portal is on its own server, copy the MultiFactorAuthenticationUserPortalSetup64.msi file from the install location of one of the MFA Servers and put it onto the User Portal web server.</span></span> <span data-ttu-id="e2d8b-135">Execute o instalador.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-135">Run the installer.</span></span> 

  <span data-ttu-id="e2d8b-136">Se ocorrer um erro informando que os Pacotes Redistribuíveis do Microsoft Visual C++ 2015 Atualização 1 ou posterior são obrigatórios, baixe e instale o último pacote de atualização no [Centro de Download da Microsoft](https://www.microsoft.com/download/).</span><span class="sxs-lookup"><span data-stu-id="e2d8b-136">If an error occurs stating, "Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required," download and install the latest update package from the [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="e2d8b-137">Instale as versões x86 e x64.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-137">Install both the x86 and x64 versions.</span></span>

4. <span data-ttu-id="e2d8b-138">Após a instalação do software atualizado do Portal do Usuário, compare o backup de web.config criado na etapa 1 com o novo arquivo web.config.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-138">After the updated User Portal software is installed, compare the web.config backup you made in step 1 with the new web.config file.</span></span> <span data-ttu-id="e2d8b-139">Se não houver nenhum atributo no novo web.config, copie o web.config de backup para o diretório virtual para substituir o novo.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-139">If no new attributes exist in the new web.config, copy your backup web.config into the virtual directory to overwrite the new one.</span></span> <span data-ttu-id="e2d8b-140">Outra opção é copiar e colar os valores de appSettings e a URL do SDK do Serviço Web do arquivo de backup para o novo web.config.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-140">Another option is to copy/paste the appSettings values and the Web Service SDK URL from the backup file into the new web.config.</span></span>

<span data-ttu-id="e2d8b-141">Se você tiver o Portal do Usuário em vários servidores, repita a instalação em todos eles.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-141">If you have the User Portal on multiple servers, repeat the installation on all of them.</span></span> 


## <a name="upgrade-the-mobile-app-web-service"></a><span data-ttu-id="e2d8b-142">Atualizar o Serviço Web do Aplicativo Móvel</span><span class="sxs-lookup"><span data-stu-id="e2d8b-142">Upgrade the Mobile App Web Service</span></span>

1. <span data-ttu-id="e2d8b-143">Faça um backup do arquivo web.config que está no diretório virtual do local de instalação do Serviço Web do Aplicativo Móvel (por exemplo, C:\inetpub\wwwroot\app ou C:\inetpub\wwwroot\MultiFactorAuthMobileAppWebService).</span><span class="sxs-lookup"><span data-stu-id="e2d8b-143">Make a backup of the web.config file that is in the virtual directory of the Mobile App Web Service installation location (for example, C:\inetpub\wwwroot\app or C:\inetpub\wwwroot\MultiFactorAuthMobileAppWebService).</span></span>
2. <span data-ttu-id="e2d8b-144">Copie o arquivo MultiFactorAuthenticationMobileAppWebServiceSetup64.msi do local de instalação dos Servidores do MFA e coloque-o no servidor Web de registro do Aplicativo Móvel.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-144">Copy the MultiFactorAuthenticationMobileAppWebServiceSetup64.msi file from the install location of the MFA Servers and put it onto the Mobile App registration web server.</span></span>
3. <span data-ttu-id="e2d8b-145">Execute o instalador.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-145">Run the installer.</span></span> 

  <span data-ttu-id="e2d8b-146">Se ocorrer um erro informando que os Pacotes Redistribuíveis do Microsoft Visual C++ 2015 Atualização 1 ou posterior são obrigatórios, baixe e instale o último pacote de atualização no [Centro de Download da Microsoft](https://www.microsoft.com/download/).</span><span class="sxs-lookup"><span data-stu-id="e2d8b-146">If an error occurs stating that Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required, download and install the latest update package from the [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="e2d8b-147">Instale as versões x86 e x64.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-147">Install both the x86 and x64 versions.</span></span>

4. <span data-ttu-id="e2d8b-148">Após a instalação do software atualizado do Serviço Web do Aplicativo Móvel, compare o arquivo web.config do qual foi criado um backup na etapa 1 com o novo arquivo web.config.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-148">After the updated Mobile App Web Service software installs, compare the web.config file that was backed up in step 1 with the new web.config file.</span></span> <span data-ttu-id="e2d8b-149">Se não houver nenhum atributo no novo web.config, será possível copiar o web.config salvo novamente para o diretório virtual e substituir o novo.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-149">If no new attributes exist in the new web.config, you can copy your saved web.config back into the virtual directory and overwrite the new one.</span></span> <span data-ttu-id="e2d8b-150">Outra opção é copiar e colar os valores de appSettings e a URL do SDK do Serviço Web do arquivo de backup para o novo web.config.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-150">Another option is to copy/paste the appSettings values and the Web Service SDK URL from the backup file into the new web.config.</span></span>

<span data-ttu-id="e2d8b-151">Se você tiver o Serviço Web do Aplicativo Móvel em vários servidores, repita a instalação em todos eles.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-151">If you have the Mobile App Web Service on multiple servers, repeat the installation on all of them.</span></span> 

## <a name="upgrade-the-ad-fs-adapters"></a><span data-ttu-id="e2d8b-152">Atualizar os adaptadores do AD FS</span><span class="sxs-lookup"><span data-stu-id="e2d8b-152">Upgrade the AD FS Adapters</span></span>


### <a name="if-mfa-runs-on-different-servers-than-ad-fs"></a><span data-ttu-id="e2d8b-153">Se o MFA for executado em servidores diferentes do que o AD FS</span><span class="sxs-lookup"><span data-stu-id="e2d8b-153">If MFA runs on different servers than AD FS</span></span>

<span data-ttu-id="e2d8b-154">Essas instruções se aplicarão apenas se você executar o Servidor de Autenticação Multifator separadamente dos servidores do AD FS.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-154">These instructions only apply if you run Multi-Factor Authentication Server separately from your AD FS servers.</span></span> <span data-ttu-id="e2d8b-155">Se ambos os serviços forem executados nos mesmos servidores, ignore esta seção e vá para as etapas de instalação.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-155">If both services run on the same servers, skip this section and go to the installation steps.</span></span> 

1. <span data-ttu-id="e2d8b-156">Salve uma cópia do MultiFactorAuthenticationAdfsAdapter.config existente que foi registrado no AD FS ou exporte a configuração usando o seguinte comando do PowerShell: `Export-AdfsAuthenticationProviderConfigurationData -Name [adapter name] -FilePath [path to config file]`.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-156">Save a copy of the MultiFactorAuthenticationAdfsAdapter.config file that was registered in AD FS, or export the configuration using the following PowerShell command: `Export-AdfsAuthenticationProviderConfigurationData -Name [adapter name] -FilePath [path to config file]`.</span></span> <span data-ttu-id="e2d8b-157">O nome do adaptador é “WindowsAzureMultiFactorAuthentication” ou “AzureMfaServerAuthentication”, dependendo da versão instalada anteriormente.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-157">The adapter name is either "WindowsAzureMultiFactorAuthentication" or "AzureMfaServerAuthentication" depending on the version previously installed.</span></span>
2. <span data-ttu-id="e2d8b-158">Copie os seguintes arquivos do local de instalação do Servidor MFA para os servidores do AD FS:</span><span class="sxs-lookup"><span data-stu-id="e2d8b-158">Copy the following files from the MFA Server installation location to the AD FS servers:</span></span>

  - <span data-ttu-id="e2d8b-159">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span><span class="sxs-lookup"><span data-stu-id="e2d8b-159">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span></span>
  - <span data-ttu-id="e2d8b-160">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="e2d8b-160">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
  - <span data-ttu-id="e2d8b-161">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="e2d8b-161">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
  - <span data-ttu-id="e2d8b-162">MultiFactorAuthenticationAdfsAdapter.config</span><span class="sxs-lookup"><span data-stu-id="e2d8b-162">MultiFactorAuthenticationAdfsAdapter.config</span></span>

3. <span data-ttu-id="e2d8b-163">Edite o script Register-multifactorauthenticationadfsadapter.ps1 adicionando `-ConfigurationFilePath [path]` ao final do comando `Register-AdfsAuthenticationProvider`.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-163">Edit the Register-MultiFactorAuthenticationAdfsAdapter.ps1 script by adding `-ConfigurationFilePath [path]` to the end of the `Register-AdfsAuthenticationProvider` command.</span></span> <span data-ttu-id="e2d8b-164">Substitua *[caminho]* pelo caminho completo até o arquivo MultiFactorAuthenticationAdfsAdapter.config ou até o arquivo de configuração exportado na etapa anterior.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-164">Replace *[path]* with the full path to the MultiFactorAuthenticationAdfsAdapter.config file or the configuration file exported in the previous step.</span></span> 

  <span data-ttu-id="e2d8b-165">Verifique os atributos no novo MultiFactorAuthenticationAdfsAdapter.config para ver se eles correspondem ao arquivo de configuração antigo.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-165">Check the attributes in the new MultiFactorAuthenticationAdfsAdapter.config to see if they match the old config file.</span></span> <span data-ttu-id="e2d8b-166">Se todos os atributos foram adicionados ou removidos na nova versão, copie os valores de atributo do arquivo de configuração antigo para o novo ou modifique o arquivo de configuração antigo para que ele seja correspondente.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-166">If any attributes were added or removed in the new version, copy the attribute values from the old configuration file to the new one or modify the old configuration file to match.</span></span>

### <a name="install-new-ad-fs-adapters"></a><span data-ttu-id="e2d8b-167">Instalar novos adaptadores do AD FS</span><span class="sxs-lookup"><span data-stu-id="e2d8b-167">Install new AD FS adapters</span></span>

> [!IMPORTANT] 
> <span data-ttu-id="e2d8b-168">Os usuários não precisarão realizar a verificação em duas etapas durante as etapas 3 a 8 desta seção.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-168">Your users will not be required to perform two-step verification during steps 3-8 of this section.</span></span> <span data-ttu-id="e2d8b-169">Se você tiver o AD FS configurado em vários clusters, será possível remover, atualizar e restaurar cada cluster no farm, independentemente dos outros clusters, para evitar tempo de inatividade.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-169">If you have AD FS configured in multiple clusters, you can remove, upgrade, and restore each cluster in the farm independently of the other clusters to avoid downtime.</span></span>

1. <span data-ttu-id="e2d8b-170">Remova alguns servidores do AD FS do farm.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-170">Remove some AD FS servers from the farm.</span></span> <span data-ttu-id="e2d8b-171">Atualize esses servidores enquanto os outros ainda estiverem em execução.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-171">Update these servers while the others are still running.</span></span>
2. <span data-ttu-id="e2d8b-172">Instale o novo adaptador do AD FS em cada servidor removido do farm do AD FS.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-172">Install the new AD FS adapter on each server removed from the AD FS farm.</span></span> <span data-ttu-id="e2d8b-173">Se o Servidor MFA for instalado em cada servidor do AD FS, será possível atualizar por meio do UX de administrador do Servidor MFA.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-173">If the MFA Server is installed on each AD FS server, you can update through the MFA Server admin UX.</span></span> <span data-ttu-id="e2d8b-174">Caso contrário, atualize executando MultiFactorAuthenticationAdfsAdapterSetup64.msi.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-174">Otherwise, update by running MultiFactorAuthenticationAdfsAdapterSetup64.msi.</span></span> 

  <span data-ttu-id="e2d8b-175">Se ocorrer um erro informando que os Pacotes Redistribuíveis do Microsoft Visual C++ 2015 Atualização 1 ou posterior são obrigatórios, baixe e instale o último pacote de atualização no [Centro de Download da Microsoft](https://www.microsoft.com/download/).</span><span class="sxs-lookup"><span data-stu-id="e2d8b-175">If an error occurs stating, "Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required," download and install the latest update package from the [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="e2d8b-176">Instale as versões x86 e x64.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-176">Install both the x86 and x64 versions.</span></span>

3. <span data-ttu-id="e2d8b-177">Acesse **AD FS** > **Políticas de Autenticação** > **Editar Política de Autenticação Multifator Global**.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-177">Go to **AD FS** > **Authentication Policies** > **Edit Global MultiFactor Authentication Policy**.</span></span> <span data-ttu-id="e2d8b-178">Desmarque **WindowsAzureMultiFactorAuthentication** ou **AzureMFAServerAuthentication** (dependendo da versão atual instalada).</span><span class="sxs-lookup"><span data-stu-id="e2d8b-178">Uncheck **WindowsAzureMultiFactorAuthentication** or **AzureMFAServerAuthentication** (depending on the current version installed).</span></span> 

  <span data-ttu-id="e2d8b-179">Quando essa etapa for concluída, a verificação em duas etapas por meio do Servidor MFA não estará disponível neste cluster do AD FS após a conclusão da etapa 8.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-179">Once this step is complete, two-step verification through MFA Server is not available in this AD FS cluster until you complete step 8.</span></span>

4. <span data-ttu-id="e2d8b-180">Cancele o registro da versão antiga do adaptador do AD FS executando o script Unregister-MultiFactorAuthenticationAdfsAdapter.ps1 do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-180">Unregister the older version of the AD FS adapter by running the Unregister-MultiFactorAuthenticationAdfsAdapter.ps1 PowerShell script.</span></span> <span data-ttu-id="e2d8b-181">Verifique se o parâmetro *-Name* (“WindowsAzureMultiFactorAuthentication” ou "AzureMFAServerAuthentication") corresponde ao nome exibido na etapa 3.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-181">Ensure that the *-Name* parameter (either “WindowsAzureMultiFactorAuthentication” or "AzureMFAServerAuthentication") matches the name that was displayed in step 3.</span></span> <span data-ttu-id="e2d8b-182">Isso se aplica a todos os servidores no mesmo cluster do AD FS, pois há uma configuração central.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-182">This applies to all servers in the same AD FS cluster since there is a central configuration.</span></span>
5. <span data-ttu-id="e2d8b-183">Registre o novo adaptador do AD FS executando o script Register-MultiFactorAuthenticationAdfsAdapter.ps1 do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-183">Register the new AD FS adapter by running the Register-MultiFactorAuthenticationAdfsAdapter.ps1 PowerShell script.</span></span> <span data-ttu-id="e2d8b-184">Isso se aplica a todos os servidores no mesmo cluster do AD FS, pois há uma configuração central.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-184">This applies to all servers in the same AD FS cluster since there is a central configuration.</span></span>
6. <span data-ttu-id="e2d8b-185">Reinicie o serviço do AD FS em cada servidor removido do farm do AD FS.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-185">Restart the AD FS service on each server removed from the AD FS farm.</span></span>
7. <span data-ttu-id="e2d8b-186">Adicione os servidores atualizados novamente ao farm do AD FS e remova os outros servidores do farm.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-186">Add the updated servers back to the AD FS farm and remove the other servers from the farm.</span></span>
8. <span data-ttu-id="e2d8b-187">Acesse **AD FS** > **Políticas de Autenticação** > **Editar Política de Autenticação Multifator Global**.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-187">Go to **AD FS** > **Authentication Policies** > **Edit Global MultiFactor Authentication Policy**.</span></span> <span data-ttu-id="e2d8b-188">Marque **AzureMfaServerAuthentication**.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-188">Check **AzureMfaServerAuthentication**.</span></span>
9. <span data-ttu-id="e2d8b-189">Repita a etapa 2 para atualizar os servidores agora removidos do farm do AD FS e reinicie o serviço do AD FS nesses servidores.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-189">Repeat step 2 to update the servers now removed from the AD FS farm and restart the AD FS service on those servers.</span></span>
10. <span data-ttu-id="e2d8b-190">Adicione esses servidores novamente ao farm do AD FS.</span><span class="sxs-lookup"><span data-stu-id="e2d8b-190">Add those servers back into the AD FS farm.</span></span>

## <a name="next-steps"></a><span data-ttu-id="e2d8b-191">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="e2d8b-191">Next steps</span></span>

- <span data-ttu-id="e2d8b-192">Obtenha exemplos de [Cenários avançados com a Autenticação Multifator do Azure e VPNs de terceiros](multi-factor-authentication-advanced-vpn-configurations.md)</span><span class="sxs-lookup"><span data-stu-id="e2d8b-192">Get examples of [Advanced scenarios with Azure Multi-Factor Authentication and third-party VPNs](multi-factor-authentication-advanced-vpn-configurations.md)</span></span>

- [<span data-ttu-id="e2d8b-193">Sincronizar o Servidor MFA com o Windows Server Active Directory</span><span class="sxs-lookup"><span data-stu-id="e2d8b-193">Synchronize MFA Server with Windows Server Active Directory</span></span>](multi-factor-authentication-get-started-server-dirint.md)

- <span data-ttu-id="e2d8b-194">[Configurar a Autenticação do Windows](multi-factor-authentication-get-started-server-windows.md) para os aplicativos</span><span class="sxs-lookup"><span data-stu-id="e2d8b-194">[Configure Windows Authentication](multi-factor-authentication-get-started-server-windows.md) for your applications</span></span>
