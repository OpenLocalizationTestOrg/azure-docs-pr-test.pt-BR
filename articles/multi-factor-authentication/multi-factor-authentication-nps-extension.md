---
title: recursos aaaUse existentes NPS servidores tooprovide MFA do Azure | Microsoft Docs
description: "Olá extensão do servidor de políticas de rede para o Azure multi-Factor Authentication é uma solução simples tooadd baseado em nuvem em duas etapas vericiation recursos tooyour autenticação infraestrutura existente."
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/14/2017
ms.author: kgremban
ms.reviewer: yossib
ms.custom: H1Hack27Feb2017; it-pro
ms.openlocfilehash: e9fc495b06873d45f06233f1aa618db9d94f8bd9
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="integrate-your-existing-nps-infrastructure-with-azure-multi-factor-authentication"></a><span data-ttu-id="7b891-103">Integrar sua infraestrutura do NPS existente à Autenticação Multifator do Azure</span><span class="sxs-lookup"><span data-stu-id="7b891-103">Integrate your existing NPS infrastructure with Azure Multi-Factor Authentication</span></span>

<span data-ttu-id="7b891-104">saudação de extensão do servidor de diretivas de rede (NPS) para o Azure MFA adiciona baseado em nuvem MFA recursos tooyour infraestrutura de autenticação usando os servidores existentes.</span><span class="sxs-lookup"><span data-stu-id="7b891-104">hello Network Policy Server (NPS) extension for Azure MFA adds cloud-based MFA capabilities tooyour authentication infrastructure using your existing servers.</span></span> <span data-ttu-id="7b891-105">Com hello extensão do NPS, você pode adicionar chamada telefônica, mensagem de texto ou telefone aplicativo verificação tooyour existente fluxo de autenticação sem ter que tooinstall, configurar e manter os novos servidores.</span><span class="sxs-lookup"><span data-stu-id="7b891-105">With hello NPS extension, you can add phone call, text message, or phone app verification tooyour existing authentication flow without having tooinstall, configure, and maintain new servers.</span></span> 

<span data-ttu-id="7b891-106">Esta extensão foi criada para as organizações que desejam tooprotect conexões de VPN sem implantar Olá servidor Azure MFA.</span><span class="sxs-lookup"><span data-stu-id="7b891-106">This extension was created for organizations that want tooprotect VPN connections without deploying hello Azure MFA Server.</span></span> <span data-ttu-id="7b891-107">Olá extensão NPS atua como um adaptador entre RADIUS e baseado em nuvem do Azure MFA tooprovide um segundo fator de autenticação para usuários federados ou sincronizados.</span><span class="sxs-lookup"><span data-stu-id="7b891-107">hello NPS extension acts as an adapter between RADIUS and cloud-based Azure MFA tooprovide a second factor of authentication for federated or synced users.</span></span>

<span data-ttu-id="7b891-108">Ao usar a extensão NPS Olá para o Azure MFA, o fluxo de autenticação de saudação inclui Olá componentes a seguir:</span><span class="sxs-lookup"><span data-stu-id="7b891-108">When using hello NPS extension for Azure MFA, hello authentication flow includes hello following components:</span></span> 

1. <span data-ttu-id="7b891-109">**Servidor VPN/NAS** recebe solicitações de clientes VPN e converte-os em servidores de tooNPS de solicitações do RADIUS.</span><span class="sxs-lookup"><span data-stu-id="7b891-109">**NAS/VPN Server** receives requests from VPN clients and converts them into RADIUS requests tooNPS servers.</span></span> 
2. <span data-ttu-id="7b891-110">**Servidor NPS** conecta tooActive Directory tooperform Olá autenticação primária para Olá RADIUS solicita e, em caso de sucesso, passa as extensões do hello solicitação tooany instalado.</span><span class="sxs-lookup"><span data-stu-id="7b891-110">**NPS Server** connects tooActive Directory tooperform hello primary authentication for hello RADIUS requests and, upon success, passes hello request tooany installed extensions.</span></span>  
3. <span data-ttu-id="7b891-111">**Extensão de NPS** dispara uma solicitação tooAzure MFA para autenticação secundária hello.</span><span class="sxs-lookup"><span data-stu-id="7b891-111">**NPS Extension** triggers a request tooAzure MFA for hello secondary authentication.</span></span> <span data-ttu-id="7b891-112">Depois que a extensão Olá recebe a resposta hello e Olá desafio MFA for bem-sucedida, ele conclui a solicitação de autenticação hello, fornecendo o servidor NPS de saudação com tokens de segurança que incluem uma declaração de MFA, emitida pelo STS do Azure.</span><span class="sxs-lookup"><span data-stu-id="7b891-112">Once hello extension receives hello response, and if hello MFA challenge succeeds, it completes hello authentication request by providing hello NPS server with security tokens that include an MFA claim, issued by Azure STS.</span></span>  
4. <span data-ttu-id="7b891-113">**Azure MFA** se comunica com os detalhes do usuário do Active Directory do Azure tooretrieve hello e realiza a autenticação secundária hello, usando um usuário de toohello verificação método configurado.</span><span class="sxs-lookup"><span data-stu-id="7b891-113">**Azure MFA** communicates with Azure Active Directory tooretrieve hello user’s details and performs hello secondary authentication using a verification method configured toohello user.</span></span>

<span data-ttu-id="7b891-114">Olá diagrama a seguir ilustra esse fluxo de solicitação de autenticação de alto nível:</span><span class="sxs-lookup"><span data-stu-id="7b891-114">hello following diagram illustrates this high-level authentication request flow:</span></span> 

![Diagrama de fluxo de autenticação](./media/multi-factor-authentication-nps-extension/auth-flow.png)

## <a name="plan-your-deployment"></a><span data-ttu-id="7b891-116">Planejar sua implantação</span><span class="sxs-lookup"><span data-stu-id="7b891-116">Plan your deployment</span></span>

<span data-ttu-id="7b891-117">Olá extensão NPS controla automaticamente a redundância, que exige uma configuração especial.</span><span class="sxs-lookup"><span data-stu-id="7b891-117">hello NPS extension automatically handles redundancy, so you don't need a special configuration.</span></span>

<span data-ttu-id="7b891-118">Você pode criar quantos servidores NPS habilitados para o Azure MFA conforme necessário.</span><span class="sxs-lookup"><span data-stu-id="7b891-118">You can create as many Azure MFA-enabled NPS servers as you need.</span></span> <span data-ttu-id="7b891-119">Se você instalar vários servidores, use um certificado de cliente diferente para cada um deles.</span><span class="sxs-lookup"><span data-stu-id="7b891-119">If you do install multiple servers, you should use a difference client certificate for each one of them.</span></span> <span data-ttu-id="7b891-120">Ao criar um certificado para cada servidor, você pode atualizar cada certificado individualmente e não se preocupar com tempo de inatividade em todos eles.</span><span class="sxs-lookup"><span data-stu-id="7b891-120">Creating a cert for each server means that you can update each cert individually, and not worry about downtime across all your servers.</span></span>

<span data-ttu-id="7b891-121">Servidores VPN de rotear solicitações de autenticação, portanto, precisam toobe atento novos servidores NPS ativado o Azure MFA hello.</span><span class="sxs-lookup"><span data-stu-id="7b891-121">VPN servers route authentication requests, so they need toobe aware of hello new Azure MFA-enabled NPS servers.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="7b891-122">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="7b891-122">Prerequisites</span></span>

<span data-ttu-id="7b891-123">Olá extensão NPS deve toowork com sua infraestrutura existente.</span><span class="sxs-lookup"><span data-stu-id="7b891-123">hello NPS extension is meant toowork with your existing infrastructure.</span></span> <span data-ttu-id="7b891-124">Certifique-se de que ter Olá seguintes pré-requisitos antes de começar.</span><span class="sxs-lookup"><span data-stu-id="7b891-124">Make sure you have hello following prerequisites before you begin.</span></span>

### <a name="licenses"></a><span data-ttu-id="7b891-125">Licenças</span><span class="sxs-lookup"><span data-stu-id="7b891-125">Licenses</span></span>

<span data-ttu-id="7b891-126">Olá NPS extensão para o Azure MFA é disponível toocustomers com [licenças para o Azure multi-Factor Authentication](multi-factor-authentication.md) (incluído no Azure AD Premium, o EMS ou uma assinatura de MFA).</span><span class="sxs-lookup"><span data-stu-id="7b891-126">hello NPS Extension for Azure MFA is available toocustomers with [licenses for Azure Multi-Factor Authentication](multi-factor-authentication.md) (included with Azure AD Premium, EMS, or an MFA subscription).</span></span>

### <a name="software"></a><span data-ttu-id="7b891-127">Software</span><span class="sxs-lookup"><span data-stu-id="7b891-127">Software</span></span>

<span data-ttu-id="7b891-128">Windows Server 2008 R2 SP1 ou superior.</span><span class="sxs-lookup"><span data-stu-id="7b891-128">Windows Server 2008 R2 SP1 or above.</span></span>

### <a name="libraries"></a><span data-ttu-id="7b891-129">Bibliotecas</span><span class="sxs-lookup"><span data-stu-id="7b891-129">Libraries</span></span>

<span data-ttu-id="7b891-130">Essas bibliotecas são instaladas automaticamente com a extensão de saudação.</span><span class="sxs-lookup"><span data-stu-id="7b891-130">These libraries are installed automatically with hello extension.</span></span>
-   [<span data-ttu-id="7b891-131">Pacotes redistribuíveis do Visual C++ para Visual Studio 2013 (X64)</span><span class="sxs-lookup"><span data-stu-id="7b891-131">Visual C++ Redistributable Packages for Visual Studio 2013 (X64)</span></span>](https://www.microsoft.com/download/details.aspx?id=40784)
-   [<span data-ttu-id="7b891-132">Módulo Microsoft Azure Active Directory para Windows PowerShell versão 1.1.166.0</span><span class="sxs-lookup"><span data-stu-id="7b891-132">Microsoft Azure Active Directory Module for Windows PowerShell version 1.1.166.0</span></span>](https://connect.microsoft.com/site1164/Downloads/DownloadDetails.aspx?DownloadID=59185)

### <a name="azure-active-directory"></a><span data-ttu-id="7b891-133">Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="7b891-133">Azure Active Directory</span></span>

<span data-ttu-id="7b891-134">Qualquer pessoa que usa a extensão NPS Olá deve ser tooAzure sincronizado do Active Directory usando o Azure AD Connect e deve ser registrado para MFA.</span><span class="sxs-lookup"><span data-stu-id="7b891-134">Everyone using hello NPS extension must be synced tooAzure Active Directory using Azure AD Connect, and must be registered for MFA.</span></span>

<span data-ttu-id="7b891-135">Quando você instala a extensão de hello, terá as credenciais de administrador e a ID de diretório Olá para seu locatário do AD do Azure.</span><span class="sxs-lookup"><span data-stu-id="7b891-135">When you install hello extension, you need hello directory ID and admin credentials for your Azure AD tenant.</span></span> <span data-ttu-id="7b891-136">Você pode encontrar sua ID de diretório no hello [portal do Azure](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="7b891-136">You can find your directory ID in hello [Azure portal](https://portal.azure.com).</span></span> <span data-ttu-id="7b891-137">Entre como administrador, selecione Olá **Active Directory do Azure** ícone Olá esquerda, selecione **propriedades**.</span><span class="sxs-lookup"><span data-stu-id="7b891-137">Sign in as an administrator, select hello **Azure Active Directory** icon on hello left, then select **Properties**.</span></span> <span data-ttu-id="7b891-138">Saudação de cópia GUID em Olá **ID de diretório** caixa e salvá-lo.</span><span class="sxs-lookup"><span data-stu-id="7b891-138">Copy hello GUID in hello **Directory ID** box and save it.</span></span> <span data-ttu-id="7b891-139">Você pode usar esse GUID como ID de locatário hello quando você instala o hello extensão do NPS.</span><span class="sxs-lookup"><span data-stu-id="7b891-139">You use this GUID as hello tenant ID when you install hello NPS extension.</span></span>

![Localize sua ID de diretório em Propriedades do Azure Active Directory](./media/multi-factor-authentication-nps-extension/find-directory-id.png)

## <a name="prepare-your-environment"></a><span data-ttu-id="7b891-141">Prepare o seu ambiente</span><span class="sxs-lookup"><span data-stu-id="7b891-141">Prepare your environment</span></span>

<span data-ttu-id="7b891-142">Antes de instalar a extensão NPS hello, você deseja tooprepare você ambiente toohandle Olá tráfego de autenticação.</span><span class="sxs-lookup"><span data-stu-id="7b891-142">Before you install hello NPS extension, you want tooprepare you environment toohandle hello authentication traffic.</span></span>

### <a name="enable-hello-nps-role-on-a-domain-joined-server"></a><span data-ttu-id="7b891-143">Habilitar a função do NPS Olá em um servidor ingressado no domínio</span><span class="sxs-lookup"><span data-stu-id="7b891-143">Enable hello NPS role on a domain-joined server</span></span>

<span data-ttu-id="7b891-144">servidor NPS Olá conecta tooAzure do Active Directory e autentica solicitações MFA de saudação.</span><span class="sxs-lookup"><span data-stu-id="7b891-144">hello NPS server connects tooAzure Active Directory and authenticates hello MFA requests.</span></span> <span data-ttu-id="7b891-145">Escolha um servidor para essa função.</span><span class="sxs-lookup"><span data-stu-id="7b891-145">Choose one server for this role.</span></span> <span data-ttu-id="7b891-146">É recomendável escolher um servidor que não lidar com solicitações de outros serviços, como Olá extensão NPS gera erros para todas as solicitações que não são RADIUS.</span><span class="sxs-lookup"><span data-stu-id="7b891-146">We recommend choosing a server that doesn't handle requests from other services, because hello NPS extension throws errors for any requests that aren't RADIUS.</span></span>

1. <span data-ttu-id="7b891-147">No seu servidor, abra Olá **assistente Adicionar funções e recursos** de saudação menu Quickstart Gerenciador do servidor.</span><span class="sxs-lookup"><span data-stu-id="7b891-147">On your server, open hello **Add Roles and Features Wizard** from hello Server Manager Quickstart menu.</span></span>
2. <span data-ttu-id="7b891-148">Escolha **Instalação baseada em função ou recurso** para o tipo de instalação.</span><span class="sxs-lookup"><span data-stu-id="7b891-148">Choose **Role-based or feature-based installation** for your installation type.</span></span>
3. <span data-ttu-id="7b891-149">Selecione Olá **serviços de acesso e política de rede** função de servidor.</span><span class="sxs-lookup"><span data-stu-id="7b891-149">Select hello **Network Policy and Access Services** server role.</span></span> <span data-ttu-id="7b891-150">Uma janela poderá ser exibido tooinform de recursos necessários toorun essa função.</span><span class="sxs-lookup"><span data-stu-id="7b891-150">A window may pop up tooinform you of required features toorun this role.</span></span>
4. <span data-ttu-id="7b891-151">Prossiga com o assistente Olá até a página de confirmação de saudação.</span><span class="sxs-lookup"><span data-stu-id="7b891-151">Continue through hello wizard until hello Confirmation page.</span></span> <span data-ttu-id="7b891-152">Selecione **Instalar**.</span><span class="sxs-lookup"><span data-stu-id="7b891-152">Select **Install**.</span></span>

<span data-ttu-id="7b891-153">Agora que você tem um servidor designado para NPS, você também deve configurar este servidor toohandle solicitações RADIUS do hello solução VPN.</span><span class="sxs-lookup"><span data-stu-id="7b891-153">Now that you have a server designated for NPS, you should also configure this server toohandle incoming RADIUS requests from hello VPN solution.</span></span>

### <a name="configure-your-vpn-solution-toocommunicate-with-hello-nps-server"></a><span data-ttu-id="7b891-154">Configurar seu toocommunicate de solução VPN com o servidor NPS de saudação</span><span class="sxs-lookup"><span data-stu-id="7b891-154">Configure your VPN solution toocommunicate with hello NPS server</span></span>

<span data-ttu-id="7b891-155">Dependendo de qual solução VPN que você usar, Olá tooconfigure etapas variam de sua política de autenticação de RADIUS.</span><span class="sxs-lookup"><span data-stu-id="7b891-155">Depending on which VPN solution you use, hello steps tooconfigure your RADIUS authentication policy vary.</span></span> <span data-ttu-id="7b891-156">Configure o servidor de NPS RADIUS política toopoint tooyour.</span><span class="sxs-lookup"><span data-stu-id="7b891-156">Configure this policy toopoint tooyour RADIUS NPS server.</span></span>

### <a name="sync-domain-users-toohello-cloud"></a><span data-ttu-id="7b891-157">Nuvem de toohello de usuários de domínio de sincronização</span><span class="sxs-lookup"><span data-stu-id="7b891-157">Sync domain users toohello cloud</span></span>

<span data-ttu-id="7b891-158">Esta etapa já poderá ser concluída no seu locatário, mas é bom verificação toodouble do Azure AD Connect foi sincronizado seus bancos de dados recentemente.</span><span class="sxs-lookup"><span data-stu-id="7b891-158">This step may already be complete on your tenant, but it's good toodouble-check that Azure AD Connect has synchronized your databases recently.</span></span>

1. <span data-ttu-id="7b891-159">Entrar toohello [portal do Azure](https://portal.azure.com) como um administrador.</span><span class="sxs-lookup"><span data-stu-id="7b891-159">Sign in toohello [Azure portal](https://portal.azure.com) as an administrator.</span></span>
2. <span data-ttu-id="7b891-160">Selecione **Azure Active Directory** > **Azure AD Connect**</span><span class="sxs-lookup"><span data-stu-id="7b891-160">Select **Azure Active Directory** > **Azure AD Connect**</span></span>
3. <span data-ttu-id="7b891-161">Verifique se o status de sincronização está **Habilitado** e se a última sincronização foi há menos de uma hora.</span><span class="sxs-lookup"><span data-stu-id="7b891-161">Verify that your sync status is **Enabled** and that your last sync was less than an hour ago.</span></span>

<span data-ttu-id="7b891-162">Se você precisar tookick uma nova rodada de sincronização, nós Olá instruções [sincronização do Azure AD Connect: Agendador](../active-directory/connect/active-directory-aadconnectsync-feature-scheduler.md#start-the-scheduler).</span><span class="sxs-lookup"><span data-stu-id="7b891-162">If you need tookick off a new round of synchronization, us hello instructions in [Azure AD Connect sync: Scheduler](../active-directory/connect/active-directory-aadconnectsync-feature-scheduler.md#start-the-scheduler).</span></span>

### <a name="determine-which-authentication-methods-your-users-can-use"></a><span data-ttu-id="7b891-163">Determinar quais métodos de autenticação os usuários podem usar</span><span class="sxs-lookup"><span data-stu-id="7b891-163">Determine which authentication methods your users can use</span></span>

<span data-ttu-id="7b891-164">Há dois fatores que afetam quais métodos de autenticação estão disponíveis com uma implantação de extensão do NPS:</span><span class="sxs-lookup"><span data-stu-id="7b891-164">There are two factors that affect which authentication methods are available with an NPS extension deployment:</span></span>

1. <span data-ttu-id="7b891-165">algoritmo de criptografia de senha Olá usado entre o cliente RADIUS de saudação (VPN, Netscaler server, ou outros) e os servidores NPS hello.</span><span class="sxs-lookup"><span data-stu-id="7b891-165">hello password encryption algorithm used between hello RADIUS client (VPN, Netscaler server, or other) and hello NPS servers.</span></span>
   - <span data-ttu-id="7b891-166">**PAP** oferece suporte a todos os métodos de autenticação de saudação do Azure MFA na nuvem Olá: chamada telefônica, mensagem de texto unidirecional, notificação de aplicativo móvel e código de verificação de aplicativo móvel.</span><span class="sxs-lookup"><span data-stu-id="7b891-166">**PAP** supports all hello authentication methods of Azure MFA in hello cloud: phone call, one-way text message, mobile app notification, and mobile app verification code.</span></span>
   - <span data-ttu-id="7b891-167">**CHAPV2** e **EAP** dão suporte a chamada telefônica e notificação de aplicativo móvel.</span><span class="sxs-lookup"><span data-stu-id="7b891-167">**CHAPV2** and **EAP** support phone call and mobile app notification.</span></span>
2. <span data-ttu-id="7b891-168">métodos que Olá aplicativo cliente de entrada Hello (VPN, Netscaler server, ou outros) pode manipular.</span><span class="sxs-lookup"><span data-stu-id="7b891-168">hello input methods that hello client application (VPN, Netscaler server, or other) can handle.</span></span> <span data-ttu-id="7b891-169">Por exemplo, o cliente VPN Olá ter alguns meios tooallow Olá usuário tootype em um código de verificação de um texto ou aplicativo móvel?</span><span class="sxs-lookup"><span data-stu-id="7b891-169">For example, does hello VPN client have some means tooallow hello user tootype in a verification code from a text or mobile app?</span></span>

<span data-ttu-id="7b891-170">Quando você implantar a extensão NPS hello, use essas tooevaluate fatores quais métodos estão disponíveis para os usuários.</span><span class="sxs-lookup"><span data-stu-id="7b891-170">When you deploy hello NPS extension, use these factors tooevaluate which methods are available for your users.</span></span> <span data-ttu-id="7b891-171">Se o cliente RADIUS oferece suporte a PAP, mas o cliente Olá UX não tem campos de entrada para um código de verificação, em seguida, chamada telefônica e notificação de aplicativo móvel são duas opções com suporte de saudação.</span><span class="sxs-lookup"><span data-stu-id="7b891-171">If your RADIUS client supports PAP, but hello client UX doesn't have input fields for a verification code, then phone call and mobile app notification are hello two supported options.</span></span>

<span data-ttu-id="7b891-172">Você pode [desabilitar métodos de autenticação sem suporte](multi-factor-authentication-whats-next.md#selectable-verification-methods) no Azure.</span><span class="sxs-lookup"><span data-stu-id="7b891-172">You can [disable unsupported authentication methods](multi-factor-authentication-whats-next.md#selectable-verification-methods) in Azure.</span></span>

### <a name="enable-users-for-mfa"></a><span data-ttu-id="7b891-173">Habilitar usuários para a MFA</span><span class="sxs-lookup"><span data-stu-id="7b891-173">Enable users for MFA</span></span>

<span data-ttu-id="7b891-174">Antes de implantar a extensão NPS completo Olá, é necessário tooenable MFA para usuários de saudação que você deseja tooperform verificação de duas etapas.</span><span class="sxs-lookup"><span data-stu-id="7b891-174">Before you deploy hello full NPS extension, you need tooenable MFA for hello users that you want tooperform two-step verification.</span></span> <span data-ttu-id="7b891-175">Mais imediatamente, extensão de saudação tootest como implantá-lo, você precisa de pelo menos um teste conta totalmente registrado para autenticação multifator.</span><span class="sxs-lookup"><span data-stu-id="7b891-175">More immediately, tootest hello extension as you deploy it, you need at least one test account that is fully registered for Multi-Factor Authentication.</span></span>

<span data-ttu-id="7b891-176">Use esses tooget etapas iniciada de uma conta de teste:</span><span class="sxs-lookup"><span data-stu-id="7b891-176">Use these steps tooget a test account started:</span></span>
1. <span data-ttu-id="7b891-177">Entrar muito[https://aka.ms/mfasetup](https://aka.ms/mfasetup) com uma conta de teste.</span><span class="sxs-lookup"><span data-stu-id="7b891-177">Sign in too[https://aka.ms/mfasetup](https://aka.ms/mfasetup) with a test account.</span></span> 
2. <span data-ttu-id="7b891-178">Siga Olá prompts tooset um método de verificação.</span><span class="sxs-lookup"><span data-stu-id="7b891-178">Follow hello prompts tooset up a verification method.</span></span>
3. <span data-ttu-id="7b891-179">Crie uma política de acesso condicional ou [alterar o estado do usuário Olá](multi-factor-authentication-get-started-user-states.md) toorequire verificação de duas etapas para a conta de teste de saudação.</span><span class="sxs-lookup"><span data-stu-id="7b891-179">Either create a conditional access policy or [change hello user state](multi-factor-authentication-get-started-user-states.md) toorequire two-step verification for hello test account.</span></span> 

<span data-ttu-id="7b891-180">Os usuários também precisam ter toofollow tooenroll estas etapas antes de eles poderão autenticar com a extensão NPS hello.</span><span class="sxs-lookup"><span data-stu-id="7b891-180">Your users also need toofollow these steps tooenroll before they can authenticate with hello NPS extension.</span></span>

## <a name="install-hello-nps-extension"></a><span data-ttu-id="7b891-181">Instalar a extensão NPS Olá</span><span class="sxs-lookup"><span data-stu-id="7b891-181">Install hello NPS extension</span></span>

> [!IMPORTANT]
> <span data-ttu-id="7b891-182">Instale a extensão NPS de saudação em um servidor diferente do ponto de acesso VPN hello.</span><span class="sxs-lookup"><span data-stu-id="7b891-182">Install hello NPS extension on a different server than hello VPN access point.</span></span>

### <a name="download-and-install-hello-nps-extension-for-azure-mfa"></a><span data-ttu-id="7b891-183">Baixe e instale a extensão NPS Olá para o Azure MFA</span><span class="sxs-lookup"><span data-stu-id="7b891-183">Download and install hello NPS extension for Azure MFA</span></span>

1.  <span data-ttu-id="7b891-184">[Baixar Olá NPS extensão](https://aka.ms/npsmfa) de saudação Microsoft Download Center.</span><span class="sxs-lookup"><span data-stu-id="7b891-184">[Download hello NPS Extension](https://aka.ms/npsmfa) from hello Microsoft Download Center.</span></span>
2.  <span data-ttu-id="7b891-185">Copie Olá binário toohello deseja tooconfigure do servidor de políticas de rede.</span><span class="sxs-lookup"><span data-stu-id="7b891-185">Copy hello binary toohello Network Policy Server you want tooconfigure.</span></span>
3.  <span data-ttu-id="7b891-186">Executar *setup.exe* e siga as instruções de instalação de saudação.</span><span class="sxs-lookup"><span data-stu-id="7b891-186">Run *setup.exe* and follow hello installation instructions.</span></span> <span data-ttu-id="7b891-187">Se você encontrar erros, verifique que Olá duas bibliotecas da seção de pré-requisitos Olá foram instaladas com êxito.</span><span class="sxs-lookup"><span data-stu-id="7b891-187">If you encounter errors, double-check that hello two libraries from hello prerequisite section were successfully installed.</span></span>

### <a name="run-hello-powershell-script"></a><span data-ttu-id="7b891-188">Executar script do PowerShell Olá</span><span class="sxs-lookup"><span data-stu-id="7b891-188">Run hello PowerShell script</span></span>

<span data-ttu-id="7b891-189">instalador de saudação cria um script do PowerShell neste local: `C:\Program Files\Microsoft\AzureMfa\Config` (onde C:\ é a unidade de instalação).</span><span class="sxs-lookup"><span data-stu-id="7b891-189">hello installer creates a PowerShell script in this location: `C:\Program Files\Microsoft\AzureMfa\Config` (where C:\ is your installation drive).</span></span> <span data-ttu-id="7b891-190">Este script do PowerShell executa Olá ações a seguir:</span><span class="sxs-lookup"><span data-stu-id="7b891-190">This PowerShell script performs hello following actions:</span></span>

-   <span data-ttu-id="7b891-191">Crie um certificado autoassinado.</span><span class="sxs-lookup"><span data-stu-id="7b891-191">Create a self-signed certificate.</span></span>
-   <span data-ttu-id="7b891-192">Associe a chave pública de saudação do serviço de toohello de certificado de saudação principal no AD do Azure.</span><span class="sxs-lookup"><span data-stu-id="7b891-192">Associate hello public key of hello certificate toohello service principal on Azure AD.</span></span>
-   <span data-ttu-id="7b891-193">Repositório cert Olá no repositório de certificados do computador local hello.</span><span class="sxs-lookup"><span data-stu-id="7b891-193">Store hello cert in hello local machine cert store.</span></span>
-   <span data-ttu-id="7b891-194">Particular chave tooNetwork conceder acesso toohello certificado usuário.</span><span class="sxs-lookup"><span data-stu-id="7b891-194">Grant access toohello certificate’s private key tooNetwork User.</span></span>
-   <span data-ttu-id="7b891-195">Reinicie Olá NPS.</span><span class="sxs-lookup"><span data-stu-id="7b891-195">Restart hello NPS.</span></span>

<span data-ttu-id="7b891-196">A menos que você deseje toouse seus próprios certificados (em vez da saudação certificados autoassinados hello gera script do PowerShell), execute Olá Script do PowerShell toocomplete instalação de saudação.</span><span class="sxs-lookup"><span data-stu-id="7b891-196">Unless you want toouse your own certificates (instead of hello self-signed certificates that hello PowerShell script generates), run hello PowerShell Script toocomplete hello installation.</span></span> <span data-ttu-id="7b891-197">Se você instalar a extensão de saudação em vários servidores, cada um deve ter seu próprio certificado.</span><span class="sxs-lookup"><span data-stu-id="7b891-197">If you install hello extension on multiple servers, each one should have its own certificate.</span></span>

1. <span data-ttu-id="7b891-198">Execute o Windows PowerShell como um administrador.</span><span class="sxs-lookup"><span data-stu-id="7b891-198">Run Windows PowerShell as an administrator.</span></span>
2. <span data-ttu-id="7b891-199">Altere os diretórios.</span><span class="sxs-lookup"><span data-stu-id="7b891-199">Change directories.</span></span>

   `cd "C:\Program Files\Microsoft\AzureMfa\Config"`

3. <span data-ttu-id="7b891-200">Execute script do PowerShell Olá criado pelo instalador hello.</span><span class="sxs-lookup"><span data-stu-id="7b891-200">Run hello PowerShell script created by hello installer.</span></span>

   `.\AzureMfaNpsExtnConfigSetup.ps1`

4. <span data-ttu-id="7b891-201">O PowerShell solicitará a sua ID de locatário.</span><span class="sxs-lookup"><span data-stu-id="7b891-201">PowerShell prompts for your tenant ID.</span></span> <span data-ttu-id="7b891-202">Use Olá GUID de ID de diretório que você copiou da saudação portal do Azure, na seção de pré-requisitos de saudação.</span><span class="sxs-lookup"><span data-stu-id="7b891-202">Use hello Directory ID GUID that you copied from hello Azure portal in hello prerequisites section.</span></span>
5. <span data-ttu-id="7b891-203">Entrar tooAzure AD como um administrador.</span><span class="sxs-lookup"><span data-stu-id="7b891-203">Sign in tooAzure AD as an administrator.</span></span>
6. <span data-ttu-id="7b891-204">PowerShell mostra uma mensagem de êxito quando Olá script for concluído.</span><span class="sxs-lookup"><span data-stu-id="7b891-204">PowerShell shows a success message when hello script is finished.</span></span>  

<span data-ttu-id="7b891-205">Repita essas etapas em quaisquer servidores NPS adicionais que você deseja tooset para balanceamento de carga.</span><span class="sxs-lookup"><span data-stu-id="7b891-205">Repeat these steps on any additional NPS servers that you want tooset up for load balancing.</span></span>

>[!NOTE]
><span data-ttu-id="7b891-206">Se você usar seus próprios certificados em vez de gerar certificados com hello script do PowerShell, certifique-se de que elas se alinham toohello convenção de nomenclatura de NPS.</span><span class="sxs-lookup"><span data-stu-id="7b891-206">If you use your own certificates instead of generating certificates with hello PowerShell script, make sure that they align toohello NPS naming convention.</span></span> <span data-ttu-id="7b891-207">nome da entidade Olá deve ser **CN =\<TenantID\>, UO = Microsoft NPS extensão**.</span><span class="sxs-lookup"><span data-stu-id="7b891-207">hello subject name must be **CN=\<TenantID\>,OU=Microsoft NPS Extension**.</span></span> 

## <a name="configure-your-nps-extension"></a><span data-ttu-id="7b891-208">Configurar sua extensão do NPS</span><span class="sxs-lookup"><span data-stu-id="7b891-208">Configure your NPS extension</span></span>

<span data-ttu-id="7b891-209">Esta seção inclui considerações sobre o design e sugestões para implantações bem-sucedidas da extensão do NPS.</span><span class="sxs-lookup"><span data-stu-id="7b891-209">This section includes design considerations and suggestions for successful NPS extension deployments.</span></span>

### <a name="configuration-limitations"></a><span data-ttu-id="7b891-210">Limitações de configuração</span><span class="sxs-lookup"><span data-stu-id="7b891-210">Configuration limitations</span></span>

- <span data-ttu-id="7b891-211">Olá extensão NPS para o Azure MFA não inclui os usuários toomigrate de ferramentas e configurações de nuvem do servidor MFA toohello.</span><span class="sxs-lookup"><span data-stu-id="7b891-211">hello NPS extension for Azure MFA does not include tools toomigrate users and settings from MFA Server toohello cloud.</span></span> <span data-ttu-id="7b891-212">Por esse motivo, é aconselhável usar extensão Olá para novas implantações, em vez de implantação existente.</span><span class="sxs-lookup"><span data-stu-id="7b891-212">For this reason, we suggest using hello extension for new deployments, rather than existing deployment.</span></span> <span data-ttu-id="7b891-213">Se você usar a extensão de saudação em uma implantação existente, os usuários tiverem o prova tooperform novamente toopopulate seu MFA detalhes na nuvem hello.</span><span class="sxs-lookup"><span data-stu-id="7b891-213">If you use hello extension on an existing deployment, your users have tooperform proof-up again toopopulate their MFA details in hello cloud.</span></span>  
- <span data-ttu-id="7b891-214">Olá extensão NPS usa Olá UPN da saudação usuário do Active directory tooidentify Olá no Azure MFA para executar a extensão de Olá Olá autenticação secundária pode ser configurado toouse um identificador diferente como logon alternativo ID personalizado do Active Directory ou ao local campo que não seja o UPN.</span><span class="sxs-lookup"><span data-stu-id="7b891-214">hello NPS extension uses hello UPN from hello on-premises Active directory tooidentify hello user on Azure MFA for performing hello Secondary Auth. hello extension can be configured toouse a different identifier like alternate login ID or custom Active Directory field other than UPN.</span></span> <span data-ttu-id="7b891-215">Consulte [configuração Opções avançadas para Olá extensão NPS para autenticação multifator](multi-factor-authentication-advanced-vpn-configurations.md) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="7b891-215">See [Advanced configuration options for hello NPS extension for Multi-Factor Authentication](multi-factor-authentication-advanced-vpn-configurations.md) for more information.</span></span>
- <span data-ttu-id="7b891-216">Nem todos os protocolos de criptografia dão suporte a todos os métodos de verificação.</span><span class="sxs-lookup"><span data-stu-id="7b891-216">Not all encryption protocols support all verification methods.</span></span>
   - <span data-ttu-id="7b891-217">O **PAP** dá suporte a chamadas telefônicas, mensagens de texto unidirecionais, notificações de aplicativo móvel e códigos de verificação de aplicativo móvel</span><span class="sxs-lookup"><span data-stu-id="7b891-217">**PAP** supports phone call, one-way text message, mobile app notification, and mobile app verification code</span></span>
   - <span data-ttu-id="7b891-218">**CHAPV2** e **EAP** dão suporte a chamada telefônica e notificação do aplicativo móvel</span><span class="sxs-lookup"><span data-stu-id="7b891-218">**CHAPV2** and **EAP** support phone call and mobile app notification</span></span>

### <a name="control-radius-clients-that-require-mfa"></a><span data-ttu-id="7b891-219">Clientes RADIUS de controle que exigem MFA</span><span class="sxs-lookup"><span data-stu-id="7b891-219">Control RADIUS clients that require MFA</span></span>

<span data-ttu-id="7b891-220">Depois que você habilita a MFA para um cliente RADIUS usando Olá extensão do NPS, todas as autenticações desse cliente são necessário tooperform MFA.</span><span class="sxs-lookup"><span data-stu-id="7b891-220">Once you enable MFA for a RADIUS client using hello NPS Extension, all authentications for this client are required tooperform MFA.</span></span> <span data-ttu-id="7b891-221">Se você quiser tooenable MFA para alguns clientes RADIUS, mas outros não, você pode configurar dois servidores NPS e instalar extensão Olá em apenas um deles.</span><span class="sxs-lookup"><span data-stu-id="7b891-221">If you want tooenable MFA for some RADIUS clients but not others, you can configure two NPS servers and install hello extension on only one of them.</span></span> <span data-ttu-id="7b891-222">Configure clientes RADIUS que você deseja toorequire MFA toosend solicitações toohello servidor NPS configurado com a extensão de saudação e outro servidor RADIUS clientes toohello NPS não está configurado com a extensão de saudação.</span><span class="sxs-lookup"><span data-stu-id="7b891-222">Configure RADIUS clients that you want toorequire MFA toosend requests toohello NPS server configured with hello extension, and other RADIUS clients toohello NPS server not configured with hello extension.</span></span>

### <a name="prepare-for-users-that-arent-enrolled-for-mfa"></a><span data-ttu-id="7b891-223">Preparar usuários que não são registrados na MFA</span><span class="sxs-lookup"><span data-stu-id="7b891-223">Prepare for users that aren't enrolled for MFA</span></span>

<span data-ttu-id="7b891-224">Se você tiver usuários que não são registrados para MFA, é possível determinar o que acontece quando eles tentam tooauthenticate.</span><span class="sxs-lookup"><span data-stu-id="7b891-224">If you have users that aren't enrolled for MFA, you can determine what happens when they try tooauthenticate.</span></span> <span data-ttu-id="7b891-225">Usar configuração de registro de saudação *REQUIRE_USER_MATCH* no caminho de registro Olá *HKLM\Software\Microsoft\AzureMFA* toocontrol o comportamento de recursos hello.</span><span class="sxs-lookup"><span data-stu-id="7b891-225">Use hello registry setting *REQUIRE_USER_MATCH* in hello registry path *HKLM\Software\Microsoft\AzureMFA* toocontrol hello feature behavior.</span></span> <span data-ttu-id="7b891-226">Essa configuração tem uma opção de configuração única:</span><span class="sxs-lookup"><span data-stu-id="7b891-226">This setting has a single configuration option:</span></span>

| <span data-ttu-id="7b891-227">Chave</span><span class="sxs-lookup"><span data-stu-id="7b891-227">Key</span></span> | <span data-ttu-id="7b891-228">Valor</span><span class="sxs-lookup"><span data-stu-id="7b891-228">Value</span></span> | <span data-ttu-id="7b891-229">Padrão</span><span class="sxs-lookup"><span data-stu-id="7b891-229">Default</span></span> |
| --- | ----- | ------- |
| <span data-ttu-id="7b891-230">REQUIRE_USER_MATCH</span><span class="sxs-lookup"><span data-stu-id="7b891-230">REQUIRE_USER_MATCH</span></span> | <span data-ttu-id="7b891-231">TRUE/FALSE</span><span class="sxs-lookup"><span data-stu-id="7b891-231">TRUE/FALSE</span></span> | <span data-ttu-id="7b891-232">Não definido (tooTRUE equivalente)</span><span class="sxs-lookup"><span data-stu-id="7b891-232">Not set (equivalent tooTRUE)</span></span> |

<span data-ttu-id="7b891-233">Olá propósito dessa configuração é toodetermine que toodo quando um usuário não estiver registrado para MFA.</span><span class="sxs-lookup"><span data-stu-id="7b891-233">hello purpose of this setting is toodetermine what toodo when a user is not enrolled for MFA.</span></span> <span data-ttu-id="7b891-234">Quando Olá key não existe, não está definido ou está definido tooTRUE, Olá usuário não estiver registrado e extensão Olá falha desafio MFA de saudação.</span><span class="sxs-lookup"><span data-stu-id="7b891-234">When hello key does not exist, is not set, or is set tooTRUE, and hello user is not enrolled, then hello extension fails hello MFA challenge.</span></span> <span data-ttu-id="7b891-235">Quando a chave de saudação está definido tooFALSE e Olá usuário não estiver registrado, a autenticação continuará sem executar o MFA.</span><span class="sxs-lookup"><span data-stu-id="7b891-235">When hello key is set tooFALSE and hello user is not enrolled, authentication proceeds without performing MFA.</span></span>

<span data-ttu-id="7b891-236">Você pode escolher toocreate essa chave e defini-lo tooFALSE enquanto os usuários estão integração e podem nem todas ser registradas para o Azure MFA ainda.</span><span class="sxs-lookup"><span data-stu-id="7b891-236">You can choose toocreate this key and set it tooFALSE while your users are onboarding, and may not all be enrolled for Azure MFA yet.</span></span> <span data-ttu-id="7b891-237">No entanto, desde que a configuração da chave Olá permite que os usuários que não são registrados para toosign MFA no, você deve remover essa chave antes de ir tooproduction.</span><span class="sxs-lookup"><span data-stu-id="7b891-237">However, since setting hello key permits users that aren't enrolled for MFA toosign in, you should remove this key before going tooproduction.</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="7b891-238">Solucionar problemas</span><span class="sxs-lookup"><span data-stu-id="7b891-238">Troubleshooting</span></span>

### <a name="how-do-i-verify-that-hello-client-cert-is-installed-as-expected"></a><span data-ttu-id="7b891-239">Como verificar o que certificado de cliente que hello está instalado, conforme o esperado?</span><span class="sxs-lookup"><span data-stu-id="7b891-239">How do I verify that hello client cert is installed as expected?</span></span>

<span data-ttu-id="7b891-240">Procure o certificado autoassinado do hello criado pelo instalador Olá no repositório de certificados de saudação e verifique se Olá chave privada tem permissões concedidas toouser **serviço de rede**.</span><span class="sxs-lookup"><span data-stu-id="7b891-240">Look for hello self-signed certificate created by hello installer in hello cert store, and check that hello private key has permissions granted toouser **NETWORK SERVICE**.</span></span> <span data-ttu-id="7b891-241">cert Olá tem um nome de assunto de **CN \<tenantid\>, UO = extensão do NPS da Microsoft**</span><span class="sxs-lookup"><span data-stu-id="7b891-241">hello cert has a subject name of **CN \<tenantid\>, OU = Microsoft NPS Extension**</span></span>

-------------------------------------------------------------

### <a name="how-can-i-verify-that-my-client-cert-is-associated-toomy-tenant-in-azure-active-directory"></a><span data-ttu-id="7b891-242">Como verificar o certificado de cliente é locatário toomy associada no Active Directory do Azure?</span><span class="sxs-lookup"><span data-stu-id="7b891-242">How can I verify that my client cert is associated toomy tenant in Azure Active Directory?</span></span>

<span data-ttu-id="7b891-243">Abra um prompt de comando do PowerShell e execute hello comandos a seguir:</span><span class="sxs-lookup"><span data-stu-id="7b891-243">Open PowerShell command prompt and run hello following commands:</span></span>

```
import-module MSOnline
Connect-MsolService
Get-MsolServicePrincipalCredential -AppPrincipalId "981f26a1-7f43-403b-a875-f8b09b8cd720" -ReturnKeyValues 1 
```

<span data-ttu-id="7b891-244">Estes comandos imprimem todos os certificados de saudação associar seu locatário a sua instância do hello extensão NPS em sua sessão do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="7b891-244">These commands print all hello certificates associating your tenant with your instance of hello NPS extension in your PowerShell session.</span></span> <span data-ttu-id="7b891-245">Procure seu certificado exportando seu certificado de cliente como um arquivo "codificado na Base 64 X.509(.cer)" sem chave privada hello e compará-lo com a lista de saudação do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="7b891-245">Look for your certificate by exporting your client cert as a "Base-64 encoded X.509(.cer)" file without hello private key, and compare it with hello list from PowerShell.</span></span>

<span data-ttu-id="7b891-246">Válido- e de término válidas-até que os carimbos de hora, que estão no formato legível, podem ser usado toofilter out misfits óbvios se o comando Olá retorna mais de um certificado.</span><span class="sxs-lookup"><span data-stu-id="7b891-246">Valid-From and Valid-Until timestamps, which are in human-readable form, can be used toofilter out obvious misfits if hello command returns more than one cert.</span></span>

-------------------------------------------------------------

### <a name="why-are-my-requests-failing-with-adal-token-error"></a><span data-ttu-id="7b891-247">Por que minhas solicitações estão falhando, com erro de token ADAL?</span><span class="sxs-lookup"><span data-stu-id="7b891-247">Why are my requests failing with ADAL token error?</span></span>

<span data-ttu-id="7b891-248">Esse erro pode ter ocorrido tooone várias razões.</span><span class="sxs-lookup"><span data-stu-id="7b891-248">This error could be due tooone of several reasons.</span></span> <span data-ttu-id="7b891-249">Use essas etapas de solução de problemas de toohelp:</span><span class="sxs-lookup"><span data-stu-id="7b891-249">Use these steps toohelp troubleshoot:</span></span>

1. <span data-ttu-id="7b891-250">Reinicie o servidor NPS.</span><span class="sxs-lookup"><span data-stu-id="7b891-250">Restart your NPS server.</span></span>
2. <span data-ttu-id="7b891-251">Verifique se o certificado do cliente está instalado conforme o esperado.</span><span class="sxs-lookup"><span data-stu-id="7b891-251">Verify that that client cert is installed as expected.</span></span>
3. <span data-ttu-id="7b891-252">Verifique se que esse certificado hello está associado ao seu locatário no AD do Azure.</span><span class="sxs-lookup"><span data-stu-id="7b891-252">Verify that hello certificate is associated with your tenant on Azure AD.</span></span>
4. <span data-ttu-id="7b891-253">Verifique se que https://login.microsoftonline.com/ está acessível no servidor de saudação executando a extensão de saudação.</span><span class="sxs-lookup"><span data-stu-id="7b891-253">Verify that https://login.microsoftonline.com/ is accessible from hello server running hello extension.</span></span>

-------------------------------------------------------------

### <a name="why-does-authentication-fail-with-an-error-in-http-logs-stating-that-hello-user-is-not-found"></a><span data-ttu-id="7b891-254">Por que a autenticação falha com um erro nos logs HTTP, indicando que o usuário Olá não foi encontrado?</span><span class="sxs-lookup"><span data-stu-id="7b891-254">Why does authentication fail with an error in HTTP logs stating that hello user is not found?</span></span>

<span data-ttu-id="7b891-255">Verifique se o AD Connect está em execução, e esse usuário hello está presente no Active Directory do Windows e o Active Directory do Azure.</span><span class="sxs-lookup"><span data-stu-id="7b891-255">Verify that AD Connect is running, and that hello user is present in both Windows Active Directory and Azure Active Directory.</span></span>

------------------------------------------------------------

### <a name="why-do-i-see-http-connect-errors-in-logs-with-all-my-authentications-failing"></a><span data-ttu-id="7b891-256">Por que vejo erros de conexão HTTP nos logs, com todas as minhas autenticações falhando?</span><span class="sxs-lookup"><span data-stu-id="7b891-256">Why do I see HTTP connect errors in logs with all my authentications failing?</span></span>

<span data-ttu-id="7b891-257">Verifique se que esse https://adnotifications.windowsazure.com é acessível do servidor de saudação executando a extensão de NPS hello.</span><span class="sxs-lookup"><span data-stu-id="7b891-257">Verify that https://adnotifications.windowsazure.com is reachable from hello server running hello NPS extension.</span></span>


## <a name="next-steps"></a><span data-ttu-id="7b891-258">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="7b891-258">Next steps</span></span>

- <span data-ttu-id="7b891-259">Configurar IDs alternativos para logon, ou configurar uma lista de exceções para IPs que não devem executar a verificação em duas etapas no [configuração Opções avançadas para Olá extensão NPS para autenticação multifator](nps-extension-advanced-configuration.md)</span><span class="sxs-lookup"><span data-stu-id="7b891-259">Configure alternate IDs for login, or set up an exception list for IPs that shouldn't perform two-step verification in [Advanced configuration options for hello NPS extension for Multi-Factor Authentication](nps-extension-advanced-configuration.md)</span></span>

- [<span data-ttu-id="7b891-260">Resolver mensagens de erro de saudação extensão NPS para o Azure multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="7b891-260">Resolve error messages from hello NPS extension for Azure Multi-Factor Authentication</span></span>](multi-factor-authentication-nps-errors.md)
