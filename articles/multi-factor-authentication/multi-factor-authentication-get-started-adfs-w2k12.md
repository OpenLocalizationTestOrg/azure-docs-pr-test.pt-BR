---
title: Servidor do MFA com AD FS no Windows Server | Microsoft Docs
description: "Este artigo descreve como começar a usar a Autenticação Multifator do Azure e o AD FS no Windows Server 2012 R2 e 2016."
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
editor: yossib
ms.assetid: 57208068-1e55-45b6-840f-fdcd13723074
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 03/29/2017
ms.author: kgremban
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: f2481c18f12d74a90938ffb0353dd000fe73f440
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="configure-azure-multi-factor-authentication-server-to-work-with-ad-fs-in-windows-server"></a><span data-ttu-id="19b37-103">Configurar o Servidor de Autenticação Multifator do Azure para trabalhar com o AD FS no Windows Server</span><span class="sxs-lookup"><span data-stu-id="19b37-103">Configure Azure Multi-Factor Authentication Server to work with AD FS in Windows Server</span></span>
<span data-ttu-id="19b37-104">Se você usa o AD FS (Serviços de Federação do Active Directory) e deseja proteger recursos na nuvem ou locais, pode configurar o servidor de Autenticação Multifator do Azure para trabalhar com o AD FS.</span><span class="sxs-lookup"><span data-stu-id="19b37-104">If you use Active Directory Federation Services (AD FS) and want to secure cloud or on-premises resources, you can configure Azure Multi-Factor Authentication Server to work with AD FS.</span></span> <span data-ttu-id="19b37-105">Essa configuração dispara a verificação em duas etapas para pontos de extremidade de alto valor.</span><span class="sxs-lookup"><span data-stu-id="19b37-105">This configuration triggers two-step verification for high-value endpoints.</span></span>

<span data-ttu-id="19b37-106">Neste artigo, discutimos o uso do Servidor de Autenticação Multifator do Azure com o AD FS no Windows Server 2012 R2 ou no Windows Server 2016.</span><span class="sxs-lookup"><span data-stu-id="19b37-106">In this article, we discuss using Azure Multi-Factor Authentication Server with AD FS in Windows Server 2012 R2 or Windows Server 2016.</span></span> <span data-ttu-id="19b37-107">Para saber mais, leia sobre como [proteger recursos de nuvem e locais usando o Servidor Azure Multi-Factor Authentication com o AD FS 2.0](multi-factor-authentication-get-started-adfs-adfs2.md).</span><span class="sxs-lookup"><span data-stu-id="19b37-107">For more information, read about how to [secure cloud and on-premises resources by using Azure Multi-Factor Authentication Server with AD FS 2.0](multi-factor-authentication-get-started-adfs-adfs2.md).</span></span>

## <a name="secure-windows-server-ad-fs-with-azure-multi-factor-authentication-server"></a><span data-ttu-id="19b37-108">Proteger o AD FS do Windows Server com o Servidor de Autenticação Multifator do Azure</span><span class="sxs-lookup"><span data-stu-id="19b37-108">Secure Windows Server AD FS with Azure Multi-Factor Authentication Server</span></span>
<span data-ttu-id="19b37-109">Ao instalar o Servidor Azure Multi-Factor Authentication, você tem as seguintes opções:</span><span class="sxs-lookup"><span data-stu-id="19b37-109">When you install Azure Multi-Factor Authentication Server, you have the following options:</span></span>

* <span data-ttu-id="19b37-110">Instalar o Servidor Azure Multi-Factor Authentication localmente no mesmo servidor que o AD FS</span><span class="sxs-lookup"><span data-stu-id="19b37-110">Install Azure Multi-Factor Authentication Server locally on the same server as AD FS</span></span>
* <span data-ttu-id="19b37-111">Instalar o adaptador do Azure Multi-Factor Authentication localmente no servidor do AD FS e instalar o Servidor Multi-Factor Authentication em outro computador</span><span class="sxs-lookup"><span data-stu-id="19b37-111">Install the Azure Multi-Factor Authentication adapter locally on the AD FS server, and then install Multi-Factor Authentication Server on a different computer</span></span>

<span data-ttu-id="19b37-112">Antes de começar, esteja ciente das seguintes informações:</span><span class="sxs-lookup"><span data-stu-id="19b37-112">Before you begin, be aware of the following information:</span></span>

* <span data-ttu-id="19b37-113">Não é necessário instalar o Servidor Azure Multi-Factor Authentication no servidor do AD FS.</span><span class="sxs-lookup"><span data-stu-id="19b37-113">You are not required to install Azure Multi-Factor Authentication Server on your AD FS server.</span></span> <span data-ttu-id="19b37-114">No entanto, você deve instalar o adaptador da Autenticação Multifator para o AD FS no Windows Server 2012 R2 ou no Windows Server 2016 que está executando o AD FS.</span><span class="sxs-lookup"><span data-stu-id="19b37-114">However, you must install the Multi-Factor Authentication adapter for AD FS on a Windows Server 2012 R2 or Windows Server 2016 that is running AD FS.</span></span> <span data-ttu-id="19b37-115">Você pode instalar o servidor em outro computador, desde que seja uma versão com suporte, e instalar o adaptador do AD FS separadamente no seu servidor de federação do AD FS.</span><span class="sxs-lookup"><span data-stu-id="19b37-115">You can install the server on a different computer if it is a supported version and you install the AD FS adapter separately on your AD FS federation server.</span></span> <span data-ttu-id="19b37-116">Confira os procedimentos a seguir para aprender a instalar o adaptador separadamente.</span><span class="sxs-lookup"><span data-stu-id="19b37-116">See the following procedures to learn how to install the adapter separately.</span></span>
* <span data-ttu-id="19b37-117">Se sua organização estiver usando mensagens de texto ou de métodos de verificação de aplicativos móveis, as cadeias de caracteres definidas em Configurações da Empresa contêm um espaço reservado <$*nome_do_aplicativo*$>.</span><span class="sxs-lookup"><span data-stu-id="19b37-117">If your organization is using text message or mobile app verification methods, the strings defined in Company Settings contain a placeholder, <$*application_name*$>.</span></span> <span data-ttu-id="19b37-118">No Servidor de MFA v7.1, você pode fornecer um nome de aplicativo que substitui esse espaço reservado.</span><span class="sxs-lookup"><span data-stu-id="19b37-118">In MFA Server v7.1, you can provide an application name that replaces this placeholder.</span></span> <span data-ttu-id="19b37-119">No v7.0 ou mais antigo, esse espaço reservado não será substituído automaticamente quando você usar o adaptador do AD FS.</span><span class="sxs-lookup"><span data-stu-id="19b37-119">In v7.0 or older, this placeholder is not automatically replaced when you use the AD FS adapter.</span></span> <span data-ttu-id="19b37-120">Para essas versões mais antigas, remova o espaço reservado de cadeias de caracteres apropriadas ao proteger o AD FS.</span><span class="sxs-lookup"><span data-stu-id="19b37-120">For those older versions, remove the placeholder from the appropriate strings when you secure AD FS.</span></span>
* <span data-ttu-id="19b37-121">A conta que você usa para entrar deve ter direitos de usuário para criar grupos de segurança no serviço do Active Directory.</span><span class="sxs-lookup"><span data-stu-id="19b37-121">The account that you use to sign in must have user rights to create security groups in your Active Directory service.</span></span>
* <span data-ttu-id="19b37-122">O assistente de instalação de adaptador do AD FS de Autenticação Multifator cria um grupo de segurança chamado PhoneFactor Admins na sua instância do Active Directory.</span><span class="sxs-lookup"><span data-stu-id="19b37-122">The Multi-Factor Authentication AD FS adapter installation wizard creates a security group called PhoneFactor Admins in your instance of Active Directory.</span></span> <span data-ttu-id="19b37-123">Em seguida, ele adiciona a conta de serviço do seu serviço de Federação do AD FS a esse grupo.</span><span class="sxs-lookup"><span data-stu-id="19b37-123">It then adds the AD FS service account of your federation service to this group.</span></span> <span data-ttu-id="19b37-124">Verifique no controlador de domínio que o grupo PhoneFactor Admins realmente é criado e se a conta de serviço do AD FS é membro desse grupo.</span><span class="sxs-lookup"><span data-stu-id="19b37-124">Verify on your domain controller that the PhoneFactor Admins group is indeed created and that the AD FS service account is a member of this group.</span></span> <span data-ttu-id="19b37-125">Se necessário, adicione manualmente a conta de serviço do AD FS ao grupo PhoneFactor Admins no controlador de domínio.</span><span class="sxs-lookup"><span data-stu-id="19b37-125">If necessary, manually add the AD FS service account to the PhoneFactor Admins group on your domain controller.</span></span>
* <span data-ttu-id="19b37-126">Para saber mais sobre como instalar o SDK do Serviço Web com o portal do usuário, leia sobre a [implantação do portal do usuário para o Servidor Azure Multi-Factor Authentication.](multi-factor-authentication-get-started-portal.md)</span><span class="sxs-lookup"><span data-stu-id="19b37-126">For information about installing the Web Service SDK with the user portal, read about [deploying the user portal for Azure Multi-Factor Authentication Server.](multi-factor-authentication-get-started-portal.md)</span></span>

### <a name="install-azure-multi-factor-authentication-server-locally-on-the-ad-fs-server"></a><span data-ttu-id="19b37-127">Instalar o Servidor Azure Multi-Factor Authentication localmente no mesmo servidor que o AD FS</span><span class="sxs-lookup"><span data-stu-id="19b37-127">Install Azure Multi-Factor Authentication Server locally on the AD FS server</span></span>
1. <span data-ttu-id="19b37-128">Baixe e instale o Servidor de Autenticação Multifator do Microsoft Azure no servidor do AD FS.</span><span class="sxs-lookup"><span data-stu-id="19b37-128">Download and install Azure Multi-Factor Authentication Server on your AD FS server.</span></span> <span data-ttu-id="19b37-129">Para obter informações sobre instalação, leia sobre a [introdução ao Servidor Azure Multi-Factor Authentication](multi-factor-authentication-get-started-server.md).</span><span class="sxs-lookup"><span data-stu-id="19b37-129">For installation information, read about [getting started with Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server.md).</span></span>
2. <span data-ttu-id="19b37-130">No console de gerenciamento do Servidor de Autenticação Multifator do Azure, clique no ícone **AD FS**.</span><span class="sxs-lookup"><span data-stu-id="19b37-130">In the Azure Multi-Factor Authentication Server management console, click the **AD FS** icon.</span></span> <span data-ttu-id="19b37-131">Selecione as opções **Permitir registro de usuário** e **Permitir que os usuários selecionem o método**.</span><span class="sxs-lookup"><span data-stu-id="19b37-131">Select the options **Allow user enrollment** and **Allow users to select method**.</span></span>
3. <span data-ttu-id="19b37-132">Selecione as opções adicionais que você deseja especificar para a sua organização.</span><span class="sxs-lookup"><span data-stu-id="19b37-132">Select any additional options you'd like to specify for your organization.</span></span>
4. <span data-ttu-id="19b37-133">Clique em **Instalar Adaptador do AD FS**.</span><span class="sxs-lookup"><span data-stu-id="19b37-133">Click **Install AD FS Adapter**.</span></span>
   
   <span data-ttu-id="19b37-134"><center>![Nuvem](./media/multi-factor-authentication-get-started-adfs-w2k12/server.png)</center></span><span class="sxs-lookup"><span data-stu-id="19b37-134"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/server.png)</center></span></span>

5. <span data-ttu-id="19b37-135">Se a janela do Active Directory for exibida, isso significará duas coisas.</span><span class="sxs-lookup"><span data-stu-id="19b37-135">If the Active Directory window is displayed, that means two things.</span></span> <span data-ttu-id="19b37-136">O computador faz parte de um domínio e a configuração do Active Directory para proteger a comunicação entre o adaptador do AD FS e o serviço de autenticação multifator está incompleta.</span><span class="sxs-lookup"><span data-stu-id="19b37-136">Your computer is joined to a domain, and the Active Directory configuration for securing communication between the AD FS adapter and the Multi-Factor Authentication service is incomplete.</span></span> <span data-ttu-id="19b37-137">Clique em **Avançar** para concluir automaticamente essa configuração ou marque a caixa de seleção **Ignorar configuração automática do Active Directory e definir as configurações manualmente**.</span><span class="sxs-lookup"><span data-stu-id="19b37-137">Click **Next** to automatically complete this configuration, or select the **Skip automatic Active Directory configuration and configure settings manually** check box.</span></span> <span data-ttu-id="19b37-138">Clique em **Avançar**.</span><span class="sxs-lookup"><span data-stu-id="19b37-138">Click **Next**.</span></span>
6. <span data-ttu-id="19b37-139">Se as janelas de Grupo Local forem exibidas, isso significará duas coisas.</span><span class="sxs-lookup"><span data-stu-id="19b37-139">If the Local Group windows is displayed, that means two things.</span></span> <span data-ttu-id="19b37-140">Seu computador não faz parte de um domínio e a configuração do grupo local para proteger a comunicação entre o adaptador do AD FS e o serviço de autenticação multifator está incompleta.</span><span class="sxs-lookup"><span data-stu-id="19b37-140">Your computer is not joined to a domain, and the local group configuration for securing communication between the AD FS adapter and the Multi-Factor Authentication service is incomplete.</span></span> <span data-ttu-id="19b37-141">Clique em **Avançar** para concluir automaticamente essa configuração ou marque a caixa de seleção **Ignorar configuração automática do Grupo Local e definir as configurações manualmente**.</span><span class="sxs-lookup"><span data-stu-id="19b37-141">Click **Next** to automatically complete this configuration, or select the **Skip automatic Local Group configuration and configure settings manually** check box.</span></span> <span data-ttu-id="19b37-142">Clique em **Avançar**.</span><span class="sxs-lookup"><span data-stu-id="19b37-142">Click **Next**.</span></span>
7. <span data-ttu-id="19b37-143">No Assistente de instalação, clique em **Avançar**.</span><span class="sxs-lookup"><span data-stu-id="19b37-143">In the installation wizard, click **Next**.</span></span> <span data-ttu-id="19b37-144">O Servidor Azure Multi-Factor Authentication cria o grupo PhoneFactor Admins e adiciona a conta de serviço do AD FS ao grupo PhoneFactor Admins.</span><span class="sxs-lookup"><span data-stu-id="19b37-144">Azure Multi-Factor Authentication Server creates the PhoneFactor Admins group and adds the AD FS service account to the PhoneFactor Admins group.</span></span>
   <span data-ttu-id="19b37-145"><center>![Nuvem](./media/multi-factor-authentication-get-started-adfs-w2k12/adapter.png)</center></span><span class="sxs-lookup"><span data-stu-id="19b37-145"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/adapter.png)</center></span></span>
8. <span data-ttu-id="19b37-146">Na página **Iniciar Instalador**, clique em **Avançar**.</span><span class="sxs-lookup"><span data-stu-id="19b37-146">On the **Launch Installer** page, click **Next**.</span></span>
9. <span data-ttu-id="19b37-147">No instalador do adaptador do AD FS do Multi-Factor Authentication, clique em **Avançar**.</span><span class="sxs-lookup"><span data-stu-id="19b37-147">In the Multi-Factor Authentication AD FS adapter installer, click **Next**.</span></span>
10. <span data-ttu-id="19b37-148">Clique em **Fechar** quando a instalação for concluída.</span><span class="sxs-lookup"><span data-stu-id="19b37-148">Click **Close** when the installation is finished.</span></span>
11. <span data-ttu-id="19b37-149">Quando o adaptador tiver sido instalado, você deverá registrá-lo no AD FS.</span><span class="sxs-lookup"><span data-stu-id="19b37-149">When the adapter has been installed, you must register it with AD FS.</span></span> <span data-ttu-id="19b37-150">Abra PowerShell e execute o seguinte comando:</span><span class="sxs-lookup"><span data-stu-id="19b37-150">Open Windows PowerShell and run the following command:</span></span><br><span data-ttu-id="19b37-151">
    `C:\Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1`
    <center>![Nuvem](./media/multi-factor-authentication-get-started-adfs-w2k12/pshell.png)</center></span><span class="sxs-lookup"><span data-stu-id="19b37-151">
`C:\Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1`
<center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/pshell.png)</center></span></span>
12. <span data-ttu-id="19b37-152">Para usar o adaptador recém-registrado, edite a política de autenticação global no AD FS.</span><span class="sxs-lookup"><span data-stu-id="19b37-152">To use your newly registered adapter, edit the global authentication policy in AD FS.</span></span> <span data-ttu-id="19b37-153">No console de gerenciamento do AD FS, vá até o nó **Políticas de Autenticação** .</span><span class="sxs-lookup"><span data-stu-id="19b37-153">In the AD FS management console, go to the **Authentication Policies** node.</span></span> <span data-ttu-id="19b37-154">Na seção **Autenticação Multifator**, clique no link **Editar** próximo à seção **Configurações Globais**.</span><span class="sxs-lookup"><span data-stu-id="19b37-154">In the **Multi-factor Authentication** section, click the **Edit** link next to the **Global Settings** section.</span></span> <span data-ttu-id="19b37-155">Na janela **Editar Política de Autenticação Global**, selecione **Autenticação Multifator** como um método de autenticação adicional e clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="19b37-155">In the **Edit Global Authentication Policy** window, select **Multi-Factor Authentication** as an additional authentication method, and then click **OK**.</span></span> <span data-ttu-id="19b37-156">O adaptador é registrado como WindowsAzureMultiFactorAuthentication.</span><span class="sxs-lookup"><span data-stu-id="19b37-156">The adapter is registered as WindowsAzureMultiFactorAuthentication.</span></span> <span data-ttu-id="19b37-157">Reinicie o serviço AD FS para que o registro entre em vigor.</span><span class="sxs-lookup"><span data-stu-id="19b37-157">Restart the AD FS service for the registration to take effect.</span></span>

<span data-ttu-id="19b37-158"><center>![Nuvem](./media/multi-factor-authentication-get-started-adfs-w2k12/global.png)</center></span><span class="sxs-lookup"><span data-stu-id="19b37-158"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/global.png)</center></span></span>

<span data-ttu-id="19b37-159">Neste ponto, o Servidor Multi-Factor Authentication está configurado para ser um provedor de autenticação adicional a ser usado com o AD FS.</span><span class="sxs-lookup"><span data-stu-id="19b37-159">At this point, Multi-Factor Authentication Server is set up to be an additional authentication provider to use with AD FS.</span></span>

## <a name="install-a-standalone-instance-of-the-ad-fs-adapter-by-using-the-web-service-sdk"></a><span data-ttu-id="19b37-160">Instalar o adaptador do AD FS autônomo usando o SDK do serviço Web</span><span class="sxs-lookup"><span data-stu-id="19b37-160">Install a standalone instance of the AD FS adapter by using the Web Service SDK</span></span>
1. <span data-ttu-id="19b37-161">Instale o SDK do Serviço Web no servidor que esteja executando o Servidor Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="19b37-161">Install the Web Service SDK on the server that is running Multi-Factor Authentication Server.</span></span>
2. <span data-ttu-id="19b37-162">Copie os arquivos a seguir do diretório \Arquivos de Programa\Multi-Factor Authentication Server para o servidor no qual você planeja instalar o adaptador do AD FS:</span><span class="sxs-lookup"><span data-stu-id="19b37-162">Copy the following files from the \Program Files\Multi-Factor Authentication Server directory to the server on which you plan to install the AD FS adapter:</span></span>
   * <span data-ttu-id="19b37-163">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span><span class="sxs-lookup"><span data-stu-id="19b37-163">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span></span>
   * <span data-ttu-id="19b37-164">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="19b37-164">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
   * <span data-ttu-id="19b37-165">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="19b37-165">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
   * <span data-ttu-id="19b37-166">MultiFactorAuthenticationAdfsAdapter.config</span><span class="sxs-lookup"><span data-stu-id="19b37-166">MultiFactorAuthenticationAdfsAdapter.config</span></span>
3. <span data-ttu-id="19b37-167">Execute a instalação de MultiFactorAuthenticationAdfsAdapterSetup64.msi.</span><span class="sxs-lookup"><span data-stu-id="19b37-167">Run the MultiFactorAuthenticationAdfsAdapterSetup64.msi installation file.</span></span>
4. <span data-ttu-id="19b37-168">No instalador do Adaptador do AD FS da Autenticação Multifator, clique em **Avançar** para iniciar a instalação.</span><span class="sxs-lookup"><span data-stu-id="19b37-168">In the Multi-Factor Authentication AD FS adapter installer, click **Next** to start the installation.</span></span>
5. <span data-ttu-id="19b37-169">Clique em **Fechar** quando a instalação for concluída.</span><span class="sxs-lookup"><span data-stu-id="19b37-169">Click **Close** when the installation is finished.</span></span>

## <a name="edit-the-multifactorauthenticationadfsadapterconfig-file"></a><span data-ttu-id="19b37-170">Editar o arquivo MultiFactorAuthenticationAdfsAdapter.config</span><span class="sxs-lookup"><span data-stu-id="19b37-170">Edit the MultiFactorAuthenticationAdfsAdapter.config file</span></span>
<span data-ttu-id="19b37-171">Execute estas etapas para editar o arquivo MultiFactorAuthenticationAdfsAdapter.config:</span><span class="sxs-lookup"><span data-stu-id="19b37-171">Follow these steps to edit the MultiFactorAuthenticationAdfsAdapter.config file:</span></span>

1. <span data-ttu-id="19b37-172">Defina o nó **UseWebServiceSdk** como **true**.</span><span class="sxs-lookup"><span data-stu-id="19b37-172">Set the **UseWebServiceSdk** node to **true**.</span></span>  
2. <span data-ttu-id="19b37-173">Defina o valor **WebServiceSdkUrl** para a URL do SDK do Serviço Web da Autenticação Multifator.</span><span class="sxs-lookup"><span data-stu-id="19b37-173">Set the value for **WebServiceSdkUrl** to the URL of the Multi-Factor Authentication Web Service SDK.</span></span> <span data-ttu-id="19b37-174">Por exemplo: *https://contoso.com/&lt;certificatename&gt;/MultiFactorAuthWebServiceSdk/PfWsSdk.asmx*, em que *certificatename* é o nome do seu certificado.</span><span class="sxs-lookup"><span data-stu-id="19b37-174">For example:  *https://contoso.com/&lt;certificatename&gt;/MultiFactorAuthWebServiceSdk/PfWsSdk.asmx*, Where *certificatename* is the name of your certificate.</span></span>  
3. <span data-ttu-id="19b37-175">Edite o script Register-MultiFactorAuthenticationAdfsAdapter.ps1 adicionando *-ConfigurationFilePath &lt;caminho&gt;* ao fim do comando `Register-AdfsAuthenticationProvider`, em que *&lt;caminho&gt;* é o caminho completo para o arquivo MultiFactorAuthenticationAdfsAdapter.config.</span><span class="sxs-lookup"><span data-stu-id="19b37-175">Edit the Register-MultiFactorAuthenticationAdfsAdapter.ps1 script by adding *-ConfigurationFilePath &lt;path&gt;* to the end of the `Register-AdfsAuthenticationProvider` command, where *&lt;path&gt;* is the full path to the MultiFactorAuthenticationAdfsAdapter.config file.</span></span>

### <a name="configure-the-web-service-sdk-with-a-username-and-password"></a><span data-ttu-id="19b37-176">Configurar o SDK do Serviço Web com um nome de usuário e senha</span><span class="sxs-lookup"><span data-stu-id="19b37-176">Configure the Web Service SDK with a username and password</span></span>
<span data-ttu-id="19b37-177">Há duas opções para configurar o SDK do Serviço Web.</span><span class="sxs-lookup"><span data-stu-id="19b37-177">There are two options for configuring the Web Service SDK.</span></span> <span data-ttu-id="19b37-178">A primeira é com um nome de usuário e senha, a segunda é com um certificado de cliente.</span><span class="sxs-lookup"><span data-stu-id="19b37-178">The first is with a username and password, the second is with a client certificate.</span></span> <span data-ttu-id="19b37-179">Execute estas etapas para a primeira opção, ou pule para a segunda.</span><span class="sxs-lookup"><span data-stu-id="19b37-179">Follow these steps for the first option, or skip ahead for the second.</span></span>  

1. <span data-ttu-id="19b37-180">Defina o valor como **WebServiceSdkUsername** para uma conta membro do grupo de segurança PhoneFactor Admins.</span><span class="sxs-lookup"><span data-stu-id="19b37-180">Set the value for **WebServiceSdkUsername** to an account that is a member of the PhoneFactor Admins security group.</span></span> <span data-ttu-id="19b37-181">Use o formato &lt;domínio&gt;&#92;&lt;nome de usuário&gt;.</span><span class="sxs-lookup"><span data-stu-id="19b37-181">Use the &lt;domain&gt;&#92;&lt;user name&gt; format.</span></span>  
2. <span data-ttu-id="19b37-182">Defina o valor de **WebServiceSdkPassword** para a senha da conta apropriada.</span><span class="sxs-lookup"><span data-stu-id="19b37-182">Set the value for **WebServiceSdkPassword** to the appropriate account password.</span></span>

### <a name="configure-the-web-service-sdk-with-a-client-certificate"></a><span data-ttu-id="19b37-183">Configurar o SDK do Serviço Web com um certificado de cliente</span><span class="sxs-lookup"><span data-stu-id="19b37-183">Configure the Web Service SDK with a client certificate</span></span>
<span data-ttu-id="19b37-184">Se você não quiser usar um nome de usuário e senha, execute estas etapas para configurar o SDK do Serviço da Web com um certificado de cliente.</span><span class="sxs-lookup"><span data-stu-id="19b37-184">If you don't want to use a username and password, follow these steps to configure the Web Service SDK with a client certificate.</span></span>

1. <span data-ttu-id="19b37-185">Obtenha um certificado do cliente de uma autoridade de certificação para o servidor que está executando o SDK de Serviço Web.</span><span class="sxs-lookup"><span data-stu-id="19b37-185">Obtain a client certificate from a certificate authority for the server that is running the Web Service SDK.</span></span> <span data-ttu-id="19b37-186">Saiba como [obter certificados de cliente](https://technet.microsoft.com/library/cc770328.aspx).</span><span class="sxs-lookup"><span data-stu-id="19b37-186">Learn how to [obtain client certificates](https://technet.microsoft.com/library/cc770328.aspx).</span></span>  
2. <span data-ttu-id="19b37-187">Importe o certificado do cliente no repositório de certificados pessoais do computador local no servidor que está executando o SDK do Serviço Web.</span><span class="sxs-lookup"><span data-stu-id="19b37-187">Import the client certificate to the local computer personal certificate store on the server that is running the Web Service SDK.</span></span> <span data-ttu-id="19b37-188">Verifique se o certificado público da autoridade de certificação está no repositório de certificados de Certificados Raiz Confiáveis.</span><span class="sxs-lookup"><span data-stu-id="19b37-188">Make sure that the certificate authority's public certificate is in Trusted Root Certificates certificate store.</span></span>  
3. <span data-ttu-id="19b37-189">Exporte as chaves pública e privada do certificado do cliente para um arquivo .pfx.</span><span class="sxs-lookup"><span data-stu-id="19b37-189">Export the public and private keys of the client certificate to a .pfx file.</span></span>  
4. <span data-ttu-id="19b37-190">Exporte a chave pública no formato Base64 em um arquivo .cer.</span><span class="sxs-lookup"><span data-stu-id="19b37-190">Export the public key in Base64 format to a .cer file.</span></span>  
5. <span data-ttu-id="19b37-191">No Gerenciador de Servidores, verifique se o recurso Servidor da Web (IIS)\Servidor da Web\Segurança\Autenticação de mapeamento de certificado de cliente SSL está instalado.</span><span class="sxs-lookup"><span data-stu-id="19b37-191">In Server Manager, verify that the Web Server (IIS)\Web Server\Security\IIS Client Certificate Mapping Authentication feature is installed.</span></span> <span data-ttu-id="19b37-192">Se não estiver instalado, selecione **Adicionar Funções e Recursos** para adicionar esse recurso.</span><span class="sxs-lookup"><span data-stu-id="19b37-192">If it is not installed, select **Add Roles and Features** to add this feature.</span></span>  
6. <span data-ttu-id="19b37-193">No Gerenciador do IIS, clique duas vezes em **Editor de Configuração** no site que contém o diretório virtual do SDK do Serviço Web.</span><span class="sxs-lookup"><span data-stu-id="19b37-193">In IIS Manager, double-click **Configuration Editor** in the website that contains the Web Service SDK virtual directory.</span></span> <span data-ttu-id="19b37-194">É importante selecionar o site, não o diretório virtual.</span><span class="sxs-lookup"><span data-stu-id="19b37-194">It is important to select the website, not the virtual directory.</span></span>  
7. <span data-ttu-id="19b37-195">Acesse a seção **system.webServer/security/authentication/iisClientCertificateMappingAuthentication** .</span><span class="sxs-lookup"><span data-stu-id="19b37-195">Go to the **system.webServer/security/authentication/iisClientCertificateMappingAuthentication** section.</span></span>  
8. <span data-ttu-id="19b37-196">Defina habilitado como **true**.</span><span class="sxs-lookup"><span data-stu-id="19b37-196">Set enabled to **true**.</span></span>  
9. <span data-ttu-id="19b37-197">Defina oneToOneCertificateMappingsEnabled como **true**.</span><span class="sxs-lookup"><span data-stu-id="19b37-197">Set oneToOneCertificateMappingsEnabled to **true**.</span></span>  
10. <span data-ttu-id="19b37-198">Clique no botão **...** próximo a oneToOneMappings e clique no link **Adicionar**.</span><span class="sxs-lookup"><span data-stu-id="19b37-198">Click the **...** button next to oneToOneMappings, and then click the **Add** link.</span></span>  
11. <span data-ttu-id="19b37-199">Abra o arquivo .cer de Base64 exportado anteriormente.</span><span class="sxs-lookup"><span data-stu-id="19b37-199">Open the Base64 .cer file you exported earlier.</span></span> <span data-ttu-id="19b37-200">Remova *-----BEGIN CERTIFICATE-----*, *-----END CERTIFICATE-----* e todas as quebras de linha.</span><span class="sxs-lookup"><span data-stu-id="19b37-200">Remove *-----BEGIN CERTIFICATE-----*, *-----END CERTIFICATE-----*, and any line breaks.</span></span> <span data-ttu-id="19b37-201">Copie a cadeia de caracteres resultante.</span><span class="sxs-lookup"><span data-stu-id="19b37-201">Copy the resulting string.</span></span>  
12. <span data-ttu-id="19b37-202">Defina o certificado para a cadeia de caracteres copiada na etapa anterior.</span><span class="sxs-lookup"><span data-stu-id="19b37-202">Set certificate to the string copied in the preceding step.</span></span>  
13. <span data-ttu-id="19b37-203">Defina habilitado como **true**.</span><span class="sxs-lookup"><span data-stu-id="19b37-203">Set enabled to **true**.</span></span>  
14. <span data-ttu-id="19b37-204">Defina userName para uma conta que seja membro do grupo de segurança PhoneFactor Admins.</span><span class="sxs-lookup"><span data-stu-id="19b37-204">Set userName to an account that is a member of the PhoneFactor Admins security group.</span></span> <span data-ttu-id="19b37-205">Use o formato &lt;domínio&gt;&#92;&lt;nome de usuário&gt;.</span><span class="sxs-lookup"><span data-stu-id="19b37-205">Use the &lt;domain&gt;&#92;&lt;user name&gt; format.</span></span>  
15. <span data-ttu-id="19b37-206">Defina a senha como a senha da conta apropriada e, em seguida, feche o Editor de Configuração.</span><span class="sxs-lookup"><span data-stu-id="19b37-206">Set the password to the appropriate account password, and then close Configuration Editor.</span></span>  
16. <span data-ttu-id="19b37-207">Clique no link **Aplicar** .</span><span class="sxs-lookup"><span data-stu-id="19b37-207">Click the **Apply** link.</span></span>  
17. <span data-ttu-id="19b37-208">No diretório virtual do SDK do Serviço Web, clique duas vezes em **Autenticação**.</span><span class="sxs-lookup"><span data-stu-id="19b37-208">In the Web Service SDK virtual directory, double-click **Authentication**.</span></span>  
18. <span data-ttu-id="19b37-209">Verifique se Personificação do ASP.NET e Autenticação Básica estão definidos como **Habilitado** e se todos os outros itens estão definidos como **Desabilitado**.</span><span class="sxs-lookup"><span data-stu-id="19b37-209">Verify that ASP.NET Impersonation and Basic Authentication are set to **Enabled**, and that all other items are set to **Disabled**.</span></span>  
19. <span data-ttu-id="19b37-210">No diretório virtual do SDK do Serviço Web, clique duas vezes em **Configurações de SSL**.</span><span class="sxs-lookup"><span data-stu-id="19b37-210">In the Web Service SDK virtual directory, double-click **SSL Settings**.</span></span>  
20. <span data-ttu-id="19b37-211">Defina Certificados de Cliente como **Aceitar** e depois clique em **Aplicar**.</span><span class="sxs-lookup"><span data-stu-id="19b37-211">Set Client Certificates to **Accept**, and then click **Apply**.</span></span>  
21. <span data-ttu-id="19b37-212">Copie o arquivo .pfx exportado anteriormente no servidor que está executando o adaptador do AD FS.</span><span class="sxs-lookup"><span data-stu-id="19b37-212">Copy the .pfx file you exported earlier to the server that is running the AD FS adapter.</span></span>  
22. <span data-ttu-id="19b37-213">Importe o arquivo .pfx para o repositório de certificados pessoais do computador local.</span><span class="sxs-lookup"><span data-stu-id="19b37-213">Import the .pfx file to the local computer personal certificate store.</span></span>  
23. <span data-ttu-id="19b37-214">Clique com o botão direito do mouse e selecione **Gerenciar Chaves Privadas**e, em seguida, conceda acesso de leitura à conta usada para entrar no serviço do AD FS.</span><span class="sxs-lookup"><span data-stu-id="19b37-214">Right-click and select **Manage Private Keys**, and then grant read access to the account you used to sign in to the AD FS service.</span></span>  
24. <span data-ttu-id="19b37-215">Abra o certificado de cliente e copie a impressão digital da guia **Detalhes** .</span><span class="sxs-lookup"><span data-stu-id="19b37-215">Open the client certificate and copy the thumbprint from the **Details** tab.</span></span>  
25. <span data-ttu-id="19b37-216">No arquivo MultiFactorAuthenticationAdfsAdapter.config, defina **WebServiceSdkCertificateThumbprint** para a cadeia de caracteres copiada na etapa anterior.</span><span class="sxs-lookup"><span data-stu-id="19b37-216">In the MultiFactorAuthenticationAdfsAdapter.config file, set **WebServiceSdkCertificateThumbprint** to the string copied in the previous step.</span></span>  

<span data-ttu-id="19b37-217">Por fim, execute o script \Arquivos de Programa\Servidor Autenticação Multifator\Register-MultiFactorAuthenticationAdfsAdapter.ps1 no PowerShell.</span><span class="sxs-lookup"><span data-stu-id="19b37-217">Finally, to register the adapter, run the \Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1 script in PowerShell.</span></span> <span data-ttu-id="19b37-218">O adaptador é registrado como WindowsAzureMultiFactorAuthentication.</span><span class="sxs-lookup"><span data-stu-id="19b37-218">The adapter is registered as WindowsAzureMultiFactorAuthentication.</span></span> <span data-ttu-id="19b37-219">Reinicie o serviço AD FS para que o registro entre em vigor.</span><span class="sxs-lookup"><span data-stu-id="19b37-219">Restart the AD FS service for the registration to take effect.</span></span>

## <a name="secure-azure-ad-resources-using-ad-fs"></a><span data-ttu-id="19b37-220">Proteger recursos do Azure AD usando o AD FS</span><span class="sxs-lookup"><span data-stu-id="19b37-220">Secure Azure AD resources using AD FS</span></span>
<span data-ttu-id="19b37-221">Para proteger seus recursos de nuvem, configure uma regra de declaração para que os Serviços de Federação do Active Directory emitem a declaração multipleauthn quando um usuário executa a verificação em duas etapas com êxito.</span><span class="sxs-lookup"><span data-stu-id="19b37-221">To secure your cloud resource, set up a claims rule so that Active Directory Federation Services emits the multipleauthn claim when a user performs two-step verification successfully.</span></span> <span data-ttu-id="19b37-222">Essa declaração é passada para o Azure AD.</span><span class="sxs-lookup"><span data-stu-id="19b37-222">This claim is passed on to Azure AD.</span></span> <span data-ttu-id="19b37-223">Siga este procedimento para percorrer as etapas:</span><span class="sxs-lookup"><span data-stu-id="19b37-223">Follow this procedure to walk through the steps:</span></span>

1. <span data-ttu-id="19b37-224">Abra o gerenciamento do AD FS.</span><span class="sxs-lookup"><span data-stu-id="19b37-224">Open AD FS Management.</span></span>
2. <span data-ttu-id="19b37-225">À esquerda, selecione **Relações de Confiança com Terceira Parte Confiável**.</span><span class="sxs-lookup"><span data-stu-id="19b37-225">On the left, select **Relying Party Trusts**.</span></span>
3. <span data-ttu-id="19b37-226">Clique com o botão direito do mouse na **Plataforma de Identidade do Microsoft Office 365** e selecione **Editar Regras de Declaração...**</span><span class="sxs-lookup"><span data-stu-id="19b37-226">Right-click on **Microsoft Office 365 Identity Platform** and select **Edit Claim Rules…**</span></span>

   ![Nuvem](./media/multi-factor-authentication-get-started-adfs-cloud/trustedip1.png)

4. <span data-ttu-id="19b37-228">Em Regras de Transformação de Emissão, clique em **Adicionar Regra.**</span><span class="sxs-lookup"><span data-stu-id="19b37-228">On Issuance Transform Rules, click **Add Rule.**</span></span>

   ![Nuvem](./media/multi-factor-authentication-get-started-adfs-cloud/trustedip2.png)

5. <span data-ttu-id="19b37-230">No Assistente Adicionar Regra de Declaração de Transformação, selecione **Passar ou filtrar uma Declaração de Entrada** na lista e clique em **Avançar**.</span><span class="sxs-lookup"><span data-stu-id="19b37-230">On the Add Transform Claim Rule Wizard, select **Pass Through or Filter an Incoming Claim** from the drop-down and click **Next**.</span></span>

   ![Nuvem](./media/multi-factor-authentication-get-started-adfs-cloud/trustedip3.png)

6. <span data-ttu-id="19b37-232">Dê um nome para a regra.</span><span class="sxs-lookup"><span data-stu-id="19b37-232">Give your rule a name.</span></span>
7. <span data-ttu-id="19b37-233">Selecione **Referências de Métodos de Autenticação** como o tipo de declaração Entrada.</span><span class="sxs-lookup"><span data-stu-id="19b37-233">Select **Authentication Methods References** as the Incoming claim type.</span></span>
8. <span data-ttu-id="19b37-234">Selecione **Passar todos os valores de declaração**.</span><span class="sxs-lookup"><span data-stu-id="19b37-234">Select **Pass through all claim values**.</span></span>
    <span data-ttu-id="19b37-235">![Assistente para Adicionar Regra de Declaração de Transformação](./media/multi-factor-authentication-get-started-adfs-cloud/configurewizard.png)</span><span class="sxs-lookup"><span data-stu-id="19b37-235">![Add Transform Claim Rule Wizard](./media/multi-factor-authentication-get-started-adfs-cloud/configurewizard.png)</span></span>
9. <span data-ttu-id="19b37-236">Clique em **Concluir**.</span><span class="sxs-lookup"><span data-stu-id="19b37-236">Click **Finish**.</span></span> <span data-ttu-id="19b37-237">Feche o Console de gerenciamento do AD FS.</span><span class="sxs-lookup"><span data-stu-id="19b37-237">Close the AD FS Management console.</span></span>

## <a name="related-topics"></a><span data-ttu-id="19b37-238">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="19b37-238">Related topics</span></span>
<span data-ttu-id="19b37-239">Para obter ajuda com a solução de problemas, confira [Perguntas frequentes da Autenticação Multifator do Azure](multi-factor-authentication-faq.md)</span><span class="sxs-lookup"><span data-stu-id="19b37-239">For troubleshooting help, see the [Azure Multi-Factor Authentication FAQs](multi-factor-authentication-faq.md)</span></span>
