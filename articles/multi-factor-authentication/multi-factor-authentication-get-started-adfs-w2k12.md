---
title: aaaMFA servidor com o AD FS no Windows Server | Microsoft Docs
description: "Este artigo descreve como tooget iniciada com autenticação multifator do Azure e o AD FS no Windows Server 2012 R2 e 2016."
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
editor: yossib
ms.assetid: 57208068-1e55-45b6-840f-fdcd13723074
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 03/29/2017
ms.author: kgremban
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 656785abcc63a020add765a86670b488a3b84b51
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="configure-azure-multi-factor-authentication-server-toowork-with-ad-fs-in-windows-server"></a><span data-ttu-id="c8b8a-103">Configurar o servidor Azure multi-Factor Authentication toowork com o AD FS no Windows Server</span><span class="sxs-lookup"><span data-stu-id="c8b8a-103">Configure Azure Multi-Factor Authentication Server toowork with AD FS in Windows Server</span></span>
<span data-ttu-id="c8b8a-104">Se você usa os serviços de Federação do Active Directory (AD FS) e deseja que recursos de nuvem ou local toosecure, você pode configurar o servidor Azure multi-Factor Authentication toowork com o AD FS.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-104">If you use Active Directory Federation Services (AD FS) and want toosecure cloud or on-premises resources, you can configure Azure Multi-Factor Authentication Server toowork with AD FS.</span></span> <span data-ttu-id="c8b8a-105">Essa configuração dispara a verificação em duas etapas para pontos de extremidade de alto valor.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-105">This configuration triggers two-step verification for high-value endpoints.</span></span>

<span data-ttu-id="c8b8a-106">Neste artigo, discutimos o uso do Servidor de Autenticação Multifator do Azure com o AD FS no Windows Server 2012 R2 ou no Windows Server 2016.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-106">In this article, we discuss using Azure Multi-Factor Authentication Server with AD FS in Windows Server 2012 R2 or Windows Server 2016.</span></span> <span data-ttu-id="c8b8a-107">Para obter mais informações, leia sobre como muito[proteger recursos locais e de nuvem usando o servidor Azure multi-Factor Authentication com o AD FS 2.0](multi-factor-authentication-get-started-adfs-adfs2.md).</span><span class="sxs-lookup"><span data-stu-id="c8b8a-107">For more information, read about how too[secure cloud and on-premises resources by using Azure Multi-Factor Authentication Server with AD FS 2.0](multi-factor-authentication-get-started-adfs-adfs2.md).</span></span>

## <a name="secure-windows-server-ad-fs-with-azure-multi-factor-authentication-server"></a><span data-ttu-id="c8b8a-108">Proteger o AD FS do Windows Server com o Servidor de Autenticação Multifator do Azure</span><span class="sxs-lookup"><span data-stu-id="c8b8a-108">Secure Windows Server AD FS with Azure Multi-Factor Authentication Server</span></span>
<span data-ttu-id="c8b8a-109">Quando você instala o servidor Azure multi-Factor Authentication, você tem Olá as opções a seguir:</span><span class="sxs-lookup"><span data-stu-id="c8b8a-109">When you install Azure Multi-Factor Authentication Server, you have hello following options:</span></span>

* <span data-ttu-id="c8b8a-110">Instalar o servidor Azure multi-Factor Authentication localmente no hello mesmo servidor do AD FS</span><span class="sxs-lookup"><span data-stu-id="c8b8a-110">Install Azure Multi-Factor Authentication Server locally on hello same server as AD FS</span></span>
* <span data-ttu-id="c8b8a-111">Instalar adaptador do Azure multi-Factor Authentication Olá localmente em saudação do servidor AD FS e, em seguida, instale o servidor multi-Factor Authentication em um computador diferente</span><span class="sxs-lookup"><span data-stu-id="c8b8a-111">Install hello Azure Multi-Factor Authentication adapter locally on hello AD FS server, and then install Multi-Factor Authentication Server on a different computer</span></span>

<span data-ttu-id="c8b8a-112">Antes de começar, lembre-se de saudação informações a seguir:</span><span class="sxs-lookup"><span data-stu-id="c8b8a-112">Before you begin, be aware of hello following information:</span></span>

* <span data-ttu-id="c8b8a-113">Você não é necessário tooinstall servidor Azure multi-Factor Authentication no seu servidor do AD FS.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-113">You are not required tooinstall Azure Multi-Factor Authentication Server on your AD FS server.</span></span> <span data-ttu-id="c8b8a-114">No entanto, você deve instalar o adaptador do multi-Factor Authentication de saudação do AD FS em um Windows Server 2012 R2 ou Windows Server 2016 que esteja executando o AD FS.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-114">However, you must install hello Multi-Factor Authentication adapter for AD FS on a Windows Server 2012 R2 or Windows Server 2016 that is running AD FS.</span></span> <span data-ttu-id="c8b8a-115">Você pode instalar o servidor de saudação em um computador diferente se é uma versão com suporte e instalar Olá adaptador do AD FS separadamente no servidor de Federação do AD FS.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-115">You can install hello server on a different computer if it is a supported version and you install hello AD FS adapter separately on your AD FS federation server.</span></span> <span data-ttu-id="c8b8a-116">Consulte Olá toolearn procedimentos a seguir como tooinstall Olá adaptador separadamente.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-116">See hello following procedures toolearn how tooinstall hello adapter separately.</span></span>
* <span data-ttu-id="c8b8a-117">Se sua organização estiver usando métodos de verificação de aplicativo móvel ou mensagem de texto, cadeias de caracteres de saudação definidas nas configurações da empresa contém um espaço reservado, <$*application_name*$>.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-117">If your organization is using text message or mobile app verification methods, hello strings defined in Company Settings contain a placeholder, <$*application_name*$>.</span></span> <span data-ttu-id="c8b8a-118">No Servidor de MFA v7.1, você pode fornecer um nome de aplicativo que substitui esse espaço reservado.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-118">In MFA Server v7.1, you can provide an application name that replaces this placeholder.</span></span> <span data-ttu-id="c8b8a-119">Na versão 7.0 ou anterior, esse espaço reservado não será substituído automaticamente quando você usar o adaptador do hello AD FS.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-119">In v7.0 or older, this placeholder is not automatically replaced when you use hello AD FS adapter.</span></span> <span data-ttu-id="c8b8a-120">Para as versões mais antigas, remova espaço reservado de saudação cadeias de caracteres apropriadas hello quando você proteger o AD FS.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-120">For those older versions, remove hello placeholder from hello appropriate strings when you secure AD FS.</span></span>
* <span data-ttu-id="c8b8a-121">conta de saudação que usam toosign no deve ter grupos de segurança de toocreate de direitos de usuário no serviço do Active Directory.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-121">hello account that you use toosign in must have user rights toocreate security groups in your Active Directory service.</span></span>
* <span data-ttu-id="c8b8a-122">Assistente de instalação do adaptador de saudação do multi-Factor Authentication AD FS cria um grupo de segurança denominado PhoneFactor Admins na sua instância do Active Directory.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-122">hello Multi-Factor Authentication AD FS adapter installation wizard creates a security group called PhoneFactor Admins in your instance of Active Directory.</span></span> <span data-ttu-id="c8b8a-123">Ele, em seguida, adiciona a conta de serviço de saudação do AD FS do seu grupo de toothis do serviço de Federação.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-123">It then adds hello AD FS service account of your federation service toothis group.</span></span> <span data-ttu-id="c8b8a-124">Verifique no controlador de domínio que hello grupo PhoneFactor Admins realmente foi criado e a conta de serviço do hello AD FS é um membro desse grupo.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-124">Verify on your domain controller that hello PhoneFactor Admins group is indeed created and that hello AD FS service account is a member of this group.</span></span> <span data-ttu-id="c8b8a-125">Se necessário, adicione manualmente toohello de conta de serviço de saudação do AD FS grupo PhoneFactor Admins no controlador de domínio.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-125">If necessary, manually add hello AD FS service account toohello PhoneFactor Admins group on your domain controller.</span></span>
* <span data-ttu-id="c8b8a-126">Para obter informações sobre como instalar Olá SDK do serviço Web com o portal do usuário hello, leia sobre [Implantando o portal do usuário Olá para o servidor Azure multi-Factor Authentication.](multi-factor-authentication-get-started-portal.md)</span><span class="sxs-lookup"><span data-stu-id="c8b8a-126">For information about installing hello Web Service SDK with hello user portal, read about [deploying hello user portal for Azure Multi-Factor Authentication Server.](multi-factor-authentication-get-started-portal.md)</span></span>

### <a name="install-azure-multi-factor-authentication-server-locally-on-hello-ad-fs-server"></a><span data-ttu-id="c8b8a-127">Instalar o servidor Azure multi-Factor Authentication localmente no servidor de saudação do AD FS</span><span class="sxs-lookup"><span data-stu-id="c8b8a-127">Install Azure Multi-Factor Authentication Server locally on hello AD FS server</span></span>
1. <span data-ttu-id="c8b8a-128">Baixe e instale o Servidor de Autenticação Multifator do Microsoft Azure no servidor do AD FS.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-128">Download and install Azure Multi-Factor Authentication Server on your AD FS server.</span></span> <span data-ttu-id="c8b8a-129">Para obter informações sobre instalação, leia sobre a [introdução ao Servidor Azure Multi-Factor Authentication](multi-factor-authentication-get-started-server.md).</span><span class="sxs-lookup"><span data-stu-id="c8b8a-129">For installation information, read about [getting started with Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server.md).</span></span>
2. <span data-ttu-id="c8b8a-130">No console de gerenciamento do servidor Azure multi-Factor Authentication hello, clique em Olá **do AD FS** ícone.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-130">In hello Azure Multi-Factor Authentication Server management console, click hello **AD FS** icon.</span></span> <span data-ttu-id="c8b8a-131">Selecione as opções de saudação **permitir a inscrição de usuário** e **permitir que os usuários tooselect método**.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-131">Select hello options **Allow user enrollment** and **Allow users tooselect method**.</span></span>
3. <span data-ttu-id="c8b8a-132">Selecione as opções adicionais que você gostaria que toospecify para sua organização.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-132">Select any additional options you'd like toospecify for your organization.</span></span>
4. <span data-ttu-id="c8b8a-133">Clique em **Instalar Adaptador do AD FS**.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-133">Click **Install AD FS Adapter**.</span></span>
   
   <span data-ttu-id="c8b8a-134"><center>![Nuvem](./media/multi-factor-authentication-get-started-adfs-w2k12/server.png)</center></span><span class="sxs-lookup"><span data-stu-id="c8b8a-134"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/server.png)</center></span></span>

5. <span data-ttu-id="c8b8a-135">Se a janela do Active Directory Olá for exibida, isso significa que duas coisas.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-135">If hello Active Directory window is displayed, that means two things.</span></span> <span data-ttu-id="c8b8a-136">O computador é tooa ingressado no domínio e configuração do Active Directory Olá para proteger a comunicação entre o adaptador do hello AD FS e o serviço de autenticação multifator hello está incompleta.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-136">Your computer is joined tooa domain, and hello Active Directory configuration for securing communication between hello AD FS adapter and hello Multi-Factor Authentication service is incomplete.</span></span> <span data-ttu-id="c8b8a-137">Clique em **próximo** tooautomatically concluir esta configuração, ou selecione Olá **ignorar configuração automática do Active Directory e definir as configurações manualmente** caixa de seleção.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-137">Click **Next** tooautomatically complete this configuration, or select hello **Skip automatic Active Directory configuration and configure settings manually** check box.</span></span> <span data-ttu-id="c8b8a-138">Clique em **Avançar**.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-138">Click **Next**.</span></span>
6. <span data-ttu-id="c8b8a-139">Janelas do grupo Local de saudação for exibido, significa que duas coisas.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-139">If hello Local Group windows is displayed, that means two things.</span></span> <span data-ttu-id="c8b8a-140">Seu computador não é tooa ingressado no domínio e configuração de grupo local Olá para proteger a comunicação entre o adaptador do hello AD FS e o serviço de autenticação multifator hello está incompleta.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-140">Your computer is not joined tooa domain, and hello local group configuration for securing communication between hello AD FS adapter and hello Multi-Factor Authentication service is incomplete.</span></span> <span data-ttu-id="c8b8a-141">Clique em **próximo** tooautomatically concluir esta configuração, ou selecione Olá **ignorar configuração automática do grupo Local e definir as configurações manualmente** caixa de seleção.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-141">Click **Next** tooautomatically complete this configuration, or select hello **Skip automatic Local Group configuration and configure settings manually** check box.</span></span> <span data-ttu-id="c8b8a-142">Clique em **Avançar**.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-142">Click **Next**.</span></span>
7. <span data-ttu-id="c8b8a-143">No Assistente de instalação de saudação, clique em **próximo**.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-143">In hello installation wizard, click **Next**.</span></span> <span data-ttu-id="c8b8a-144">Servidor de autenticação multifator do Azure cria Olá grupo PhoneFactor Admins e adiciona toohello de conta de serviço de saudação do AD FS grupo PhoneFactor Admins.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-144">Azure Multi-Factor Authentication Server creates hello PhoneFactor Admins group and adds hello AD FS service account toohello PhoneFactor Admins group.</span></span>
   <span data-ttu-id="c8b8a-145"><center>![Nuvem](./media/multi-factor-authentication-get-started-adfs-w2k12/adapter.png)</center></span><span class="sxs-lookup"><span data-stu-id="c8b8a-145"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/adapter.png)</center></span></span>
8. <span data-ttu-id="c8b8a-146">Em Olá **iniciar instalador** , clique em **próximo**.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-146">On hello **Launch Installer** page, click **Next**.</span></span>
9. <span data-ttu-id="c8b8a-147">No instalador do adaptador Olá multi-Factor Authentication AD FS, clique em **próximo**.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-147">In hello Multi-Factor Authentication AD FS adapter installer, click **Next**.</span></span>
10. <span data-ttu-id="c8b8a-148">Clique em **fechar** quando a instalação de saudação for concluída.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-148">Click **Close** when hello installation is finished.</span></span>
11. <span data-ttu-id="c8b8a-149">Quando adaptador Olá tiver sido instalado, você deve registrá-lo com o AD FS.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-149">When hello adapter has been installed, you must register it with AD FS.</span></span> <span data-ttu-id="c8b8a-150">Abra o Windows PowerShell e execute Olá comando a seguir:</span><span class="sxs-lookup"><span data-stu-id="c8b8a-150">Open Windows PowerShell and run hello following command:</span></span><br><span data-ttu-id="c8b8a-151">
    `C:\Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1`
    <center>![Nuvem](./media/multi-factor-authentication-get-started-adfs-w2k12/pshell.png)</center></span><span class="sxs-lookup"><span data-stu-id="c8b8a-151">
`C:\Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1`
<center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/pshell.png)</center></span></span>
12. <span data-ttu-id="c8b8a-152">toouse seu adaptador registrado recentemente, Editar política de autenticação global de saudação do AD FS.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-152">toouse your newly registered adapter, edit hello global authentication policy in AD FS.</span></span> <span data-ttu-id="c8b8a-153">No console de gerenciamento do hello AD FS, acesse toohello **políticas de autenticação** nó.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-153">In hello AD FS management console, go toohello **Authentication Policies** node.</span></span> <span data-ttu-id="c8b8a-154">Em Olá **multi-factor Authentication** seção, clique em Olá **editar** link próximo toohello **configurações globais** seção.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-154">In hello **Multi-factor Authentication** section, click hello **Edit** link next toohello **Global Settings** section.</span></span> <span data-ttu-id="c8b8a-155">Em Olá **Editar política de autenticação Global** janela, selecione **multi-Factor Authentication** como um método de autenticação adicional e clique **Okey**.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-155">In hello **Edit Global Authentication Policy** window, select **Multi-Factor Authentication** as an additional authentication method, and then click **OK**.</span></span> <span data-ttu-id="c8b8a-156">Olá adaptador é registrado como WindowsAzureMultiFactorAuthentication.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-156">hello adapter is registered as WindowsAzureMultiFactorAuthentication.</span></span> <span data-ttu-id="c8b8a-157">Reinicie serviço do hello AD FS para efeito de tootake de registro de saudação.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-157">Restart hello AD FS service for hello registration tootake effect.</span></span>

<span data-ttu-id="c8b8a-158"><center>![Nuvem](./media/multi-factor-authentication-get-started-adfs-w2k12/global.png)</center></span><span class="sxs-lookup"><span data-stu-id="c8b8a-158"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/global.png)</center></span></span>

<span data-ttu-id="c8b8a-159">Neste ponto, o servidor de autenticação multifator é configurado toobe um toouse de provedor de autenticação adicional com o AD FS.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-159">At this point, Multi-Factor Authentication Server is set up toobe an additional authentication provider toouse with AD FS.</span></span>

## <a name="install-a-standalone-instance-of-hello-ad-fs-adapter-by-using-hello-web-service-sdk"></a><span data-ttu-id="c8b8a-160">Instalar uma instância autônoma do adaptador de saudação do AD FS usando o SDK do serviço Web de saudação</span><span class="sxs-lookup"><span data-stu-id="c8b8a-160">Install a standalone instance of hello AD FS adapter by using hello Web Service SDK</span></span>
1. <span data-ttu-id="c8b8a-161">Instale Olá SDK do serviço Web no servidor de saudação que está executando o servidor multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-161">Install hello Web Service SDK on hello server that is running Multi-Factor Authentication Server.</span></span>
2. <span data-ttu-id="c8b8a-162">A seguir Olá copiar arquivos de Olá \Program Files\Multi-servidor Factor Authentication diretório toohello em que planeje adaptador do tooinstall Olá AD FS:</span><span class="sxs-lookup"><span data-stu-id="c8b8a-162">Copy hello following files from hello \Program Files\Multi-Factor Authentication Server directory toohello server on which you plan tooinstall hello AD FS adapter:</span></span>
   * <span data-ttu-id="c8b8a-163">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span><span class="sxs-lookup"><span data-stu-id="c8b8a-163">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span></span>
   * <span data-ttu-id="c8b8a-164">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="c8b8a-164">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
   * <span data-ttu-id="c8b8a-165">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="c8b8a-165">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
   * <span data-ttu-id="c8b8a-166">MultiFactorAuthenticationAdfsAdapter.config</span><span class="sxs-lookup"><span data-stu-id="c8b8a-166">MultiFactorAuthenticationAdfsAdapter.config</span></span>
3. <span data-ttu-id="c8b8a-167">Execute o arquivo de instalação do hello MultiFactorAuthenticationAdfsAdapterSetup64.msi.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-167">Run hello MultiFactorAuthenticationAdfsAdapterSetup64.msi installation file.</span></span>
4. <span data-ttu-id="c8b8a-168">No instalador do adaptador Olá multi-Factor Authentication AD FS, clique em **próximo** toostart instalação de saudação.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-168">In hello Multi-Factor Authentication AD FS adapter installer, click **Next** toostart hello installation.</span></span>
5. <span data-ttu-id="c8b8a-169">Clique em **fechar** quando a instalação de saudação for concluída.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-169">Click **Close** when hello installation is finished.</span></span>

## <a name="edit-hello-multifactorauthenticationadfsadapterconfig-file"></a><span data-ttu-id="c8b8a-170">Editar o arquivo multifactorauthenticationadfsadapter. config de saudação</span><span class="sxs-lookup"><span data-stu-id="c8b8a-170">Edit hello MultiFactorAuthenticationAdfsAdapter.config file</span></span>
<span data-ttu-id="c8b8a-171">Execute o arquivo de Multifactorauthenticationadfsadapter essas etapas tooedit hello:</span><span class="sxs-lookup"><span data-stu-id="c8b8a-171">Follow these steps tooedit hello MultiFactorAuthenticationAdfsAdapter.config file:</span></span>

1. <span data-ttu-id="c8b8a-172">Saudação de conjunto **UseWebServiceSdk** nó muito**true**.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-172">Set hello **UseWebServiceSdk** node too**true**.</span></span>  
2. <span data-ttu-id="c8b8a-173">Definir valor Olá **WebServiceSdkUrl** toohello URL de saudação SDK do serviço de Web do multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-173">Set hello value for **WebServiceSdkUrl** toohello URL of hello Multi-Factor Authentication Web Service SDK.</span></span> <span data-ttu-id="c8b8a-174">Por exemplo: *https://contoso.com/&lt;certificatename&gt;/MultiFactorAuthWebServiceSdk/PfWsSdk.asmx*, onde *certificatename* é o nome de saudação do seu certificado.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-174">For example:  *https://contoso.com/&lt;certificatename&gt;/MultiFactorAuthWebServiceSdk/PfWsSdk.asmx*, Where *certificatename* is hello name of your certificate.</span></span>  
3. <span data-ttu-id="c8b8a-175">Edite o script hello Register-multifactorauthenticationadfsadapter.ps1 adicionando *- ConfigurationFilePath &lt;caminho&gt;*  toohello final de saudação `Register-AdfsAuthenticationProvider` comando, onde  *&lt;caminho&gt;*  é o arquivo multifactorauthenticationadfsadapter. config do hello caminho completo toohello.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-175">Edit hello Register-MultiFactorAuthenticationAdfsAdapter.ps1 script by adding *-ConfigurationFilePath &lt;path&gt;* toohello end of hello `Register-AdfsAuthenticationProvider` command, where *&lt;path&gt;* is hello full path toohello MultiFactorAuthenticationAdfsAdapter.config file.</span></span>

### <a name="configure-hello-web-service-sdk-with-a-username-and-password"></a><span data-ttu-id="c8b8a-176">Configurar Olá SDK do serviço Web com um nome de usuário e senha</span><span class="sxs-lookup"><span data-stu-id="c8b8a-176">Configure hello Web Service SDK with a username and password</span></span>
<span data-ttu-id="c8b8a-177">Há duas opções para configurar Olá SDK do serviço Web.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-177">There are two options for configuring hello Web Service SDK.</span></span> <span data-ttu-id="c8b8a-178">Olá é primeiro com um nome de usuário e senha, Olá segundo com um certificado de cliente.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-178">hello first is with a username and password, hello second is with a client certificate.</span></span> <span data-ttu-id="c8b8a-179">Siga estas etapas para a opção primeira hello ou pular para Olá segundo.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-179">Follow these steps for hello first option, or skip ahead for hello second.</span></span>  

1. <span data-ttu-id="c8b8a-180">Definir valor Olá **WebServiceSdkUsername** tooan conta que seja membro de grupo de segurança PhoneFactor Admins de hello.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-180">Set hello value for **WebServiceSdkUsername** tooan account that is a member of hello PhoneFactor Admins security group.</span></span> <span data-ttu-id="c8b8a-181">Saudação de uso &lt;domínio&gt;&#92;&lt; nome de usuário&gt; formato.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-181">Use hello &lt;domain&gt;&#92;&lt;user name&gt; format.</span></span>  
2. <span data-ttu-id="c8b8a-182">Definir valor Olá **WebServiceSdkPassword** toohello senha de conta apropriada.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-182">Set hello value for **WebServiceSdkPassword** toohello appropriate account password.</span></span>

### <a name="configure-hello-web-service-sdk-with-a-client-certificate"></a><span data-ttu-id="c8b8a-183">Configurar Olá SDK do serviço Web com um certificado de cliente</span><span class="sxs-lookup"><span data-stu-id="c8b8a-183">Configure hello Web Service SDK with a client certificate</span></span>
<span data-ttu-id="c8b8a-184">Se você não quiser toouse um nome de usuário e senha, siga a saudação de tooconfigure essas etapas SDK do serviço Web com um certificado de cliente.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-184">If you don't want toouse a username and password, follow these steps tooconfigure hello Web Service SDK with a client certificate.</span></span>

1. <span data-ttu-id="c8b8a-185">Obter um certificado de cliente de uma autoridade de certificação para o servidor de saudação que está executando o hello SDK do serviço Web.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-185">Obtain a client certificate from a certificate authority for hello server that is running hello Web Service SDK.</span></span> <span data-ttu-id="c8b8a-186">Saiba como muito[obter certificados de cliente](https://technet.microsoft.com/library/cc770328.aspx).</span><span class="sxs-lookup"><span data-stu-id="c8b8a-186">Learn how too[obtain client certificates](https://technet.microsoft.com/library/cc770328.aspx).</span></span>  
2. <span data-ttu-id="c8b8a-187">Importação Olá cliente certificado toohello local repositório de certificados pessoal no servidor de saudação que está executando o hello SDK do serviço Web.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-187">Import hello client certificate toohello local computer personal certificate store on hello server that is running hello Web Service SDK.</span></span> <span data-ttu-id="c8b8a-188">Verifique se o que certificado público da autoridade de certificação que hello está no repositório de certificados de certificados de raiz confiável.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-188">Make sure that hello certificate authority's public certificate is in Trusted Root Certificates certificate store.</span></span>  
3. <span data-ttu-id="c8b8a-189">Exporte chaves públicas e privadas de Olá Olá cliente tooa. pfx do arquivo de certificado.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-189">Export hello public and private keys of hello client certificate tooa .pfx file.</span></span>  
4. <span data-ttu-id="c8b8a-190">Exporte a chave pública Olá no arquivo. cer do Base64 formato tooa.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-190">Export hello public key in Base64 format tooa .cer file.</span></span>  
5. <span data-ttu-id="c8b8a-191">No Gerenciador do servidor, verifique se que esse recurso de autenticação de mapeamento de certificado de cliente \Web Server\Security\IIS Olá servidor Web (IIS) está instalado.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-191">In Server Manager, verify that hello Web Server (IIS)\Web Server\Security\IIS Client Certificate Mapping Authentication feature is installed.</span></span> <span data-ttu-id="c8b8a-192">Se não estiver instalado, selecione **adicionar funções e recursos** tooadd esse recurso.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-192">If it is not installed, select **Add Roles and Features** tooadd this feature.</span></span>  
6. <span data-ttu-id="c8b8a-193">No Gerenciador do IIS, clique duas vezes em **Editor de configuração** no site de saudação que contém o diretório virtual do SDK do serviço Web hello.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-193">In IIS Manager, double-click **Configuration Editor** in hello website that contains hello Web Service SDK virtual directory.</span></span> <span data-ttu-id="c8b8a-194">É importante tooselect Olá site, diretório virtual não hello.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-194">It is important tooselect hello website, not hello virtual directory.</span></span>  
7. <span data-ttu-id="c8b8a-195">Vá toohello **system.webServer/security/authentication/iisClientCertificateMappingAuthentication** seção.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-195">Go toohello **system.webServer/security/authentication/iisClientCertificateMappingAuthentication** section.</span></span>  
8. <span data-ttu-id="c8b8a-196">Defina enabled muito**true**.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-196">Set enabled too**true**.</span></span>  
9. <span data-ttu-id="c8b8a-197">Defina oneToOneCertificateMappingsEnabled muito**true**.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-197">Set oneToOneCertificateMappingsEnabled too**true**.</span></span>  
10. <span data-ttu-id="c8b8a-198">Clique em Olá **...**  botão Avançar toooneToOneMappings e clique em Olá **adicionar** link.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-198">Click hello **...** button next toooneToOneMappings, and then click hello **Add** link.</span></span>  
11. <span data-ttu-id="c8b8a-199">Abra o arquivo. cer de Base64 Olá exportado anteriormente.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-199">Open hello Base64 .cer file you exported earlier.</span></span> <span data-ttu-id="c8b8a-200">Remova *-----BEGIN CERTIFICATE-----*, *-----END CERTIFICATE-----* e todas as quebras de linha.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-200">Remove *-----BEGIN CERTIFICATE-----*, *-----END CERTIFICATE-----*, and any line breaks.</span></span> <span data-ttu-id="c8b8a-201">Copie a cadeia de caracteres resultante hello.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-201">Copy hello resulting string.</span></span>  
12. <span data-ttu-id="c8b8a-202">Cadeia de caracteres do conjunto de certificado toohello copiadas Olá anterior da etapa.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-202">Set certificate toohello string copied in hello preceding step.</span></span>  
13. <span data-ttu-id="c8b8a-203">Defina enabled muito**true**.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-203">Set enabled too**true**.</span></span>  
14. <span data-ttu-id="c8b8a-204">Defina userName tooan conta que seja membro de grupo de segurança PhoneFactor Admins de hello.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-204">Set userName tooan account that is a member of hello PhoneFactor Admins security group.</span></span> <span data-ttu-id="c8b8a-205">Saudação de uso &lt;domínio&gt;&#92;&lt; nome de usuário&gt; formato.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-205">Use hello &lt;domain&gt;&#92;&lt;user name&gt; format.</span></span>  
15. <span data-ttu-id="c8b8a-206">Definir senha de conta apropriada Olá senha toohello e, em seguida, feche o Editor de configuração.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-206">Set hello password toohello appropriate account password, and then close Configuration Editor.</span></span>  
16. <span data-ttu-id="c8b8a-207">Clique em Olá **aplicar** link.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-207">Click hello **Apply** link.</span></span>  
17. <span data-ttu-id="c8b8a-208">Diretório virtual do SDK do serviço Web de saudação, clique duas vezes em **autenticação**.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-208">In hello Web Service SDK virtual directory, double-click **Authentication**.</span></span>  
18. <span data-ttu-id="c8b8a-209">Verifique se a autenticação básica e representação do ASP.NET estão definidas muito**habilitado**, e todos os outros itens definidos muito**desabilitado**.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-209">Verify that ASP.NET Impersonation and Basic Authentication are set too**Enabled**, and that all other items are set too**Disabled**.</span></span>  
19. <span data-ttu-id="c8b8a-210">Diretório virtual do SDK do serviço Web de saudação, clique duas vezes em **configurações de SSL**.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-210">In hello Web Service SDK virtual directory, double-click **SSL Settings**.</span></span>  
20. <span data-ttu-id="c8b8a-211">Defina certificados de cliente muito**aceitar**e, em seguida, clique em **aplicar**.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-211">Set Client Certificates too**Accept**, and then click **Apply**.</span></span>  
21. <span data-ttu-id="c8b8a-212">Copie o arquivo do hello. pfx exportado anterior servidor toohello executando Olá adaptador do AD FS.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-212">Copy hello .pfx file you exported earlier toohello server that is running hello AD FS adapter.</span></span>  
22. <span data-ttu-id="c8b8a-213">Importar o repositório de certificados pessoais do hello. pfx arquivo toohello computador local.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-213">Import hello .pfx file toohello local computer personal certificate store.</span></span>  
23. <span data-ttu-id="c8b8a-214">Clique com botão direito e selecione **gerenciar chaves privadas**e, em seguida, conceder acesso de leitura toohello à conta usada toosign no serviço do toohello AD FS.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-214">Right-click and select **Manage Private Keys**, and then grant read access toohello account you used toosign in toohello AD FS service.</span></span>  
24. <span data-ttu-id="c8b8a-215">Abrir Olá cliente certificado e cópia Olá a impressão digital de saudação **detalhes** guia.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-215">Open hello client certificate and copy hello thumbprint from hello **Details** tab.</span></span>  
25. <span data-ttu-id="c8b8a-216">No arquivo multifactorauthenticationadfsadapter. config de hello, defina **WebServiceSdkCertificateThumbprint** toohello de cadeia de caracteres copiada na etapa anterior hello.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-216">In hello MultiFactorAuthenticationAdfsAdapter.config file, set **WebServiceSdkCertificateThumbprint** toohello string copied in hello previous step.</span></span>  

<span data-ttu-id="c8b8a-217">Por fim, tooregister Olá adaptador, execute \Program Files\Multi Olá-script Factor Authentication\register-multifactorauthenticationadfsadapter.ps1 no PowerShell.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-217">Finally, tooregister hello adapter, run hello \Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1 script in PowerShell.</span></span> <span data-ttu-id="c8b8a-218">Olá adaptador é registrado como WindowsAzureMultiFactorAuthentication.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-218">hello adapter is registered as WindowsAzureMultiFactorAuthentication.</span></span> <span data-ttu-id="c8b8a-219">Reinicie serviço do hello AD FS para efeito de tootake de registro de saudação.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-219">Restart hello AD FS service for hello registration tootake effect.</span></span>

## <a name="secure-azure-ad-resources-using-ad-fs"></a><span data-ttu-id="c8b8a-220">Proteger recursos do Azure AD usando o AD FS</span><span class="sxs-lookup"><span data-stu-id="c8b8a-220">Secure Azure AD resources using AD FS</span></span>
<span data-ttu-id="c8b8a-221">toosecure seu recurso de nuvem, configurar uma regra de declarações para que os serviços de Federação do Active Directory emite a declaração de multipleauthn hello quando um usuário executa a verificação em duas etapas com êxito.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-221">toosecure your cloud resource, set up a claims rule so that Active Directory Federation Services emits hello multipleauthn claim when a user performs two-step verification successfully.</span></span> <span data-ttu-id="c8b8a-222">Esta declaração é passada no tooAzure AD.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-222">This claim is passed on tooAzure AD.</span></span> <span data-ttu-id="c8b8a-223">Siga este toowalk procedimento etapas hello:</span><span class="sxs-lookup"><span data-stu-id="c8b8a-223">Follow this procedure toowalk through hello steps:</span></span>

1. <span data-ttu-id="c8b8a-224">Abra o gerenciamento do AD FS.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-224">Open AD FS Management.</span></span>
2. <span data-ttu-id="c8b8a-225">Olá esquerda, selecione **terceira parte confiável**.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-225">On hello left, select **Relying Party Trusts**.</span></span>
3. <span data-ttu-id="c8b8a-226">Clique com o botão direito do mouse na **Plataforma de Identidade do Microsoft Office 365** e selecione **Editar Regras de Declaração...**</span><span class="sxs-lookup"><span data-stu-id="c8b8a-226">Right-click on **Microsoft Office 365 Identity Platform** and select **Edit Claim Rules…**</span></span>

   ![Nuvem](./media/multi-factor-authentication-get-started-adfs-cloud/trustedip1.png)

4. <span data-ttu-id="c8b8a-228">Em Regras de Transformação de Emissão, clique em **Adicionar Regra.**</span><span class="sxs-lookup"><span data-stu-id="c8b8a-228">On Issuance Transform Rules, click **Add Rule.**</span></span>

   ![Nuvem](./media/multi-factor-authentication-get-started-adfs-cloud/trustedip2.png)

5. <span data-ttu-id="c8b8a-230">Em Olá Adicionar Assistente de regra de declaração de transformação, selecione **passar ou filtrar uma declaração de entrada** de Olá suspensa e clique em **próximo**.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-230">On hello Add Transform Claim Rule Wizard, select **Pass Through or Filter an Incoming Claim** from hello drop-down and click **Next**.</span></span>

   ![Nuvem](./media/multi-factor-authentication-get-started-adfs-cloud/trustedip3.png)

6. <span data-ttu-id="c8b8a-232">Dê um nome para a regra.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-232">Give your rule a name.</span></span>
7. <span data-ttu-id="c8b8a-233">Selecione **referências de métodos de autenticação** como Olá entrada o tipo de declaração.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-233">Select **Authentication Methods References** as hello Incoming claim type.</span></span>
8. <span data-ttu-id="c8b8a-234">Selecione **Passar todos os valores de declaração**.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-234">Select **Pass through all claim values**.</span></span>
    <span data-ttu-id="c8b8a-235">![Assistente para Adicionar Regra de Declaração de Transformação](./media/multi-factor-authentication-get-started-adfs-cloud/configurewizard.png)</span><span class="sxs-lookup"><span data-stu-id="c8b8a-235">![Add Transform Claim Rule Wizard](./media/multi-factor-authentication-get-started-adfs-cloud/configurewizard.png)</span></span>
9. <span data-ttu-id="c8b8a-236">Clique em **Concluir**.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-236">Click **Finish**.</span></span> <span data-ttu-id="c8b8a-237">Feche o console de gerenciamento FS Olá AD.</span><span class="sxs-lookup"><span data-stu-id="c8b8a-237">Close hello AD FS Management console.</span></span>

## <a name="related-topics"></a><span data-ttu-id="c8b8a-238">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="c8b8a-238">Related topics</span></span>
<span data-ttu-id="c8b8a-239">Para obter ajuda de solução de problemas, consulte Olá [perguntas frequentes sobre o Azure multi-Factor Authentication](multi-factor-authentication-faq.md)</span><span class="sxs-lookup"><span data-stu-id="c8b8a-239">For troubleshooting help, see hello [Azure Multi-Factor Authentication FAQs](multi-factor-authentication-faq.md)</span></span>
