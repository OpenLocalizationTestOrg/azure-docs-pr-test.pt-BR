---
title: "a autenticação principal aaaService para aplicativos de API no serviço de aplicativo do Azure | Microsoft Docs"
description: "Saiba como aplicativo tooprotect uma API no serviço de aplicativo do Azure para cenários de serviços."
services: app-service\api
documentationcenter: .net
author: alexkarcher-msft
manager: erikre
editor: 
ms.assetid: 7ca0bab2-1d29-4d51-b779-dce0edd34f8b
ms.service: app-service-api
ms.workload: na
ms.tgt_pltfrm: dotnet
ms.devlang: na
ms.topic: article
ms.date: 06/30/2016
ms.author: alkarche
ms.openlocfilehash: 94d9ee11f38293df4a2fd815ef02c59cc6defed4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="service-principal-authentication-for-api-apps-in-azure-app-service"></a><span data-ttu-id="ced6b-103">Autenticação de entidade de serviço para Aplicativos de API no Serviço de Aplicativo do Azure</span><span class="sxs-lookup"><span data-stu-id="ced6b-103">Service principal authentication for API Apps in Azure App Service</span></span>
## <a name="overview"></a><span data-ttu-id="ced6b-104">Visão geral</span><span class="sxs-lookup"><span data-stu-id="ced6b-104">Overview</span></span>
<span data-ttu-id="ced6b-105">Este artigo explica como autenticação de serviço de aplicativo toouse para *interno* acessar aplicativos tooAPI.</span><span class="sxs-lookup"><span data-stu-id="ced6b-105">This article explains how toouse App Service authentication for *internal* access tooAPI apps.</span></span> <span data-ttu-id="ced6b-106">Um cenário interno é onde você tem um aplicativo de API que você deseja toobe consumível somente por seu próprio código de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ced6b-106">An internal scenario is where you have an API app that you want toobe consumable only by your own application code.</span></span> <span data-ttu-id="ced6b-107">Olá recomendado tooimplement de maneira esse cenário no serviço de aplicativo é toouse AD do Azure tooprotect Olá chamado aplicativo de API.</span><span class="sxs-lookup"><span data-stu-id="ced6b-107">hello recommended way tooimplement this scenario in App Service is toouse Azure AD tooprotect hello called API app.</span></span> <span data-ttu-id="ced6b-108">Chamar o aplicativo de API Olá protegido com um token de portador que você obtém do AD do Azure, fornecendo credenciais (entidade de serviço) a identidade do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ced6b-108">You call hello protected API app with a bearer token that you get from Azure AD by providing application identity (service principal) credentials.</span></span> <span data-ttu-id="ced6b-109">Para alternativas toousing AD do Azure, consulte Olá **autenticação de serviço a serviço** seção Olá [visão geral da autenticação do serviço de aplicativo do Azure](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span><span class="sxs-lookup"><span data-stu-id="ced6b-109">For alternatives toousing Azure AD, see hello **Service-to-service authentication** section of hello [Azure App Service authentication overview](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span></span>

<span data-ttu-id="ced6b-110">Neste artigo, você aprenderá o seguinte:</span><span class="sxs-lookup"><span data-stu-id="ced6b-110">In this article, you'll learn:</span></span>

* <span data-ttu-id="ced6b-111">Como toouse aplicativo de tooprotect uma API do Azure Active Directory (AD do Azure) de acesso não autenticado.</span><span class="sxs-lookup"><span data-stu-id="ced6b-111">How toouse Azure Active Directory (Azure AD) tooprotect an API app from unauthenticated access.</span></span>
* <span data-ttu-id="ced6b-112">Como aplicativo tooconsume uma API protegida de um aplicativo de API, aplicativo web ou aplicativo móvel usando credenciais de entidade de segurança (identidade de aplicativo) de serviço do AD do Azure.</span><span class="sxs-lookup"><span data-stu-id="ced6b-112">How tooconsume a protected API app from an API app, web app, or mobile app by using Azure AD service principal (app identity) credentials.</span></span> <span data-ttu-id="ced6b-113">Para obter informações sobre como tooconsume de um aplicativo de lógica, consulte [usando sua API personalizada hospedado no serviço de aplicativo com aplicativos lógicos](../logic-apps/logic-apps-custom-hosted-api.md).</span><span class="sxs-lookup"><span data-stu-id="ced6b-113">For information about how tooconsume from a logic app, see [Using your custom API hosted on App Service with Logic apps](../logic-apps/logic-apps-custom-hosted-api.md).</span></span>
* <span data-ttu-id="ced6b-114">Como toomake-se de que Olá protegido do aplicativo de API não pode ser chamado em um navegador, usuários conectados.</span><span class="sxs-lookup"><span data-stu-id="ced6b-114">How toomake sure that hello protected API app can't be called from a browser by logged on users.</span></span>
* <span data-ttu-id="ced6b-115">Como toomake-se de que Olá protegido do aplicativo de API só pode ser chamado por uma determinada entidade de serviço do AD do Azure.</span><span class="sxs-lookup"><span data-stu-id="ced6b-115">How toomake sure that hello protected API app can only be called by a specific Azure AD service principal.</span></span>

<span data-ttu-id="ced6b-116">artigo Olá contém duas seções:</span><span class="sxs-lookup"><span data-stu-id="ced6b-116">hello article contains two sections:</span></span>

* <span data-ttu-id="ced6b-117">Olá [como tooconfigure serviço principal autenticação no serviço de aplicativo do Azure](#authconfig) seção explica como geral tooconfigure autenticação para qualquer aplicativo de API e como tooconsume Olá protegido do aplicativo de API.</span><span class="sxs-lookup"><span data-stu-id="ced6b-117">hello [How tooconfigure service principal authentication in Azure App Service](#authconfig) section explains in general how tooconfigure authentication for any API app, and how tooconsume hello protected API app.</span></span> <span data-ttu-id="ced6b-118">Esta seção se aplica igualmente tooall estruturas com suporte pelo serviço de aplicativo, incluindo .NET, Node.js e Java.</span><span class="sxs-lookup"><span data-stu-id="ced6b-118">This section applies equally tooall frameworks supported by App Service, including .NET, Node.js, and Java.</span></span>
* <span data-ttu-id="ced6b-119">Começando com hello [continuar tutoriais de Introdução .NET de saudação](#tutorialstart) seção, Olá tutorial orienta você pela configuração de um cenário de "acesso interno" para um aplicativo de exemplo .NET em execução no serviço de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ced6b-119">Starting with hello [Continuing hello .NET getting-started tutorials](#tutorialstart) section, hello tutorial guides you through configuring an "internal access" scenario for a .NET sample application running in App Service.</span></span> 

## <span data-ttu-id="ced6b-120"><a id="authconfig"></a>Como tooconfigure serviço principal autenticação no serviço de aplicativo do Azure</span><span class="sxs-lookup"><span data-stu-id="ced6b-120"><a id="authconfig"></a> How tooconfigure service principal authentication in Azure App Service</span></span>
<span data-ttu-id="ced6b-121">Esta seção fornece instruções gerais que se aplicam a tooany do aplicativo de API.</span><span class="sxs-lookup"><span data-stu-id="ced6b-121">This section provides general instructions that apply tooany API app.</span></span> <span data-ttu-id="ced6b-122">Para etapas específicas toohello tooDo aplicativo de exemplo .NET de lista, vá muito[continuar a série de tutoriais de aplicativos de API .NET Olá](#tutorialstart).</span><span class="sxs-lookup"><span data-stu-id="ced6b-122">For steps specific toohello tooDo List .NET sample application, go too[Continuing hello .NET API Apps tutorial series](#tutorialstart).</span></span>

1. <span data-ttu-id="ced6b-123">Em Olá [portal do Azure](https://portal.azure.com/), navegar toohello **configurações** folha do aplicativo hello API que você deseja tooprotect e, em seguida, localize Olá **recursos** seção e clique em **Autenticação / autorização**.</span><span class="sxs-lookup"><span data-stu-id="ced6b-123">In hello [Azure portal](https://portal.azure.com/), navigate toohello **Settings** blade of hello API app that you want tooprotect, and then find hello **Features** section and click **Authentication/ Authorization**.</span></span>
   
    ![Autenticação/Autorização no portal do Azure](./media/app-service-api-dotnet-user-principal-auth/features.png)
2. <span data-ttu-id="ced6b-125">Em Olá **autenticação / autorização** folha, clique em **em**.</span><span class="sxs-lookup"><span data-stu-id="ced6b-125">In hello **Authentication / Authorization** blade, click **On**.</span></span>
3. <span data-ttu-id="ced6b-126">Em Olá **tootake de ação quando a solicitação não está autenticada** lista suspensa, selecione **fazer logon com Active Directory do Azure** .</span><span class="sxs-lookup"><span data-stu-id="ced6b-126">In hello **Action tootake when request is not authenticated** drop-down list, select **Log in with Azure Active Directory** .</span></span>
4. <span data-ttu-id="ced6b-127">Em **Provedores de Autenticação**, selecione **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="ced6b-127">Under **Authentication Providers**, select **Azure Active Directory**.</span></span>
   
    ![Folha Autenticação/Autorização no portal do Azure](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
5. <span data-ttu-id="ced6b-129">Configurar Olá **configurações do Active Directory do Azure** toocreate folha Azure um novo aplicativo do AD, ou usar um aplicativo existente do AD do Azure se você já tiver um que você deseja toouse.</span><span class="sxs-lookup"><span data-stu-id="ced6b-129">Configure hello **Azure Active Directory Settings** blade toocreate a new Azure AD application, or use an existing Azure AD application if you already have one that you want toouse.</span></span>
   
    <span data-ttu-id="ced6b-130">Cenários internos normalmente envolvem um aplicativo de API que chama um aplicativo de API.</span><span class="sxs-lookup"><span data-stu-id="ced6b-130">Internal scenarios typically involve an API app calling an API app.</span></span> <span data-ttu-id="ced6b-131">Você pode usar aplicativos do Azure AD separados para cada aplicativo de API ou apenas um aplicativo Azure AD.</span><span class="sxs-lookup"><span data-stu-id="ced6b-131">You can use separate Azure AD applications for each API app or just one Azure AD application.</span></span>
   
    <span data-ttu-id="ced6b-132">Para obter instruções detalhadas sobre esta folha, consulte [como tooconfigure seu logon de Active Directory do Azure do serviço de aplicativo aplicativo toouse](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="ced6b-132">For detailed instructions on this blade, see [How tooconfigure your App Service application toouse Azure Active Directory login](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span></span>
6. <span data-ttu-id="ced6b-133">Quando tiver terminado com folha de configuração do provedor de autenticação de saudação, clique em **Okey**.</span><span class="sxs-lookup"><span data-stu-id="ced6b-133">When you're done with hello authentication provider configuration blade, click **OK**.</span></span>
7. <span data-ttu-id="ced6b-134">Em Olá **autenticação / autorização** folha, clique em **salvar**.</span><span class="sxs-lookup"><span data-stu-id="ced6b-134">In hello **Authentication / Authorization** blade, click **Save**.</span></span>
   
    ![Clique em Salvar](./media/app-service-api-dotnet-service-principal-auth/authsave.png)

<span data-ttu-id="ced6b-136">Quando isso for feito, o serviço de aplicativo só permite solicitações de chamadores em locatário do AD do Azure Olá configurado.</span><span class="sxs-lookup"><span data-stu-id="ced6b-136">When this is done, App Service only allows requests from callers in hello configured Azure AD tenant.</span></span> <span data-ttu-id="ced6b-137">Nenhum código de autorização ou autenticação é necessária no aplicativo de API Olá protegido.</span><span class="sxs-lookup"><span data-stu-id="ced6b-137">No authentication or authorization code is required in hello protected API app.</span></span> <span data-ttu-id="ced6b-138">Olá token de portador é passada toohello API aplicativo junto com as declarações usadas em cabeçalhos HTTP, e você pode ler as informações no código toovalidate que solicitações são de um chamador específico, como uma entidade de serviço.</span><span class="sxs-lookup"><span data-stu-id="ced6b-138">hello bearer token is passed toohello API app along with commonly used claims in HTTP headers, and you can read that information in code toovalidate that requests are from a particular caller, such as a service principal.</span></span>

<span data-ttu-id="ced6b-139">Essa funcionalidade de autenticação funciona Olá mesma maneira para todos os idiomas do serviço de aplicativo que oferece suporte, incluindo .NET, Node.js e Java.</span><span class="sxs-lookup"><span data-stu-id="ced6b-139">This authentication functionality works hello same way for all languages that App service supports, including .NET, Node.js, and Java.</span></span> 

#### <a name="how-tooconsume-hello-protected-api-app"></a><span data-ttu-id="ced6b-140">Como tooconsume Olá protegido do aplicativo de API</span><span class="sxs-lookup"><span data-stu-id="ced6b-140">How tooconsume hello protected API app</span></span>
<span data-ttu-id="ced6b-141">chamador Olá deve fornecer um token de portador do AD do Azure com chamadas de API.</span><span class="sxs-lookup"><span data-stu-id="ced6b-141">hello caller must provide an Azure AD bearer token with API calls.</span></span> <span data-ttu-id="ced6b-142">tooget um token de portador usando credenciais de serviço principal, o chamador de saudação usa a biblioteca de autenticação do Active Directory (ADAL para [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), ou [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span><span class="sxs-lookup"><span data-stu-id="ced6b-142">tooget a bearer token using service principal credentials, hello caller uses Active Directory Authentication Library (ADAL for [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), or [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span></span> <span data-ttu-id="ced6b-143">tooget um token, código de saudação que chama o ADAL fornece Olá tooADAL informações a seguir:</span><span class="sxs-lookup"><span data-stu-id="ced6b-143">tooget a token, hello code that calls ADAL provides tooADAL hello following information:</span></span>

* <span data-ttu-id="ced6b-144">nome de saudação do seu locatário do AD do Azure.</span><span class="sxs-lookup"><span data-stu-id="ced6b-144">hello name of your Azure AD tenant.</span></span>
* <span data-ttu-id="ced6b-145">Olá ID e o cliente segredo do cliente (chave de aplicativo) do aplicativo de saudação do AD do Azure associado chamador hello.</span><span class="sxs-lookup"><span data-stu-id="ced6b-145">hello client ID and client secret (app key) of hello Azure AD app associated with hello caller.</span></span>
* <span data-ttu-id="ced6b-146">Olá ID do cliente de aplicativo do AD do Azure associado à saudação do hello protegido do aplicativo de API.</span><span class="sxs-lookup"><span data-stu-id="ced6b-146">hello client ID of hello Azure AD application associated with hello protected API app.</span></span> <span data-ttu-id="ced6b-147">(Se apenas um aplicativo do AD do Azure for usado, isso é Olá mesma ID de cliente como Olá um chamador hello.)</span><span class="sxs-lookup"><span data-stu-id="ced6b-147">(If just one Azure AD application is used, this is hello same client ID as hello one for hello caller.)</span></span>

<span data-ttu-id="ced6b-148">Esses valores estão disponíveis nas páginas de saudação do AD do Azure do hello [portal clássico do Azure](https://manage.windowsazure.com/).</span><span class="sxs-lookup"><span data-stu-id="ced6b-148">These values are available in hello Azure AD pages of hello [Azure classic portal](https://manage.windowsazure.com/).</span></span>

<span data-ttu-id="ced6b-149">Depois que o token Olá foi adquirido, chamador Olá inclui com solicitações HTTP no cabeçalho de autorização de saudação.</span><span class="sxs-lookup"><span data-stu-id="ced6b-149">Once hello token has been acquired, hello caller includes it with HTTP requests in hello Authorization header.</span></span>  <span data-ttu-id="ced6b-150">Serviço de aplicativo valida o token hello e permite Olá Olá de tooreach solicitações protegido do aplicativo de API.</span><span class="sxs-lookup"><span data-stu-id="ced6b-150">App Service validates hello token and allows hello requests tooreach hello protected API app.</span></span>

#### <a name="how-tooprotect-hello-api-app-from-access-by-users-in-hello-same-tenant"></a><span data-ttu-id="ced6b-151">Como tooprotect Olá API aplicativo contra o acesso por usuários em Olá mesmo locatário</span><span class="sxs-lookup"><span data-stu-id="ced6b-151">How tooprotect hello API app from access by users in hello same tenant</span></span>
<span data-ttu-id="ced6b-152">Os tokens de portador para usuários em Olá mesmo locatário são considerados válidos para Olá protegido do aplicativo de API.</span><span class="sxs-lookup"><span data-stu-id="ced6b-152">Bearer tokens for users in hello same tenant are considered valid for hello protected API app.</span></span>  <span data-ttu-id="ced6b-153">Se você quiser tooensure apenas uma entidade de serviço pode chamar hello protegido do aplicativo de API, adicione o código em Olá protegido saudação de toovalidate de aplicativo de API declarações do token Olá a seguir:</span><span class="sxs-lookup"><span data-stu-id="ced6b-153">If you want tooensure that only a service principal can call hello protected API app, add code in hello protected API app toovalidate hello following claims from hello token:</span></span>

* <span data-ttu-id="ced6b-154">`appid`deve ser o ID de cliente de saudação do aplicativo do AD do Azure Olá que está associado ao chamador hello.</span><span class="sxs-lookup"><span data-stu-id="ced6b-154">`appid` should be hello client ID of hello Azure AD application that is associated with hello caller.</span></span> 
* <span data-ttu-id="ced6b-155">`oid`(`objectidentifier`) deve ser o ID principal do serviço de saudação do chamador hello.</span><span class="sxs-lookup"><span data-stu-id="ced6b-155">`oid` (`objectidentifier`) should be hello service principal ID of hello caller.</span></span> 

<span data-ttu-id="ced6b-156">Serviço de aplicativo também fornece Olá `objectidentifier` declaração no cabeçalho X-MS-CLIENT--ID do PRINCIPAL de saudação.</span><span class="sxs-lookup"><span data-stu-id="ced6b-156">App Service also provides hello `objectidentifier` claim in hello X-MS-CLIENT-PRINCIPAL-ID header.</span></span>

### <a name="how-tooprotect-hello-api-app-from-browser-access"></a><span data-ttu-id="ced6b-157">Como tooprotect Olá aplicativo de API de acesso do navegador</span><span class="sxs-lookup"><span data-stu-id="ced6b-157">How tooprotect hello API app from browser access</span></span>
<span data-ttu-id="ced6b-158">Se você não validar declarações em código no aplicativo de API Olá protegido e se você usar um separado aplicativo AD do Azure para Olá protegido aplicativo de API, certifique-se de que Olá URL de resposta do aplicativo do AD do Azure é não Olá mesmo Olá URL base do aplicativo de API.</span><span class="sxs-lookup"><span data-stu-id="ced6b-158">If you don't validate claims in code in hello protected API app, and if you use a separate Azure AD application for hello protected API app, make sure that hello Azure AD application's Reply URL is not hello same as hello API app's base URL.</span></span> <span data-ttu-id="ced6b-159">Se Olá URL de resposta aponta diretamente do aplicativo de API toohello protegido, um usuário no locatário Olá mesmo Azure AD pode procurar o aplicativo de API toohello, logon e chamar com êxito Olá API.</span><span class="sxs-lookup"><span data-stu-id="ced6b-159">If hello Reply URL points directly toohello protected API app, a user in hello same Azure AD tenant could browse toohello API app, log on, and successfully call hello API.</span></span>

## <span data-ttu-id="ced6b-160"><a id="tutorialstart"></a>Continuando a série de tutoriais Olá aplicativos de API do .NET</span><span class="sxs-lookup"><span data-stu-id="ced6b-160"><a id="tutorialstart"></a> Continuing hello .NET API Apps tutorial series</span></span>
<span data-ttu-id="ced6b-161">Se você estiver seguindo Olá Node. js ou Java série de tutoriais para aplicativos de API, ignorar toohello [próximas etapas](#next-steps) seção.</span><span class="sxs-lookup"><span data-stu-id="ced6b-161">If you are following hello Node.js or Java tutorial series for API apps, skip toohello [Next steps](#next-steps) section.</span></span> 

<span data-ttu-id="ced6b-162">Olá restante deste artigo continua a série de tutoriais Olá aplicativos de API do .NET e pressupõe que você tenha concluído Olá [tutorial de autenticação de usuário](app-service-api-dotnet-user-principal-auth.md) e ter o aplicativo de exemplo hello em execução no Azure com autenticação do usuário habilitado.</span><span class="sxs-lookup"><span data-stu-id="ced6b-162">hello remainder of this article continues hello .NET API Apps tutorial series and assumes that you have completed hello [user authentication tutorial](app-service-api-dotnet-user-principal-auth.md) and have hello sample application running in Azure with user authentication enabled.</span></span>

## <a name="set-up-authentication-in-azure"></a><span data-ttu-id="ced6b-163">Configurar a autenticação no Azure</span><span class="sxs-lookup"><span data-stu-id="ced6b-163">Set up authentication in Azure</span></span>
<span data-ttu-id="ced6b-164">Nesta seção você configurar o serviço de aplicativo para que solicitações de HTTP só permite que o aplicativo de API do tooreach Olá dados da camada de saudação são Olá aqueles que têm válida do Azure tokens de portador de AD.</span><span class="sxs-lookup"><span data-stu-id="ced6b-164">In this section you configure App Service so that hello only HTTP requests it allows tooreach hello data tier API app are hello ones that have valid Azure AD bearer tokens.</span></span> 

<span data-ttu-id="ced6b-165">Em Olá seção a seguir, você configurar credenciais Olá camada intermediária API aplicativo toosend aplicativo tooAzure AD, obter um token de portador e envia portador Olá token toohello aplicativo de API de camada de dados.</span><span class="sxs-lookup"><span data-stu-id="ced6b-165">In hello following section, you configure hello middle tier API app toosend application credentials tooAzure AD, get back a bearer token, and send hello bearer token toohello data tier API app.</span></span> <span data-ttu-id="ced6b-166">Esse processo é ilustrado no diagrama de saudação.</span><span class="sxs-lookup"><span data-stu-id="ced6b-166">This process is illustrated in hello diagram.</span></span>

![Diagrama do serviço de autenticação](./media/app-service-api-dotnet-service-principal-auth/appdiagram.png)

<span data-ttu-id="ced6b-168">Se você tiver problemas ao tutorial instruções a seguir hello, consulte Olá [solução de problemas](#troubleshooting) seção final Olá tutorial hello.</span><span class="sxs-lookup"><span data-stu-id="ced6b-168">If you run into problems while following hello tutorial directions, see hello [Troubleshooting](#troubleshooting) section at hello end of hello tutorial.</span></span> 

1. <span data-ttu-id="ced6b-169">Em Olá [portal do Azure](https://portal.azure.com/), navegar toohello **configurações** folha Olá API do aplicativo de que você criou para o aplicativo de API do hello ToDoListDataAPI (camada de dados) e, em seguida, clique em **configurações**.</span><span class="sxs-lookup"><span data-stu-id="ced6b-169">In hello [Azure portal](https://portal.azure.com/), navigate toohello **Settings** blade of hello API app that you created for hello ToDoListDataAPI (data tier) API app, and then click **Settings**.</span></span>
2. <span data-ttu-id="ced6b-170">Em Olá **configurações** folha, localizar Olá **recursos** seção e, em seguida, clique em **autenticação / autorização**.</span><span class="sxs-lookup"><span data-stu-id="ced6b-170">In hello **Settings** blade, find hello **Features** section, and then click **Authentication / Authorization**.</span></span>
   
    ![Autenticação/Autorização no portal do Azure](./media/app-service-api-dotnet-user-principal-auth/features.png)
3. <span data-ttu-id="ced6b-172">Em Olá **autenticação / autorização** folha, clique em **em**.</span><span class="sxs-lookup"><span data-stu-id="ced6b-172">In hello **Authentication / Authorization** blade, click **On**.</span></span>
4. <span data-ttu-id="ced6b-173">Em Olá **tootake de ação quando a solicitação não está autenticada** lista suspensa, selecione **fazer logon com Active Directory do Azure**.</span><span class="sxs-lookup"><span data-stu-id="ced6b-173">In hello **Action tootake when request is not authenticated** drop-down list, select **Log in with Azure Active Directory**.</span></span>
   
    <span data-ttu-id="ced6b-174">Essa é a configuração de saudação que faz com que o serviço de aplicativo tooensure que autenticou somente solicitações alcance saudação do aplicativo de API.</span><span class="sxs-lookup"><span data-stu-id="ced6b-174">This is hello setting that causes App Service tooensure that only authenticated requests reach hello API app.</span></span> <span data-ttu-id="ced6b-175">Para solicitações com tokens de portador válido, o serviço de aplicativo passa tokens Olá ao longo do aplicativo toohello API e preenche os cabeçalhos HTTP com declarações usadas toomake essas informações código tooyour mais facilmente disponíveis.</span><span class="sxs-lookup"><span data-stu-id="ced6b-175">For requests that have valid bearer tokens, App Service passes hello tokens along toohello API app and populates HTTP headers with commonly used claims toomake that information more easily available tooyour code.</span></span>
5. <span data-ttu-id="ced6b-176">Em **Provedores de Autenticação**, clique em **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="ced6b-176">Under **Authentication Providers**, click **Azure Active Directory**.</span></span>
   
    ![Folha Autenticação/Autorização no portal do Azure](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
6. <span data-ttu-id="ced6b-178">Em Olá **configurações do Active Directory do Azure** folha, clique em **Express**.</span><span class="sxs-lookup"><span data-stu-id="ced6b-178">In hello **Azure Active Directory Settings** blade, click **Express**.</span></span>
   
    <span data-ttu-id="ced6b-179">Com hello **Express** opção Azure pode criar um aplicativo AAD automaticamente no AD do Azure [locatário](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span><span class="sxs-lookup"><span data-stu-id="ced6b-179">With hello **Express** option Azure can automatically create an AAD application in your Azure AD [tenant](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span></span> 
   
    <span data-ttu-id="ced6b-180">Você não tem toocreate um locatário, porque cada conta do Azure tem uma automaticamente.</span><span class="sxs-lookup"><span data-stu-id="ced6b-180">You don't have toocreate a tenant, because every Azure account automatically has one.</span></span>
7. <span data-ttu-id="ced6b-181">Em **Modo de gerenciamento**, clique em **Criar novo aplicativo do AD** se ainda não estiver selecionado.</span><span class="sxs-lookup"><span data-stu-id="ced6b-181">Under **Management mode**, click **Create New AD App** if it isn't already selected.</span></span>
   
    <span data-ttu-id="ced6b-182">conecta-se portal Olá Olá **criar aplicativo** caixa de entrada com um valor padrão.</span><span class="sxs-lookup"><span data-stu-id="ced6b-182">hello portal plugs hello **Create App** input box with a default value.</span></span> <span data-ttu-id="ced6b-183">Por padrão, Olá aplicativo AD do Azure é denominado hello mesmo como o aplicativo hello API.</span><span class="sxs-lookup"><span data-stu-id="ced6b-183">By default, hello Azure AD application is named hello same as hello API app.</span></span> <span data-ttu-id="ced6b-184">Se preferir, você pode inserir um nome diferente.</span><span class="sxs-lookup"><span data-stu-id="ced6b-184">If you prefer, you can enter a different name.</span></span>
   
    ![Configurações do Azure AD](./media/app-service-api-dotnet-service-principal-auth/aadsettings.png)
   
    <span data-ttu-id="ced6b-186">**Observação**: como alternativa, você pode usar o Azure AD um único aplicativo para ambos Olá chamado aplicativo de API e Olá protegido do aplicativo de API.</span><span class="sxs-lookup"><span data-stu-id="ced6b-186">**Note**: As an alternative, you could use a single Azure AD application for both hello calling API app and hello protected API app.</span></span> <span data-ttu-id="ced6b-187">Se você escolher essa alternativa, você não precisará Olá **criar novo aplicativo AD** opção aqui porque você já criou um aplicativo do AD do Azure anteriormente no tutorial de autenticação de usuário hello.</span><span class="sxs-lookup"><span data-stu-id="ced6b-187">If you chose that alternative, you would not need hello **Create New AD App** option here because you already created an Azure AD application earlier in hello user authentication tutorial.</span></span> <span data-ttu-id="ced6b-188">Para este tutorial, você usará separar aplicativos do Azure AD para Olá chamando o aplicativo de API e hello protegido do aplicativo de API.</span><span class="sxs-lookup"><span data-stu-id="ced6b-188">For this tutorial, you'll use separate Azure AD applications for hello calling API app and hello protected API app.</span></span>
8. <span data-ttu-id="ced6b-189">Anote Olá valor Olá **criar aplicativo** caixa de entrada; você verá esse aplicativo AAD no hello portal clássico do Azure posteriormente.</span><span class="sxs-lookup"><span data-stu-id="ced6b-189">Make a note of hello value that is in hello **Create App** input box; you'll look up this AAD application in hello Azure classic portal later.</span></span>
9. <span data-ttu-id="ced6b-190">Clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="ced6b-190">Click **OK**.</span></span>
10. <span data-ttu-id="ced6b-191">Em Olá **autenticação / autorização** folha, clique em **salvar**.</span><span class="sxs-lookup"><span data-stu-id="ced6b-191">In hello **Authentication / Authorization** blade, click **Save**.</span></span>
    
    ![Clique em Salvar](./media/app-service-api-dotnet-service-principal-auth/saveauth.png)
    
    <span data-ttu-id="ced6b-193">Serviço de aplicativo cria um aplicativo do Active Directory do Azure com **URL de logon** e **URL de resposta** definir automaticamente a URL de toohello do seu aplicativo de API.</span><span class="sxs-lookup"><span data-stu-id="ced6b-193">App Service creates an Azure Active Directory application with **Sign-on URL** and **Reply URL** automatically set toohello URL of your API app.</span></span> <span data-ttu-id="ced6b-194">último valor de saudação permite aos usuários em sua toolog de locatário do AAD no e aplicativo de API de saudação do access.</span><span class="sxs-lookup"><span data-stu-id="ced6b-194">hello latter value enables users in your AAD tenant toolog in and access hello API app.</span></span>

### <a name="verify-that-hello-api-app-is-protected"></a><span data-ttu-id="ced6b-195">Verifique se que o aplicativo hello API está protegido</span><span class="sxs-lookup"><span data-stu-id="ced6b-195">Verify that hello API app is protected</span></span>
1. <span data-ttu-id="ced6b-196">Em um navegador, vá toohello URL do aplicativo hello API: no hello **aplicativo de API** folha em Olá portal do Azure, clique o link de saudação em **URL**.</span><span class="sxs-lookup"><span data-stu-id="ced6b-196">In a browser go toohello URL of hello API app: in hello **API app** blade in hello Azure portal, click hello link under **URL**.</span></span> 
   
    <span data-ttu-id="ced6b-197">Você está a tela de login tooa redirecionado porque as solicitações não autenticadas não são permitidas tooreach saudação do aplicativo de API.</span><span class="sxs-lookup"><span data-stu-id="ced6b-197">You are redirected tooa login screen because unauthenticated requests are not allowed tooreach hello API app.</span></span> 
   
    <span data-ttu-id="ced6b-198">Se seu navegador vá toohello Swagger da interface do usuário, seu navegador já pode estar conectado – nesse caso, abra uma janela InPrivate ou Incognito e vá toohello URL Swagger de interface do usuário.</span><span class="sxs-lookup"><span data-stu-id="ced6b-198">If your browser does go toohello Swagger UI, your browser might already be logged on -- in that case, open an InPrivate or Incognito window and go toohello Swagger UI URL.</span></span>
2. <span data-ttu-id="ced6b-199">Faça logon com as credenciais de um usuário em seu locatário do AAD.</span><span class="sxs-lookup"><span data-stu-id="ced6b-199">Log in with credentials of a user in your AAD tenant.</span></span>
   
   <span data-ttu-id="ced6b-200">Quando você fizer logon, Olá "criado com êxito" página aparece no navegador de saudação.</span><span class="sxs-lookup"><span data-stu-id="ced6b-200">When you're logged on, hello "successfully created" page appears in hello browser.</span></span>

## <a name="configure-hello-todolistapi-project-tooacquire-and-send-hello-azure-ad-token"></a><span data-ttu-id="ced6b-201">Configurar Olá ToDoListAPI projeto tooacquire e enviar o token do AD do Azure Olá</span><span class="sxs-lookup"><span data-stu-id="ced6b-201">Configure hello ToDoListAPI project tooacquire and send hello Azure AD token</span></span>
<span data-ttu-id="ced6b-202">Nesta seção você Olá seguintes tarefas:</span><span class="sxs-lookup"><span data-stu-id="ced6b-202">In this section you do hello following tasks:</span></span>

* <span data-ttu-id="ced6b-203">Adicione o código no aplicativo de API de camada intermediária Olá que usa o AD do Azure aplicativo credenciais tooacquire um token e enviar solicitações com HTTP toohello aplicativo de API de camada de dados.</span><span class="sxs-lookup"><span data-stu-id="ced6b-203">Add code in hello middle tier API app that uses Azure AD application credentials tooacquire a token and send it with HTTP requests toohello data tier API app.</span></span>
* <span data-ttu-id="ced6b-204">Obtenha as credenciais de saudação que precisar do AD do Azure.</span><span class="sxs-lookup"><span data-stu-id="ced6b-204">Get hello credentials you need from Azure AD.</span></span>
* <span data-ttu-id="ced6b-205">Insira as credenciais de saudação em configurações de ambiente de tempo de execução do serviço de aplicativo do Azure na camada intermediária de saudação do aplicativo de API.</span><span class="sxs-lookup"><span data-stu-id="ced6b-205">Enter hello credentials into Azure App Service runtime environment settings in hello middle tier API app.</span></span> 

### <a name="configure-hello-todolistapi-project-tooacquire-and-send-hello-azure-ad-token"></a><span data-ttu-id="ced6b-206">Configurar Olá ToDoListAPI projeto tooacquire e enviar o token do AD do Azure Olá</span><span class="sxs-lookup"><span data-stu-id="ced6b-206">Configure hello ToDoListAPI project tooacquire and send hello Azure AD token</span></span>
<span data-ttu-id="ced6b-207">Verifique Olá após as alterações no projeto de ToDoListAPI Olá no Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="ced6b-207">Make hello following changes in hello ToDoListAPI project in Visual Studio.</span></span>

1. <span data-ttu-id="ced6b-208">Remova todo o código de saudação em Olá *ServicePrincipal.cs* arquivo.</span><span class="sxs-lookup"><span data-stu-id="ced6b-208">Uncomment all of hello code in hello *ServicePrincipal.cs* file.</span></span>
   
    <span data-ttu-id="ced6b-209">Esse é o código de saudação que usa ADAL para o token de portador .NET tooacquire Olá AD do Azure.</span><span class="sxs-lookup"><span data-stu-id="ced6b-209">This is hello code that uses ADAL for .NET tooacquire hello Azure AD bearer token.</span></span>  <span data-ttu-id="ced6b-210">Ele usa vários valores de configuração que você definir no ambiente de tempo de execução do Azure hello mais tarde.</span><span class="sxs-lookup"><span data-stu-id="ced6b-210">It uses several configuration values that you'll set in hello Azure runtime environment later.</span></span> <span data-ttu-id="ced6b-211">Aqui está o código de saudação:</span><span class="sxs-lookup"><span data-stu-id="ced6b-211">Here's hello code:</span></span> 
   
        public static class ServicePrincipal
        {
            static string authority = ConfigurationManager.AppSettings["ida:Authority"];
            static string clientId = ConfigurationManager.AppSettings["ida:ClientId"];
            static string clientSecret = ConfigurationManager.AppSettings["ida:ClientSecret"];
            static string resource = ConfigurationManager.AppSettings["ida:Resource"];
   
            public static AuthenticationResult GetS2SAccessTokenForProdMSA()
            {
                return GetS2SAccessToken(authority, resource, clientId, clientSecret);
            }
   
            static AuthenticationResult GetS2SAccessToken(string authority, string resource, string clientId, string clientSecret)
            {
                var clientCredential = new ClientCredential(clientId, clientSecret);
                AuthenticationContext context = new AuthenticationContext(authority, false);
                AuthenticationResult authenticationResult = context.AcquireToken(
                    resource,
                    clientCredential);
                return authenticationResult;
            }
        }
   
    <span data-ttu-id="ced6b-212">**Observação:** esse código requer Olá ADAL para o pacote do NuGet do .NET (ActiveDirectory), que já está instalado no projeto de saudação.</span><span class="sxs-lookup"><span data-stu-id="ced6b-212">**Note:** This code requires hello ADAL for .NET NuGet package (Microsoft.IdentityModel.Clients.ActiveDirectory), which is already installed in hello project.</span></span> <span data-ttu-id="ced6b-213">Se você criar este projeto do zero, você teria tooinstall este pacote.</span><span class="sxs-lookup"><span data-stu-id="ced6b-213">If you were creating this project from scratch, you would have tooinstall this package.</span></span> <span data-ttu-id="ced6b-214">Este pacote não é instalado automaticamente pelo modelo de novo projeto de aplicativo de API de saudação.</span><span class="sxs-lookup"><span data-stu-id="ced6b-214">This package is not automatically installed by hello API app new-project template.</span></span>
2. <span data-ttu-id="ced6b-215">Em *controladores/ToDoListController*, remova os comentários de código Olá Olá `NewDataAPIClient` método que adiciona solicitações de token tooHTTP Olá no cabeçalho de autorização de saudação.</span><span class="sxs-lookup"><span data-stu-id="ced6b-215">In *Controllers/ToDoListController*, uncomment hello code in hello `NewDataAPIClient` method that adds hello token tooHTTP requests in hello authorization header.</span></span>
   
        client.HttpClient.DefaultRequestHeaders.Authorization =
            new AuthenticationHeaderValue("Bearer", ServicePrincipal.GetS2SAccessTokenForProdMSA().AccessToken);
3. <span data-ttu-id="ced6b-216">Implante Olá ToDoListAPI projeto.</span><span class="sxs-lookup"><span data-stu-id="ced6b-216">Deploy hello ToDoListAPI project.</span></span> <span data-ttu-id="ced6b-217">(Clique com botão direito hello, clique em **publicar > publicar**.)</span><span class="sxs-lookup"><span data-stu-id="ced6b-217">(Right-click hello project, then click **Publish > Publish**.)</span></span>
   
    <span data-ttu-id="ced6b-218">Visual Studio implanta o projeto hello e abre URL de base de um navegador toohello aplicativo web.</span><span class="sxs-lookup"><span data-stu-id="ced6b-218">Visual Studio deploys hello project and opens a browser toohello web app's base URL.</span></span> <span data-ttu-id="ced6b-219">Isso mostrará uma página de 403 erro, que é normal para uma URL base de tentativa toogo tooa API da Web em um navegador.</span><span class="sxs-lookup"><span data-stu-id="ced6b-219">This will show a 403 error page, which is normal for an attempt toogo tooa Web API base URL from a browser.</span></span>
4. <span data-ttu-id="ced6b-220">Navegador de saudação fechar.</span><span class="sxs-lookup"><span data-stu-id="ced6b-220">Close hello browser.</span></span>

### <a name="get-azure-ad-configuration-values"></a><span data-ttu-id="ced6b-221">Obter valores de configuração do Azure AD</span><span class="sxs-lookup"><span data-stu-id="ced6b-221">Get Azure AD configuration values</span></span>
1. <span data-ttu-id="ced6b-222">Em Olá [portal clássico do Azure](https://manage.windowsazure.com/), ir muito**Active Directory do Azure**.</span><span class="sxs-lookup"><span data-stu-id="ced6b-222">In hello [Azure classic portal](https://manage.windowsazure.com/), go too**Azure Active Directory**.</span></span>
2. <span data-ttu-id="ced6b-223">Em Olá **diretório** , clique em seu locatário do AAD.</span><span class="sxs-lookup"><span data-stu-id="ced6b-223">On hello **Directory** tab, click your AAD tenant.</span></span>
3. <span data-ttu-id="ced6b-224">Clique em **aplicativos > aplicativos que minha empresa possui**e, em seguida, clique em marca de seleção de saudação.</span><span class="sxs-lookup"><span data-stu-id="ced6b-224">Click **Applications > Applications my company owns**, and then click hello check mark.</span></span>
4. <span data-ttu-id="ced6b-225">Na lista de Olá de aplicativos, clique em nome de saudação do hello que Azure criado para você quando você habilitou a autenticação para aplicativo de API do hello ToDoListDataAPI (camada de dados).</span><span class="sxs-lookup"><span data-stu-id="ced6b-225">In hello list of applications, click hello name of hello one that Azure created for you when you enabled authentication for hello ToDoListDataAPI (data tier) API app.</span></span>
5. <span data-ttu-id="ced6b-226">Clique em Olá **configurar** guia.</span><span class="sxs-lookup"><span data-stu-id="ced6b-226">Click hello **Configure** tab.</span></span>
6. <span data-ttu-id="ced6b-227">Saudação de cópia **ID do cliente** valor e salve-o em algum ponto, você poderá obtê-lo de mais tarde.</span><span class="sxs-lookup"><span data-stu-id="ced6b-227">Copy hello **Client ID** value and save it someplace you can get it from later.</span></span> 
7. <span data-ttu-id="ced6b-228">No portal clássico do Azure de saudação volte lista toohello de **aplicativos que minha empresa possui**e clique em aplicativo AAD hello que você criou para o aplicativo ToDoListAPI API de camada intermediária hello (Olá um criado no tutorial anterior de saudação, não Olá um criado por você neste tutorial).</span><span class="sxs-lookup"><span data-stu-id="ced6b-228">In hello Azure classic portal go back toohello list of **Applications my company owns**, and click hello AAD application that you created for hello middle tier ToDoListAPI API app (hello one you created in hello previous tutorial, not hello one you created in this tutorial).</span></span>
8. <span data-ttu-id="ced6b-229">Clique em Olá **configurar** guia.</span><span class="sxs-lookup"><span data-stu-id="ced6b-229">Click hello **Configure** tab.</span></span>
9. <span data-ttu-id="ced6b-230">Saudação de cópia **ID do cliente** valor e salve-o em algum ponto, você poderá obtê-lo de mais tarde.</span><span class="sxs-lookup"><span data-stu-id="ced6b-230">Copy hello **Client ID** value and save it someplace you can get it from later.</span></span>
10. <span data-ttu-id="ced6b-231">Em **chaves**, selecione **1 ano** de saudação **selecionar duração** lista suspensa.</span><span class="sxs-lookup"><span data-stu-id="ced6b-231">Under **keys**, select **1 year** from hello **Select duration** drop-down list.</span></span>
11. <span data-ttu-id="ced6b-232">Clique em **Salvar**.</span><span class="sxs-lookup"><span data-stu-id="ced6b-232">Click **Save**.</span></span>
    
     ![Gerar chave do aplicativo](./media/app-service-api-dotnet-service-principal-auth/genkey.png)
12. <span data-ttu-id="ced6b-234">Copie o valor da chave hello e salve-o em algum ponto, que você poderá obtê-lo de mais tarde.</span><span class="sxs-lookup"><span data-stu-id="ced6b-234">Copy hello key value and save it someplace you can get it from later.</span></span>
    
     ![Copiar a nova chave do aplicativo](./media/app-service-api-dotnet-service-principal-auth/genkeycopy.png)

### <a name="configure-azure-ad-settings-in-hello-middle-tier-api-apps-runtime-environment"></a><span data-ttu-id="ced6b-236">Configurar o AD do Azure no ambiente de tempo de execução do aplicativo de camada intermediária API Olá</span><span class="sxs-lookup"><span data-stu-id="ced6b-236">Configure Azure AD settings in hello middle tier API app's runtime environment</span></span>
1. <span data-ttu-id="ced6b-237">Vá toohello [portal do Azure](https://portal.azure.com/)e, em seguida, navegue toohello **API App** folha para o aplicativo hello API que hospeda o projeto do hello TodoListAPI (camada intermediária).</span><span class="sxs-lookup"><span data-stu-id="ced6b-237">Go toohello [Azure portal](https://portal.azure.com/), and then navigate toohello **API App** blade for hello API app that hosts hello TodoListAPI (middle tier) project.</span></span>
2. <span data-ttu-id="ced6b-238">Clique em **Configurações > Configurações do Aplicativo**.</span><span class="sxs-lookup"><span data-stu-id="ced6b-238">Click **Settings > Application Settings**.</span></span>
3. <span data-ttu-id="ced6b-239">Em Olá **configurações do aplicativo** seção, adicione Olá seguindo as chaves e valores:</span><span class="sxs-lookup"><span data-stu-id="ced6b-239">In hello **App settings** section, add hello following keys and values:</span></span>
   
   | <span data-ttu-id="ced6b-240">**Chave**</span><span class="sxs-lookup"><span data-stu-id="ced6b-240">**Key**</span></span> | <span data-ttu-id="ced6b-241">ida:Authority</span><span class="sxs-lookup"><span data-stu-id="ced6b-241">ida:Authority</span></span> |
   | --- | --- |
   | <span data-ttu-id="ced6b-242">**Valor**</span><span class="sxs-lookup"><span data-stu-id="ced6b-242">**Value**</span></span> |<span data-ttu-id="ced6b-243">https://login.microsoftonline.com/{your Azure AD tenant name}</span><span class="sxs-lookup"><span data-stu-id="ced6b-243">https://login.microsoftonline.com/{your Azure AD tenant name}</span></span> |
   | <span data-ttu-id="ced6b-244">**Exemplo**</span><span class="sxs-lookup"><span data-stu-id="ced6b-244">**Example**</span></span> |<span data-ttu-id="ced6b-245">https://login.microsoftonline.com/contoso.onmicrosoft.com</span><span class="sxs-lookup"><span data-stu-id="ced6b-245">https://login.microsoftonline.com/contoso.onmicrosoft.com</span></span> |
   
   | <span data-ttu-id="ced6b-246">**Chave**</span><span class="sxs-lookup"><span data-stu-id="ced6b-246">**Key**</span></span> | <span data-ttu-id="ced6b-247">ida:ClientId</span><span class="sxs-lookup"><span data-stu-id="ced6b-247">ida:ClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="ced6b-248">**Valor**</span><span class="sxs-lookup"><span data-stu-id="ced6b-248">**Value**</span></span> |<span data-ttu-id="ced6b-249">ID do cliente da saudação (camada intermediária - ToDoListAPI) do aplicativo de chamada</span><span class="sxs-lookup"><span data-stu-id="ced6b-249">Client ID of hello calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="ced6b-250">**Exemplo**</span><span class="sxs-lookup"><span data-stu-id="ced6b-250">**Example**</span></span> |<span data-ttu-id="ced6b-251">960adec2-b74a-484a-960adec2-b74a-484a</span><span class="sxs-lookup"><span data-stu-id="ced6b-251">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
   
   | <span data-ttu-id="ced6b-252">**Chave**</span><span class="sxs-lookup"><span data-stu-id="ced6b-252">**Key**</span></span> | <span data-ttu-id="ced6b-253">ida:ClientSecret</span><span class="sxs-lookup"><span data-stu-id="ced6b-253">ida:ClientSecret</span></span> |
   | --- | --- |
   | <span data-ttu-id="ced6b-254">**Valor**</span><span class="sxs-lookup"><span data-stu-id="ced6b-254">**Value**</span></span> |<span data-ttu-id="ced6b-255">Chave de aplicativo da saudação (camada intermediária - ToDoListAPI) do aplicativo de chamada</span><span class="sxs-lookup"><span data-stu-id="ced6b-255">App key of hello calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="ced6b-256">**Exemplo**</span><span class="sxs-lookup"><span data-stu-id="ced6b-256">**Example**</span></span> |<span data-ttu-id="ced6b-257">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span><span class="sxs-lookup"><span data-stu-id="ced6b-257">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
   | <span data-ttu-id="ced6b-258">**Chave**</span><span class="sxs-lookup"><span data-stu-id="ced6b-258">**Key**</span></span> | <span data-ttu-id="ced6b-259">ida:Resource</span><span class="sxs-lookup"><span data-stu-id="ced6b-259">ida:Resource</span></span> |
   | --- | --- |
   | <span data-ttu-id="ced6b-260">**Valor**</span><span class="sxs-lookup"><span data-stu-id="ced6b-260">**Value**</span></span> |<span data-ttu-id="ced6b-261">ID do cliente do hello chamado de aplicativo (camada de dados - ToDoListDataAPI)</span><span class="sxs-lookup"><span data-stu-id="ced6b-261">Client ID of hello called application (data tier - ToDoListDataAPI)</span></span> |
   | <span data-ttu-id="ced6b-262">**Exemplo**</span><span class="sxs-lookup"><span data-stu-id="ced6b-262">**Example**</span></span> |<span data-ttu-id="ced6b-263">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span><span class="sxs-lookup"><span data-stu-id="ced6b-263">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
    <span data-ttu-id="ced6b-264">**Observação**: para `ida:Resource`, certifique-se de usar o hello chamado do aplicativo **ID do cliente** e não seu **URI da ID do aplicativo**.</span><span class="sxs-lookup"><span data-stu-id="ced6b-264">**Note**: For `ida:Resource`, make sure you use hello called application's **client ID** and not its **App ID URI**.</span></span>
   
    <span data-ttu-id="ced6b-265">`ida:ClientId`e `ida:Resource` são diferentes valores para este tutorial, porque você está usando, separe applicaations do AD do Azure para a camada intermediária hello e camada de dados.</span><span class="sxs-lookup"><span data-stu-id="ced6b-265">`ida:ClientId` and `ida:Resource` are different values for this tutorial because you're using separate Azure AD applicaations for hello middle tier and data tier.</span></span> <span data-ttu-id="ced6b-266">Se você estiver usando um único aplicativo do AD do Azure para Olá chamando o aplicativo de API e hello protegido do aplicativo de API, você usaria Olá mesmo valor em ambos os `ida:ClientId` e `ida:Resource`.</span><span class="sxs-lookup"><span data-stu-id="ced6b-266">If you were using a single Azure AD application for hello calling API app and hello protected API app, you would use hello same value in both `ida:ClientId` and `ida:Resource`.</span></span>
   
    <span data-ttu-id="ced6b-267">código de Olá usa ConfigurationManager tooget esses valores, portanto pode ser armazenados no arquivo de Web. config do projeto hello ou no ambiente de tempo de execução do Azure hello.</span><span class="sxs-lookup"><span data-stu-id="ced6b-267">hello code uses ConfigurationManager tooget these values, so they could be stored in hello project's Web.config file or in hello Azure runtime environment.</span></span> <span data-ttu-id="ced6b-268">Enquanto um aplicativo do ASP.NET é executado no Serviço de Aplicativo do Azure, as configurações de ambiente automaticamente substituem as configurações de Web.config. Configurações de ambiente são geralmente uma [mais seguras informações confidenciais toostore de maneira com tooa. config](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span><span class="sxs-lookup"><span data-stu-id="ced6b-268">While an ASP.NET application is running in Azure App Service, environment settings automatically override settings from Web.config. Environment settings are generally a [more secure way toostore sensitive information compared tooa Web.config file](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span></span>
4. <span data-ttu-id="ced6b-269">Clique em **Salvar**.</span><span class="sxs-lookup"><span data-stu-id="ced6b-269">Click **Save**.</span></span>
   
    ![Clique em Salvar](./media/app-service-api-dotnet-service-principal-auth/appsettings.png)

### <a name="test-hello-application"></a><span data-ttu-id="ced6b-271">Testar o aplicativo hello</span><span class="sxs-lookup"><span data-stu-id="ced6b-271">Test hello application</span></span>
1. <span data-ttu-id="ced6b-272">Em um navegador, vá toohello HTTPS URL do aplicativo de web de front-end Olá AngularJS.</span><span class="sxs-lookup"><span data-stu-id="ced6b-272">In a browser go toohello HTTPS URL of hello AngularJS front end web app.</span></span>
2. <span data-ttu-id="ced6b-273">Clique em Olá **tooDo lista** guia e faça logon com credenciais de um usuário no seu locatário do AD do Azure.</span><span class="sxs-lookup"><span data-stu-id="ced6b-273">Click hello **tooDo List** tab and log in with credentials for a user in your Azure AD tenant.</span></span> 
3. <span data-ttu-id="ced6b-274">Adicione tooverify de itens de tarefas que o aplicativo hello está funcionando.</span><span class="sxs-lookup"><span data-stu-id="ced6b-274">Add to-do items tooverify that hello application is working.</span></span>
   
    ![página de lista de tooDo](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)
   
    <span data-ttu-id="ced6b-276">Se o aplicativo hello não funcionar conforme o esperado, verifique novamente todas as configurações de saudação inserido no hello portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="ced6b-276">If hello application doesn't work as expected, double-check all of hello settings you entered in hello Azure portal.</span></span> <span data-ttu-id="ced6b-277">Se todas as configurações de saudação aparecem toobe correto, consulte Olá [solução de problemas](#troubleshooting) seção mais adiante neste tutorial.</span><span class="sxs-lookup"><span data-stu-id="ced6b-277">If all of hello settings appear toobe correct, see hello [Troubleshooting](#troubleshooting) section later in this tutorial.</span></span>

## <a name="protect-hello-api-app-from-browser-access"></a><span data-ttu-id="ced6b-278">Proteger a saudação do aplicativo de API de acesso do navegador</span><span class="sxs-lookup"><span data-stu-id="ced6b-278">Protect hello API app from browser access</span></span>
<span data-ttu-id="ced6b-279">Para este tutorial, você criou um separado aplicativo AD do Azure para o aplicativo hello API ToDoListDataAPI (camada de dados).</span><span class="sxs-lookup"><span data-stu-id="ced6b-279">For this tutorial you created a separate Azure AD application for hello ToDoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="ced6b-280">Como você viu, quando o serviço de aplicativo cria um aplicativo AAD, ele configura o aplicativo de AAD saudação de forma que permite que URL de um usuário toogo toohello aplicativo de API em um navegador e o log em.</span><span class="sxs-lookup"><span data-stu-id="ced6b-280">As you've seen, when App Service creates an AAD application, it configures hello AAD application in a way that enables a user toogo toohello API app's URL in a browser and log on.</span></span> <span data-ttu-id="ced6b-281">Isso significa que é possível que um usuário final em seu locatário do AD do Azure, não apenas uma entidade de serviço, tooaccess Olá API.</span><span class="sxs-lookup"><span data-stu-id="ced6b-281">That means it's possible for an end user in your Azure AD tenant, not just a service principal, tooaccess hello API.</span></span> 

<span data-ttu-id="ced6b-282">Se você quiser acesso do navegador tooprevent sem gravar qualquer código no hello protegidos do aplicativo de API, você pode alterar Olá **URL de resposta** em Olá aplicativo AAD para que seja diferente do aplicativo hello API URL de base.</span><span class="sxs-lookup"><span data-stu-id="ced6b-282">If you want tooprevent browser access without writing any code in hello protected API app, you can change hello **Reply URL** in hello AAD application so that it's different from hello API app's base URL.</span></span> 

### <a name="disable-browser-access"></a><span data-ttu-id="ced6b-283">Desabilitar o acesso do navegador</span><span class="sxs-lookup"><span data-stu-id="ced6b-283">Disable browser access</span></span>
1. <span data-ttu-id="ced6b-284">No portal clássico hello **configurar** para aplicativo AAD hello que foi criado para Olá TodoListService, altere o valor Olá Olá **URL de resposta** campo para que seja uma URL válida, mas não Olá API do aplicativo URL.</span><span class="sxs-lookup"><span data-stu-id="ced6b-284">In hello classic portal's **Configure** tab for hello AAD application that was created for hello TodoListService, change hello value in hello **Reply URL** field so that it is a valid URL but not hello API app's URL.</span></span>
2. <span data-ttu-id="ced6b-285">Clique em **Salvar**.</span><span class="sxs-lookup"><span data-stu-id="ced6b-285">Click **Save**.</span></span>

### <a name="verify-browser-access-no-longer-works"></a><span data-ttu-id="ced6b-286">Verificar se o acesso de navegador não funciona mais</span><span class="sxs-lookup"><span data-stu-id="ced6b-286">Verify browser access no longer works</span></span>
<span data-ttu-id="ced6b-287">Anteriormente, você verificou que você pode ir toohello URL do aplicativo de API de um navegador, faça logon com credenciais de um usuário individual.</span><span class="sxs-lookup"><span data-stu-id="ced6b-287">Earlier you verified that you can go toohello API app URL from a browser by logging on with an individual user's credentials.</span></span> <span data-ttu-id="ced6b-288">Nesta seção, você verá que isso não é mais possível.</span><span class="sxs-lookup"><span data-stu-id="ced6b-288">In this section, you verify that this is no longer possible.</span></span> 

1. <span data-ttu-id="ced6b-289">Em uma nova janela do navegador, vá toohello URL do aplicativo de API Olá novamente.</span><span class="sxs-lookup"><span data-stu-id="ced6b-289">In a new browser window, go toohello URL of hello API app again.</span></span>
2. <span data-ttu-id="ced6b-290">Log quando for solicitado para toodo.</span><span class="sxs-lookup"><span data-stu-id="ced6b-290">Log in when prompted toodo so.</span></span>
3. <span data-ttu-id="ced6b-291">Logon for bem-sucedido, mas leva tooan página de erro.</span><span class="sxs-lookup"><span data-stu-id="ced6b-291">Login succeeds but leads tooan error page.</span></span>
   
    <span data-ttu-id="ced6b-292">Você configurou o aplicativo do AAD Olá para que os usuários no locatário do AAD Olá não podem entrar e acessar Olá API em um navegador.</span><span class="sxs-lookup"><span data-stu-id="ced6b-292">You've configured hello AAD app so that users in hello AAD tenant cannot log in and access hello API from a browser.</span></span> <span data-ttu-id="ced6b-293">Você ainda pode acessar o aplicativo de API Olá usando um token da entidade do serviço, que você pode verificar indo URL do aplicativo da web toohello e adicionar mais itens de tarefas pendentes.</span><span class="sxs-lookup"><span data-stu-id="ced6b-293">You can still access hello API app by using a service principal token, which you can verify by going toohello web app's URL and adding more to-do items.</span></span>

## <a name="restrict-access-tooa-particular-service-principal"></a><span data-ttu-id="ced6b-294">Restringir a entidade de serviço específico de tooa de acesso</span><span class="sxs-lookup"><span data-stu-id="ced6b-294">Restrict access tooa particular service principal</span></span>
<span data-ttu-id="ced6b-295">Agora, qualquer chamador que pode obter um token para um usuário ou entidade de serviço em seu locatário do AD do Azure pode chamar o aplicativo hello API TodoListDataAPI (camada de dados).</span><span class="sxs-lookup"><span data-stu-id="ced6b-295">Right now, any caller that can get a token for a user or service principal in your Azure AD tenant can call hello TodoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="ced6b-296">Talvez você queira toomake-se de que aplicativo de API Olá da camada de dados só aceita chamadas de aplicativo de API do hello TodoListAPI (camada intermediária) e somente de uma entidade de serviço específico.</span><span class="sxs-lookup"><span data-stu-id="ced6b-296">You might want toomake sure that hello data tier API app only accepts calls from hello TodoListAPI (middle tier) API app, and only from a particular service principal.</span></span> 

<span data-ttu-id="ced6b-297">Você pode adicionar essas restrições com a adição de saudação do código toovalidate `appid` e `objectidentifier` declarações em chamadas de entrada.</span><span class="sxs-lookup"><span data-stu-id="ced6b-297">You can add these restrictions by adding code toovalidate hello `appid` and `objectidentifier` claims on incoming calls.</span></span>

<span data-ttu-id="ced6b-298">Neste tutorial você colocar o código de saudação que valida a ID do aplicativo e a ID principal serviço diretamente em suas ações do controlador.</span><span class="sxs-lookup"><span data-stu-id="ced6b-298">For this tutorial you put hello code that validates app ID and service principal ID directly in your controller actions.</span></span>  <span data-ttu-id="ced6b-299">Alternativas são toouse um personalizado `Authorize` atributo ou toodo essa validação nas sequências de inicialização (por exemplo, o middleware OWIN).</span><span class="sxs-lookup"><span data-stu-id="ced6b-299">Alternatives are toouse a custom `Authorize` attribute or toodo this validation in your startup sequences (e.g. OWIN middleware).</span></span> <span data-ttu-id="ced6b-300">Para obter um exemplo de hello último, consulte [este aplicativo de exemplo](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span><span class="sxs-lookup"><span data-stu-id="ced6b-300">For an example of hello latter, see [this sample application](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span></span> 

<span data-ttu-id="ced6b-301">Verifique Olá projeto de TodoListDataAPI toohello alterações a seguir.</span><span class="sxs-lookup"><span data-stu-id="ced6b-301">Make hello following changes toohello TodoListDataAPI project.</span></span>

1. <span data-ttu-id="ced6b-302">Olá abrir *Controllers/TodoListController.cs* arquivo.</span><span class="sxs-lookup"><span data-stu-id="ced6b-302">Open hello *Controllers/TodoListController.cs* file.</span></span>
2. <span data-ttu-id="ced6b-303">Descomente as linhas de saudação que definam `trustedCallerClientId` e `trustedCallerServicePrincipalId`.</span><span class="sxs-lookup"><span data-stu-id="ced6b-303">Uncomment hello lines that set `trustedCallerClientId` and `trustedCallerServicePrincipalId`.</span></span>
   
        private static string trustedCallerClientId = ConfigurationManager.AppSettings["todo:TrustedCallerClientId"];
        private static string trustedCallerServicePrincipalId = ConfigurationManager.AppSettings["todo:TrustedCallerServicePrincipalId"];
3. <span data-ttu-id="ced6b-304">Remova os comentários de código Olá Olá CheckCallerId método.</span><span class="sxs-lookup"><span data-stu-id="ced6b-304">Uncomment hello code in hello CheckCallerId method.</span></span> <span data-ttu-id="ced6b-305">Este método é chamado no início de saudação de cada método de ação no controlador de saudação.</span><span class="sxs-lookup"><span data-stu-id="ced6b-305">This method is called at hello start of every action method in hello controller.</span></span> 
   
        private static void CheckCallerId()
        {
            string currentCallerClientId = ClaimsPrincipal.Current.FindFirst("appid").Value;
            string currentCallerServicePrincipalId = ClaimsPrincipal.Current.FindFirst("http://schemas.microsoft.com/identity/claims/objectidentifier").Value;
            if (currentCallerClientId != trustedCallerClientId || currentCallerServicePrincipalId != trustedCallerServicePrincipalId)
            {
                throw new HttpResponseException(new HttpResponseMessage { StatusCode = HttpStatusCode.Unauthorized, ReasonPhrase = "hello appID or service principal ID is not hello expected value." });
            }
        }
4. <span data-ttu-id="ced6b-306">Reimplante Olá ToDoListDataAPI projeto tooAzure do serviço de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ced6b-306">Redeploy hello ToDoListDataAPI project tooAzure App Service.</span></span>
5. <span data-ttu-id="ced6b-307">Em seu navegador, vá HTTPS URL do aplicativo do toohello AngularJS front-end da web e clique em Ajuda na home page do hello Olá **tooDo lista** guia.</span><span class="sxs-lookup"><span data-stu-id="ced6b-307">In your browser, go toohello AngularJS front end web app's HTTPS URL, and in hello home page click hello **tooDo List** tab.</span></span>
   
    <span data-ttu-id="ced6b-308">aplicativo Hello não funciona porque falha em chamadas toohello volta terminar.</span><span class="sxs-lookup"><span data-stu-id="ced6b-308">hello application doesn't work because calls toohello back end are failing.</span></span> <span data-ttu-id="ced6b-309">novo código de saudação está verificando appid real e objectidentifier mas ele ainda não tem Olá valores corretos toocheck-las com.</span><span class="sxs-lookup"><span data-stu-id="ced6b-309">hello new code is checking actual appid and objectidentifier but it doesn't yet have hello correct values toocheck them against.</span></span> <span data-ttu-id="ced6b-310">navegador de saudação Console de ferramentas de desenvolvedor relata que servidor hello está retornando um erro HTTP 401.</span><span class="sxs-lookup"><span data-stu-id="ced6b-310">hello browser Developer Tools Console reports that hello server is returning an HTTP 401 error.</span></span>
   
    ![Erro no Console de Ferramentas de Desenvolvedor](./media/app-service-api-dotnet-service-principal-auth/webapperror.png)
   
    <span data-ttu-id="ced6b-312">Olá etapas a seguir, você configura valores esperados de saudação.</span><span class="sxs-lookup"><span data-stu-id="ced6b-312">In hello following steps you configure hello expected values.</span></span>
6. <span data-ttu-id="ced6b-313">Usando o PowerShell do AD do Azure, obter valor de saudação do serviço de saudação principal Olá aplicativo AD do Azure que você criou para o projeto de TodoListWebApp hello.</span><span class="sxs-lookup"><span data-stu-id="ced6b-313">Using Azure AD PowerShell, get hello value of hello service principal for hello Azure AD application that you created for hello TodoListWebApp project.</span></span>
   
    <span data-ttu-id="ced6b-314">a.</span><span class="sxs-lookup"><span data-stu-id="ced6b-314">a.</span></span> <span data-ttu-id="ced6b-315">Para obter instruções sobre como tooinstall PowerShell do Azure e conecte-se a assinatura de tooyour, consulte [usando o PowerShell do Azure com o Azure Resource Manager](../powershell-azure-resource-manager.md).</span><span class="sxs-lookup"><span data-stu-id="ced6b-315">For instructions on how tooinstall Azure PowerShell and connect tooyour subscription, see [Using Azure PowerShell with Azure Resource Manager](../powershell-azure-resource-manager.md).</span></span>
   
    <span data-ttu-id="ced6b-316">b.</span><span class="sxs-lookup"><span data-stu-id="ced6b-316">b.</span></span> <span data-ttu-id="ced6b-317">tooget uma lista de entidades de serviço, execute Olá `Login-AzureRmAccount` de comando e, em seguida, Olá `Get-AzureRmADServicePrincipal` comando.</span><span class="sxs-lookup"><span data-stu-id="ced6b-317">tooget a list of service principals, execute hello `Login-AzureRmAccount` command and then hello `Get-AzureRmADServicePrincipal` command.</span></span>
   
    <span data-ttu-id="ced6b-318">c.</span><span class="sxs-lookup"><span data-stu-id="ced6b-318">c.</span></span> <span data-ttu-id="ced6b-319">Localizar objectid Olá para Olá entidade de serviço de aplicativo de TodoListAPI hello e salvá-lo em um local que você pode copiar de mais tarde.</span><span class="sxs-lookup"><span data-stu-id="ced6b-319">Find hello objectid for hello service principal of hello TodoListAPI application, and save it in a location you can copy from later.</span></span>
7. <span data-ttu-id="ced6b-320">No portal do Azure de Olá, navegue toohello folha de API do aplicativo para o aplicativo de API Olá que você implantou o projeto ToDoListDataAPI Olá.</span><span class="sxs-lookup"><span data-stu-id="ced6b-320">In hello Azure portal, navigate toohello API app blade for hello API app that you deployed hello ToDoListDataAPI project to.</span></span>
8. <span data-ttu-id="ced6b-321">Clique em **Configurações > Configurações do Aplicativo**.</span><span class="sxs-lookup"><span data-stu-id="ced6b-321">Click **Settings > Application settings**.</span></span>
9. <span data-ttu-id="ced6b-322">Em Olá **configurações do aplicativo** seção, adicione Olá seguindo as chaves e valores:</span><span class="sxs-lookup"><span data-stu-id="ced6b-322">In hello **App settings** section, add hello following keys and values:</span></span>
   
   | <span data-ttu-id="ced6b-323">**Chave**</span><span class="sxs-lookup"><span data-stu-id="ced6b-323">**Key**</span></span> | <span data-ttu-id="ced6b-324">todo:TrustedCallerServicePrincipalId</span><span class="sxs-lookup"><span data-stu-id="ced6b-324">todo:TrustedCallerServicePrincipalId</span></span> |
   | --- | --- |
   | <span data-ttu-id="ced6b-325">**Valor**</span><span class="sxs-lookup"><span data-stu-id="ced6b-325">**Value**</span></span> |<span data-ttu-id="ced6b-326">Id da entidade de serviço do aplicativo de chamada</span><span class="sxs-lookup"><span data-stu-id="ced6b-326">Service principal id of calling application</span></span> |
   | <span data-ttu-id="ced6b-327">**Exemplo**</span><span class="sxs-lookup"><span data-stu-id="ced6b-327">**Example**</span></span> |<span data-ttu-id="ced6b-328">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span><span class="sxs-lookup"><span data-stu-id="ced6b-328">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span></span> |
   
   | <span data-ttu-id="ced6b-329">**Chave**</span><span class="sxs-lookup"><span data-stu-id="ced6b-329">**Key**</span></span> | <span data-ttu-id="ced6b-330">todo:TrustedCallerClientId</span><span class="sxs-lookup"><span data-stu-id="ced6b-330">todo:TrustedCallerClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="ced6b-331">**Valor**</span><span class="sxs-lookup"><span data-stu-id="ced6b-331">**Value**</span></span> |<span data-ttu-id="ced6b-332">ID do cliente da chamada de aplicativo - copiado do aplicativo do hello TodoListAPI AD do Azure</span><span class="sxs-lookup"><span data-stu-id="ced6b-332">Client ID of calling application - copied from hello TodoListAPI Azure AD application</span></span> |
   | <span data-ttu-id="ced6b-333">**Exemplo**</span><span class="sxs-lookup"><span data-stu-id="ced6b-333">**Example**</span></span> |<span data-ttu-id="ced6b-334">960adec2-b74a-484a-960adec2-b74a-484a</span><span class="sxs-lookup"><span data-stu-id="ced6b-334">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
10. <span data-ttu-id="ced6b-335">Clique em **Salvar**.</span><span class="sxs-lookup"><span data-stu-id="ced6b-335">Click **Save**.</span></span>
    
     ![Clique em Salvar](./media/app-service-api-dotnet-service-principal-auth/trustedcaller.png)
11. <span data-ttu-id="ced6b-337">No navegador, retornar o URL do aplicativo da web de toohello e, em seguida, clique em Ajuda na home page do Olá Olá **tooDo lista** guia.</span><span class="sxs-lookup"><span data-stu-id="ced6b-337">In your browser, return toohello web app's URL, and in hello home page click hello **tooDo List** tab.</span></span>
    
     <span data-ttu-id="ced6b-338">Este aplicativo de saudação do tempo funciona conforme o esperado porque Olá chamador confiável app ID e a ID de entidade de serviço Olá esperado de valores.</span><span class="sxs-lookup"><span data-stu-id="ced6b-338">This time hello application works as expected because hello trusted caller app ID and service principal ID are hello expected values.</span></span>
    
     ![página de lista de tooDo](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)

## <a name="building-hello-projects-from-scratch"></a><span data-ttu-id="ced6b-340">Compilando projetos de saudação do zero</span><span class="sxs-lookup"><span data-stu-id="ced6b-340">Building hello projects from scratch</span></span>
<span data-ttu-id="ced6b-341">projetos de API da Web Hello dois foram criados usando Olá **aplicativo de API do Azure** modelo e substituindo controlador de valores padrão de saudação com um controlador de lista de tarefas do projeto.</span><span class="sxs-lookup"><span data-stu-id="ced6b-341">hello two Web API projects were created by using hello **Azure API App** project template and replacing hello default Values controller with a ToDoList controller.</span></span> <span data-ttu-id="ced6b-342">Para aquisição de tokens de entidade de serviço do AD do Azure no projeto de ToDoListAPI Olá, Olá [autenticação biblioteca ADAL (Active Directory) para .NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) NuGet package foi instalado.</span><span class="sxs-lookup"><span data-stu-id="ced6b-342">For acquiring Azure AD service principal tokens in hello ToDoListAPI project, hello [Active Directory Authentication Library (ADAL) for .NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) NuGet package was installed.</span></span>

<span data-ttu-id="ced6b-343">Para obter informações sobre como criar muito um aplicativo de página única AngularJS com um back-end de API da Web como ToDoListAngular, consulte [mãos no laboratório: criar um aplicativo de página única (SPA) com a API da Web do ASP.NET e Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span><span class="sxs-lookup"><span data-stu-id="ced6b-343">For information about how too create an AngularJS single-page application with a Web API back end like ToDoListAngular, see  [Hands On Lab: Build a Single Page Application (SPA) with ASP.NET Web API and Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span></span> <span data-ttu-id="ced6b-344">Para obter informações sobre como tooadd código de autenticação do AD do Azure, consulte [protegendo AngularJS única página de aplicativos com o Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span><span class="sxs-lookup"><span data-stu-id="ced6b-344">For information about how tooadd Azure AD authentication code, see [Securing AngularJS Single Page Apps with Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="ced6b-345">Solucionar problemas</span><span class="sxs-lookup"><span data-stu-id="ced6b-345">Troubleshooting</span></span>
[!INCLUDE [troubleshooting](../../includes/app-service-api-auth-troubleshooting.md)]

* <span data-ttu-id="ced6b-346">Não confunda ToDoListAPI (camada intermediária) e ToDoListDataAPI (camada de dados).</span><span class="sxs-lookup"><span data-stu-id="ced6b-346">Make sure that you don't confuse ToDoListAPI (middle tier) and ToDoListDataAPI (data tier).</span></span> <span data-ttu-id="ced6b-347">Por exemplo, neste tutorial, você adicionar autenticação toohello dados da camada aplicativo de API, **mas chave do aplicativo hello deve vir do hello aplicativo AD do Azure que você criou para o aplicativo de camada intermediária API Olá**.</span><span class="sxs-lookup"><span data-stu-id="ced6b-347">For example, in this tutorial you add authentication toohello data tier API app, **but hello app key must come from hello Azure AD application that you created for hello middle tier API app**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="ced6b-348">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="ced6b-348">Next steps</span></span>
<span data-ttu-id="ced6b-349">Este é o último tutorial Olá Olá série de aplicativos de API.</span><span class="sxs-lookup"><span data-stu-id="ced6b-349">This is hello last tutorial in hello API Apps series.</span></span> 

<span data-ttu-id="ced6b-350">Para obter mais informações sobre o Active Directory do Azure, consulte Olá recursos a seguir.</span><span class="sxs-lookup"><span data-stu-id="ced6b-350">For more information about Azure Active Directory, see hello following resources.</span></span>

* [<span data-ttu-id="ced6b-351">Guia dos desenvolvedores do AD do Azure</span><span class="sxs-lookup"><span data-stu-id="ced6b-351">Azure AD developers' guide</span></span>](http://aka.ms/aaddev)
* [<span data-ttu-id="ced6b-352">Cenários do AD do Azure</span><span class="sxs-lookup"><span data-stu-id="ced6b-352">Azure AD scenarios</span></span>](http://aka.ms/aadscenarios)
* [<span data-ttu-id="ced6b-353">Exemplos do AD do Azure</span><span class="sxs-lookup"><span data-stu-id="ced6b-353">Azure AD samples</span></span>](http://aka.ms/aadsamples)
  
    <span data-ttu-id="ced6b-354">Olá [WebApp-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) exemplo é semelhante toowhat é mostrado neste tutorial, mas sem usar autenticação do serviço de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ced6b-354">hello [WebApp-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) sample is similar toowhat is shown in this tutorial, but without using App Service authentication.</span></span>

<span data-ttu-id="ced6b-355">Para obter informações sobre outras maneiras toodeploy Visual Studio projetos tooAPI aplicativos, usando o Visual Studio ou [automatizar a implantação](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) de um [sistema de controle de origem](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), consulte [como toodeploy um Aplicativo de serviço de aplicativo do Azure](../app-service-web/web-sites-deploy.md).</span><span class="sxs-lookup"><span data-stu-id="ced6b-355">For information about other ways toodeploy Visual Studio projects tooAPI apps, by using Visual Studio or by [automating deployment](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) from a [source control system](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), see [How toodeploy an Azure App Service app](../app-service-web/web-sites-deploy.md).</span></span>

