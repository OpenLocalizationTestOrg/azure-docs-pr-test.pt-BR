---
title: 'Gerar e exportar certificados para o Ponto a Site: MakeCert : Azure | Microsoft Docs'
description: "Este artigo contém etapas para criar um certificado raiz autoassinado, exportar a chave pública e gerar certificados do cliente usando o MakeCert."
services: vpn-gateway
documentationcenter: na
author: cherylmc
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 
ms.service: vpn-gateway
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 08/09/2017
ms.author: cherylmc
ms.openlocfilehash: 4c51edac3b1cdafae8f9543bd0e3133b6a050f73
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/18/2017
---
# <a name="generate-and-export-certificates-for-point-to-site-connections-using-makecert"></a><span data-ttu-id="3bdfe-103">Gerar e exportar certificados para conexões Ponto a Site usando o MakeCert</span><span class="sxs-lookup"><span data-stu-id="3bdfe-103">Generate and export certificates for Point-to-Site connections using MakeCert</span></span>

<span data-ttu-id="3bdfe-104">Conexões ponto a site usam certificados para se autenticar.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-104">Point-to-Site connections use certificates to authenticate.</span></span> <span data-ttu-id="3bdfe-105">Este artigo mostra como criar um certificado raiz autoassinado e gerar certificados do cliente usando o MakeCert.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-105">This article shows you how to create a self-signed root certificate and generate client certificates using MakeCert.</span></span> <span data-ttu-id="3bdfe-106">Se você estiver procurando por etapas de configuração de Ponto a Site, tais como fazer o upload de certificados raiz, selecione um dos artigos 'Configurar Ponto a Site' na lista a seguir:</span><span class="sxs-lookup"><span data-stu-id="3bdfe-106">If you are looking for Point-to-Site configuration steps, such as how to upload root certificates, select one of the 'Configure Point-to-Site' articles from the following list:</span></span>

> [!div class="op_single_selector"]
> * [<span data-ttu-id="3bdfe-107">Criar certificados autoassinados – PowerShell</span><span class="sxs-lookup"><span data-stu-id="3bdfe-107">Create self-signed certificates - PowerShell</span></span>](vpn-gateway-certificates-point-to-site.md)
> * [<span data-ttu-id="3bdfe-108">Criar certificados autoassinados - MakeCert</span><span class="sxs-lookup"><span data-stu-id="3bdfe-108">Create self-signed certificates - MakeCert</span></span>](vpn-gateway-certificates-point-to-site-makecert.md)
> * [<span data-ttu-id="3bdfe-109">Configurar Ponto a Site – Resource Manager – portal do Azure</span><span class="sxs-lookup"><span data-stu-id="3bdfe-109">Configure Point-to-Site - Resource Manager - Azure portal</span></span>](vpn-gateway-howto-point-to-site-resource-manager-portal.md)
> * [<span data-ttu-id="3bdfe-110">Configurar o Point-to-Site - Gerenciador de recursos - Portal do Azure</span><span class="sxs-lookup"><span data-stu-id="3bdfe-110">Configure Point-to-Site - Resource Manager - PowerShell</span></span>](vpn-gateway-howto-point-to-site-rm-ps.md)
> * [<span data-ttu-id="3bdfe-111">Configurar Ponto a Site – Clássico – portal do Azure</span><span class="sxs-lookup"><span data-stu-id="3bdfe-111">Configure Point-to-Site - Classic - Azure portal</span></span>](vpn-gateway-howto-point-to-site-classic-azure-portal.md)
> 
> 

<span data-ttu-id="3bdfe-112">Enquanto é recomendável usar o [etapas do Windows 10 PowerShell](vpn-gateway-certificates-point-to-site.md) para criar seus certificados, fornecemos essas instruções MakeCert como um método opcional.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-112">While we recommend using the [Windows 10 PowerShell steps](vpn-gateway-certificates-point-to-site.md) to create your certificates, we provide these MakeCert instructions as an optional method.</span></span> <span data-ttu-id="3bdfe-113">Os certificados que você gerar utilizando qualquer um dos métodos podem ser instalados em [qualquer sistema operacional cliente com suporte](vpn-gateway-howto-point-to-site-resource-manager-portal.md#faq).</span><span class="sxs-lookup"><span data-stu-id="3bdfe-113">The certificates that you generate using either method can be installed on [any supported client operating system](vpn-gateway-howto-point-to-site-resource-manager-portal.md#faq).</span></span> <span data-ttu-id="3bdfe-114">No entanto, o MakeCert tem a seguinte limitação:</span><span class="sxs-lookup"><span data-stu-id="3bdfe-114">However, MakeCert has the following limitation:</span></span>

* <span data-ttu-id="3bdfe-115">O MakeCert foi preterido.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-115">MakeCert is deprecated.</span></span> <span data-ttu-id="3bdfe-116">Isso significa que essa ferramenta pode ser removida a qualquer momento.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-116">This means that this tool could be removed at any point.</span></span> <span data-ttu-id="3bdfe-117">Todos os certificados que você já tiver gerado usando MakeCert não serão afetados quando o MakeCert não estiver mais disponível.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-117">Any certificates that you already generated using MakeCert won't be affected when MakeCert is no longer available.</span></span> <span data-ttu-id="3bdfe-118">MakeCert só é usado para gerar os certificados, não como um mecanismo de validação.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-118">MakeCert is only used to generate the certificates, not as a validating mechanism.</span></span>

## <span data-ttu-id="3bdfe-119"><a name="rootcert"></a>Criar um certificado raiz autoassinado</span><span class="sxs-lookup"><span data-stu-id="3bdfe-119"><a name="rootcert"></a>Create a self-signed root certificate</span></span>

<span data-ttu-id="3bdfe-120">As etapas a seguir mostram como criar um certificado autoassinado usando o MakeCert.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-120">The following steps show you how to create a self-signed certificate using MakeCert.</span></span> <span data-ttu-id="3bdfe-121">Essas etapas não são específicas do modelo de implantação.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-121">These steps are not deployment-model specific.</span></span> <span data-ttu-id="3bdfe-122">Elas são válidas tanto para o Gerenciador de Recursos quanto para o clássico.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-122">They are valid for both Resource Manager and classic.</span></span>

1. <span data-ttu-id="3bdfe-123">Baixe e instale o [MakeCert](https://msdn.microsoft.com/library/windows/desktop/aa386968(v=vs.85).aspx).</span><span class="sxs-lookup"><span data-stu-id="3bdfe-123">Download and install [MakeCert](https://msdn.microsoft.com/library/windows/desktop/aa386968(v=vs.85).aspx).</span></span>
2. <span data-ttu-id="3bdfe-124">Após a instalação, você pode normalmente localizar o utilitário makecert.exe neste caminho: 'C:\Program Files (x86)\Windows Kits\10\bin\<arch>'.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-124">After installation, you can typically find the makecert.exe utility under this path: 'C:\Program Files (x86)\Windows Kits\10\bin\<arch>'.</span></span> <span data-ttu-id="3bdfe-125">Embora, é possível que ele tenha sido instalado em outro local.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-125">Although, it's possible that it was installed to another location.</span></span> <span data-ttu-id="3bdfe-126">Abra um prompt de comando como administrador e navegue até o local do utilitário MakeCert.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-126">Open a command prompt as administrator and navigate to the location of the MakeCert utility.</span></span> <span data-ttu-id="3bdfe-127">Você pode usar o exemplo a seguir, ajustando para o local apropriado:</span><span class="sxs-lookup"><span data-stu-id="3bdfe-127">You can use the following example, adjusting for the proper location:</span></span>

  ```cmd
  cd C:\Program Files (x86)\Windows Kits\10\bin\x64
  ```
3. <span data-ttu-id="3bdfe-128">Em seguida, crie e instale um certificado no repositório de certificados Pessoal em seu computador.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-128">Create and install a certificate in the Personal certificate store on your computer.</span></span> <span data-ttu-id="3bdfe-129">O exemplo a seguir cria um arquivo *.cer* correspondente que você carrega no Azure ao configurar P2S.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-129">The following example creates a corresponding *.cer* file that you upload to Azure when configuring P2S.</span></span> <span data-ttu-id="3bdfe-130">Substitua “P2SRootCert” e “P2SRootCert.cer” pelo nome que você deseja usar para o certificado.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-130">Replace 'P2SRootCert' and 'P2SRootCert.cer' with the name that you want to use for the certificate.</span></span> <span data-ttu-id="3bdfe-131">O certificado está localizado em seus 'Certificados – Current User\Personal\Certificates'.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-131">The certificate is located in your 'Certificates - Current User\Personal\Certificates'.</span></span>

  ```cmd
  makecert -sky exchange -r -n "CN=P2SRootCert" -pe -a sha256 -len 2048 -ss My
  ```

## <span data-ttu-id="3bdfe-132"><a name="cer"></a>Exportar a chave pública (.cer)</span><span class="sxs-lookup"><span data-stu-id="3bdfe-132"><a name="cer"></a>Export the public key (.cer)</span></span>

[!INCLUDE [Export public key](../../includes/vpn-gateway-certificates-export-public-key-include.md)]

<span data-ttu-id="3bdfe-133">O arquivo exported.cer deve ser carregado no Azure.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-133">The exported.cer file must be uploaded to Azure.</span></span> <span data-ttu-id="3bdfe-134">Para obter instruções, consulte [Configurar uma conexão ponto a site](vpn-gateway-howto-point-to-site-resource-manager-portal.md#uploadfile).</span><span class="sxs-lookup"><span data-stu-id="3bdfe-134">For instructions, see [Configure a Point-to-Site connection](vpn-gateway-howto-point-to-site-resource-manager-portal.md#uploadfile).</span></span> <span data-ttu-id="3bdfe-135">Para adicionar um certificado raiz confiável adicional, consulte [esta seção](vpn-gateway-howto-point-to-site-resource-manager-portal.md#add) do artigo.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-135">To add an additional trusted root certificate, see [this section](vpn-gateway-howto-point-to-site-resource-manager-portal.md#add) of the article.</span></span>

### <a name="export-the-self-signed-certificate-and-private-key-to-store-it-optional"></a><span data-ttu-id="3bdfe-136">Exportar o certificado autoassinado e a chave privada para armazená-lo (opcional)</span><span class="sxs-lookup"><span data-stu-id="3bdfe-136">Export the self-signed certificate and private key to store it (optional)</span></span>

<span data-ttu-id="3bdfe-137">Convém exportar o certificado raiz autoassinado e armazená-lo com segurança.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-137">You may want to export the self-signed root certificate and store it safely.</span></span> <span data-ttu-id="3bdfe-138">Se precisar, você pode instalá-lo depois em outro computador e gerar mais certificados de cliente, ou exportar outro arquivo .cer.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-138">If need be, you can later install it on another computer and generate more client certificates, or export another .cer file.</span></span> <span data-ttu-id="3bdfe-139">Para exportar o certificado raiz autoassinado como um .pfx, selecione o certificado raiz e use as mesmas etapas, conforme descrito em [Exportar um certificado do cliente](#clientexport) para exportar.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-139">To export the self-signed root certificate as a .pfx, select the root certificate and use the same steps as described in [Export a client certificate](#clientexport).</span></span>

## <a name="create-and-install-client-certificates"></a><span data-ttu-id="3bdfe-140">Criar e instalar certificados de cliente</span><span class="sxs-lookup"><span data-stu-id="3bdfe-140">Create and install client certificates</span></span>

<span data-ttu-id="3bdfe-141">Não instale o certificado autoassinado diretamente no computador cliente.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-141">You don't install the self-signed certificate directly on the client computer.</span></span> <span data-ttu-id="3bdfe-142">Você precisa gerar um certificado de cliente do certificado autoassinado.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-142">You need to generate a client certificate from the self-signed certificate.</span></span> <span data-ttu-id="3bdfe-143">Em seguida, você exporta e instala o certificado de cliente no computador cliente.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-143">You then export and install the client certificate to the client computer.</span></span> <span data-ttu-id="3bdfe-144">Essas etapas não são específicas ao modelo de implantação.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-144">The following steps are not deployment-model specific.</span></span> <span data-ttu-id="3bdfe-145">Elas são válidas tanto para o Gerenciador de Recursos quanto para o clássico.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-145">They are valid for both Resource Manager and classic.</span></span>

### <span data-ttu-id="3bdfe-146"><a name="clientcert"></a>Gerar um certificado do cliente</span><span class="sxs-lookup"><span data-stu-id="3bdfe-146"><a name="clientcert"></a>Generate a client certificate</span></span>

<span data-ttu-id="3bdfe-147">Cada computador cliente que se conecta a uma rede virtual usando ponto a site deve ter um certificado do cliente instalado.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-147">Each client computer that connects to a VNet using Point-to-Site must have a client certificate installed.</span></span> <span data-ttu-id="3bdfe-148">Você gera um certificado do cliente com base no certificado raiz autoassinado e, em seguida, a exporta e instala o certificado do cliente.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-148">You generate a client certificate from the self-signed root certificate, and then export and install the client certificate.</span></span> <span data-ttu-id="3bdfe-149">Se o certificado do cliente não estiver instalado, a autenticação falhará.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-149">If the client certificate is not installed, authentication fails.</span></span> 

<span data-ttu-id="3bdfe-150">As etapas abaixo lhe guiarão pela geração de um certificado do cliente por meio de um certificado raiz autoassinado.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-150">The following steps walk you through generating a client certificate from a self-signed root certificate.</span></span> <span data-ttu-id="3bdfe-151">Você pode gerar vários certificados de cliente a partir do mesmo certificado raiz.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-151">You may generate multiple client certificates from the same root certificate.</span></span> <span data-ttu-id="3bdfe-152">Quando você gerar certificados do cliente usando as etapas a seguir, o certificado do cliente será instalado automaticamente no computador que você tiver usado para gerar o certificado.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-152">When you generate client certificates using the steps below, the client certificate is automatically installed on the computer that you used to generate the certificate.</span></span> <span data-ttu-id="3bdfe-153">Se você quiser instalar um certificado do cliente em outro computador cliente, você poderá exportar o certificado.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-153">If you want to install a client certificate on another client computer, you can export the certificate.</span></span>
 
1. <span data-ttu-id="3bdfe-154">No mesmo computador usado para criar o certificado autoassinado, abra um prompt de comando como administrador.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-154">On the same computer that you used to create the self-signed certificate, open a command prompt as administrator.</span></span>
2. <span data-ttu-id="3bdfe-155">Modifique e execute o exemplo para gerar um certificado de cliente.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-155">Modify and run the sample to generate a client certificate.</span></span>
  * <span data-ttu-id="3bdfe-156">Altere *“P2SRootCert”* para o nome da raiz autoassinada com base na qual você está gerando o certificado do cliente.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-156">Change *"P2SRootCert"* to the name of the self-signed root that you are generating the client certificate from.</span></span> <span data-ttu-id="3bdfe-157">Verifique se você está usando o nome do certificado raiz, que é equivalente ao valor 'CN=' que você especificou quando criou a raiz autoassinada.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-157">Make sure you are using the name of the root certificate, which is whatever the 'CN=' value was that you specified when you created the self-signed root.</span></span>
  * <span data-ttu-id="3bdfe-158">Altere *P2SChildCert* para o nome que você deseja fornecer a um certificado do cliente gerado.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-158">Change *P2SChildCert* to the name you want to generate a client certificate to be.</span></span>

  <span data-ttu-id="3bdfe-159">Se você executar o exemplo a seguir sem modificá-lo, o resultado será um certificado do cliente chamado P2SChildcert em seu repositório de certificados Personal que foi gerado com base no certificado raiz P2SRootCert.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-159">If you run the following example without modifying it, the result is a client certificate named P2SChildcert in your Personal certificate store that was generated from root certificate P2SRootCert.</span></span>

  ```cmd
  makecert.exe -n "CN=P2SChildCert" -pe -sky exchange -m 96 -ss My -in "P2SRootCert" -is my -a sha256
  ```

### <span data-ttu-id="3bdfe-160"><a name="clientexport"></a>Exportar um certificado do cliente</span><span class="sxs-lookup"><span data-stu-id="3bdfe-160"><a name="clientexport"></a>Export a client certificate</span></span>

[!INCLUDE [Export client certificate](../../includes/vpn-gateway-certificates-export-client-cert-include.md)]

### <span data-ttu-id="3bdfe-161"><a name="install"></a>Instalar um certificado do cliente exportado</span><span class="sxs-lookup"><span data-stu-id="3bdfe-161"><a name="install"></a>Install an exported client certificate</span></span>

[!INCLUDE [Install client certificate](../../includes/vpn-gateway-certificates-install-client-cert-include.md)]

## <a name="next-steps"></a><span data-ttu-id="3bdfe-162">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="3bdfe-162">Next steps</span></span>

<span data-ttu-id="3bdfe-163">Continue com a configuração de Ponto a Site.</span><span class="sxs-lookup"><span data-stu-id="3bdfe-163">Continue with your Point-to-Site configuration.</span></span> 

* <span data-ttu-id="3bdfe-164">Para as etapas do modelo de implantação do **Resource Manager**, veja [Configurar uma conexão Ponto a Site a uma VNet](vpn-gateway-howto-point-to-site-resource-manager-portal.md).</span><span class="sxs-lookup"><span data-stu-id="3bdfe-164">For **Resource Manager** deployment model steps, see [Configure a Point-to-Site connection to a VNet](vpn-gateway-howto-point-to-site-resource-manager-portal.md).</span></span>
* <span data-ttu-id="3bdfe-165">Para as etapas do modelo de implantação **clássico**, veja [Configurar uma conexão VPN Ponto a Site para uma VNet (clássico)](vpn-gateway-howto-point-to-site-classic-azure-portal.md).</span><span class="sxs-lookup"><span data-stu-id="3bdfe-165">For **classic** deployment model steps, see [Configure a Point-to-Site VPN connection to a VNet (classic)](vpn-gateway-howto-point-to-site-classic-azure-portal.md).</span></span>
