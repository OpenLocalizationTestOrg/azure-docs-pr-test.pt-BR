---
title: Como solucionar problemas do Cache Redis do Azure | Microsoft Docs
description: Saiba como solucionar problemas comuns do Cache Redis do Azure.
services: redis-cache
documentationcenter: 
author: steved0x
manager: douge
editor: 
ms.assetid: 928b9b9c-d64f-4252-884f-af7ba8309af6
ms.service: cache
ms.workload: tbd
ms.tgt_pltfrm: cache-redis
ms.devlang: na
ms.topic: article
ms.date: 01/06/2017
ms.author: sdanie
ms.openlocfilehash: 2e9d1b644f1e80c7d916a261a6c47fcc11a1ffe0
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="how-to-troubleshoot-azure-redis-cache"></a><span data-ttu-id="731e0-103">Como solucionar problemas do Cache Redis do Azure</span><span class="sxs-lookup"><span data-stu-id="731e0-103">How to troubleshoot Azure Redis Cache</span></span>
<span data-ttu-id="731e0-104">Este artigo fornece orientações para solucionar as seguintes categorias de problemas do Cache Redis do Azure.</span><span class="sxs-lookup"><span data-stu-id="731e0-104">This article provides guidance for troubleshooting the following categories of Azure Redis Cache issues.</span></span>

* <span data-ttu-id="731e0-105">[Solução de problemas do cliente](#client-side-troubleshooting) - esta seção fornece diretrizes sobre como identificar e resolver problemas causados pelo aplicativo que se conecta ao Cache Redis do Azure.</span><span class="sxs-lookup"><span data-stu-id="731e0-105">[Client side troubleshooting](#client-side-troubleshooting) - This section provides guidelines on identifying and resolving issues caused by the application connecting to Azure Redis Cache.</span></span>
* <span data-ttu-id="731e0-106">[Solução de problemas do servidor](#server-side-troubleshooting) - esta seção fornece diretrizes sobre como identificar e resolver problemas causados pelo servidor do Cache Redis do Azure.</span><span class="sxs-lookup"><span data-stu-id="731e0-106">[Server side troubleshooting](#server-side-troubleshooting) - This section provides guidelines on identifying and resolving issues caused on the Azure Redis Cache server side.</span></span>
* <span data-ttu-id="731e0-107">[Exceções de tempo limite do StackExchange.Redis](#stackexchangeredis-timeout-exceptions) - esta seção fornece informações sobre como solucionar problemas ao usar o cliente StackExchange.Redis.</span><span class="sxs-lookup"><span data-stu-id="731e0-107">[StackExchange.Redis timeout exceptions](#stackexchangeredis-timeout-exceptions) - This section provides information on troubleshooting issues when using the StackExchange.Redis client.</span></span>

> [!NOTE]
> <span data-ttu-id="731e0-108">Várias das etapas de solução de problemas neste guia incluem instruções para executar comandos do Redis e monitorar diversas métricas de desempenho.</span><span class="sxs-lookup"><span data-stu-id="731e0-108">Several of the troubleshooting steps in this guide include instructions to run Redis commands and monitor various performance metrics.</span></span> <span data-ttu-id="731e0-109">Para obter mais informações, consulte os artigos na seção [Informações adicionais](#additional-information) .</span><span class="sxs-lookup"><span data-stu-id="731e0-109">For more information and instructions, see the articles in the [Additional information](#additional-information) section.</span></span>
> 
> 

## <a name="client-side-troubleshooting"></a><span data-ttu-id="731e0-110">Solução de problemas do cliente</span><span class="sxs-lookup"><span data-stu-id="731e0-110">Client side troubleshooting</span></span>
<span data-ttu-id="731e0-111">Esta seção aborda a solução de problemas que ocorrem devido a alguma condição do aplicativo cliente.</span><span class="sxs-lookup"><span data-stu-id="731e0-111">This section discusses troubleshooting issues that occur because of a condition on the client application.</span></span>

* [<span data-ttu-id="731e0-112">Demanda de memória do cliente</span><span class="sxs-lookup"><span data-stu-id="731e0-112">Memory pressure on the client</span></span>](#memory-pressure-on-the-client)
* [<span data-ttu-id="731e0-113">Intermitência de tráfego</span><span class="sxs-lookup"><span data-stu-id="731e0-113">Burst of traffic</span></span>](#burst-of-traffic)
* [<span data-ttu-id="731e0-114">Alto nível de uso da CPU do cliente</span><span class="sxs-lookup"><span data-stu-id="731e0-114">High client CPU usage</span></span>](#high-client-cpu-usage)
* [<span data-ttu-id="731e0-115">Largura de banda do cliente ultrapassada</span><span class="sxs-lookup"><span data-stu-id="731e0-115">Client Side Bandwidth Exceeded</span></span>](#client-side-bandwidth-exceeded)
* [<span data-ttu-id="731e0-116">Solicitação/resposta grande</span><span class="sxs-lookup"><span data-stu-id="731e0-116">Large Request/Response Size</span></span>](#large-requestresponse-size)
* [<span data-ttu-id="731e0-117">O que aconteceu com meus dados no Redis?</span><span class="sxs-lookup"><span data-stu-id="731e0-117">What happened to my data in Redis?</span></span>](#what-happened-to-my-data-in-redis)

### <a name="memory-pressure-on-the-client"></a><span data-ttu-id="731e0-118">Demanda de memória do cliente</span><span class="sxs-lookup"><span data-stu-id="731e0-118">Memory pressure on the client</span></span>
#### <a name="problem"></a><span data-ttu-id="731e0-119">Problema</span><span class="sxs-lookup"><span data-stu-id="731e0-119">Problem</span></span>
<span data-ttu-id="731e0-120">A demanda de memória no computador cliente leva a todo tipo de problemas de desempenho, que podem atrasar o processamento de dados que foram enviados pela instância do Redis sem nenhum atraso.</span><span class="sxs-lookup"><span data-stu-id="731e0-120">Memory pressure on the client machine leads to all kinds of performance problems that can delay processing of data that was sent by the Redis instance without any delay.</span></span> <span data-ttu-id="731e0-121">Quando há grande demanda de memória, o sistema normalmente precisar paginar dados da memória física para a memória virtual que está no disco.</span><span class="sxs-lookup"><span data-stu-id="731e0-121">When memory pressure hits, the system typically has to page data from physical memory to virtual memory which is on disk.</span></span> <span data-ttu-id="731e0-122">Esse tipo de *falha de página* faz com que o sistema fique significativamente mais lento.</span><span class="sxs-lookup"><span data-stu-id="731e0-122">This *page faulting* causes the system to slow down significantly.</span></span>

#### <a name="measurement"></a><span data-ttu-id="731e0-123">Medida</span><span class="sxs-lookup"><span data-stu-id="731e0-123">Measurement</span></span>
1. <span data-ttu-id="731e0-124">Monitorar o uso de memória no computador para certificar-se de que ele não ultrapasse a memória disponível.</span><span class="sxs-lookup"><span data-stu-id="731e0-124">Monitor memory usage on machine to make sure that it does not exceed available memory.</span></span> 
2. <span data-ttu-id="731e0-125">Monitorar o contador de desempenho `Page Faults/Sec` .</span><span class="sxs-lookup"><span data-stu-id="731e0-125">Monitor the `Page Faults/Sec` performance counter.</span></span> <span data-ttu-id="731e0-126">A maioria dos sistemas terá algumas falhas de página até mesmo durante a operação normal, portanto, fique atento a picos no contador de desempenho de falhas página que correspondem aos tempos limite.</span><span class="sxs-lookup"><span data-stu-id="731e0-126">Most systems will have some page faults even during normal operation, so watch for spikes in this page faults performance counter which correspond with timeouts.</span></span>

#### <a name="resolution"></a><span data-ttu-id="731e0-127">Resolução</span><span class="sxs-lookup"><span data-stu-id="731e0-127">Resolution</span></span>
<span data-ttu-id="731e0-128">Atualizar o cliente para uma VM cliente maior com mais memória ou analisar seus padrões de uso de memória para reduzir o consumo de memória.</span><span class="sxs-lookup"><span data-stu-id="731e0-128">Upgrade your client to a larger client VM size with more memory or dig into your memory usage patterns to reduce memory consuption.</span></span>

### <a name="burst-of-traffic"></a><span data-ttu-id="731e0-129">Intermitência de tráfego</span><span class="sxs-lookup"><span data-stu-id="731e0-129">Burst of traffic</span></span>
#### <a name="problem"></a><span data-ttu-id="731e0-130">Problema</span><span class="sxs-lookup"><span data-stu-id="731e0-130">Problem</span></span>
<span data-ttu-id="731e0-131">A intermitência de tráfego, combinada com configurações de `ThreadPool` ruins, podem resultar em atrasos no processamento de dados que já foram enviados pelo servidor Redis, mas ainda não foram consumidos no lado do cliente.</span><span class="sxs-lookup"><span data-stu-id="731e0-131">Bursts of traffic combined with poor `ThreadPool` settings can result in delays in processing data already sent by the Redis Server but not yet consumed on the client side.</span></span>

#### <a name="measurement"></a><span data-ttu-id="731e0-132">Medida</span><span class="sxs-lookup"><span data-stu-id="731e0-132">Measurement</span></span>
<span data-ttu-id="731e0-133">Monitor como suas estatísticas de `ThreadPool` mudam ao longo do tempo usando um código [como este](https://github.com/JonCole/SampleCode/blob/master/ThreadPoolMonitor/ThreadPoolLogger.cs).</span><span class="sxs-lookup"><span data-stu-id="731e0-133">Monitor how your `ThreadPool` statistics change over time using code [like this](https://github.com/JonCole/SampleCode/blob/master/ThreadPoolMonitor/ThreadPoolLogger.cs).</span></span> <span data-ttu-id="731e0-134">Você também pode examinar a mensagem `TimeoutException` do StackExchange.Redis.</span><span class="sxs-lookup"><span data-stu-id="731e0-134">You can also look at the `TimeoutException` message from StackExchange.Redis.</span></span> <span data-ttu-id="731e0-135">Veja um exemplo:</span><span class="sxs-lookup"><span data-stu-id="731e0-135">Here is an example :</span></span>

    System.TimeoutException: Timeout performing EVAL, inst: 8, mgr: Inactive, queue: 0, qu: 0, qs: 0, qc: 0, wr: 0, wq: 0, in: 64221, ar: 0, 
    IOCP: (Busy=6,Free=999,Min=2,Max=1000), WORKER: (Busy=7,Free=8184,Min=2,Max=8191)

<span data-ttu-id="731e0-136">Na mensagem acima, há várias questões interessantes:</span><span class="sxs-lookup"><span data-stu-id="731e0-136">In the above message, there are several issues that are interesting:</span></span>

1. <span data-ttu-id="731e0-137">Observe que, na seção `IOCP` e na seção `WORKER`, você tem um valor `Busy` que é maior que o valor `Min`.</span><span class="sxs-lookup"><span data-stu-id="731e0-137">Notice that in the `IOCP` section and the `WORKER` section you have a `Busy` value that is greater than the `Min` value.</span></span> <span data-ttu-id="731e0-138">Isso significa que suas configurações de `ThreadPool` precisam de ajuste.</span><span class="sxs-lookup"><span data-stu-id="731e0-138">This means that your `ThreadPool` settings need adjusting.</span></span>
2. <span data-ttu-id="731e0-139">Você também pode ver `in: 64221`.</span><span class="sxs-lookup"><span data-stu-id="731e0-139">You can also see `in: 64221`.</span></span> <span data-ttu-id="731e0-140">Isso indica que 64211 bytes foram recebidos na camada de soquete de kernel, mas ainda não foram lidos pelo aplicativo (por exemplo, StackExchange.Redis).</span><span class="sxs-lookup"><span data-stu-id="731e0-140">This indicates that 64211 bytes have been received at the kernel socket layer but haven't yet been read by the application (e.g. StackExchange.Redis).</span></span> <span data-ttu-id="731e0-141">Normalmente, isso significa que seu aplicativo não está lendo dados da rede na velocidade em que o servidor os está enviando para você.</span><span class="sxs-lookup"><span data-stu-id="731e0-141">This typically means that your application isn't reading data from the network as quickly as the server is sending it to you.</span></span>

#### <a name="resolution"></a><span data-ttu-id="731e0-142">Resolução</span><span class="sxs-lookup"><span data-stu-id="731e0-142">Resolution</span></span>
<span data-ttu-id="731e0-143">Configurar suas [Configurações de ThreadPool](https://gist.github.com/JonCole/e65411214030f0d823cb) para certificar-se de que o pool de threads será escalado verticalmente rapidamente em cenários de intermitência.</span><span class="sxs-lookup"><span data-stu-id="731e0-143">Configure your [ThreadPool Settings](https://gist.github.com/JonCole/e65411214030f0d823cb) to make sure that your thread pool will scale up quickly under burst scenarios.</span></span>

### <a name="high-client-cpu-usage"></a><span data-ttu-id="731e0-144">Alto nível de uso da CPU do cliente</span><span class="sxs-lookup"><span data-stu-id="731e0-144">High client CPU usage</span></span>
#### <a name="problem"></a><span data-ttu-id="731e0-145">Problema</span><span class="sxs-lookup"><span data-stu-id="731e0-145">Problem</span></span>
<span data-ttu-id="731e0-146">Um alto nível de uso da CPU do cliente é uma indicação de que o sistema não é capaz de acompanhar o trabalho que foi solicitado a executar.</span><span class="sxs-lookup"><span data-stu-id="731e0-146">High CPU usage on the client is an indication that the system cannot keep up with the work that it has been asked to perform.</span></span> <span data-ttu-id="731e0-147">Isso significa que o cliente pode deixar de processar uma resposta do Redis de forma oportuna, embora o Redis tenha enviado a resposta muito rapidamente.</span><span class="sxs-lookup"><span data-stu-id="731e0-147">This means that the client may fail to process a response from Redis in a timely fashion even though Redis sent the response very quickly.</span></span>

#### <a name="measurement"></a><span data-ttu-id="731e0-148">Medida</span><span class="sxs-lookup"><span data-stu-id="731e0-148">Measurement</span></span>
<span data-ttu-id="731e0-149">Monitorar o uso de CPU geral do sistema por meio do Portal do Azure ou do contador de desempenho associado.</span><span class="sxs-lookup"><span data-stu-id="731e0-149">Monitor the System Wide CPU usage through the Azure Portal or through the associated performance counter.</span></span> <span data-ttu-id="731e0-150">Tenha cuidado para não monitorar o uso de CPU do *processo* , porque um único processo pode representar pouco uso da CPU enquanto o uso de CPU do sistema geral pode ser alto.</span><span class="sxs-lookup"><span data-stu-id="731e0-150">Be careful not to monitor *process* CPU because a single process can have low CPU usage at the same time that overall system CPU can be high.</span></span> <span data-ttu-id="731e0-151">Fique atento a picos de uso de CPU que correspondem aos tempos limite.</span><span class="sxs-lookup"><span data-stu-id="731e0-151">Watch for spikes in CPU usage that correspond with timeouts.</span></span> <span data-ttu-id="731e0-152">Como resultado do alto nível de uso da CPU, você também poderá ver valores altos de `in: XXX` em mensagens de erro `TimeoutException`, conforme descrito na seção [Intermitência de tráfego](#burst-of-traffic).</span><span class="sxs-lookup"><span data-stu-id="731e0-152">As a result of high CPU, you may also see high `in: XXX` values in `TimeoutException` error messages as described in the [Burst of traffic](#burst-of-traffic) section.</span></span>

> [!NOTE]
> <span data-ttu-id="731e0-153">O StackExchange 1.1.603 e versões posteriores incluem a métrica `local-cpu` em mensagens de erro `TimeoutException`.</span><span class="sxs-lookup"><span data-stu-id="731e0-153">StackExchange.Redis 1.1.603 and later includes the `local-cpu` metric in `TimeoutException` error messages.</span></span> <span data-ttu-id="731e0-154">Certifique-se de estar usando a versão mais recente do [Pacote NuGet do StackExchange.Redis](https://www.nuget.org/packages/StackExchange.Redis/).</span><span class="sxs-lookup"><span data-stu-id="731e0-154">Ensure you using the latest version of the [StackExchange.Redis NuGet package](https://www.nuget.org/packages/StackExchange.Redis/).</span></span> <span data-ttu-id="731e0-155">Constantemente são corrigidos bugs no código para torná-lo mais robusto com relação a tempos limite, de modo que ter a versão mais recente é importante.</span><span class="sxs-lookup"><span data-stu-id="731e0-155">There are bugs constantly being fixed in the code to make it more robust to timeouts so having the latest version is important.</span></span>
> 
> 

#### <a name="resolution"></a><span data-ttu-id="731e0-156">Resolução</span><span class="sxs-lookup"><span data-stu-id="731e0-156">Resolution</span></span>
<span data-ttu-id="731e0-157">Atualizar para uma VM maior, com mais capacidade de CPU, ou investigar o que está causando os picos de CPU.</span><span class="sxs-lookup"><span data-stu-id="731e0-157">Upgrade to a larger VM size with more CPU capacity or investigate what is causing CPU spikes.</span></span> 

### <a name="client-side-bandwidth-exceeded"></a><span data-ttu-id="731e0-158">Largura de banda do cliente ultrapassada</span><span class="sxs-lookup"><span data-stu-id="731e0-158">Client side bandwidth exceeded</span></span>
#### <a name="problem"></a><span data-ttu-id="731e0-159">Problema</span><span class="sxs-lookup"><span data-stu-id="731e0-159">Problem</span></span>
<span data-ttu-id="731e0-160">Computadores cliente com tamanhos diferentes têm limitações quanto à largura de banda de rede que têm disponível.</span><span class="sxs-lookup"><span data-stu-id="731e0-160">Different sized client machines have limitations on how much network bandwidth they have available.</span></span> <span data-ttu-id="731e0-161">Se o cliente ultrapassar a largura de banda disponível, os dados não serão processados no lado do cliente tão rapidamente quanto o servidor os envia.</span><span class="sxs-lookup"><span data-stu-id="731e0-161">If the client exceeds the available bandwidth, then data will not be processed on the client side as quickly as the server is sending it.</span></span> <span data-ttu-id="731e0-162">Isso pode levar a tempos limite.</span><span class="sxs-lookup"><span data-stu-id="731e0-162">This can lead to timeouts.</span></span>

#### <a name="measurement"></a><span data-ttu-id="731e0-163">Medida</span><span class="sxs-lookup"><span data-stu-id="731e0-163">Measurement</span></span>
<span data-ttu-id="731e0-164">Monitorar como seu uso de largura de banda muda ao longo do tempo usando um código [como este](https://github.com/JonCole/SampleCode/blob/master/BandWidthMonitor/BandwidthLogger.cs).</span><span class="sxs-lookup"><span data-stu-id="731e0-164">Monitor how your Bandwidth usage change over time using code [like this](https://github.com/JonCole/SampleCode/blob/master/BandWidthMonitor/BandwidthLogger.cs).</span></span> <span data-ttu-id="731e0-165">Observe que esse código pode não ser executado com êxito em alguns ambientes com permissões restritas (como sites do Azure).</span><span class="sxs-lookup"><span data-stu-id="731e0-165">Note that this code may not run successfully in some environments with restricted permissions (like Azure web sites).</span></span>

#### <a name="resolution"></a><span data-ttu-id="731e0-166">Resolução</span><span class="sxs-lookup"><span data-stu-id="731e0-166">Resolution</span></span>
<span data-ttu-id="731e0-167">Aumentar o tamanho da VM do cliente ou reduzir o consumo de largura de banda da rede.</span><span class="sxs-lookup"><span data-stu-id="731e0-167">Increase Client VM size or reduce network bandwidth consumption.</span></span>

### <a name="large-requestresponse-size"></a><span data-ttu-id="731e0-168">Solicitação/resposta grande</span><span class="sxs-lookup"><span data-stu-id="731e0-168">Large Request/Response Size</span></span>
#### <a name="problem"></a><span data-ttu-id="731e0-169">Problema</span><span class="sxs-lookup"><span data-stu-id="731e0-169">Problem</span></span>
<span data-ttu-id="731e0-170">Uma solicitação/resposta grande pode causar tempos limite.</span><span class="sxs-lookup"><span data-stu-id="731e0-170">A large request/response can cause timeouts.</span></span> <span data-ttu-id="731e0-171">Por exemplo, suponha que o valor do tempo limite configurado no seu cliente seja de um segundo.</span><span class="sxs-lookup"><span data-stu-id="731e0-171">As an example, Suppose your timeout value configured on your client is 1 second.</span></span> <span data-ttu-id="731e0-172">Seu aplicativo solicita duas chaves (por exemplo, "A" e "B") ao mesmo tempo (usando a mesma conexão de rede física).</span><span class="sxs-lookup"><span data-stu-id="731e0-172">Your application requests two keys (e.g. 'A' and 'B') at the same time (using the same physical network connection).</span></span> <span data-ttu-id="731e0-173">A maioria dos clientes dá suporte ao "pipelining" de solicitações, de modo que as duas solicitações, "A" e "B", sejam transmitidas ao servidor uma após a outra sem esperar pelas respostas.</span><span class="sxs-lookup"><span data-stu-id="731e0-173">Most clients support "Pipelining" of requests, such that both requests 'A' and 'B' are sent on the wire to the server one after the other without waiting for the responses.</span></span> <span data-ttu-id="731e0-174">O servidor enviará as respostas na mesma ordem.</span><span class="sxs-lookup"><span data-stu-id="731e0-174">The server will send the responses back in the same order.</span></span> <span data-ttu-id="731e0-175">Se a resposta "A" for grande o suficiente, ela poderá consumir a maior parte do tempo limite das solicitações subsequentes.</span><span class="sxs-lookup"><span data-stu-id="731e0-175">If response 'A' is large enough it can eat up most of the timeout for subsequent requests.</span></span> 

<span data-ttu-id="731e0-176">O exemplo a seguir demonstra esse cenário.</span><span class="sxs-lookup"><span data-stu-id="731e0-176">The following example demonstrates this scenario.</span></span> <span data-ttu-id="731e0-177">No cenário, as solicitações "A" e "B" são enviadas rapidamente, o servidor começa a enviar respostas "A" e "B" rapidamente, mas, devido ao tempo para a transferência de dados, "B" fica preso atrás da outra solicitação e atinge o tempo limite, embora o servidor tenha respondido rapidamente.</span><span class="sxs-lookup"><span data-stu-id="731e0-177">In this scenario, Request 'A' and 'B' are sent quickly, the server starts sending responses 'A' and 'B' quickly, but because of data transfer times, 'B' get stuck behind the other request and times out even though the server responded quickly.</span></span>

    |-------- 1 Second Timeout (A)----------|
    |-Request A-|
         |-------- 1 Second Timeout (B) ----------|
         |-Request B-|
                |- Read Response A --------|
                                           |- Read Response B-| (**TIMEOUT**)



#### <a name="measurement"></a><span data-ttu-id="731e0-178">Medida</span><span class="sxs-lookup"><span data-stu-id="731e0-178">Measurement</span></span>
<span data-ttu-id="731e0-179">Isso é difícil de medir.</span><span class="sxs-lookup"><span data-stu-id="731e0-179">This is a difficult one to measure.</span></span> <span data-ttu-id="731e0-180">Basicamente, você precisa instrumentar o código do cliente para monitorar grandes solicitações e respostas.</span><span class="sxs-lookup"><span data-stu-id="731e0-180">You basically have to instrument your client code to track large requests and responses.</span></span> 

#### <a name="resolution"></a><span data-ttu-id="731e0-181">Resolução</span><span class="sxs-lookup"><span data-stu-id="731e0-181">Resolution</span></span>
1. <span data-ttu-id="731e0-182">O Redis é otimizado para um grande número de valores pequenos, em vez de alguns valores grandes.</span><span class="sxs-lookup"><span data-stu-id="731e0-182">Redis is optimized for a large number of small values, rather than a few large values.</span></span> <span data-ttu-id="731e0-183">A solução preferida é dividir seus dados em valores menores relacionados.</span><span class="sxs-lookup"><span data-stu-id="731e0-183">The preferred solution is to break up your data into related smaller values.</span></span> <span data-ttu-id="731e0-184">Consulte a postagem [What is the ideal value size range for redis? Is 100KB too large? (Qual é o intervalo de tamanho ideal para o Redis? 100 KB é muito?)](https://groups.google.com/forum/#!searchin/redis-db/size/redis-db/n7aa2A4DZDs/3OeEPHSQBAAJ) para obter detalhes sobre por que valores menores são recomendados.</span><span class="sxs-lookup"><span data-stu-id="731e0-184">See the [What is the ideal value size range for redis? Is 100KB too large?](https://groups.google.com/forum/#!searchin/redis-db/size/redis-db/n7aa2A4DZDs/3OeEPHSQBAAJ) post for details around why smaller values are recommended.</span></span>
2. <span data-ttu-id="731e0-185">Aumentar o tamanho da VM (para o cliente e o servidor do Cache Redis) para obter mais recursos de largura de banda, reduzindo os tempos de transferência de dados para respostas maiores.</span><span class="sxs-lookup"><span data-stu-id="731e0-185">Increase the size of your VM (for client and Redis Cache Server), to get higher bandwidth capabilities, reducing data transfer times for larger responses.</span></span> <span data-ttu-id="731e0-186">Observe que obter mais largura de banda apenas no servidor ou apenas no cliente pode não ser suficiente.</span><span class="sxs-lookup"><span data-stu-id="731e0-186">Note that getting more bandwidth on just the server or just on the client may not be enough.</span></span> <span data-ttu-id="731e0-187">Meça o uso de largura de banda e compare-o com os recursos do tamanho da VM que você tem no momento.</span><span class="sxs-lookup"><span data-stu-id="731e0-187">Measure your bandwidth usage and compare it to the capabilities of the size of VM you currently have.</span></span>
3. <span data-ttu-id="731e0-188">Aumentar o número de objetos `ConnectionMultiplexer` que você usa e fazer round robin das solicitações através de diferentes conexões.</span><span class="sxs-lookup"><span data-stu-id="731e0-188">Increase the number of `ConnectionMultiplexer` objects you use and round-robin requests over different connections.</span></span>

### <a name="what-happened-to-my-data-in-redis"></a><span data-ttu-id="731e0-189">O que aconteceu com meus dados no Redis?</span><span class="sxs-lookup"><span data-stu-id="731e0-189">What happened to my data in Redis?</span></span>
#### <a name="problem"></a><span data-ttu-id="731e0-190">Problema</span><span class="sxs-lookup"><span data-stu-id="731e0-190">Problem</span></span>
<span data-ttu-id="731e0-191">Eu esperava que certos dados estivessem em minha instância do Cache Redis do Azure, mas eles não parecem estar lá.</span><span class="sxs-lookup"><span data-stu-id="731e0-191">I expected for certain data to be in my Azure Redis Cache instance but it didn't seem to be there.</span></span>

#### <a name="resolution"></a><span data-ttu-id="731e0-192">Resolução</span><span class="sxs-lookup"><span data-stu-id="731e0-192">Resolution</span></span>
<span data-ttu-id="731e0-193">Consulte [What happened to my data in Redis? (O que aconteceu com meu dados no Redis?)](https://gist.github.com/JonCole/b6354d92a2d51c141490f10142884ea4#file-whathappenedtomydatainredis-md) para ver as possíveis causas e resoluções.</span><span class="sxs-lookup"><span data-stu-id="731e0-193">See [What happened to my data in Redis?](https://gist.github.com/JonCole/b6354d92a2d51c141490f10142884ea4#file-whathappenedtomydatainredis-md) for possible causes and resolutions.</span></span>

## <a name="server-side-troubleshooting"></a><span data-ttu-id="731e0-194">Solução de problemas do servidor</span><span class="sxs-lookup"><span data-stu-id="731e0-194">Server side troubleshooting</span></span>
<span data-ttu-id="731e0-195">Esta seção aborda a solução de problemas que ocorrem devido a alguma condição do servidor de cache.</span><span class="sxs-lookup"><span data-stu-id="731e0-195">This section discusses troubleshooting issues that occur because of a condition on the cache server.</span></span>

* [<span data-ttu-id="731e0-196">Demanda de memória do servidor</span><span class="sxs-lookup"><span data-stu-id="731e0-196">Memory Pressure on the server</span></span>](#memory-pressure-on-the-server)
* [<span data-ttu-id="731e0-197">Alto nível de uso da CPU/carga de servidor</span><span class="sxs-lookup"><span data-stu-id="731e0-197">High CPU usage / Server Load</span></span>](#high-cpu-usage-server-load)
* [<span data-ttu-id="731e0-198">Largura de banda do servidor ultrapassada</span><span class="sxs-lookup"><span data-stu-id="731e0-198">Server Side Bandwidth Exceeded</span></span>](#server-side-bandwidth-exceeded)

### <a name="memory-pressure-on-the-server"></a><span data-ttu-id="731e0-199">Demanda de memória do servidor</span><span class="sxs-lookup"><span data-stu-id="731e0-199">Memory Pressure on the server</span></span>
#### <a name="problem"></a><span data-ttu-id="731e0-200">Problema</span><span class="sxs-lookup"><span data-stu-id="731e0-200">Problem</span></span>
<span data-ttu-id="731e0-201">Uma grande demanda da memória do servidor acarreta todo tipo de problemas de desempenho, que podem atrasar o processamento de solicitações.</span><span class="sxs-lookup"><span data-stu-id="731e0-201">Memory pressure on the server side leads to all kinds of performance problems that can delay processing of requests.</span></span> <span data-ttu-id="731e0-202">Quando há grande demanda de memória, o sistema normalmente precisar paginar dados da memória física para a memória virtual que está no disco.</span><span class="sxs-lookup"><span data-stu-id="731e0-202">When memory pressure hits, the system typically has to page data from physical memory to virtual memory which is on disk.</span></span> <span data-ttu-id="731e0-203">Esse tipo de *falha de página* faz com que o sistema fique significativamente mais lento.</span><span class="sxs-lookup"><span data-stu-id="731e0-203">This *page faulting* causes the system to slow down significantly.</span></span> <span data-ttu-id="731e0-204">Há diversas causas possíveis para essa demanda de memória:</span><span class="sxs-lookup"><span data-stu-id="731e0-204">There are several possible causes of this memory pressure:</span></span> 

1. <span data-ttu-id="731e0-205">Você preencheu toda a capacidade do cache com dados.</span><span class="sxs-lookup"><span data-stu-id="731e0-205">You have filled the cache to full capacity with data.</span></span> 
2. <span data-ttu-id="731e0-206">O Redis está passando por uma grande fragmentação da memória, que frequentemente causada pelo armazenamento de objetos grandes (o Redis é otimizado para objetos pequenos. Consulte a postagem [What is the ideal value size range for redis? Is 100KB too large?(Qual é o intervalo de tamanho ideal para o Redis? 100 KB é muito?)](https://groups.google.com/forum/#!searchin/redis-db/size/redis-db/n7aa2A4DZDs/3OeEPHSQBAAJ) para obter mais detalhes).</span><span class="sxs-lookup"><span data-stu-id="731e0-206">Redis is seeing high memory fragmentation - most often caused by storing large objects (Redis is optimized for a small objects - See the [What is the ideal value size range for redis? Is 100KB too large?](https://groups.google.com/forum/#!searchin/redis-db/size/redis-db/n7aa2A4DZDs/3OeEPHSQBAAJ) post for details).</span></span> 

#### <a name="measurement"></a><span data-ttu-id="731e0-207">Medida</span><span class="sxs-lookup"><span data-stu-id="731e0-207">Measurement</span></span>
<span data-ttu-id="731e0-208">O Redis expõe duas métricas que podem ajudá-lo a identificar esse problema.</span><span class="sxs-lookup"><span data-stu-id="731e0-208">Redis exposes two metrics that can help you identify this issue.</span></span> <span data-ttu-id="731e0-209">A primeira é `used_memory` e a outra é `used_memory_rss`.</span><span class="sxs-lookup"><span data-stu-id="731e0-209">The first is `used_memory` and the other is `used_memory_rss`.</span></span> <span data-ttu-id="731e0-210">[Essas métricas](cache-how-to-monitor.md#available-metrics-and-reporting-intervals) estão disponíveis no Portal do Azure ou por meio do comando [INFO do Redis](http://redis.io/commands/info).</span><span class="sxs-lookup"><span data-stu-id="731e0-210">[These metrics](cache-how-to-monitor.md#available-metrics-and-reporting-intervals) are available in the Azure Portal or through the [Redis INFO](http://redis.io/commands/info) command.</span></span>

#### <a name="resolution"></a><span data-ttu-id="731e0-211">Resolução</span><span class="sxs-lookup"><span data-stu-id="731e0-211">Resolution</span></span>
<span data-ttu-id="731e0-212">Há várias alterações possíveis que você pode fazer para ajudar a manter a integridade do uso de memória:</span><span class="sxs-lookup"><span data-stu-id="731e0-212">There are several possible changes that you can make to help keep memory usage healthy:</span></span>

1. <span data-ttu-id="731e0-213">[Configurar uma política de memória](cache-configure.md#maxmemory-policy-and-maxmemory-reserved) e definir tempos de expiração em suas chaves.</span><span class="sxs-lookup"><span data-stu-id="731e0-213">[Configure a memory policy](cache-configure.md#maxmemory-policy-and-maxmemory-reserved) and set expiration times on your keys.</span></span> <span data-ttu-id="731e0-214">Observe que isso poderá não ser suficiente se você tiver fragmentação.</span><span class="sxs-lookup"><span data-stu-id="731e0-214">Note that this may not be sufficient if you have fragmentation.</span></span>
2. <span data-ttu-id="731e0-215">[Configurar um valor para maxmemory-reserved](cache-configure.md#maxmemory-policy-and-maxmemory-reserved) que seja grande o suficiente para compensar pela fragmentação da memória.</span><span class="sxs-lookup"><span data-stu-id="731e0-215">[Configure a maxmemory-reserved value](cache-configure.md#maxmemory-policy-and-maxmemory-reserved) that is large enough to compensate for memory fragmentation.</span></span>
3. <span data-ttu-id="731e0-216">Dividir os objetos grandes armazenados em cache em objetos menores relacionados.</span><span class="sxs-lookup"><span data-stu-id="731e0-216">Break up your large cached objects into smaller related objects.</span></span>
4. <span data-ttu-id="731e0-217">[Dimensionar](cache-how-to-scale.md) para um tamanho de cache maior.</span><span class="sxs-lookup"><span data-stu-id="731e0-217">[Scale](cache-how-to-scale.md) to a larger cache size.</span></span>
5. <span data-ttu-id="731e0-218">Se estiver usando um [cache premium com o cluster Redis habilitado](cache-how-to-premium-clustering.md), você poderá [aumentar o número de fragmentos](cache-how-to-premium-clustering.md#change-the-cluster-size-on-a-running-premium-cache).</span><span class="sxs-lookup"><span data-stu-id="731e0-218">If you are using a [premium cache with Redis cluster enabled](cache-how-to-premium-clustering.md) you can [increase the number of shards](cache-how-to-premium-clustering.md#change-the-cluster-size-on-a-running-premium-cache).</span></span>

### <a name="high-cpu-usage--server-load"></a><span data-ttu-id="731e0-219">Alto nível de uso da CPU/carga de servidor</span><span class="sxs-lookup"><span data-stu-id="731e0-219">High CPU usage / Server Load</span></span>
#### <a name="problem"></a><span data-ttu-id="731e0-220">Problema</span><span class="sxs-lookup"><span data-stu-id="731e0-220">Problem</span></span>
<span data-ttu-id="731e0-221">Um alto nível de uso da CPU pode significar que o cliente pode deixar de processar uma resposta do Redis de forma oportuna, embora o Redis tenha enviado a resposta muito rapidamente.</span><span class="sxs-lookup"><span data-stu-id="731e0-221">High CPU usage can mean that the client side can fail to process a response from Redis in a timely fashion even though Redis sent the response very quickly.</span></span>

#### <a name="measurement"></a><span data-ttu-id="731e0-222">Medida</span><span class="sxs-lookup"><span data-stu-id="731e0-222">Measurement</span></span>
<span data-ttu-id="731e0-223">Monitorar o uso de CPU geral do sistema por meio do Portal do Azure ou do contador de desempenho associado.</span><span class="sxs-lookup"><span data-stu-id="731e0-223">Monitor the System Wide CPU usage through the Azure Portal or through the associated performance counter.</span></span> <span data-ttu-id="731e0-224">Tenha cuidado para não monitorar o uso de CPU do *processo* , porque um único processo pode representar pouco uso da CPU enquanto o uso de CPU do sistema geral pode ser alto.</span><span class="sxs-lookup"><span data-stu-id="731e0-224">Be careful not to monitor *process* CPU because a single process can have low CPU usage at the same time that overall system CPU can be high.</span></span> <span data-ttu-id="731e0-225">Fique atento a picos de uso de CPU que correspondem aos tempos limite.</span><span class="sxs-lookup"><span data-stu-id="731e0-225">Watch for spikes in CPU usage that correspond with timeouts.</span></span>

#### <a name="resolution"></a><span data-ttu-id="731e0-226">Resolução</span><span class="sxs-lookup"><span data-stu-id="731e0-226">Resolution</span></span>
<span data-ttu-id="731e0-227">[Dimensionar](cache-how-to-scale.md) para uma camada de cache maior, com mais capacidade de CPU, ou investigar o que está causando os picos de CPU.</span><span class="sxs-lookup"><span data-stu-id="731e0-227">[Scale](cache-how-to-scale.md) to a larger cache tier with more CPU capacity or investigate what is causing CPU spikes.</span></span> 

### <a name="server-side-bandwidth-exceeded"></a><span data-ttu-id="731e0-228">Largura de banda do servidor ultrapassada</span><span class="sxs-lookup"><span data-stu-id="731e0-228">Server Side Bandwidth Exceeded</span></span>
#### <a name="problem"></a><span data-ttu-id="731e0-229">Problema</span><span class="sxs-lookup"><span data-stu-id="731e0-229">Problem</span></span>
<span data-ttu-id="731e0-230">Instâncias de cache com tamanhos diferentes têm limitações quanto à largura de banda de rede que têm disponível.</span><span class="sxs-lookup"><span data-stu-id="731e0-230">Different sized cache instances have limitations on how much network bandwidth they have available.</span></span> <span data-ttu-id="731e0-231">Se o servidor ultrapassar a largura de banda disponível, os dados não serão enviados ao cliente tão rapidamente.</span><span class="sxs-lookup"><span data-stu-id="731e0-231">If the server exceeds the available bandwidth, then data will not be sent to the client as quickly.</span></span> <span data-ttu-id="731e0-232">Isso pode levar a tempos limite.</span><span class="sxs-lookup"><span data-stu-id="731e0-232">This can lead to timeouts.</span></span>

#### <a name="measurement"></a><span data-ttu-id="731e0-233">Medida</span><span class="sxs-lookup"><span data-stu-id="731e0-233">Measurement</span></span>
<span data-ttu-id="731e0-234">Você pode monitorar a métrica `Cache Read` , que é a quantidade de dados lidos do cache, em MB/s, durante o intervalo de relatório especificado.</span><span class="sxs-lookup"><span data-stu-id="731e0-234">You can monitor the `Cache Read` metric, which is the amount of data read from the cache in Megabytes per second (MB/s) during the specified reporting interval.</span></span> <span data-ttu-id="731e0-235">Esse valor corresponde à largura de banda de rede usada por esse cache.</span><span class="sxs-lookup"><span data-stu-id="731e0-235">This value corresponds to the network bandwidth used by this cache.</span></span> <span data-ttu-id="731e0-236">Se quiser configurar alertas para limites de largura de banda de rede no servidor, você poderá criá-los usando este contador `Cache Read` .</span><span class="sxs-lookup"><span data-stu-id="731e0-236">If you want to set up alerts for server side network bandwidth limits, you can create them using this `Cache Read` counter.</span></span> <span data-ttu-id="731e0-237">Compare suas leituras com os valores [nesta tabela](cache-faq.md#cache-performance) para ver os limites de largura de banda observados para vários tamanhos e camadas de preços de cache.</span><span class="sxs-lookup"><span data-stu-id="731e0-237">Compare your readings with the values in [this table](cache-faq.md#cache-performance) for the observed bandwidth limits for various cache pricing tiers and sizes.</span></span>

#### <a name="resolution"></a><span data-ttu-id="731e0-238">Resolução</span><span class="sxs-lookup"><span data-stu-id="731e0-238">Resolution</span></span>
<span data-ttu-id="731e0-239">Se você estiver consistentemente perto da largura de banda máxima observada para o tamanho do cache e o tipo de preço, considere [dimensionar](cache-how-to-scale.md) para um tamanho ou tipo de preço que tenha maior largura de banda de rede, usando os valores [nesta tabela](cache-faq.md#cache-performance) como guia.</span><span class="sxs-lookup"><span data-stu-id="731e0-239">If you are consistently near the observed maximum bandwidth for your pricing tier and cache size, consider [scaling](cache-how-to-scale.md) to a pricing tier or size that has greater network bandwidth, using the values in [this table](cache-faq.md#cache-performance) as a guide.</span></span>

## <a name="stackexchangeredis-timeout-exceptions"></a><span data-ttu-id="731e0-240">Exceções de tempo limite do StackExchange.Redis</span><span class="sxs-lookup"><span data-stu-id="731e0-240">StackExchange.Redis timeout exceptions</span></span>
<span data-ttu-id="731e0-241">O StackExchange.Redis usa uma configuração chamada `synctimeout` para operações síncronas, que tem um valor padrão de 1000 ms.</span><span class="sxs-lookup"><span data-stu-id="731e0-241">StackExchange.Redis uses a configuration setting named `synctimeout` for synchronous operations which has a default value  of 1000 ms.</span></span> <span data-ttu-id="731e0-242">Se uma chamada síncrona não for concluída no tempo determinado, o cliente do StackExchange.Redis gerará um erro de tempo limite semelhante ao exemplo a seguir.</span><span class="sxs-lookup"><span data-stu-id="731e0-242">If a synchronous call doesn’t complete in the stipulated time, the StackExchange.Redis client throws a timeout error similar to the following example.</span></span>

    System.TimeoutException: Timeout performing MGET 2728cc84-58ae-406b-8ec8-3f962419f641, inst: 1,mgr: Inactive, queue: 73, qu=6, qs=67, qc=0, wr=1/1, in=0/0 IOCP: (Busy=6, Free=999, Min=2,Max=1000), WORKER (Busy=7,Free=8184,Min=2,Max=8191)


<span data-ttu-id="731e0-243">Essa mensagem de erro contém métricas que podem ajudar a indicar a causa e a possível resolução do problema.</span><span class="sxs-lookup"><span data-stu-id="731e0-243">This error message contains metrics that can help point you to the cause and possible resolution of the issue.</span></span> <span data-ttu-id="731e0-244">A tabela a seguir contém detalhes sobre as métricas da mensagem de erro.</span><span class="sxs-lookup"><span data-stu-id="731e0-244">The following table contains details about the error message metrics.</span></span>

| <span data-ttu-id="731e0-245">Métrica da mensagem de erro</span><span class="sxs-lookup"><span data-stu-id="731e0-245">Error message metric</span></span> | <span data-ttu-id="731e0-246">Detalhes</span><span class="sxs-lookup"><span data-stu-id="731e0-246">Details</span></span> |
| --- | --- |
| <span data-ttu-id="731e0-247">inst</span><span class="sxs-lookup"><span data-stu-id="731e0-247">inst</span></span> |<span data-ttu-id="731e0-248">Na última fração de tempo: 0 comandos foram emitidos</span><span class="sxs-lookup"><span data-stu-id="731e0-248">In the last time slice: 0 commands have been issued</span></span> |
| <span data-ttu-id="731e0-249">mgr</span><span class="sxs-lookup"><span data-stu-id="731e0-249">mgr</span></span> |<span data-ttu-id="731e0-250">O gerenciador do soquete está executando `socket.select`, o que significa que ele está solicitando que o sistema operacional indique um soquete que tem algo a fazer. Basicamente, o leitor não está lendo ativamente da rede porque ele acha que não há nada a fazer.</span><span class="sxs-lookup"><span data-stu-id="731e0-250">The socket manager is performing `socket.select` which means it is asking the OS to indicate a socket that has something to do; basically: the reader is not actively reading from the network because it doesn't think there is anything to do</span></span> |
| <span data-ttu-id="731e0-251">fila</span><span class="sxs-lookup"><span data-stu-id="731e0-251">queue</span></span> |<span data-ttu-id="731e0-252">Existem 73 operações em andamento no total</span><span class="sxs-lookup"><span data-stu-id="731e0-252">There are 73 total in-progress operations</span></span> |
| <span data-ttu-id="731e0-253">qu</span><span class="sxs-lookup"><span data-stu-id="731e0-253">qu</span></span> |<span data-ttu-id="731e0-254">6 das operações em andamento estão na fila de "não enviadas" e ainda não foram gravadas na rede de saída</span><span class="sxs-lookup"><span data-stu-id="731e0-254">6 of the in-progress operations are in the unsent queue and have not yet been written to the outbound network</span></span> |
| <span data-ttu-id="731e0-255">qs</span><span class="sxs-lookup"><span data-stu-id="731e0-255">qs</span></span> |<span data-ttu-id="731e0-256">67 das operações em andamento foram enviadas ao servidor, mas uma resposta ainda não está disponível.</span><span class="sxs-lookup"><span data-stu-id="731e0-256">67 of he in-progress operations have been sent to the server but a response is not yet available.</span></span> <span data-ttu-id="731e0-257">A resposta pode ser `Not yet sent by the server` ou `sent by the server but not yet processed by the client.`</span><span class="sxs-lookup"><span data-stu-id="731e0-257">The response could be `Not yet sent by the server` or `sent by the server but not yet processed by the client.`</span></span> |
| <span data-ttu-id="731e0-258">qc</span><span class="sxs-lookup"><span data-stu-id="731e0-258">qc</span></span> |<span data-ttu-id="731e0-259">0 das operações em andamento viram respostas, mas ainda não foram marcados como concluídas devido a espera do loop de conclusão</span><span class="sxs-lookup"><span data-stu-id="731e0-259">0 of the in-progress operations have seen replies but have not yet been marked as complete due to waiting on the completion loop</span></span> |
| <span data-ttu-id="731e0-260">wr</span><span class="sxs-lookup"><span data-stu-id="731e0-260">wr</span></span> |<span data-ttu-id="731e0-261">Há um gravador ativo (ou seja, as 6 solicitações não enviadas não estão sendo ignoradas) bytes/activewriters</span><span class="sxs-lookup"><span data-stu-id="731e0-261">There is an active writer (meaning the 6 unsent requests are not being ignored) bytes/activewriters</span></span> |
| <span data-ttu-id="731e0-262">mergulhar</span><span class="sxs-lookup"><span data-stu-id="731e0-262">in</span></span> |<span data-ttu-id="731e0-263">Não há nenhum leitor ativo e zero bytes estão disponíveis para serem lidos no NIC bytes/activereaders</span><span class="sxs-lookup"><span data-stu-id="731e0-263">There are no active readers and zero bytes are available to be read on the NIC bytes/activereaders</span></span> |

### <a name="steps-to-investigate"></a><span data-ttu-id="731e0-264">Etapas para investigar</span><span class="sxs-lookup"><span data-stu-id="731e0-264">Steps to investigate</span></span>
1. <span data-ttu-id="731e0-265">Como uma prática recomendada, verifique se você está usando o seguinte padrão para se conectar usando o cliente do StackExchange.Redis.</span><span class="sxs-lookup"><span data-stu-id="731e0-265">As a best practice make sure you are using the following pattern to connect when using the StackExchange.Redis client.</span></span>

    ```c#
    private static Lazy<ConnectionMultiplexer> lazyConnection = new Lazy<ConnectionMultiplexer>(() =>
    {
        return ConnectionMultiplexer.Connect("cachename.redis.cache.windows.net,abortConnect=false,ssl=true,password=...");
    
    });
    
    public static ConnectionMultiplexer Connection
    {
        get
        {
            return lazyConnection.Value;
        }
    }
    ````

    <span data-ttu-id="731e0-266">Para saber mais, confira [Conectar-se ao cache usando StackExchange.Redis](cache-dotnet-how-to-use-azure-redis-cache.md#connect-to-the-cache).</span><span class="sxs-lookup"><span data-stu-id="731e0-266">For more information, see [Connect to the cache using StackExchange.Redis](cache-dotnet-how-to-use-azure-redis-cache.md#connect-to-the-cache).</span></span>

1. <span data-ttu-id="731e0-267">Verifique se o Cache Redis do Azure e o aplicativo cliente estão na mesma região no Azure.</span><span class="sxs-lookup"><span data-stu-id="731e0-267">Ensure that your Azure Redis Cache and the client application are in the same region in Azure.</span></span> <span data-ttu-id="731e0-268">Por exemplo, você pode receber tempos limite quando o cache está no Leste dos EUA e o cliente está no Oeste dos EUA e a solicitação não é concluída dentro do intervalo de `synctimeout` , ou você pode receber tempos limite quando estiver depurando de seu computador de desenvolvimento local.</span><span class="sxs-lookup"><span data-stu-id="731e0-268">For example, you might be getting timeouts when your cache is in East US but the client is in West US and the request doesn't complete within the `synctimeout` interval or you might be getting timeouts when you are debugging from your local development machine.</span></span> 
   
    <span data-ttu-id="731e0-269">É altamente recomendável ter o cache e o cliente na mesma região do Azure.</span><span class="sxs-lookup"><span data-stu-id="731e0-269">It’s highly recommended to have the cache and in the client in the same Azure region.</span></span> <span data-ttu-id="731e0-270">Se tiver um cenário que inclua chamadas entre regiões, você deverá definir o intervalo de `synctimeout` como um valor maior que o intervalo de 1000 ms padrão, incluindo um propriedade `synctimeout` na cadeia de conexão.</span><span class="sxs-lookup"><span data-stu-id="731e0-270">If you have a scenario that includes cross region calls, you should set the `synctimeout` interval to a value higher than the default 1000 ms interval by including a `synctimeout` property in the connection string.</span></span> <span data-ttu-id="731e0-271">O exemplo a seguir mostra um trecho da cadeia de conexão do cache do StackExchange.Redis com um `synctimeout` de 2000 ms.</span><span class="sxs-lookup"><span data-stu-id="731e0-271">The following example shows a StackExchange.Redis cache connection string snippet with a `synctimeout` of 2000 ms.</span></span>
   
        synctimeout=2000,cachename.redis.cache.windows.net,abortConnect=false,ssl=true,password=...
2. <span data-ttu-id="731e0-272">Certifique-se de estar usando a versão mais recente do [Pacote NuGet do StackExchange.Redis](https://www.nuget.org/packages/StackExchange.Redis/).</span><span class="sxs-lookup"><span data-stu-id="731e0-272">Ensure you using the latest version of the [StackExchange.Redis NuGet package](https://www.nuget.org/packages/StackExchange.Redis/).</span></span> <span data-ttu-id="731e0-273">Constantemente são corrigidos bugs no código para torná-lo mais robusto com relação a tempos limite, de modo que ter a versão mais recente é importante.</span><span class="sxs-lookup"><span data-stu-id="731e0-273">There are bugs constantly being fixed in the code to make it more robust to timeouts so having the latest version is important.</span></span>
3. <span data-ttu-id="731e0-274">Se houver solicitações restritas por limitações de largura de banda no servidor ou no cliente, levará mais tempo para conclui-las, o que resultará em tempos limite.</span><span class="sxs-lookup"><span data-stu-id="731e0-274">If there are requests that are getting bound by bandwidth limitations on the server or client, it will take longer for them to complete and thereby cause timeouts.</span></span> <span data-ttu-id="731e0-275">Para ver se o seu tempo limite se deve à largura de banda de rede do servidor, consulte [Largura de banda do servidor ultrapassada](#server-side-bandwidth-exceeded).</span><span class="sxs-lookup"><span data-stu-id="731e0-275">To see if your timeout is due to network bandwidth on the server, see [Server side bandwidth exceeded](#server-side-bandwidth-exceeded).</span></span> <span data-ttu-id="731e0-276">Para ver se o seu tempo limite se deve à largura de banda de rede do cliente, consulte [Largura de banda do cliente ultrapassada](#client-side-bandwidth-exceeded).</span><span class="sxs-lookup"><span data-stu-id="731e0-276">To see if your timeout is due to client network bandwidth, see [Client side bandwidth exceeded](#client-side-bandwidth-exceeded).</span></span>
4. <span data-ttu-id="731e0-277">Você está sendo limitado à CPU no servidor ou no cliente?</span><span class="sxs-lookup"><span data-stu-id="731e0-277">Are you getting CPU bound on the server or on the client?</span></span>
   
   * <span data-ttu-id="731e0-278">Verifique se você está sendo limitado pela CPU no cliente, o que pode fazer com que a solicitação não seja processada dentro do intervalo `synctimeout` , provocando um tempo limite.</span><span class="sxs-lookup"><span data-stu-id="731e0-278">Check if you are getting bound by CPU on your client which could cause the request to not be processed within the `synctimeout` interval, thus causing a timeout.</span></span> <span data-ttu-id="731e0-279">Mover para um tamanho de cliente maior ou distribuir a carga pode ajudar a controlar isso.</span><span class="sxs-lookup"><span data-stu-id="731e0-279">Moving to a larger client size or distributing the load can help to control this.</span></span> 
   * <span data-ttu-id="731e0-280">Verifique se você está sendo limitado pela CPU no servidor monitorando a [métrica de desempenho de cache](cache-how-to-monitor.md#available-metrics-and-reporting-intervals) `CPU`.</span><span class="sxs-lookup"><span data-stu-id="731e0-280">Check if you are getting CPU bound on the server by monitoring the `CPU` [cache performance metric](cache-how-to-monitor.md#available-metrics-and-reporting-intervals).</span></span> <span data-ttu-id="731e0-281">Solicitações recebidas enquanto o Redis está limitado à CPU podem fazer com que essas solicitações cheguem ao tempo limite.</span><span class="sxs-lookup"><span data-stu-id="731e0-281">Requests coming in while Redis is CPU bound can cause those requests to timeout.</span></span> <span data-ttu-id="731e0-282">Para resolver isso, você pode distribuir a carga entre vários fragmentos em um cache premium ou atualizar para um tipo de preço ou tamanho maior.</span><span class="sxs-lookup"><span data-stu-id="731e0-282">To address this you can distribute the load across multiple shards in a premium cache, or upgrade to a larger size or pricing tier.</span></span> <span data-ttu-id="731e0-283">Para obter mais informações, consulte [Largura de banda do servidor ultrapassada](#server-side-bandwidth-exceeded).</span><span class="sxs-lookup"><span data-stu-id="731e0-283">For more information, see [Server Side Bandwidth Exceeded](#server-side-bandwidth-exceeded).</span></span>
5. <span data-ttu-id="731e0-284">Há comandos que levam muito tempo para serem processados no servidor?</span><span class="sxs-lookup"><span data-stu-id="731e0-284">Are there commands taking long time to process on the server?</span></span> <span data-ttu-id="731e0-285">Comandos de execução longa que levam muito tempo para serem processados no servidor do Redis podem resultar em tempos limite.</span><span class="sxs-lookup"><span data-stu-id="731e0-285">Long running commands that are taking long time to process on the redis-server can cause timeouts.</span></span> <span data-ttu-id="731e0-286">Alguns exemplos de comandos de execução longa são `mget` com um grande número de chaves, `keys *` ou scripts lua mal escritos.</span><span class="sxs-lookup"><span data-stu-id="731e0-286">Some examples of long running commands are `mget` with large numbers of keys, `keys *` or poorly written lua scripts.</span></span> <span data-ttu-id="731e0-287">Você pode se conectar à instância do Cache Redis do Azure usando o cliente redis-cli ou usar o [Console do Redis](cache-configure.md#redis-console) e executar o comando [SlowLog](http://redis.io/commands/slowlog) para ver se há solicitações que estão demorando mais do que o esperado.</span><span class="sxs-lookup"><span data-stu-id="731e0-287">You can connect to your Azure Redis Cache instance using the redis-cli client or use the [Redis Console](cache-configure.md#redis-console) and run the [SlowLog](http://redis.io/commands/slowlog) command to see if there are requests taking longer than expected.</span></span> <span data-ttu-id="731e0-288">O Servidor do Redis e o StackExchange.Redis são otimizados para várias solicitações pequenas, em vez de menos solicitações grandes.</span><span class="sxs-lookup"><span data-stu-id="731e0-288">Redis Server and StackExchange.Redis are optimized for many small requests rather than fewer large requests.</span></span> <span data-ttu-id="731e0-289">Dividir os dados em partes menores pode melhorar as coisa.</span><span class="sxs-lookup"><span data-stu-id="731e0-289">Splitting your data into smaller chunks may improve things here.</span></span> 
   
    <span data-ttu-id="731e0-290">Para obter informações sobre como se conectar ao ponto de extremidade SSL de Cache Redis do Azure usando redis-cli e stunnel, consulte a postagem de blog [Anunciando o provedor de estado de sessão ASP.NET para a versão de teste do Redis](http://blogs.msdn.com/b/webdev/archive/2014/05/12/announcing-asp-net-session-state-provider-for-redis-preview-release.aspx) .</span><span class="sxs-lookup"><span data-stu-id="731e0-290">For information on connecting to the Azure Redis Cache SSL endpoint using redis-cli and stunnel, see the [Announcing ASP.NET Session State Provider for Redis Preview Release](http://blogs.msdn.com/b/webdev/archive/2014/05/12/announcing-asp-net-session-state-provider-for-redis-preview-release.aspx) blog post.</span></span> <span data-ttu-id="731e0-291">Para obter mais informações, consulte [SlowLog](http://redis.io/commands/slowlog).</span><span class="sxs-lookup"><span data-stu-id="731e0-291">For more information, see [SlowLog](http://redis.io/commands/slowlog).</span></span>
6. <span data-ttu-id="731e0-292">Uma carga alta no servidor Redis pode resultar em tempos limite.</span><span class="sxs-lookup"><span data-stu-id="731e0-292">High Redis server load can cause timeouts.</span></span> <span data-ttu-id="731e0-293">Você pode monitorar a carga do servidor monitorando a [métrica de desempenho de cache](cache-how-to-monitor.md#available-metrics-and-reporting-intervals) `Redis Server Load`.</span><span class="sxs-lookup"><span data-stu-id="731e0-293">You can monitor the server load by monitoring the `Redis Server Load` [cache performance metric](cache-how-to-monitor.md#available-metrics-and-reporting-intervals).</span></span> <span data-ttu-id="731e0-294">Uma carga de servidor de 100 (valor máximo) significa que o servidor Redis está ocupado, sem tempo ocioso, processando de solicitações.</span><span class="sxs-lookup"><span data-stu-id="731e0-294">A server load of 100 (maximum value) signifies that the redis server has been busy, with no idle time, processing requests.</span></span> <span data-ttu-id="731e0-295">Para ver se determinadas solicitações estão consumindo toda a capacidade do servidor, execute o comando SlowLog, conforme descrito no parágrafo anterior.</span><span class="sxs-lookup"><span data-stu-id="731e0-295">To see if certain requests are taking up all of the server capability, run the SlowLog command, as described in the previous paragraph.</span></span> <span data-ttu-id="731e0-296">Para obter mais informações, consulte [Alto nível de uso da CPU/carga de servidor](#high-cpu-usage-server-load).</span><span class="sxs-lookup"><span data-stu-id="731e0-296">For more information, see [High CPU usage / Server Load](#high-cpu-usage-server-load).</span></span>
7. <span data-ttu-id="731e0-297">Houve qualquer outro evento no lado do cliente que possa ter causado um problema na rede?</span><span class="sxs-lookup"><span data-stu-id="731e0-297">Was there any other event on the client side that could have caused a network blip?</span></span> <span data-ttu-id="731e0-298">Verifique no cliente (Web, função de trabalho ou VM IaaS) se ocorreu algo como a alteração do número de instâncias de cliente ou a implantação de uma nova versão do cliente, ou se o dimensionamento automático está habilitado. Em nossos testes, descobrimos que o dimensionamento automático ou a escalar/reduzir horizontalmente pode fazer com que a conectividade de rede de saída seja perdida por alguns segundos.</span><span class="sxs-lookup"><span data-stu-id="731e0-298">Check on the client (web, worker role or an Iaas VM) if there was an event like scaling the number of client instances up or down, or deploying a new version of the client or auto-scale is enabled?In our testing we have found that autoscale or scaling up/down can cause outbound network connectivity can be lost for several seconds.</span></span> <span data-ttu-id="731e0-299">O código do StackExchange.Redis é resiliente a tais eventos e se reconectará.</span><span class="sxs-lookup"><span data-stu-id="731e0-299">StackExchange.Redis code is resilient to such events and will reconnect.</span></span> <span data-ttu-id="731e0-300">Durante esse tempo de reconexão, quaisquer solicitações na fila poderão atingir o tempo limite.</span><span class="sxs-lookup"><span data-stu-id="731e0-300">During this time of re-connection any requests in the queue can time out.</span></span>
8. <span data-ttu-id="731e0-301">Houve uma grande solicitação anterior a várias pequenas solicitações para o Cache Redis que atingiu o tempo limite?</span><span class="sxs-lookup"><span data-stu-id="731e0-301">Was there a big request preceding several small requests to the Redis Cache that timed out?</span></span> <span data-ttu-id="731e0-302">O parâmetro `qs` na mensagem de erro informa quantas solicitações foram enviadas do cliente ao servidor mas ainda não processaram uma resposta.</span><span class="sxs-lookup"><span data-stu-id="731e0-302">The parameter `qs` in the error message tells you how many requests were sent from the client to the server, but have not yet processed a response.</span></span> <span data-ttu-id="731e0-303">Esse valor pode continuar crescendo porque o StackExchange.Redis usa uma única conexão TCP e só pode ler uma resposta por vez.</span><span class="sxs-lookup"><span data-stu-id="731e0-303">This value can keep growing because StackExchange.Redis uses a single TCP connection and can only read one response at a time.</span></span> <span data-ttu-id="731e0-304">Embora a primeira operação tenha atingido o tempo limite, isso não impede que dados sejam enviados/recebidos do servidor, e outras solicitações são bloqueadas até que isso seja concluído, causando tempos limite.</span><span class="sxs-lookup"><span data-stu-id="731e0-304">Even though the first operation timed out, it does not stop the data being sent to/from the server, and other requests are blocked until this is finished, causing time outs.</span></span> <span data-ttu-id="731e0-305">Uma solução é minimizar a chance de tempos limite, garantindo que o cache seja grande o suficiente para sua carga de trabalho e dividindo valores grandes em partes menores.</span><span class="sxs-lookup"><span data-stu-id="731e0-305">One solution is to minimize the chance of timeouts by ensuring that your cache is large enough for your workload and splitting large values into smaller chunks.</span></span> <span data-ttu-id="731e0-306">Outra solução possível é usar um pool de objetos `ConnectionMultiplexer` no seu cliente e escolher o `ConnectionMultiplexer` menos carregado ao enviar uma nova solicitação.</span><span class="sxs-lookup"><span data-stu-id="731e0-306">Another possible solution is to use a pool of `ConnectionMultiplexer` objects in your client, and choose the least loaded `ConnectionMultiplexer` when sending a new request.</span></span> <span data-ttu-id="731e0-307">Isso deve impedir que um único tempo limite faça com que outras solicitações também atinjam o tempo limite.</span><span class="sxs-lookup"><span data-stu-id="731e0-307">This should prevent a single timeout from causing other requests to also timeout.</span></span>
9. <span data-ttu-id="731e0-308">Se você estiver usando `RedisSessionStateprovider`, certifique-se de que você configurou corretamente o tempo limite para novas tentativas.</span><span class="sxs-lookup"><span data-stu-id="731e0-308">If you are using `RedisSessionStateprovider`, ensure you have set the retry timeout correctly.</span></span> <span data-ttu-id="731e0-309">`retrytimeoutInMilliseconds` deve ser maior do que `operationTimeoutinMilliseonds`; caso contrário, não haverá novas tentativas.</span><span class="sxs-lookup"><span data-stu-id="731e0-309">`retrytimeoutInMilliseconds` should be higher than `operationTimeoutinMilliseonds`, otherwise no retries will occur.</span></span> <span data-ttu-id="731e0-310">No exemplo a seguir, `retrytimeoutInMilliseconds` é definido como 3000.</span><span class="sxs-lookup"><span data-stu-id="731e0-310">In the following example `retrytimeoutInMilliseconds` is set to 3000.</span></span> <span data-ttu-id="731e0-311">Para obter mais informações, consulte [Provedor de estado de sessão ASP.NET para Cache Redis do Azure](cache-aspnet-session-state-provider.md) e [Como usar os parâmetros de configuração do Provedor de estado de sessão e do Provedor de cache de saída](https://github.com/Azure/aspnet-redis-providers/wiki/Configuration).</span><span class="sxs-lookup"><span data-stu-id="731e0-311">For more information, see [ASP.NET Session State Provider for Azure Redis Cache](cache-aspnet-session-state-provider.md) and [How to use the configuration parameters of Session State Provider and Output Cache Provider](https://github.com/Azure/aspnet-redis-providers/wiki/Configuration).</span></span>

    <add
      name="AFRedisCacheSessionStateProvider"
      type="Microsoft.Web.Redis.RedisSessionStateProvider"
      host="enbwcache.redis.cache.windows.net"
      port="6380"
      accessKey="…"
      ssl="true"
      databaseId="0"
      applicationName="AFRedisCacheSessionState"
      connectionTimeoutInMilliseconds = "5000"
      operationTimeoutInMilliseconds = "1000"
      retryTimeoutInMilliseconds="3000" />


1. <span data-ttu-id="731e0-312">Verifique o uso de memória no servidor do Cache Redis do Azure [monitorando](cache-how-to-monitor.md#available-metrics-and-reporting-intervals) `Used Memory RSS` e `Used Memory`.</span><span class="sxs-lookup"><span data-stu-id="731e0-312">Check memory usage on the Azure Redis Cache server by [monitoring](cache-how-to-monitor.md#available-metrics-and-reporting-intervals) `Used Memory RSS` and `Used Memory`.</span></span> <span data-ttu-id="731e0-313">Se uma política de remoção estiver em vigor, o Redis começará a remover chaves quando `Used_Memory` atingir o tamanho do cache.</span><span class="sxs-lookup"><span data-stu-id="731e0-313">If an eviction policy is in place, Redis starts evicting keys when `Used_Memory` reaches the cache size.</span></span> <span data-ttu-id="731e0-314">Idealmente, `Used Memory RSS` deve ser apenas um pouco maior do que `Used memory`.</span><span class="sxs-lookup"><span data-stu-id="731e0-314">Ideally, `Used Memory RSS` should be only slightly higher than `Used memory`.</span></span> <span data-ttu-id="731e0-315">Uma grande diferença significa que há fragmentação de memória (interna ou externa).</span><span class="sxs-lookup"><span data-stu-id="731e0-315">A large difference means there is memory fragmentation (internal or external.</span></span> <span data-ttu-id="731e0-316">Quando `Used Memory RSS` é menor que `Used Memory`, isso significa que parte da memória em cache foi trocada pelo sistema operacional.</span><span class="sxs-lookup"><span data-stu-id="731e0-316">When `Used Memory RSS` is less than `Used Memory`, it means part of the cache memory has been swapped  by the operating system.</span></span> <span data-ttu-id="731e0-317">Se isso ocorrer, você poderá esperar que haja algumas latências significativas.</span><span class="sxs-lookup"><span data-stu-id="731e0-317">If this occurs you can expect some significant latencies.</span></span> <span data-ttu-id="731e0-318">Como o Redis não tem controle sobre como suas alocações são mapeadas para as páginas de memória, um valor alto de `Used Memory RSS` costuma ser o resultado de um aumento no uso de memória.</span><span class="sxs-lookup"><span data-stu-id="731e0-318">Because Redis does not have control over how its allocations are mapped to memory pages, high `Used Memory RSS` is often the result of a spike in memory usage.</span></span> <span data-ttu-id="731e0-319">Quando o Redis libera memória, a memória é dada de volta para o alocador e o alocador pode ou não pode fornecer a memória novamente ao sistema.</span><span class="sxs-lookup"><span data-stu-id="731e0-319">When Redis frees memory, the memory is given back to the allocator, and the allocator may or may not give the memory back to the system.</span></span> <span data-ttu-id="731e0-320">Pode haver uma discrepância entre o valor de `Used Memory` e o consumo de memória, conforme relatado pelo sistema operacional.</span><span class="sxs-lookup"><span data-stu-id="731e0-320">There may be a discrepancy between the `Used Memory` value and memory consumption as reported by the operating system.</span></span> <span data-ttu-id="731e0-321">Isso pode ocorrer devido ao fato de a memória foi usada e liberada pelo Redis, mas não fornecida de volta para o sistema.</span><span class="sxs-lookup"><span data-stu-id="731e0-321">It may be due to the fact memory has been used and released by Redis, but not given back to the system.</span></span> <span data-ttu-id="731e0-322">Para ajudar a atenuar problemas de memória, você pode executar as etapas a seguir.</span><span class="sxs-lookup"><span data-stu-id="731e0-322">To help mitigate memory issues you can perform the following steps.</span></span>
   
   * <span data-ttu-id="731e0-323">Atualizar o cache para um tamanho maior para que você não tenha problemas com as limitações de memória no sistema.</span><span class="sxs-lookup"><span data-stu-id="731e0-323">Upgrade the cache to a larger size so that you are not running up against memory limitations on the system.</span></span>
   * <span data-ttu-id="731e0-324">Definir tempos de expiração das chaves para que valores mais antigos sejam removidos de forma proativa.</span><span class="sxs-lookup"><span data-stu-id="731e0-324">Set expiration times on the keys so that older values are evicted proactively.</span></span>
   * <span data-ttu-id="731e0-325">Monitorar a métrica de cache `used_memory_rss` .</span><span class="sxs-lookup"><span data-stu-id="731e0-325">Monitor the the `used_memory_rss` cache metric.</span></span> <span data-ttu-id="731e0-326">Quando esse valor se aproximar do tamanho de seu cache, provavelmente você começará a ver problemas de desempenho.</span><span class="sxs-lookup"><span data-stu-id="731e0-326">When this value approaches the size of their cache, you are likely to start seeing performance issues.</span></span> <span data-ttu-id="731e0-327">Distribuir os dados em vários fragmentos se você estiver usando um cache premium ou atualizar para um tamanho de cache maior.</span><span class="sxs-lookup"><span data-stu-id="731e0-327">Distribute the data across multiple shards if you are using a premium cache, or upgrade to a larger cache size.</span></span>
   
   <span data-ttu-id="731e0-328">Para obter mais informações, confira [Demanda de memória do servidor](#memory-pressure-on-the-server).</span><span class="sxs-lookup"><span data-stu-id="731e0-328">For more information, see [Memory Pressure on the server](#memory-pressure-on-the-server).</span></span>

## <a name="additional-information"></a><span data-ttu-id="731e0-329">Informações adicionais</span><span class="sxs-lookup"><span data-stu-id="731e0-329">Additional information</span></span>
* [<span data-ttu-id="731e0-330">Qual oferta e tamanho de Cache Redis devo usar?</span><span class="sxs-lookup"><span data-stu-id="731e0-330">What Redis Cache offering and size should I use?</span></span>](cache-faq.md#what-redis-cache-offering-and-size-should-i-use)
* [<span data-ttu-id="731e0-331">Como medir e testar o desempenho do meu cache?</span><span class="sxs-lookup"><span data-stu-id="731e0-331">How can I benchmark and test the performance of my cache?</span></span>](cache-faq.md#how-can-i-benchmark-and-test-the-performance-of-my-cache)
* [<span data-ttu-id="731e0-332">Como posso executar comandos do Redis?</span><span class="sxs-lookup"><span data-stu-id="731e0-332">How can I run Redis commands?</span></span>](cache-faq.md#how-can-i-run-redis-commands)
* [<span data-ttu-id="731e0-333">Como monitorar o Cache Redis do Azure</span><span class="sxs-lookup"><span data-stu-id="731e0-333">How to monitor Azure Redis Cache</span></span>](cache-how-to-monitor.md)

