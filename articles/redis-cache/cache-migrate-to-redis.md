---
title: "Migrar aplicativos do Serviço de Cache Gerenciado para o Redis - Azure | Microsoft Docs"
description: "Saiba como migrar aplicativos do Serviço de Cache Gerenciado e aplicativos de Cache na Função para o Cache Redis do Azure"
services: redis-cache
documentationcenter: na
author: steved0x
manager: douge
editor: tysonn
ms.assetid: 041f077b-8c8e-4d7c-a3fc-89d334ed70d6
ms.service: cache
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: cache-redis
ms.workload: tbd
ms.date: 05/30/2017
ms.author: sdanie
ms.openlocfilehash: 0fbfb945c66926794721f2ce8cc183dac51ecb27
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="migrate-from-managed-cache-service-to-azure-redis-cache"></a><span data-ttu-id="e8d89-103">Migrar do Serviço de Cache gerenciado para o Cache Redis do Azure</span><span class="sxs-lookup"><span data-stu-id="e8d89-103">Migrate from Managed Cache Service to Azure Redis Cache</span></span>
<span data-ttu-id="e8d89-104">Migrar seus aplicativos que usam o Serviço de Cache Gerenciado do Azure para Cache Redis do Azure pode ser feito com alterações mínimas no seu aplicativo, dependendo dos recursos do Serviço de Cache Gerenciado usados pelo seu aplicativo de cache.</span><span class="sxs-lookup"><span data-stu-id="e8d89-104">Migrating your applications that use Azure Managed Cache Service to Azure Redis Cache can be accomplished with minimal changes to your application, depending on the Managed Cache Service features used by your caching application.</span></span> <span data-ttu-id="e8d89-105">Apesar das APIs não serem exatamente a mesmo coisa elas são semelhantes e grande parte do seu código existente que usa o Serviço de Cache Gerenciado para acessar um cache pode ser reutilizado com alterações mínimas.</span><span class="sxs-lookup"><span data-stu-id="e8d89-105">While the APIs are not exactly the same they are similar, and much of your existing code that uses Managed Cache Service to access a cache can be reused with minimal changes.</span></span> <span data-ttu-id="e8d89-106">Este tópico mostra como fazer as alterações de configuração e aplicativo necessárias para migrar seus aplicativos do Serviço de Cache Gerenciado para usar o Cache Redis do Azure. Além disso, mostra como alguns dos recursos do Cache Redis do Azure podem ser usados para implementar a funcionalidade de um cache do Serviço de Cache Gerenciado.</span><span class="sxs-lookup"><span data-stu-id="e8d89-106">This topic shows how to make the necessary configuration and application changes to migrate your Managed Cache Service applications to use Azure Redis Cache, and shows how some of the features of Azure Redis Cache can be used to implement the functionality of a Managed Cache Service cache.</span></span>

>[!NOTE]
><span data-ttu-id="e8d89-107">Serviço de Cache Gerenciado e na Cache na Função foram [desativados](https://azure.microsoft.com/blog/azure-managed-cache-and-in-role-cache-services-to-be-retired-on-11-30-2016/) em 30 de novembro de 2016.</span><span class="sxs-lookup"><span data-stu-id="e8d89-107">Managed Cache Service and In-Role Cache were [retired](https://azure.microsoft.com/blog/azure-managed-cache-and-in-role-cache-services-to-be-retired-on-11-30-2016/) November 30, 2016.</span></span> <span data-ttu-id="e8d89-108">Se você tiver quaisquer implantações de Cache na Função que você deseja migrar para o Cache Redis do Azure, execute as etapas neste artigo.</span><span class="sxs-lookup"><span data-stu-id="e8d89-108">If you have any In-Role Cache deployments that you want to migrate to Azure Redis Cache, you can follow the steps in this article.</span></span>

## <a name="migration-steps"></a><span data-ttu-id="e8d89-109">Etapas da migração</span><span class="sxs-lookup"><span data-stu-id="e8d89-109">Migration Steps</span></span>
<span data-ttu-id="e8d89-110">As etapas a seguir são necessárias para migrar um aplicativo de Serviço de Cache Gerenciado para usar o Cache Redis do Azure.</span><span class="sxs-lookup"><span data-stu-id="e8d89-110">The following steps are required to migrate a Managed Cache Service application to use Azure Redis Cache.</span></span>

* <span data-ttu-id="e8d89-111">Mapear recursos do Serviço de Cache Gerenciado para o Cache Redis do Azure</span><span class="sxs-lookup"><span data-stu-id="e8d89-111">Map Managed Cache Service features to Azure Redis Cache</span></span>
* <span data-ttu-id="e8d89-112">Escolher uma oferta de Cache</span><span class="sxs-lookup"><span data-stu-id="e8d89-112">Choose a Cache Offering</span></span>
* <span data-ttu-id="e8d89-113">Criar um Cache</span><span class="sxs-lookup"><span data-stu-id="e8d89-113">Create a Cache</span></span>
* <span data-ttu-id="e8d89-114">Configurar os clientes de Cache</span><span class="sxs-lookup"><span data-stu-id="e8d89-114">Configure the Cache Clients</span></span>
  * <span data-ttu-id="e8d89-115">Remover a configuração do Serviço de Cache Gerenciado</span><span class="sxs-lookup"><span data-stu-id="e8d89-115">Remove the Managed Cache Service Configuration</span></span>
  * <span data-ttu-id="e8d89-116">Configurar um cliente de cache usando o Pacote NuGet Stackexchange.Redis</span><span class="sxs-lookup"><span data-stu-id="e8d89-116">Configure a cache client using the StackExchange.Redis NuGet Package</span></span>
* <span data-ttu-id="e8d89-117">Migrar o código do Serviço de Cache Gerenciado</span><span class="sxs-lookup"><span data-stu-id="e8d89-117">Migrate Managed Cache Service code</span></span>
  * <span data-ttu-id="e8d89-118">Conectar-se ao cache usando a classe ConnectionMultiplexer</span><span class="sxs-lookup"><span data-stu-id="e8d89-118">Connect to the cache using the ConnectionMultiplexer class</span></span>
  * <span data-ttu-id="e8d89-119">Tipos de dados primitivos de acesso no cache</span><span class="sxs-lookup"><span data-stu-id="e8d89-119">Access primitive data types in the cache</span></span>
  * <span data-ttu-id="e8d89-120">Trabalhar com objetos .NET no cache</span><span class="sxs-lookup"><span data-stu-id="e8d89-120">Work with .NET objects in the cache</span></span>
* <span data-ttu-id="e8d89-121">Migrar o Estado de sessão do ASP.NET e cache de saída para o Cache Redis do Azure</span><span class="sxs-lookup"><span data-stu-id="e8d89-121">Migrate ASP.NET Session State and Output caching to Azure Redis Cache</span></span> 

## <a name="map-managed-cache-service-features-to-azure-redis-cache"></a><span data-ttu-id="e8d89-122">Mapear recursos do Serviço de Cache Gerenciado para o Cache Redis do Azure</span><span class="sxs-lookup"><span data-stu-id="e8d89-122">Map Managed Cache Service features to Azure Redis Cache</span></span>
<span data-ttu-id="e8d89-123">Serviço de Cache Gerenciado do e Cache Redis do Azure são semelhantes, mas implementam alguns dos seus recursos de maneiras diferentes.</span><span class="sxs-lookup"><span data-stu-id="e8d89-123">Azure Managed Cache Service and Azure Redis Cache are similar but implement some of their features in different ways.</span></span> <span data-ttu-id="e8d89-124">Esta seção descreve algumas das diferenças e fornece orientação sobre como implementar os recursos do Serviço de Cache Gerenciado no Cache Redis do Azure.</span><span class="sxs-lookup"><span data-stu-id="e8d89-124">This section describes some of the differences and provides guidance on implementing the features of Managed Cache Service in Azure Redis Cache.</span></span>

| <span data-ttu-id="e8d89-125">Recurso do Serviço de Cache Gerenciado</span><span class="sxs-lookup"><span data-stu-id="e8d89-125">Managed Cache Service feature</span></span> | <span data-ttu-id="e8d89-126">Suporte do Serviço de Cache Gerenciado</span><span class="sxs-lookup"><span data-stu-id="e8d89-126">Managed Cache Service support</span></span> | <span data-ttu-id="e8d89-127">Suporte do Cache Redis do Azure</span><span class="sxs-lookup"><span data-stu-id="e8d89-127">Azure Redis Cache support</span></span> |
| --- | --- | --- |
| <span data-ttu-id="e8d89-128">Caches nomeados</span><span class="sxs-lookup"><span data-stu-id="e8d89-128">Named caches</span></span> |<span data-ttu-id="e8d89-129">Um cache padrão está configurado e nas ofertas de cache Standard e Premium, até nove caches nomeados adicionais podem ser configuradas se desejado.</span><span class="sxs-lookup"><span data-stu-id="e8d89-129">A default cache is configured, and in the Standard and Premium cache offerings, up to nine additional named caches can be configured if desired.</span></span> |<span data-ttu-id="e8d89-130">Os Caches Redis do Azure possuem um número configurável de bancos de dados (padrão de 16) que podem ser usados para implementar uma funcionalidade semelhante em caches nomeados.</span><span class="sxs-lookup"><span data-stu-id="e8d89-130">Azure Redis caches have a configurable number of databases (default of 16) that can be used to implement a similar functionality to named caches.</span></span> <span data-ttu-id="e8d89-131">Para saber mais, veja [O que são os bancos de dados do Redis?](cache-faq.md#what-are-redis-databases) e [Configuração padrão do servidor Redis](cache-configure.md#default-redis-server-configuration).</span><span class="sxs-lookup"><span data-stu-id="e8d89-131">For more information, see [What are Redis databases?](cache-faq.md#what-are-redis-databases) and [Default Redis server configuration](cache-configure.md#default-redis-server-configuration).</span></span> |
| <span data-ttu-id="e8d89-132">Alta disponibilidade</span><span class="sxs-lookup"><span data-stu-id="e8d89-132">High Availability</span></span> |<span data-ttu-id="e8d89-133">Fornece alta disponibilidade para itens no cache nas ofertas de cache Standard e Premium.</span><span class="sxs-lookup"><span data-stu-id="e8d89-133">Provides high availability for items in the cache in the Standard and Premium cache offerings.</span></span> <span data-ttu-id="e8d89-134">Se os itens são perdidos devido a uma falha, cópias de backup dos itens no cache ainda ficam disponíveis.</span><span class="sxs-lookup"><span data-stu-id="e8d89-134">If items are lost due to a failure, backup copies of the items in the cache are still available.</span></span> <span data-ttu-id="e8d89-135">Gravações no cache secundário são feitas de forma síncrona.</span><span class="sxs-lookup"><span data-stu-id="e8d89-135">Writes to the secondary cache are made synchronously.</span></span> |<span data-ttu-id="e8d89-136">Alta disponibilidade nas ofertas de cache Standard e Premium, que possuem uma configuração Principal/Réplica de dois nós (cada fragmento em um cache Premium tem um par de principal/réplica).</span><span class="sxs-lookup"><span data-stu-id="e8d89-136">High availability is available in the Standard and Premium cache offerings, which have a two node Primary/Replica configuration (each shard in a Premium cache has a primary/replica pair).</span></span> <span data-ttu-id="e8d89-137">Gravações de réplica são feitas de forma assíncrona.</span><span class="sxs-lookup"><span data-stu-id="e8d89-137">Writes to the replica are made asynchronously.</span></span> <span data-ttu-id="e8d89-138">Para obter mais informações, confira [Preço do Cache Redis do Azure](https://azure.microsoft.com/pricing/details/cache/).</span><span class="sxs-lookup"><span data-stu-id="e8d89-138">For more information, see [Azure Redis Cache pricing](https://azure.microsoft.com/pricing/details/cache/).</span></span> |
| <span data-ttu-id="e8d89-139">Notificações</span><span class="sxs-lookup"><span data-stu-id="e8d89-139">Notifications</span></span> |<span data-ttu-id="e8d89-140">Permite que os clientes recebam notificações assíncronas quando várias operações de cache ocorrem em um cache nomeado.</span><span class="sxs-lookup"><span data-stu-id="e8d89-140">Allows clients to receive asynchronous notifications when a variety of cache operations occur on a named cache.</span></span> |<span data-ttu-id="e8d89-141">Aplicativos cliente podem usar o Redis pub/sub ou [Notificações de keyspace](cache-configure.md#keyspace-notifications-advanced-settings) para obter uma funcionalidade semelhante para notificações.</span><span class="sxs-lookup"><span data-stu-id="e8d89-141">Client applications can use Redis pub/sub or [Keyspace notifications](cache-configure.md#keyspace-notifications-advanced-settings) to achieve a similar functionality to notifications.</span></span> |
| <span data-ttu-id="e8d89-142">Cache local</span><span class="sxs-lookup"><span data-stu-id="e8d89-142">Local cache</span></span> |<span data-ttu-id="e8d89-143">Armazena uma cópia dos objetos armazenados em cache localmente no cliente para acesso extremamente rápido.</span><span class="sxs-lookup"><span data-stu-id="e8d89-143">Stores a copy of cached objects locally on the client for extra-fast access.</span></span> |<span data-ttu-id="e8d89-144">Os aplicativos cliente precisariam implementar essa funcionalidade usando um dicionário ou uma estrutura de dados semelhantes.</span><span class="sxs-lookup"><span data-stu-id="e8d89-144">Client applications would need to implement this functionality using a dictionary or similar data structure.</span></span> |
| <span data-ttu-id="e8d89-145">Política de remoção</span><span class="sxs-lookup"><span data-stu-id="e8d89-145">Eviction Policy</span></span> |<span data-ttu-id="e8d89-146">Nenhuma ou LRU.</span><span class="sxs-lookup"><span data-stu-id="e8d89-146">None or LRU.</span></span> <span data-ttu-id="e8d89-147">A política padrão é LRU.</span><span class="sxs-lookup"><span data-stu-id="e8d89-147">The default policy is LRU.</span></span> |<span data-ttu-id="e8d89-148">O Cache Redis do Azure suporta as seguintes políticas de remoção: volatile-lru, allkeys-lru, volatil-random, allkeys-random, volatile-ttl, noeviction.</span><span class="sxs-lookup"><span data-stu-id="e8d89-148">Azure Redis Cache supports the following eviction policies: volatile-lru, allkeys-lru, volatile-random, allkeys-random, volatile-ttl, noeviction.</span></span> <span data-ttu-id="e8d89-149">A política padrão é volatile-lru.</span><span class="sxs-lookup"><span data-stu-id="e8d89-149">The default policy is volatile-lru.</span></span> <span data-ttu-id="e8d89-150">Para obter mais informações, confira [Configuração padrão do servidor Redis](cache-configure.md#default-redis-server-configuration).</span><span class="sxs-lookup"><span data-stu-id="e8d89-150">For more information, see [Default Redis server configuration](cache-configure.md#default-redis-server-configuration).</span></span> |
| <span data-ttu-id="e8d89-151">Política de expiração</span><span class="sxs-lookup"><span data-stu-id="e8d89-151">Expiration Policy</span></span> |<span data-ttu-id="e8d89-152">A política de expiração padrão é Absolute e o intervalo de expiração padrão é de dez minutos.</span><span class="sxs-lookup"><span data-stu-id="e8d89-152">The default expiration policy is Absolute and the default expiration interval is ten minutes.</span></span> <span data-ttu-id="e8d89-153">As políticas Sliding e Never também estão disponíveis.</span><span class="sxs-lookup"><span data-stu-id="e8d89-153">Sliding and Never policies are also available.</span></span> |<span data-ttu-id="e8d89-154">Por padrão, itens no cache não expiram, mas uma expiração pode ser configurada por gravação usando sobrecargas de conjunto de cache.</span><span class="sxs-lookup"><span data-stu-id="e8d89-154">By default items in the cache do not expire, but an expiration can be configured on a per write basis using cache set overloads.</span></span> <span data-ttu-id="e8d89-155">Para obter mais informações, consulte [Adicionar e recuperar objetos do cache](cache-dotnet-how-to-use-azure-redis-cache.md#add-and-retrieve-objects-from-the-cache).</span><span class="sxs-lookup"><span data-stu-id="e8d89-155">For more information, see [Add and retrieve objects from the cache](cache-dotnet-how-to-use-azure-redis-cache.md#add-and-retrieve-objects-from-the-cache).</span></span> |
| <span data-ttu-id="e8d89-156">Regiões e marcação</span><span class="sxs-lookup"><span data-stu-id="e8d89-156">Regions and Tagging</span></span> |<span data-ttu-id="e8d89-157">As regiões são subgrupos para itens em cache.</span><span class="sxs-lookup"><span data-stu-id="e8d89-157">Regions are subgroups for cached items.</span></span> <span data-ttu-id="e8d89-158">Regiões também oferecem suporte à anotação dos itens em cache com mais sequências de caracteres descritivas denominadas marcas.</span><span class="sxs-lookup"><span data-stu-id="e8d89-158">Regions also support the annotation of cached items with additional descriptive strings called tags.</span></span> <span data-ttu-id="e8d89-159">As regiões oferecem suporte à capacidade de realizar operações de pesquisa em qualquer item marcado nessa região.</span><span class="sxs-lookup"><span data-stu-id="e8d89-159">Regions support the ability to perform search operations on any tagged items in that region.</span></span> <span data-ttu-id="e8d89-160">Todos os itens dentro de uma região estão localizados dentro de um único nó do cluster de cache.</span><span class="sxs-lookup"><span data-stu-id="e8d89-160">All items within a region are located within a single node of the cache cluster.</span></span> |<span data-ttu-id="e8d89-161">Um cache Redis consiste em um único nó (a menos que o cluster Redis esteja habilitado) então o conceito de regiões do Serviço de Cache Gerenciado não se aplica.</span><span class="sxs-lookup"><span data-stu-id="e8d89-161">A Redis cache consists of a single node (unless Redis cluster is enabled) so the concept of Managed Cache Service regions does not apply.</span></span> <span data-ttu-id="e8d89-162">O Redis oferece suporte à pesquisa e operações com caractere curinga ao recuperar chaves para que marcas descritivas possam ser incorporadas nos nomes de chave e usadas para recuperar os itens posteriormente.</span><span class="sxs-lookup"><span data-stu-id="e8d89-162">Redis supports searching and wildcard operations when retrieving keys so descriptive tags can be embedded within the key names and used to retrieve the items later.</span></span> <span data-ttu-id="e8d89-163">Para obter um exemplo de implementação de uma solução de marcação usando Redis, consulte [Implementar marcação de cache com Redis](http://stackify.com/implementing-cache-tagging-redis/).</span><span class="sxs-lookup"><span data-stu-id="e8d89-163">For an example of implementing a tagging solution using Redis, see [Implementing cache tagging with Redis](http://stackify.com/implementing-cache-tagging-redis/).</span></span> |
| <span data-ttu-id="e8d89-164">Serialização</span><span class="sxs-lookup"><span data-stu-id="e8d89-164">Serialization</span></span> |<span data-ttu-id="e8d89-165">O Cache gerenciado suporta o NetDataContractSerializer, BinaryFormatter e o uso de serializadores personalizados.</span><span class="sxs-lookup"><span data-stu-id="e8d89-165">Managed Cache supports NetDataContractSerializer, BinaryFormatter, and the use of custom serializers.</span></span> <span data-ttu-id="e8d89-166">O padrão é o NetDataContractSerializer.</span><span class="sxs-lookup"><span data-stu-id="e8d89-166">The default is NetDataContractSerializer.</span></span> |<span data-ttu-id="e8d89-167">É responsabilidade do aplicativo cliente para serializar objetos .NET antes de colocá-los no cache, com a opção do serializador para o desenvolvedor do aplicativo cliente.</span><span class="sxs-lookup"><span data-stu-id="e8d89-167">It is the responsibility of the client application to serialize .NET objects before placing them into the cache, with the choice of the serializer up to the client application developer.</span></span> <span data-ttu-id="e8d89-168">Para obter mais informações e um código de exemplo, consulte [Trabalhar com objetos .NET no cache](cache-dotnet-how-to-use-azure-redis-cache.md#work-with-net-objects-in-the-cache).</span><span class="sxs-lookup"><span data-stu-id="e8d89-168">For more information and sample code, see [Work with .NET objects in the cache](cache-dotnet-how-to-use-azure-redis-cache.md#work-with-net-objects-in-the-cache).</span></span> |
| <span data-ttu-id="e8d89-169">Emulador de cache</span><span class="sxs-lookup"><span data-stu-id="e8d89-169">Cache emulator</span></span> |<span data-ttu-id="e8d89-170">O Cache Gerenciado fornece um emulador de cache local.</span><span class="sxs-lookup"><span data-stu-id="e8d89-170">Managed Cache provides a local cache emulator.</span></span> |<span data-ttu-id="e8d89-171">O Cache Redis do Azure não tem um emulador, mas é possível [executar o build MSOpenTech do redis-server.exe localmente](cache-faq.md#cache-emulator) para fornecer uma experiência de emulador.</span><span class="sxs-lookup"><span data-stu-id="e8d89-171">Azure Redis Cache does not have an emulator, but you can [run the MSOpenTech build of redis-server.exe locally](cache-faq.md#cache-emulator) to provide an emulator experience.</span></span> |

## <a name="choose-a-cache-offering"></a><span data-ttu-id="e8d89-172">Escolher uma oferta de Cache</span><span class="sxs-lookup"><span data-stu-id="e8d89-172">Choose a Cache Offering</span></span>
<span data-ttu-id="e8d89-173">O Cache Redis do Microsoft Azure está disponível nas seguintes camadas:</span><span class="sxs-lookup"><span data-stu-id="e8d89-173">Microsoft Azure Redis Cache is available in the following tiers:</span></span>

* <span data-ttu-id="e8d89-174">**Básico** – um único nó.</span><span class="sxs-lookup"><span data-stu-id="e8d89-174">**Basic** – Single node.</span></span> <span data-ttu-id="e8d89-175">Vários tamanhos acima de 53 GB.</span><span class="sxs-lookup"><span data-stu-id="e8d89-175">Multiple sizes up to 53 GB.</span></span>
* <span data-ttu-id="e8d89-176">**Standard** – principal/réplica com dois nós.</span><span class="sxs-lookup"><span data-stu-id="e8d89-176">**Standard** – Two-node Primary/Replica.</span></span> <span data-ttu-id="e8d89-177">Vários tamanhos acima de 53 GB.</span><span class="sxs-lookup"><span data-stu-id="e8d89-177">Multiple sizes up to 53 GB.</span></span> <span data-ttu-id="e8d89-178">SLA de 99,9%.</span><span class="sxs-lookup"><span data-stu-id="e8d89-178">99.9% SLA.</span></span>
* <span data-ttu-id="e8d89-179">**Premium** – dois nós Primário/Réplica com até 10 fragmentos.</span><span class="sxs-lookup"><span data-stu-id="e8d89-179">**Premium** – Two-node Primary/Replica with up to 10 shards.</span></span> <span data-ttu-id="e8d89-180">Vários tamanhos de 6 GB a 530 GB.</span><span class="sxs-lookup"><span data-stu-id="e8d89-180">Multiple sizes from 6 GB to 530 GB.</span></span> <span data-ttu-id="e8d89-181">Todos os recursos do tipo Standard e outros, incluindo suporte para [cluster Redis](cache-how-to-premium-clustering.md), [persistência Redis](cache-how-to-premium-persistence.md) e [Rede Virtual do Azure](cache-how-to-premium-vnet.md).</span><span class="sxs-lookup"><span data-stu-id="e8d89-181">All Standard tier features and more including support for [Redis cluster](cache-how-to-premium-clustering.md), [Redis persistence](cache-how-to-premium-persistence.md), and [Azure Virtual Network](cache-how-to-premium-vnet.md).</span></span> <span data-ttu-id="e8d89-182">SLA de 99,9%.</span><span class="sxs-lookup"><span data-stu-id="e8d89-182">99.9% SLA.</span></span>

<span data-ttu-id="e8d89-183">Cada camada é diferente em termos de recursos e preços.</span><span class="sxs-lookup"><span data-stu-id="e8d89-183">Each tier differs in terms of features and pricing.</span></span> <span data-ttu-id="e8d89-184">Os recursos são abordados posteriormente neste manual e, para obter mais informações sobre preços, consulte [Detalhes de preços do Cache](https://azure.microsoft.com/pricing/details/cache/).</span><span class="sxs-lookup"><span data-stu-id="e8d89-184">The features are covered later in this guide, and for more information on pricing, see [Cache Pricing Details](https://azure.microsoft.com/pricing/details/cache/).</span></span>

<span data-ttu-id="e8d89-185">Um ponto de partida para a migração é escolher o tamanho que corresponda ao tamanho do cache do Serviço de Cache Gerenciado anterior e, em seguida, aumentar ou diminuir, dependendo dos requisitos do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e8d89-185">A starting point for migration is to pick the size that matches the size of your previous Managed Cache Service cache, and then scale up or down depending on the requirements of your application.</span></span> <span data-ttu-id="e8d89-186">Para obter instruções sobre como escolher a oferta certa do Cache Redis do Azure, consulte [Qual oferta de Cache Redis e tamanho devo usar?](cache-faq.md#what-redis-cache-offering-and-size-should-i-use).</span><span class="sxs-lookup"><span data-stu-id="e8d89-186">For more guidance on choosing the right Azure Redis Cache offering, see [What Redis Cache offering and size should I use?](cache-faq.md#what-redis-cache-offering-and-size-should-i-use).</span></span>

## <a name="create-a-cache"></a><span data-ttu-id="e8d89-187">Criar um Cache</span><span class="sxs-lookup"><span data-stu-id="e8d89-187">Create a Cache</span></span>
[!INCLUDE [redis-cache-create](../../includes/redis-cache-create.md)]

## <a name="configure-the-cache-clients"></a><span data-ttu-id="e8d89-188">Configurar os clientes de Cache</span><span class="sxs-lookup"><span data-stu-id="e8d89-188">Configure the Cache Clients</span></span>
<span data-ttu-id="e8d89-189">Depois que o cache é criado e configurado, a próxima etapa é remover a configuração do Serviço de Cache Gerenciado e adicionar a configuração de Cache Redis do Azure e referências para que os clientes de cache possam acessar o cache.</span><span class="sxs-lookup"><span data-stu-id="e8d89-189">Once the cache is created and configured, the next step is to remove the Managed Cache Service configuration, and add the add the Azure Redis Cache configuration and references so that cache clients can access the cache.</span></span>

* <span data-ttu-id="e8d89-190">Remover a configuração do Serviço de Cache Gerenciado</span><span class="sxs-lookup"><span data-stu-id="e8d89-190">Remove the Managed Cache Service Configuration</span></span>
* <span data-ttu-id="e8d89-191">Configurar um cliente de cache usando o Pacote NuGet Stackexchange.Redis</span><span class="sxs-lookup"><span data-stu-id="e8d89-191">Configure a cache client using the StackExchange.Redis NuGet Package</span></span>

### <a name="remove-the-managed-cache-service-configuration"></a><span data-ttu-id="e8d89-192">Remover a configuração do Serviço de Cache Gerenciado</span><span class="sxs-lookup"><span data-stu-id="e8d89-192">Remove the Managed Cache Service Configuration</span></span>
<span data-ttu-id="e8d89-193">Antes dos aplicativos cliente poderem ser configurados para o Cache Redis do Azure, a configuração do Serviço de Cache Gerenciado existente e referências de assembly devem ser removidas desinstalando o pacote NuGet de Serviço de Cache Gerenciado.</span><span class="sxs-lookup"><span data-stu-id="e8d89-193">Before the client applications can be configured for Azure Redis Cache, the existing Managed Cache Service configuration and assembly references must be removed by uninstalling the Managed Cache Service NuGet package.</span></span>

<span data-ttu-id="e8d89-194">Para desinstalar o pacote NuGet do Serviço de Cache Gerenciado, clique com o botão direito do mouse no projeto do cliente no **Gerenciador de Soluções** e escolha **Gerenciar Pacotes NuGet**.</span><span class="sxs-lookup"><span data-stu-id="e8d89-194">To uninstall the Managed Cache Service NuGet package, right-click the client project in **Solution Explorer** and choose **Manage NuGet Packages**.</span></span> <span data-ttu-id="e8d89-195">Selecione o nó **Pacotes instalados** e digite W**indowsAzure.Caching** na caixa Pesquisar pacotes instalados.</span><span class="sxs-lookup"><span data-stu-id="e8d89-195">Select the **Installed packages** node, and type W**indowsAzure.Caching** into the Search installed packages box.</span></span> <span data-ttu-id="e8d89-196">Selecione **Windows** **Cache do Azure** (ou **Windows** **Caching do Azure** dependendo da versão do pacote NuGet), clique em **Desinstalar**, e, em seguida, clique em **Fechar**.</span><span class="sxs-lookup"><span data-stu-id="e8d89-196">Select **Windows** **Azure Cache** (or **Windows** **Azure Caching** depending on the version of the NuGet package), click **Uninstall**, and then click **Close**.</span></span>

![Desinstalar o pacote NuGet do Serviço de Cache Gerenciado do Azure](./media/cache-migrate-to-redis/IC757666.jpg)

<span data-ttu-id="e8d89-198">Desinstalar o pacote NuGet de Serviço de Cache Gerenciado remove os assemblies do Serviço de Cache Gerenciado e as entradas do Serviço de Cache Gerenciado no app.config ou web.config do aplicativo cliente.</span><span class="sxs-lookup"><span data-stu-id="e8d89-198">Uninstalling the Managed Cache Service NuGet package removes the Managed Cache Service assemblies and the Managed Cache Service entries in the app.config or web.config of the client application.</span></span> <span data-ttu-id="e8d89-199">Como algumas configurações personalizadas não podem ser removidas quando você desinstala o pacote NuGet, abra web.config ou app.config e certifique-se de que os seguintes elementos são completamente removidos.</span><span class="sxs-lookup"><span data-stu-id="e8d89-199">Because some customized settings may not be removed when uninstalling the NuGet package, open web.config or app.config and ensure that the following elements are completely removed.</span></span>

<span data-ttu-id="e8d89-200">Verifique se a entrada `dataCacheClients` é removida do elemento `configSections`.</span><span class="sxs-lookup"><span data-stu-id="e8d89-200">Ensure that the `dataCacheClients` entry is removed from the `configSections` element.</span></span> <span data-ttu-id="e8d89-201">Não remova todo o elemento `configSections`; remova apenas a entrada `dataCacheClients`, se estiver presente.</span><span class="sxs-lookup"><span data-stu-id="e8d89-201">Do not remove the entire `configSections` element; just remove the `dataCacheClients` entry, if it is present.</span></span>

```xml
<configSections>
  <!-- Existing sections omitted for clarity. -->
  <section name="dataCacheClients"type="Microsoft.ApplicationServer.Caching.DataCacheClientsSection, Microsoft.ApplicationServer.Caching.Core" allowLocation="true" allowDefinition="Everywhere"/>
</configSections>
```

<span data-ttu-id="e8d89-202">Verifique se a seção `dataCacheClients` é removida.</span><span class="sxs-lookup"><span data-stu-id="e8d89-202">Ensure that the `dataCacheClients` section is removed.</span></span> <span data-ttu-id="e8d89-203">A seção `dataCacheClients` será semelhante ao exemplo a seguir.</span><span class="sxs-lookup"><span data-stu-id="e8d89-203">The `dataCacheClients` section will be similar to the following example.</span></span>

```xml
<dataCacheClients>
  <dataCacheClientname="default">
    <!--To use the in-role flavor of Azure Cache, set identifier to be the cache cluster role name -->
    <!--To use the Azure Managed Cache Service, set identifier to be the endpoint of the cache cluster -->
    <autoDiscoverisEnabled="true"identifier="[Cache role name or Service Endpoint]"/>

    <!--<localCache isEnabled="true" sync="TimeoutBased" objectCount="100000" ttlValue="300" />-->
    <!--Use this section to specify security settings for connecting to your cache. This section is not required if your cache is hosted on a role that is a part of your cloud service. -->
    <!--<securityProperties mode="Message" sslEnabled="true">
      <messageSecurity authorizationInfo="[Authentication Key]" />
    </securityProperties>-->
  </dataCacheClient>
</dataCacheClients>
```

<span data-ttu-id="e8d89-204">Depois que a configuração do Serviço de Cache Gerenciado é removida, você pode configurar o cliente de cache conforme descrito na seção a seguir.</span><span class="sxs-lookup"><span data-stu-id="e8d89-204">Once the Managed Cache Service configuration is removed, you can configure the cache client as described in the following section.</span></span>

### <a name="configure-a-cache-client-using-the-stackexchangeredis-nuget-package"></a><span data-ttu-id="e8d89-205">Configurar um cliente de cache usando o Pacote NuGet Stackexchange.Redis</span><span class="sxs-lookup"><span data-stu-id="e8d89-205">Configure a cache client using the StackExchange.Redis NuGet Package</span></span>
[!INCLUDE [redis-cache-configure](../../includes/redis-cache-configure-stackexchange-redis-nuget.md)]

## <a name="migrate-managed-cache-service-code"></a><span data-ttu-id="e8d89-206">Migrar o código do Serviço de Cache Gerenciado</span><span class="sxs-lookup"><span data-stu-id="e8d89-206">Migrate Managed Cache Service code</span></span>
<span data-ttu-id="e8d89-207">A API para o cliente de cache StackExchange.Redis é semelhante para o Serviço de Cache Gerenciado.</span><span class="sxs-lookup"><span data-stu-id="e8d89-207">The API for the StackExchange.Redis cache client is similar to the Managed Cache Service.</span></span> <span data-ttu-id="e8d89-208">Esta seção fornece uma visão geral das diferenças.</span><span class="sxs-lookup"><span data-stu-id="e8d89-208">This section provides an overview of the differences.</span></span>

### <a name="connect-to-the-cache-using-the-connectionmultiplexer-class"></a><span data-ttu-id="e8d89-209">Conectar-se ao cache usando a classe ConnectionMultiplexer</span><span class="sxs-lookup"><span data-stu-id="e8d89-209">Connect to the cache using the ConnectionMultiplexer class</span></span>
<span data-ttu-id="e8d89-210">No Serviço de Cache Gerenciado, as conexões com o cache eram manipuladas pelas classes `DataCacheFactory` e `DataCache`.</span><span class="sxs-lookup"><span data-stu-id="e8d89-210">In Managed Cache Service, connections to the cache were handled by the `DataCacheFactory` and `DataCache` classes.</span></span> <span data-ttu-id="e8d89-211">No Cache Redis do Azure, essas conexões são gerenciadas pela classe `ConnectionMultiplexer` .</span><span class="sxs-lookup"><span data-stu-id="e8d89-211">In Azure Redis Cache, these connections are managed by the `ConnectionMultiplexer` class.</span></span>

<span data-ttu-id="e8d89-212">Adicione o seguinte usando a instrução na parte superior de qualquer arquivo do qual você deseja acessar o cache.</span><span class="sxs-lookup"><span data-stu-id="e8d89-212">Add the following using statement to the top of any file from which you want to access the cache.</span></span>

```c#
using StackExchange.Redis
```

<span data-ttu-id="e8d89-213">Se esse namespace não for resolvido, certifique-se de que você tenha adicionado o pacote NuGet StackExchange.Redis conforme descrito em [Configurar os clientes de cache](cache-dotnet-how-to-use-azure-redis-cache.md#configure-the-cache-clients).</span><span class="sxs-lookup"><span data-stu-id="e8d89-213">If this namespace doesn’t resolve, be sure that you have added the StackExchange.Redis NuGet package as described in [Configure the cache clients](cache-dotnet-how-to-use-azure-redis-cache.md#configure-the-cache-clients).</span></span>

> [!NOTE]
> <span data-ttu-id="e8d89-214">Observe que o cliente StackExchange.Redis requer o .NET Framework 4 ou superior.</span><span class="sxs-lookup"><span data-stu-id="e8d89-214">Note that the StackExchange.Redis client requires .NET Framework 4 or higher.</span></span>
> 
> 

<span data-ttu-id="e8d89-215">Para se conectar a uma instância de Cache Redis do Azure, chame o método estático `ConnectionMultiplexer.Connect` e passe-o na chave e no ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="e8d89-215">To connect to an Azure Redis Cache instance, call the static `ConnectionMultiplexer.Connect` method and pass in the endpoint and key.</span></span> <span data-ttu-id="e8d89-216">Uma abordagem para compartilhar uma instância do `ConnectionMultiplexer` em seu aplicativo deve ter uma propriedade estática que retorna uma instância conectada, semelhante ao exemplo a seguir.</span><span class="sxs-lookup"><span data-stu-id="e8d89-216">One approach to sharing a `ConnectionMultiplexer` instance in your application is to have a static property that returns a connected instance, similar to the following example.</span></span> <span data-ttu-id="e8d89-217">Isso oferece uma maneira segura para o thread para inicializar somente uma única instância conectada do `ConnectionMultiplexer` .</span><span class="sxs-lookup"><span data-stu-id="e8d89-217">This provides a thread-safe way to initialize only a single connected `ConnectionMultiplexer` instance.</span></span> <span data-ttu-id="e8d89-218">Neste exemplo, `abortConnect` é definido como false, o que significa que a chamada terá êxito mesmo que não seja possível estabelecer uma conexão com o cache.</span><span class="sxs-lookup"><span data-stu-id="e8d89-218">In this example `abortConnect` is set to false, which means that the call will succeed even if a connection to the cache is not established.</span></span> <span data-ttu-id="e8d89-219">Um recurso chave do `ConnectionMultiplexer` é que ele vai restaurar automaticamente a conectividade ao cache assim que o problema de rede ou outras causas sejam resolvidos.</span><span class="sxs-lookup"><span data-stu-id="e8d89-219">One key feature of `ConnectionMultiplexer` is that it will automatically restore connectivity to the cache once the network issue or other causes are resolved.</span></span>

```c#
private static Lazy<ConnectionMultiplexer> lazyConnection = new Lazy<ConnectionMultiplexer>(() =>
{
    return ConnectionMultiplexer.Connect("contoso5.redis.cache.windows.net,abortConnect=false,ssl=true,password=...");
});

public static ConnectionMultiplexer Connection
{
    get
    {
        return lazyConnection.Value;
    }
}
```

<span data-ttu-id="e8d89-220">O ponto de extremidade do cache, as chaves e portas podem ser obtidos na folha **Cache Redis** de sua instância de cache.</span><span class="sxs-lookup"><span data-stu-id="e8d89-220">The cache endpoint, keys, and ports can be obtained from the **Redis Cache** blade for your cache instance.</span></span> <span data-ttu-id="e8d89-221">Para obter mais informações, consulte as [Propriedades do Cache Redis](cache-configure.md#properties).</span><span class="sxs-lookup"><span data-stu-id="e8d89-221">For more information, see [Redis Cache properties](cache-configure.md#properties).</span></span>

<span data-ttu-id="e8d89-222">Quando a conexão for estabelecida, retorne uma referência para o banco de dados do redis cache chamando o método `ConnectionMultiplexer.GetDatabase` .</span><span class="sxs-lookup"><span data-stu-id="e8d89-222">Once the connection is established, return a reference to the Redis cache database by calling the `ConnectionMultiplexer.GetDatabase` method.</span></span> <span data-ttu-id="e8d89-223">O objeto retornado pelo método `GetDatabase` é um objeto leve de passagem e não precisa ser armazenado.</span><span class="sxs-lookup"><span data-stu-id="e8d89-223">The object returned from the `GetDatabase` method is a lightweight pass-through object and does not need to be stored.</span></span>

```c#
IDatabase cache = Connection.GetDatabase();

// Perform cache operations using the cache object...
// Simple put of integral data types into the cache
cache.StringSet("key1", "value");
cache.StringSet("key2", 25);

// Simple get of data types from the cache
string key1 = cache.StringGet("key1");
int key2 = (int)cache.StringGet("key2");
```

<span data-ttu-id="e8d89-224">O cliente StackExchange.Redis usa os tipos `RedisKey` e `RedisValue` tipos para acessar e armazenar itens no cache.</span><span class="sxs-lookup"><span data-stu-id="e8d89-224">The StackExchange.Redis client uses the `RedisKey` and `RedisValue` types for accessing and storing items in the cache.</span></span> <span data-ttu-id="e8d89-225">Esses tipos mapeiam para tipos de linguagem mais primitivos, incluindo a cadeia de caracteres e geralmente não são usados diretamente.</span><span class="sxs-lookup"><span data-stu-id="e8d89-225">These types map onto most primitive language types, including string, and often are not used directly.</span></span> <span data-ttu-id="e8d89-226">As Cadeias de caracteres Redis são o tipo mais básico de valor do Redis e podem conter muitos tipos de dados, incluindo fluxos de binários serializados e apesar de você não poderá usar o tipo diretamente, você usará métodos que contêm `String` no nome.</span><span class="sxs-lookup"><span data-stu-id="e8d89-226">Redis Strings are the most basic kind of Redis value, and can contain many types of data, including serialized binary streams, and while you may not use the type directly, you will use methods that contain `String` in the name.</span></span> <span data-ttu-id="e8d89-227">Para a maioria dos tipos de dados primitivos você armazena e recupera itens do cache usando os métodos `StringSet` e `StringGet`, a menos que você pretenda armazenar coleções ou outros tipos de dados Redis no cache.</span><span class="sxs-lookup"><span data-stu-id="e8d89-227">For most primitive data types you store and retrieve items from the cache using the `StringSet` and `StringGet` methods, unless you are storing collections or other Redis data types in the cache.</span></span> 

<span data-ttu-id="e8d89-228">`StringSet` e `StringGet` são muito semelhantes aos métodos `Put` e `Get` do Serviço de Cache Gerenciado, com uma grande diferença de que antes de definir e obter um objeto .NET no cache você deve serializá-lo primeiro.</span><span class="sxs-lookup"><span data-stu-id="e8d89-228">`StringSet` and `StringGet` are very similar to the Managed Cache Service `Put` and `Get` methods, with one major difference being that before you set and get a .NET object into the cache you must serialize it first.</span></span> 

<span data-ttu-id="e8d89-229">Ao se chamar `StringGet`, se o objeto existir, ele será retornado e, se não existir, será retornado nulo.</span><span class="sxs-lookup"><span data-stu-id="e8d89-229">When calling `StringGet`, if the object exists, it is returned, and if it does not, null is returned.</span></span> <span data-ttu-id="e8d89-230">Nesse caso você pode recuperar o valor da fonte de dados desejado e armazená-lo no cache para uso subsequente.</span><span class="sxs-lookup"><span data-stu-id="e8d89-230">In this case you can retrieve the value from the desired data source and store it in the cache for subsequent use.</span></span> <span data-ttu-id="e8d89-231">Isso é conhecido como o padrão cache-aside.</span><span class="sxs-lookup"><span data-stu-id="e8d89-231">This is known as the cache-aside pattern.</span></span>

<span data-ttu-id="e8d89-232">Para especificar a expiração de um item no cache, use o parâmetro `TimeSpan` de `StringSet`.</span><span class="sxs-lookup"><span data-stu-id="e8d89-232">To specify the expiration of an item in the cache, use the `TimeSpan` parameter of `StringSet`.</span></span>

```c#
cache.StringSet("key1", "value1", TimeSpan.FromMinutes(90));
```

<span data-ttu-id="e8d89-233">O Cache Redis do Azure pode trabalhar com objetos .NET, bem como tipos de dados primitivos, mas antes que um objeto .NET possa ser armazenado em cache, ele deve ser serializado.</span><span class="sxs-lookup"><span data-stu-id="e8d89-233">Azure Redis Cache can work with .NET objects as well as primitive data types, but before a .NET object can be cached it must be serialized.</span></span> <span data-ttu-id="e8d89-234">Isso é responsabilidade do desenvolvedor do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e8d89-234">This is the responsibility of the application developer.</span></span> <span data-ttu-id="e8d89-235">Isso oferece flexibilidade ao desenvolvedor na escolha do serializador.</span><span class="sxs-lookup"><span data-stu-id="e8d89-235">This gives the developer flexibility in the choice of the serializer.</span></span> <span data-ttu-id="e8d89-236">Para obter mais informações e um código de exemplo, consulte [Trabalhar com objetos .NET no cache](cache-dotnet-how-to-use-azure-redis-cache.md#work-with-net-objects-in-the-cache).</span><span class="sxs-lookup"><span data-stu-id="e8d89-236">For more information and sample code, see [Work with .NET objects in the cache](cache-dotnet-how-to-use-azure-redis-cache.md#work-with-net-objects-in-the-cache).</span></span>

## <a name="migrate-aspnet-session-state-and-output-caching-to-azure-redis-cache"></a><span data-ttu-id="e8d89-237">Migrar o Estado de sessão do ASP.NET e cache de saída para o Cache Redis do Azure</span><span class="sxs-lookup"><span data-stu-id="e8d89-237">Migrate ASP.NET Session State and Output caching to Azure Redis Cache</span></span>
<span data-ttu-id="e8d89-238">O Cache Redis do Azure possui provedores de Estado da Sessão ASP.NET e o caching de Saída de Página.</span><span class="sxs-lookup"><span data-stu-id="e8d89-238">Azure Redis Cache has providers for both ASP.NET Session State and Page Output caching.</span></span> <span data-ttu-id="e8d89-239">Para migrar seu aplicativo que usa as versões de Serviço de Cache Gerenciado desses provedores, primeiro remova as seções existentes do web.config e configure as versões de Cache Redis do Azure dos provedores.</span><span class="sxs-lookup"><span data-stu-id="e8d89-239">To migrate your application that uses the Managed Cache Service versions of these providers, first remove the existing sections from your web.config, and then configure the Azure Redis Cache versions of the providers.</span></span> <span data-ttu-id="e8d89-240">Para obter instruções sobre como usar os provedores ASP.NET de Cache Redis do Azure, consulte [Provedor de estado de sessão ASP.NET para Cache Redis do Azure](cache-aspnet-session-state-provider.md) e [Provedor de Cache de saída do ASP.NET para Cache Redis do Azure](cache-aspnet-output-cache-provider.md).</span><span class="sxs-lookup"><span data-stu-id="e8d89-240">For instructions on using the Azure Redis Cache ASP.NET providers, see [ASP.NET Session State Provider for Azure Redis Cache](cache-aspnet-session-state-provider.md) and [ASP.NET Output Cache Provider for Azure Redis Cache](cache-aspnet-output-cache-provider.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="e8d89-241">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="e8d89-241">Next steps</span></span>
<span data-ttu-id="e8d89-242">Explore a [documentação do Cache Redis do Azure](https://azure.microsoft.com/documentation/services/cache/) e veja os tutoriais, exemplos, vídeos e muito mais.</span><span class="sxs-lookup"><span data-stu-id="e8d89-242">Explore the [Azure Redis Cache documentation](https://azure.microsoft.com/documentation/services/cache/) for tutorials, samples, videos, and more.</span></span>

