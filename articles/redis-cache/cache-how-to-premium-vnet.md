---
title: Configurar a Rede Virtual para um Cache Redis do Azure Premium | Microsoft Docs
description: "Saiba como criar e gerenciar o suporte de Rede Virtual para as instâncias da camada Premium do Cache Redis do Azure"
services: redis-cache
documentationcenter: 
author: steved0x
manager: douge
editor: 
ms.assetid: 8b1e43a0-a70e-41e6-8994-0ac246d8bf7f
ms.service: cache
ms.workload: tbd
ms.tgt_pltfrm: cache-redis
ms.devlang: na
ms.topic: article
ms.date: 05/15/2017
ms.author: sdanie
ms.openlocfilehash: 59d46990e02c0719d2b4df01e216a97fd649c509
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/18/2017
---
# <a name="how-to-configure-virtual-network-support-for-a-premium-azure-redis-cache"></a><span data-ttu-id="743fb-103">Como configurar o suporte de Rede Virtual para um Cache Redis do Azure Premium</span><span class="sxs-lookup"><span data-stu-id="743fb-103">How to configure Virtual Network Support for a Premium Azure Redis Cache</span></span>
<span data-ttu-id="743fb-104">O Cache Redis do Azure apresenta diferentes ofertas de cache que fornecem flexibilidade na escolha do tamanho e dos recursos de cache, incluindo recursos do nível Premium, como clustering, persistência e suporte à rede virtual.</span><span class="sxs-lookup"><span data-stu-id="743fb-104">Azure Redis Cache has different cache offerings, which provide flexibility in the choice of cache size and features, including Premium tier features such as clustering, persistence, and virtual network support.</span></span> <span data-ttu-id="743fb-105">Uma VNet é uma rede privada na nuvem.</span><span class="sxs-lookup"><span data-stu-id="743fb-105">A VNet is a private network in the cloud.</span></span> <span data-ttu-id="743fb-106">Quando uma instância do Cache Redis do Azure é configurada com uma Vnet, ela não é publicamente endereçável e pode ser acessada apenas de máquinas virtuais e aplicativos na VNet.</span><span class="sxs-lookup"><span data-stu-id="743fb-106">When an Azure Redis Cache instance is configured with a VNet, it is not publicly addressable and can only be accessed from virtual machines and applications within the VNet.</span></span> <span data-ttu-id="743fb-107">Este artigo descreve como configurar o suporte de rede virtual para uma instância Premium do Cache Redis do Azure.</span><span class="sxs-lookup"><span data-stu-id="743fb-107">This article describes how to configure virtual network support for a premium Azure Redis Cache instance.</span></span>

> [!NOTE]
> <span data-ttu-id="743fb-108">O Cache Redis do Azure dá suporte a VNets clássicas e do Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="743fb-108">Azure Redis Cache supports both classic and Resource Manager VNets.</span></span>
> 
> 

<span data-ttu-id="743fb-109">Para obter informações sobre outros recursos de cache premium, veja [Introdução à camada Premium do Cache Redis do Azure](cache-premium-tier-intro.md).</span><span class="sxs-lookup"><span data-stu-id="743fb-109">For information on other premium cache features, see [Introduction to the Azure Redis Cache Premium tier](cache-premium-tier-intro.md).</span></span>

## <a name="why-vnet"></a><span data-ttu-id="743fb-110">Por que a VNet?</span><span class="sxs-lookup"><span data-stu-id="743fb-110">Why VNet?</span></span>
<span data-ttu-id="743fb-111">A implantação da [VNet (Rede Virtual do Azure)](https://azure.microsoft.com/services/virtual-network/) fornece segurança e isolamento aprimorados para seu Cache Redis do Azure, além de todas as sub-redes, políticas de controle de acesso e outros recursos para obter acesso restrito adicional.</span><span class="sxs-lookup"><span data-stu-id="743fb-111">[Azure Virtual Network (VNet)](https://azure.microsoft.com/services/virtual-network/) deployment provides enhanced security and isolation for your Azure Redis Cache, as well as subnets, access control policies, and other features to further restrict access.</span></span>

## <a name="virtual-network-support"></a><span data-ttu-id="743fb-112">Suporte de rede virtual</span><span class="sxs-lookup"><span data-stu-id="743fb-112">Virtual network support</span></span>
<span data-ttu-id="743fb-113">O suporte da VNet (Rede Virtual) é configurado na folha **Novo Cache Redis** durante a criação do cache.</span><span class="sxs-lookup"><span data-stu-id="743fb-113">Virtual Network (VNet) support is configured on the **New Redis Cache** blade during cache creation.</span></span> 

[!INCLUDE [redis-cache-create](../../includes/redis-cache-premium-create.md)]

<span data-ttu-id="743fb-114">Depois de selecionar um tipo de preço Premium, você pode configurar a integração VNet do Redis selecionando uma VNet que está na mesma assinatura e localização que seu cache.</span><span class="sxs-lookup"><span data-stu-id="743fb-114">Once you have selected a premium pricing tier, you can configure Redis VNet integration by selecting a VNet that is in the same subscription and location as your cache.</span></span> <span data-ttu-id="743fb-115">Para usar uma nova VNet, crie-a primeiro seguindo as etapas em [Criar uma Rede Virtual usando o portal do Azure](../virtual-network/virtual-networks-create-vnet-arm-pportal.md) ou [Criar uma rede virtual (clássica) usando o portal do Azure](../virtual-network/virtual-networks-create-vnet-classic-pportal.md) e volte para a folha **Novo Cache Redis** para criar e configurar seu cache Premium.</span><span class="sxs-lookup"><span data-stu-id="743fb-115">To use a new VNet, create it first by following the steps in [Create a virtual network using the Azure portal](../virtual-network/virtual-networks-create-vnet-arm-pportal.md) or [Create a virtual network (classic) by using the Azure portal](../virtual-network/virtual-networks-create-vnet-classic-pportal.md) and then return to the **New Redis Cache** blade to create and configure your premium cache.</span></span>

<span data-ttu-id="743fb-116">Para configurar a VNet para seu novo cache, clique em **Rede Virtual** na folha **Novo Cache Redis** e selecione a VNet desejada na lista suspensa.</span><span class="sxs-lookup"><span data-stu-id="743fb-116">To configure the VNet for your new cache, click **Virtual Network** on the **New Redis Cache** blade, and select the desired VNet from the drop-down list.</span></span>

![Rede virtual][redis-cache-vnet]

<span data-ttu-id="743fb-118">Selecione a sub-rede desejada da lista suspensa **Sub-rede** e especifique o **Endereço IP estático** desejado.</span><span class="sxs-lookup"><span data-stu-id="743fb-118">Select the desired subnet from the **Subnet** drop-down list, and specify the desired **Static IP address**.</span></span> <span data-ttu-id="743fb-119">Se você estiver usando uma VNet clássica, o campo **Endereço IP estático** será opcional e, se não for especificado nenhum, será escolhido um da sub-rede selecionada.</span><span class="sxs-lookup"><span data-stu-id="743fb-119">If you are using a classic VNet the **Static IP address** field is optional, and if none is specified, one is chosen from the selected subnet.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="743fb-120">Ao implantar um Cache Redis do Azure em uma VNet do Resource Manager, o cache deve estar em uma sub-rede dedicada que não contém nenhum outro recurso, exceto o Cache Redis do Azure.</span><span class="sxs-lookup"><span data-stu-id="743fb-120">When deploying an Azure Redis Cache to a Resource Manager VNet, the cache must be in a dedicated subnet that contains no other resources except for Azure Redis Cache instances.</span></span> <span data-ttu-id="743fb-121">Se for feita uma tentativa de implantar um Cache Redis do Azure em uma VNet do Resource Manager para uma sub-rede contendo outros recursos, a implantação falhará.</span><span class="sxs-lookup"><span data-stu-id="743fb-121">If an attempt is made to deploy an Azure Redis Cache to a Resource Manager VNet to a subnet that contains other resources, the deployment fails.</span></span>
> 
> 

![Rede virtual][redis-cache-vnet-ip]

> [!IMPORTANT]
> <span data-ttu-id="743fb-123">O Azure reserva alguns endereços IP em cada sub-rede, os quais não podem ser usados.</span><span class="sxs-lookup"><span data-stu-id="743fb-123">Azure reserves some IP addresses within each subnet, and these addresses can't be used.</span></span> <span data-ttu-id="743fb-124">O primeiro e o último endereço IP das sub-redes são reservados para fins de conformidade de protocolo, juntamente com três outros endereços usados para os serviços do Azure.</span><span class="sxs-lookup"><span data-stu-id="743fb-124">The first and last IP addresses of the subnets are reserved for protocol conformance, along with three more addresses used for Azure services.</span></span> <span data-ttu-id="743fb-125">Para obter mais informações, consulte [Existem restrições quanto ao uso de endereços IP dentro dessas sub-redes?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span><span class="sxs-lookup"><span data-stu-id="743fb-125">For more information, see [Are there any restrictions on using IP addresses within these subnets?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span></span>
> 
> <span data-ttu-id="743fb-126">Além dos endereços IP usados pela infraestrutura do Azure VNET, cada instância de Redis na sub-rede usa dois endereços IP por fragmento e um endereço IP adicional para o balanceador de carga.</span><span class="sxs-lookup"><span data-stu-id="743fb-126">In addition to the IP addresses used by the Azure VNET infrastructure, each Redis instance in the subnet uses two IP addresses per shard and one additional IP address for the load balancer.</span></span> <span data-ttu-id="743fb-127">Considera-se que um cache não clusterizado tem um fragmento.</span><span class="sxs-lookup"><span data-stu-id="743fb-127">A non-clustered cache is considered to have one shard.</span></span>
> 
> 

<span data-ttu-id="743fb-128">Após o cache ser criado, você pode exibir a configuração da VNet clicando em **Rede Virtual** no menu **Recursos**.</span><span class="sxs-lookup"><span data-stu-id="743fb-128">After the cache is created, you can view the configuration for the VNet by clicking **Virtual Network** from the **Resource menu**.</span></span>

![Rede virtual][redis-cache-vnet-info]

<span data-ttu-id="743fb-130">Para se conectar à sua instância de Cache Redis do Azure usando uma VNet, especifique o nome do host do cache na cadeia de conexão, conforme mostrado no exemplo a seguir:</span><span class="sxs-lookup"><span data-stu-id="743fb-130">To connect to your Azure Redis cache instance when using a VNet, specify the host name of your cache in the connection string as shown in the following example:</span></span>

    private static Lazy<ConnectionMultiplexer> lazyConnection = new Lazy<ConnectionMultiplexer>(() =>
    {
        return ConnectionMultiplexer.Connect("contoso5premium.redis.cache.windows.net,abortConnect=false,ssl=true,password=password");
    });

    public static ConnectionMultiplexer Connection
    {
        get
        {
            return lazyConnection.Value;
        }
    }

## <a name="azure-redis-cache-vnet-faq"></a><span data-ttu-id="743fb-131">Perguntas frequentes sobre a Vnet do Cache Redis do Azure</span><span class="sxs-lookup"><span data-stu-id="743fb-131">Azure Redis Cache VNet FAQ</span></span>
<span data-ttu-id="743fb-132">A lista a seguir contém respostas para perguntas frequentes sobre a escala do Cache Redis do Azure.</span><span class="sxs-lookup"><span data-stu-id="743fb-132">The following list contains answers to commonly asked questions about the Azure Redis Cache scaling.</span></span>

* [<span data-ttu-id="743fb-133">Quais são alguns problemas comuns de configuração incorreta no Cache Redis do Azure e nas VNets?</span><span class="sxs-lookup"><span data-stu-id="743fb-133">What are some common misconfiguration issues with Azure Redis Cache and VNets?</span></span>](#what-are-some-common-misconfiguration-issues-with-azure-redis-cache-and-vnets)
* [<span data-ttu-id="743fb-134">Como verificar se o cache está funcionando em uma VNET?</span><span class="sxs-lookup"><span data-stu-id="743fb-134">How can I verify that my cache is working in a VNET?</span></span>](#how-can-i-verify-that-my-cache-is-working-in-a-vnet)
* [<span data-ttu-id="743fb-135">Posso usar VNets com um cache básico ou Standard?</span><span class="sxs-lookup"><span data-stu-id="743fb-135">Can I use VNets with a standard or basic cache?</span></span>](#can-i-use-vnets-with-a-standard-or-basic-cache)
* [<span data-ttu-id="743fb-136">Por que a criação de um cache Redis falha em algumas sub-redes, mas não em outras?</span><span class="sxs-lookup"><span data-stu-id="743fb-136">Why does creating a Redis cache fail in some subnets but not others?</span></span>](#why-does-creating-a-redis-cache-fail-in-some-subnets-but-not-others)
* [<span data-ttu-id="743fb-137">Quais são os requisitos de espaço de endereço de sub-rede?</span><span class="sxs-lookup"><span data-stu-id="743fb-137">What are the subnet address space requirements?</span></span>](#what-are-the-subnet-address-space-requirements)
* [<span data-ttu-id="743fb-138">Todos os recursos de cache funcionam ao hospedar um cache em uma rede virtual?</span><span class="sxs-lookup"><span data-stu-id="743fb-138">Do all cache features work when hosting a cache in a VNET?</span></span>](#do-all-cache-features-work-when-hosting-a-cache-in-a-vnet)

## <a name="what-are-some-common-misconfiguration-issues-with-azure-redis-cache-and-vnets"></a><span data-ttu-id="743fb-139">Quais são alguns problemas comuns de configuração incorreta no Cache Redis do Azure e nas VNets?</span><span class="sxs-lookup"><span data-stu-id="743fb-139">What are some common misconfiguration issues with Azure Redis Cache and VNets?</span></span>
<span data-ttu-id="743fb-140">Quando o Cache Redis do Azure estiver hospedado em uma VNet, as portas nas tabelas a seguir serão usadas.</span><span class="sxs-lookup"><span data-stu-id="743fb-140">When Azure Redis Cache is hosted in a VNet, the ports in the following tables are used.</span></span> 

>[!IMPORTANT]
><span data-ttu-id="743fb-141">Se as portas nas tabelas a seguir estiverem bloqueadas, é possível que o cache não funcione corretamente.</span><span class="sxs-lookup"><span data-stu-id="743fb-141">If the ports in the following tables are blocked, the cache may not function correctly.</span></span> <span data-ttu-id="743fb-142">A existência de uma ou mais dessas portas bloqueadas é o problema mais comum de configuração incorreta no uso do Cache Redis do Azure em uma VNet.</span><span class="sxs-lookup"><span data-stu-id="743fb-142">Having one or more of these ports blocked is the most common misconfiguration issue when using Azure Redis Cache in a VNet.</span></span>
> 
> 

- [<span data-ttu-id="743fb-143">Requisitos de porta de saída</span><span class="sxs-lookup"><span data-stu-id="743fb-143">Outbound port requirements</span></span>](#outbound-port-requirements)
- [<span data-ttu-id="743fb-144">Requisitos de porta de entrada</span><span class="sxs-lookup"><span data-stu-id="743fb-144">Inbound port requirements</span></span>](#inbound-port-requirements)

### <a name="outbound-port-requirements"></a><span data-ttu-id="743fb-145">Requisitos de porta de saída</span><span class="sxs-lookup"><span data-stu-id="743fb-145">Outbound port requirements</span></span>

<span data-ttu-id="743fb-146">Há sete requisitos de porta de saída.</span><span class="sxs-lookup"><span data-stu-id="743fb-146">There are seven outbound port requirements.</span></span>

- <span data-ttu-id="743fb-147">Se desejado, todas as conexões de saída à Internet podem ser feitas por meio de um dispositivo de auditoria local do cliente.</span><span class="sxs-lookup"><span data-stu-id="743fb-147">If desired, all outbound connections to the internet can be made through a client's on-premises auditing device.</span></span>
- <span data-ttu-id="743fb-148">Três das portas roteiam o tráfego para Pontos de Extremidade do Azure atendendo o Armazenamento do Azure e o DNS do Azure.</span><span class="sxs-lookup"><span data-stu-id="743fb-148">Three of the ports route traffic to Azure endpoints servicing Azure Storage and Azure DNS.</span></span>
- <span data-ttu-id="743fb-149">Os intervalos de portas restantes e para comunicações internas de sub-rede Redis.</span><span class="sxs-lookup"><span data-stu-id="743fb-149">The remaining port ranges and for internal Redis subnet communications.</span></span> <span data-ttu-id="743fb-150">Não é necessária nenhuma regra do NSG da sub-rede para as comunicações internas de sub-rede Redis.</span><span class="sxs-lookup"><span data-stu-id="743fb-150">No subnet NSG rules are required for internal Redis subnet communications.</span></span>

| <span data-ttu-id="743fb-151">Porta(s)</span><span class="sxs-lookup"><span data-stu-id="743fb-151">Port(s)</span></span> | <span data-ttu-id="743fb-152">Direção</span><span class="sxs-lookup"><span data-stu-id="743fb-152">Direction</span></span> | <span data-ttu-id="743fb-153">Protocolo de Transporte</span><span class="sxs-lookup"><span data-stu-id="743fb-153">Transport Protocol</span></span> | <span data-ttu-id="743fb-154">Finalidade</span><span class="sxs-lookup"><span data-stu-id="743fb-154">Purpose</span></span> | <span data-ttu-id="743fb-155">IP local</span><span class="sxs-lookup"><span data-stu-id="743fb-155">Local IP</span></span> | <span data-ttu-id="743fb-156">IP Remoto</span><span class="sxs-lookup"><span data-stu-id="743fb-156">Remote IP</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="743fb-157">80, 443</span><span class="sxs-lookup"><span data-stu-id="743fb-157">80, 443</span></span> |<span data-ttu-id="743fb-158">Saída</span><span class="sxs-lookup"><span data-stu-id="743fb-158">Outbound</span></span> |<span data-ttu-id="743fb-159">TCP</span><span class="sxs-lookup"><span data-stu-id="743fb-159">TCP</span></span> |<span data-ttu-id="743fb-160">Dependências de Redis no Armazenamento do Azure/PKI (Internet)</span><span class="sxs-lookup"><span data-stu-id="743fb-160">Redis dependencies on Azure Storage/PKI (Internet)</span></span> | <span data-ttu-id="743fb-161">(Sub-rede Redis)</span><span class="sxs-lookup"><span data-stu-id="743fb-161">(Redis subnet)</span></span> |* |
| <span data-ttu-id="743fb-162">53</span><span class="sxs-lookup"><span data-stu-id="743fb-162">53</span></span> |<span data-ttu-id="743fb-163">Saída</span><span class="sxs-lookup"><span data-stu-id="743fb-163">Outbound</span></span> |<span data-ttu-id="743fb-164">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="743fb-164">TCP/UDP</span></span> |<span data-ttu-id="743fb-165">Dependências Redis no DNS (Internet/Rede Virtual)</span><span class="sxs-lookup"><span data-stu-id="743fb-165">Redis dependencies on DNS (Internet/VNet)</span></span> | <span data-ttu-id="743fb-166">(Sub-rede Redis)</span><span class="sxs-lookup"><span data-stu-id="743fb-166">(Redis subnet)</span></span> |* |
| <span data-ttu-id="743fb-167">8443</span><span class="sxs-lookup"><span data-stu-id="743fb-167">8443</span></span> |<span data-ttu-id="743fb-168">Saída</span><span class="sxs-lookup"><span data-stu-id="743fb-168">Outbound</span></span> |<span data-ttu-id="743fb-169">TCP</span><span class="sxs-lookup"><span data-stu-id="743fb-169">TCP</span></span> |<span data-ttu-id="743fb-170">Comunicações internas para Redis</span><span class="sxs-lookup"><span data-stu-id="743fb-170">Internal communications for Redis</span></span> | <span data-ttu-id="743fb-171">(Sub-rede Redis)</span><span class="sxs-lookup"><span data-stu-id="743fb-171">(Redis subnet)</span></span> | <span data-ttu-id="743fb-172">(Sub-rede Redis)</span><span class="sxs-lookup"><span data-stu-id="743fb-172">(Redis subnet)</span></span> |
| <span data-ttu-id="743fb-173">10221-10231</span><span class="sxs-lookup"><span data-stu-id="743fb-173">10221-10231</span></span> |<span data-ttu-id="743fb-174">Saída</span><span class="sxs-lookup"><span data-stu-id="743fb-174">Outbound</span></span> |<span data-ttu-id="743fb-175">TCP</span><span class="sxs-lookup"><span data-stu-id="743fb-175">TCP</span></span> |<span data-ttu-id="743fb-176">Comunicações internas para Redis</span><span class="sxs-lookup"><span data-stu-id="743fb-176">Internal communications for Redis</span></span> | <span data-ttu-id="743fb-177">(Sub-rede Redis)</span><span class="sxs-lookup"><span data-stu-id="743fb-177">(Redis subnet)</span></span> | <span data-ttu-id="743fb-178">(Sub-rede Redis)</span><span class="sxs-lookup"><span data-stu-id="743fb-178">(Redis subnet)</span></span> |
| <span data-ttu-id="743fb-179">20226</span><span class="sxs-lookup"><span data-stu-id="743fb-179">20226</span></span> |<span data-ttu-id="743fb-180">Saída</span><span class="sxs-lookup"><span data-stu-id="743fb-180">Outbound</span></span> |<span data-ttu-id="743fb-181">TCP</span><span class="sxs-lookup"><span data-stu-id="743fb-181">TCP</span></span> |<span data-ttu-id="743fb-182">Comunicações internas para Redis</span><span class="sxs-lookup"><span data-stu-id="743fb-182">Internal communications for Redis</span></span> | <span data-ttu-id="743fb-183">(Sub-rede Redis)</span><span class="sxs-lookup"><span data-stu-id="743fb-183">(Redis subnet)</span></span> |<span data-ttu-id="743fb-184">(Sub-rede Redis)</span><span class="sxs-lookup"><span data-stu-id="743fb-184">(Redis subnet)</span></span> |
| <span data-ttu-id="743fb-185">13000-13999</span><span class="sxs-lookup"><span data-stu-id="743fb-185">13000-13999</span></span> |<span data-ttu-id="743fb-186">Saída</span><span class="sxs-lookup"><span data-stu-id="743fb-186">Outbound</span></span> |<span data-ttu-id="743fb-187">TCP</span><span class="sxs-lookup"><span data-stu-id="743fb-187">TCP</span></span> |<span data-ttu-id="743fb-188">Comunicações internas para Redis</span><span class="sxs-lookup"><span data-stu-id="743fb-188">Internal communications for Redis</span></span> | <span data-ttu-id="743fb-189">(Sub-rede Redis)</span><span class="sxs-lookup"><span data-stu-id="743fb-189">(Redis subnet)</span></span> |<span data-ttu-id="743fb-190">(Sub-rede Redis)</span><span class="sxs-lookup"><span data-stu-id="743fb-190">(Redis subnet)</span></span> |
| <span data-ttu-id="743fb-191">15000-15999</span><span class="sxs-lookup"><span data-stu-id="743fb-191">15000-15999</span></span> |<span data-ttu-id="743fb-192">Saída</span><span class="sxs-lookup"><span data-stu-id="743fb-192">Outbound</span></span> |<span data-ttu-id="743fb-193">TCP</span><span class="sxs-lookup"><span data-stu-id="743fb-193">TCP</span></span> |<span data-ttu-id="743fb-194">Comunicações internas para Redis</span><span class="sxs-lookup"><span data-stu-id="743fb-194">Internal communications for Redis</span></span> | <span data-ttu-id="743fb-195">(Sub-rede Redis)</span><span class="sxs-lookup"><span data-stu-id="743fb-195">(Redis subnet)</span></span> |<span data-ttu-id="743fb-196">(Sub-rede Redis)</span><span class="sxs-lookup"><span data-stu-id="743fb-196">(Redis subnet)</span></span> |


### <a name="inbound-port-requirements"></a><span data-ttu-id="743fb-197">Requisitos de porta de entrada</span><span class="sxs-lookup"><span data-stu-id="743fb-197">Inbound port requirements</span></span>

<span data-ttu-id="743fb-198">Há oito requisitos de intervalo de portas de entrada.</span><span class="sxs-lookup"><span data-stu-id="743fb-198">There are eight inbound port range requirements.</span></span> <span data-ttu-id="743fb-199">As solicitações de entrada nesses intervalos são recebidas de outros serviços hospedados na mesma VNET ou internas para as comunicações de sub-rede Redis.</span><span class="sxs-lookup"><span data-stu-id="743fb-199">Inbound requests in these ranges are either inbound from other services hosted in the same VNET or internal to the Redis subnet communications.</span></span>

| <span data-ttu-id="743fb-200">Porta(s)</span><span class="sxs-lookup"><span data-stu-id="743fb-200">Port(s)</span></span> | <span data-ttu-id="743fb-201">Direção</span><span class="sxs-lookup"><span data-stu-id="743fb-201">Direction</span></span> | <span data-ttu-id="743fb-202">Protocolo de Transporte</span><span class="sxs-lookup"><span data-stu-id="743fb-202">Transport Protocol</span></span> | <span data-ttu-id="743fb-203">Finalidade</span><span class="sxs-lookup"><span data-stu-id="743fb-203">Purpose</span></span> | <span data-ttu-id="743fb-204">IP local</span><span class="sxs-lookup"><span data-stu-id="743fb-204">Local IP</span></span> | <span data-ttu-id="743fb-205">IP Remoto</span><span class="sxs-lookup"><span data-stu-id="743fb-205">Remote IP</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="743fb-206">6379, 6380</span><span class="sxs-lookup"><span data-stu-id="743fb-206">6379, 6380</span></span> |<span data-ttu-id="743fb-207">Entrada</span><span class="sxs-lookup"><span data-stu-id="743fb-207">Inbound</span></span> |<span data-ttu-id="743fb-208">TCP</span><span class="sxs-lookup"><span data-stu-id="743fb-208">TCP</span></span> |<span data-ttu-id="743fb-209">Comunicação do cliente com o Redis, Balanceamento de Carga do Azure</span><span class="sxs-lookup"><span data-stu-id="743fb-209">Client communication to Redis, Azure load balancing</span></span> | <span data-ttu-id="743fb-210">(Sub-rede Redis)</span><span class="sxs-lookup"><span data-stu-id="743fb-210">(Redis subnet)</span></span> |<span data-ttu-id="743fb-211">Rede virtual, Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="743fb-211">Virtual Network, Azure Load Balancer</span></span> |
| <span data-ttu-id="743fb-212">8443</span><span class="sxs-lookup"><span data-stu-id="743fb-212">8443</span></span> |<span data-ttu-id="743fb-213">Entrada</span><span class="sxs-lookup"><span data-stu-id="743fb-213">Inbound</span></span> |<span data-ttu-id="743fb-214">TCP</span><span class="sxs-lookup"><span data-stu-id="743fb-214">TCP</span></span> |<span data-ttu-id="743fb-215">Comunicações internas para Redis</span><span class="sxs-lookup"><span data-stu-id="743fb-215">Internal communications for Redis</span></span> | <span data-ttu-id="743fb-216">(Sub-rede Redis)</span><span class="sxs-lookup"><span data-stu-id="743fb-216">(Redis subnet)</span></span> |<span data-ttu-id="743fb-217">(Sub-rede Redis)</span><span class="sxs-lookup"><span data-stu-id="743fb-217">(Redis subnet)</span></span> |
| <span data-ttu-id="743fb-218">8500</span><span class="sxs-lookup"><span data-stu-id="743fb-218">8500</span></span> |<span data-ttu-id="743fb-219">Entrada</span><span class="sxs-lookup"><span data-stu-id="743fb-219">Inbound</span></span> |<span data-ttu-id="743fb-220">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="743fb-220">TCP/UDP</span></span> |<span data-ttu-id="743fb-221">Balanceamento de Carga do Azure</span><span class="sxs-lookup"><span data-stu-id="743fb-221">Azure load balancing</span></span> | <span data-ttu-id="743fb-222">(Sub-rede Redis)</span><span class="sxs-lookup"><span data-stu-id="743fb-222">(Redis subnet)</span></span> |<span data-ttu-id="743fb-223">Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="743fb-223">Azure Load Balancer</span></span> |
| <span data-ttu-id="743fb-224">10221-10231</span><span class="sxs-lookup"><span data-stu-id="743fb-224">10221-10231</span></span> |<span data-ttu-id="743fb-225">Entrada</span><span class="sxs-lookup"><span data-stu-id="743fb-225">Inbound</span></span> |<span data-ttu-id="743fb-226">TCP</span><span class="sxs-lookup"><span data-stu-id="743fb-226">TCP</span></span> |<span data-ttu-id="743fb-227">Comunicações internas para Redis</span><span class="sxs-lookup"><span data-stu-id="743fb-227">Internal communications for Redis</span></span> | <span data-ttu-id="743fb-228">(Sub-rede Redis)</span><span class="sxs-lookup"><span data-stu-id="743fb-228">(Redis subnet)</span></span> |<span data-ttu-id="743fb-229">(Sub-rede Redus), Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="743fb-229">(Redis subnet), Azure Load Balancer</span></span> |
| <span data-ttu-id="743fb-230">13000-13999</span><span class="sxs-lookup"><span data-stu-id="743fb-230">13000-13999</span></span> |<span data-ttu-id="743fb-231">Entrada</span><span class="sxs-lookup"><span data-stu-id="743fb-231">Inbound</span></span> |<span data-ttu-id="743fb-232">TCP</span><span class="sxs-lookup"><span data-stu-id="743fb-232">TCP</span></span> |<span data-ttu-id="743fb-233">Comunicação do cliente com Clusters Redis, Balanceamento de Carga do Azure</span><span class="sxs-lookup"><span data-stu-id="743fb-233">Client communication to Redis Clusters, Azure load balancing</span></span> | <span data-ttu-id="743fb-234">(Sub-rede Redis)</span><span class="sxs-lookup"><span data-stu-id="743fb-234">(Redis subnet)</span></span> |<span data-ttu-id="743fb-235">Rede virtual, Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="743fb-235">Virtual Network, Azure Load Balancer</span></span> |
| <span data-ttu-id="743fb-236">15000-15999</span><span class="sxs-lookup"><span data-stu-id="743fb-236">15000-15999</span></span> |<span data-ttu-id="743fb-237">Entrada</span><span class="sxs-lookup"><span data-stu-id="743fb-237">Inbound</span></span> |<span data-ttu-id="743fb-238">TCP</span><span class="sxs-lookup"><span data-stu-id="743fb-238">TCP</span></span> |<span data-ttu-id="743fb-239">Comunicação do cliente com Clusters Redis, Balanceamento de Carga do Azure</span><span class="sxs-lookup"><span data-stu-id="743fb-239">Client communication to Redis Clusters, Azure load Balancing</span></span> | <span data-ttu-id="743fb-240">(Sub-rede Redis)</span><span class="sxs-lookup"><span data-stu-id="743fb-240">(Redis subnet)</span></span> |<span data-ttu-id="743fb-241">Rede virtual, Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="743fb-241">Virtual Network, Azure Load Balancer</span></span> |
| <span data-ttu-id="743fb-242">16001</span><span class="sxs-lookup"><span data-stu-id="743fb-242">16001</span></span> |<span data-ttu-id="743fb-243">Entrada</span><span class="sxs-lookup"><span data-stu-id="743fb-243">Inbound</span></span> |<span data-ttu-id="743fb-244">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="743fb-244">TCP/UDP</span></span> |<span data-ttu-id="743fb-245">Balanceamento de Carga do Azure</span><span class="sxs-lookup"><span data-stu-id="743fb-245">Azure load balancing</span></span> | <span data-ttu-id="743fb-246">(Sub-rede Redis)</span><span class="sxs-lookup"><span data-stu-id="743fb-246">(Redis subnet)</span></span> |<span data-ttu-id="743fb-247">Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="743fb-247">Azure Load Balancer</span></span> |
| <span data-ttu-id="743fb-248">20226</span><span class="sxs-lookup"><span data-stu-id="743fb-248">20226</span></span> |<span data-ttu-id="743fb-249">Entrada</span><span class="sxs-lookup"><span data-stu-id="743fb-249">Inbound</span></span> |<span data-ttu-id="743fb-250">TCP</span><span class="sxs-lookup"><span data-stu-id="743fb-250">TCP</span></span> |<span data-ttu-id="743fb-251">Comunicações internas para Redis</span><span class="sxs-lookup"><span data-stu-id="743fb-251">Internal communications for Redis</span></span> | <span data-ttu-id="743fb-252">(Sub-rede Redis)</span><span class="sxs-lookup"><span data-stu-id="743fb-252">(Redis subnet)</span></span> |<span data-ttu-id="743fb-253">(Sub-rede Redis)</span><span class="sxs-lookup"><span data-stu-id="743fb-253">(Redis subnet)</span></span> |

### <a name="additional-vnet-network-connectivity-requirements"></a><span data-ttu-id="743fb-254">Requisitos de conectividade de rede VNET adicionais</span><span class="sxs-lookup"><span data-stu-id="743fb-254">Additional VNET network connectivity requirements</span></span>

<span data-ttu-id="743fb-255">Há requisitos de conectividade de rede para o Cache Redis do Azure que podem não ser atendidos inicialmente em uma rede virtual.</span><span class="sxs-lookup"><span data-stu-id="743fb-255">There are network connectivity requirements for Azure Redis Cache that may not be initially met in a virtual network.</span></span> <span data-ttu-id="743fb-256">O Cache Redis do Azure requer todos os itens a seguir para funcionar corretamente quando usado em uma rede virtual.</span><span class="sxs-lookup"><span data-stu-id="743fb-256">Azure Redis Cache requires all the following items to function properly when used within a virtual network.</span></span>

* <span data-ttu-id="743fb-257">Conectividade de rede de saída para pontos de extremidade do Armazenamento do Azure em todo o mundo.</span><span class="sxs-lookup"><span data-stu-id="743fb-257">Outbound network connectivity to Azure Storage endpoints worldwide.</span></span> <span data-ttu-id="743fb-258">Isso inclui os pontos de extremidade localizados na mesma região que a instância do Cache Redis do Azure, bem como os pontos de extremidade de armazenamento localizados em **outras** regiões do Azure.</span><span class="sxs-lookup"><span data-stu-id="743fb-258">This includes endpoints located in the same region as the Azure Redis Cache instance, as well as storage endpoints located in **other** Azure regions.</span></span> <span data-ttu-id="743fb-259">Os pontos de extremidade do Armazenamento do Azure são resolvidos nos seguintes domínios DNS: *table.core.windows.net*, *blob.core.windows.net*, *queue.core.windows.net* e *file.core.windows.net*.</span><span class="sxs-lookup"><span data-stu-id="743fb-259">Azure Storage endpoints resolve under the following DNS domains: *table.core.windows.net*, *blob.core.windows.net*, *queue.core.windows.net*, and *file.core.windows.net*.</span></span> 
* <span data-ttu-id="743fb-260">Conectividade de rede de saída para *ocsp.msocsp.com*, *mscrl.microsoft.com* e *crl.microsoft.com*. Essa conectividade é necessária para dar suporte à funcionalidade SSL.</span><span class="sxs-lookup"><span data-stu-id="743fb-260">Outbound network connectivity to *ocsp.msocsp.com*, *mscrl.microsoft.com*, and *crl.microsoft.com*. This connectivity is needed to support SSL functionality.</span></span>
* <span data-ttu-id="743fb-261">A configuração DNS para a rede virtual deve ser capaz de resolver todos os pontos de extremidade e domínios mencionados nos pontos anteriores.</span><span class="sxs-lookup"><span data-stu-id="743fb-261">The DNS configuration for the virtual network must be capable of resolving all of the endpoints and domains mentioned in the earlier points.</span></span> <span data-ttu-id="743fb-262">Esses requisitos de DNS podem ser atendidos, garantindo que uma infraestrutura de DNS válida seja configurada e mantida para a rede virtual.</span><span class="sxs-lookup"><span data-stu-id="743fb-262">These DNS requirements can be met by ensuring a valid DNS infrastructure is configured and maintained for the virtual network.</span></span>
* <span data-ttu-id="743fb-263">Conectividade de rede de saída para os seguintes pontos de extremidade do Azure Monitoring resolvidos nos domínios DNS a seguir: shoebox2-black.shoebox2.metrics.nsatc.net, north-prod2.prod2.metrics.nsatc.net, azglobal-black.azglobal.metrics.nsatc.net, shoebox2-red.shoebox2.metrics.nsatc.net, east-prod2.prod2.metrics.nsatc.net, azglobal-red.azglobal.metrics.nsatc.net.</span><span class="sxs-lookup"><span data-stu-id="743fb-263">Outbound network connectivity to the following Azure Monitoring endpoints, which resolve under the following DNS domains: shoebox2-black.shoebox2.metrics.nsatc.net, north-prod2.prod2.metrics.nsatc.net, azglobal-black.azglobal.metrics.nsatc.net, shoebox2-red.shoebox2.metrics.nsatc.net, east-prod2.prod2.metrics.nsatc.net, azglobal-red.azglobal.metrics.nsatc.net.</span></span>

### <a name="how-can-i-verify-that-my-cache-is-working-in-a-vnet"></a><span data-ttu-id="743fb-264">Como verificar se o cache está funcionando em uma VNET?</span><span class="sxs-lookup"><span data-stu-id="743fb-264">How can I verify that my cache is working in a VNET?</span></span>

>[!IMPORTANT]
><span data-ttu-id="743fb-265">Ao se conectar a uma instância de Cache Redis do Azure que é hospedada em uma VNET, os clientes de cache devem estar na mesma VNET, incluindo quaisquer aplicativos de teste ou ferramentas de diagnóstico do ping.</span><span class="sxs-lookup"><span data-stu-id="743fb-265">When connecting to an Azure Redis Cache instance that is hosted in a VNET, your cache clients must be in the same VNET, including any test applications or diagnostic pinging tools.</span></span>
>
>

<span data-ttu-id="743fb-266">Uma vez configurados os requisitos de porta conforme descrito na seção anterior, você pode verificar se o cache está funcionando executando as etapas a seguir.</span><span class="sxs-lookup"><span data-stu-id="743fb-266">Once the port requirements are configured as described in the previous section, you can verify that your cache is working by performing the following steps.</span></span>

- <span data-ttu-id="743fb-267">[Reinicialize](cache-administration.md#reboot) todos os nós de cache.</span><span class="sxs-lookup"><span data-stu-id="743fb-267">[Reboot](cache-administration.md#reboot) all of the cache nodes.</span></span> <span data-ttu-id="743fb-268">Se todas as dependências de cache necessárias não podem ser acessadas (conforme documentado em [Requisitos de porta de entrada](cache-how-to-premium-vnet.md#inbound-port-requirements) e [Requisitos de porta de saída](cache-how-to-premium-vnet.md#outbound-port-requirements)), não será possível reiniciar o cache com êxito.</span><span class="sxs-lookup"><span data-stu-id="743fb-268">If all of the required cache dependencies can't be reached (as documented in [Inbound port requirements](cache-how-to-premium-vnet.md#inbound-port-requirements) and [Outbound port requirements](cache-how-to-premium-vnet.md#outbound-port-requirements)), the cache won't be able to restart successfully.</span></span>
- <span data-ttu-id="743fb-269">Uma vez que os nós de cache tenham reinicializado (conforme relatado pelo status de cache no portal do Azure), você poderá executar os testes a seguir:</span><span class="sxs-lookup"><span data-stu-id="743fb-269">Once the cache nodes have restarted (as reported by the cache status in the Azure portal), you can perform the following tests:</span></span>
  - <span data-ttu-id="743fb-270">Execute o ping no ponto de extremidade do cache (usando a porta 6380) de um computador que esteja na mesma VNET que o cache, usando [tcping](https://www.elifulkerson.com/projects/tcping.php).</span><span class="sxs-lookup"><span data-stu-id="743fb-270">ping the cache endpoint (using port 6380) from a machine that is within the same VNET as the cache, using [tcping](https://www.elifulkerson.com/projects/tcping.php).</span></span> <span data-ttu-id="743fb-271">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="743fb-271">For example:</span></span>
    
    `tcping.exe contosocache.redis.cache.windows.net 6380`
    
    <span data-ttu-id="743fb-272">Se a ferramenta `tcping` relata que a porta está aberta, o cache está disponível para a conexão de clientes na VNET.</span><span class="sxs-lookup"><span data-stu-id="743fb-272">If the `tcping` tool reports that the port is open, the cache is available for connection from clients in the VNET.</span></span>

  - <span data-ttu-id="743fb-273">Outra maneira de testar é criar um cliente de cache de teste (que pode ser um simples aplicativo de console usando StackExchange.Redis) que se conecta ao cache e adiciona e recupera alguns itens do cache.</span><span class="sxs-lookup"><span data-stu-id="743fb-273">Another way to test is to create a test cache client (which could be a simple console application using StackExchange.Redis) that connects to the cache and adds and retrieves some items from the cache.</span></span> <span data-ttu-id="743fb-274">Instale o aplicativo de cliente de exemplo em uma VM que está na mesma VNET que o cache e execute-o para verificar a conectividade com o cache.</span><span class="sxs-lookup"><span data-stu-id="743fb-274">Install the sample client application onto a VM that is in the same VNET as the cache and run it to verify connectivity to the cache.</span></span>


### <a name="can-i-use-vnets-with-a-standard-or-basic-cache"></a><span data-ttu-id="743fb-275">Posso usar VNets com um cache básico ou Standard?</span><span class="sxs-lookup"><span data-stu-id="743fb-275">Can I use VNets with a standard or basic cache?</span></span>
<span data-ttu-id="743fb-276">As VNets podem ser usadas apenas com os caches Premium.</span><span class="sxs-lookup"><span data-stu-id="743fb-276">VNets can only be used with premium caches.</span></span>

### <a name="why-does-creating-a-redis-cache-fail-in-some-subnets-but-not-others"></a><span data-ttu-id="743fb-277">Por que a criação de um cache Redis falha em algumas sub-redes, mas não em outras?</span><span class="sxs-lookup"><span data-stu-id="743fb-277">Why does creating a Redis cache fail in some subnets but not others?</span></span>
<span data-ttu-id="743fb-278">Se você estiver implantando um Cache Redis do Azure em uma VNet do Resource Manager, o cache deverá estar em uma sub-rede dedicada que não contém nenhum outro tipo de recurso.</span><span class="sxs-lookup"><span data-stu-id="743fb-278">If you are deploying an Azure Redis Cache to a Resource Manager VNet, the cache must be in a dedicated subnet that contains no other resource type.</span></span> <span data-ttu-id="743fb-279">Se for feita uma tentativa de implantar um Cache Redis do Azure em uma VNet do Resource Manager em uma sub-rede que contém outros recursos, a implantação falhará.</span><span class="sxs-lookup"><span data-stu-id="743fb-279">If an attempt is made to deploy an Azure Redis Cache to a Resource Manager VNet subnet that contains other resources, the deployment fails.</span></span> <span data-ttu-id="743fb-280">É necessário excluir os recursos existentes na sub-rede antes de ser possível criar um novo Cache Redis.</span><span class="sxs-lookup"><span data-stu-id="743fb-280">You must delete the existing resources inside the subnet before you can create a new Redis cache.</span></span>

<span data-ttu-id="743fb-281">Você pode implantar vários tipos de recursos para uma VNet clássica, contanto que tenha endereços IP suficientes disponíveis.</span><span class="sxs-lookup"><span data-stu-id="743fb-281">You can deploy multiple types of resources to a classic VNet as long as you have enough IP addresses available.</span></span>

### <a name="what-are-the-subnet-address-space-requirements"></a><span data-ttu-id="743fb-282">Quais são os requisitos de espaço de endereço de sub-rede?</span><span class="sxs-lookup"><span data-stu-id="743fb-282">What are the subnet address space requirements?</span></span>
<span data-ttu-id="743fb-283">O Azure reserva alguns endereços IP em cada sub-rede, os quais não podem ser usados.</span><span class="sxs-lookup"><span data-stu-id="743fb-283">Azure reserves some IP addresses within each subnet, and these addresses can't be used.</span></span> <span data-ttu-id="743fb-284">O primeiro e o último endereço IP das sub-redes são reservados para fins de conformidade de protocolo, juntamente com três outros endereços usados para os serviços do Azure.</span><span class="sxs-lookup"><span data-stu-id="743fb-284">The first and last IP addresses of the subnets are reserved for protocol conformance, along with three more addresses used for Azure services.</span></span> <span data-ttu-id="743fb-285">Para obter mais informações, consulte [Existem restrições quanto ao uso de endereços IP dentro dessas sub-redes?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span><span class="sxs-lookup"><span data-stu-id="743fb-285">For more information, see [Are there any restrictions on using IP addresses within these subnets?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span></span>

<span data-ttu-id="743fb-286">Além dos endereços IP usados pela infraestrutura do Azure VNET, cada instância de Redis na sub-rede usa dois endereços IP por fragmento e um endereço IP adicional para o balanceador de carga.</span><span class="sxs-lookup"><span data-stu-id="743fb-286">In addition to the IP addresses used by the Azure VNET infrastructure, each Redis instance in the subnet uses two IP addresses per shard and one additional IP address for the load balancer.</span></span> <span data-ttu-id="743fb-287">Considera-se que um cache não clusterizado tem um fragmento.</span><span class="sxs-lookup"><span data-stu-id="743fb-287">A non-clustered cache is considered to have one shard.</span></span>

### <a name="do-all-cache-features-work-when-hosting-a-cache-in-a-vnet"></a><span data-ttu-id="743fb-288">Todos os recursos de cache funcionam ao hospedar um cache em uma rede virtual?</span><span class="sxs-lookup"><span data-stu-id="743fb-288">Do all cache features work when hosting a cache in a VNET?</span></span>
<span data-ttu-id="743fb-289">Quando o seu cache faz parte de uma VNET, somente os clientes na VNET podem acessar o cache.</span><span class="sxs-lookup"><span data-stu-id="743fb-289">When your cache is part of a VNET, only clients in the VNET can access the cache.</span></span> <span data-ttu-id="743fb-290">Como resultado, os recursos de gerenciamento de cache a seguir não funcionarão neste momento.</span><span class="sxs-lookup"><span data-stu-id="743fb-290">As a result, the following cache management features don't work at this time.</span></span>

* <span data-ttu-id="743fb-291">Console do Redis – Como o Console do Redis é executado em seu navegador local, que está fora da VNET, ele não poderá se conectar ao seu cache.</span><span class="sxs-lookup"><span data-stu-id="743fb-291">Redis Console - Because Redis Console runs in your local browser, which is outside the VNET, it can't connect to your cache.</span></span>

## <a name="use-expressroute-with-azure-redis-cache"></a><span data-ttu-id="743fb-292">Usar o ExpressRoute com Cache Redis do Azure</span><span class="sxs-lookup"><span data-stu-id="743fb-292">Use ExpressRoute with Azure Redis Cache</span></span>
<span data-ttu-id="743fb-293">Os clientes podem conectar um circuito do [Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/) à infraestrutura de rede virtual, estendendo, assim, a rede local até o Azure.</span><span class="sxs-lookup"><span data-stu-id="743fb-293">Customers can connect an [Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/) circuit to their virtual network infrastructure, thus extending their on-premises network to Azure.</span></span> 

<span data-ttu-id="743fb-294">Por padrão, um circuito ExpressRoute recém-criado não executa túnel forçado (anúncio de uma rota padrão, 0.0.0.0/0) em uma VNET.</span><span class="sxs-lookup"><span data-stu-id="743fb-294">By default, a newly created ExpressRoute circuit does not perform forced tunneling (advertisement of a default route, 0.0.0.0/0) on a VNET.</span></span> <span data-ttu-id="743fb-295">Como resultado, a conectividade de Internet de saída é permitida diretamente da VNET e aplicativos cliente são capazes de se conectar a outros pontos de extremidade do Azure, incluindo o Cache Redis do Azure.</span><span class="sxs-lookup"><span data-stu-id="743fb-295">As a result, outbound Internet connectivity is allowed directly from the VNET and client applications are able to connect to other Azure endpoints including Azure Redis Cache.</span></span>

<span data-ttu-id="743fb-296">No entanto, uma configuração de cliente comum é usar túnel forçado (anunciar uma rota padrão), o que força o tráfego de saída da Internet a, em vez disso, ter fluxo local.</span><span class="sxs-lookup"><span data-stu-id="743fb-296">However a common customer configuration is to use forced tunneling (advertise a default route) which forces outbound Internet traffic to instead flow on-premises.</span></span> <span data-ttu-id="743fb-297">Esse fluxo de tráfego interromperá a conectividade com o Cache Redis do Azure se o tráfego de saída for bloqueado localmente, de modo que a instância do Cache Redis do Azure não será capaz de se comunicar com suas dependências.</span><span class="sxs-lookup"><span data-stu-id="743fb-297">This traffic flow breaks connectivity with Azure Redis Cache if the outbound traffic is then blocked on-premises such that the Azure Redis Cache instance is not able to communicate with its dependencies.</span></span>

<span data-ttu-id="743fb-298">A solução é definir uma (ou mais) UDRs (rotas definidas pelo usuário) na sub-rede que contenham o Cache Redis do Azure.</span><span class="sxs-lookup"><span data-stu-id="743fb-298">The solution is to define one (or more) user-defined routes (UDRs) on the subnet that contains the Azure Redis Cache.</span></span> <span data-ttu-id="743fb-299">Uma UDR define rotas específicas de sub-rede que serão consideradas no lugar da rota padrão.</span><span class="sxs-lookup"><span data-stu-id="743fb-299">A UDR defines subnet-specific routes that will be honored instead of the default route.</span></span>

<span data-ttu-id="743fb-300">Se possível, é recomendável usar a seguinte configuração:</span><span class="sxs-lookup"><span data-stu-id="743fb-300">If possible, it is recommended to use the following configuration:</span></span>

* <span data-ttu-id="743fb-301">A configuração de ExpressRoute anuncia 0.0.0.0/0 e, por padrão, encapsula à força todo o tráfego de saída no local.</span><span class="sxs-lookup"><span data-stu-id="743fb-301">The ExpressRoute configuration advertises 0.0.0.0/0 and by default force tunnels all outbound traffic on-premises.</span></span>
* <span data-ttu-id="743fb-302">O UDR aplicado à sub-rede que contém o Cache Redis do Azure define 0.0.0.0/0 com uma rota de trabalho para o tráfego de TCP/IP à Internet pública. Por exemplo, definindo o tipo do próximo salto como “Internet”.</span><span class="sxs-lookup"><span data-stu-id="743fb-302">The UDR applied to the subnet containing the Azure Redis Cache defines 0.0.0.0/0 with a working route for TCP/IP traffic to the public internet; for example by setting the next hop type to 'Internet'.</span></span>

<span data-ttu-id="743fb-303">O efeito combinado dessas etapas é que a UDR do nível de sub-rede tem precedência sobre o túnel forçado do ExpressRoute, garantindo acesso de Internet de saída do Cache Redis do Azure.</span><span class="sxs-lookup"><span data-stu-id="743fb-303">The combined effect of these steps is that the subnet level UDR takes precedence over the ExpressRoute forced tunneling, thus ensuring outbound Internet access from the Azure Redis Cache.</span></span>

<span data-ttu-id="743fb-304">Conectar-se a uma instância de Cache Redis do Azure de um aplicativo local usando o ExpressRoute não é um cenário de uso típico por motivos de desempenho (para o melhor desempenho, os clientes do Cache Redis do Azure devem estar na mesma região que o Cache Redis do Azure).</span><span class="sxs-lookup"><span data-stu-id="743fb-304">Connecting to an Azure Redis Cache instance from an on-premises application using ExpressRoute is not a typical usage scenario due to performance reasons (for best performance Azure Redis Cache clients should be in the same region as the Azure Redis Cache).</span></span>

>[!IMPORTANT] 
><span data-ttu-id="743fb-305">As rotas definidas em uma UDR **devem** ser específicas o suficiente para ter precedência sobre todas as rotas anunciadas pela configuração do ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="743fb-305">The routes defined in a UDR **must** be specific enough to take precedence over any routes advertised by the ExpressRoute configuration.</span></span> <span data-ttu-id="743fb-306">O exemplo a seguir usa o intervalo de endereços 0.0.0.0/0 amplo, e potencialmente pode ser substituído por acidente pelos anúncios de rota usando intervalos de endereços mais específicos.</span><span class="sxs-lookup"><span data-stu-id="743fb-306">The following example uses the broad 0.0.0.0/0 address range, and as such can potentially be accidentally overridden by route advertisements using more specific address ranges.</span></span>

>[!WARNING]  
><span data-ttu-id="743fb-307">O Cache Redis do Azure não tem suporte com configurações do ExpressRoute que **incorretamente cruzam anúncios de rotas do caminho de emparelhamento público para o caminho de emparelhamento privado**.</span><span class="sxs-lookup"><span data-stu-id="743fb-307">Azure Redis Cache is not supported with ExpressRoute configurations that **incorrectly cross-advertise routes from the public peering path to the private peering path**.</span></span> <span data-ttu-id="743fb-308">As configurações de ExpressRoute com emparelhamento público definido receberão anúncios de rota da Microsoft para um grande conjunto de intervalos de endereços IP do Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="743fb-308">ExpressRoute configurations that have public peering configured, receive route advertisements from Microsoft for a large set of Microsoft Azure IP address ranges.</span></span> <span data-ttu-id="743fb-309">Se esses intervalos de endereços forem incorretamente anunciados de modo cruzado no caminho de emparelhamento privado, o resultado final será que todos os pacotes de saída de rede da sub-rede da instância do Cache Redis do Azure serão incorretamente encapsulados à força em uma infraestrutura de rede local do cliente.</span><span class="sxs-lookup"><span data-stu-id="743fb-309">If these address ranges are incorrectly cross-advertised on the private peering path, the result is that all outbound network packets from the Azure Redis Cache instance's subnet are incorrectly force-tunneled to a customer's on-premises network infrastructure.</span></span> <span data-ttu-id="743fb-310">Esse fluxo de rede interrompe o Cache Redis do Azure.</span><span class="sxs-lookup"><span data-stu-id="743fb-310">This network flow breaks Azure Redis Cache.</span></span> <span data-ttu-id="743fb-311">A solução para esse problema é parar as rotas de anúncios cruzados do caminho de emparelhamento público para o caminho de emparelhamento particular.</span><span class="sxs-lookup"><span data-stu-id="743fb-311">The solution to this problem is to stop cross-advertising routes from the public peering path to the private peering path.</span></span>


<span data-ttu-id="743fb-312">Informações básicas sobre as rotas definidas pelo usuário estão disponíveis nesta [visão geral](../virtual-network/virtual-networks-udr-overview.md).</span><span class="sxs-lookup"><span data-stu-id="743fb-312">Background information on user-defined routes is available in this [overview](../virtual-network/virtual-networks-udr-overview.md).</span></span>

<span data-ttu-id="743fb-313">Para obter mais informações sobre o ExpressRoute, consulte [Visão geral técnica do ExpressRoute](../expressroute/expressroute-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="743fb-313">For more information about ExpressRoute, see [ExpressRoute technical overview](../expressroute/expressroute-introduction.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="743fb-314">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="743fb-314">Next steps</span></span>
<span data-ttu-id="743fb-315">Aprenda a usar mais recursos de cache premium.</span><span class="sxs-lookup"><span data-stu-id="743fb-315">Learn how to use more premium cache features.</span></span>

* [<span data-ttu-id="743fb-316">Introdução à camada Premium do Cache Redis do Azure</span><span class="sxs-lookup"><span data-stu-id="743fb-316">Introduction to the Azure Redis Cache Premium tier</span></span>](cache-premium-tier-intro.md)

<!-- IMAGES -->

[redis-cache-vnet]: ./media/cache-how-to-premium-vnet/redis-cache-vnet.png

[redis-cache-vnet-ip]: ./media/cache-how-to-premium-vnet/redis-cache-vnet-ip.png

[redis-cache-vnet-info]: ./media/cache-how-to-premium-vnet/redis-cache-vnet-info.png

