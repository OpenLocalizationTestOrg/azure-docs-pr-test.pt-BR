---
title: "Alta Disponibilidade e Recuperação de Desastre para SQL Server | Microsoft Docs"
description: "Uma discussão sobre os diversos tipos de estratégias HADR do SQL Server em execução em máquinas virtuais do Azure."
services: virtual-machines-windows
documentationcenter: na
author: MikeRayMSFT
manager: jhubbard
editor: 
tags: azure-service-management
ms.assetid: 53981f7e-8370-4979-b26a-93a5988d905f
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 06/27/2017
ms.author: mikeray
ms.openlocfilehash: 27d05c1681f7d7b3090fc7abd4a6b15d1c030e2c
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="high-availability-and-disaster-recovery-for-sql-server-in-azure-virtual-machines"></a><span data-ttu-id="0aeb5-103">Alta disponibilidade e recuperação de desastre para SQL Server nas Máquinas Virtuais do Azure</span><span class="sxs-lookup"><span data-stu-id="0aeb5-103">High availability and disaster recovery for SQL Server in Azure Virtual Machines</span></span>

<span data-ttu-id="0aeb5-104">VMs (Máquinas virtuais) do Microsoft Azure com SQL Server podem ajudar a reduzir o custo de uma solução de banco de dados HADR (Alta Disponibilidade e Recuperação de Desastre).</span><span class="sxs-lookup"><span data-stu-id="0aeb5-104">Microsoft Azure virtual machines (VMs) with SQL Server can help lower the cost of a high availability and disaster recovery (HADR) database solution.</span></span> <span data-ttu-id="0aeb5-105">A maioria das soluções HADR do SQL Server tem suporte em máquinas virtuais do Azure, tanto como somente Azure ou como soluções híbridas.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-105">Most SQL Server HADR solutions are supported in Azure virtual machines, both as Azure-only and as hybrid solutions.</span></span> <span data-ttu-id="0aeb5-106">Em uma solução somente Azure, todo o sistema HADR é executado no Azure.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-106">In an Azure-only solution, the entire HADR system runs in Azure.</span></span> <span data-ttu-id="0aeb5-107">Em uma configuração híbrida, parte da solução é executada no Azure e a outra parte é executada localmente em sua organização.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-107">In a hybrid configuration, part of the solution runs in Azure and the other part runs on-premises in your organization.</span></span> <span data-ttu-id="0aeb5-108">A flexibilidade do ambiente do Azure permite que você se mova parcial ou completamente para o Azure para atender aos requisitos de orçamento e HADR de seus sistemas de banco de dados do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-108">The flexibility of the Azure environment enables you to move partially or completely to Azure to satisfy the budget and HADR requirements of your SQL Server database systems.</span></span>

[!INCLUDE [learn-about-deployment-models](../../../../includes/learn-about-deployment-models-both-include.md)]

## <a name="understanding-the-need-for-an-hadr-solution"></a><span data-ttu-id="0aeb5-109">Compreendendo a necessidade de uma solução HADR</span><span class="sxs-lookup"><span data-stu-id="0aeb5-109">Understanding the need for an HADR solution</span></span>
<span data-ttu-id="0aeb5-110">Cabe a você garantir que seu sistema de banco de dados possua os recursos HADR que o SLA (Contrato de Nível de Serviço) exige.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-110">It is up to you to ensure that your database system possesses the HADR capabilities that the service-level agreement (SLA) requires.</span></span> <span data-ttu-id="0aeb5-111">O fato de que o Azure fornece mecanismos de alta disponibilidade, como recuperação de serviço para serviços de nuvem e detecção de recuperação de falhas para máquinas virtuais, não é garantia de que você possa atender ao SLA desejado.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-111">The fact that Azure provides high availability mechanisms, such as service healing for cloud services and failure recovery detection for Virtual Machines, does not itself guarantee you can meet the desired SLA.</span></span> <span data-ttu-id="0aeb5-112">Esses mecanismos protegem a alta disponibilidade das VMs, mas não a alta disponibilidade do SQL Server em execução nas VMs.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-112">These mechanisms protect the high availability of the VMs but not the high availability of SQL Server running inside the VMs.</span></span> <span data-ttu-id="0aeb5-113">É possível que a instância do SQL Server falhe enquanto a VM estiver online e íntegra.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-113">It is possible for the SQL Server instance to fail while the VM is online and healthy.</span></span> <span data-ttu-id="0aeb5-114">Além disso, até mesmo os mecanismos de alta disponibilidade fornecidos pelo Azure permitem tempo de inatividade das VMs em razão de eventos como recuperação de software ou falhas de hardware e atualizações do sistema operacional.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-114">Moreover, even the high availability mechanisms provided by Azure allow for downtime of the VMs due to events such as recovery from software or hardware failures and operating system upgrades.</span></span>

<span data-ttu-id="0aeb5-115">Além disso, o GRS (Armazenamento com Redundância Geográfica) no Azure, que é implementado com um recurso chamado replicação geográfica, pode não ser uma solução de recuperação de desastres adequada para seus bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-115">In addition, Geo Redundant Storage (GRS) in Azure, which is implemented with a feature called geo-replication, may not be an adequate disaster recovery solution for your databases.</span></span> <span data-ttu-id="0aeb5-116">Como a replicação geográfica envia dados de forma assíncrona, atualizações recentes podem ser perdidas no caso de desastre.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-116">Because geo-replication sends data asynchronously, recent updates can be lost in the event of disaster.</span></span> <span data-ttu-id="0aeb5-117">Mais informações sobre limitações de replicação geográfica são abordadas na seção [Replicação geográfica sem suporte para arquivos de dados e log em discos separados](#geo-replication-support) .</span><span class="sxs-lookup"><span data-stu-id="0aeb5-117">More information regarding geo-replication limitations are covered in the [Geo-replication not supported for data and log files on separate disks](#geo-replication-support) section.</span></span>

## <a name="hadr-deployment-architectures"></a><span data-ttu-id="0aeb5-118">Arquiteturas de implantação de HADR</span><span class="sxs-lookup"><span data-stu-id="0aeb5-118">HADR deployment architectures</span></span>
<span data-ttu-id="0aeb5-119">As tecnologias HADR do SQL Server que têm suporte no Azure incluem:</span><span class="sxs-lookup"><span data-stu-id="0aeb5-119">SQL Server HADR technologies that are supported in Azure include:</span></span>

* [<span data-ttu-id="0aeb5-120">Grupos de disponibilidade AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="0aeb5-120">Always On Availability Groups</span></span>](https://technet.microsoft.com/library/hh510230.aspx)
* [<span data-ttu-id="0aeb5-121">Instâncias do cluster de failover AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="0aeb5-121">Always On Failover Cluster Instances</span></span>](https://technet.microsoft.com/library/ms189134.aspx)
* [<span data-ttu-id="0aeb5-122">Envio de logs</span><span class="sxs-lookup"><span data-stu-id="0aeb5-122">Log Shipping</span></span>](https://technet.microsoft.com/library/ms187103.aspx)
* [<span data-ttu-id="0aeb5-123">Backup e restauração do SQL Server com o Serviço de armazenamento de blobs do Azure</span><span class="sxs-lookup"><span data-stu-id="0aeb5-123">SQL Server Backup and Restore with Azure Blob Storage Service</span></span>](https://msdn.microsoft.com/library/jj919148.aspx)
* <span data-ttu-id="0aeb5-124">[Espelhamento de banco de dados](https://technet.microsoft.com/library/ms189852.aspx) - preterido no SQL Server 2016</span><span class="sxs-lookup"><span data-stu-id="0aeb5-124">[Database Mirroring](https://technet.microsoft.com/library/ms189852.aspx) - Deprecated in SQL Server 2016</span></span>

<span data-ttu-id="0aeb5-125">É possível combinar as tecnologias para implementar uma solução SQL Server com alta disponibilidade e recursos de recuperação de desastre.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-125">It is possible to combine the technologies together to implement a SQL Server solution that has both high availability and disaster recovery capabilities.</span></span> <span data-ttu-id="0aeb5-126">Dependendo da tecnologia usada, uma implantação híbrida pode exigir um túnel VPN com a rede virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-126">Depending on the technology you use, a hybrid deployment may require a VPN tunnel with the Azure virtual network.</span></span> <span data-ttu-id="0aeb5-127">As seções a seguir mostram algumas das arquiteturas de implantação de exemplo.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-127">The sections below show you some of the example deployment architectures.</span></span>

## <a name="azure-only-high-availability-solutions"></a><span data-ttu-id="0aeb5-128">Somente Azure: soluções de alta disponibilidade</span><span class="sxs-lookup"><span data-stu-id="0aeb5-128">Azure-only: High availability solutions</span></span>

<span data-ttu-id="0aeb5-129">É possível ter uma solução de alta disponibilidade para o SQL Server em um nível de banco de dados com Grupos de Disponibilidade AlwaysOn - chamados de grupos de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-129">You can have a high availability solution for SQL Server at a database level with Always On Availability Groups - called availability groups.</span></span> <span data-ttu-id="0aeb5-130">Você também pode criar uma solução de alta disponibilidade no nível da instância com Instâncias de Cluster de Failover do Always On - instâncias de cluster de failover.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-130">You can also create a high availability solution at an instance level with Always On Failover Cluster Instances - failover cluster instances.</span></span> <span data-ttu-id="0aeb5-131">Para adicionar redundância, crie a redundância nos dois níveis, criando grupos de disponibilidade em instâncias de cluster de failover.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-131">For additional redundancy, you can create redundancy at both levels by creating availability groups on failover cluster instances.</span></span> 

| <span data-ttu-id="0aeb5-132">Tecnologia</span><span class="sxs-lookup"><span data-stu-id="0aeb5-132">Technology</span></span> | <span data-ttu-id="0aeb5-133">Arquiteturas de exemplo</span><span class="sxs-lookup"><span data-stu-id="0aeb5-133">Example Architectures</span></span> |
| --- | --- |
| <span data-ttu-id="0aeb5-134">**Grupos de disponibilidade**</span><span class="sxs-lookup"><span data-stu-id="0aeb5-134">**Availability groups**</span></span> |<span data-ttu-id="0aeb5-135">As réplicas de disponibilidade em execução em VMs do Azure para a mesma região fornecem alta disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-135">Availability replicas running in Azure VMs in the same region provide high availability.</span></span> <span data-ttu-id="0aeb5-136">Você precisa configurar uma VM de controlador de domínio, porque o clustering de failover do Windows exige um domínio do Active Directory.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-136">You need to configure a domain controller VM, because Windows failover clustering requires an Active Directory domain.</span></span><br/> <span data-ttu-id="0aeb5-137">![Grupos de Disponibilidade](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_ha_always_on.gif)</span><span class="sxs-lookup"><span data-stu-id="0aeb5-137">![Availability Groups](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_ha_always_on.gif)</span></span><br/><span data-ttu-id="0aeb5-138">Para saber mais, consulte [Configurar Grupos de Disponibilidade no Azure (GUI)](virtual-machines-windows-portal-sql-alwayson-availability-groups.md).</span><span class="sxs-lookup"><span data-stu-id="0aeb5-138">For more information, see [Configure Availability Groups in Azure (GUI)](virtual-machines-windows-portal-sql-alwayson-availability-groups.md).</span></span> |
| <span data-ttu-id="0aeb5-139">**Instâncias do cluster de failover**</span><span class="sxs-lookup"><span data-stu-id="0aeb5-139">**Failover cluster instances**</span></span> |<span data-ttu-id="0aeb5-140">FCI (Instâncias de Cluster de Failover), que exigem armazenamento compartilhado, podem ser criadas de três maneiras diferentes.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-140">Failover Cluster Instances (FCI), which require shared storage, can be created in 3 different ways.</span></span><br/><br/><span data-ttu-id="0aeb5-141">1. Um cluster de failover de dois nós em execução nas VMs do Azure com o armazenamento anexado, usando os [Espaços de Armazenamento Diretos do Windows Server 2016 \(S2D\)](virtual-machines-windows-portal-sql-create-failover-cluster.md) para fornecer uma SAN virtual baseada em software.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-141">1. A two-node failover cluster running in Azure VMs with attached storage using [Windows Server 2016 Storage Spaces Direct \(S2D\)](virtual-machines-windows-portal-sql-create-failover-cluster.md) to provide a software-based virtual SAN.</span></span><br/><br/><span data-ttu-id="0aeb5-142">2. Um cluster de failover de dois nós em execução nas VMs do Azure com armazenamento com suporte em uma solução de clustering de terceiros.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-142">2. A two-node failover cluster running in Azure VMs with storage supported by a third-party clustering solution.</span></span> <span data-ttu-id="0aeb5-143">Para obter um exemplo específico que usa o SIOS DataKeeper, consulte [Alta disponibilidade para um compartilhamento de arquivos usando o clustering de failover e o software de terceiros SIOS Datakeeper](https://azure.microsoft.com/blog/high-availability-for-a-file-share-using-wsfc-ilb-and-3rd-party-software-sios-datakeeper/).</span><span class="sxs-lookup"><span data-stu-id="0aeb5-143">For a specific example that uses SIOS DataKeeper, see [High availability for a file share using failover clustering and 3rd party software SIOS DataKeeper](https://azure.microsoft.com/blog/high-availability-for-a-file-share-using-wsfc-ilb-and-3rd-party-software-sios-datakeeper/).</span></span><br/><br/><span data-ttu-id="0aeb5-144">3. Um cluster de failover de dois nós em execução nas VMs do Azure com armazenamento em bloco compartilhado do Destino iSCSI remoto por meio do ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-144">3. A two-node failover cluster running in Azure VMs with remote iSCSI Target shared block storage via ExpressRoute.</span></span> <span data-ttu-id="0aeb5-145">Por exemplo, o NPS (Armazenamento Privado do NetApp) expõe um destino iSCSI por meio do ExpressRoute com o Equinix para VMs do Azure.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-145">For example, NetApp Private Storage (NPS) exposes an iSCSI target via ExpressRoute with Equinix to Azure VMs.</span></span><br/><br/><span data-ttu-id="0aeb5-146">Em caso de problemas relacionados ao acesso a dados no failover, contate o fornecedor para obter soluções de terceiros para armazenamento compartilhado e replicação de dados.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-146">For third-party shared storage and data replication solutions, you should contact the vendor for any issues related to accessing data on failover.</span></span><br/><br/><span data-ttu-id="0aeb5-147">Observe que ainda não há suporte para o uso do FCI no [Armazenamento de arquivos do Azure](https://azure.microsoft.com/services/storage/files/) , pois esta solução não utiliza o Armazenamento Premium.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-147">Note that using FCI on top of [Azure File storage](https://azure.microsoft.com/services/storage/files/) is not supported yet, because this solution does not utilize Premium Storage.</span></span> <span data-ttu-id="0aeb5-148">Estamos trabalhando para dar suporte a isso em breve.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-148">We are working to support this soon.</span></span> |

## <a name="azure-only-disaster-recovery-solutions"></a><span data-ttu-id="0aeb5-149">Somente Azure: soluções de recuperação de desastre</span><span class="sxs-lookup"><span data-stu-id="0aeb5-149">Azure-only: Disaster recovery solutions</span></span>
<span data-ttu-id="0aeb5-150">Você pode ter uma solução de recuperação de desastres para seus bancos de dados do SQL Server no Azure usando Grupos de Disponibilidade, espelhamento de banco de dados ou backup e restauração com blobs de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-150">You can have a disaster recovery solution for your SQL Server databases in Azure using availability groups, database mirroring, or backup and restore with storage blobs.</span></span>

| <span data-ttu-id="0aeb5-151">Tecnologia</span><span class="sxs-lookup"><span data-stu-id="0aeb5-151">Technology</span></span> | <span data-ttu-id="0aeb5-152">Arquiteturas de exemplo</span><span class="sxs-lookup"><span data-stu-id="0aeb5-152">Example Architectures</span></span> |
| --- | --- |
| <span data-ttu-id="0aeb5-153">**Grupos de Disponibilidade**</span><span class="sxs-lookup"><span data-stu-id="0aeb5-153">**Availability Groups**</span></span> |<span data-ttu-id="0aeb5-154">Réplicas de disponibilidade executadas em vários datacenters em VMs do Azure para recuperação de desastres.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-154">Availability replicas running across multiple datacenters in Azure VMs for disaster recovery.</span></span> <span data-ttu-id="0aeb5-155">Essa solução de regiões cruzadas protege contra interrupção completa de site.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-155">This cross-region solution protects against complete site outage.</span></span> <br/> <span data-ttu-id="0aeb5-156">![Grupos de Disponibilidade](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_dr_alwayson.png)</span><span class="sxs-lookup"><span data-stu-id="0aeb5-156">![Availability Groups](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_dr_alwayson.png)</span></span><br/><span data-ttu-id="0aeb5-157">Dentro de uma região, todas as réplicas devem estar dentro do mesmo serviço de nuvem e na mesma VNet.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-157">Within a region, all replicas should be within the same cloud service and the same VNet.</span></span> <span data-ttu-id="0aeb5-158">Como cada região terá uma VNet separada, essas soluções necessitam de VNet para conectividade VNet.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-158">Because each region will have a separate VNet, these solutions require VNet to VNet connectivity.</span></span> <span data-ttu-id="0aeb5-159">Para obter mais informações, consulte [Configurar uma conexão VNet a VNet usando o portal do Azure](../../../vpn-gateway/vpn-gateway-howto-vnet-vnet-resource-manager-portal.md).</span><span class="sxs-lookup"><span data-stu-id="0aeb5-159">For more information, see [Configure a VNet-to-VNet connection using the Azure portal](../../../vpn-gateway/vpn-gateway-howto-vnet-vnet-resource-manager-portal.md).</span></span> <span data-ttu-id="0aeb5-160">Para obter instruções detalhadas, confira [Configurar um grupo de disponibilidade do SQL Server em máquinas virtuais do Azure em diferentes regiões](virtual-machines-windows-portal-sql-availability-group-dr.md).</span><span class="sxs-lookup"><span data-stu-id="0aeb5-160">For detailed instructions, see [Configure a SQL Server Availability Group on Azure Virtual Machines in Different Regions](virtual-machines-windows-portal-sql-availability-group-dr.md).</span></span>|
| <span data-ttu-id="0aeb5-161">**Espelhamento de banco de dados**</span><span class="sxs-lookup"><span data-stu-id="0aeb5-161">**Database Mirroring**</span></span> |<span data-ttu-id="0aeb5-162">Servidores principal e de espelho em execução em diferentes datacenters para recuperação de desastres.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-162">Principal and mirror and servers running in different datacenters for disaster recovery.</span></span> <span data-ttu-id="0aeb5-163">Você deve implantar usando certificados de servidor, pois um domínio do Active Directory não pode abranger vários datacenters.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-163">You must deploy using server certificates because an active directory domain cannot span multiple datacenters.</span></span><br/>![Espelhamento de banco de dados](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_dr_dbmirroring.gif) |
| <span data-ttu-id="0aeb5-165">**Backup e restauração com o Serviço de armazenamento de blob do Azure**</span><span class="sxs-lookup"><span data-stu-id="0aeb5-165">**Backup and Restore with Azure Blob Storage Service**</span></span> |<span data-ttu-id="0aeb5-166">Bancos de dados de produção com backup direto no armazenamento de blob em um datacenter diferente para recuperação de desastre.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-166">Production databases backed up directly to blob storage in a different datacenter for disaster recovery.</span></span><br/><span data-ttu-id="0aeb5-167">![Backup e restauração](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_dr_backup_restore.gif)</span><span class="sxs-lookup"><span data-stu-id="0aeb5-167">![Backup and Restore](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_dr_backup_restore.gif)</span></span><br/><span data-ttu-id="0aeb5-168">Para obter mais informações, consulte [Backup e Restauração para SQL Server em Máquinas Virtuais do Azure](virtual-machines-windows-sql-backup-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="0aeb5-168">For more information, see [Backup and Restore for SQL Server in Azure Virtual Machines](virtual-machines-windows-sql-backup-recovery.md).</span></span> |

## <a name="hybrid-it-disaster-recovery-solutions"></a><span data-ttu-id="0aeb5-169">TI híbrida: soluções de recuperação de desastre</span><span class="sxs-lookup"><span data-stu-id="0aeb5-169">Hybrid IT: Disaster recovery solutions</span></span>
<span data-ttu-id="0aeb5-170">Você pode ter uma solução de recuperação de desastres para seus bancos de dados do SQL Server em um ambiente de TI híbrida, usando Grupos de disponibilidade, espelhamento de banco de dados, envio de log e backup e restauração com o armazenamento de blog do Azure.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-170">You can have a disaster recovery solution for your SQL Server databases in a hybrid-IT environment using availability groups, database mirroring, log shipping, and backup and restore with Azure blog storage.</span></span>

| <span data-ttu-id="0aeb5-171">Tecnologia</span><span class="sxs-lookup"><span data-stu-id="0aeb5-171">Technology</span></span> | <span data-ttu-id="0aeb5-172">Arquiteturas de exemplo</span><span class="sxs-lookup"><span data-stu-id="0aeb5-172">Example Architectures</span></span> |
| --- | --- |
| <span data-ttu-id="0aeb5-173">**Grupos de Disponibilidade**</span><span class="sxs-lookup"><span data-stu-id="0aeb5-173">**Availability Groups**</span></span> |<span data-ttu-id="0aeb5-174">Algumas réplicas de disponibilidade executadas em VMs do Azure e outras réplicas executadas localmente para recuperação de desastres intersite.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-174">Some availability replicas running in Azure VMs and other replicas running on-premises for cross-site disaster recovery.</span></span> <span data-ttu-id="0aeb5-175">O site de produção pode ser local ou em um datacenter do Azure.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-175">The production site can be either on-premises or in an Azure datacenter.</span></span><br/>![Grupos de Disponibilidade](./media/virtual-machines-windows-sql-high-availability-dr/hybrid_dr_alwayson.gif)<br/><span data-ttu-id="0aeb5-177">Como todas as réplicas de disponibilidade devem estar no mesmo cluster de failover, o cluster deve abranger as duas redes (um cluster de failover de várias sub-redes).</span><span class="sxs-lookup"><span data-stu-id="0aeb5-177">Because all availability replicas must be in the same failover cluster, the cluster must span both networks (a multi-subnet failover cluster).</span></span> <span data-ttu-id="0aeb5-178">Essa configuração requer uma conexão VPN entre o Azure e a rede local.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-178">This configuration requires a VPN connection between Azure and the on-premises network.</span></span><br/><br/><span data-ttu-id="0aeb5-179">Para recuperação de desastres bem-sucedida de seus bancos de dados, você também deve instalar um controlador de domínio de réplica no local da recuperação de desastres.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-179">For successful disaster recovery of your databases, you should also install a replica domain controller at the disaster recovery site.</span></span><br/><br/><span data-ttu-id="0aeb5-180">É possível usar o Assistente de Adição de Réplica no SSMS para adicionar uma réplica do Azure a um grupo de disponibilidade AlwaysOn existente.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-180">It is possible to use the Add Replica Wizard in SSMS to add an Azure replica to an existing Always On Availability Group.</span></span> <span data-ttu-id="0aeb5-181">Para obter mais informações, consulte o Tutorial: estender seu grupo de disponibilidade AlwaysOn para o Azure.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-181">For more information, see Tutorial: Extend your Always On Availability Group to Azure.</span></span> |
| <span data-ttu-id="0aeb5-182">**Espelhamento de banco de dados**</span><span class="sxs-lookup"><span data-stu-id="0aeb5-182">**Database Mirroring**</span></span> |<span data-ttu-id="0aeb5-183">Um parceiro executado em uma VM do Azure e o outro executado localmente para recuperação de desastres intersite usando certificados de servidor.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-183">One partner running in an Azure VM and the other running on-premises for cross-site disaster recovery using server certificates.</span></span> <span data-ttu-id="0aeb5-184">Os parceiros não precisam estar no mesmo domínio do Active Directory e nenhuma conexão VPN é necessária.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-184">Partners do not need to be in the same Active Directory domain, and no VPN connection is required.</span></span><br/><span data-ttu-id="0aeb5-185">![Espelhamento de banco de dados](./media/virtual-machines-windows-sql-high-availability-dr/hybrid_dr_dbmirroring.gif)</span><span class="sxs-lookup"><span data-stu-id="0aeb5-185">![Database Mirroring](./media/virtual-machines-windows-sql-high-availability-dr/hybrid_dr_dbmirroring.gif)</span></span><br/><span data-ttu-id="0aeb5-186">Outro cenário que o espelhamento de banco de dados envolve é um parceiro em execução em uma VM do Azure e o outro em execução localmente no mesmo domínio do Active Directory para recuperação de desastres intersite.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-186">Another database mirroring scenario involves one partner running in an Azure VM and the other running on-premises in the same Active Directory domain for cross-site disaster recovery.</span></span> <span data-ttu-id="0aeb5-187">Uma [conexão VPN entre a rede virtual do Azure e a rede local](../../../vpn-gateway/vpn-gateway-site-to-site-create.md) é necessária.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-187">A [VPN connection between the Azure virtual network and the on-premises network](../../../vpn-gateway/vpn-gateway-site-to-site-create.md) is required.</span></span><br/><br/><span data-ttu-id="0aeb5-188">Para recuperação de desastres bem-sucedida de seus bancos de dados, você também deve instalar um controlador de domínio de réplica no local da recuperação de desastres.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-188">For successful disaster recovery of your databases, you should also install a replica domain controller at the disaster recovery site.</span></span> |
| <span data-ttu-id="0aeb5-189">**Envio de logs**</span><span class="sxs-lookup"><span data-stu-id="0aeb5-189">**Log Shipping**</span></span> |<span data-ttu-id="0aeb5-190">Um servidor em execução em uma VM do Azure e outro em execução local para recuperação de desastre intersite.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-190">One server running in an Azure VM and the other running on-premises for cross-site disaster recovery.</span></span> <span data-ttu-id="0aeb5-191">O envio de log depende do compartilhamento de arquivos do Windows, assim, uma conexão VPN entre a rede virtual do Azure e a rede local é necessária.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-191">Log shipping depends on Windows file sharing, so a VPN connection between the Azure virtual network and the on-premises network is required.</span></span><br/>![Envio de logs](./media/virtual-machines-windows-sql-high-availability-dr/hybrid_dr_log_shipping.gif)<br/><span data-ttu-id="0aeb5-193">Para recuperação de desastres bem-sucedida de seus bancos de dados, você também deve instalar um controlador de domínio de réplica no local da recuperação de desastres.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-193">For successful disaster recovery of your databases, you should also install a replica domain controller at the disaster recovery site.</span></span> |
| <span data-ttu-id="0aeb5-194">**Backup e restauração com o Serviço de armazenamento de blob do Azure**</span><span class="sxs-lookup"><span data-stu-id="0aeb5-194">**Backup and Restore with Azure Blob Storage Service**</span></span> |<span data-ttu-id="0aeb5-195">Bancos de dados de produção local com backup diretamente no armazenamento de blob do Azure para recuperação de desastres.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-195">On-premises production databases backed up directly to Azure blob storage for disaster recovery.</span></span><br/><span data-ttu-id="0aeb5-196">![Backup e restauração](./media/virtual-machines-windows-sql-high-availability-dr/hybrid_dr_backup_restore.gif)</span><span class="sxs-lookup"><span data-stu-id="0aeb5-196">![Backup and Restore](./media/virtual-machines-windows-sql-high-availability-dr/hybrid_dr_backup_restore.gif)</span></span><br/><span data-ttu-id="0aeb5-197">Para obter mais informações, consulte [Backup e Restauração para SQL Server em Máquinas Virtuais do Azure](virtual-machines-windows-sql-backup-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="0aeb5-197">For more information, see [Backup and Restore for SQL Server in Azure Virtual Machines](virtual-machines-windows-sql-backup-recovery.md).</span></span> |

## <a name="important-considerations-for-sql-server-hadr-in-azure"></a><span data-ttu-id="0aeb5-198">Considerações importantes para HADR do SQL Server no Azure</span><span class="sxs-lookup"><span data-stu-id="0aeb5-198">Important considerations for SQL Server HADR in Azure</span></span>
<span data-ttu-id="0aeb5-199">VMs do Azure, armazenamento e rede têm características operacionais diferentes da infraestrutura de TI local, não virtualizada.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-199">Azure VMs, storage, and networking have different operational characteristics than an on-premises, non-virtualized IT infrastructure.</span></span> <span data-ttu-id="0aeb5-200">Uma implementação bem-sucedida de uma solução HADR SQL Server no Azure requer que você compreenda essas diferenças e crie sua solução para acomodá-las.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-200">A successful implementation of a HADR SQL Server solution in Azure requires that you understand these differences and design your solution to accommodate them.</span></span>

### <a name="high-availability-nodes-in-an-availability-set"></a><span data-ttu-id="0aeb5-201">Nós de alta disponibilidade em um conjunto de disponibilidade</span><span class="sxs-lookup"><span data-stu-id="0aeb5-201">High availability nodes in an availability set</span></span>
<span data-ttu-id="0aeb5-202">Conjuntos de disponibilidade no Azure permitem que você coloque os nós de alta disponibilidade em FDs (Domínios de Falha) e UDs (Domínios de Atualização) separados.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-202">Availability sets in Azure enable you to place the high availability nodes into separate Fault Domains (FDs) and Update Domains (UDs).</span></span> <span data-ttu-id="0aeb5-203">Para que VMs do Azure sejam colocadas no mesmo conjunto de disponibilidade, você deve implantá-las no mesmo serviço de nuvem.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-203">For Azure VMs to be placed in the same availability set, you must deploy them in the same cloud service.</span></span> <span data-ttu-id="0aeb5-204">Somente nós no mesmo serviço de nuvem podem participar do mesmo conjunto de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-204">Only nodes in the same cloud service can participate in the same availability set.</span></span> <span data-ttu-id="0aeb5-205">Para obter mais informações, consulte [Gerenciar a Disponibilidade de Máquinas Virtuais](../manage-availability.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="0aeb5-205">For more information, see [Manage the Availability of Virtual Machines](../manage-availability.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>

### <a name="failover-cluster-behavior-in-azure-networking"></a><span data-ttu-id="0aeb5-206">Comportamento do cluster de failover na rede do Azure</span><span class="sxs-lookup"><span data-stu-id="0aeb5-206">Failover cluster behavior in Azure networking</span></span>
<span data-ttu-id="0aeb5-207">O serviço DHCP não compatível com RFC no Azure pode causar uma falha na criação de algumas configurações do cluster de failover, devido à atribuição do nome da rede de cluster a um endereço IP duplicado, por exemplo, o mesmo endereço IP de um dos nós do cluster.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-207">The non-RFC-compliant DHCP service in Azure can cause the creation of certain failover cluster configurations to fail, due to the cluster network name being assigned a duplicate IP address, such as the same IP address as one of the cluster nodes.</span></span> <span data-ttu-id="0aeb5-208">Isso é um problema quando você implementa Grupos de Disponibilidade, que dependem do recurso de cluster de failover do Windows.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-208">This is an issue when you implement Availability Groups, which depends on the Windows failover cluster feature.</span></span>

<span data-ttu-id="0aeb5-209">Considere o cenário onde um cluster de dois nós é criado e colocado online:</span><span class="sxs-lookup"><span data-stu-id="0aeb5-209">Consider the scenario when a two-node cluster is created and brought online:</span></span>

1. <span data-ttu-id="0aeb5-210">O cluster fica online e NODE1 solicita um endereço IP atribuído dinamicamente ao nome de rede de cluster.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-210">The cluster comes online, then NODE1 requests a dynamically assigned IP address for the cluster network name.</span></span>
2. <span data-ttu-id="0aeb5-211">Nenhum endereço IP que não seja o próprio endereço IP do NODE1 é fornecido pelo serviço DHCP, já que o serviço DHCP reconhece que a solicitação vem do próprio NODE1.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-211">No IP address other than NODE1’s own IP address is given by the DHCP service, since the DHCP service recognizes that the request comes from NODE1 itself.</span></span>
3. <span data-ttu-id="0aeb5-212">O Windows detecta que um endereço duplicado é atribuído a NODE1 e ao nome da rede de cluster de failover, e o grupo de clusters padrão não fica online.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-212">Windows detects that a duplicate address is assigned both to NODE1 and to the failover cluster network name, and the default cluster group fails to come online.</span></span>
4. <span data-ttu-id="0aeb5-213">O grupo de clusters padrão é movido para o NODE2, que trata o endereço IP do NODE1 como o endereço IP do cluster e coloca o grupo de clusters padrão online.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-213">The default cluster group moves to NODE2, which treats NODE1’s IP address as the cluster IP address and brings the default cluster group online.</span></span>
5. <span data-ttu-id="0aeb5-214">Quando NODE2 tenta estabelecer conectividade com NODE1, pacotes direcionados ao NODE1 nunca deixam o NODE2, pois ele resolve o endereço IP do NODE1 para si mesmo.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-214">When NODE2 attempts to establish connectivity with NODE1, packets directed at NODE1 never leave NODE2 because it resolves NODE1’s IP address to itself.</span></span> <span data-ttu-id="0aeb5-215">O NODE2 não pode estabelecer conectividade com NODE1, perde quorum e fecha o cluster.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-215">NODE2 cannot establish connectivity with NODE1, then loses quorum and shuts down the cluster.</span></span>
6. <span data-ttu-id="0aeb5-216">Enquanto isso, o NODE1 pode enviar pacotes para o NODE2, mas NODE2 não pode responder.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-216">In the meantime, NODE1 can send packets to NODE2, but NODE2 cannot reply.</span></span> <span data-ttu-id="0aeb5-217">O NODE1 perde quorum e fecha o cluster.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-217">NODE1 loses quorum and shuts down the cluster.</span></span>

<span data-ttu-id="0aeb5-218">Esse cenário pode ser evitado atribuindo um estático endereço IP não usado, como um endereço IP de link local como 169.254.1.1, ao nome da rede de cluster para colocar o nome de rede do cluster online.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-218">This scenario can be avoided by assigning an unused static IP address, such as a link-local IP address like 169.254.1.1, to the cluster network name in order to bring the cluster network name online.</span></span> <span data-ttu-id="0aeb5-219">Para simplificar esse processo, consulte [Configurar cluster de failover do Windows no Azure para grupos de disponibilidade](http://social.technet.microsoft.com/wiki/contents/articles/14776.configuring-windows-failover-cluster-in-windows-azure-for-alwayson-availability-groups.aspx).</span><span class="sxs-lookup"><span data-stu-id="0aeb5-219">To simplify this process, see [Configuring Windows failover cluster in Azure for availability groups](http://social.technet.microsoft.com/wiki/contents/articles/14776.configuring-windows-failover-cluster-in-windows-azure-for-alwayson-availability-groups.aspx).</span></span>

<span data-ttu-id="0aeb5-220">Para saber mais, consulte [Configurar grupos de disponibilidade no Azure (GUI)](virtual-machines-windows-portal-sql-alwayson-availability-groups.md).</span><span class="sxs-lookup"><span data-stu-id="0aeb5-220">For more information, see [Configure availability groups in Azure (GUI)](virtual-machines-windows-portal-sql-alwayson-availability-groups.md).</span></span>

### <a name="availability-group-listener-support"></a><span data-ttu-id="0aeb5-221">Suporte do ouvinte do grupo de disponibilidade</span><span class="sxs-lookup"><span data-stu-id="0aeb5-221">Availability group listener support</span></span>
<span data-ttu-id="0aeb5-222">Ouvintes do grupo de disponibilidade têm suporte em VMs do Azure que executam o Windows Server 2008 R2, Windows Server 2012, Windows Server 2012 R2 e Windows Server 2016.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-222">Availability group listeners are supported on Azure VMs running Windows Server 2008 R2, Windows Server 2012, Windows Server 2012 R2, and Windows Server 2016.</span></span> <span data-ttu-id="0aeb5-223">Esse suporte é possibilitado pelo uso de pontos de extremidade habilitados em VMs do Azure, que são nós do grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-223">This support is made possible by the use of load-balanced endpoints enabled on the Azure VMs that are availability group nodes.</span></span> <span data-ttu-id="0aeb5-224">Você deve seguir etapas especiais de configuração para que os ouvintes trabalhem para ambos os aplicativos clientes que estão em execução no Azure, bem como os que estão em execução local.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-224">You must follow special configuration steps for the listeners to work for both client applications that are running in Azure as well as those running on-premises.</span></span>

<span data-ttu-id="0aeb5-225">Há duas opções principais para configurar o ouvinte: externo (público) ou interno.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-225">There are two main options for setting up your listener: external (public) or internal.</span></span> <span data-ttu-id="0aeb5-226">O ouvinte (público) externo usa um balanceador de carga voltado para a Internet e é associado a um IP Virtual público (VIP) acessível pela Internet.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-226">The external (public) listener uses an internet facing load balancer and is associated with a public Virtual IP (VIP) that is accessible over the internet.</span></span> <span data-ttu-id="0aeb5-227">Um ouvinte interno usa um balanceador de carga interno e só oferece suporte a clientes na mesma rede virtual.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-227">An internal listener uses an internal load balancer and only supports clients within the same Virtual Network.</span></span> <span data-ttu-id="0aeb5-228">Para qualquer desses dois tipos de balanceador de carga, você deve habilitar o retorno de servidor direto.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-228">For either load balancer type, you must enable Direct Server Return.</span></span> 

<span data-ttu-id="0aeb5-229">Se o Grupo de disponibilidade abranger várias sub-redes do Azure (como uma implantação que cruza regiões do Azure), a cadeia de conexão do cliente deve incluir "**MultisubnetFailover=True**".</span><span class="sxs-lookup"><span data-stu-id="0aeb5-229">If the Availability Group spans multiple Azure subnets (such as a deployment that crosses Azure regions), the client connection string must include "**MultisubnetFailover=True**".</span></span> <span data-ttu-id="0aeb5-230">Isso resulta em tentativas de conexão em paralelo às réplicas nas diferentes sub-redes.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-230">This results in parallel connection attempts to the replicas in the different subnets.</span></span> <span data-ttu-id="0aeb5-231">Para obter instruções sobre como configurar um ouvinte, consulte</span><span class="sxs-lookup"><span data-stu-id="0aeb5-231">For instructions on setting up a listener, see</span></span>

* <span data-ttu-id="0aeb5-232">[Configurar um ouvinte de ILB para grupos de disponibilidade no Azure](virtual-machines-windows-portal-sql-ps-alwayson-int-listener.md).</span><span class="sxs-lookup"><span data-stu-id="0aeb5-232">[Configure an ILB listener for availability groups in Azure](virtual-machines-windows-portal-sql-ps-alwayson-int-listener.md).</span></span>
* <span data-ttu-id="0aeb5-233">[Configurar um ouvinte externo para grupos de disponibilidade no Azure](../classic/ps-sql-ext-listener.md).</span><span class="sxs-lookup"><span data-stu-id="0aeb5-233">[Configure an external listener for availability groups in Azure](../classic/ps-sql-ext-listener.md).</span></span>

<span data-ttu-id="0aeb5-234">Você pode ainda se conectar a cada réplica de disponibilidade separadamente conectando-se diretamente à instância do serviço.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-234">You can still connect to each availability replica separately by connecting directly to the service instance.</span></span> <span data-ttu-id="0aeb5-235">Além disso, como os grupos de disponibilidade são compatíveis com versões anteriores com clientes de espelhamento de banco de dados, você pode se conectar a réplicas de disponibilidade, como parceiros de espelhamento, desde que as réplicas sejam configuradas de forma semelhante ao espelhamento do banco de dados:</span><span class="sxs-lookup"><span data-stu-id="0aeb5-235">Also, since availability groups are backward compatible with database mirroring clients, you can connect to the availability replicas like database mirroring partners as long as the replicas are configured similar to database mirroring:</span></span>

* <span data-ttu-id="0aeb5-236">Uma réplica primária e uma réplica secundária</span><span class="sxs-lookup"><span data-stu-id="0aeb5-236">One primary replica and one secondary replica</span></span>
* <span data-ttu-id="0aeb5-237">A réplica secundária é configurada como ilegível (**opção Secundária Legível** definida como **Não**)</span><span class="sxs-lookup"><span data-stu-id="0aeb5-237">The secondary replica is configured as non-readable (**Readable Secondary** option set to **No**)</span></span>

<span data-ttu-id="0aeb5-238">Um exemplo de cadeia de conexão de cliente que corresponde à configuração deste espelhamento de banco de dados usando ADO.NET ou o SQL Server Native Client é ilustrado abaixo:</span><span class="sxs-lookup"><span data-stu-id="0aeb5-238">An example client connection string that corresponds to this database mirroring-like configuration using ADO.NET or SQL Server Native Client is below:</span></span>

    Data Source=ReplicaServer1;Failover Partner=ReplicaServer2;Initial Catalog=AvailabilityDatabase;

<span data-ttu-id="0aeb5-239">Para obter mais informações sobre conectividade de cliente, consulte:</span><span class="sxs-lookup"><span data-stu-id="0aeb5-239">For more information on client connectivity, see:</span></span>

* [<span data-ttu-id="0aeb5-240">Usando palavras-chave da cadeia de conexão com o SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="0aeb5-240">Using Connection String Keywords with SQL Server Native Client</span></span>](https://msdn.microsoft.com/library/ms130822.aspx)
* [<span data-ttu-id="0aeb5-241">Conectar clientes a uma sessão de espelhamento de banco de dados (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="0aeb5-241">Connect Clients to a Database Mirroring Session (SQL Server)</span></span>](https://technet.microsoft.com/library/ms175484.aspx)
* [<span data-ttu-id="0aeb5-242">Conectando-se ao ouvinte do grupo de disponibilidade em TI híbrida</span><span class="sxs-lookup"><span data-stu-id="0aeb5-242">Connecting to Availability Group Listener in Hybrid IT</span></span>](http://blogs.msdn.com/b/sqlalwayson/archive/2013/02/14/connecting-to-availability-group-listener-in-hybrid-it.aspx)
* [<span data-ttu-id="0aeb5-243">Ouvintes de grupo de disponibilidade, conectividade de cliente e failover de aplicativo (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="0aeb5-243">Availability Group Listeners, Client Connectivity, and Application Failover (SQL Server)</span></span>](https://technet.microsoft.com/library/hh213417.aspx)
* [<span data-ttu-id="0aeb5-244">Usando cadeias de conexão de espelhamento de banco de dados com grupos de disponibilidade</span><span class="sxs-lookup"><span data-stu-id="0aeb5-244">Using Database-Mirroring Connection Strings with Availability Groups</span></span>](https://technet.microsoft.com/library/hh213417.aspx)

### <a name="network-latency-in-hybrid-it"></a><span data-ttu-id="0aeb5-245">Latência de rede em TI híbrida</span><span class="sxs-lookup"><span data-stu-id="0aeb5-245">Network latency in hybrid IT</span></span>
<span data-ttu-id="0aeb5-246">Você deve implantar sua solução HADR com a suposição de que pode haver períodos com alta latência da rede entre sua rede local e o Azure.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-246">You should deploy your HADR solution with the assumption that there may be periods of time with high network latency between your on-premises network and Azure.</span></span> <span data-ttu-id="0aeb5-247">Ao implantar réplicas do Azure, você deve usar confirmação assíncrona, em vez de confirmação síncrona, para o modo de sincronização.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-247">When deploying replicas to Azure, you should use asynchronous commit instead of synchronous commit for the synchronization mode.</span></span> <span data-ttu-id="0aeb5-248">Ao implantar servidores de espelhamento de banco de dados localmente e no Azure, use o modo de alto desempenho, em vez do modo de alta segurança.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-248">When deploying database mirroring servers both on-premises and in Azure, use the high-performance mode instead of the high-safety mode.</span></span>

### <a name="geo-replication-support"></a><span data-ttu-id="0aeb5-249">Suporte para replicação geográfica</span><span class="sxs-lookup"><span data-stu-id="0aeb5-249">Geo-replication support</span></span>
<span data-ttu-id="0aeb5-250">A replicação geográfica em discos do Azure não dá suporte ao arquivo de dados e ao arquivo de log do mesmo banco de dados a ser armazenado em discos separados.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-250">Geo-replication in Azure disks does not support the data file and log file of the same database to be stored on separate disks.</span></span> <span data-ttu-id="0aeb5-251">GRS replica as alterações em cada disco, de forma independente e assíncrona.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-251">GRS replicates changes on each disk independently and asynchronously.</span></span> <span data-ttu-id="0aeb5-252">Esse mecanismo garante a ordem de gravação em um único disco na cópia replicada geograficamente, mas não em cópias replicadas geograficamente de vários discos.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-252">This mechanism guarantees the write order within a single disk on the geo-replicated copy, but not across geo-replicated copies of multiple disks.</span></span> <span data-ttu-id="0aeb5-253">Se você configurar um banco de dados para armazenar arquivo de dados e arquivo de log em discos separados, os discos recuperados após um desastre poderão conter uma cópia mais recente do arquivo de dados do que o arquivo de log, interrompendo o log write-ahead no SQL Server e as propriedades ACID das transações.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-253">If you configure a database to store its data file and its log file on separate disks, the recovered disks after a disaster may contain a more up-to-date copy of the data file than the log file, which breaks the write-ahead log in SQL Server and the ACID properties of transactions.</span></span> <span data-ttu-id="0aeb5-254">Se você não tiver a opção de desabilitar a replicação geográfica na conta de armazenamento, deverá manter todos os dados e arquivos de log em determinado banco de dados no mesmo disco.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-254">If you do not have the option to disable geo-replication on the storage account, you should keep all data and log files for a given database on the same disk.</span></span> <span data-ttu-id="0aeb5-255">Se você precisar usar mais de um disco devido ao tamanho do banco de dados, terá de implantar uma das soluções de recuperação de desastres listadas anteriormente para garantir a redundância dos dados.</span><span class="sxs-lookup"><span data-stu-id="0aeb5-255">If you must use more than one disk due to the size of the database, you need to deploy one of the disaster recovery solutions listed above to ensure data redundancy.</span></span>

## <a name="next-steps"></a><span data-ttu-id="0aeb5-256">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="0aeb5-256">Next steps</span></span>
<span data-ttu-id="0aeb5-257">Se você precisar criar uma máquina virtual do Azure com SQL Server, consulte [Provisionando uma Máquina Virtual do SQL Server no Azure](virtual-machines-windows-portal-sql-server-provision.md).</span><span class="sxs-lookup"><span data-stu-id="0aeb5-257">If you need to create an Azure virtual machine with SQL Server, see [Provisioning a SQL Server Virtual Machine on Azure](virtual-machines-windows-portal-sql-server-provision.md).</span></span>

<span data-ttu-id="0aeb5-258">Para obter o melhor desempenho do SQL Server em execução em uma VM do Azure, consulte as diretrizes em [Práticas Recomentadas para o Desempenho do SQL Server em Máquinas Virtuais do Azure](virtual-machines-windows-sql-performance.md).</span><span class="sxs-lookup"><span data-stu-id="0aeb5-258">To get the best performance from SQL Server running on an Azure VM, see the guidance in [Performance Best Practices for SQL Server in Azure Virtual Machines](virtual-machines-windows-sql-performance.md).</span></span>

<span data-ttu-id="0aeb5-259">Para outros tópicos relacionados à execução do SQL Server em VMs do Azure, consulte [SQL Server em Máquinas Virtuais do Azure](virtual-machines-windows-sql-server-iaas-overview.md).</span><span class="sxs-lookup"><span data-stu-id="0aeb5-259">For other topics related to running SQL Server in Azure VMs, see [SQL Server on Azure Virtual Machines](virtual-machines-windows-sql-server-iaas-overview.md).</span></span>

### <a name="other-resources"></a><span data-ttu-id="0aeb5-260">Outros recursos</span><span class="sxs-lookup"><span data-stu-id="0aeb5-260">Other resources</span></span>
* [<span data-ttu-id="0aeb5-261">Instalar uma nova floresta do Active Directory no Azure</span><span class="sxs-lookup"><span data-stu-id="0aeb5-261">Install a new Active Directory forest in Azure</span></span>](../../../active-directory/active-directory-new-forest-virtual-machine.md)
* [<span data-ttu-id="0aeb5-262">Criar um cluster de failover para grupos de disponibilidade em uma VM do Azure</span><span class="sxs-lookup"><span data-stu-id="0aeb5-262">Create Failover Cluster for availability groups in Azure VM</span></span>](http://gallery.technet.microsoft.com/scriptcenter/Create-WSFC-Cluster-for-7c207d3a)

