---
title: aaaConfigure um ouvinte externo para grupos de disponibilidade AlwaysOn | Microsoft Docs
description: "Este tutorial aborda você nas etapas de criação de um sempre no ouvinte do grupo disponibilidade no Azure que é acessível externamente usando Olá endereço IP Virtual público do hello serviço de nuvem associado."
services: virtual-machines-windows
documentationcenter: na
author: MikeRayMSFT
manager: jhubbard
editor: 
tags: azure-service-management
ms.assetid: a2453032-94ab-4775-b976-c74d24716728
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 05/31/2017
ms.author: mikeray
ms.openlocfilehash: f8e2110bcc25d9cb7653675cb4ae5c8d717b6902
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="configure-an-external-listener-for-always-on-availability-groups-in-azure"></a><span data-ttu-id="6929d-103">Configurar um ouvinte externo para grupos de disponibilidade AlwaysOn no Azure</span><span class="sxs-lookup"><span data-stu-id="6929d-103">Configure an external listener for Always On Availability Groups in Azure</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="6929d-104">Ouvinte interno</span><span class="sxs-lookup"><span data-stu-id="6929d-104">Internal Listener</span></span>](../classic/ps-sql-int-listener.md)
> * [<span data-ttu-id="6929d-105">Ouvinte externo</span><span class="sxs-lookup"><span data-stu-id="6929d-105">External Listener</span></span>](../classic/ps-sql-ext-listener.md)
> 
> 

<span data-ttu-id="6929d-106">Este tópico mostra como tooconfigure um ouvinte para um grupo de disponibilidade AlwaysOn externamente acessível Olá da internet.</span><span class="sxs-lookup"><span data-stu-id="6929d-106">This topic shows you how tooconfigure a listener for an Always On Availability Group that is externally accessible on hello internet.</span></span> <span data-ttu-id="6929d-107">Isso é possibilitado por meio da associação do serviço de nuvem Olá **IP Virtual público (VIP)** endereço com o ouvinte de saudação.</span><span class="sxs-lookup"><span data-stu-id="6929d-107">This is made possible by associating hello cloud service's **public Virtual IP (VIP)** address with hello listener.</span></span>

> [!IMPORTANT] 
> <span data-ttu-id="6929d-108">O Azure tem dois modelos de implantação diferentes para criar e trabalhar com recursos: [Gerenciador de Recursos e Clássico](../../../azure-resource-manager/resource-manager-deployment-model.md).</span><span class="sxs-lookup"><span data-stu-id="6929d-108">Azure has two different deployment models for creating and working with resources: [Resource Manager and Classic](../../../azure-resource-manager/resource-manager-deployment-model.md).</span></span> <span data-ttu-id="6929d-109">Este artigo aborda usando o modelo de implantação clássico hello.</span><span class="sxs-lookup"><span data-stu-id="6929d-109">This article covers using hello Classic deployment model.</span></span> <span data-ttu-id="6929d-110">A Microsoft recomenda que mais novas implantações de usam o modelo do Gerenciador de recursos de saudação.</span><span class="sxs-lookup"><span data-stu-id="6929d-110">Microsoft recommends that most new deployments use hello Resource Manager model.</span></span>

<span data-ttu-id="6929d-111">O seu grupo de disponibilidade pode conter somente réplicas locais, somente no Azure ou locais e no Azure para configurações híbridas.</span><span class="sxs-lookup"><span data-stu-id="6929d-111">Your Availability Group can contain replicas that are on-premises only, Azure only, or span both on-premises and Azure for hybrid configurations.</span></span> <span data-ttu-id="6929d-112">Réplicas do Azure podem residir em Olá mesma região ou em várias regiões usando várias redes virtuais (VNets).</span><span class="sxs-lookup"><span data-stu-id="6929d-112">Azure replicas can reside within hello same region or across multiple regions using multiple virtual networks (VNets).</span></span> <span data-ttu-id="6929d-113">Olá estas etapas pressupõem que você já tiver [configurado um grupo de disponibilidade](../classic/portal-sql-alwayson-availability-groups.md) , mas não configurou um ouvinte.</span><span class="sxs-lookup"><span data-stu-id="6929d-113">hello steps below assume you have already [configured an availability group](../classic/portal-sql-alwayson-availability-groups.md) but have not configured a listener.</span></span>

## <a name="guidelines-and-limitations-for-external-listeners"></a><span data-ttu-id="6929d-114">Diretrizes e limitações para ouvintes externos</span><span class="sxs-lookup"><span data-stu-id="6929d-114">Guidelines and limitations for external listeners</span></span>
<span data-ttu-id="6929d-115">Observe Olá seguindo as diretrizes sobre o ouvinte do grupo de disponibilidade Olá no Azure durante a implantação usando Olá endereço serviço de nuvem publicado VIP:</span><span class="sxs-lookup"><span data-stu-id="6929d-115">Note hello following guidelines about hello availability group listener in Azure when you are deploying using hello cloud service pubic VIP address:</span></span>

* <span data-ttu-id="6929d-116">há suporte para o ouvinte do grupo de disponibilidade Olá no Windows Server 2008 R2, Windows Server 2012 e Windows Server 2012 R2.</span><span class="sxs-lookup"><span data-stu-id="6929d-116">hello availability group listener is supported on Windows Server 2008 R2, Windows Server 2012, and Windows Server 2012 R2.</span></span>
* <span data-ttu-id="6929d-117">aplicativo de cliente Hello deve residir em um serviço de nuvem diferente Olá que contém suas máquinas virtuais do grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="6929d-117">hello client application must reside on a different cloud service than hello one that contains your availability group VMs.</span></span> <span data-ttu-id="6929d-118">Serviço de nuvem do Azure não suporta servidor direto retornar com cliente e servidor de saudação mesmo.</span><span class="sxs-lookup"><span data-stu-id="6929d-118">Azure does not support direct server return with client and server in hello same cloud service.</span></span>
* <span data-ttu-id="6929d-119">Por padrão, etapas Olá neste artigo mostram como endereço IP Virtual (VIP) do serviço em nuvem tooconfigure Olá de toouse de um ouvinte.</span><span class="sxs-lookup"><span data-stu-id="6929d-119">By default, hello steps in this article show how tooconfigure one listener toouse hello cloud service Virtual IP (VIP) address.</span></span> <span data-ttu-id="6929d-120">No entanto, é possível tooreserve e criar vários endereços VIP para seu serviço de nuvem.</span><span class="sxs-lookup"><span data-stu-id="6929d-120">However, it is possible tooreserve and create multiple VIP addresses for your cloud service.</span></span> <span data-ttu-id="6929d-121">Isso permite que você toouse etapas Olá este toocreate artigo vários ouvintes que estão associados a um VIP diferente.</span><span class="sxs-lookup"><span data-stu-id="6929d-121">This enables you toouse hello steps in this article toocreate multiple listeners that are each associated with a different VIP.</span></span> <span data-ttu-id="6929d-122">Para obter informações sobre como toocreate vários endereços VIP, consulte [vários VIPs por serviço de nuvem](../../../load-balancer/load-balancer-multivip.md).</span><span class="sxs-lookup"><span data-stu-id="6929d-122">For information on how toocreate multiple VIP addresses, see [Multiple VIPs per cloud service](../../../load-balancer/load-balancer-multivip.md).</span></span>
* <span data-ttu-id="6929d-123">Se você estiver criando um ouvinte para um ambiente híbrido, a rede de local de saudação deve ter conectividade toohello Internet pública em adição toohello VPN site a site com hello rede virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="6929d-123">If you are creating a listener for a hybrid environment, hello on-premises network must have connectivity toohello public Internet in addition toohello site-to-site VPN with hello Azure virtual network.</span></span> <span data-ttu-id="6929d-124">Quando em Olá sub-rede do Azure, o ouvinte do grupo de disponibilidade de saudação é alcançável somente pelo endereço IP público de Olá Olá respectivos do serviço de nuvem.</span><span class="sxs-lookup"><span data-stu-id="6929d-124">When in hello Azure subnet, hello availability group listener is reachable only by hello public IP address of hello respective cloud service.</span></span>
* <span data-ttu-id="6929d-125">Não há suporte para toocreate um ouvinte externo no hello mesmo serviço em que você também tem um ouvinte interno usando na nuvem Olá balanceador de carga interno (ILB).</span><span class="sxs-lookup"><span data-stu-id="6929d-125">It is not supported toocreate an external listener in hello same cloud service where you also have an internal listener using hello Internal Load Balancer (ILB).</span></span>

## <a name="determine-hello-accessibility-of-hello-listener"></a><span data-ttu-id="6929d-126">Determinar a acessibilidade de saudação do ouvinte Olá</span><span class="sxs-lookup"><span data-stu-id="6929d-126">Determine hello accessibility of hello listener</span></span>
[!INCLUDE [ag-listener-accessibility](../../../../includes/virtual-machines-ag-listener-determine-accessibility.md)]

<span data-ttu-id="6929d-127">Este artigo se concentra na criação de um ouvinte que use o **balanceamento de carga externo**.</span><span class="sxs-lookup"><span data-stu-id="6929d-127">This article focuses on creating a listener that uses **external load balancing**.</span></span> <span data-ttu-id="6929d-128">Se você quiser um ouvinte de rede virtual privada tooyour, consulte versão Olá deste artigo que fornece as etapas para configurar um [ouvinte com o ILB](../classic/ps-sql-int-listener.md)</span><span class="sxs-lookup"><span data-stu-id="6929d-128">If you want a listener that is private tooyour virtual network, see hello version of this article that provides steps for setting up an [listener with ILB](../classic/ps-sql-int-listener.md)</span></span>

## <a name="create-load-balanced-vm-endpoints-with-direct-server-return"></a><span data-ttu-id="6929d-129">Criar pontos de extremidade da VM com balanceamento de carga com retorno de servidor direto</span><span class="sxs-lookup"><span data-stu-id="6929d-129">Create load-balanced VM endpoints with direct server return</span></span>
<span data-ttu-id="6929d-130">Balanceamento de carga externa usa Olá Olá virtual endereço IP Virtual público saudação do serviço de nuvem que hospeda suas VMs.</span><span class="sxs-lookup"><span data-stu-id="6929d-130">External load balancing uses hello virtual hello public Virtual IP address of hello cloud service that hosts your VMs.</span></span> <span data-ttu-id="6929d-131">Para que você não precisa toocreate ou configure o balanceador de carga de saudação nesse caso.</span><span class="sxs-lookup"><span data-stu-id="6929d-131">So you do not need toocreate or configure hello load balancer in this case.</span></span>

<span data-ttu-id="6929d-132">Você deve criar um ponto de extremidade de carga equilibrada para cada VM que hospeda uma réplica do Azure.</span><span class="sxs-lookup"><span data-stu-id="6929d-132">You must create a load-balanced endpoint for each VM hosting an Azure replica.</span></span> <span data-ttu-id="6929d-133">Se você tiver réplicas em várias regiões, cada réplica para essa região deve estar no mesmo serviço de nuvem de saudação Olá mesma rede virtual.</span><span class="sxs-lookup"><span data-stu-id="6929d-133">If you have replicas in multiple regions, each replica for that region must be in hello same cloud service in hello same VNet.</span></span> <span data-ttu-id="6929d-134">Criação de réplicas do Grupo de Disponibilidade que abrangem várias regiões do Azure requer configurar diversas VNets.</span><span class="sxs-lookup"><span data-stu-id="6929d-134">Creating Availability Group replicas that span multiple Azure regions requires configuring multiple VNets.</span></span> <span data-ttu-id="6929d-135">Para obter mais informações sobre como configurar a conectividade de rede virtual cruzada, consulte [tooVNet VNet configurar conectividade](../../../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md).</span><span class="sxs-lookup"><span data-stu-id="6929d-135">For more information on configuring cross VNet connectivity, see  [Configure VNet tooVNet Connectivity](../../../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md).</span></span>

1. <span data-ttu-id="6929d-136">No portal do Azure de Olá, navegue tooeach VM hospedando uma réplica e exibir os detalhes hello.</span><span class="sxs-lookup"><span data-stu-id="6929d-136">In hello Azure portal, navigate tooeach VM hosting a replica and view hello details.</span></span>
2. <span data-ttu-id="6929d-137">Clique em Olá **pontos de extremidade** guia para cada uma das VMs hello.</span><span class="sxs-lookup"><span data-stu-id="6929d-137">Click hello **Endpoints** tab for each of hello VMs.</span></span>
3. <span data-ttu-id="6929d-138">Verifique se esse Olá **nome** e **porta pública** do ponto de extremidade de escuta Olá deseja toouse não ainda estiver em uso.</span><span class="sxs-lookup"><span data-stu-id="6929d-138">Verify that hello **Name** and **Public Port** of hello listener endpoint you want toouse is not already in use.</span></span> <span data-ttu-id="6929d-139">O exemplo hello abaixo, Olá nome é "MyEndpoint" e porta de saudação é "1433".</span><span class="sxs-lookup"><span data-stu-id="6929d-139">In hello example below, hello name is “MyEndpoint” and hello port is “1433”.</span></span>
4. <span data-ttu-id="6929d-140">No cliente local, baixe e instale [módulo do PowerShell mais recente Olá](https://azure.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="6929d-140">On your local client, download and install [hello latest PowerShell module](https://azure.microsoft.com/downloads/).</span></span>
5. <span data-ttu-id="6929d-141">Inicie o **PowerShell do Azure**.</span><span class="sxs-lookup"><span data-stu-id="6929d-141">Launch **Azure PowerShell**.</span></span> <span data-ttu-id="6929d-142">Um novo PowerShell sessão é aberta com hello módulos administrativos do Azure carregados.</span><span class="sxs-lookup"><span data-stu-id="6929d-142">A new PowerShell session is opened with hello Azure administrative modules loaded.</span></span>
6. <span data-ttu-id="6929d-143">Executar **Get-AzurePublishSettingsFile**.</span><span class="sxs-lookup"><span data-stu-id="6929d-143">Run **Get-AzurePublishSettingsFile**.</span></span> <span data-ttu-id="6929d-144">Esse cmdlet direciona toodownload de navegador tooa um diretório local tooa de arquivo publicar configurações.</span><span class="sxs-lookup"><span data-stu-id="6929d-144">This cmdlet directs you tooa browser toodownload a publish settings file tooa local directory.</span></span> <span data-ttu-id="6929d-145">É possível que seja solicitado para inserir as suas credenciais para a assinatura do Aure.</span><span class="sxs-lookup"><span data-stu-id="6929d-145">You may be prompted for your log-in credentials for your Azure subscription.</span></span>
7. <span data-ttu-id="6929d-146">Executar Olá **AzurePublishSettingsFile importação** comando com caminho Olá Olá Publicar arquivo de configurações que você baixou:</span><span class="sxs-lookup"><span data-stu-id="6929d-146">Run hello **Import-AzurePublishSettingsFile** command with hello path of hello publish settings file that you downloaded:</span></span>
   
        Import-AzurePublishSettingsFile -PublishSettingsFile <PublishSettingsFilePath>
   
    <span data-ttu-id="6929d-147">Depois que o hello Publicar arquivo de configurações é importado, você pode gerenciar sua assinatura do Azure na sessão do PowerShell hello.</span><span class="sxs-lookup"><span data-stu-id="6929d-147">Once hello publish settings file is imported, you can manage your Azure subscription in hello PowerShell session.</span></span>
    
1. <span data-ttu-id="6929d-148">Copie o script do PowerShell Olá abaixo em um editor de texto e defina Olá valores de variáveis toosuit seu ambiente (padrões foram fornecidos para alguns parâmetros).</span><span class="sxs-lookup"><span data-stu-id="6929d-148">Copy hello PowerShell script below into a text editor and set hello variable values toosuit your environment (defaults have been provided for some parameters).</span></span> <span data-ttu-id="6929d-149">Observe que se seu grupo de disponibilidade abranger regiões do Azure, você deve executar Olá script uma vez em cada data center para o serviço de nuvem hello e nós que residem nesse datacenter.</span><span class="sxs-lookup"><span data-stu-id="6929d-149">Note that if your availability group spans Azure regions, you must run hello script once in each datacenter for hello cloud service and nodes that reside in that datacenter.</span></span>
   
        # Define variables
        $ServiceName = "<MyCloudService>" # hello name of hello cloud service that contains hello availability group nodes
        $AGNodes = "<VM1>","<VM2>","<VM3>" # all availability group nodes containing replicas in hello same cloud service, separated by commas
   
        # Configure a load balanced endpoint for each node in $AGNodes, with direct server return enabled
        ForEach ($node in $AGNodes)
        {
            Get-AzureVM -ServiceName $ServiceName -Name $node | Add-AzureEndpoint -Name "ListenerEndpoint" -Protocol "TCP" -PublicPort 1433 -LocalPort 1433 -LBSetName "ListenerEndpointLB" -ProbePort 59999 -ProbeProtocol "TCP" -DirectServerReturn $true | Update-AzureVM
        }

2. <span data-ttu-id="6929d-150">Depois que você tiver definido as variáveis de Olá, Olá de cópia de script do editor de texto de saudação em seu toorun de sessão do PowerShell do Azure-lo.</span><span class="sxs-lookup"><span data-stu-id="6929d-150">Once you have set hello variables, copy hello script from hello text editor into your Azure PowerShell session toorun it.</span></span> <span data-ttu-id="6929d-151">Se ainda mostrará o prompt Olá >>, digite ENTER novamente se script de saudação toomake começa a ser executado.</span><span class="sxs-lookup"><span data-stu-id="6929d-151">If hello prompt still shows >>, type ENTER again toomake sure hello script starts running.</span></span>

## <a name="verify-that-kb2854082-is-installed-if-necessary"></a><span data-ttu-id="6929d-152">Verifique se KB2854082 está instalado, se necessário</span><span class="sxs-lookup"><span data-stu-id="6929d-152">Verify that KB2854082 is installed if necessary</span></span>
[!INCLUDE [kb2854082](../../../../includes/virtual-machines-ag-listener-kb2854082.md)]

## <a name="open-hello-firewall-ports-in-availability-group-nodes"></a><span data-ttu-id="6929d-153">Abrir as portas de firewall Olá em nós do grupo de disponibilidade</span><span class="sxs-lookup"><span data-stu-id="6929d-153">Open hello firewall ports in availability group nodes</span></span>
[!INCLUDE [firewall](../../../../includes/virtual-machines-ag-listener-open-firewall.md)]

## <a name="create-hello-availability-group-listener"></a><span data-ttu-id="6929d-154">Criar o ouvinte do grupo de disponibilidade Olá</span><span class="sxs-lookup"><span data-stu-id="6929d-154">Create hello availability group listener</span></span>

<span data-ttu-id="6929d-155">Crie o ouvinte do grupo de disponibilidade de saudação em duas etapas.</span><span class="sxs-lookup"><span data-stu-id="6929d-155">Create hello availability group listener in two steps.</span></span> <span data-ttu-id="6929d-156">Primeiro, crie o recurso de cluster de ponto de acesso do hello cliente e configurar as dependências.</span><span class="sxs-lookup"><span data-stu-id="6929d-156">First, create hello client access point cluster resource and configure  dependencies.</span></span> <span data-ttu-id="6929d-157">Em seguida, configure recursos de cluster de saudação com o PowerShell.</span><span class="sxs-lookup"><span data-stu-id="6929d-157">Second, configure hello cluster resources with PowerShell.</span></span>

### <a name="create-hello-client-access-point-and-configure-hello-cluster-dependencies"></a><span data-ttu-id="6929d-158">Criar ponto de acesso para cliente hello e configurar dependências de saudação de cluster</span><span class="sxs-lookup"><span data-stu-id="6929d-158">Create hello client access point and configure hello cluster dependencies</span></span>
[!INCLUDE [firewall](../../../../includes/virtual-machines-ag-listener-create-listener.md)]

### <a name="configure-hello-cluster-resources-in-powershell"></a><span data-ttu-id="6929d-159">Configurar recursos de cluster Olá no PowerShell</span><span class="sxs-lookup"><span data-stu-id="6929d-159">Configure hello cluster resources in PowerShell</span></span>
1. <span data-ttu-id="6929d-160">Para o balanceamento de carga externo, você deve obter Olá endereço IP virtual público saudação do serviço de nuvem que contém suas réplicas.</span><span class="sxs-lookup"><span data-stu-id="6929d-160">For external load balancing, you must obtain hello public virtual IP address of hello cloud service that contains your replicas.</span></span> <span data-ttu-id="6929d-161">Faça logon no hello portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="6929d-161">Log into hello Azure portal.</span></span> <span data-ttu-id="6929d-162">Navegue toohello serviço de nuvem que contém o grupo de disponibilidade VM.</span><span class="sxs-lookup"><span data-stu-id="6929d-162">Navigate toohello cloud service that contains your availability group VM.</span></span> <span data-ttu-id="6929d-163">Olá abrir **painel** exibição.</span><span class="sxs-lookup"><span data-stu-id="6929d-163">Open hello **Dashboard** view.</span></span>
2. <span data-ttu-id="6929d-164">Observe o endereço de saudação mostrado em **endereço IP Virtual público (VIP)**.</span><span class="sxs-lookup"><span data-stu-id="6929d-164">Note hello address shown under **Public Virtual IP (VIP) Address**.</span></span> <span data-ttu-id="6929d-165">Se a sua solução abrange VNets, repita essa etapa para cada serviço de nuvem que contém uma VM que hospeda uma réplica.</span><span class="sxs-lookup"><span data-stu-id="6929d-165">If your solution spans VNets, repeat this step for each cloud service that contains a VM that hosts a replica.</span></span>
3. <span data-ttu-id="6929d-166">Em um dos Olá VMs, copie Olá script do PowerShell abaixo em um editor de texto e defina as variáveis de saudação toohello valores anotados anteriormente.</span><span class="sxs-lookup"><span data-stu-id="6929d-166">On one of hello VMs, copy hello PowerShell script below into a text editor and set hello variables toohello values you noted earlier.</span></span>
   
        # Define variables
        $ClusterNetworkName = "<ClusterNetworkName>" # hello cluster network name (Use Get-ClusterNetwork on Windows Server 2012 of higher toofind hello name)
        $IPResourceName = "<IPResourceName>" # hello IP Address resource name
        $CloudServiceIP = "<X.X.X.X>" # Public Virtual IP (VIP) address of your cloud service
   
        Import-Module FailoverClusters
   
        # If you are using Windows Server 2012 or higher, use hello Get-Cluster Resource command. If you are using Windows Server 2008 R2, use hello cluster res command. Both commands are commented out. Choose hello one applicable tooyour environment and remove hello # at hello beginning of hello line tooconvert hello comment tooan executable line of code.
   
        # Get-ClusterResource $IPResourceName | Set-ClusterParameter -Multiple @{"Address"="$CloudServiceIP";"ProbePort"="59999";"SubnetMask"="255.255.255.255";"Network"="$ClusterNetworkName";"OverrideAddressMatch"=1;"EnableDhcp"=0}
        # cluster res $IPResourceName /priv enabledhcp=0 overrideaddressmatch=1 address=$CloudServiceIP probeport=59999  subnetmask=255.255.255.255
4. <span data-ttu-id="6929d-167">Uma vez você tiver definido as variáveis de hello, abra uma janela do Windows PowerShell com privilégios elevados, copia script hello do editor de texto de saudação e colá-lo em seu toorun de sessão do PowerShell do Azure.</span><span class="sxs-lookup"><span data-stu-id="6929d-167">Once you have set hello variables, open an elevated Windows PowerShell window, then copy hello script from hello text editor and paste into your Azure PowerShell session toorun it.</span></span> <span data-ttu-id="6929d-168">Se ainda mostrará o prompt Olá >>, digite ENTER novamente se script de saudação toomake começa a ser executado.</span><span class="sxs-lookup"><span data-stu-id="6929d-168">If hello prompt still shows >>, type ENTER again toomake sure hello script starts running.</span></span>
5. <span data-ttu-id="6929d-169">Repita esse procedimento em cada VM.</span><span class="sxs-lookup"><span data-stu-id="6929d-169">Repeat this on each VM.</span></span> <span data-ttu-id="6929d-170">Esse script configura o recurso de endereço IP de saudação com o endereço IP Olá Olá do serviço de nuvem e define outros parâmetros como a porta de investigação de saudação.</span><span class="sxs-lookup"><span data-stu-id="6929d-170">This script configures hello IP Address resource with hello IP address of hello cloud service and sets other parameters like hello probe port.</span></span> <span data-ttu-id="6929d-171">Quando Olá recurso de endereço IP está online, ele pode responder toohello sondagem na porta de investigação de saudação do ponto de extremidade com balanceamento de carga de saudação criada anteriormente neste tutorial.</span><span class="sxs-lookup"><span data-stu-id="6929d-171">When hello IP Address resource is brought online, it can then respond toohello polling on hello probe port from hello load-balanced endpoint created earlier in this tutorial.</span></span>

## <a name="bring-hello-listener-online"></a><span data-ttu-id="6929d-172">Coloque o ouvinte Olá online</span><span class="sxs-lookup"><span data-stu-id="6929d-172">Bring hello listener online</span></span>
[!INCLUDE [Bring-Listener-Online](../../../../includes/virtual-machines-ag-listener-bring-online.md)]

## <a name="follow-up-items"></a><span data-ttu-id="6929d-173">Itens de acompanhamento</span><span class="sxs-lookup"><span data-stu-id="6929d-173">Follow-up items</span></span>
[!INCLUDE [Follow-up](../../../../includes/virtual-machines-ag-listener-follow-up.md)]

## <a name="test-hello-availability-group-listener-within-hello-same-vnet"></a><span data-ttu-id="6929d-174">Ouvinte de grupo de disponibilidade do teste hello (Olá na mesma rede virtual)</span><span class="sxs-lookup"><span data-stu-id="6929d-174">Test hello availability group listener (within hello same VNet)</span></span>
[!INCLUDE [Test-Listener-Within-VNET](../../../../includes/virtual-machines-ag-listener-test.md)]

## <a name="test-hello-availability-group-listener-over-hello-internet"></a><span data-ttu-id="6929d-175">Ouvinte de grupo de disponibilidade do teste hello (sobre Olá da internet)</span><span class="sxs-lookup"><span data-stu-id="6929d-175">Test hello availability group listener (over hello internet)</span></span>
<span data-ttu-id="6929d-176">Em ordem tooaccess Olá ouvinte de rede virtual externa Olá é necessário usar o balanceamento de carga de externas/público (descrito neste tópico), em vez de ILB, que é somente acessível em hello mesma rede virtual.</span><span class="sxs-lookup"><span data-stu-id="6929d-176">In order tooaccess hello listener from outside hello virtual network, you must be using external/public load balancing (described in this topic) rather than ILB, which is only accesible within hello same VNet.</span></span> <span data-ttu-id="6929d-177">Na cadeia de caracteres de conexão Olá, você deve especificar o nome de serviço de nuvem hello.</span><span class="sxs-lookup"><span data-stu-id="6929d-177">In hello connection string, you specify hello cloud service name.</span></span> <span data-ttu-id="6929d-178">Por exemplo, se você tiver um serviço de nuvem com o nome da saudação *mycloudservice*, instrução de sqlcmd Olá seria o seguinte:</span><span class="sxs-lookup"><span data-stu-id="6929d-178">For example, if you had a cloud service with hello name *mycloudservice*, hello sqlcmd statement would be as follows:</span></span>

    sqlcmd -S "mycloudservice.cloudapp.net,<EndpointPort>" -d "<DatabaseName>" -U "<LoginId>" -P "<Password>"  -Q "select @@servername, db_name()" -l 15

<span data-ttu-id="6929d-179">Ao contrário do exemplo anterior de saudação, autenticação do SQL deve ser usada, porque o chamador Olá não é possível usar a autenticação do windows em Olá internet.</span><span class="sxs-lookup"><span data-stu-id="6929d-179">Unlike hello previous example, SQL authentication must be used, because hello caller cannot use windows authentication over hello internet.</span></span> <span data-ttu-id="6929d-180">Para obter mais informações, consulte [AlwaysOn Availability Group in Azure VM: Client Connectivity Scenarios](http://blogs.msdn.com/b/sqlcat/archive/2014/02/03/alwayson-availability-group-in-windows-azure-vm-client-connectivity-scenarios.aspx)(Grupo de disponibilidade AlwaysOn na VM do Azure: cenários de conectividade do cliente).</span><span class="sxs-lookup"><span data-stu-id="6929d-180">For more information, see [Always On Availability Group in Azure VM: Client Connectivity Scenarios](http://blogs.msdn.com/b/sqlcat/archive/2014/02/03/alwayson-availability-group-in-windows-azure-vm-client-connectivity-scenarios.aspx).</span></span> <span data-ttu-id="6929d-181">Ao usar a autenticação do SQL, certifique-se de que você crie Olá mesmo logon em ambas as réplicas.</span><span class="sxs-lookup"><span data-stu-id="6929d-181">When using SQL authentication, make sure that you create hello same login on both replicas.</span></span> <span data-ttu-id="6929d-182">Para obter mais informações sobre como solucionar problemas de logons com grupos de disponibilidade, consulte [como toomap logons ou usar contidos SQL réplicas de tooother de tooconnect de usuário de banco de dados e mapear os bancos de dados tooavailability](http://blogs.msdn.com/b/alwaysonpro/archive/2014/02/19/how-to-map-logins-or-use-contained-sql-database-user-to-connect-to-other-replicas-and-map-to-availability-databases.aspx).</span><span class="sxs-lookup"><span data-stu-id="6929d-182">For more information about troubleshooting logins with Availability Groups, see [How toomap logins or use contained SQL database user tooconnect tooother replicas and map tooavailability databases](http://blogs.msdn.com/b/alwaysonpro/archive/2014/02/19/how-to-map-logins-or-use-contained-sql-database-user-to-connect-to-other-replicas-and-map-to-availability-databases.aspx).</span></span>

<span data-ttu-id="6929d-183">Se Olá sempre em réplicas estiverem em sub-redes diferentes, os clientes deverão especificar **MultisubnetFailover = True** na cadeia de caracteres de conexão de saudação.</span><span class="sxs-lookup"><span data-stu-id="6929d-183">If hello Always On replicas are in different subnets, clients must specify **MultisubnetFailover=True** in hello connection string.</span></span> <span data-ttu-id="6929d-184">Isso resulta em tooreplicas de tentativas de conexão paralelas em sub-redes diferentes hello.</span><span class="sxs-lookup"><span data-stu-id="6929d-184">This results in parallel connection attempts tooreplicas in hello different subnets.</span></span> <span data-ttu-id="6929d-185">Observe que esse cenário inclui uma implantação de grupo de disponibilidade do AlwaysOn entre regiões.</span><span class="sxs-lookup"><span data-stu-id="6929d-185">Note that this scenario includes a cross-region Always On Availability Group deployment.</span></span>

## <a name="next-steps"></a><span data-ttu-id="6929d-186">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="6929d-186">Next steps</span></span>
[!INCLUDE [Listener-Next-Steps](../../../../includes/virtual-machines-ag-listener-next-steps.md)]

