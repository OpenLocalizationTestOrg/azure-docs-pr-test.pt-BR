---
title: Como usar PerfInsights no Microsoft Azure | Microsoft Docs
description: Aprenda a usar o PerfInsights para solucionar problemas de desempenho da VM do Windows.
services: virtual-machines-windows'
documentationcenter: 
author: genlin
manager: cshepard
editor: na
tags: 
ms.service: virtual-machines-windows
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-windows
ms.devlang: na
ms.topic: article
ms.date: 07/18/2017
ms.author: genli
ms.openlocfilehash: f22bd42302b96118dba0d4e5e387c6798a0b8777
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/18/2017
---
# <a name="how-to-use-perfinsights"></a><span data-ttu-id="3e695-103">Como usar o PerfInsights</span><span class="sxs-lookup"><span data-stu-id="3e695-103">How to use PerfInsights</span></span> 

<span data-ttu-id="3e695-104">O [PerfInsights](http://aka.ms/perfinsightsdownload) é um script automatizado que coleta informações de diagnóstico úteis, executa cargas de estresse de E/S e fornece um relatório de análise para ajudar a solucionar problemas de desempenho de VM do Windows no Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="3e695-104">[PerfInsights](http://aka.ms/perfinsightsdownload) is an automated script that collects useful diagnostic information, runs I/O stress loads, and provides an analysis report to help troubleshoot Windows VM performance problems in Microsoft Azure.</span></span> 

<span data-ttu-id="3e695-105">É recomendável executar esse script antes de abrir um chamado de suporte com a Microsoft para problemas de desempenho da VM.</span><span class="sxs-lookup"><span data-stu-id="3e695-105">We recommend that you run this script before you open a Support ticket with Microsoft for VM performance issues.</span></span>

## <a name="supported-troubleshooting-scenarios"></a><span data-ttu-id="3e695-106">Cenários de solução de problemas com suporte</span><span class="sxs-lookup"><span data-stu-id="3e695-106">Supported troubleshooting scenarios</span></span>

<span data-ttu-id="3e695-107">O PerfInsights pode coletar e analisar vários tipos de informações que são agrupadas em cenários exclusivos.</span><span class="sxs-lookup"><span data-stu-id="3e695-107">PerfInsights can collect and analyze several kinds of information that are grouped into unique scenarios.</span></span>

### <a name="collect-disk-configuration"></a><span data-ttu-id="3e695-108">Coletar configuração de disco</span><span class="sxs-lookup"><span data-stu-id="3e695-108">Collect disk configuration</span></span> 

<span data-ttu-id="3e695-109">Esse cenário coleta a configuração do disco e outras informações importantes, incluindo os seguintes itens:</span><span class="sxs-lookup"><span data-stu-id="3e695-109">This scenario collects the disk configuration and other important information, including the following items:</span></span>

-   <span data-ttu-id="3e695-110">Logs de eventos</span><span class="sxs-lookup"><span data-stu-id="3e695-110">Event logs</span></span>

-   <span data-ttu-id="3e695-111">Status da rede para todas as conexões de entrada e saída</span><span class="sxs-lookup"><span data-stu-id="3e695-111">Network status for all incoming and outgoing connections</span></span>

-   <span data-ttu-id="3e695-112">Definições de configuração de firewall e rede</span><span class="sxs-lookup"><span data-stu-id="3e695-112">Network and firewall configuration settings</span></span>

-   <span data-ttu-id="3e695-113">Lista de tarefas para todos os aplicativos que estão sendo executados no sistema no momento</span><span class="sxs-lookup"><span data-stu-id="3e695-113">Task list for all applications that are currently running on the system</span></span>

-   <span data-ttu-id="3e695-114">Arquivo de informações criado pelo msinfo32 para a VM (máquina virtual)</span><span class="sxs-lookup"><span data-stu-id="3e695-114">Information file created by msinfo32 for the virtual machine (VM)</span></span>

-   <span data-ttu-id="3e695-115">Definições de configuração do banco de dados Microsoft SQL Server (se a VM for identificada como um servidor que execute o SQL Server)</span><span class="sxs-lookup"><span data-stu-id="3e695-115">Microsoft SQL Server database configuration settings (if the VM is identified as a server that is running SQL Server)</span></span>

-   <span data-ttu-id="3e695-116">Contadores de confiabilidade do armazenamento</span><span class="sxs-lookup"><span data-stu-id="3e695-116">Storage reliability counters</span></span>

-   <span data-ttu-id="3e695-117">Hotfixes importantes do Windows</span><span class="sxs-lookup"><span data-stu-id="3e695-117">Important Windows hotfixes</span></span>

-   <span data-ttu-id="3e695-118">Drivers de filtro instalados</span><span class="sxs-lookup"><span data-stu-id="3e695-118">Installed filter drivers</span></span>

<span data-ttu-id="3e695-119">Esta é uma coleção de passiva de informações que não devem afetar o sistema.</span><span class="sxs-lookup"><span data-stu-id="3e695-119">This is a passive collection of information that shouldn't affect the system.</span></span> 

>[!Note]
><span data-ttu-id="3e695-120">Esse cenário é incluído automaticamente em cada um dos cenários a seguir.</span><span class="sxs-lookup"><span data-stu-id="3e695-120">This scenario is automatically included in each of the following scenarios.</span></span>

### <a name="benchmarkstorage-performance-test"></a><span data-ttu-id="3e695-121">Teste de desempenho de armazenamento/parâmetro de comparação</span><span class="sxs-lookup"><span data-stu-id="3e695-121">Benchmark/Storage Performance Test</span></span>

<span data-ttu-id="3e695-122">Este cenário executa o teste de parâmetro de comparação [diskspd](https://github.com/Microsoft/diskspd) (IOPS e MBPS) para todas as unidades anexadas à VM.</span><span class="sxs-lookup"><span data-stu-id="3e695-122">This scenario runs the [diskspd](https://github.com/Microsoft/diskspd) benchmark test (IOPS and MBPS) for all drives that are attached to the VM.</span></span> 

> [!Note]
> <span data-ttu-id="3e695-123">Esse cenário pode afetar o sistema e não deve ser executado em um sistema de produção ativo.</span><span class="sxs-lookup"><span data-stu-id="3e695-123">This scenario can affect the system and shouldn’t be run on a live production system.</span></span> <span data-ttu-id="3e695-124">Se necessário, execute este cenário em uma janela de manutenção dedicada para evitar problemas.</span><span class="sxs-lookup"><span data-stu-id="3e695-124">If necessary, run this scenario in a dedicated maintenance window to avoid any problems.</span></span> <span data-ttu-id="3e695-125">Uma carga de trabalho maior causada por um teste de parâmetro de comparação ou rastreamento pode afetar adversamente o desempenho da VM.</span><span class="sxs-lookup"><span data-stu-id="3e695-125">An increased workload that is caused by a trace or benchmark test could adversely affect the performance of your VM.</span></span>
>

### <a name="general-vm-slow-analysis"></a><span data-ttu-id="3e695-126">Análise geral de VM lenta</span><span class="sxs-lookup"><span data-stu-id="3e695-126">General VM Slow analysis</span></span> 

<span data-ttu-id="3e695-127">Este cenário executa um rastreamento de [contador de desempenho](https://msdn.microsoft.com/library/windows/desktop/aa373083(v=vs.85).aspx) usando os contadores especificados no arquivo Generalcounters.txt.</span><span class="sxs-lookup"><span data-stu-id="3e695-127">This scenario runs a [performance counter](https://msdn.microsoft.com/library/windows/desktop/aa373083(v=vs.85).aspx) trace by using the counters that are specified in the Generalcounters.txt file.</span></span> <span data-ttu-id="3e695-128">Se a VM for identificada como um servidor que executa o SQL Server, ela executará um rastreamento do contador de desempenho usando os contadores encontrados no arquivo Sqlcounters.txt.</span><span class="sxs-lookup"><span data-stu-id="3e695-128">If the VM is identified as a server that is running SQL Server, it runs a performance counter trace by using the counters that are found in the Sqlcounters.txt file.</span></span> <span data-ttu-id="3e695-129">Também inclui dados de Diagnóstico de Desempenho.</span><span class="sxs-lookup"><span data-stu-id="3e695-129">It also includes Performance Diagnostics data.</span></span>

### <a name="vm-slow-analysis-and-benchmark"></a><span data-ttu-id="3e695-130">Parâmetro de comparação e análise de VM lenta</span><span class="sxs-lookup"><span data-stu-id="3e695-130">VM Slow analysis and benchmark</span></span>

<span data-ttu-id="3e695-131">Este cenário executa um rastreamento do [contador de desempenho](https://msdn.microsoft.com/library/windows/desktop/aa373083(v=vs.85).aspx) que é seguido pelo teste de parâmetro de comparação [diskspd](https://github.com/Microsoft/diskspd).</span><span class="sxs-lookup"><span data-stu-id="3e695-131">This scenario runs a [performance counter](https://msdn.microsoft.com/library/windows/desktop/aa373083(v=vs.85).aspx) trace that is followed by a [diskspd](https://github.com/Microsoft/diskspd) benchmark test.</span></span> 

> [!Note]
> <span data-ttu-id="3e695-132">Esse cenário pode afetar o sistema e não deve ser executado em um sistema de produção ativo.</span><span class="sxs-lookup"><span data-stu-id="3e695-132">This scenario can affect the system and shouldn’t be run on a live production system.</span></span> <span data-ttu-id="3e695-133">Se necessário, execute este cenário em uma janela de manutenção dedicada para evitar problemas.</span><span class="sxs-lookup"><span data-stu-id="3e695-133">If necessary, run this scenario in a dedicated maintenance window to avoid any problems.</span></span> <span data-ttu-id="3e695-134">Uma carga de trabalho maior causada por um teste de parâmetro de comparação ou rastreamento pode afetar adversamente o desempenho da VM.</span><span class="sxs-lookup"><span data-stu-id="3e695-134">An increased workload that is caused by a trace or benchmark test could adversely affect the performance of your VM.</span></span>
>

### <a name="azure-files-analysis"></a><span data-ttu-id="3e695-135">Análise de Arquivos do Azure</span><span class="sxs-lookup"><span data-stu-id="3e695-135">Azure Files analysis</span></span> 

<span data-ttu-id="3e695-136">Este cenário executa uma captura de contador de desempenho especial junto com um rastreamento de rede.</span><span class="sxs-lookup"><span data-stu-id="3e695-136">This scenario runs a special performance counter capture together with a network trace.</span></span> <span data-ttu-id="3e695-137">A captura inclui todos os contadores de "Compartilhamentos de Cliente SMB".</span><span class="sxs-lookup"><span data-stu-id="3e695-137">The capture includes all the "SMB Client Shares" counters.</span></span> <span data-ttu-id="3e695-138">A seguir estão alguns contadores de desempenho de compartilhamento de cliente SMB que fazem parte da captura:</span><span class="sxs-lookup"><span data-stu-id="3e695-138">The following are some key SMB client share performance counters that are part of the capture:</span></span>

| <span data-ttu-id="3e695-139">**Tipo**</span><span class="sxs-lookup"><span data-stu-id="3e695-139">**Type**</span></span>     | <span data-ttu-id="3e695-140">**Contador de compartilhamentos de cliente SMB**</span><span class="sxs-lookup"><span data-stu-id="3e695-140">**SMB client shares counter**</span></span> |
|--------------|-------------------------------|
| <span data-ttu-id="3e695-141">IOPS</span><span class="sxs-lookup"><span data-stu-id="3e695-141">IOPS</span></span>         | <span data-ttu-id="3e695-142">Solicitações de dados/s</span><span class="sxs-lookup"><span data-stu-id="3e695-142">Data Requests/sec</span></span>             |
|              | <span data-ttu-id="3e695-143">Solicitações de leitura/s</span><span class="sxs-lookup"><span data-stu-id="3e695-143">Read Requests/sec</span></span>             |
|              | <span data-ttu-id="3e695-144">Solicitações de gravação/s</span><span class="sxs-lookup"><span data-stu-id="3e695-144">Write Requests/sec</span></span>            |
| <span data-ttu-id="3e695-145">Latência</span><span class="sxs-lookup"><span data-stu-id="3e695-145">Latency</span></span>      | <span data-ttu-id="3e695-146">Solicitação de dados/s média</span><span class="sxs-lookup"><span data-stu-id="3e695-146">Avg. sec/Data Request</span></span>         |
|              | <span data-ttu-id="3e695-147">Média de leituras/s</span><span class="sxs-lookup"><span data-stu-id="3e695-147">Avg. sec/Read</span></span>                 |
|              | <span data-ttu-id="3e695-148">Média de s/gravação</span><span class="sxs-lookup"><span data-stu-id="3e695-148">Avg. sec/Write</span></span>                |
| <span data-ttu-id="3e695-149">Tamanho de E/S</span><span class="sxs-lookup"><span data-stu-id="3e695-149">IO Size</span></span>      | <span data-ttu-id="3e695-150">Média Bytes/solicitação de dados</span><span class="sxs-lookup"><span data-stu-id="3e695-150">Avg. Bytes/Data Request</span></span>       |
|              | <span data-ttu-id="3e695-151">Média Bytes/leitura</span><span class="sxs-lookup"><span data-stu-id="3e695-151">Avg. Bytes/Read</span></span>               |
|              | <span data-ttu-id="3e695-152">Média Bytes/gravação</span><span class="sxs-lookup"><span data-stu-id="3e695-152">Avg. Bytes/Write</span></span>              |
| <span data-ttu-id="3e695-153">Taxa de transferência</span><span class="sxs-lookup"><span data-stu-id="3e695-153">Throughput</span></span>   | <span data-ttu-id="3e695-154">Bytes de dados/s</span><span class="sxs-lookup"><span data-stu-id="3e695-154">Data Bytes/sec</span></span>                |
|              | <span data-ttu-id="3e695-155">Bytes de leitura/s</span><span class="sxs-lookup"><span data-stu-id="3e695-155">Read Bytes/sec</span></span>                |
|              | <span data-ttu-id="3e695-156">Bytes de gravação/s</span><span class="sxs-lookup"><span data-stu-id="3e695-156">Write Bytes/sec</span></span>               |
| <span data-ttu-id="3e695-157">Comprimento da fila</span><span class="sxs-lookup"><span data-stu-id="3e695-157">Queue Length</span></span> | <span data-ttu-id="3e695-158">Média Tamanho da fila de leitura</span><span class="sxs-lookup"><span data-stu-id="3e695-158">Avg. Read Queue Length</span></span>        |
|              | <span data-ttu-id="3e695-159">Média Tamanho da fila de gravação</span><span class="sxs-lookup"><span data-stu-id="3e695-159">Avg. Write Queue Length</span></span>       |
|              | <span data-ttu-id="3e695-160">Média Comprimento da fila de dados</span><span class="sxs-lookup"><span data-stu-id="3e695-160">Avg. Data Queue Length</span></span>        |

### <a name="custom-configuration"></a><span data-ttu-id="3e695-161">Configuração personalizada</span><span class="sxs-lookup"><span data-stu-id="3e695-161">Custom configuration</span></span> 

<span data-ttu-id="3e695-162">Quando você executa uma configuração personalizada, está executando todos os rastreamentos (diagnóstico de desempenho, contador de desempenho, xperf, rede, storport) em paralelo, dependendo de quantos rastreamentos diferentes são selecionados.</span><span class="sxs-lookup"><span data-stu-id="3e695-162">When you run a custom configuration, you are running all traces (performance diagnostics, performance counter, xperf, network, storport) in parallel, depending how many different traces are selected.</span></span> <span data-ttu-id="3e695-163">Após o rastreamento estar concluído, a ferramenta executará o parâmetro de comparação diskspd, se ele estiver selecionado.</span><span class="sxs-lookup"><span data-stu-id="3e695-163">After tracing is completed, the tool runs the diskspd benchmark, if it is selected.</span></span> 

> [!Note]
> <span data-ttu-id="3e695-164">Esse cenário pode afetar o sistema e não deve ser executado em um sistema de produção ativo.</span><span class="sxs-lookup"><span data-stu-id="3e695-164">This scenario can affect the system and shouldn’t be run on a live production system.</span></span> <span data-ttu-id="3e695-165">Se necessário, execute este cenário em uma janela de manutenção dedicada para evitar problemas.</span><span class="sxs-lookup"><span data-stu-id="3e695-165">If necessary, run this scenario in a dedicated maintenance window to avoid any problems.</span></span> <span data-ttu-id="3e695-166">Uma carga de trabalho maior causada por um teste de parâmetro de comparação ou rastreamento pode afetar adversamente o desempenho da VM.</span><span class="sxs-lookup"><span data-stu-id="3e695-166">An increased workload that is caused by a trace or benchmark test could adversely affect the performance of your VM.</span></span>
>

## <a name="what-kind-of-information-is-collected-by-the-script"></a><span data-ttu-id="3e695-167">Que tipo de informações é coletado pelo script?</span><span class="sxs-lookup"><span data-stu-id="3e695-167">What kind of information is collected by the script?</span></span>

<span data-ttu-id="3e695-168">Informações sobre VM do Windows, configuração de discos ou pools de armazenamento, contadores de desempenho, logs e vários rastreamentos são coletadas dependendo do cenário de desempenho usado:</span><span class="sxs-lookup"><span data-stu-id="3e695-168">Information about Windows VM, disks or storage pools configuration, performance counters, logs and various traces are collected depending on the performance scenario used:</span></span>

|<span data-ttu-id="3e695-169">Dados coletados</span><span class="sxs-lookup"><span data-stu-id="3e695-169">Data collected</span></span>                              |  |  | <span data-ttu-id="3e695-170">Cenários de desempenho</span><span class="sxs-lookup"><span data-stu-id="3e695-170">Performance Scenarios</span></span> |  |  | |
|----------------------------------|----------------------------|------------------------------------|--------------------------|--------------------------------|----------------------|----------------------|
|                              | <span data-ttu-id="3e695-171">Coletar Configuração de Disco</span><span class="sxs-lookup"><span data-stu-id="3e695-171">Collect disk Configuration</span></span> | <span data-ttu-id="3e695-172">Teste de desempenho de armazenamento/parâmetro de comparação</span><span class="sxs-lookup"><span data-stu-id="3e695-172">Benchmark/Storage Performance test</span></span> | <span data-ttu-id="3e695-173">Análise geral de VM lenta</span><span class="sxs-lookup"><span data-stu-id="3e695-173">General VM Slow analysis</span></span> | <span data-ttu-id="3e695-174">Parâmetro de comparação e análise de VM lenta</span><span class="sxs-lookup"><span data-stu-id="3e695-174">VM Slow analysis and benchmark</span></span> | <span data-ttu-id="3e695-175">Análise de Arquivos do Azure</span><span class="sxs-lookup"><span data-stu-id="3e695-175">Azure Files analysis</span></span> | <span data-ttu-id="3e695-176">Configuração personalizada</span><span class="sxs-lookup"><span data-stu-id="3e695-176">Custom configuration</span></span> |
| <span data-ttu-id="3e695-177">Informações de logs de eventos</span><span class="sxs-lookup"><span data-stu-id="3e695-177">Information from Event logs</span></span>      | <span data-ttu-id="3e695-178">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-178">Yes</span></span>                        | <span data-ttu-id="3e695-179">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-179">Yes</span></span>                                | <span data-ttu-id="3e695-180">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-180">Yes</span></span>                      | <span data-ttu-id="3e695-181">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-181">Yes</span></span>                            | <span data-ttu-id="3e695-182">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-182">Yes</span></span>                  | <span data-ttu-id="3e695-183">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-183">Yes</span></span>                  |
| <span data-ttu-id="3e695-184">Informações do sistema</span><span class="sxs-lookup"><span data-stu-id="3e695-184">System information</span></span>               | <span data-ttu-id="3e695-185">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-185">Yes</span></span>                        | <span data-ttu-id="3e695-186">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-186">Yes</span></span>                                | <span data-ttu-id="3e695-187">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-187">Yes</span></span>                      | <span data-ttu-id="3e695-188">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-188">Yes</span></span>                            | <span data-ttu-id="3e695-189">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-189">Yes</span></span>                  | <span data-ttu-id="3e695-190">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-190">Yes</span></span>                  |
| <span data-ttu-id="3e695-191">Mapa de volume</span><span class="sxs-lookup"><span data-stu-id="3e695-191">Volume Map</span></span>                       | <span data-ttu-id="3e695-192">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-192">Yes</span></span>                        | <span data-ttu-id="3e695-193">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-193">Yes</span></span>                                | <span data-ttu-id="3e695-194">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-194">Yes</span></span>                      | <span data-ttu-id="3e695-195">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-195">Yes</span></span>                            | <span data-ttu-id="3e695-196">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-196">Yes</span></span>                  | <span data-ttu-id="3e695-197">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-197">Yes</span></span>                  |
| <span data-ttu-id="3e695-198">Mapa do disco</span><span class="sxs-lookup"><span data-stu-id="3e695-198">Disk Map</span></span>                         | <span data-ttu-id="3e695-199">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-199">Yes</span></span>                        | <span data-ttu-id="3e695-200">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-200">Yes</span></span>                                | <span data-ttu-id="3e695-201">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-201">Yes</span></span>                      | <span data-ttu-id="3e695-202">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-202">Yes</span></span>                            | <span data-ttu-id="3e695-203">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-203">Yes</span></span>                  | <span data-ttu-id="3e695-204">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-204">Yes</span></span>                  |
| <span data-ttu-id="3e695-205">Tarefas em execução</span><span class="sxs-lookup"><span data-stu-id="3e695-205">Running Tasks</span></span>                    | <span data-ttu-id="3e695-206">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-206">Yes</span></span>                        | <span data-ttu-id="3e695-207">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-207">Yes</span></span>                                | <span data-ttu-id="3e695-208">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-208">Yes</span></span>                      | <span data-ttu-id="3e695-209">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-209">Yes</span></span>                            | <span data-ttu-id="3e695-210">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-210">Yes</span></span>                  | <span data-ttu-id="3e695-211">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-211">Yes</span></span>                  |
| <span data-ttu-id="3e695-212">Contadores de Confiabilidade do Armazenamento</span><span class="sxs-lookup"><span data-stu-id="3e695-212">Storage Reliability Counters</span></span>     | <span data-ttu-id="3e695-213">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-213">Yes</span></span>                        | <span data-ttu-id="3e695-214">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-214">Yes</span></span>                                | <span data-ttu-id="3e695-215">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-215">Yes</span></span>                      | <span data-ttu-id="3e695-216">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-216">Yes</span></span>                            | <span data-ttu-id="3e695-217">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-217">Yes</span></span>                  | <span data-ttu-id="3e695-218">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-218">Yes</span></span>                  |
| <span data-ttu-id="3e695-219">Informações de armazenamento</span><span class="sxs-lookup"><span data-stu-id="3e695-219">Storage information</span></span>              | <span data-ttu-id="3e695-220">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-220">Yes</span></span>                        | <span data-ttu-id="3e695-221">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-221">Yes</span></span>                                | <span data-ttu-id="3e695-222">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-222">Yes</span></span>                      | <span data-ttu-id="3e695-223">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-223">Yes</span></span>                            | <span data-ttu-id="3e695-224">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-224">Yes</span></span>                  | <span data-ttu-id="3e695-225">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-225">Yes</span></span>                  |
| <span data-ttu-id="3e695-226">Saída do fsutil</span><span class="sxs-lookup"><span data-stu-id="3e695-226">Fsutil output</span></span>                    | <span data-ttu-id="3e695-227">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-227">Yes</span></span>                        | <span data-ttu-id="3e695-228">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-228">Yes</span></span>                                | <span data-ttu-id="3e695-229">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-229">Yes</span></span>                      | <span data-ttu-id="3e695-230">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-230">Yes</span></span>                            | <span data-ttu-id="3e695-231">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-231">Yes</span></span>                  | <span data-ttu-id="3e695-232">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-232">Yes</span></span>                  |
| <span data-ttu-id="3e695-233">Informações do driver de filtro</span><span class="sxs-lookup"><span data-stu-id="3e695-233">Filter Driver info</span></span>               | <span data-ttu-id="3e695-234">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-234">Yes</span></span>                        | <span data-ttu-id="3e695-235">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-235">Yes</span></span>                                | <span data-ttu-id="3e695-236">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-236">Yes</span></span>                      | <span data-ttu-id="3e695-237">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-237">Yes</span></span>                            | <span data-ttu-id="3e695-238">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-238">Yes</span></span>                  | <span data-ttu-id="3e695-239">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-239">Yes</span></span>                  |
| <span data-ttu-id="3e695-240">Saída de Netstat</span><span class="sxs-lookup"><span data-stu-id="3e695-240">Netstat output</span></span>                   | <span data-ttu-id="3e695-241">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-241">Yes</span></span>                        | <span data-ttu-id="3e695-242">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-242">Yes</span></span>                                | <span data-ttu-id="3e695-243">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-243">Yes</span></span>                      | <span data-ttu-id="3e695-244">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-244">Yes</span></span>                            | <span data-ttu-id="3e695-245">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-245">Yes</span></span>                  | <span data-ttu-id="3e695-246">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-246">Yes</span></span>                  |
| <span data-ttu-id="3e695-247">Configuração de rede</span><span class="sxs-lookup"><span data-stu-id="3e695-247">Network configuration</span></span>            | <span data-ttu-id="3e695-248">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-248">Yes</span></span>                        | <span data-ttu-id="3e695-249">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-249">Yes</span></span>                                | <span data-ttu-id="3e695-250">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-250">Yes</span></span>                      | <span data-ttu-id="3e695-251">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-251">Yes</span></span>                            | <span data-ttu-id="3e695-252">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-252">Yes</span></span>                  | <span data-ttu-id="3e695-253">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-253">Yes</span></span>                  |
| <span data-ttu-id="3e695-254">Configuração do firewall</span><span class="sxs-lookup"><span data-stu-id="3e695-254">Firewall configuration</span></span>           | <span data-ttu-id="3e695-255">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-255">Yes</span></span>                        | <span data-ttu-id="3e695-256">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-256">Yes</span></span>                                | <span data-ttu-id="3e695-257">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-257">Yes</span></span>                      | <span data-ttu-id="3e695-258">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-258">Yes</span></span>                            | <span data-ttu-id="3e695-259">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-259">Yes</span></span>                  | <span data-ttu-id="3e695-260">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-260">Yes</span></span>                  |
| <span data-ttu-id="3e695-261">Configuração do SQL Server</span><span class="sxs-lookup"><span data-stu-id="3e695-261">SQL Server configuration</span></span>         | <span data-ttu-id="3e695-262">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-262">Yes</span></span>                        | <span data-ttu-id="3e695-263">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-263">Yes</span></span>                                | <span data-ttu-id="3e695-264">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-264">Yes</span></span>                      | <span data-ttu-id="3e695-265">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-265">Yes</span></span>                            | <span data-ttu-id="3e695-266">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-266">Yes</span></span>                  | <span data-ttu-id="3e695-267">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-267">Yes</span></span>                  |
| <span data-ttu-id="3e695-268">Rastreamentos de diagnóstico de desempenho *</span><span class="sxs-lookup"><span data-stu-id="3e695-268">Performance Diagnostics Traces *</span></span> |                            |                                    | <span data-ttu-id="3e695-269">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-269">Yes</span></span>                      |                                |                      | <span data-ttu-id="3e695-270">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-270">Yes</span></span>                  |
| <span data-ttu-id="3e695-271">Rastreamento do contador de desempenho **</span><span class="sxs-lookup"><span data-stu-id="3e695-271">Performance counter Trace **</span></span>     |                            |                                    |                          |                                |                      | <span data-ttu-id="3e695-272">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-272">Yes</span></span>                  |
| <span data-ttu-id="3e695-273">Rastreamento do contador SMB **</span><span class="sxs-lookup"><span data-stu-id="3e695-273">SMB counter Trace **</span></span>             |                            |                                    |                          |                                | <span data-ttu-id="3e695-274">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-274">Yes</span></span>                  |                      |
| <span data-ttu-id="3e695-275">Rastreamento do contador do SQL Server **</span><span class="sxs-lookup"><span data-stu-id="3e695-275">SQL Server counter Trace **</span></span>      |                            |                                    |                          |                                |                      | <span data-ttu-id="3e695-276">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-276">Yes</span></span>                  |
| <span data-ttu-id="3e695-277">Rastreamento de XPerf</span><span class="sxs-lookup"><span data-stu-id="3e695-277">XPerf Trace</span></span>                      |                            |                                    |                          |                                |                      | <span data-ttu-id="3e695-278">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-278">Yes</span></span>                  |
| <span data-ttu-id="3e695-279">Rastreamento de StorPort</span><span class="sxs-lookup"><span data-stu-id="3e695-279">StorPort Trace</span></span>                   |                            |                                    |                          |                                |                      | <span data-ttu-id="3e695-280">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-280">Yes</span></span>                  |
| <span data-ttu-id="3e695-281">Rastreamento de rede</span><span class="sxs-lookup"><span data-stu-id="3e695-281">Network Trace</span></span>                    |                            |                                    |                          |                                | <span data-ttu-id="3e695-282">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-282">Yes</span></span>                  | <span data-ttu-id="3e695-283">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-283">Yes</span></span>                  |
| <span data-ttu-id="3e695-284">Rastreamento de parâmetro de comparação de Diskspd ***</span><span class="sxs-lookup"><span data-stu-id="3e695-284">Diskspd Benchmark trace ***</span></span>      |                            | <span data-ttu-id="3e695-285">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-285">Yes</span></span>                                |                          | <span data-ttu-id="3e695-286">Sim</span><span class="sxs-lookup"><span data-stu-id="3e695-286">Yes</span></span>                            |                      |                      |
|       |                            |                         |                                                   |                      |                      |

### <a name="performance-diagnostics-trace-"></a><span data-ttu-id="3e695-287">Rastreamento de diagnóstico de desempenho (*)</span><span class="sxs-lookup"><span data-stu-id="3e695-287">Performance Diagnostics trace (*)</span></span>

<span data-ttu-id="3e695-288">Executa um mecanismo baseado em regras no segundo plano para coletar dados e diagnosticar problemas de desempenho em andamento.</span><span class="sxs-lookup"><span data-stu-id="3e695-288">Runs a rule-based engine in the background to collect data and diagnose ongoing performance issues.</span></span> <span data-ttu-id="3e695-289">No momento, há suporte para regras a seguir:</span><span class="sxs-lookup"><span data-stu-id="3e695-289">The following rules are currently supported:</span></span>

- <span data-ttu-id="3e695-290">Regra de HighCpuUsage: detecta períodos de uso elevado de CPU e mostra os principais consumidores de uso da CPU durante esses períodos.</span><span class="sxs-lookup"><span data-stu-id="3e695-290">HighCpuUsage rule: Detects high CPU usage periods and shows the top CPU usage consumers during those periods.</span></span>
- <span data-ttu-id="3e695-291">Regra de HighDiskUsage: detecta períodos de uso elevado de disco em discos físicos e mostra os principais consumidores de uso de disco durante esses períodos.</span><span class="sxs-lookup"><span data-stu-id="3e695-291">HighDiskUsage rule: Detects high disk usage periods on physical disks and shows the top disk usage consumers during those periods.</span></span>
- <span data-ttu-id="3e695-292">Regra de HighResolutionDiskMetric: mostra IOPS, taxa de transferência e métricas de latência de E/S por 50 milissegundos para cada disco físico.</span><span class="sxs-lookup"><span data-stu-id="3e695-292">HighResolutionDiskMetric rule: Shows IOPS, throughput and IO latency metrics per 50 milliseconds for each physical disk.</span></span> <span data-ttu-id="3e695-293">Isso ajuda a identificar rapidamente os períodos de limitação de disco.</span><span class="sxs-lookup"><span data-stu-id="3e695-293">It helps to quickly identify disk throttling periods.</span></span>
- <span data-ttu-id="3e695-294">Regra de HighMemoryUsage: detecta os períodos de uso elevado de memória e mostra os principais consumidores de uso de memória durante esses períodos.</span><span class="sxs-lookup"><span data-stu-id="3e695-294">HighMemoryUsage rule: Detects high memory usage periods, and shows the top memory usage consumers during those periods.</span></span>

> [!NOTE] 
> <span data-ttu-id="3e695-295">Atualmente, há suporte para versões do Windows que incluem .NET Framework 3.5 ou versões posteriores.</span><span class="sxs-lookup"><span data-stu-id="3e695-295">Currently, Windows versions that include the .NET Framework 3.5 or later versions are supported.</span></span>

### <a name="performance-counter-trace-"></a><span data-ttu-id="3e695-296">Rastreamento do contador de desempenho (**)</span><span class="sxs-lookup"><span data-stu-id="3e695-296">Performance Counter trace (**)</span></span>

<span data-ttu-id="3e695-297">Coleta os seguintes contadores de desempenho:</span><span class="sxs-lookup"><span data-stu-id="3e695-297">Collects the following Performance Counters:</span></span>

- <span data-ttu-id="3e695-298">\Process, \Processor, \Memory, \Thread, \PhysicalDisk, \LogicalDisk</span><span class="sxs-lookup"><span data-stu-id="3e695-298">\Process, \Processor, \Memory, \Thread, \PhysicalDisk, \LogicalDisk</span></span>
- <span data-ttu-id="3e695-299">\Cache\Dirty Pages, \Cache\Lazy Write Flushes/sec, \Server\Pool Nonpaged, Failures, \Server\Pool Paged Failures</span><span class="sxs-lookup"><span data-stu-id="3e695-299">\Cache\Dirty Pages, \Cache\Lazy Write Flushes/sec, \Server\Pool Nonpaged, Failures, \Server\Pool Paged Failures</span></span>
- <span data-ttu-id="3e695-300">Contadores selecionados em \Network Interface, \IPv4\Datagrams, \IPv6\Datagrams, \TCPv4\Segments, \TCPv6\Segments,  \Network Adapter, \WFPv4\Packets, \WFPv6\Packets, \UDPv4\Datagrams, \UDPv6\Datagrams, \TCPv4\Connection, \TCPv6\Connection, \Network QoS Policy\Packets, \Per Processor Network Interface Card Activity, \Microsoft Winsock BSP</span><span class="sxs-lookup"><span data-stu-id="3e695-300">Selected counters under \Network Interface, \IPv4\Datagrams, \IPv6\Datagrams, \TCPv4\Segments, \TCPv6\Segments,  \Network Adapter, \WFPv4\Packets, \WFPv6\Packets, \UDPv4\Datagrams, \UDPv6\Datagrams, \TCPv4\Connection, \TCPv6\Connection, \Network QoS Policy\Packets, \Per Processor Network Interface Card Activity, \Microsoft Winsock BSP</span></span>

#### <a name="for-sql-server-instances"></a><span data-ttu-id="3e695-301">Para instâncias do SQL Server</span><span class="sxs-lookup"><span data-stu-id="3e695-301">For SQL Server instances</span></span>
- <span data-ttu-id="3e695-302">\SQL Server:Buffer Manager, \SQLServer:Resource Pool Stats, \SQLServer:SQL Statistics\\</span><span class="sxs-lookup"><span data-stu-id="3e695-302">\SQL Server:Buffer Manager, \SQLServer:Resource Pool Stats, \SQLServer:SQL Statistics\\</span></span>
- <span data-ttu-id="3e695-303">\SQLServer:Locks, \SQLServer:General, Statistics</span><span class="sxs-lookup"><span data-stu-id="3e695-303">\SQLServer:Locks, \SQLServer:General, Statistics</span></span>
- <span data-ttu-id="3e695-304">\SQLServer:Access Methods</span><span class="sxs-lookup"><span data-stu-id="3e695-304">\SQLServer:Access Methods</span></span>

#### <a name="for-azure-files"></a><span data-ttu-id="3e695-305">Para Arquivos do Azure</span><span class="sxs-lookup"><span data-stu-id="3e695-305">For Azure Files</span></span>
<span data-ttu-id="3e695-306">\SMB Client Shares</span><span class="sxs-lookup"><span data-stu-id="3e695-306">\SMB Client Shares</span></span>

### <a name="diskspd-benchmark-trace-"></a><span data-ttu-id="3e695-307">Rastreamento de parâmetro de comparação de Diskspd (***)</span><span class="sxs-lookup"><span data-stu-id="3e695-307">Diskspd Benchmark trace (***)</span></span>
<span data-ttu-id="3e695-308">Testes de carga de trabalho de E/S do Diskspd [disco do SO (gravação) e unidades de pool (leitura/gravação)]</span><span class="sxs-lookup"><span data-stu-id="3e695-308">Diskspd IO workload tests [OS Disk (write) and pool drives (read/write)]</span></span>

## <a name="run-the-perfinsights-on-your-vm"></a><span data-ttu-id="3e695-309">Execute o PerfInsights na sua VM</span><span class="sxs-lookup"><span data-stu-id="3e695-309">Run the PerfInsights on your VM</span></span>

### <a name="what-do-i-have-to-know-before-i-run-the-script"></a><span data-ttu-id="3e695-310">O que eu preciso saber antes de executar o script?</span><span class="sxs-lookup"><span data-stu-id="3e695-310">What do I have to know before I run the script?</span></span> 

<span data-ttu-id="3e695-311">**Requisitos de script**</span><span class="sxs-lookup"><span data-stu-id="3e695-311">**Script requirements**</span></span>

1.  <span data-ttu-id="3e695-312">Esse script deve ser executado na VM que tem o problema de desempenho.</span><span class="sxs-lookup"><span data-stu-id="3e695-312">This script must be run on the VM that has the performance issue.</span></span> 

2.  <span data-ttu-id="3e695-313">Há suporte para os SOs a seguir: Windows Server 2008 R2, 2012, 2012 R2, 2016; Windows 8.1 e Windows 10.</span><span class="sxs-lookup"><span data-stu-id="3e695-313">The following OSes are supported: Windows Server 2008 R2, 2012, 2012 R2, 2016; Windows 8.1 and Windows 10.</span></span>

<span data-ttu-id="3e695-314">**Possíveis problemas ao executar o script em VMs de produção:**</span><span class="sxs-lookup"><span data-stu-id="3e695-314">**Possible issues when you run the script on production VMs:**</span></span>

1.  <span data-ttu-id="3e695-315">O script pode afetar negativamente o desempenho da VM quando ela for usada junto com o cenário de "Parâmetro de Comparação" ou "Personalizado" configurado usando XPerf ou DiskSpd.</span><span class="sxs-lookup"><span data-stu-id="3e695-315">The script might adversely affect the performance of the VM when it is used together with the "Benchmark" or "Custom" scenario that is configured by using XPerf or DiskSpd.</span></span> <span data-ttu-id="3e695-316">Tenha cuidado ao executar o script em um ambiente de produção.</span><span class="sxs-lookup"><span data-stu-id="3e695-316">Be careful when you run the script in a production environment.</span></span>

2.  <span data-ttu-id="3e695-317">Quando você usar o script junto com o cenário "Parâmetro de Comparação" ou "Personalizado" configurado usando o DiskSpd, certifique-se de que nenhuma outra atividade em segundo plano interfira na carga de trabalho de E/S nos discos testados.</span><span class="sxs-lookup"><span data-stu-id="3e695-317">When you use the script together with the "Benchmark" or "Custom" scenario that is configured by using DiskSpd, make sure that no other background activity interferes with the I/O workload on the tested disks.</span></span>

3.  <span data-ttu-id="3e695-318">Por padrão, o script usa a unidade de armazenamento temporário para coletar dados.</span><span class="sxs-lookup"><span data-stu-id="3e695-318">By default, the script uses the temporary storage drive to collect data.</span></span> <span data-ttu-id="3e695-319">Se o rastreamento permanecer habilitado por mais tempo, a quantidade de dados coletados poderá ser relevante.</span><span class="sxs-lookup"><span data-stu-id="3e695-319">If tracing stays enabled for a longer time, the amount of data that is collected might be relevant.</span></span> <span data-ttu-id="3e695-320">Isso pode reduzir a disponibilidade de espaço no disco temporário, afetando, portanto, qualquer aplicativo que dependa dessa unidade.</span><span class="sxs-lookup"><span data-stu-id="3e695-320">This can reduce the availability of space on the temporary disk, therefore affecting any application that relies on this drive.</span></span>

### <a name="how-do-i-run-perfinsights"></a><span data-ttu-id="3e695-321">Como fazer para executar o PerfInsights?</span><span class="sxs-lookup"><span data-stu-id="3e695-321">How do I run PerfInsights?</span></span> 

<span data-ttu-id="3e695-322">Para executar o script, siga estas etapas:</span><span class="sxs-lookup"><span data-stu-id="3e695-322">To run the script, follow these steps:</span></span>

1. <span data-ttu-id="3e695-323">Baixe [PerfInsights.zip](http://aka.ms/perfinsightsdownload).</span><span class="sxs-lookup"><span data-stu-id="3e695-323">Download [PerfInsights.zip](http://aka.ms/perfinsightsdownload).</span></span>

2. <span data-ttu-id="3e695-324">Desbloqueie o arquivo PerfInsights.zip.</span><span class="sxs-lookup"><span data-stu-id="3e695-324">Unblock the PerfInsights.zip file.</span></span> <span data-ttu-id="3e695-325">Para fazer isso, clique com o botão direito do mouse no arquivo PerfInsights.zip e selecione **Propriedades**.</span><span class="sxs-lookup"><span data-stu-id="3e695-325">To do this, right-click the PerfInsights.zip file, select **Properties**.</span></span> <span data-ttu-id="3e695-326">Na guia **Geral**, selecione **Desbloquear** e, em seguida, selecione **OK**.</span><span class="sxs-lookup"><span data-stu-id="3e695-326">In the **General** tab, select **Unblock** and then select **OK**.</span></span> <span data-ttu-id="3e695-327">Isso garantirá que o script seja executado sem prompts de segurança adicionais.</span><span class="sxs-lookup"><span data-stu-id="3e695-327">This will make sure that the script runs without any additional security prompts.</span></span>  

    ![Desbloquear o arquivo zip](media/how-to-use-perfInsights/unlock-file.png)

3.  <span data-ttu-id="3e695-329">Expanda o arquivo PerfInsights.zip compactado na unidade temporária (por padrão, costuma ser a unidade D).</span><span class="sxs-lookup"><span data-stu-id="3e695-329">Expand the compressed PerfInsights.zip file into your temporary drive (by default, usually the D drive).</span></span> <span data-ttu-id="3e695-330">O arquivo compactado deve conter os seguintes arquivos e pastas:</span><span class="sxs-lookup"><span data-stu-id="3e695-330">The compressed file should contain the following files and folders:</span></span>

    ![arquivos na pasta zip](media/how-to-use-perfInsights/file-folder.png)

4.  <span data-ttu-id="3e695-332">Abra o Windows PowerShell como administrador e execute o script PerfInsights.ps1.</span><span class="sxs-lookup"><span data-stu-id="3e695-332">Open Windows PowerShell as an administrator, and then run the PerfInsights.ps1 script.</span></span>

    ```
    cd <the path of PerfInsights folder >
    Powershell.exe -ExecutionPolicy UnRestricted -NoProfile -File .\\PerfInsights.ps1
    ```

    <span data-ttu-id="3e695-333">Pode ser necessário digitar "y" se você for solicitado a confirmar se deseja alterar a política de execução.</span><span class="sxs-lookup"><span data-stu-id="3e695-333">You might have to enter "y" to if you are asked to confirm that you want to change the execution policy.</span></span>

    <span data-ttu-id="3e695-334">Na caixa de diálogo Aviso de Isenção de Responsabilidade, você terá a opção de compartilhar informações de diagnóstico com o Suporte da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="3e695-334">In the Disclaimer dialog box, you are given the option to share diagnostic information with Microsoft Support.</span></span> <span data-ttu-id="3e695-335">Você também deve concordar com o contrato de licença para continuar.</span><span class="sxs-lookup"><span data-stu-id="3e695-335">You must also consent to the license agreement to continue.</span></span> <span data-ttu-id="3e695-336">Faça suas seleções e, em seguida, clique em **Executar Script**.</span><span class="sxs-lookup"><span data-stu-id="3e695-336">Make your selections, and then click **Run Script**.</span></span>

    ![Caixa de diálogo Aviso de Isenção de Responsabilidade](media/how-to-use-perfInsights/disclaimer.png)

5.  <span data-ttu-id="3e695-338">Envie o número do caso, se ele estiver disponível, ao executar o script (isso é para nossas estatísticas).</span><span class="sxs-lookup"><span data-stu-id="3e695-338">Submit the case number, if it is available, when you run the script (This is for our statistics).</span></span> <span data-ttu-id="3e695-339">Em seguida, clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="3e695-339">Then, click **OK**.</span></span>
    
    ![inserir ID de suporte](media/how-to-use-perfInsights/enter-support-number.png)

6.  <span data-ttu-id="3e695-341">Selecione a unidade de armazenamento temporário.</span><span class="sxs-lookup"><span data-stu-id="3e695-341">Select your temporary storage drive.</span></span> <span data-ttu-id="3e695-342">O Script pode detectar automaticamente a letra da unidade.</span><span class="sxs-lookup"><span data-stu-id="3e695-342">The Script can auto-detect the drive letter of the drive.</span></span> <span data-ttu-id="3e695-343">Se houver problemas nesse estágio, você poderá ser solicitado a selecionar a unidade (a unidade padrão é D).</span><span class="sxs-lookup"><span data-stu-id="3e695-343">If any problems occur in this stage, you might be prompted to select the drive (the default drive is D).</span></span> <span data-ttu-id="3e695-344">Os logs gerados são armazenados aqui na pasta log\_collection.</span><span class="sxs-lookup"><span data-stu-id="3e695-344">Generated logs are stored here in the log\_collection folder.</span></span> <span data-ttu-id="3e695-345">Depois que você insere ou aceita a letra da unidade, clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="3e695-345">After you enter or accept the drive letter, click **OK**.</span></span>

    ![inerir unidade](media/how-to-use-perfInsights/enter-drive.png)

7.  <span data-ttu-id="3e695-347">Selecione um cenário de solução de problemas na lista fornecida.</span><span class="sxs-lookup"><span data-stu-id="3e695-347">Select a troubleshooting scenario from the provided list.</span></span>

       ![Selecionar cenários de suporte](media/how-to-use-perfInsights/select-scenarios.png)

8.  <span data-ttu-id="3e695-349">Você também pode executar PerfInsights sem interface do usuário.</span><span class="sxs-lookup"><span data-stu-id="3e695-349">You can also run PerfInsights without UI.</span></span>

    <span data-ttu-id="3e695-350">O comando a seguir executa o cenário de solução de problemas “Análise geral de VM lenta” sem um aviso de interface do usuário ou captura dados por 30 segundos.</span><span class="sxs-lookup"><span data-stu-id="3e695-350">The following command runs the "General VM Slow analysis" troubleshooting scenario without a UI prompt or capture data for 30 seconds.</span></span> <span data-ttu-id="3e695-351">Ele solicita que você concorde com o mesmo aviso de isenção de responsabilidade e EULA mencionados na etapa 4.</span><span class="sxs-lookup"><span data-stu-id="3e695-351">It prompts you to consent to the same disclaimer and EULA that  are mentioned in step 4.</span></span>

        powershell.exe -ExecutionPolicy UnRestricted -NoProfile -Command ".\\PerfInsights.ps1 -NoGui -Scenario vmslow -TracingDuration 30"

    <span data-ttu-id="3e695-352">Se você quiser que o PerfInsights seja executado no modo sem confirmação, use o parâmetro **-AcceptDisclaimerAndShareDiagnostics**.</span><span class="sxs-lookup"><span data-stu-id="3e695-352">If you want PerfInsights to run in silent mode, use the **-AcceptDisclaimerAndShareDiagnostics** parameter.</span></span> <span data-ttu-id="3e695-353">Por exemplo, use o seguinte comando:</span><span class="sxs-lookup"><span data-stu-id="3e695-353">For example, use the following command:</span></span>

        powershell.exe -ExecutionPolicy UnRestricted -NoProfile -Command ".\\PerfInsights.ps1 -NoGui -Scenario vmslow -TracingDuration 30 -AcceptDisclaimerAndShareDiagnostics"

### <a name="how-do-i-troubleshoot-issues-while-running-the-script"></a><span data-ttu-id="3e695-354">Como fazer para solucionar os problemas durante a execução do script?</span><span class="sxs-lookup"><span data-stu-id="3e695-354">How do I troubleshoot issues while running the script?</span></span>

<span data-ttu-id="3e695-355">Se o script terminar de maneira anormal, você poderá limpar um estado divergente executando o script em conjunto com a opção -Cleanup da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="3e695-355">If the script terminates abnormally, you can clean up an inconsistent state by running the script together with the -Cleanup switch, as follows:</span></span>

    powershell.exe -ExecutionPolicy UnRestricted -NoProfile -Command ".\\PerfInsights.ps1 -Cleanup"

<span data-ttu-id="3e695-356">Se houver problemas durante a detecção automática da unidade temporária, você poderá ser solicitado a selecionar a unidade (a unidade padrão é a D).</span><span class="sxs-lookup"><span data-stu-id="3e695-356">If any problems occur during the automatic detection of the temporary drive, you might be prompted to select the drive (the default drive is D).</span></span>

![enter-drive](media/how-to-use-perfInsights/enter-drive.png)

<span data-ttu-id="3e695-358">O script desinstala as ferramentas do utilitário e remove as pastas temporárias.</span><span class="sxs-lookup"><span data-stu-id="3e695-358">The script uninstalls the utility tools and removes temporary folders.</span></span>

### <a name="troubleshooting-other-script-issues"></a><span data-ttu-id="3e695-359">Solução de outros problemas de script</span><span class="sxs-lookup"><span data-stu-id="3e695-359">Troubleshooting other script issues</span></span> 

<span data-ttu-id="3e695-360">Se ocorrerem problemas quando você executar o script, pressione Ctrl+C para interromper a execução do script.</span><span class="sxs-lookup"><span data-stu-id="3e695-360">If any problems occur when you run the script, press Ctrl+C to interrupt the script execution.</span></span> <span data-ttu-id="3e695-361">Para remover objetos temporários, consulte a seção "Limpeza após o encerramento anormal".</span><span class="sxs-lookup"><span data-stu-id="3e695-361">To remove temporary objects, see the "Clean up after abnormal termination" section.</span></span>

<span data-ttu-id="3e695-362">Se você continuar a encontrar a falha de script mesmo após várias tentativas, é recomendável executar o script no "modo de depuração" usando a opção de parâmetro "-Debug" na inicialização.</span><span class="sxs-lookup"><span data-stu-id="3e695-362">If you continue to experience script failure even after several attempts, we recommend that you run the script in "debug mode" by using the "-Debug" parameter option on startup.</span></span>

<span data-ttu-id="3e695-363">Após a falha ocorrer, copie a saída completa do console do PowerShell e envie-a ao agente de Suporte da Microsoft que o está ajudando a solucionar o problema.</span><span class="sxs-lookup"><span data-stu-id="3e695-363">After the failure occurs, copy the full output of the PowerShell console, and send it to the Microsoft Support agent who is assisting you to help troubleshoot the problem.</span></span>

### <a name="how-do-i-run-the-script-in-custom-configuration-mode"></a><span data-ttu-id="3e695-364">Como fazer para executar o script no modo de configuração personalizada?</span><span class="sxs-lookup"><span data-stu-id="3e695-364">How do I run the script in custom configuration mode?</span></span>

<span data-ttu-id="3e695-365">Ao selecionar a configuração **Personalizado**, você pode habilitar vários rastreamentos em paralelo (use Shift para selecionar vários):</span><span class="sxs-lookup"><span data-stu-id="3e695-365">By selecting the **Custom** configuration, you can enable several traces in parallel (use Shift to multi-select):</span></span>

![selecionar cenários](media/how-to-use-perfInsights/select-scenario.png)

<span data-ttu-id="3e695-367">Quando você selecionar o cenário Diagnóstico de Desempenho, Rastreamento do Contador de Desempenho, Rastreamento de XPerf, Rastreamento de Rede ou Rastreamento de Storport, siga as instruções nas caixas de diálogo e tente reproduzir o problema de desempenho lento depois de iniciar os rastreamentos.</span><span class="sxs-lookup"><span data-stu-id="3e695-367">When you select the Performance Diagnostics, Performance Counter Trace, XPerf Trace, Network Trace, or Storport Trace scenarios, follow the instructions in the dialog boxes, and try to reproduce the slow performance issue after you start the traces.</span></span>

<span data-ttu-id="3e695-368">A caixa de diálogo a seguir permite que você inicie um rastreamento:</span><span class="sxs-lookup"><span data-stu-id="3e695-368">The following dialog box lets you start a trace:</span></span>

![start-trace](media/how-to-use-perfInsights/start-trace-message.png)

<span data-ttu-id="3e695-370">Para interromper os rastreamentos, você precisa confirmar o comando em uma segunda caixa de diálogo.</span><span class="sxs-lookup"><span data-stu-id="3e695-370">To stop the traces, you have to confirm the command in a second dialog box.</span></span>

<span data-ttu-id="3e695-371">![stop-trace](media/how-to-use-perfInsights/stop-trace-message.png)
![stop-trace](media/how-to-use-perfInsights/ok-trace-message.png)</span><span class="sxs-lookup"><span data-stu-id="3e695-371">![stop-trace](media/how-to-use-perfInsights/stop-trace-message.png)
![stop-trace](media/how-to-use-perfInsights/ok-trace-message.png)</span></span>

<span data-ttu-id="3e695-372">Quando os rastreamentos ou as operações forem concluídos, um novo arquivo será gerado em D:\\log\_collection (ou unidade temporária) com o nome **CollectedData\_yyyy-MM-dd\_hh\_mm\_ss.zip.**</span><span class="sxs-lookup"><span data-stu-id="3e695-372">When the traces or operations are completed, a new file is generated in D:\\log\_collection (or the temporary drive) that is named **CollectedData\_yyyy-MM-dd\_hh\_mm\_ss.zip.**</span></span> <span data-ttu-id="3e695-373">Você pode enviar esse arquivo para o agente de Suporte para análise.</span><span class="sxs-lookup"><span data-stu-id="3e695-373">You can send this file to the Support agent for analysis.</span></span>

## <a name="review-the-diagnostics-report-created-by-perfinsights"></a><span data-ttu-id="3e695-374">Examine o relatório de diagnóstico criado pelo PerfInsights</span><span class="sxs-lookup"><span data-stu-id="3e695-374">Review the diagnostics report created by PerfInsights</span></span>

<span data-ttu-id="3e695-375">No arquivo **CollectedData\_yyyy-MM-dd\_hh\_mm\_ss.zip,** que é gerado pelo PerfInsights, você pode localizar um relatório HTML com detalhes sobre as descobertas do PerfInsights.</span><span class="sxs-lookup"><span data-stu-id="3e695-375">Within the **CollectedData\_yyyy-MM-dd\_hh\_mm\_ss.zip file,** that is generated by PerfInsights, you can find an HTML report that details the findings of PerfInsights.</span></span> <span data-ttu-id="3e695-376">Para examinar o relatório, expanda o arquivo **CollectedData\_yyyy-MM-dd\_hh\_mm\_ss.zip** e, em seguida, abra o arquivo **PerfInsights Report.html**.</span><span class="sxs-lookup"><span data-stu-id="3e695-376">To review the report, expand the **CollectedData\_yyyy-MM-dd\_hh\_mm\_ss.zip** file, and then open the **PerfInsights Report.html** file.</span></span>

<span data-ttu-id="3e695-377">Selecione a guia **Descobertas**.</span><span class="sxs-lookup"><span data-stu-id="3e695-377">Select the **Findings** tab.</span></span>

![guia localizar](media/how-to-use-perfInsights/findingtab.png)

<span data-ttu-id="3e695-379">**Observações**</span><span class="sxs-lookup"><span data-stu-id="3e695-379">**Notes**</span></span>

-   <span data-ttu-id="3e695-380">Mensagens em vermelho são problemas de configuração conhecidos que podem causar problemas de desempenho.</span><span class="sxs-lookup"><span data-stu-id="3e695-380">Messages in red are known configuration issues that may cause performance issues.</span></span>

-   <span data-ttu-id="3e695-381">Mensagens em amarelo são avisos que representam configurações não ideais que não necessariamente causam problemas de desempenho.</span><span class="sxs-lookup"><span data-stu-id="3e695-381">Messages in yellow are warnings that represent non-optimal configurations that do not necessarily cause performance issues.</span></span>

-   <span data-ttu-id="3e695-382">As mensagens em azul são somente instruções informativas.</span><span class="sxs-lookup"><span data-stu-id="3e695-382">Messages in blue are informative statements only.</span></span>

<span data-ttu-id="3e695-383">Examine os links HTTP para todas as mensagens de erro em vermelho para obter informações mais detalhadas sobre as descobertas e como elas podem afetar o desempenho ou as práticas recomendadas para configurações otimizadas para desempenho.</span><span class="sxs-lookup"><span data-stu-id="3e695-383">Review the HTTP links for all error messages in red to get more detailed information about the findings and how they can affect the performance or best practices for performance-optimized configurations.</span></span>

### <a name="disk-configuration-tab"></a><span data-ttu-id="3e695-384">Guia Configuração de Disco</span><span class="sxs-lookup"><span data-stu-id="3e695-384">Disk Configuration Tab</span></span>

<span data-ttu-id="3e695-385">A seção **Visão Geral** exibe as exibições da configuração de armazenamento, incluindo informações de Diskpart e Espaços de Armazenamento</span><span class="sxs-lookup"><span data-stu-id="3e695-385">The **Overview** section displays different views of the storage configuration, including information from Diskpart and Storage Spaces</span></span>

<span data-ttu-id="3e695-386">As seções **DiskMap** e **VolumeMap** descrevem em uma perspectiva dupla como volumes lógicos e discos físicos estão relacionados uns aos outros.</span><span class="sxs-lookup"><span data-stu-id="3e695-386">The **DiskMap** and **VolumeMap** sections describe on a dual perspective how logical volumes and physical disks are related to each other.</span></span>

<span data-ttu-id="3e695-387">Na perspectiva PhysicalDisk (DiskMap), a tabela mostra todos os volumes lógicos que estão em execução no disco.</span><span class="sxs-lookup"><span data-stu-id="3e695-387">In the PhysicalDisk perspective (DiskMap), the table shows all logical volumes that are running on the disk.</span></span> <span data-ttu-id="3e695-388">No exemplo a seguir, PhysicalDrive2 executa dois Volumes Lógicos criados em várias partições (J e H):</span><span class="sxs-lookup"><span data-stu-id="3e695-388">In the following example, PhysicalDrive2 runs 2 Logical Volumes created on multiple partitions (J and H):</span></span>

![guia dados](media/how-to-use-perfInsights/disktab.png)

<span data-ttu-id="3e695-390">Na perspectiva Volume (*VolumeMap*), as tabelas mostram todos os discos físicos em cada volume lógico.</span><span class="sxs-lookup"><span data-stu-id="3e695-390">In the Volume perspective (*VolumeMap*), the tables show all the physical disks under each logical volume.</span></span> <span data-ttu-id="3e695-391">Observe que, para discos RAID/Dinâmicos, você pode executar um volume lógico em vários discos físicos.</span><span class="sxs-lookup"><span data-stu-id="3e695-391">Notice that for RAID/Dynamic disks, you might run a logical volume upon multiple physical disks.</span></span> <span data-ttu-id="3e695-392">No exemplo a seguir *C:\\mount* é configurado como um ponto de montagem como *SpannedDisk* em PhysicalDisks \#2 e \#3:</span><span class="sxs-lookup"><span data-stu-id="3e695-392">In the following sample *C:\\mount* is a mountpoint configured as *SpannedDisk* on PhysicalDisks \#2 and \#3:</span></span>

![Guia de volume](media/how-to-use-perfInsights/volumetab.png)

### <a name="sql-server-tab"></a><span data-ttu-id="3e695-394">Guia SQL Server</span><span class="sxs-lookup"><span data-stu-id="3e695-394">SQL Server tab</span></span>

<span data-ttu-id="3e695-395">Se a VM de destino hospedar alguma instância do SQL Server, você verá uma guia adicional no relatório chamada **SQL Server**:</span><span class="sxs-lookup"><span data-stu-id="3e695-395">If the target VM hosts any SQL Server instances, you will see an additional tab in the report that is named **SQL Server**:</span></span>

![guia sql](media/how-to-use-perfInsights/sqltab.png)

<span data-ttu-id="3e695-397">Esta seção contém uma "visão geral" e subguias adicionais para cada uma das instâncias do SQL Server hospedadas na VM.</span><span class="sxs-lookup"><span data-stu-id="3e695-397">This section contains an "Overview" and additional sub tabs for each of the SQL Server instances hosted on the VM.</span></span>

<span data-ttu-id="3e695-398">A seção "Visão Geral" contém uma tabela útil que resume todos os discos físicos (discos de sistema e dados) que estão em execução e que contêm uma mistura de arquivos de dados e arquivos de log de transações.</span><span class="sxs-lookup"><span data-stu-id="3e695-398">The "Overview" section contains a helpful table that summarizes all the physical disks (system and data disks) that are running and that contain a mixture of data files and transaction log files.</span></span>

<span data-ttu-id="3e695-399">No exemplo a seguir, *PhysicalDrive0* (executando a unidade C) é exibida porque os arquivos *modeldev* e *modellog* estão ambos localizados na unidade C e são de tipos diferentes (como Arquivo de Dados e Log de Transações, respectivamente):</span><span class="sxs-lookup"><span data-stu-id="3e695-399">In the following example, *PhysicalDrive0* (running the C drive) is displayed because both the *modeldev* and *modellog* files are located on the C drive, and they are of different types (such as Data File and Transaction Log, respectively):</span></span>

![loginfo](media/how-to-use-perfInsights/loginfo.png)

<span data-ttu-id="3e695-401">As guias específicas da instância do SQL Server contêm uma seção geral que exibe informações básicas sobre a instância selecionada e seções adicionais para informações avançadas, incluindo Configurações, Definições e Opções do Usuário.</span><span class="sxs-lookup"><span data-stu-id="3e695-401">The SQL Server instance-specific tabs contain a general section that displays basic information about the selected instance and additional sections for advanced information, including Settings, Configurations, and User Options.</span></span>

## <a name="references-to-the-external-tools-used"></a><span data-ttu-id="3e695-402">Referências às ferramentas externas usadas</span><span class="sxs-lookup"><span data-stu-id="3e695-402">References to the external tools used</span></span>

### <a name="diskspd"></a><span data-ttu-id="3e695-403">Diskspd</span><span class="sxs-lookup"><span data-stu-id="3e695-403">Diskspd</span></span>

<span data-ttu-id="3e695-404">DISKSPD é um gerador de carga de armazenamento e uma ferramenta de teste de desempenho do Windows e das equipes de engenharia de Infraestrutura do Windows Server e Cloud Server.</span><span class="sxs-lookup"><span data-stu-id="3e695-404">DISKSPD is a storage load generator and performance test tool from the Windows and Windows Server and Cloud Server Infrastructure engineering teams.</span></span> <span data-ttu-id="3e695-405">Para obter mais informações, consulte [Diskspd](https://github.com/Microsoft/diskspd).</span><span class="sxs-lookup"><span data-stu-id="3e695-405">For more information, see [Diskspd](https://github.com/Microsoft/diskspd).</span></span>

### <a name="xperf"></a><span data-ttu-id="3e695-406">XPerf</span><span class="sxs-lookup"><span data-stu-id="3e695-406">XPerf</span></span>

<span data-ttu-id="3e695-407">XPerf é uma ferramenta de linha de comando para capturar rastreamentos do Kit de Ferramentas de Desempenho do Windows.</span><span class="sxs-lookup"><span data-stu-id="3e695-407">Xperf is a command-line tool to capture traces from the Windows Performance Tools Kit.</span></span>

<span data-ttu-id="3e695-408">Para obter mais informações, consulte [Windows Performance Toolkit – Xperf](https://blogs.msdn.microsoft.com/ntdebugging/2008/04/03/windows-performance-toolkit-xperf/).</span><span class="sxs-lookup"><span data-stu-id="3e695-408">For more information, see [Windows Performance Toolkit – Xperf](https://blogs.msdn.microsoft.com/ntdebugging/2008/04/03/windows-performance-toolkit-xperf/).</span></span>

## <a name="next-steps"></a><span data-ttu-id="3e695-409">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="3e695-409">Next Steps</span></span>

### <a name="upload-diagnostics-logs-and-reports-to-microsoft-support-for-further-review"></a><span data-ttu-id="3e695-410">Carregar relatórios e logs de diagnóstico para o Suporte da Microsoft para mais exame</span><span class="sxs-lookup"><span data-stu-id="3e695-410">Upload diagnostics logs and reports to Microsoft Support for further review</span></span>

<span data-ttu-id="3e695-411">Ao trabalhar com a equipe do Suporte da Microsoft, você pode ser solicitado a transmitir a saída gerada por PerfInsights para auxiliar no processo de solução de problemas.</span><span class="sxs-lookup"><span data-stu-id="3e695-411">When you work with the Microsoft Support staff, you may be requested to transmit the output that is generated by PerfInsights to assist the troubleshooting process.</span></span>

<span data-ttu-id="3e695-412">O agente de suporte criará um espaço de trabalho DTM para você e você receberá uma mensagem de email incluindo um link para o portal DTM (https://filetransfer.support.microsoft.com/EFTClient/Account/Login.htm) e uma ID de usuário e senha únicos.</span><span class="sxs-lookup"><span data-stu-id="3e695-412">The Support agent will create a DTM workspace for you, and you will receive an email message that includes a link to the [DTM portal (https://filetransfer.support.microsoft.com/EFTClient/Account/Login.htm) and a unique user ID and password.</span></span>

<span data-ttu-id="3e695-413">Esta mensagem será enviada de **Serviços de Diagnóstico Automatizados CTS** (ctsadiag@microsoft.com).</span><span class="sxs-lookup"><span data-stu-id="3e695-413">This message will be sent from **CTS Automated Diagnostics Services** (ctsadiag@microsoft.com).</span></span>

![Exemplo da mensagem](media/how-to-use-perfInsights/supportemail.png)

<span data-ttu-id="3e695-415">Para segurança adicional, você será solicitado a alterar sua senha no primeiro uso.</span><span class="sxs-lookup"><span data-stu-id="3e695-415">For additional security, you will be required to change your password on first use.</span></span>

<span data-ttu-id="3e695-416">Após fazer logon no DTM, você verá uma caixa de diálogo para carregar o arquivo **CollectedData\_yyyy-MM-dd\_hh\_mm\_ss.zip** coletado por PerfInsights.</span><span class="sxs-lookup"><span data-stu-id="3e695-416">After you log in to DTM, you will find a dialog box to upload the **CollectedData\_yyyy-MM-dd\_hh\_mm\_ss.zip** file that was collected by PerfInsights.</span></span>
