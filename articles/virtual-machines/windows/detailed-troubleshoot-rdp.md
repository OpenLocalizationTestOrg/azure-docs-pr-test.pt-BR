---
title: "área de trabalho remota aaaDetailed de solução de problemas no Azure | Microsoft Docs"
description: "Examine as etapas detalhadas de solução de problemas para erros de área de trabalho remotas onde não é possível tooa máquinas de virtuais do Windows no Azure"
services: virtual-machines-windows
documentationcenter: 
author: genlin
manager: timlt
editor: 
tags: top-support-issue,azure-service-management,azure-resource-manager
keywords: "não é possível conectar-se a área de trabalho tooremote, solucionar problemas de área de trabalho remota, área de trabalho remota não pode se conectar, erros de área de trabalho remotos, solução de problemas da área de trabalho remota, problemas de área de trabalho remotos"
ms.assetid: 9da36f3d-30dd-44af-824b-8ce5ef07e5e0
ms.service: virtual-machines-windows
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-windows
ms.devlang: na
ms.topic: support-article
ms.date: 07/25/2017
ms.author: genli
ms.openlocfilehash: fcb0d06aa66b748f3ebbbbe3431471d3cbe7c60d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="detailed-troubleshooting-steps-for-remote-desktop-connection-issues-toowindows-vms-in-azure"></a><span data-ttu-id="7f3eb-104">Etapas detalhadas de solução de problemas de conexão de área de trabalho remota emite tooWindows VMs no Azure</span><span class="sxs-lookup"><span data-stu-id="7f3eb-104">Detailed troubleshooting steps for remote desktop connection issues tooWindows VMs in Azure</span></span>
<span data-ttu-id="7f3eb-105">Este artigo fornece etapas de solução de problemas detalhadas toodiagnose e corrigir erros de área de trabalho remota complexos para máquinas de virtuais baseadas em Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-105">This article provides detailed troubleshooting steps toodiagnose and fix complex Remote Desktop errors for Windows-based Azure virtual machines.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="7f3eb-106">tooeliminate Olá erros mais comuns de área de trabalho remota, tooread se tornar [artigo de solução de problemas básicos Olá para área de trabalho remota](troubleshoot-rdp-connection.md) antes de continuar.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-106">tooeliminate hello more common Remote Desktop errors, make sure tooread [hello basic troubleshooting article for Remote Desktop](troubleshoot-rdp-connection.md) before proceeding.</span></span>

<span data-ttu-id="7f3eb-107">Você pode encontrar uma área de trabalho remota, mensagem de erro que não se assemelha a qualquer uma das mensagens de erro específicas Olá abordada [Olá básica área de trabalho remota guia de solução de problemas](troubleshoot-rdp-connection.md).</span><span class="sxs-lookup"><span data-stu-id="7f3eb-107">You may encounter a Remote Desktop error message that does not resemble any of hello specific error messages covered in [hello basic Remote Desktop troubleshooting guide](troubleshoot-rdp-connection.md).</span></span> <span data-ttu-id="7f3eb-108">Siga essas toodetermine etapas por que o cliente de área de trabalho remota (RDP) hello é o serviço RDP de toohello de tooconnect não é possível no hello VM do Azure.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-108">Follow these steps toodetermine why hello Remote Desktop (RDP) client is unable tooconnect toohello RDP service on hello Azure VM.</span></span>

[!INCLUDE [learn-about-deployment-models](../../../includes/learn-about-deployment-models-both-include.md)]

<span data-ttu-id="7f3eb-109">Se você precisar de mais ajuda a qualquer momento neste artigo, você pode contatar hello Azure especialistas em [hello Azure MSDN e Olá fóruns de estouro de pilha](https://azure.microsoft.com/support/forums/).</span><span class="sxs-lookup"><span data-stu-id="7f3eb-109">If you need more help at any point in this article, you can contact hello Azure experts on [hello MSDN Azure and hello Stack Overflow forums](https://azure.microsoft.com/support/forums/).</span></span> <span data-ttu-id="7f3eb-110">Como alternativa, você também pode registrar um incidente de suporte do Azure.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-110">Alternatively, you can also file an Azure support incident.</span></span> <span data-ttu-id="7f3eb-111">Vá toohello [site de suporte do Azure](https://azure.microsoft.com/support/options/) e clique em **suporte**.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-111">Go toohello [Azure Support site](https://azure.microsoft.com/support/options/) and click **Get Support**.</span></span> <span data-ttu-id="7f3eb-112">Para obter informações sobre como usar o suporte do Azure, leia Olá [perguntas Frequentes de suporte do Microsoft Azure](https://azure.microsoft.com/support/faq/).</span><span class="sxs-lookup"><span data-stu-id="7f3eb-112">For information about using Azure Support, read hello [Microsoft Azure Support FAQ](https://azure.microsoft.com/support/faq/).</span></span>

## <a name="components-of-a-remote-desktop-connection"></a><span data-ttu-id="7f3eb-113">Componentes de uma conexão da Área de Trabalho Remota</span><span class="sxs-lookup"><span data-stu-id="7f3eb-113">Components of a Remote Desktop connection</span></span>
<span data-ttu-id="7f3eb-114">Olá componentes a seguir é envolvido em uma conexão de RDP:</span><span class="sxs-lookup"><span data-stu-id="7f3eb-114">hello following components are involved in an RDP connection:</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_0.png)

<span data-ttu-id="7f3eb-115">Antes de prosseguir, pode ser útil toomentally examinar o que mudou desde Olá última bem-sucedida área de trabalho remota conexão toohello VM.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-115">Before proceeding, it might help toomentally review what has changed since hello last successful Remote Desktop connection toohello VM.</span></span> <span data-ttu-id="7f3eb-116">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="7f3eb-116">For example:</span></span>

* <span data-ttu-id="7f3eb-117">Olá endereço IP público Olá VM ou saudação do serviço de nuvem que contém a saudação VM (também chamado de endereço IP virtual Olá [VIP](https://en.wikipedia.org/wiki/Virtual_IP_address)) foi alterado.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-117">hello public IP address of hello VM or hello cloud service containing hello VM (also called hello virtual IP address [VIP](https://en.wikipedia.org/wiki/Virtual_IP_address)) has changed.</span></span> <span data-ttu-id="7f3eb-118">Olá falha RDP pode ser porque o cache do cliente DNS ainda tem Olá *endereço IP antigo* registrado para o nome DNS de saudação.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-118">hello RDP failure could be because your DNS client cache still has hello *old IP address* registered for hello DNS name.</span></span> <span data-ttu-id="7f3eb-119">Liberar o cache do cliente DNS e tente conectar-se a saudação VM novamente.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-119">Flush your DNS client cache and try connecting hello VM again.</span></span> <span data-ttu-id="7f3eb-120">Ou tente conectar-se diretamente com hello novo VIP.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-120">Or try connecting directly with hello new VIP.</span></span>
* <span data-ttu-id="7f3eb-121">Você está usando um aplicativo de terceiros toomanage suas conexões de área de trabalho remota em vez de usar conexão Olá gerado pelo Olá portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-121">You are using a third-party application toomanage your Remote Desktop connections instead of using hello connection generated by hello Azure portal.</span></span> <span data-ttu-id="7f3eb-122">Verifique se que essa configuração de aplicativo hello inclui Olá correta a porta TCP para Olá tráfego de área de trabalho remota.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-122">Verify that hello application configuration includes hello correct TCP port for hello Remote Desktop traffic.</span></span> <span data-ttu-id="7f3eb-123">Você pode verificar essa porta para uma máquina virtual clássica no hello [portal do Azure](https://portal.azure.com), clicando em configurações da VM hello > pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-123">You can check this port for a classic virtual machine in hello [Azure portal](https://portal.azure.com), by clicking hello VM's Settings > Endpoints.</span></span>

## <a name="preliminary-steps"></a><span data-ttu-id="7f3eb-124">Etapas preliminares</span><span class="sxs-lookup"><span data-stu-id="7f3eb-124">Preliminary steps</span></span>
<span data-ttu-id="7f3eb-125">Antes de continuar toohello solução de problemas detalhada,</span><span class="sxs-lookup"><span data-stu-id="7f3eb-125">Before proceeding toohello detailed troubleshooting,</span></span>

* <span data-ttu-id="7f3eb-126">Verificar status de saudação de máquina virtual Olá Olá portal do Azure para qualquer problema óbvio.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-126">Check hello status of hello virtual machine in hello Azure portal for any obvious issues.</span></span>
* <span data-ttu-id="7f3eb-127">Siga Olá [etapas de correção rápida para erros comuns de RDP na solução de problemas básicos de saudação orientam](troubleshoot-rdp-connection.md#quick-troubleshooting-steps).</span><span class="sxs-lookup"><span data-stu-id="7f3eb-127">Follow hello [quick fix steps for common RDP errors in hello basic troubleshooting guide](troubleshoot-rdp-connection.md#quick-troubleshooting-steps).</span></span>

<span data-ttu-id="7f3eb-128">Tente reconectar toohello VM por meio da área de trabalho remota após estas etapas.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-128">Try reconnecting toohello VM via Remote Desktop after these steps.</span></span>

## <a name="detailed-troubleshooting-steps"></a><span data-ttu-id="7f3eb-129">Etapas detalhadas de solução de problemas</span><span class="sxs-lookup"><span data-stu-id="7f3eb-129">Detailed troubleshooting steps</span></span>
<span data-ttu-id="7f3eb-130">cliente de área de trabalho remota Olá pode não ser tooreach capaz de serviço de área de trabalho remota Olá em hello Azure VM tooissues devido a saudação as origens a seguir:</span><span class="sxs-lookup"><span data-stu-id="7f3eb-130">hello Remote Desktop client may not be able tooreach hello Remote Desktop service on hello Azure VM due tooissues at hello following sources:</span></span>

* [<span data-ttu-id="7f3eb-131">Computador cliente de Área de Trabalho Remota</span><span class="sxs-lookup"><span data-stu-id="7f3eb-131">Remote Desktop client computer</span></span>](#source-1-remote-desktop-client-computer)
* [<span data-ttu-id="7f3eb-132">Dispositivo de borda de intranet da organização</span><span class="sxs-lookup"><span data-stu-id="7f3eb-132">Organization intranet edge device</span></span>](#source-2-organization-intranet-edge-device)
* [<span data-ttu-id="7f3eb-133">Ponto de extremidade de serviço de nuvem e ACL (lista de controle de acesso)</span><span class="sxs-lookup"><span data-stu-id="7f3eb-133">Cloud service endpoint and access control list (ACL)</span></span>](#source-3-cloud-service-endpoint-and-acl)
* [<span data-ttu-id="7f3eb-134">Grupos de segurança de rede</span><span class="sxs-lookup"><span data-stu-id="7f3eb-134">Network security groups</span></span>](#source-4-network-security-groups)
* [<span data-ttu-id="7f3eb-135">VM do Azure Baseada em Windows</span><span class="sxs-lookup"><span data-stu-id="7f3eb-135">Windows-based Azure VM</span></span>](#source-5-windows-based-azure-vm)

## <a name="source-1-remote-desktop-client-computer"></a><span data-ttu-id="7f3eb-136">Fonte 1: computador cliente de Área de Trabalho Remota</span><span class="sxs-lookup"><span data-stu-id="7f3eb-136">Source 1: Remote Desktop client computer</span></span>
<span data-ttu-id="7f3eb-137">Verifique se o computador pode fazer a área de trabalho remota conexões tooanother local, o computador baseado em Windows.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-137">Verify that your computer can make Remote Desktop connections tooanother on-premises, Windows-based computer.</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_1.png)

<span data-ttu-id="7f3eb-138">Se não for possível, verificar Olá configurações a seguir no seu computador:</span><span class="sxs-lookup"><span data-stu-id="7f3eb-138">If you cannot, check for hello following settings on your computer:</span></span>

* <span data-ttu-id="7f3eb-139">Uma configuração de firewall local que está bloqueando o tráfego de Área de Trabalho Remota.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-139">A local firewall setting that is blocking Remote Desktop traffic.</span></span>
* <span data-ttu-id="7f3eb-140">Um software de proxy cliente instalado localmente que está impedindo conexões de Área de Trabalho Remota.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-140">Locally installed client proxy software that is preventing Remote Desktop connections.</span></span>
* <span data-ttu-id="7f3eb-141">Um software de monitoramento de rede instalado localmente que está impedindo conexões de Área de Trabalho Remota.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-141">Locally installed network monitoring software that is preventing Remote Desktop connections.</span></span>
* <span data-ttu-id="7f3eb-142">Outros tipos de software de segurança que monitoram o tráfego ou permitem/não permitem tipos específicos de tráfego e que estão impedindo conexões de Área de Trabalho Remota.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-142">Other types of security software that either monitor traffic or allow/disallow specific types of traffic that is preventing Remote Desktop connections.</span></span>

<span data-ttu-id="7f3eb-143">Em todos esses casos, temporariamente desabilite software hello e tente tooconnect tooan local no computador por meio da área de trabalho remota.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-143">In all these cases, temporarily disable hello software and try tooconnect tooan on-premises computer via Remote Desktop.</span></span> <span data-ttu-id="7f3eb-144">Se você pode descobrir causa real Olá dessa maneira, trabalhe com seu administrador toocorrect Olá software configurações tooallow área de trabalho remota conexões de rede.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-144">If you can find out hello actual cause this way, work with your network administrator toocorrect hello software settings tooallow Remote Desktop connections.</span></span>

## <a name="source-2-organization-intranet-edge-device"></a><span data-ttu-id="7f3eb-145">Fonte 2: dispositivo de borda de intranet da organização</span><span class="sxs-lookup"><span data-stu-id="7f3eb-145">Source 2: Organization intranet edge device</span></span>
<span data-ttu-id="7f3eb-146">Verifique se um computador diretamente conectado toohello que Internet pode fazer conexões de área de trabalho remota tooyour máquina virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-146">Verify that a computer directly connected toohello Internet can make Remote Desktop connections tooyour Azure virtual machine.</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_2.png)

<span data-ttu-id="7f3eb-147">Se você não tiver um computador que esteja conectado diretamente toohello Internet, crie e teste com uma nova máquina virtual do Azure em um serviço de nuvem ou o grupo de recursos.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-147">If you do not have a computer that is directly connected toohello Internet, create and test with a new Azure virtual machine in a resource group or cloud service.</span></span> <span data-ttu-id="7f3eb-148">Para obter mais informações, consulte [Criar uma máquina virtual que executa o Windows no Azure](../virtual-machines-windows-hero-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="7f3eb-148">For more information, see [Create a virtual machine running Windows in Azure](../virtual-machines-windows-hero-tutorial.md).</span></span> <span data-ttu-id="7f3eb-149">Você pode excluir máquina virtual de saudação e grupo de recursos de saudação ou serviço de nuvem Olá, depois de testar a saudação.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-149">You can delete hello virtual machine and hello resource group or hello cloud service, after hello test.</span></span>

<span data-ttu-id="7f3eb-150">Se você pode criar uma conexão de área de trabalho remota com um toohello computador conectado diretamente à Internet, verifique o dispositivo de borda de intranet de organização para:</span><span class="sxs-lookup"><span data-stu-id="7f3eb-150">If you can create a Remote Desktop connection with a computer directly attached toohello Internet, check your organization intranet edge device for:</span></span>

* <span data-ttu-id="7f3eb-151">Um firewall interno bloqueando conexões de HTTPS toohello da Internet.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-151">An internal firewall blocking HTTPS connections toohello Internet.</span></span>
* <span data-ttu-id="7f3eb-152">Um servidor proxy impedindo conexões de Área de Trabalho Remota.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-152">A proxy server preventing Remote Desktop connections.</span></span>
* <span data-ttu-id="7f3eb-153">Software de detecção de intrusão ou monitoramento de rede executado em dispositivos em sua rede de borda que está impedindo conexões de Área de Trabalho Remota.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-153">Intrusion detection or network monitoring software running on devices in your edge network that is preventing Remote Desktop connections.</span></span>

<span data-ttu-id="7f3eb-154">Trabalhe com seu administrador toocorrect Olá as configurações de rede da sua organização intranet borda dispositivo tooallow área de trabalho remota com base em HTTPS conexões toohello da Internet.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-154">Work with your network administrator toocorrect hello settings of your organization intranet edge device tooallow HTTPS-based Remote Desktop connections toohello Internet.</span></span>

## <a name="source-3-cloud-service-endpoint-and-acl"></a><span data-ttu-id="7f3eb-155">Fonte 3: ponto de extremidade de serviço de nuvem e ACL</span><span class="sxs-lookup"><span data-stu-id="7f3eb-155">Source 3: Cloud service endpoint and ACL</span></span>
<span data-ttu-id="7f3eb-156">Para máquinas virtuais criadas usando o modelo de implantação clássico hello, verifique se que outra VM do Azure que está no hello mesmo serviço de nuvem ou rede virtual pode fazer conexões de área de trabalho remota tooyour VM do Azure.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-156">For VMs created using hello Classic deployment model, verify that another Azure VM that is in hello same cloud service or virtual network can make Remote Desktop connections tooyour Azure VM.</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_3.png)

> [!NOTE]
> <span data-ttu-id="7f3eb-157">Para máquinas virtuais criadas no Gerenciador de recursos, ignorar muito[fonte 4: grupos de segurança de rede](#source-4-network-security-groups).</span><span class="sxs-lookup"><span data-stu-id="7f3eb-157">For virtual machines created in Resource Manager, skip too[Source 4: Network Security Groups](#source-4-network-security-groups).</span></span>

<span data-ttu-id="7f3eb-158">Se você não tiver outra máquina virtual em Olá mesmo serviço de nuvem ou rede virtual, crie um.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-158">If you do not have another virtual machine in hello same cloud service or virtual network, create one.</span></span> <span data-ttu-id="7f3eb-159">Siga as etapas de saudação em [criar uma máquina virtual executando o Windows Azure](../virtual-machines-windows-hero-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="7f3eb-159">Follow hello steps in [Create a virtual machine running Windows in Azure](../virtual-machines-windows-hero-tutorial.md).</span></span> <span data-ttu-id="7f3eb-160">Exclua Olá máquina de virtual de teste após a conclusão do teste de saudação.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-160">Delete hello test virtual machine after hello test is completed.</span></span>

<span data-ttu-id="7f3eb-161">Se você puder se conectar por meio da área de trabalho remota tooa VM em hello mesmo serviço ou de rede virtual, na nuvem verificar essas configurações:</span><span class="sxs-lookup"><span data-stu-id="7f3eb-161">If you can connect via Remote Desktop tooa virtual machine in hello same cloud service or virtual network, check for these settings:</span></span>

* <span data-ttu-id="7f3eb-162">configuração de ponto de extremidade Olá para tráfego de área de trabalho remota na VM de destino Olá: porta TCP privada de saudação do ponto de extremidade de saudação deve corresponder em qual Olá serviços de área de trabalho remota da VM está escutando a porta TCP hello (o padrão é 3389).</span><span class="sxs-lookup"><span data-stu-id="7f3eb-162">hello endpoint configuration for Remote Desktop traffic on hello target VM: hello private TCP port of hello endpoint must match hello TCP port on which hello VM's Remote Desktop service is listening (default is 3389).</span></span>
* <span data-ttu-id="7f3eb-163">Olá ACL para ponto de extremidade do tráfego de área de trabalho remota de Olá na VM de destino Olá: ACLs permitem toospecify permitido ou negado o tráfego de entrada da saudação baseado na Internet em seu endereço IP de origem.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-163">hello ACL for hello Remote Desktop traffic endpoint on hello target VM: ACLs allow you toospecify allowed or denied incoming traffic from hello Internet based on its source IP address.</span></span> <span data-ttu-id="7f3eb-164">As ACLs configuradas incorretamente podem impedir que o ponto de extremidade toohello tráfego de entrada área de trabalho remota.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-164">Misconfigured ACLs can prevent incoming Remote Desktop traffic toohello endpoint.</span></span> <span data-ttu-id="7f3eb-165">Verifique seu tooensure ACLs que o tráfego de entrada de seus endereços IP públicos do seu proxy ou outro servidor de borda é permitido.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-165">Check your ACLs tooensure that incoming traffic from your public IP addresses of your proxy or other edge server is allowed.</span></span> <span data-ttu-id="7f3eb-166">Para obter mais informações, veja [O que é uma ACL (Lista de Controle de Acesso) de Rede?](../../virtual-network/virtual-networks-acl.md)</span><span class="sxs-lookup"><span data-stu-id="7f3eb-166">For more information, see [What is a Network Access Control List (ACL)?](../../virtual-network/virtual-networks-acl.md)</span></span>

<span data-ttu-id="7f3eb-167">toocheck se o ponto de extremidade de saudação for origem Olá Olá problema, remova o ponto de extremidade atual hello e criar um novo, escolha uma porta aleatória na 49152-65535 Olá intervalo para o número da porta externa hello.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-167">toocheck if hello endpoint is hello source of hello problem, remove hello current endpoint and create a new one, choosing a random port in hello range 49152–65535 for hello external port number.</span></span> <span data-ttu-id="7f3eb-168">Para obter mais informações, consulte [como tooset máquina de virtual pontos de extremidade tooa](classic/setup-endpoints.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="7f3eb-168">For more information, see [How tooset up endpoints tooa virtual machine](classic/setup-endpoints.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json).</span></span>

## <a name="source-4-network-security-groups"></a><span data-ttu-id="7f3eb-169">Fonte 4: Grupos de segurança de rede</span><span class="sxs-lookup"><span data-stu-id="7f3eb-169">Source 4: Network Security Groups</span></span>
<span data-ttu-id="7f3eb-170">Os grupos de segurança de rede proporcionam um controle mais granular do tráfego de entrada e de saída permitido.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-170">Network Security Groups allow more granular control of allowed inbound and outbound traffic.</span></span> <span data-ttu-id="7f3eb-171">Você pode criar regras que abrangem sub-redes e serviços de nuvem em uma rede virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-171">You can create rules spanning subnets and cloud services in an Azure virtual network.</span></span>

<span data-ttu-id="7f3eb-172">Use [Verifique se o fluxo IP](../../network-watcher/network-watcher-check-ip-flow-verify-portal.md) tooconfirm se uma regra em um grupo de segurança de rede está bloqueando o tráfego tooor de uma máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-172">Use [IP flow verify](../../network-watcher/network-watcher-check-ip-flow-verify-portal.md) tooconfirm if a rule in a Network Security Group is blocking traffic tooor from a virtual machine.</span></span> <span data-ttu-id="7f3eb-173">Você também pode analisar as regras de entrada tooensure "Permitir" NSG regra existe e é priorizada para a porta do RDP (padrão 3389) do grupo de segurança efetiva.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-173">You can also review effective security group rules tooensure inbound "Allow" NSG rule exists and is prioritized for RDP port(default 3389).</span></span> <span data-ttu-id="7f3eb-174">Para obter mais informações, consulte [fluxo de tráfego usando regras de segurança efetiva tootroubleshoot VM](../../virtual-network/virtual-network-nsg-troubleshoot-portal.md#using-effective-security-rules-to-troubleshoot-vm-traffic-flow).</span><span class="sxs-lookup"><span data-stu-id="7f3eb-174">For more information, see [Using Effective Security Rules tootroubleshoot VM traffic flow](../../virtual-network/virtual-network-nsg-troubleshoot-portal.md#using-effective-security-rules-to-troubleshoot-vm-traffic-flow).</span></span>

## <a name="source-5-windows-based-azure-vm"></a><span data-ttu-id="7f3eb-175">Fonte 5: VM do Azure Baseada em Windows</span><span class="sxs-lookup"><span data-stu-id="7f3eb-175">Source 5: Windows-based Azure VM</span></span>
![](./media/detailed-troubleshoot-rdp/tshootrdp_5.png)

<span data-ttu-id="7f3eb-176">Siga as instruções de saudação em [neste artigo](reset-rdp.md).</span><span class="sxs-lookup"><span data-stu-id="7f3eb-176">Follow hello instructions in [this article](reset-rdp.md).</span></span> <span data-ttu-id="7f3eb-177">Este artigo redefine o serviço de área de trabalho remota Olá na máquina virtual de saudação:</span><span class="sxs-lookup"><span data-stu-id="7f3eb-177">This article resets hello Remote Desktop service on hello virtual machine:</span></span>

* <span data-ttu-id="7f3eb-178">Habilite a regra padrão do Firewall do Windows "Área de trabalho remota" hello (porta TCP 3389).</span><span class="sxs-lookup"><span data-stu-id="7f3eb-178">Enable hello "Remote Desktop" Windows Firewall default rule (TCP port 3389).</span></span>
* <span data-ttu-id="7f3eb-179">Habilite conexões de área de trabalho remota, definindo Olá HKLM\System\CurrentControlSet\Control\Terminal Server\fDenyTSConnections registro valor too0.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-179">Enable Remote Desktop connections by setting hello HKLM\System\CurrentControlSet\Control\Terminal Server\fDenyTSConnections registry value too0.</span></span>

<span data-ttu-id="7f3eb-180">Tente a conexão de saudação do seu computador novamente.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-180">Try hello connection from your computer again.</span></span> <span data-ttu-id="7f3eb-181">Se você ainda não é possível tooconnect via área de trabalho remota, verifique Olá problemas possíveis a seguir:</span><span class="sxs-lookup"><span data-stu-id="7f3eb-181">If you are still not able tooconnect via Remote Desktop, check for hello following possible problems:</span></span>

* <span data-ttu-id="7f3eb-182">Olá serviços de área de trabalho remota não está em execução na VM de destino hello.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-182">hello Remote Desktop service is not running on hello target VM.</span></span>
* <span data-ttu-id="7f3eb-183">Olá serviços de área de trabalho remota não está escutando na porta TCP 3389.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-183">hello Remote Desktop service is not listening on TCP port 3389.</span></span>
* <span data-ttu-id="7f3eb-184">O Firewall do Windows ou outro firewall local tem uma regra de saída que está impedindo o tráfego de Área de Trabalho Remota.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-184">Windows Firewall or another local firewall has an outbound rule that is preventing Remote Desktop traffic.</span></span>
* <span data-ttu-id="7f3eb-185">Detecção de intrusão ou software em execução na máquina virtual do Azure de saudação de monitoramento de rede está impedindo conexões de área de trabalho remota.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-185">Intrusion detection or network monitoring software running on hello Azure virtual machine is preventing Remote Desktop connections.</span></span>

<span data-ttu-id="7f3eb-186">Para VMs criadas usando o modelo de implantação clássico hello, você pode usar um toohello de sessão remota do PowerShell do Azure máquina virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-186">For VMs created using hello classic deployment model, you can use a remote Azure PowerShell session toohello Azure virtual machine.</span></span> <span data-ttu-id="7f3eb-187">Primeiro, é necessário tooinstall um certificado para o serviço de nuvem de hospedagem de saudação máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-187">First, you need tooinstall a certificate for hello virtual machine's hosting cloud service.</span></span> <span data-ttu-id="7f3eb-188">Vá muito[tooAzure de configurar o acesso remoto seguro PowerShell máquinas virtuais](http://gallery.technet.microsoft.com/scriptcenter/Configures-Secure-Remote-b137f2fe) e baixar Olá **InstallWinRMCertAzureVM.ps1** computador local de tooyour de arquivo de script.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-188">Go too[Configure Secure Remote PowerShell Access tooAzure Virtual Machines](http://gallery.technet.microsoft.com/scriptcenter/Configures-Secure-Remote-b137f2fe) and download hello **InstallWinRMCertAzureVM.ps1** script file tooyour local computer.</span></span>

<span data-ttu-id="7f3eb-189">Em seguida, instale o Azure PowerShell, se ainda não tiver feito isso.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-189">Next, install Azure PowerShell if you haven't already.</span></span> <span data-ttu-id="7f3eb-190">Consulte [como tooinstall e configurar o Azure PowerShell](/powershell/azure/overview).</span><span class="sxs-lookup"><span data-stu-id="7f3eb-190">See [How tooinstall and configure Azure PowerShell](/powershell/azure/overview).</span></span>

<span data-ttu-id="7f3eb-191">Em seguida, abra um prompt de comando do PowerShell do Azure e alterar Olá atual toohello local da pasta Olá **InstallWinRMCertAzureVM.ps1** arquivo de script.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-191">Next, open an Azure PowerShell command prompt and change hello current folder toohello location of hello **InstallWinRMCertAzureVM.ps1** script file.</span></span> <span data-ttu-id="7f3eb-192">toorun um script do PowerShell do Azure, você deve definir a política de execução correta de saudação.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-192">toorun an Azure PowerShell script, you must set hello correct execution policy.</span></span> <span data-ttu-id="7f3eb-193">Executar Olá **Get-ExecutionPolicy** comando toodetermine seu nível de política atual.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-193">Run hello **Get-ExecutionPolicy** command toodetermine your current policy level.</span></span> <span data-ttu-id="7f3eb-194">Para obter informações sobre como definir o nível apropriado de hello, consulte [Set-ExecutionPolicy](https://technet.microsoft.com/library/hh849812.aspx).</span><span class="sxs-lookup"><span data-stu-id="7f3eb-194">For information about setting hello appropriate level, see [Set-ExecutionPolicy](https://technet.microsoft.com/library/hh849812.aspx).</span></span>

<span data-ttu-id="7f3eb-195">Em seguida, preencha a nome da sua assinatura do Azure, o nome de serviço de nuvem hello e o nome da máquina virtual (removendo hello < e > caracteres) e, em seguida, execute estes comandos.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-195">Next, fill in your Azure subscription name, hello cloud service name, and your virtual machine name (removing hello < and > characters), and then run these commands.</span></span>

```powershell
$subscr="<Name of your Azure subscription>"
$serviceName="<Name of hello cloud service that contains hello target virtual machine>"
$vmName="<Name of hello target virtual machine>"
.\InstallWinRMCertAzureVM.ps1 -SubscriptionName $subscr -ServiceName $serviceName -Name $vmName
```

<span data-ttu-id="7f3eb-196">Você pode obter o nome de assinatura correta de saudação do hello *SubscriptionName* propriedade da exibição de saudação do hello **Get-AzureSubscription** comando.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-196">You can get hello correct subscription name from hello *SubscriptionName* property of hello display of hello **Get-AzureSubscription** command.</span></span> <span data-ttu-id="7f3eb-197">Você pode obter o nome do serviço de nuvem Olá para a máquina virtual de saudação do hello *ServiceName* coluna na exibição de saudação do hello **Get-AzureVM** comando.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-197">You can get hello cloud service name for hello virtual machine from hello *ServiceName* column in hello display of hello **Get-AzureVM** command.</span></span>

<span data-ttu-id="7f3eb-198">Verifique se você tem o novo certificado de saudação.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-198">Check if you have hello new certificate.</span></span> <span data-ttu-id="7f3eb-199">Abrir um snap-in de certificados para o usuário atual hello e examinar Olá **\ certificados de certificação raiz confiáveis** pasta.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-199">Open a Certificates snap-in for hello current user and look in hello **Trusted Root Certification Authorities\Certificates** folder.</span></span> <span data-ttu-id="7f3eb-200">Você deve ver um certificado com o nome DNS de saudação do seu serviço de nuvem no hello emitido toocolumn (exemplo: cloudservice4testing.cloudapp.net).</span><span class="sxs-lookup"><span data-stu-id="7f3eb-200">You should see a certificate with hello DNS name of your cloud service in hello Issued toocolumn (example: cloudservice4testing.cloudapp.net).</span></span>

<span data-ttu-id="7f3eb-201">Em seguida, inicie uma sessão remota do Azure PowerShell usando estes comandos.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-201">Next, initiate a remote Azure PowerShell session by using these commands.</span></span>

```powershell
$uri = Get-AzureWinRMUri -ServiceName $serviceName -Name $vmName
$creds = Get-Credential
Enter-PSSession -ConnectionUri $uri -Credential $creds
```

<span data-ttu-id="7f3eb-202">Depois de inserir as credenciais de administrador válida, você verá algo semelhante toohello prompt do Azure PowerShell a seguir:</span><span class="sxs-lookup"><span data-stu-id="7f3eb-202">After entering valid administrator credentials, you should see something similar toohello following Azure PowerShell prompt:</span></span>

```powershell
[cloudservice4testing.cloudapp.net]: PS C:\Users\User1\Documents>
```

<span data-ttu-id="7f3eb-203">Olá primeira parte desse prompt é o nome do serviço de nuvem que contém o destino Olá VM, que pode ser diferente de "cloudservice4testing.cloudapp.net".</span><span class="sxs-lookup"><span data-stu-id="7f3eb-203">hello first part of this prompt is your cloud service name that contains hello target VM, which could be different from "cloudservice4testing.cloudapp.net".</span></span> <span data-ttu-id="7f3eb-204">Você pode emitir comandos do PowerShell do Azure para esta nuvem mencionados de problemas do serviço tooinvestigate hello e corrigir a configuração de saudação.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-204">You can now issue Azure PowerShell commands for this cloud service tooinvestigate hello problems mentioned and correct hello configuration.</span></span>

### <a name="toomanually-correct-hello-remote-desktop-services-listening-tcp-port"></a><span data-ttu-id="7f3eb-205">toomanually corrigir Olá Remote Desktop Services escutando a porta TCP</span><span class="sxs-lookup"><span data-stu-id="7f3eb-205">toomanually correct hello Remote Desktop Services listening TCP port</span></span>
<span data-ttu-id="7f3eb-206">No prompt de sessão do PowerShell do Azure remoto hello, execute este comando.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-206">At hello remote Azure PowerShell session prompt, run this command.</span></span>

```powershell
Get-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" -Name "PortNumber"
```

<span data-ttu-id="7f3eb-207">Olá propriedade PortNumber mostra o número da porta atual hello.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-207">hello PortNumber property shows hello current port number.</span></span> <span data-ttu-id="7f3eb-208">Se necessário, altere Olá área de trabalho remota porta número tooits back valor padrão (3389) usando este comando.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-208">If needed, change hello Remote Desktop port number back tooits default value (3389) by using this command.</span></span>

```powershell
Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" -Name "PortNumber" -Value 3389
```

<span data-ttu-id="7f3eb-209">Verifique se que a porta de saudação foi alterado too3389 usando este comando.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-209">Verify that hello port has been changed too3389 by using this command.</span></span>

```powershell
Get-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" -Name "PortNumber"
```

<span data-ttu-id="7f3eb-210">Sair da sessão remota do PowerShell do Azure de saudação usando este comando.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-210">Exit hello remote Azure PowerShell session by using this command.</span></span>

```powershell
Exit-PSSession
```

<span data-ttu-id="7f3eb-211">Verifique se que esse ponto de extremidade de área de trabalho remota para hello Azure VM Olá também está usando a porta TCP 3398 como sua porta interna.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-211">Verify that hello Remote Desktop endpoint for hello Azure VM is also using TCP port 3398 as its internal port.</span></span> <span data-ttu-id="7f3eb-212">Reinicie Olá VM do Azure e tente a conexão de área de trabalho remota Olá novamente.</span><span class="sxs-lookup"><span data-stu-id="7f3eb-212">Restart hello Azure VM and try hello Remote Desktop connection again.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="7f3eb-213">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="7f3eb-213">Additional resources</span></span>
[<span data-ttu-id="7f3eb-214">Como tooreset uma senha ou hello área de trabalho remota de serviço para máquinas virtuais do Windows</span><span class="sxs-lookup"><span data-stu-id="7f3eb-214">How tooreset a password or hello Remote Desktop service for Windows virtual machines</span></span>](reset-rdp.md)

[<span data-ttu-id="7f3eb-215">Como tooinstall e configurar o Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="7f3eb-215">How tooinstall and configure Azure PowerShell</span></span>](/powershell/azure/overview)

[<span data-ttu-id="7f3eb-216">Solucionar problemas de Secure Shell (SSH) conexões tooa baseados em Linux máquina virtual do Azure</span><span class="sxs-lookup"><span data-stu-id="7f3eb-216">Troubleshoot Secure Shell (SSH) connections tooa Linux-based Azure virtual machine</span></span>](../linux/troubleshoot-ssh-connection.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)

[<span data-ttu-id="7f3eb-217">Solucionar problemas de acesso tooan aplicativo em execução em uma máquina virtual do Azure</span><span class="sxs-lookup"><span data-stu-id="7f3eb-217">Troubleshoot access tooan application running on an Azure virtual machine</span></span>](../linux/troubleshoot-app-connection.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)

