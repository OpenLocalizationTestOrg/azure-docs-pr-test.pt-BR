---
title: "Solução de problemas detalhada da área de trabalho remota no Azure | Microsoft Docs"
description: "Examinar as etapas detalhadas para solução de problemas para erros da área de trabalho remota, em que não é possível usar a área de trabalho remota para conectar às máquinas virtuais do Windows no Azure"
services: virtual-machines-windows
documentationcenter: 
author: genlin
manager: timlt
editor: 
tags: top-support-issue,azure-service-management,azure-resource-manager
keywords: "não é possível conectar à área de trabalho remota, solucionar problemas da área de trabalho remota, a área de trabalho remota não pode conectar, erros da área de trabalho remota, solução de problemas da área de trabalho remota, problemas da área de trabalho remota"
ms.assetid: 9da36f3d-30dd-44af-824b-8ce5ef07e5e0
ms.service: virtual-machines-windows
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-windows
ms.devlang: na
ms.topic: support-article
ms.date: 07/25/2017
ms.author: genli
ms.openlocfilehash: 22080b9402b13fd8162024db10aef5475880e4a7
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/03/2017
---
# <a name="detailed-troubleshooting-steps-for-remote-desktop-connection-issues-to-windows-vms-in-azure"></a><span data-ttu-id="1e151-104">Etapas detalhadas de solução de problemas para problemas de conexão de área de trabalho remota para VMs do Windows no Azure</span><span class="sxs-lookup"><span data-stu-id="1e151-104">Detailed troubleshooting steps for remote desktop connection issues to Windows VMs in Azure</span></span>
<span data-ttu-id="1e151-105">Este artigo fornece etapas detalhadas de solução de problemas a fim de diagnosticar e corrigir erros complexos de Área de Trabalho Remota para máquinas virtuais do Azure baseadas no Windows.</span><span class="sxs-lookup"><span data-stu-id="1e151-105">This article provides detailed troubleshooting steps to diagnose and fix complex Remote Desktop errors for Windows-based Azure virtual machines.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="1e151-106">Para eliminar os erros mais comuns da Área de Trabalho Remota, leia [o artigo de solução de problemas básicos da Área de Trabalho Remota](troubleshoot-rdp-connection.md) antes de continuar.</span><span class="sxs-lookup"><span data-stu-id="1e151-106">To eliminate the more common Remote Desktop errors, make sure to read [the basic troubleshooting article for Remote Desktop](troubleshoot-rdp-connection.md) before proceeding.</span></span>

<span data-ttu-id="1e151-107">Você pode encontrar uma mensagem de erro da Área de Trabalho Remota que não se parece com nenhuma das mensagens de erro específicas tratadas no [Guia básico de solução de problemas da Área de Trabalho Remota](troubleshoot-rdp-connection.md).</span><span class="sxs-lookup"><span data-stu-id="1e151-107">You may encounter a Remote Desktop error message that does not resemble any of the specific error messages covered in [the basic Remote Desktop troubleshooting guide](troubleshoot-rdp-connection.md).</span></span> <span data-ttu-id="1e151-108">Siga estas etapas para determinar por que o cliente RDP (área de trabalho remota) não é capaz de se conectar ao serviço RDP na VM do Azure.</span><span class="sxs-lookup"><span data-stu-id="1e151-108">Follow these steps to determine why the Remote Desktop (RDP) client is unable to connect to the RDP service on the Azure VM.</span></span>

[!INCLUDE [learn-about-deployment-models](../../../includes/learn-about-deployment-models-both-include.md)]

<span data-ttu-id="1e151-109">Se você precisar de mais ajuda em qualquer momento neste artigo, você pode contatar os especialistas do Azure nos [fóruns do Azure MSDN e Excedente de Pilha](https://azure.microsoft.com/support/forums/).</span><span class="sxs-lookup"><span data-stu-id="1e151-109">If you need more help at any point in this article, you can contact the Azure experts on [the MSDN Azure and the Stack Overflow forums](https://azure.microsoft.com/support/forums/).</span></span> <span data-ttu-id="1e151-110">Como alternativa, você também pode registrar um incidente de suporte do Azure.</span><span class="sxs-lookup"><span data-stu-id="1e151-110">Alternatively, you can also file an Azure support incident.</span></span> <span data-ttu-id="1e151-111">Vá para o [site de Suporte do Azure](https://azure.microsoft.com/support/options/) e clique em **Obter Suporte**.</span><span class="sxs-lookup"><span data-stu-id="1e151-111">Go to the [Azure Support site](https://azure.microsoft.com/support/options/) and click **Get Support**.</span></span> <span data-ttu-id="1e151-112">Para saber mais sobre como usar o suporte do Azure, leia as [Perguntas frequentes do Suporte do Microsoft Azure](https://azure.microsoft.com/support/faq/).</span><span class="sxs-lookup"><span data-stu-id="1e151-112">For information about using Azure Support, read the [Microsoft Azure Support FAQ](https://azure.microsoft.com/support/faq/).</span></span>

## <a name="components-of-a-remote-desktop-connection"></a><span data-ttu-id="1e151-113">Componentes de uma conexão da Área de Trabalho Remota</span><span class="sxs-lookup"><span data-stu-id="1e151-113">Components of a Remote Desktop connection</span></span>
<span data-ttu-id="1e151-114">Estes são os componentes envolvidos em uma conexão RDP:</span><span class="sxs-lookup"><span data-stu-id="1e151-114">The following components are involved in an RDP connection:</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_0.png)

<span data-ttu-id="1e151-115">Antes de continuar, talvez seja útil revisar mentalmente o que mudou desde a última conexão bem-sucedida da Área de Trabalho Remota com a VM.</span><span class="sxs-lookup"><span data-stu-id="1e151-115">Before proceeding, it might help to mentally review what has changed since the last successful Remote Desktop connection to the VM.</span></span> <span data-ttu-id="1e151-116">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="1e151-116">For example:</span></span>

* <span data-ttu-id="1e151-117">O endereço IP público da VM ou do serviço de nuvem que contém a máquina virtual (também chamado de [VIP](https://en.wikipedia.org/wiki/Virtual_IP_address), endereço IP virtual) foi alterado.</span><span class="sxs-lookup"><span data-stu-id="1e151-117">The public IP address of the VM or the cloud service containing the VM (also called the virtual IP address [VIP](https://en.wikipedia.org/wiki/Virtual_IP_address)) has changed.</span></span> <span data-ttu-id="1e151-118">A falha RDP pode ter ocorrido porque o cache do cliente DNS ainda tem o *endereço IP antigo* registrado para o nome DNS.</span><span class="sxs-lookup"><span data-stu-id="1e151-118">The RDP failure could be because your DNS client cache still has the *old IP address* registered for the DNS name.</span></span> <span data-ttu-id="1e151-119">Libere o cache do cliente DNS e tente conectar-se novamente à VM.</span><span class="sxs-lookup"><span data-stu-id="1e151-119">Flush your DNS client cache and try connecting the VM again.</span></span> <span data-ttu-id="1e151-120">Ou tente conectar-se diretamente com o novo VIP.</span><span class="sxs-lookup"><span data-stu-id="1e151-120">Or try connecting directly with the new VIP.</span></span>
* <span data-ttu-id="1e151-121">Você está usando um aplicativo de terceiros para gerenciar suas conexões de Área de Trabalho Remota em vez de usar a conexão gerada pelo portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="1e151-121">You are using a third-party application to manage your Remote Desktop connections instead of using the connection generated by the Azure portal.</span></span> <span data-ttu-id="1e151-122">Verifique se a configuração do aplicativo inclui a porta TCP correta para o tráfego de Área de Trabalho Remota.</span><span class="sxs-lookup"><span data-stu-id="1e151-122">Verify that the application configuration includes the correct TCP port for the Remote Desktop traffic.</span></span> <span data-ttu-id="1e151-123">Você pode verificar essa porta para ter uma máquina virtual clássica no [portal do Azure](https://portal.azure.com), clicando em Configurações da VM > Pontos de Extremidade.</span><span class="sxs-lookup"><span data-stu-id="1e151-123">You can check this port for a classic virtual machine in the [Azure portal](https://portal.azure.com), by clicking the VM's Settings > Endpoints.</span></span>

## <a name="preliminary-steps"></a><span data-ttu-id="1e151-124">Etapas preliminares</span><span class="sxs-lookup"><span data-stu-id="1e151-124">Preliminary steps</span></span>
<span data-ttu-id="1e151-125">Antes de prosseguir para a solução de problemas detalhada,</span><span class="sxs-lookup"><span data-stu-id="1e151-125">Before proceeding to the detailed troubleshooting,</span></span>

* <span data-ttu-id="1e151-126">verifique o status da máquina virtual no portal do Azure em busca de problemas óbvios.</span><span class="sxs-lookup"><span data-stu-id="1e151-126">Check the status of the virtual machine in the Azure portal for any obvious issues.</span></span>
* <span data-ttu-id="1e151-127">Siga as [etapas de correção rápida para os erros comuns de RDP no guia de solução de problemas básicos](troubleshoot-rdp-connection.md#quick-troubleshooting-steps).</span><span class="sxs-lookup"><span data-stu-id="1e151-127">Follow the [quick fix steps for common RDP errors in the basic troubleshooting guide](troubleshoot-rdp-connection.md#quick-troubleshooting-steps).</span></span>

<span data-ttu-id="1e151-128">Tente reconectar-se à VM por meio da Área de Trabalho Remota após estas etapas.</span><span class="sxs-lookup"><span data-stu-id="1e151-128">Try reconnecting to the VM via Remote Desktop after these steps.</span></span>

## <a name="detailed-troubleshooting-steps"></a><span data-ttu-id="1e151-129">Etapas detalhadas de solução de problemas</span><span class="sxs-lookup"><span data-stu-id="1e151-129">Detailed troubleshooting steps</span></span>
<span data-ttu-id="1e151-130">Talvez o cliente da Área de Trabalho Remota não consiga acessar o serviço da Área de Trabalho Remota na VM do Azure devido a problemas nas seguintes fontes:</span><span class="sxs-lookup"><span data-stu-id="1e151-130">The Remote Desktop client may not be able to reach the Remote Desktop service on the Azure VM due to issues at the following sources:</span></span>

* [<span data-ttu-id="1e151-131">Computador cliente de Área de Trabalho Remota</span><span class="sxs-lookup"><span data-stu-id="1e151-131">Remote Desktop client computer</span></span>](#source-1-remote-desktop-client-computer)
* [<span data-ttu-id="1e151-132">Dispositivo de borda de intranet da organização</span><span class="sxs-lookup"><span data-stu-id="1e151-132">Organization intranet edge device</span></span>](#source-2-organization-intranet-edge-device)
* [<span data-ttu-id="1e151-133">Ponto de extremidade de serviço de nuvem e ACL (lista de controle de acesso)</span><span class="sxs-lookup"><span data-stu-id="1e151-133">Cloud service endpoint and access control list (ACL)</span></span>](#source-3-cloud-service-endpoint-and-acl)
* [<span data-ttu-id="1e151-134">Grupos de segurança de rede</span><span class="sxs-lookup"><span data-stu-id="1e151-134">Network security groups</span></span>](#source-4-network-security-groups)
* [<span data-ttu-id="1e151-135">VM do Azure Baseada em Windows</span><span class="sxs-lookup"><span data-stu-id="1e151-135">Windows-based Azure VM</span></span>](#source-5-windows-based-azure-vm)

## <a name="source-1-remote-desktop-client-computer"></a><span data-ttu-id="1e151-136">Fonte 1: computador cliente de Área de Trabalho Remota</span><span class="sxs-lookup"><span data-stu-id="1e151-136">Source 1: Remote Desktop client computer</span></span>
<span data-ttu-id="1e151-137">Verifique se o computador pode estabelecer conexões de Área de Trabalho Remota com outro computador local baseado em Windows.</span><span class="sxs-lookup"><span data-stu-id="1e151-137">Verify that your computer can make Remote Desktop connections to another on-premises, Windows-based computer.</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_1.png)

<span data-ttu-id="1e151-138">Se isso não for possível, verifique as seguintes configurações em seu computador:</span><span class="sxs-lookup"><span data-stu-id="1e151-138">If you cannot, check for the following settings on your computer:</span></span>

* <span data-ttu-id="1e151-139">Uma configuração de firewall local que está bloqueando o tráfego de Área de Trabalho Remota.</span><span class="sxs-lookup"><span data-stu-id="1e151-139">A local firewall setting that is blocking Remote Desktop traffic.</span></span>
* <span data-ttu-id="1e151-140">Um software de proxy cliente instalado localmente que está impedindo conexões de Área de Trabalho Remota.</span><span class="sxs-lookup"><span data-stu-id="1e151-140">Locally installed client proxy software that is preventing Remote Desktop connections.</span></span>
* <span data-ttu-id="1e151-141">Um software de monitoramento de rede instalado localmente que está impedindo conexões de Área de Trabalho Remota.</span><span class="sxs-lookup"><span data-stu-id="1e151-141">Locally installed network monitoring software that is preventing Remote Desktop connections.</span></span>
* <span data-ttu-id="1e151-142">Outros tipos de software de segurança que monitoram o tráfego ou permitem/não permitem tipos específicos de tráfego e que estão impedindo conexões de Área de Trabalho Remota.</span><span class="sxs-lookup"><span data-stu-id="1e151-142">Other types of security software that either monitor traffic or allow/disallow specific types of traffic that is preventing Remote Desktop connections.</span></span>

<span data-ttu-id="1e151-143">Em todos esses casos, desabilite temporariamente o software e tente estabelecer uma conexão com um computador local por meio da Área de Trabalho Remota.</span><span class="sxs-lookup"><span data-stu-id="1e151-143">In all these cases, temporarily disable the software and try to connect to an on-premises computer via Remote Desktop.</span></span> <span data-ttu-id="1e151-144">Se você puder encontrar a causa real dessa forma, trabalhe com o administrador de rede para corrigir as configurações do software a fim de permitir as conexões de Área de Trabalho Remota.</span><span class="sxs-lookup"><span data-stu-id="1e151-144">If you can find out the actual cause this way, work with your network administrator to correct the software settings to allow Remote Desktop connections.</span></span>

## <a name="source-2-organization-intranet-edge-device"></a><span data-ttu-id="1e151-145">Fonte 2: dispositivo de borda de intranet da organização</span><span class="sxs-lookup"><span data-stu-id="1e151-145">Source 2: Organization intranet edge device</span></span>
<span data-ttu-id="1e151-146">Verifique se um computador conectado diretamente à Internet pode estabelecer conexões de Área de Trabalho Remota com sua máquina virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="1e151-146">Verify that a computer directly connected to the Internet can make Remote Desktop connections to your Azure virtual machine.</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_2.png)

<span data-ttu-id="1e151-147">Se não tiver um computador que esteja diretamente conectado à Internet, crie e teste com uma nova máquina virtual do Azure em um grupo de recursos ou serviço de nuvem.</span><span class="sxs-lookup"><span data-stu-id="1e151-147">If you do not have a computer that is directly connected to the Internet, create and test with a new Azure virtual machine in a resource group or cloud service.</span></span> <span data-ttu-id="1e151-148">Para obter mais informações, consulte [Criar uma máquina virtual que executa o Windows no Azure](../virtual-machines-windows-hero-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="1e151-148">For more information, see [Create a virtual machine running Windows in Azure](../virtual-machines-windows-hero-tutorial.md).</span></span> <span data-ttu-id="1e151-149">Após o teste, você pode excluir a máquina virtual e o grupo de recursos ou o serviço de nuvem.</span><span class="sxs-lookup"><span data-stu-id="1e151-149">You can delete the virtual machine and the resource group or the cloud service, after the test.</span></span>

<span data-ttu-id="1e151-150">Se você puder criar uma conexão de Área de Trabalho Remota com um computador conectado diretamente à Internet, verifique se há o seguinte no dispositivo de borda de intranet da organização:</span><span class="sxs-lookup"><span data-stu-id="1e151-150">If you can create a Remote Desktop connection with a computer directly attached to the Internet, check your organization intranet edge device for:</span></span>

* <span data-ttu-id="1e151-151">Um firewall interno bloqueando conexões HTTPS com a Internet.</span><span class="sxs-lookup"><span data-stu-id="1e151-151">An internal firewall blocking HTTPS connections to the Internet.</span></span>
* <span data-ttu-id="1e151-152">Um servidor proxy impedindo conexões de Área de Trabalho Remota.</span><span class="sxs-lookup"><span data-stu-id="1e151-152">A proxy server preventing Remote Desktop connections.</span></span>
* <span data-ttu-id="1e151-153">Software de detecção de intrusão ou monitoramento de rede executado em dispositivos em sua rede de borda que está impedindo conexões de Área de Trabalho Remota.</span><span class="sxs-lookup"><span data-stu-id="1e151-153">Intrusion detection or network monitoring software running on devices in your edge network that is preventing Remote Desktop connections.</span></span>

<span data-ttu-id="1e151-154">Trabalhe com o administrador da rede para corrigir as configurações do dispositivo de borda de intranet da organização para permitir as conexões de Área de Trabalho Remota baseadas em HTTPS com a Internet.</span><span class="sxs-lookup"><span data-stu-id="1e151-154">Work with your network administrator to correct the settings of your organization intranet edge device to allow HTTPS-based Remote Desktop connections to the Internet.</span></span>

## <a name="source-3-cloud-service-endpoint-and-acl"></a><span data-ttu-id="1e151-155">Fonte 3: ponto de extremidade de serviço de nuvem e ACL</span><span class="sxs-lookup"><span data-stu-id="1e151-155">Source 3: Cloud service endpoint and ACL</span></span>
<span data-ttu-id="1e151-156">Para VMs criadas usando o modelo de implantação clássico, verifique se outra VM do Azure que está no mesmo serviço de nuvem ou rede virtual pode estabelecer conexões da Área de Trabalho Remota com sua VM do Azure.</span><span class="sxs-lookup"><span data-stu-id="1e151-156">For VMs created using the Classic deployment model, verify that another Azure VM that is in the same cloud service or virtual network can make Remote Desktop connections to your Azure VM.</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_3.png)

> [!NOTE]
> <span data-ttu-id="1e151-157">Para máquinas virtuais criadas no Gerenciador de Recursos, vá para [Fonte 4: Grupos de segurança de rede](#source-4-network-security-groups).</span><span class="sxs-lookup"><span data-stu-id="1e151-157">For virtual machines created in Resource Manager, skip to [Source 4: Network Security Groups](#source-4-network-security-groups).</span></span>

<span data-ttu-id="1e151-158">Se não houver outra máquina virtual no mesmo serviço de nuvem ou rede virtual, você poderá criar uma.</span><span class="sxs-lookup"><span data-stu-id="1e151-158">If you do not have another virtual machine in the same cloud service or virtual network, create one.</span></span> <span data-ttu-id="1e151-159">Siga as etapas em [Criar uma máquina virtual que executa o Windows no Azure](../virtual-machines-windows-hero-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="1e151-159">Follow the steps in [Create a virtual machine running Windows in Azure](../virtual-machines-windows-hero-tutorial.md).</span></span> <span data-ttu-id="1e151-160">Exclua a máquina virtual de teste após esse teste ser concluído.</span><span class="sxs-lookup"><span data-stu-id="1e151-160">Delete the test virtual machine after the test is completed.</span></span>

<span data-ttu-id="1e151-161">Se você puder se conectar a uma máquina virtual por meio da Área de Trabalho Remota no mesmo serviço de nuvem ou rede virtual, verifique as seguintes configurações:</span><span class="sxs-lookup"><span data-stu-id="1e151-161">If you can connect via Remote Desktop to a virtual machine in the same cloud service or virtual network, check for these settings:</span></span>

* <span data-ttu-id="1e151-162">A configuração do ponto de extremidade para o tráfego de Área de Trabalho Remota na VM de destino: a porta TCP privada do ponto de extremidade deve corresponder à porta TCP na qual o serviço de Área de Trabalho Remota da VM está escutando (o padrão é 3389).</span><span class="sxs-lookup"><span data-stu-id="1e151-162">The endpoint configuration for Remote Desktop traffic on the target VM: The private TCP port of the endpoint must match the TCP port on which the VM's Remote Desktop service is listening (default is 3389).</span></span>
* <span data-ttu-id="1e151-163">A ACL para o ponto de extremidade do tráfego da Área de Trabalho Remota na VM de destino: as ACLs permitem que você especifique o tráfego de entrada permitido ou negado da Internet com base em seu endereço IP de origem.</span><span class="sxs-lookup"><span data-stu-id="1e151-163">The ACL for the Remote Desktop traffic endpoint on the target VM: ACLs allow you to specify allowed or denied incoming traffic from the Internet based on its source IP address.</span></span> <span data-ttu-id="1e151-164">ACLs configuradas incorretamente podem impedir o tráfego de Área de Trabalho Remota para o ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="1e151-164">Misconfigured ACLs can prevent incoming Remote Desktop traffic to the endpoint.</span></span> <span data-ttu-id="1e151-165">Verifique suas ACLs para verificar se o tráfego de entrada dos endereços IP públicos de seu proxy ou outro servidor de borda é permitido.</span><span class="sxs-lookup"><span data-stu-id="1e151-165">Check your ACLs to ensure that incoming traffic from your public IP addresses of your proxy or other edge server is allowed.</span></span> <span data-ttu-id="1e151-166">Para obter mais informações, veja [O que é uma ACL (Lista de Controle de Acesso) de Rede?](../../virtual-network/virtual-networks-acl.md)</span><span class="sxs-lookup"><span data-stu-id="1e151-166">For more information, see [What is a Network Access Control List (ACL)?](../../virtual-network/virtual-networks-acl.md)</span></span>

<span data-ttu-id="1e151-167">Para verificar se o ponto de extremidade é a fonte do problema, remova o ponto de extremidade atual e crie um novo, escolhendo uma porta aleatória no intervalo 49152-65535 para o número da porta externa.</span><span class="sxs-lookup"><span data-stu-id="1e151-167">To check if the endpoint is the source of the problem, remove the current endpoint and create a new one, choosing a random port in the range 49152–65535 for the external port number.</span></span> <span data-ttu-id="1e151-168">Para obter mais informações, consulte [Como configurar pontos de extremidade para uma máquina virtual](classic/setup-endpoints.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="1e151-168">For more information, see [How to set up endpoints to a virtual machine](classic/setup-endpoints.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json).</span></span>

## <a name="source-4-network-security-groups"></a><span data-ttu-id="1e151-169">Fonte 4: Grupos de segurança de rede</span><span class="sxs-lookup"><span data-stu-id="1e151-169">Source 4: Network Security Groups</span></span>
<span data-ttu-id="1e151-170">Os grupos de segurança de rede proporcionam um controle mais granular do tráfego de entrada e de saída permitido.</span><span class="sxs-lookup"><span data-stu-id="1e151-170">Network Security Groups allow more granular control of allowed inbound and outbound traffic.</span></span> <span data-ttu-id="1e151-171">Você pode criar regras que abrangem sub-redes e serviços de nuvem em uma rede virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="1e151-171">You can create rules spanning subnets and cloud services in an Azure virtual network.</span></span>

<span data-ttu-id="1e151-172">Use a [verificação de fluxo de IP](../../network-watcher/network-watcher-check-ip-flow-verify-portal.md) para confirmar se uma regra em um Grupo de Segurança de Rede está bloqueando o tráfego de ou para uma máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="1e151-172">Use [IP flow verify](../../network-watcher/network-watcher-check-ip-flow-verify-portal.md) to confirm if a rule in a Network Security Group is blocking traffic to or from a virtual machine.</span></span> <span data-ttu-id="1e151-173">Você também pode examinar as regras de grupo de segurança efetivas para garantir que a regra "Permitir" NSG existe e é priorizada para a porta RDP(padrão 3389).</span><span class="sxs-lookup"><span data-stu-id="1e151-173">You can also review effective security group rules to ensure inbound "Allow" NSG rule exists and is prioritized for RDP port(default 3389).</span></span> <span data-ttu-id="1e151-174">Para obter mais informações, confira [Usar regras de segurança efetivas para solucionar problemas de fluxo de tráfego de VM](../../virtual-network/virtual-network-nsg-troubleshoot-portal.md#using-effective-security-rules-to-troubleshoot-vm-traffic-flow).</span><span class="sxs-lookup"><span data-stu-id="1e151-174">For more information, see [Using Effective Security Rules to troubleshoot VM traffic flow](../../virtual-network/virtual-network-nsg-troubleshoot-portal.md#using-effective-security-rules-to-troubleshoot-vm-traffic-flow).</span></span>

## <a name="source-5-windows-based-azure-vm"></a><span data-ttu-id="1e151-175">Fonte 5: VM do Azure Baseada em Windows</span><span class="sxs-lookup"><span data-stu-id="1e151-175">Source 5: Windows-based Azure VM</span></span>
![](./media/detailed-troubleshoot-rdp/tshootrdp_5.png)

<span data-ttu-id="1e151-176">Siga as instruções [deste artigo](reset-rdp.md).</span><span class="sxs-lookup"><span data-stu-id="1e151-176">Follow the instructions in [this article](reset-rdp.md).</span></span> <span data-ttu-id="1e151-177">Este artigo redefine o serviço de Área de Trabalho Remota na máquina virtual:</span><span class="sxs-lookup"><span data-stu-id="1e151-177">This article resets the Remote Desktop service on the virtual machine:</span></span>

* <span data-ttu-id="1e151-178">Habilitar a regra de firewall padrão do Windows de "Área de Trabalho Remota" (porta TCP 3389).</span><span class="sxs-lookup"><span data-stu-id="1e151-178">Enable the "Remote Desktop" Windows Firewall default rule (TCP port 3389).</span></span>
* <span data-ttu-id="1e151-179">Habilitar conexões de Área de Trabalho Remota definindo o valor do Registro HKLM\System\CurrentControlSet\Control\Terminal Server\fDenyTSConnections como 0.</span><span class="sxs-lookup"><span data-stu-id="1e151-179">Enable Remote Desktop connections by setting the HKLM\System\CurrentControlSet\Control\Terminal Server\fDenyTSConnections registry value to 0.</span></span>

<span data-ttu-id="1e151-180">Tente estabelecer a conexão de seu computador novamente.</span><span class="sxs-lookup"><span data-stu-id="1e151-180">Try the connection from your computer again.</span></span> <span data-ttu-id="1e151-181">Se você ainda não conseguir conectar-se via Área de Trabalho Remota, verifique os possíveis problemas a seguir:</span><span class="sxs-lookup"><span data-stu-id="1e151-181">If you are still not able to connect via Remote Desktop, check for the following possible problems:</span></span>

* <span data-ttu-id="1e151-182">O serviço de Área de Trabalho Remota não está em execução na VM de destino.</span><span class="sxs-lookup"><span data-stu-id="1e151-182">The Remote Desktop service is not running on the target VM.</span></span>
* <span data-ttu-id="1e151-183">O serviço de Área de Trabalho Remota não está escutando na porta TCP 3389.</span><span class="sxs-lookup"><span data-stu-id="1e151-183">The Remote Desktop service is not listening on TCP port 3389.</span></span>
* <span data-ttu-id="1e151-184">O Firewall do Windows ou outro firewall local tem uma regra de saída que está impedindo o tráfego de Área de Trabalho Remota.</span><span class="sxs-lookup"><span data-stu-id="1e151-184">Windows Firewall or another local firewall has an outbound rule that is preventing Remote Desktop traffic.</span></span>
* <span data-ttu-id="1e151-185">Um software de detecção de intrusão ou monitoramento de rede em execução na máquina virtual do Azure está impedindo conexões de Área de Trabalho Remota.</span><span class="sxs-lookup"><span data-stu-id="1e151-185">Intrusion detection or network monitoring software running on the Azure virtual machine is preventing Remote Desktop connections.</span></span>

<span data-ttu-id="1e151-186">Para VMs criadas usando o modelo de implantação clássico, você pode usar uma sessão remota do Azure PowerShell para a máquina virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="1e151-186">For VMs created using the classic deployment model, you can use a remote Azure PowerShell session to the Azure virtual machine.</span></span> <span data-ttu-id="1e151-187">Primeiro, você precisa instalar um certificado para o serviço de nuvem de hospedagem da máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="1e151-187">First, you need to install a certificate for the virtual machine's hosting cloud service.</span></span> <span data-ttu-id="1e151-188">Acesse [Configurar Acesso Seguro Remoto do PowerShell às Máquinas Virtuais do Azure](http://gallery.technet.microsoft.com/scriptcenter/Configures-Secure-Remote-b137f2fe) e baixe o arquivo de script **InstallWinRMCertAzureVM.ps1** para o computador local.</span><span class="sxs-lookup"><span data-stu-id="1e151-188">Go to [Configure Secure Remote PowerShell Access to Azure Virtual Machines](http://gallery.technet.microsoft.com/scriptcenter/Configures-Secure-Remote-b137f2fe) and download the **InstallWinRMCertAzureVM.ps1** script file to your local computer.</span></span>

<span data-ttu-id="1e151-189">Em seguida, instale o Azure PowerShell, se ainda não tiver feito isso.</span><span class="sxs-lookup"><span data-stu-id="1e151-189">Next, install Azure PowerShell if you haven't already.</span></span> <span data-ttu-id="1e151-190">Consulte [Como instalar e configurar o PowerShell do Azure](/powershell/azure/overview).</span><span class="sxs-lookup"><span data-stu-id="1e151-190">See [How to install and configure Azure PowerShell](/powershell/azure/overview).</span></span>

<span data-ttu-id="1e151-191">Em seguida, abra um prompt de comando do Azure PowerShell e altere a pasta atual para o local do arquivo de script **InstallWinRMCertAzureVM.ps1** .</span><span class="sxs-lookup"><span data-stu-id="1e151-191">Next, open an Azure PowerShell command prompt and change the current folder to the location of the **InstallWinRMCertAzureVM.ps1** script file.</span></span> <span data-ttu-id="1e151-192">Para executar um script do Azure PowerShell, é preciso definir a política de execução correta.</span><span class="sxs-lookup"><span data-stu-id="1e151-192">To run an Azure PowerShell script, you must set the correct execution policy.</span></span> <span data-ttu-id="1e151-193">Execute o comando **Get-ExecutionPolicy** para determinar o nível de política atual.</span><span class="sxs-lookup"><span data-stu-id="1e151-193">Run the **Get-ExecutionPolicy** command to determine your current policy level.</span></span> <span data-ttu-id="1e151-194">Para obter informações sobre como definir o nível apropriado, consulte [Set-ExecutionPolicy](https://technet.microsoft.com/library/hh849812.aspx).</span><span class="sxs-lookup"><span data-stu-id="1e151-194">For information about setting the appropriate level, see [Set-ExecutionPolicy](https://technet.microsoft.com/library/hh849812.aspx).</span></span>

<span data-ttu-id="1e151-195">Em seguida, preencha o nome de sua assinatura do Azure, o nome do serviço de nuvem e o nome da máquina virtual (removendo os caracteres < e >), depois execute estes comandos.</span><span class="sxs-lookup"><span data-stu-id="1e151-195">Next, fill in your Azure subscription name, the cloud service name, and your virtual machine name (removing the < and > characters), and then run these commands.</span></span>

```powershell
$subscr="<Name of your Azure subscription>"
$serviceName="<Name of the cloud service that contains the target virtual machine>"
$vmName="<Name of the target virtual machine>"
.\InstallWinRMCertAzureVM.ps1 -SubscriptionName $subscr -ServiceName $serviceName -Name $vmName
```

<span data-ttu-id="1e151-196">Você pode obter o nome da assinatura correto na propriedade *SubscriptionName* da exibição do comando **Get-AzureSubscription**.</span><span class="sxs-lookup"><span data-stu-id="1e151-196">You can get the correct subscription name from the *SubscriptionName* property of the display of the **Get-AzureSubscription** command.</span></span> <span data-ttu-id="1e151-197">Você pode obter o nome do serviço de nuvem para a máquina virtual na coluna *ServiceName* na exibição do comando **Get-AzureVM**.</span><span class="sxs-lookup"><span data-stu-id="1e151-197">You can get the cloud service name for the virtual machine from the *ServiceName* column in the display of the **Get-AzureVM** command.</span></span>

<span data-ttu-id="1e151-198">Verifique se você tem o novo certificado.</span><span class="sxs-lookup"><span data-stu-id="1e151-198">Check if you have the new certificate.</span></span> <span data-ttu-id="1e151-199">Abra um snap-in de Certificados para o usuário atual e examine a pasta **Autoridades\Certificados de Certificação da Raiz Confiáveis**.</span><span class="sxs-lookup"><span data-stu-id="1e151-199">Open a Certificates snap-in for the current user and look in the **Trusted Root Certification Authorities\Certificates** folder.</span></span> <span data-ttu-id="1e151-200">Você deve ver um certificado com o nome DNS de seu serviço de nuvem na coluna Emitido para (exemplo: cloudservice4testing.cloudapp.net).</span><span class="sxs-lookup"><span data-stu-id="1e151-200">You should see a certificate with the DNS name of your cloud service in the Issued To column (example: cloudservice4testing.cloudapp.net).</span></span>

<span data-ttu-id="1e151-201">Em seguida, inicie uma sessão remota do Azure PowerShell usando estes comandos.</span><span class="sxs-lookup"><span data-stu-id="1e151-201">Next, initiate a remote Azure PowerShell session by using these commands.</span></span>

```powershell
$uri = Get-AzureWinRMUri -ServiceName $serviceName -Name $vmName
$creds = Get-Credential
Enter-PSSession -ConnectionUri $uri -Credential $creds
```

<span data-ttu-id="1e151-202">Depois de inserir credenciais de administrador válidas, você verá algo semelhante ao prompt do Azure PowerShell a seguir:</span><span class="sxs-lookup"><span data-stu-id="1e151-202">After entering valid administrator credentials, you should see something similar to the following Azure PowerShell prompt:</span></span>

```powershell
[cloudservice4testing.cloudapp.net]: PS C:\Users\User1\Documents>
```

<span data-ttu-id="1e151-203">A primeira parte desse prompt é seu nome de serviço de nuvem que contém a VM de destino, que pode ser diferente de "cloudservice4testing.cloudapp.net".</span><span class="sxs-lookup"><span data-stu-id="1e151-203">The first part of this prompt is your cloud service name that contains the target VM, which could be different from "cloudservice4testing.cloudapp.net".</span></span> <span data-ttu-id="1e151-204">Agora é possível emitir comandos do Azure PowerShell para esse serviço de nuvem para investigar os problemas mencionados e corrigir a configuração.</span><span class="sxs-lookup"><span data-stu-id="1e151-204">You can now issue Azure PowerShell commands for this cloud service to investigate the problems mentioned and correct the configuration.</span></span>

### <a name="to-manually-correct-the-remote-desktop-services-listening-tcp-port"></a><span data-ttu-id="1e151-205">Para corrigir manualmente os Serviços de Área de Trabalho Remota escutando a porta TCP</span><span class="sxs-lookup"><span data-stu-id="1e151-205">To manually correct the Remote Desktop Services listening TCP port</span></span>
<span data-ttu-id="1e151-206">No prompt de sessão remota do Azure PowerShell, execute este comando.</span><span class="sxs-lookup"><span data-stu-id="1e151-206">At the remote Azure PowerShell session prompt, run this command.</span></span>

```powershell
Get-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" -Name "PortNumber"
```

<span data-ttu-id="1e151-207">A propriedade PortNumber mostra o número de porta atual.</span><span class="sxs-lookup"><span data-stu-id="1e151-207">The PortNumber property shows the current port number.</span></span> <span data-ttu-id="1e151-208">Se necessário, altere o número de porta da Área de Trabalho Remota de volta para seu valor padrão (3389) usando este comando.</span><span class="sxs-lookup"><span data-stu-id="1e151-208">If needed, change the Remote Desktop port number back to its default value (3389) by using this command.</span></span>

```powershell
Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" -Name "PortNumber" -Value 3389
```

<span data-ttu-id="1e151-209">Verifique se a porta foi alterada para 3389 usando este comando.</span><span class="sxs-lookup"><span data-stu-id="1e151-209">Verify that the port has been changed to 3389 by using this command.</span></span>

```powershell
Get-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" -Name "PortNumber"
```

<span data-ttu-id="1e151-210">Saia da sessão remota do Azure PowerShell usando este comando.</span><span class="sxs-lookup"><span data-stu-id="1e151-210">Exit the remote Azure PowerShell session by using this command.</span></span>

```powershell
Exit-PSSession
```

<span data-ttu-id="1e151-211">Verifique se o ponto de extremidade da Área de Trabalho Remota para a VM do Azure também está usando a porta TCP 3398 como sua porta interna.</span><span class="sxs-lookup"><span data-stu-id="1e151-211">Verify that the Remote Desktop endpoint for the Azure VM is also using TCP port 3398 as its internal port.</span></span> <span data-ttu-id="1e151-212">Reinicie a VM do Azure e tente novamente a conexão de Área de Trabalho Remota.</span><span class="sxs-lookup"><span data-stu-id="1e151-212">Restart the Azure VM and try the Remote Desktop connection again.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="1e151-213">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="1e151-213">Additional resources</span></span>
[<span data-ttu-id="1e151-214">Como redefinir uma senha ou o serviço da Área de Trabalho Remota para as máquinas virtuais do Windows</span><span class="sxs-lookup"><span data-stu-id="1e151-214">How to reset a password or the Remote Desktop service for Windows virtual machines</span></span>](reset-rdp.md)

[<span data-ttu-id="1e151-215">Como instalar e configurar o Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="1e151-215">How to install and configure Azure PowerShell</span></span>](/powershell/azure/overview)

[<span data-ttu-id="1e151-216">Solucionar problemas de conexões SSH (Secure Shell) para uma máquina virtual do Azure baseada em Linux</span><span class="sxs-lookup"><span data-stu-id="1e151-216">Troubleshoot Secure Shell (SSH) connections to a Linux-based Azure virtual machine</span></span>](../linux/troubleshoot-ssh-connection.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)

[<span data-ttu-id="1e151-217">Solucionar problemas de acesso a um aplicativo executado em uma máquina virtual do Azure</span><span class="sxs-lookup"><span data-stu-id="1e151-217">Troubleshoot access to an application running on an Azure virtual machine</span></span>](../linux/troubleshoot-app-connection.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)

