---
title: "monitoramento e diagnóstico de aaaAdd tooan máquina virtual do Azure | Microsoft Docs"
description: "Use um toocreate de modelo do Gerenciador de recursos do Azure nova máquina virtual do Windows com a extensão de diagnóstico do Azure."
services: virtual-machines-windows
documentationcenter: 
author: sbtron
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 8cde8fe7-977b-43d2-be74-ad46dc946058
ms.service: virtual-machines-windows
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-windows
ms.devlang: na
ms.topic: article
ms.date: 05/31/2017
ms.author: saurabh
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: d8a831421a0f9d38c09d51cf8c2e6dff913c77ff
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="use-monitoring-and-diagnostics-with-a-windows-vm-and-azure-resource-manager-templates"></a><span data-ttu-id="b9a01-103">Usar monitoramento e diagnóstico com uma VM Windows e modelos do Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="b9a01-103">Use monitoring and diagnostics with a Windows VM and Azure Resource Manager templates</span></span>
<span data-ttu-id="b9a01-104">Olá extensão de diagnóstico do Azure fornece monitoramento de saudação e recursos de diagnóstico em um Windows com base em máquina virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="b9a01-104">hello Azure Diagnostics Extension provides hello monitoring and diagnostics capabilities on a Windows based Azure virtual machine.</span></span> <span data-ttu-id="b9a01-105">Você pode habilitar esses recursos na máquina virtual de hello, incluindo a extensão de saudação como parte do modelo do Gerenciador de recursos do azure hello.</span><span class="sxs-lookup"><span data-stu-id="b9a01-105">You can enable these capabilities on hello virtual machine by including hello extension as part of hello azure resource manager template.</span></span> <span data-ttu-id="b9a01-106">Para saber mais sobre como incluir extensões como parte de um modelo de máquina virtual, confira [Criando modelos do Gerenciador de Recursos do Azure com extensões de VM](template-description.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json#extensions) .</span><span class="sxs-lookup"><span data-stu-id="b9a01-106">See [Authoring Azure Resource Manager Templates with VM Extensions](template-description.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json#extensions) for more information on including any extension as part of a virtual machine template.</span></span> <span data-ttu-id="b9a01-107">Este artigo descreve como você pode adicionar um modelo de máquina virtual do windows hello diagnóstico do Azure extensão tooa.</span><span class="sxs-lookup"><span data-stu-id="b9a01-107">This article describes how you can add hello Azure Diagnostics extension tooa windows virtual machine template.</span></span>  

## <a name="add-hello-azure-diagnostics-extension-toohello-vm-resource-definition"></a><span data-ttu-id="b9a01-108">Adicionar definição de recurso VM Olá diagnóstico do Azure extensão toohello</span><span class="sxs-lookup"><span data-stu-id="b9a01-108">Add hello Azure Diagnostics extension toohello VM resource definition</span></span>
<span data-ttu-id="b9a01-109">extensão de diagnóstico Olá tooenable em uma máquina Virtual do Windows precisa de extensão de saudação tooadd como um recurso VM no hello modelo do Gerenciador de recursos.</span><span class="sxs-lookup"><span data-stu-id="b9a01-109">tooenable hello diagnostics extension on a Windows Virtual Machine you need tooadd hello extension as a VM resource in hello Resource manager template.</span></span>

<span data-ttu-id="b9a01-110">Para um Gerenciador de recursos simples baseado em máquina de Virtual adicionar Olá extensão configuração toohello *recursos* matriz para Olá Máquina Virtual:</span><span class="sxs-lookup"><span data-stu-id="b9a01-110">For a simple Resource Manager based Virtual Machine add hello extension configuration toohello *resources* array for hello Virtual Machine:</span></span> 

    "resources": [
                {
                    "name": "Microsoft.Insights.VMDiagnosticsSettings",
                    "type": "extensions",
                    "location": "[resourceGroup().location]",
                    "apiVersion": "2015-06-15",
                    "dependsOn": [
                        "[concat('Microsoft.Compute/virtualMachines/', variables('vmName'))]"
                    ],
                    "tags": {
                        "displayName": "AzureDiagnostics"
                    },
                    "properties": {
                        "publisher": "Microsoft.Azure.Diagnostics",
                        "type": "IaaSDiagnostics",
                        "typeHandlerVersion": "1.5",
                        "autoUpgradeMinorVersion": true,
                        "settings": {
                            "xmlCfg": "[base64(concat(variables('wadcfgxstart'), variables('wadmetricsresourceid'), variables('vmName'), variables('wadcfgxend')))]",
                            "storageAccount": "[parameters('existingdiagnosticsStorageAccountName')]"
                        },
                        "protectedSettings": {
                            "storageAccountName": "[parameters('existingdiagnosticsStorageAccountName')]",
                            "storageAccountKey": "[listkeys(variables('accountid'), '2015-05-01-preview').key1]",
                            "storageAccountEndPoint": "https://core.windows.net"
                        }
                    }
                }
            ]


<span data-ttu-id="b9a01-111">Outra convenção comum é adicionar configuração da extensão Olá no nó de recursos Olá raiz do modelo de saudação em vez de defini-lo no nó de recursos da máquina virtual hello.</span><span class="sxs-lookup"><span data-stu-id="b9a01-111">Another common convention is add hello extension configuration at hello root resources node of hello template instead of defining it under hello virtual machine's resources node.</span></span> <span data-ttu-id="b9a01-112">Com essa abordagem, você tem tooexplicitly especificar uma relação hierárquica entre extensão hello e máquina virtual de saudação com hello *nome* e *tipo* valores.</span><span class="sxs-lookup"><span data-stu-id="b9a01-112">With this approach you have tooexplicitly specify a hierarchical relation between hello extension and hello virtual machine with hello *name* and *type* values.</span></span> <span data-ttu-id="b9a01-113">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="b9a01-113">For example:</span></span> 

    "name": "[concat(variables('vmName'),'Microsoft.Insights.VMDiagnosticsSettings')]",
    "type": "Microsoft.Compute/virtualMachines/extensions",

<span data-ttu-id="b9a01-114">extensão Olá é sempre associada a máquina virtual de saudação, você poderá diretamente defini-lo diretamente no nó de recurso da máquina de virtual Olá ou defini-lo no nível de base de saudação e usar Olá tooassociate de convenção de nomenclatura hierárquica com hello virtual máquina.</span><span class="sxs-lookup"><span data-stu-id="b9a01-114">hello extension is always associated with hello virtual machine, you can either directly define it under hello virtual machine's resource node directly or define it at hello base level and use hello hierarchical naming convention tooassociate it with hello virtual machine.</span></span>

<span data-ttu-id="b9a01-115">Para extensões de saudação de conjuntos de escala de máquina Virtual configuração é especificada em Olá *extensionProfile* propriedade Olá *VirtualMachineProfile*.</span><span class="sxs-lookup"><span data-stu-id="b9a01-115">For Virtual Machine Scale Sets hello extensions configuration is specified in hello *extensionProfile* property of hello *VirtualMachineProfile*.</span></span>

<span data-ttu-id="b9a01-116">Olá *publicador* propriedade com valor de saudação do **Microsoft.Azure.Diagnostics** e hello *tipo* propriedade com valor de saudação do **IaaSDiagnostics** identificar exclusivamente Olá extensão de diagnóstico do Azure.</span><span class="sxs-lookup"><span data-stu-id="b9a01-116">hello *publisher* property with hello value of **Microsoft.Azure.Diagnostics** and hello *type* property with hello value of **IaaSDiagnostics** uniquely identify hello Azure Diagnostics extension.</span></span>

<span data-ttu-id="b9a01-117">Olá valor Olá *nome* propriedade pode ser usado toorefer toohello extensão no grupo de recursos de saudação.</span><span class="sxs-lookup"><span data-stu-id="b9a01-117">hello value of hello *name* property can be used toorefer toohello extension in hello resource group.</span></span> <span data-ttu-id="b9a01-118">Configurá-lo especificamente muito**Microsoft.Insights.VMDiagnosticsSettings** habilitará toobe facilmente identificado por hello garantindo portal do Azure, Olá monitoramento gráficos aparecem corretamente Olá portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="b9a01-118">Setting it specifically too**Microsoft.Insights.VMDiagnosticsSettings** will enable it toobe easily identified by hello Azure portal ensuring that hello monitoring charts show up correctly in hello Azure portal.</span></span>

<span data-ttu-id="b9a01-119">Olá *typeHandlerVersion* Especifica Olá versão da extensão Olá você gostaria que toouse.</span><span class="sxs-lookup"><span data-stu-id="b9a01-119">hello *typeHandlerVersion* specifies hello version of hello extension you would like toouse.</span></span> <span data-ttu-id="b9a01-120">Configuração *autoUpgradeMinorVersion* muito a versão secundária**true** garante que você obterá a versão secundária mais recente de saudação de extensão de saudação que está disponível.</span><span class="sxs-lookup"><span data-stu-id="b9a01-120">Setting *autoUpgradeMinorVersion* minor version too**true** ensures that you will get hello latest Minor version of hello extension that is available.</span></span> <span data-ttu-id="b9a01-121">É altamente recomendável que você sempre defina *autoUpgradeMinorVersion* tooalways ser **true** para que você obtenha sempre toouse hello mais recente disponível extensão de diagnóstico com todos os novos recursos do hello e bug correções.</span><span class="sxs-lookup"><span data-stu-id="b9a01-121">It is highly recommended that you always set *autoUpgradeMinorVersion* tooalways be **true** so that you always get toouse hello latest available diagnostics extension with all hello new features and bug fixes.</span></span> 

<span data-ttu-id="b9a01-122">Olá *configurações* elemento contém propriedades de configurações de extensão de saudação que podem ser definidas e ler da extensão de saudação (às vezes chamado de tooas configuração pública).</span><span class="sxs-lookup"><span data-stu-id="b9a01-122">hello *settings* element contains configurations properties for hello extension that can be set and read back from hello extension (sometimes referred tooas public configuration).</span></span> <span data-ttu-id="b9a01-123">Olá *xmlcfg* propriedade contém a configuração baseada em xml para logs de diagnóstico hello, contadores de desempenho que serão coletadas pelo agente de diagnóstico Olá etc.</span><span class="sxs-lookup"><span data-stu-id="b9a01-123">hello *xmlcfg* property contains xml based configuration for hello diagnostics logs, performance counters etc that will be collected by hello diagnostics agent.</span></span> <span data-ttu-id="b9a01-124">Consulte [esquema de configuração de diagnóstico](https://msdn.microsoft.com/library/azure/dn782207.aspx) para obter mais informações sobre o próprio esquema de xml hello.</span><span class="sxs-lookup"><span data-stu-id="b9a01-124">See [Diagnostics Configuration Schema](https://msdn.microsoft.com/library/azure/dn782207.aspx) for more information about hello xml schema itself.</span></span> <span data-ttu-id="b9a01-125">Uma prática comum é a configuração de xml real de saudação toostore como uma variável no modelo do Azure Resource Manager hello e, em seguida, concatenar e base64 codificação-los o valor Olá tooset *xmlcfg*.</span><span class="sxs-lookup"><span data-stu-id="b9a01-125">A common practice is toostore hello actual xml configuration as a variable in hello Azure Resource Manager template and then concatenate and base64 encode them tooset hello value for *xmlcfg*.</span></span> <span data-ttu-id="b9a01-126">Consulte a seção de saudação em [variáveis de configuração de diagnóstico](#diagnostics-configuration-variables) toounderstand mais informações sobre como toostore Olá xml em variáveis.</span><span class="sxs-lookup"><span data-stu-id="b9a01-126">See hello section on [diagnostics configuration variables](#diagnostics-configuration-variables) toounderstand more about how toostore hello xml in variables.</span></span> <span data-ttu-id="b9a01-127">Olá *storageAccount* propriedade especifica o nome de Olá Olá armazenamento conta toowhich de dados de diagnóstico será transferido.</span><span class="sxs-lookup"><span data-stu-id="b9a01-127">hello *storageAccount* property specifies hello name of hello storage account toowhich diagnostics data will be transferred.</span></span> 

<span data-ttu-id="b9a01-128">Olá propriedades em *protectedSettings* (às vezes chamado de tooas configuração privada) podem ser definida, mas não podem ser lidos após sendo definido.</span><span class="sxs-lookup"><span data-stu-id="b9a01-128">hello properties in *protectedSettings* (sometimes referred tooas private configuration) can be set but cannot be read back after being set.</span></span> <span data-ttu-id="b9a01-129">Olá natureza somente gravação do *protectedSettings* é útil para armazenar segredos como chave de conta de armazenamento Olá onde os dados de diagnóstico hello serão gravados.</span><span class="sxs-lookup"><span data-stu-id="b9a01-129">hello write-only nature of *protectedSettings* makes it useful for storing secrets like hello storage account key where hello diagnostics data will be written.</span></span>    

## <a name="specifying-diagnostics-storage-account-as-parameters"></a><span data-ttu-id="b9a01-130">Especificando uma conta de armazenamento de diagnóstico como parâmetro</span><span class="sxs-lookup"><span data-stu-id="b9a01-130">Specifying diagnostics storage account as parameters</span></span>
<span data-ttu-id="b9a01-131">Olá diagnóstico extensão trecho json a acima assume dois parâmetros *existingdiagnosticsStorageAccountName* e *existingdiagnosticsStorageResourceGroup* toospecify diagnóstico de saudação conta de armazenamento onde serão armazenados os dados de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="b9a01-131">hello diagnostics extension json snippet above assumes two parameters *existingdiagnosticsStorageAccountName* and *existingdiagnosticsStorageResourceGroup* toospecify hello diagnostics storage account where diagnostics data will be stored.</span></span> <span data-ttu-id="b9a01-132">Especificar a conta de armazenamento de diagnóstico de saudação como um parâmetro torna fácil toochange conta de armazenamento de diagnóstico de saudação entre ambientes diferentes, por exemplo, talvez queira toouse uma conta de armazenamento de diagnóstico diferentes para teste e outro para o implantação de produção.</span><span class="sxs-lookup"><span data-stu-id="b9a01-132">Specifying hello diagnostics storage account as a parameter makes it easy toochange hello diagnostics storage account across different environments e.g. you may want toouse a different diagnostics storage account for testing and a different one for your production deployment.</span></span>  

        "existingdiagnosticsStorageAccountName": {
            "type": "string",
            "metadata": {
        "description": "hello name of an existing storage account toowhich diagnostics data will be transfered."
            }        
        },
        "existingdiagnosticsStorageResourceGroup": {
            "type": "string",
            "metadata": {
        "description": "hello resource group for hello storage account specified in existingdiagnosticsStorageAccountName"
              }
        }

<span data-ttu-id="b9a01-133">É uma conta de armazenamento de diagnóstico em um grupo de recursos diferente de grupo de recursos de saudação para a máquina virtual de saudação toospecify de melhor prática.</span><span class="sxs-lookup"><span data-stu-id="b9a01-133">It is best practice toospecify a diagnostics storage account in a different resource group than hello resource group for hello virtual machine.</span></span> <span data-ttu-id="b9a01-134">Um grupo de recursos pode ser considerado toobe com seu próprio tempo de vida de uma unidade de implantação, uma máquina virtual pode ser implantada e reimplantada conforme novas atualizações de configurações ficam tooit, mas você pode querer toocontinue armazenar dados de diagnóstico de saudação em Olá mesma conta de armazenamento entre essas implantações de máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="b9a01-134">A resource group can be considered toobe a deployment unit with its own lifetime, a virtual machine can be deployed and redeployed as new configurations updates are made it tooit but you may want toocontinue storing hello diagnostics data in hello same storage account across those virtual machine deployments.</span></span> <span data-ttu-id="b9a01-135">Com a conta de armazenamento Olá em um recurso diferente habilita Olá armazenamento conta tooaccept de dados de várias implantações de máquina virtual, tornando fácil tootroubleshoot problemas em Olá várias versões.</span><span class="sxs-lookup"><span data-stu-id="b9a01-135">Having hello storage account in a different resource enables hello storage account tooaccept data from various virtual machine deployments making it easy tootroubleshoot issues across hello various versions.</span></span>

> [!NOTE]
> <span data-ttu-id="b9a01-136">Se você criar um modelo de máquina virtual do windows do Visual Studio pode ser definida a conta de armazenamento padrão de saudação toouse Olá a mesma conta de armazenamento onde o VHD da máquina virtual Olá é carregado.</span><span class="sxs-lookup"><span data-stu-id="b9a01-136">If you create a windows virtual machine template from Visual Studio hello default storage account might be set toouse hello same storage account where hello virtual machine VHD is uploaded.</span></span> <span data-ttu-id="b9a01-137">Isso é a configuração inicial de saudação VM toosimplify.</span><span class="sxs-lookup"><span data-stu-id="b9a01-137">This is toosimplify initial setup of hello VM.</span></span> <span data-ttu-id="b9a01-138">Novamente, você deverá considerar Olá modelo toouse outra conta de armazenamento que pode ser passada como um parâmetro.</span><span class="sxs-lookup"><span data-stu-id="b9a01-138">You should re-factor hello template toouse a different storage account that can be passed in as a parameter.</span></span> 
> 
> 

## <a name="diagnostics-configuration-variables"></a><span data-ttu-id="b9a01-139">Variáveis de configuração de diagnóstico</span><span class="sxs-lookup"><span data-stu-id="b9a01-139">Diagnostics configuration variables</span></span>
<span data-ttu-id="b9a01-140">Olá diagnóstico extensão trecho json a acima define uma *accountid* toosimplify variável obtendo chave de conta de armazenamento Olá para o armazenamento de diagnóstico hello:</span><span class="sxs-lookup"><span data-stu-id="b9a01-140">hello diagnostics extension json snippet above defines an *accountid* variable toosimplify getting hello storage account key for hello diagnostics storage:</span></span>   

    "accountid": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/',parameters('existingdiagnosticsStorageResourceGroup'), '/providers/','Microsoft.Storage/storageAccounts/', parameters('existingdiagnosticsStorageAccountName'))]"


<span data-ttu-id="b9a01-141">Olá *xmlcfg* propriedade de extensão de diagnóstico de saudação é definida usando diversas variáveis que são concatenados.</span><span class="sxs-lookup"><span data-stu-id="b9a01-141">hello *xmlcfg* property for hello diagnostics extension is defined using multiple variables that are concatenated together.</span></span> <span data-ttu-id="b9a01-142">os valores dessas variáveis Olá estão em xml necessidade toobe escape corretamente ao definir variáveis de json hello.</span><span class="sxs-lookup"><span data-stu-id="b9a01-142">hello values of these variables are in xml so they need toobe escaped correctly when setting hello json variables.</span></span>

<span data-ttu-id="b9a01-143">Olá informações a seguir descrevem Olá xml de configuração de diagnóstico que coleta os contadores de desempenho de nível de sistema padrão juntamente com alguns logs de eventos do windows e logs de infraestrutura de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="b9a01-143">hello following describes hello diagnostics configuration xml that collects standard system level performance counters along with some windows event logs and diagnostics infrastructure logs.</span></span> <span data-ttu-id="b9a01-144">Ele foi escape e formatado corretamente para que hello configuração diretamente colá-los na seção de variáveis de saudação do seu modelo.</span><span class="sxs-lookup"><span data-stu-id="b9a01-144">It has been escaped and formatted correctly so that hello configuration can directly be pasted into hello variables section of your template.</span></span> <span data-ttu-id="b9a01-145">Consulte Olá [esquema de configuração de diagnóstico](https://msdn.microsoft.com/library/azure/dn782207.aspx) para obter um exemplo mais humano legível do xml de configuração de saudação.</span><span class="sxs-lookup"><span data-stu-id="b9a01-145">See hello [Diagnostics Configuration Schema](https://msdn.microsoft.com/library/azure/dn782207.aspx) for a more human readable example of hello configuration xml.</span></span>

        "wadlogs": "<WadCfg> <DiagnosticMonitorConfiguration overallQuotaInMB=\"4096\" xmlns=\"http://schemas.microsoft.com/ServiceHosting/2010/10/DiagnosticsConfiguration\"> <DiagnosticInfrastructureLogs scheduledTransferLogLevelFilter=\"Error\"/> <WindowsEventLog scheduledTransferPeriod=\"PT1M\" > <DataSource name=\"Application!*[System[(Level = 1 or Level = 2)]]\" /> <DataSource name=\"Security!*[System[(Level = 1 or Level = 2)]]\" /> <DataSource name=\"System!*[System[(Level = 1 or Level = 2)]]\" /></WindowsEventLog>",
        "wadperfcounters1": "<PerformanceCounters scheduledTransferPeriod=\"PT1M\"><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% Processor Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU utilization\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% Privileged Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU privileged time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% User Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU user time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor Information(_Total)\\Processor Frequency\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"CPU frequency\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\System\\Processes\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Processes\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Process(_Total)\\Thread Count\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Threads\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Process(_Total)\\Handle Count\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Handles\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\% Committed Bytes In Use\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Memory usage\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Available Bytes\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory available\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Committed Bytes\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory committed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Commit Limit\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory commit limit\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active time\" locale=\"en-us\"/></PerformanceCounterConfiguration>",
        "wadperfcounters2": "<PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Read Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active read time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Write Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active write time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Transfers/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Reads/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk read operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Writes/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk write operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Read Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk read speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Write Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk write speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\LogicalDisk(_Total)\\% Free Space\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk free space (percentage)\" locale=\"en-us\"/></PerformanceCounterConfiguration></PerformanceCounters>",
        "wadcfgxstart": "[concat(variables('wadlogs'), variables('wadperfcounters1'), variables('wadperfcounters2'), '<Metrics resourceId=\"')]",
        "wadmetricsresourceid": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name , '/providers/', 'Microsoft.Compute/virtualMachines/')]",
        "wadcfgxend": "\"><MetricAggregation scheduledTransferPeriod=\"PT1H\"/><MetricAggregation scheduledTransferPeriod=\"PT1M\"/></Metrics></DiagnosticMonitorConfiguration></WadCfg>"

<span data-ttu-id="b9a01-146">Olá métricas definição o nó xml no hello acima de configuração é um elemento de configuração importantes que define como os contadores de desempenho de saudação definida anteriormente Olá xml no *PerformanceCounter* nó será agregado e armazenados.</span><span class="sxs-lookup"><span data-stu-id="b9a01-146">hello Metrics definition xml node in hello above configuration is an important configuration element as it defines how hello performance counters defined earlier in hello xml in *PerformanceCounter* node will be aggregated and stored.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="b9a01-147">Essas métricas unidade Olá monitoramento gráficos e alertas no hello portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="b9a01-147">These metrics drive hello monitoring charts and alerts in hello Azure portal.</span></span>  <span data-ttu-id="b9a01-148">Olá **métricas** nó com hello *resourceID* e **MetricAggregation** devem ser incluídos na configuração de diagnóstico Olá para sua VM se você quiser toosee Olá VM dados de monitoramento no hello portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="b9a01-148">hello **Metrics** node with hello *resourceID* and **MetricAggregation** must be included in hello diagnostics configuration for your VM if you want toosee hello VM monitoring data in hello Azure portal.</span></span> 
> 
> 

<span data-ttu-id="b9a01-149">a seguir Olá é um exemplo de xml Olá definições de métricas:</span><span class="sxs-lookup"><span data-stu-id="b9a01-149">hello following is an example of hello xml for metrics definitions:</span></span> 

        <Metrics resourceId="/subscriptions/subscription().subscriptionId/resourceGroups/resourceGroup().name/providers/Microsoft.Compute/virtualMachines/vmName">
            <MetricAggregation scheduledTransferPeriod="PT1H"/>
            <MetricAggregation scheduledTransferPeriod="PT1M"/>
        </Metrics>

<span data-ttu-id="b9a01-150">Olá *resourceID* atributo identifica exclusivamente a máquina virtual de saudação em sua assinatura.</span><span class="sxs-lookup"><span data-stu-id="b9a01-150">hello *resourceID* attribute uniquely identifies hello virtual machine in your subscription.</span></span> <span data-ttu-id="b9a01-151">Verifique se subscription() de saudação toouse e resourceGroup() funções para que hello modelo atualiza automaticamente esses valores com base no grupo de assinatura e do recurso de saudação que você está implantando.</span><span class="sxs-lookup"><span data-stu-id="b9a01-151">Make sure toouse hello subscription() and resourceGroup() functions so that hello template automatically updates those values based on hello subscription and resource group you are deploying to.</span></span>

<span data-ttu-id="b9a01-152">Se você estiver criando várias máquinas virtuais em um loop, você terá Olá toopopulate *resourceID* valor com um toocorrectly de função copyIndex() diferenciar cada VM individual.</span><span class="sxs-lookup"><span data-stu-id="b9a01-152">If you are creating multiple Virtual Machines in a loop then you will have toopopulate hello *resourceID* value with an copyIndex() function toocorrectly differentiate each individual VM.</span></span> <span data-ttu-id="b9a01-153">Olá *xmlCfg* valor pode ser atualizada toosupport isso da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="b9a01-153">hello *xmlCfg* value can be updated toosupport this as follows:</span></span>  

    "xmlCfg": "[base64(concat(variables('wadcfgxstart'), variables('wadmetricsresourceid'), concat(parameters('vmNamePrefix'), copyindex()), variables('wadcfgxend')))]", 

<span data-ttu-id="b9a01-154">Olá valor MetricAggregation *PT1H* e *PT1M* representar uma agregação em um minuto e uma agregação em uma hora.</span><span class="sxs-lookup"><span data-stu-id="b9a01-154">hello MetricAggregation value of *PT1H* and *PT1M* signify an aggregation over a minute and an aggregation over an hour.</span></span>

## <a name="wadmetrics-tables-in-storage"></a><span data-ttu-id="b9a01-155">Tabelas WADMetrics no armazenamento</span><span class="sxs-lookup"><span data-stu-id="b9a01-155">WADMetrics tables in storage</span></span>
<span data-ttu-id="b9a01-156">configuração de métricas de Olá acima irá gerar tabelas na sua conta de armazenamento de diagnóstico com hello convenções de nomenclatura a seguir:</span><span class="sxs-lookup"><span data-stu-id="b9a01-156">hello Metrics configuration above will generate tables in your diagnostics storage account with hello following naming conventions:</span></span>

* <span data-ttu-id="b9a01-157">**WADMetrics** : prefixo padrão para todas as tabelas WADMetrics</span><span class="sxs-lookup"><span data-stu-id="b9a01-157">**WADMetrics** : Standard prefix for all WADMetrics tables</span></span>
* <span data-ttu-id="b9a01-158">**PT1H** ou **PT1M** : significa que essa tabela Olá contém dados de agregação em 1 hora ou 1 minuto</span><span class="sxs-lookup"><span data-stu-id="b9a01-158">**PT1H** or **PT1M** : Signifies that hello table contains aggregate data over 1 hour or 1 minute</span></span>
* <span data-ttu-id="b9a01-159">**P10D** : significa tabela Olá conterá dados para 10 dias a partir de quando tabela Olá começar a coletar os dados</span><span class="sxs-lookup"><span data-stu-id="b9a01-159">**P10D** : Signifies hello table will contain data for 10 days from when hello table started collecting data</span></span>
* <span data-ttu-id="b9a01-160">**V2S** : constante de cadeia de caracteres</span><span class="sxs-lookup"><span data-stu-id="b9a01-160">**V2S** : String constant</span></span>
* <span data-ttu-id="b9a01-161">**AAAAMMDD** : data de saudação no qual Olá tabela começar a coletar os dados</span><span class="sxs-lookup"><span data-stu-id="b9a01-161">**yyyymmdd** : hello date at which hello table started collecting data</span></span>

<span data-ttu-id="b9a01-162">Exemplo: *WADMetricsPT1HP10DV2S20151108* inclui dados agregados das métricas para o período de uma hora durante 10 dias, com início em 11 de novembro de 2015</span><span class="sxs-lookup"><span data-stu-id="b9a01-162">Example: *WADMetricsPT1HP10DV2S20151108* will contain metrics data aggregated over an hour for 10 days starting on 11-Nov-2015</span></span>    

<span data-ttu-id="b9a01-163">Cada tabela WADMetrics conterá Olá colunas a seguir:</span><span class="sxs-lookup"><span data-stu-id="b9a01-163">Each WADMetrics table will contain hello following columns:</span></span>

* <span data-ttu-id="b9a01-164">**PartitionKey**: partitionkey Olá é construído com base em Olá *resourceID* toouniquely valor identificar Olá de recursos VM.</span><span class="sxs-lookup"><span data-stu-id="b9a01-164">**PartitionKey**: hello partitionkey is constructed based on hello *resourceID* value toouniquely identify hello VM resource.</span></span> <span data-ttu-id="b9a01-165">por exemplo: 002Fsubscriptions:<subscriptionID>:002FresourceGroups:002F<ResourceGroupName>:002Fproviders:002FMicrosoft:002ECompute:002FvirtualMachines:002F<vmName></span><span class="sxs-lookup"><span data-stu-id="b9a01-165">for e.g. : 002Fsubscriptions:<subscriptionID>:002FresourceGroups:002F<ResourceGroupName>:002Fproviders:002FMicrosoft:002ECompute:002FvirtualMachines:002F<vmName></span></span>  
* <span data-ttu-id="b9a01-166">**RowKey** : formato de saudação de maneira <Descending time tick>:<Performance Counter Name>.</span><span class="sxs-lookup"><span data-stu-id="b9a01-166">**RowKey** : Follows hello format <Descending time tick>:<Performance Counter Name>.</span></span> <span data-ttu-id="b9a01-167">Olá decrescente cálculo de escala de tempo é escalas de tempo máximo menos tempo de saudação do início de saudação do período de agregação de saudação.</span><span class="sxs-lookup"><span data-stu-id="b9a01-167">hello descending time tick calculation is max time ticks minus hello time of hello beginning of hello aggregation period.</span></span> <span data-ttu-id="b9a01-168">Por exemplo</span><span class="sxs-lookup"><span data-stu-id="b9a01-168">E.g.</span></span> <span data-ttu-id="b9a01-169">Se o período de exemplo hello iniciado em 10 de novembro de 2015 e cálculo de UTC, em seguida, Olá 00:00Hrs seria: ticks - (DateTime(2015,11,10,0,0,0,DateTimeKind.Utc) novo. Tiques).</span><span class="sxs-lookup"><span data-stu-id="b9a01-169">if hello sample period started on 10-Nov-2015 and 00:00Hrs UTC then hello calculation would be: DateTime.MaxValue.Ticks - (new DateTime(2015,11,10,0,0,0,DateTimeKind.Utc).Ticks).</span></span> <span data-ttu-id="b9a01-170">Para Olá memória bytes disponíveis chave contador de desempenho Olá linha aparecerá como: 2519551871999999999__:005CMemory:005CAvailable:0020 Bytes</span><span class="sxs-lookup"><span data-stu-id="b9a01-170">For hello memory available bytes performance counter hello row key will look like: 2519551871999999999__:005CMemory:005CAvailable:0020Bytes</span></span>
* <span data-ttu-id="b9a01-171">**CounterName** : É nome Olá Olá do contador de desempenho.</span><span class="sxs-lookup"><span data-stu-id="b9a01-171">**CounterName** : Is hello name of hello performance counter.</span></span> <span data-ttu-id="b9a01-172">Isso corresponde a saudação *counterSpecifier* definido na configuração do xml de saudação.</span><span class="sxs-lookup"><span data-stu-id="b9a01-172">This matches hello *counterSpecifier* defined in hello xml config.</span></span>
* <span data-ttu-id="b9a01-173">**Máximo** : Olá valor máximo do contador de desempenho de saudação em período de agregação de saudação.</span><span class="sxs-lookup"><span data-stu-id="b9a01-173">**Maximum** : hello maximum value of hello performance counter over hello aggregation period.</span></span>
* <span data-ttu-id="b9a01-174">**Mínimo** : Olá valor mínimo saudação do contador de desempenho por período de agregação de saudação.</span><span class="sxs-lookup"><span data-stu-id="b9a01-174">**Minimum** : hello minimum value of hello performance counter over hello aggregation period.</span></span>
* <span data-ttu-id="b9a01-175">**Total** : soma de saudação de todos os valores de contador de desempenho Olá informado por período de agregação de saudação.</span><span class="sxs-lookup"><span data-stu-id="b9a01-175">**Total** : hello sum of all values of hello performance counter reported over hello aggregation period.</span></span>
* <span data-ttu-id="b9a01-176">**Contagem de** : número total de saudação de valores relatados para o contador de desempenho hello.</span><span class="sxs-lookup"><span data-stu-id="b9a01-176">**Count** : hello total number of values reported for hello performance counter.</span></span>
* <span data-ttu-id="b9a01-177">**Médio** : Olá valor médio (total/contagem) saudação do contador de desempenho por período de agregação de saudação.</span><span class="sxs-lookup"><span data-stu-id="b9a01-177">**Average** : hello average (total/count) value of hello performance counter over hello aggregation period.</span></span>

## <a name="next-steps"></a><span data-ttu-id="b9a01-178">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="b9a01-178">Next Steps</span></span>
* <span data-ttu-id="b9a01-179">Para obter um modelo de exemplo completo de uma máquina virtual do Windows com extensão de diagnóstico, confira [201-vm-monitoring-diagnostics-extension](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-monitoring-diagnostics-extension)</span><span class="sxs-lookup"><span data-stu-id="b9a01-179">For a complete sample template of a Windows virtual machine with diagnostics extension see [201-vm-monitoring-diagnostics-extension](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-monitoring-diagnostics-extension)</span></span>   
* <span data-ttu-id="b9a01-180">Implantar o modelo de Gerenciador de recursos de saudação usando [Azure PowerShell](ps-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) ou [linha de comando do Azure](../linux/create-ssh-secured-vm-from-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span><span class="sxs-lookup"><span data-stu-id="b9a01-180">Deploy hello resource manager template using [Azure PowerShell](ps-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) or [Azure Command Line](../linux/create-ssh-secured-vm-from-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span></span>
* <span data-ttu-id="b9a01-181">Saiba mais sobre a [Criação de modelos do Gerenciador de Recursos do Azure](../../resource-group-authoring-templates.md)</span><span class="sxs-lookup"><span data-stu-id="b9a01-181">Learn more about [authoring Azure Resource Manager templates](../../resource-group-authoring-templates.md)</span></span>

