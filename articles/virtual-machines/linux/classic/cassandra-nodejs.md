---
title: Executar Cassandra com Linux no Azure | Microsoft Docs
description: "Como executar um cluster Cassandra no Linux em máquinas virtuais do Azure de um aplicativo Node.js"
services: virtual-machines-linux
documentationcenter: nodejs
author: tomarcher
manager: routlaw
editor: 
tags: azure-service-management
ms.assetid: 30de1f29-e97d-492f-ae34-41ec83488de0
ms.service: virtual-machines-linux
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-linux
ms.devlang: na
ms.topic: article
ms.date: 08/17/2017
ms.author: tarcher
ms.openlocfilehash: 1ff3d77ced6c9d90029b251490c05e52d9b43515
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/29/2017
---
# <a name="running-cassandra-with-linux-on-azure-and-accessing-it-from-nodejs"></a><span data-ttu-id="6d259-103">Executando Cassandra com Linux no Azure e acessando-a do Node.js</span><span class="sxs-lookup"><span data-stu-id="6d259-103">Running Cassandra with Linux on Azure and Accessing it from Node.js</span></span>
> [!IMPORTANT] 
> <span data-ttu-id="6d259-104">O Azure tem dois modelos de implantação diferentes para criar e trabalhar com recursos: [Gerenciador de Recursos e Clássico](../../../resource-manager-deployment-model.md).</span><span class="sxs-lookup"><span data-stu-id="6d259-104">Azure has two different deployment models for creating and working with resources: [Resource Manager and Classic](../../../resource-manager-deployment-model.md).</span></span> <span data-ttu-id="6d259-105">Este artigo aborda o uso do modelo de implantação Clássica.</span><span class="sxs-lookup"><span data-stu-id="6d259-105">This article covers using the Classic deployment model.</span></span> <span data-ttu-id="6d259-106">A Microsoft recomenda que a maioria das implantações novas use o modelo do Gerenciador de Recursos.</span><span class="sxs-lookup"><span data-stu-id="6d259-106">Microsoft recommends that most new deployments use the Resource Manager model.</span></span> <span data-ttu-id="6d259-107">Consulte modelos do Resource Manager para [Datastax Enterprise](https://azure.microsoft.com/documentation/templates/datastax) e [Cluster Spark e Cassandra CentOS](https://azure.microsoft.com/documentation/templates/spark-and-cassandra-on-centos/).</span><span class="sxs-lookup"><span data-stu-id="6d259-107">See Resource Manager templates for [Datastax Enterprise](https://azure.microsoft.com/documentation/templates/datastax) and [Spark cluster and Cassandra on CentOS](https://azure.microsoft.com/documentation/templates/spark-and-cassandra-on-centos/).</span></span>

## <a name="overview"></a><span data-ttu-id="6d259-108">Visão geral</span><span class="sxs-lookup"><span data-stu-id="6d259-108">Overview</span></span>
<span data-ttu-id="6d259-109">O Microsoft Azure é uma plataforma de nuvem aberta que executa tanto os softwares da Microsoft quanto os não pertencentes à Microsoft, que inclui sistemas operacionais, servidores de aplicativos, middlewares de mensagens, bem como bancos de dados SQL e NoSQL de ambos os modelos de software livre e comercial.</span><span class="sxs-lookup"><span data-stu-id="6d259-109">Microsoft Azure is an open cloud platform that runs both Microsoft as well as non-Microsoft software which  includes operating systems, application servers, messaging middleware as well as SQL and NoSQL databases from both commercial and open source models.</span></span> <span data-ttu-id="6d259-110">A criação de serviços resilientes em nuvens públicas, incluindo o Azure, requer um planejamento cuidadoso e uma arquitetura deliberada para ambos os servidores de aplicativos, bem como camadas de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="6d259-110">Building resilient services on public clouds including Azure requires careful planning and deliberate architecture for both applications servers as well storage layers.</span></span> <span data-ttu-id="6d259-111">A arquitetura de armazenamento distribuída de Cassandra naturalmente ajuda na criação de sistemas altamente disponíveis que são tolerantes a falhas para as falhas de cluster.</span><span class="sxs-lookup"><span data-stu-id="6d259-111">Cassandra’s distributed storage architecture naturally helps in building highly available systems that are fault tolerant for cluster failures.</span></span> <span data-ttu-id="6d259-112">Cassandra é um banco de dados NoSQL de escala na nuvem mantido pela Apache Software Foundation em cassandra.apache.org; Cassandra é escrito em Java e, portanto, pode ser executado em ambas as plataformas Windows e Linux.</span><span class="sxs-lookup"><span data-stu-id="6d259-112">Cassandra is a cloud scale NoSQL database maintained by Apache Software Foundation at cassandra.apache.org; Cassandra is written in Java and hence runs on both on Windows as well as Linux platforms.</span></span>

<span data-ttu-id="6d259-113">O foco deste artigo é mostrar a implantação de Cassandra no Ubuntu como um cluster de centro de único ou de vários dados utilizando Máquinas Virtuais e Redes Virtuais do Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="6d259-113">The focus of this article is to show Cassandra deployment on Ubuntu as a single and multi-data center cluster leveraging Microsoft Azure Virtual Machines and Virtual Networks.</span></span> <span data-ttu-id="6d259-114">A implantação do cluster para cargas de trabalho de produção otimizada está fora do escopo deste artigo porque requer configuração de nó em vários discos, design apropriado de topologia em anel e modelagem de dados para dar suporte à replicação necessária, consistência, taxa de transferência e requisitos de alta disponibilidade de dados.</span><span class="sxs-lookup"><span data-stu-id="6d259-114">The cluster deployment for production optimized workloads is out of scope of this article as it requires multi-disk node configuration, appropriate ring topology design and data modeling to support the needed replication, data consistency, throughput and high availability requirements.</span></span>

<span data-ttu-id="6d259-115">Este artigo adota uma abordagem fundamental para mostrar o que está envolvido na criação do cluster de Cassandra em comparação com Docker, Chef ou Puppet, os quais podem tornar a implantação da infraestrutura muito mais fácil.</span><span class="sxs-lookup"><span data-stu-id="6d259-115">This article takes a fundamental approach to show what is involved in building the Cassandra cluster compared Docker, Chef or Puppet which can make the infrastructure deployment a lot easier.</span></span>  

## <a name="the-deployment-models"></a><span data-ttu-id="6d259-116">Os modelos de implantação</span><span class="sxs-lookup"><span data-stu-id="6d259-116">The Deployment Models</span></span>
<span data-ttu-id="6d259-117">A rede do Microsoft Azure permite a implantação de clusters particulares isolados, cujo acesso pode ser restrito para se atingir uma segurança de rede refinada.</span><span class="sxs-lookup"><span data-stu-id="6d259-117">Microsoft Azure networking allows the deployment of isolated private clusters, the access of which can be restricted to attain fine grained network security.</span></span>  <span data-ttu-id="6d259-118">Como este artigo é sobre a implantação de Cassandra num nível fundamental, não nos concentraremos no nível de consistência e no design de armazenamento ideal para a taxa de transferência.</span><span class="sxs-lookup"><span data-stu-id="6d259-118">Since this article is about showing the Cassandra deployment at a fundamental level, we will not focus on the consistency level and the optimal storage design for throughput.</span></span> <span data-ttu-id="6d259-119">Aqui está a lista de requisitos de rede para o nosso cluster hipotético:</span><span class="sxs-lookup"><span data-stu-id="6d259-119">Here is the list of networking requirements for our hypothetical cluster:</span></span>

* <span data-ttu-id="6d259-120">Os sistemas externos não podem acessar o banco de dados de Cassandra desde dentro ou fora do Azure</span><span class="sxs-lookup"><span data-stu-id="6d259-120">External systems can’t access Cassandra database from within or outside Azure</span></span>
* <span data-ttu-id="6d259-121">O cluster de Cassandra precisa estar atrás de um balanceador de carga de tráfego de poupança</span><span class="sxs-lookup"><span data-stu-id="6d259-121">Cassandra cluster has to be behind a load balancer for thrift traffic</span></span>
* <span data-ttu-id="6d259-122">Implantar nós de Cassandra em dois grupos em cada data center para uma disponibilidade de cluster aprimorada</span><span class="sxs-lookup"><span data-stu-id="6d259-122">Deploy Cassandra nodes in two groups in each data center for an enhanced cluster availability</span></span>
* <span data-ttu-id="6d259-123">Bloquear o cluster até que apenas o farm de servidores de aplicativos tenha acesso ao banco de dados diretamente</span><span class="sxs-lookup"><span data-stu-id="6d259-123">Lock down the cluster so that only application server farm has access to the database directly</span></span>
* <span data-ttu-id="6d259-124">Nenhum ponto de extremidade de rede pública diferente de SSH</span><span class="sxs-lookup"><span data-stu-id="6d259-124">No public networking endpoints other than SSH</span></span>
* <span data-ttu-id="6d259-125">Cada nó de Cassandra precisa de um endereço IP interno fixo</span><span class="sxs-lookup"><span data-stu-id="6d259-125">Each Cassandra node needs a fixed internal IP address</span></span>

<span data-ttu-id="6d259-126">Cassandra pode ser implantado em uma única região do Azure ou em várias regiões, de acordo com a natureza distribuída da carga de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6d259-126">Cassandra can be deployed to a single Azure region or to multiple regions based on the distributed nature of the workload.</span></span> <span data-ttu-id="6d259-127">O modelo de implantação de várias regiões pode ser utilizado para atender os usuários finais mais próximos de uma determinada região geográfica por meio da mesma infraestrutura de Cassandra.</span><span class="sxs-lookup"><span data-stu-id="6d259-127">Multi-region deployment model can be leveraged to serve end users closer to a particular geography through the same Cassandra infrastructure.</span></span> <span data-ttu-id="6d259-128">A replicação do nó interno de Cassandra cuida da sincronização de gravações de vários mestres provenientes de vários data centers e apresenta uma exibição consistente dos dados para os aplicativos.</span><span class="sxs-lookup"><span data-stu-id="6d259-128">Cassandra’s built-in node replication takes care of the synchronization of multi-master writes originating from multiple data centers and presents a consistent view of the data to applications.</span></span> <span data-ttu-id="6d259-129">A implantação de várias regiões também pode ajudar na redução de risco de falhas mais amplas de serviço do Azure.</span><span class="sxs-lookup"><span data-stu-id="6d259-129">Multi-region deployment can also help with the risk mitigation of the broader Azure service outages.</span></span> <span data-ttu-id="6d259-130">A consistência ajustável e a replicação de topologia de Cassandra ajudará a atender às diversas necessidades de RPO dos aplicativos.</span><span class="sxs-lookup"><span data-stu-id="6d259-130">Cassandra’s tunable consistency and replication topology will help in meeting diverse RPO needs of applications.</span></span>

### <a name="single-region-deployment"></a><span data-ttu-id="6d259-131">Implantação de região única</span><span class="sxs-lookup"><span data-stu-id="6d259-131">Single Region Deployment</span></span>
<span data-ttu-id="6d259-132">Começaremos com uma implantação de região única e utilizaremos os aprendizados obtidos na criação de um modelo de várias regiões.</span><span class="sxs-lookup"><span data-stu-id="6d259-132">We will start with a single region deployment and harvest the learnings in creating a multi-region model.</span></span> <span data-ttu-id="6d259-133">A rede virtual do Azure será usada para criar sub-redes isoladas para que os requisitos de segurança da rede mencionados acima possam ser atendidos.</span><span class="sxs-lookup"><span data-stu-id="6d259-133">Azure virtual networking will be used to create isolated subnets so that the network security requirements mentioned above can be met.</span></span>  <span data-ttu-id="6d259-134">O processo descrito na criação da implantação de região única utiliza o Ubuntu 14.04 LTS e Cassandra 2.08; no entanto, o processo pode facilmente ser adotado para as outras variantes do Linux.</span><span class="sxs-lookup"><span data-stu-id="6d259-134">The process described in creating the single region deployment uses Ubuntu 14.04 LTS and Cassandra 2.08; however, the process can easily be adopted to the other Linux variants.</span></span> <span data-ttu-id="6d259-135">A seguir estão algumas das características sistemáticas da implantação de região única.</span><span class="sxs-lookup"><span data-stu-id="6d259-135">The following are some of the systemic characteristics of the single region deployment.</span></span>  

<span data-ttu-id="6d259-136">**Alta disponibilidade:** os nós Cassandra mostrados na Figura 1 são implantados em dois conjuntos de disponibilidade para que sejam distribuídos entre vários domínios com falha para alta disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="6d259-136">**High Availability:** The Cassandra nodes shown in the Figure 1 are deployed to two availability sets so that the nodes are spread between multiple fault domains for high availability.</span></span> <span data-ttu-id="6d259-137">As VMs anotadas com cada conjunto de disponibilidade são mapeadas para 2 domínios de falha.</span><span class="sxs-lookup"><span data-stu-id="6d259-137">VMs annotated with each availability set is mapped to 2 fault domains.</span></span>  <span data-ttu-id="6d259-138">O Microsoft Azure usa o conceito de domínio com falha para gerenciar tempo de inatividade não planejado (por exemplo, falhas de hardware ou software), enquanto o conceito de domínio de atualização (por exemplo correção/atualizações de host ou SO de convidado, atualizações de aplicativo) é usado para gerenciar tempo de inatividade agendado.</span><span class="sxs-lookup"><span data-stu-id="6d259-138">Microsoft Azure uses the concept of fault domain to manage unplanned down time (e.g. hardware or software failures) while the concept of upgrade domain (e.g. host or guest OS patching/upgrades, application upgrades) is used for managing scheduled down time.</span></span> <span data-ttu-id="6d259-139">Consulte [Recuperação de desastre e alta disponibilidade para aplicativos Azure](http://msdn.microsoft.com/library/dn251004.aspx) para a função de domínios com falha e de atualização na obtenção de alta disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="6d259-139">Please see [Disaster Recovery and High Availability for Azure Applications](http://msdn.microsoft.com/library/dn251004.aspx) for the role of fault and upgrade domains in attaining high availability.</span></span>

![Implantação de região única](./media/cassandra-nodejs/cassandra-linux1.png)

<span data-ttu-id="6d259-141">Figura 1: implantação de região única</span><span class="sxs-lookup"><span data-stu-id="6d259-141">Figure 1: Single region deployment</span></span>

<span data-ttu-id="6d259-142">Observe que, no momento da redação deste artigo, o Azure não permite o mapeamento explícito de um grupo de VMs em um domínio de falha específico; consequentemente, mesmo com o modelo de implantação mostrado na Figura 1, é estatisticamente provável que todas as máquinas virtuais possam ser mapeadas para dois domínios de falha em vez de quatro.</span><span class="sxs-lookup"><span data-stu-id="6d259-142">Note that at the time of this writing, Azure doesn’t allow the explicit mapping of a group of VMs to a specific fault domain; consequently, even with the deployment model shown in Figure 1, it is statistically probable that all the virtual machines may be mapped to two fault domains instead of four.</span></span>

<span data-ttu-id="6d259-143">**Tráfego Thrift de Balanceamento de Carga:** as bibliotecas de cliente Thrift dentro do servidor Web se conectam ao cluster por meio de um balanceador de carga interno.</span><span class="sxs-lookup"><span data-stu-id="6d259-143">**Load Balancing Thrift Traffic:** Thrift client libraries inside the web server connect to the cluster through an internal load balancer.</span></span> <span data-ttu-id="6d259-144">Isso exige o processo de adicionar o balanceador de carga interno à sub-rede "data" (confira a Figura 1) no contexto do serviço de nuvem que hospeda o cluster Cassandra.</span><span class="sxs-lookup"><span data-stu-id="6d259-144">This requires the process of adding the internal load balancer to the “data” subnet (refer Figure 1) in the context of the cloud service hosting the Cassandra cluster.</span></span> <span data-ttu-id="6d259-145">Depois que o balanceador de carga interno for definido, cada nó requer o ponto de extremidade com balanceamento de carga a ser adicionado com as anotações de um conjunto de balanceamento de carga com o nome do balanceador de carga definido anteriormente.</span><span class="sxs-lookup"><span data-stu-id="6d259-145">Once the internal load balancer is defined, each node requires the load balanced endpoint to be added with the annotations of a load balanced set with previously defined load balancer name.</span></span> <span data-ttu-id="6d259-146">Confira [Balanceamento de carga interno do Azure ](../../../load-balancer/load-balancer-internal-overview.md)para obter mais detalhes.</span><span class="sxs-lookup"><span data-stu-id="6d259-146">See [Azure Internal Load Balancing ](../../../load-balancer/load-balancer-internal-overview.md)for more details.</span></span>

<span data-ttu-id="6d259-147">**Sementes de cluster:** é importante selecionar os nós que estejam altamente disponíveis para sementes, pois os nós mais novos vão se comunicar com os nós de propagação para descobrir a topologia do cluster.</span><span class="sxs-lookup"><span data-stu-id="6d259-147">**Cluster Seeds:** It is important to select the most highly available nodes for seeds as the new nodes will communicate with seed nodes to discover the topology of the cluster.</span></span> <span data-ttu-id="6d259-148">Um nó de cada conjunto de disponibilidade será designado como nó de propagação para evitar pontos únicos de falha.</span><span class="sxs-lookup"><span data-stu-id="6d259-148">One node from each availability set is designated as seed nodes to avoid single point of failure.</span></span>

<span data-ttu-id="6d259-149">**Fator de replicação e nível de consistência:** a alta disponibilidade interna do Cassandra e a durabilidade dos dados são caracterizadas pelo Fator de Replicação (RF - número de cópias de cada linha armazenada no cluster) e pelo Nível de Consistência (número de réplicas a serem lidas/gravadas antes de retornar o resultado ao chamador).</span><span class="sxs-lookup"><span data-stu-id="6d259-149">**Replication Factor and Consistency Level:** Cassandra’s build-in high-availability and data durability is characterized by the Replication Factor (RF - number of copies of each row stored on the cluster) and Consistency Level (number of replicas to be read/written before returning the result to the caller).</span></span> <span data-ttu-id="6d259-150">O fator de replicação é especificado durante a criação de KEYSPACE (semelhante a um banco de dados relacional), enquanto o nível de consistência é especificado durante a emissão da consulta CRUD.</span><span class="sxs-lookup"><span data-stu-id="6d259-150">Replication factor is specified during the KEYSPACE (similar to a relational database) creation whereas the consistency level is specified while issuing the CRUD query.</span></span> <span data-ttu-id="6d259-151">Confira a documentação do Cassandra em [Configurando para consistência](http://www.datastax.com/documentation/cassandra/2.0/cassandra/dml/dml_config_consistency_c.html) para obter detalhes de consistência e a fórmula para o cálculo de quorum.</span><span class="sxs-lookup"><span data-stu-id="6d259-151">See Cassandra documentation at [Configuring for Consistency](http://www.datastax.com/documentation/cassandra/2.0/cassandra/dml/dml_config_consistency_c.html) for consistency details and the formula for quorum computation.</span></span>

<span data-ttu-id="6d259-152">Cassandra dá suporte a dois tipos de modelos de integridade de dados – Consistência e Consistência Eventual; o Fator de Replicação e o Nível de Consistência juntos determinarão se os dados serão consistentes logo que uma operação de gravação for concluída ou se estarão eventualmente consistentes.</span><span class="sxs-lookup"><span data-stu-id="6d259-152">Cassandra supports two types of data integrity models – Consistency and Eventual Consistency; the Replication Factor and Consistency Level will together determine if the data will be consistent as soon as a write operation is complete or it will be eventually consistent.</span></span> <span data-ttu-id="6d259-153">Por exemplo, a especificação de QUORUM como o Nível de Consistência garantirá sempre a Consistência de dados durante qualquer nível de consistência, abaixo do número de réplicas a ser gravado conforme necessário para alcançar o QUORUM (por exemplo, UM) resulta em dados sendo eventualmente consistentes.</span><span class="sxs-lookup"><span data-stu-id="6d259-153">For example, specifying QUORUM as the Consistency Level will always ensures data Consistency while any consistency level, below the number of replicas to be written as needed to attain QUORUM (e.g. ONE) results in data being eventually consistent.</span></span>

<span data-ttu-id="6d259-154">O cluster de 8 nós mostrado acima, com um fator de replicação de 3 e nível de consistência de leitura/gravação de QUORUM (2 nós são lidos ou gravados para consistência), poderá sobreviver à perda teórica de no máximo 1 nó por grupo de replicação antes de que o aplicativo perceba a falha.</span><span class="sxs-lookup"><span data-stu-id="6d259-154">The 8-node cluster shown above, with a replication factor of 3 and QUORUM (2 nodes are read or written for consistency) read/write consistency level, can survive the theoretical loss of at the most 1 node per replication group before the application start noticing the failure.</span></span> <span data-ttu-id="6d259-155">Isso pressupõe que todos os key spaces também têm solicitações de balanceamento de leitura/gravação.</span><span class="sxs-lookup"><span data-stu-id="6d259-155">This assumes that all the key spaces have well balanced read/write requests.</span></span>  <span data-ttu-id="6d259-156">A seguir estão os parâmetros que usaremos para o cluster implantado:</span><span class="sxs-lookup"><span data-stu-id="6d259-156">The following are the parameters we will use for the deployed cluster:</span></span>

<span data-ttu-id="6d259-157">Configuração de cluster de Cassandra de região única:</span><span class="sxs-lookup"><span data-stu-id="6d259-157">Single region Cassandra cluster configuration:</span></span>

| <span data-ttu-id="6d259-158">Parâmetros de cluster</span><span class="sxs-lookup"><span data-stu-id="6d259-158">Cluster Parameter</span></span> | <span data-ttu-id="6d259-159">Valor</span><span class="sxs-lookup"><span data-stu-id="6d259-159">Value</span></span> | <span data-ttu-id="6d259-160">Comentários</span><span class="sxs-lookup"><span data-stu-id="6d259-160">Remarks</span></span> |
| --- | --- | --- |
| <span data-ttu-id="6d259-161">Número de nós (N)</span><span class="sxs-lookup"><span data-stu-id="6d259-161">Number of Nodes (N)</span></span> |<span data-ttu-id="6d259-162">8</span><span class="sxs-lookup"><span data-stu-id="6d259-162">8</span></span> |<span data-ttu-id="6d259-163">Número total de nós do cluster</span><span class="sxs-lookup"><span data-stu-id="6d259-163">Total number of nodes in the cluster</span></span> |
| <span data-ttu-id="6d259-164">Fator de replicação (RF)</span><span class="sxs-lookup"><span data-stu-id="6d259-164">Replication Factor (RF)</span></span> |<span data-ttu-id="6d259-165">3</span><span class="sxs-lookup"><span data-stu-id="6d259-165">3</span></span> |<span data-ttu-id="6d259-166">Número de réplicas de uma determinada linha</span><span class="sxs-lookup"><span data-stu-id="6d259-166">Number of replicas of a given row</span></span> |
| <span data-ttu-id="6d259-167">Nível de consistência (gravação)</span><span class="sxs-lookup"><span data-stu-id="6d259-167">Consistency Level (Write)</span></span> |<span data-ttu-id="6d259-168">QUORUM [(RF/2) +1= 2] O resultado da fórmula é arredondado para baixo</span><span class="sxs-lookup"><span data-stu-id="6d259-168">QUORUM[(RF/2) +1) = 2] The result of the formula is rounded down</span></span> |<span data-ttu-id="6d259-169">Grava no máximo 2 réplicas antes que a resposta seja enviada ao chamador; a 3ª réplica é gravada como eventualmente consistente.</span><span class="sxs-lookup"><span data-stu-id="6d259-169">Writes at the most 2 replicas before the response is sent to the caller; 3rd replica is written in an eventually consistent manner.</span></span> |
| <span data-ttu-id="6d259-170">Nível de consistência (leitura)</span><span class="sxs-lookup"><span data-stu-id="6d259-170">Consistency Level (Read)</span></span> |<span data-ttu-id="6d259-171">QUORUM [(RF/2) +1 = 2] O resultado da fórmula é arredondado para baixo</span><span class="sxs-lookup"><span data-stu-id="6d259-171">QUORUM [(RF/2) +1= 2] The result of the formula is rounded down</span></span> |<span data-ttu-id="6d259-172">Grava 2 réplicas antes de enviar a resposta ao chamador.</span><span class="sxs-lookup"><span data-stu-id="6d259-172">Reads 2 replicas before sending response to the caller.</span></span> |
| <span data-ttu-id="6d259-173">Estratégia de replicação</span><span class="sxs-lookup"><span data-stu-id="6d259-173">Replication Strategy</span></span> |<span data-ttu-id="6d259-174">NetworkTopologyStrategy consulte [Replicação de dados](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureDataDistributeReplication_c.html) na documentação de Cassandra para obter mais informações</span><span class="sxs-lookup"><span data-stu-id="6d259-174">NetworkTopologyStrategy see [Data Replication](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureDataDistributeReplication_c.html) in Cassandra documentation for more information</span></span> |<span data-ttu-id="6d259-175">Entende a topologia de implantação e coloca as réplicas em nós para que todas as réplicas não terminem no mesmo rack</span><span class="sxs-lookup"><span data-stu-id="6d259-175">Understands the deployment topology and places replicas on nodes so that all the replicas don’t end up on the same rack</span></span> |
| <span data-ttu-id="6d259-176">Informante</span><span class="sxs-lookup"><span data-stu-id="6d259-176">Snitch</span></span> |<span data-ttu-id="6d259-177">GossipingPropertyFileSnitch consulte [Informantes](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureSnitchesAbout_c.html) na documentação de Cassandra para obter mais informações</span><span class="sxs-lookup"><span data-stu-id="6d259-177">GossipingPropertyFileSnitch see [Snitches](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureSnitchesAbout_c.html) in Cassandra documentation for more information</span></span> |<span data-ttu-id="6d259-178">NetworkTopologyStrategy usa um conceito de informante para compreender a topologia.</span><span class="sxs-lookup"><span data-stu-id="6d259-178">NetworkTopologyStrategy uses a concept of snitch to understand the topology.</span></span> <span data-ttu-id="6d259-179">GossipingPropertyFileSnitch oferece maior controle ao mapear cada nó para rack e data center.</span><span class="sxs-lookup"><span data-stu-id="6d259-179">GossipingPropertyFileSnitch gives better control in mapping each node to data center and rack.</span></span> <span data-ttu-id="6d259-180">O cluster faz uso de fofocas para propagar essas informações.</span><span class="sxs-lookup"><span data-stu-id="6d259-180">The cluster then uses gossip to propagate this information.</span></span> <span data-ttu-id="6d259-181">Isso é muito mais simples na configuração de IP dinâmico em relação a PropertyFileSnitch</span><span class="sxs-lookup"><span data-stu-id="6d259-181">This is much simpler in dynamic IP setting relative to PropertyFileSnitch</span></span> |

<span data-ttu-id="6d259-182">**Considerações do azure para o cluster do Cassandra:** o recurso de máquinas virtuais do Microsoft Azure usa o armazenamento de Blob do Azure para persistência de disco; o Armazenamento do Azure salva 3 réplicas de cada disco para alta durabilidade.</span><span class="sxs-lookup"><span data-stu-id="6d259-182">**Azure Considerations for Cassandra Cluster:** Microsoft Azure Virtual Machines capability uses Azure Blob storage for disk persistence; Azure Storage saves 3 replicas of each disk for high durability.</span></span> <span data-ttu-id="6d259-183">Isso significa que cada linha de dados inseridos em uma tabela do Cassandra já está armazenada em 3 réplicas e, portanto, a consistência dos dados já estará resolvida, mesmo se o fator de replicação (RF) for 1.</span><span class="sxs-lookup"><span data-stu-id="6d259-183">That means each row of data inserted into a Cassandra table is already stored in 3 replicas and hence data consistency is already taken care of even if the Replication Factor (RF) is 1.</span></span> <span data-ttu-id="6d259-184">O principal problema com o Fator de Replicação ser 1 é que o aplicativo terá um tempo de inatividade, mesmo se um único nó do Cassandra falhar.</span><span class="sxs-lookup"><span data-stu-id="6d259-184">The main problem with Replication Factor being 1 is that the application will experience downtime even if a single Cassandra node fails.</span></span> <span data-ttu-id="6d259-185">No entanto, se um nó estiver inativo para os problemas (por exemplo, falhas de hardware, software do sistema) reconhecidos pelo Controlador de Malha do Azure, ele provisionará um novo nó em seu lugar usando as mesmas unidades de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="6d259-185">However, if a node is down for the problems (e.g. hardware, system software failures) recognized by Azure Fabric Controller, it will provision a new node in its place using the same storage drives.</span></span> <span data-ttu-id="6d259-186">O provisionamento de um novo nó para substituir o antigo pode levar alguns minutos.</span><span class="sxs-lookup"><span data-stu-id="6d259-186">Provisioning a new node to replace the old one may take a few minutes.</span></span>  <span data-ttu-id="6d259-187">Da mesma forma, para atividades de manutenção planejada como alterações do sistema operacional convidado, atualizações do Cassandra e alterações de aplicativo, o Controlador de Malha do Azure executa atualizações sem interrupções de nós no cluster.</span><span class="sxs-lookup"><span data-stu-id="6d259-187">Similarly for planned maintenance activities like guest OS changes, Cassandra upgrades and application changes Azure Fabric Controller performs rolling upgrades of the nodes in the cluster.</span></span>  <span data-ttu-id="6d259-188">Atualizações sem interrupção também podem desativar alguns nós por vez; portanto, o cluster pode apresentar um breve tempo de inatividade para algumas partições.</span><span class="sxs-lookup"><span data-stu-id="6d259-188">Rolling upgrades also may take down a few nodes at a time and hence the cluster may experience brief downtime for a few partitions.</span></span> <span data-ttu-id="6d259-189">No entanto, os dados não serão perdidos devido à redundância interna do Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="6d259-189">However, the data will not be lost due to the built-in Azure Storage redundancy.</span></span>  

<span data-ttu-id="6d259-190">Para sistemas implantados no Azure que não exijam alta disponibilidade (por exemplo, cerca 99,9 que equivale a 8,76 h/ano; confira [Alta disponibilidade](http://en.wikipedia.org/wiki/High_availability) para obter mais detalhes), você poderá executar com RF = 1 e Nível de Consistência = UM.</span><span class="sxs-lookup"><span data-stu-id="6d259-190">For systems deployed to Azure that doesn’t require high availability (e.g. around 99.9 which is equivalent to 8.76 hrs/year; see [High Availability](http://en.wikipedia.org/wiki/High_availability) for details) you may be able to run with RF=1 and Consistency Level=ONE.</span></span>  <span data-ttu-id="6d259-191">Para aplicativos com requisitos de alta disponibilidade, RF = 3 e Nível de Consistência = QUORUM tolerarão o tempo de inatividade de um dos nós de uma das réplicas.</span><span class="sxs-lookup"><span data-stu-id="6d259-191">For applications with high availability requirements, RF=3 and Consistency Level=QUORUM will tolerate the down time of one of the nodes one of the replicas.</span></span> <span data-ttu-id="6d259-192">RF=1 em implantações tradicionais (por exemplo, locais) não pode ser usado devido à possível perda de dados resultante de problemas, como falhas no disco.</span><span class="sxs-lookup"><span data-stu-id="6d259-192">RF=1 in traditional deployments (e.g. on-premises) can’t be used due to the possible data loss resulting from problems like disk failures.</span></span>   

## <a name="multi-region-deployment"></a><span data-ttu-id="6d259-193">Implantação em várias regiões</span><span class="sxs-lookup"><span data-stu-id="6d259-193">Multi-region Deployment</span></span>
<span data-ttu-id="6d259-194">A replicação de reconhecimento e o modelo de consistência de data center de Cassandra, descritos acima, ajudam com a implantação de várias regiões fora da caixa sem a necessidade de qualquer ferramenta externa.</span><span class="sxs-lookup"><span data-stu-id="6d259-194">Cassandra’s data-center-aware replication and consistency model described above helps with the multi-region deployment out of the box without the need for any external tooling.</span></span> <span data-ttu-id="6d259-195">Isto é bem diferente dos bancos de dados relacionais tradicionais em que a configuração de espelhamento de banco de dados para gravações de vários mestres pode ser bastante complexa.</span><span class="sxs-lookup"><span data-stu-id="6d259-195">This is quite different from the traditional relational databases where the setup for database mirroring for multi-master writes can be quite complex.</span></span> <span data-ttu-id="6d259-196">Cassandra em uma configuração de várias regiões pode ajudar com os cenários de uso, incluindo os seguintes:</span><span class="sxs-lookup"><span data-stu-id="6d259-196">Cassandra in a multi-region set up can help with the usage scenarios including the following:</span></span>

<span data-ttu-id="6d259-197">**Implantação com base em proximidade:** aplicativos multilocatário, com mapeamento claro de usuários locatários para região, podem ser beneficiados pelas baixas latências do cluster de várias regiões.</span><span class="sxs-lookup"><span data-stu-id="6d259-197">**Proximity based deployment:** Multi-tenant applications, with clear mapping of tenant users -to-region, can be benefited by the multi-region cluster’s low latencies.</span></span> <span data-ttu-id="6d259-198">Por exemplo, sistemas de gerenciamento de aprendizado para instituições de ensino podem implantar um cluster distribuído nas regiões leste e oeste dos EUA para atender aos respectivos campus para transacional, bem como análise.</span><span class="sxs-lookup"><span data-stu-id="6d259-198">For example a learning management systems for educational institutions can deploy a distributed cluster in East US and West US regions to serve the respective campuses for transactional as well as analytics.</span></span> <span data-ttu-id="6d259-199">Os dados podem ser localmente consistentes no momento das leituras e gravações e podem ser eventualmente consistentes em ambas as regiões da.</span><span class="sxs-lookup"><span data-stu-id="6d259-199">The data can be locally consistent at the time reads and writes and can be eventually consistent across both the regions.</span></span> <span data-ttu-id="6d259-200">Existem outros exemplos, como distribuição de mídia, comércio eletrônico e qualquer coisa que sirva à base de usuários concentrada geograficamente é um bom caso de uso esse modelo de implantação.</span><span class="sxs-lookup"><span data-stu-id="6d259-200">There are other examples like media distribution, e-commerce and anything and everything that serves geo concentrated user base is a good use case for this deployment model.</span></span>

<span data-ttu-id="6d259-201">**Alta disponibilidade:** a redundância é um fator importante na obtenção de alta disponibilidade de software e hardware; confira Criando sistemas de nuvem confiáveis no Microsoft Azure para obter detalhes.</span><span class="sxs-lookup"><span data-stu-id="6d259-201">**High Availability:** Redundancy is a key factor in attaining high availability of software and hardware; see Building Reliable Cloud Systems on Microsoft Azure for details.</span></span> <span data-ttu-id="6d259-202">No Microsoft Azure, o único modo confiável de conseguir redundância real é implantando um cluster de várias regiões.</span><span class="sxs-lookup"><span data-stu-id="6d259-202">On Microsoft Azure, the only reliable way of achieving true redundancy is by deploying a multi-region cluster.</span></span> <span data-ttu-id="6d259-203">Os aplicativos podem ser implantados em um modo ativo-ativo ou ativo-passivo e se uma das regiões estiver inativa, o Gerenciador de Tráfego do Azure pode redirecionar o tráfego para a região ativa.</span><span class="sxs-lookup"><span data-stu-id="6d259-203">Applications can be deployed in an active-active or active-passive mode and if one of the regions is down, Azure Traffic Manager can redirect traffic to the active region.</span></span>  <span data-ttu-id="6d259-204">Com a implantação de região única, se a disponibilidade for 99,9, uma implantação de duas regiões poderá atingir uma disponibilidade de 99,9999 calculada pela fórmula: (1-(1-0.999) * (1-0.999))*100); confira o artigo anterior para obter detalhes.</span><span class="sxs-lookup"><span data-stu-id="6d259-204">With the single region deployment, if the availability is 99.9, a two-region deployment can attain an availability of 99.9999 computed by the formula: (1-(1-0.999) * (1-0.999))*100); see the above paper for details.</span></span>

<span data-ttu-id="6d259-205">**Recuperação de desastres:** o cluster Cassandra de várias regiões, se projetado adequadamente, pode resistir a interrupções catastróficas do data center.</span><span class="sxs-lookup"><span data-stu-id="6d259-205">**Disaster Recovery:** Multi-region Cassandra cluster, if properly designed, can withstand catastrophic data center outages.</span></span> <span data-ttu-id="6d259-206">Se uma região estiver inativa, o aplicativo implantado em outras regiões pode começar a servir os usuários finais.</span><span class="sxs-lookup"><span data-stu-id="6d259-206">If one region is down, the application deployed to other regions can start serving the end users.</span></span> <span data-ttu-id="6d259-207">Como as outras implementações de continuidade de negócios, o aplicativo precisa ser tolerante a falhas para alguma perda de dados resultante dos dados no pipeline assíncrono.</span><span class="sxs-lookup"><span data-stu-id="6d259-207">Like any other business continuity implementations, the application has to be tolerant for some data loss resulting from the data in the asynchronous pipeline.</span></span> <span data-ttu-id="6d259-208">No entanto, o Cassandra torna a recuperação muito mais rápida que os processos de recuperação de banco de dados tradicionais.</span><span class="sxs-lookup"><span data-stu-id="6d259-208">However, Cassandra makes the recovery much swifter than the time taken by traditional database recovery processes.</span></span> <span data-ttu-id="6d259-209">A Figura 2 mostra o modelo de implantação de várias regiões típico com oito nós em cada região.</span><span class="sxs-lookup"><span data-stu-id="6d259-209">Figure 2 shows the typical multi-region deployment model with eight nodes in each region.</span></span> <span data-ttu-id="6d259-210">Ambas as regiões são imagens espelhadas uma da outra para a mesma simetria; designs reais dependem do tipo de carga de trabalho (por exemplo, transacional ou analítica), RPO, RTO, consistência de dados e requisitos de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="6d259-210">Both regions are mirror images of each other for the same of symmetry; real world designs depend on the workload type (e.g. transactional or analytical), RPO, RTO, data consistency and availability requirements.</span></span>

![Implantação de várias regiões](./media/cassandra-nodejs/cassandra-linux2.png)

<span data-ttu-id="6d259-212">Figura 2: implantação do Cassandra de várias regiões</span><span class="sxs-lookup"><span data-stu-id="6d259-212">Figure 2: Multi-region Cassandra deployment</span></span>

### <a name="network-integration"></a><span data-ttu-id="6d259-213">Integração de rede</span><span class="sxs-lookup"><span data-stu-id="6d259-213">Network Integration</span></span>
<span data-ttu-id="6d259-214">Os conjuntos de máquinas virtuais implantados em redes privadas localizadas em duas regiões se comunicam entre si usando um túnel VPN.</span><span class="sxs-lookup"><span data-stu-id="6d259-214">Sets of virtual machines deployed to private networks located on two regions communicates with each other using a VPN tunnel.</span></span> <span data-ttu-id="6d259-215">O túnel VPN conecta dois gateways de software provisionados durante o processo de implantação de rede.</span><span class="sxs-lookup"><span data-stu-id="6d259-215">The VPN tunnel connects two software gateways provisioned during the network deployment process.</span></span> <span data-ttu-id="6d259-216">Ambas as regiões têm uma arquitetura de rede semelhante em termos de sub-redes "web" e "dados"; a rede do Azure permite a criação de quantas sub-redes forem necessárias e a aplicação de ACLs conforme necessário pela segurança de rede.</span><span class="sxs-lookup"><span data-stu-id="6d259-216">Both regions have similar network architecture in terms of “web” and “data” subnets; Azure networking allows the creation of as many subnets as needed and apply ACLs as needed by network security.</span></span> <span data-ttu-id="6d259-217">Ao projetar a topologia de cluster entre a latência de comunicação do data center e o impacto econômico da rede, o tráfego precisam ser considerado.</span><span class="sxs-lookup"><span data-stu-id="6d259-217">While designing the cluster topology inter data center communication latency and the economic impact of the network traffic need to be considered.</span></span>

### <a name="data-consistency-for-multi-data-center-deployment"></a><span data-ttu-id="6d259-218">Consistência de dados para implantação em vários data centers</span><span class="sxs-lookup"><span data-stu-id="6d259-218">Data Consistency for Multi-Data Center Deployment</span></span>
<span data-ttu-id="6d259-219">As implantações distribuídas precisam estar cientes do impacto da topologia de cluster na produtividade e alta disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="6d259-219">Distributed deployments need to be aware of the cluster topology impact on throughput and high availability.</span></span> <span data-ttu-id="6d259-220">O RF e o Nível de Consistência precisam ser selecionados de forma que o quorum não dependa da disponibilidade de todos os data centers.</span><span class="sxs-lookup"><span data-stu-id="6d259-220">The RF and Consistency Level need to be selected in such way that the quorum doesn’t depend on the availability of all the data centers.</span></span>
<span data-ttu-id="6d259-221">Para um sistema que precisa de consistência alta, um LOCAL_QUORUM para o nível de consistência (para leituras e gravações) garantirá que as leituras e gravações locais sejam atendidas por meio dos nós locais enquanto os dados são replicados assincronamente para os data centers remotos.</span><span class="sxs-lookup"><span data-stu-id="6d259-221">For a system that needs high consistency, a LOCAL_QUORUM for consistency level (for reads and writes) will make sure that the local reads and writes are satisfied from the local nodes while data is replicated asynchronously to the remote data centers.</span></span>  <span data-ttu-id="6d259-222">A tabela 2 resume os detalhes de configuração para o cluster de várias regiões descritos posteriormente na gravação.</span><span class="sxs-lookup"><span data-stu-id="6d259-222">Table 2 summarizes the configuration details for the multi-region cluster outlined later in the write up.</span></span>

<span data-ttu-id="6d259-223">**Configuração de cluster Cassandra de duas regiões**</span><span class="sxs-lookup"><span data-stu-id="6d259-223">**Two-region Cassandra cluster configuration**</span></span>

| <span data-ttu-id="6d259-224">Parâmetros de cluster</span><span class="sxs-lookup"><span data-stu-id="6d259-224">Cluster Parameter</span></span> | <span data-ttu-id="6d259-225">Valor</span><span class="sxs-lookup"><span data-stu-id="6d259-225">Value</span></span> | <span data-ttu-id="6d259-226">Comentários</span><span class="sxs-lookup"><span data-stu-id="6d259-226">Remarks</span></span> |
| --- | --- | --- |
| <span data-ttu-id="6d259-227">Número de nós (N)</span><span class="sxs-lookup"><span data-stu-id="6d259-227">Number of Nodes (N)</span></span> |<span data-ttu-id="6d259-228">8 + 8</span><span class="sxs-lookup"><span data-stu-id="6d259-228">8 + 8</span></span> |<span data-ttu-id="6d259-229">Número total de nós do cluster</span><span class="sxs-lookup"><span data-stu-id="6d259-229">Total number of nodes in the cluster</span></span> |
| <span data-ttu-id="6d259-230">Fator de replicação (RF)</span><span class="sxs-lookup"><span data-stu-id="6d259-230">Replication Factor (RF)</span></span> |<span data-ttu-id="6d259-231">3</span><span class="sxs-lookup"><span data-stu-id="6d259-231">3</span></span> |<span data-ttu-id="6d259-232">Número de réplicas de uma determinada linha</span><span class="sxs-lookup"><span data-stu-id="6d259-232">Number of replicas of a given row</span></span> |
| <span data-ttu-id="6d259-233">Nível de consistência (gravação)</span><span class="sxs-lookup"><span data-stu-id="6d259-233">Consistency Level (Write)</span></span> |<span data-ttu-id="6d259-234">LOCAL_QUORUM [(sum(RF)/2) +1) = 4] O resultado da fórmula é arredondado para baixo</span><span class="sxs-lookup"><span data-stu-id="6d259-234">LOCAL_QUORUM [(sum(RF)/2) +1) = 4] The result of the formula is rounded down</span></span> |<span data-ttu-id="6d259-235">2 nós serão gravados no primeiro data center de forma síncrona; os 2 nós adicionais necessários para o quorum serão gravados assincronamente no 2º data center.</span><span class="sxs-lookup"><span data-stu-id="6d259-235">2 nodes will be written to the first data center synchronously; the additional 2 nodes needed for quorum will be written asynchronously to the 2nd data center.</span></span> |
| <span data-ttu-id="6d259-236">Nível de consistência (leitura)</span><span class="sxs-lookup"><span data-stu-id="6d259-236">Consistency Level (Read)</span></span> |<span data-ttu-id="6d259-237">LOCAL_QUORUM ((RF/2) +1) = 2 O resultado da fórmula é arredondado para baixo</span><span class="sxs-lookup"><span data-stu-id="6d259-237">LOCAL_QUORUM ((RF/2) +1) = 2 The result of the formula is rounded down</span></span> |<span data-ttu-id="6d259-238">As solicitações de leitura são satisfeitas por meio de apenas uma região; 2 nós são lidos antes de que a resposta seja enviada de volta ao cliente.</span><span class="sxs-lookup"><span data-stu-id="6d259-238">Read requests are satisfied from only one region; 2 nodes are read before the response is sent back to the client.</span></span> |
| <span data-ttu-id="6d259-239">Estratégia de replicação</span><span class="sxs-lookup"><span data-stu-id="6d259-239">Replication Strategy</span></span> |<span data-ttu-id="6d259-240">NetworkTopologyStrategy consulte [Replicação de dados](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureDataDistributeReplication_c.html) na documentação de Cassandra para obter mais informações</span><span class="sxs-lookup"><span data-stu-id="6d259-240">NetworkTopologyStrategy see [Data Replication](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureDataDistributeReplication_c.html) in Cassandra documentation for more information</span></span> |<span data-ttu-id="6d259-241">Entende a topologia de implantação e coloca as réplicas em nós para que todas as réplicas não terminem no mesmo rack</span><span class="sxs-lookup"><span data-stu-id="6d259-241">Understands the deployment topology and places replicas on nodes so that all the replicas don’t end up on the same rack</span></span> |
| <span data-ttu-id="6d259-242">Informante</span><span class="sxs-lookup"><span data-stu-id="6d259-242">Snitch</span></span> |<span data-ttu-id="6d259-243">GossipingPropertyFileSnitch consulte [Informantes](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureSnitchesAbout_c.html) na documentação de Cassandra para obter mais informações</span><span class="sxs-lookup"><span data-stu-id="6d259-243">GossipingPropertyFileSnitch see [Snitches](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureSnitchesAbout_c.html) in Cassandra documentation for more information</span></span> |<span data-ttu-id="6d259-244">NetworkTopologyStrategy usa um conceito de informante para compreender a topologia.</span><span class="sxs-lookup"><span data-stu-id="6d259-244">NetworkTopologyStrategy uses a concept of snitch to understand the topology.</span></span> <span data-ttu-id="6d259-245">GossipingPropertyFileSnitch oferece maior controle ao mapear cada nó para rack e data center.</span><span class="sxs-lookup"><span data-stu-id="6d259-245">GossipingPropertyFileSnitch gives better control in mapping each node to data center and rack.</span></span> <span data-ttu-id="6d259-246">O cluster faz uso de fofocas para propagar essas informações.</span><span class="sxs-lookup"><span data-stu-id="6d259-246">The cluster then uses gossip to propagate this information.</span></span> <span data-ttu-id="6d259-247">Isso é muito mais simples na configuração de IP dinâmico em relação a PropertyFileSnitch</span><span class="sxs-lookup"><span data-stu-id="6d259-247">This is much simpler in dynamic IP setting relative to PropertyFileSnitch</span></span> |

## <a name="the-software-configuration"></a><span data-ttu-id="6d259-248">A CONFIGURAÇÃO DO SOFTWARE</span><span class="sxs-lookup"><span data-stu-id="6d259-248">THE SOFTWARE CONFIGURATION</span></span>
<span data-ttu-id="6d259-249">As seguintes versões de software são usadas durante a implantação:</span><span class="sxs-lookup"><span data-stu-id="6d259-249">The following software versions are used during the deployment:</span></span>

<table>
<tr><th><span data-ttu-id="6d259-250">Software</span><span class="sxs-lookup"><span data-stu-id="6d259-250">Software</span></span></th><th><span data-ttu-id="6d259-251">Fonte</span><span class="sxs-lookup"><span data-stu-id="6d259-251">Source</span></span></th><th><span data-ttu-id="6d259-252">Versão</span><span class="sxs-lookup"><span data-stu-id="6d259-252">Version</span></span></th></tr>
<tr><td><span data-ttu-id="6d259-253">JRE</span><span class="sxs-lookup"><span data-stu-id="6d259-253">JRE</span></span>    </td><td><span data-ttu-id="6d259-254">[JRE 8](http://www.oracle.com/technetwork/java/javase/downloads/server-jre8-downloads-2133154.html) </span><span class="sxs-lookup"><span data-stu-id="6d259-254">[JRE 8](http://www.oracle.com/technetwork/java/javase/downloads/server-jre8-downloads-2133154.html) </span></span></td><td><span data-ttu-id="6d259-255">8U5</span><span class="sxs-lookup"><span data-stu-id="6d259-255">8U5</span></span></td></tr>
<tr><td><span data-ttu-id="6d259-256">JNA</span><span class="sxs-lookup"><span data-stu-id="6d259-256">JNA</span></span>    </td><td><span data-ttu-id="6d259-257">[JNA](https://github.com/twall/jna) </span><span class="sxs-lookup"><span data-stu-id="6d259-257">[JNA](https://github.com/twall/jna) </span></span></td><td> <span data-ttu-id="6d259-258">3.2.7</span><span class="sxs-lookup"><span data-stu-id="6d259-258">3.2.7</span></span></td></tr>
<tr><td><span data-ttu-id="6d259-259">Cassandra</span><span class="sxs-lookup"><span data-stu-id="6d259-259">Cassandra</span></span></td><td>[<span data-ttu-id="6d259-260">Apache Cassandra 2.0.8</span><span class="sxs-lookup"><span data-stu-id="6d259-260">Apache Cassandra 2.0.8</span></span>](http://www.apache.org/dist/cassandra/2.0.8/apache-cassandra-2.0.8-bin.tar.gz)</td><td> <span data-ttu-id="6d259-261">2.0.8</span><span class="sxs-lookup"><span data-stu-id="6d259-261">2.0.8</span></span></td></tr>
<tr><td><span data-ttu-id="6d259-262">Ubuntu</span><span class="sxs-lookup"><span data-stu-id="6d259-262">Ubuntu</span></span>    </td><td><span data-ttu-id="6d259-263">[Microsoft Azure](https://azure.microsoft.com/) </span><span class="sxs-lookup"><span data-stu-id="6d259-263">[Microsoft Azure](https://azure.microsoft.com/) </span></span></td><td><span data-ttu-id="6d259-264">14.04 LTS</span><span class="sxs-lookup"><span data-stu-id="6d259-264">14.04 LTS</span></span></td></tr>
</table>

<span data-ttu-id="6d259-265">Como o download do JRE requer a aceitação manual da licença do Oracle, para simplificar a implantação, baixe todos os softwares necessários para a área de trabalho para carregar mais tarde na imagem de modelo do Ubuntu que estaremos criando como precursora da implantação de cluster.</span><span class="sxs-lookup"><span data-stu-id="6d259-265">Since downloading of JRE requires manual acceptance of Oracle license, to simplify the deployment, download all the required software to the desktop for later uploading into the Ubuntu template image we will be creating as a precursor to the cluster deployment.</span></span>

<span data-ttu-id="6d259-266">Baixe o software acima em um diretório de downloads conhecido (por exemplo, %TEMP%/downloads no Windows ou ~/Downloads na maioria das distribuições Linux ou Mac) no computador local.</span><span class="sxs-lookup"><span data-stu-id="6d259-266">Download the above software into a well-known download directory (e.g. %TEMP%/downloads on Windows or ~/Downloads on most Linux distributions or Mac) on the local computer.</span></span>

### <a name="create-ubuntu-vm"></a><span data-ttu-id="6d259-267">CRIAR UMA MV UBUNTU</span><span class="sxs-lookup"><span data-stu-id="6d259-267">CREATE UBUNTU VM</span></span>
<span data-ttu-id="6d259-268">Nesta etapa do processo, criaremos a imagem do Ubuntu com o software de pré-requisito para que a imagem possa ser reutilizada para o provisionamento de vários nós de Cassandra.</span><span class="sxs-lookup"><span data-stu-id="6d259-268">In this step of the process we will create Ubuntu image with the pre-requisite software so that the image can be reused for provisioning several Cassandra nodes.</span></span>  

#### <a name="step-1-generate-ssh-key-pair"></a><span data-ttu-id="6d259-269">ETAPA 1: gerar o par de chave SSH</span><span class="sxs-lookup"><span data-stu-id="6d259-269">STEP 1: Generate SSH key pair</span></span>
<span data-ttu-id="6d259-270">O Azure precisa de uma chave pública X509 que é PEM ou DER codificada no momento de provisionamento.</span><span class="sxs-lookup"><span data-stu-id="6d259-270">Azure needs an X509 public key that is either PEM or DER encoded at the provisioning time.</span></span> <span data-ttu-id="6d259-271">Gerar um par de chaves pública/privada usando as instruções localizadas em Como usar SSH com Linux no Azure.</span><span class="sxs-lookup"><span data-stu-id="6d259-271">Generate a public/private key pair using the instructions located at How to Use SSH with Linux on Azure.</span></span> <span data-ttu-id="6d259-272">Se você planeja usar putty.exe como um cliente SSH no Windows ou Linux, você precisará converter a chave privada RSA codificada PEM para o formato PPK usando puttygen.exe; as instruções para isso podem ser encontradas na página da Web acima.</span><span class="sxs-lookup"><span data-stu-id="6d259-272">If you plan to use putty.exe as an SSH client either on Windows or Linux, you have to convert the PEM encoded RSA private key to PPK format using puttygen.exe; the instructions for this can be found in the above web page.</span></span>

#### <a name="step-2-create-ubuntu-template-vm"></a><span data-ttu-id="6d259-273">ETAPA 2: criar uma VM do modelo Ubuntu</span><span class="sxs-lookup"><span data-stu-id="6d259-273">STEP 2: Create Ubuntu template VM</span></span>
<span data-ttu-id="6d259-274">Para criar a VM do modelo, faça logon no portal clássico do Azure e use a seguinte sequência: clique em NOVO, COMPUTAÇÃO, MÁQUINA VIRTUAL, DA GALERIA, UBUNTU, Ubuntu Server 14.04 LTS e clique na seta direita.</span><span class="sxs-lookup"><span data-stu-id="6d259-274">To create the template VM, log into the Azure classic portal and use the following sequence: Click NEW, COMPUTE, VIRTUAL MACHINE, FROM GALLERY, UBUNTU, Ubuntu Server 14.04 LTS, and then click the right arrow.</span></span> <span data-ttu-id="6d259-275">Para um tutorial que descreva como criar uma VM Linux, consulte Criar uma Máquina Virtual executando o Linux.</span><span class="sxs-lookup"><span data-stu-id="6d259-275">For a tutorial that describes how to create a Linux VM, see Create a Virtual Machine Running Linux.</span></span>

<span data-ttu-id="6d259-276">Insira as seguintes informações na tela #1 "Configuração da máquina virtual":</span><span class="sxs-lookup"><span data-stu-id="6d259-276">Enter the following information on the “Virtual machine configuration” screen #1:</span></span>

<table>
<tr><th><span data-ttu-id="6d259-277">NOME DO CAMPO</span><span class="sxs-lookup"><span data-stu-id="6d259-277">FIELD NAME</span></span>              </td><td>       <span data-ttu-id="6d259-278">VALOR DO CAMPO</span><span class="sxs-lookup"><span data-stu-id="6d259-278">FIELD VALUE</span></span>               </td><td>         <span data-ttu-id="6d259-279">COMENTÁRIOS</span><span class="sxs-lookup"><span data-stu-id="6d259-279">REMARKS</span></span>                </td><tr>
<tr><td><span data-ttu-id="6d259-280">DATA DE LANÇAMENTO DA VERSÃO</span><span class="sxs-lookup"><span data-stu-id="6d259-280">VERSION RELEASE DATE</span></span>    </td><td> <span data-ttu-id="6d259-281">Selecione uma data no menu suspenso</span><span class="sxs-lookup"><span data-stu-id="6d259-281">Select a date from the drop down</span></span></td><td></td><tr>
<tr><td><span data-ttu-id="6d259-282">NOME DA MÁQUINA VIRTUAL</span><span class="sxs-lookup"><span data-stu-id="6d259-282">VIRTUAL MACHINE NAME</span></span>    </td><td> <span data-ttu-id="6d259-283">cass-template</span><span class="sxs-lookup"><span data-stu-id="6d259-283">cass-template</span></span>                   </td><td> <span data-ttu-id="6d259-284">Este é o nome do organizador da MV</span><span class="sxs-lookup"><span data-stu-id="6d259-284">This is the hostname of the VM</span></span> </td><tr>
<tr><td><span data-ttu-id="6d259-285">CAMADA</span><span class="sxs-lookup"><span data-stu-id="6d259-285">TIER</span></span>                     </td><td> <span data-ttu-id="6d259-286">STANDARD</span><span class="sxs-lookup"><span data-stu-id="6d259-286">STANDARD</span></span>                           </td><td> <span data-ttu-id="6d259-287">Deixar o padrão</span><span class="sxs-lookup"><span data-stu-id="6d259-287">Leave the default</span></span>              </td><tr>
<tr><td><span data-ttu-id="6d259-288">TAMANHO adequado</span><span class="sxs-lookup"><span data-stu-id="6d259-288">SIZE</span></span>                     </td><td> <span data-ttu-id="6d259-289">A1</span><span class="sxs-lookup"><span data-stu-id="6d259-289">A1</span></span>                              </td><td><span data-ttu-id="6d259-290">Selecione a VM com base nas necessidades de E/S; para esta finalidade, deixe o valor padrão</span><span class="sxs-lookup"><span data-stu-id="6d259-290">Select the VM based on the IO needs; for this purpose leave the default</span></span> </td><tr>
<tr><td> <span data-ttu-id="6d259-291">NOVO NOME DE USUÁRIO</span><span class="sxs-lookup"><span data-stu-id="6d259-291">NEW USER NAME</span></span>             </td><td> <span data-ttu-id="6d259-292">localadmin</span><span class="sxs-lookup"><span data-stu-id="6d259-292">localadmin</span></span>                       </td><td> <span data-ttu-id="6d259-293">"admin" é um nome de usuário reservado no Ubuntu 12.xx e depois</span><span class="sxs-lookup"><span data-stu-id="6d259-293">"admin" is a reserved user name in Ubuntu 12.xx and after</span></span></td><tr>
<tr><td> <span data-ttu-id="6d259-294">AUTENTICAÇÃO</span><span class="sxs-lookup"><span data-stu-id="6d259-294">AUTHENTICATION</span></span>         </td><td> <span data-ttu-id="6d259-295">Clique na caixa de seleção</span><span class="sxs-lookup"><span data-stu-id="6d259-295">Click check box</span></span>                 </td><td><span data-ttu-id="6d259-296">Verifique se você deseja proteger com uma chave SSH</span><span class="sxs-lookup"><span data-stu-id="6d259-296">Check if you want to secure with an SSH key</span></span> </td><tr>
<tr><td> <span data-ttu-id="6d259-297">CERTIFICADO</span><span class="sxs-lookup"><span data-stu-id="6d259-297">CERTIFICATE</span></span>             </td><td> <span data-ttu-id="6d259-298">nome do arquivo do certificado de chave pública</span><span class="sxs-lookup"><span data-stu-id="6d259-298">file name of the public key certificate</span></span> </td><td> <span data-ttu-id="6d259-299">Use a chave pública gerada anteriormente</span><span class="sxs-lookup"><span data-stu-id="6d259-299">Use the public key generated previously</span></span></td><tr>
<tr><td> <span data-ttu-id="6d259-300">Nova senha</span><span class="sxs-lookup"><span data-stu-id="6d259-300">New Password</span></span>    </td><td> <span data-ttu-id="6d259-301">senha de alta segurança</span><span class="sxs-lookup"><span data-stu-id="6d259-301">strong password</span></span> </td><td> </td><tr>
<tr><td> <span data-ttu-id="6d259-302">Confirmar Senha</span><span class="sxs-lookup"><span data-stu-id="6d259-302">Confirm Password</span></span>    </td><td> <span data-ttu-id="6d259-303">senha de alta segurança</span><span class="sxs-lookup"><span data-stu-id="6d259-303">strong password</span></span> </td><td></td><tr>
</table>

<span data-ttu-id="6d259-304">Insira as seguintes informações na tela #2 "Configuração da máquina virtual":</span><span class="sxs-lookup"><span data-stu-id="6d259-304">Enter the following information on the “Virtual machine configuration” screen #2:</span></span>

<table>
<tr><th><span data-ttu-id="6d259-305">NOME DO CAMPO</span><span class="sxs-lookup"><span data-stu-id="6d259-305">FIELD NAME</span></span>             </th><th> <span data-ttu-id="6d259-306">VALOR DO CAMPO</span><span class="sxs-lookup"><span data-stu-id="6d259-306">FIELD VALUE</span></span>                       </th><th> <span data-ttu-id="6d259-307">COMENTÁRIOS</span><span class="sxs-lookup"><span data-stu-id="6d259-307">REMARKS</span></span>                                 </th></tr>
<tr><td> <span data-ttu-id="6d259-308">SERVIÇO DE NUVEM</span><span class="sxs-lookup"><span data-stu-id="6d259-308">CLOUD SERVICE</span></span>    </td><td> <span data-ttu-id="6d259-309">Crie um novo serviço de nuvem</span><span class="sxs-lookup"><span data-stu-id="6d259-309">Create a new cloud service</span></span>    </td><td><span data-ttu-id="6d259-310">O serviço de nuvem é um recurso de contêiner de computação, como as máquinas virtuais</span><span class="sxs-lookup"><span data-stu-id="6d259-310">Cloud service is a container compute resources like virtual machines</span></span></td></tr>
<tr><td> <span data-ttu-id="6d259-311">NOME DNS DO SERVIÇO DE NUVEM</span><span class="sxs-lookup"><span data-stu-id="6d259-311">CLOUD SERVICE DNS NAME</span></span>    </td><td><span data-ttu-id="6d259-312">ubuntu-template.cloudapp.net</span><span class="sxs-lookup"><span data-stu-id="6d259-312">ubuntu-template.cloudapp.net</span></span>    </td><td><span data-ttu-id="6d259-313">Dê um nome do balanceador de carga independente da máquina</span><span class="sxs-lookup"><span data-stu-id="6d259-313">Give a machine agnostic load balancer name</span></span></td></tr>
<tr><td> <span data-ttu-id="6d259-314">REGIÃO/GRUPO DE AFINIDADE/REDE VIRTUAL</span><span class="sxs-lookup"><span data-stu-id="6d259-314">REGION/AFFINITY GROUP/VIRTUAL NETWORK</span></span> </td><td>    <span data-ttu-id="6d259-315">Oeste dos EUA</span><span class="sxs-lookup"><span data-stu-id="6d259-315">West US</span></span>    </td><td> <span data-ttu-id="6d259-316">Selecione uma região na qual seus aplicativos da web acessam o cluster Cassandra</span><span class="sxs-lookup"><span data-stu-id="6d259-316">Select a region from which your web applications access the Cassandra cluster</span></span></td></tr>
<tr><td><span data-ttu-id="6d259-317">CONTA DE ARMAZENAMENTO</span><span class="sxs-lookup"><span data-stu-id="6d259-317">STORAGE ACCOUNT</span></span> </td><td>    <span data-ttu-id="6d259-318">Usar padrão</span><span class="sxs-lookup"><span data-stu-id="6d259-318">Use default</span></span>    </td><td><span data-ttu-id="6d259-319">Use a conta de armazenamento padrão ou uma conta de armazenamento criada previamente em uma determinada região</span><span class="sxs-lookup"><span data-stu-id="6d259-319">Use the default storage account  or a pre-created storage account in a particular region</span></span></td></tr>
<tr><td><span data-ttu-id="6d259-320">Conjunto de disponibilidade</span><span class="sxs-lookup"><span data-stu-id="6d259-320">AVAILABILITY SET</span></span> </td><td>    <span data-ttu-id="6d259-321">Nenhum</span><span class="sxs-lookup"><span data-stu-id="6d259-321">None</span></span> </td><td>    <span data-ttu-id="6d259-322">Deixe em branco</span><span class="sxs-lookup"><span data-stu-id="6d259-322">Leave it blank</span></span></td></tr>
<tr><td><span data-ttu-id="6d259-323">PONTOS DE EXTREMIDADE</span><span class="sxs-lookup"><span data-stu-id="6d259-323">ENDPOINTS</span></span>    </td><td><span data-ttu-id="6d259-324">Usar padrão</span><span class="sxs-lookup"><span data-stu-id="6d259-324">Use default</span></span> </td><td>    <span data-ttu-id="6d259-325">Use a configuração padrão de SSH</span><span class="sxs-lookup"><span data-stu-id="6d259-325">Use the default SSH configuration</span></span> </td></tr>
</table>

<span data-ttu-id="6d259-326">Clique na seta para a direita, mantenha os padrões na tela #3 e clique no botão de "verificação" para concluir o processo de provisionamento da VM.</span><span class="sxs-lookup"><span data-stu-id="6d259-326">Click right arrow, leave the defaults on the screen #3 and click the “check” button to complete the VM provisioning process.</span></span> <span data-ttu-id="6d259-327">Depois de alguns minutos, a VM com o nome "ubuntu-template" deve estar no status "em execução".</span><span class="sxs-lookup"><span data-stu-id="6d259-327">After a few minutes, the VM with the name “ubuntu-template” should be in a “running” status.</span></span>

### <a name="install-the-necessary-software"></a><span data-ttu-id="6d259-328">INSTALAR O SOFTWARE NECESSÁRIO</span><span class="sxs-lookup"><span data-stu-id="6d259-328">INSTALL THE NECESSARY SOFTWARE</span></span>
#### <a name="step-1-upload-tarballs"></a><span data-ttu-id="6d259-329">ETAPA 1: carregar tarballs</span><span class="sxs-lookup"><span data-stu-id="6d259-329">STEP 1: Upload tarballs</span></span>
<span data-ttu-id="6d259-330">Usando scp ou pscp, copie o software baixado anteriormente para o diretório ~/downloads usando o seguinte formato de comando:</span><span class="sxs-lookup"><span data-stu-id="6d259-330">Using scp or pscp, copy the previously downloaded software to ~/downloads directory using the following command format:</span></span>

##### <a name="pscp-server-jre-8u5-linux-x64targz-localadminhk-cas-templatecloudappnethomelocaladmindownloadsserver-jre-8u5-linux-x64targz"></a><span data-ttu-id="6d259-331">pscp server-jre-8u5-linux-x64.tar.gz localadmin@hk-cas-template.cloudapp.net:/home/localadmin/downloads/server-jre-8u5-linux-x64.tar.gz</span><span class="sxs-lookup"><span data-stu-id="6d259-331">pscp server-jre-8u5-linux-x64.tar.gz localadmin@hk-cas-template.cloudapp.net:/home/localadmin/downloads/server-jre-8u5-linux-x64.tar.gz</span></span>
<span data-ttu-id="6d259-332">Repita o comando acima para JRE, bem como para os bits de Cassandra.</span><span class="sxs-lookup"><span data-stu-id="6d259-332">Repeat the above command for JRE as well as for the Cassandra bits.</span></span>

#### <a name="step-2-prepare-the-directory-structure-and-extract-the-archives"></a><span data-ttu-id="6d259-333">ETAPA 2: preparar a estrutura de diretório e extraia os arquivos</span><span class="sxs-lookup"><span data-stu-id="6d259-333">STEP 2: Prepare the directory structure and extract the archives</span></span>
<span data-ttu-id="6d259-334">Faça o logon na VM, crie a estrutura de diretórios e extraia o software como um superusuário usando o script bash abaixo:</span><span class="sxs-lookup"><span data-stu-id="6d259-334">Log into the VM and create the directory structure and extract software as a super user using the bash script below:</span></span>

    #!/bin/bash
    CASS_INSTALL_DIR="/opt/cassandra"
    JRE_INSTALL_DIR="/opt/java"
    CASS_DATA_DIR="/var/lib/cassandra"
    CASS_LOG_DIR="/var/log/cassandra"
    DOWNLOADS_DIR="~/downloads"
    JRE_TARBALL="server-jre-8u5-linux-x64.tar.gz"
    CASS_TARBALL="apache-cassandra-2.0.8-bin.tar.gz"
    SVC_USER="localadmin"

    RESET_ERROR=1
    MKDIR_ERROR=2

    reset_installation ()
    {
       rm -rf $CASS_INSTALL_DIR 2> /dev/null
       rm -rf $JRE_INSTALL_DIR 2> /dev/null
       rm -rf $CASS_DATA_DIR 2> /dev/null
       rm -rf $CASS_LOG_DIR 2> /dev/null
    }
    make_dir ()
    {
       if [ -z "$1" ]
       then
          echo "make_dir: invalid directory name"
          exit $MKDIR_ERROR
       fi

       if [ -d "$1" ]
       then
          echo "make_dir: directory already exists"
          exit $MKDIR_ERROR
       fi

       mkdir $1 2>/dev/null
       if [ $? != 0 ]
       then
          echo "directory creation failed"
          exit $MKDIR_ERROR
       fi
    }

    unzip()
    {
       if [ $# == 2 ]
       then
          tar xzf $1 -C $2
       else
          echo "archive error"
       fi

    }

    if [ -n "$1" ]
    then
       SVC_USER=$1
    fi

    reset_installation
    make_dir $CASS_INSTALL_DIR
    make_dir $JRE_INSTALL_DIR
    make_dir $CASS_DATA_DIR
    make_dir $CASS_LOG_DIR

    #unzip JRE and Cassandra
    unzip $HOME/downloads/$JRE_TARBALL $JRE_INSTALL_DIR
    unzip $HOME/downloads/$CASS_TARBALL $CASS_INSTALL_DIR

    #Change the ownership to the service credentials

    chown -R $SVC_USER:$GROUP $CASS_DATA_DIR
    chown -R $SVC_USER:$GROUP $CASS_LOG_DIR
    echo "edit /etc/profile to add JRE to the PATH"
    echo "installation is complete"


<span data-ttu-id="6d259-335">Se você colar este script na janela vim, certifique-se de remover o retorno de carro ("\r") usando o seguinte comando:</span><span class="sxs-lookup"><span data-stu-id="6d259-335">If you paste this script into vim window, make sure to remove the carriage return (‘\r”) using the following command:</span></span>

    tr -d '\r' <infile.sh >outfile.sh

#### <a name="step-3-edit-etcprofile"></a><span data-ttu-id="6d259-336">Etapa 3: editar etc/profile</span><span class="sxs-lookup"><span data-stu-id="6d259-336">Step 3: Edit etc/profile</span></span>
<span data-ttu-id="6d259-337">Acrescente o seguinte ao final:</span><span class="sxs-lookup"><span data-stu-id="6d259-337">Append the following at the end:</span></span>

    JAVA_HOME=/opt/java/jdk1.8.0_05
    CASS_HOME= /opt/cassandra/apache-cassandra-2.0.8
    PATH=$PATH:$HOME/bin:$JAVA_HOME/bin:$CASS_HOME/bin
    export JAVA_HOME
    export CASS_HOME
    export PATH

#### <a name="step-4-install-jna-for-production-systems"></a><span data-ttu-id="6d259-338">Etapa 4: instalar JNA para sistemas de produção</span><span class="sxs-lookup"><span data-stu-id="6d259-338">Step 4: Install JNA for production systems</span></span>
<span data-ttu-id="6d259-339">Use a seguinte sequência de comandos: o comando a seguir instalará jna-3.2.7.jar e jna-platform-3.2.7.jar em /usr/share.java directory sudo apt-get install libjna-java</span><span class="sxs-lookup"><span data-stu-id="6d259-339">Use the following command sequence: The following command will install jna-3.2.7.jar and jna-platform-3.2.7.jar to /usr/share.java directory sudo apt-get install libjna-java</span></span>

<span data-ttu-id="6d259-340">Crie links simbólicos no diretório $CASS_HOME/lib para que o script de inicialização de Cassandra possa encontrar essas jars:</span><span class="sxs-lookup"><span data-stu-id="6d259-340">Create symbolic links in $CASS_HOME/lib directory so that Cassandra startup script can find these jars:</span></span>

    ln -s /usr/share/java/jna-3.2.7.jar $CASS_HOME/lib/jna.jar

    ln -s /usr/share/java/jna-platform-3.2.7.jar $CASS_HOME/lib/jna-platform.jar

#### <a name="step-5-configure-cassandrayaml"></a><span data-ttu-id="6d259-341">Etapa 5: configurar o cassandra.yaml</span><span class="sxs-lookup"><span data-stu-id="6d259-341">Step 5: Configure cassandra.yaml</span></span>
<span data-ttu-id="6d259-342">Edite cassandra.yaml em cada VM para refletir a configuração necessária para todas as máquinas virtuais [ajustaremos isso durante o provisionamento real]:</span><span class="sxs-lookup"><span data-stu-id="6d259-342">Edit cassandra.yaml on each VM to reflect configuration needed by all the virtual machines [we will tweak this during the actual provisioning]:</span></span>

<table>
<tr><th><span data-ttu-id="6d259-343">Nome do campo</span><span class="sxs-lookup"><span data-stu-id="6d259-343">Field Name</span></span>   </th><th> <span data-ttu-id="6d259-344">Valor</span><span class="sxs-lookup"><span data-stu-id="6d259-344">Value</span></span>  </th><th>    <span data-ttu-id="6d259-345">Comentários</span><span class="sxs-lookup"><span data-stu-id="6d259-345">Remarks</span></span> </th></tr>
<tr><td><span data-ttu-id="6d259-346">cluster_name</span><span class="sxs-lookup"><span data-stu-id="6d259-346">cluster_name</span></span> </td><td>    <span data-ttu-id="6d259-347">"CustomerService"</span><span class="sxs-lookup"><span data-stu-id="6d259-347">“CustomerService”</span></span>    </td><td> <span data-ttu-id="6d259-348">Use o nome que reflete a sua implantação</span><span class="sxs-lookup"><span data-stu-id="6d259-348">Use the name that reflects your deployment</span></span></td></tr>
<tr><td><span data-ttu-id="6d259-349">listen_address</span><span class="sxs-lookup"><span data-stu-id="6d259-349">listen_address</span></span>    </td><td><span data-ttu-id="6d259-350">[deixe em branco]</span><span class="sxs-lookup"><span data-stu-id="6d259-350">[leave it blank]</span></span>    </td><td> <span data-ttu-id="6d259-351">Excluir "localhost"</span><span class="sxs-lookup"><span data-stu-id="6d259-351">Delete “localhost”</span></span> </td></tr>
<tr><td><span data-ttu-id="6d259-352">rpc_addres</span><span class="sxs-lookup"><span data-stu-id="6d259-352">rpc_addres</span></span>   </td><td><span data-ttu-id="6d259-353">[deixe em branco]</span><span class="sxs-lookup"><span data-stu-id="6d259-353">[leave it blank]</span></span>    </td><td> <span data-ttu-id="6d259-354">Excluir "localhost"</span><span class="sxs-lookup"><span data-stu-id="6d259-354">Delete “localhost”</span></span> </td></tr>
<tr><td><span data-ttu-id="6d259-355">sementes</span><span class="sxs-lookup"><span data-stu-id="6d259-355">seeds</span></span>    </td><td><span data-ttu-id="6d259-356">"10.1.2.4, 10.1.2.6, 10.1.2.8"</span><span class="sxs-lookup"><span data-stu-id="6d259-356">"10.1.2.4, 10.1.2.6, 10.1.2.8"</span></span>    </td><td><span data-ttu-id="6d259-357">Lista de todos os endereços IP que são designados como sementes.</span><span class="sxs-lookup"><span data-stu-id="6d259-357">List of  all the IP addresses which are designated as seeds.</span></span></td></tr>
<tr><td><span data-ttu-id="6d259-358">endpoint_snitch</span><span class="sxs-lookup"><span data-stu-id="6d259-358">endpoint_snitch</span></span> </td><td> <span data-ttu-id="6d259-359">org.apache.cassandra.locator.GossipingPropertyFileSnitch</span><span class="sxs-lookup"><span data-stu-id="6d259-359">org.apache.cassandra.locator.GossipingPropertyFileSnitch</span></span> </td><td> <span data-ttu-id="6d259-360">É usado pelo NetworkTopologyStrateg para deduzir o data center e o rack da VM</span><span class="sxs-lookup"><span data-stu-id="6d259-360">This is used by the NetworkTopologyStrateg for inferring the data center and the rack of the VM</span></span></td></tr>
</table>

#### <a name="step-6-capture-the-vm-image"></a><span data-ttu-id="6d259-361">Etapa 6: capturar a imagem da VM</span><span class="sxs-lookup"><span data-stu-id="6d259-361">Step 6: Capture the VM image</span></span>
<span data-ttu-id="6d259-362">Faça logon na máquina virtual usando o nome de host (hk-cas-template.cloudapp.net) e a chave privada SSH criada anteriormente.</span><span class="sxs-lookup"><span data-stu-id="6d259-362">Log into the virtual machine using the hostname (hk-cas-template.cloudapp.net) and the SSH private key previously created.</span></span> <span data-ttu-id="6d259-363">Consulte como usar a SSH com o Linux no Azure para obter detalhes sobre como fazer logon usando o comando ssh ou putty.exe.</span><span class="sxs-lookup"><span data-stu-id="6d259-363">See How to Use SSH with Linux on Azure for details on how to log in using the command ssh or putty.exe.</span></span>

<span data-ttu-id="6d259-364">Execute a seguinte sequência de ações para capturar a imagem:</span><span class="sxs-lookup"><span data-stu-id="6d259-364">Execute the following sequence of actions to capture the image:</span></span>

##### <a name="1-deprovision"></a><span data-ttu-id="6d259-365">1. Desprovisionar</span><span class="sxs-lookup"><span data-stu-id="6d259-365">1. Deprovision</span></span>
<span data-ttu-id="6d259-366">Use o comando "sudo waagent-deprovision+user" para remover informações específicas da instância de Máquina Virtual.</span><span class="sxs-lookup"><span data-stu-id="6d259-366">Use the command “sudo waagent –deprovision+user” to remove Virtual Machine instance specific information.</span></span> <span data-ttu-id="6d259-367">Veja [Como capturar uma Máquina Virtual Linux](capture-image.md) para usar como um modelo para mais detalhes sobre o processo de captura de imagem.</span><span class="sxs-lookup"><span data-stu-id="6d259-367">See for [How to Capture a Linux Virtual Machine](capture-image.md) to Use as a Template more details on the image capture process.</span></span>

##### <a name="2-shutdown-the-vm"></a><span data-ttu-id="6d259-368">2: desligar a VM</span><span class="sxs-lookup"><span data-stu-id="6d259-368">2: Shutdown the VM</span></span>
<span data-ttu-id="6d259-369">Certifique-se de que a máquina virtual esteja realçada e clique no link DESLIGAMENTO na barra de comandos inferior.</span><span class="sxs-lookup"><span data-stu-id="6d259-369">Make sure that the virtual machine is highlighted and click the SHUTDOWN link from the bottom command bar.</span></span>

##### <a name="3-capture-the-image"></a><span data-ttu-id="6d259-370">3: capturar a imagem</span><span class="sxs-lookup"><span data-stu-id="6d259-370">3: Capture the image</span></span>
<span data-ttu-id="6d259-371">Certifique-se de que a máquina virtual esteja realçada e clique no link CAPTURAR na barra de comandos inferior.</span><span class="sxs-lookup"><span data-stu-id="6d259-371">Make sure that the virtual machine is highlighted and click the CAPTURE link from the bottom command bar.</span></span> <span data-ttu-id="6d259-372">Na próxima tela, atribua um NOME DE IMAGEM (por exemplo, hk-cas-2-08-ub-14-04-2014071), uma DESCRIÇÃO DA IMAGEM apropriada, e clique na marca de "verificação" para concluir o processo de captura.</span><span class="sxs-lookup"><span data-stu-id="6d259-372">In the next screen, give an IMAGE NAME (e.g. hk-cas-2-08-ub-14-04-2014071), appropriate IMAGE DESCRIPTION, and click the “check” mark to finish the CAPTURE process.</span></span>

<span data-ttu-id="6d259-373">Isto levará alguns segundos e a imagem deverá estar disponível na seção MINHAS IMAGENS da galeria de imagens.</span><span class="sxs-lookup"><span data-stu-id="6d259-373">This will take a few seconds and the image should be available in MY IMAGES section of the image gallery.</span></span> <span data-ttu-id="6d259-374">A VM de origem será automaticamente excluída depois que a imagem for capturada com êxito.</span><span class="sxs-lookup"><span data-stu-id="6d259-374">The source VM will be automatically deleted after the image is successfully captured.</span></span> 

## <a name="single-region-deployment-process"></a><span data-ttu-id="6d259-375">Processo de implantação de região única</span><span class="sxs-lookup"><span data-stu-id="6d259-375">Single Region Deployment Process</span></span>
<span data-ttu-id="6d259-376">**Etapa 1: Criar a Rede Virtual** Faça logon no portal do Azure e crie uma Rede Virtual (clássica) com os atributos mostrados na tabela a seguir.</span><span class="sxs-lookup"><span data-stu-id="6d259-376">**Step 1: Create the Virtual Network** Log into the Azure portal and create a virtual network (classic) with the attributes shown in the following table.</span></span> <span data-ttu-id="6d259-377">Confira [Criar uma rede virtual (clássica) usando o portal do Azure](../../../virtual-network/virtual-networks-create-vnet-classic-pportal.md) para obter as etapas detalhadas do processo.</span><span class="sxs-lookup"><span data-stu-id="6d259-377">See [Create a virtual network (classic) using the Azure portal](../../../virtual-network/virtual-networks-create-vnet-classic-pportal.md) for detailed steps of the process.</span></span>      

<table>
<tr><th><span data-ttu-id="6d259-378">Nome do atributo da VM</span><span class="sxs-lookup"><span data-stu-id="6d259-378">VM Attribute Name</span></span></th><th><span data-ttu-id="6d259-379">Valor</span><span class="sxs-lookup"><span data-stu-id="6d259-379">Value</span></span></th><th><span data-ttu-id="6d259-380">Comentários</span><span class="sxs-lookup"><span data-stu-id="6d259-380">Remarks</span></span></th></tr>
<tr><td><span data-ttu-id="6d259-381">Nome</span><span class="sxs-lookup"><span data-stu-id="6d259-381">Name</span></span></td><td><span data-ttu-id="6d259-382">vnet-cass-west-us</span><span class="sxs-lookup"><span data-stu-id="6d259-382">vnet-cass-west-us</span></span></td><td></td></tr>
<tr><td><span data-ttu-id="6d259-383">Região</span><span class="sxs-lookup"><span data-stu-id="6d259-383">Region</span></span></td><td><span data-ttu-id="6d259-384">Oeste dos EUA</span><span class="sxs-lookup"><span data-stu-id="6d259-384">West US</span></span></td><td></td></tr>
<tr><td><span data-ttu-id="6d259-385">Servidores DNS</span><span class="sxs-lookup"><span data-stu-id="6d259-385">DNS Servers</span></span></td><td><span data-ttu-id="6d259-386">Nenhum</span><span class="sxs-lookup"><span data-stu-id="6d259-386">None</span></span></td><td><span data-ttu-id="6d259-387">Ignore isso, pois não estamos usando um servidor DNS</span><span class="sxs-lookup"><span data-stu-id="6d259-387">Ignore this as we are not using a DNS Server</span></span></td></tr>
<tr><td><span data-ttu-id="6d259-388">Espaço de endereço</span><span class="sxs-lookup"><span data-stu-id="6d259-388">Address Space</span></span></td><td><span data-ttu-id="6d259-389">10.1.0.0/16</span><span class="sxs-lookup"><span data-stu-id="6d259-389">10.1.0.0/16</span></span></td><td></td></tr>    
<tr><td><span data-ttu-id="6d259-390">IP Inicial</span><span class="sxs-lookup"><span data-stu-id="6d259-390">Starting IP</span></span></td><td><span data-ttu-id="6d259-391">10.1.0.0</span><span class="sxs-lookup"><span data-stu-id="6d259-391">10.1.0.0</span></span></td><td></td></tr>    
<tr><td><span data-ttu-id="6d259-392">CIDR</span><span class="sxs-lookup"><span data-stu-id="6d259-392">CIDR</span></span> </td><td><span data-ttu-id="6d259-393">/16 (65531)</span><span class="sxs-lookup"><span data-stu-id="6d259-393">/16 (65531)</span></span></td><td></td></tr>
</table>

<span data-ttu-id="6d259-394">Adicione as seguintes sub-redes:</span><span class="sxs-lookup"><span data-stu-id="6d259-394">Add the following subnets:</span></span>

<table>
<tr><th><span data-ttu-id="6d259-395">Name</span><span class="sxs-lookup"><span data-stu-id="6d259-395">Name</span></span></th><th><span data-ttu-id="6d259-396">IP Inicial</span><span class="sxs-lookup"><span data-stu-id="6d259-396">Starting IP</span></span></th><th><span data-ttu-id="6d259-397">CIDR</span><span class="sxs-lookup"><span data-stu-id="6d259-397">CIDR</span></span></th><th><span data-ttu-id="6d259-398">Comentários</span><span class="sxs-lookup"><span data-stu-id="6d259-398">Remarks</span></span></th></tr>
<tr><td><span data-ttu-id="6d259-399">web</span><span class="sxs-lookup"><span data-stu-id="6d259-399">web</span></span></td><td><span data-ttu-id="6d259-400">10.1.1.0</span><span class="sxs-lookup"><span data-stu-id="6d259-400">10.1.1.0</span></span></td><td><span data-ttu-id="6d259-401">/24 (251)</span><span class="sxs-lookup"><span data-stu-id="6d259-401">/24 (251)</span></span></td><td><span data-ttu-id="6d259-402">Sub-rede para a web farm</span><span class="sxs-lookup"><span data-stu-id="6d259-402">Subnet for the web farm</span></span></td></tr>
<tr><td><span data-ttu-id="6d259-403">data</span><span class="sxs-lookup"><span data-stu-id="6d259-403">data</span></span></td><td><span data-ttu-id="6d259-404">10.1.2.0</span><span class="sxs-lookup"><span data-stu-id="6d259-404">10.1.2.0</span></span></td><td><span data-ttu-id="6d259-405">/24 (251)</span><span class="sxs-lookup"><span data-stu-id="6d259-405">/24 (251)</span></span></td><td><span data-ttu-id="6d259-406">Sub-rede para os nós do banco de dados</span><span class="sxs-lookup"><span data-stu-id="6d259-406">Subnet for the database nodes</span></span></td></tr>
</table>

<span data-ttu-id="6d259-407">As sub-redes de Web e Dados podem ser protegidas por meio dos grupos de segurança de rede, a cobertura das mesmas está fora do escopo deste artigo.</span><span class="sxs-lookup"><span data-stu-id="6d259-407">Data and Web subnets can be protected through network security groups the coverage of which is out of scope for this article.</span></span>  

<span data-ttu-id="6d259-408">**Etapa 2: provisionar máquinas virtuais** Usando a imagem criada anteriormente, criaremos as seguintes máquinas virtuais no servidor de nuvem "hk-c-svc-west" e as associaremos às respectivas sub-redes, conforme mostrado abaixo:</span><span class="sxs-lookup"><span data-stu-id="6d259-408">**Step 2: Provision Virtual Machines** Using the image created previously, we will create the following virtual machines in the cloud server “hk-c-svc-west” and bind them to the respective subnets as shown below:</span></span>

<table>
<tr><th><span data-ttu-id="6d259-409">Nome da máquina</span><span class="sxs-lookup"><span data-stu-id="6d259-409">Machine Name</span></span>    </th><th><span data-ttu-id="6d259-410">Sub-rede</span><span class="sxs-lookup"><span data-stu-id="6d259-410">Subnet</span></span>    </th><th><span data-ttu-id="6d259-411">Endereço IP</span><span class="sxs-lookup"><span data-stu-id="6d259-411">IP Address</span></span>    </th><th><span data-ttu-id="6d259-412">Conjunto de disponibilidade</span><span class="sxs-lookup"><span data-stu-id="6d259-412">Availability set</span></span></th><th><span data-ttu-id="6d259-413">DC/Rack</span><span class="sxs-lookup"><span data-stu-id="6d259-413">DC/Rack</span></span></th><th><span data-ttu-id="6d259-414">Propagar?</span><span class="sxs-lookup"><span data-stu-id="6d259-414">Seed?</span></span></th></tr>
<tr><td><span data-ttu-id="6d259-415">hk-c1-west-us</span><span class="sxs-lookup"><span data-stu-id="6d259-415">hk-c1-west-us</span></span>    </td><td><span data-ttu-id="6d259-416">data</span><span class="sxs-lookup"><span data-stu-id="6d259-416">data</span></span>    </td><td><span data-ttu-id="6d259-417">10.1.2.4</span><span class="sxs-lookup"><span data-stu-id="6d259-417">10.1.2.4</span></span>    </td><td><span data-ttu-id="6d259-418">hk-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="6d259-418">hk-c-aset-1</span></span>    </td><td><span data-ttu-id="6d259-419">dc =WESTUS rack =rack1</span><span class="sxs-lookup"><span data-stu-id="6d259-419">dc =WESTUS rack =rack1</span></span> </td><td><span data-ttu-id="6d259-420">Sim</span><span class="sxs-lookup"><span data-stu-id="6d259-420">Yes</span></span></td></tr>
<tr><td><span data-ttu-id="6d259-421">hk-c2-west-us</span><span class="sxs-lookup"><span data-stu-id="6d259-421">hk-c2-west-us</span></span>    </td><td><span data-ttu-id="6d259-422">data</span><span class="sxs-lookup"><span data-stu-id="6d259-422">data</span></span>    </td><td><span data-ttu-id="6d259-423">10.1.2.5</span><span class="sxs-lookup"><span data-stu-id="6d259-423">10.1.2.5</span></span>    </td><td><span data-ttu-id="6d259-424">hk-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="6d259-424">hk-c-aset-1</span></span>    </td><td><span data-ttu-id="6d259-425">dc =WESTUS rack =rack1</span><span class="sxs-lookup"><span data-stu-id="6d259-425">dc =WESTUS rack =rack1</span></span>    </td><td><span data-ttu-id="6d259-426">Não</span><span class="sxs-lookup"><span data-stu-id="6d259-426">No</span></span> </td></tr>
<tr><td><span data-ttu-id="6d259-427">hk-c3-west-us</span><span class="sxs-lookup"><span data-stu-id="6d259-427">hk-c3-west-us</span></span>    </td><td><span data-ttu-id="6d259-428">data</span><span class="sxs-lookup"><span data-stu-id="6d259-428">data</span></span>    </td><td><span data-ttu-id="6d259-429">10.1.2.6</span><span class="sxs-lookup"><span data-stu-id="6d259-429">10.1.2.6</span></span>    </td><td><span data-ttu-id="6d259-430">hk-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="6d259-430">hk-c-aset-1</span></span>    </td><td><span data-ttu-id="6d259-431">dc =WESTUS rack =rack2</span><span class="sxs-lookup"><span data-stu-id="6d259-431">dc =WESTUS rack =rack2</span></span>    </td><td><span data-ttu-id="6d259-432">Sim</span><span class="sxs-lookup"><span data-stu-id="6d259-432">Yes</span></span></td></tr>
<tr><td><span data-ttu-id="6d259-433">hk-c4-west-us</span><span class="sxs-lookup"><span data-stu-id="6d259-433">hk-c4-west-us</span></span>    </td><td><span data-ttu-id="6d259-434">data</span><span class="sxs-lookup"><span data-stu-id="6d259-434">data</span></span>    </td><td><span data-ttu-id="6d259-435">10.1.2.7</span><span class="sxs-lookup"><span data-stu-id="6d259-435">10.1.2.7</span></span>    </td><td><span data-ttu-id="6d259-436">hk-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="6d259-436">hk-c-aset-1</span></span>    </td><td><span data-ttu-id="6d259-437">dc =WESTUS rack =rack2</span><span class="sxs-lookup"><span data-stu-id="6d259-437">dc =WESTUS rack =rack2</span></span>    </td><td><span data-ttu-id="6d259-438">Não</span><span class="sxs-lookup"><span data-stu-id="6d259-438">No</span></span> </td></tr>
<tr><td><span data-ttu-id="6d259-439">hk-c5-west-us</span><span class="sxs-lookup"><span data-stu-id="6d259-439">hk-c5-west-us</span></span>    </td><td><span data-ttu-id="6d259-440">data</span><span class="sxs-lookup"><span data-stu-id="6d259-440">data</span></span>    </td><td><span data-ttu-id="6d259-441">10.1.2.8</span><span class="sxs-lookup"><span data-stu-id="6d259-441">10.1.2.8</span></span>    </td><td><span data-ttu-id="6d259-442">hk-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="6d259-442">hk-c-aset-2</span></span>    </td><td><span data-ttu-id="6d259-443">dc =WESTUS rack =rack3</span><span class="sxs-lookup"><span data-stu-id="6d259-443">dc =WESTUS rack =rack3</span></span>    </td><td><span data-ttu-id="6d259-444">Sim</span><span class="sxs-lookup"><span data-stu-id="6d259-444">Yes</span></span></td></tr>
<tr><td><span data-ttu-id="6d259-445">hk-c6-west-us</span><span class="sxs-lookup"><span data-stu-id="6d259-445">hk-c6-west-us</span></span>    </td><td><span data-ttu-id="6d259-446">data</span><span class="sxs-lookup"><span data-stu-id="6d259-446">data</span></span>    </td><td><span data-ttu-id="6d259-447">10.1.2.9</span><span class="sxs-lookup"><span data-stu-id="6d259-447">10.1.2.9</span></span>    </td><td><span data-ttu-id="6d259-448">hk-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="6d259-448">hk-c-aset-2</span></span>    </td><td><span data-ttu-id="6d259-449">dc =WESTUS rack =rack3</span><span class="sxs-lookup"><span data-stu-id="6d259-449">dc =WESTUS rack =rack3</span></span>    </td><td><span data-ttu-id="6d259-450">Não</span><span class="sxs-lookup"><span data-stu-id="6d259-450">No</span></span> </td></tr>
<tr><td><span data-ttu-id="6d259-451">hk-c7-west-us</span><span class="sxs-lookup"><span data-stu-id="6d259-451">hk-c7-west-us</span></span>    </td><td><span data-ttu-id="6d259-452">data</span><span class="sxs-lookup"><span data-stu-id="6d259-452">data</span></span>    </td><td><span data-ttu-id="6d259-453">10.1.2.10</span><span class="sxs-lookup"><span data-stu-id="6d259-453">10.1.2.10</span></span>    </td><td><span data-ttu-id="6d259-454">hk-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="6d259-454">hk-c-aset-2</span></span>    </td><td><span data-ttu-id="6d259-455">dc =WESTUS rack =rack4</span><span class="sxs-lookup"><span data-stu-id="6d259-455">dc =WESTUS rack =rack4</span></span>    </td><td><span data-ttu-id="6d259-456">Sim</span><span class="sxs-lookup"><span data-stu-id="6d259-456">Yes</span></span></td></tr>
<tr><td><span data-ttu-id="6d259-457">hk-c8-west-us</span><span class="sxs-lookup"><span data-stu-id="6d259-457">hk-c8-west-us</span></span>    </td><td><span data-ttu-id="6d259-458">data</span><span class="sxs-lookup"><span data-stu-id="6d259-458">data</span></span>    </td><td><span data-ttu-id="6d259-459">10.1.2.11</span><span class="sxs-lookup"><span data-stu-id="6d259-459">10.1.2.11</span></span>    </td><td><span data-ttu-id="6d259-460">hk-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="6d259-460">hk-c-aset-2</span></span>    </td><td><span data-ttu-id="6d259-461">dc =WESTUS rack =rack4</span><span class="sxs-lookup"><span data-stu-id="6d259-461">dc =WESTUS rack =rack4</span></span>    </td><td><span data-ttu-id="6d259-462">Não</span><span class="sxs-lookup"><span data-stu-id="6d259-462">No</span></span> </td></tr>
<tr><td><span data-ttu-id="6d259-463">hk-w1-west-us</span><span class="sxs-lookup"><span data-stu-id="6d259-463">hk-w1-west-us</span></span>    </td><td><span data-ttu-id="6d259-464">web</span><span class="sxs-lookup"><span data-stu-id="6d259-464">web</span></span>    </td><td><span data-ttu-id="6d259-465">10.1.1.4</span><span class="sxs-lookup"><span data-stu-id="6d259-465">10.1.1.4</span></span>    </td><td><span data-ttu-id="6d259-466">hk-w-aset-1</span><span class="sxs-lookup"><span data-stu-id="6d259-466">hk-w-aset-1</span></span>    </td><td>                       </td><td><span data-ttu-id="6d259-467">N/D</span><span class="sxs-lookup"><span data-stu-id="6d259-467">N/A</span></span></td></tr>
<tr><td><span data-ttu-id="6d259-468">hk-w2-west-us</span><span class="sxs-lookup"><span data-stu-id="6d259-468">hk-w2-west-us</span></span>    </td><td><span data-ttu-id="6d259-469">web</span><span class="sxs-lookup"><span data-stu-id="6d259-469">web</span></span>    </td><td><span data-ttu-id="6d259-470">10.1.1.5</span><span class="sxs-lookup"><span data-stu-id="6d259-470">10.1.1.5</span></span>    </td><td><span data-ttu-id="6d259-471">hk-w-aset-1</span><span class="sxs-lookup"><span data-stu-id="6d259-471">hk-w-aset-1</span></span>    </td><td>                       </td><td><span data-ttu-id="6d259-472">N/D</span><span class="sxs-lookup"><span data-stu-id="6d259-472">N/A</span></span></td></tr>
</table>

<span data-ttu-id="6d259-473">A criação da lista de VMs mencionada acima exige o seguinte processo:</span><span class="sxs-lookup"><span data-stu-id="6d259-473">Creation of the above list of VMs requires the following process:</span></span>

1. <span data-ttu-id="6d259-474">Crie um serviço de nuvem vazio em uma determinada região</span><span class="sxs-lookup"><span data-stu-id="6d259-474">Create an empty cloud service in a particular region</span></span>
2. <span data-ttu-id="6d259-475">Crie uma VM por meio da imagem capturada anteriormente e anexe-a à rede virtual criada anteriormente; repita esta etapa para todas as VMs</span><span class="sxs-lookup"><span data-stu-id="6d259-475">Create a VM from the previously captured image and attach it to the virtual network created previously; repeat this for all the VMs</span></span>
3. <span data-ttu-id="6d259-476">Adicione um balanceador de carga interno ao serviço de nuvem e anexe-o à sub-rede "dados"</span><span class="sxs-lookup"><span data-stu-id="6d259-476">Add an internal load balancer to the cloud service and attach it to the “data” subnet</span></span>
4. <span data-ttu-id="6d259-477">Para cada VM criada anteriormente, adicione um ponto de extremidade com balanceamento de carga para o tráfego de poupança através de um conjunto de balanceamento de carga conectado ao balanceador de carga interno criado anteriormente</span><span class="sxs-lookup"><span data-stu-id="6d259-477">For each VM created previously, add a load balanced endpoint for thrift traffic through a load balanced set connected to the previously created internal load balancer</span></span>

<span data-ttu-id="6d259-478">O processo acima pode ser executado usando o portal clássico do Azure; use um computador com o Windows (ou uma VM no Azure, caso você não tenha acesso a um computador com o Windows), use o script do PowerShell a seguir para provisionar todas as 8 VMs automaticamente.</span><span class="sxs-lookup"><span data-stu-id="6d259-478">The above process can be executed using Azure classic portal; use a Windows machine (use a VM on Azure if you don't have access to a Windows machine), use the following PowerShell script to provision all 8 VMs automatically.</span></span>

<span data-ttu-id="6d259-479">**Lista 1: script do PowerShell para provisionamento de máquinas virtuais**</span><span class="sxs-lookup"><span data-stu-id="6d259-479">**List 1: PowerShell script for provisioning virtual machines**</span></span>

        #Tested with Azure Powershell - November 2014
        #This powershell script deployes a number of VMs from an existing image inside an Azure region
        #Import your Azure subscription into the current Powershell session before proceeding
        #The process: 1. create Azure Storage account, 2. create virtual network, 3.create the VM template, 2. crate a list of VMs from the template

        #fundamental variables - change these to reflect your subscription
        $country="us"; $region="west"; $vnetName = "your_vnet_name";$storageAccount="your_storage_account"
        $numVMs=8;$prefix = "hk-cass";$ilbIP="your_ilb_ip"
        $subscriptionName = "Azure_subscription_name";
        $vmSize="ExtraSmall"; $imageName="your_linux_image_name"
        $ilbName="ThriftInternalLB"; $thriftEndPoint="ThriftEndPoint"

        #generated variables
        $serviceName = "$prefix-svc-$region-$country"; $azureRegion = "$region $country"

        $vmNames = @()
        for ($i=0; $i -lt $numVMs; $i++)
        {
           $vmNames+=("$prefix-vm"+($i+1) + "-$region-$country" );
        }

        #select an Azure subscription already imported into Powershell session
        Select-AzureSubscription -SubscriptionName $subscriptionName -Current
        Set-AzureSubscription -SubscriptionName $subscriptionName -CurrentStorageAccountName $storageAccount

        #create an empty cloud service
        New-AzureService -ServiceName $serviceName -Label "hkcass$region" -Location $azureRegion
        Write-Host "Created $serviceName"

        $VMList= @()   # stores the list of azure vm configuration objects
        #create the list of VMs
        foreach($vmName in $vmNames)
        {
           $VMList += New-AzureVMConfig -Name $vmName -InstanceSize ExtraSmall -ImageName $imageName |
           Add-AzureProvisioningConfig -Linux -LinuxUser "localadmin" -Password "Local123" |
           Set-AzureSubnet "data"
        }

        New-AzureVM -ServiceName $serviceName -VNetName $vnetName -VMs $VMList

        #Create internal load balancer
        Add-AzureInternalLoadBalancer -ServiceName $serviceName -InternalLoadBalancerName $ilbName -SubnetName "data" -StaticVNetIPAddress "$ilbIP"
        Write-Host "Created $ilbName"
        #Add add the thrift endpoint to the internal load balancer for all the VMs
        foreach($vmName in $vmNames)
        {
            Get-AzureVM -ServiceName $serviceName -Name $vmName |
                Add-AzureEndpoint -Name $thriftEndPoint -LBSetName "ThriftLBSet" -Protocol tcp -LocalPort 9160 -PublicPort 9160 -ProbePort 9160 -ProbeProtocol tcp -ProbeIntervalInSeconds 10 -InternalLoadBalancerName $ilbName |
                Update-AzureVM

            Write-Host "created $vmName"     
        }

<span data-ttu-id="6d259-480">**Etapa 3: configurar o Cassandra em cada VM**</span><span class="sxs-lookup"><span data-stu-id="6d259-480">**Step 3: Configure Cassandra on each VM**</span></span>

<span data-ttu-id="6d259-481">Faça logon na VM e execute o seguinte procedimento:</span><span class="sxs-lookup"><span data-stu-id="6d259-481">Log into the VM and perform the following:</span></span>

* <span data-ttu-id="6d259-482">Edite $CASS_HOME/conf/cassandra-rackdc.properties para especificar as propriedades de data center e rack:</span><span class="sxs-lookup"><span data-stu-id="6d259-482">Edit $CASS_HOME/conf/cassandra-rackdc.properties to specify the data center and rack properties:</span></span>
  
       dc =EASTUS, rack =rack1
* <span data-ttu-id="6d259-483">Edite cassandra.yaml para configurar os nós de propagação, conforme abaixo:</span><span class="sxs-lookup"><span data-stu-id="6d259-483">Edit cassandra.yaml to configure seed nodes as below:</span></span>
  
       Seeds: "10.1.2.4,10.1.2.6,10.1.2.8,10.1.2.10"

<span data-ttu-id="6d259-484">**Etapa 4: iniciar as VMs e testar o cluster**</span><span class="sxs-lookup"><span data-stu-id="6d259-484">**Step 4: Start the VMs and test the cluster**</span></span>

<span data-ttu-id="6d259-485">Faça logon em um dos nós (por exemplo, hk-c1-west-us) e execute o seguinte comando para ver o status do cluster:</span><span class="sxs-lookup"><span data-stu-id="6d259-485">Log into one of the nodes (e.g. hk-c1-west-us) and run the following command to see the status of the cluster:</span></span>

       nodetool –h 10.1.2.4 –p 7199 status

<span data-ttu-id="6d259-486">Você deverá ver uma tela semelhante à seguinte para um cluster de 8 nós:</span><span class="sxs-lookup"><span data-stu-id="6d259-486">You should see the display similar to the one below for an 8-node cluster:</span></span>

<table>
<tr><th><span data-ttu-id="6d259-487">Status</span><span class="sxs-lookup"><span data-stu-id="6d259-487">Status</span></span></th><th><span data-ttu-id="6d259-488">Endereço</span><span class="sxs-lookup"><span data-stu-id="6d259-488">Address</span></span>    </th><th><span data-ttu-id="6d259-489">Carregar</span><span class="sxs-lookup"><span data-stu-id="6d259-489">Load</span></span>    </th><th><span data-ttu-id="6d259-490">Tokens</span><span class="sxs-lookup"><span data-stu-id="6d259-490">Tokens</span></span>    </th><th><span data-ttu-id="6d259-491">Possui</span><span class="sxs-lookup"><span data-stu-id="6d259-491">Owns</span></span> </th><th><span data-ttu-id="6d259-492">ID do host</span><span class="sxs-lookup"><span data-stu-id="6d259-492">Host ID</span></span>    </th><th><span data-ttu-id="6d259-493">Rack</span><span class="sxs-lookup"><span data-stu-id="6d259-493">Rack</span></span></th></tr>
<tr><th><span data-ttu-id="6d259-494">UN</span><span class="sxs-lookup"><span data-stu-id="6d259-494">UN</span></span>    </td><td><span data-ttu-id="6d259-495">10.1.2.4</span><span class="sxs-lookup"><span data-stu-id="6d259-495">10.1.2.4</span></span>     </td><td><span data-ttu-id="6d259-496">87.81 KB</span><span class="sxs-lookup"><span data-stu-id="6d259-496">87.81 KB</span></span>    </td><td><span data-ttu-id="6d259-497">256</span><span class="sxs-lookup"><span data-stu-id="6d259-497">256</span></span>    </td><td><span data-ttu-id="6d259-498">38,0%</span><span class="sxs-lookup"><span data-stu-id="6d259-498">38.0%</span></span>    </td><td><span data-ttu-id="6d259-499">Guid (removido)</span><span class="sxs-lookup"><span data-stu-id="6d259-499">Guid (removed)</span></span></td><td><span data-ttu-id="6d259-500">rack1</span><span class="sxs-lookup"><span data-stu-id="6d259-500">rack1</span></span></td></tr>
<tr><th><span data-ttu-id="6d259-501">UN</span><span class="sxs-lookup"><span data-stu-id="6d259-501">UN</span></span>    </td><td><span data-ttu-id="6d259-502">10.1.2.5</span><span class="sxs-lookup"><span data-stu-id="6d259-502">10.1.2.5</span></span>     </td><td><span data-ttu-id="6d259-503">41.08 KB</span><span class="sxs-lookup"><span data-stu-id="6d259-503">41.08 KB</span></span>    </td><td><span data-ttu-id="6d259-504">256</span><span class="sxs-lookup"><span data-stu-id="6d259-504">256</span></span>    </td><td><span data-ttu-id="6d259-505">68.9%</span><span class="sxs-lookup"><span data-stu-id="6d259-505">68.9%</span></span>    </td><td><span data-ttu-id="6d259-506">Guid (removido)</span><span class="sxs-lookup"><span data-stu-id="6d259-506">Guid (removed)</span></span></td><td><span data-ttu-id="6d259-507">rack1</span><span class="sxs-lookup"><span data-stu-id="6d259-507">rack1</span></span></td></tr>
<tr><th><span data-ttu-id="6d259-508">UN</span><span class="sxs-lookup"><span data-stu-id="6d259-508">UN</span></span>    </td><td><span data-ttu-id="6d259-509">10.1.2.6</span><span class="sxs-lookup"><span data-stu-id="6d259-509">10.1.2.6</span></span>     </td><td><span data-ttu-id="6d259-510">55.29 KB</span><span class="sxs-lookup"><span data-stu-id="6d259-510">55.29 KB</span></span>    </td><td><span data-ttu-id="6d259-511">256</span><span class="sxs-lookup"><span data-stu-id="6d259-511">256</span></span>    </td><td><span data-ttu-id="6d259-512">68.8%</span><span class="sxs-lookup"><span data-stu-id="6d259-512">68.8%</span></span>    </td><td><span data-ttu-id="6d259-513">Guid (removido)</span><span class="sxs-lookup"><span data-stu-id="6d259-513">Guid (removed)</span></span></td><td><span data-ttu-id="6d259-514">rack2</span><span class="sxs-lookup"><span data-stu-id="6d259-514">rack2</span></span></td></tr>
<tr><th><span data-ttu-id="6d259-515">UN</span><span class="sxs-lookup"><span data-stu-id="6d259-515">UN</span></span>    </td><td><span data-ttu-id="6d259-516">10.1.2.7</span><span class="sxs-lookup"><span data-stu-id="6d259-516">10.1.2.7</span></span>     </td><td><span data-ttu-id="6d259-517">55.29 KB</span><span class="sxs-lookup"><span data-stu-id="6d259-517">55.29 KB</span></span>    </td><td><span data-ttu-id="6d259-518">256</span><span class="sxs-lookup"><span data-stu-id="6d259-518">256</span></span>    </td><td><span data-ttu-id="6d259-519">68.8%</span><span class="sxs-lookup"><span data-stu-id="6d259-519">68.8%</span></span>    </td><td><span data-ttu-id="6d259-520">Guid (removido)</span><span class="sxs-lookup"><span data-stu-id="6d259-520">Guid (removed)</span></span></td><td><span data-ttu-id="6d259-521">rack2</span><span class="sxs-lookup"><span data-stu-id="6d259-521">rack2</span></span></td></tr>
<tr><th><span data-ttu-id="6d259-522">UN</span><span class="sxs-lookup"><span data-stu-id="6d259-522">UN</span></span>    </td><td><span data-ttu-id="6d259-523">10.1.2.8</span><span class="sxs-lookup"><span data-stu-id="6d259-523">10.1.2.8</span></span>     </td><td><span data-ttu-id="6d259-524">55.29 KB</span><span class="sxs-lookup"><span data-stu-id="6d259-524">55.29 KB</span></span>    </td><td><span data-ttu-id="6d259-525">256</span><span class="sxs-lookup"><span data-stu-id="6d259-525">256</span></span>    </td><td><span data-ttu-id="6d259-526">68.8%</span><span class="sxs-lookup"><span data-stu-id="6d259-526">68.8%</span></span>    </td><td><span data-ttu-id="6d259-527">Guid (removido)</span><span class="sxs-lookup"><span data-stu-id="6d259-527">Guid (removed)</span></span></td><td><span data-ttu-id="6d259-528">rack3</span><span class="sxs-lookup"><span data-stu-id="6d259-528">rack3</span></span></td></tr>
<tr><th><span data-ttu-id="6d259-529">UN</span><span class="sxs-lookup"><span data-stu-id="6d259-529">UN</span></span>    </td><td><span data-ttu-id="6d259-530">10.1.2.9</span><span class="sxs-lookup"><span data-stu-id="6d259-530">10.1.2.9</span></span>     </td><td><span data-ttu-id="6d259-531">55.29 KB</span><span class="sxs-lookup"><span data-stu-id="6d259-531">55.29 KB</span></span>    </td><td><span data-ttu-id="6d259-532">256</span><span class="sxs-lookup"><span data-stu-id="6d259-532">256</span></span>    </td><td><span data-ttu-id="6d259-533">68.8%</span><span class="sxs-lookup"><span data-stu-id="6d259-533">68.8%</span></span>    </td><td><span data-ttu-id="6d259-534">Guid (removido)</span><span class="sxs-lookup"><span data-stu-id="6d259-534">Guid (removed)</span></span></td><td><span data-ttu-id="6d259-535">rack3</span><span class="sxs-lookup"><span data-stu-id="6d259-535">rack3</span></span></td></tr>
<tr><th><span data-ttu-id="6d259-536">UN</span><span class="sxs-lookup"><span data-stu-id="6d259-536">UN</span></span>    </td><td><span data-ttu-id="6d259-537">10.1.2.10</span><span class="sxs-lookup"><span data-stu-id="6d259-537">10.1.2.10</span></span>     </td><td><span data-ttu-id="6d259-538">55.29 KB</span><span class="sxs-lookup"><span data-stu-id="6d259-538">55.29 KB</span></span>    </td><td><span data-ttu-id="6d259-539">256</span><span class="sxs-lookup"><span data-stu-id="6d259-539">256</span></span>    </td><td><span data-ttu-id="6d259-540">68.8%</span><span class="sxs-lookup"><span data-stu-id="6d259-540">68.8%</span></span>    </td><td><span data-ttu-id="6d259-541">Guid (removido)</span><span class="sxs-lookup"><span data-stu-id="6d259-541">Guid (removed)</span></span></td><td><span data-ttu-id="6d259-542">rack4</span><span class="sxs-lookup"><span data-stu-id="6d259-542">rack4</span></span></td></tr>
<tr><th><span data-ttu-id="6d259-543">UN</span><span class="sxs-lookup"><span data-stu-id="6d259-543">UN</span></span>    </td><td><span data-ttu-id="6d259-544">10.1.2.11</span><span class="sxs-lookup"><span data-stu-id="6d259-544">10.1.2.11</span></span>     </td><td><span data-ttu-id="6d259-545">55.29 KB</span><span class="sxs-lookup"><span data-stu-id="6d259-545">55.29 KB</span></span>    </td><td><span data-ttu-id="6d259-546">256</span><span class="sxs-lookup"><span data-stu-id="6d259-546">256</span></span>    </td><td><span data-ttu-id="6d259-547">68.8%</span><span class="sxs-lookup"><span data-stu-id="6d259-547">68.8%</span></span>    </td><td><span data-ttu-id="6d259-548">Guid (removido)</span><span class="sxs-lookup"><span data-stu-id="6d259-548">Guid (removed)</span></span></td><td><span data-ttu-id="6d259-549">rack4</span><span class="sxs-lookup"><span data-stu-id="6d259-549">rack4</span></span></td></tr>
</table>

## <a name="test-the-single-region-cluster"></a><span data-ttu-id="6d259-550">Testar o cluster de região única</span><span class="sxs-lookup"><span data-stu-id="6d259-550">Test the Single Region Cluster</span></span>
<span data-ttu-id="6d259-551">Use as etapas a seguir para testar o cluster:</span><span class="sxs-lookup"><span data-stu-id="6d259-551">Use the following steps to test the cluster:</span></span>

1. <span data-ttu-id="6d259-552">Usando o comando do Powershell Get-AzureInternalLoadbalancer commandlet, obtenha o endereço IP do balanceador de carga interno (por exemplo, 10.1.2.101).</span><span class="sxs-lookup"><span data-stu-id="6d259-552">Using the Powershell command Get-AzureInternalLoadbalancer commandlet, obtain the IP address of the internal load balancer (e.g.  10.1.2.101).</span></span> <span data-ttu-id="6d259-553">A sintaxe do comando é mostrada abaixo: Get-AzureLoadbalancer –ServiceName "hk-c-svc-west-us" [exibe os detalhes do balanceador de carga interno juntamente com seu endereço IP]</span><span class="sxs-lookup"><span data-stu-id="6d259-553">The syntax of the command is shown below: Get-AzureLoadbalancer –ServiceName "hk-c-svc-west-us” [displays the details of the internal load balancer along with its IP address]</span></span>
2. <span data-ttu-id="6d259-554">Faça logon na web farm VM (por exemplo, hk-w1-west-us) usando Putty ou ssh</span><span class="sxs-lookup"><span data-stu-id="6d259-554">Log into the web farm VM (e.g. hk-w1-west-us) using Putty or ssh</span></span>
3. <span data-ttu-id="6d259-555">Execute $CASS_HOME/bin/cqlsh 10.1.2.101 9160</span><span class="sxs-lookup"><span data-stu-id="6d259-555">Execute $CASS_HOME/bin/cqlsh 10.1.2.101 9160</span></span>
4. <span data-ttu-id="6d259-556">Use os seguintes comandos CQL para verificar se o cluster está funcionando:</span><span class="sxs-lookup"><span data-stu-id="6d259-556">Use the following CQL commands to verify if the cluster is working:</span></span>
   
     <span data-ttu-id="6d259-557">CREATE KEYSPACE customers_ks WITH REPLICATION = { 'class' : 'SimpleStrategy', 'replication_factor' : 3 };   USE customers_ks;   CREATE TABLE Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   INSERT INTO Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   INSERT INTO Customers(customer_id, firstname, lastname) VALUES (2, 'Jane', 'Doe');</span><span class="sxs-lookup"><span data-stu-id="6d259-557">CREATE KEYSPACE customers_ks WITH REPLICATION = { 'class' : 'SimpleStrategy', 'replication_factor' : 3 };   USE customers_ks;   CREATE TABLE Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   INSERT INTO Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   INSERT INTO Customers(customer_id, firstname, lastname) VALUES (2, 'Jane', 'Doe');</span></span>
   
     <span data-ttu-id="6d259-558">SELECT * FROM Customers;</span><span class="sxs-lookup"><span data-stu-id="6d259-558">SELECT * FROM Customers;</span></span>

<span data-ttu-id="6d259-559">Você deve ver uma tela como a mostrada abaixo:</span><span class="sxs-lookup"><span data-stu-id="6d259-559">You should see a display like the one below:</span></span>

<table>
  <tr><th> <span data-ttu-id="6d259-560">customer_id</span><span class="sxs-lookup"><span data-stu-id="6d259-560">customer_id</span></span> </th><th> <span data-ttu-id="6d259-561">nome</span><span class="sxs-lookup"><span data-stu-id="6d259-561">firstname</span></span> </th><th> <span data-ttu-id="6d259-562">Sobrenome</span><span class="sxs-lookup"><span data-stu-id="6d259-562">lastname</span></span> </th></tr>
  <tr><td> <span data-ttu-id="6d259-563">1</span><span class="sxs-lookup"><span data-stu-id="6d259-563">1</span></span> </td><td> <span data-ttu-id="6d259-564">John</span><span class="sxs-lookup"><span data-stu-id="6d259-564">John</span></span> </td><td> <span data-ttu-id="6d259-565">Doe</span><span class="sxs-lookup"><span data-stu-id="6d259-565">Doe</span></span> </td></tr>
  <tr><td> <span data-ttu-id="6d259-566">2</span><span class="sxs-lookup"><span data-stu-id="6d259-566">2</span></span> </td><td> <span data-ttu-id="6d259-567">Jane</span><span class="sxs-lookup"><span data-stu-id="6d259-567">Jane</span></span> </td><td> <span data-ttu-id="6d259-568">Doe</span><span class="sxs-lookup"><span data-stu-id="6d259-568">Doe</span></span> </td></tr>
</table>

<span data-ttu-id="6d259-569">Observe que o keyspace criado na etapa 4 usa SimpleStrategy com um replication_factor de 3.</span><span class="sxs-lookup"><span data-stu-id="6d259-569">Please note that the keyspace created in step 4 uses SimpleStrategy with a  replication_factor of 3.</span></span> <span data-ttu-id="6d259-570">SimpleStrategy é recomendado para implantações únicas de data center, enquanto NetworkTopologyStrategy é recomendado para implantações de vários data centers.</span><span class="sxs-lookup"><span data-stu-id="6d259-570">SimpleStrategy is recommended for single data center deployments whereas NetworkTopologyStrategy for multi-data center deployments.</span></span> <span data-ttu-id="6d259-571">Um replication_factor de 3 fornecerá tolerância às falhas do nó.</span><span class="sxs-lookup"><span data-stu-id="6d259-571">A replication_factor of 3 will give tolerance for node failures.</span></span>

## <span data-ttu-id="6d259-572"><a id="tworegion"> </a>Processo de implantação de várias regiões</span><span class="sxs-lookup"><span data-stu-id="6d259-572"><a id="tworegion"> </a>Multi-Region Deployment Process</span></span>
<span data-ttu-id="6d259-573">Utilizará a implantação de região única concluída e repetirá o mesmo processo para instalar a segunda região.</span><span class="sxs-lookup"><span data-stu-id="6d259-573">Will leverage the single region deployment completed and repeat the same process for installing the second region.</span></span> <span data-ttu-id="6d259-574">A principal diferença entre a implantação de região única e a de várias regiões é a configuração de túnel VPN para comunicação entre regiões; começaremos com a instalação de rede, provisionamento de VMs e configuração de Cassandra.</span><span class="sxs-lookup"><span data-stu-id="6d259-574">The key difference between the single and multiple region deployment is the VPN tunnel setup for inter-region communication; we will start with the network installation, provision the VMs and configure Cassandra.</span></span>

### <a name="step-1-create-the-virtual-network-at-the-2nd-region"></a><span data-ttu-id="6d259-575">Etapa 1: criar uma rede virtual na 2ª região</span><span class="sxs-lookup"><span data-stu-id="6d259-575">Step 1: Create the Virtual Network at the 2nd Region</span></span>
<span data-ttu-id="6d259-576">Faça logon no portal clássico do Azure e crie uma Rede Virtual com os atributos mostrados na tabela.</span><span class="sxs-lookup"><span data-stu-id="6d259-576">Log into the Azure classic portal and create a Virtual Network with the attributes show in the table.</span></span> <span data-ttu-id="6d259-577">Confira [Configurar uma rede virtual somente na nuvem no portal clássico do Azure](../../../virtual-network/virtual-networks-create-vnet-classic-pportal.md) para obter as etapas detalhadas do processo.</span><span class="sxs-lookup"><span data-stu-id="6d259-577">See [Configure a Cloud-Only Virtual Network in the Azure classic portal](../../../virtual-network/virtual-networks-create-vnet-classic-pportal.md) for detailed steps of the process.</span></span>      

<table>
<tr><th><span data-ttu-id="6d259-578">Nome do atributo</span><span class="sxs-lookup"><span data-stu-id="6d259-578">Attribute Name</span></span>    </th><th><span data-ttu-id="6d259-579">Valor</span><span class="sxs-lookup"><span data-stu-id="6d259-579">Value</span></span>    </th><th><span data-ttu-id="6d259-580">Comentários</span><span class="sxs-lookup"><span data-stu-id="6d259-580">Remarks</span></span></th></tr>
<tr><td><span data-ttu-id="6d259-581">Name</span><span class="sxs-lookup"><span data-stu-id="6d259-581">Name</span></span>    </td><td><span data-ttu-id="6d259-582">vnet-cass-east-us</span><span class="sxs-lookup"><span data-stu-id="6d259-582">vnet-cass-east-us</span></span></td><td></td></tr>
<tr><td><span data-ttu-id="6d259-583">Região</span><span class="sxs-lookup"><span data-stu-id="6d259-583">Region</span></span>    </td><td><span data-ttu-id="6d259-584">Leste dos EUA</span><span class="sxs-lookup"><span data-stu-id="6d259-584">East US</span></span></td><td></td></tr>
<tr><td><span data-ttu-id="6d259-585">Servidores DNS</span><span class="sxs-lookup"><span data-stu-id="6d259-585">DNS Servers</span></span>        </td><td></td><td><span data-ttu-id="6d259-586">Ignore isso, pois não estamos usando um servidor DNS</span><span class="sxs-lookup"><span data-stu-id="6d259-586">Ignore this as we are not using a DNS Server</span></span></td></tr>
<tr><td><span data-ttu-id="6d259-587">Configurar uma VPN ponto a site</span><span class="sxs-lookup"><span data-stu-id="6d259-587">Configure a point-to-site VPN</span></span></td><td></td><td>        <span data-ttu-id="6d259-588">Ignore isso</span><span class="sxs-lookup"><span data-stu-id="6d259-588">Ignore this</span></span></td></tr>
<tr><td><span data-ttu-id="6d259-589">Configurar uma VPN site a site</span><span class="sxs-lookup"><span data-stu-id="6d259-589">Configure a site-to-site VPN</span></span></td><td></td><td>        <span data-ttu-id="6d259-590">Ignore isso</span><span class="sxs-lookup"><span data-stu-id="6d259-590">Ignore this</span></span></td></tr>
<tr><td><span data-ttu-id="6d259-591">Espaço de endereço</span><span class="sxs-lookup"><span data-stu-id="6d259-591">Address Space</span></span>    </td><td><span data-ttu-id="6d259-592">10.2.0.0/16</span><span class="sxs-lookup"><span data-stu-id="6d259-592">10.2.0.0/16</span></span></td><td></td></tr>
<tr><td><span data-ttu-id="6d259-593">IP Inicial</span><span class="sxs-lookup"><span data-stu-id="6d259-593">Starting IP</span></span>    </td><td><span data-ttu-id="6d259-594">10.2.0.0</span><span class="sxs-lookup"><span data-stu-id="6d259-594">10.2.0.0</span></span>    </td><td></td></tr>
<tr><td><span data-ttu-id="6d259-595">CIDR</span><span class="sxs-lookup"><span data-stu-id="6d259-595">CIDR</span></span>    </td><td><span data-ttu-id="6d259-596">/16 (65531)</span><span class="sxs-lookup"><span data-stu-id="6d259-596">/16 (65531)</span></span></td><td></td></tr>
</table>

<span data-ttu-id="6d259-597">Adicione as seguintes sub-redes:</span><span class="sxs-lookup"><span data-stu-id="6d259-597">Add the following subnets:</span></span>

<table>
<tr><th><span data-ttu-id="6d259-598">Name</span><span class="sxs-lookup"><span data-stu-id="6d259-598">Name</span></span>    </th><th><span data-ttu-id="6d259-599">IP Inicial</span><span class="sxs-lookup"><span data-stu-id="6d259-599">Starting IP</span></span>    </th><th><span data-ttu-id="6d259-600">CIDR</span><span class="sxs-lookup"><span data-stu-id="6d259-600">CIDR</span></span>    </th><th><span data-ttu-id="6d259-601">Comentários</span><span class="sxs-lookup"><span data-stu-id="6d259-601">Remarks</span></span></th></tr>
<tr><td><span data-ttu-id="6d259-602">web</span><span class="sxs-lookup"><span data-stu-id="6d259-602">web</span></span>    </td><td><span data-ttu-id="6d259-603">10.2.1.0</span><span class="sxs-lookup"><span data-stu-id="6d259-603">10.2.1.0</span></span>    </td><td><span data-ttu-id="6d259-604">/24 (251)</span><span class="sxs-lookup"><span data-stu-id="6d259-604">/24 (251)</span></span>    </td><td><span data-ttu-id="6d259-605">Sub-rede para a web farm</span><span class="sxs-lookup"><span data-stu-id="6d259-605">Subnet for the web farm</span></span></td></tr>
<tr><td><span data-ttu-id="6d259-606">data</span><span class="sxs-lookup"><span data-stu-id="6d259-606">data</span></span>    </td><td><span data-ttu-id="6d259-607">10.2.2.0</span><span class="sxs-lookup"><span data-stu-id="6d259-607">10.2.2.0</span></span>    </td><td><span data-ttu-id="6d259-608">/24 (251)</span><span class="sxs-lookup"><span data-stu-id="6d259-608">/24 (251)</span></span>    </td><td><span data-ttu-id="6d259-609">Sub-rede para os nós do banco de dados</span><span class="sxs-lookup"><span data-stu-id="6d259-609">Subnet for the database nodes</span></span></td></tr>
</table>


### <a name="step-2-create-local-networks"></a><span data-ttu-id="6d259-610">Etapa 2: criar Redes Locais</span><span class="sxs-lookup"><span data-stu-id="6d259-610">Step 2: Create Local Networks</span></span>
<span data-ttu-id="6d259-611">Uma Rede Local na rede virtual do Azure é um espaço de endereço proxy que é mapeado para um site remoto, incluindo uma nuvem privada ou outra região do Azure.</span><span class="sxs-lookup"><span data-stu-id="6d259-611">A Local Network in Azure virtual networking is a proxy address space that maps to a remote site including a private cloud or another Azure region.</span></span> <span data-ttu-id="6d259-612">Este espaço de endereço proxy está associado a um gateway remoto para roteamento de rede para os destinos de rede corretos.</span><span class="sxs-lookup"><span data-stu-id="6d259-612">This proxy address space is bound to a remote gateway for routing network to the right networking destinations.</span></span> <span data-ttu-id="6d259-613">Confira [Configurar uma conexão VNet a VNet](../../../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md) para obter instruções sobre como estabelecer conexões VNET a VNET.</span><span class="sxs-lookup"><span data-stu-id="6d259-613">See [Configure a VNet to VNet Connection](../../../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md) for the instructions on establishing VNET-to-VNET connection.</span></span>

<span data-ttu-id="6d259-614">Crie duas redes locais para os seguintes detalhes:</span><span class="sxs-lookup"><span data-stu-id="6d259-614">Create two local networks per the following details:</span></span>

| <span data-ttu-id="6d259-615">Nome da rede</span><span class="sxs-lookup"><span data-stu-id="6d259-615">Network Name</span></span> | <span data-ttu-id="6d259-616">Endereço do Gateway da VPN</span><span class="sxs-lookup"><span data-stu-id="6d259-616">VPN Gateway Address</span></span> | <span data-ttu-id="6d259-617">Espaço de endereço</span><span class="sxs-lookup"><span data-stu-id="6d259-617">Address Space</span></span> | <span data-ttu-id="6d259-618">Comentários</span><span class="sxs-lookup"><span data-stu-id="6d259-618">Remarks</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="6d259-619">hk-lnet-map-to-east-us</span><span class="sxs-lookup"><span data-stu-id="6d259-619">hk-lnet-map-to-east-us</span></span> |<span data-ttu-id="6d259-620">23.1.1.1</span><span class="sxs-lookup"><span data-stu-id="6d259-620">23.1.1.1</span></span> |<span data-ttu-id="6d259-621">10.2.0.0/16</span><span class="sxs-lookup"><span data-stu-id="6d259-621">10.2.0.0/16</span></span> |<span data-ttu-id="6d259-622">Ao criar a Rede Local, um espaço reservado para o endereço de gateway nos é dado.</span><span class="sxs-lookup"><span data-stu-id="6d259-622">While creating the Local Network give a placeholder gateway address.</span></span> <span data-ttu-id="6d259-623">O endereço do gateway real é preenchido quando o gateway é criado.</span><span class="sxs-lookup"><span data-stu-id="6d259-623">The real gateway address is filled once the gateway is created.</span></span> <span data-ttu-id="6d259-624">Certifique-se de que o espaço do endereço corresponda exatamente ao respectivo VNET remoto; neste caso, o VNET criado na região leste dos EUA.</span><span class="sxs-lookup"><span data-stu-id="6d259-624">Make sure the address space exactly matches the respective remote VNET; in this case the VNET created in the East US region.</span></span> |
| <span data-ttu-id="6d259-625">hk-lnet-map-to-west-us</span><span class="sxs-lookup"><span data-stu-id="6d259-625">hk-lnet-map-to-west-us</span></span> |<span data-ttu-id="6d259-626">23.2.2.2</span><span class="sxs-lookup"><span data-stu-id="6d259-626">23.2.2.2</span></span> |<span data-ttu-id="6d259-627">10.1.0.0/16</span><span class="sxs-lookup"><span data-stu-id="6d259-627">10.1.0.0/16</span></span> |<span data-ttu-id="6d259-628">Ao criar a Rede Local, um espaço reservado para o endereço de gateway nos é dado.</span><span class="sxs-lookup"><span data-stu-id="6d259-628">While creating the Local Network give a placeholder gateway address.</span></span> <span data-ttu-id="6d259-629">O endereço do gateway real é preenchido quando o gateway é criado.</span><span class="sxs-lookup"><span data-stu-id="6d259-629">The real gateway address is filled once the gateway is created.</span></span> <span data-ttu-id="6d259-630">Certifique-se de que o espaço do endereço corresponda exatamente ao respectivo VNET remoto; neste caso, o VNET criado na região oeste dos EUA.</span><span class="sxs-lookup"><span data-stu-id="6d259-630">Make sure the address space exactly matches the respective remote VNET; in this case the VNET created in the West US region.</span></span> |

### <a name="step-3-map-local-network-to-the-respective-vnets"></a><span data-ttu-id="6d259-631">Etapa 3: mapear rede "Local" para os respectivos VNETs</span><span class="sxs-lookup"><span data-stu-id="6d259-631">Step 3: Map “Local” network to the respective VNETs</span></span>
<span data-ttu-id="6d259-632">No portal clássico do Azure, selecione todas as redes virtuais, clique em "Configurar", marque "Conectar à rede local" e selecione as Redes Locais de acordo com os seguintes detalhes:</span><span class="sxs-lookup"><span data-stu-id="6d259-632">From the Azure classic portal, select each vnet, click “Configure”, check “Connect to the local network”, and select the Local Networks per the following details:</span></span>

| <span data-ttu-id="6d259-633">Rede Virtual</span><span class="sxs-lookup"><span data-stu-id="6d259-633">Virtual Network</span></span> | <span data-ttu-id="6d259-634">Rede Local</span><span class="sxs-lookup"><span data-stu-id="6d259-634">Local Network</span></span> |
| --- | --- |
| <span data-ttu-id="6d259-635">hk-vnet-west-us</span><span class="sxs-lookup"><span data-stu-id="6d259-635">hk-vnet-west-us</span></span> |<span data-ttu-id="6d259-636">hk-lnet-map-to-east-us</span><span class="sxs-lookup"><span data-stu-id="6d259-636">hk-lnet-map-to-east-us</span></span> |
| <span data-ttu-id="6d259-637">hk-vnet-east-us</span><span class="sxs-lookup"><span data-stu-id="6d259-637">hk-vnet-east-us</span></span> |<span data-ttu-id="6d259-638">hk-lnet-map-to-west-us</span><span class="sxs-lookup"><span data-stu-id="6d259-638">hk-lnet-map-to-west-us</span></span> |

### <a name="step-4-create-gateways-on-vnet1-and-vnet2"></a><span data-ttu-id="6d259-639">Etapa 4: criar Gateways em VNET1 e VNET2</span><span class="sxs-lookup"><span data-stu-id="6d259-639">Step 4: Create Gateways on VNET1 and VNET2</span></span>
<span data-ttu-id="6d259-640">No painel de ambas as redes virtuais, clique em CRIAR GATEWAY, o que acionará o processo de provisionamento do gateway de VPN.</span><span class="sxs-lookup"><span data-stu-id="6d259-640">From the dashboard of both the virtual networks, click CREATE GATEWAY which will trigger the VPN gateway provisioning process.</span></span> <span data-ttu-id="6d259-641">Após alguns minutos, o painel de cada rede virtual deverá exibir o endereço de gateway real.</span><span class="sxs-lookup"><span data-stu-id="6d259-641">After a few minutes the dashboard of each virtual network should display the actual gateway address.</span></span>

### <a name="step-5-update-local-networks-with-the-respective-gateway-addresses"></a><span data-ttu-id="6d259-642">Etapa 5: atualizar redes "Local" com os respectivos endereços "Gateway"</span><span class="sxs-lookup"><span data-stu-id="6d259-642">Step 5: Update “Local” networks with the respective “Gateway” addresses</span></span>
<span data-ttu-id="6d259-643">Edite ambas as redes locais para substituir o endereço IP do gateway de espaço reservado com o endereço IP real dos gateways provisionados.</span><span class="sxs-lookup"><span data-stu-id="6d259-643">Edit both the local networks to replace the placeholder gateway IP address with the real IP address of the just provisioned gateways.</span></span> <span data-ttu-id="6d259-644">Use o seguinte mapeamento:</span><span class="sxs-lookup"><span data-stu-id="6d259-644">Use the following mapping:</span></span>

<table>
<tr><th><span data-ttu-id="6d259-645">Rede Local</span><span class="sxs-lookup"><span data-stu-id="6d259-645">Local Network</span></span>    </th><th><span data-ttu-id="6d259-646">Gateway de Rede Virtual</span><span class="sxs-lookup"><span data-stu-id="6d259-646">Virtual Network Gateway</span></span></th></tr>
<tr><td><span data-ttu-id="6d259-647">hk-lnet-map-to-east-us</span><span class="sxs-lookup"><span data-stu-id="6d259-647">hk-lnet-map-to-east-us</span></span> </td><td><span data-ttu-id="6d259-648">Gateway de hk-vnet-west-us</span><span class="sxs-lookup"><span data-stu-id="6d259-648">Gateway of hk-vnet-west-us</span></span></td></tr>
<tr><td><span data-ttu-id="6d259-649">hk-lnet-map-to-west-us</span><span class="sxs-lookup"><span data-stu-id="6d259-649">hk-lnet-map-to-west-us</span></span> </td><td><span data-ttu-id="6d259-650">Gateway de hk-vnet-east-us</span><span class="sxs-lookup"><span data-stu-id="6d259-650">Gateway of hk-vnet-east-us</span></span></td></tr>
</table>

### <a name="step-6-update-the-shared-key"></a><span data-ttu-id="6d259-651">Etapa 6: atualizar a chave compartilhada</span><span class="sxs-lookup"><span data-stu-id="6d259-651">Step 6: Update the shared key</span></span>
<span data-ttu-id="6d259-652">Use o seguinte script do Powershell para atualizar a chave do IPSec de cada gateway de VPN [use a mesma chave para ambos os gateways]: Set-AzureVNetGatewayKey -VNetName hk-vnet-east-us -LocalNetworkSiteName hk-lnet-map-to-west-us -SharedKey D9E76BKK Set-AzureVNetGatewayKey -VNetName hk-vnet-west-us -LocalNetworkSiteName hk-lnet-map-to-east-us -SharedKey D9E76BKK</span><span class="sxs-lookup"><span data-stu-id="6d259-652">Use the following Powershell script to update the IPSec key of each VPN gateway [use the sake key for both the gateways]: Set-AzureVNetGatewayKey -VNetName hk-vnet-east-us -LocalNetworkSiteName hk-lnet-map-to-west-us -SharedKey D9E76BKK Set-AzureVNetGatewayKey -VNetName hk-vnet-west-us -LocalNetworkSiteName hk-lnet-map-to-east-us -SharedKey D9E76BKK</span></span>

### <a name="step-7-establish-the-vnet-to-vnet-connection"></a><span data-ttu-id="6d259-653">Etapa 7: estabelecer a conexão VNET para VNET</span><span class="sxs-lookup"><span data-stu-id="6d259-653">Step 7: Establish the VNET-to-VNET connection</span></span>
<span data-ttu-id="6d259-654">No portal clássico do Azure, use o menu "PAINEL" das duas redes virtuais para estabelecer a conexão gateway a gateway.</span><span class="sxs-lookup"><span data-stu-id="6d259-654">From the Azure classic portal, use the “DASHBOARD” menu of both the virtual networks to establish gateway-to-gateway connection.</span></span> <span data-ttu-id="6d259-655">Use os itens do menu "CONECTAR" na barra de ferramentas inferior.</span><span class="sxs-lookup"><span data-stu-id="6d259-655">Use the “CONNECT” menu items in the bottom toolbar.</span></span> <span data-ttu-id="6d259-656">Após alguns minutos, o painel deverá exibir graficamente os detalhes da conexão.</span><span class="sxs-lookup"><span data-stu-id="6d259-656">After a few minutes the dashboard should display the connection details graphically.</span></span>

### <a name="step-8-create-the-virtual-machines-in-region-2"></a><span data-ttu-id="6d259-657">Etapa 8: criar as máquinas virtuais na região nº 2</span><span class="sxs-lookup"><span data-stu-id="6d259-657">Step 8: Create the virtual machines in region #2</span></span>
<span data-ttu-id="6d259-658">Criar a imagem do Ubuntu, conforme descrito na implantação da região #1, seguindo as mesmas etapas, ou copie o arquivo VHD de imagem para a conta de armazenamento do Azure localizada na região #2 e crie a imagem.</span><span class="sxs-lookup"><span data-stu-id="6d259-658">Create the Ubuntu image as described in region #1 deployment by following the same steps or copy the image VHD file to the Azure storage account located in region #2 and create the image.</span></span> <span data-ttu-id="6d259-659">Use esta imagem e crie a seguinte lista de máquinas virtuais em um novo serviço de nuvem hk-c-svc-east-us:</span><span class="sxs-lookup"><span data-stu-id="6d259-659">Use this image and create the following list of virtual machines into a new cloud service hk-c-svc-east-us:</span></span>

| <span data-ttu-id="6d259-660">Nome da máquina</span><span class="sxs-lookup"><span data-stu-id="6d259-660">Machine Name</span></span> | <span data-ttu-id="6d259-661">Sub-rede</span><span class="sxs-lookup"><span data-stu-id="6d259-661">Subnet</span></span> | <span data-ttu-id="6d259-662">Endereço IP</span><span class="sxs-lookup"><span data-stu-id="6d259-662">IP Address</span></span> | <span data-ttu-id="6d259-663">Conjunto de disponibilidade</span><span class="sxs-lookup"><span data-stu-id="6d259-663">Availability set</span></span> | <span data-ttu-id="6d259-664">DC/Rack</span><span class="sxs-lookup"><span data-stu-id="6d259-664">DC/Rack</span></span> | <span data-ttu-id="6d259-665">Propagar?</span><span class="sxs-lookup"><span data-stu-id="6d259-665">Seed?</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="6d259-666">hk-c1-east-us</span><span class="sxs-lookup"><span data-stu-id="6d259-666">hk-c1-east-us</span></span> |<span data-ttu-id="6d259-667">data</span><span class="sxs-lookup"><span data-stu-id="6d259-667">data</span></span> |<span data-ttu-id="6d259-668">10.2.2.4</span><span class="sxs-lookup"><span data-stu-id="6d259-668">10.2.2.4</span></span> |<span data-ttu-id="6d259-669">hk-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="6d259-669">hk-c-aset-1</span></span> |<span data-ttu-id="6d259-670">dc =EASTUS rack =rack1</span><span class="sxs-lookup"><span data-stu-id="6d259-670">dc =EASTUS rack =rack1</span></span> |<span data-ttu-id="6d259-671">Sim</span><span class="sxs-lookup"><span data-stu-id="6d259-671">Yes</span></span> |
| <span data-ttu-id="6d259-672">hk-c2-east-us</span><span class="sxs-lookup"><span data-stu-id="6d259-672">hk-c2-east-us</span></span> |<span data-ttu-id="6d259-673">data</span><span class="sxs-lookup"><span data-stu-id="6d259-673">data</span></span> |<span data-ttu-id="6d259-674">10.2.2.5</span><span class="sxs-lookup"><span data-stu-id="6d259-674">10.2.2.5</span></span> |<span data-ttu-id="6d259-675">hk-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="6d259-675">hk-c-aset-1</span></span> |<span data-ttu-id="6d259-676">dc =EASTUS rack =rack1</span><span class="sxs-lookup"><span data-stu-id="6d259-676">dc =EASTUS rack =rack1</span></span> |<span data-ttu-id="6d259-677">Não</span><span class="sxs-lookup"><span data-stu-id="6d259-677">No</span></span> |
| <span data-ttu-id="6d259-678">hk-c3-east-us</span><span class="sxs-lookup"><span data-stu-id="6d259-678">hk-c3-east-us</span></span> |<span data-ttu-id="6d259-679">data</span><span class="sxs-lookup"><span data-stu-id="6d259-679">data</span></span> |<span data-ttu-id="6d259-680">10.2.2.6</span><span class="sxs-lookup"><span data-stu-id="6d259-680">10.2.2.6</span></span> |<span data-ttu-id="6d259-681">hk-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="6d259-681">hk-c-aset-1</span></span> |<span data-ttu-id="6d259-682">dc =EASTUS rack =rack2</span><span class="sxs-lookup"><span data-stu-id="6d259-682">dc =EASTUS rack =rack2</span></span> |<span data-ttu-id="6d259-683">Sim</span><span class="sxs-lookup"><span data-stu-id="6d259-683">Yes</span></span> |
| <span data-ttu-id="6d259-684">hk-c5-east-us</span><span class="sxs-lookup"><span data-stu-id="6d259-684">hk-c5-east-us</span></span> |<span data-ttu-id="6d259-685">data</span><span class="sxs-lookup"><span data-stu-id="6d259-685">data</span></span> |<span data-ttu-id="6d259-686">10.2.2.8</span><span class="sxs-lookup"><span data-stu-id="6d259-686">10.2.2.8</span></span> |<span data-ttu-id="6d259-687">hk-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="6d259-687">hk-c-aset-2</span></span> |<span data-ttu-id="6d259-688">dc =EASTUS rack =rack3</span><span class="sxs-lookup"><span data-stu-id="6d259-688">dc =EASTUS rack =rack3</span></span> |<span data-ttu-id="6d259-689">Sim</span><span class="sxs-lookup"><span data-stu-id="6d259-689">Yes</span></span> |
| <span data-ttu-id="6d259-690">hk-c6-east-us</span><span class="sxs-lookup"><span data-stu-id="6d259-690">hk-c6-east-us</span></span> |<span data-ttu-id="6d259-691">data</span><span class="sxs-lookup"><span data-stu-id="6d259-691">data</span></span> |<span data-ttu-id="6d259-692">10.2.2.9</span><span class="sxs-lookup"><span data-stu-id="6d259-692">10.2.2.9</span></span> |<span data-ttu-id="6d259-693">hk-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="6d259-693">hk-c-aset-2</span></span> |<span data-ttu-id="6d259-694">dc =EASTUS rack =rack3</span><span class="sxs-lookup"><span data-stu-id="6d259-694">dc =EASTUS rack =rack3</span></span> |<span data-ttu-id="6d259-695">Não</span><span class="sxs-lookup"><span data-stu-id="6d259-695">No</span></span> |
| <span data-ttu-id="6d259-696">hk-c7-east-us</span><span class="sxs-lookup"><span data-stu-id="6d259-696">hk-c7-east-us</span></span> |<span data-ttu-id="6d259-697">data</span><span class="sxs-lookup"><span data-stu-id="6d259-697">data</span></span> |<span data-ttu-id="6d259-698">10.2.2.10</span><span class="sxs-lookup"><span data-stu-id="6d259-698">10.2.2.10</span></span> |<span data-ttu-id="6d259-699">hk-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="6d259-699">hk-c-aset-2</span></span> |<span data-ttu-id="6d259-700">dc =EASTUS rack =rack4</span><span class="sxs-lookup"><span data-stu-id="6d259-700">dc =EASTUS rack =rack4</span></span> |<span data-ttu-id="6d259-701">Sim</span><span class="sxs-lookup"><span data-stu-id="6d259-701">Yes</span></span> |
| <span data-ttu-id="6d259-702">hk-c8-east-us</span><span class="sxs-lookup"><span data-stu-id="6d259-702">hk-c8-east-us</span></span> |<span data-ttu-id="6d259-703">data</span><span class="sxs-lookup"><span data-stu-id="6d259-703">data</span></span> |<span data-ttu-id="6d259-704">10.2.2.11</span><span class="sxs-lookup"><span data-stu-id="6d259-704">10.2.2.11</span></span> |<span data-ttu-id="6d259-705">hk-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="6d259-705">hk-c-aset-2</span></span> |<span data-ttu-id="6d259-706">dc =EASTUS rack =rack4</span><span class="sxs-lookup"><span data-stu-id="6d259-706">dc =EASTUS rack =rack4</span></span> |<span data-ttu-id="6d259-707">Não</span><span class="sxs-lookup"><span data-stu-id="6d259-707">No</span></span> |
| <span data-ttu-id="6d259-708">hk-w1-east-us</span><span class="sxs-lookup"><span data-stu-id="6d259-708">hk-w1-east-us</span></span> |<span data-ttu-id="6d259-709">web</span><span class="sxs-lookup"><span data-stu-id="6d259-709">web</span></span> |<span data-ttu-id="6d259-710">10.2.1.4</span><span class="sxs-lookup"><span data-stu-id="6d259-710">10.2.1.4</span></span> |<span data-ttu-id="6d259-711">hk-w-aset-1</span><span class="sxs-lookup"><span data-stu-id="6d259-711">hk-w-aset-1</span></span> |<span data-ttu-id="6d259-712">N/D</span><span class="sxs-lookup"><span data-stu-id="6d259-712">N/A</span></span> |<span data-ttu-id="6d259-713">N/D</span><span class="sxs-lookup"><span data-stu-id="6d259-713">N/A</span></span> |
| <span data-ttu-id="6d259-714">hk-w2-east-us</span><span class="sxs-lookup"><span data-stu-id="6d259-714">hk-w2-east-us</span></span> |<span data-ttu-id="6d259-715">web</span><span class="sxs-lookup"><span data-stu-id="6d259-715">web</span></span> |<span data-ttu-id="6d259-716">10.2.1.5</span><span class="sxs-lookup"><span data-stu-id="6d259-716">10.2.1.5</span></span> |<span data-ttu-id="6d259-717">hk-w-aset-1</span><span class="sxs-lookup"><span data-stu-id="6d259-717">hk-w-aset-1</span></span> |<span data-ttu-id="6d259-718">N/D</span><span class="sxs-lookup"><span data-stu-id="6d259-718">N/A</span></span> |<span data-ttu-id="6d259-719">N/D</span><span class="sxs-lookup"><span data-stu-id="6d259-719">N/A</span></span> |

<span data-ttu-id="6d259-720">Siga as mesmas instruções que para a região #1, mas use o espaço de endereço de 10.2.xxx.xxx.</span><span class="sxs-lookup"><span data-stu-id="6d259-720">Follow the same instructions as region #1 but use 10.2.xxx.xxx address space.</span></span>

### <a name="step-9-configure-cassandra-on-each-vm"></a><span data-ttu-id="6d259-721">Etapa 9: configurar o Cassandra em cada VM</span><span class="sxs-lookup"><span data-stu-id="6d259-721">Step 9: Configure Cassandra on each VM</span></span>
<span data-ttu-id="6d259-722">Faça logon na VM e execute o seguinte procedimento:</span><span class="sxs-lookup"><span data-stu-id="6d259-722">Log into the VM and perform the following:</span></span>

1. <span data-ttu-id="6d259-723">Edite $CASS_HOME/conf/cassandra-rackdc.properties para especificar as propriedades de data center e rack no formato: dc =EASTUS rack =rack1</span><span class="sxs-lookup"><span data-stu-id="6d259-723">Edit $CASS_HOME/conf/cassandra-rackdc.properties to specify the data center and rack properties in the format:  dc =EASTUS  rack =rack1</span></span>
2. <span data-ttu-id="6d259-724">Edite cassandra.yaml para configurar os nós de semente: Sementes: "10.1.2.4,10.1.2.6,10.1.2.8,10.1.2.10,10.2.2.4,10.2.2.6,10.2.2.8,10.2.2.10"</span><span class="sxs-lookup"><span data-stu-id="6d259-724">Edit cassandra.yaml to configure seed nodes:  Seeds: "10.1.2.4,10.1.2.6,10.1.2.8,10.1.2.10,10.2.2.4,10.2.2.6,10.2.2.8,10.2.2.10"</span></span>

### <a name="step-10-start-cassandra"></a><span data-ttu-id="6d259-725">Etapa 10: iniciar o Cassandra</span><span class="sxs-lookup"><span data-stu-id="6d259-725">Step 10: Start Cassandra</span></span>
<span data-ttu-id="6d259-726">Faça logon em cada VM e inicie o Cassandra em segundo plano, executando o seguinte comando: $CASS_HOME/bin/cassandra</span><span class="sxs-lookup"><span data-stu-id="6d259-726">Log into each VM and start Cassandra in the background by running the following command: $CASS_HOME/bin/cassandra</span></span>

## <a name="test-the-multi-region-cluster"></a><span data-ttu-id="6d259-727">Testar o cluster de várias regiões</span><span class="sxs-lookup"><span data-stu-id="6d259-727">Test the Multi-Region Cluster</span></span>
<span data-ttu-id="6d259-728">Até agora, Cassandra foi implantado em 16 nós com 8 nós em cada região do Azure.</span><span class="sxs-lookup"><span data-stu-id="6d259-728">By now Cassandra has been deployed to 16 nodes with 8 nodes in each Azure region.</span></span> <span data-ttu-id="6d259-729">Estes nós estão no mesmo cluster por meio do nome comum do cluster e da configuração do nó de propagação.</span><span class="sxs-lookup"><span data-stu-id="6d259-729">These nodes are in the same cluster by virtue of the common cluster name and the seed node configuration.</span></span> <span data-ttu-id="6d259-730">Use o seguinte processo para testar o cluster:</span><span class="sxs-lookup"><span data-stu-id="6d259-730">Use the following process to test the cluster:</span></span>

### <a name="step-1-get-the-internal-load-balancer-ip-for-both-the-regions-using-powershell"></a><span data-ttu-id="6d259-731">Etapa 1: obter o IP do balanceador de carga interno para ambas as regiões usando o PowerShell</span><span class="sxs-lookup"><span data-stu-id="6d259-731">Step 1: Get the internal load balancer IP for both the regions using PowerShell</span></span>
* <span data-ttu-id="6d259-732">Get-AzureInternalLoadbalancer -ServiceName "hk-c-svc-west-us"</span><span class="sxs-lookup"><span data-stu-id="6d259-732">Get-AzureInternalLoadbalancer -ServiceName "hk-c-svc-west-us"</span></span>
* <span data-ttu-id="6d259-733">Get-AzureInternalLoadbalancer -ServiceName "hk-c-svc-east-us"</span><span class="sxs-lookup"><span data-stu-id="6d259-733">Get-AzureInternalLoadbalancer -ServiceName "hk-c-svc-east-us"</span></span>  
  
    <span data-ttu-id="6d259-734">Observe os endereços IP (por exemplo, oeste - 10.1.2.101, leste - 10.2.2.101) exibidos.</span><span class="sxs-lookup"><span data-stu-id="6d259-734">Note the IP addresses (e.g. west - 10.1.2.101, east - 10.2.2.101) displayed.</span></span>

### <a name="step-2-execute-the-following-in-the-west-region-after-logging-into-hk-w1-west-us"></a><span data-ttu-id="6d259-735">Etapa 2: executar o seguinte na região oeste depois de efetuar logon em hk-w1-west-us</span><span class="sxs-lookup"><span data-stu-id="6d259-735">Step 2: Execute the following in the west region after logging into hk-w1-west-us</span></span>
1. <span data-ttu-id="6d259-736">Execute $CASS_HOME/bin/cqlsh 10.1.2.101 9160</span><span class="sxs-lookup"><span data-stu-id="6d259-736">Execute $CASS_HOME/bin/cqlsh 10.1.2.101 9160</span></span>
2. <span data-ttu-id="6d259-737">Execute os seguintes comandos CQL:</span><span class="sxs-lookup"><span data-stu-id="6d259-737">Execute the following CQL commands:</span></span>
   
     <span data-ttu-id="6d259-738">CREATE KEYSPACE customers_ks   WITH REPLICATION = { 'class' : 'NetworkToplogyStrategy', 'WESTUS' : 3, 'EASTUS' : 3};   USE customers_ks;   CREATE TABLE Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   INSERT INTO Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   INSERT INTO Customers(customer_id, firstname, lastname) VALUES (2, 'Jane', 'Doe');   SELECT * FROM Customers;</span><span class="sxs-lookup"><span data-stu-id="6d259-738">CREATE KEYSPACE customers_ks   WITH REPLICATION = { 'class' : 'NetworkToplogyStrategy', 'WESTUS' : 3, 'EASTUS' : 3};   USE customers_ks;   CREATE TABLE Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   INSERT INTO Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   INSERT INTO Customers(customer_id, firstname, lastname) VALUES (2, 'Jane', 'Doe');   SELECT * FROM Customers;</span></span>

<span data-ttu-id="6d259-739">Você deve ver uma tela como a mostrada abaixo:</span><span class="sxs-lookup"><span data-stu-id="6d259-739">You should see a display like the one below:</span></span>

| <span data-ttu-id="6d259-740">customer_id</span><span class="sxs-lookup"><span data-stu-id="6d259-740">customer_id</span></span> | <span data-ttu-id="6d259-741">nome</span><span class="sxs-lookup"><span data-stu-id="6d259-741">firstname</span></span> | <span data-ttu-id="6d259-742">Sobrenome</span><span class="sxs-lookup"><span data-stu-id="6d259-742">Lastname</span></span> |
| --- | --- | --- |
| <span data-ttu-id="6d259-743">1</span><span class="sxs-lookup"><span data-stu-id="6d259-743">1</span></span> |<span data-ttu-id="6d259-744">John</span><span class="sxs-lookup"><span data-stu-id="6d259-744">John</span></span> |<span data-ttu-id="6d259-745">Doe</span><span class="sxs-lookup"><span data-stu-id="6d259-745">Doe</span></span> |
| <span data-ttu-id="6d259-746">2</span><span class="sxs-lookup"><span data-stu-id="6d259-746">2</span></span> |<span data-ttu-id="6d259-747">Jane</span><span class="sxs-lookup"><span data-stu-id="6d259-747">Jane</span></span> |<span data-ttu-id="6d259-748">Doe</span><span class="sxs-lookup"><span data-stu-id="6d259-748">Doe</span></span> |

### <a name="step-3-execute-the-following-in-the-east-region-after-logging-into-hk-w1-east-us"></a><span data-ttu-id="6d259-749">Etapa 3: executar o seguinte na região leste depois de efetuar logon em hk-w1-east-us</span><span class="sxs-lookup"><span data-stu-id="6d259-749">Step 3: Execute the following in the east region after logging into hk-w1-east-us:</span></span>
1. <span data-ttu-id="6d259-750">Execute $CASS_HOME/bin/cqlsh 10.2.2.101 9160</span><span class="sxs-lookup"><span data-stu-id="6d259-750">Execute $CASS_HOME/bin/cqlsh 10.2.2.101 9160</span></span>
2. <span data-ttu-id="6d259-751">Execute os seguintes comandos CQL:</span><span class="sxs-lookup"><span data-stu-id="6d259-751">Execute the following CQL commands:</span></span>
   
     <span data-ttu-id="6d259-752">USE customers_ks;   CREATE TABLE Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   INSERT INTO Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   INSERT INTO Customers(customer_id, firstname, lastname) VALUES (2, 'Jane', 'Doe');   SELECT * FROM Customers;</span><span class="sxs-lookup"><span data-stu-id="6d259-752">USE customers_ks;   CREATE TABLE Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   INSERT INTO Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   INSERT INTO Customers(customer_id, firstname, lastname) VALUES (2, 'Jane', 'Doe');   SELECT * FROM Customers;</span></span>

<span data-ttu-id="6d259-753">Você deverá ver a mesma tela exibida para a região oeste:</span><span class="sxs-lookup"><span data-stu-id="6d259-753">You should see the same display as seen for the West region:</span></span>

| <span data-ttu-id="6d259-754">customer_id</span><span class="sxs-lookup"><span data-stu-id="6d259-754">customer_id</span></span> | <span data-ttu-id="6d259-755">nome</span><span class="sxs-lookup"><span data-stu-id="6d259-755">firstname</span></span> | <span data-ttu-id="6d259-756">Sobrenome</span><span class="sxs-lookup"><span data-stu-id="6d259-756">Lastname</span></span> |
| --- | --- | --- |
| <span data-ttu-id="6d259-757">1</span><span class="sxs-lookup"><span data-stu-id="6d259-757">1</span></span> |<span data-ttu-id="6d259-758">John</span><span class="sxs-lookup"><span data-stu-id="6d259-758">John</span></span> |<span data-ttu-id="6d259-759">Doe</span><span class="sxs-lookup"><span data-stu-id="6d259-759">Doe</span></span> |
| <span data-ttu-id="6d259-760">2</span><span class="sxs-lookup"><span data-stu-id="6d259-760">2</span></span> |<span data-ttu-id="6d259-761">Jane</span><span class="sxs-lookup"><span data-stu-id="6d259-761">Jane</span></span> |<span data-ttu-id="6d259-762">Doe</span><span class="sxs-lookup"><span data-stu-id="6d259-762">Doe</span></span> |

<span data-ttu-id="6d259-763">Execute mais algumas inserções e veja como são replicadas para a parte west-us do cluster.</span><span class="sxs-lookup"><span data-stu-id="6d259-763">Execute a few more inserts and see that those get replicated to west-us part of the cluster.</span></span>

## <a name="test-cassandra-cluster-from-nodejs"></a><span data-ttu-id="6d259-764">Testar o cluster de Cassandra do Node.js</span><span class="sxs-lookup"><span data-stu-id="6d259-764">Test Cassandra Cluster from Node.js</span></span>
<span data-ttu-id="6d259-765">Usando uma das VMs do Linux encaixotadas anteriormente na camada "web", executaremos um script simples do Node.js para ler os dados inseridos anteriormente</span><span class="sxs-lookup"><span data-stu-id="6d259-765">Using one of the Linux VMs crated in the "web" tier previously, we will execute a simple Node.js script to read the previously inserted data</span></span>

<span data-ttu-id="6d259-766">**Etapa 1: instalar o Node.js e o cliente do Cassandra**</span><span class="sxs-lookup"><span data-stu-id="6d259-766">**Step 1: Install Node.js and Cassandra Client**</span></span>

1. <span data-ttu-id="6d259-767">Instale o Node.js e npm</span><span class="sxs-lookup"><span data-stu-id="6d259-767">Install Node.js and npm</span></span>
2. <span data-ttu-id="6d259-768">Instale o pacote de nó "cassandra-client" usando npm</span><span class="sxs-lookup"><span data-stu-id="6d259-768">Install node package "cassandra-client" using npm</span></span>
3. <span data-ttu-id="6d259-769">Execute o seguinte script no prompt de shell que exibe a cadeia de caracteres json dos dados recuperados:</span><span class="sxs-lookup"><span data-stu-id="6d259-769">Execute the following script at the shell prompt which displays the json string of the retrieved data:</span></span>
   
        var pooledCon = require('cassandra-client').PooledConnection;
        var ksName = "custsupport_ks";
        var cfName = "customers_cf";
        var hostList = ['internal_loadbalancer_ip:9160'];
        var ksConOptions = { hosts: hostList,
                             keyspace: ksName, use_bigints: false };
   
        function createKeyspace(callback){
           var cql = 'CREATE KEYSPACE ' + ksName + ' WITH strategy_class=SimpleStrategy AND strategy_options:replication_factor=1';
           var sysConOptions = { hosts: hostList,  
                                 keyspace: 'system', use_bigints: false };
           var con = new pooledCon(sysConOptions);
           con.execute(cql,[],function(err) {
           if (err) {
             console.log("Failed to create Keyspace: " + ksName);
             console.log(err);
           }
           else {
             console.log("Created Keyspace: " + ksName);
             callback(ksConOptions, populateCustomerData);
           }
           });
           con.shutdown();
        }
   
        function createColumnFamily(ksConOptions, callback){
          var params = ['customers_cf','custid','varint','custname',
                        'text','custaddress','text'];
          var cql = 'CREATE COLUMNFAMILY ? (? ? PRIMARY KEY,? ?, ? ?)';
        var con =  new pooledCon(ksConOptions);
          con.execute(cql,params,function(err) {
              if (err) {
                 console.log("Failed to create column family: " + params[0]);
                 console.log(err);
              }
              else {
                 console.log("Created column family: " + params[0]);
                 callback();
              }
          });
          con.shutdown();
        }
   
        //populate Data
        function populateCustomerData() {
           var params = ['John','Infinity Dr, TX', 1];
           updateCustomer(ksConOptions,params);
   
           params = ['Tom','Fermat Ln, WA', 2];
           updateCustomer(ksConOptions,params);
        }
   
        //update will also insert the record if none exists
        function updateCustomer(ksConOptions,params)
        {
          var cql = 'UPDATE customers_cf SET custname=?,custaddress=? where custid=?';
          var con = new pooledCon(ksConOptions);
          con.execute(cql,params,function(err) {
              if (err) console.log(err);
              else console.log("Inserted customer : " + params[0]);
          });
          con.shutdown();
        }
   
        //read the two rows inserted above
        function readCustomer(ksConOptions)
        {
          var cql = 'SELECT * FROM customers_cf WHERE custid IN (1,2)';
          var con = new pooledCon(ksConOptions);
          con.execute(cql,[],function(err,rows) {
              if (err)
                 console.log(err);
              else
                 for (var i=0; i<rows.length; i++)
                    console.log(JSON.stringify(rows[i]));
            });
           con.shutdown();
        }
   
        //exectue the code
        createKeyspace(createColumnFamily);
        readCustomer(ksConOptions)

## <a name="conclusion"></a><span data-ttu-id="6d259-770">Conclusão</span><span class="sxs-lookup"><span data-stu-id="6d259-770">Conclusion</span></span>
<span data-ttu-id="6d259-771">O Microsoft Azure é uma plataforma flexível que permite a execução tanto de softwares da Microsoft, bem como de software livre, conforme demonstrado neste exercício.</span><span class="sxs-lookup"><span data-stu-id="6d259-771">Microsoft Azure is a flexible platform that allows the running of both Microsoft as well as open source software as demonstrated by this exercise.</span></span> <span data-ttu-id="6d259-772">Os clusters de Cassandra altamente disponíveis podem ser implantados em um único data center por meio de propagação de nós de cluster em vários domínios de falha.</span><span class="sxs-lookup"><span data-stu-id="6d259-772">Highly available Cassandra clusters can be deployed on a single data center through the spreading of the cluster nodes across multiple fault domains.</span></span> <span data-ttu-id="6d259-773">Os clusters de Cassandra também podem ser implantados em regiões geograficamente distantes do Azure para sistemas à prova de desastres.</span><span class="sxs-lookup"><span data-stu-id="6d259-773">Cassandra clusters can also be deployed across multiple geographically distant Azure regions for disaster proof systems.</span></span> <span data-ttu-id="6d259-774">Juntos, o Azure e Cassandra possibilitam a construção serviços de nuvem altamente escalonáveis, altamente disponíveis e recuperáveis contra desastres, necessários pelos serviços de escala de internet de hoje em dia.</span><span class="sxs-lookup"><span data-stu-id="6d259-774">Azure and Cassandra together enables the construction of highly scalable, highly available and disaster recoverable cloud services needed by today's internet scale services.</span></span>  

## <a name="references"></a><span data-ttu-id="6d259-775">Referências</span><span class="sxs-lookup"><span data-stu-id="6d259-775">References</span></span>
* [<span data-ttu-id="6d259-776">http://cassandra.apache.org</span><span class="sxs-lookup"><span data-stu-id="6d259-776">http://cassandra.apache.org</span></span>](http://cassandra.apache.org)
* [<span data-ttu-id="6d259-777">http://www.datastax.com</span><span class="sxs-lookup"><span data-stu-id="6d259-777">http://www.datastax.com</span></span>](http://www.datastax.com)
* [<span data-ttu-id="6d259-778">http://www.nodejs.org</span><span class="sxs-lookup"><span data-stu-id="6d259-778">http://www.nodejs.org</span></span>](http://www.nodejs.org)

