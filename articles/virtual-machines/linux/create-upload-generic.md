---
title: aaaCreate e carregar um VHD do Linux no Azure
description: "Saiba toocreate e carregar um Azure disco rígido virtual (VHD) que contém um sistema operacional Linux."
services: virtual-machines-linux
documentationcenter: 
author: szarkos
manager: timlt
editor: tysonn
tags: azure-resource-manager,azure-service-management
ms.assetid: d351396c-95a0-4092-b7bf-c6aae0bbd112
ms.service: virtual-machines-linux
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-linux
ms.devlang: na
ms.topic: article
ms.date: 02/02/2017
ms.author: szark
ms.openlocfilehash: 208e15c035edb5520fc29ba8e4e71c42b041864d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="information-for-non-endorsed-distributions"></a><span data-ttu-id="6f952-103">Informações para as distribuições não endossadas</span><span class="sxs-lookup"><span data-stu-id="6f952-103">Information for Non-Endorsed Distributions</span></span>
[!INCLUDE [learn-about-deployment-models](../../../includes/learn-about-deployment-models-both-include.md)]

<span data-ttu-id="6f952-104">a plataforma Windows Azure SLA Hello aplica toovirtual máquinas em execução Olá SO Linux somente quando um de saudação [aprovados distribuições](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) é usado.</span><span class="sxs-lookup"><span data-stu-id="6f952-104">hello Azure platform SLA applies toovirtual machines running hello Linux OS only when one of hello [endorsed distributions](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) is used.</span></span> <span data-ttu-id="6f952-105">Todas as distribuições do Linux que são fornecidas no hello Azure Galeria de imagens são aprovados distribuições com a configuração solicitada hello.</span><span class="sxs-lookup"><span data-stu-id="6f952-105">All Linux distributions that are provided in hello Azure image gallery are endorsed distributions with hello required configuration.</span></span>

* [<span data-ttu-id="6f952-106">Linux no Azure - Distribuições endossadas</span><span class="sxs-lookup"><span data-stu-id="6f952-106">Linux on Azure - Endorsed Distributions</span></span>](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)
* [<span data-ttu-id="6f952-107">Suporte para imagens Linux no Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="6f952-107">Support for Linux images in Microsoft Azure</span></span>](https://support.microsoft.com/kb/2941892)

<span data-ttu-id="6f952-108">Todas as distribuições em execução no Azure serão necessário toomeet um número de pré-requisitos toohave um tooproperly chance executado na plataforma de saudação.</span><span class="sxs-lookup"><span data-stu-id="6f952-108">All distributions running on Azure will need toomeet a number of prerequisites toohave a chance tooproperly run on hello platform.</span></span>  <span data-ttu-id="6f952-109">Este artigo não é abrangente como cada distribuição é diferente; e é bem possível que, mesmo se você atender a todos os Olá critérios abaixo que você ainda precisará toosignificantly ajustar sua tooensure de sistema do Linux que ele é executado corretamente na plataforma de saudação.</span><span class="sxs-lookup"><span data-stu-id="6f952-109">This article is by no means comprehensive as every distribution is different; and it is quite possible that even if you meet all hello criteria below you will still need toosignificantly tweak your Linux system tooensure that it properly runs on hello platform.</span></span>

<span data-ttu-id="6f952-110">Por isso, recomendamos que você inicie com uma das nossas [distribuições endossadas do Linux no Azure](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) sempre que possível.</span><span class="sxs-lookup"><span data-stu-id="6f952-110">It is for this reason that we recommend that you start with one of our [Linux on Azure Endorsed Distributions](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) when possible.</span></span> <span data-ttu-id="6f952-111">Olá artigos a seguir orientará como tooprepare Olá vários aprovados distribuições do Linux com suporte no Azure:</span><span class="sxs-lookup"><span data-stu-id="6f952-111">hello following articles will guide you through how tooprepare hello various endorsed Linux distributions that are supported on Azure:</span></span>

* <span data-ttu-id="6f952-112">**[Distribuições com base em CentOS](create-upload-centos.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="6f952-112">**[CentOS-based Distributions](create-upload-centos.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="6f952-113">**[Debian Linux](debian-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="6f952-113">**[Debian Linux](debian-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="6f952-114">**[Oracle Linux](oracle-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="6f952-114">**[Oracle Linux](oracle-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="6f952-115">**[Red Hat Enterprise Linux](redhat-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="6f952-115">**[Red Hat Enterprise Linux](redhat-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="6f952-116">**[SLES & openSUSE](suse-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="6f952-116">**[SLES & openSUSE](suse-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="6f952-117">**[Ubuntu](create-upload-ubuntu.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="6f952-117">**[Ubuntu](create-upload-ubuntu.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>

<span data-ttu-id="6f952-118">restante Olá deste artigo se concentrará em diretrizes gerais para executar sua distribuição do Linux no Azure.</span><span class="sxs-lookup"><span data-stu-id="6f952-118">hello rest of this article will focus on general guidance for running your Linux distribution on Azure.</span></span>

## <a name="general-linux-installation-notes"></a><span data-ttu-id="6f952-119">Notas de instalação gerais do Linux</span><span class="sxs-lookup"><span data-stu-id="6f952-119">General Linux Installation Notes</span></span>
* <span data-ttu-id="6f952-120">formato do Hello VHDX não tem suporte apenas no Azure, **VHD fixo**.</span><span class="sxs-lookup"><span data-stu-id="6f952-120">hello VHDX format is not supported in Azure, only **fixed VHD**.</span></span>  <span data-ttu-id="6f952-121">Você pode converter Olá disco tooVHD formato usando o Gerenciador do Hyper-V ou Olá cmdlet convert-vhd.</span><span class="sxs-lookup"><span data-stu-id="6f952-121">You can convert hello disk tooVHD format using Hyper-V Manager or hello convert-vhd cmdlet.</span></span> <span data-ttu-id="6f952-122">Se você estiver usando VirtualBox isso significa que selecionando **tamanho fixo** como oposição padrão toohello alocada dinamicamente durante a criação de disco de saudação.</span><span class="sxs-lookup"><span data-stu-id="6f952-122">If you are using VirtualBox this means selecting **Fixed size** as opposed toohello default dynamically allocated when creating hello disk.</span></span>
* <span data-ttu-id="6f952-123">O Azure oferece suporte somente para máquinas virtuais de geração 1.</span><span class="sxs-lookup"><span data-stu-id="6f952-123">Azure only supports generation 1 virtual machines.</span></span> <span data-ttu-id="6f952-124">Você pode converter uma geração 1 máquina virtual de formato de arquivo VHD VHDX toohello em expansão dinâmica tooa fixada em tamanho de disco.</span><span class="sxs-lookup"><span data-stu-id="6f952-124">You can convert a generation 1 virtual machine from VHDX toohello VHD file format and from dynamically expanding tooa fixed sized disk.</span></span> <span data-ttu-id="6f952-125">Mas não é possível alterar a geração de uma máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="6f952-125">But you can't change a virtual machine's generation.</span></span> <span data-ttu-id="6f952-126">Para saber mais, confira [Devo criar uma máquina virtual de geração 1 ou 2 no Hyper-V?](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/plan/should-i-create-a-generation-1-or-2-virtual-machine-in-hyper-v)</span><span class="sxs-lookup"><span data-stu-id="6f952-126">For more information, see [Should I create a generation 1 or 2 virtual machine in Hyper-V?](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/plan/should-i-create-a-generation-1-or-2-virtual-machine-in-hyper-v)</span></span>
* <span data-ttu-id="6f952-127">tamanho máximo de saudação permitido para Olá que VHD é 1.023 GB.</span><span class="sxs-lookup"><span data-stu-id="6f952-127">hello maximum size allowed for hello VHD is 1,023 GB.</span></span>
* <span data-ttu-id="6f952-128">Ao instalar o sistema de Linux Olá é *recomendado* que você use partições padrão em vez de LVM (geralmente padrão Olá para muitas instalações).</span><span class="sxs-lookup"><span data-stu-id="6f952-128">When installing hello Linux system it is *recommended* that you use standard partitions rather than LVM (often hello default for many installations).</span></span> <span data-ttu-id="6f952-129">Isso evitará LVM nome conflita com VMs clonados, especialmente se um disco do sistema operacional nunca precisa tooanother toobe anexado VM idêntico para solução de problemas.</span><span class="sxs-lookup"><span data-stu-id="6f952-129">This will avoid LVM name conflicts with cloned VMs, particularly if an OS disk ever needs toobe attached tooanother identical VM for troubleshooting.</span></span> <span data-ttu-id="6f952-130">[LVM](configure-lvm.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) ou [RAID](configure-raid.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) podem ser usados nos discos de dados.</span><span class="sxs-lookup"><span data-stu-id="6f952-130">[LVM](configure-lvm.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) or [RAID](configure-raid.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) may be used on data disks.</span></span>
* <span data-ttu-id="6f952-131">É necessário suporte a kernel para montar sistemas de arquivos UDF.</span><span class="sxs-lookup"><span data-stu-id="6f952-131">Kernel support for mounting UDF file systems is required.</span></span> <span data-ttu-id="6f952-132">Durante a primeira inicialização hello Azure configuração de provisionamento é passada toohello VM Linux por meio de mídia formatada UDF que é anexado toohello convidado.</span><span class="sxs-lookup"><span data-stu-id="6f952-132">At first boot on Azure hello provisioning configuration is passed toohello Linux VM via UDF-formatted media that is attached toohello guest.</span></span> <span data-ttu-id="6f952-133">agente do Linux Azure Olá deve ser capaz de toomount Olá UDF arquivo sistema tooread sua configuração e provisionar Olá VM.</span><span class="sxs-lookup"><span data-stu-id="6f952-133">hello Azure Linux agent must be able toomount hello UDF file system tooread its configuration and provision hello VM.</span></span>
* <span data-ttu-id="6f952-134">Versões de kernel do Linux abaixo de 2.6.37 não dão suporte ao NUMA no Hyper-V com tamanhos maiores de VM.</span><span class="sxs-lookup"><span data-stu-id="6f952-134">Linux kernel versions below 2.6.37 do not support NUMA on Hyper-V with larger VM sizes.</span></span> <span data-ttu-id="6f952-135">Esse problema principalmente impactos distribuições mais antigas usando Olá upstream kernel Red Hat 2.6.32 e foi corrigido em RHEL 6.6 (kernel-2.6.32-504).</span><span class="sxs-lookup"><span data-stu-id="6f952-135">This issue primarily impacts older distributions using hello upstream Red Hat 2.6.32 kernel, and was fixed in RHEL 6.6 (kernel-2.6.32-504).</span></span> <span data-ttu-id="6f952-136">Sistemas que executam kernels personalizados anteriores 2.6.37 ou com base em RHEL kernels mais antigos que 2.6.32-504 deve definir Olá parâmetro de inicialização `numa=off` no kernel de saudação de linha de comando em grub.conf.</span><span class="sxs-lookup"><span data-stu-id="6f952-136">Systems running custom kernels older than 2.6.37, or RHEL-based kernels older than 2.6.32-504 must set hello boot parameter `numa=off` on hello kernel command-line in grub.conf.</span></span> <span data-ttu-id="6f952-137">Para obter mais informações, confira o [KB 436883](https://access.redhat.com/solutions/436883) do Red Hat.</span><span class="sxs-lookup"><span data-stu-id="6f952-137">For more information see Red Hat [KB 436883](https://access.redhat.com/solutions/436883).</span></span>
* <span data-ttu-id="6f952-138">Não configure uma partição de troca no disco do sistema operacional hello.</span><span class="sxs-lookup"><span data-stu-id="6f952-138">Do not configure a swap partition on hello OS disk.</span></span> <span data-ttu-id="6f952-139">agente do Linux Olá pode ser configurado toocreate um arquivo de permuta em disco de recursos temporário hello.</span><span class="sxs-lookup"><span data-stu-id="6f952-139">hello Linux agent can be configured toocreate a swap file on hello temporary resource disk.</span></span>  <span data-ttu-id="6f952-140">Para obter mais informações sobre isso podem ser encontradas nas etapas de saudação abaixo.</span><span class="sxs-lookup"><span data-stu-id="6f952-140">More information about this can be found in hello steps below.</span></span>
* <span data-ttu-id="6f952-141">Todos os VHDs Olá devem ter tamanhos que sejam múltiplos de 1 MB.</span><span class="sxs-lookup"><span data-stu-id="6f952-141">All of hello VHDs must have sizes that are multiples of 1 MB.</span></span>

### <a name="installing-kernel-modules-without-hyper-v"></a><span data-ttu-id="6f952-142">Instalação dos módulos de kernel sem Hyper-V</span><span class="sxs-lookup"><span data-stu-id="6f952-142">Installing kernel modules without Hyper-V</span></span>
<span data-ttu-id="6f952-143">Azure é executado no hipervisor do Hyper-V hello, para que Linux requer que determinados módulos de kernel estão instalados na ordem toorun no Azure.</span><span class="sxs-lookup"><span data-stu-id="6f952-143">Azure runs on hello Hyper-V hypervisor, so Linux requires that certain kernel modules are installed in order toorun in Azure.</span></span> <span data-ttu-id="6f952-144">Se você tiver uma VM que foi criada fora do Hyper-V, instaladores de Linux Olá não inclua drivers de saudação do Hyper-V ramdisk de saudação inicial (initrd ou initramfs), a menos que ele detecta que está executando um um ambiente Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="6f952-144">If you have a VM that was created outside of Hyper-V, hello Linux installers may not include hello drivers for Hyper-V in hello initial ramdisk (initrd or initramfs) unless it detects that it is running an a Hyper-V environment.</span></span> <span data-ttu-id="6f952-145">Ao usar um tooprepare do sistema (ou seja, Virtualbox, KVM, etc.) de virtualização diferente em sua imagem do Linux, talvez seja necessário toorebuild Olá initrd tooensure que pelo menos Olá `hv_vmbus` e `hv_storvsc` módulos de kernel estão disponíveis no ramdisk de saudação inicial.</span><span class="sxs-lookup"><span data-stu-id="6f952-145">When using a different virtualization system (i.e. Virtualbox, KVM, etc.) tooprepare your Linux image, you may need toorebuild hello initrd tooensure that at least hello `hv_vmbus` and `hv_storvsc` kernel modules are available on hello initial ramdisk.</span></span>  <span data-ttu-id="6f952-146">Isso é um problema conhecido pelo menos em sistemas com base na distribuição de Red Hat upstream hello.</span><span class="sxs-lookup"><span data-stu-id="6f952-146">This is a known issue at least on systems based on hello upstream Red Hat distribution.</span></span>

<span data-ttu-id="6f952-147">mecanismo de saudação para a recriação de imagem de saudação initrd ou initramfs pode variar dependendo distribuição hello.</span><span class="sxs-lookup"><span data-stu-id="6f952-147">hello mechanism for rebuilding hello initrd or initramfs image may vary depending on hello distribution.</span></span> <span data-ttu-id="6f952-148">Por favor, consulte a documentação da distribuição ou suporte para procedimento adequado hello.</span><span class="sxs-lookup"><span data-stu-id="6f952-148">Please consult your distribution's documentation or support for hello proper procedure.</span></span>  <span data-ttu-id="6f952-149">Aqui está um exemplo de como toorebuild Olá initrd usando Olá `mkinitrd` utilitário:</span><span class="sxs-lookup"><span data-stu-id="6f952-149">Here is one example for how toorebuild hello initrd using hello `mkinitrd` utility:</span></span>

<span data-ttu-id="6f952-150">Primeiro, fazer backup de imagem existente de initrd hello:</span><span class="sxs-lookup"><span data-stu-id="6f952-150">First, back up hello existing initrd image:</span></span>

    # cd /boot
    # sudo cp initrd-`uname -r`.img  initrd-`uname -r`.img.bak

<span data-ttu-id="6f952-151">Em seguida, recrie initrd Olá com hello `hv_vmbus` e `hv_storvsc` módulos de kernel:</span><span class="sxs-lookup"><span data-stu-id="6f952-151">Next, rebuild hello initrd with hello `hv_vmbus` and `hv_storvsc` kernel modules:</span></span>

    # sudo mkinitrd --preload=hv_storvsc --preload=hv_vmbus -v -f initrd-`uname -r`.img `uname -r`


### <a name="resizing-vhds"></a><span data-ttu-id="6f952-152">Redimensionando VHDs</span><span class="sxs-lookup"><span data-stu-id="6f952-152">Resizing VHDs</span></span>
<span data-ttu-id="6f952-153">Imagens de VHD no Azure devem ter um tamanho virtual alinhado too1MB.</span><span class="sxs-lookup"><span data-stu-id="6f952-153">VHD images on Azure must have a virtual size aligned too1MB.</span></span>  <span data-ttu-id="6f952-154">Normalmente, os VHDs criados usando o Hyper-V já foram alinhados corretamente.</span><span class="sxs-lookup"><span data-stu-id="6f952-154">Typically, VHDs created using Hyper-V should already be aligned correctly.</span></span>  <span data-ttu-id="6f952-155">Se Olá VHD não está alinhado corretamente em seguida, você poderá receber um erro mensagem semelhante toohello a seguir ao tentar toocreate um *imagem* de seu VHD:</span><span class="sxs-lookup"><span data-stu-id="6f952-155">If hello VHD is not aligned correctly then you may receive an error message similar toohello following when you attempt toocreate an *image* from your VHD:</span></span>

    "hello VHD http://<mystorageaccount>.blob.core.windows.net/vhds/MyLinuxVM.vhd has an unsupported virtual size of 21475270656 bytes. hello size must be a whole number (in MBs).”

<span data-ttu-id="6f952-156">tooremedy isso você pode redimensionar Olá VM usando o console do Gerenciador do Hyper-V hello ou hello [Resize-VHD](http://technet.microsoft.com/library/hh848535.aspx) cmdlet do Powershell.</span><span class="sxs-lookup"><span data-stu-id="6f952-156">tooremedy this you can resize hello VM using either hello Hyper-V Manager console or hello [Resize-VHD](http://technet.microsoft.com/library/hh848535.aspx) Powershell cmdlet.</span></span>  <span data-ttu-id="6f952-157">Se você não estiver executando em um ambiente Windows, em seguida, ele é recomendado toouse img qemu tooconvert (se necessário) e redimensionar Olá VHD.</span><span class="sxs-lookup"><span data-stu-id="6f952-157">If you are not running in a Windows environment then it is recommended toouse qemu-img tooconvert (if needed) and resize hello VHD.</span></span>

> [!NOTE]
> <span data-ttu-id="6f952-158">Há um bug conhecido nas versões qemu-img > = 2.2.1 que resulta em um VHD formatado incorretamente.</span><span class="sxs-lookup"><span data-stu-id="6f952-158">There is a known bug in qemu-img versions >=2.2.1 that results in an improperly formatted VHD.</span></span> <span data-ttu-id="6f952-159">Olá problema foi corrigido na versão 2.6 do QEMU.</span><span class="sxs-lookup"><span data-stu-id="6f952-159">hello issue has been fixed in QEMU 2.6.</span></span> <span data-ttu-id="6f952-160">É recomendável toouse qemu-img 2.2.0 ou inferior ou atualização too2.6 ou superior.</span><span class="sxs-lookup"><span data-stu-id="6f952-160">It is recommended toouse either qemu-img 2.2.0 or lower, or update too2.6 or higher.</span></span> <span data-ttu-id="6f952-161">Referência: https://bugs.launchpad.net/qemu/+bug/1490611.</span><span class="sxs-lookup"><span data-stu-id="6f952-161">Reference: https://bugs.launchpad.net/qemu/+bug/1490611.</span></span>
> 
> 

1. <span data-ttu-id="6f952-162">Redimensionando Olá VHD diretamente usando ferramentas como `qemu-img` ou `vbox-manage` pode resultar em um VHD não inicializável.</span><span class="sxs-lookup"><span data-stu-id="6f952-162">Resizing hello VHD directly using tools such as `qemu-img` or `vbox-manage` may result in an unbootable VHD.</span></span>  <span data-ttu-id="6f952-163">Ele é recomendado toofirst convert Olá imagem de disco VHD tooa.</span><span class="sxs-lookup"><span data-stu-id="6f952-163">So it is recommended toofirst convert hello VHD tooa RAW disk image.</span></span>  <span data-ttu-id="6f952-164">Se a imagem da VM Olá já foi criada como imagem de disco (padrão de saudação para alguns hipervisores como KVM), você pode ignorar esta etapa:</span><span class="sxs-lookup"><span data-stu-id="6f952-164">If hello VM image was already created as RAW disk image (hello default for some Hypervisors such as KVM) then you may skip this step:</span></span>
   
       # qemu-img convert -f vpc -O raw MyLinuxVM.vhd MyLinuxVM.raw

2. <span data-ttu-id="6f952-165">Calcule Olá necessário tamanho de saudação tooensure de imagem de disco que Olá tamanho virtual é too1MB alinhados.</span><span class="sxs-lookup"><span data-stu-id="6f952-165">Calculate hello required size of hello disk image tooensure that hello virtual size is aligned too1MB.</span></span>  <span data-ttu-id="6f952-166">Olá após o script de shell bash pode ajudar com isso.</span><span class="sxs-lookup"><span data-stu-id="6f952-166">hello following bash shell script can assist with this.</span></span>  <span data-ttu-id="6f952-167">Olá script usa "`qemu-img info`" toodetermine Olá virtual tamanho da imagem de disco de saudação e, em seguida, calcula Olá tamanho toohello Avançar 1 MB:</span><span class="sxs-lookup"><span data-stu-id="6f952-167">hello script uses "`qemu-img info`" toodetermine hello virtual size of hello disk image and then calculates hello size toohello next 1MB:</span></span>
   
       rawdisk="MyLinuxVM.raw"
       vhddisk="MyLinuxVM.vhd"
   
       MB=$((1024*1024))
       size=$(qemu-img info -f raw --output json "$rawdisk" | \
              gawk 'match($0, /"virtual-size": ([0-9]+),/, val) {print val[1]}')
   
       rounded_size=$((($size/$MB + 1)*$MB))
       echo "Rounded Size = $rounded_size"

3. <span data-ttu-id="6f952-168">Redimensione disco bruto de saudação usando $rounded_size como definido no hello acima script:</span><span class="sxs-lookup"><span data-stu-id="6f952-168">Resize hello raw disk using $rounded_size as set in hello above script:</span></span>
   
       # qemu-img resize MyLinuxVM.raw $rounded_size

4. <span data-ttu-id="6f952-169">Agora, converta Olá disco RAW back tooa VHD de tamanho fixo:</span><span class="sxs-lookup"><span data-stu-id="6f952-169">Now, convert hello RAW disk back tooa fixed-size VHD:</span></span>
   
       # qemu-img convert -f raw -o subformat=fixed -O vpc MyLinuxVM.raw MyLinuxVM.vhd

   <span data-ttu-id="6f952-170">Ou, com a versão de qemu **2.6 +** incluem hello `force_size` opção:</span><span class="sxs-lookup"><span data-stu-id="6f952-170">Or, with qemu version **2.6+** include hello `force_size` option:</span></span>

       # qemu-img convert -f raw -o subformat=fixed,force_size -O vpc MyLinuxVM.raw MyLinuxVM.vhd

## <a name="linux-kernel-requirements"></a><span data-ttu-id="6f952-171">Requisitos do kernel do Linux</span><span class="sxs-lookup"><span data-stu-id="6f952-171">Linux Kernel Requirements</span></span>
<span data-ttu-id="6f952-172">Olá drivers do Integration Services LIS (Linux) do Hyper-V e do Azure são a contribuição diretamente toohello upstream kernel do Linux.</span><span class="sxs-lookup"><span data-stu-id="6f952-172">hello Linux Integration Services (LIS) drivers for Hyper-V and Azure are contributed directly toohello upstream Linux kernel.</span></span> <span data-ttu-id="6f952-173">Muitas distribuições que contam com uma versão recente do kernel do Linux (por exemplo, versões 3.x) já terão esses drivers ou fornecerão versões revertidas desses drivers com seus kernels.</span><span class="sxs-lookup"><span data-stu-id="6f952-173">Many distributions that include a recent Linux kernel version (i.e. 3.x) will have these drivers available already, or otherwise provide backported versions of these drivers with their kernels.</span></span>  <span data-ttu-id="6f952-174">Esses drivers constantemente estão sendo atualizados no kernel de upstream Olá com novas correções e recursos, portanto quando possível, é recomendável toorun um [aprovados distribuição](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) que incluirá essas correções e atualizações.</span><span class="sxs-lookup"><span data-stu-id="6f952-174">These drivers are constantly being updated in hello upstream kernel with new fixes and features, so when possible it is recommended toorun an [endorsed distribution](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) that will include these fixes and updates.</span></span>

<span data-ttu-id="6f952-175">Se você estiver executando uma variante do Red Hat Enterprise Linux versões **6.0 6.3**, será necessário tooinstall Olá LIS drivers de Hyper-v.</span><span class="sxs-lookup"><span data-stu-id="6f952-175">If you are running a variant of Red Hat Enterprise Linux versions **6.0-6.3**, then you will need tooinstall hello latest LIS drivers for Hyper-V.</span></span> <span data-ttu-id="6f952-176">Olá drivers podem ser encontrados [neste local](http://go.microsoft.com/fwlink/p/?LinkID=254263&clcid=0x409).</span><span class="sxs-lookup"><span data-stu-id="6f952-176">hello drivers can be found [at this location](http://go.microsoft.com/fwlink/p/?LinkID=254263&clcid=0x409).</span></span> <span data-ttu-id="6f952-177">A partir do RHEL **6.4 +** (e derivados) drivers LIS Olá já são incluídos no kernel Olá e portanto, não há pacotes de instalação adicionais é necessária toorun esses sistemas no Azure.</span><span class="sxs-lookup"><span data-stu-id="6f952-177">As of RHEL **6.4+** (and derivatives) hello LIS drivers are already included with hello kernel and so no additional installation packages are needed toorun those systems on Azure.</span></span>

<span data-ttu-id="6f952-178">Se um kernel personalizado for necessário, é recomendável toouse uma versão mais recente do kernel (ou seja, **3.8 +**).</span><span class="sxs-lookup"><span data-stu-id="6f952-178">If a custom kernel is required, it is recommended toouse a more recent kernel version (i.e. **3.8+**).</span></span> <span data-ttu-id="6f952-179">Para as distribuições ou fornecedores que mantêm seu próprios kernel, alguns esforço será necessário tooregularly backport Olá LIS drivers do kernel personalizado do tooyour Olá kernel upstream.</span><span class="sxs-lookup"><span data-stu-id="6f952-179">For those distributions or vendors who maintain their own kernel, some effort will be required tooregularly backport hello LIS drivers from hello upstream kernel tooyour custom kernel.</span></span>  <span data-ttu-id="6f952-180">Mesmo se você já estiver executando uma versão de kernel relativamente recentes, é altamente recomendável tookeep controlar qualquer upstream correções backport e drivers LIS Olá aqueles conforme necessário.</span><span class="sxs-lookup"><span data-stu-id="6f952-180">Even if you are already running a relatively recent kernel version, it is highly recommended tookeep track of any upstream fixes in hello LIS drivers and backport those as needed.</span></span> <span data-ttu-id="6f952-181">local de Olá Olá LIS driver de arquivos de origem está disponível no hello [MANTENEDORES](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/MAINTAINERS) arquivo na árvore de origem de kernel Olá Linux:</span><span class="sxs-lookup"><span data-stu-id="6f952-181">hello location of hello LIS driver source files is available in hello [MAINTAINERS](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/MAINTAINERS) file in hello Linux kernel source tree:</span></span>

    F:    arch/x86/include/asm/mshyperv.h
    F:    arch/x86/include/uapi/asm/hyperv.h
    F:    arch/x86/kernel/cpu/mshyperv.c
    F:    drivers/hid/hid-hyperv.c
    F:    drivers/hv/
    F:    drivers/input/serio/hyperv-keyboard.c
    F:    drivers/net/hyperv/
    F:    drivers/scsi/storvsc_drv.c
    F:    drivers/video/fbdev/hyperv_fb.c
    F:    include/linux/hyperv.h
    F:    tools/hv/

<span data-ttu-id="6f952-182">Em um mínimo, ausência Olá Olá patches a seguir são conhecidos toocause problemas no Azure e então eles devem ser incluídos no kernel hello.</span><span class="sxs-lookup"><span data-stu-id="6f952-182">At a very minimum, hello absence of hello following patches have been known toocause problems on Azure and so these must be included in hello kernel.</span></span> <span data-ttu-id="6f952-183">De forma alguma essa lista pode ser considerada completa para todas as distribuições:</span><span class="sxs-lookup"><span data-stu-id="6f952-183">This list is by no means exhaustive or complete for all distributions:</span></span>

* [<span data-ttu-id="6f952-184">ata_piix: adiar drivers toohello Hyper-V de discos por padrão</span><span class="sxs-lookup"><span data-stu-id="6f952-184">ata_piix: defer disks toohello Hyper-V drivers by default</span></span>](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/drivers/ata/ata_piix.c?id=cd006086fa5d91414d8ff9ff2b78fbb593878e3c)
* [<span data-ttu-id="6f952-185">storvsc: conta para os pacotes em trânsito no caminho de redefinição de saudação</span><span class="sxs-lookup"><span data-stu-id="6f952-185">storvsc: Account for in-transit packets in hello RESET path</span></span>](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/drivers/scsi/storvsc_drv.c?id=5c1b10ab7f93d24f29b5630286e323d1c5802d5c)
* [<span data-ttu-id="6f952-186">storvsc: evite o uso de WRITE_SAME</span><span class="sxs-lookup"><span data-stu-id="6f952-186">storvsc: avoid usage of WRITE_SAME</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=3e8f4f4065901c8dfc51407e1984495e1748c090)
* [<span data-ttu-id="6f952-187">storvsc: desabilite WRITE SAME para RAID e drivers do adaptador de host virtual</span><span class="sxs-lookup"><span data-stu-id="6f952-187">storvsc: Disable WRITE SAME for RAID and virtual host adapter drivers</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=54b2b50c20a61b51199bedb6e5d2f8ec2568fb43)
* [<span data-ttu-id="6f952-188">storvsc: correção de desreferência de ponteiro NULL</span><span class="sxs-lookup"><span data-stu-id="6f952-188">storvsc: NULL pointer dereference fix</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=b12bb60d6c350b348a4e1460cd68f97ccae9822e)
* [<span data-ttu-id="6f952-189">storvsc: as falhas do buffer de anéis podem resultar em congelamento de E/S</span><span class="sxs-lookup"><span data-stu-id="6f952-189">storvsc: ring buffer failures may result in I/O freeze</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=e86fb5e8ab95f10ec5f2e9430119d5d35020c951)
* [<span data-ttu-id="6f952-190">scsi_sysfs: proteger contra a execução dupla de __scsi_remove_device</span><span class="sxs-lookup"><span data-stu-id="6f952-190">scsi_sysfs: protect against double execution of __scsi_remove_device</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/scsi_sysfs.c?id=be821fd8e62765de43cc4f0e2db363d0e30a7e9b)

## <a name="hello-azure-linux-agent"></a><span data-ttu-id="6f952-191">Olá agente Linux do Azure</span><span class="sxs-lookup"><span data-stu-id="6f952-191">hello Azure Linux Agent</span></span>
<span data-ttu-id="6f952-192">Olá [agente Linux do Azure](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) (waagent) é necessário tooproperly provisionar uma máquina virtual do Linux no Azure.</span><span class="sxs-lookup"><span data-stu-id="6f952-192">hello [Azure Linux Agent](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) (waagent) is required tooproperly provision a Linux virtual machine in Azure.</span></span> <span data-ttu-id="6f952-193">Obter a versão mais recente do hello, problemas de arquivos ou enviar solicitações de recepção no hello [repositório GitHub de agente Linux](https://github.com/Azure/WALinuxAgent).</span><span class="sxs-lookup"><span data-stu-id="6f952-193">You can get hello latest version, file issues or submit pull requests at hello [Linux Agent GitHub repo](https://github.com/Azure/WALinuxAgent).</span></span>

* <span data-ttu-id="6f952-194">agente do Linux Olá foi lançado sob licença Olá Apache 2.0.</span><span class="sxs-lookup"><span data-stu-id="6f952-194">hello Linux agent is released under hello Apache 2.0 license.</span></span> <span data-ttu-id="6f952-195">Muitas distribuições já fornecem RPM ou deb pacotes para agente Olá, e então em alguns casos isso pode ser instalado e atualizado com pouco esforço.</span><span class="sxs-lookup"><span data-stu-id="6f952-195">Many distributions already provide RPM or deb packages for hello agent, and so in some cases this can be installed and updated with little effort.</span></span>
* <span data-ttu-id="6f952-196">Olá agente Linux do Azure requer Python v 2.6 +.</span><span class="sxs-lookup"><span data-stu-id="6f952-196">hello Azure Linux Agent requires Python v2.6+.</span></span>
* <span data-ttu-id="6f952-197">Agente de Olá também requer o módulo de python pyasn1 hello.</span><span class="sxs-lookup"><span data-stu-id="6f952-197">hello agent also requires hello python-pyasn1 module.</span></span> <span data-ttu-id="6f952-198">A maioria das distribuições fornece esse módulo como uma pacote autônomo instalável.</span><span class="sxs-lookup"><span data-stu-id="6f952-198">Most distributions provide this as a separate package that can be installed.</span></span>
* <span data-ttu-id="6f952-199">Em alguns casos Olá agente Linux do Azure pode não ser compatível com o Gerenciador.</span><span class="sxs-lookup"><span data-stu-id="6f952-199">In some cases hello Azure Linux Agent may not be compatible with NetworkManager.</span></span> <span data-ttu-id="6f952-200">Vários pacotes RPM/Deb Olá fornecidos pelo distribuições de configurar Gerenciador como um pacote de waagent toohello conflito e, portanto, serão desinstalado Gerenciador quando você instala o pacote do agente Linux hello.</span><span class="sxs-lookup"><span data-stu-id="6f952-200">Many of hello RPM/Deb packages provided by distributions configure NetworkManager as a conflict toohello waagent package, and thus will uninstall NetworkManager when you install hello Linux agent package.</span></span>

## <a name="general-linux-system-requirements"></a><span data-ttu-id="6f952-201">Requisitos gerais do sistema Linux</span><span class="sxs-lookup"><span data-stu-id="6f952-201">General Linux System Requirements</span></span>

* <span data-ttu-id="6f952-202">Modifique a linha de inicialização de kernel de saudação no GRUB ou GRUB2 Olá tooinclude parâmetros a seguir.</span><span class="sxs-lookup"><span data-stu-id="6f952-202">Modify hello kernel boot line in GRUB or GRUB2 tooinclude hello following parameters.</span></span> <span data-ttu-id="6f952-203">Isso garantirá todas as mensagens de console são enviadas toohello primeira porta serial, que pode ajudá-lo Azure suporte à depuração de problemas:</span><span class="sxs-lookup"><span data-stu-id="6f952-203">This will also ensure all console messages are sent toohello first serial port, which can assist Azure support with debugging issues:</span></span>
  
        console=ttyS0,115200n8 earlyprintk=ttyS0,115200 rootdelay=300
  
    <span data-ttu-id="6f952-204">Isso garantirá todas as mensagens de console são enviadas toohello primeira porta serial, que pode ajudá-lo Azure suporte à depuração de problemas.</span><span class="sxs-lookup"><span data-stu-id="6f952-204">This will also ensure all console messages are sent toohello first serial port, which can assist Azure support with debugging issues.</span></span>
  
    <span data-ttu-id="6f952-205">Além disso toohello acima, recomenda-se muito*remover* Olá parâmetros a seguir se eles existirem:</span><span class="sxs-lookup"><span data-stu-id="6f952-205">In addition toohello above, it is recommended too*remove* hello following parameters if they exist:</span></span>
  
        rhgb quiet crashkernel=auto
  
    <span data-ttu-id="6f952-206">Inicialização gráfica e silenciosa não são úteis em um ambiente de nuvem onde queremos que todos os toobe de logs de saudação enviada toohello de porta serial.</span><span class="sxs-lookup"><span data-stu-id="6f952-206">Graphical and quiet boot are not useful in a cloud environment where we want all hello logs toobe sent toohello serial port.</span></span> <span data-ttu-id="6f952-207">Olá `crashkernel` opção pode ser esquerda configurada, se desejado, mas observe que esse parâmetro será reduzir a quantidade de saudação de memória disponível em Olá VM em 128 MB ou mais, que pode ser problemático em tamanhos de VM menores hello.</span><span class="sxs-lookup"><span data-stu-id="6f952-207">hello `crashkernel` option may be left configured if desired, but note that this parameter will reduce hello amount of available memory in hello VM by 128MB or more, which may be problematic on hello smaller VM sizes.</span></span>

* <span data-ttu-id="6f952-208">Olá instalar agente Linux do Azure</span><span class="sxs-lookup"><span data-stu-id="6f952-208">Installing hello Azure Linux Agent</span></span>
  
    <span data-ttu-id="6f952-209">Olá agente Linux do Azure é necessária para o provisionamento de uma imagem do Linux no Azure.</span><span class="sxs-lookup"><span data-stu-id="6f952-209">hello Azure Linux Agent is required for provisioning a Linux image on Azure.</span></span>  <span data-ttu-id="6f952-210">Muitas distribuições fornecem agente hello como um pacote RPM ou Deb (pacote de saudação é geralmente chamado 'WALinuxAgent' ou 'walinuxagent').</span><span class="sxs-lookup"><span data-stu-id="6f952-210">Many distributions provide hello agent as an RPM or Deb package (hello package is typically called 'WALinuxAgent' or 'walinuxagent').</span></span>  <span data-ttu-id="6f952-211">Olá agente também pode ser instalado manualmente seguindo as etapas Olá Olá [guia do agente Linux](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="6f952-211">hello agent can also be installed manually by following hello steps in hello [Linux Agent Guide](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span></span>

* <span data-ttu-id="6f952-212">Certifique-se de servidor SSH hello está instalado e configurado toostart no momento da inicialização.</span><span class="sxs-lookup"><span data-stu-id="6f952-212">Ensure that hello SSH server is installed and configured toostart at boot time.</span></span>  <span data-ttu-id="6f952-213">Geralmente, esse é o padrão de saudação.</span><span class="sxs-lookup"><span data-stu-id="6f952-213">This is usually hello default.</span></span>

* <span data-ttu-id="6f952-214">Não crie espaço de permuta em disco do sistema operacional Olá</span><span class="sxs-lookup"><span data-stu-id="6f952-214">Do not create swap space on hello OS disk</span></span>
  
    <span data-ttu-id="6f952-215">Olá agente Linux do Azure pode configurar automaticamente o espaço de permuta usando Olá disco de recurso local que é anexado toohello VM após a configuração no Azure.</span><span class="sxs-lookup"><span data-stu-id="6f952-215">hello Azure Linux Agent can automatically configure swap space using hello local resource disk that is attached toohello VM after provisioning on Azure.</span></span> <span data-ttu-id="6f952-216">Observe que esse disco de recurso local Olá é um *temporário* disco e pode ser esvaziada quando Olá VM for desprovisionada.</span><span class="sxs-lookup"><span data-stu-id="6f952-216">Note that hello local resource disk is a *temporary* disk, and might be emptied when hello VM is deprovisioned.</span></span> <span data-ttu-id="6f952-217">Depois de instalar o hello agente Linux do Azure (consulte a etapa anterior), modifique Olá seguintes parâmetros em /etc/waagent.conf adequadamente:</span><span class="sxs-lookup"><span data-stu-id="6f952-217">After installing hello Azure Linux Agent (see previous step), modify hello following parameters in /etc/waagent.conf appropriately:</span></span>
  
        ResourceDisk.Format=y
        ResourceDisk.Filesystem=ext4
        ResourceDisk.MountPoint=/mnt/resource
        ResourceDisk.EnableSwap=y
        ResourceDisk.SwapSizeMB=2048    ## NOTE: set this toowhatever you need it toobe.

* <span data-ttu-id="6f952-218">Como etapa final, execute Olá comandos toodeprovision Olá virtual máquina a seguir:</span><span class="sxs-lookup"><span data-stu-id="6f952-218">As a final step, run hello following commands toodeprovision hello virtual machine:</span></span>
  
        # sudo waagent -force -deprovision
        # export HISTSIZE=0
        # logout
  
  > [!NOTE]
  > <span data-ttu-id="6f952-219">Em Virtualbox, você poderá ver Olá erro a seguir depois de executar ' waagent-force - desprovisionamento ': `[Errno 5] Input/output error`.</span><span class="sxs-lookup"><span data-stu-id="6f952-219">On Virtualbox you may see hello following error after running 'waagent -force -deprovision': `[Errno 5] Input/output error`.</span></span> <span data-ttu-id="6f952-220">Essa mensagem de erro não é crítica e pode ser ignorada.</span><span class="sxs-lookup"><span data-stu-id="6f952-220">This error message is not critical and can be ignored.</span></span>
  > 
  > 

* <span data-ttu-id="6f952-221">Em seguida, será necessário tooshut máquina virtual do hello e carregar Olá VHD tooAzure.</span><span class="sxs-lookup"><span data-stu-id="6f952-221">You will then need tooshut down hello virtual machine and upload hello VHD tooAzure.</span></span>

