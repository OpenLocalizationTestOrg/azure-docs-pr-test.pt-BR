---
title: "Opções de resolução de nomes DNS para máquinas virtuais Linux no Azure"
description: "Cenários de resolução de nomes para máquinas virtuais Linux no Azure IaaS, incluindo serviços DNS fornecidos, o servidor traga seu próprio DNS e DNS externo híbrido."
services: virtual-machines
documentationcenter: na
author: RicksterCDN
manager: timlt
editor: tysonn
ms.assetid: 787a1e04-cebf-4122-a1b4-1fcf0a2bbf5f
ms.service: virtual-machines-linux
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/19/2016
ms.author: rclaus
ms.openlocfilehash: cc06ee9305b4d3034154a0825c1aea53fe446f80
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="dns-name-resolution-options-for-linux-virtual-machines-in-azure"></a><span data-ttu-id="015d1-103">Opções de resolução de nomes DNS para máquinas virtuais Linux no Azure</span><span class="sxs-lookup"><span data-stu-id="015d1-103">DNS Name Resolution options for Linux virtual machines in Azure</span></span>
<span data-ttu-id="015d1-104">O Azure fornece resolução de nomes DNS por padrão para todas as máquinas virtuais que estão em uma única rede virtual.</span><span class="sxs-lookup"><span data-stu-id="015d1-104">Azure provides DNS name resolution by default for all virtual machines that are in a single virtual network.</span></span> <span data-ttu-id="015d1-105">Você pode implementar sua própria solução de resolução de nomes DNS configurando seus próprios serviços DNS em suas máquinas virtuais que o Azure hospeda.</span><span class="sxs-lookup"><span data-stu-id="015d1-105">You can implement your own DNS name resolution solution by configuring your own DNS services on your virtual machines that Azure hosts.</span></span> <span data-ttu-id="015d1-106">Os cenários a seguir devem ajudá-lo a escolher a que funciona para sua situação.</span><span class="sxs-lookup"><span data-stu-id="015d1-106">The following scenarios should help you choose the one that works for your situation.</span></span>

* [<span data-ttu-id="015d1-107">Resolução de nomes que o Azure fornece</span><span class="sxs-lookup"><span data-stu-id="015d1-107">Name resolution that Azure provides</span></span>](#azure-provided-name-resolution)
* [<span data-ttu-id="015d1-108">Resolução de nome usando o seu próprio servidor DNS</span><span class="sxs-lookup"><span data-stu-id="015d1-108">Name resolution using your own DNS server</span></span>](#name-resolution-using-your-own-dns-server)

<span data-ttu-id="015d1-109">O tipo de resolução de nomes que você usa depende de como as máquinas virtuais e as instâncias de função precisam se comunicar entre si.</span><span class="sxs-lookup"><span data-stu-id="015d1-109">The type of name resolution that you use depends on how your virtual machines and role instances need to communicate with each other.</span></span>

<span data-ttu-id="015d1-110">A tabela a seguir ilustra os cenários e as soluções de resolução de nomes correspondentes:</span><span class="sxs-lookup"><span data-stu-id="015d1-110">The following table illustrates scenarios and corresponding name resolution solutions:</span></span>

| <span data-ttu-id="015d1-111">**Cenário**</span><span class="sxs-lookup"><span data-stu-id="015d1-111">**Scenario**</span></span> | <span data-ttu-id="015d1-112">**Solução**</span><span class="sxs-lookup"><span data-stu-id="015d1-112">**Solution**</span></span> | <span data-ttu-id="015d1-113">**Suffix**</span><span class="sxs-lookup"><span data-stu-id="015d1-113">**Suffix**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="015d1-114">Resolução de nomes entre as instâncias de função ou as máquinas virtuais na mesma rede virtual</span><span class="sxs-lookup"><span data-stu-id="015d1-114">Name resolution between role instances or virtual machines in the same virtual network</span></span> |[<span data-ttu-id="015d1-115">Resolução de nomes que o Azure fornece</span><span class="sxs-lookup"><span data-stu-id="015d1-115">Name resolution that Azure provides</span></span>](#azure-provided-name-resolution) |<span data-ttu-id="015d1-116">nome de host ou FQDN (nome de domínio totalmente qualificado)</span><span class="sxs-lookup"><span data-stu-id="015d1-116">hostname or fully-qualified domain name (FQDN)</span></span> |
| <span data-ttu-id="015d1-117">Resolução de nomes entre as instâncias de função ou as máquinas virtuais em redes virtuais diferentes</span><span class="sxs-lookup"><span data-stu-id="015d1-117">Name resolution between role instances or virtual machines in different virtual networks</span></span> |<span data-ttu-id="015d1-118">Servidores DNS gerenciados pelo cliente que encaminham consultas entre redes virtuais para resolução pelo Azure (proxy DNS).</span><span class="sxs-lookup"><span data-stu-id="015d1-118">Customer-managed DNS servers that forward queries between virtual networks for resolution by Azure (DNS proxy).</span></span> <span data-ttu-id="015d1-119">Confira [Resolução de nomes usando o seu próprio servidor DNS](#name-resolution-using-your-own-dns-server).</span><span class="sxs-lookup"><span data-stu-id="015d1-119">See [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server).</span></span> |<span data-ttu-id="015d1-120">Somente FQDN</span><span class="sxs-lookup"><span data-stu-id="015d1-120">FQDN only</span></span> |
| <span data-ttu-id="015d1-121">Resolução de nomes de serviço e de computador locais em instâncias de função ou máquinas virtuais no Azure</span><span class="sxs-lookup"><span data-stu-id="015d1-121">Resolution of on-premises computers and service names from role instances or virtual machines in Azure</span></span> |<span data-ttu-id="015d1-122">Servidores DNS gerenciados pelo cliente (por exemplo, controlador de domínio local, controlador de domínio somente leitura local ou DNS secundário sincronizados usando transferências de zona).</span><span class="sxs-lookup"><span data-stu-id="015d1-122">Customer-managed DNS servers (for example, on-premises domain controller, local read-only domain controller, or a DNS secondary synced by using zone transfers).</span></span> <span data-ttu-id="015d1-123">Confira [Resolução de nomes usando o seu próprio servidor DNS](#name-resolution-using-your-own-dns-server).</span><span class="sxs-lookup"><span data-stu-id="015d1-123">See [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server).</span></span> |<span data-ttu-id="015d1-124">Somente FQDN</span><span class="sxs-lookup"><span data-stu-id="015d1-124">FQDN only</span></span> |
| <span data-ttu-id="015d1-125">Resolução de nomes de host do Azure de computadores locais</span><span class="sxs-lookup"><span data-stu-id="015d1-125">Resolution of Azure hostnames from on-premises computers</span></span> |<span data-ttu-id="015d1-126">Encaminhe consultas para um servidor de proxy de DNS gerenciada pelo cliente na rede virtual correspondente.</span><span class="sxs-lookup"><span data-stu-id="015d1-126">Forward queries to a customer-managed DNS proxy server in the corresponding virtual network.</span></span> <span data-ttu-id="015d1-127">O servidor proxy encaminha consultas para o Azure para resolução.</span><span class="sxs-lookup"><span data-stu-id="015d1-127">The proxy server forwards queries to Azure for resolution.</span></span> <span data-ttu-id="015d1-128">Confira [Resolução de nomes usando o seu próprio servidor DNS](#name-resolution-using-your-own-dns-server).</span><span class="sxs-lookup"><span data-stu-id="015d1-128">See [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server).</span></span> |<span data-ttu-id="015d1-129">Somente FQDN</span><span class="sxs-lookup"><span data-stu-id="015d1-129">FQDN only</span></span> |
| <span data-ttu-id="015d1-130">DNS inverso para IPs internos</span><span class="sxs-lookup"><span data-stu-id="015d1-130">Reverse DNS for internal IPs</span></span> |[<span data-ttu-id="015d1-131">Resolução de nome usando o seu próprio servidor DNS</span><span class="sxs-lookup"><span data-stu-id="015d1-131">Name resolution using your own DNS server</span></span>](#name-resolution-using-your-own-dns-server) |<span data-ttu-id="015d1-132">n/d</span><span class="sxs-lookup"><span data-stu-id="015d1-132">n/a</span></span> |

## <a name="name-resolution-that-azure-provides"></a><span data-ttu-id="015d1-133">Resolução de nomes que o Azure fornece</span><span class="sxs-lookup"><span data-stu-id="015d1-133">Name resolution that Azure provides</span></span>
<span data-ttu-id="015d1-134">Junto com a resolução de nomes DNS públicos, o Azure fornece uma resolução de nomes interna para máquinas virtuais e instâncias de função que estão na mesma rede virtual.</span><span class="sxs-lookup"><span data-stu-id="015d1-134">Along with resolution of public DNS names, Azure provides internal name resolution for virtual machines and role instances that are in the same virtual network.</span></span> <span data-ttu-id="015d1-135">Em redes virtuais baseadas no Azure Resource Manager, o sufixo DNS é consistente em toda a rede virtual; o FQDN não é necessário.</span><span class="sxs-lookup"><span data-stu-id="015d1-135">In virtual networks that are based on Azure Resource Manager, the DNS suffix is consistent across the virtual network; the FQDN is not needed.</span></span> <span data-ttu-id="015d1-136">Os nomes DNS podem ser atribuídos a máquinas virtuais e placas de adaptador de rede (NICs).</span><span class="sxs-lookup"><span data-stu-id="015d1-136">DNS names can be assigned to both network interface cards (NICs) and virtual machines.</span></span> <span data-ttu-id="015d1-137">Embora a resolução de nomes que o Azure fornece não solicite qualquer configuração, ela não é a escolha apropriada para todos os cenários de implantação, como mostrado na tabela acima.</span><span class="sxs-lookup"><span data-stu-id="015d1-137">Although the name resolution that Azure provides does not require any configuration, it is not the appropriate choice for all deployment scenarios, as seen on the preceding table.</span></span>

### <a name="features-and-considerations"></a><span data-ttu-id="015d1-138">Recursos e considerações</span><span class="sxs-lookup"><span data-stu-id="015d1-138">Features and considerations</span></span>
<span data-ttu-id="015d1-139">**Recursos:**</span><span class="sxs-lookup"><span data-stu-id="015d1-139">**Features:**</span></span>

* <span data-ttu-id="015d1-140">não é necessária nenhuma configuração para usar a resolução de nomes que o Azure fornece.</span><span class="sxs-lookup"><span data-stu-id="015d1-140">No configuration is required to use name resolution that Azure provides.</span></span>
* <span data-ttu-id="015d1-141">O serviço de resolução de nomes que o Azure fornece está altamente disponível.</span><span class="sxs-lookup"><span data-stu-id="015d1-141">The name resolution service that Azure provides is highly available.</span></span> <span data-ttu-id="015d1-142">Você não precisa criar e gerenciar clusters de seus próprios servidores DNS.</span><span class="sxs-lookup"><span data-stu-id="015d1-142">You don't need to create and manage clusters of your own DNS servers.</span></span>
* <span data-ttu-id="015d1-143">O serviço de resolução de nomes que o Azure fornece pode ser usado junto com seus próprios servidores DNS para resolver nomes de host locais e do Azure.</span><span class="sxs-lookup"><span data-stu-id="015d1-143">The name resolution service that Azure provides can be used along with your own DNS servers to resolve both on-premises and Azure hostnames.</span></span>
* <span data-ttu-id="015d1-144">A resolução de nomes é fornecida entre máquinas virtuais em redes virtuais sem a necessidade de FQDN.</span><span class="sxs-lookup"><span data-stu-id="015d1-144">Name resolution is provided between virtual machines in virtual networks without need for the FQDN.</span></span>
* <span data-ttu-id="015d1-145">Você pode usar nomes de host que descrevem melhor as suas implantações, em vez de trabalhar com nomes gerados automaticamente.</span><span class="sxs-lookup"><span data-stu-id="015d1-145">You can use hostnames that best describe your deployments rather than working with auto-generated names.</span></span>

<span data-ttu-id="015d1-146">**Considerações:**</span><span class="sxs-lookup"><span data-stu-id="015d1-146">**Considerations:**</span></span>

* <span data-ttu-id="015d1-147">O sufixo DNS que o Azure cria não pode ser modificado.</span><span class="sxs-lookup"><span data-stu-id="015d1-147">The DNS suffix that Azure creates cannot be modified.</span></span>
* <span data-ttu-id="015d1-148">Não é possível registrar manualmente seus próprios registros.</span><span class="sxs-lookup"><span data-stu-id="015d1-148">You cannot manually register your own records.</span></span>
* <span data-ttu-id="015d1-149">Não há suporte para o WINS e NetBIOS.</span><span class="sxs-lookup"><span data-stu-id="015d1-149">WINS and NetBIOS are not supported.</span></span>
* <span data-ttu-id="015d1-150">Os nomes de host devem ser compatíveis com DNS.</span><span class="sxs-lookup"><span data-stu-id="015d1-150">Hostnames must be DNS-compatible.</span></span>
    <span data-ttu-id="015d1-151">Os nomes devem usar somente 0-9, a-z e '-' e não podem começar ou terminar com um '-'.</span><span class="sxs-lookup"><span data-stu-id="015d1-151">Names must use only 0-9, a-z, and '-', and they cannot start or end with a '-'.</span></span> <span data-ttu-id="015d1-152">Veja a RFC 3696, seção 2.</span><span class="sxs-lookup"><span data-stu-id="015d1-152">See RFC 3696 Section 2.</span></span>
* <span data-ttu-id="015d1-153">O tráfego da consulta DNS é restrita a cada máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="015d1-153">DNS query traffic is throttled for each virtual machine.</span></span> <span data-ttu-id="015d1-154">Essa limitação não deve afetar a maioria dos aplicativos.</span><span class="sxs-lookup"><span data-stu-id="015d1-154">Throttling shouldn't impact most applications.</span></span>  <span data-ttu-id="015d1-155">Se a limitação da solicitação for observada, certifique-se de que o armazenamento em cache do cliente está habilitado.</span><span class="sxs-lookup"><span data-stu-id="015d1-155">If request throttling is observed, ensure that client-side caching is enabled.</span></span>  <span data-ttu-id="015d1-156">Para obter mais detalhes, confira [Obtendo o máximo de resolução de nomes que o Azure fornece](#getting-the-most-from-name-resolution-that-azure-provides).</span><span class="sxs-lookup"><span data-stu-id="015d1-156">For more information, see [Getting the most from name resolution that Azure provides](#getting-the-most-from-name-resolution-that-azure-provides).</span></span>

### <a name="getting-the-most-from-name-resolution-that-azure-provides"></a><span data-ttu-id="015d1-157">Obtendo o máximo de resolução de nomes que o Azure fornece</span><span class="sxs-lookup"><span data-stu-id="015d1-157">Getting the most from name resolution that Azure provides</span></span>
<span data-ttu-id="015d1-158">**Armazenamento em cache no lado cliente:**</span><span class="sxs-lookup"><span data-stu-id="015d1-158">**Client-side caching:**</span></span>

<span data-ttu-id="015d1-159">Algumas consultas DNS não são enviadas pela rede.</span><span class="sxs-lookup"><span data-stu-id="015d1-159">Some DNS queries are not sent across the network.</span></span> <span data-ttu-id="015d1-160">O armazenamento em cache do lado do cliente ajuda a reduzir a latência e melhorar a resistência a inconsistências de rede resolvendo consultas de DNS recorrentes a partir de um cache local.</span><span class="sxs-lookup"><span data-stu-id="015d1-160">Client-side caching helps reduce latency and improve resilience to network inconsistencies by resolving recurring DNS queries from a local cache.</span></span> <span data-ttu-id="015d1-161">Os registros DNS contêm um Time-To-Live (TTL) que permite que o cache armazene o registro o maior tempo possível sem afetar a atualização de registro.</span><span class="sxs-lookup"><span data-stu-id="015d1-161">DNS records contain a Time-To-Live (TTL), which enables the cache to store the record for as long as possible without impacting record freshness.</span></span> <span data-ttu-id="015d1-162">Como resultado disso, o cache do lado do cliente é adequado para a maioria das situações.</span><span class="sxs-lookup"><span data-stu-id="015d1-162">As a result, client-side caching is suitable for most situations.</span></span>

<span data-ttu-id="015d1-163">Algumas distribuições do Linux não incluem o armazenamento em cache por padrão.</span><span class="sxs-lookup"><span data-stu-id="015d1-163">Some Linux distributions do not include caching by default.</span></span> <span data-ttu-id="015d1-164">É recomendável que você adicione um cache para cada máquina virtual do Linux, depois de verificar se já não há um cache local.</span><span class="sxs-lookup"><span data-stu-id="015d1-164">We recommend that you add a cache to each Linux virtual machine after you check that there isn't a local cache already.</span></span>

<span data-ttu-id="015d1-165">Vários pacotes de cache DNS diferentes, como dnsmasq, estão disponíveis.</span><span class="sxs-lookup"><span data-stu-id="015d1-165">Several different DNS caching packages, such as dnsmasq, are available.</span></span> <span data-ttu-id="015d1-166">Aqui estão as etapas para instalar o dnsmasq nas distribuições mais comuns:</span><span class="sxs-lookup"><span data-stu-id="015d1-166">Here are the steps to install dnsmasq on the most common distributions:</span></span>

<span data-ttu-id="015d1-167">**Ubuntu (usa resolvconf)**</span><span class="sxs-lookup"><span data-stu-id="015d1-167">**Ubuntu (uses resolvconf)**</span></span>
  * <span data-ttu-id="015d1-168">Instale o pacote dnsmasq ("sudo apt-get install dnsmasq").</span><span class="sxs-lookup"><span data-stu-id="015d1-168">Install the dnsmasq package (“sudo apt-get install dnsmasq”).</span></span>

<span data-ttu-id="015d1-169">**SUSE (usa netconf)**:</span><span class="sxs-lookup"><span data-stu-id="015d1-169">**SUSE (uses netconf)**:</span></span>
1. <span data-ttu-id="015d1-170">Instale o pacote dnsmasq ("sudo zypper install dnsmasq").</span><span class="sxs-lookup"><span data-stu-id="015d1-170">Install the dnsmasq package (“sudo zypper install dnsmasq”).</span></span>
2. <span data-ttu-id="015d1-171">Habilite o serviço dnsmasq ("systemctl enable dnsmasq.service").</span><span class="sxs-lookup"><span data-stu-id="015d1-171">Enable the dnsmasq service (“systemctl enable dnsmasq.service”).</span></span>
3. <span data-ttu-id="015d1-172">Inicie o serviço dnsmasq ("systemctl start dnsmasq.service").</span><span class="sxs-lookup"><span data-stu-id="015d1-172">Start the dnsmasq service (“systemctl start dnsmasq.service”).</span></span>
4. <span data-ttu-id="015d1-173">Edite "/etc/sysconfig/network/config" e altere NETCONFIG_DNS_FORWARDER = "" para "dnsmasq".</span><span class="sxs-lookup"><span data-stu-id="015d1-173">Edit “/etc/sysconfig/network/config”, and change NETCONFIG_DNS_FORWARDER="" to ”dnsmasq”.</span></span>
5. <span data-ttu-id="015d1-174">Atualize resolv.conf ("netconfig update") para definir o cache do resolvedor DNS local.</span><span class="sxs-lookup"><span data-stu-id="015d1-174">Update resolv.conf ("netconfig update") to set the cache as the local DNS resolver.</span></span>

<span data-ttu-id="015d1-175">**CentOS por Rogue Wave Software (anteriormente OpenLogic) (usa o NetworkManager)**</span><span class="sxs-lookup"><span data-stu-id="015d1-175">**CentOS by Rogue Wave Software (formerly OpenLogic; uses NetworkManager)**</span></span>
1. <span data-ttu-id="015d1-176">Instale o pacote de dnsmasq ("sudo yum install dnsmasq").</span><span class="sxs-lookup"><span data-stu-id="015d1-176">Install the dnsmasq package (“sudo yum install dnsmasq”).</span></span>
2. <span data-ttu-id="015d1-177">Habilite o serviço dnsmasq ("systemctl enable dnsmasq.service").</span><span class="sxs-lookup"><span data-stu-id="015d1-177">Enable the dnsmasq service (“systemctl enable dnsmasq.service”).</span></span>
3. <span data-ttu-id="015d1-178">Inicie o serviço dnsmasq ("systemctl start dnsmasq.service").</span><span class="sxs-lookup"><span data-stu-id="015d1-178">Start the dnsmasq service (“systemctl start dnsmasq.service”).</span></span>
4. <span data-ttu-id="015d1-179">Adicione "prepend domain-name-servers 127.0.0.1;" a "/etc/dhclient-eth0.conf".</span><span class="sxs-lookup"><span data-stu-id="015d1-179">Add “prepend domain-name-servers 127.0.0.1;” to “/etc/dhclient-eth0.conf”.</span></span>
5. <span data-ttu-id="015d1-180">Reinicie o serviço de rede ("service network restart") para definir o cache como o resolvedor DNS local</span><span class="sxs-lookup"><span data-stu-id="015d1-180">Restart the network service (“service network restart”) to set the cache as the local DNS resolver</span></span>

> [!NOTE]
> <span data-ttu-id="015d1-181">: O pacote 'dnsmasq' é apenas um dos vários caches DNS disponíveis para o Linux.</span><span class="sxs-lookup"><span data-stu-id="015d1-181">: The 'dnsmasq' package is only one of the many DNS caches that are available for Linux.</span></span> <span data-ttu-id="015d1-182">Antes de usá-lo, verifique sua adequação para suas necessidades e se nenhum outro cache está instalado.</span><span class="sxs-lookup"><span data-stu-id="015d1-182">Before you use it, check its suitability for your needs and that no other cache is installed.</span></span>
>
>

<span data-ttu-id="015d1-183">**Tentativa no lado do cliente**</span><span class="sxs-lookup"><span data-stu-id="015d1-183">**Client-side retries**</span></span>

<span data-ttu-id="015d1-184">O DNS é principalmente um protocolo UDP.</span><span class="sxs-lookup"><span data-stu-id="015d1-184">DNS is primarily a UDP protocol.</span></span> <span data-ttu-id="015d1-185">Como o protocolo UDP não garante a entrega de mensagens, o próprio protocolo DNS manipula a lógica de repetição.</span><span class="sxs-lookup"><span data-stu-id="015d1-185">Because the UDP protocol doesn't guarantee message delivery, the DNS protocol itself handles retry logic.</span></span> <span data-ttu-id="015d1-186">Cada cliente DNS (sistema operacional) pode apresentar uma lógica de repetição diferente dependendo da preferência dos criadores:</span><span class="sxs-lookup"><span data-stu-id="015d1-186">Each DNS client (operating system) can exhibit different retry logic depending on the creator's preference:</span></span>

* <span data-ttu-id="015d1-187">Os sistemas operacionais Windows tentam novamente após um segundo e, em seguida, novamente após mais dois, quatro e outros quatro segundos.</span><span class="sxs-lookup"><span data-stu-id="015d1-187">Windows operating systems retry after one second and then again after another two, four, and another four seconds.</span></span>
* <span data-ttu-id="015d1-188">A configuração padrão do Linux tenta novamente após cinco segundos.</span><span class="sxs-lookup"><span data-stu-id="015d1-188">The default Linux setup retries after five seconds.</span></span>  <span data-ttu-id="015d1-189">Altere isso para tentar novamente cinco vezes em intervalos de um segundo.</span><span class="sxs-lookup"><span data-stu-id="015d1-189">You should change this to retry five times at one-second intervals.</span></span>  

<span data-ttu-id="015d1-190">Para verificar as configurações atuais em uma máquina virtual do Linux, 'cat /etc/resolv.conf' e examine a linha 'options', por exemplo:</span><span class="sxs-lookup"><span data-stu-id="015d1-190">To check the current settings on a Linux virtual machine, 'cat /etc/resolv.conf', and look at the 'options' line, for example:</span></span>

    options timeout:1 attempts:5

<span data-ttu-id="015d1-191">O arquivo resolv.conf é gerado automaticamente e não deve ser editado.</span><span class="sxs-lookup"><span data-stu-id="015d1-191">The resolv.conf file is auto-generated and should not be edited.</span></span> <span data-ttu-id="015d1-192">As etapas específicas que adicionam a linha 'options' variam de acordo com a distribuição:</span><span class="sxs-lookup"><span data-stu-id="015d1-192">The specific steps that add the 'options' line vary by distribution:</span></span>

<span data-ttu-id="015d1-193">**Ubuntu** (usa resolvconf)</span><span class="sxs-lookup"><span data-stu-id="015d1-193">**Ubuntu** (uses resolvconf)</span></span>
1. <span data-ttu-id="015d1-194">Adicione a linha de opções para '/etc/resolveconf/resolv.conf.d/head'.</span><span class="sxs-lookup"><span data-stu-id="015d1-194">Add the options line to '/etc/resolveconf/resolv.conf.d/head'.</span></span>
2. <span data-ttu-id="015d1-195">Execute 'resolvconf -u' para atualizar.</span><span class="sxs-lookup"><span data-stu-id="015d1-195">Run 'resolvconf -u' to update.</span></span>

<span data-ttu-id="015d1-196">**SUSE** (usa netconf)</span><span class="sxs-lookup"><span data-stu-id="015d1-196">**SUSE** (uses netconf)</span></span>
1. <span data-ttu-id="015d1-197">Adicione 'timeout:1 tentativas: 5' ao parâmetro NETCONFIG_DNS_RESOLVER_OPTIONS = "" em '/ etc/sysconfig/rede/config'.</span><span class="sxs-lookup"><span data-stu-id="015d1-197">Add 'timeout:1 attempts:5' to the NETCONFIG_DNS_RESOLVER_OPTIONS="" parameter in '/etc/sysconfig/network/config'.</span></span>
2. <span data-ttu-id="015d1-198">Execute 'netconfig update' para atualizar.</span><span class="sxs-lookup"><span data-stu-id="015d1-198">Run 'netconfig update' to update.</span></span>

<span data-ttu-id="015d1-199">**CentOS por Rogue Wave Software (anteriormente OpenLogic)** (usa o NetworkManager)</span><span class="sxs-lookup"><span data-stu-id="015d1-199">**CentOS by Rogue Wave Software (formerly OpenLogic)** (uses NetworkManager)</span></span>
1. <span data-ttu-id="015d1-200">Adicione 'echo "options timeout:1 attempts:5"' em '/etc/NetworkManager/dispatcher.d/11-dhclient'.</span><span class="sxs-lookup"><span data-stu-id="015d1-200">Add 'echo "options timeout:1 attempts:5"' to '/etc/NetworkManager/dispatcher.d/11-dhclient'.</span></span>
2. <span data-ttu-id="015d1-201">Execute 'service network restart' para atualizar.</span><span class="sxs-lookup"><span data-stu-id="015d1-201">Run 'service network restart' to update.</span></span>

## <a name="name-resolution-using-your-own-dns-server"></a><span data-ttu-id="015d1-202">Resolução de nome usando o seu próprio servidor DNS</span><span class="sxs-lookup"><span data-stu-id="015d1-202">Name resolution using your own DNS server</span></span>
<span data-ttu-id="015d1-203">Suas necessidades de resolução de nomes podem ir além dos recursos do Azure.</span><span class="sxs-lookup"><span data-stu-id="015d1-203">Your name resolution needs may go beyond the features that Azure provides.</span></span> <span data-ttu-id="015d1-204">Por exemplo, você pode exigir a resolução DNS entre redes virtuais.</span><span class="sxs-lookup"><span data-stu-id="015d1-204">For example, you might require DNS resolution between virtual networks.</span></span> <span data-ttu-id="015d1-205">Para abordar esse cenário, você poderá usar seus próprios servidores DNS.</span><span class="sxs-lookup"><span data-stu-id="015d1-205">To cover this scenario, you can use your own DNS servers.</span></span>  

<span data-ttu-id="015d1-206">Os servidores DNS em uma rede virtual podem encaminhar consultas DNS para os resolvedores recursivos do Azure a fim de resolver nomes de host que estão na mesma rede virtual.</span><span class="sxs-lookup"><span data-stu-id="015d1-206">DNS servers within a virtual network can forward DNS queries to recursive resolvers of Azure to resolve hostnames that are in the same virtual network.</span></span> <span data-ttu-id="015d1-207">Por exemplo, um servidor DNS que é executado o Azure pode responder a consultas DNS dos seus próprios arquivos de zona DNS e encaminhar todas as outras consultas ao Azure.</span><span class="sxs-lookup"><span data-stu-id="015d1-207">For example, a DNS server that runs in Azure can respond to DNS queries for its own DNS zone files and forward all other queries to Azure.</span></span> <span data-ttu-id="015d1-208">Essa funcionalidade permite que máquinas virtuais vejam as entradas nos arquivos de zona e os nomes de host que o Azure fornece (via o encaminhador).</span><span class="sxs-lookup"><span data-stu-id="015d1-208">This functionality enables virtual machines to see both your entries in your zone files and hostnames that Azure provides (via the forwarder).</span></span> <span data-ttu-id="015d1-209">O acesso a resolvedores recursivos do Azure é fornecido por meio da IP virtual 168.63.129.16.</span><span class="sxs-lookup"><span data-stu-id="015d1-209">Access to the recursive resolvers of Azure is provided via the virtual IP 168.63.129.16.</span></span>

<span data-ttu-id="015d1-210">O encaminhamento de DNS também habilita a resolução de DNS entre redes virtuais e habilita que suas máquinas locais resolvam os nomes de host que o Azure fornece.</span><span class="sxs-lookup"><span data-stu-id="015d1-210">DNS forwarding also enables DNS resolution between virtual networks and enables your on-premises machines to resolve hostnames that Azure provides.</span></span> <span data-ttu-id="015d1-211">Para resolver o nome de host da máquina virtual, a máquina virtual do servidor DNS deve residir na mesma rede virtual e ser configurado para encaminhar consultas de nome de host ao Azure.</span><span class="sxs-lookup"><span data-stu-id="015d1-211">To resolve a virtual machine's hostname, the DNS server virtual machine must reside in the same virtual network and be configured to forward hostname queries to Azure.</span></span> <span data-ttu-id="015d1-212">Como o sufixo DNS é diferente em cada rede virtual, você pode usar regras de encaminhamento condicionais para enviar consultas DNS a fim de serem resolvidas pela rede virtual correta.</span><span class="sxs-lookup"><span data-stu-id="015d1-212">Because the DNS suffix is different in each virtual network, you can use conditional forwarding rules to send DNS queries to the correct virtual network for resolution.</span></span> <span data-ttu-id="015d1-213">A imagem a seguir mostra duas redes virtuais e uma rede local fazendo a resolução do DNS entre redes virtuais usando esse método:</span><span class="sxs-lookup"><span data-stu-id="015d1-213">The following image shows two virtual networks and an on-premises network doing DNS resolution between virtual networks by using this method:</span></span>

![resolução do DNS entre redes virtuais](./media/azure-dns/inter-vnet-dns.png)

<span data-ttu-id="015d1-215">Quando você usa a resolução de nomes que o Azure fornece, o sufixo DNS interno é fornecido para cada máquina virtual usando o DHCP.</span><span class="sxs-lookup"><span data-stu-id="015d1-215">When you use name resolution that Azure provides, the internal DNS suffix is provided to each virtual machine by using DHCP.</span></span> <span data-ttu-id="015d1-216">Quando você usa sua própria solução de resolução de nomes, esse sufixo não será fornecido para as máquinas virtuais porque o sufixo interfere com outras arquiteturas de DNS.</span><span class="sxs-lookup"><span data-stu-id="015d1-216">When you use your own name resolution solution, this suffix is not supplied to virtual machines because the suffix interferes with other DNS architectures.</span></span> <span data-ttu-id="015d1-217">Para fazer referência a máquinas pelo FQDN, ou para configurar o sufixo em suas máquinas virtuais, você pode usar o PowerShell ou a API para determinar o sufixo:</span><span class="sxs-lookup"><span data-stu-id="015d1-217">To refer to machines by FQDN or to configure the suffix on your virtual machines, you can use PowerShell or the API to determine the suffix:</span></span>

* <span data-ttu-id="015d1-218">Para redes virtuais que são gerenciadas pelo Azure Resource Manager, o sufixo está disponível por meio do recurso [placa de adaptador de rede](https://msdn.microsoft.com/library/azure/mt163668.aspx).</span><span class="sxs-lookup"><span data-stu-id="015d1-218">For virtual networks that are managed by Azure Resource Manager, the suffix is available via the [network interface card](https://msdn.microsoft.com/library/azure/mt163668.aspx) resource.</span></span> <span data-ttu-id="015d1-219">Você também pode executar o comando `azure network public-ip show <resource group> <pip name>` para exibir os detalhes de seu IP público, que inclui o FQDN da NIC.</span><span class="sxs-lookup"><span data-stu-id="015d1-219">You can also run the `azure network public-ip show <resource group> <pip name>` command to display the details of your public IP, which includes the FQDN of the NIC.</span></span>

<span data-ttu-id="015d1-220">Se o encaminhamento de consultas para o Azure não atender às suas necessidades, você precisará fornecer sua própria solução DNS.</span><span class="sxs-lookup"><span data-stu-id="015d1-220">If forwarding queries to Azure doesn't suit your needs, you need to provide your own DNS solution.</span></span>  <span data-ttu-id="015d1-221">A solução do DNS precisa:</span><span class="sxs-lookup"><span data-stu-id="015d1-221">Your DNS solution needs to:</span></span>

* <span data-ttu-id="015d1-222">Fornecer resolução de nome de host apropriada, por exemplo, [DDNS](../../virtual-network/virtual-networks-name-resolution-ddns.md).</span><span class="sxs-lookup"><span data-stu-id="015d1-222">Provide appropriate hostname resolution, for example via [DDNS](../../virtual-network/virtual-networks-name-resolution-ddns.md).</span></span> <span data-ttu-id="015d1-223">Se você usar DDNS, convém desabilitar a limpeza de registro de DNS.</span><span class="sxs-lookup"><span data-stu-id="015d1-223">If you use DDNS, you might need to disable DNS record scavenging.</span></span> <span data-ttu-id="015d1-224">As concessões de DHCP do Azure são muito longas e a eliminação pode remover os registros DNS prematuramente.</span><span class="sxs-lookup"><span data-stu-id="015d1-224">DHCP leases of Azure are very long and scavenging may remove DNS records prematurely.</span></span>
* <span data-ttu-id="015d1-225">Fornecer a resolução recursiva apropriada para permitir a resolução de nomes de domínio externo.</span><span class="sxs-lookup"><span data-stu-id="015d1-225">Provide appropriate recursive resolution to allow resolution of external domain names.</span></span>
* <span data-ttu-id="015d1-226">Ser acessível (TCP e UDP na porta 53) dos clientes a que ela serve e ser capaz de acessar a Internet.</span><span class="sxs-lookup"><span data-stu-id="015d1-226">Be accessible (TCP and UDP on port 53) from the clients it serves and be able to access the Internet.</span></span>
* <span data-ttu-id="015d1-227">Ter proteção contra acesso da Internet, para atenuar as ameaças impostas por agentes externos.</span><span class="sxs-lookup"><span data-stu-id="015d1-227">Be secured against access from the Internet to mitigate threats posed by external agents.</span></span>

> [!NOTE]
> <span data-ttu-id="015d1-228">Para obter o melhor desempenho, quando usar máquinas virtuais em servidores DNS do Azure, desabilite o IPv6 e atribua um [IP público em nível de instância](../../virtual-network/virtual-networks-instance-level-public-ip.md) para cada máquina virtual do servidor DNS.</span><span class="sxs-lookup"><span data-stu-id="015d1-228">For best performance, when you use virtual machines in Azure DNS servers, disable IPv6 and assign an [Instance-Level Public IP](../../virtual-network/virtual-networks-instance-level-public-ip.md) to each DNS server virtual machine.</span></span>  
>
>
