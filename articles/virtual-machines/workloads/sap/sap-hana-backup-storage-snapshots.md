---
title: "backup do Azure do HANA aaaSAP com base em instantâneos de armazenamento | Microsoft Docs"
description: "Há duas possibilidades principais de backup para SAP HANA em máquinas virtuais do Azure, e este artigo aborda o backup do Azure do SAP HANA baseado em instantâneos de armazenamento"
services: virtual-machines-linux
documentationcenter: 
author: hermanndms
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ums.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 3/13/2017
ms.author: rclaus
ms.openlocfilehash: 32bb80f5a928a2cf63699bfe4f4cf5bbad81e6fe
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="sap-hana-backup-based-on-storage-snapshots"></a><span data-ttu-id="19e7c-103">Backup do SAP HANA com base em instantâneos de armazenamento</span><span class="sxs-lookup"><span data-stu-id="19e7c-103">SAP HANA backup based on storage snapshots</span></span>

## <a name="introduction"></a><span data-ttu-id="19e7c-104">Introdução</span><span class="sxs-lookup"><span data-stu-id="19e7c-104">Introduction</span></span>

<span data-ttu-id="19e7c-105">Este artigo faz parte de uma série dividida em três partes com artigos relacionados ao backup do SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="19e7c-105">This is part of a three-part series of related articles on SAP HANA backup.</span></span> <span data-ttu-id="19e7c-106">[Guia de backup para o SAP HANA em máquinas virtuais Azure](sap-hana-backup-guide.md) fornece uma visão geral e informações sobre como começar, e [SAP HANA Azure Backup em nível de arquivo](sap-hana-backup-file-level.md) abrange Olá a opção de backup baseado em arquivo.</span><span class="sxs-lookup"><span data-stu-id="19e7c-106">[Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md) provides an overview and information on getting started, and [SAP HANA Azure Backup on file level](sap-hana-backup-file-level.md) covers hello file-based backup option.</span></span>

<span data-ttu-id="19e7c-107">Ao usar um recurso de backup de VM para um sistema de demonstração de em um instância única, um considere fazer um backup VM em vez de gerenciar backups do HANA em Olá nível do sistema operacional.</span><span class="sxs-lookup"><span data-stu-id="19e7c-107">When using a VM backup feature for a single-instance all-in-one demo system, one should consider doing a VM backup instead of managing HANA backups at hello OS level.</span></span> <span data-ttu-id="19e7c-108">Uma alternativa é cópias de toocreate do tootake BLOBs do Azure instantâneos de discos virtuais individuais, que são anexados tooa VM e manter os arquivos de dados do HANA hello.</span><span class="sxs-lookup"><span data-stu-id="19e7c-108">An alternative is tootake Azure blob snapshots toocreate copies of individual virtual disks, which are attached tooa virtual machine, and keep hello HANA data files.</span></span> <span data-ttu-id="19e7c-109">Mas ponto crítico é a consistência do aplicativo quando criar um instantâneo de backup ou o disco VM enquanto Olá sistema está ligado e em execução.</span><span class="sxs-lookup"><span data-stu-id="19e7c-109">But a critical point is app consistency when creating a VM backup or disk snapshot while hello system is up and running.</span></span> <span data-ttu-id="19e7c-110">Consulte _consistência de dados SAP HANA ao armazenamento de instantâneos_ no artigo relacionado Olá [guia de Backup para o SAP HANA em máquinas virtuais Azure](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="19e7c-110">See _SAP HANA data consistency when taking storage snapshots_ in hello related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span> <span data-ttu-id="19e7c-111">O SAP HANA tem um recurso que oferece suporte a esses tipos de instantâneos de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="19e7c-111">SAP HANA has a feature that supports these kinds of storage snapshots.</span></span>

## <a name="sap-hana-snapshots"></a><span data-ttu-id="19e7c-112">Instantâneos do SAP HANA</span><span class="sxs-lookup"><span data-stu-id="19e7c-112">SAP HANA snapshots</span></span>

<span data-ttu-id="19e7c-113">Há um recurso no SAP HANA que oferece suporte a tirar um instantâneo do armazenamento.</span><span class="sxs-lookup"><span data-stu-id="19e7c-113">There is a feature in SAP HANA that supports taking a storage snapshot.</span></span> <span data-ttu-id="19e7c-114">No entanto, a partir de dezembro de 2016, há uma restrição sistemas toosingle contêiner.</span><span class="sxs-lookup"><span data-stu-id="19e7c-114">However, as of December 2016, there is a restriction toosingle-container systems.</span></span> <span data-ttu-id="19e7c-115">As configurações de contêiner multilocatário não dão suporte a esse tipo de instantâneo de banco de dados (veja [Criar um instantâneo de armazenamento (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm)).</span><span class="sxs-lookup"><span data-stu-id="19e7c-115">Multitenant container configurations do not support this kind of database snapshot (see [Create a Storage Snapshot (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm)).</span></span>

<span data-ttu-id="19e7c-116">Ele funciona da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="19e7c-116">It works as follows:</span></span>

- <span data-ttu-id="19e7c-117">Preparar para um instantâneo de armazenamento iniciando o instantâneo do SAP HANA Olá</span><span class="sxs-lookup"><span data-stu-id="19e7c-117">Prepare for a storage snapshot by initiating hello SAP HANA snapshot</span></span>
- <span data-ttu-id="19e7c-118">Execute o instantâneo de armazenamento da saudação (BLOBs do Azure, instantâneo, por exemplo)</span><span class="sxs-lookup"><span data-stu-id="19e7c-118">Run hello storage snapshot (Azure blob snapshot, for example)</span></span>
- <span data-ttu-id="19e7c-119">Confirme o instantâneo do SAP HANA Olá</span><span class="sxs-lookup"><span data-stu-id="19e7c-119">Confirm hello SAP HANA snapshot</span></span>

![Esta captura de tela mostra que um instantâneo de dados do SAP HANA pode ser criado por meio de uma instrução SQL](media/sap-hana-backup-storage-snapshots/image011.png)

<span data-ttu-id="19e7c-121">Esta captura de tela mostra que um instantâneo de dados do SAP HANA pode ser criado por meio de uma instrução SQL.</span><span class="sxs-lookup"><span data-stu-id="19e7c-121">This screenshot shows that an SAP HANA data snapshot can be created via a SQL statement.</span></span>

![Olá, em seguida, de instantâneo também aparece no catálogo de backup de saudação do SAP HANA Studio](media/sap-hana-backup-storage-snapshots/image012.png)

<span data-ttu-id="19e7c-123">Olá, em seguida, de instantâneo também aparece no catálogo de backup de saudação do SAP HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="19e7c-123">hello snapshot then also appears in hello backup catalog in SAP HANA Studio.</span></span>

![No disco, instantâneo Olá aparece no diretório de dados do SAP HANA Olá](media/sap-hana-backup-storage-snapshots/image013.png)

<span data-ttu-id="19e7c-125">No disco, instantâneo Olá aparece no diretório de dados do SAP HANA hello.</span><span class="sxs-lookup"><span data-stu-id="19e7c-125">On disk, hello snapshot shows up in hello SAP HANA data directory.</span></span>

<span data-ttu-id="19e7c-126">Um tem tooensure que também é a garantia de consistência do sistema de arquivo hello antes de executar o instantâneo de armazenamento Olá enquanto HANA SAP está no modo de preparação de instantâneo hello.</span><span class="sxs-lookup"><span data-stu-id="19e7c-126">One has tooensure that hello file system consistency is also guaranteed before running hello storage snapshot while SAP HANA is in hello snapshot preparation mode.</span></span> <span data-ttu-id="19e7c-127">Consulte _consistência de dados SAP HANA ao armazenamento de instantâneos_ no artigo relacionado Olá [guia de Backup para o SAP HANA em máquinas virtuais Azure](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="19e7c-127">See _SAP HANA data consistency when taking storage snapshots_ in hello related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span>

<span data-ttu-id="19e7c-128">Depois de instantâneo de armazenamento Olá, é instantâneo de SAP HANA Olá tooconfirm crítico.</span><span class="sxs-lookup"><span data-stu-id="19e7c-128">Once hello storage snapshot is done, it is critical tooconfirm hello SAP HANA snapshot.</span></span> <span data-ttu-id="19e7c-129">Há um toorun de instrução SQL correspondente: instantâneo de fechamento de dados de BACKUP (consulte [BACKUP de dados de instantâneo instrução CLOSE (Backup e recuperação)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/9739966f7f4bd5818769ad4ce6a7f8/content.htm)).</span><span class="sxs-lookup"><span data-stu-id="19e7c-129">There is a corresponding SQL statement toorun: BACKUP DATA CLOSE SNAPSHOT (see [BACKUP DATA CLOSE SNAPSHOT Statement (Backup and Recovery)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/9739966f7f4bd5818769ad4ce6a7f8/content.htm)).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="19e7c-130">Confirme o instantâneo do HANA hello.</span><span class="sxs-lookup"><span data-stu-id="19e7c-130">Confirm hello HANA snapshot.</span></span> <span data-ttu-id="19e7c-131">Vencimento muito&quot;Copy-on-Write,&quot; SAP HANA podem exigir espaço em disco adicional no instantâneo-modo de preparação e não é possível toostart novos backups até que o instantâneo do SAP HANA Olá for confirmado.</span><span class="sxs-lookup"><span data-stu-id="19e7c-131">Due too&quot;Copy-on-Write,&quot; SAP HANA might require additional disk space in snapshot-prepare mode, and it is not possible toostart new backups until hello SAP HANA snapshot is confirmed.</span></span>

## <a name="hana-vm-backup-via-azure-backup-service"></a><span data-ttu-id="19e7c-132">Backup da VM do HANA por meio do serviço de Backup do Azure</span><span class="sxs-lookup"><span data-stu-id="19e7c-132">HANA VM backup via Azure Backup service</span></span>

<span data-ttu-id="19e7c-133">A partir de dezembro de 2016, o agente de backup de saudação do hello serviço Backup do Azure não está disponível para VMs do Linux.</span><span class="sxs-lookup"><span data-stu-id="19e7c-133">As of December 2016, hello backup agent of hello Azure Backup service is not available for Linux VMs.</span></span> <span data-ttu-id="19e7c-134">uso de toomake de backup do Azure no nível de arquivo/diretório hello, um copie tooa de arquivos de backup do SAP HANA VM do Windows e, em seguida, usar o agente de backup hello.</span><span class="sxs-lookup"><span data-stu-id="19e7c-134">toomake use of Azure backup on hello file/directory level, one would copy SAP HANA backup files tooa Windows VM and then use hello backup agent.</span></span> <span data-ttu-id="19e7c-135">Caso contrário, apenas um backup completo de VM do Linux é possível por meio do serviço de Backup do Azure hello.</span><span class="sxs-lookup"><span data-stu-id="19e7c-135">Otherwise, only a full Linux VM backup is possible via hello Azure Backup service.</span></span> <span data-ttu-id="19e7c-136">Consulte [visão geral da saudação recursos no Azure Backup](../../../backup/backup-introduction-to-azure-backup.md) toofind mais.</span><span class="sxs-lookup"><span data-stu-id="19e7c-136">See [Overview of hello features in Azure Backup](../../../backup/backup-introduction-to-azure-backup.md) toofind out more.</span></span>

<span data-ttu-id="19e7c-137">Olá serviço Backup do Azure oferece uma opção tooback e restaurar uma máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="19e7c-137">hello Azure Backup service offers an option tooback up and restore a VM.</span></span> <span data-ttu-id="19e7c-138">Para obter mais informações sobre esse serviço e como ele funciona podem ser encontradas no artigo de saudação [planejar sua infraestrutura de backup de VM no Azure](../../../backup/backup-azure-vms-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="19e7c-138">More information about this service and how it works can be found in hello article [Plan your VM backup infrastructure in Azure](../../../backup/backup-azure-vms-introduction.md).</span></span>

<span data-ttu-id="19e7c-139">Há duas considerações importantes, de acordo com o artigo toothat:</span><span class="sxs-lookup"><span data-stu-id="19e7c-139">There are two important considerations according toothat article:</span></span>

<span data-ttu-id="19e7c-140">_&quot;Para máquinas virtuais Linux, somente backups consistentes de arquivos são possíveis, como Linux não tem um tooVSS plataforma equivalente.&quot;_</span><span class="sxs-lookup"><span data-stu-id="19e7c-140">_&quot;For Linux virtual machines, only file-consistent backups are possible, since Linux does not have an equivalent platform tooVSS.&quot;_</span></span>

<span data-ttu-id="19e7c-141">_&quot;Os aplicativos precisam tooimplement seus próprios &quot;correção&quot; mecanismo Olá restaurado dados.&quot;_</span><span class="sxs-lookup"><span data-stu-id="19e7c-141">_&quot;Applications need tooimplement their own &quot;fix-up&quot; mechanism on hello restored data.&quot;_</span></span>

<span data-ttu-id="19e7c-142">Portanto, um tem toomake se que SAP HANA está em um estado consistente no disco quando Olá backup é iniciado.</span><span class="sxs-lookup"><span data-stu-id="19e7c-142">Therefore, one has toomake sure SAP HANA is in a consistent state on disk when hello backup starts.</span></span> <span data-ttu-id="19e7c-143">Consulte _instantâneos do SAP HANA_ descritos anteriormente Olá documento.</span><span class="sxs-lookup"><span data-stu-id="19e7c-143">See _SAP HANA snapshots_ described earlier in hello document.</span></span> <span data-ttu-id="19e7c-144">Mas há um problema em potencial quando o SAP HANA permanece nesse modo de preparação de instantâneo.</span><span class="sxs-lookup"><span data-stu-id="19e7c-144">But there is a potential issue when SAP HANA stays in this snapshot preparation mode.</span></span> <span data-ttu-id="19e7c-145">Veja [Criar um instantâneo de armazenamento (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm) para saber mais.</span><span class="sxs-lookup"><span data-stu-id="19e7c-145">See [Create a Storage Snapshot (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm) for more information.</span></span>

<span data-ttu-id="19e7c-146">O artigo declara:</span><span class="sxs-lookup"><span data-stu-id="19e7c-146">That article states:</span></span>

<span data-ttu-id="19e7c-147">_&quot;Ele é altamente recomendável tooconfirm ou abandonar um instantâneo de armazenamento mais rápido possível depois de ele ter sido criado. Enquanto o instantâneo de armazenamento hello está sendo preparado ou criado, Olá dados relevantes de instantâneo estão congelados. Enquanto dados relevantes de instantâneo Olá permanecem congelados, alterações ainda podem ser feitas no banco de dados de saudação. Essas alterações não causará Olá congelado toobe relevantes de instantâneo de dados alterado. Em vez disso, as alterações de saudação são gravadas toopositions na área de dados Olá separados do instantâneo de armazenamento hello. As alterações também são gravadas toohello log. No entanto, mais dados de instantâneo relevantes Olá Olá são mantidos congelados, Olá Olá mais volume de dados pode crescer.&quot;_</span><span class="sxs-lookup"><span data-stu-id="19e7c-147">_&quot;It is strongly recommended tooconfirm or abandon a storage snapshot as soon as possible after it has been created. While hello storage snapshot is being prepared or created, hello snapshot-relevant data is frozen. While hello snapshot-relevant data remains frozen, changes can still be made in hello database. Such changes will not cause hello frozen snapshot-relevant data toobe changed. Instead, hello changes are written toopositions in hello data area that are separate from hello storage snapshot. Changes are also written toohello log. However, hello longer hello snapshot-relevant data is kept frozen, hello more hello data volume can grow.&quot;_</span></span>

<span data-ttu-id="19e7c-148">O Backup do Azure cuida da consistência do sistema de arquivo hello por meio de extensões de VM do Azure.</span><span class="sxs-lookup"><span data-stu-id="19e7c-148">Azure Backup takes care of hello file system consistency via Azure VM extensions.</span></span> <span data-ttu-id="19e7c-149">Essas extensões não são autônomos disponíveis e funcionam somente em conjunto com o serviço de Backup do Azure.</span><span class="sxs-lookup"><span data-stu-id="19e7c-149">These extensions are not available standalone, and work only in combination with Azure Backup service.</span></span> <span data-ttu-id="19e7c-150">No entanto, ainda é um requisito toomanage uma consistência de aplicativo SAP HANA instantâneo tooguarantee.</span><span class="sxs-lookup"><span data-stu-id="19e7c-150">Nevertheless, it is still a requirement toomanage an SAP HANA snapshot tooguarantee app consistency.</span></span>

<span data-ttu-id="19e7c-151">O Backup do Azure tem duas fases principais:</span><span class="sxs-lookup"><span data-stu-id="19e7c-151">Azure Backup has two major phases:</span></span>

- <span data-ttu-id="19e7c-152">Tirar instantâneo</span><span class="sxs-lookup"><span data-stu-id="19e7c-152">Take Snapshot</span></span>
- <span data-ttu-id="19e7c-153">Transferência de dados toovault</span><span class="sxs-lookup"><span data-stu-id="19e7c-153">Transfer data toovault</span></span>

<span data-ttu-id="19e7c-154">Uma pode confirmar o instantâneo do SAP HANA Olá após a conclusão da fase de serviço de Backup do Azure Olá de tirar um instantâneo.</span><span class="sxs-lookup"><span data-stu-id="19e7c-154">So one could confirm hello SAP HANA snapshot once hello Azure Backup service phase of taking a snapshot is completed.</span></span> <span data-ttu-id="19e7c-155">Pode levar vários toosee de minutos em Olá portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="19e7c-155">It might take several minutes toosee in hello Azure portal.</span></span>

![Esta figura mostra a parte da lista de trabalhos de backup de saudação de um serviço de Backup do Azure](media/sap-hana-backup-storage-snapshots/image014.png)

<span data-ttu-id="19e7c-157">Esta figura mostra a parte da lista de trabalho de backup de saudação de um serviço de Backup do Azure, que era usado tooback a VM de teste HANA hello.</span><span class="sxs-lookup"><span data-stu-id="19e7c-157">This figure shows part of hello backup job list of an Azure Backup service, which was used tooback up hello HANA test VM.</span></span>

![detalhes do trabalho Olá tooshow, clique em trabalho de backup Olá no hello portal do Azure](media/sap-hana-backup-storage-snapshots/image015.png)

<span data-ttu-id="19e7c-159">detalhes do trabalho Olá tooshow, clique em trabalho de backup Olá no hello portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="19e7c-159">tooshow hello job details, click hello backup job in hello Azure portal.</span></span> <span data-ttu-id="19e7c-160">Aqui, um pode ver Olá duas fases.</span><span class="sxs-lookup"><span data-stu-id="19e7c-160">Here, one can see hello two phases.</span></span> <span data-ttu-id="19e7c-161">Pode levar alguns minutos até que ela mostra a fase de instantâneo Olá como concluída.</span><span class="sxs-lookup"><span data-stu-id="19e7c-161">It might take a few minutes until it shows hello snapshot phase as completed.</span></span> <span data-ttu-id="19e7c-162">A maioria do tempo de saudação é gasto na fase de transferência de dados de saudação.</span><span class="sxs-lookup"><span data-stu-id="19e7c-162">Most of hello time is spent in hello data transfer phase.</span></span>

## <a name="hana-vm-backup-automation-via-azure-backup-service"></a><span data-ttu-id="19e7c-163">Automação de backups HANA VM por meio do serviço de Backup do Azure</span><span class="sxs-lookup"><span data-stu-id="19e7c-163">HANA VM backup automation via Azure Backup service</span></span>

<span data-ttu-id="19e7c-164">Um pôde confirmar instantâneo do SAP HANA Olá manualmente depois que a fase de instantâneo do Azure Backup Olá for concluída, conforme descrito anteriormente, mas é útil tooconsider automação porque um administrador não pode monitorar a lista de trabalho de backup de saudação em Olá portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="19e7c-164">One could manually confirm hello SAP HANA snapshot once hello Azure Backup snapshot phase is completed, as described earlier, but it is helpful tooconsider automation because an admin might not monitor hello backup job list in hello Azure portal.</span></span>

<span data-ttu-id="19e7c-165">Aqui está uma explicação de como isso pode ser obtido por meio de cmdlets do Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="19e7c-165">Here is an explanation how it could be accomplished via Azure PowerShell cmdlets.</span></span>

![Um serviço de Backup do Azure foi criado com hello nome hana--Cofre de backup](media/sap-hana-backup-storage-snapshots/image016.png)

<span data-ttu-id="19e7c-167">Um serviço de Backup do Azure foi criado com o nome da saudação &quot;hana-backup-cofre.&quot; Olá comando PS **AzureRmRecoveryServicesVault de Get-nome do Cofre de backup do hana** recupera Olá objeto correspondente.</span><span class="sxs-lookup"><span data-stu-id="19e7c-167">An Azure Backup service was created with hello name &quot;hana-backup-vault.&quot; hello PS command **Get-AzureRmRecoveryServicesVault -Name hana-backup-vault** retrieves hello corresponding object.</span></span> <span data-ttu-id="19e7c-168">Esse objeto é usado tooset Olá backup contexto como mostrado na figura a seguir hello.</span><span class="sxs-lookup"><span data-stu-id="19e7c-168">This object is then used tooset hello backup context as seen on hello next figure.</span></span>

![É possível verificar Olá trabalho de backup em andamento](media/sap-hana-backup-storage-snapshots/image017.png)

<span data-ttu-id="19e7c-170">Depois de contexto correto de saudação de configuração, um pode verificar Olá trabalho de backup está em andamento e, em seguida, procure os detalhes do trabalho.</span><span class="sxs-lookup"><span data-stu-id="19e7c-170">After setting hello correct context, one can check for hello backup job currently in progress, and then look for its job details.</span></span> <span data-ttu-id="19e7c-171">lista a subtarefa Olá mostra se fase de instantâneo de saudação do hello trabalho de backup do Azure já foi concluído:</span><span class="sxs-lookup"><span data-stu-id="19e7c-171">hello subtask list shows if hello snapshot phase of hello Azure backup job is already completed:</span></span>

```
$ars = Get-AzureRmRecoveryServicesVault -Name hana-backup-vault
Set-AzureRmRecoveryServicesVaultContext -Vault $ars
$jid = Get-AzureRmRecoveryServicesBackupJob -Status InProgress | select -ExpandProperty jobid
Get-AzureRmRecoveryServicesBackupJobDetails -Jobid $jid | select -ExpandProperty subtasks
```

![Valor de saudação de pesquisa em um loop até que ele transforma tooCompleted](media/sap-hana-backup-storage-snapshots/image018.png)

<span data-ttu-id="19e7c-173">Depois que os detalhes do trabalho Olá são armazenados em uma variável, é simplesmente PS sintaxe tooget toohello primeira entrada da matriz e recuperar o valor de status de saudação.</span><span class="sxs-lookup"><span data-stu-id="19e7c-173">Once hello job details are stored in a variable, it is simply PS syntax tooget toohello first array entry and retrieve hello status value.</span></span> <span data-ttu-id="19e7c-174">script de automação de saudação toocomplete, sondagem Olá valor em um loop até que ele ativa muito&quot;concluída.&quot;</span><span class="sxs-lookup"><span data-stu-id="19e7c-174">toocomplete hello automation script, poll hello value in a loop until it turns too&quot;Completed.&quot;</span></span>

```
$st = Get-AzureRmRecoveryServicesBackupJobDetails -Jobid $jid | select -ExpandProperty subtasks
$st[0] | select -ExpandProperty status
```

## <a name="hana-license-key-and-vm-restore-via-azure-backup-service"></a><span data-ttu-id="19e7c-175">Restaurar a chave de licença do HANA e VM por meio do serviço de Backup do Azure</span><span class="sxs-lookup"><span data-stu-id="19e7c-175">HANA license key and VM restore via Azure Backup service</span></span>

<span data-ttu-id="19e7c-176">saudação de serviço de Backup do Azure é projetado toocreate uma nova VM durante a restauração.</span><span class="sxs-lookup"><span data-stu-id="19e7c-176">hello Azure Backup service is designed toocreate a new VM during restore.</span></span> <span data-ttu-id="19e7c-177">Não há nenhum plano à direita agora toodo um &quot;in-loco&quot; restauração de uma VM do Azure existente.</span><span class="sxs-lookup"><span data-stu-id="19e7c-177">There is no plan right now toodo an &quot;in-place&quot; restore of an existing Azure VM.</span></span>

![Esta figura mostra a opção de restauração de saudação de saudação do serviço do Azure em Olá portal do Azure](media/sap-hana-backup-storage-snapshots/image019.png)

<span data-ttu-id="19e7c-179">Esta figura mostra a opção de restauração de saudação de saudação do serviço do Azure em Olá portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="19e7c-179">This figure shows hello restore option of hello Azure service in hello Azure portal.</span></span> <span data-ttu-id="19e7c-180">Você pode escolher entre criar uma máquina virtual durante a restauração ou restauração de discos de saudação.</span><span class="sxs-lookup"><span data-stu-id="19e7c-180">One can choose between creating a VM during restore or restoring hello disks.</span></span> <span data-ttu-id="19e7c-181">Depois de restaurar discos Olá, é necessário ainda toocreate uma nova VM sobre ele.</span><span class="sxs-lookup"><span data-stu-id="19e7c-181">After restoring hello disks, it is still necessary toocreate a new VM on top of it.</span></span> <span data-ttu-id="19e7c-182">Sempre que uma nova VM é criada em alterações de VM ID exclusivas hello Azure (consulte [acessando e usando o Azure VM ident](https://azure.microsoft.com/blog/accessing-and-using-azure-vm-unique-id/)).</span><span class="sxs-lookup"><span data-stu-id="19e7c-182">Whenever a new VM gets created on Azure hello unique VM ID changes (see [Accessing and Using Azure VM Unique ID](https://azure.microsoft.com/blog/accessing-and-using-azure-vm-unique-id/)).</span></span>

![Esta figura mostra a ID exclusiva de VM do Azure Olá antes e após a restauração de saudação por meio do serviço de Backup do Azure](media/sap-hana-backup-storage-snapshots/image020.png)

<span data-ttu-id="19e7c-184">Esta figura mostra a ID exclusiva de VM do Azure Olá antes e após a restauração de saudação por meio do serviço de Backup do Azure.</span><span class="sxs-lookup"><span data-stu-id="19e7c-184">This figure shows hello Azure VM unique ID before and after hello restore via Azure Backup service.</span></span> <span data-ttu-id="19e7c-185">chave de hardware do SAP Hello, que é usado para licenciamento do SAP, está usando esta ID exclusiva de VM.</span><span class="sxs-lookup"><span data-stu-id="19e7c-185">hello SAP hardware key, which is used for SAP licensing, is using this unique VM ID.</span></span> <span data-ttu-id="19e7c-186">Como consequência, uma nova licença SAP tem toobe instalado após uma restauração de VM.</span><span class="sxs-lookup"><span data-stu-id="19e7c-186">As a consequence, a new SAP license has toobe installed after a VM restore.</span></span>

<span data-ttu-id="19e7c-187">Um novo recurso de Backup do Azure foi apresentado no modo de visualização durante a criação de saudação deste guia de backup.</span><span class="sxs-lookup"><span data-stu-id="19e7c-187">A new Azure Backup feature was presented in preview mode during hello creation of this backup guide.</span></span> <span data-ttu-id="19e7c-188">Ele permite que uma restauração de nível de arquivo com base no instantâneo VM Olá que foi feito para Olá VM backup.</span><span class="sxs-lookup"><span data-stu-id="19e7c-188">It allows a file level restore based on hello VM snapshot that was taken for hello VM backup.</span></span> <span data-ttu-id="19e7c-189">Isso evita a necessidade de saudação toodeploy uma nova VM e, portanto, permanece de VM ID exclusivo Olá Olá mesmo e nenhuma nova chave de licença do SAP HANA é necessária.</span><span class="sxs-lookup"><span data-stu-id="19e7c-189">This avoids hello need toodeploy a new VM, and therefore hello unique VM ID stays hello same and no new SAP HANA license key is required.</span></span> <span data-ttu-id="19e7c-190">Mais documentação sobre este recurso será fornecida depois que ele foi totalmente testado.</span><span class="sxs-lookup"><span data-stu-id="19e7c-190">More documentation on this feature will be provided after it is fully tested.</span></span>

<span data-ttu-id="19e7c-191">O Backup do Azure serão eventualmente permitir o backup de discos virtuais do Azure individuais, além de arquivos e diretórios de dentro de Olá VM.</span><span class="sxs-lookup"><span data-stu-id="19e7c-191">Azure Backup will eventually allow backup of individual Azure virtual disks, plus files and directories from inside hello VM.</span></span> <span data-ttu-id="19e7c-192">Uma grande vantagem do Backup do Azure é o gerenciamento de todos os backups de hello, salvando Prezado cliente tenha toodo-lo.</span><span class="sxs-lookup"><span data-stu-id="19e7c-192">A major advantage of Azure Backup is its management of all hello backups, saving hello customer from having toodo it.</span></span> <span data-ttu-id="19e7c-193">Se uma restauração for necessária, o Backup do Azure selecionará Olá toouse de backup correto.</span><span class="sxs-lookup"><span data-stu-id="19e7c-193">If a restore becomes necessary, Azure Backup will select hello correct backup toouse.</span></span>

## <a name="sap-hana-vm-backup-via-manual-disk-snapshot"></a><span data-ttu-id="19e7c-194">Backup de VM do SAP HANA por meio de instantâneo de disco manual</span><span class="sxs-lookup"><span data-stu-id="19e7c-194">SAP HANA VM backup via manual disk snapshot</span></span>

<span data-ttu-id="19e7c-195">Em vez de usar o serviço de Backup do Azure Olá, um pode configurar uma solução de backup individual por meio da criação de instantâneos de blob do Azure VHDs manualmente por meio do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="19e7c-195">Instead of using hello Azure Backup service, one could configure an individual backup solution by creating blob snapshots of Azure VHDs manually via PowerShell.</span></span> <span data-ttu-id="19e7c-196">Consulte [usando instantâneos de blob com o PowerShell](https://blogs.msdn.microsoft.com/cie/2016/05/17/using-blob-snapshots-with-powershell/) para obter uma descrição das etapas de saudação.</span><span class="sxs-lookup"><span data-stu-id="19e7c-196">See [Using blob snapshots with PowerShell](https://blogs.msdn.microsoft.com/cie/2016/05/17/using-blob-snapshots-with-powershell/) for a description of hello steps.</span></span>

<span data-ttu-id="19e7c-197">Ele oferece mais flexibilidade, mas não resolve problemas de saudação explicados anteriormente neste documento:</span><span class="sxs-lookup"><span data-stu-id="19e7c-197">It provides more flexibility but does not resolve hello issues explained earlier in this document:</span></span>

- <span data-ttu-id="19e7c-198">Você ainda deve se certificar de que o SAP HANA está em um estado consistente</span><span class="sxs-lookup"><span data-stu-id="19e7c-198">One still must make sure that SAP HANA is in a consistent state</span></span>
- <span data-ttu-id="19e7c-199">disco do sistema operacional Olá não pode ser substituído, mesmo que exista Olá que VM é desalocada devido a um erro informando que uma concessão.</span><span class="sxs-lookup"><span data-stu-id="19e7c-199">hello OS disk cannot be overwritten even if hello VM is deallocated because of an error stating that a lease exists.</span></span> <span data-ttu-id="19e7c-200">Funciona somente após a exclusão Olá VM, que poderia levar tooa novo exclusivo ID da VM e hello necessidade tooinstall uma nova licença SAP.</span><span class="sxs-lookup"><span data-stu-id="19e7c-200">It only works after deleting hello VM, which would lead tooa new unique VM ID and hello need tooinstall a new SAP license.</span></span>

![É possível toorestore somente Olá os discos de dados de uma VM do Azure](media/sap-hana-backup-storage-snapshots/image021.png)

<span data-ttu-id="19e7c-202">É toorestore possíveis apenas discos de dados de saudação de uma VM do Azure, evitando o problema de saudação da obtenção de uma nova ID exclusiva da VM e, portanto, invalidados licença do SAP hello:</span><span class="sxs-lookup"><span data-stu-id="19e7c-202">It is possible toorestore only hello data disks of an Azure VM, avoiding hello problem of getting a new unique VM ID and, therefore, invalidated hello SAP license:</span></span>

- <span data-ttu-id="19e7c-203">Para teste hello, dois discos de dados do Azure foram anexado tooa VM e RAID de software foi definida na parte superior-los</span><span class="sxs-lookup"><span data-stu-id="19e7c-203">For hello test, two Azure data disks were attached tooa VM and software RAID was defined on top of them</span></span> 
- <span data-ttu-id="19e7c-204">Ele foi confirmado que o SAP HANA estava em um estado consistente pelo recurso de instantâneo do SAP HANA</span><span class="sxs-lookup"><span data-stu-id="19e7c-204">It was confirmed that SAP HANA was in a consistent state by SAP HANA snapshot feature</span></span>
- <span data-ttu-id="19e7c-205">Congelamento do sistema de arquivos (consulte _consistência de dados SAP HANA ao armazenamento de instantâneos_ no artigo relacionado Olá [guia de Backup para o SAP HANA em máquinas virtuais Azure](sap-hana-backup-guide.md))</span><span class="sxs-lookup"><span data-stu-id="19e7c-205">File system freeze (see _SAP HANA data consistency when taking storage snapshots_ in hello related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md))</span></span>
- <span data-ttu-id="19e7c-206">Instantâneos de blob foram tirados de ambos os discos de dados</span><span class="sxs-lookup"><span data-stu-id="19e7c-206">Blob snapshots were taken from both data disks</span></span>
- <span data-ttu-id="19e7c-207">Descongelar do sistema de arquivos</span><span class="sxs-lookup"><span data-stu-id="19e7c-207">File system unfreeze</span></span>
- <span data-ttu-id="19e7c-208">Confirmação de instantâneo do SAP HANA</span><span class="sxs-lookup"><span data-stu-id="19e7c-208">SAP HANA snapshot confirmation</span></span>
- <span data-ttu-id="19e7c-209">desanexar de ambos os discos e discos de dados do toorestore hello, Olá VM foi desligado</span><span class="sxs-lookup"><span data-stu-id="19e7c-209">toorestore hello data disks, hello VM was shut down and both disks detached</span></span>
- <span data-ttu-id="19e7c-210">Depois de desanexar discos hello, foram substituídos com instantâneos de blob antiga Olá</span><span class="sxs-lookup"><span data-stu-id="19e7c-210">After detaching hello disks, they were overwritten with hello former blob snapshots</span></span>
- <span data-ttu-id="19e7c-211">E discos virtuais Olá restaurado foram anexados novamente toohello VM</span><span class="sxs-lookup"><span data-stu-id="19e7c-211">Then hello restored virtual disks were attached again toohello VM</span></span>
- <span data-ttu-id="19e7c-212">Depois que o tempo de instantâneo de VM, tudo no software Olá RAID funcionou bem e foi redefinido blob toohello de saudação inicial</span><span class="sxs-lookup"><span data-stu-id="19e7c-212">After starting hello VM, everything on hello software RAID worked fine and was set back toohello blob snapshot time</span></span>
- <span data-ttu-id="19e7c-213">HANA foi redefinido instantâneo do HANA toohello</span><span class="sxs-lookup"><span data-stu-id="19e7c-213">HANA was set back toohello HANA snapshot</span></span>

<span data-ttu-id="19e7c-214">Se foi possível tooshut para baixo do SAP HANA antes de instantâneos de blob hello, procedimento Olá seria menos complexo.</span><span class="sxs-lookup"><span data-stu-id="19e7c-214">If it was possible tooshut down SAP HANA before hello blob snapshots, hello procedure would be less complex.</span></span> <span data-ttu-id="19e7c-215">Nesse caso, um pode ignorar o instantâneo do HANA hello e, se nada mais acontece no sistema hello, também ignorar congelamento de sistema de arquivo hello.</span><span class="sxs-lookup"><span data-stu-id="19e7c-215">In that case, one could skip hello HANA snapshot and, if nothing else is going on in hello system, also skip hello file system freeze.</span></span> <span data-ttu-id="19e7c-216">Complexidade adicional é imagem hello quando é necessário toodo instantâneos enquanto tudo está online.</span><span class="sxs-lookup"><span data-stu-id="19e7c-216">Added complexity comes into hello picture when it is necessary toodo snapshots while everything is online.</span></span> <span data-ttu-id="19e7c-217">Consulte _consistência de dados SAP HANA ao armazenamento de instantâneos_ no artigo relacionado Olá [guia de Backup para o SAP HANA em máquinas virtuais Azure](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="19e7c-217">See _SAP HANA data consistency when taking storage snapshots_ in hello related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="19e7c-218">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="19e7c-218">Next steps</span></span>
* <span data-ttu-id="19e7c-219">[Guia de backup do SAP HANA nas Máquinas Virtuais do Azure](sap-hana-backup-guide.md) fornece uma visão geral e informações sobre como começar.</span><span class="sxs-lookup"><span data-stu-id="19e7c-219">[Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md) gives an overview and information on getting started.</span></span>
* <span data-ttu-id="19e7c-220">[Backup do HANA SAP com base no nível de arquivo](sap-hana-backup-file-level.md) abrange Olá a opção de backup baseado em arquivo.</span><span class="sxs-lookup"><span data-stu-id="19e7c-220">[SAP HANA backup based on file level](sap-hana-backup-file-level.md) covers hello file-based backup option.</span></span>
* <span data-ttu-id="19e7c-221">toolearn como tooestablish alta disponibilidade e o plano de recuperação de desastres do HANA SAP no Azure (instâncias grandes), consulte [SAP HANA (instâncias grandes) alta disponibilidade e recuperação de desastres no Azure](hana-overview-high-availability-disaster-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="19e7c-221">toolearn how tooestablish high availability and plan for disaster recovery of SAP HANA on Azure (large instances), see [SAP HANA (large instances) high availability and disaster recovery on Azure](hana-overview-high-availability-disaster-recovery.md).</span></span>
