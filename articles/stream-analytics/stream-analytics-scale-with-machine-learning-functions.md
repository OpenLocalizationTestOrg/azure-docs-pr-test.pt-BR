---
title: "Dimensionando o trabalho com o Azure Stream Analytics e as funções do Azure Machine Learning | Microsoft Docs"
description: "Saiba como dimensionar corretamente os trabalhos do Stream Analytics (particionamento, quantidade de SU e muito mais) ao usar funções do Azure Machine Learning."
keywords: 
documentationcenter: 
services: stream-analytics
author: jeffstokes72
manager: jhubbard
editor: cgronlun
ms.assetid: 47ce7c5e-1de1-41ca-9a26-b5ecce814743
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 03/28/2017
ms.author: jeffstok
ms.openlocfilehash: 5e07e4efcd14cd8c12124cb34058ef6c345f7f47
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/29/2017
---
# <a name="scale-your-stream-analytics-job-with-azure-machine-learning-functions"></a><span data-ttu-id="4f23c-103">Dimensionar seu trabalho do Stream Analytics com funções do Azure Machine Learning</span><span class="sxs-lookup"><span data-stu-id="4f23c-103">Scale your Stream Analytics job with Azure Machine Learning functions</span></span>
<span data-ttu-id="4f23c-104">Geralmente, é bem fácil configurar um trabalho do Stream Analytics e executar alguns dados de exemplo nele.</span><span class="sxs-lookup"><span data-stu-id="4f23c-104">It is often quite easy to set up an Stream Analytics job and run some sample data through it.</span></span> <span data-ttu-id="4f23c-105">O que podemos fazer quando precisamos executar o mesmo trabalho com um volume de dados maior?</span><span class="sxs-lookup"><span data-stu-id="4f23c-105">What should we do when we need to run the same job with higher data volume?</span></span> <span data-ttu-id="4f23c-106">Precisamos entender como configurar o trabalho do Stream Analytics para que ele possa ser escalado.</span><span class="sxs-lookup"><span data-stu-id="4f23c-106">It requires us to understand how to configure the Stream Analytics job so that it will scale.</span></span> <span data-ttu-id="4f23c-107">Neste documento, nos concentraremos nos aspectos especiais do dimensionamento de trabalhos do Stream Analytics com funções do Machine Learning.</span><span class="sxs-lookup"><span data-stu-id="4f23c-107">In this document, we will focus on the special aspects of scaling Stream Analytics jobs with Machine Learning functions.</span></span> <span data-ttu-id="4f23c-108">Para saber mais sobre como dimensionar trabalhos do Stream Analytics em geral, confira o artigo [Dimensionar os trabalhos do Stream Analytics](stream-analytics-scale-jobs.md).</span><span class="sxs-lookup"><span data-stu-id="4f23c-108">For information on how to scale Stream Analytics jobs in general see the article [Scaling jobs](stream-analytics-scale-jobs.md).</span></span>

## <a name="what-is-an-azure-machine-learning-function-in-stream-analytics"></a><span data-ttu-id="4f23c-109">O que é uma função do Azure Machine Learning no Stream Analytics?</span><span class="sxs-lookup"><span data-stu-id="4f23c-109">What is an Azure Machine Learning function in Stream Analytics?</span></span>
<span data-ttu-id="4f23c-110">Uma função do Machine Learning no Stream Analytics pode ser usada como uma chamada de função normal na linguagem de consulta do Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="4f23c-110">A Machine Learning function in Stream Analytics can be used like a regular function call in the Stream Analytics query language.</span></span> <span data-ttu-id="4f23c-111">No entanto, nos bastidores, as chamadas de função são, na verdade, solicitações de Serviço Web do Azure Machine Learning.</span><span class="sxs-lookup"><span data-stu-id="4f23c-111">However, behind the scene, the function calls are actually Azure Machine Learning Web Service requests.</span></span> <span data-ttu-id="4f23c-112">Os serviços Web do Machine Learning oferecem suporte à inclusão de várias linhas em "lotes", o que é chamado de lote simplificado, na mesma chamada à API de serviço Web, a fim de melhorar a produtividade geral.</span><span class="sxs-lookup"><span data-stu-id="4f23c-112">Machine Learning web services support “batching” multiple rows, which is called mini-batch, in the same web service API call, to improve overall throughput.</span></span> <span data-ttu-id="4f23c-113">Confira os artigos a seguir para obter mais detalhes. [Funções do Azure Machine Learning no Stream Analytics](https://blogs.technet.microsoft.com/machinelearning/2015/12/10/azure-ml-now-available-as-a-function-in-azure-stream-analytics/) e [Serviços Web do Azure Machine Learning](../machine-learning/machine-learning-consume-web-services.md).</span><span class="sxs-lookup"><span data-stu-id="4f23c-113">Please see the following articles for more details; [Azure Machine Learning functions in Stream Analytics](https://blogs.technet.microsoft.com/machinelearning/2015/12/10/azure-ml-now-available-as-a-function-in-azure-stream-analytics/) and [Azure Machine Learning Web Services](../machine-learning/machine-learning-consume-web-services.md).</span></span>

## <a name="configure-a-stream-analytics-job-with-machine-learning-functions"></a><span data-ttu-id="4f23c-114">Configurar seu trabalho do Stream Analytics com funções de Machine Learning</span><span class="sxs-lookup"><span data-stu-id="4f23c-114">Configure a Stream Analytics job with Machine Learning functions</span></span>
<span data-ttu-id="4f23c-115">Ao configurar uma função do Machine Learning para um trabalho do Stream Analytics, há dois parâmetros a serem considerados, o tamanho do lote das chamadas de função do Machine Learning e as SUs (unidades de streaming) provisionadas para o trabalho do Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="4f23c-115">When configuring a Machine Learning function for Stream Analytics job, there are two parameters to consider, the batch size of the Machine Learning function calls, and the streaming units (SUs) provisioned for the Stream Analytics job.</span></span> <span data-ttu-id="4f23c-116">Para determinar seus valores apropriados, é necessário tomar uma decisão primeiro entre a latência e a produtividade, ou seja, latência do trabalho do Stream Analytics e a produtividade de cada SU.</span><span class="sxs-lookup"><span data-stu-id="4f23c-116">To determine the appropriate values for these, first a decision must be made between latency and throughput, that is, latency of the Stream Analytics job, and throughput of each SU.</span></span> <span data-ttu-id="4f23c-117">As SUs podem ser adicionadas sempre a um trabalho a fim de aumentar a produtividade de uma consulta do Stream Analytics bem particionada, embora SUs adicionais aumentem o custo da execução do trabalho.</span><span class="sxs-lookup"><span data-stu-id="4f23c-117">SUs may always be added to a job to increase throughput of a well partitioned Stream Analytics query, although additional SUs increases the cost of running the job.</span></span>

<span data-ttu-id="4f23c-118">Portanto, é importante determinar a *tolerância* de latência da execução de um trabalho do Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="4f23c-118">Therefore it is important to determine the *tolerance* of latency in running a Stream Analytics job.</span></span> <span data-ttu-id="4f23c-119">A latência adicional proveniente da execução de solicitações de serviço do Azure Machine Learning aumenta naturalmente com o tamanho do lote, que vai compor a latência do trabalho do Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="4f23c-119">Additional latency from running Azure Machine Learning service requests will naturally increase with batch size, which will compound the latency of the Stream Analytics job.</span></span> <span data-ttu-id="4f23c-120">Por outro lado, o aumento do tamanho do lote permite que o trabalho do Stream Analytics processe *mais eventos com o *mesmo número* de solicitações de serviço Web do Machine Learning.</span><span class="sxs-lookup"><span data-stu-id="4f23c-120">On the other hand, increasing batch size allows the Stream Analytics job to process *more events with the *same number* of Machine Learning web service requests.</span></span> <span data-ttu-id="4f23c-121">Geralmente, o aumento da latência do serviço Web do Machine Learning é sub-linear ao aumento do tamanho do lote. Portanto, é importante considerar o tamanho de lote mais econômico e eficiente para um serviço Web do Machine Learning em qualquer situação.</span><span class="sxs-lookup"><span data-stu-id="4f23c-121">Often the increase of Machine Learning web service latency is sub-linear to the increase of batch size so it is important to consider the most cost-efficient batch size for a Machine Learning web service in any given situation.</span></span> <span data-ttu-id="4f23c-122">O tamanho de lote padrão para as solicitações de serviço Web é 1.000 e pode ser modificado usando a [API REST do Stream Analytics](https://msdn.microsoft.com/library/mt653706.aspx "API REST do Stream Analytics") ou o [Cliente PowerShell para Stream Analytics](stream-analytics-monitor-and-manage-jobs-use-powershell.md "Cliente PowerShell para Stream Analytics").</span><span class="sxs-lookup"><span data-stu-id="4f23c-122">The default batch size for the web service requests is 1000 and may be modified either by using the [Stream Analytics REST API](https://msdn.microsoft.com/library/mt653706.aspx "Stream Analytics REST API") or the [PowerShell client for Stream Analytics](stream-analytics-monitor-and-manage-jobs-use-powershell.md "PowerShell client for Stream Analytics").</span></span>

<span data-ttu-id="4f23c-123">Depois de determinar um tamanho de lote, a quantidade de SUs (unidades de streaming) pode ser determinada com base no número de eventos que a função precisa processar por segundo.</span><span class="sxs-lookup"><span data-stu-id="4f23c-123">Once a batch size has been determined, the amount of streaming units (SUs) can be determined, based on the number of events that the function needs to process per second.</span></span> <span data-ttu-id="4f23c-124">Para obter mais informações sobre o unidades de streaming, consulte Dimensionar trabalhos do [Trabalhos de escala do Stream Analytics](stream-analytics-scale-jobs.md).</span><span class="sxs-lookup"><span data-stu-id="4f23c-124">For more information about streaming units, see [Stream Analytics scale jobs](stream-analytics-scale-jobs.md).</span></span>

<span data-ttu-id="4f23c-125">Em geral, há 20 conexões simultâneas com o serviço Web do Machine Learning para cada seis SUs, com exceção dos trabalhos de uma SU e os trabalhos de três SUs que receberão 20 conexões simultâneas também.</span><span class="sxs-lookup"><span data-stu-id="4f23c-125">In general, there are 20 concurrent connections to the Machine Learning web service for every 6 SUs, except that 1 SU jobs and 3 SU jobs will get 20 concurrent connections also.</span></span>  <span data-ttu-id="4f23c-126">Por exemplo, se a taxa de dados de entrada for 200.000 eventos por segundo, e o tamanho do lote for deixado com o valor padrão de 1000, a latência de serviço Web resultante com um lote simplificado de 1000 eventos será de 200 ms.</span><span class="sxs-lookup"><span data-stu-id="4f23c-126">For example, if the input data rate is 200,000 events per second and the batch size is left to the default of 1000 the resulting web service latency with 1000 events mini-batch is 200ms.</span></span> <span data-ttu-id="4f23c-127">Isso significa que cada conexão pode fazer cinco solicitações para o serviço Web do Machine Learning em um segundo.</span><span class="sxs-lookup"><span data-stu-id="4f23c-127">This means every connection can make 5 requests to the Machine Learning web service in a second.</span></span> <span data-ttu-id="4f23c-128">Com 20 conexões, o trabalho do Stream Analytics poderá processar 20.000 eventos em 200 ms e, portanto, 100.000 eventos em um segundo.</span><span class="sxs-lookup"><span data-stu-id="4f23c-128">With 20 connections, the Stream Analytics job can process 20,000 events in 200ms  and therefore 100,000 events in a second.</span></span> <span data-ttu-id="4f23c-129">Então, para processar 200.000 eventos por segundo, o trabalho do Stream Analytics precisará de 40 conexões simultâneas, provenientes de 12 SUs.</span><span class="sxs-lookup"><span data-stu-id="4f23c-129">So to process 200,000 events per second, the Stream Analytics job needs 40 concurrent connections, which comes out to 12 SUs.</span></span> <span data-ttu-id="4f23c-130">O diagrama a seguir ilustra as solicitações do trabalho do Stream Analytics para o ponto de extremidade de serviço Web do Machine Learning – a cada 6 SUs há, no máximo, 20 conexões simultâneas com o serviço Web do Machine Learning.</span><span class="sxs-lookup"><span data-stu-id="4f23c-130">The diagram below illustrates the requests from the Stream Analytics job to the Machine Learning web service endpoint – Every 6 SUs has 20 concurrent connections to Machine Learning web service at max.</span></span>

<span data-ttu-id="4f23c-131">![Dimensionar o Stream Analytics com as funções de Machine Learning, exemplo de trabalho 2](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-00.png "Dimensionar o Stream Analytics com as funções do Machine Learning, exemplo de trabalho 2")</span><span class="sxs-lookup"><span data-stu-id="4f23c-131">![Scale Stream Analytics with Machine Learning Functions 2 job example](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-00.png "Scale Stream Analytics with Machine Learning Functions 2 job example")</span></span>

<span data-ttu-id="4f23c-132">Em geral, sendo ***B*** o tamanho do lote e ***L*** a latência do serviço Web com o tamanho do lote B em milissegundos, a produtividade de um trabalho do Stream Analytics com ***N*** SUs será:</span><span class="sxs-lookup"><span data-stu-id="4f23c-132">In general, ***B*** for batch size, ***L*** for the web service latency at batch size B in milliseconds, the throughput of an Stream Analytics job with ***N*** SUs is:</span></span>

<span data-ttu-id="4f23c-133">![Fórmula para Dimensionar o Stream Analytics com as funções do Machine Learning](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-02.png "Fórmula para Dimensionar o Stream Analytics com as funções do Machine Learning")</span><span class="sxs-lookup"><span data-stu-id="4f23c-133">![Scale Stream Analytics with Machine Learning Functions Formula](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-02.png "Scale Stream Analytics with Machine Learning Functions Formula")</span></span>

<span data-ttu-id="4f23c-134">Uma consideração adicional pode ser o número “máximo de chamadas simultâneas” no lado do serviço Web do Machine Learning. Recomendamos a definição como o valor máximo (no momento, 200).</span><span class="sxs-lookup"><span data-stu-id="4f23c-134">An additional consideration may be the 'max concurrent calls' on the Machine Learning web service side, it’s recommended to set this to the maximum value (200 currently).</span></span>

<span data-ttu-id="4f23c-135">Para saber mais sobre essa configuração, confira o [artigo sobre dimensionamento de serviços Web do Machine Learning](../machine-learning/machine-learning-scaling-webservice.md).</span><span class="sxs-lookup"><span data-stu-id="4f23c-135">For more information on this setting please review the [Scaling article for Machine Learning Web Services](../machine-learning/machine-learning-scaling-webservice.md).</span></span>

## <a name="example--sentiment-analysis"></a><span data-ttu-id="4f23c-136">Exemplo – análise de sentimento</span><span class="sxs-lookup"><span data-stu-id="4f23c-136">Example – Sentiment Analysis</span></span>
<span data-ttu-id="4f23c-137">O exemplo a seguir inclui um trabalho do Stream Analytics com a função do Machine Learning de análise de sentimento, conforme descrito no [Tutorial de integração do Machine Learning do Stream Analytics](stream-analytics-machine-learning-integration-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="4f23c-137">The following example includes a Stream Analytics job with the sentiment analysis Machine Learning function, as described in the [Stream Analytics Machine Learning integration tutorial](stream-analytics-machine-learning-integration-tutorial.md).</span></span>

<span data-ttu-id="4f23c-138">A consulta é simples e totalmente particionada, seguida pela função **sentiment** , conforme mostrado abaixo:</span><span class="sxs-lookup"><span data-stu-id="4f23c-138">The query is a simple fully partitioned query followed by the **sentiment** function, as shown below:</span></span>

    WITH subquery AS (
        SELECT text, sentiment(text) as result from input
    )

    Select text, result.[Score]
    Into output
    From subquery

<span data-ttu-id="4f23c-139">Considere o seguinte cenário; com uma produtividade de 10.000 tweets por segundo, um trabalho do Stream Analytics deve ser criado para executar análise de sentimento dos tweets (eventos).</span><span class="sxs-lookup"><span data-stu-id="4f23c-139">Consider the following scenario; with a throughput of 10,000 tweets per second a Stream Analytics job must be created to perform sentiment analysis of the tweets (events).</span></span> <span data-ttu-id="4f23c-140">Com uma SU, esse trabalho do Stream Analytics poderá lidar com o tráfego?</span><span class="sxs-lookup"><span data-stu-id="4f23c-140">Using 1 SU, could this Stream Analytics job be able to handle the traffic?</span></span> <span data-ttu-id="4f23c-141">Com o tamanho de lote padrão de 1000, o trabalho deve ser capaz de acompanhar a entrada.</span><span class="sxs-lookup"><span data-stu-id="4f23c-141">Using the default batch size of 1000 the job should be able to keep up with the input.</span></span> <span data-ttu-id="4f23c-142">Além disso, a função adicional do Machine Learning não deve gerar mais do que um segundo de latência, que é a latência geral padrão do serviço Web do Machine Learning de análise de sentimento (com um tamanho de lote padrão de 1000).</span><span class="sxs-lookup"><span data-stu-id="4f23c-142">Further the added Machine Learning function should generate no more than a second of latency, which is the general default latency of the sentiment analysis Machine Learning web service (with a default batch size of 1000).</span></span> <span data-ttu-id="4f23c-143">A latência **geral** ou ponta a ponta do trabalho do Stream Analytics normalmente seria de alguns segundos.</span><span class="sxs-lookup"><span data-stu-id="4f23c-143">The Stream Analytics job’s **overall** or end-to-end latency would typically be a few seconds.</span></span> <span data-ttu-id="4f23c-144">Dê uma olhada mais detalhada nesse trabalho do Stream Analytics, *especialmente* nas chamadas de função do Machine Learning.</span><span class="sxs-lookup"><span data-stu-id="4f23c-144">Take a more detailed look into this Stream Analytics job, *especially* the Machine Learning function calls.</span></span> <span data-ttu-id="4f23c-145">Com o tamanho de lote de 1000, uma produtividade de 10.000 eventos precisará de aproximadamente 10 solicitações ao serviço Web.</span><span class="sxs-lookup"><span data-stu-id="4f23c-145">Having the batch size as 1000, a throughput of 10,000 events will take about 10 requests to web service.</span></span> <span data-ttu-id="4f23c-146">Mesmo com uma SU, há conexões simultâneas suficientes para acomodar esse tráfego de entrada.</span><span class="sxs-lookup"><span data-stu-id="4f23c-146">Even with 1 SU, there are enough concurrent connections to accommodate this input traffic.</span></span>

<span data-ttu-id="4f23c-147">Mas, e se a taxa de eventos de entrada aumentar em 100x, e agora o trabalho do Stream Analytics precisar processar 1.000.000 tweets por segundo?</span><span class="sxs-lookup"><span data-stu-id="4f23c-147">But what if the input event rate increases by 100x and now the Stream Analytics job needs to process 1,000,000 tweets per second?</span></span> <span data-ttu-id="4f23c-148">Há duas opções:</span><span class="sxs-lookup"><span data-stu-id="4f23c-148">There are two options:</span></span>

1. <span data-ttu-id="4f23c-149">Aumentar o tamanho do lote, ou</span><span class="sxs-lookup"><span data-stu-id="4f23c-149">Increase the batch size, or</span></span>
2. <span data-ttu-id="4f23c-150">Particionar o fluxo de entrada a fim de processar os eventos em paralelo</span><span class="sxs-lookup"><span data-stu-id="4f23c-150">Partition the input stream to process the events in parallel</span></span>

<span data-ttu-id="4f23c-151">Com a primeira opção, a **latência** do trabalho aumentará.</span><span class="sxs-lookup"><span data-stu-id="4f23c-151">With the first option, the job **latency** will increase.</span></span>

<span data-ttu-id="4f23c-152">Com a segunda opção, seria necessário provisionar mais SUs e, portanto, gerar mais solicitações simultâneas do serviço Web do Machine Learning.</span><span class="sxs-lookup"><span data-stu-id="4f23c-152">With the second option, more SUs would need to be provisioned and therefore generate more concurrent Machine Learning web service requests.</span></span> <span data-ttu-id="4f23c-153">Isso significa que o **custo** do trabalho aumentará.</span><span class="sxs-lookup"><span data-stu-id="4f23c-153">This means the job **cost** will increase.</span></span>

<span data-ttu-id="4f23c-154">Vamos supor que a latência do serviço Web do Machine Learning de análise de sentimento seja de 200 ms para lotes com 1000 eventos ou menos, 250 ms para lotes com 5.000 eventos, 300 ms para lotes com 10.000 eventos ou 500 ms para lotes com 25.000 eventos.</span><span class="sxs-lookup"><span data-stu-id="4f23c-154">Assume the latency of the sentiment analysis Machine Learning web service is 200ms for 1000-event batches or below, 250ms for 5,000-event batches, 300ms for 10,000-event batches or 500ms for 25,000-event batches.</span></span>

1. <span data-ttu-id="4f23c-155">Usando a primeira opção (**não** provisionando mais SUs), o tamanho do lote pode ser aumentado para **25.000**.</span><span class="sxs-lookup"><span data-stu-id="4f23c-155">Using the first option, (**not** provisioning more SUs), the batch size could be increased to **25,000**.</span></span> <span data-ttu-id="4f23c-156">Isso, por sua vez, permitiria que o trabalho processasse 1.000.000 de eventos com 20 conexões simultâneas para o serviço Web do Machine Learning (com uma latência de 500 ms por chamada).</span><span class="sxs-lookup"><span data-stu-id="4f23c-156">This in turn would allow the job to process 1,000,000 events with 20 concurrent connections to the Machine Learning web service (with a latency of 500ms per call).</span></span> <span data-ttu-id="4f23c-157">Portanto, a latência adicional do trabalho do Stream Analytics causada pelas solicitações de função de sentimento aumentaria de **200 ms** para **500 ms** em comparação com as solicitações de serviço Web do Machine Learning.</span><span class="sxs-lookup"><span data-stu-id="4f23c-157">So the additional latency of the Stream Analytics job due to the sentiment function requests against the Machine Learning web service requests would be increased from **200ms** to **500ms**.</span></span> <span data-ttu-id="4f23c-158">No entanto, observe que **não é possível** aumentar o tamanho do lote infinitamente, pois os serviços Web do Machine Learning exige que o tamanho da carga de uma solicitação seja de 4 MB ou menos e o tempo limite das solicitações de serviço Web esgota após 100 segundos de operação.</span><span class="sxs-lookup"><span data-stu-id="4f23c-158">However, note that batch size **cannot** be increased infinitely as the Machine Learning web services requires the payload size of a request be 4MB or smaller web service requests timeout after 100 seconds of operation.</span></span>
2. <span data-ttu-id="4f23c-159">Usando a segunda opção, o tamanho do lote é deixado como 1000, com latência de serviço Web de 200 ms, e cada 20 conexões simultâneas com o serviço Web seriam capazes de processar 1000 * 20 * 5 eventos = 100.000 por segundo.</span><span class="sxs-lookup"><span data-stu-id="4f23c-159">Using the second option, the batch size is left at 1000, with 200ms web service latency, every 20 concurrent connections to the web service would be able to process 1000 * 20 * 5 events = 100,000 per second.</span></span> <span data-ttu-id="4f23c-160">Então, para processar 1.000.000 eventos por segundo, o trabalho precisaria de 60 SUs.</span><span class="sxs-lookup"><span data-stu-id="4f23c-160">So to process 1,000,000 events per second, the job would need 60 SUs.</span></span> <span data-ttu-id="4f23c-161">Comparando com a primeira opção, o trabalho do Stream Analytics faria mais solicitações em lote do serviço Web, gerando um aumento do custo.</span><span class="sxs-lookup"><span data-stu-id="4f23c-161">Compared to the first option, Stream Analytics job would make more web service batch requests, in turn generating an increased cost.</span></span>

<span data-ttu-id="4f23c-162">Veja abaixo uma tabela sobre a produtividade do trabalho do Stream Analytics para SUs e tamanhos de lote diferentes (em número de eventos por segundo).</span><span class="sxs-lookup"><span data-stu-id="4f23c-162">Below is a table for the throughput of the Stream Analytics job for different SUs and batch sizes (in number of events per second).</span></span>

| <span data-ttu-id="4f23c-163">tamanho do lote (latência de AM)</span><span class="sxs-lookup"><span data-stu-id="4f23c-163">batch size (ML latency)</span></span> | <span data-ttu-id="4f23c-164">500 (200 ms)</span><span class="sxs-lookup"><span data-stu-id="4f23c-164">500 (200ms)</span></span> | <span data-ttu-id="4f23c-165">1.000 (200 ms)</span><span class="sxs-lookup"><span data-stu-id="4f23c-165">1,000 (200ms)</span></span> | <span data-ttu-id="4f23c-166">5.000 (250 ms)</span><span class="sxs-lookup"><span data-stu-id="4f23c-166">5,000 (250ms)</span></span> | <span data-ttu-id="4f23c-167">10.000 (300 ms)</span><span class="sxs-lookup"><span data-stu-id="4f23c-167">10,000 (300ms)</span></span> | <span data-ttu-id="4f23c-168">25.000 (500 ms)</span><span class="sxs-lookup"><span data-stu-id="4f23c-168">25,000 (500ms)</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="4f23c-169">**1 SU**</span><span class="sxs-lookup"><span data-stu-id="4f23c-169">**1 SU**</span></span> |<span data-ttu-id="4f23c-170">2.500</span><span class="sxs-lookup"><span data-stu-id="4f23c-170">2,500</span></span> |<span data-ttu-id="4f23c-171">5.000</span><span class="sxs-lookup"><span data-stu-id="4f23c-171">5,000</span></span> |<span data-ttu-id="4f23c-172">20.000</span><span class="sxs-lookup"><span data-stu-id="4f23c-172">20,000</span></span> |<span data-ttu-id="4f23c-173">30.000</span><span class="sxs-lookup"><span data-stu-id="4f23c-173">30,000</span></span> |<span data-ttu-id="4f23c-174">50.000</span><span class="sxs-lookup"><span data-stu-id="4f23c-174">50,000</span></span> |
| <span data-ttu-id="4f23c-175">**3 SUs**</span><span class="sxs-lookup"><span data-stu-id="4f23c-175">**3 SUs**</span></span> |<span data-ttu-id="4f23c-176">2.500</span><span class="sxs-lookup"><span data-stu-id="4f23c-176">2,500</span></span> |<span data-ttu-id="4f23c-177">5.000</span><span class="sxs-lookup"><span data-stu-id="4f23c-177">5,000</span></span> |<span data-ttu-id="4f23c-178">20.000</span><span class="sxs-lookup"><span data-stu-id="4f23c-178">20,000</span></span> |<span data-ttu-id="4f23c-179">30.000</span><span class="sxs-lookup"><span data-stu-id="4f23c-179">30,000</span></span> |<span data-ttu-id="4f23c-180">50.000</span><span class="sxs-lookup"><span data-stu-id="4f23c-180">50,000</span></span> |
| <span data-ttu-id="4f23c-181">**6 SUs**</span><span class="sxs-lookup"><span data-stu-id="4f23c-181">**6 SUs**</span></span> |<span data-ttu-id="4f23c-182">2.500</span><span class="sxs-lookup"><span data-stu-id="4f23c-182">2,500</span></span> |<span data-ttu-id="4f23c-183">5.000</span><span class="sxs-lookup"><span data-stu-id="4f23c-183">5,000</span></span> |<span data-ttu-id="4f23c-184">20.000</span><span class="sxs-lookup"><span data-stu-id="4f23c-184">20,000</span></span> |<span data-ttu-id="4f23c-185">30.000</span><span class="sxs-lookup"><span data-stu-id="4f23c-185">30,000</span></span> |<span data-ttu-id="4f23c-186">50.000</span><span class="sxs-lookup"><span data-stu-id="4f23c-186">50,000</span></span> |
| <span data-ttu-id="4f23c-187">**12 SUs**</span><span class="sxs-lookup"><span data-stu-id="4f23c-187">**12 SUs**</span></span> |<span data-ttu-id="4f23c-188">5.000</span><span class="sxs-lookup"><span data-stu-id="4f23c-188">5,000</span></span> |<span data-ttu-id="4f23c-189">10.000</span><span class="sxs-lookup"><span data-stu-id="4f23c-189">10,000</span></span> |<span data-ttu-id="4f23c-190">40.000</span><span class="sxs-lookup"><span data-stu-id="4f23c-190">40,000</span></span> |<span data-ttu-id="4f23c-191">60.000</span><span class="sxs-lookup"><span data-stu-id="4f23c-191">60,000</span></span> |<span data-ttu-id="4f23c-192">100.000</span><span class="sxs-lookup"><span data-stu-id="4f23c-192">100,000</span></span> |
| <span data-ttu-id="4f23c-193">**18 SUs**</span><span class="sxs-lookup"><span data-stu-id="4f23c-193">**18 SUs**</span></span> |<span data-ttu-id="4f23c-194">7.500</span><span class="sxs-lookup"><span data-stu-id="4f23c-194">7,500</span></span> |<span data-ttu-id="4f23c-195">15.000</span><span class="sxs-lookup"><span data-stu-id="4f23c-195">15,000</span></span> |<span data-ttu-id="4f23c-196">60.000</span><span class="sxs-lookup"><span data-stu-id="4f23c-196">60,000</span></span> |<span data-ttu-id="4f23c-197">90.000</span><span class="sxs-lookup"><span data-stu-id="4f23c-197">90,000</span></span> |<span data-ttu-id="4f23c-198">150.000</span><span class="sxs-lookup"><span data-stu-id="4f23c-198">150,000</span></span> |
| <span data-ttu-id="4f23c-199">**24 SUs**</span><span class="sxs-lookup"><span data-stu-id="4f23c-199">**24 SUs**</span></span> |<span data-ttu-id="4f23c-200">10.000</span><span class="sxs-lookup"><span data-stu-id="4f23c-200">10,000</span></span> |<span data-ttu-id="4f23c-201">20.000</span><span class="sxs-lookup"><span data-stu-id="4f23c-201">20,000</span></span> |<span data-ttu-id="4f23c-202">80.000</span><span class="sxs-lookup"><span data-stu-id="4f23c-202">80,000</span></span> |<span data-ttu-id="4f23c-203">120.000</span><span class="sxs-lookup"><span data-stu-id="4f23c-203">120,000</span></span> |<span data-ttu-id="4f23c-204">200.000</span><span class="sxs-lookup"><span data-stu-id="4f23c-204">200,000</span></span> |
| <span data-ttu-id="4f23c-205">**…**</span><span class="sxs-lookup"><span data-stu-id="4f23c-205">**…**</span></span> |<span data-ttu-id="4f23c-206">…</span><span class="sxs-lookup"><span data-stu-id="4f23c-206">…</span></span> |<span data-ttu-id="4f23c-207">…</span><span class="sxs-lookup"><span data-stu-id="4f23c-207">…</span></span> |<span data-ttu-id="4f23c-208">…</span><span class="sxs-lookup"><span data-stu-id="4f23c-208">…</span></span> |<span data-ttu-id="4f23c-209">…</span><span class="sxs-lookup"><span data-stu-id="4f23c-209">…</span></span> |<span data-ttu-id="4f23c-210">…</span><span class="sxs-lookup"><span data-stu-id="4f23c-210">…</span></span> |
| <span data-ttu-id="4f23c-211">**60 SUs**</span><span class="sxs-lookup"><span data-stu-id="4f23c-211">**60 SUs**</span></span> |<span data-ttu-id="4f23c-212">25.000</span><span class="sxs-lookup"><span data-stu-id="4f23c-212">25,000</span></span> |<span data-ttu-id="4f23c-213">50.000</span><span class="sxs-lookup"><span data-stu-id="4f23c-213">50,000</span></span> |<span data-ttu-id="4f23c-214">200.000</span><span class="sxs-lookup"><span data-stu-id="4f23c-214">200,000</span></span> |<span data-ttu-id="4f23c-215">300.000</span><span class="sxs-lookup"><span data-stu-id="4f23c-215">300,000</span></span> |<span data-ttu-id="4f23c-216">500.000</span><span class="sxs-lookup"><span data-stu-id="4f23c-216">500,000</span></span> |

<span data-ttu-id="4f23c-217">Agora, você já deve ter uma boa compreensão de como as funções do Machine Learning funcionam no Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="4f23c-217">By now, you should already have a good understanding of how Machine Learning functions in Stream Analytics work.</span></span> <span data-ttu-id="4f23c-218">Provavelmente você também compreende que os trabalhos do Stream Analytics "obtêm" dados de fontes de dados, e que cada "obtenção" retorna um lote de eventos para o trabalho do Stream Analytics processar.</span><span class="sxs-lookup"><span data-stu-id="4f23c-218">You likely also understand that Stream Analytics jobs “pull” data from data sources and each “pull” returns a batch of events for the Stream Analytics job to process.</span></span> <span data-ttu-id="4f23c-219">Como esse modelo de obtenção afeta as solicitações de serviço Web do Machine Learning?</span><span class="sxs-lookup"><span data-stu-id="4f23c-219">How does this pull model impact the Machine Learning web service requests?</span></span>

<span data-ttu-id="4f23c-220">Normalmente, o tamanho do lote que definimos para as funções do Machine Learning não pode ser dividido exatamente pelo número de eventos retornados por cada “obtenção” do trabalho do Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="4f23c-220">Normally, the batch size we set for Machine Learning functions won’t exactly be divisible by the number of events returned by each Stream Analytics job “pull”.</span></span> <span data-ttu-id="4f23c-221">Quando isso ocorrer, o serviço Web do Machine Learning será chamado com lotes "parciais".</span><span class="sxs-lookup"><span data-stu-id="4f23c-221">When this occurs the Machine Learning web service will be called with “partial” batches.</span></span> <span data-ttu-id="4f23c-222">Isso é feito para não causar sobrecarga adicional de latência de trabalho em eventos acumulados a cada pull.</span><span class="sxs-lookup"><span data-stu-id="4f23c-222">This is done to not incur additional job latency overhead in coalescing events from pull to pull.</span></span>

## <a name="new-function-related-monitoring-metrics"></a><span data-ttu-id="4f23c-223">Novas métricas de monitoramentos relacionadas à função</span><span class="sxs-lookup"><span data-stu-id="4f23c-223">New function-related monitoring metrics</span></span>
<span data-ttu-id="4f23c-224">Na área de Monitoramento de um trabalho do Stream Analytics, foram adicionadas três métricas relacionadas à função.</span><span class="sxs-lookup"><span data-stu-id="4f23c-224">In the Monitor area of a Stream Analytics job, three additional function-related metrics have been added.</span></span> <span data-ttu-id="4f23c-225">São elas: SOLICITAÇÕES DE FUNÇÃO, EVENTOS DE FUNÇÃO E SOLICITAÇÕES DE FUNÇÃO COM FALHA, conforme mostra a imagem abaixo.</span><span class="sxs-lookup"><span data-stu-id="4f23c-225">They are FUNCTION REQUESTS, FUNCTION EVENTS and FAILED FUNCTION REQUESTS, as shown in the graphic below.</span></span>

<span data-ttu-id="4f23c-226">![Métricas para Dimensionar o Stream Analytics com as funções de Machine Learning](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-01.png "Métricas para Dimensionar o Stream Analytics com as funções do Machine Learning")</span><span class="sxs-lookup"><span data-stu-id="4f23c-226">![Scale Stream Analytics with Machine Learning Functions Metrics](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-01.png "Scale Stream Analytics with Machine Learning Functions Metrics")</span></span>

<span data-ttu-id="4f23c-227">Estas são as definições:</span><span class="sxs-lookup"><span data-stu-id="4f23c-227">The are defined as follows:</span></span>

<span data-ttu-id="4f23c-228">**SOLICITAÇÕES DE FUNÇÃO**: o número de solicitações de função.</span><span class="sxs-lookup"><span data-stu-id="4f23c-228">**FUNCTION REQUESTS**: The number of function requests.</span></span>

<span data-ttu-id="4f23c-229">**EVENTOS DE FUNÇÃO**: o número de eventos nas solicitações de função.</span><span class="sxs-lookup"><span data-stu-id="4f23c-229">**FUNCTION EVENTS**: The number events in the function requests.</span></span>

<span data-ttu-id="4f23c-230">**SOLICITAÇÕES DE FUNÇÃO COM FALHA**: o número de solicitações de função com falha.</span><span class="sxs-lookup"><span data-stu-id="4f23c-230">**FAILED FUNCTION REQUESTS**: The number of failed function requests.</span></span>

## <a name="key-takeaways"></a><span data-ttu-id="4f23c-231">Principais observações</span><span class="sxs-lookup"><span data-stu-id="4f23c-231">Key Takeaways</span></span>
<span data-ttu-id="4f23c-232">Para resumir os principais pontos, para dimensionar um trabalho do Stream Analytics com funções do Machine Learning, considere os itens a seguir:</span><span class="sxs-lookup"><span data-stu-id="4f23c-232">To summarize the main points, in order to scale an Stream Analytics job with Machine Learning functions, the following items must be considered:</span></span>

1. <span data-ttu-id="4f23c-233">A taxa de eventos de entrada</span><span class="sxs-lookup"><span data-stu-id="4f23c-233">The input event rate</span></span>
2. <span data-ttu-id="4f23c-234">A latência tolerada para execução do trabalho do Stream Analytics (e, portanto, o tamanho do lote das solicitações de serviço Web do Machine Learning)</span><span class="sxs-lookup"><span data-stu-id="4f23c-234">The tolerated latency for the running Stream Analytics job (and thus the batch size of the Machine Learning web service requests)</span></span>
3. <span data-ttu-id="4f23c-235">As SUs do Stream Analytics provisionadas e o número de solicitações de serviço Web do Machine Learning (os custos adicionais relacionados à função)</span><span class="sxs-lookup"><span data-stu-id="4f23c-235">The provisioned Stream Analytics SUs and the number of Machine Learning web service requests (the additional function-related costs)</span></span>

<span data-ttu-id="4f23c-236">Uma consulta do Stream Analytics totalmente particionada foi usada como exemplo.</span><span class="sxs-lookup"><span data-stu-id="4f23c-236">A fully partitioned Stream Analytics query was used as an example.</span></span> <span data-ttu-id="4f23c-237">Caso seja necessária uma consulta mais complexa, o [Fórum do Stream Analytics do Azure](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics) é um excelente recurso para obter mais ajuda da equipe do Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="4f23c-237">If a more complex query is needed the [Azure Stream Analytics forum](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics) is a great resource for getting additional help from the Stream Analytics team.</span></span>

## <a name="next-steps"></a><span data-ttu-id="4f23c-238">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="4f23c-238">Next steps</span></span>
<span data-ttu-id="4f23c-239">Para saber mais sobre o Stream Analytics, confira:</span><span class="sxs-lookup"><span data-stu-id="4f23c-239">To learn more about Stream Analytics, see:</span></span>

* [<span data-ttu-id="4f23c-240">Introdução ao uso do Stream Analytics do Azure</span><span class="sxs-lookup"><span data-stu-id="4f23c-240">Get started using Azure Stream Analytics</span></span>](stream-analytics-real-time-fraud-detection.md)
* [<span data-ttu-id="4f23c-241">Dimensionar trabalhos do Stream Analytics do Azure</span><span class="sxs-lookup"><span data-stu-id="4f23c-241">Scale Azure Stream Analytics jobs</span></span>](stream-analytics-scale-jobs.md)
* [<span data-ttu-id="4f23c-242">Referência de Linguagem de Consulta do Stream Analytics do Azure</span><span class="sxs-lookup"><span data-stu-id="4f23c-242">Azure Stream Analytics Query Language Reference</span></span>](https://msdn.microsoft.com/library/azure/dn834998.aspx)
* [<span data-ttu-id="4f23c-243">Referência da API REST do Gerenciamento do Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="4f23c-243">Azure Stream Analytics Management REST API Reference</span></span>](https://msdn.microsoft.com/library/azure/dn835031.aspx)
