---
title: "aaaJob dimensionamento com funções do Azure Stream Analytics & AzureML | Microsoft Docs"
description: "Saiba como tooproperly dimensionar trabalhos do Stream Analytics (particionamento, quantidade SU e muito mais) ao usar as funções de aprendizado de máquina do Azure."
keywords: 
documentationcenter: 
services: stream-analytics
author: jeffstokes72
manager: jhubbard
editor: cgronlun
ms.assetid: 47ce7c5e-1de1-41ca-9a26-b5ecce814743
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 03/28/2017
ms.author: jeffstok
ms.openlocfilehash: 3fbdfaf7e8e86896c56f1d18bbde3a10bd3dca04
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="scale-your-stream-analytics-job-with-azure-machine-learning-functions"></a><span data-ttu-id="10d52-103">Dimensionar seu trabalho do Stream Analytics com funções do Azure Machine Learning</span><span class="sxs-lookup"><span data-stu-id="10d52-103">Scale your Stream Analytics job with Azure Machine Learning functions</span></span>
<span data-ttu-id="10d52-104">Ele geralmente é muito fácil tooset um trabalho de análise de fluxo e executar alguns dados de exemplo por meio dele.</span><span class="sxs-lookup"><span data-stu-id="10d52-104">It is often quite easy tooset up an Stream Analytics job and run some sample data through it.</span></span> <span data-ttu-id="10d52-105">O que podemos fazer quando precisamos toorun Olá mesmo trabalho com o maior volume de dados?</span><span class="sxs-lookup"><span data-stu-id="10d52-105">What should we do when we need toorun hello same job with higher data volume?</span></span> <span data-ttu-id="10d52-106">Ela requer toounderstand como tooconfigure Olá análise de fluxo de trabalho para que a escala.</span><span class="sxs-lookup"><span data-stu-id="10d52-106">It requires us toounderstand how tooconfigure hello Stream Analytics job so that it will scale.</span></span> <span data-ttu-id="10d52-107">Neste documento, abordaremos aspectos especiais de saudação da análise de fluxo de dimensionamento de trabalhos com funções de aprendizado de máquina.</span><span class="sxs-lookup"><span data-stu-id="10d52-107">In this document, we will focus on hello special aspects of scaling Stream Analytics jobs with Machine Learning functions.</span></span> <span data-ttu-id="10d52-108">Para obter informações sobre como trabalhos do Stream Analytics tooscale em geral consulte artigo Olá [dimensionamento de trabalhos](stream-analytics-scale-jobs.md).</span><span class="sxs-lookup"><span data-stu-id="10d52-108">For information on how tooscale Stream Analytics jobs in general see hello article [Scaling jobs](stream-analytics-scale-jobs.md).</span></span>

## <a name="what-is-an-azure-machine-learning-function-in-stream-analytics"></a><span data-ttu-id="10d52-109">O que é uma função do Azure Machine Learning no Stream Analytics?</span><span class="sxs-lookup"><span data-stu-id="10d52-109">What is an Azure Machine Learning function in Stream Analytics?</span></span>
<span data-ttu-id="10d52-110">Uma função de aprendizado de máquina no Stream Analytics pode ser usada como uma chamada de função regular Olá linguagem de consulta do Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="10d52-110">A Machine Learning function in Stream Analytics can be used like a regular function call in hello Stream Analytics query language.</span></span> <span data-ttu-id="10d52-111">No entanto, por trás da cena hello, chamadas de função hello são, na verdade, as solicitações de serviço de Web de aprendizado de máquina do Azure.</span><span class="sxs-lookup"><span data-stu-id="10d52-111">However, behind hello scene, hello function calls are actually Azure Machine Learning Web Service requests.</span></span> <span data-ttu-id="10d52-112">Suporte "processamento em lotes" várias linhas, que é chamado de minia lote serviços web do aprendizado de máquina, em Olá mesmo web chamada de API de serviço, tooimprove produtividade geral.</span><span class="sxs-lookup"><span data-stu-id="10d52-112">Machine Learning web services support “batching” multiple rows, which is called mini-batch, in hello same web service API call, tooimprove overall throughput.</span></span> <span data-ttu-id="10d52-113">Consulte Olá seguintes artigos para obter mais detalhes. [Funções de aprendizado de máquina do azure no Stream Analytics](https://blogs.technet.microsoft.com/machinelearning/2015/12/10/azure-ml-now-available-as-a-function-in-azure-stream-analytics/) e [serviços de Web de aprendizado de máquina do Azure](../machine-learning/machine-learning-consume-web-services.md).</span><span class="sxs-lookup"><span data-stu-id="10d52-113">Please see hello following articles for more details; [Azure Machine Learning functions in Stream Analytics](https://blogs.technet.microsoft.com/machinelearning/2015/12/10/azure-ml-now-available-as-a-function-in-azure-stream-analytics/) and [Azure Machine Learning Web Services](../machine-learning/machine-learning-consume-web-services.md).</span></span>

## <a name="configure-a-stream-analytics-job-with-machine-learning-functions"></a><span data-ttu-id="10d52-114">Configurar seu trabalho do Stream Analytics com funções de Machine Learning</span><span class="sxs-lookup"><span data-stu-id="10d52-114">Configure a Stream Analytics job with Machine Learning functions</span></span>
<span data-ttu-id="10d52-115">Ao configurar uma função de aprendizado de máquina para o trabalho do Stream Analytics, há dois parâmetros tooconsider, tamanho de lote de saudação de chamadas de função de aprendizado de máquina hello e Olá unidades (SUs) configuradas para o trabalho de análise de fluxo de saudação de streaming.</span><span class="sxs-lookup"><span data-stu-id="10d52-115">When configuring a Machine Learning function for Stream Analytics job, there are two parameters tooconsider, hello batch size of hello Machine Learning function calls, and hello streaming units (SUs) provisioned for hello Stream Analytics job.</span></span> <span data-ttu-id="10d52-116">toodetermine Olá os valores apropriados para esses, primeiro uma decisão deve ser feita entre a latência e taxa de transferência, ou seja, latência de trabalho do Stream Analytics hello e taxa de transferência de cada SU.</span><span class="sxs-lookup"><span data-stu-id="10d52-116">toodetermine hello appropriate values for these, first a decision must be made between latency and throughput, that is, latency of hello Stream Analytics job, and throughput of each SU.</span></span> <span data-ttu-id="10d52-117">SUs podem sempre ser adicionado tooa throughput de tooincrease de trabalho de uma consulta do Stream Analytics bem particionado, embora SUs adicional aumenta o custo de saudação de execução do trabalho hello.</span><span class="sxs-lookup"><span data-stu-id="10d52-117">SUs may always be added tooa job tooincrease throughput of a well partitioned Stream Analytics query, although additional SUs increases hello cost of running hello job.</span></span>

<span data-ttu-id="10d52-118">Portanto, é importante toodetermine Olá *tolerância* de latência em um trabalho de análise de fluxo de execução.</span><span class="sxs-lookup"><span data-stu-id="10d52-118">Therefore it is important toodetermine hello *tolerance* of latency in running a Stream Analytics job.</span></span> <span data-ttu-id="10d52-119">Naturalmente, latência adicional da execução de solicitações de serviço de aprendizado de máquina do Azure aumentará com tamanho de lote, que vai compor a latência de saudação do trabalho de análise de fluxo de saudação.</span><span class="sxs-lookup"><span data-stu-id="10d52-119">Additional latency from running Azure Machine Learning service requests will naturally increase with batch size, which will compound hello latency of hello Stream Analytics job.</span></span> <span data-ttu-id="10d52-120">Olá outro lado, aumentando o tamanho do lote permite que tooprocess de trabalho do Stream Analytics hello * mais eventos por hello *mesmo número* de aprendizado de máquina solicitações ao serviço web.</span><span class="sxs-lookup"><span data-stu-id="10d52-120">On hello other hand, increasing batch size allows hello Stream Analytics job tooprocess *more events with hello *same number* of Machine Learning web service requests.</span></span> <span data-ttu-id="10d52-121">Geralmente aumento de saudação de latência de serviço de web do aprendizado de máquina é inferior linear toohello aumento de tamanho do lote, portanto, é importante tooconsider hello mais eficiente tamanho de lote para um serviço web de aprendizado de máquina em qualquer situação.</span><span class="sxs-lookup"><span data-stu-id="10d52-121">Often hello increase of Machine Learning web service latency is sub-linear toohello increase of batch size so it is important tooconsider hello most cost-efficient batch size for a Machine Learning web service in any given situation.</span></span> <span data-ttu-id="10d52-122">tamanho do lote saudação padrão para o serviço web de saudação solicitações é 1000 e pode ser modificado usando Olá [API de REST de análise de fluxo](https://msdn.microsoft.com/library/mt653706.aspx "API de REST de análise de fluxo") ou hello [cliente do PowerShell para análise de fluxo](stream-analytics-monitor-and-manage-jobs-use-powershell.md "PowerShell de cliente para análise de fluxo").</span><span class="sxs-lookup"><span data-stu-id="10d52-122">hello default batch size for hello web service requests is 1000 and may be modified either by using hello [Stream Analytics REST API](https://msdn.microsoft.com/library/mt653706.aspx "Stream Analytics REST API") or hello [PowerShell client for Stream Analytics](stream-analytics-monitor-and-manage-jobs-use-powershell.md "PowerShell client for Stream Analytics").</span></span>

<span data-ttu-id="10d52-123">Depois que um tamanho de lote tiver sido determinado, quantidade de saudação de streaming de unidades (SUs) podem ser determinadas, com base no hello número de eventos de função hello precisa tooprocess por segundo.</span><span class="sxs-lookup"><span data-stu-id="10d52-123">Once a batch size has been determined, hello amount of streaming units (SUs) can be determined, based on hello number of events that hello function needs tooprocess per second.</span></span> <span data-ttu-id="10d52-124">Para obter mais informações sobre o unidades de streaming, consulte Dimensionar trabalhos do [Trabalhos de escala do Stream Analytics](stream-analytics-scale-jobs.md).</span><span class="sxs-lookup"><span data-stu-id="10d52-124">For more information about streaming units, see [Stream Analytics scale jobs](stream-analytics-scale-jobs.md).</span></span>

<span data-ttu-id="10d52-125">Em geral, há 20 conexões simultâneas toohello serviço de web de aprendizado de máquina para cada 6 SUs, exceto que os trabalhos de SU 1 e 3 SU obterá 20 conexões simultâneas também.</span><span class="sxs-lookup"><span data-stu-id="10d52-125">In general, there are 20 concurrent connections toohello Machine Learning web service for every 6 SUs, except that 1 SU jobs and 3 SU jobs will get 20 concurrent connections also.</span></span>  <span data-ttu-id="10d52-126">Por exemplo, se a taxa de dados de entrada hello está 200.000 eventos por segundo e o tamanho de lote Olá fica toohello padrão de 1000 Olá resultante web serviço latência com lotes simplificado de eventos de 1000 é 200 ms.</span><span class="sxs-lookup"><span data-stu-id="10d52-126">For example, if hello input data rate is 200,000 events per second and hello batch size is left toohello default of 1000 hello resulting web service latency with 1000 events mini-batch is 200ms.</span></span> <span data-ttu-id="10d52-127">Isso significa que cada conexão pode fazer 5 solicitações de serviço de web de aprendizado de máquina toohello em um segundo.</span><span class="sxs-lookup"><span data-stu-id="10d52-127">This means every connection can make 5 requests toohello Machine Learning web service in a second.</span></span> <span data-ttu-id="10d52-128">Com 20 conexões, trabalho de análise de fluxo de saudação pode processar 20.000 eventos em 200 MS e, portanto, 100.000 eventos em um segundo.</span><span class="sxs-lookup"><span data-stu-id="10d52-128">With 20 connections, hello Stream Analytics job can process 20,000 events in 200ms  and therefore 100,000 events in a second.</span></span> <span data-ttu-id="10d52-129">Portanto tooprocess 200.000 eventos por segundo, trabalho de análise de fluxo de saudação precisa 40 conexões simultâneas, que são fornecidos too12 SUs.</span><span class="sxs-lookup"><span data-stu-id="10d52-129">So tooprocess 200,000 events per second, hello Stream Analytics job needs 40 concurrent connections, which comes out too12 SUs.</span></span> <span data-ttu-id="10d52-130">Olá diagrama a seguir ilustra a solicitações de saudação de extremidade de serviço web de aprendizado de máquina toohello de trabalho do Stream Analytics de hello – cada SUs de 6 tem 20 serviço de web de aprendizado para tooMachine conexões simultâneas no máximo.</span><span class="sxs-lookup"><span data-stu-id="10d52-130">hello diagram below illustrates hello requests from hello Stream Analytics job toohello Machine Learning web service endpoint – Every 6 SUs has 20 concurrent connections tooMachine Learning web service at max.</span></span>

<span data-ttu-id="10d52-131">![Dimensionar o Stream Analytics com as funções de Machine Learning, exemplo de trabalho 2](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-00.png "Dimensionar o Stream Analytics com as funções do Machine Learning, exemplo de trabalho 2")</span><span class="sxs-lookup"><span data-stu-id="10d52-131">![Scale Stream Analytics with Machine Learning Functions 2 job example](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-00.png "Scale Stream Analytics with Machine Learning Functions 2 job example")</span></span>

<span data-ttu-id="10d52-132">Em geral, ***B*** para tamanho de lote, ***L*** para latência de serviço Olá web no tamanho do lote B em milissegundos, Olá taxa de transferência de um trabalho do Stream Analytics com ***N*** é:</span><span class="sxs-lookup"><span data-stu-id="10d52-132">In general, ***B*** for batch size, ***L*** for hello web service latency at batch size B in milliseconds, hello throughput of an Stream Analytics job with ***N*** SUs is:</span></span>

<span data-ttu-id="10d52-133">![Fórmula para Dimensionar o Stream Analytics com as funções do Machine Learning](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-02.png "Fórmula para Dimensionar o Stream Analytics com as funções do Machine Learning")</span><span class="sxs-lookup"><span data-stu-id="10d52-133">![Scale Stream Analytics with Machine Learning Functions Formula](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-02.png "Scale Stream Analytics with Machine Learning Functions Formula")</span></span>

<span data-ttu-id="10d52-134">Uma consideração adicional pode ser Olá 'máximo de chamadas simultâneas' em Olá no lado do serviço de web do aprendizado de máquina, é recomendável tooset esse valor máximo de toohello (200 no momento).</span><span class="sxs-lookup"><span data-stu-id="10d52-134">An additional consideration may be hello 'max concurrent calls' on hello Machine Learning web service side, it’s recommended tooset this toohello maximum value (200 currently).</span></span>

<span data-ttu-id="10d52-135">Para obter mais informações sobre essa configuração, consulte Olá [artigo de escala para serviços de Web do aprendizado de máquina](../machine-learning/machine-learning-scaling-webservice.md).</span><span class="sxs-lookup"><span data-stu-id="10d52-135">For more information on this setting please review hello [Scaling article for Machine Learning Web Services](../machine-learning/machine-learning-scaling-webservice.md).</span></span>

## <a name="example--sentiment-analysis"></a><span data-ttu-id="10d52-136">Exemplo – análise de sentimento</span><span class="sxs-lookup"><span data-stu-id="10d52-136">Example – Sentiment Analysis</span></span>
<span data-ttu-id="10d52-137">Olá exemplo a seguir inclui um trabalho do Stream Analytics com análise de sentimento Olá função de aprendizado de máquina, conforme descrito em Olá [tutorial de integração de aprendizado de máquina de análise de fluxo](stream-analytics-machine-learning-integration-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="10d52-137">hello following example includes a Stream Analytics job with hello sentiment analysis Machine Learning function, as described in hello [Stream Analytics Machine Learning integration tutorial](stream-analytics-machine-learning-integration-tutorial.md).</span></span>

<span data-ttu-id="10d52-138">Olá, consulta é uma consulta totalmente particionada simple seguida de saudação **sentimento** de função, conforme mostrado abaixo:</span><span class="sxs-lookup"><span data-stu-id="10d52-138">hello query is a simple fully partitioned query followed by hello **sentiment** function, as shown below:</span></span>

    WITH subquery AS (
        SELECT text, sentiment(text) as result from input
    )

    Select text, result.[Score]
    Into output
    From subquery

<span data-ttu-id="10d52-139">Considere Olá seguindo o cenário. com uma taxa de transferência de 10.000 tweets por segundo, um trabalho de análise de fluxo deve ser criado tooperform análise de sentimento de tweets de saudação (eventos).</span><span class="sxs-lookup"><span data-stu-id="10d52-139">Consider hello following scenario; with a throughput of 10,000 tweets per second a Stream Analytics job must be created tooperform sentiment analysis of hello tweets (events).</span></span> <span data-ttu-id="10d52-140">Usando 1 SU, este trabalho do Stream Analytics foi toohandle capaz de tráfego de Olá?</span><span class="sxs-lookup"><span data-stu-id="10d52-140">Using 1 SU, could this Stream Analytics job be able toohandle hello traffic?</span></span> <span data-ttu-id="10d52-141">Com tamanho de lote de padrão de saudação do trabalho de saudação 1000 deve ser capaz de tookeep backup com entrada hello.</span><span class="sxs-lookup"><span data-stu-id="10d52-141">Using hello default batch size of 1000 hello job should be able tookeep up with hello input.</span></span> <span data-ttu-id="10d52-142">Olá mais Adicionar função de aprendizado de máquina deve gerar não mais do que um segundo de latência, que é a latência geral padrão de Olá de análise de sentimento Olá serviço web de aprendizado de máquina (com um tamanho de lote padrão de 1000).</span><span class="sxs-lookup"><span data-stu-id="10d52-142">Further hello added Machine Learning function should generate no more than a second of latency, which is hello general default latency of hello sentiment analysis Machine Learning web service (with a default batch size of 1000).</span></span> <span data-ttu-id="10d52-143">trabalho de análise de fluxo Olá **geral** ou latência de ponta a ponta normalmente seria alguns segundos.</span><span class="sxs-lookup"><span data-stu-id="10d52-143">hello Stream Analytics job’s **overall** or end-to-end latency would typically be a few seconds.</span></span> <span data-ttu-id="10d52-144">Dê uma olhada mais detalhada para esse trabalho do Stream Analytics, *especialmente* Olá chamadas de função de aprendizado de máquina.</span><span class="sxs-lookup"><span data-stu-id="10d52-144">Take a more detailed look into this Stream Analytics job, *especially* hello Machine Learning function calls.</span></span> <span data-ttu-id="10d52-145">Com o tamanho do lote hello como 1.000, uma taxa de transferência de 10.000 eventos levará aproximadamente 10 solicitações tooweb serviço.</span><span class="sxs-lookup"><span data-stu-id="10d52-145">Having hello batch size as 1000, a throughput of 10,000 events will take about 10 requests tooweb service.</span></span> <span data-ttu-id="10d52-146">Mesmo com 1 SU, há suficiente tooaccommodate conexões simultâneas esse tráfego de entrada.</span><span class="sxs-lookup"><span data-stu-id="10d52-146">Even with 1 SU, there are enough concurrent connections tooaccommodate this input traffic.</span></span>

<span data-ttu-id="10d52-147">Mas e se aumenta a taxa de eventos de entrada hello x 100 e agora precisa de trabalho do Stream Analytics Olá tweets de 1.000.000 tooprocess por segundo?</span><span class="sxs-lookup"><span data-stu-id="10d52-147">But what if hello input event rate increases by 100x and now hello Stream Analytics job needs tooprocess 1,000,000 tweets per second?</span></span> <span data-ttu-id="10d52-148">Há duas opções:</span><span class="sxs-lookup"><span data-stu-id="10d52-148">There are two options:</span></span>

1. <span data-ttu-id="10d52-149">Aumentar o tamanho do lote hello, ou</span><span class="sxs-lookup"><span data-stu-id="10d52-149">Increase hello batch size, or</span></span>
2. <span data-ttu-id="10d52-150">Tooprocess de fluxo de entrada hello partição Olá eventos em paralelo</span><span class="sxs-lookup"><span data-stu-id="10d52-150">Partition hello input stream tooprocess hello events in parallel</span></span>

<span data-ttu-id="10d52-151">Com a opção de primeiro hello, Olá trabalho **latência** aumentará.</span><span class="sxs-lookup"><span data-stu-id="10d52-151">With hello first option, hello job **latency** will increase.</span></span>

<span data-ttu-id="10d52-152">Com a segunda opção de hello, SUs mais seria necessário toobe provisionado e, portanto, gerar simultâneas mais solicitações de serviço web de aprendizado de máquina.</span><span class="sxs-lookup"><span data-stu-id="10d52-152">With hello second option, more SUs would need toobe provisioned and therefore generate more concurrent Machine Learning web service requests.</span></span> <span data-ttu-id="10d52-153">Isso significa que o trabalho de saudação **custo** aumentará.</span><span class="sxs-lookup"><span data-stu-id="10d52-153">This means hello job **cost** will increase.</span></span>

<span data-ttu-id="10d52-154">Presumem que a latência de saudação de análise de sentimento Olá serviço web de aprendizado de máquina é 200 ms para lotes de 1000 eventos ou abaixo, 250ms para lotes de 5.000 eventos, 300 ms de lotes de 10.000 eventos ou 500 ms para lotes de eventos de 25.000.</span><span class="sxs-lookup"><span data-stu-id="10d52-154">Assume hello latency of hello sentiment analysis Machine Learning web service is 200ms for 1000-event batches or below, 250ms for 5,000-event batches, 300ms for 10,000-event batches or 500ms for 25,000-event batches.</span></span>

1. <span data-ttu-id="10d52-155">Usando a opção de primeira Olá, (**não** provisionamento mais SUs), tamanho do lote Olá pode ser aumentado muito**25.000**.</span><span class="sxs-lookup"><span data-stu-id="10d52-155">Using hello first option, (**not** provisioning more SUs), hello batch size could be increased too**25,000**.</span></span> <span data-ttu-id="10d52-156">Isso seria permitir Olá trabalho tooprocess 1.000.000 eventos com 20 conexões simultâneas toohello serviço web de aprendizado de máquina (com uma latência de 500 ms por chamada).</span><span class="sxs-lookup"><span data-stu-id="10d52-156">This in turn would allow hello job tooprocess 1,000,000 events with 20 concurrent connections toohello Machine Learning web service (with a latency of 500ms per call).</span></span> <span data-ttu-id="10d52-157">Olá assim a latência adicional de trabalho do Stream Analytics Olá devido a solicitações de função de sentimento toohello contra Olá aprendizado de máquina, solicitações de serviço web deve ser aumentadas de **200 MS** muito**500 MS**.</span><span class="sxs-lookup"><span data-stu-id="10d52-157">So hello additional latency of hello Stream Analytics job due toohello sentiment function requests against hello Machine Learning web service requests would be increased from **200ms** too**500ms**.</span></span> <span data-ttu-id="10d52-158">No entanto, observe que tamanho de lote **não é possível** ser aumentado infinitamente como serviços web do aprendizado de máquina hello requer tamanho da carga de saudação de uma solicitação de 4 MB ou web menor tempo limite de solicitações de serviço depois de 100 segundos da operação.</span><span class="sxs-lookup"><span data-stu-id="10d52-158">However, note that batch size **cannot** be increased infinitely as hello Machine Learning web services requires hello payload size of a request be 4MB or smaller web service requests timeout after 100 seconds of operation.</span></span>
2. <span data-ttu-id="10d52-159">Usando a opção segundo Olá, tamanho do lote Olá é deixado em 1.000, com latência de serviço web 200 MS, cada serviço de web toohello 20 conexões simultâneas deve ser capaz de tooprocess 1000 * 20 * 5 eventos = 100.000 por segundo.</span><span class="sxs-lookup"><span data-stu-id="10d52-159">Using hello second option, hello batch size is left at 1000, with 200ms web service latency, every 20 concurrent connections toohello web service would be able tooprocess 1000 * 20 * 5 events = 100,000 per second.</span></span> <span data-ttu-id="10d52-160">Para eventos de 1.000.000 tooprocess por segundo, o trabalho de saudação precisaria 60 SUs.</span><span class="sxs-lookup"><span data-stu-id="10d52-160">So tooprocess 1,000,000 events per second, hello job would need 60 SUs.</span></span> <span data-ttu-id="10d52-161">Primeira opção toohello comparados, análise de fluxo de trabalho criam web mais solicitações de lote de serviço, por sua vez gerando um aumento de custo.</span><span class="sxs-lookup"><span data-stu-id="10d52-161">Compared toohello first option, Stream Analytics job would make more web service batch requests, in turn generating an increased cost.</span></span>

<span data-ttu-id="10d52-162">Abaixo está uma tabela para a taxa de transferência de saudação do trabalho do Stream Analytics Olá para SUs diferente e tamanhos de lote (em número de eventos por segundo).</span><span class="sxs-lookup"><span data-stu-id="10d52-162">Below is a table for hello throughput of hello Stream Analytics job for different SUs and batch sizes (in number of events per second).</span></span>

| <span data-ttu-id="10d52-163">tamanho do lote (latência de AM)</span><span class="sxs-lookup"><span data-stu-id="10d52-163">batch size (ML latency)</span></span> | <span data-ttu-id="10d52-164">500 (200 ms)</span><span class="sxs-lookup"><span data-stu-id="10d52-164">500 (200ms)</span></span> | <span data-ttu-id="10d52-165">1.000 (200 ms)</span><span class="sxs-lookup"><span data-stu-id="10d52-165">1,000 (200ms)</span></span> | <span data-ttu-id="10d52-166">5.000 (250 ms)</span><span class="sxs-lookup"><span data-stu-id="10d52-166">5,000 (250ms)</span></span> | <span data-ttu-id="10d52-167">10.000 (300 ms)</span><span class="sxs-lookup"><span data-stu-id="10d52-167">10,000 (300ms)</span></span> | <span data-ttu-id="10d52-168">25.000 (500 ms)</span><span class="sxs-lookup"><span data-stu-id="10d52-168">25,000 (500ms)</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="10d52-169">**1 SU**</span><span class="sxs-lookup"><span data-stu-id="10d52-169">**1 SU**</span></span> |<span data-ttu-id="10d52-170">2.500</span><span class="sxs-lookup"><span data-stu-id="10d52-170">2,500</span></span> |<span data-ttu-id="10d52-171">5.000</span><span class="sxs-lookup"><span data-stu-id="10d52-171">5,000</span></span> |<span data-ttu-id="10d52-172">20.000</span><span class="sxs-lookup"><span data-stu-id="10d52-172">20,000</span></span> |<span data-ttu-id="10d52-173">30.000</span><span class="sxs-lookup"><span data-stu-id="10d52-173">30,000</span></span> |<span data-ttu-id="10d52-174">50.000</span><span class="sxs-lookup"><span data-stu-id="10d52-174">50,000</span></span> |
| <span data-ttu-id="10d52-175">**3 SUs**</span><span class="sxs-lookup"><span data-stu-id="10d52-175">**3 SUs**</span></span> |<span data-ttu-id="10d52-176">2.500</span><span class="sxs-lookup"><span data-stu-id="10d52-176">2,500</span></span> |<span data-ttu-id="10d52-177">5.000</span><span class="sxs-lookup"><span data-stu-id="10d52-177">5,000</span></span> |<span data-ttu-id="10d52-178">20.000</span><span class="sxs-lookup"><span data-stu-id="10d52-178">20,000</span></span> |<span data-ttu-id="10d52-179">30.000</span><span class="sxs-lookup"><span data-stu-id="10d52-179">30,000</span></span> |<span data-ttu-id="10d52-180">50.000</span><span class="sxs-lookup"><span data-stu-id="10d52-180">50,000</span></span> |
| <span data-ttu-id="10d52-181">**6 SUs**</span><span class="sxs-lookup"><span data-stu-id="10d52-181">**6 SUs**</span></span> |<span data-ttu-id="10d52-182">2.500</span><span class="sxs-lookup"><span data-stu-id="10d52-182">2,500</span></span> |<span data-ttu-id="10d52-183">5.000</span><span class="sxs-lookup"><span data-stu-id="10d52-183">5,000</span></span> |<span data-ttu-id="10d52-184">20.000</span><span class="sxs-lookup"><span data-stu-id="10d52-184">20,000</span></span> |<span data-ttu-id="10d52-185">30.000</span><span class="sxs-lookup"><span data-stu-id="10d52-185">30,000</span></span> |<span data-ttu-id="10d52-186">50.000</span><span class="sxs-lookup"><span data-stu-id="10d52-186">50,000</span></span> |
| <span data-ttu-id="10d52-187">**12 SUs**</span><span class="sxs-lookup"><span data-stu-id="10d52-187">**12 SUs**</span></span> |<span data-ttu-id="10d52-188">5.000</span><span class="sxs-lookup"><span data-stu-id="10d52-188">5,000</span></span> |<span data-ttu-id="10d52-189">10.000</span><span class="sxs-lookup"><span data-stu-id="10d52-189">10,000</span></span> |<span data-ttu-id="10d52-190">40.000</span><span class="sxs-lookup"><span data-stu-id="10d52-190">40,000</span></span> |<span data-ttu-id="10d52-191">60.000</span><span class="sxs-lookup"><span data-stu-id="10d52-191">60,000</span></span> |<span data-ttu-id="10d52-192">100.000</span><span class="sxs-lookup"><span data-stu-id="10d52-192">100,000</span></span> |
| <span data-ttu-id="10d52-193">**18 SUs**</span><span class="sxs-lookup"><span data-stu-id="10d52-193">**18 SUs**</span></span> |<span data-ttu-id="10d52-194">7.500</span><span class="sxs-lookup"><span data-stu-id="10d52-194">7,500</span></span> |<span data-ttu-id="10d52-195">15.000</span><span class="sxs-lookup"><span data-stu-id="10d52-195">15,000</span></span> |<span data-ttu-id="10d52-196">60.000</span><span class="sxs-lookup"><span data-stu-id="10d52-196">60,000</span></span> |<span data-ttu-id="10d52-197">90.000</span><span class="sxs-lookup"><span data-stu-id="10d52-197">90,000</span></span> |<span data-ttu-id="10d52-198">150.000</span><span class="sxs-lookup"><span data-stu-id="10d52-198">150,000</span></span> |
| <span data-ttu-id="10d52-199">**24 SUs**</span><span class="sxs-lookup"><span data-stu-id="10d52-199">**24 SUs**</span></span> |<span data-ttu-id="10d52-200">10.000</span><span class="sxs-lookup"><span data-stu-id="10d52-200">10,000</span></span> |<span data-ttu-id="10d52-201">20.000</span><span class="sxs-lookup"><span data-stu-id="10d52-201">20,000</span></span> |<span data-ttu-id="10d52-202">80.000</span><span class="sxs-lookup"><span data-stu-id="10d52-202">80,000</span></span> |<span data-ttu-id="10d52-203">120.000</span><span class="sxs-lookup"><span data-stu-id="10d52-203">120,000</span></span> |<span data-ttu-id="10d52-204">200.000</span><span class="sxs-lookup"><span data-stu-id="10d52-204">200,000</span></span> |
| <span data-ttu-id="10d52-205">**…**</span><span class="sxs-lookup"><span data-stu-id="10d52-205">**…**</span></span> |<span data-ttu-id="10d52-206">…</span><span class="sxs-lookup"><span data-stu-id="10d52-206">…</span></span> |<span data-ttu-id="10d52-207">…</span><span class="sxs-lookup"><span data-stu-id="10d52-207">…</span></span> |<span data-ttu-id="10d52-208">…</span><span class="sxs-lookup"><span data-stu-id="10d52-208">…</span></span> |<span data-ttu-id="10d52-209">…</span><span class="sxs-lookup"><span data-stu-id="10d52-209">…</span></span> |<span data-ttu-id="10d52-210">…</span><span class="sxs-lookup"><span data-stu-id="10d52-210">…</span></span> |
| <span data-ttu-id="10d52-211">**60 SUs**</span><span class="sxs-lookup"><span data-stu-id="10d52-211">**60 SUs**</span></span> |<span data-ttu-id="10d52-212">25.000</span><span class="sxs-lookup"><span data-stu-id="10d52-212">25,000</span></span> |<span data-ttu-id="10d52-213">50.000</span><span class="sxs-lookup"><span data-stu-id="10d52-213">50,000</span></span> |<span data-ttu-id="10d52-214">200.000</span><span class="sxs-lookup"><span data-stu-id="10d52-214">200,000</span></span> |<span data-ttu-id="10d52-215">300.000</span><span class="sxs-lookup"><span data-stu-id="10d52-215">300,000</span></span> |<span data-ttu-id="10d52-216">500.000</span><span class="sxs-lookup"><span data-stu-id="10d52-216">500,000</span></span> |

<span data-ttu-id="10d52-217">Agora, você já deve ter uma boa compreensão de como as funções do Machine Learning funcionam no Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="10d52-217">By now, you should already have a good understanding of how Machine Learning functions in Stream Analytics work.</span></span> <span data-ttu-id="10d52-218">Você provavelmente também entender que os trabalhos do Stream Analytics "pull" dados de fontes de dados e cada "pull" retorna um lote de eventos para Olá tooprocess de trabalho do Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="10d52-218">You likely also understand that Stream Analytics jobs “pull” data from data sources and each “pull” returns a batch of events for hello Stream Analytics job tooprocess.</span></span> <span data-ttu-id="10d52-219">Como esse modelo de pull afeta solicitações de serviço de web de aprendizado de máquina Olá?</span><span class="sxs-lookup"><span data-stu-id="10d52-219">How does this pull model impact hello Machine Learning web service requests?</span></span>

<span data-ttu-id="10d52-220">Normalmente, tamanho do lote Olá que definimos para funções de aprendizado de máquina não exatamente é divisível pelo número de saudação de eventos retornados por cada análise de fluxo de trabalho "pull".</span><span class="sxs-lookup"><span data-stu-id="10d52-220">Normally, hello batch size we set for Machine Learning functions won’t exactly be divisible by hello number of events returned by each Stream Analytics job “pull”.</span></span> <span data-ttu-id="10d52-221">Quando isso ocorre, Olá serviço web de aprendizado de máquina com lotes "parciais" será chamado.</span><span class="sxs-lookup"><span data-stu-id="10d52-221">When this occurs hello Machine Learning web service will be called with “partial” batches.</span></span> <span data-ttu-id="10d52-222">Isso é feito toonot incorrer em latência de trabalho adicional sobrecarga em eventos de conciliação de toopull pull.</span><span class="sxs-lookup"><span data-stu-id="10d52-222">This is done toonot incur additional job latency overhead in coalescing events from pull toopull.</span></span>

## <a name="new-function-related-monitoring-metrics"></a><span data-ttu-id="10d52-223">Novas métricas de monitoramentos relacionadas à função</span><span class="sxs-lookup"><span data-stu-id="10d52-223">New function-related monitoring metrics</span></span>
<span data-ttu-id="10d52-224">Na área de Monitor de um trabalho de análise de fluxo de Olá, foram adicionadas três métricas adicionais relacionadas à função.</span><span class="sxs-lookup"><span data-stu-id="10d52-224">In hello Monitor area of a Stream Analytics job, three additional function-related metrics have been added.</span></span> <span data-ttu-id="10d52-225">Eles são solicitações de função, eventos de função e solicitações de função com falha, conforme mostrado no gráfico de saudação abaixo.</span><span class="sxs-lookup"><span data-stu-id="10d52-225">They are FUNCTION REQUESTS, FUNCTION EVENTS and FAILED FUNCTION REQUESTS, as shown in hello graphic below.</span></span>

<span data-ttu-id="10d52-226">![Métricas para Dimensionar o Stream Analytics com as funções de Machine Learning](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-01.png "Métricas para Dimensionar o Stream Analytics com as funções do Machine Learning")</span><span class="sxs-lookup"><span data-stu-id="10d52-226">![Scale Stream Analytics with Machine Learning Functions Metrics](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-01.png "Scale Stream Analytics with Machine Learning Functions Metrics")</span></span>

<span data-ttu-id="10d52-227">Olá são definidas da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="10d52-227">hello are defined as follows:</span></span>

<span data-ttu-id="10d52-228">**FUNÇÃO solicitações**: Olá o número de solicitações de função.</span><span class="sxs-lookup"><span data-stu-id="10d52-228">**FUNCTION REQUESTS**: hello number of function requests.</span></span>

<span data-ttu-id="10d52-229">**EVENTOS de função**: número eventos Olá Olá função solicitações.</span><span class="sxs-lookup"><span data-stu-id="10d52-229">**FUNCTION EVENTS**: hello number events in hello function requests.</span></span>

<span data-ttu-id="10d52-230">**Falha na função solicitações**: Olá o número de solicitações de função com falha.</span><span class="sxs-lookup"><span data-stu-id="10d52-230">**FAILED FUNCTION REQUESTS**: hello number of failed function requests.</span></span>

## <a name="key-takeaways"></a><span data-ttu-id="10d52-231">Principais observações</span><span class="sxs-lookup"><span data-stu-id="10d52-231">Key Takeaways</span></span>
<span data-ttu-id="10d52-232">toosummarize Olá principais pontos, em ordem tooscale um trabalho do Stream Analytics com funções de aprendizado de máquina, hello itens a seguir devem ser considerados:</span><span class="sxs-lookup"><span data-stu-id="10d52-232">toosummarize hello main points, in order tooscale an Stream Analytics job with Machine Learning functions, hello following items must be considered:</span></span>

1. <span data-ttu-id="10d52-233">taxa de eventos de entrada Hello</span><span class="sxs-lookup"><span data-stu-id="10d52-233">hello input event rate</span></span>
2. <span data-ttu-id="10d52-234">Olá tolerado latência para Olá executar análise de fluxo de trabalho (e, portanto, o tamanho de lote de saudação do serviço de web de aprendizado de máquina saudação de solicitações)</span><span class="sxs-lookup"><span data-stu-id="10d52-234">hello tolerated latency for hello running Stream Analytics job (and thus hello batch size of hello Machine Learning web service requests)</span></span>
3. <span data-ttu-id="10d52-235">Olá provisionado SUs de análise de fluxo e número de saudação de solicitações de serviço web de aprendizado de máquina (Olá adicionais função custos relacionados)</span><span class="sxs-lookup"><span data-stu-id="10d52-235">hello provisioned Stream Analytics SUs and hello number of Machine Learning web service requests (hello additional function-related costs)</span></span>

<span data-ttu-id="10d52-236">Uma consulta do Stream Analytics totalmente particionada foi usada como exemplo.</span><span class="sxs-lookup"><span data-stu-id="10d52-236">A fully partitioned Stream Analytics query was used as an example.</span></span> <span data-ttu-id="10d52-237">Se for necessária uma consulta mais complexa Olá [Fórum do Azure Stream Analytics](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics) é um ótimo recurso para obter ajuda adicional da equipe de análise de fluxo de saudação.</span><span class="sxs-lookup"><span data-stu-id="10d52-237">If a more complex query is needed hello [Azure Stream Analytics forum](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics) is a great resource for getting additional help from hello Stream Analytics team.</span></span>

## <a name="next-steps"></a><span data-ttu-id="10d52-238">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="10d52-238">Next steps</span></span>
<span data-ttu-id="10d52-239">toolearn mais sobre análise de fluxo, consulte:</span><span class="sxs-lookup"><span data-stu-id="10d52-239">toolearn more about Stream Analytics, see:</span></span>

* [<span data-ttu-id="10d52-240">Introdução ao uso do Stream Analytics do Azure</span><span class="sxs-lookup"><span data-stu-id="10d52-240">Get started using Azure Stream Analytics</span></span>](stream-analytics-real-time-fraud-detection.md)
* [<span data-ttu-id="10d52-241">Dimensionar trabalhos do Stream Analytics do Azure</span><span class="sxs-lookup"><span data-stu-id="10d52-241">Scale Azure Stream Analytics jobs</span></span>](stream-analytics-scale-jobs.md)
* [<span data-ttu-id="10d52-242">Referência de Linguagem de Consulta do Stream Analytics do Azure</span><span class="sxs-lookup"><span data-stu-id="10d52-242">Azure Stream Analytics Query Language Reference</span></span>](https://msdn.microsoft.com/library/azure/dn834998.aspx)
* [<span data-ttu-id="10d52-243">Referência da API REST do Gerenciamento do Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="10d52-243">Azure Stream Analytics Management REST API Reference</span></span>](https://msdn.microsoft.com/library/azure/dn835031.aspx)
