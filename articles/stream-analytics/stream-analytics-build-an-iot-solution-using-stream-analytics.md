---
title: "Criar uma solução de IoT usando o Stream Analytics | Microsoft Docs"
description: "Tutorial de introdução da solução de IoT Stream Analytics de um cenário de pedágio"
keywords: "solução de iot, funções da janela"
documentationcenter: 
services: stream-analytics
author: samacha
manager: jhubbard
editor: cgronlun
ms.assetid: a473ea0a-3eaa-4e5b-aaa1-fec7e9069f20
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 03/28/2017
ms.author: samacha
ms.openlocfilehash: a93693ef7d40025fa96846594a8eb525a50b6885
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/18/2017
---
# <a name="build-an-iot-solution-by-using-stream-analytics"></a><span data-ttu-id="205da-104">Compilar uma solução de IoT usando o Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="205da-104">Build an IoT solution by using Stream Analytics</span></span>
## <a name="introduction"></a><span data-ttu-id="205da-105">Introdução</span><span class="sxs-lookup"><span data-stu-id="205da-105">Introduction</span></span>
<span data-ttu-id="205da-106">Neste tutorial, você aprenderá a usar o Stream Analytics do Azure para aprofundar-se em seus dados em tempo real.</span><span class="sxs-lookup"><span data-stu-id="205da-106">In this tutorial, you will learn how to use Azure Stream Analytics to get real-time insights from your data.</span></span> <span data-ttu-id="205da-107">Os desenvolvedores podem facilmente combinar fluxos de dados, como fluxos de cliques, logs e eventos gerados pelo dispositivo, com registros históricos ou dados de referência para gerar insights comerciais.</span><span class="sxs-lookup"><span data-stu-id="205da-107">Developers can easily combine streams of data, such as click-streams, logs, and device-generated events, with historical records or reference data to derive business insights.</span></span> <span data-ttu-id="205da-108">Como um serviço de computação de fluxo em tempo real totalmente gerenciado e hospedado no Microsoft Azure, o Stream Analytics do Azure fornece resiliência interna, baixa latência e escalabilidade para você colocar tudo em funcionamento em minutos.</span><span class="sxs-lookup"><span data-stu-id="205da-108">As a fully managed, real-time stream computation service that's hosted in Microsoft Azure, Azure Stream Analytics provides built-in resiliency, low latency, and scalability to get you up and running in minutes.</span></span>

<span data-ttu-id="205da-109">Depois de concluir este tutorial, você poderá:</span><span class="sxs-lookup"><span data-stu-id="205da-109">After completing this tutorial, you will be able to:</span></span>

* <span data-ttu-id="205da-110">Familiarizar-se com o portal do Stream Analytics do Azure.</span><span class="sxs-lookup"><span data-stu-id="205da-110">Familiarize yourself with the Azure Stream Analytics portal.</span></span>
* <span data-ttu-id="205da-111">Configurar e implantar um trabalho de transmissão.</span><span class="sxs-lookup"><span data-stu-id="205da-111">Configure and deploy a streaming job.</span></span>
* <span data-ttu-id="205da-112">Articular problemas do mundo real e resolvê-los usando a linguagem de consulta do Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="205da-112">Articulate real-world problems and solve them by using the Stream Analytics query language.</span></span>
* <span data-ttu-id="205da-113">Desenvolver com confiança soluções de transmissão para seus clientes usando o Stream Analytics do Azure.</span><span class="sxs-lookup"><span data-stu-id="205da-113">Develop streaming solutions for your customers by using Stream Analytics with confidence.</span></span>
* <span data-ttu-id="205da-114">Use o monitoramento e experiência de log para solucionar problemas.</span><span class="sxs-lookup"><span data-stu-id="205da-114">Use the monitoring and logging experience to troubleshoot issues.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="205da-115">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="205da-115">Prerequisites</span></span>
<span data-ttu-id="205da-116">Para concluir este tutorial, você precisará dos seguintes pré-requisitos:</span><span class="sxs-lookup"><span data-stu-id="205da-116">You will need the following prerequisites to complete this tutorial:</span></span>

* <span data-ttu-id="205da-117">A versão mais recente do [Azure PowerShell](/powershell/azure/overview)</span><span class="sxs-lookup"><span data-stu-id="205da-117">The latest version of [Azure PowerShell](/powershell/azure/overview)</span></span>
* <span data-ttu-id="205da-118">Visual Studio 2017, 2015 ou o [Visual Studio Community](https://www.visualstudio.com/products/visual-studio-community-vs.aspx) gratuito</span><span class="sxs-lookup"><span data-stu-id="205da-118">Visual Studio 2017, 2015, or the free [Visual Studio Community](https://www.visualstudio.com/products/visual-studio-community-vs.aspx)</span></span>
* <span data-ttu-id="205da-119">Uma [assinatura do Azure](https://azure.microsoft.com/pricing/free-trial/)</span><span class="sxs-lookup"><span data-stu-id="205da-119">An [Azure subscription](https://azure.microsoft.com/pricing/free-trial/)</span></span>
* <span data-ttu-id="205da-120">Privilégios administrativos no computador</span><span class="sxs-lookup"><span data-stu-id="205da-120">Administrative privileges on the computer</span></span>
* <span data-ttu-id="205da-121">Baixar [TollApp.zip](https://github.com/Azure/azure-stream-analytics/blob/master/Samples/TollApp/TollApp.zip) do Centro de Download da Microsoft</span><span class="sxs-lookup"><span data-stu-id="205da-121">Download of [TollApp.zip](https://github.com/Azure/azure-stream-analytics/blob/master/Samples/TollApp/TollApp.zip) from the Microsoft Download Center</span></span>
* <span data-ttu-id="205da-122">Opcional: código-fonte do gerador de evento TollApp no [GitHub](https://aka.ms/azure-stream-analytics-toll-source)</span><span class="sxs-lookup"><span data-stu-id="205da-122">Optional: Source code for the TollApp event generator in [GitHub](https://aka.ms/azure-stream-analytics-toll-source)</span></span>

## <a name="scenario-introduction-hello-toll"></a><span data-ttu-id="205da-123">Introdução ao cenário: “Olá, pedágio!”</span><span class="sxs-lookup"><span data-stu-id="205da-123">Scenario introduction: “Hello, Toll!”</span></span>
<span data-ttu-id="205da-124">Uma praça de pedágio é um fenômeno comum.</span><span class="sxs-lookup"><span data-stu-id="205da-124">A toll station is a common phenomenon.</span></span> <span data-ttu-id="205da-125">Você se depara com elas em várias estradas, pontes e túneis em todo o mundo.</span><span class="sxs-lookup"><span data-stu-id="205da-125">You encounter them on many expressways, bridges, and tunnels across the world.</span></span> <span data-ttu-id="205da-126">Cada praça de pedágio tem várias cabines do pedágio.</span><span class="sxs-lookup"><span data-stu-id="205da-126">Each toll station has multiple toll booths.</span></span> <span data-ttu-id="205da-127">Em cabines manuais, você para e paga o pedágio para um atendente.</span><span class="sxs-lookup"><span data-stu-id="205da-127">At manual booths, you stop to pay the toll to an attendant.</span></span> <span data-ttu-id="205da-128">Em cabines automatizadas, um sensor sobre cada uma das cabines lê um cartão RFID fixado ao para-brisa do veículo conforme você passa pela cabine.</span><span class="sxs-lookup"><span data-stu-id="205da-128">At automated booths, a sensor on top of each booth scans an RFID card that's affixed to the windshield of your vehicle as you pass the toll booth.</span></span> <span data-ttu-id="205da-129">É fácil visualizar a passagem dos veículos por essas estações de pedágio como uma transmissão de eventos sobre quais operações interessantes podem ser executadas.</span><span class="sxs-lookup"><span data-stu-id="205da-129">It is easy to visualize the passage of vehicles through these toll stations as an event stream over which interesting operations can be performed.</span></span>

![Imagem de carros em cabines de pedágio](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image1.jpg)

## <a name="incoming-data"></a><span data-ttu-id="205da-131">Dados de entrada</span><span class="sxs-lookup"><span data-stu-id="205da-131">Incoming data</span></span>
<span data-ttu-id="205da-132">Este tutorial funciona com dois fluxos de dados.</span><span class="sxs-lookup"><span data-stu-id="205da-132">This tutorial works with two streams of data.</span></span> <span data-ttu-id="205da-133">Sensores instalados na entrada e na saída das praças de pedágio produzem o primeiro fluxo.</span><span class="sxs-lookup"><span data-stu-id="205da-133">Sensors installed in the entrance and exit of the toll stations produce the first stream.</span></span> <span data-ttu-id="205da-134">O segundo fluxo é um conjunto de dados de pesquisa estático que contém dados de registro dos veículos.</span><span class="sxs-lookup"><span data-stu-id="205da-134">The second stream is a static lookup dataset that has vehicle registration data.</span></span>

### <a name="entry-data-stream"></a><span data-ttu-id="205da-135">Fluxo de dados de entrada</span><span class="sxs-lookup"><span data-stu-id="205da-135">Entry data stream</span></span>
<span data-ttu-id="205da-136">O fluxo de dados de entrada contém informações sobre os carros que entram nas praças de pedágio.</span><span class="sxs-lookup"><span data-stu-id="205da-136">The entry data stream contains information about cars as they enter toll stations.</span></span>

| <span data-ttu-id="205da-137">TollID</span><span class="sxs-lookup"><span data-stu-id="205da-137">TollID</span></span> | <span data-ttu-id="205da-138">EntryTime</span><span class="sxs-lookup"><span data-stu-id="205da-138">EntryTime</span></span> | <span data-ttu-id="205da-139">PlacaDeCarro</span><span class="sxs-lookup"><span data-stu-id="205da-139">LicensePlate</span></span> | <span data-ttu-id="205da-140">Estado</span><span class="sxs-lookup"><span data-stu-id="205da-140">State</span></span> | <span data-ttu-id="205da-141">Faça</span><span class="sxs-lookup"><span data-stu-id="205da-141">Make</span></span> | <span data-ttu-id="205da-142">Modelo</span><span class="sxs-lookup"><span data-stu-id="205da-142">Model</span></span> | <span data-ttu-id="205da-143">VehicleType</span><span class="sxs-lookup"><span data-stu-id="205da-143">VehicleType</span></span> | <span data-ttu-id="205da-144">VehicleWeight</span><span class="sxs-lookup"><span data-stu-id="205da-144">VehicleWeight</span></span> | <span data-ttu-id="205da-145">Pedágio</span><span class="sxs-lookup"><span data-stu-id="205da-145">Toll</span></span> | <span data-ttu-id="205da-146">Marca</span><span class="sxs-lookup"><span data-stu-id="205da-146">Tag</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="205da-147">1</span><span class="sxs-lookup"><span data-stu-id="205da-147">1</span></span> |<span data-ttu-id="205da-148">2014-09-10 12:01:00.000</span><span class="sxs-lookup"><span data-stu-id="205da-148">2014-09-10 12:01:00.000</span></span> |<span data-ttu-id="205da-149">JNB 7001</span><span class="sxs-lookup"><span data-stu-id="205da-149">JNB 7001</span></span> |<span data-ttu-id="205da-150">NOVA IORQUE</span><span class="sxs-lookup"><span data-stu-id="205da-150">NY</span></span> |<span data-ttu-id="205da-151">Honda</span><span class="sxs-lookup"><span data-stu-id="205da-151">Honda</span></span> |<span data-ttu-id="205da-152">CRV</span><span class="sxs-lookup"><span data-stu-id="205da-152">CRV</span></span> |<span data-ttu-id="205da-153">1</span><span class="sxs-lookup"><span data-stu-id="205da-153">1</span></span> |<span data-ttu-id="205da-154">0</span><span class="sxs-lookup"><span data-stu-id="205da-154">0</span></span> |<span data-ttu-id="205da-155">7</span><span class="sxs-lookup"><span data-stu-id="205da-155">7</span></span> | |
| <span data-ttu-id="205da-156">1</span><span class="sxs-lookup"><span data-stu-id="205da-156">1</span></span> |<span data-ttu-id="205da-157">2014-09-10 12:02:00.000</span><span class="sxs-lookup"><span data-stu-id="205da-157">2014-09-10 12:02:00.000</span></span> |<span data-ttu-id="205da-158">1001 YXZ</span><span class="sxs-lookup"><span data-stu-id="205da-158">YXZ 1001</span></span> |<span data-ttu-id="205da-159">NOVA IORQUE</span><span class="sxs-lookup"><span data-stu-id="205da-159">NY</span></span> |<span data-ttu-id="205da-160">Toyota</span><span class="sxs-lookup"><span data-stu-id="205da-160">Toyota</span></span> |<span data-ttu-id="205da-161">Camry</span><span class="sxs-lookup"><span data-stu-id="205da-161">Camry</span></span> |<span data-ttu-id="205da-162">1</span><span class="sxs-lookup"><span data-stu-id="205da-162">1</span></span> |<span data-ttu-id="205da-163">0</span><span class="sxs-lookup"><span data-stu-id="205da-163">0</span></span> |<span data-ttu-id="205da-164">4</span><span class="sxs-lookup"><span data-stu-id="205da-164">4</span></span> |<span data-ttu-id="205da-165">123456789</span><span class="sxs-lookup"><span data-stu-id="205da-165">123456789</span></span> |
| <span data-ttu-id="205da-166">3</span><span class="sxs-lookup"><span data-stu-id="205da-166">3</span></span> |<span data-ttu-id="205da-167">2014-09-10 12:02:00.000</span><span class="sxs-lookup"><span data-stu-id="205da-167">2014-09-10 12:02:00.000</span></span> |<span data-ttu-id="205da-168">ABC 1004</span><span class="sxs-lookup"><span data-stu-id="205da-168">ABC 1004</span></span> |<span data-ttu-id="205da-169">CT</span><span class="sxs-lookup"><span data-stu-id="205da-169">CT</span></span> |<span data-ttu-id="205da-170">Ford</span><span class="sxs-lookup"><span data-stu-id="205da-170">Ford</span></span> |<span data-ttu-id="205da-171">Taurus</span><span class="sxs-lookup"><span data-stu-id="205da-171">Taurus</span></span> |<span data-ttu-id="205da-172">1</span><span class="sxs-lookup"><span data-stu-id="205da-172">1</span></span> |<span data-ttu-id="205da-173">0</span><span class="sxs-lookup"><span data-stu-id="205da-173">0</span></span> |<span data-ttu-id="205da-174">5</span><span class="sxs-lookup"><span data-stu-id="205da-174">5</span></span> |<span data-ttu-id="205da-175">456789123</span><span class="sxs-lookup"><span data-stu-id="205da-175">456789123</span></span> |
| <span data-ttu-id="205da-176">2</span><span class="sxs-lookup"><span data-stu-id="205da-176">2</span></span> |<span data-ttu-id="205da-177">2014-09-10 12:03:00.000</span><span class="sxs-lookup"><span data-stu-id="205da-177">2014-09-10 12:03:00.000</span></span> |<span data-ttu-id="205da-178">1003 XYZ</span><span class="sxs-lookup"><span data-stu-id="205da-178">XYZ 1003</span></span> |<span data-ttu-id="205da-179">CT</span><span class="sxs-lookup"><span data-stu-id="205da-179">CT</span></span> |<span data-ttu-id="205da-180">Toyota</span><span class="sxs-lookup"><span data-stu-id="205da-180">Toyota</span></span> |<span data-ttu-id="205da-181">Corolla</span><span class="sxs-lookup"><span data-stu-id="205da-181">Corolla</span></span> |<span data-ttu-id="205da-182">1</span><span class="sxs-lookup"><span data-stu-id="205da-182">1</span></span> |<span data-ttu-id="205da-183">0</span><span class="sxs-lookup"><span data-stu-id="205da-183">0</span></span> |<span data-ttu-id="205da-184">4</span><span class="sxs-lookup"><span data-stu-id="205da-184">4</span></span> | |
| <span data-ttu-id="205da-185">1</span><span class="sxs-lookup"><span data-stu-id="205da-185">1</span></span> |<span data-ttu-id="205da-186">2014-09-10 12:03:00.000</span><span class="sxs-lookup"><span data-stu-id="205da-186">2014-09-10 12:03:00.000</span></span> |<span data-ttu-id="205da-187">1007 BNJ</span><span class="sxs-lookup"><span data-stu-id="205da-187">BNJ 1007</span></span> |<span data-ttu-id="205da-188">NOVA IORQUE</span><span class="sxs-lookup"><span data-stu-id="205da-188">NY</span></span> |<span data-ttu-id="205da-189">Honda</span><span class="sxs-lookup"><span data-stu-id="205da-189">Honda</span></span> |<span data-ttu-id="205da-190">CRV</span><span class="sxs-lookup"><span data-stu-id="205da-190">CRV</span></span> |<span data-ttu-id="205da-191">1</span><span class="sxs-lookup"><span data-stu-id="205da-191">1</span></span> |<span data-ttu-id="205da-192">0</span><span class="sxs-lookup"><span data-stu-id="205da-192">0</span></span> |<span data-ttu-id="205da-193">5</span><span class="sxs-lookup"><span data-stu-id="205da-193">5</span></span> |<span data-ttu-id="205da-194">789123456</span><span class="sxs-lookup"><span data-stu-id="205da-194">789123456</span></span> |
| <span data-ttu-id="205da-195">2</span><span class="sxs-lookup"><span data-stu-id="205da-195">2</span></span> |<span data-ttu-id="205da-196">2014-09-10 12:05:00.000</span><span class="sxs-lookup"><span data-stu-id="205da-196">2014-09-10 12:05:00.000</span></span> |<span data-ttu-id="205da-197">CDE 1007</span><span class="sxs-lookup"><span data-stu-id="205da-197">CDE 1007</span></span> |<span data-ttu-id="205da-198">NJ</span><span class="sxs-lookup"><span data-stu-id="205da-198">NJ</span></span> |<span data-ttu-id="205da-199">Toyota</span><span class="sxs-lookup"><span data-stu-id="205da-199">Toyota</span></span> |<span data-ttu-id="205da-200">4x4</span><span class="sxs-lookup"><span data-stu-id="205da-200">4x4</span></span> |<span data-ttu-id="205da-201">1</span><span class="sxs-lookup"><span data-stu-id="205da-201">1</span></span> |<span data-ttu-id="205da-202">0</span><span class="sxs-lookup"><span data-stu-id="205da-202">0</span></span> |<span data-ttu-id="205da-203">6</span><span class="sxs-lookup"><span data-stu-id="205da-203">6</span></span> |<span data-ttu-id="205da-204">321987654</span><span class="sxs-lookup"><span data-stu-id="205da-204">321987654</span></span> |

<span data-ttu-id="205da-205">Aqui está uma breve descrição das colunas:</span><span class="sxs-lookup"><span data-stu-id="205da-205">Here is a short description of the columns:</span></span>

| <span data-ttu-id="205da-206">Coluna</span><span class="sxs-lookup"><span data-stu-id="205da-206">Column</span></span> | <span data-ttu-id="205da-207">Descrição</span><span class="sxs-lookup"><span data-stu-id="205da-207">Description</span></span> |
| --- | --- |
| <span data-ttu-id="205da-208">TollID</span><span class="sxs-lookup"><span data-stu-id="205da-208">TollID</span></span> |<span data-ttu-id="205da-209">A ID da cabine de pedágio que identifica exclusivamente uma cabine de pedágio</span><span class="sxs-lookup"><span data-stu-id="205da-209">The toll booth ID that uniquely identifies a toll booth</span></span> |
| <span data-ttu-id="205da-210">EntryTime</span><span class="sxs-lookup"><span data-stu-id="205da-210">EntryTime</span></span> |<span data-ttu-id="205da-211">A data e hora da entrada do veículo na cabine de pedágio no horário UTC</span><span class="sxs-lookup"><span data-stu-id="205da-211">The date and time of entry of the vehicle to the toll booth in UTC</span></span> |
| <span data-ttu-id="205da-212">PlacaDeCarro</span><span class="sxs-lookup"><span data-stu-id="205da-212">LicensePlate</span></span> |<span data-ttu-id="205da-213">O número da placa de licença do veículo</span><span class="sxs-lookup"><span data-stu-id="205da-213">The license plate number of the vehicle</span></span> |
| <span data-ttu-id="205da-214">Estado</span><span class="sxs-lookup"><span data-stu-id="205da-214">State</span></span> |<span data-ttu-id="205da-215">Um estado nos Estados Unidos</span><span class="sxs-lookup"><span data-stu-id="205da-215">A state in United States</span></span> |
| <span data-ttu-id="205da-216">Faça</span><span class="sxs-lookup"><span data-stu-id="205da-216">Make</span></span> |<span data-ttu-id="205da-217">O fabricante do automóvel</span><span class="sxs-lookup"><span data-stu-id="205da-217">The manufacturer of the automobile</span></span> |
| <span data-ttu-id="205da-218">Modelo</span><span class="sxs-lookup"><span data-stu-id="205da-218">Model</span></span> |<span data-ttu-id="205da-219">O número do modelo do automóvel</span><span class="sxs-lookup"><span data-stu-id="205da-219">The model number of the automobile</span></span> |
| <span data-ttu-id="205da-220">VehicleType</span><span class="sxs-lookup"><span data-stu-id="205da-220">VehicleType</span></span> |<span data-ttu-id="205da-221">1 para veículos de passageiros ou 2 para veículos comerciais</span><span class="sxs-lookup"><span data-stu-id="205da-221">Either 1 for passenger vehicles or 2 for commercial vehicles</span></span> |
| <span data-ttu-id="205da-222">WeightType</span><span class="sxs-lookup"><span data-stu-id="205da-222">WeightType</span></span> |<span data-ttu-id="205da-223">Peso do veículo em toneladas; 0 para veículos de passageiros</span><span class="sxs-lookup"><span data-stu-id="205da-223">Vehicle weight in tons; 0 for passenger vehicles</span></span> |
| <span data-ttu-id="205da-224">Pedágio</span><span class="sxs-lookup"><span data-stu-id="205da-224">Toll</span></span> |<span data-ttu-id="205da-225">Valor do pedágio em dólares americanos</span><span class="sxs-lookup"><span data-stu-id="205da-225">The toll value in USD</span></span> |
| <span data-ttu-id="205da-226">Marca</span><span class="sxs-lookup"><span data-stu-id="205da-226">Tag</span></span> |<span data-ttu-id="205da-227">A e-Tag no automóvel que automatiza o pagamento; deixado em branco quando o pagamento é feito manualmente</span><span class="sxs-lookup"><span data-stu-id="205da-227">The e-Tag on the automobile that automates payment; blank where the payment was done manually</span></span> |

### <a name="exit-data-stream"></a><span data-ttu-id="205da-228">Fluxo de dados de saída</span><span class="sxs-lookup"><span data-stu-id="205da-228">Exit data stream</span></span>
<span data-ttu-id="205da-229">O fluxo de dados de saída contém informações sobre os carros que estão saindo da praça de pedágio.</span><span class="sxs-lookup"><span data-stu-id="205da-229">The exit data stream contains information about cars leaving the toll station.</span></span>

| <span data-ttu-id="205da-230">**TollId**</span><span class="sxs-lookup"><span data-stu-id="205da-230">**TollId**</span></span> | <span data-ttu-id="205da-231">**ExitTime**</span><span class="sxs-lookup"><span data-stu-id="205da-231">**ExitTime**</span></span> | <span data-ttu-id="205da-232">**PlacaDeCarro**</span><span class="sxs-lookup"><span data-stu-id="205da-232">**LicensePlate**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="205da-233">1</span><span class="sxs-lookup"><span data-stu-id="205da-233">1</span></span> |<span data-ttu-id="205da-234">2014-09-10T12:03:00.0000000Z</span><span class="sxs-lookup"><span data-stu-id="205da-234">2014-09-10T12:03:00.0000000Z</span></span> |<span data-ttu-id="205da-235">JNB 7001</span><span class="sxs-lookup"><span data-stu-id="205da-235">JNB 7001</span></span> |
| <span data-ttu-id="205da-236">1</span><span class="sxs-lookup"><span data-stu-id="205da-236">1</span></span> |<span data-ttu-id="205da-237">2014-09-10T12:03:00.0000000Z</span><span class="sxs-lookup"><span data-stu-id="205da-237">2014-09-10T12:03:00.0000000Z</span></span> |<span data-ttu-id="205da-238">1001 YXZ</span><span class="sxs-lookup"><span data-stu-id="205da-238">YXZ 1001</span></span> |
| <span data-ttu-id="205da-239">3</span><span class="sxs-lookup"><span data-stu-id="205da-239">3</span></span> |<span data-ttu-id="205da-240">2014-09-10T12:04:00.0000000Z</span><span class="sxs-lookup"><span data-stu-id="205da-240">2014-09-10T12:04:00.0000000Z</span></span> |<span data-ttu-id="205da-241">ABC 1004</span><span class="sxs-lookup"><span data-stu-id="205da-241">ABC 1004</span></span> |
| <span data-ttu-id="205da-242">2</span><span class="sxs-lookup"><span data-stu-id="205da-242">2</span></span> |<span data-ttu-id="205da-243">2014-09-10T12:07:00.0000000Z</span><span class="sxs-lookup"><span data-stu-id="205da-243">2014-09-10T12:07:00.0000000Z</span></span> |<span data-ttu-id="205da-244">1003 XYZ</span><span class="sxs-lookup"><span data-stu-id="205da-244">XYZ 1003</span></span> |
| <span data-ttu-id="205da-245">1</span><span class="sxs-lookup"><span data-stu-id="205da-245">1</span></span> |<span data-ttu-id="205da-246">2014-09-10T12:08:00.0000000Z</span><span class="sxs-lookup"><span data-stu-id="205da-246">2014-09-10T12:08:00.0000000Z</span></span> |<span data-ttu-id="205da-247">1007 BNJ</span><span class="sxs-lookup"><span data-stu-id="205da-247">BNJ 1007</span></span> |
| <span data-ttu-id="205da-248">2</span><span class="sxs-lookup"><span data-stu-id="205da-248">2</span></span> |<span data-ttu-id="205da-249">2014-09-10T12:07:00.0000000Z</span><span class="sxs-lookup"><span data-stu-id="205da-249">2014-09-10T12:07:00.0000000Z</span></span> |<span data-ttu-id="205da-250">CDE 1007</span><span class="sxs-lookup"><span data-stu-id="205da-250">CDE 1007</span></span> |

<span data-ttu-id="205da-251">Aqui está uma breve descrição das colunas:</span><span class="sxs-lookup"><span data-stu-id="205da-251">Here is a short description of the columns:</span></span>

| <span data-ttu-id="205da-252">Coluna</span><span class="sxs-lookup"><span data-stu-id="205da-252">Column</span></span> | <span data-ttu-id="205da-253">Descrição</span><span class="sxs-lookup"><span data-stu-id="205da-253">Description</span></span> |
| --- | --- |
| <span data-ttu-id="205da-254">TollID</span><span class="sxs-lookup"><span data-stu-id="205da-254">TollID</span></span> |<span data-ttu-id="205da-255">A ID da cabine de pedágio que identifica exclusivamente uma cabine de pedágio</span><span class="sxs-lookup"><span data-stu-id="205da-255">The toll booth ID that uniquely identifies a toll booth</span></span> |
| <span data-ttu-id="205da-256">ExitTime</span><span class="sxs-lookup"><span data-stu-id="205da-256">ExitTime</span></span> |<span data-ttu-id="205da-257">A data e hora de saída do veículo da cabine de pedágio no horário UTC</span><span class="sxs-lookup"><span data-stu-id="205da-257">The date and time of exit of the vehicle from toll booth in UTC</span></span> |
| <span data-ttu-id="205da-258">PlacaDeCarro</span><span class="sxs-lookup"><span data-stu-id="205da-258">LicensePlate</span></span> |<span data-ttu-id="205da-259">O número da placa de licença do veículo</span><span class="sxs-lookup"><span data-stu-id="205da-259">The license plate number of the vehicle</span></span> |

### <a name="commercial-vehicle-registration-data"></a><span data-ttu-id="205da-260">Dados de registro de veículo comercial</span><span class="sxs-lookup"><span data-stu-id="205da-260">Commercial vehicle registration data</span></span>
<span data-ttu-id="205da-261">Este tutorial usa um instantâneo estático de um banco de dados de registro de veículos comerciais.</span><span class="sxs-lookup"><span data-stu-id="205da-261">The tutorial uses a static snapshot of a commercial vehicle registration database.</span></span>

| <span data-ttu-id="205da-262">PlacaDeCarro</span><span class="sxs-lookup"><span data-stu-id="205da-262">LicensePlate</span></span> | <span data-ttu-id="205da-263">RegistrationId</span><span class="sxs-lookup"><span data-stu-id="205da-263">RegistrationId</span></span> | <span data-ttu-id="205da-264">Expirado</span><span class="sxs-lookup"><span data-stu-id="205da-264">Expired</span></span> |
| --- | --- | --- |
| <span data-ttu-id="205da-265">SVT 6023</span><span class="sxs-lookup"><span data-stu-id="205da-265">SVT 6023</span></span> |<span data-ttu-id="205da-266">285429838</span><span class="sxs-lookup"><span data-stu-id="205da-266">285429838</span></span> |<span data-ttu-id="205da-267">1</span><span class="sxs-lookup"><span data-stu-id="205da-267">1</span></span> |
| <span data-ttu-id="205da-268">XLZ 3463</span><span class="sxs-lookup"><span data-stu-id="205da-268">XLZ 3463</span></span> |<span data-ttu-id="205da-269">362715656</span><span class="sxs-lookup"><span data-stu-id="205da-269">362715656</span></span> |<span data-ttu-id="205da-270">0</span><span class="sxs-lookup"><span data-stu-id="205da-270">0</span></span> |
| <span data-ttu-id="205da-271">BAC 1005</span><span class="sxs-lookup"><span data-stu-id="205da-271">BAC 1005</span></span> |<span data-ttu-id="205da-272">876133137</span><span class="sxs-lookup"><span data-stu-id="205da-272">876133137</span></span> |<span data-ttu-id="205da-273">1</span><span class="sxs-lookup"><span data-stu-id="205da-273">1</span></span> |
| <span data-ttu-id="205da-274">RIV 8632</span><span class="sxs-lookup"><span data-stu-id="205da-274">RIV 8632</span></span> |<span data-ttu-id="205da-275">992711956</span><span class="sxs-lookup"><span data-stu-id="205da-275">992711956</span></span> |<span data-ttu-id="205da-276">0</span><span class="sxs-lookup"><span data-stu-id="205da-276">0</span></span> |
| <span data-ttu-id="205da-277">SNY 7188</span><span class="sxs-lookup"><span data-stu-id="205da-277">SNY 7188</span></span> |<span data-ttu-id="205da-278">592133890</span><span class="sxs-lookup"><span data-stu-id="205da-278">592133890</span></span> |<span data-ttu-id="205da-279">0</span><span class="sxs-lookup"><span data-stu-id="205da-279">0</span></span> |
| <span data-ttu-id="205da-280">ELH 9896</span><span class="sxs-lookup"><span data-stu-id="205da-280">ELH 9896</span></span> |<span data-ttu-id="205da-281">678427724</span><span class="sxs-lookup"><span data-stu-id="205da-281">678427724</span></span> |<span data-ttu-id="205da-282">1</span><span class="sxs-lookup"><span data-stu-id="205da-282">1</span></span> |

<span data-ttu-id="205da-283">Aqui está uma breve descrição das colunas:</span><span class="sxs-lookup"><span data-stu-id="205da-283">Here is a short description of the columns:</span></span>

| <span data-ttu-id="205da-284">Coluna</span><span class="sxs-lookup"><span data-stu-id="205da-284">Column</span></span> | <span data-ttu-id="205da-285">Descrição</span><span class="sxs-lookup"><span data-stu-id="205da-285">Description</span></span> |
| --- | --- |
| <span data-ttu-id="205da-286">PlacaDeCarro</span><span class="sxs-lookup"><span data-stu-id="205da-286">LicensePlate</span></span> |<span data-ttu-id="205da-287">O número da placa de licença do veículo</span><span class="sxs-lookup"><span data-stu-id="205da-287">The license plate number of the vehicle</span></span> |
| <span data-ttu-id="205da-288">RegistrationId</span><span class="sxs-lookup"><span data-stu-id="205da-288">RegistrationId</span></span> |<span data-ttu-id="205da-289">A ID de registro do veículo</span><span class="sxs-lookup"><span data-stu-id="205da-289">The vehicle's registration ID</span></span> |
| <span data-ttu-id="205da-290">Expirado</span><span class="sxs-lookup"><span data-stu-id="205da-290">Expired</span></span> |<span data-ttu-id="205da-291">O status de registro do veículo: 0 se o registro do veículo estiver ativo, 1 se estiver vencido</span><span class="sxs-lookup"><span data-stu-id="205da-291">The registration status of the vehicle: 0 if vehicle registration is active, 1 if registration is expired</span></span> |

## <a name="set-up-the-environment-for-azure-stream-analytics"></a><span data-ttu-id="205da-292">Configurar o ambiente para o Stream Analytics do Azure</span><span class="sxs-lookup"><span data-stu-id="205da-292">Set up the environment for Azure Stream Analytics</span></span>
<span data-ttu-id="205da-293">Para concluir este tutorial, você precisa de uma assinatura do Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="205da-293">To complete this tutorial, you need a Microsoft Azure subscription.</span></span> <span data-ttu-id="205da-294">A Microsoft oferece uma avaliação gratuita dos serviços do Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="205da-294">Microsoft offers free trial for Microsoft Azure services.</span></span>

<span data-ttu-id="205da-295">Se não tiver uma conta do Azure, [solicite uma versão de avaliação gratuita](http://azure.microsoft.com/pricing/free-trial/).</span><span class="sxs-lookup"><span data-stu-id="205da-295">If you do not have an Azure account, you can [request a free trial version](http://azure.microsoft.com/pricing/free-trial/).</span></span>

> [!NOTE]
> <span data-ttu-id="205da-296">Para se inscrever para uma avaliação gratuita, você precisará de um dispositivo móvel que possa receber mensagens de texto e de um cartão de crédito válido.</span><span class="sxs-lookup"><span data-stu-id="205da-296">To sign up for a free trial, you need a mobile device that can receive text messages and a valid credit card.</span></span>
> 
> 

<span data-ttu-id="205da-297">Siga as etapas na seção “Limpar sua conta do Azure” no final deste artigo para que você possa fazer o melhor uso de seu crédito do Azure.</span><span class="sxs-lookup"><span data-stu-id="205da-297">Be sure to follow the steps in the “Clean up your Azure account” section at the end of this article so that you can make the best use of your Azure credit.</span></span>

## <a name="provision-azure-resources-required-for-the-tutorial"></a><span data-ttu-id="205da-298">Provisionar os recursos do Azure necessários para o tutorial</span><span class="sxs-lookup"><span data-stu-id="205da-298">Provision Azure resources required for the tutorial</span></span>
<span data-ttu-id="205da-299">Este tutorial requer dois hubs de eventos para receber transmissões de dados de *entrada* e de *saída*.</span><span class="sxs-lookup"><span data-stu-id="205da-299">This tutorial requires two event hubs to receive *entry* and *exit* data streams.</span></span> <span data-ttu-id="205da-300">O Banco de Dados SQL do Azure gera os resultados dos trabalhos do Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="205da-300">Azure SQL Database outputs the results of the Stream Analytics jobs.</span></span> <span data-ttu-id="205da-301">O Armazenamento do Azure armazena dados de referência sobre o registro do veículo.</span><span class="sxs-lookup"><span data-stu-id="205da-301">Azure Storage stores reference data about vehicle registrations.</span></span>

<span data-ttu-id="205da-302">Você pode usar o script Setup.ps1 na pasta TollApp no GitHub para criar todos os recursos necessários.</span><span class="sxs-lookup"><span data-stu-id="205da-302">You can use the Setup.ps1 script in the TollApp folder on GitHub to create all required resources.</span></span> <span data-ttu-id="205da-303">Devido ao tempo, recomendamos que você execute-o.</span><span class="sxs-lookup"><span data-stu-id="205da-303">In the interest of time, we recommend that you run it.</span></span> <span data-ttu-id="205da-304">Se quiser saber mais sobre como configurar esses recursos no portal do Azure, veja o apêndice “Configurar recursos de tutorial no portal do Azure”.</span><span class="sxs-lookup"><span data-stu-id="205da-304">If you would like to learn more about how to configure these resources in the Azure portal, refer to the “Configuring tutorial resources in Azure portal” appendix.</span></span>

<span data-ttu-id="205da-305">Baixe e salve os arquivos e pastas [TollApp](https://github.com/Azure/azure-stream-analytics/blob/master/Samples/TollApp/TollApp.zip) de suporte.</span><span class="sxs-lookup"><span data-stu-id="205da-305">Download and save the supporting [TollApp](https://github.com/Azure/azure-stream-analytics/blob/master/Samples/TollApp/TollApp.zip) folder and files.</span></span>

<span data-ttu-id="205da-306">Abra uma janela do **Microsoft Azure PowerShell***como administrador*.</span><span class="sxs-lookup"><span data-stu-id="205da-306">Open a **Microsoft Azure PowerShell** window *as an administrator*.</span></span> <span data-ttu-id="205da-307">Se ainda não tiver o Azure PowerShell, siga as instruções em [Instalar e configurar o Azure PowerShell](/powershell/azure/overview) para instalá-lo.</span><span class="sxs-lookup"><span data-stu-id="205da-307">If you do not yet have Azure PowerShell, follow the instructions in [Install and configure Azure PowerShell](/powershell/azure/overview) to install it.</span></span>

<span data-ttu-id="205da-308">Como o Windows bloqueia automaticamente arquivos .ps1, .dll e .exe, você precisa definir a política de execução antes de executar o script.</span><span class="sxs-lookup"><span data-stu-id="205da-308">Because Windows automatically blocks .ps1, .dll, and .exe files, you need to set the execution policy before you run the script.</span></span> <span data-ttu-id="205da-309">Verifique se a janela do Azure PowerShell está em execução *como administrador*.</span><span class="sxs-lookup"><span data-stu-id="205da-309">Make sure the Azure PowerShell window is running *as an administrator*.</span></span> <span data-ttu-id="205da-310">Execute **Set-ExecutionPolicy unrestricted**.</span><span class="sxs-lookup"><span data-stu-id="205da-310">Run **Set-ExecutionPolicy unrestricted**.</span></span> <span data-ttu-id="205da-311">Quando solicitado, digite **Y**.</span><span class="sxs-lookup"><span data-stu-id="205da-311">When prompted, type **Y**.</span></span>

![Captura de tela de "Set-ExecutionPolicy unrestricted" em execução na janela do Azure PowerShell](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image2.png)

<span data-ttu-id="205da-313">Execute **Get-ExecutionPolicy** para confirmar se o comando funcionou.</span><span class="sxs-lookup"><span data-stu-id="205da-313">Run **Get-ExecutionPolicy** to make sure that the command worked.</span></span>

![Captura de tela de "Get-ExecutionPolicy" em execução na janela do Azure PowerShell](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image3.png)

<span data-ttu-id="205da-315">Vá até o diretório que tem os scripts e o aplicativo gerador.</span><span class="sxs-lookup"><span data-stu-id="205da-315">Go to the directory that has the scripts and generator application.</span></span>

![Captura de tela de "cd.\TollApp\TollApp" em execução na janela do Azure PowerShell](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image4.png)

<span data-ttu-id="205da-317">Digite **.\\Setup.ps1** para configurar sua conta do Azure, crie e configure todos os recursos necessários e comece a gerar eventos.</span><span class="sxs-lookup"><span data-stu-id="205da-317">Type **.\\Setup.ps1** to set up your Azure account, create and configure all required resources, and start to generate events.</span></span> <span data-ttu-id="205da-318">O script seleciona aleatoriamente uma região para criar seus recursos.</span><span class="sxs-lookup"><span data-stu-id="205da-318">The script randomly picks up a region to create your resources.</span></span> <span data-ttu-id="205da-319">Para especificar explicitamente uma região, você pode passar o parâmetro **-location** , como no exemplo a seguir:</span><span class="sxs-lookup"><span data-stu-id="205da-319">To explicitly specify a region, you can pass the **-location** parameter as in the following example:</span></span>

<span data-ttu-id="205da-320">**.\\Setup.ps1 -location “Central US”**</span><span class="sxs-lookup"><span data-stu-id="205da-320">**.\\Setup.ps1 -location “Central US”**</span></span>

![Captura de tela da página de entrada do Azure](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image5.png)

<span data-ttu-id="205da-322">O script abre a página **Entrar** do Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="205da-322">The script opens the **Sign In** page for Microsoft Azure.</span></span> <span data-ttu-id="205da-323">Insira suas credenciais de conta.</span><span class="sxs-lookup"><span data-stu-id="205da-323">Enter your account credentials.</span></span>

> [!NOTE]
> <span data-ttu-id="205da-324">Se sua conta tiver acesso a várias assinaturas, será solicitado que você insira o nome da assinatura que deseja usar para o tutorial.</span><span class="sxs-lookup"><span data-stu-id="205da-324">If your account has access to multiple subscriptions, you will be asked to enter the subscription name that you want to use for the tutorial.</span></span>
> 
> 

<span data-ttu-id="205da-325">O script pode levar vários minutos para ser executado.</span><span class="sxs-lookup"><span data-stu-id="205da-325">The script can take several minutes to run.</span></span> <span data-ttu-id="205da-326">Após a conclusão, a saída deve ser semelhante à seguinte captura de tela.</span><span class="sxs-lookup"><span data-stu-id="205da-326">After it finishes, the output should look like the following screenshot.</span></span>

![Captura de tela da saída do script na janela do Azure PowerShell](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image6.PNG)

<span data-ttu-id="205da-328">Você também verá outra janela semelhante à captura de tela a seguir.</span><span class="sxs-lookup"><span data-stu-id="205da-328">You will also see another window that's similar to the following screenshot.</span></span> <span data-ttu-id="205da-329">Este aplicativo está enviando eventos aos Hubs de Eventos do Azure, que é necessário para executar o tutorial.</span><span class="sxs-lookup"><span data-stu-id="205da-329">This application is sending events to Azure Event Hubs, which is required to run the tutorial.</span></span> <span data-ttu-id="205da-330">Sendo assim, não interrompa o aplicativo ou feche a janela até concluir o tutorial.</span><span class="sxs-lookup"><span data-stu-id="205da-330">So, do not stop the application or close this window until you finish the tutorial.</span></span>

![Captura de tela de "Enviando dados de hub de evento"](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image7.png)

<span data-ttu-id="205da-332">Agora, você deverá ver todos os recursos no portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="205da-332">You should be able to see your resources in Azure portal now.</span></span> <span data-ttu-id="205da-333">Vá para <https://portal.azure.com> e entre com as credenciais de sua conta.</span><span class="sxs-lookup"><span data-stu-id="205da-333">Go to <https://portal.azure.com>, and sign in with your account credentials.</span></span> <span data-ttu-id="205da-334">Observe que, no momento, algumas funcionalidades utilizam o portal clássico.</span><span class="sxs-lookup"><span data-stu-id="205da-334">Note that currently some functionality utilizes the classic portal.</span></span> <span data-ttu-id="205da-335">Essas etapas serão indicadas claramente.</span><span class="sxs-lookup"><span data-stu-id="205da-335">These steps will be clearly indicated.</span></span>

### <a name="azure-event-hubs"></a><span data-ttu-id="205da-336">Hubs de eventos do Azure</span><span class="sxs-lookup"><span data-stu-id="205da-336">Azure Event Hubs</span></span>
<span data-ttu-id="205da-337">No portal do Azure, clique em **Mais serviços** na parte inferior do painel de gerenciamento esquerdo.</span><span class="sxs-lookup"><span data-stu-id="205da-337">In the Azure portal, click **More services** on the bottom of the left management pane.</span></span> <span data-ttu-id="205da-338">Digite **Hubs de eventos** no campo fornecido e clique em **Hubs de eventos**.</span><span class="sxs-lookup"><span data-stu-id="205da-338">Type **Event hubs** in the field provided and click **Event hubs**.</span></span> <span data-ttu-id="205da-339">Isso iniciará uma nova janela do navegador para exibir a área **BARRAMENTO DE SERVIÇO** no **portal clássico**.</span><span class="sxs-lookup"><span data-stu-id="205da-339">This launches a new browser window to display the **SERVICE BUS** area in the **classic portal**.</span></span> <span data-ttu-id="205da-340">Aqui você pode ver o Hub de Eventos criado pelo script Setup.ps1.</span><span class="sxs-lookup"><span data-stu-id="205da-340">Here you can see the Event Hub created by the Setup.ps1 script.</span></span>

![Barramento de Serviço](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image8.png)

<span data-ttu-id="205da-342">Clique naquele que começa com *tolldata*.</span><span class="sxs-lookup"><span data-stu-id="205da-342">Click the one that starts with *tolldata*.</span></span> <span data-ttu-id="205da-343">Clique na guia **HUBS DE EVENTOS** . Você verá dois Hubs de Eventos chamados *entry* e *exit* criados nesse namespace.</span><span class="sxs-lookup"><span data-stu-id="205da-343">Click the **EVENT HUBS** tab. You will see two event hubs named *entry* and *exit* created in this namespace.</span></span>

![Guia Hubs de Eventos no portal clássico](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image9.png)

### <a name="azure-storage-container"></a><span data-ttu-id="205da-345">Contêiner de armazenamento do Azure</span><span class="sxs-lookup"><span data-stu-id="205da-345">Azure Storage container</span></span>
1. <span data-ttu-id="205da-346">Volte à guia aberta no navegador para o portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="205da-346">Go back to the tab in your browser open to Azure portal.</span></span> <span data-ttu-id="205da-347">Clique em **ARMAZENAMENTO** no lado esquerdo do portal do Azure para ver o contêiner de Armazenamento do Azure usado no tutorial.</span><span class="sxs-lookup"><span data-stu-id="205da-347">Click **STORAGE** on the left side of the Azure portal to see the Azure Storage container that's used in the tutorial.</span></span>
   
    ![Item de menu de armazenamento](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image11.png)
2. <span data-ttu-id="205da-349">Clique naquele que começa com *tolldata*.</span><span class="sxs-lookup"><span data-stu-id="205da-349">Click the one that start with *tolldata*.</span></span> <span data-ttu-id="205da-350">Clique na guia **CONTÊINERES** para ver o contêiner criado.</span><span class="sxs-lookup"><span data-stu-id="205da-350">Click the **CONTAINERS** tab to see the created container.</span></span>
   
    ![Guia Contêineres no portal do Azure](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image10.png)
3. <span data-ttu-id="205da-352">Clique no contêiner **tolldata** para ver o arquivo JSON carregado com os dados de registro de veículos.</span><span class="sxs-lookup"><span data-stu-id="205da-352">Click the **tolldata** container to see the uploaded JSON file that has vehicle registration data.</span></span>
   
    ![Captura de tela do arquivo registration.json no contêiner](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image12.png)

### <a name="azure-sql-database"></a><span data-ttu-id="205da-354">Banco de Dados SQL do Azure</span><span class="sxs-lookup"><span data-stu-id="205da-354">Azure SQL Database</span></span>
1. <span data-ttu-id="205da-355">Volte ao portal do Azure na primeira guia que foi aberta no navegador.</span><span class="sxs-lookup"><span data-stu-id="205da-355">Go back to the Azure portal on the first tab that was opened in the browser.</span></span> <span data-ttu-id="205da-356">Clique em **BANCOS DE DADOS SQL** no lado esquerdo do portal do Azure para ver o banco de dados SQL que será usado no tutorial e clique em **tolldatadb**.</span><span class="sxs-lookup"><span data-stu-id="205da-356">Click **SQL DATABASES** on the left side of the Azure portal to see the SQL database that will be used in the tutorial and click **tolldatadb**.</span></span>
   
    ![Captura de tela do banco de dados SQL criado](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image15.png)
2. <span data-ttu-id="205da-358">Copie o nome do servidor sem o número da porta (*servername*.database.windows.net, por exemplo).</span><span class="sxs-lookup"><span data-stu-id="205da-358">Copy the server name without the port number (*servername*.database.windows.net, for example).</span></span>
    <span data-ttu-id="205da-359">![Captura de tela do banco de dados SQL criado](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image15a.png)</span><span class="sxs-lookup"><span data-stu-id="205da-359">![Screenshot of the created SQL database db](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image15a.png)</span></span>

## <a name="connect-to-the-database-from-visual-studio"></a><span data-ttu-id="205da-360">Conectar-se ao banco de dados do Visual Studio</span><span class="sxs-lookup"><span data-stu-id="205da-360">Connect to the database from Visual Studio</span></span>
<span data-ttu-id="205da-361">Use o Visual Studio para acessar os resultados de consultas no banco de dados de saída.</span><span class="sxs-lookup"><span data-stu-id="205da-361">Use Visual Studio to access query results in the output database.</span></span>

<span data-ttu-id="205da-362">Conecte-se ao banco de dados SQL (o destino) do Visual Studio:</span><span class="sxs-lookup"><span data-stu-id="205da-362">Connect to the SQL database (the destination) from Visual Studio:</span></span>

1. <span data-ttu-id="205da-363">Abra o Visual Studio e clique em **Ferramentas** > **Conectar-se ao banco de dados**.</span><span class="sxs-lookup"><span data-stu-id="205da-363">Open Visual Studio, and then click **Tools** > **Connect to Database**.</span></span>
2. <span data-ttu-id="205da-364">Se for solicitado, clique em **Microsoft SQL Server** como uma fonte de dados.</span><span class="sxs-lookup"><span data-stu-id="205da-364">If asked, click **Microsoft SQL Server** as a data source.</span></span>
   
    ![Caixa de diálogo Alterar Fonte de Dados](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image16.png)
3. <span data-ttu-id="205da-366">No campo **Nome do servidor** , cole o nome copiado na seção anterior do portal do Azure (ou seja, *servername*.database.windows.net).</span><span class="sxs-lookup"><span data-stu-id="205da-366">In the **Server name** field, paste the name that you copied in the previous section from the Azure portal (that is, *servername*.database.windows.net).</span></span>
4. <span data-ttu-id="205da-367">Clique em **Usar Autenticação do SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="205da-367">Click **Use SQL Server Authentication**.</span></span>
5. <span data-ttu-id="205da-368">Digite **tolladmin** no campo **Nome de usuário** e **123toll!**</span><span class="sxs-lookup"><span data-stu-id="205da-368">Enter **tolladmin** in the **User name** field and **123toll!**</span></span> <span data-ttu-id="205da-369">in the **Senha** .</span><span class="sxs-lookup"><span data-stu-id="205da-369">in the **Password** field.</span></span>
6. <span data-ttu-id="205da-370">Clique em **Selecione ou insira um nome de banco de dados** e selecione **TollDataDB** como o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="205da-370">Click **Select or enter a database name**, and select **TollDataDB** as the database.</span></span>
   
    ![Caixa de diálogo Adicionar Conexão](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image17.jpg)
7. <span data-ttu-id="205da-372">Clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="205da-372">Click **OK**.</span></span>
8. <span data-ttu-id="205da-373">Abra o Gerenciador de Servidores.</span><span class="sxs-lookup"><span data-stu-id="205da-373">Open Server Explorer.</span></span>
   
    ![Gerenciador de Servidores](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image18.png)
9. <span data-ttu-id="205da-375">Veja quatro tabelas no banco de dados TollDataDB.</span><span class="sxs-lookup"><span data-stu-id="205da-375">See four tables in the TollDataDB database.</span></span>
   
    ![Tabelas no banco de dados TollDataDB](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image19.jpg)

## <a name="event-generator-tollapp-sample-project"></a><span data-ttu-id="205da-377">Gerador de eventos: projeto de exemplo TollApp</span><span class="sxs-lookup"><span data-stu-id="205da-377">Event generator: TollApp sample project</span></span>
<span data-ttu-id="205da-378">O script do PowerShell inicia automaticamente o envio de eventos usando o programa TollApp do aplicativo de exemplo.</span><span class="sxs-lookup"><span data-stu-id="205da-378">The PowerShell script automatically starts to send events by using the TollApp sample application program.</span></span> <span data-ttu-id="205da-379">Você não precisa executar nenhuma etapa adicional.</span><span class="sxs-lookup"><span data-stu-id="205da-379">You don’t need to perform any additional steps.</span></span>

<span data-ttu-id="205da-380">No entanto, se estiver interessado nos detalhes da implementação, você encontrará o código-fonte do aplicativo TollApp no GitHub [samples/TollApp](https://aka.ms/azure-stream-analytics-toll-source).</span><span class="sxs-lookup"><span data-stu-id="205da-380">However, if you are interested in implementation details, you can find the source code of the TollApp application in GitHub [samples/TollApp](https://aka.ms/azure-stream-analytics-toll-source).</span></span>

![Captura de tela do código de exemplo exibido no Visual Studio](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image20.png)

## <a name="create-a-stream-analytics-job"></a><span data-ttu-id="205da-382">Criar um trabalho de Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="205da-382">Create a Stream Analytics job</span></span>
1. <span data-ttu-id="205da-383">No portal do Azure, clique no sinal de adição verde no canto superior esquerdo da página para criar um novo trabalho do Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="205da-383">In the Azure portal, click the green plus sign in the top-left corner of the page to create a new Stream Analytics job.</span></span> <span data-ttu-id="205da-384">Selecione **Inteligência + Análise** e clique em **Trabalho do Stream Analytics**.</span><span class="sxs-lookup"><span data-stu-id="205da-384">Select **Intelligence + Analytics** and then click **Stream Analytics job**.</span></span>
   
    ![Novo botão](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image21.png)
2. <span data-ttu-id="205da-386">Forneça um nome de trabalho, valide se a assinatura está correta e crie um novo Grupo de recursos na mesma região do armazenamento do Hub de eventos (o padrão para o script é Centro-Sul dos EUA).</span><span class="sxs-lookup"><span data-stu-id="205da-386">Provide a job name, validate the subscription is correct and then create a new Resource group in the same region as the Event hub storage (default is South Central US for the script).</span></span>
3. <span data-ttu-id="205da-387">Clique em **Fixar no painel** e em **CRIAR** na parte inferior da página.</span><span class="sxs-lookup"><span data-stu-id="205da-387">Click **Pin to dashboard** and then **CREATE** at the bottom of the page.</span></span>
   
    ![Opção Criar um Trabalho do Stream Analytics](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image22.png)

## <a name="define-input-sources"></a><span data-ttu-id="205da-389">Definir fontes de entrada</span><span class="sxs-lookup"><span data-stu-id="205da-389">Define input sources</span></span>
1. <span data-ttu-id="205da-390">O trabalho criará e abrirá a página do trabalho.</span><span class="sxs-lookup"><span data-stu-id="205da-390">The job will create and open the job page.</span></span> <span data-ttu-id="205da-391">Se preferir, clique no trabalho de análise criado no painel do portal.</span><span class="sxs-lookup"><span data-stu-id="205da-391">Or you can click the created analytics job on the portal dashboard.</span></span>

2. <span data-ttu-id="205da-392">Clique na guia **ENTRADAS** para definir os dados de origem.</span><span class="sxs-lookup"><span data-stu-id="205da-392">Click the **INPUTS** tab to define the source data.</span></span>
   
    ![A guia Entradas](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image24.png)
3. <span data-ttu-id="205da-394">Clique em **ADICIONAR UMA ENTRADA**.</span><span class="sxs-lookup"><span data-stu-id="205da-394">Click **ADD AN INPUT**.</span></span>
   
    ![A opção Adicionar uma Entrada](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image25.png)
4. <span data-ttu-id="205da-396">Digite **EntryStream** como **ALIAS DE ENTRADA**.</span><span class="sxs-lookup"><span data-stu-id="205da-396">Enter **EntryStream** as **INPUT ALIAS**.</span></span>
5. <span data-ttu-id="205da-397">O Tipo de Origem é **Transmissão de Dados**</span><span class="sxs-lookup"><span data-stu-id="205da-397">Source Type is **Data Stream**</span></span>
6. <span data-ttu-id="205da-398">A Fonte é **Hub de eventos**.</span><span class="sxs-lookup"><span data-stu-id="205da-398">Source is **Event hub**.</span></span>
7. <span data-ttu-id="205da-399">O **Namespace do barramento de serviço** deve ser o TollData no menu suspenso.</span><span class="sxs-lookup"><span data-stu-id="205da-399">**Service bus namespace** should be the TollData one in the drop down.</span></span>
8. <span data-ttu-id="205da-400">O **Nome do hub de eventos** deve ser definido como **entrada**.</span><span class="sxs-lookup"><span data-stu-id="205da-400">**Event hub name** should be set to **entry**.</span></span>
9. <span data-ttu-id="205da-401">**Nome da política do hub de eventos*é **RootManageSharedAccessKey**  (o valor padrão).</span><span class="sxs-lookup"><span data-stu-id="205da-401">**Event hub policy name*is **RootManageSharedAccessKey**  (the default value).</span></span>
10. <span data-ttu-id="205da-402">Selecione **JSON** como **FORMATO DE SERIALIZAÇÃO DO EVENTO** e **UTF8** como **CODIFICAÇÃO**.</span><span class="sxs-lookup"><span data-stu-id="205da-402">Select **JSON** for **EVENT SERIALIZATION FORMAT** and **UTF8** for **ENCODING**.</span></span>
   
    <span data-ttu-id="205da-403">As configurações ficarão semelhantes:</span><span class="sxs-lookup"><span data-stu-id="205da-403">Your settings will look like:</span></span>
   
    ![Configurações do hub de evento](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image28.png)

10. <span data-ttu-id="205da-405">Clique em **Criar** na parte inferior da página para concluir o assistente.</span><span class="sxs-lookup"><span data-stu-id="205da-405">Click **Create** at the bottom of the page to finish the wizard.</span></span>
    
    <span data-ttu-id="205da-406">Agora que criou o fluxo de entrada, você seguirá as mesmas etapas para criar o fluxo de saída.</span><span class="sxs-lookup"><span data-stu-id="205da-406">Now that you've created the entry stream, you will follow the same steps to create the exit stream.</span></span> <span data-ttu-id="205da-407">Lembre-se de inserir valores como mostra a captura de tela a seguir.</span><span class="sxs-lookup"><span data-stu-id="205da-407">Be sure to enter values as on the following screenshot.</span></span>
    
    ![Configurações do fluxo de saída](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image31.png)
    
    <span data-ttu-id="205da-409">Você definiu dois fluxos de entrada:</span><span class="sxs-lookup"><span data-stu-id="205da-409">You have defined two input streams:</span></span>
    
    ![Fluxos de entrada definidos no portal do Azure](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image32.png)
    
    <span data-ttu-id="205da-411">Em seguida, você adicionará a entrada de dados de referência para o arquivo de blob que contém os dados de registro do carro.</span><span class="sxs-lookup"><span data-stu-id="205da-411">Next, you will add reference data input for the blob file that contains car registration data.</span></span>
11. <span data-ttu-id="205da-412">Clique em **ADICIONAR** e siga o mesmo processo para as entradas de transmissão, mas selecione **DADOS DE REFERÊNCIA** em vez de **Transmissão de Dados**. O **Alias de Entrada** é **Registro**.</span><span class="sxs-lookup"><span data-stu-id="205da-412">Click **ADD**, and then follow the same process for the stream inputs but select **REFERENCE DATA** instead of **Data Stream** and the **Input Alias** is **Registration**.</span></span>

12. <span data-ttu-id="205da-413">conta de armazenamento que começa com **tolldata**.</span><span class="sxs-lookup"><span data-stu-id="205da-413">storage account that starts with **tolldata**.</span></span> <span data-ttu-id="205da-414">O nome do contêiner deve ser **tolldata** e o **PADRÃO DO CAMINHO** deve ser **registration.json**.</span><span class="sxs-lookup"><span data-stu-id="205da-414">The container name should be **tolldata**, and the **PATH PATTERN** should be **registration.json**.</span></span> <span data-ttu-id="205da-415">Este nome de arquivo diferencia maiúsculas de minúsculas e deve estar em **minúsculas**.</span><span class="sxs-lookup"><span data-stu-id="205da-415">This file name is case sensitive and should be **lowercase**.</span></span>
    
    ![Configurações de armazenamento de blob](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image34.png)
13. <span data-ttu-id="205da-417">Clique em **Criar** para concluir o assistente.</span><span class="sxs-lookup"><span data-stu-id="205da-417">Click **Create** to finish the wizard.</span></span>

<span data-ttu-id="205da-418">Agora, todas as entradas são definidas.</span><span class="sxs-lookup"><span data-stu-id="205da-418">Now all inputs are defined.</span></span>

## <a name="define-output"></a><span data-ttu-id="205da-419">Definir saída</span><span class="sxs-lookup"><span data-stu-id="205da-419">Define output</span></span>
1. <span data-ttu-id="205da-420">No painel de visão geral do trabalho do Stream Analytics, selecione **SAÍDAS**.</span><span class="sxs-lookup"><span data-stu-id="205da-420">On the Stream Analytics job overview pane, select **OUTPUTS**.</span></span>
   
    ![A guia Saída e a opção “Adicionar uma saída”](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image37.png)
2. <span data-ttu-id="205da-422">Clique em **Adicionar**.</span><span class="sxs-lookup"><span data-stu-id="205da-422">Click **Add**.</span></span>
3. <span data-ttu-id="205da-423">Defina o **Alias de saída** como “saída” e **Coletor** como **Banco de dados SQL**.</span><span class="sxs-lookup"><span data-stu-id="205da-423">Set the **Output alias** to 'output' and then **Sink** to **SQL database**.</span></span>
3. <span data-ttu-id="205da-424">Selecione o nome do servidor que foi usado na seção “Conectar-se ao banco de dados do Visual Studio” do artigo.</span><span class="sxs-lookup"><span data-stu-id="205da-424">Select the server name that was used in the “Connect to Database from Visual Studio” section of the article.</span></span> <span data-ttu-id="205da-425">O nome do banco de dados é **TollDataDB**.</span><span class="sxs-lookup"><span data-stu-id="205da-425">The database name is **TollDataDB**.</span></span>
4. <span data-ttu-id="205da-426">Digite **tolladmin** no campo **USERNAME**, **123toll!**</span><span class="sxs-lookup"><span data-stu-id="205da-426">Enter **tolladmin** in the **USERNAME** field, **123toll!**</span></span> <span data-ttu-id="205da-427">no campo **SENHA**, e **TollDataRefJoin** no campo **TABELA**.</span><span class="sxs-lookup"><span data-stu-id="205da-427">in the **PASSWORD** field, and **TollDataRefJoin** in the **TABLE** field.</span></span>
   
    ![Configurações do Banco de Dados SQL](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image38.png)
5. <span data-ttu-id="205da-429">Clique em **Criar**.</span><span class="sxs-lookup"><span data-stu-id="205da-429">Click **Create**.</span></span>

## <a name="azure-stream-analytics-query"></a><span data-ttu-id="205da-430">Consulta do Stream Analytics do Azure</span><span class="sxs-lookup"><span data-stu-id="205da-430">Azure Stream analytics query</span></span>
<span data-ttu-id="205da-431">A guia **CONSULTA** contém uma consulta SQL que transforma os dados de entrada.</span><span class="sxs-lookup"><span data-stu-id="205da-431">The **QUERY** tab contains a SQL query that transforms the incoming data.</span></span>

![Uma consulta adicionada à guia Consulta](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image39.png)

<span data-ttu-id="205da-433">Este tutorial tenta responder várias perguntas de negócios relacionadas aos dados de pedágio e criar consultas do Stream Analytics que possam ser usadas no Stream Analytics do Azure para fornecer uma resposta relevante.</span><span class="sxs-lookup"><span data-stu-id="205da-433">This tutorial attempts to answer several business questions that are related to toll data and constructs Stream Analytics queries that can be used in Azure Stream Analytics to provide a relevant answer.</span></span>

<span data-ttu-id="205da-434">Antes de você começar seu primeiro trabalho do Stream Analytics do Azure, vamos explorar alguns cenários e a sintaxe de consulta.</span><span class="sxs-lookup"><span data-stu-id="205da-434">Before you start your first Stream Analytics job, let’s explore a few scenarios and the query syntax.</span></span>

## <a name="introduction-to-azure-stream-analytics-query-language"></a><span data-ttu-id="205da-435">Introdução à linguagem de consulta do Stream Analytics do Azure</span><span class="sxs-lookup"><span data-stu-id="205da-435">Introduction to Azure Stream Analytics query language</span></span>
- - -
<span data-ttu-id="205da-436">Digamos que você precise contar o número de veículos que entram em uma cabine de pedágio.</span><span class="sxs-lookup"><span data-stu-id="205da-436">Let’s say that you need to count the number of vehicles that enter a toll booth.</span></span> <span data-ttu-id="205da-437">Como se trata de um fluxo contínuo de eventos, você precisa definir um “período”.</span><span class="sxs-lookup"><span data-stu-id="205da-437">Because this is a continuous stream of events, you have to define a “period of time.”</span></span> <span data-ttu-id="205da-438">Vamos modificar a pergunta para "Quantos veículos entram em uma cabine de pedágio a cada três minutos?".</span><span class="sxs-lookup"><span data-stu-id="205da-438">Let's modify the question to be “How many vehicles enter a toll booth every three minutes?”.</span></span> <span data-ttu-id="205da-439">Isso é conhecido como contagem em cascata.</span><span class="sxs-lookup"><span data-stu-id="205da-439">This is commonly referred to as the tumbling count.</span></span>

<span data-ttu-id="205da-440">Vejamos a consulta do Stream Analytics do Azure que responde essa pergunta:</span><span class="sxs-lookup"><span data-stu-id="205da-440">Let’s look at the Azure Stream Analytics query that answers this question:</span></span>

    SELECT TollId, System.Timestamp AS WindowEnd, COUNT(*) AS Count
    FROM EntryStream TIMESTAMP BY EntryTime
    GROUP BY TUMBLINGWINDOW(minute, 3), TollId

<span data-ttu-id="205da-441">Como você pode ver, o Stream Analytics do Azure usa uma linguagem de consulta parecida com SQL e adiciona algumas extensões para especificar aspectos da consulta relacionados ao tempo.</span><span class="sxs-lookup"><span data-stu-id="205da-441">As you can see, Azure Stream Analytics uses a query language that's like SQL and adds a few extensions to specify time-related aspects of the query.</span></span>

<span data-ttu-id="205da-442">Para obter mais detalhes, leia sobre [Gerenciamento de tempo](https://msdn.microsoft.com/library/azure/mt582045.aspx) e construções de [Janelas](https://msdn.microsoft.com/library/azure/dn835019.aspx) usadas na consulta no MSDN.</span><span class="sxs-lookup"><span data-stu-id="205da-442">For more details, read about [Time Management](https://msdn.microsoft.com/library/azure/mt582045.aspx) and [Windowing](https://msdn.microsoft.com/library/azure/dn835019.aspx) constructs used in the query from MSDN.</span></span>

## <a name="testing-azure-stream-analytics-queries"></a><span data-ttu-id="205da-443">Testando consultas do Stream Analytics do Azure</span><span class="sxs-lookup"><span data-stu-id="205da-443">Testing Azure Stream Analytics queries</span></span>
<span data-ttu-id="205da-444">Agora que você escreveu sua primeira consulta do Stream Analytics do Azure, é hora de testá-la usando os arquivos de dados de exemplo localizados na pasta TollApp no caminho a seguir:</span><span class="sxs-lookup"><span data-stu-id="205da-444">Now that you have written your first Azure Stream Analytics query, it is time to test it by using sample data files located in your TollApp folder in the following path:</span></span>

<span data-ttu-id="205da-445">**..\\TollApp\\TollApp\\Data**</span><span class="sxs-lookup"><span data-stu-id="205da-445">**..\\TollApp\\TollApp\\Data**</span></span>

<span data-ttu-id="205da-446">Esta pasta contém os seguintes arquivos:</span><span class="sxs-lookup"><span data-stu-id="205da-446">This folder contains the following files:</span></span>

* <span data-ttu-id="205da-447">Entry.json</span><span class="sxs-lookup"><span data-stu-id="205da-447">Entry.json</span></span>
* <span data-ttu-id="205da-448">Exit.JSON</span><span class="sxs-lookup"><span data-stu-id="205da-448">Exit.json</span></span>
* <span data-ttu-id="205da-449">registration.json</span><span class="sxs-lookup"><span data-stu-id="205da-449">Registration.json</span></span>

## <a name="question-1-number-of-vehicles-entering-a-toll-booth"></a><span data-ttu-id="205da-450">Pergunta 1: número de veículos que entram em uma cabine de pedágio</span><span class="sxs-lookup"><span data-stu-id="205da-450">Question 1: Number of vehicles entering a toll booth</span></span>
1. <span data-ttu-id="205da-451">Abra o portal do Azure e navegue até o trabalho do Stream Analytics do Azure que foi criado.</span><span class="sxs-lookup"><span data-stu-id="205da-451">Open the Azure portal and go to your created Azure Stream Analytics job.</span></span> <span data-ttu-id="205da-452">Clique na guia **CONSULTA** e copie e cole a consulta da seção anterior.</span><span class="sxs-lookup"><span data-stu-id="205da-452">Click the **QUERY** tab and paste query from the previous section.</span></span>

2. <span data-ttu-id="205da-453">Para validar essa consulta nos dados de exemplo, carregue os dados na entrada EntryStream clicando no símbolo … e selecionando **carregar dados de exemplo do arquivo**.</span><span class="sxs-lookup"><span data-stu-id="205da-453">To validate this query against sample data, upload the data into the EntryStream input by clicking the ... symbol and selecting **Upload sample data from file**.</span></span>

    ![Captura de tela do arquivo Entry.json](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image41.png)
3. <span data-ttu-id="205da-455">No painel exibido, selecione o arquivo (Entry.json) no computador local e clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="205da-455">In the pane that appears select the file (Entry.json) on your local machine and click **OK**.</span></span> <span data-ttu-id="205da-456">O ícone **Teste** agora ficará aceso e será clicável.</span><span class="sxs-lookup"><span data-stu-id="205da-456">The **Test** icon will now illuminate and be clickable.</span></span>
   
    ![Captura de tela do arquivo Entry.json](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image42.png)
3. <span data-ttu-id="205da-458">Valide que a saída da consulta é conforme o esperado:</span><span class="sxs-lookup"><span data-stu-id="205da-458">Validate that the output of the query is as expected:</span></span>
   
    ![Resultados do teste](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image43.png)

## <a name="question-2-report-total-time-for-each-car-to-pass-through-the-toll-booth"></a><span data-ttu-id="205da-460">Pergunta 2: relatar o tempo total para cada carro passar pela cabine de pedágio</span><span class="sxs-lookup"><span data-stu-id="205da-460">Question 2: Report total time for each car to pass through the toll booth</span></span>
<span data-ttu-id="205da-461">O tempo médio necessário para um carro passar pela cabine de pedágio ajuda a avaliar a eficiência do processo e a experiência do cliente.</span><span class="sxs-lookup"><span data-stu-id="205da-461">The average time that's required for a car to pass through the toll helps to assess the efficiency of the process and the customer experience.</span></span>

<span data-ttu-id="205da-462">Para encontrar o tempo total, você precisa associar o fluxo EntryTime ao fluxo ExitTime.</span><span class="sxs-lookup"><span data-stu-id="205da-462">To find the total time, you need to join the EntryTime stream with the ExitTime stream.</span></span> <span data-ttu-id="205da-463">Associe os fluxos nas colunas TollId e LicencePlate.</span><span class="sxs-lookup"><span data-stu-id="205da-463">You will join the streams on TollId and LicencePlate columns.</span></span> <span data-ttu-id="205da-464">O operador **JOIN** exige a especificação de um espaço de manobra temporal que descreve a diferença de tempo aceitável entre os eventos associados.</span><span class="sxs-lookup"><span data-stu-id="205da-464">The **JOIN** operator requires you to specify temporal leeway that describes the acceptable time difference between the joined events.</span></span> <span data-ttu-id="205da-465">Use a função **DATEDIFF** para especificar que os eventos não devem ter um intervalo maior que 15 minutos entre si.</span><span class="sxs-lookup"><span data-stu-id="205da-465">You will use **DATEDIFF** function to specify that events should be no more than 15 minutes from each other.</span></span> <span data-ttu-id="205da-466">Aplique também a função **DATEDIFF** às horas de entrada e saída para calcular o tempo real que um carro gasta na praça de pedágio.</span><span class="sxs-lookup"><span data-stu-id="205da-466">You will also apply the **DATEDIFF** function to exit and entry times to compute the actual time that a car spends in the toll station.</span></span> <span data-ttu-id="205da-467">Observe a diferença do uso da **DATEDIFF** quando usada em uma instrução **SELECT** em comparação com uma condição **JOIN**.</span><span class="sxs-lookup"><span data-stu-id="205da-467">Note the difference of the use of **DATEDIFF** when it's used in a **SELECT** statement rather than a **JOIN** condition.</span></span>

    SELECT EntryStream.TollId, EntryStream.EntryTime, ExitStream.ExitTime, EntryStream.LicensePlate, DATEDIFF (minute , EntryStream.EntryTime, ExitStream.ExitTime) AS DurationInMinutes
    FROM EntryStream TIMESTAMP BY EntryTime
    JOIN ExitStream TIMESTAMP BY ExitTime
    ON (EntryStream.TollId= ExitStream.TollId AND EntryStream.LicensePlate = ExitStream.LicensePlate)
    AND DATEDIFF (minute, EntryStream, ExitStream ) BETWEEN 0 AND 15

1. <span data-ttu-id="205da-468">Para testar essa consulta, atualize-a na **CONSULTA** do trabalho.</span><span class="sxs-lookup"><span data-stu-id="205da-468">To test this query, update the query on the **QUERY** for the job.</span></span> <span data-ttu-id="205da-469">Adicione o arquivo de teste de **ExitStream** da mesma forma que **EntryStream** foi inserido acima.</span><span class="sxs-lookup"><span data-stu-id="205da-469">Add the test file for **ExitStream** just like **EntryStream** was entered above.</span></span>
   
2. <span data-ttu-id="205da-470">Clique em **Testar**.</span><span class="sxs-lookup"><span data-stu-id="205da-470">Click **Test**.</span></span>

3. <span data-ttu-id="205da-471">Marque a caixa de seleção para testar a consulta e exibir a saída:</span><span class="sxs-lookup"><span data-stu-id="205da-471">Select the check box to test the query and view the output:</span></span>
   
    ![Saída do teste](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image45.png)

## <a name="question-3-report-all-commercial-vehicles-with-expired-registration"></a><span data-ttu-id="205da-473">Pergunta 3: relatar todos os veículos comerciais com o registro vencido</span><span class="sxs-lookup"><span data-stu-id="205da-473">Question 3: Report all commercial vehicles with expired registration</span></span>
<span data-ttu-id="205da-474">O Stream Analytics do Azure pode usar instantâneos estáticos de dados para se associar com os fluxos de dados temporais.</span><span class="sxs-lookup"><span data-stu-id="205da-474">Azure Stream Analytics can use static snapshots of data to join with temporal data streams.</span></span> <span data-ttu-id="205da-475">Para demonstrar essa funcionalidade, use a pergunta de exemplo a seguir.</span><span class="sxs-lookup"><span data-stu-id="205da-475">To demonstrate this capability, use the following sample question.</span></span>

<span data-ttu-id="205da-476">Se um veículo comercial estiver registrado na empresa de pedágio, ele poderá passar pela cabine sem ser parado para inspeção.</span><span class="sxs-lookup"><span data-stu-id="205da-476">If a commercial vehicle is registered with the toll company, it can pass through the toll booth without being stopped for inspection.</span></span> <span data-ttu-id="205da-477">Use a tabela de pesquisa de Registro de Veículo Comercial para identificar todos os veículos comerciais com o registro vencido.</span><span class="sxs-lookup"><span data-stu-id="205da-477">You will use Commercial Vehicle Registration lookup table to identify all commercial vehicles that have expired registrations.</span></span>

```
SELECT EntryStream.EntryTime, EntryStream.LicensePlate, EntryStream.TollId, Registration.RegistrationId
FROM EntryStream TIMESTAMP BY EntryTime
JOIN Registration
ON EntryStream.LicensePlate = Registration.LicensePlate
WHERE Registration.Expired = '1'
```

<span data-ttu-id="205da-478">Para testar uma consulta usando dados de referência, você precisa definir uma fonte de entrada para os dados de referência, o que você já fez.</span><span class="sxs-lookup"><span data-stu-id="205da-478">To test a query by using reference data, you need to define an input source for the reference data, which you have done already.</span></span>

<span data-ttu-id="205da-479">Para testar essa consulta, cole-a na guia **CONSULTA** clique em **Testar**, especifique as duas fontes de entrada e os dados de exemplo de registro e clique em **Testar**.</span><span class="sxs-lookup"><span data-stu-id="205da-479">To test this query, paste the query into the **QUERY** tab, click **Test**, and specify the two input sources and the registration sample data and click **Test**.</span></span>  
   
![Saída do teste](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image46.png)

## <a name="start-the-stream-analytics-job"></a><span data-ttu-id="205da-481">Iniciar o trabalho do Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="205da-481">Start the Stream Analytics job</span></span>
<span data-ttu-id="205da-482">Agora, é hora de concluir a configuração e iniciar o trabalho.</span><span class="sxs-lookup"><span data-stu-id="205da-482">Now it's time to finish the configuration and start the job.</span></span> <span data-ttu-id="205da-483">Salve a consulta da Pergunta 3, o que produzirá a saída correspondente ao esquema da tabela de saída **TollDataRefJoin** .</span><span class="sxs-lookup"><span data-stu-id="205da-483">Save the query from Question 3, which will produce output that matches the schema of the **TollDataRefJoin** output table.</span></span>

<span data-ttu-id="205da-484">Navegue até o **PAINEL** de trabalho e clique em **INICIAR**.</span><span class="sxs-lookup"><span data-stu-id="205da-484">Go to the job **DASHBOARD**, and click **START**.</span></span>

![Captura de tela do botão Iniciar no painel de trabalho](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image48.png)

<span data-ttu-id="205da-486">Na caixa de diálogo que aparece, altere a hora de **INICIAR SAÍDA** para **HORA PERSONALIZADA**.</span><span class="sxs-lookup"><span data-stu-id="205da-486">In the dialog box that opens, change the **START OUTPUT** time to **CUSTOM TIME**.</span></span> <span data-ttu-id="205da-487">Altere a hora para uma hora antes da hora atual.</span><span class="sxs-lookup"><span data-stu-id="205da-487">Change the hour to one hour before the current time.</span></span> <span data-ttu-id="205da-488">Essa alteração assegura que todos os eventos do hub de eventos sejam processados desde que você começou a gerar os eventos no início do tutorial.</span><span class="sxs-lookup"><span data-stu-id="205da-488">This change ensures that all events from the event hub are processed since you started to generate the events at the beginning of the tutorial.</span></span> <span data-ttu-id="205da-489">Agora clique no botão **Iniciar** para iniciar o trabalho.</span><span class="sxs-lookup"><span data-stu-id="205da-489">Now click the **Start** button to start the job.</span></span>

![Seleção de hora personalizada](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image49.png)

<span data-ttu-id="205da-491">O início do trabalho pode levar alguns minutos.</span><span class="sxs-lookup"><span data-stu-id="205da-491">Starting the job can take a few minutes.</span></span> <span data-ttu-id="205da-492">Você pode ver o status na página de nível superior do Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="205da-492">You can see the status on the top-level page for Stream Analytics.</span></span>

![Captura de tela do status do trabalho](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image50.png)

## <a name="check-results-in-visual-studio"></a><span data-ttu-id="205da-494">Verificar resultados no Visual Studio</span><span class="sxs-lookup"><span data-stu-id="205da-494">Check results in Visual Studio</span></span>
1. <span data-ttu-id="205da-495">Abra o Gerenciador de Servidores do Visual Studio e clique com o botão direito do mouse na tabela **TollDataRefJoin** .</span><span class="sxs-lookup"><span data-stu-id="205da-495">Open Visual Studio Server Explorer, and right-click the **TollDataRefJoin** table.</span></span>
2. <span data-ttu-id="205da-496">Selecione **Mostrar Dados da Tabela** para ver a saída do seu trabalho.</span><span class="sxs-lookup"><span data-stu-id="205da-496">Click **Show Table Data** to see the output of your job.</span></span>
   
    ![Seleção de "Mostrar Dados da Tabela" no Gerenciador de Servidores](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image51.jpg)

## <a name="scale-out-azure-stream-analytics-jobs"></a><span data-ttu-id="205da-498">Escalar horizontalmente trabalhos do Stream Analytics do Azure</span><span class="sxs-lookup"><span data-stu-id="205da-498">Scale out Azure Stream Analytics jobs</span></span>
<span data-ttu-id="205da-499">O Stream Analytics do Azure foi projetado para ser dimensionado de forma elástica, de modo a poder lidar com muitos dados.</span><span class="sxs-lookup"><span data-stu-id="205da-499">Azure Stream Analytics is designed to elastically scale so that it can handle a lot of data.</span></span> <span data-ttu-id="205da-500">A consulta do Stream Analytics do Azure pode usar uma cláusula **PARTITION BY** para informar ao sistema que esta etapa será escalável horizontalmente. **PartitionId** é uma coluna especial adicionada pelo sistema e corresponde à ID da partição de entrada (hub de evento).</span><span class="sxs-lookup"><span data-stu-id="205da-500">The Azure Stream Analytics query can use a **PARTITION BY** clause to tell the system that this step will scale out. **PartitionId** is a special column that the system adds to match the partition ID of the input (event hub).</span></span>

    SELECT TollId, System.Timestamp AS WindowEnd, COUNT(*)AS Count
    FROM EntryStream TIMESTAMP BY EntryTime PARTITION BY PartitionId
    GROUP BY TUMBLINGWINDOW(minute,3), TollId, PartitionId

1. <span data-ttu-id="205da-501">Interrompa o trabalho atual, atualize a consulta na guia **CONSULTA** e abra a engrenagem **Configurações** no painel do trabalho.</span><span class="sxs-lookup"><span data-stu-id="205da-501">Stop the current job, update the query in the **QUERY** tab, and open the **Settings** gear in the job dashboard.</span></span> <span data-ttu-id="205da-502">Clique em **Escala**.</span><span class="sxs-lookup"><span data-stu-id="205da-502">Click **Scale**.</span></span>
   
    <span data-ttu-id="205da-503">**UNIDADES DE STREAMING** definem a quantidade de capacidade de computação que o trabalho pode receber.</span><span class="sxs-lookup"><span data-stu-id="205da-503">**STREAMING UNITS** define the amount of compute power that the job can receive.</span></span>
2. <span data-ttu-id="205da-504">Altere o menu suspenso de 1 para 6.</span><span class="sxs-lookup"><span data-stu-id="205da-504">Change the drop down from 1 from 6.</span></span>
   
    ![Captura de tela da seleção de 6 unidades de streaming](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image52.png)
3. <span data-ttu-id="205da-506">Vá até a guia **SAÍDAS** e altere o nome da tabela SQL para **TollDataTumblingCountPartitioned**.</span><span class="sxs-lookup"><span data-stu-id="205da-506">Go to the **OUTPUTS** tab and change the name of the SQL table to **TollDataTumblingCountPartitioned**.</span></span>

<span data-ttu-id="205da-507">Se você iniciar o trabalho agora, o Stream Analytics do Azure poderá distribuir o trabalho entre mais recursos de computação e obter uma taxa de transferência melhor.</span><span class="sxs-lookup"><span data-stu-id="205da-507">If you start the job now, Azure Stream Analytics can distribute work across more compute resources and achieve better throughput.</span></span> <span data-ttu-id="205da-508">Observe que o aplicativo TollApp também está enviando eventos particionados pelo TollId.</span><span class="sxs-lookup"><span data-stu-id="205da-508">Please note that the TollApp application is also sending events partitioned by TollId.</span></span>

## <a name="monitor"></a><span data-ttu-id="205da-509">Monitoramento</span><span class="sxs-lookup"><span data-stu-id="205da-509">Monitor</span></span>
<span data-ttu-id="205da-510">A área **MONITORAR** contém estatísticas sobre o trabalho em execução.</span><span class="sxs-lookup"><span data-stu-id="205da-510">The **MONITOR** area contains statistics about the running job.</span></span> <span data-ttu-id="205da-511">Uma configuração inicial é necessária para usar a conta de armazenamento na mesma região (início do nome como o restante deste documento).</span><span class="sxs-lookup"><span data-stu-id="205da-511">First time configuration is needed to use the storage account in the same region (name toll like the rest of this document).</span></span>   

![Captura de tela do monitor](media/stream-analytics-build-an-iot-solution-using-stream-analytics/monitoring.png)

<span data-ttu-id="205da-513">Você também pode acessar **Logs de Atividade** na área **Configurações** do painel do trabalho.</span><span class="sxs-lookup"><span data-stu-id="205da-513">You can access **Activity Logs** from the job dashboard **Settings** area as well.</span></span>


## <a name="conclusion"></a><span data-ttu-id="205da-514">Conclusão</span><span class="sxs-lookup"><span data-stu-id="205da-514">Conclusion</span></span>
<span data-ttu-id="205da-515">Este tutorial forneceu uma introdução ao serviço Stream Analytics do Azure.</span><span class="sxs-lookup"><span data-stu-id="205da-515">This tutorial introduced you to the Azure Stream Analytics service.</span></span> <span data-ttu-id="205da-516">Ele demonstrou como configurar entradas e saídas para o trabalho do Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="205da-516">It demonstrated how to configure inputs and outputs for the Stream Analytics job.</span></span> <span data-ttu-id="205da-517">Usando o cenário de Dados de Pedágio, o tutorial explicou os tipos comuns de problemas que podem surgir no espaço de dados em movimento e como eles podem ser resolvidos com consultas simples do tipo SQL no Stream Analytics do Azure.</span><span class="sxs-lookup"><span data-stu-id="205da-517">Using the Toll Data scenario, the tutorial explained common types of problems that arise in the space of data in motion and how they can be solved with simple SQL-like queries in Azure Stream Analytics.</span></span> <span data-ttu-id="205da-518">O tutorial descreveu construções de extensão do SQL para trabalhar com os dados temporais.</span><span class="sxs-lookup"><span data-stu-id="205da-518">The tutorial described SQL extension constructs for working with temporal data.</span></span> <span data-ttu-id="205da-519">Ele mostrou como combinar transmissões de dados, como aprimorar a transmissão de dados com os dados de referência estáticos e como escalar horizontalmente uma consulta para aumentar a taxa de transferência.</span><span class="sxs-lookup"><span data-stu-id="205da-519">It showed how to join data streams, how to enrich the data stream with static reference data, and how to scale out a query to achieve higher throughput.</span></span>

<span data-ttu-id="205da-520">Embora este tutorial forneça uma boa introdução, ele não é, de forma alguma, completo.</span><span class="sxs-lookup"><span data-stu-id="205da-520">Although this tutorial provides a good introduction, it is not complete by any means.</span></span> <span data-ttu-id="205da-521">Você pode encontrar mais padrões de consulta usando a linguagem SAQL em [Exemplos de consulta para padrões de uso do Stream Analytics](stream-analytics-stream-analytics-query-patterns.md).</span><span class="sxs-lookup"><span data-stu-id="205da-521">You can find more query patterns using the SAQL language at [Query examples for common Stream Analytics usage patterns](stream-analytics-stream-analytics-query-patterns.md).</span></span>
<span data-ttu-id="205da-522">Consulte a [documentação online](https://azure.microsoft.com/documentation/services/stream-analytics/) para saber mais sobre o Stream Analytics do Azure.</span><span class="sxs-lookup"><span data-stu-id="205da-522">Refer to the [online documentation](https://azure.microsoft.com/documentation/services/stream-analytics/) to learn more about Azure Stream Analytics.</span></span>

## <a name="clean-up-your-azure-account"></a><span data-ttu-id="205da-523">Limpar sua conta do Azure</span><span class="sxs-lookup"><span data-stu-id="205da-523">Clean up your Azure account</span></span>
1. <span data-ttu-id="205da-524">Interrompa o trabalho do Stream Analytics do portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="205da-524">Stop the Stream Analytics job in the Azure portal.</span></span>
   
    <span data-ttu-id="205da-525">O script Setup.ps1 cria dois hubs de eventos e um banco de dados SQL.</span><span class="sxs-lookup"><span data-stu-id="205da-525">The Setup.ps1 script creates two event hubs and a SQL database.</span></span> <span data-ttu-id="205da-526">As instruções a seguir ajudarão você a limpar os recursos no final do tutorial.</span><span class="sxs-lookup"><span data-stu-id="205da-526">The following instructions help you clean up resources at the end of the tutorial.</span></span>
2. <span data-ttu-id="205da-527">Em uma janela do PowerShell, digite **.\\Cleanup.ps1** Isso iniciará o script que exclui os recursos usados no tutorial.</span><span class="sxs-lookup"><span data-stu-id="205da-527">In a PowerShell window, type **.\\Cleanup.ps1** to start the script that deletes resources used in the tutorial.</span></span>
   
   > [!NOTE]
   > <span data-ttu-id="205da-528">Os recursos são identificados pelo nome.</span><span class="sxs-lookup"><span data-stu-id="205da-528">Resources are identified by the name.</span></span> <span data-ttu-id="205da-529">Certifique-se de examinar cuidadosamente cada item antes de confirmar a remoção.</span><span class="sxs-lookup"><span data-stu-id="205da-529">Make sure you carefully review each item before confirming removal.</span></span>
   > 
   > 


