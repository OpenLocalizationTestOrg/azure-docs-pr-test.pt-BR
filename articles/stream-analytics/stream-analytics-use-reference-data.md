---
title: "Usar tabelas de pesquisa e dados de referência no Stream Analytics | Microsoft Docs"
description: "Usar dados de referência em uma consulta do Stream Analytics"
keywords: "tabela de pesquisa, dados de referência"
services: stream-analytics
documentationcenter: 
author: jeffstokes72
manager: jhubbard
editor: cgronlun
ms.assetid: 06103be5-553a-4da1-8a8d-3be9ca2aff54
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 03/28/2017
ms.author: jeffstok
ms.openlocfilehash: 3fd9c869be68d624a59ffb09ee53e31cd5a2f71b
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/29/2017
---
# <a name="using-reference-data-or-lookup-tables-in-a-stream-analytics-input-stream"></a><span data-ttu-id="4b404-104">Usando dados de referência e tabelas de pesquisa em um fluxo de entrada do Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="4b404-104">Using reference data or lookup tables in a Stream Analytics input stream</span></span>
<span data-ttu-id="4b404-105">Dados de referência (também conhecidos como tabela de pesquisa) são um conjunto finito de dados estáticos ou com alteração lenta por natureza, usados para executar uma pesquisa ou para correlacionar com seu fluxo de dados.</span><span class="sxs-lookup"><span data-stu-id="4b404-105">Reference data (also known as a lookup table) is a finite data set that is static or slowing changing in nature, used to perform a lookup or to correlate with your data stream.</span></span> <span data-ttu-id="4b404-106">Para usar dados de referência no seu trabalho do Stream Analytics do Azure geralmente é preciso usar uma [União de dados de referência](https://msdn.microsoft.com/library/azure/dn949258.aspx) em sua Consulta.</span><span class="sxs-lookup"><span data-stu-id="4b404-106">To make use of reference data in your Azure Stream Analytics job, you will generally use a [Reference Data Join](https://msdn.microsoft.com/library/azure/dn949258.aspx) in your Query.</span></span> <span data-ttu-id="4b404-107">O Stream Analytics usa o armazenamento de Blobs do Azure como a camada de armazenamento para dados de referência e com os dados de referência do Azure Data Factory podem ser transformados e/ou copiados para o armazenamento de Blobs do Azure, para uso como dados de referência de [qualquer número armazenamentos de dados de nuvem e locais](../data-factory/data-factory-data-movement-activities.md).</span><span class="sxs-lookup"><span data-stu-id="4b404-107">Stream Analytics uses Azure Blob storage as the storage layer for Reference Data, and with Azure Data Factory reference data can be transformed and/or copied to Azure Blob storage, for use as Reference Data, from [any number of cloud-based and on-premises data stores](../data-factory/data-factory-data-movement-activities.md).</span></span> <span data-ttu-id="4b404-108">Dados de referência são modelados como uma sequência de blobs (definidos na configuração de entrada) em ordem crescente segundo a data/hora especificada no nome do blob.</span><span class="sxs-lookup"><span data-stu-id="4b404-108">Reference data is modeled as a sequence of blobs (defined in the input configuration) in ascending order of the date/time specified in the blob name.</span></span> <span data-ttu-id="4b404-109">Ele **somente** dá suporte à adição ao final da sequência usando um valor de data/hora **maior** que aquele especificado pelo último blob na sequência.</span><span class="sxs-lookup"><span data-stu-id="4b404-109">It **only** supports adding to the end of the sequence by using a date/time **greater** than the one specified by the last blob in the sequence.</span></span>

<span data-ttu-id="4b404-110">O Stream Analytics tem uma **limite de 100 MB por blob** mas trabalhos podem processar vários blobs de referência usando o **padrão de caminho** propriedade.</span><span class="sxs-lookup"><span data-stu-id="4b404-110">Stream Analytics has a **limit of 100 MB per blob** but jobs can process multiple reference blobs by using the **path pattern** property.</span></span>


## <a name="configuring-reference-data"></a><span data-ttu-id="4b404-111">Configurando os dados de referência</span><span class="sxs-lookup"><span data-stu-id="4b404-111">Configuring reference data</span></span>
<span data-ttu-id="4b404-112">Para configurar os dados de referência, você primeiro precisa criar uma entrada que seja do tipo **Dados de Referência**.</span><span class="sxs-lookup"><span data-stu-id="4b404-112">To configure your reference data, you first need to create an input that is of type **Reference Data**.</span></span> <span data-ttu-id="4b404-113">A tabela a seguir explica cada propriedade que você precisará fornecer ao criar os entrada de dados de referência com sua descrição:</span><span class="sxs-lookup"><span data-stu-id="4b404-113">The table below explains each property that you will need to provide while creating the reference data input with its description:</span></span>


<table>
<tbody>
<tr>
<td><span data-ttu-id="4b404-114">Nome da Propriedade</span><span class="sxs-lookup"><span data-stu-id="4b404-114">Property Name</span></span></td>
<td><span data-ttu-id="4b404-115">Descrição</span><span class="sxs-lookup"><span data-stu-id="4b404-115">Description</span></span></td>
</tr>
<tr>
<td><span data-ttu-id="4b404-116">Alias de entrada</span><span class="sxs-lookup"><span data-stu-id="4b404-116">Input Alias</span></span></td>
<td><span data-ttu-id="4b404-117">Um nome amigável que será usado na consulta de trabalho para fazer referência a essa entrada.</span><span class="sxs-lookup"><span data-stu-id="4b404-117">A friendly name that will be used in the job query to reference this input.</span></span></td>
</tr>
<tr>
<td><span data-ttu-id="4b404-118">Conta de armazenamento</span><span class="sxs-lookup"><span data-stu-id="4b404-118">Storage Account</span></span></td>
<td><span data-ttu-id="4b404-119">O nome da conta de armazenamento onde estão localizados os blobs.</span><span class="sxs-lookup"><span data-stu-id="4b404-119">The name of the storage account where your blobs are located.</span></span> <span data-ttu-id="4b404-120">Se estiver na mesma assinatura que o trabalho do Stream Analytics, você pode selecioná-lo na lista suspensa.</span><span class="sxs-lookup"><span data-stu-id="4b404-120">If it’s in the same subscription as your Stream Analytics Job, you can select it from the drop-down.</span></span></td>
</tr>
<tr>
<td><span data-ttu-id="4b404-121">Chave da conta de armazenamento</span><span class="sxs-lookup"><span data-stu-id="4b404-121">Storage Account Key</span></span></td>
<td><span data-ttu-id="4b404-122">A chave secreta associada à conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="4b404-122">The secret key associated with the storage account.</span></span> <span data-ttu-id="4b404-123">É preenchida automaticamente se a conta de armazenamento estiver na mesma assinatura que o trabalho do Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="4b404-123">This gets automatically populated if the storage account is in the same subscription as your Stream Analytics job.</span></span></td>
</tr>
<tr>
<td><span data-ttu-id="4b404-124">Contêiner de armazenamento</span><span class="sxs-lookup"><span data-stu-id="4b404-124">Storage Container</span></span></td>
<td><span data-ttu-id="4b404-125">Os contêineres fornecem um agrupamento lógico de blobs armazenados no serviço Blob do Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="4b404-125">Containers provide a logical grouping for blobs stored in the Microsoft Azure Blob service.</span></span> <span data-ttu-id="4b404-126">Quando você carrega um blob no serviço Blob, você deve especificar um contêiner para aquele blob.</span><span class="sxs-lookup"><span data-stu-id="4b404-126">When you upload a blob to the Blob service, you must specify a container for that blob.</span></span></td>
</tr>
<tr>
<td><span data-ttu-id="4b404-127">Padrão de caminho</span><span class="sxs-lookup"><span data-stu-id="4b404-127">Path Pattern</span></span></td>
<td><span data-ttu-id="4b404-128">O caminho usado para localizar seus blobs no contêiner especificado.</span><span class="sxs-lookup"><span data-stu-id="4b404-128">The path used to locate your blobs within the specified container.</span></span> <span data-ttu-id="4b404-129">No caminho, você pode optar por especificar uma ou mais instâncias das duas variáveis a seguir:</span><span class="sxs-lookup"><span data-stu-id="4b404-129">Within the path, you may choose to specify one or more instances of the following 2 variables:</span></span><BR><span data-ttu-id="4b404-130">{data}, {hora}</span><span class="sxs-lookup"><span data-stu-id="4b404-130">{date}, {time}</span></span><BR><span data-ttu-id="4b404-131">Exemplo 1: products/{data}/{hora}/product-list.csv</span><span class="sxs-lookup"><span data-stu-id="4b404-131">Example 1: products/{date}/{time}/product-list.csv</span></span><BR><span data-ttu-id="4b404-132">Exemplo 2: products/{data}/product-list.csv</span><span class="sxs-lookup"><span data-stu-id="4b404-132">Example 2: products/{date}/product-list.csv</span></span>
</tr>
<tr>
<td><span data-ttu-id="4b404-133">Formato de data [opcional]</span><span class="sxs-lookup"><span data-stu-id="4b404-133">Date Format [optional]</span></span></td>
<td><span data-ttu-id="4b404-134">Se você tiver usado {data} no padrão de caminho que você especificou, você pode selecionar o formato de data no qual os blobs são organizados na lista suspensa de formatos com suporte.</span><span class="sxs-lookup"><span data-stu-id="4b404-134">If you have used {date} within the Path Pattern that you specified, then you can select the date format in which your blobs are organized from the drop-down of supported formats.</span></span><BR><span data-ttu-id="4b404-135">Exemplo: AAAA/MM/DD, MM/DD/AAAA etc.</span><span class="sxs-lookup"><span data-stu-id="4b404-135">Example: YYYY/MM/DD, MM/DD/YYYY, etc.</span></span></td>
</tr>
<tr>
<td><span data-ttu-id="4b404-136">Formato de hora [opcional]</span><span class="sxs-lookup"><span data-stu-id="4b404-136">Time Format [optional]</span></span></td>
<td><span data-ttu-id="4b404-137">Se você tiver usado {hora} no padrão de caminho que você especificou, você pode selecionar o formato de hora no qual os blobs são organizados na lista suspensa de formatos com suporte.</span><span class="sxs-lookup"><span data-stu-id="4b404-137">If you have used {time} within the Path Pattern that you specified, then you can select the time format in which your blobs are organized from the drop-down of supported formats.</span></span><BR><span data-ttu-id="4b404-138">Exemplo: HH, HH/mm ou HH-mm</span><span class="sxs-lookup"><span data-stu-id="4b404-138">Example: HH, HH/mm, or HH-mm</span></span></td>
</tr>
<tr>
<td><span data-ttu-id="4b404-139">Formato de serialização do evento</span><span class="sxs-lookup"><span data-stu-id="4b404-139">Event Serialization Format</span></span></td>
<td><span data-ttu-id="4b404-140">Para verificar se as consultas funcionam da maneira esperada, o Stream Analytics precisa saber qual formato de serialização você está usando para os fluxos de dados de entrada.</span><span class="sxs-lookup"><span data-stu-id="4b404-140">To make sure your queries work the way you expect, Stream Analytics needs to know which serialization format you're using for incoming data streams.</span></span> <span data-ttu-id="4b404-141">Para dados de referência, os formatos com suporte são CSV e JSON.</span><span class="sxs-lookup"><span data-stu-id="4b404-141">For Reference Data, the supported formats are CSV and JSON.</span></span></td>
</tr>
<tr>
<td><span data-ttu-id="4b404-142">Codificação</span><span class="sxs-lookup"><span data-stu-id="4b404-142">Encoding</span></span></td>
<td><span data-ttu-id="4b404-143">UTF-8 é o único formato de codificação com suporte no momento.</span><span class="sxs-lookup"><span data-stu-id="4b404-143">UTF-8 is the only supported encoding format at this time</span></span></td>
</tr>
</tbody>
</table>

## <a name="generating-reference-data-on-a-schedule"></a><span data-ttu-id="4b404-144">Gerar dados de referência em uma agenda</span><span class="sxs-lookup"><span data-stu-id="4b404-144">Generating reference data on a schedule</span></span>
<span data-ttu-id="4b404-145">Se os seus dados de referência são um conjunto de dados de alteração lenta, o suporte para atualização de dados de referência é habilitado especificando, na configuração de entrada, um padrão de caminho usando os tokens de substituição {date} e {time}.</span><span class="sxs-lookup"><span data-stu-id="4b404-145">If your reference data is a slowly changing data set, then support for refreshing reference data is enabled by specifying a path pattern in the input configuration using the {date} and {time} substitution tokens.</span></span> <span data-ttu-id="4b404-146">O Stream Analytics separa as definições de dados de referência baseadas nesse padrão de caminho.</span><span class="sxs-lookup"><span data-stu-id="4b404-146">Stream Analytics picks up the updated reference data definitions based on this path pattern.</span></span> <span data-ttu-id="4b404-147">Por exemplo, um padrão de `sample/{date}/{time}/products.csv` com um formato de data **"AAAA-MM-DD"** e um formato de hora **"HH: mm"** informa o Stream Analytics para acompanhar o blob `sample/2015-04-16/17-30/products.csv` atualizado às 17:30, em 16 de abril de 2015 fuso horário UTC.</span><span class="sxs-lookup"><span data-stu-id="4b404-147">For example, a pattern of `sample/{date}/{time}/products.csv` with a date format of **“YYYY-MM-DD”** and a time format of **“HH-mm”** instructs Stream Analytics to pick up the updated blob `sample/2015-04-16/17-30/products.csv` at 5:30 PM on April 16th, 2015 UTC time zone.</span></span>

> [!NOTE]
> <span data-ttu-id="4b404-148">Atualmente os trabalhos do Stream Analytics procuram pela atualização de blob somente quando a hora do computador avança até a hora codificada no nome do blob.</span><span class="sxs-lookup"><span data-stu-id="4b404-148">Currently Stream Analytics jobs look for the blob refresh only when the machine time advances to the time encoded in the blob name.</span></span> <span data-ttu-id="4b404-149">Por exemplo o trabalho irá procurar `sample/2015-04-16/17-30/products.csv` assim que possível, mas não antes das 17:30 UTC do dia 16 de abril de 2015.</span><span class="sxs-lookup"><span data-stu-id="4b404-149">For example, the job will look for `sample/2015-04-16/17-30/products.csv` as soon as possible but no earlier than 5:30 PM on April 16th, 2015 UTC time zone.</span></span> <span data-ttu-id="4b404-150">Ele *nunca* procurará um blob com uma hora codificada anterior ao último que foi descoberto.</span><span class="sxs-lookup"><span data-stu-id="4b404-150">It will *never* look for a blob with an encoded time earlier than the last one that is discovered.</span></span>
> 
> <span data-ttu-id="4b404-151">Por exemplo</span><span class="sxs-lookup"><span data-stu-id="4b404-151">E.g.</span></span> <span data-ttu-id="4b404-152">Depois que o trabalho localiza o blob `sample/2015-04-16/17-30/products.csv`, ele ignora todos os arquivos com uma data codificada anterior às 17:30 de 16 de abril de 2015. Portanto, se um blob `sample/2015-04-16/17-25/products.csv` atrasado for criado no mesmo contêiner, o trabalho não o usará.</span><span class="sxs-lookup"><span data-stu-id="4b404-152">once the job finds the blob `sample/2015-04-16/17-30/products.csv` it will ignore any files with an encoded date earlier than 5:30 PM April 16th, 2015 so if a late arriving `sample/2015-04-16/17-25/products.csv` blob gets created in the same container the job will not use it.</span></span>
> 
> <span data-ttu-id="4b404-153">Da mesma forma, se `sample/2015-04-16/17-30/products.csv` só é produzido às 22:03 do dia 16 de abril de 2015, mas nenhum blob com uma data anterior está presente no contêiner, o trabalho usa esse arquivo começando às 22:03 do dia 16 de abril de 2015 e usando os dados de referência anteriores.</span><span class="sxs-lookup"><span data-stu-id="4b404-153">Likewise if `sample/2015-04-16/17-30/products.csv` is only produced at 10:03 PM April 16th, 2015 but no blob with an earlier date is present in the container, the job will use this file starting at 10:03 PM April 16th, 2015 and use the previous reference data until then.</span></span>
> 
> <span data-ttu-id="4b404-154">Uma exceção a isso é iniciada quando o trabalho precisa reprocessar dados de volta no tempo ou quando o trabalho é o primeiro a iniciar.</span><span class="sxs-lookup"><span data-stu-id="4b404-154">An exception to this is when the job needs to re-process data back in time or when the job is first started.</span></span> <span data-ttu-id="4b404-155">Na hora de início, o trabalho está procurando o blob mais recente produzido antes da hora especificada de início do trabalho.</span><span class="sxs-lookup"><span data-stu-id="4b404-155">At start time the job is looking for the most recent blob produced before the job start time specified.</span></span> <span data-ttu-id="4b404-156">Isso é feito para garantir que haja um conjunto de dados de referência **não vazio** quando o trabalho é iniciado.</span><span class="sxs-lookup"><span data-stu-id="4b404-156">This is done to ensure that there is a **non-empty** reference data set when the job starts.</span></span> <span data-ttu-id="4b404-157">Se um não for encontrado, o trabalho exibirá o seguinte diagnóstico: `Initializing input without a valid reference data blob for UTC time <start time>`.</span><span class="sxs-lookup"><span data-stu-id="4b404-157">If one cannot be found, the job displays the following diagnostic: `Initializing input without a valid reference data blob for UTC time <start time>`.</span></span>
> 
> 

<span data-ttu-id="4b404-158">[Azure Data Factory](https://azure.microsoft.com/documentation/services/data-factory/) pode ser utilizada para orquestrar a tarefa de criar os blobs atualizados exigidos pelo Stream Analytics para atualizar as definições de dados de referência.</span><span class="sxs-lookup"><span data-stu-id="4b404-158">[Azure Data Factory](https://azure.microsoft.com/documentation/services/data-factory/) can be used to orchestrate the task of creating the updated blobs required by Stream Analytics to update reference data definitions.</span></span> <span data-ttu-id="4b404-159">O Data Factory é um serviço de integração de dados baseado em nuvem que automatiza a movimentação e a transformação dos dados.</span><span class="sxs-lookup"><span data-stu-id="4b404-159">Data Factory is a cloud-based data integration service that orchestrates and automates the movement and transformation of data.</span></span> <span data-ttu-id="4b404-160">O Data Factory dá suporte [à conexão de um grande número de armazenamentos de dados local baseados em nuvem](../data-factory/data-factory-data-movement-activities.md) e mover dados facilmente em um agendamento regular que você especificar.</span><span class="sxs-lookup"><span data-stu-id="4b404-160">Data Factory supports [connecting to a large number of cloud based and on-premises data stores](../data-factory/data-factory-data-movement-activities.md) and moving data easily on a regular schedule that you specify.</span></span> <span data-ttu-id="4b404-161">Para obter mais informações e orientações passo a passo sobre como configurar um pipeline de Data Factory para gerar dados de referência para o Stream Analytics que é atualizado em um cronograma predefinido, confira este [exemplo de GitHub](https://github.com/Azure/Azure-DataFactory/tree/master/Samples/ReferenceDataRefreshForASAJobs).</span><span class="sxs-lookup"><span data-stu-id="4b404-161">For more information and step by step guidance on how to set up a Data Factory pipeline to generate reference data for Stream Analytics which refreshes on a pre-defined schedule, check out this [GitHub sample](https://github.com/Azure/Azure-DataFactory/tree/master/Samples/ReferenceDataRefreshForASAJobs).</span></span>

## <a name="tips-on-refreshing-your-reference-data"></a><span data-ttu-id="4b404-162">Dicas sobre como atualizar seus dados de referência</span><span class="sxs-lookup"><span data-stu-id="4b404-162">Tips on refreshing your reference data</span></span>
1. <span data-ttu-id="4b404-163">Substituir blobs de dados de referência não fará com que o Stream Analytics recarregue o blob e, em alguns casos, isso pode fazer com que o trabalho falhe.</span><span class="sxs-lookup"><span data-stu-id="4b404-163">Overwriting reference data blobs will not cause Stream Analytics to reload the blob and in some cases it can cause the job to fail.</span></span> <span data-ttu-id="4b404-164">A maneira recomendada de alterar os dados de referência é adicionar um novo blob usando o mesmo padrão de caminho e contêiner definidos na entrada de trabalho e usar um valor de data/hora **maior** que o especificado pelo último blob na sequência.</span><span class="sxs-lookup"><span data-stu-id="4b404-164">The recommended way to change reference data is to add a new blob using the same container and path pattern defined in the job input and use a date/time **greater** than the one specified by the last blob in the sequence.</span></span>
2. <span data-ttu-id="4b404-165">Blobs de dados de referência **não** são ordenados pela hora da "Última modificação" do blob, mas apenas pela hora e data especificadas no nome do blob usando as substituições {date} e {time}.</span><span class="sxs-lookup"><span data-stu-id="4b404-165">Reference data blobs are **not** ordered by the blob’s “Last Modified” time but only by the time and date specified in the blob name using the {date} and {time} substitutions.</span></span>
3. <span data-ttu-id="4b404-166">Em algumas ocasiões um trabalho deve voltar no tempo, portanto, blobs de dados de referência não devem ser alterados ou excluídos.</span><span class="sxs-lookup"><span data-stu-id="4b404-166">On a few occasions, a job must go back in time, therefore reference data blobs must not be altered or deleted.</span></span>

## <a name="get-help"></a><span data-ttu-id="4b404-167">Obter ajuda</span><span class="sxs-lookup"><span data-stu-id="4b404-167">Get help</span></span>
<span data-ttu-id="4b404-168">Para obter mais assistência, experimente nosso [Fórum do Stream Analytics do Azure](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics)</span><span class="sxs-lookup"><span data-stu-id="4b404-168">For further assistance, try our [Azure Stream Analytics forum](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics)</span></span>

## <a name="next-steps"></a><span data-ttu-id="4b404-169">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="4b404-169">Next steps</span></span>
<span data-ttu-id="4b404-170">Você foi apresentado ao Stream Analytics, um serviço gerenciado para análise de streaming em dados da Internet das coisas.</span><span class="sxs-lookup"><span data-stu-id="4b404-170">You've been introduced to Stream Analytics, a managed service for streaming analytics on data from the Internet of Things.</span></span> <span data-ttu-id="4b404-171">Para saber mais sobre esse serviço, consulte:</span><span class="sxs-lookup"><span data-stu-id="4b404-171">To learn more about this service, see:</span></span>

* [<span data-ttu-id="4b404-172">Introdução ao uso do Stream Analytics do Azure</span><span class="sxs-lookup"><span data-stu-id="4b404-172">Get started using Azure Stream Analytics</span></span>](stream-analytics-real-time-fraud-detection.md)
* [<span data-ttu-id="4b404-173">Dimensionar trabalhos do Stream Analytics do Azure</span><span class="sxs-lookup"><span data-stu-id="4b404-173">Scale Azure Stream Analytics jobs</span></span>](stream-analytics-scale-jobs.md)
* [<span data-ttu-id="4b404-174">Referência de Linguagem de Consulta do Stream Analytics do Azure</span><span class="sxs-lookup"><span data-stu-id="4b404-174">Azure Stream Analytics Query Language Reference</span></span>](https://msdn.microsoft.com/library/azure/dn834998.aspx)
* [<span data-ttu-id="4b404-175">Referência da API REST do Gerenciamento do Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="4b404-175">Azure Stream Analytics Management REST API Reference</span></span>](https://msdn.microsoft.com/library/azure/dn835031.aspx)

<!--Link references-->
[stream.analytics.developer.guide]: ../stream-analytics-developer-guide.md
[stream.analytics.scale.jobs]: stream-analytics-scale-jobs.md
[stream.analytics.introduction]: stream-analytics-real-time-fraud-detection.md
[stream.analytics.get.started]: stream-analytics-get-started.md
[stream.analytics.query.language.reference]: http://go.microsoft.com/fwlink/?LinkID=513299
[stream.analytics.rest.api.reference]: http://go.microsoft.com/fwlink/?LinkId=517301
