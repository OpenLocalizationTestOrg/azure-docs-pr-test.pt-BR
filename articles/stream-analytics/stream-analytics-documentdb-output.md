---
title: "saída de aaaJSON para análise de fluxo | Microsoft Docs"
description: "Saiba como o Stream Analytics pode direcionar o Azure Cosmos DB para uma saída em JSON, para arquivamento de dados e consultas de baixa latência em dados JSON não estruturados."
keywords: "Saída em JSON"
documentationcenter: 
services: stream-analytics,documentdb
author: samacha
manager: jhubbard
editor: cgronlun
ms.assetid: 5d2a61a6-0dbf-4f1b-80af-60a80eb25dd1
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 03/28/2017
ms.author: samacha
ms.openlocfilehash: fa717818c839ecd7a60fcee33d22011990fd5878
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="target-azure-cosmos-db-for-json-output-from-stream-analytics"></a><span data-ttu-id="8cb2e-104">Direcionar o Azure Cosmos DB para uma saída em JSON no Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="8cb2e-104">Target Azure Cosmos DB for JSON output from Stream Analytics</span></span>
<span data-ttu-id="8cb2e-105">O Stream Analytics pode direcionar o [Azure Cosmos DB](https://azure.microsoft.com/services/documentdb/) para uma saída em JSON, possibilitando o arquivamento de dados e consultas de baixa latência em dados JSON não estruturados.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-105">Stream Analytics can target [Azure Cosmos DB](https://azure.microsoft.com/services/documentdb/) for JSON output, enabling data archiving and low-latency queries on unstructured JSON data.</span></span> <span data-ttu-id="8cb2e-106">Este documento aborda algumas práticas recomendadas para implementar essa configuração.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-106">This document covers some best practices for implementing this configuration.</span></span>

<span data-ttu-id="8cb2e-107">Para aqueles que não estão familiarizados com o banco de dados do Cosmos, dê uma olhada [de aprendizado do Azure Cosmos DB](https://azure.microsoft.com/documentation/learning-paths/documentdb/) tooget iniciado.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-107">For those who are unfamiliar with Cosmos DB, take a look at [Azure Cosmos DB’s learning path](https://azure.microsoft.com/documentation/learning-paths/documentdb/) tooget started.</span></span> 

<span data-ttu-id="8cb2e-108">Observação: atualmente, não há suporte para coleções do Cosmos DB baseados na API do Mongo DB.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-108">Note: Mongo DB API based Cosmos DB collections is currently not supported.</span></span> 

## <a name="basics-of-cosmos-db-as-an-output-target"></a><span data-ttu-id="8cb2e-109">Conceitos básicos do Cosmos DB como um destino de saída</span><span class="sxs-lookup"><span data-stu-id="8cb2e-109">Basics of Cosmos DB as an output target</span></span>
<span data-ttu-id="8cb2e-110">Hello Azure Cosmos DB saída no Stream Analytics permite gravar seu fluxo de processamento de resultados como saída JSON em seu banco de dados do Cosmos collection(s).</span><span class="sxs-lookup"><span data-stu-id="8cb2e-110">hello Azure Cosmos DB output in Stream Analytics enables writing your stream processing results as JSON output into your Cosmos DB collection(s).</span></span> <span data-ttu-id="8cb2e-111">Análise de fluxo não criar coleções no banco de dados, em vez disso, exigindo que você toocreate-los antecipadamente.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-111">Stream Analytics does not create collections in your database, instead requiring you toocreate them upfront.</span></span> <span data-ttu-id="8cb2e-112">Isso é para que os custos de cobrança de saudação de coleções de banco de dados do Cosmos são tooyou transparente e para que você pode ajustar o desempenho de hello, consistência e a capacidade de suas coleções diretamente usando Olá [Cosmos DB APIs](https://msdn.microsoft.com/library/azure/dn781481.aspx).</span><span class="sxs-lookup"><span data-stu-id="8cb2e-112">This is so that hello billing costs of Cosmos DB collections are transparent tooyou, and so that you can tune hello performance, consistency and capacity of your collections directly using hello [Cosmos DB APIs](https://msdn.microsoft.com/library/azure/dn781481.aspx).</span></span> <span data-ttu-id="8cb2e-113">É recomendável usar um banco de dados DB Cosmos por fluxo de trabalho separado de toologically suas coleções para um trabalho de streaming.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-113">We recommend using one Cosmos DB Database per streaming job toologically separate your collections for a streaming job.</span></span>

<span data-ttu-id="8cb2e-114">Algumas das opções de coleção de banco de dados do Cosmos Olá são detalhadas abaixo.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-114">Some of hello Cosmos DB collection options are detailed below.</span></span>

## <a name="tune-consistency-availability-and-latency"></a><span data-ttu-id="8cb2e-115">Ajustar a consistência, a disponibilidade e a latência</span><span class="sxs-lookup"><span data-stu-id="8cb2e-115">Tune consistency, availability, and latency</span></span>
<span data-ttu-id="8cb2e-116">toomatch seus requisitos de aplicativo, banco de dados do Cosmos permite banco de dados do toofine ajustar hello e coleções e verifique prós e contras latência, a disponibilidade e a consistência.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-116">toomatch your application requirements, Cosmos DB allows you toofine tune hello database and collections and make trade-offs between consistency, availability and latency.</span></span> <span data-ttu-id="8cb2e-117">Dependendo dos níveis de consistência de leitura exigidos pelo seu cenário em relação à latência de leitura e de gravação, você poderá escolher um nível de consistência em sua conta de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-117">Depending on what levels of read consistency your scenario needs against read and write latency, you can choose a consistency level on your database account.</span></span> <span data-ttu-id="8cb2e-118">Também por padrão, DB Cosmos permite a indexação síncrona em cada coleção de tooyour operações CRUD.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-118">Also by default, Cosmos DB enables synchronous indexing on each CRUD operation tooyour collection.</span></span> <span data-ttu-id="8cb2e-119">Isso é Olá toocontrol de outra opção útil desempenho no banco de dados do Cosmos de leitura/gravação.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-119">This is another useful option toocontrol hello write/read performance in Cosmos DB.</span></span> <span data-ttu-id="8cb2e-120">Para obter mais informações sobre este tópico, revise Olá [alterar os níveis de consistência do banco de dados e consulta](../documentdb/documentdb-consistency-levels.md) artigo.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-120">For further information on this topic, review hello [change your database and query consistency levels](../documentdb/documentdb-consistency-levels.md) article.</span></span>

## <a name="upserts-from-stream-analytics"></a><span data-ttu-id="8cb2e-121">Inserções e atualizações a partir do Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="8cb2e-121">Upserts from Stream Analytics</span></span>
<span data-ttu-id="8cb2e-122">Integração de análise de fluxo com o banco de dados do Cosmos permite tooinsert ou atualizar registros na sua coleção de banco de dados do Cosmos com base em uma determinada coluna de ID do documento.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-122">Stream Analytics integration with Cosmos DB allows you tooinsert or update records in your Cosmos DB collection based on a given Document ID column.</span></span> <span data-ttu-id="8cb2e-123">Isso também é chamado de tooas um *Upsert*.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-123">This is also referred tooas an *Upsert*.</span></span>

<span data-ttu-id="8cb2e-124">Análise de fluxo utiliza uma abordagem Upsert otimista, onde as atualizações são realizadas somente quando insert falha devido a conflito de ID do documento tooa.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-124">Stream Analytics utilizes an optimistic Upsert approach, where updates are only done when insert fails due tooa Document ID conflict.</span></span> <span data-ttu-id="8cb2e-125">Essa atualização é executada pela análise de fluxo como um PATCH, para que ele permite que o documento de toohello atualizações parciais, ou seja, a adição de novas propriedades ou substituindo que uma propriedade existente é executada de forma incremental.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-125">This update is performed by Stream Analytics as a PATCH, so it enables partial updates toohello document, i.e. addition of new properties or replacing an existing property is performed incrementally.</span></span> <span data-ttu-id="8cb2e-126">Observe que as alterações nos valores de saudação de propriedades de matriz no documento JSON resultarem em todo o array Olá obtendo substituído, ou seja, a matriz Olá não será mesclada.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-126">Note that changes in hello values of array properties in your JSON document result in hello entire array getting overwritten, i.e. hello array is not merged.</span></span>

## <a name="data-partitioning-in-cosmos-db"></a><span data-ttu-id="8cb2e-127">Particionamento de dados no Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="8cb2e-127">Data partitioning in Cosmos DB</span></span>
<span data-ttu-id="8cb2e-128">Cosmos DB [particionada coleções](../cosmos-db/partition-data.md) são Olá recomendado abordagem para particionar seus dados.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-128">Cosmos DB [partitioned collections](../cosmos-db/partition-data.md) are hello recommended approach for partitioning your data.</span></span> 

<span data-ttu-id="8cb2e-129">Para coleções de banco de dados do Cosmos único, análise de fluxo ainda permite que você toopartition seus dados com base em padrões de consulta hello e necessidades de desempenho do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-129">For single Cosmos DB collections, Stream Analytics still allows you toopartition your data based on both hello query patterns and performance needs of your application.</span></span> <span data-ttu-id="8cb2e-130">Cada uma coleção pode conter o too10GB de dados (máximo) e atualmente que não há nenhuma maneira tooscale backup (ou estouro).</span><span class="sxs-lookup"><span data-stu-id="8cb2e-130">Each collection may contain up too10GB of data (maximum) and currently there is no way tooscale up (or overflow) a collection.</span></span> <span data-ttu-id="8cb2e-131">Para dimensionar, o Stream Analytics permite toowrite toomultiple coleções com um prefixo especificado (consulte os detalhes de uso abaixo).</span><span class="sxs-lookup"><span data-stu-id="8cb2e-131">For scaling out, Stream Analytics allows you toowrite toomultiple collections with a given prefix (see usage details below).</span></span> <span data-ttu-id="8cb2e-132">Olá consistente o Stream Analytics usa [Hash partição resolvedor](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.partitioning.hashpartitionresolver.aspx) estratégia baseada em usuário Olá fornecido PartitionKey coluna toopartition seus registros de saída.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-132">Stream Analytics uses hello consistent [Hash Partition Resolver](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.partitioning.hashpartitionresolver.aspx) strategy based on hello user provided PartitionKey column toopartition its output records.</span></span> <span data-ttu-id="8cb2e-133">Olá número de coleções com hello fornecido prefixo na hora de início do trabalho de streaming de saudação é usado como contagem de partições de saída de hello, trabalho de saudação toowhich grava tooin paralelo (coleções de banco de dados do Cosmos = partições de saída).</span><span class="sxs-lookup"><span data-stu-id="8cb2e-133">hello number of collections with hello given prefix at hello streaming job’s start time is used as hello output partition count, toowhich hello job writes tooin parallel (Cosmos DB Collections = Output Partitions).</span></span> <span data-ttu-id="8cb2e-134">Para uma coleção individual com indexação lenta que realiza apenas inserções, é possível esperar uma produtividade de gravação de cerca de 0,4 MB/s.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-134">For a single collection with lazy indexing doing only inserts, about 0.4 MB/s write throughput can be expected.</span></span> <span data-ttu-id="8cb2e-135">Usando várias coleções pode permitir que você tooachieve maior taxa de transferência e o aumento da capacidade.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-135">Using multiple collections can allow you tooachieve higher throughput and increased capacity.</span></span>

<span data-ttu-id="8cb2e-136">Se você pretende tooincrease Olá a contagem de partição no hello futuras, talvez seja necessário toostop seu trabalho, reparticionar Olá dados de suas coleções existentes novas coleções e, em seguida, trabalho de análise de fluxo de saudação reinicialização.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-136">If you intend tooincrease hello partition count in hello future, you may need toostop your job, repartition hello data from your existing collections into new collections and then restart hello Stream Analytics job.</span></span> <span data-ttu-id="8cb2e-137">Incluiremos mais detalhes sobre como usar PartitionResolver e o novo particionamento, junto com um exemplo de código, em uma próxima postagem.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-137">More details on using PartitionResolver and re-partitioning along with sample code, will be included in a follow-up post.</span></span> <span data-ttu-id="8cb2e-138">artigo Olá [particionamento e escala no banco de dados do Cosmos](../documentdb/documentdb-partition-data.md) também fornece detalhes sobre isso.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-138">hello article [Partitioning and scaling in Cosmos DB](../documentdb/documentdb-partition-data.md) also provides details on this.</span></span>

## <a name="cosmos-db-settings-for-json-output"></a><span data-ttu-id="8cb2e-139">Configurações do Cosmos DB para saída em JSON</span><span class="sxs-lookup"><span data-stu-id="8cb2e-139">Cosmos DB settings for JSON output</span></span>
<span data-ttu-id="8cb2e-140">A criação do Cosmos DB como uma saída no Stream Analytics gera uma solicitação de informações, conforme mostrado abaixo.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-140">Creating Cosmos DB as an output in Stream Analytics generates a prompt for information as seen below.</span></span> <span data-ttu-id="8cb2e-141">Esta seção fornece uma explicação da definição de propriedades de saudação.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-141">This section provides an explanation of hello properties definition.</span></span>

<span data-ttu-id="8cb2e-142">Coleção particionada</span><span class="sxs-lookup"><span data-stu-id="8cb2e-142">Partitioned Collection</span></span> | <span data-ttu-id="8cb2e-143">Várias coleções de “partição única”</span><span class="sxs-lookup"><span data-stu-id="8cb2e-143">Multiple “Single Partition” collections</span></span>
---|---
![tela de saída do stream analytics do banco de dados de documentos](media/stream-analytics-documentdb-output/stream-analytics-documentdb-output-1.png) |  ![tela de saída do stream analytics do banco de dados de documentos](media/stream-analytics-documentdb-output/stream-analytics-documentdb-output-2.png)


  
> [!NOTE]
> <span data-ttu-id="8cb2e-146">Olá **várias coleções de "Única partição"** cenário requer uma chave de partição e é uma configuração com suporte.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-146">hello **Multiple “Single Partition” collections** scenario requires a partition key and is a supported configuration.</span></span> 

* <span data-ttu-id="8cb2e-147">**Alias de saída** – um toorefer alias esta saída em sua consulta ASA</span><span class="sxs-lookup"><span data-stu-id="8cb2e-147">**Output Alias** – An alias toorefer this output in your ASA query</span></span>  
* <span data-ttu-id="8cb2e-148">**O nome da conta** – nome hello ou ponto de extremidade URI da saudação conta de banco de dados do Cosmos.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-148">**Account Name** – hello name or endpoint URI of hello Cosmos DB account.</span></span>  
* <span data-ttu-id="8cb2e-149">**Chave de conta** – chave de acesso compartilhado Olá para Olá conta de banco de dados do Cosmos.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-149">**Account Key** – hello shared access key for hello Cosmos DB account.</span></span>  
* <span data-ttu-id="8cb2e-150">**Banco de dados** – nome de banco de dados do banco de dados do Cosmos hello.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-150">**Database** – hello Cosmos DB database name.</span></span>  
* <span data-ttu-id="8cb2e-151">**Padrão de nome** – nome da coleção hello ou seu padrão para Olá coleções toobe usado.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-151">**Collection Name Pattern** – hello collection name or their pattern for hello collections toobe used.</span></span> <span data-ttu-id="8cb2e-152">formato de nome de coleção Olá pode ser construído usando o token {partition} opcional de hello, onde as partições começam do 0.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-152">hello collection name format can be constructed using hello optional {partition} token, where partitions start from 0.</span></span> <span data-ttu-id="8cb2e-153">A seguir estão as entradas válidas de exemplo:</span><span class="sxs-lookup"><span data-stu-id="8cb2e-153">Following are sample valid inputs:</span></span>  
  <span data-ttu-id="8cb2e-154">1\) MyCollection – uma coleção denominada “MyCollection” deve existir.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-154">1\) MyCollection – One collection named “MyCollection” must exist.</span></span>  
  <span data-ttu-id="8cb2e-155">2\) MyCollection{partition} – estas coleções devem existir – "MyCollection0”, “MyCollection1”, “MyCollection2” e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-155">2\) MyCollection{partition} – Such collections must exist– "MyCollection0”, “MyCollection1”, “MyCollection2” and so on.</span></span>  
* <span data-ttu-id="8cb2e-156">**Chave de Partição** — opcional.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-156">**Partition Key** – Optional.</span></span> <span data-ttu-id="8cb2e-157">Isso só será necessário se você estiver usando um token {partition} no seu padrão de nome de coleção.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-157">This is only needed if you are using a {parition} token in your collection name pattern.</span></span> <span data-ttu-id="8cb2e-158">nome de saudação do campo de saudação na saída eventos usados toospecify Olá chave para particionamento de saída por coleções.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-158">hello name of hello field in output events used toospecify hello key for partitioning output across collections.</span></span> <span data-ttu-id="8cb2e-159">Para uma saída de coleção única, nenhuma coluna de saída arbitrária pode ser usada, por exemplo, PartitionId.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-159">For single collection output, any arbitrary output column can be used e.g. PartitionId.</span></span>  
* <span data-ttu-id="8cb2e-160">**ID do Documento** : opcional.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-160">**Document ID** – Optional.</span></span> <span data-ttu-id="8cb2e-161">nome de saudação do campo Olá em eventos de saída usado chave primária de saudação toospecify nas quais insert ou update operações são baseadas.</span><span class="sxs-lookup"><span data-stu-id="8cb2e-161">hello name of hello field in output events used toospecify hello primary key on which insert or update operations are based.</span></span>  
