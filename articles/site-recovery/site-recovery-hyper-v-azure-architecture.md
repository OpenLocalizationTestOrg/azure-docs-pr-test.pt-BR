---
title: "Como funciona a replicação do Hyper-V para o Azure no Site Recovery? | Microsoft Docs"
description: "Este artigo fornece uma visão geral do funcionamento da replicação do Hyper-V no Azure Site Recovery"
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: jwhit
editor: 
ms.assetid: c413efcd-d750-4b22-b34b-15bcaa03934a
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 06/14/2017
ms.author: raynew
ROBOTS: NOINDEX, NOFOLLOW
redirect_url: site-recovery-architecture-hyper-v-to-azure
ms.openlocfilehash: 6fa952af93033f82effdef418903fc93d94dd05c
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="how-does-hyper-v-replication-to-azure-work"></a><span data-ttu-id="bd177-104">Como funciona a replicação do Hyper-V para o Azure?</span><span class="sxs-lookup"><span data-stu-id="bd177-104">How does Hyper-V replication to Azure work?</span></span>

<span data-ttu-id="bd177-105">Leia este artigo para compreender a arquitetura e os fluxos de trabalho de replicação do Hyper-V para o Azure usando o serviço [Azure Site Recovery](site-recovery-overview.md).</span><span class="sxs-lookup"><span data-stu-id="bd177-105">Read this article to understand the architecture and workflows for Hyper-V replication to Azure using the [Azure Site Recovery](site-recovery-overview.md) service.</span></span>

<span data-ttu-id="bd177-106">Poste comentários na parte inferior deste artigo ou no [Fórum de Serviços de Recuperação do Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="bd177-106">Post any comments at the bottom of this article, or in the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>

<span data-ttu-id="bd177-107">Replique o seguinte no Azure:</span><span class="sxs-lookup"><span data-stu-id="bd177-107">You can replicate the following to Azure:</span></span>
- <span data-ttu-id="bd177-108">**Hyper-V com o VMM**: as máquinas virtuais em hosts do Hyper-V local gerenciadas nas nuvens do System Center Virtual MAchine Manager (VMM).</span><span class="sxs-lookup"><span data-stu-id="bd177-108">**Hyper-V with VMM**: VMs located on on-premises Hyper-V hosts managed in  System Center Virtual MAchine Manager (VMM) clouds.</span></span> <span data-ttu-id="bd177-109">Os hosts podem estar executando qualquer [sistema operacional com suporte](site-recovery-support-matrix-to-azure.md#support-for-datacenter-management-servers).</span><span class="sxs-lookup"><span data-stu-id="bd177-109">Hosts can be running any [supported operating system](site-recovery-support-matrix-to-azure.md#support-for-datacenter-management-servers).</span></span> <span data-ttu-id="bd177-110">Replique VMs Hyper-V executando qualquer sistema operacional convidado [com suporte do Hyper-V e do Azure](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows).</span><span class="sxs-lookup"><span data-stu-id="bd177-110">You can replicate Hyper-V VMs running any guest operating system [supported by Hyper-V and Azure](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows).</span></span>
- <span data-ttu-id="bd177-111">**Hyper-V sem o VMM**: VMs locais localizadas nos hosts Hyper-V que não são gerenciadas em nuvens do VMM.</span><span class="sxs-lookup"><span data-stu-id="bd177-111">**Hyper-V without VMM**: On-premises VMs located on Hyper-V hosts that aren't managed in VMM clouds.</span></span> <span data-ttu-id="bd177-112">Os hosts podem executar qualquer um dos [sistemas operacionais com suporte](site-recovery-support-matrix-to-azure.md#support-for-replicated-machine-os-versions).</span><span class="sxs-lookup"><span data-stu-id="bd177-112">Hosts can run any of the [supported operating systems](site-recovery-support-matrix-to-azure.md#support-for-replicated-machine-os-versions).</span></span> <span data-ttu-id="bd177-113">Replique VMs Hyper-V executando qualquer sistema operacional convidado [com suporte do Hyper-V e do Azure](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows).</span><span class="sxs-lookup"><span data-stu-id="bd177-113">You can replicate Hyper-V VMs running any guest operating system [supported by Hyper-V and Azure](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows).</span></span>


## <a name="architectural-components"></a><span data-ttu-id="bd177-114">Componentes de arquitetura</span><span class="sxs-lookup"><span data-stu-id="bd177-114">Architectural components</span></span>

<span data-ttu-id="bd177-115">**Área**</span><span class="sxs-lookup"><span data-stu-id="bd177-115">**Area**</span></span> | <span data-ttu-id="bd177-116">**Componente**</span><span class="sxs-lookup"><span data-stu-id="bd177-116">**Component**</span></span> | <span data-ttu-id="bd177-117">**Detalhes**</span><span class="sxs-lookup"><span data-stu-id="bd177-117">**Details**</span></span>
--- | --- | ---
<span data-ttu-id="bd177-118">**As tabelas**</span><span class="sxs-lookup"><span data-stu-id="bd177-118">**Azure**</span></span> | <span data-ttu-id="bd177-119">No Azure, você precisa de uma conta do Microsoft Azure, uma conta de armazenamento do Azure e uma rede do Azure.</span><span class="sxs-lookup"><span data-stu-id="bd177-119">In Azure you need a Microsoft Azure account, an Azure storage account, and a Azure network.</span></span> | <span data-ttu-id="bd177-120">O armazenamento e a rede podem ser contas baseadas no Gerenciador de Recursos ou clássicas.</span><span class="sxs-lookup"><span data-stu-id="bd177-120">Storage and network can be Resource Manager-based, or classic accounts.</span></span><br/><br/> <span data-ttu-id="bd177-121">Os dados replicados são armazenados na conta de armazenamento, e VMs do Azure são criadas com os dados replicados quando ocorre failover do site local.</span><span class="sxs-lookup"><span data-stu-id="bd177-121">Replicated data is stored in the storage account, and Azure VMs are created with the replicated data when failover from your on-premises site occurs.</span></span><br/><br/> <span data-ttu-id="bd177-122">As VMs do Azure se conectam à rede virtual do Azure quando são criadas.</span><span class="sxs-lookup"><span data-stu-id="bd177-122">The Azure VMs connect to the Azure virtual network when they're created.</span></span>
<span data-ttu-id="bd177-123">**Servidor VMM**</span><span class="sxs-lookup"><span data-stu-id="bd177-123">**VMM server**</span></span> | <span data-ttu-id="bd177-124">Hosts Hyper-V localizados em nuvens do VMM</span><span class="sxs-lookup"><span data-stu-id="bd177-124">Hyper-V hosts located in VMM clouds</span></span> | <span data-ttu-id="bd177-125">Se os hosts Hyper-V forem gerenciados em nuvens do VMM, registre o servidor VMM no cofre dos Serviços de Recuperação.</span><span class="sxs-lookup"><span data-stu-id="bd177-125">If Hyper-V hosts are managed in VMM clouds, you register the VMM server in the Recovery Services vault.</span></span><br/><br/> <span data-ttu-id="bd177-126">No servidor do VMM, instale o Provedor de Site Recovery para orquestrar a replicação com o Azure.</span><span class="sxs-lookup"><span data-stu-id="bd177-126">On the VMM server you install the Site Recovery Provider to orchestrate replication with Azure.</span></span><br/><br/> <span data-ttu-id="bd177-127">Você precisa de redes lógicas e de VM configuradas para definir o mapeamento de rede.</span><span class="sxs-lookup"><span data-stu-id="bd177-127">You need logical and VM networks set up to configure network mapping.</span></span> <span data-ttu-id="bd177-128">Uma rede de VM deve ser vinculada a uma rede lógica associada à nuvem.</span><span class="sxs-lookup"><span data-stu-id="bd177-128">A VM network should be linked to a logical network that's associated with the cloud.</span></span>
<span data-ttu-id="bd177-129">**Host Hyper-V**</span><span class="sxs-lookup"><span data-stu-id="bd177-129">**Hyper-V host**</span></span> | <span data-ttu-id="bd177-130">Os servidores Hyper-V podem ser implantados com ou sem o servidor do VMM.</span><span class="sxs-lookup"><span data-stu-id="bd177-130">Hyper-V servers can be deployed with or without VMM server.</span></span> | <span data-ttu-id="bd177-131">Se não houver um servidor VMM, o Provedor de Site Recovery será instalado no host para orquestrar a replicação com o Site Recovery pela internet.</span><span class="sxs-lookup"><span data-stu-id="bd177-131">If there's no VMM server, the Site Recovery Provider is installed on the host to orchestrate replication with Site Recovery over the internet.</span></span> <span data-ttu-id="bd177-132">Se houver um servidor VMM, o Provedor será instalado nele, e não no host.</span><span class="sxs-lookup"><span data-stu-id="bd177-132">If there's a VMM server, the Provider is installed on it, and not on the host.</span></span><br/><br/> <span data-ttu-id="bd177-133">O agente dos Serviços de Recuperação é instalado no host para lidar com a replicação de dados.</span><span class="sxs-lookup"><span data-stu-id="bd177-133">The Recovery Services agent is installed on the host to handle data replication.</span></span><br/><br/> <span data-ttu-id="bd177-134">As comunicações do provedor e do agente são protegidas e criptografadas.</span><span class="sxs-lookup"><span data-stu-id="bd177-134">Communications from both the Provider and the agent are secure and encrypted.</span></span> <span data-ttu-id="bd177-135">Os dados replicados no armazenamento do Azure também são criptografados.</span><span class="sxs-lookup"><span data-stu-id="bd177-135">Replicated data in Azure storage is also encrypted.</span></span>
<span data-ttu-id="bd177-136">**VMs Hyper-V**</span><span class="sxs-lookup"><span data-stu-id="bd177-136">**Hyper-V VMs**</span></span> | <span data-ttu-id="bd177-137">Você precisa de uma ou mais VMs no servidor de host Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="bd177-137">You need one or more VMs on the Hyper-V host server.</span></span> | <span data-ttu-id="bd177-138">Nada precisa ser explicitamente instalado em VMs</span><span class="sxs-lookup"><span data-stu-id="bd177-138">Nothing needs to explicitly installed on VMs</span></span>

## <a name="deployment-steps"></a><span data-ttu-id="bd177-139">Etapas de implantação.</span><span class="sxs-lookup"><span data-stu-id="bd177-139">Deployment steps</span></span>

1. <span data-ttu-id="bd177-140">**Azure**: configure os componentes do Azure.</span><span class="sxs-lookup"><span data-stu-id="bd177-140">**Azure**: You set up the Azure components.</span></span> <span data-ttu-id="bd177-141">Recomendamos que você configure as contas de armazenamento e rede antes de começar a implantação da Recuperação de Site.</span><span class="sxs-lookup"><span data-stu-id="bd177-141">We recommend you set up storage and network accounts before you begin Site Recovery deployment.</span></span>
2. <span data-ttu-id="bd177-142">**Cofre**: crie um cofre de Serviços de Recuperação para o Site Recovery e defina configurações de cofre, inclusive as configurações de origem e destino, configuração de uma política de replicação e habilitando a replicação.</span><span class="sxs-lookup"><span data-stu-id="bd177-142">**Vault**: You create a Recovery Services vault for Site Recovery, and configure vault settings, including configuring source and target settings, setting up a replication policy, and enabling replication.</span></span>
3. <span data-ttu-id="bd177-143">**Origem e destino**:</span><span class="sxs-lookup"><span data-stu-id="bd177-143">**Source and target**:</span></span>
    - <span data-ttu-id="bd177-144">**Hosts do Hyper-V em nuvens do VMM**: como parte da especificação de configurações de origem, você pode baixar e instalar o Provedor do Azure Site Recovery no servidor do VMM e o agente de Serviços de Recuperação do Azure em cada host Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="bd177-144">**Hyper-V hosts in VMM clouds**: As part of specifying source settings, you download and install the Azure Site Recovery Provider on the VMM server, and the Azure Recovery Services agent on each Hyper-V host.</span></span> <span data-ttu-id="bd177-145">A origem será o servidor do VMM.</span><span class="sxs-lookup"><span data-stu-id="bd177-145">The source will be the VMM server.</span></span> <span data-ttu-id="bd177-146">O destino é o Azure.</span><span class="sxs-lookup"><span data-stu-id="bd177-146">The target is Azure.</span></span>
    - <span data-ttu-id="bd177-147">Hosts do Hyper-V sem o VMM: ao especificar as configurações de origem, você baixa e instala o Provedor e o agente em cada host Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="bd177-147">Hyper-V hosts without VMM: When you specify source settings, you download and install the Provider and agent on each Hyper-V host.</span></span> <span data-ttu-id="bd177-148">Durante a implantação você reune os hosts em um site do Hyper-V e especifica este site como a origem.</span><span class="sxs-lookup"><span data-stu-id="bd177-148">During deployment you gather the hosts into a Hyper-V site, and specify this site as the source.</span></span> <span data-ttu-id="bd177-149">O destino é o Azure.</span><span class="sxs-lookup"><span data-stu-id="bd177-149">The target is Azure.</span></span>

    <span data-ttu-id="bd177-150">![Replicação do Hyper-V/VMM para o Azure](./media/site-recovery-components/arch-onprem-onprem-azure-vmm.png) ![replicação de site do Hyper-V para o Azure](./media/site-recovery-components/arch-onprem-azure-hypervsite.png)</span><span class="sxs-lookup"><span data-stu-id="bd177-150">![Hyper-V/VMM replication to Azure](./media/site-recovery-components/arch-onprem-onprem-azure-vmm.png) ![Hyper-V site replication to Azure](./media/site-recovery-components/arch-onprem-azure-hypervsite.png)</span></span>


4. <span data-ttu-id="bd177-151">**Política de replicação**: crie uma política de replicação para o site do Hyper-V ou a nuvem do VMM.</span><span class="sxs-lookup"><span data-stu-id="bd177-151">**Replication policy**: You create a replication policy for the Hyper-V site or VMM cloud.</span></span> <span data-ttu-id="bd177-152">A política é aplicada a todas as VMs localizadas nos hosts na nuvem ou no site.</span><span class="sxs-lookup"><span data-stu-id="bd177-152">The policy is applied to all VMs located on hosts in the site or cloud.</span></span>
5. <span data-ttu-id="bd177-153">**Habilitar replicação**: habilite a replicação para máquinas virtuais do Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="bd177-153">**Enable replication**: You enable replication for Hyper-V VMs.</span></span> <span data-ttu-id="bd177-154">A replicação inicial ocorre de acordo com as configurações de política de replicação.</span><span class="sxs-lookup"><span data-stu-id="bd177-154">Initial replication occurs in accordance with the replication policy settings.</span></span> <span data-ttu-id="bd177-155">As alterações de dados são acompanhadas, e a replicação de alterações delta para o Azure começa após a replicação inicial terminar.</span><span class="sxs-lookup"><span data-stu-id="bd177-155">Data changes are tracked, and replication of delta changes to Azure begins after the initial replication finishes.</span></span> <span data-ttu-id="bd177-156">As alterações acompanhadas para um item são mantidas em um arquivo .hrl.</span><span class="sxs-lookup"><span data-stu-id="bd177-156">Tracked changes for an item are held in a .hrl file.</span></span>
6. <span data-ttu-id="bd177-157">**Failover de teste**: execute um failover de teste para verificar se tudo está funcionando conforme o esperado.</span><span class="sxs-lookup"><span data-stu-id="bd177-157">**Test failover**:  You run a test failover to make sure everything's working as expected.</span></span>

<span data-ttu-id="bd177-158">Saiba mais sobre a implantação:</span><span class="sxs-lookup"><span data-stu-id="bd177-158">Learn more about deployment:</span></span>
- [<span data-ttu-id="bd177-159">Introdução à replicação de máquinas virtuais do Hyper-V para o Azure - com VMM</span><span class="sxs-lookup"><span data-stu-id="bd177-159">Get started with Hyper-V VM replication to Azure - with VMM</span></span>](site-recovery-vmm-to-azure.md)
- [<span data-ttu-id="bd177-160">Introdução à replicação de máquinas virtuais do Hyper-V para o Azure - sem VMM</span><span class="sxs-lookup"><span data-stu-id="bd177-160">Get started with Hyper-V VM replication to Azure - without VMM</span></span>](site-recovery-hyper-v-site-to-azure.md)

## <a name="hyper-v-replication-workflow"></a><span data-ttu-id="bd177-161">Fluxo de trabalho de replicação do Hyper-V</span><span class="sxs-lookup"><span data-stu-id="bd177-161">Hyper-V replication workflow</span></span>

### <a name="enable-protection"></a><span data-ttu-id="bd177-162">Habilitar proteção</span><span class="sxs-lookup"><span data-stu-id="bd177-162">Enable protection</span></span>

1. <span data-ttu-id="bd177-163">Depois de habilitar a proteção para uma máquina virtual do Hyper-V, no portal do Azure ou no local, a opção **Habilitar proteção** é iniciada.</span><span class="sxs-lookup"><span data-stu-id="bd177-163">After you enable protection for a Hyper-V VM, in the Azure portal or on-premises, the **Enable protection** starts.</span></span>
2. <span data-ttu-id="bd177-164">O trabalho verifica se o computador está em conformidade com os pré-requisitos antes de invocar [CreateReplicationRelationship](https://msdn.microsoft.com/library/hh850036.aspx) para configurar a replicação com as configurações definidas por você.</span><span class="sxs-lookup"><span data-stu-id="bd177-164">The job checks that the machine complies with prerequisites, before invoking the [CreateReplicationRelationship](https://msdn.microsoft.com/library/hh850036.aspx), to set up replication with the settings you've configured.</span></span>
3. <span data-ttu-id="bd177-165">O trabalho é iniciado com a replicação inicial, invocando o método [StartReplication](https://msdn.microsoft.com/library/hh850303.aspx), para inicializar uma replicação completa de VM e enviar os discos virtuais da VM no Azure.</span><span class="sxs-lookup"><span data-stu-id="bd177-165">The job starts initial replication by invoking the [StartReplication](https://msdn.microsoft.com/library/hh850303.aspx) method, to initialize a full VM replication, and send the VM's virtual disks to Azure.</span></span>
4. <span data-ttu-id="bd177-166">Você pode monitorar o trabalho na guia **Trabalhos** .</span><span class="sxs-lookup"><span data-stu-id="bd177-166">You can monitor the job in the **Jobs** tab.</span></span>
        <span data-ttu-id="bd177-167">![Lista de trabalhos](media/site-recovery-hyper-v-azure-architecture/image1.png) ![Habilitar busca detalhada da proteção](media/site-recovery-hyper-v-azure-architecture/image2.png)</span><span class="sxs-lookup"><span data-stu-id="bd177-167">![Jobs list](media/site-recovery-hyper-v-azure-architecture/image1.png) ![Enable protection drill down](media/site-recovery-hyper-v-azure-architecture/image2.png)</span></span>

### <a name="initial-replication"></a><span data-ttu-id="bd177-168">Replicação inicial</span><span class="sxs-lookup"><span data-stu-id="bd177-168">Initial replication</span></span>

1. <span data-ttu-id="bd177-169">Um [Instantâneo da VM do Hyper-V](https://technet.microsoft.com/library/dd560637.aspx) é tirado quando a replicação inicial é disparada.</span><span class="sxs-lookup"><span data-stu-id="bd177-169">A [Hyper-V VM snapshot](https://technet.microsoft.com/library/dd560637.aspx) snapshot is taken when initial replication is triggered.</span></span>
2. <span data-ttu-id="bd177-170">Discos rígidos virtuais são replicadas individualmente até que eles sejam copiados para o Azure.</span><span class="sxs-lookup"><span data-stu-id="bd177-170">Virtual hard disks are replicated one by one until they're all copied to Azure.</span></span> <span data-ttu-id="bd177-171">Ele pode demorar um pouco, dependendo do tamanho da VM e largura de banda de rede.</span><span class="sxs-lookup"><span data-stu-id="bd177-171">It could take a while, depending on the VM size, and network bandwidth.</span></span> <span data-ttu-id="bd177-172">Para otimizar o uso da rede, veja [Como gerenciar o uso de largura de banda de rede da proteção local do Azure](https://support.microsoft.com/kb/3056159).</span><span class="sxs-lookup"><span data-stu-id="bd177-172">To optimize your network usage, see [How to manage on-premises to Azure protection network bandwidth usage](https://support.microsoft.com/kb/3056159).</span></span>
3. <span data-ttu-id="bd177-173">Se houver alterações no disco durante a replicação inicial, o Controlador de Replicação de Réplica do Hyper-V mostrará essas alterações em Logs de Replicação do Hyper-V (.hrl).</span><span class="sxs-lookup"><span data-stu-id="bd177-173">If disk changes occur while initial replication is in progress, the Hyper-V Replica Replication Tracker tracks those changes as Hyper-V Replication Logs (.hrl).</span></span> <span data-ttu-id="bd177-174">Esses arquivos estão localizados na mesma pasta dos discos.</span><span class="sxs-lookup"><span data-stu-id="bd177-174">These files are located in the same folder as the disks.</span></span> <span data-ttu-id="bd177-175">Cada disco tem um arquivo .hrl associado que será enviado ao armazenamento secundário.</span><span class="sxs-lookup"><span data-stu-id="bd177-175">Each disk has an associated .hrl file that will be sent to secondary storage.</span></span>
4. <span data-ttu-id="bd177-176">O instantâneo e os arquivos de log consomem recursos de disco durante a replicação inicial.</span><span class="sxs-lookup"><span data-stu-id="bd177-176">The snapshot and log files consume disk resources while initial replication is in progress.</span></span>
5. <span data-ttu-id="bd177-177">Quando a replicação inicial termina, o instantâneo de VM é excluído.</span><span class="sxs-lookup"><span data-stu-id="bd177-177">When the initial replication finishes, the VM snapshot is deleted.</span></span> <span data-ttu-id="bd177-178">As alterações de disco delta no log são sincronizadas e mescladas para o disco pai.</span><span class="sxs-lookup"><span data-stu-id="bd177-178">Delta disk changes in the log are synchronized and merged to the parent disk.</span></span>


### <a name="finalize-protection"></a><span data-ttu-id="bd177-179">Finalizar proteção</span><span class="sxs-lookup"><span data-stu-id="bd177-179">Finalize protection</span></span>

1. <span data-ttu-id="bd177-180">Após a conclusão da replicação inicial, o trabalho **Finalizar proteção na máquina virtual** definirá outras configurações de rede e pós-replicação para que a máquina virtual fique protegida.</span><span class="sxs-lookup"><span data-stu-id="bd177-180">After the initial replication finishes, the **Finalize protection on the virtual machine** job configures network and other post-replication settings, so that the virtual machine is protected.</span></span>
    <span data-ttu-id="bd177-181">![Finalizar trabalho de proteção](media/site-recovery-hyper-v-azure-architecture/image3.png)</span><span class="sxs-lookup"><span data-stu-id="bd177-181">![Finalize protection job](media/site-recovery-hyper-v-azure-architecture/image3.png)</span></span>
2. <span data-ttu-id="bd177-182">Se você estiver replicando no Azure, talvez seja necessário ajustar as configurações para a máquina virtual de modo que ela fique pronta para o failover.</span><span class="sxs-lookup"><span data-stu-id="bd177-182">If you're replicating to Azure, you might need to tweak the settings for the virtual machine so that it's ready for failover.</span></span> <span data-ttu-id="bd177-183">Aqui você já pode executar um failover de teste para verificar se tudo está funcionando conforme o esperado.</span><span class="sxs-lookup"><span data-stu-id="bd177-183">At this point you can run a test failover to check everything is working as expected.</span></span>

### <a name="delta-replication"></a><span data-ttu-id="bd177-184">Replicação delta</span><span class="sxs-lookup"><span data-stu-id="bd177-184">Delta replication</span></span>

1. <span data-ttu-id="bd177-185">Após a replicação inicial, a sincronização delta se inicia, de acordo com as configurações de replicação.</span><span class="sxs-lookup"><span data-stu-id="bd177-185">After the initial replication, delta synchronization begins, in accordance with replication settings.</span></span>
2. <span data-ttu-id="bd177-186">O Controlador de Replicação de Réplica do Hyper-V rastreia as alterações em um disco rígido virtual como arquivos. hrl.</span><span class="sxs-lookup"><span data-stu-id="bd177-186">The Hyper-V Replica Replication Tracker tracks the changes to a virtual hard disk as .hrl files.</span></span> <span data-ttu-id="bd177-187">Cada disco configurado para a replicação tem um arquivo .hrl associado.</span><span class="sxs-lookup"><span data-stu-id="bd177-187">Each disk that's configured for replication has an associated .hrl file.</span></span> <span data-ttu-id="bd177-188">Esses logs são enviados para a conta de armazenamento do cliente após a conclusão da replicação inicial.</span><span class="sxs-lookup"><span data-stu-id="bd177-188">This log is sent to the customer's storage account after initial replication is complete.</span></span> <span data-ttu-id="bd177-189">Quando um log está em trânsito para o Azure, as alterações no disco primário são rastreadas em outro arquivo de log no mesmo diretório.</span><span class="sxs-lookup"><span data-stu-id="bd177-189">When a log is in transit to Azure, the changes in the primary disk are tracked in another log file, in the same directory.</span></span>
3. <span data-ttu-id="bd177-190">Durante a replicação inicial e delta, você pode monitorar a VM na exibição da VM.</span><span class="sxs-lookup"><span data-stu-id="bd177-190">During initial and delta replication, you can monitor the VM in the VM view.</span></span> <span data-ttu-id="bd177-191">[Saiba mais](site-recovery-monitoring-and-troubleshooting.md#monitor-replication-health-for-virtual-machines).</span><span class="sxs-lookup"><span data-stu-id="bd177-191">[Learn more](site-recovery-monitoring-and-troubleshooting.md#monitor-replication-health-for-virtual-machines).</span></span>  

### <a name="replication-synchronization"></a><span data-ttu-id="bd177-192">Sincronização de replicação</span><span class="sxs-lookup"><span data-stu-id="bd177-192">Replication synchronization</span></span>

1. <span data-ttu-id="bd177-193">Se a replicação delta falhar, e uma replicação completa for dispendiosa em termos de largura de banda ou tempo, a VM fica marcada para ressincronização.</span><span class="sxs-lookup"><span data-stu-id="bd177-193">If delta replication fails, and a full replication would be costly in terms of bandwidth or time, then a VM is marked for resynchronization.</span></span> <span data-ttu-id="bd177-194">Por exemplo, se os arquivos .hrl alcançarem 50% do tamanho do disco, a VM será marcada para ressincronização.</span><span class="sxs-lookup"><span data-stu-id="bd177-194">For example, if the .hrl files reach 50% of the disk size, then the VM will be marked for resynchronization.</span></span>
2.  <span data-ttu-id="bd177-195">A ressincronização minimiza a quantidade de dados enviados, calculando as somas de verificação das máquinas virtuais de origem e de destino e enviando apenas os dados de delta.</span><span class="sxs-lookup"><span data-stu-id="bd177-195">Resynchronization minimizes the amount of data sent by computing checksums of the source and target virtual machines, and sending only the delta data.</span></span> <span data-ttu-id="bd177-196">A ressincronização usa um algoritmo de agrupamento de bloco fixo em que os arquivos de origem e destino são divididos em partes fixas.</span><span class="sxs-lookup"><span data-stu-id="bd177-196">Resynchronization uses a fixed-block chunking algorithm where source and target files are divided into fixed chunks.</span></span> <span data-ttu-id="bd177-197">As somas de verificação para cada bloco são geradas e comparadas para determinar quais blocos da origem precisam ser aplicados ao destino.</span><span class="sxs-lookup"><span data-stu-id="bd177-197">Checksums for each chunk are generated and then compared to determine which blocks from the source need to be applied to the target.</span></span>
3. <span data-ttu-id="bd177-198">Após a conclusão da ressincronização, a replicação delta normal deverá ser retomada.</span><span class="sxs-lookup"><span data-stu-id="bd177-198">After resynchronization finishes, normal delta replication should resume.</span></span> <span data-ttu-id="bd177-199">Por padrão a ressincronização está agendada para execução automática fora do expediente, mas você pode ressincronizar uma máquina virtual manualmente.</span><span class="sxs-lookup"><span data-stu-id="bd177-199">By default resynchronization is scheduled to run automatically outside office hours, but you can resynchronize a virtual machine manually.</span></span> <span data-ttu-id="bd177-200">Por exemplo, se ocorrer uma interrupção da rede ou outra interrupção qualquer, você poderá retomar a ressincronização.</span><span class="sxs-lookup"><span data-stu-id="bd177-200">For example, you can resume resynchronization if a network outage or another outage occurs.</span></span> <span data-ttu-id="bd177-201">Para fazer isso, selecione a máquina virtual no portal > **Ressincronizar**.</span><span class="sxs-lookup"><span data-stu-id="bd177-201">To do this, select the VM in the portal > **Resynchronize**.</span></span>

    ![Ressincronização manual](media/site-recovery-hyper-v-azure-architecture/image4.png)


### <a name="retries"></a><span data-ttu-id="bd177-203">Novas tentativas</span><span class="sxs-lookup"><span data-stu-id="bd177-203">Retries</span></span>

<span data-ttu-id="bd177-204">Se um erro de replicação ocorrer, haverá uma repetição interna.</span><span class="sxs-lookup"><span data-stu-id="bd177-204">If a replication error occurs, there's a built-in retry.</span></span> <span data-ttu-id="bd177-205">Ela pode ser classificada em duas categorias:</span><span class="sxs-lookup"><span data-stu-id="bd177-205">This logic can be classified into two categories:</span></span>

<span data-ttu-id="bd177-206">**Categoria**</span><span class="sxs-lookup"><span data-stu-id="bd177-206">**Category**</span></span> | <span data-ttu-id="bd177-207">**Detalhes**</span><span class="sxs-lookup"><span data-stu-id="bd177-207">**Details**</span></span>
--- | ---
<span data-ttu-id="bd177-208">**Erros não recuperáveis**</span><span class="sxs-lookup"><span data-stu-id="bd177-208">**Non-recoverable errors**</span></span> | <span data-ttu-id="bd177-209">Nenhuma nova tentativa é feita.</span><span class="sxs-lookup"><span data-stu-id="bd177-209">No retry is attempted.</span></span> <span data-ttu-id="bd177-210">O status da VM será **Crítico** e há necessidade de intervenção do administrador.</span><span class="sxs-lookup"><span data-stu-id="bd177-210">VM status will be **Critical**, and administrator intervention is required.</span></span> <span data-ttu-id="bd177-211">Exemplos desses erros incluem: cadeia VHD quebrada; Estado inválido para a VM de réplica; Erros de autenticação de rede: erros de autorização; A VM não encontrou erros (para servidores do Hyper-V autônomo)</span><span class="sxs-lookup"><span data-stu-id="bd177-211">Examples of these errors include: broken VHD chain; Invalid state for the replica VM; Network authentication errors: authorization errors; VM not found errors (for standalone Hyper-V servers)</span></span>
<span data-ttu-id="bd177-212">**Erros recuperáveis**</span><span class="sxs-lookup"><span data-stu-id="bd177-212">**Recoverable errors**</span></span> | <span data-ttu-id="bd177-213">Novas tentativas ocorrem a cada intervalo da replicação usando de modo exponencial a retirada, o que aumenta o intervalo de repetição desde o início da primeira tentativa por 1, 2, 4, 8 e 10 minutos.</span><span class="sxs-lookup"><span data-stu-id="bd177-213">Retries occur every replication interval, using an exponential back-off that increases the retry interval from the start of the first attempt by 1, 2, 4, 8, and 10 minutes.</span></span> <span data-ttu-id="bd177-214">Se o erro persistir, repita a operação a cada 30 minutos.</span><span class="sxs-lookup"><span data-stu-id="bd177-214">If an error persists, retry every 30 minutes.</span></span> <span data-ttu-id="bd177-215">Os exemplos incluem: erros da rede; erros de pouco espaço em disco; condições de memória insuficiente</span><span class="sxs-lookup"><span data-stu-id="bd177-215">Examples include: network errors; low disk  errors; low memory conditions</span></span> |

## <a name="protection-and-recovery-lifecycle"></a><span data-ttu-id="bd177-216">Proteção e ciclo de vida de recuperação</span><span class="sxs-lookup"><span data-stu-id="bd177-216">Protection and recovery lifecycle</span></span>

![fluxo de trabalho](./media/site-recovery-components/arch-hyperv-azure-workflow.png)

## <a name="next-steps"></a><span data-ttu-id="bd177-218">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="bd177-218">Next steps</span></span>

- [<span data-ttu-id="bd177-219">Verificar pré-requisitos da implantação</span><span class="sxs-lookup"><span data-stu-id="bd177-219">Check deployment prerequisites</span></span>](site-recovery-prereq.md)
- <span data-ttu-id="bd177-220">Solucionar problemas com:</span><span class="sxs-lookup"><span data-stu-id="bd177-220">Troubleshoot with:</span></span>
    - [<span data-ttu-id="bd177-221">Monitorar e solucionar problemas de proteção</span><span class="sxs-lookup"><span data-stu-id="bd177-221">Monitor and troubleshoot protection</span></span>](site-recovery-monitoring-and-troubleshooting.md)
    - [<span data-ttu-id="bd177-222">Ajuda do suporte da Microsoft</span><span class="sxs-lookup"><span data-stu-id="bd177-222">Help from Microsoft support</span></span>](site-recovery-monitoring-and-troubleshooting.md#reach-out-for-microsoft-support)
    - [<span data-ttu-id="bd177-223">Erros comuns e resoluções</span><span class="sxs-lookup"><span data-stu-id="bd177-223">Common errors and resolutions</span></span>](site-recovery-monitoring-and-troubleshooting.md#common-azure-site-recovery-errors-and-their-resolutions)
