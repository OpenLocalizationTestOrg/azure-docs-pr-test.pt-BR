---
title: "Replicar um aplicativo Web baseado em IIS de várias camadas usando o Azure Site Recovery | Microsoft Docs"
description: "Este artigo descreve como replicar máquinas de virtuais de um farm da Web do IIS usando o Azure Site Recovery."
services: site-recovery
documentationcenter: 
author: nsoneji
manager: gauravd
editor: 
ms.assetid: 
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/11/2017
ms.author: nisoneji
ms.openlocfilehash: 4ac79df703de00ac009d9845772d8be740e74f29
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/18/2017
---
# <a name="replicate-a-multi-tier-iis-based-web-application-using-azure-site-recovery"></a><span data-ttu-id="4e6b6-103">Replicar um aplicativo Web baseado em IIS de várias camadas usando o Azure Site Recovery</span><span class="sxs-lookup"><span data-stu-id="4e6b6-103">Replicate a multi-tier IIS based web application using Azure Site Recovery</span></span>

## <a name="overview"></a><span data-ttu-id="4e6b6-104">Visão geral</span><span class="sxs-lookup"><span data-stu-id="4e6b6-104">Overview</span></span>


<span data-ttu-id="4e6b6-105">Software de aplicativo é o motor da produtividade comercial em uma organização.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-105">Application software is the engine of business productivity in an organization.</span></span> <span data-ttu-id="4e6b6-106">Vários aplicativos Web podem servir para propósitos diferentes em uma organização.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-106">Various web applications can serve different purposes in an organization.</span></span> <span data-ttu-id="4e6b6-107">Alguns deles, como processamento de folha de pagamento, aplicativos financeiros e sites voltados para o cliente podem ser essenciais para uma organização.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-107">Some of these like payroll processing, financial applications and customer facing websites can be utmost critical for an organization.</span></span> <span data-ttu-id="4e6b6-108">É importante que a organização os tenha sempre em execução para evitar a perda de produtividade e, acima de tudo, evitar danos à imagem da marca da organização.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-108">It will be important for the organization to have them up and running at all times to prevent loss of productivity and more importantly prevent any damage to the brand image of the organization.</span></span>

<span data-ttu-id="4e6b6-109">Os aplicativos Web críticos normalmente são configurados como aplicativos de várias camadas, com a Web, o banco de dados e o aplicativo em camadas diferentes.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-109">Critical web applications are typically set up as multi-tier applications with the web, database and application on different tiers.</span></span> <span data-ttu-id="4e6b6-110">Além do serem espalhados em várias camadas, os aplicativos também podem usar vários servidores em cada camada a fim de balancear o tráfego.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-110">Apart from being spread across various tiers, the applications may also be using multiple servers in each tier to load balance the traffic.</span></span> <span data-ttu-id="4e6b6-111">Além disso, os mapeamentos entre várias camadas e no servidor Web podem ter base em endereços IP estáticos.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-111">Moreover, the mappings between various tiers and on the web server may be based on static IP addresses.</span></span> <span data-ttu-id="4e6b6-112">Durante o failover, será necessário atualizar alguns desses mapeamentos, especialmente se houver vários sites configurados no servidor da Web.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-112">On failover, some of these mappings will need to be updated, especially, if you have multiple websites configured on the web server.</span></span> <span data-ttu-id="4e6b6-113">No caso de aplicativos Web que usam SSL, será necessário atualizar as associações de certificado.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-113">In case of web applications using SSL, certificate bindings will need to be updated.</span></span>

<span data-ttu-id="4e6b6-114">Os métodos tradicionais de recuperação sem base na replicação envolvem o backup de vários arquivos de configuração, configurações do Registro, associações, componentes personalizados (COM ou .NET), conteúdo e também certificados e recuperação dos arquivos por meio de um conjunto de etapas manuais.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-114">Traditional non-replication based recovery methods involve backing up of various configuration files, registry settings, bindings, custom components (COM or .NET), content and also certificates and recovering the files through a set of manual steps.</span></span> <span data-ttu-id="4e6b6-115">Está claro que essas técnicas são inconvenientes, propensas a erros e não escalonáveis.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-115">These techniques are clearly cumbersome, error prone and not scalable.</span></span> <span data-ttu-id="4e6b6-116">É possível, por exemplo, que você se esqueça facilmente de fazer backup de certificados e acabe ficando sem outra opção além de comprar novos certificados para o servidor após o failover.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-116">It is, for example, easily possible for you to forget backing up certificates and be left with no choice but to buy new certificates for the server after failover.</span></span>

<span data-ttu-id="4e6b6-117">Uma boa solução de recuperação de desastres deve permitir a modelagem de planos de recuperação em torno das arquiteturas de aplicativo complexas indicadas acima, e também tem a capacidade de adicionar etapas personalizadas para lidar com mapeamentos de aplicativo entre as várias camadas, fornecendo uma solução certeira acionada com um único clique no caso de um desastre resultar em um RTO inferior.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-117">A good disaster recovery solution, should allow modeling of recovery plans around the above complex application architectures and also have the ability to add customized steps to handle application mappings between various tiers hence providing a single-click sure shot solution in the event of a disaster leading to a lower RTO.</span></span>


<span data-ttu-id="4e6b6-118">Este artigo descreve como proteger um aplicativo Web baseado em IIS usando o [Azure Site Recovery](site-recovery-overview.md).</span><span class="sxs-lookup"><span data-stu-id="4e6b6-118">This article describes how to protect an IIS based web application using a [Azure Site Recovery](site-recovery-overview.md).</span></span> <span data-ttu-id="4e6b6-119">Este artigo abordará as práticas recomendadas para a replicação de um aplicativo Web baseado em IIS no Azure, como você pode fazer uma análise de recuperação de desastres e como é possível realizar o failover do aplicativo no Azure.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-119">This article will cover best practices for replicating a three tier IIS based web application to Azure, how you can do a disaster recovery drill, and how you can failover the application to Azure.</span></span>


## <a name="prerequisites"></a><span data-ttu-id="4e6b6-120">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="4e6b6-120">Prerequisites</span></span>

<span data-ttu-id="4e6b6-121">Antes de começar, você precisa entender o seguinte:</span><span class="sxs-lookup"><span data-stu-id="4e6b6-121">Before you start, make sure you understand the following:</span></span>

1. [<span data-ttu-id="4e6b6-122">Replicar uma máquina virtual no Azure</span><span class="sxs-lookup"><span data-stu-id="4e6b6-122">Replicating a virtual machine to Azure</span></span>](site-recovery-vmware-to-azure.md)
1. <span data-ttu-id="4e6b6-123">Como [criar uma rede de recuperação](site-recovery-network-design.md)</span><span class="sxs-lookup"><span data-stu-id="4e6b6-123">How to [design a recovery network](site-recovery-network-design.md)</span></span>
1. [<span data-ttu-id="4e6b6-124">Executar um failover de teste no Azure</span><span class="sxs-lookup"><span data-stu-id="4e6b6-124">Doing a test failover to Azure</span></span>](./site-recovery-test-failover-to-azure.md)
1. [<span data-ttu-id="4e6b6-125">Executar um failover no Azure</span><span class="sxs-lookup"><span data-stu-id="4e6b6-125">Doing a failover to Azure</span></span>](site-recovery-failover.md)
1. <span data-ttu-id="4e6b6-126">Como [replicar um controlador de domínio](site-recovery-active-directory.md)</span><span class="sxs-lookup"><span data-stu-id="4e6b6-126">How to [replicate a domain controller](site-recovery-active-directory.md)</span></span>
1. <span data-ttu-id="4e6b6-127">Como [replicar o SQL Server](site-recovery-sql.md)</span><span class="sxs-lookup"><span data-stu-id="4e6b6-127">How to [replicate SQL Server](site-recovery-sql.md)</span></span>

## <a name="deployment-patterns"></a><span data-ttu-id="4e6b6-128">Padrões de implantação</span><span class="sxs-lookup"><span data-stu-id="4e6b6-128">Deployment patterns</span></span>
<span data-ttu-id="4e6b6-129">Um aplicativo Web baseado no IIS normalmente segue um destes padrões de implantação:</span><span class="sxs-lookup"><span data-stu-id="4e6b6-129">An IIS based web application typically follows one of the following deployment patterns:</span></span>

<span data-ttu-id="4e6b6-130">**Padrão de implantação 1** Um farm da Web baseado no IIS com ARR (Application Request Routing), o Servidor IIS e o Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-130">**Deployment pattern 1 ** An IIS based web farm  with Application Request Routing(ARR), IIS Server and Microsoft SQL Server.</span></span>

![Padrão de implantação](./media/site-recovery-iis/deployment-pattern1.png)

<span data-ttu-id="4e6b6-132">**Padrão de implantação 2** Um farm da Web baseado no IIS com ARR (Application Request Routing), o Servidor IIS, Servidor de Aplicativos e o Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-132">**Deployment pattern 2** An IIS based web farm with Application Request Routing(ARR), IIS Server, Application Server, and Microsoft SQL Server.</span></span>


![Padrão de implantação](./media/site-recovery-iis/deployment-pattern2.png)

## <a name="site-recovery-support"></a><span data-ttu-id="4e6b6-134">Suporte do Site Recovery</span><span class="sxs-lookup"><span data-stu-id="4e6b6-134">Site Recovery support</span></span>

<span data-ttu-id="4e6b6-135">Para a criação deste artigo, usamos as máquinas virtuais VMware com o Servidor IIS versão 7.5 no Windows Server 2012 R2 Enterprise.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-135">For the purpose of creating this article VMware virtual machines with IIS Server version 7.5 on Windows Server 2012 R2 Enterprise were used.</span></span> <span data-ttu-id="4e6b6-136">Como a replicação de recuperação do site é independente do aplicativo, as recomendações fornecidas aqui devem servir para os seguintes cenários, bem como para uma versão diferente do IIS.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-136">As site recovery replication is application agnostic, the recommendations provided here are expected to hold on following scenarios as well and for different version of IIS.</span></span>

### <a name="source-and-target"></a><span data-ttu-id="4e6b6-137">Origem e destino</span><span class="sxs-lookup"><span data-stu-id="4e6b6-137">Source and target</span></span>

<span data-ttu-id="4e6b6-138">**Cenário**</span><span class="sxs-lookup"><span data-stu-id="4e6b6-138">**Scenario**</span></span> | <span data-ttu-id="4e6b6-139">**Para um site secundário**</span><span class="sxs-lookup"><span data-stu-id="4e6b6-139">**To a secondary site**</span></span> | <span data-ttu-id="4e6b6-140">**Para o Azure**</span><span class="sxs-lookup"><span data-stu-id="4e6b6-140">**To Azure**</span></span>
--- | --- | ---
<span data-ttu-id="4e6b6-141">**Hyper-V**</span><span class="sxs-lookup"><span data-stu-id="4e6b6-141">**Hyper-V**</span></span> | <span data-ttu-id="4e6b6-142">Sim</span><span class="sxs-lookup"><span data-stu-id="4e6b6-142">Yes</span></span> | <span data-ttu-id="4e6b6-143">Sim</span><span class="sxs-lookup"><span data-stu-id="4e6b6-143">Yes</span></span>
<span data-ttu-id="4e6b6-144">**VMware**</span><span class="sxs-lookup"><span data-stu-id="4e6b6-144">**VMware**</span></span> | <span data-ttu-id="4e6b6-145">Sim</span><span class="sxs-lookup"><span data-stu-id="4e6b6-145">Yes</span></span> | <span data-ttu-id="4e6b6-146">Sim</span><span class="sxs-lookup"><span data-stu-id="4e6b6-146">Yes</span></span>
<span data-ttu-id="4e6b6-147">**Servidor físico**</span><span class="sxs-lookup"><span data-stu-id="4e6b6-147">**Physical server**</span></span> | <span data-ttu-id="4e6b6-148">Não</span><span class="sxs-lookup"><span data-stu-id="4e6b6-148">No</span></span> | <span data-ttu-id="4e6b6-149">Sim</span><span class="sxs-lookup"><span data-stu-id="4e6b6-149">Yes</span></span>

## <a name="replicate-virtual-machines"></a><span data-ttu-id="4e6b6-150">Replicar máquinas virtuais</span><span class="sxs-lookup"><span data-stu-id="4e6b6-150">Replicate virtual machines</span></span>

<span data-ttu-id="4e6b6-151">Siga [este guia](site-recovery-vmware-to-azure.md) para começar a replicar todas as máquinas virtuais do farm da Web do IIS no Azure.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-151">Follow [this guidance](site-recovery-vmware-to-azure.md) to start replicating all the IIS web farm virtual machines to Azure.</span></span>

<span data-ttu-id="4e6b6-152">Se você estiver usando um IP estático, especifique o IP que você deseja usar na máquina virtual na configuração [**IP de Destino**](./site-recovery-replicate-vmware-to-azure.md#view-and-manage-vm-properties), nas configurações de Rede e Computação.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-152">If you are using a static IP then specify the IP that you want the virtual machine to take in the [**Target IP**](./site-recovery-replicate-vmware-to-azure.md#view-and-manage-vm-properties) setting in Compute and Network settings.</span></span>

![IP de Destino](./media/site-recovery-active-directory/dns-target-ip.png)


## <a name="creating-a-recovery-plan"></a><span data-ttu-id="4e6b6-154">Criar um plano de recuperação</span><span class="sxs-lookup"><span data-stu-id="4e6b6-154">Creating a recovery plan</span></span>

<span data-ttu-id="4e6b6-155">Um plano de recuperação permite o sequenciamento do failover de várias camadas em um aplicativo de várias camadas, mantendo assim a consistência do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-155">A recovery plan allows sequencing the failover of various tiers in a multi-tier application, hence, maintaining application consistency.</span></span> <span data-ttu-id="4e6b6-156">Execute as etapas abaixo ao criar um plano de recuperação para um aplicativo Web de várias camadas.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-156">Follow the below steps while creating a recovery plan for a multi-tier web application.</span></span>  <span data-ttu-id="4e6b6-157">[Saiba mais sobre a criação de um plano de recuperação](./site-recovery-create-recovery-plans.md).</span><span class="sxs-lookup"><span data-stu-id="4e6b6-157">[Learn more about creating a recovery plan](./site-recovery-create-recovery-plans.md).</span></span>

### <a name="adding-virtual-machines-to-failover-groups"></a><span data-ttu-id="4e6b6-158">Adicionar máquinas virtuais aos grupos de failover</span><span class="sxs-lookup"><span data-stu-id="4e6b6-158">Adding virtual machines to failover groups</span></span>
<span data-ttu-id="4e6b6-159">Um aplicativo Web comum do IIS de várias camadas será formado por uma camada de banco de dados com máquinas virtuais SQL, pela camada da Web composta por um Servidor IIS, e uma camada de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-159">A typical multi-tier IIS web application will consist of a database tier with SQL virtual machines, the web tier constituted by a IIS server and an application tier.</span></span> <span data-ttu-id="4e6b6-160">Adicione todas essas máquinas virtuais a outro grupo com base na camada abaixo.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-160">Add all these virtual machines to different group based on tier as below.</span></span> <span data-ttu-id="4e6b6-161">[Saiba mais sobre como personalizar o plano de recuperação](site-recovery-runbook-automation.md#customize-the-recovery-plan).</span><span class="sxs-lookup"><span data-stu-id="4e6b6-161">[Learn more about customising recovery plan](site-recovery-runbook-automation.md#customize-the-recovery-plan).</span></span>

1. <span data-ttu-id="4e6b6-162">Crie um plano de recuperação.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-162">Create a recovery plan.</span></span> <span data-ttu-id="4e6b6-163">Adicione as máquinas virtuais da camada de banco de dados ao Grupo 1 para garantir que elas sejam encerradas por último e ativadas primeiro.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-163">Add the database tier virtual machines under Group 1 to ensure that they are shutdown last and brought up first.</span></span>

1. <span data-ttu-id="4e6b6-164">Adicione as máquinas virtuais de camada de aplicativo ao Grupo 2, para que elas sejam acionadas após o acionamento da camada de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-164">Add the application tier virtual machines under Group 2 such that they are brought up after the database tier has been brought up.</span></span>

1. <span data-ttu-id="4e6b6-165">Adicione as máquinas virtuais de camada da Web ao Grupo 3, para que elas sejam acionadas após o acionamento da camada de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-165">Add the web tier virtual machines in Group 3 such that they are brought up after the application tier has been brought up.</span></span>

1. <span data-ttu-id="4e6b6-166">Adicione as máquinas virtuais de balanceamento de carga ao Grupo 4, para que elas sejam acionadas após o acionamento da camada da Web.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-166">Add load balance virtual machines in Group 4 such that they are brought up after the web tier has been brought up.</span></span>


### <a name="adding-scripts-to-the-recovery-plan"></a><span data-ttu-id="4e6b6-167">Adicionar scripts ao plano de recuperação</span><span class="sxs-lookup"><span data-stu-id="4e6b6-167">Adding scripts to the recovery plan</span></span>
<span data-ttu-id="4e6b6-168">Talvez seja necessário fazer algumas operações nas máquinas virtuais do Azure após o failover/teste de failover a fim de fazer o farm da Web do IIS funcionar corretamente.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-168">You may need to do some operations on the Azure virtual machines post failover/Test failover to make IIS web farm function correctly.</span></span> <span data-ttu-id="4e6b6-169">Automatize a operação pós-failover, como a atualização da entrada DNS, alteração da associação de site, alteração na cadeia de conexão, adicionando scripts correspondentes no plano de recuperação, conforme mostrado a seguir.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-169">You can automate the post failover operation like updating DNS entry, changing site binding, change  in connection string  by adding corresponding scripts in the recovery plan as below.</span></span> <span data-ttu-id="4e6b6-170">[Saiba mais sobre como adicionar script ao plano de recuperação](./site-recovery-create-recovery-plans.md#add-scripts).</span><span class="sxs-lookup"><span data-stu-id="4e6b6-170">[Learn more about add script recovery plan](./site-recovery-create-recovery-plans.md#add-scripts).</span></span>

#### <a name="dns-update"></a><span data-ttu-id="4e6b6-171">Atualização de DNS</span><span class="sxs-lookup"><span data-stu-id="4e6b6-171">DNS Update</span></span>
<span data-ttu-id="4e6b6-172">Se o DNS estiver configurado para atualização dinâmica de DNS, as máquinas virtuais normalmente atualizarão o DNS com o novo IP quando forem iniciadas.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-172">If the DNS is configured for dynamic DNS update then virtual machines usually update the DNS with the new IP once they start.</span></span> <span data-ttu-id="4e6b6-173">Se você quiser adicionar uma etapa explícita para atualizar o DNS com os novos IPs das máquinas virtuais, adicione este [script para atualizar o IP no DNS](https://aka.ms/asr-dns-update) como uma ação posterior nos grupos de plano de recuperação.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-173">If you want to add an explicit step to update DNS with the new IPs of the virtual machines then add this [script to update IP in DNS](https://aka.ms/asr-dns-update) as a post action on recovery plan groups.</span></span>  

#### <a name="connection-string-in-an-applications-webconfig"></a><span data-ttu-id="4e6b6-174">Cadeia de conexão no web.config do aplicativo</span><span class="sxs-lookup"><span data-stu-id="4e6b6-174">Connection string in an application’s web.config</span></span>
<span data-ttu-id="4e6b6-175">A cadeia de conexão especifica o banco de dados com o qual o banco de dados se comunica.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-175">The connection string specifies the database that the web site communicates with.</span></span>

<span data-ttu-id="4e6b6-176">Se a cadeia de conexão levar o nome da máquina virtual do banco de dados, nenhuma outra etapa será necessária após o failover, e o aplicativo será capaz de se comunicar automaticamente com o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-176">If the connection string carries the name of the database virtual machine, no further steps will be needed post failover and the application will be able to automatically communicate to the DB.</span></span> <span data-ttu-id="4e6b6-177">Além disso, se o endereço IP da máquina virtual do banco de dados for mantido, ele não será necessário para atualizar a cadeia de conexão.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-177">Also, if the IP address for the database virtual machine is retained, it will not be needed to update the connection string.</span></span> <span data-ttu-id="4e6b6-178">Se a cadeia de conexão se referir à máquina virtual do banco de dados usando um endereço IP, será necessário atualizá-lo após o failover.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-178">If the connection string refers to the database virtual machine using an IP address, it will need to be updated post failover.</span></span> <span data-ttu-id="4e6b6-179">Por exemplo</span><span class="sxs-lookup"><span data-stu-id="4e6b6-179">E.g.</span></span> <span data-ttu-id="4e6b6-180">a cadeia de conexão abaixo aponta para o banco de dados com IP 127.0.1.2</span><span class="sxs-lookup"><span data-stu-id="4e6b6-180">the below connection string points to the DB with IP 127.0.1.2</span></span>

        <?xml version="1.0" encoding="utf-8"?>
        <configuration>
        <connectionStrings>
        <add name="ConnStringDb1" connectionString="Data Source= 127.0.1.2\SqlExpress; Initial Catalog=TestDB1;Integrated Security=False;" />
        </connectionStrings>
        </configuration>

<span data-ttu-id="4e6b6-181">Atualize a cadeia de conexão na camada da Web adicionando o [script de atualização de conexão do IIS](https://aka.ms/asr-update-webtier-script-classic) após o Grupo 3 no plano de recuperação.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-181">You can update the connection string in web tier by adding [IIS connection update script](https://aka.ms/asr-update-webtier-script-classic) after Group 3 in the recovery plan.</span></span>

#### <a name="site-bindings-for-the-application"></a><span data-ttu-id="4e6b6-182">Associações de site para o aplicativo</span><span class="sxs-lookup"><span data-stu-id="4e6b6-182">Site bindings for the application</span></span>
<span data-ttu-id="4e6b6-183">Cada site é composto por informações de associação que incluem o tipo de associação, o endereço IP no qual o servidor IIS escuta as solicitações para o site, o número da porta e os nomes de host do site.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-183">Every site consists of binding information that includes the type of binding, the IP address at which the IIS server listens to the requests for the site, the port number and the host names for the site.</span></span> <span data-ttu-id="4e6b6-184">No momento de um failover, talvez seja necessário atualizar essas associações se houver uma alteração no endereço IP associado a elas.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-184">At the time of a failover, these bindings might need to be updated if there is a change in the IP address associated with them.</span></span>

> [!NOTE]
>
> <span data-ttu-id="4e6b6-185">Se você tiver marcado 'todos não atribuídos' para a associação de site, como no exemplo a seguir, não será necessário atualizar essa associação após o failover.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-185">If you have marked ‘all unassigned’ for the site binding as in the example below, you will not need to update this binding post failover.</span></span> <span data-ttu-id="4e6b6-186">Além disso, se o endereço IP associado a um site não for alterado após o failover, não será necessário atualizar a associação do site (a retenção do endereço IP depende da arquitetura de rede e das sub-redes atribuídas aos sites primário e de recuperação e, assim, pode ou não ser viável para a sua organização.)</span><span class="sxs-lookup"><span data-stu-id="4e6b6-186">Also, if the IP address associated with a site is not changed post failover, the site binding need not be updated (Retention of the IP address depends on the network architecture and subnets assigned to the primary and recovery sites and hence may or may not be feasible for your organization.)</span></span>

![Associação de SSL](./media/site-recovery-iis/sslbinding.png)

<span data-ttu-id="4e6b6-188">Se você tiver associado o endereço IP a um site, será necessário atualizar todas as associações de site com o novo endereço IP.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-188">If you have associated the IP address with a site, you will need to update all site bindings with the new IP address.</span></span> <span data-ttu-id="4e6b6-189">Adicione o [script de atualização da camada da Web do IIS](https://aka.ms/asr-web-tier-update-runbook-classic) após o Grupo 3 no plano de recuperação para alterar as associações de site.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-189">You can add [IIS Web tier update script](https://aka.ms/asr-web-tier-update-runbook-classic) after Group 3 in recovery plan to change the site bindings.</span></span>


#### <a name="update-load-balancer-ip-address"></a><span data-ttu-id="4e6b6-190">Atualizar o endereço IP do balanceador de carga</span><span class="sxs-lookup"><span data-stu-id="4e6b6-190">Update load balancer IP address</span></span>
<span data-ttu-id="4e6b6-191">Se você tiver uma máquina virtual com Application Request Routing, adicione o [script de failover de ARR do IIS](https://aka.ms/asr-iis-arrtier-failover-script-classic) após o Grupo 4 para atualizar o endereço IP.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-191">If you have  Application Request Routing virtual machine, add [IIS ARR  failover script](https://aka.ms/asr-iis-arrtier-failover-script-classic) after Group 4 to update the IP address.</span></span>

#### <a name="the-ssl-cert-binding-for-an-https-connection"></a><span data-ttu-id="4e6b6-192">A associação de certificados SSL para uma conexão https</span><span class="sxs-lookup"><span data-stu-id="4e6b6-192">The SSL cert binding for an https connection</span></span>
<span data-ttu-id="4e6b6-193">Os sites podem ter um certificado SSL associado que ajuda a garantir uma comunicação segura entre o servidor Web e o navegador do usuário.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-193">Websites can have an associated SSL certificate that helps in ensuring a secure communication between the webserver and the user’s browser.</span></span> <span data-ttu-id="4e6b6-194">Se o site tiver uma conexão https e uma associação de site https associada ao endereço IP do servidor IIS com uma associação de certificado SSL, será necessário adicionar uma nova associação de site ao certificado com o IP da máquina virtual do IIS após o failover.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-194">If the website has an https connection and an associated https site binding to the IP address of the IIS server with an SSL cert binding, a new site binding will need to be added for the cert with the IP of the IIS virtual machine post failover.</span></span>

<span data-ttu-id="4e6b6-195">O certificado SSL pode ser executado:</span><span class="sxs-lookup"><span data-stu-id="4e6b6-195">The SSL cert can be issued against-</span></span>

<span data-ttu-id="4e6b6-196">a) No nome de domínio totalmente qualificado do site</span><span class="sxs-lookup"><span data-stu-id="4e6b6-196">a) The fully qualified domain name of the website</span></span><br>
<span data-ttu-id="4e6b6-197">b) No nome do servidor</span><span class="sxs-lookup"><span data-stu-id="4e6b6-197">b) The name of the server</span></span><br>
<span data-ttu-id="4e6b6-198">c) Em um certificado curinga para o nome de domínio</span><span class="sxs-lookup"><span data-stu-id="4e6b6-198">c) A wildcard certificate for the domain name</span></span><br>
<span data-ttu-id="4e6b6-199">d) Em um endereço IP – Se o certificado SSL for emitido para o IP do servidor IIS, outro certificado SSL deverá ser emitido para o endereço IP do servidor IIS no site do Azure, e será necessário criar uma associação SSL adicional para esse certificado.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-199">d) An IP address – If the SSL cert is issued against the IP of the IIS server, another SSL cert needs to be issued against the IP address of the IIS server on the Azure site and an additional SSL binding for this certificate will need to be created.</span></span> <span data-ttu-id="4e6b6-200">Portanto, não aconselhamos o uso de um certificado SSL emitido com base no IP.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-200">Hence, it is advisable to not use an SSL cert issued against IP.</span></span> <span data-ttu-id="4e6b6-201">Essa é uma opção menos usada e em breve será substituída de acordo com as novas alterações na CA/fórum do navegador.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-201">This is a less widely used option and will soon be deprecated as per new CA/browser forum changes.</span></span>

#### <a name="update-the-dependency-between-the-web-and-the-application-tier"></a><span data-ttu-id="4e6b6-202">Atualizar a dependência entre a camada da Web e de aplicativo</span><span class="sxs-lookup"><span data-stu-id="4e6b6-202">Update the dependency between the web and the application tier</span></span>
<span data-ttu-id="4e6b6-203">Se você tiver uma dependência específica do aplicativo com base no endereço IP das máquinas virtuais, será necessário atualizar essa dependência após o failover.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-203">If you have an application specific dependency based on the IP address of the virtual machines, you need to update this dependency post failover.</span></span>

## <a name="doing-a-test-failover"></a><span data-ttu-id="4e6b6-204">Executar um failover de teste</span><span class="sxs-lookup"><span data-stu-id="4e6b6-204">Doing a test failover</span></span>
<span data-ttu-id="4e6b6-205">Siga [este guia](site-recovery-test-failover-to-azure.md) fazer um failover de teste.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-205">Follow [this guidance](site-recovery-test-failover-to-azure.md) to do a test failover.</span></span>

1.  <span data-ttu-id="4e6b6-206">Acesse o Portal do Azure e selecione seu cofre do Serviço de Recuperação.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-206">Go to Azure portal and select your Recovery Service vault.</span></span>
1.  <span data-ttu-id="4e6b6-207">Clique no plano de recuperação criado para o farm da Web do IIS.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-207">Click on the recovery plan created for IIS web farm.</span></span>
1.  <span data-ttu-id="4e6b6-208">Clique em 'Failover de Teste'.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-208">Click on 'Test Failover'.</span></span>
1.  <span data-ttu-id="4e6b6-209">Selecione o ponto e recuperação e a rede virtual do Azure para iniciar o processo de failover de teste.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-209">Select recovery point and Azure virtual network to start the test failover process.</span></span>
1.  <span data-ttu-id="4e6b6-210">Quando o ambiente secundário estiver funcionando, você poderá executar sua validações.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-210">Once the secondary environment is up, you can perform your validations.</span></span>
1.  <span data-ttu-id="4e6b6-211">Após a conclusão das validações, selecione 'Validações concluídas', e o ambiente do failover de teste será limpo.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-211">Once the validations are complete, you can select ‘Validations complete’ and the test failover environment will be cleaned.</span></span>

## <a name="doing-a-failover"></a><span data-ttu-id="4e6b6-212">Executar um failover</span><span class="sxs-lookup"><span data-stu-id="4e6b6-212">Doing a failover</span></span>
<span data-ttu-id="4e6b6-213">Siga [este guia](site-recovery-failover.md) quando estiver realizando um failover.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-213">Follow [this guidance](site-recovery-failover.md) when you are doing a failover.</span></span>

1.  <span data-ttu-id="4e6b6-214">Acesse o Portal do Azure e selecione seu cofre do Serviço de Recuperação.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-214">Go to Azure portal and select your Recovery Service vault.</span></span>
1.  <span data-ttu-id="4e6b6-215">Clique no plano de recuperação criado para o farm da Web do IIS.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-215">Click on the recovery plan created for IIS web farm.</span></span>
1.  <span data-ttu-id="4e6b6-216">Clique em 'Failover'.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-216">Click on 'Failover'.</span></span>
1.  <span data-ttu-id="4e6b6-217">Selecione o ponto de recuperação para iniciar o processo de failover.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-217">Select recovery point to start the failover process.</span></span>

## <a name="next-steps"></a><span data-ttu-id="4e6b6-218">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="4e6b6-218">Next steps</span></span>
<span data-ttu-id="4e6b6-219">Saiba mais sobre [replicar outros aplicativos](site-recovery-workload.md) usando o Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="4e6b6-219">You can learn more about [replicate other applications](site-recovery-workload.md) using Site Recovery.</span></span>
