---
title: "Preparar recursos do VMware locais para replicação no Azure com o Azure Site Recovery | Microsoft Docs"
description: "Resume as etapas necessárias para replicar as cargas de trabalho em execução em VMs VMware no armazenamento do Azure"
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: 6aba0e89-ad7c-467e-9db2-cfb3bfe4c7d6
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/27/2017
ms.author: raynew
ms.openlocfilehash: 3e1c589030210c2eae1ad9c02811775d9d6365d4
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/18/2017
---
# <a name="step-6-prepare-on-premises-vmware-replication-to-azure"></a><span data-ttu-id="150cb-103">Etapa 6: Preparar a replicação da VMware local para o Azure</span><span class="sxs-lookup"><span data-stu-id="150cb-103">Step 6: Prepare on-premises VMware replication to Azure</span></span>

<span data-ttu-id="150cb-104">Use as instruções neste artigo para preparar servidores VMware locais para interagir com o Azure Site Recovery e preparar as máquinas virtuais VMWare para a instalação do serviço Mobilidade.</span><span class="sxs-lookup"><span data-stu-id="150cb-104">Use the instructions in this article to prepare on-premises VMware servers to interact with Azure Site Recovery, and prepare VMWare VMs for installation of the Mobility service.</span></span> <span data-ttu-id="150cb-105">O agente de serviço Mobilidade deve ser instalado em todas as VMs locais que você deseja replicar no Azure.</span><span class="sxs-lookup"><span data-stu-id="150cb-105">The Mobility service agent must be installed on all on-premises VMs that you want to replicate to Azure.</span></span>

## <a name="prepare-for-automatic-discovery"></a><span data-ttu-id="150cb-106">Preparar para a descoberta automática</span><span class="sxs-lookup"><span data-stu-id="150cb-106">Prepare for automatic discovery</span></span>

<span data-ttu-id="150cb-107">O Site Recovery detecta automaticamente as VMs em execução em hosts ESXi vSphere (com ou sem um servidor do vCenter).</span><span class="sxs-lookup"><span data-stu-id="150cb-107">Site Recovery automatically discovers VMs running on vSphere ESXi hosts (with or without a vCenter server).</span></span> <span data-ttu-id="150cb-108">Para a descoberta automática, o Site Recovery precisa de uma conta para acessar os hosts e servidores:</span><span class="sxs-lookup"><span data-stu-id="150cb-108">For automatic discovery, Site Recovery needs an account to access hosts and servers:</span></span>

1. <span data-ttu-id="150cb-109">Para usar uma conta dedicada, crie uma função (no nível do vCenter com as permissões, conforme descrito na tabela abaixo.</span><span class="sxs-lookup"><span data-stu-id="150cb-109">To use a dedicated account, create a role (at the vCenter level, with the permissions described in the table below.</span></span> <span data-ttu-id="150cb-110">Use um nome como **Azure_Site_Recovery**.</span><span class="sxs-lookup"><span data-stu-id="150cb-110">Give it a name such as **Azure_Site_Recovery**.</span></span>
2. <span data-ttu-id="150cb-111">Em seguida, crie um usuário no host vSphere/servidor vCenter e atribua a função ao usuário.</span><span class="sxs-lookup"><span data-stu-id="150cb-111">Then, create a user on the vSphere host/vCenter server, and assign the role to the user.</span></span> <span data-ttu-id="150cb-112">Você especifica essa conta de usuário durante a implantação de Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="150cb-112">You specify this user account during Site Recovery deployment.</span></span>


### <a name="vmware-account-permissions"></a><span data-ttu-id="150cb-113">Permissões de conta do VMware</span><span class="sxs-lookup"><span data-stu-id="150cb-113">VMware account permissions</span></span>

<span data-ttu-id="150cb-114">A Site Recovery precisa de acesso ao VMware para que o servidor de processo descubra automaticamente as VMs e para failover e failback de VMs.</span><span class="sxs-lookup"><span data-stu-id="150cb-114">Site Recovery needs access to VMware for the process server to automatically discover VMs, and for failover and failback of VMs.</span></span>

- <span data-ttu-id="150cb-115">**Migrar**: se você quiser migrar VMs VMware para o Azure, sem nunca realizar failback novamente, poderá usar uma conta do VMware com uma função somente leitura.</span><span class="sxs-lookup"><span data-stu-id="150cb-115">**Migrate**: If you only want to migrate VMware VMs to Azure, without ever failing them back, you can use a VMware account with a read-only role.</span></span> <span data-ttu-id="150cb-116">Essa função pode executar o failover, mas não pode desligar máquinas de origem protegidas.</span><span class="sxs-lookup"><span data-stu-id="150cb-116">Such a role can run failover, but can't shut down protected source machines.</span></span> <span data-ttu-id="150cb-117">Isso não é necessário para a migração.</span><span class="sxs-lookup"><span data-stu-id="150cb-117">This isn't necessary for migration.</span></span>
- <span data-ttu-id="150cb-118">**Replicação/recuperação**: se você desejar implantar a replicação completa (replicar, failover e failback) a conta deverá ser capaz de executar operações como criar e remover discos, ativar VMs etc.</span><span class="sxs-lookup"><span data-stu-id="150cb-118">**Replicate/Recover**: If you want to deploy full replication (replicate, failover, failback) the account must be able to run operations such as creating and removing disks, powering on VMs etc.</span></span>
- <span data-ttu-id="150cb-119">**Descoberta automática**: é necessário ter pelo menos uma conta somente leitura.</span><span class="sxs-lookup"><span data-stu-id="150cb-119">**Automatic discovery**: At least a read-only account is required.</span></span>


<span data-ttu-id="150cb-120">**Tarefa**</span><span class="sxs-lookup"><span data-stu-id="150cb-120">**Task**</span></span> | <span data-ttu-id="150cb-121">**Conta/função necessária**</span><span class="sxs-lookup"><span data-stu-id="150cb-121">**Required account/role**</span></span> | <span data-ttu-id="150cb-122">**Permissões**</span><span class="sxs-lookup"><span data-stu-id="150cb-122">**Permissions**</span></span> | <span data-ttu-id="150cb-123">**Detalhes**</span><span class="sxs-lookup"><span data-stu-id="150cb-123">**Details**</span></span>
--- | --- | --- | ---
<span data-ttu-id="150cb-124">**Servidor de processo descobre automaticamente as VMs VMware**</span><span class="sxs-lookup"><span data-stu-id="150cb-124">**Process server automatically discovers VMware VMs**</span></span> | <span data-ttu-id="150cb-125">Você precisa de pelo menos um usuário somente leitura</span><span class="sxs-lookup"><span data-stu-id="150cb-125">You need at least a read-only user</span></span> | <span data-ttu-id="150cb-126">Objeto de data center –> Propagar para o objeto filho, função = somente leitura</span><span class="sxs-lookup"><span data-stu-id="150cb-126">Data Center object –> Propagate to Child Object, role=Read-only</span></span> | <span data-ttu-id="150cb-127">Usuário atribuído no nível de datacenter e tem acesso a todos os objetos no datacenter.</span><span class="sxs-lookup"><span data-stu-id="150cb-127">User assigned at datacenter level, and has access to all the objects in the datacenter.</span></span><br/><br/> <span data-ttu-id="150cb-128">Para restringir o acesso, atribua a função **Nenhum acesso** com o objeto **Propagar para filho** aos objetos filho (hosts vSphere, armazenamentos de dados, VMs e redes).</span><span class="sxs-lookup"><span data-stu-id="150cb-128">To restrict access, assign the **No access** role with the **Propagate to child** object, to the child objects (vSphere hosts, datastores, VMs and networks).</span></span>
<span data-ttu-id="150cb-129">**Failover**</span><span class="sxs-lookup"><span data-stu-id="150cb-129">**Failover**</span></span> | <span data-ttu-id="150cb-130">Você precisa de pelo menos um usuário somente leitura</span><span class="sxs-lookup"><span data-stu-id="150cb-130">You need at least a read-only user</span></span> | <span data-ttu-id="150cb-131">Objeto de data center –> Propagar para o objeto filho, função = somente leitura</span><span class="sxs-lookup"><span data-stu-id="150cb-131">Data Center object –> Propagate to Child Object, role=Read-only</span></span> | <span data-ttu-id="150cb-132">Usuário atribuído no nível de datacenter e tem acesso a todos os objetos no datacenter.</span><span class="sxs-lookup"><span data-stu-id="150cb-132">User assigned at datacenter level, and has access to all the objects in the datacenter.</span></span><br/><br/> <span data-ttu-id="150cb-133">Se desejar restringir o acesso, atribua a função **Nenhum acesso** com o objeto **Propagar para objeto filho** aos objetos filho (hosts vSphere, armazenamentos de dados, VMs e redes).</span><span class="sxs-lookup"><span data-stu-id="150cb-133">To restrict access, assign the **No access** role with the **Propagate to child** object to the child objects (vSphere hosts, datastores, VMs and networks).</span></span><br/><br/> <span data-ttu-id="150cb-134">É útil para fins de migração, mas não para replicação completa, failover ou failback.</span><span class="sxs-lookup"><span data-stu-id="150cb-134">Useful for migration purposes, but not full replication, failover, failback.</span></span>
<span data-ttu-id="150cb-135">**Failover e failback**</span><span class="sxs-lookup"><span data-stu-id="150cb-135">**Failover and failback**</span></span> | <span data-ttu-id="150cb-136">Sugerimos que você crie uma função (Azure_Site_Recovery) com as permissões necessárias e atribua a função a um usuário ou grupo do VMware</span><span class="sxs-lookup"><span data-stu-id="150cb-136">We suggest you create a role (Azure_Site_Recovery) with the required permissions, and then assign the role to a VMware user or group</span></span> | <span data-ttu-id="150cb-137">Objeto de Data Center –> Propagar para o Objeto Filho, função = Azure_Site_Recovery</span><span class="sxs-lookup"><span data-stu-id="150cb-137">Data Center object –> Propagate to Child Object, role=Azure_Site_Recovery</span></span><br/><br/> <span data-ttu-id="150cb-138">Armazenamento de dados -> alocar espaço, procurar armazenamento de dados, operações de arquivo de baixo nível, remover arquivo, atualizar arquivos de máquina virtual</span><span class="sxs-lookup"><span data-stu-id="150cb-138">Datastore -> Allocate space, browse datastore, low-level file operations, remove file, update virtual machine files</span></span><br/><br/> <span data-ttu-id="150cb-139">Rede -> Atribuição de rede</span><span class="sxs-lookup"><span data-stu-id="150cb-139">Network -> Network assign</span></span><br/><br/> <span data-ttu-id="150cb-140">Recurso -> Atribuir VM ao pool de recursos, migrar VM desligada, migrar VM ligada</span><span class="sxs-lookup"><span data-stu-id="150cb-140">Resource -> Assign VM to resource pool, migrate powered off VM, migrate powered on VM</span></span><br/><br/> <span data-ttu-id="150cb-141">Tarefas -> Criar tarefa, atualizar tarefa</span><span class="sxs-lookup"><span data-stu-id="150cb-141">Tasks -> Create task, update task</span></span><br/><br/> <span data-ttu-id="150cb-142">Máquina virtual -> Configuração</span><span class="sxs-lookup"><span data-stu-id="150cb-142">Virtual machine -> Configuration</span></span><br/><br/> <span data-ttu-id="150cb-143">Máquina virtual -> Interagir -> responder à pergunta, conexão de dispositivo, configurar mídia de CD, configurar mídia de disquete, desligar, ligar, instalação de ferramentas VMware</span><span class="sxs-lookup"><span data-stu-id="150cb-143">Virtual machine -> Interact -> answer question, device connection, configure CD media, configure floppy media, power off, power on, VMware tools install</span></span><br/><br/> <span data-ttu-id="150cb-144">Máquina virtual -> Inventário -> Criar, registrar, cancelar registro</span><span class="sxs-lookup"><span data-stu-id="150cb-144">Virtual machine -> Inventory -> Create, register, unregister</span></span><br/><br/> <span data-ttu-id="150cb-145">Máquina virtual -> Provisionamento -> Permitir download de máquina virtual, permitir upload de arquivos de máquina virtual</span><span class="sxs-lookup"><span data-stu-id="150cb-145">Virtual machine -> Provisioning -> Allow virtual machine download, allow virtual machine files upload</span></span><br/><br/> <span data-ttu-id="150cb-146">Máquina virtual -> Instantâneos -> Remover instantâneos</span><span class="sxs-lookup"><span data-stu-id="150cb-146">Virtual machine -> Snapshots -> Remove snapshots</span></span> | <span data-ttu-id="150cb-147">Usuário atribuído no nível de datacenter e tem acesso a todos os objetos no datacenter.</span><span class="sxs-lookup"><span data-stu-id="150cb-147">User assigned at datacenter level, and has access to all the objects in the datacenter.</span></span><br/><br/> <span data-ttu-id="150cb-148">Para restringir o acesso, atribua a função **Nenhum acesso** com o objeto **Propagar para filho** aos objetos filho (hosts vSphere, armazenamentos de dados, VMs e redes).</span><span class="sxs-lookup"><span data-stu-id="150cb-148">To restrict access, assign the **No access** role with the **Propagate to child** object, to the child objects (vSphere hosts, datastores, VMs and networks).</span></span>


## <a name="prepare-for-push-installation-of-the-mobility-service"></a><span data-ttu-id="150cb-149">Preparar para instalação do Serviço de Mobilidade por push</span><span class="sxs-lookup"><span data-stu-id="150cb-149">Prepare for push installation of the Mobility service</span></span>

<span data-ttu-id="150cb-150">O serviço de Mobilidade deve ser instalado em todas as VMs que você deseja replicar.</span><span class="sxs-lookup"><span data-stu-id="150cb-150">The Mobility service must be installed on all VMs you want to replicate.</span></span> <span data-ttu-id="150cb-151">Há várias maneiras de instalar o serviço, incluindo a instalação manual, a instalação por push do servidor de processo do Site Recovery e a instalação usando métodos como o System Center Configuration Manager.</span><span class="sxs-lookup"><span data-stu-id="150cb-151">There are a number of ways to install the service, including manual installation, push installation from the Site Recovery process server, and installation using methods such as System Center Configuration Manager.</span></span>

<span data-ttu-id="150cb-152">Se você quiser usar a instalação por push, precisará preparar uma conta que o Site Recovery possa usar para acessar a VM.</span><span class="sxs-lookup"><span data-stu-id="150cb-152">If you want to use push installation, you need to prepare an account that Site Recovery can use to access the VM.</span></span>

- <span data-ttu-id="150cb-153">Você pode usar uma conta local ou de domínio</span><span class="sxs-lookup"><span data-stu-id="150cb-153">You can use a domain or local account</span></span>
- <span data-ttu-id="150cb-154">Para Windows, se não estiver usando uma conta de domínio, precisará desabilitar o controle de Acesso de Usuário Remoto no computador local.</span><span class="sxs-lookup"><span data-stu-id="150cb-154">For Windows, if you're not using a domain account, you need to disable Remote User Access control on the local machine.</span></span> <span data-ttu-id="150cb-155">Para fazer isso, no registro, em **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System**, adicione a entrada DWORD **LocalAccountTokenFilterPolicy** com um valor de 1.</span><span class="sxs-lookup"><span data-stu-id="150cb-155">To do this, in the register under **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System**, add the DWORD entry **LocalAccountTokenFilterPolicy**, with a value of 1.</span></span>
- <span data-ttu-id="150cb-156">Se deseja adicionar a entrada do Registro do Windows de uma CLI, digite: ``REG ADD HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1.``</span><span class="sxs-lookup"><span data-stu-id="150cb-156">If you want to add the registry entry for Windows from a CLI, type:       ``REG ADD HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1.``</span></span>
- <span data-ttu-id="150cb-157">Para Linux, a conta deve ser a raiz no servidor Linux de origem.</span><span class="sxs-lookup"><span data-stu-id="150cb-157">For Linux, the account should be root on the source Linux server.</span></span>



## <a name="next-steps"></a><span data-ttu-id="150cb-158">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="150cb-158">Next steps</span></span>

<span data-ttu-id="150cb-159">Vá para a [Etapa 7: Criar um cofre](vmware-walkthrough-create-vault.md)</span><span class="sxs-lookup"><span data-stu-id="150cb-159">Go to [Step 7: Create a vault](vmware-walkthrough-create-vault.md)</span></span>
