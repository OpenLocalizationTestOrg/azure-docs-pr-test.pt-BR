---
title: "aaaFailback no Azure Site Recovery para máquinas virtuais Hyper-v | Microsoft Docs"
description: "O Azure Site Recovery coordena a replicação hello, failover e recuperação de máquinas virtuais e servidores físicos. Saiba mais sobre o failback de datacenter local tooon do Azure."
services: site-recovery
documentationcenter: 
author: ruturaj
manager: gauravd
editor: 
ms.assetid: 44813a48-c680-4581-a92e-cecc57cc3b1e
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 08/11/2017
ms.author: ruturajd
ms.openlocfilehash: 50cda9105de6b6fb23e4c62942fdaffc55c3efa4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="failback-in-site-recovery-for-hyper-v-virtual-machines"></a><span data-ttu-id="6b503-104">Failback no Site Recovery para máquinas virtuais do Hyper-V</span><span class="sxs-lookup"><span data-stu-id="6b503-104">Failback in Site Recovery for Hyper-V virtual machines</span></span>

<span data-ttu-id="6b503-105">Este artigo descreve como máquinas virtuais de toofailback protegida pela recuperação de Site.</span><span class="sxs-lookup"><span data-stu-id="6b503-105">This article describes how toofailback virtual machines protected by Site Recovery.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="6b503-106">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="6b503-106">Prerequisites</span></span>
1. <span data-ttu-id="6b503-107">Certifique-se de que esse servidor de Hyper-V/server Olá site primário do VMM está conectado.</span><span class="sxs-lookup"><span data-stu-id="6b503-107">Ensure that hello primary site VMM server/Hyper-V server is connected.</span></span>
2. <span data-ttu-id="6b503-108">Você deve ter sido executada **confirmar** na máquina virtual de saudação.</span><span class="sxs-lookup"><span data-stu-id="6b503-108">You should have performed **Commit** on hello virtual machine.</span></span>

## <a name="why-is-there-no-button-called-failback"></a><span data-ttu-id="6b503-109">Por que não há um botão chamado failback?</span><span class="sxs-lookup"><span data-stu-id="6b503-109">Why is there no button called failback?</span></span>
<span data-ttu-id="6b503-110">No portal de hello, não há nenhum gesto explícito chamado failback.</span><span class="sxs-lookup"><span data-stu-id="6b503-110">On hello portal, there is no explicit gesture called failback.</span></span> <span data-ttu-id="6b503-111">Failback é uma etapa em que você volte site primário toohello.</span><span class="sxs-lookup"><span data-stu-id="6b503-111">Failback is a step where you come back toohello primary site.</span></span> <span data-ttu-id="6b503-112">Por definição, o failover ocorre quando você máquinas de virtuais de saudação do failover de primary(on-premises) site toorecovery (Azure) e o failback é quando você executar failover em máquinas virtuais Olá da recuperação faz tooprimary.</span><span class="sxs-lookup"><span data-stu-id="6b503-112">By definition, failover is when you failover hello virtual machines from primary(on-premises) site toorecovery (Azure), and failback is when you failover hello virtual machines from recovery back tooprimary.</span></span>

<span data-ttu-id="6b503-113">Quando você iniciar um failover, folha Olá informa sobre a direção de saudação do trabalho de saudação.</span><span class="sxs-lookup"><span data-stu-id="6b503-113">When you initiate a failover, hello blade informs you about hello direction of hello job.</span></span> <span data-ttu-id="6b503-114">Se a direção de saudação for tooOn-local do Azure, é um failback.</span><span class="sxs-lookup"><span data-stu-id="6b503-114">If hello direction is from Azure tooOn-premises, it is a failback.</span></span>

## <a name="why-is-there-only-a-planned-failover-gesture-toofailback"></a><span data-ttu-id="6b503-115">Por que há apenas um toofailback de gesto de failover planejado?</span><span class="sxs-lookup"><span data-stu-id="6b503-115">Why is there only a planned failover gesture toofailback?</span></span>
<span data-ttu-id="6b503-116">O Azure é um ambiente altamente disponível, e as máquinas virtuais estarão sempre disponíveis.</span><span class="sxs-lookup"><span data-stu-id="6b503-116">Azure is a highly available environment and your virtual machines will be always available.</span></span> <span data-ttu-id="6b503-117">Failback é uma atividade planejada onde você decidir tootake um pequeno tempo de inatividade para que cargas de trabalho Olá podem iniciar a execução local novamente.</span><span class="sxs-lookup"><span data-stu-id="6b503-117">Failback is a planned activity where you decide tootake a small downtime so that hello workloads can start running on-premises again.</span></span> <span data-ttu-id="6b503-118">Isso não tem expectativa de perda de dados.</span><span class="sxs-lookup"><span data-stu-id="6b503-118">This expects no data loss.</span></span> <span data-ttu-id="6b503-119">Portanto, se houver apenas um gesto de failover planejado, que será desativar Olá VMs no Azure, baixar alterações mais recentes hello e certifique-se de que não há nenhuma perda de dados.</span><span class="sxs-lookup"><span data-stu-id="6b503-119">Hence only a planned failover gesture is available, that will turn off hello VMs in Azure, download hello latest changes and ensure there is no data loss.</span></span>

## <a name="initiate-failback"></a><span data-ttu-id="6b503-120">Iniciar o failback</span><span class="sxs-lookup"><span data-stu-id="6b503-120">Initiate failback</span></span>
<span data-ttu-id="6b503-121">Após o failover de local de toosecondary primária hello, as máquinas virtuais replicadas não estão protegidas pela recuperação de Site e local secundário Olá agora está atuando como local ativo hello.</span><span class="sxs-lookup"><span data-stu-id="6b503-121">After failover from hello primary toosecondary location, replicated virtual machines aren't protected by Site Recovery, and hello secondary location is now acting as hello active location.</span></span> <span data-ttu-id="6b503-122">Siga estes procedimentos toofail toohello back site primário original.</span><span class="sxs-lookup"><span data-stu-id="6b503-122">Follow these procedures toofail back toohello original primary site.</span></span> <span data-ttu-id="6b503-123">Este procedimento descreve como toorun um failover planejado para uma recuperação do plano.</span><span class="sxs-lookup"><span data-stu-id="6b503-123">This procedure describes how toorun a planned failover for a recovery plan.</span></span> <span data-ttu-id="6b503-124">Alternativamente, você pode executar failover Olá para uma única máquina virtual em Olá **máquinas virtuais** guia.</span><span class="sxs-lookup"><span data-stu-id="6b503-124">Alternatively you can run hello failover for a single virtual machine on hello **Virtual Machines** tab.</span></span>

1. <span data-ttu-id="6b503-125">Selecione **Planos de Recuperação** > *recoveryplan_name*.</span><span class="sxs-lookup"><span data-stu-id="6b503-125">Select **Recovery Plans** > *recoveryplan_name*.</span></span> <span data-ttu-id="6b503-126">Clique em **Failover** > **Planned Failover**.</span><span class="sxs-lookup"><span data-stu-id="6b503-126">Click **Failover** > **Planned Failover**.</span></span>
2. <span data-ttu-id="6b503-127">Em hello * * confirmar Failover planejado * * página, escolha os locais de origem e destino hello.</span><span class="sxs-lookup"><span data-stu-id="6b503-127">On hello **Confirm Planned Failover **page, choose hello source and target locations.</span></span> <span data-ttu-id="6b503-128">Observe a direção do failover hello.</span><span class="sxs-lookup"><span data-stu-id="6b503-128">Note hello failover direction.</span></span> <span data-ttu-id="6b503-129">Se o failover de saudação do primário trabalhou como esperado e todas as máquinas virtuais estão no local secundário hello, que isso é apenas para fins informativos.</span><span class="sxs-lookup"><span data-stu-id="6b503-129">If hello failover from primary worked as expect and all virtual machines are in hello secondary location this is for information only.</span></span>
3. <span data-ttu-id="6b503-130">Se estiver fazendo failback do Azure, selecione as configurações em **Sincronização de Dados**:</span><span class="sxs-lookup"><span data-stu-id="6b503-130">If you're failing back from Azure select settings in **Data Synchronization**:</span></span>

   * <span data-ttu-id="6b503-131">**Sincronizar os dados antes do failover (sincronizar apenas alterações delta)**: essa opção minimiza o tempo de inatividade das máquinas virtuais, pois elas não são desligadas durante a sincronização.</span><span class="sxs-lookup"><span data-stu-id="6b503-131">**Synchronize data before failover(Synchronize delta changes only)**—This option minimizes downtime for virtual machines as it synchronizes without shutting them down.</span></span> <span data-ttu-id="6b503-132">Olá a seguir:</span><span class="sxs-lookup"><span data-stu-id="6b503-132">It does hello following:</span></span>
     * <span data-ttu-id="6b503-133">Fase 1: Usa o instantâneo de máquina virtual de saudação no Azure e copia host de Hyper-V toohello local.</span><span class="sxs-lookup"><span data-stu-id="6b503-133">Phase 1: Takes snapshot of hello virtual machine in Azure and copies it toohello on-premises Hyper-V host.</span></span> <span data-ttu-id="6b503-134">máquina de saudação continua em execução no Azure.</span><span class="sxs-lookup"><span data-stu-id="6b503-134">hello machine continues running in Azure.</span></span>
     * <span data-ttu-id="6b503-135">Fase 2: Desliga Olá máquina virtual do Azure para que nenhuma nova alteração ocorre existe.</span><span class="sxs-lookup"><span data-stu-id="6b503-135">Phase 2: Shuts down hello virtual machine in Azure so that no new changes occur there.</span></span> <span data-ttu-id="6b503-136">Olá final do conjunto de alterações delta são transferidos toohello servidor de local e a máquina virtual no local, Olá é iniciada.</span><span class="sxs-lookup"><span data-stu-id="6b503-136">hello final set of delta changes are transferred toohello on-premises server and hello on-premises virtual machine is started up.</span></span>

    - <span data-ttu-id="6b503-137">**Sincronizar os dados apenas durante o failover (download completo)**: use essa opção se você estiver executando no Azure por um longo período.</span><span class="sxs-lookup"><span data-stu-id="6b503-137">**Synchronize data during failover only(full download)**—Use this option if you've been running on Azure for a long time.</span></span> <span data-ttu-id="6b503-138">Essa opção é mais rápida porque esperamos que a maioria do disco Olá foi alterado e não queremos toospend tempo no cálculo da soma de verificação.</span><span class="sxs-lookup"><span data-stu-id="6b503-138">This option is faster because we expect that most of hello disk has changed and we don't want toospend time in checksum calculation.</span></span> <span data-ttu-id="6b503-139">Ele executa um download do disco de saudação.</span><span class="sxs-lookup"><span data-stu-id="6b503-139">It performs a download of hello disk.</span></span> <span data-ttu-id="6b503-140">Também é útil quando a máquina de virtual Olá local foi excluída.</span><span class="sxs-lookup"><span data-stu-id="6b503-140">It is also useful when hello on-prem virtual machine has been deleted.</span></span>

    >[!NOTE]
    ><span data-ttu-id="6b503-141">Recomendamos que você use esta opção se você esteve executando Azure por um tempo (um mês ou mais) ou Olá local virtual máquina foi excluída. Essa opção não executará os cálculos de soma de verificação.</span><span class="sxs-lookup"><span data-stu-id="6b503-141">We recommend you use this option if you've been running Azure for a while (a month or more) or hello on-prem virtual machine has been deleted.This option doesn't perform any checksum calculations.</span></span>
    >
    >




4. <span data-ttu-id="6b503-142">Se a criptografia de dados está habilitada para nuvem Olá, em **chave de criptografia** certificado Olá selecione emitido quando você tiver habilitado a criptografia de dados durante a instalação do provedor no servidor do VMM hello.</span><span class="sxs-lookup"><span data-stu-id="6b503-142">If data encryption is enabled for hello cloud, in **Encryption Key** select hello certificate that was issued when you enabled data encryption during Provider installation on hello VMM server.</span></span>
5. <span data-ttu-id="6b503-143">Inicie o failover de saudação.</span><span class="sxs-lookup"><span data-stu-id="6b503-143">Initiate hello failover.</span></span> <span data-ttu-id="6b503-144">Você pode acompanhar o progresso de failover de saudação em Olá **trabalhos** guia.</span><span class="sxs-lookup"><span data-stu-id="6b503-144">You can follow hello failover progress on hello **Jobs** tab.</span></span>
6. <span data-ttu-id="6b503-145">Se você tiver selecionado Olá opção toosynchronize Olá dados antes do failover hello, uma vez saudação inicial de sincronização de dados for concluída e você está pronto tooshut Olá máquinas de virtuais no Azure, clique em **trabalhos** nome do trabalho de failover planejado **Concluir o Failover**.</span><span class="sxs-lookup"><span data-stu-id="6b503-145">If you selected hello option toosynchronize hello data before hello failover, once hello initial data synchronization is complete and you're ready tooshut down hello virtual machines in Azure, click **Jobs** planned failover job name **Complete Failover**.</span></span> <span data-ttu-id="6b503-146">Isso fecha Olá máquina do Azure, Olá transferências mais recentes alterações máquina virtual local, toohello e inicia Olá VM local.</span><span class="sxs-lookup"><span data-stu-id="6b503-146">This shuts down hello Azure machine, transfers hello latest changes toohello on-premises virtual machine, and starts hello VM on-premises.</span></span>
7. <span data-ttu-id="6b503-147">Agora você pode fazer logon em Olá toovalidate de máquina virtual está disponível como esperado.</span><span class="sxs-lookup"><span data-stu-id="6b503-147">You can now log onto hello virtual machine toovalidate it's available as expected.</span></span>
8. <span data-ttu-id="6b503-148">Olá VM está em um estado de confirmação pendente.</span><span class="sxs-lookup"><span data-stu-id="6b503-148">hello virtual machine is in a commit pending state.</span></span> <span data-ttu-id="6b503-149">Clique em **confirmar** toocommit Olá failover.</span><span class="sxs-lookup"><span data-stu-id="6b503-149">Click **Commit** toocommit hello failover.</span></span>
9. <span data-ttu-id="6b503-150">Agora toocomplete Olá failback clicar em **replicação inversa** toostart proteger máquina virtual de saudação no site primário hello.</span><span class="sxs-lookup"><span data-stu-id="6b503-150">Now in order toocomplete hello failback click **Reverse Replicate** toostart protecting hello virtual machine in hello primary site.</span></span>

## <a name="failback-tooan-alternate-location"></a><span data-ttu-id="6b503-151">Local alternativo de tooan de failback</span><span class="sxs-lookup"><span data-stu-id="6b503-151">Failback tooan alternate location</span></span>
<span data-ttu-id="6b503-152">Se você implantou a proteção entre um [site Hyper-V e o Azure](site-recovery-hyper-v-site-to-azure.md) ter tooability toofailback do Azure tooan alternativo no local.</span><span class="sxs-lookup"><span data-stu-id="6b503-152">If you've deployed protection between a [Hyper-V site and Azure](site-recovery-hyper-v-site-to-azure.md) you have tooability toofailback from Azure tooan alternate on-premises location.</span></span> <span data-ttu-id="6b503-153">Isso é útil se você precisar tooset o novo hardware local.</span><span class="sxs-lookup"><span data-stu-id="6b503-153">This is useful if you need tooset up new on-premises hardware.</span></span> <span data-ttu-id="6b503-154">Veja como fazer isso.</span><span class="sxs-lookup"><span data-stu-id="6b503-154">Here's how you do it.</span></span>

1. <span data-ttu-id="6b503-155">Se você estiver instalando um novo hardware instalar o Windows Server 2012 R2 e Olá a função Hyper-V no servidor de saudação.</span><span class="sxs-lookup"><span data-stu-id="6b503-155">If you're setting up new hardware install Windows Server 2012 R2 and hello Hyper-V role on hello server.</span></span>
2. <span data-ttu-id="6b503-156">Crie um comutador de rede virtual com Olá mesmo nome que você tinha no servidor original hello.</span><span class="sxs-lookup"><span data-stu-id="6b503-156">Create a virtual network switch with hello same name that you had on hello original server.</span></span>
3. <span data-ttu-id="6b503-157">Selecione **itens protegidos** -> **grupo de proteção**  ->  <ProtectionGroupName>  ->  <VirtualMachineName> desejado toofail novamente e selecione **planejado Failover**.</span><span class="sxs-lookup"><span data-stu-id="6b503-157">Select **Protected Items** -> **Protection Group** -> <ProtectionGroupName> -> <VirtualMachineName> you want toofail back, and select **Planned Failover**.</span></span>
4. <span data-ttu-id="6b503-158">Em **Confirmar Failover Planejado** select **Criar máquina virtual local se ela não existir**.</span><span class="sxs-lookup"><span data-stu-id="6b503-158">In **Confirm Planned Failover** select **Create on-premises virtual machine if it does not exist**.</span></span>
5. <span data-ttu-id="6b503-159">Em **nome de Host** selecione Olá novo servidor de host do Hyper-V no qual você deseja tooplace Olá VM.</span><span class="sxs-lookup"><span data-stu-id="6b503-159">In **Host Name** select hello new Hyper-V host server on which you want tooplace hello virtual machine.</span></span>
6. <span data-ttu-id="6b503-160">Sincronização de dados, é recomendável selecionar opção de saudação **sincronizar dados Olá antes do failover Olá**.</span><span class="sxs-lookup"><span data-stu-id="6b503-160">In Data Synchronization we recommend you select  hello option **Synchronize hello data before hello failover**.</span></span> <span data-ttu-id="6b503-161">Essa opção minimiza o tempo de inatividade das máquinas virtuais, uma vez que faz a sincronização sem desligá-las.</span><span class="sxs-lookup"><span data-stu-id="6b503-161">This minimizes downtime for virtual machines as it synchronizes without shutting them down.</span></span> <span data-ttu-id="6b503-162">Olá a seguir:</span><span class="sxs-lookup"><span data-stu-id="6b503-162">It does hello following:</span></span>

   * <span data-ttu-id="6b503-163">Fase 1: Usa o instantâneo de máquina virtual de saudação no Azure e copia host de Hyper-V toohello local.</span><span class="sxs-lookup"><span data-stu-id="6b503-163">Phase 1: Takes snapshot of hello virtual machine in Azure and copies it toohello on-premises Hyper-V host.</span></span> <span data-ttu-id="6b503-164">máquina de saudação continua em execução no Azure.</span><span class="sxs-lookup"><span data-stu-id="6b503-164">hello machine continues running in Azure.</span></span>
   * <span data-ttu-id="6b503-165">Fase 2: Desliga Olá máquina virtual do Azure para que nenhuma nova alteração ocorre existe.</span><span class="sxs-lookup"><span data-stu-id="6b503-165">Phase 2: Shuts down hello virtual machine in Azure so that no new changes occur there.</span></span> <span data-ttu-id="6b503-166">Olá final do conjunto de alterações são transferidas toohello servidor de local e a máquina virtual no local, Olá é iniciada.</span><span class="sxs-lookup"><span data-stu-id="6b503-166">hello final set of changes are transferred toohello on-premises server and hello on-premises virtual machine is started up.</span></span>
7. <span data-ttu-id="6b503-167">Clique em Olá marca de seleção toobegin Olá failover (failback).</span><span class="sxs-lookup"><span data-stu-id="6b503-167">Click hello checkmark toobegin hello failover (failback).</span></span>
8. <span data-ttu-id="6b503-168">Depois de concluída a sincronização inicial hello e está pronto tooshut Olá máquina de virtual no Azure, clique em **trabalhos** > <planned failover job> > **concluir o Failover**.</span><span class="sxs-lookup"><span data-stu-id="6b503-168">After hello initial synchronization finishes and you're ready tooshut down hello virtual machine in Azure, click **Jobs** > <planned failover job> > **Complete Failover**.</span></span> <span data-ttu-id="6b503-169">Isso desliga Olá máquina do Azure, transferências hello mais recentes alterações toohello máquina virtual local e iniciá-lo.</span><span class="sxs-lookup"><span data-stu-id="6b503-169">This shuts down hello Azure machine, transfers hello latest changes toohello on-premises virtual machine and starts it.</span></span>
9. <span data-ttu-id="6b503-170">Você pode fazer logon no tooverify de máquina virtual local Olá que tudo está funcionando conforme o esperado.</span><span class="sxs-lookup"><span data-stu-id="6b503-170">You can log onto hello on-premises virtual machine tooverify everything is working as expected.</span></span> <span data-ttu-id="6b503-171">Em seguida, clique em **confirmar** toofinish Olá failover.</span><span class="sxs-lookup"><span data-stu-id="6b503-171">Then click **Commit** toofinish hello failover.</span></span>
10. <span data-ttu-id="6b503-172">Clique em **replicação inversa** toostart proteção de máquina virtual local, Olá.</span><span class="sxs-lookup"><span data-stu-id="6b503-172">Click **Reverse Replicate** toostart protecting hello on-premises virtual machine.</span></span>

    > [!NOTE]
    > <span data-ttu-id="6b503-173">Se você cancelar o trabalho de failback Olá durante a etapa de sincronização de dados, Olá local VM estará em um estado corrompido.</span><span class="sxs-lookup"><span data-stu-id="6b503-173">If you cancel hello failback job while it is in Data Synchronization step, hello on-premises VM will be in a corrupted state.</span></span> <span data-ttu-id="6b503-174">Isso ocorre porque a sincronização de dados copia dados mais recentes de saudação de discos de dados local do toohello de discos de VM do Azure, e até a conclusão da sincronização hello, dados de disco de saudação não podem estar em um estado consistente.</span><span class="sxs-lookup"><span data-stu-id="6b503-174">This is because Data Synchronization copies hello latest data from Azure VM disks toohello on-prem data disks, and until hello synchronization completes, hello disk data may not be in a consistent state.</span></span> <span data-ttu-id="6b503-175">Se Olá VM local é iniciado depois que a sincronização de dados for cancelada, ele não pode inicializar.</span><span class="sxs-lookup"><span data-stu-id="6b503-175">If hello On-prem VM is booted after Data Synchronization is canceled, it may not boot.</span></span> <span data-ttu-id="6b503-176">Disparar novamente o failover toocomplete Olá a sincronização de dados.</span><span class="sxs-lookup"><span data-stu-id="6b503-176">Re-trigger failover toocomplete hello Data Synchronization.</span></span>
    >
    >



## <a name="next-steps"></a><span data-ttu-id="6b503-177">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="6b503-177">Next Steps</span></span>

<span data-ttu-id="6b503-178">Depois de ter concluído o trabalho de failback hello, **confirmar** máquina virtual de saudação.</span><span class="sxs-lookup"><span data-stu-id="6b503-178">Once you have completed hello failback job, **Commit** hello virtual machine.</span></span> <span data-ttu-id="6b503-179">Confirmação exclui hello máquina virtual do Azure e seus discos e prepara Olá VM toobe protegido novamente.</span><span class="sxs-lookup"><span data-stu-id="6b503-179">Commit deletes hello Azure virtual machine and its disks and prepares hello VM toobe protected again.</span></span>

<span data-ttu-id="6b503-180">Depois de **confirmar**, você pode iniciar Olá *replicação inversa*.</span><span class="sxs-lookup"><span data-stu-id="6b503-180">After **Commit**, you can initiate hello *Reverse Replicate*.</span></span> <span data-ttu-id="6b503-181">Isso iniciará a proteger a máquina de virtual de saudação do tooAzure back local.</span><span class="sxs-lookup"><span data-stu-id="6b503-181">This will start protecting hello virtual machine from on-premises back tooAzure.</span></span> <span data-ttu-id="6b503-182">Observe que isso será apenas as alterações de replicar hello como Olá VM foi desativada no Azure e, portanto, envia diferencial altera somente.</span><span class="sxs-lookup"><span data-stu-id="6b503-182">Note that this will only replicate hello changes since hello VM has been turned off in Azure and hence sends differential changes only.</span></span>
