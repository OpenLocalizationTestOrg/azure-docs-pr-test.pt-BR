---
title: "Failback no Azure Site Recovery para máquinas virtuais Hyper-v | Microsoft Docs"
description: "O Azure Site Recovery coordena a replicação, o failover e a recuperação de máquinas virtuais e servidores físicos. Saiba mais sobre o failback do Azure para o datacenter local."
services: site-recovery
documentationcenter: 
author: ruturaj
manager: gauravd
editor: 
ms.assetid: 44813a48-c680-4581-a92e-cecc57cc3b1e
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 08/11/2017
ms.author: ruturajd
ms.openlocfilehash: 719fe167c1298d8a48f5906c4e29e5f5825e5aef
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/18/2017
---
# <a name="failback-in-site-recovery-for-hyper-v-virtual-machines"></a><span data-ttu-id="8c418-104">Failback no Site Recovery para máquinas virtuais do Hyper-V</span><span class="sxs-lookup"><span data-stu-id="8c418-104">Failback in Site Recovery for Hyper-V virtual machines</span></span>

<span data-ttu-id="8c418-105">Este artigo descreve como executar o failback para máquinas virtuais protegidas pela Recuperação de Site.</span><span class="sxs-lookup"><span data-stu-id="8c418-105">This article describes how to failback virtual machines protected by Site Recovery.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="8c418-106">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="8c418-106">Prerequisites</span></span>
1. <span data-ttu-id="8c418-107">Verifique se o servidor VMM de site primário/servidor Hyper-V está conectado.</span><span class="sxs-lookup"><span data-stu-id="8c418-107">Ensure that the primary site VMM server/Hyper-V server is connected.</span></span>
2. <span data-ttu-id="8c418-108">Você deve ter executado **Confirmar** na máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="8c418-108">You should have performed **Commit** on the virtual machine.</span></span>

## <a name="why-is-there-no-button-called-failback"></a><span data-ttu-id="8c418-109">Por que não há um botão chamado failback?</span><span class="sxs-lookup"><span data-stu-id="8c418-109">Why is there no button called failback?</span></span>
<span data-ttu-id="8c418-110">No portal, não há um gesto explícito chamado failback.</span><span class="sxs-lookup"><span data-stu-id="8c418-110">On the portal, there is no explicit gesture called failback.</span></span> <span data-ttu-id="8c418-111">O failback é uma etapa em que você volta para o site primário.</span><span class="sxs-lookup"><span data-stu-id="8c418-111">Failback is a step where you come back to the primary site.</span></span> <span data-ttu-id="8c418-112">Por definição, o failover é quando você executa o failover nas máquinas virtuais do site principal (local) para recuperação (Azure), e failback é quando você executa o failover nas máquinas virtuais de recuperação de volta para o principal.</span><span class="sxs-lookup"><span data-stu-id="8c418-112">By definition, failover is when you failover the virtual machines from primary(on-premises) site to recovery (Azure), and failback is when you failover the virtual machines from recovery back to primary.</span></span>

<span data-ttu-id="8c418-113">Quando você inicia um failover, a folha informa sobre a direção do trabalho.</span><span class="sxs-lookup"><span data-stu-id="8c418-113">When you initiate a failover, the blade informs you about the direction of the job.</span></span> <span data-ttu-id="8c418-114">Se a direção for do Azure para o local, será um failback.</span><span class="sxs-lookup"><span data-stu-id="8c418-114">If the direction is from Azure to On-premises, it is a failback.</span></span>

## <a name="why-is-there-only-a-planned-failover-gesture-to-failback"></a><span data-ttu-id="8c418-115">Por que há apenas um gesto de failover planejado para failback?</span><span class="sxs-lookup"><span data-stu-id="8c418-115">Why is there only a planned failover gesture to failback?</span></span>
<span data-ttu-id="8c418-116">O Azure é um ambiente altamente disponível, e as máquinas virtuais estarão sempre disponíveis.</span><span class="sxs-lookup"><span data-stu-id="8c418-116">Azure is a highly available environment and your virtual machines will be always available.</span></span> <span data-ttu-id="8c418-117">O failback é uma atividade planejada em que você decide ter um breve intervalo de inatividade, para que as cargas de trabalho possam começar a ser executadas no local novamente.</span><span class="sxs-lookup"><span data-stu-id="8c418-117">Failback is a planned activity where you decide to take a small downtime so that the workloads can start running on-premises again.</span></span> <span data-ttu-id="8c418-118">Isso não tem expectativa de perda de dados.</span><span class="sxs-lookup"><span data-stu-id="8c418-118">This expects no data loss.</span></span> <span data-ttu-id="8c418-119">Portanto, só está disponível um gesto de failover planejado, que desativará as VMs no Azure, baixará as últimas alterações e garantirá que não haja perda de dados.</span><span class="sxs-lookup"><span data-stu-id="8c418-119">Hence only a planned failover gesture is available, that will turn off the VMs in Azure, download the latest changes and ensure there is no data loss.</span></span>

## <a name="initiate-failback"></a><span data-ttu-id="8c418-120">Iniciar o failback</span><span class="sxs-lookup"><span data-stu-id="8c418-120">Initiate failback</span></span>
<span data-ttu-id="8c418-121">Depois do failover do local primário no secundário, as máquinas virtuais replicadas não são protegidas pela Recuperação de Site, e o local secundário agora atuará como local ativo.</span><span class="sxs-lookup"><span data-stu-id="8c418-121">After failover from the primary to secondary location, replicated virtual machines aren't protected by Site Recovery, and the secondary location is now acting as the active location.</span></span> <span data-ttu-id="8c418-122">Siga estes procedimentos para fazer failback no site primário original.</span><span class="sxs-lookup"><span data-stu-id="8c418-122">Follow these procedures to fail back to the original primary site.</span></span> <span data-ttu-id="8c418-123">Este procedimento descreve como executar um failover planejado para um plano de recuperação.</span><span class="sxs-lookup"><span data-stu-id="8c418-123">This procedure describes how to run a planned failover for a recovery plan.</span></span> <span data-ttu-id="8c418-124">Como alternativa, você pode executar o failover de uma única máquina virtual na guia **Máquinas Virtuais** .</span><span class="sxs-lookup"><span data-stu-id="8c418-124">Alternatively you can run the failover for a single virtual machine on the **Virtual Machines** tab.</span></span>

1. <span data-ttu-id="8c418-125">Selecione **Planos de Recuperação** > *recoveryplan_name*.</span><span class="sxs-lookup"><span data-stu-id="8c418-125">Select **Recovery Plans** > *recoveryplan_name*.</span></span> <span data-ttu-id="8c418-126">Clique em **Failover** > **Planned Failover**.</span><span class="sxs-lookup"><span data-stu-id="8c418-126">Click **Failover** > **Planned Failover**.</span></span>
2. <span data-ttu-id="8c418-127">Na página **Confirmar Failover Planejado**, escolha os locais de origem e de destino.</span><span class="sxs-lookup"><span data-stu-id="8c418-127">On the **Confirm Planned Failover **page, choose the source and target locations.</span></span> <span data-ttu-id="8c418-128">Observe a direção do failover.</span><span class="sxs-lookup"><span data-stu-id="8c418-128">Note the failover direction.</span></span> <span data-ttu-id="8c418-129">Se o failover do local primário funcionar conforme esperado e todas as máquinas virtuais estiverem no local secundário, isso servirá apenas para fins informativos.</span><span class="sxs-lookup"><span data-stu-id="8c418-129">If the failover from primary worked as expect and all virtual machines are in the secondary location this is for information only.</span></span>
3. <span data-ttu-id="8c418-130">Se estiver fazendo failback do Azure, selecione as configurações em **Sincronização de Dados**:</span><span class="sxs-lookup"><span data-stu-id="8c418-130">If you're failing back from Azure select settings in **Data Synchronization**:</span></span>

   * <span data-ttu-id="8c418-131">**Sincronizar os dados antes do failover (sincronizar apenas alterações delta)**: essa opção minimiza o tempo de inatividade das máquinas virtuais, pois elas não são desligadas durante a sincronização.</span><span class="sxs-lookup"><span data-stu-id="8c418-131">**Synchronize data before failover(Synchronize delta changes only)**—This option minimizes downtime for virtual machines as it synchronizes without shutting them down.</span></span> <span data-ttu-id="8c418-132">Ele faz o seguinte:</span><span class="sxs-lookup"><span data-stu-id="8c418-132">It does the following:</span></span>
     * <span data-ttu-id="8c418-133">Fase 1: tira instantâneo da máquina virtual no Azure e o copia no host do Hyper-V local.</span><span class="sxs-lookup"><span data-stu-id="8c418-133">Phase 1: Takes snapshot of the virtual machine in Azure and copies it to the on-premises Hyper-V host.</span></span> <span data-ttu-id="8c418-134">O computador continua em execução no Azure.</span><span class="sxs-lookup"><span data-stu-id="8c418-134">The machine continues running in Azure.</span></span>
     * <span data-ttu-id="8c418-135">Fase 2: Desliga a máquina virtual no Azure para que nenhuma alteração seja feita lá.</span><span class="sxs-lookup"><span data-stu-id="8c418-135">Phase 2: Shuts down the virtual machine in Azure so that no new changes occur there.</span></span> <span data-ttu-id="8c418-136">O conjunto final de alterações delta é transferido para o servidor local, e a máquina virtual local é inicializada.</span><span class="sxs-lookup"><span data-stu-id="8c418-136">The final set of delta changes are transferred to the on-premises server and the on-premises virtual machine is started up.</span></span>

    - <span data-ttu-id="8c418-137">**Sincronizar os dados apenas durante o failover (download completo)**: use essa opção se você estiver executando no Azure por um longo período.</span><span class="sxs-lookup"><span data-stu-id="8c418-137">**Synchronize data during failover only(full download)**—Use this option if you've been running on Azure for a long time.</span></span> <span data-ttu-id="8c418-138">Essa opção é mais rápida porque esperamos que a maior parte do disco tenha mudado e não queremos perder tempo no cálculo da soma de verificação.</span><span class="sxs-lookup"><span data-stu-id="8c418-138">This option is faster because we expect that most of the disk has changed and we don't want to spend time in checksum calculation.</span></span> <span data-ttu-id="8c418-139">Ela executa um download do disco.</span><span class="sxs-lookup"><span data-stu-id="8c418-139">It performs a download of the disk.</span></span> <span data-ttu-id="8c418-140">Ela também é útil quando a máquina virtual local é excluída.</span><span class="sxs-lookup"><span data-stu-id="8c418-140">It is also useful when the on-prem virtual machine has been deleted.</span></span>

    >[!NOTE]
    ><span data-ttu-id="8c418-141">É recomendável usar essa opção se você já está executando o Azure há algum tempo (um mês ou mais) ou se a máquina virtual local foi excluída. Essa opção não executa cálculos de soma de verificação.</span><span class="sxs-lookup"><span data-stu-id="8c418-141">We recommend you use this option if you've been running Azure for a while (a month or more) or the on-prem virtual machine has been deleted.This option doesn't perform any checksum calculations.</span></span>
    >
    >




4. <span data-ttu-id="8c418-142">Se a criptografia de dados estiver habilitada para a nuvem, em **Chave de Criptografia**, selecione o certificado que foi emitido quando você habilitou a criptografia de dados durante a instalação do provedor no servidor VMM.</span><span class="sxs-lookup"><span data-stu-id="8c418-142">If data encryption is enabled for the cloud, in **Encryption Key** select the certificate that was issued when you enabled data encryption during Provider installation on the VMM server.</span></span>
5. <span data-ttu-id="8c418-143">Inicie o failover.</span><span class="sxs-lookup"><span data-stu-id="8c418-143">Initiate the failover.</span></span> <span data-ttu-id="8c418-144">Você pode acompanhar o progresso do failover na guia **Trabalhos** .</span><span class="sxs-lookup"><span data-stu-id="8c418-144">You can follow the failover progress on the **Jobs** tab.</span></span>
6. <span data-ttu-id="8c418-145">Se você selecionou a opção para sincronizar os dados antes do failover, depois que a sincronização de dados inicial for concluída e você estiver pronto para desligar as máquinas virtuais no Azure, clique em **Trabalhos** nome do trabalho de failover planejado **Concluir Failover**.</span><span class="sxs-lookup"><span data-stu-id="8c418-145">If you selected the option to synchronize the data before the failover, once the initial data synchronization is complete and you're ready to shut down the virtual machines in Azure, click **Jobs** planned failover job name **Complete Failover**.</span></span> <span data-ttu-id="8c418-146">Isso desliga a máquina do Azure, transfere as alterações mais recentes para a máquina virtual local e inicia a VM local.</span><span class="sxs-lookup"><span data-stu-id="8c418-146">This shuts down the Azure machine, transfers the latest changes to the on-premises virtual machine, and starts the VM on-premises.</span></span>
7. <span data-ttu-id="8c418-147">Agora você pode fazer logon na máquina virtual para confirmar se ela está disponível conforme esperado.</span><span class="sxs-lookup"><span data-stu-id="8c418-147">You can now log onto the virtual machine to validate it's available as expected.</span></span>
8. <span data-ttu-id="8c418-148">A máquina virtual está em um estado de confirmação pendente.</span><span class="sxs-lookup"><span data-stu-id="8c418-148">The virtual machine is in a commit pending state.</span></span> <span data-ttu-id="8c418-149">Clique em **Confirmar** para confirmar o failover.</span><span class="sxs-lookup"><span data-stu-id="8c418-149">Click **Commit** to commit the failover.</span></span>
9. <span data-ttu-id="8c418-150">Agora, para concluir o failback, clique em **Replicação Inversa** para iniciar a proteção da máquina virtual no site primário.</span><span class="sxs-lookup"><span data-stu-id="8c418-150">Now in order to complete the failback click **Reverse Replicate** to start protecting the virtual machine in the primary site.</span></span>

## <a name="failback-to-an-alternate-location"></a><span data-ttu-id="8c418-151">Failback em um local alternativo</span><span class="sxs-lookup"><span data-stu-id="8c418-151">Failback to an alternate location</span></span>
<span data-ttu-id="8c418-152">Se você implantou a proteção entre um [site do Hyper-V e o Azure](site-recovery-hyper-v-site-to-azure.md) , será possível fazer failback do Azure em um site local alternativo.</span><span class="sxs-lookup"><span data-stu-id="8c418-152">If you've deployed protection between a [Hyper-V site and Azure](site-recovery-hyper-v-site-to-azure.md) you have to ability to failback from Azure to an alternate on-premises location.</span></span> <span data-ttu-id="8c418-153">Isso é útil quando você precisa configurar novos hardwares locais.</span><span class="sxs-lookup"><span data-stu-id="8c418-153">This is useful if you need to set up new on-premises hardware.</span></span> <span data-ttu-id="8c418-154">Veja como fazer isso.</span><span class="sxs-lookup"><span data-stu-id="8c418-154">Here's how you do it.</span></span>

1. <span data-ttu-id="8c418-155">Se você estiver definindo um novo hardware, instale o Windows Server 2012 R2 e a função do Hyper-V no servidor.</span><span class="sxs-lookup"><span data-stu-id="8c418-155">If you're setting up new hardware install Windows Server 2012 R2 and the Hyper-V role on the server.</span></span>
2. <span data-ttu-id="8c418-156">Crie um comutador de rede virtual com o mesmo nome que você tinha no servidor original.</span><span class="sxs-lookup"><span data-stu-id="8c418-156">Create a virtual network switch with the same name that you had on the original server.</span></span>
3. <span data-ttu-id="8c418-157">Selecione **Itens Protegidos** -> **Grupo de Proteção** -> <ProtectionGroupName> -> <VirtualMachineName> do qual deseja realizar failback e selecione **Failover Planejado**.</span><span class="sxs-lookup"><span data-stu-id="8c418-157">Select **Protected Items** -> **Protection Group** -> <ProtectionGroupName> -> <VirtualMachineName> you want to fail back, and select **Planned Failover**.</span></span>
4. <span data-ttu-id="8c418-158">Em **Confirmar Failover Planejado** select **Criar máquina virtual local se ela não existir**.</span><span class="sxs-lookup"><span data-stu-id="8c418-158">In **Confirm Planned Failover** select **Create on-premises virtual machine if it does not exist**.</span></span>
5. <span data-ttu-id="8c418-159">Em **Nome do Host** , selecione o novo servidor host do Hyper-V no qual deseja colocar a máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="8c418-159">In **Host Name** select the new Hyper-V host server on which you want to place the virtual machine.</span></span>
6. <span data-ttu-id="8c418-160">Em Sincronização de Dados, é recomendável selecionar a opção **Sincronizar os dados antes do failover**.</span><span class="sxs-lookup"><span data-stu-id="8c418-160">In Data Synchronization we recommend you select  the option **Synchronize the data before the failover**.</span></span> <span data-ttu-id="8c418-161">Essa opção minimiza o tempo de inatividade das máquinas virtuais, uma vez que faz a sincronização sem desligá-las.</span><span class="sxs-lookup"><span data-stu-id="8c418-161">This minimizes downtime for virtual machines as it synchronizes without shutting them down.</span></span> <span data-ttu-id="8c418-162">Ele faz o seguinte:</span><span class="sxs-lookup"><span data-stu-id="8c418-162">It does the following:</span></span>

   * <span data-ttu-id="8c418-163">Fase 1: tira instantâneo da máquina virtual no Azure e o copia no host do Hyper-V local.</span><span class="sxs-lookup"><span data-stu-id="8c418-163">Phase 1: Takes snapshot of the virtual machine in Azure and copies it to the on-premises Hyper-V host.</span></span> <span data-ttu-id="8c418-164">O computador continua em execução no Azure.</span><span class="sxs-lookup"><span data-stu-id="8c418-164">The machine continues running in Azure.</span></span>
   * <span data-ttu-id="8c418-165">Fase 2: Desliga a máquina virtual no Azure para que nenhuma alteração seja feita lá.</span><span class="sxs-lookup"><span data-stu-id="8c418-165">Phase 2: Shuts down the virtual machine in Azure so that no new changes occur there.</span></span> <span data-ttu-id="8c418-166">O conjunto final de alterações é transferido para o servidor local e a máquina virtual local é inicializada.</span><span class="sxs-lookup"><span data-stu-id="8c418-166">The final set of changes are transferred to the on-premises server and the on-premises virtual machine is started up.</span></span>
7. <span data-ttu-id="8c418-167">Clique na marca de seleção para iniciar o failover (failback).</span><span class="sxs-lookup"><span data-stu-id="8c418-167">Click the checkmark to begin the failover (failback).</span></span>
8. <span data-ttu-id="8c418-168">Depois que sincronização inicial for finalizada e você estiver pronto para desligar a máquina virtual no Azure, clique em **Trabalhos** > <planned failover job> > **Concluir Failover**.</span><span class="sxs-lookup"><span data-stu-id="8c418-168">After the initial synchronization finishes and you're ready to shut down the virtual machine in Azure, click **Jobs** > <planned failover job> > **Complete Failover**.</span></span> <span data-ttu-id="8c418-169">Isso desliga a máquina do Azure, transfere as alterações mais recentes para a máquina virtual local e a inicia.</span><span class="sxs-lookup"><span data-stu-id="8c418-169">This shuts down the Azure machine, transfers the latest changes to the on-premises virtual machine and starts it.</span></span>
9. <span data-ttu-id="8c418-170">Você pode fazer logon na máquina virtual no local para verificar se tudo está funcionando conforme esperado.</span><span class="sxs-lookup"><span data-stu-id="8c418-170">You can log onto the on-premises virtual machine to verify everything is working as expected.</span></span> <span data-ttu-id="8c418-171">Em seguida, clique em **Confirmar** para concluir o failover.</span><span class="sxs-lookup"><span data-stu-id="8c418-171">Then click **Commit** to finish the failover.</span></span>
10. <span data-ttu-id="8c418-172">Clique em **Replicação Inversa** para iniciar a proteção da máquina virtual local.</span><span class="sxs-lookup"><span data-stu-id="8c418-172">Click **Reverse Replicate** to start protecting the on-premises virtual machine.</span></span>

    > [!NOTE]
    > <span data-ttu-id="8c418-173">Se você cancelar o trabalho de failback durante a etapa de Sincronização de Dados, a VM local ficará em um estado corrompido.</span><span class="sxs-lookup"><span data-stu-id="8c418-173">If you cancel the failback job while it is in Data Synchronization step, the on-premises VM will be in a corrupted state.</span></span> <span data-ttu-id="8c418-174">Isso ocorre porque a Sincronização de Dados copia os dados mais recentes dos discos da VM do Azure para os discos de dados locais e, até que a sincronização seja concluída, o disco de dados pode não estar em um estado consistente.</span><span class="sxs-lookup"><span data-stu-id="8c418-174">This is because Data Synchronization copies the latest data from Azure VM disks to the on-prem data disks, and until the synchronization completes, the disk data may not be in a consistent state.</span></span> <span data-ttu-id="8c418-175">Se a VM local for inicializada após o cancelamento da Sincronização de Dados, talvez ela não seja inicializada.</span><span class="sxs-lookup"><span data-stu-id="8c418-175">If the On-prem VM is booted after Data Synchronization is canceled, it may not boot.</span></span> <span data-ttu-id="8c418-176">Dispare novamente o failover para concluir a Sincronização de Dados.</span><span class="sxs-lookup"><span data-stu-id="8c418-176">Re-trigger failover to complete the Data Synchronization.</span></span>
    >
    >



## <a name="next-steps"></a><span data-ttu-id="8c418-177">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="8c418-177">Next Steps</span></span>

<span data-ttu-id="8c418-178">Depois de concluir o trabalho de failback, **Confirme** a máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="8c418-178">Once you have completed the failback job, **Commit** the virtual machine.</span></span> <span data-ttu-id="8c418-179">A confirmação exclui a máquina virtual do Azure e seus discos e prepara a VM para ser protegida novamente.</span><span class="sxs-lookup"><span data-stu-id="8c418-179">Commit deletes the Azure virtual machine and its disks and prepares the VM to be protected again.</span></span>

<span data-ttu-id="8c418-180">Depois de **Confirmar**, você poderá iniciar a *Replicação Inversa*.</span><span class="sxs-lookup"><span data-stu-id="8c418-180">After **Commit**, you can initiate the *Reverse Replicate*.</span></span> <span data-ttu-id="8c418-181">Isso iniciará a proteção da máquina virtual do local para o Azure.</span><span class="sxs-lookup"><span data-stu-id="8c418-181">This will start protecting the virtual machine from on-premises back to Azure.</span></span> <span data-ttu-id="8c418-182">Observe que isso só replicará as alterações, pois a VM foi desativada no Azure e, assim, enviará somente alterações diferenciais.</span><span class="sxs-lookup"><span data-stu-id="8c418-182">Note that this will only replicate the changes since the VM has been turned off in Azure and hence sends differential changes only.</span></span>
