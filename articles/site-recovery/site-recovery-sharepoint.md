---
title: "Replicar um aplicativo do SharePoint de várias camadas usando o Azure Site Recovery | Microsoft Docs"
description: "Este artigo descreve como replicar um aplicativo do SharePoint de várias camadas usando funcionalidades do Azure Site Recovery."
services: site-recovery
documentationcenter: 
author: sujayt
manager: rochakm
editor: 
ms.assetid: 
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/10/2017
ms.author: sutalasi
ms.openlocfilehash: 9c0570b9da661a8ffb0041e5c24905480f55f6e2
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="replicate-a-multi-tier-sharepoint-application-for-disaster-recovery-using-azure-site-recovery"></a><span data-ttu-id="b1f45-103">Replicar um aplicativo do SharePoint de várias camadas para recuperação de desastre usando funcionalidades do Azure Site Recovery</span><span class="sxs-lookup"><span data-stu-id="b1f45-103">Replicate a multi-tier SharePoint application for disaster recovery using Azure Site Recovery</span></span>

<span data-ttu-id="b1f45-104">Este artigo descreve detalhadamente como proteger um aplicativo do SharePoint usando o [Azure Site Recovery](site-recovery-overview.md).</span><span class="sxs-lookup"><span data-stu-id="b1f45-104">This article describes in detail how to protect a SharePoint application using  [Azure Site Recovery](site-recovery-overview.md).</span></span>


## <a name="overview"></a><span data-ttu-id="b1f45-105">Visão geral</span><span class="sxs-lookup"><span data-stu-id="b1f45-105">Overview</span></span>

<span data-ttu-id="b1f45-106">O Microsoft SharePoint é um aplicativo avançado que pode ajudar um grupo ou departamento a organizar, colaborar com e compartilhar informações.</span><span class="sxs-lookup"><span data-stu-id="b1f45-106">Microsoft SharePoint is a powerful application that can help a group or department organize, collaborate, and share information.</span></span> <span data-ttu-id="b1f45-107">O SharePoint pode fornecer portais de intranet, gerenciamento de arquivos e documentos, colaboração, redes sociais, extranets, sites, Enterprise Search e business intelligence.</span><span class="sxs-lookup"><span data-stu-id="b1f45-107">SharePoint can provide intranet portals, document and file management, collaboration, social networks, extranets, websites, enterprise search, and business intelligence.</span></span> <span data-ttu-id="b1f45-108">Ele também tem integração de sistemas, integração de processos e funcionalidades de automação de fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="b1f45-108">It also has system integration, process integration, and workflow automation capabilities.</span></span> <span data-ttu-id="b1f45-109">Normalmente, as organizações o consideram um aplicativo de camada 1, suscetível a tempo de inatividade e perda de dados.</span><span class="sxs-lookup"><span data-stu-id="b1f45-109">Typically, organizations consider it as a Tier-1 application sensitive to downtime and data loss.</span></span>

<span data-ttu-id="b1f45-110">Hoje, o Microsoft SharePoint não fornece nenhuma funcionalidade integrada de recuperação de desastre.</span><span class="sxs-lookup"><span data-stu-id="b1f45-110">Today, Microsoft SharePoint  does not provide any out-of-the-box disaster recovery capabilities.</span></span> <span data-ttu-id="b1f45-111">Independentemente do tipo e escala de um desastre, a recuperação envolve o uso de um data center em espera para o qual você pode recuperar o farm.</span><span class="sxs-lookup"><span data-stu-id="b1f45-111">Regardless of the type and scale of a disaster, recovery involves the use of a standby data center that you can recover the farm to.</span></span> <span data-ttu-id="b1f45-112">Data centers em espera são necessários para cenários nos quais não é possível recuperar sistemas redundantes locais e backups da interrupção no data center principal.</span><span class="sxs-lookup"><span data-stu-id="b1f45-112">Standby data centers are required for scenarios where local redundant systems and backups cannot recover from the outage at the primary data center.</span></span>

<span data-ttu-id="b1f45-113">Uma boa solução de recuperação de desastre deve permitir a modelagem de planos de recuperação em torno de arquiteturas de aplicativo complexas, como o SharePoint.</span><span class="sxs-lookup"><span data-stu-id="b1f45-113">A good disaster recovery solution should allow modeling of recovery plans around the  complex application architectures such as SharePoint.</span></span> <span data-ttu-id="b1f45-114">Ela também deve ter a capacidade de adicionar etapas personalizadas para lidar com mapeamentos de aplicativo entre várias camadas, fornecendo assim um failover de clique único com um RTO mais baixo em caso de desastre.</span><span class="sxs-lookup"><span data-stu-id="b1f45-114">It should also have the ability to add customized steps to handle application mappings between various tiers and hence providing a single-click failover with a lower RTO in the event of a disaster.</span></span>

<span data-ttu-id="b1f45-115">Este artigo descreve detalhadamente como proteger um aplicativo do SharePoint usando o [Azure Site Recovery](site-recovery-overview.md).</span><span class="sxs-lookup"><span data-stu-id="b1f45-115">This article describes in detail how to protect a SharePoint application using [Azure Site Recovery](site-recovery-overview.md).</span></span> <span data-ttu-id="b1f45-116">Este artigo abordará as práticas recomendadas para a replicação de um aplicativo do SharePoint no Azure, como você pode fazer uma análise de recuperação de desastre e como é possível realizar o failover do aplicativo no Azure.</span><span class="sxs-lookup"><span data-stu-id="b1f45-116">This article will cover best practices for replicating a three tier SharePoint application to Azure, how you can do a disaster recovery drill, and how you can failover the application to Azure.</span></span>

<span data-ttu-id="b1f45-117">Você pode assistir ao vídeo abaixo sobre como recuperar um aplicativo de várias camadas para o Azure.</span><span class="sxs-lookup"><span data-stu-id="b1f45-117">You can watch the below video about recovering a multi tier application to Azure.</span></span>

> [!VIDEO https://channel9.msdn.com/Series/Azure-Site-Recovery/Disaster-Recovery-of-load-balanced-multi-tier-applications-using-Azure-Site-Recovery/player]


## <a name="prerequisites"></a><span data-ttu-id="b1f45-118">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="b1f45-118">Prerequisites</span></span>

<span data-ttu-id="b1f45-119">Antes de começar, você precisa entender o seguinte:</span><span class="sxs-lookup"><span data-stu-id="b1f45-119">Before you start, make sure you understand the following:</span></span>

1. [<span data-ttu-id="b1f45-120">Replicar uma máquina virtual no Azure</span><span class="sxs-lookup"><span data-stu-id="b1f45-120">Replicating a virtual machine to Azure</span></span>](site-recovery-vmware-to-azure.md)
2. <span data-ttu-id="b1f45-121">Como [criar uma rede de recuperação](site-recovery-network-design.md)</span><span class="sxs-lookup"><span data-stu-id="b1f45-121">How to [design a recovery network](site-recovery-network-design.md)</span></span>
3. [<span data-ttu-id="b1f45-122">Executar um failover de teste no Azure</span><span class="sxs-lookup"><span data-stu-id="b1f45-122">Doing a test failover to Azure</span></span>](site-recovery-test-failover-to-azure.md)
4. [<span data-ttu-id="b1f45-123">Executar um failover no Azure</span><span class="sxs-lookup"><span data-stu-id="b1f45-123">Doing a failover to Azure</span></span>](site-recovery-failover.md)
5. <span data-ttu-id="b1f45-124">Como [replicar um controlador de domínio](site-recovery-active-directory.md)</span><span class="sxs-lookup"><span data-stu-id="b1f45-124">How to [replicate a domain controller](site-recovery-active-directory.md)</span></span>
6. <span data-ttu-id="b1f45-125">Como [replicar o SQL Server](site-recovery-sql.md)</span><span class="sxs-lookup"><span data-stu-id="b1f45-125">How to [replicate SQL Server](site-recovery-sql.md)</span></span>

## <a name="sharepoint-architecture"></a><span data-ttu-id="b1f45-126">Arquitetura do SharePoint</span><span class="sxs-lookup"><span data-stu-id="b1f45-126">SharePoint architecture</span></span>

<span data-ttu-id="b1f45-127">O SharePoint pode ser implantado em um ou mais servidores usando topologias em camadas e funções de servidor para implementar um design de farm que cumpra metas e objetivos específicos.</span><span class="sxs-lookup"><span data-stu-id="b1f45-127">SharePoint can be deployed on one or more servers using tiered topologies and server roles to implement a farm design that meets specific goals and objectives.</span></span> <span data-ttu-id="b1f45-128">Um farm grande e de alta demanda típico do SharePoint Server, que dá suporte a um grande número de usuários simultâneos e um grande número de itens de conteúdo usam o agrupamento de serviços como parte de sua estratégia de escalabilidade.</span><span class="sxs-lookup"><span data-stu-id="b1f45-128">A typical large, high-demand SharePoint server farm that supports a high number of concurrent users and a large number of content items use service grouping as part of their scalability strategy.</span></span> <span data-ttu-id="b1f45-129">Essa abordagem envolve a execução de serviços em servidores dedicados, agrupando esses serviços e depois expandindo os servidores como um grupo.</span><span class="sxs-lookup"><span data-stu-id="b1f45-129">This approach involves running services on dedicated servers, grouping these services together, and then scaling out the servers as a group.</span></span> <span data-ttu-id="b1f45-130">A topologia a seguir ilustra o serviço agrupamento de serviços e servidores para um farm do SharePoint Server de três camadas.</span><span class="sxs-lookup"><span data-stu-id="b1f45-130">The following topology illustrates the service and server grouping for a three tier SharePoint server farm.</span></span> <span data-ttu-id="b1f45-131">Consulte a documentação do SharePoint e arquiteturas de linha de produto para obter diretrizes detalhadas sobre diferentes topologias do SharePoint.</span><span class="sxs-lookup"><span data-stu-id="b1f45-131">Please refer to SharePoint documentation and product line architectures for detailed guidance on different SharePoint topologies.</span></span> <span data-ttu-id="b1f45-132">Você pode encontrar mais detalhes sobre a implantação do SharePoint 2013 [neste documento](https://technet.microsoft.com/en-us/library/cc303422.aspx).</span><span class="sxs-lookup"><span data-stu-id="b1f45-132">You can find more details about SharePoint 2013 deployment in [this document](https://technet.microsoft.com/en-us/library/cc303422.aspx).</span></span>



![Padrão de Implantação 1](./media/site-recovery-sharepoint/sharepointarch.png)


## <a name="site-recovery-support"></a><span data-ttu-id="b1f45-134">Suporte do Site Recovery</span><span class="sxs-lookup"><span data-stu-id="b1f45-134">Site Recovery support</span></span>

<span data-ttu-id="b1f45-135">Para criar este artigo, usamos as máquinas virtuais VMware com o Windows Server 2012 R2 Enterprise.</span><span class="sxs-lookup"><span data-stu-id="b1f45-135">For creating this article, VMware virtual machines with Windows Server 2012 R2 Enterprise were used.</span></span> <span data-ttu-id="b1f45-136">Foram usados o SharePoint 2013 Enterprise edition e o SQL Server 2014 Enterprise edition.</span><span class="sxs-lookup"><span data-stu-id="b1f45-136">SharePoint 2013 Enterprise edition and SQL server 2014 Enterprise edition were used.</span></span> <span data-ttu-id="b1f45-137">Já que a replicação do Site Recovery é independente do aplicativo, as recomendações fornecidas aqui devem servir também para os cenários a seguir.</span><span class="sxs-lookup"><span data-stu-id="b1f45-137">As Site Recovery replication is application agnostic, the recommendations provided here are expected to hold on for following scenarios as well.</span></span>

### <a name="source-and-target"></a><span data-ttu-id="b1f45-138">Origem e destino</span><span class="sxs-lookup"><span data-stu-id="b1f45-138">Source and target</span></span>

<span data-ttu-id="b1f45-139">**Cenário**</span><span class="sxs-lookup"><span data-stu-id="b1f45-139">**Scenario**</span></span> | <span data-ttu-id="b1f45-140">**Para um site secundário**</span><span class="sxs-lookup"><span data-stu-id="b1f45-140">**To a secondary site**</span></span> | <span data-ttu-id="b1f45-141">**Para o Azure**</span><span class="sxs-lookup"><span data-stu-id="b1f45-141">**To Azure**</span></span>
--- | --- | ---
<span data-ttu-id="b1f45-142">**Hyper-V**</span><span class="sxs-lookup"><span data-stu-id="b1f45-142">**Hyper-V**</span></span> | <span data-ttu-id="b1f45-143">Sim</span><span class="sxs-lookup"><span data-stu-id="b1f45-143">Yes</span></span> | <span data-ttu-id="b1f45-144">Sim</span><span class="sxs-lookup"><span data-stu-id="b1f45-144">Yes</span></span>
<span data-ttu-id="b1f45-145">**VMware**</span><span class="sxs-lookup"><span data-stu-id="b1f45-145">**VMware**</span></span> | <span data-ttu-id="b1f45-146">Sim</span><span class="sxs-lookup"><span data-stu-id="b1f45-146">Yes</span></span> | <span data-ttu-id="b1f45-147">Sim</span><span class="sxs-lookup"><span data-stu-id="b1f45-147">Yes</span></span>
<span data-ttu-id="b1f45-148">**Servidor físico**</span><span class="sxs-lookup"><span data-stu-id="b1f45-148">**Physical server**</span></span> | <span data-ttu-id="b1f45-149">Sim</span><span class="sxs-lookup"><span data-stu-id="b1f45-149">Yes</span></span> | <span data-ttu-id="b1f45-150">Sim</span><span class="sxs-lookup"><span data-stu-id="b1f45-150">Yes</span></span>

### <a name="sharepoint-versions"></a><span data-ttu-id="b1f45-151">Versões do SharePoint</span><span class="sxs-lookup"><span data-stu-id="b1f45-151">SharePoint Versions</span></span>
<span data-ttu-id="b1f45-152">Há suporte para as seguintes versões do SharePoint Server.</span><span class="sxs-lookup"><span data-stu-id="b1f45-152">The following SharePoint server versions are supported.</span></span>

* <span data-ttu-id="b1f45-153">SharePoint Server 2013 Standard</span><span class="sxs-lookup"><span data-stu-id="b1f45-153">SharePoint server 2013 Standard</span></span>
* <span data-ttu-id="b1f45-154">SharePoint Server 2013 Enterprise</span><span class="sxs-lookup"><span data-stu-id="b1f45-154">SharePoint server 2013 Enterprise</span></span>
* <span data-ttu-id="b1f45-155">SharePoint Server 2016 Standard</span><span class="sxs-lookup"><span data-stu-id="b1f45-155">SharePoint server 2016 Standard</span></span>
* <span data-ttu-id="b1f45-156">SharePoint Server 2016 Enterprise</span><span class="sxs-lookup"><span data-stu-id="b1f45-156">SharePoint server 2016 Enterprise</span></span>

### <a name="things-to-keep-in-mind"></a><span data-ttu-id="b1f45-157">Algumas coisas que se deve manter em mente</span><span class="sxs-lookup"><span data-stu-id="b1f45-157">Things to keep in mind</span></span>

<span data-ttu-id="b1f45-158">Se você estiver usando um cluster baseado em disco compartilhado como qualquer camada em seu aplicativo, você não poderá usar a replicação do Site Recovery para replicar essas máquinas virtuais.</span><span class="sxs-lookup"><span data-stu-id="b1f45-158">If you are using a shared disk-based cluster as any tier in your application then you will not be able to use Site Recovery replication to replicate those virtual machines.</span></span> <span data-ttu-id="b1f45-159">Você pode usar replicação nativa fornecida pelo aplicativo e, em seguida, usar um [plano de recuperação](site-recovery-create-recovery-plans.md) para fazer failover de todas as camadas.</span><span class="sxs-lookup"><span data-stu-id="b1f45-159">You can use native replication provided by the application and then use a [recovery plan](site-recovery-create-recovery-plans.md) to failover all tiers.</span></span>

## <a name="replicating-virtual-machines"></a><span data-ttu-id="b1f45-160">Replicação de máquinas virtuais</span><span class="sxs-lookup"><span data-stu-id="b1f45-160">Replicating virtual machines</span></span>

<span data-ttu-id="b1f45-161">Siga [estas diretrizes](site-recovery-vmware-to-azure.md) para começar a replicar a máquina virtual para o Azure.</span><span class="sxs-lookup"><span data-stu-id="b1f45-161">Follow [this guidance](site-recovery-vmware-to-azure.md) to start replicating the virtual machine to Azure.</span></span>

* <span data-ttu-id="b1f45-162">Depois que a replicação for concluída, certifique-se de ir para cada máquina virtual de cada camada e selecionar o mesmo conjunto de disponibilidade em 'Item replicado > Configurações > Propriedades > Computação e Rede'.</span><span class="sxs-lookup"><span data-stu-id="b1f45-162">Once the replication is complete, make sure you go to each virtual machine of each tier and select same availability set in 'Replicated item > Settings > Properties > Compute and Network'.</span></span> <span data-ttu-id="b1f45-163">Por exemplo, se sua camada Web tem 3 VMs, certifique-se de que todas as 3 VMs estejam configuradas para fazer parte do mesmo conjunto de disponibilidade no Azure.</span><span class="sxs-lookup"><span data-stu-id="b1f45-163">For example, if your web tier has 3 VMs, ensure all the 3 VMs are configured to be part of same availability set in Azure.</span></span>

    ![Definir Conjunto de Disponibilidade](./media/site-recovery-sharepoint/select-av-set.png)

* <span data-ttu-id="b1f45-165">Para obter diretrizes sobre como proteger o Active Directory e DNS, consulte o documento [Proteger o Active Directory e DNS](site-recovery-active-directory.md).</span><span class="sxs-lookup"><span data-stu-id="b1f45-165">For guidance on protecting Active Directory and DNS, refer to [Protect Active Directory and DNS](site-recovery-active-directory.md) document.</span></span>

* <span data-ttu-id="b1f45-166">Para obter diretrizes sobre como proteger a camada de banco de dados em execução no SQL Server, consulte o documento [Proteger o SQL Server](site-recovery-active-directory.md).</span><span class="sxs-lookup"><span data-stu-id="b1f45-166">For guidance on protecting database tier running on SQL server, refer to [Protect SQL Server](site-recovery-active-directory.md) document.</span></span>

## <a name="networking-configuration"></a><span data-ttu-id="b1f45-167">Configuração de rede</span><span class="sxs-lookup"><span data-stu-id="b1f45-167">Networking configuration</span></span>

### <a name="network-properties"></a><span data-ttu-id="b1f45-168">Propriedades da rede</span><span class="sxs-lookup"><span data-stu-id="b1f45-168">Network properties</span></span>

* <span data-ttu-id="b1f45-169">Para as VMs de camada da Web e de Aplicativo, defina configurações de rede no Portal do Azure para que as VMs sejam anexadas à rede de DR correta após o failover.</span><span class="sxs-lookup"><span data-stu-id="b1f45-169">For the App and Web tier VMs, configure network settings in Azure portal so that the VMs get attached to the right DR network after failover.</span></span>

    ![Selecionar Rede](./media/site-recovery-sharepoint/select-network.png)


* <span data-ttu-id="b1f45-171">Se você estiver usando um IP estático, especifique o IP que você deseja usar na máquina virtual no campo **IP de Destino**</span><span class="sxs-lookup"><span data-stu-id="b1f45-171">If you are using a static IP, then specify the IP that you want the virtual machine to take in the **Target IP** field</span></span>

    ![Definir o IP Estático](./media/site-recovery-sharepoint/set-static-ip.png)

### <a name="dns-and-traffic-routing"></a><span data-ttu-id="b1f45-173">Roteamento de Tráfego e de DNS</span><span class="sxs-lookup"><span data-stu-id="b1f45-173">DNS and Traffic Routing</span></span>

<span data-ttu-id="b1f45-174">Para sites voltados para a Internet, [crie um perfil do Gerenciador de Tráfego do tipo 'Prioridade'](../traffic-manager/traffic-manager-create-profile.md) na assinatura do Azure.</span><span class="sxs-lookup"><span data-stu-id="b1f45-174">For internet facing sites, [create a Traffic Manager profile of 'Priority' type](../traffic-manager/traffic-manager-create-profile.md) in the Azure subscription.</span></span> <span data-ttu-id="b1f45-175">Em seguida, configure seu perfil do Gerenciador de Tráfego e de DNS da maneira descrita a seguir.</span><span class="sxs-lookup"><span data-stu-id="b1f45-175">And then configure your DNS and Traffic Manager profile in the following manner.</span></span>


| <span data-ttu-id="b1f45-176">**Onde**</span><span class="sxs-lookup"><span data-stu-id="b1f45-176">**Where**</span></span> | <span data-ttu-id="b1f45-177">**Fonte**</span><span class="sxs-lookup"><span data-stu-id="b1f45-177">**Source**</span></span> | <span data-ttu-id="b1f45-178">**Destino**</span><span class="sxs-lookup"><span data-stu-id="b1f45-178">**Target**</span></span>|
| --- | --- | --- |
| <span data-ttu-id="b1f45-179">DNS público</span><span class="sxs-lookup"><span data-stu-id="b1f45-179">Public DNS</span></span> | <span data-ttu-id="b1f45-180">DNS público para sites do SharePoint</span><span class="sxs-lookup"><span data-stu-id="b1f45-180">Public DNS for SharePoint sites</span></span> <br/><br/> <span data-ttu-id="b1f45-181">Por exemplo: sharepoint.contoso.com</span><span class="sxs-lookup"><span data-stu-id="b1f45-181">Ex: sharepoint.contoso.com</span></span> | <span data-ttu-id="b1f45-182">Gerenciador de Tráfego</span><span class="sxs-lookup"><span data-stu-id="b1f45-182">Traffic Manager</span></span> <br/><br/> <span data-ttu-id="b1f45-183">contososharepoint.trafficmanager.net</span><span class="sxs-lookup"><span data-stu-id="b1f45-183">contososharepoint.trafficmanager.net</span></span> |
| <span data-ttu-id="b1f45-184">DNS local</span><span class="sxs-lookup"><span data-stu-id="b1f45-184">On-premises DNS</span></span> | <span data-ttu-id="b1f45-185">sharepointonprem.contoso.com</span><span class="sxs-lookup"><span data-stu-id="b1f45-185">sharepointonprem.contoso.com</span></span> | <span data-ttu-id="b1f45-186">IP público no farm local</span><span class="sxs-lookup"><span data-stu-id="b1f45-186">Public IP on the on-premises farm</span></span> |


<span data-ttu-id="b1f45-187">No perfil do Gerenciador de Tráfego, [crie os pontos de extremidade primário e de recuperação](../traffic-manager/traffic-manager-configure-priority-routing-method.md).</span><span class="sxs-lookup"><span data-stu-id="b1f45-187">In the Traffic Manager profile, [create the primary and recovery endpoints](../traffic-manager/traffic-manager-configure-priority-routing-method.md).</span></span> <span data-ttu-id="b1f45-188">Use o ponto de extremidade externo como ponto de extremidade local e o IP público como ponto de extremidade do Azure.</span><span class="sxs-lookup"><span data-stu-id="b1f45-188">Use the external endpoint for on-premises endpoint and public IP for Azure endpoint.</span></span> <span data-ttu-id="b1f45-189">Verifique se a prioridade está definida como mais alta para o ponto de extremidade local.</span><span class="sxs-lookup"><span data-stu-id="b1f45-189">Ensure that the priority is set higher to on-premises endpoint.</span></span>

<span data-ttu-id="b1f45-190">Hospede uma página de teste em uma porta específica (por exemplo, 800) na camada da Web do SharePoint para o Gerenciador de Tráfego para detectar automaticamente o failover de postagem de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="b1f45-190">Host a test page on a specific port (for example, 800) in the SharePoint web tier in order for Traffic Manager to automatically detect availability post failover.</span></span> <span data-ttu-id="b1f45-191">Essa é uma solução alternativa caso você não possa habilitar a autenticação anônima em nenhum dos seus sites do SharePoint.</span><span class="sxs-lookup"><span data-stu-id="b1f45-191">This is a workaround in case you cannot enable anonymous authentication on any of your SharePoint sites.</span></span>

<span data-ttu-id="b1f45-192">[Configure o perfil do Gerenciador de Tráfego](../traffic-manager/traffic-manager-configure-priority-routing-method.md) com as configurações abaixo.</span><span class="sxs-lookup"><span data-stu-id="b1f45-192">[Configure the Traffic Manager profile](../traffic-manager/traffic-manager-configure-priority-routing-method.md) with the below settings.</span></span>

* <span data-ttu-id="b1f45-193">Método de roteamento – 'Prioridade'</span><span class="sxs-lookup"><span data-stu-id="b1f45-193">Routing method - 'Priority'</span></span>
* <span data-ttu-id="b1f45-194">Vida útil (TTL) do DNS – '30 segundos'</span><span class="sxs-lookup"><span data-stu-id="b1f45-194">DNS time to live (TTL) - '30 seconds'</span></span>
* <span data-ttu-id="b1f45-195">Configurações do monitor de ponto de extremidade – se você pode habilitar a autenticação anônima, pode também fornecer um ponto de extremidade de site específico.</span><span class="sxs-lookup"><span data-stu-id="b1f45-195">Endpoint monitor settings - If you can enable anonymous authentication, you can give a specific website endpoint.</span></span> <span data-ttu-id="b1f45-196">Ou então, você pode usar uma página de teste em uma porta específica (por exemplo, 800).</span><span class="sxs-lookup"><span data-stu-id="b1f45-196">Or, you can use a test page on a specific port (for example, 800).</span></span>

## <a name="creating-a-recovery-plan"></a><span data-ttu-id="b1f45-197">Criar um plano de recuperação</span><span class="sxs-lookup"><span data-stu-id="b1f45-197">Creating a recovery plan</span></span>

<span data-ttu-id="b1f45-198">Um plano de recuperação permite o sequenciamento do failover de várias camadas em um aplicativo de várias camadas, mantendo assim a consistência do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b1f45-198">A recovery plan allows sequencing the failover of various tiers in a multi-tier application, hence, maintaining application consistency.</span></span> <span data-ttu-id="b1f45-199">Execute as etapas abaixo ao criar um plano de recuperação para um aplicativo Web de várias camadas.</span><span class="sxs-lookup"><span data-stu-id="b1f45-199">Follow the below steps while creating a recovery plan for a multi-tier web application.</span></span> <span data-ttu-id="b1f45-200">[Saiba mais sobre a criação de um plano de recuperação](site-recovery-runbook-automation.md#customize-the-recovery-plan).</span><span class="sxs-lookup"><span data-stu-id="b1f45-200">[Learn more about creating a recovery plan](site-recovery-runbook-automation.md#customize-the-recovery-plan).</span></span>

### <a name="adding-virtual-machines-to-failover-groups"></a><span data-ttu-id="b1f45-201">Adicionar máquinas virtuais aos grupos de failover</span><span class="sxs-lookup"><span data-stu-id="b1f45-201">Adding virtual machines to failover groups</span></span>

1. <span data-ttu-id="b1f45-202">Crie um plano de recuperação adicionando as VMs de camada da Web e de Aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b1f45-202">Create a recovery plan by adding the App and Web tier VMs.</span></span>
2. <span data-ttu-id="b1f45-203">Clique em 'Personalizar' para agrupar as VMs.</span><span class="sxs-lookup"><span data-stu-id="b1f45-203">Click on 'Customize' to group the VMs.</span></span> <span data-ttu-id="b1f45-204">Por padrão, todas as VMs são parte do 'Grupo 1'.</span><span class="sxs-lookup"><span data-stu-id="b1f45-204">By default, all VMs are part of 'Group 1'.</span></span>

    ![Personalizar RP](./media/site-recovery-sharepoint/rp-groups.png)

3. <span data-ttu-id="b1f45-206">Crie outro grupo (Grupo 2) e mova as VMs de camada da Web para o novo grupo.</span><span class="sxs-lookup"><span data-stu-id="b1f45-206">Create another Group (Group 2) and move the Web tier VMs into the new group.</span></span> <span data-ttu-id="b1f45-207">Suas VMs de camada de aplicativo devem ser parte do 'Grupo 1' e as VMs de camada da Web devem ser parte do 'Grupo 2'.</span><span class="sxs-lookup"><span data-stu-id="b1f45-207">Your App tier VMs should be part of 'Group 1' and Web tier VMs should be part of 'Group 2'.</span></span> <span data-ttu-id="b1f45-208">Isso é para garantir que a inicialização das VMs de camada de Aplicativo ocorra primeiro, seguidas das VMs de camada da Web.</span><span class="sxs-lookup"><span data-stu-id="b1f45-208">This is to ensure that the App tier VMs boot up first followed by Web tier VMs.</span></span>


### <a name="adding-scripts-to-the-recovery-plan"></a><span data-ttu-id="b1f45-209">Adicionar scripts ao plano de recuperação</span><span class="sxs-lookup"><span data-stu-id="b1f45-209">Adding scripts to the recovery plan</span></span>

<span data-ttu-id="b1f45-210">Você pode implantar os scripts do Azure Site Recovery mais comumente usados em sua conta de automação clicando no botão 'Implantar no Azure' abaixo.</span><span class="sxs-lookup"><span data-stu-id="b1f45-210">You can deploy the most commonly used Azure Site Recovery scripts into your Automation account clicking the 'Deploy to Azure' button below.</span></span> <span data-ttu-id="b1f45-211">Quando você estiver usando qualquer script publicado, verifique se seguiu as diretrizes no script.</span><span class="sxs-lookup"><span data-stu-id="b1f45-211">When you are using any published script, ensure you follow the guidance in the script.</span></span>

<span data-ttu-id="b1f45-212">[![Implantar no Azure](https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c4803408-340e-49e3-9a1f-0ed3f689813d.png)](https://aka.ms/asr-automationrunbooks-deploy)</span><span class="sxs-lookup"><span data-stu-id="b1f45-212">[![Deploy to Azure](https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c4803408-340e-49e3-9a1f-0ed3f689813d.png)](https://aka.ms/asr-automationrunbooks-deploy)</span></span>

1. <span data-ttu-id="b1f45-213">Adicione um script de ação prévia para o 'Grupo 1' para fazer failover do grupo de Disponibilidade do SQL.</span><span class="sxs-lookup"><span data-stu-id="b1f45-213">Add a pre-action script to 'Group 1' to failover SQL Availability group.</span></span> <span data-ttu-id="b1f45-214">Use o script 'ASR-SQL-FailoverAG' publicado nos scripts de exemplo.</span><span class="sxs-lookup"><span data-stu-id="b1f45-214">Use the 'ASR-SQL-FailoverAG' script published in the sample scripts.</span></span> <span data-ttu-id="b1f45-215">Verifique se você seguiu as diretrizes no script e faça adequadamente as alterações necessárias no script.</span><span class="sxs-lookup"><span data-stu-id="b1f45-215">Ensure you follow the guidance in the script and make the required changes in the script appropriately.</span></span>

    ![Add-AG-Script-Step-1](./media/site-recovery-sharepoint/add-ag-script-step1.png)

    ![Add-AG-Script-Step-2](./media/site-recovery-sharepoint/add-ag-script-step2.png)

2. <span data-ttu-id="b1f45-218">Adicione um script de ação posterior para anexar um balanceador de carga a máquinas virtuais da camada da Web (Grupo 2) nas quais o failover foi realizado.</span><span class="sxs-lookup"><span data-stu-id="b1f45-218">Add a post action script to attach a load balancer on the failed over virtual machines of Web tier (Group 2).</span></span> <span data-ttu-id="b1f45-219">Use o script 'ASR-AddSingleLoadBalancer' publicado nos scripts de exemplo.</span><span class="sxs-lookup"><span data-stu-id="b1f45-219">Use the 'ASR-AddSingleLoadBalancer' script published in the sample scripts.</span></span> <span data-ttu-id="b1f45-220">Verifique se você seguiu as diretrizes no script e faça adequadamente as alterações necessárias no script.</span><span class="sxs-lookup"><span data-stu-id="b1f45-220">Ensure you follow the guidance in the script and make the required changes in the script appropriately.</span></span>

    ![Add-LB-Script-Step-1](./media/site-recovery-sharepoint/add-lb-script-step1.png)

    ![Add-LB-Script-Step-2](./media/site-recovery-sharepoint/add-lb-script-step2.png)

3. <span data-ttu-id="b1f45-223">Adicione uma etapa manual para atualizar os registros DNS para apontar para o novo farm no Azure.</span><span class="sxs-lookup"><span data-stu-id="b1f45-223">Add a manual step to update the DNS records to point to the new farm in Azure.</span></span>

    * <span data-ttu-id="b1f45-224">Para sites voltados para a Internet, não há atualizações DNS necessárias após o failover.</span><span class="sxs-lookup"><span data-stu-id="b1f45-224">For internet facing sites, no DNS updates are required post failover.</span></span> <span data-ttu-id="b1f45-225">Siga as etapas descritas na seção 'Diretrizes de rede' para configurar o Gerenciador de Tráfego.</span><span class="sxs-lookup"><span data-stu-id="b1f45-225">Follow the steps described in the 'Networking guidance' section to configure Traffic Manager.</span></span> <span data-ttu-id="b1f45-226">Se o perfil do Gerenciador de Tráfego foi configurado conforme descrito na seção anterior, adicione um script para abrir a porta fictícia (800, no exemplo) na VM do Azure.</span><span class="sxs-lookup"><span data-stu-id="b1f45-226">If the Traffic Manager profile has been set up as described in the previous section, add a script to open dummy port (800 in the example) on the Azure VM.</span></span>

    * <span data-ttu-id="b1f45-227">Para sites internos, adicione uma etapa manual para atualizar o registro DNS para apontar para o IP do balanceador de carga da nova VM de camada da Web.</span><span class="sxs-lookup"><span data-stu-id="b1f45-227">For internal facing sites, add a manual step to update the DNS record to point to the new Web tier VM’s load balancer IP.</span></span>

4. <span data-ttu-id="b1f45-228">Adicione uma etapa manual para restaurar o aplicativo de pesquisa de um backup ou iniciar um novo serviço de pesquisa.</span><span class="sxs-lookup"><span data-stu-id="b1f45-228">Add a manual step to restore search application from a backup or start a new search service.</span></span>

5. <span data-ttu-id="b1f45-229">Para restaurar o aplicativo de serviço de pesquisa de um backup, execute as etapas abaixo.</span><span class="sxs-lookup"><span data-stu-id="b1f45-229">For restoring Search service application from a backup, follow below steps.</span></span>

    * <span data-ttu-id="b1f45-230">Este método presume que um backup do Aplicativo de Serviço de Pesquisa foi executado antes do evento catastrófico e que o backup está disponível no site de DR.</span><span class="sxs-lookup"><span data-stu-id="b1f45-230">This method assumes that a backup of the Search Service Application was performed before the catastrophic event and that the backup is available at the DR site.</span></span>
    * <span data-ttu-id="b1f45-231">Isso pode ser conseguido facilmente agendando o backup (por exemplo, uma vez por dia) e usando um procedimento de cópia para colocar o backup no site de DR.</span><span class="sxs-lookup"><span data-stu-id="b1f45-231">This can easily be achieved by scheduling the backup (for example, once daily) and using a copy procedure to place the backup at the DR site.</span></span> <span data-ttu-id="b1f45-232">Os procedimentos de cópia podem incluir programas em script, como o AzCopy (Cópia do Azure) ou a configuração de DFSR (Serviços de Replicação de Arquivos Distribuído).</span><span class="sxs-lookup"><span data-stu-id="b1f45-232">Copy procedures could include scripted programs such as AzCopy (Azure Copy) or setting up DFSR (Distributed File Services Replication).</span></span>
    * <span data-ttu-id="b1f45-233">Agora que o farm do SharePoint está em execução, navegue para a Administração Central, clique em 'Backup e Restauração' e selecione Restaurar.</span><span class="sxs-lookup"><span data-stu-id="b1f45-233">Now that the SharePoint farm is running, navigate the Central Administration, 'Backup and Restore' and select Restore.</span></span> <span data-ttu-id="b1f45-234">A restauração pergunta o local de backup especificado (talvez seja necessário atualizar o valor).</span><span class="sxs-lookup"><span data-stu-id="b1f45-234">The restore interrogates the backup location specified (you may need to update the value).</span></span> <span data-ttu-id="b1f45-235">Selecione o backup do Aplicativo de Serviço de Pesquisa que você deseja restaurar.</span><span class="sxs-lookup"><span data-stu-id="b1f45-235">Select the Search Service Application backup you would like to restore.</span></span>
    * <span data-ttu-id="b1f45-236">A pesquisa é restaurada.</span><span class="sxs-lookup"><span data-stu-id="b1f45-236">Search is restored.</span></span> <span data-ttu-id="b1f45-237">Tenha em mente que a restauração espera encontrar a mesma topologia (mesmo número de servidores) e as mesmas letras de unidades de disco rígido atribuídas a esses servidores.</span><span class="sxs-lookup"><span data-stu-id="b1f45-237">Keep in mind that the restore expects to find the same topology (same number of servers) and same hard drive letters assigned to those servers.</span></span> <span data-ttu-id="b1f45-238">Para obter mais informações, consulte o documento ['Restaurar aplicativo de serviço de Pesquisa no SharePoint 2013'](https://technet.microsoft.com/library/ee748654.aspx).</span><span class="sxs-lookup"><span data-stu-id="b1f45-238">For more information, see ['Restore Search service application in SharePoint 2013'](https://technet.microsoft.com/library/ee748654.aspx) document.</span></span>


6. <span data-ttu-id="b1f45-239">Para iniciar com um novo aplicativo de serviço de Pesquisa, execute as etapas a seguir.</span><span class="sxs-lookup"><span data-stu-id="b1f45-239">For starting with a new Search service application, follow below steps.</span></span>

    * <span data-ttu-id="b1f45-240">Este método presume que um backup do banco de dados "Administração de Pesquisa" está disponível no site de DR.</span><span class="sxs-lookup"><span data-stu-id="b1f45-240">This method assumes that a backup of the “Search Administration” database is available at the DR site.</span></span>
    * <span data-ttu-id="b1f45-241">Já que os outros bancos de dados do Aplicativo de Serviço de Pesquisa não são replicados, eles precisam ser recriados.</span><span class="sxs-lookup"><span data-stu-id="b1f45-241">Since the other Search Service Application databases are not replicated, they need to be re-created.</span></span> <span data-ttu-id="b1f45-242">Para fazer isso, navegue até a Administração Central e exclua o Aplicativo de Serviço de Pesquisa.</span><span class="sxs-lookup"><span data-stu-id="b1f45-242">To do so, navigate to Central Administration and delete the Search Service Application.</span></span> <span data-ttu-id="b1f45-243">Em todos os servidores que hospedam o Índice de Pesquisa, exclua os arquivos de índice.</span><span class="sxs-lookup"><span data-stu-id="b1f45-243">On any servers which host the Search Index, delete the index files.</span></span>
    * <span data-ttu-id="b1f45-244">Recrie o Aplicativo de Serviço de Pesquisa, resultando na recriação dos bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="b1f45-244">Re-create the Search Service Application and this re-creates the databases.</span></span> <span data-ttu-id="b1f45-245">É recomendável ter um script preparado que recria este aplicativo de serviço, pois não é possível executar todas as ações por meio da GUI.</span><span class="sxs-lookup"><span data-stu-id="b1f45-245">It is recommended to have a prepared script that re-creates this service application since it is not possible to perform all actions via the GUI.</span></span> <span data-ttu-id="b1f45-246">Por exemplo, configurar o local da unidade de índice e a topologia de pesquisa só é possível usando cmdlets do PowerShell do SharePoint.</span><span class="sxs-lookup"><span data-stu-id="b1f45-246">For example, setting the index drive location and configuring the search topology are only possible by using SharePoint PowerShell cmdlets.</span></span> <span data-ttu-id="b1f45-247">Use o cmdlet Restore-SPEnterpriseSearchServiceApplication do Windows PowerShell e especifique o banco de dados de Administração de Pesquisa encaminhado com log e replicado, Search_Service__DB.</span><span class="sxs-lookup"><span data-stu-id="b1f45-247">Use the Windows PowerShell cmdlet Restore-SPEnterpriseSearchServiceApplication and specify the log-shipped and replicated Search Administration database, Search_Service__DB.</span></span> <span data-ttu-id="b1f45-248">Esse cmdlet fornece à pesquisa uma configuração, um esquema, propriedades gerenciadas, regras e fontes e cria um conjunto padrão de outros componentes.</span><span class="sxs-lookup"><span data-stu-id="b1f45-248">This cmdlet gives the search configuration, schema, managed properties, rules, and sources and creates a default set of the other components.</span></span>
    * <span data-ttu-id="b1f45-249">Já que o Aplicativo de Serviço de Pesquisa tem de ser recriado, você deve iniciar um rastreamento completo para cada fonte de conteúdo restaurar o Serviço de Pesquisa.</span><span class="sxs-lookup"><span data-stu-id="b1f45-249">Once the Search Service Application has be re-created, you must start a full crawl for each content source to restore the Search Service.</span></span> <span data-ttu-id="b1f45-250">Você perde algumas informações de análise do farm local, assim como as recomendações de pesquisa.</span><span class="sxs-lookup"><span data-stu-id="b1f45-250">You lose some analytics information from the on-premises farm, such as search recommendations.</span></span>

7. <span data-ttu-id="b1f45-251">Depois que todas as etapas forem concluídas, salvar o plano de recuperação e o plano de recuperação final terá aparência semelhante à seguinte.</span><span class="sxs-lookup"><span data-stu-id="b1f45-251">Once all the steps are completed, save the recovery plan and the final recovery plan will look like following.</span></span>

    ![RP Salvo](./media/site-recovery-sharepoint/saved-rp.png)

## <a name="doing-a-test-failover"></a><span data-ttu-id="b1f45-253">Executar um failover de teste</span><span class="sxs-lookup"><span data-stu-id="b1f45-253">Doing a test failover</span></span>
<span data-ttu-id="b1f45-254">Siga [este guia](site-recovery-test-failover-to-azure.md) fazer um failover de teste.</span><span class="sxs-lookup"><span data-stu-id="b1f45-254">Follow [this guidance](site-recovery-test-failover-to-azure.md) to do a test failover.</span></span>

1.  <span data-ttu-id="b1f45-255">Acesse o Portal do Azure e selecione seu cofre do Serviço de Recuperação.</span><span class="sxs-lookup"><span data-stu-id="b1f45-255">Go to Azure portal and select your Recovery Service vault.</span></span>
2.  <span data-ttu-id="b1f45-256">Clique no plano de recuperação criado para o aplicativo do SharePoint.</span><span class="sxs-lookup"><span data-stu-id="b1f45-256">Click on the recovery plan created for SharePoint application.</span></span>
3.  <span data-ttu-id="b1f45-257">Clique em 'Failover de Teste'.</span><span class="sxs-lookup"><span data-stu-id="b1f45-257">Click on 'Test Failover'.</span></span>
4.  <span data-ttu-id="b1f45-258">Selecione o ponto e recuperação e a rede virtual do Azure para iniciar o processo de failover de teste.</span><span class="sxs-lookup"><span data-stu-id="b1f45-258">Select recovery point and Azure virtual network to start the test failover process.</span></span>
5.  <span data-ttu-id="b1f45-259">Quando o ambiente secundário estiver funcionando, você poderá executar sua validações.</span><span class="sxs-lookup"><span data-stu-id="b1f45-259">Once the secondary environment is up, you can perform your validations.</span></span>
6.  <span data-ttu-id="b1f45-260">Depois que as validações forem concluídas, você poderá clicar em 'Limpar failover de teste' no plano de recuperação e o ambiente de failover de teste será limpo.</span><span class="sxs-lookup"><span data-stu-id="b1f45-260">Once the validations are complete, you can click 'Cleanup test failover' on the recovery plan and the test failover environment is cleaned.</span></span>

<span data-ttu-id="b1f45-261">Para obter diretrizes sobre como fazer failover de teste do AD e DNS, consulte o documento [Considerações sobre failover de teste para o AD e DNS](site-recovery-active-directory.md#test-failover-considerations).</span><span class="sxs-lookup"><span data-stu-id="b1f45-261">For guidance on doing test failover for AD and DNS, refer to [Test failover considerations for AD and DNS](site-recovery-active-directory.md#test-failover-considerations) document.</span></span>

<span data-ttu-id="b1f45-262">Para obter diretrizes sobre como fazer failover de teste para grupos de disponibilidade do SQL Always ON, consulte o documento [Fazer failover de teste para SQL Server Always On](site-recovery-sql.md#steps-to-do-a-test-failover).</span><span class="sxs-lookup"><span data-stu-id="b1f45-262">For guidance on doing test failover for SQL Always ON availability groups, refer to [Doing Test failover for SQL Server Always On](site-recovery-sql.md#steps-to-do-a-test-failover) document.</span></span>

## <a name="doing-a-failover"></a><span data-ttu-id="b1f45-263">Executar um failover</span><span class="sxs-lookup"><span data-stu-id="b1f45-263">Doing a failover</span></span>
<span data-ttu-id="b1f45-264">Siga [estas diretrizes](site-recovery-failover.md) para fazer um failover.</span><span class="sxs-lookup"><span data-stu-id="b1f45-264">Follow [this guidance](site-recovery-failover.md) for doing a failover.</span></span>

1.  <span data-ttu-id="b1f45-265">Vá para o Portal do Azure e selecione seu cofre dos Serviços de Recuperação.</span><span class="sxs-lookup"><span data-stu-id="b1f45-265">Go to Azure portal and select your Recovery Services vault.</span></span>
2.  <span data-ttu-id="b1f45-266">Clique no plano de recuperação criado para o aplicativo do SharePoint.</span><span class="sxs-lookup"><span data-stu-id="b1f45-266">Click on the recovery plan created for SharePoint application.</span></span>
3.  <span data-ttu-id="b1f45-267">Clique em 'Failover'.</span><span class="sxs-lookup"><span data-stu-id="b1f45-267">Click on 'Failover'.</span></span>
4.  <span data-ttu-id="b1f45-268">Selecione o ponto de recuperação para iniciar o processo de failover.</span><span class="sxs-lookup"><span data-stu-id="b1f45-268">Select recovery point to start the failover process.</span></span>

## <a name="next-steps"></a><span data-ttu-id="b1f45-269">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="b1f45-269">Next steps</span></span>
<span data-ttu-id="b1f45-270">Você pode saber mais sobre [replicar outros aplicativos](site-recovery-workload.md) usando o Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="b1f45-270">You can learn more about [replicating other applications](site-recovery-workload.md) using Site Recovery.</span></span>
