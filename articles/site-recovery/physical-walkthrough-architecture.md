---
title: "Examinar a arquitetura para a replicação de servidor físico para o Azure usando o Azure Site Recovery | Microsoft Docs"
description: "Este artigo fornece uma visão geral dos componentes e da arquitetura usados ao replicar servidores físicos locais para o Azure com o serviço Azure Site Recovery"
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: 09c9b136-35f5-465e-8d0f-f4c5d5d9f880
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/27/2017
ms.author: raynew
ms.openlocfilehash: 843c3f1b54f50fe50b162ed242deab717a080830
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="step-1-review-the-architecture-for-physical-server-replication-to-azure"></a><span data-ttu-id="1de22-103">Etapa 1: Examinar a arquitetura para a replicação de servidor físico para o Azure</span><span class="sxs-lookup"><span data-stu-id="1de22-103">Step 1: Review the architecture for physical server replication to Azure</span></span>

<span data-ttu-id="1de22-104">Este artigo descreve os componentes e os processos usados ao replicar servidores físicos Windows/Linux locais para o Azure, usando o serviço [Azure Site Recovery](site-recovery-overview.md).</span><span class="sxs-lookup"><span data-stu-id="1de22-104">This article describes the components and processes used when you replicate on-premises Windows/Linux physical servers to Azure, using the [Azure Site Recovery](site-recovery-overview.md) service.</span></span>

<span data-ttu-id="1de22-105">Publique eventuais comentários no final deste artigo ou no [Fórum dos Serviços de Recuperação do Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="1de22-105">Post any comments at the bottom of this article, or ask questions in the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>


## <a name="architectural-components"></a><span data-ttu-id="1de22-106">Componentes de arquitetura</span><span class="sxs-lookup"><span data-stu-id="1de22-106">Architectural components</span></span>

<span data-ttu-id="1de22-107">A tabela resume os componentes necessários.</span><span class="sxs-lookup"><span data-stu-id="1de22-107">The table summarizes the components you need.</span></span>

<span data-ttu-id="1de22-108">**Componente**</span><span class="sxs-lookup"><span data-stu-id="1de22-108">**Component**</span></span> | <span data-ttu-id="1de22-109">**Requisito**</span><span class="sxs-lookup"><span data-stu-id="1de22-109">**Requirement**</span></span> | <span data-ttu-id="1de22-110">**Detalhes**</span><span class="sxs-lookup"><span data-stu-id="1de22-110">**Details**</span></span>
--- | --- | ---
<span data-ttu-id="1de22-111">**As tabelas**</span><span class="sxs-lookup"><span data-stu-id="1de22-111">**Azure**</span></span> | <span data-ttu-id="1de22-112">Você precisa de uma conta do Azure, uma conta de armazenamento do Azure e uma rede do Azure.</span><span class="sxs-lookup"><span data-stu-id="1de22-112">You need an Azure account, an Azure storage account, and an Azure network.</span></span> | <span data-ttu-id="1de22-113">Os dados replicados são armazenados na conta de armazenamento e as VMs do Azure são criadas com os dados replicados quando ocorre o failover.</span><span class="sxs-lookup"><span data-stu-id="1de22-113">Replicated data is stored in the storage account, and Azure VMs are created with the replicated data when failover occurs.</span></span> <span data-ttu-id="1de22-114">As VMs do Azure se conectam à rede virtual do Azure quando são criadas.</span><span class="sxs-lookup"><span data-stu-id="1de22-114">Azure VMs connect to the Azure virtual network when they're created.</span></span>
<span data-ttu-id="1de22-115">**Servidor de configuração**</span><span class="sxs-lookup"><span data-stu-id="1de22-115">**Configuration server**</span></span> | <span data-ttu-id="1de22-116">Um único servidor de gerenciamento local (servidor físico ou VM do VMware) que executa todos os componentes locais do Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="1de22-116">A single on-premises management server (physical server or VMware VM) that runs all the on-premises Site Recovery components.</span></span> <span data-ttu-id="1de22-117">Isso inclui um servidor de configuração, um servidor em processo e um servidor de destino mestre.</span><span class="sxs-lookup"><span data-stu-id="1de22-117">These include a configuration server, process server, master target server.</span></span> | <span data-ttu-id="1de22-118">O componente de servidor de configuração coordena a comunicação entre o ambiente local e o Azure e gerencia a replicação de dados.</span><span class="sxs-lookup"><span data-stu-id="1de22-118">The configuration server component coordinates communications between on-premises and Azure, and manages data replication.</span></span>
 <span data-ttu-id="1de22-119">**Servidor de processo**</span><span class="sxs-lookup"><span data-stu-id="1de22-119">**Process server**</span></span>  | <span data-ttu-id="1de22-120">Instalado por padrão no servidor de configuração.</span><span class="sxs-lookup"><span data-stu-id="1de22-120">Installed by default on the configuration server.</span></span> | <span data-ttu-id="1de22-121">Atua como um gateway de replicação.</span><span class="sxs-lookup"><span data-stu-id="1de22-121">Acts as a replication gateway.</span></span> <span data-ttu-id="1de22-122">Recebe dados de replicação, otimiza-os com caching, compactação e criptografia e os envia para o Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="1de22-122">Receives replication data, optimizes it with caching, compression, and encryption, and sends it to Azure storage.</span></span><br/><br/> <span data-ttu-id="1de22-123">O servidor em processo também manipula a instalação por push do Serviço de mobilidade nos computadores protegidos.</span><span class="sxs-lookup"><span data-stu-id="1de22-123">The process server also handles push installation of the Mobility service to protected machines.</span></span><br/><br/> <span data-ttu-id="1de22-124">Você pode adicionar outros servidores em processo dedicados separados para lidar com o aumento do volume do tráfego de replicação.</span><span class="sxs-lookup"><span data-stu-id="1de22-124">You can add additional separate dedicated process servers, to handle increasing volumes of replication traffic.</span></span>
 <span data-ttu-id="1de22-125">**Servidor de destino mestre**</span><span class="sxs-lookup"><span data-stu-id="1de22-125">**Master target server**</span></span> | <span data-ttu-id="1de22-126">Instalado por padrão no servidor de configuração local.</span><span class="sxs-lookup"><span data-stu-id="1de22-126">Installed by default on the on-premises configuration server.</span></span> | <span data-ttu-id="1de22-127">Lida com os dados de replicação durante o failback do Azure.</span><span class="sxs-lookup"><span data-stu-id="1de22-127">Handles replication data during failback from Azure.</span></span><br/><br/> <span data-ttu-id="1de22-128">Se os volumes de tráfego de failback forem altos, você poderá implantar um servidor de destino mestre separado para failback.</span><span class="sxs-lookup"><span data-stu-id="1de22-128">If volumes of failback traffic are high, you can deploy a separate master target server for failback.</span></span>
<span data-ttu-id="1de22-129">**Servidores replicados**</span><span class="sxs-lookup"><span data-stu-id="1de22-129">**Replicated servers**</span></span> | <span data-ttu-id="1de22-130">O componente do Serviço de mobilidade é instalado em cada servidor Windows/Linux que você deseja replicar.</span><span class="sxs-lookup"><span data-stu-id="1de22-130">The Mobility service component is installed on each Windows/Linux server you want to replicate.</span></span> <span data-ttu-id="1de22-131">Ele pode ser instalado manualmente em cada computador ou com uma instalação por push do servidor de processo.</span><span class="sxs-lookup"><span data-stu-id="1de22-131">It can be installed manually on each machine, or with a push installation from the process server.</span></span>
<span data-ttu-id="1de22-132">**Failback**</span><span class="sxs-lookup"><span data-stu-id="1de22-132">**Failback**</span></span> | <span data-ttu-id="1de22-133">Para o failback, uma infraestrutura do VMware é necessária.</span><span class="sxs-lookup"><span data-stu-id="1de22-133">For failback a VMware infrastructure is required.</span></span> <span data-ttu-id="1de22-134">Você não pode realizar o failback para um servidor físico.</span><span class="sxs-lookup"><span data-stu-id="1de22-134">You can't fail back to a physical server.</span></span>


<span data-ttu-id="1de22-135">**Figura 1: Componentes do Físico para o Azure**</span><span class="sxs-lookup"><span data-stu-id="1de22-135">**Figure 1: Physical to Azure components**</span></span>

![Componentes](./media/physical-walkthrough-architecture/arch-enhanced.png)

## <a name="replication-process"></a><span data-ttu-id="1de22-137">Processo de replicação</span><span class="sxs-lookup"><span data-stu-id="1de22-137">Replication process</span></span>

1. <span data-ttu-id="1de22-138">Configure a implantação, incluindo os componentes locais e os componentes do Azure.</span><span class="sxs-lookup"><span data-stu-id="1de22-138">You set up the deployment, including on-premises and Azure components.</span></span> <span data-ttu-id="1de22-139">No cofre dos Serviços de Recuperação, você especifica a origem e o destino da replicação, configura o servidor de configuração, cria uma política de replicação, implanta o Serviço de mobilidade, habilita a replicação e executa um failover de teste.</span><span class="sxs-lookup"><span data-stu-id="1de22-139">In the Recovery Services vault, you specify the replication source and target, set up the configuration server, create a replication policy, deploy the Mobility service, enable replication, and run a test failover.</span></span>
2.  <span data-ttu-id="1de22-140">Os computadores são replicados de acordo com a política de replicação e uma cópia inicial dos dados é replicada para o armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="1de22-140">Machines replicate in accordance with the replication policy, and an initial copy of the data is replicated to Azure storage.</span></span>
4. <span data-ttu-id="1de22-141">Após a conclusão da replicação inicial, a replicação de alterações delta para o Azure é iniciada.</span><span class="sxs-lookup"><span data-stu-id="1de22-141">After initial replication finishes, replication of delta changes to Azure begins.</span></span> <span data-ttu-id="1de22-142">As alterações acompanhadas para uma máquina são mantidas em um arquivo .hrl.</span><span class="sxs-lookup"><span data-stu-id="1de22-142">Tracked changes for a machine are held in a .hrl file.</span></span>
    - <span data-ttu-id="1de22-143">As máquinas que estão sendo replicadas se comunicam com o servidor de configuração na porta HTTPS 443 de entrada para o gerenciamento de replicação.</span><span class="sxs-lookup"><span data-stu-id="1de22-143">Replicating machines communicate with the configuration server on port HTTPS 443 inbound, for replication management.</span></span>
    - <span data-ttu-id="1de22-144">Os computadores que estão sendo replicados enviam dados de replicação para o servidor em processo na porta HTTPS 9443 de entrada (pode ser modificada).</span><span class="sxs-lookup"><span data-stu-id="1de22-144">Replicating machines send replication data to the process server on port HTTPS 9443 inbound (can be modified).</span></span>
    - <span data-ttu-id="1de22-145">O servidor de configuração coordena o gerenciamento de replicação com o Azure pela porta HTTPS 443 de saída.</span><span class="sxs-lookup"><span data-stu-id="1de22-145">The configuration server orchestrates replication management with Azure over port HTTPS 443 outbound.</span></span>
    - <span data-ttu-id="1de22-146">O servidor de processo recebe dados de máquinas de origem, otimiza-os e criptografa-os e os envia para o armazenamento do Azure pela porta 443 de saída.</span><span class="sxs-lookup"><span data-stu-id="1de22-146">The process server receives data from source machines, optimizes and encrypts it, and sends it to Azure storage over port 443 outbound.</span></span>
    - <span data-ttu-id="1de22-147">Se você habilitar a consistência de várias VMS, as máquinas no grupo de replicação se comunicarão entre si pela porta 20004.</span><span class="sxs-lookup"><span data-stu-id="1de22-147">If you enable multi-VM consistency, then machines in the replication group communicate with each other over port 20004.</span></span> <span data-ttu-id="1de22-148">Várias VMS serão usadas se você agrupar vários computadores em grupos de replicação que compartilham pontos de recuperação consistentes com o aplicativo e com falhas ao realizar o failover.</span><span class="sxs-lookup"><span data-stu-id="1de22-148">Multi-VM is used if you group multiple machines into replication groups that share crash-consistent and app-consistent recovery points when they fail over.</span></span> <span data-ttu-id="1de22-149">Isso é útil se os computadores estão executando a mesma carga de trabalho e precisam ser consistentes.</span><span class="sxs-lookup"><span data-stu-id="1de22-149">This is useful if machines are running the same workload and need to be consistent.</span></span>
5. <span data-ttu-id="1de22-150">O tráfego é replicado para pontos de extremidade públicos do armazenamento do Azure, pela Internet.</span><span class="sxs-lookup"><span data-stu-id="1de22-150">Traffic is replicated to Azure storage public endpoints, over the internet.</span></span> <span data-ttu-id="1de22-151">Como alternativa, você pode usar o [emparelhamento público](../expressroute/expressroute-circuit-peerings.md#public-peering) do Azure ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="1de22-151">Alternately, you can use Azure ExpressRoute [public peering](../expressroute/expressroute-circuit-peerings.md#public-peering).</span></span> <span data-ttu-id="1de22-152">Não há suporte para a replicação do tráfego através de uma VPN de site a site de um site local para o Azure.</span><span class="sxs-lookup"><span data-stu-id="1de22-152">Replicating traffic over a site-to-site VPN from an on-premises site to Azure isn't supported.</span></span>

<span data-ttu-id="1de22-153">**Figura 2: Replicação do Físico para o Azure**</span><span class="sxs-lookup"><span data-stu-id="1de22-153">**Figure 2: Physical to Azure replication**</span></span>

![Avançado](./media/physical-walkthrough-architecture/v2a-architecture-henry.png)

## <a name="failover-and-failback-process"></a><span data-ttu-id="1de22-155">Processo de failover e failback</span><span class="sxs-lookup"><span data-stu-id="1de22-155">Failover and failback process</span></span>

<span data-ttu-id="1de22-156">Depois de verificar que o teste de failover está funcionando conforme o esperado, execute failovers não planejados para o Azure conforme o necessário.</span><span class="sxs-lookup"><span data-stu-id="1de22-156">After you verify that test failover is working as expected, you can run unplanned failovers to Azure as required.</span></span> <span data-ttu-id="1de22-157">Ao executar um failover, as VMs do Azure são criadas com base nos dados replicados.</span><span class="sxs-lookup"><span data-stu-id="1de22-157">When you run a failover, Azure VMs are created from replicated data.</span></span> <span data-ttu-id="1de22-158">Depois, quando o site primário local estiver disponível novamente, você poderá fazer failback.</span><span class="sxs-lookup"><span data-stu-id="1de22-158">Then, when your primary on-premises site is available again, you can fail back.</span></span> <span data-ttu-id="1de22-159">Observe que:</span><span class="sxs-lookup"><span data-stu-id="1de22-159">Note that:</span></span>

- <span data-ttu-id="1de22-160">Não há suporte para failover planejado.</span><span class="sxs-lookup"><span data-stu-id="1de22-160">Planned failover isn't supported.</span></span>
- <span data-ttu-id="1de22-161">Faça failover de um único computador ou crie [planos de recuperação](site-recovery-create-recovery-plans.md) para fazer failover de vários computadores juntos.</span><span class="sxs-lookup"><span data-stu-id="1de22-161">You can fail over a single machine, or create [recovery plans](site-recovery-create-recovery-plans.md), to fail over multiple machines together.</span></span>
- <span data-ttu-id="1de22-162">Você confirma um failover para começar a acessar a carga de trabalho por meio da VM do Azure de réplica.</span><span class="sxs-lookup"><span data-stu-id="1de22-162">You commit a failover to start accessing the workload from the replica Azure VM.</span></span>
- <span data-ttu-id="1de22-163">Quando o site primário estiver disponível novamente, replique o computador do site secundário para o primário.</span><span class="sxs-lookup"><span data-stu-id="1de22-163">When the primary site is available again, you replicate the machine from the secondary to the primary site.</span></span> <span data-ttu-id="1de22-164">Depois, execute um failover não planejado do site secundário.</span><span class="sxs-lookup"><span data-stu-id="1de22-164">Then, run an unplanned failover from the secondary site.</span></span> <span data-ttu-id="1de22-165">Depois que você confirmar esse failover, os dados estarão novamente no local e será necessário habilitar a replicação no Azure de novo.</span><span class="sxs-lookup"><span data-stu-id="1de22-165">After you commit this failover, data will be back on-premises, and you need to enable replication to Azure again.</span></span>

<span data-ttu-id="1de22-166">Os componentes do failback incluem:</span><span class="sxs-lookup"><span data-stu-id="1de22-166">Failback components include:</span></span>

- <span data-ttu-id="1de22-167">**Servidor em processo temporário no Azure**: você precisa configurar uma VM do Azure para atuar como um servidor em processo, a fim de manipular a replicação do Azure.</span><span class="sxs-lookup"><span data-stu-id="1de22-167">**Temporary process server in Azure**: You need to set up an Azure VM to act as a process server, to handle replication from Azure.</span></span> <span data-ttu-id="1de22-168">Você pode excluir a VM após a conclusão do failback.</span><span class="sxs-lookup"><span data-stu-id="1de22-168">You can delete this VM after failback finishes.</span></span>
- <span data-ttu-id="1de22-169">**Conexão VPN**: você precisa de uma conexão VPN (ou do Azure ExpressRoute) da rede do Azure com o site local.</span><span class="sxs-lookup"><span data-stu-id="1de22-169">**VPN connection**: You need a VPN connection (or Azure ExpressRoute) from the Azure network to the on-premises site.</span></span>
- <span data-ttu-id="1de22-170">**Servidor de destino mestre local separado**: o servidor de destino mestre local (instalado por padrão no servidor de configuração) manipula o failback.</span><span class="sxs-lookup"><span data-stu-id="1de22-170">**Separate on-premises master target server**: The on-premises master target server (installed by default on the configuration server) handles failback.</span></span> <span data-ttu-id="1de22-171">Se você fizer failback de grandes volumes de tráfego, deverá configurar um servidor de destino mestre local separado para essa finalidade.</span><span class="sxs-lookup"><span data-stu-id="1de22-171">If you fail back large volumes of traffic, you should set up a separate on-premises master target server for this purpose.</span></span>
- <span data-ttu-id="1de22-172">**Política de failback**: você precisa de uma política de failback.</span><span class="sxs-lookup"><span data-stu-id="1de22-172">**Failback policy**: You need a failback policy.</span></span> <span data-ttu-id="1de22-173">Isso é criado automaticamente quando você cria sua política de replicação.</span><span class="sxs-lookup"><span data-stu-id="1de22-173">This is automatically created when you created your replication policy.</span></span>
- <span data-ttu-id="1de22-174">**Infraestrutura VMware**: você deve fazer failback para uma VM VMware local.</span><span class="sxs-lookup"><span data-stu-id="1de22-174">**VMware infrastructure**: You must fail back to an on-premises VMware VM.</span></span> <span data-ttu-id="1de22-175">Isso significa que você precisa de uma infraestrutura VMware no local, mesmo se estiver replicando servidores físicos do local para o Azure.</span><span class="sxs-lookup"><span data-stu-id="1de22-175">This means you need an on-premises VMware infrastructure, even if you're replicating on-premises physical servers to Azure.</span></span>

<span data-ttu-id="1de22-176">**Figura 3: Failback de servidor físico**</span><span class="sxs-lookup"><span data-stu-id="1de22-176">**Figure 3: Physical server failback**</span></span>

![Failback](./media/physical-walkthrough-architecture/enhanced-failback.png)


## <a name="next-steps"></a><span data-ttu-id="1de22-178">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="1de22-178">Next steps</span></span>

<span data-ttu-id="1de22-179">Ir para a [Etapa 2: Verificar os pré-requisitos e as limitações](physical-walkthrough-prerequisites.md)</span><span class="sxs-lookup"><span data-stu-id="1de22-179">Go to [Step 2: Verify prerequisites and limitations](physical-walkthrough-prerequisites.md)</span></span>
