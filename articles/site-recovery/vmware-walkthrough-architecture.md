---
title: "Rever a arquitetura para replicação de VMware no Azure | Microsoft Docs"
description: "Este artigo fornece uma visão geral dos componentes e da arquitetura usada ao replicar VMs VMware locais para o Azure com o serviço Azure Site Recovery"
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: c413efcd-d750-4b22-b34b-15bcaa03934a
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/27.017
ms.author: raynew
ms.openlocfilehash: 4aae04a793bab11562c20ceec0e1ae8f1a035a0f
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="step-1-review-the-architecture-for-vmware-replication-to-azure"></a><span data-ttu-id="b6721-103">Etapa 1: rever a arquitetura para replicação do VMware no Azure</span><span class="sxs-lookup"><span data-stu-id="b6721-103">Step 1: Review the architecture for VMware replication to Azure</span></span>

<span data-ttu-id="b6721-104">Este artigo descreve os componentes e processos usados para replicar máquinas virtuais VMware locais para o Azure usando o serviço [Azure Site Recovery](site-recovery-overview.md).</span><span class="sxs-lookup"><span data-stu-id="b6721-104">This article describes the components and processes used when replicating on-premises VMware virtual machines to Azure using the [Azure Site Recovery](site-recovery-overview.md) service.</span></span>

<span data-ttu-id="b6721-105">Publique eventuais comentários no final deste artigo ou no [Fórum dos Serviços de Recuperação do Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="b6721-105">Post any comments at the bottom of this article, or ask questions in the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>


## <a name="architectural-components"></a><span data-ttu-id="b6721-106">Componentes de arquitetura</span><span class="sxs-lookup"><span data-stu-id="b6721-106">Architectural components</span></span>

<span data-ttu-id="b6721-107">A tabela resume os componentes necessários.</span><span class="sxs-lookup"><span data-stu-id="b6721-107">The table summarizes the components you need.</span></span>

<span data-ttu-id="b6721-108">**Componente**</span><span class="sxs-lookup"><span data-stu-id="b6721-108">**Component**</span></span> | <span data-ttu-id="b6721-109">**Requisito**</span><span class="sxs-lookup"><span data-stu-id="b6721-109">**Requirement**</span></span> | <span data-ttu-id="b6721-110">**Detalhes**</span><span class="sxs-lookup"><span data-stu-id="b6721-110">**Details**</span></span>
--- | --- | ---
<span data-ttu-id="b6721-111">**As tabelas**</span><span class="sxs-lookup"><span data-stu-id="b6721-111">**Azure**</span></span> | <span data-ttu-id="b6721-112">Você precisa de uma assinatura do Azure, uma conta de armazenamento do Azure e uma rede do Azure.</span><span class="sxs-lookup"><span data-stu-id="b6721-112">You need an Azure subscription, an Azure storage account, and an Azure network.</span></span> | <span data-ttu-id="b6721-113">Os dados replicados são colocados na conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="b6721-113">Replicated data is stored in the storage account.</span></span> <span data-ttu-id="b6721-114">As VMs do Azure são criadas com os dados replicados quando ocorre failover do site local.</span><span class="sxs-lookup"><span data-stu-id="b6721-114">Azure VMs are created with the replicated data when failover from your on-premises site occurs.</span></span> <span data-ttu-id="b6721-115">As VMs do Azure se conectam à rede virtual do Azure quando são criadas.</span><span class="sxs-lookup"><span data-stu-id="b6721-115">The Azure VMs connect to the Azure virtual network when they're created.</span></span>
<span data-ttu-id="b6721-116">**Servidor de configuração**</span><span class="sxs-lookup"><span data-stu-id="b6721-116">**Configuration server**</span></span> | <span data-ttu-id="b6721-117">Um único servidor de gerenciamento local (VM VMware) que executa todos os componentes locais do Site Recovery para a implantação.</span><span class="sxs-lookup"><span data-stu-id="b6721-117">A single on-premises management server (VMware VM) that runs all the on-premises Site Recovery components for the deployment.</span></span> <span data-ttu-id="b6721-118">Isso inclui um servidor de configuração, um servidor em processo e um servidor de destino mestre.</span><span class="sxs-lookup"><span data-stu-id="b6721-118">These include a configuration server, process server, master target server.</span></span> | <span data-ttu-id="b6721-119">O componente de servidor de configuração coordena a comunicação entre o ambiente local e o Azure e gerencia a replicação de dados.</span><span class="sxs-lookup"><span data-stu-id="b6721-119">The configuration server component coordinates communications between on-premises and Azure, and manages data replication.</span></span>
 <span data-ttu-id="b6721-120">**Servidor de processo**:</span><span class="sxs-lookup"><span data-stu-id="b6721-120">**Process server**:</span></span>  | <span data-ttu-id="b6721-121">Instalado por padrão no servidor de configuração.</span><span class="sxs-lookup"><span data-stu-id="b6721-121">Installed by default on the configuration server.</span></span> | <span data-ttu-id="b6721-122">Atua como um gateway de replicação.</span><span class="sxs-lookup"><span data-stu-id="b6721-122">Acts as a replication gateway.</span></span> <span data-ttu-id="b6721-123">Recebe dados de replicação, otimiza-os com caching, compactação e criptografia e os envia para o Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="b6721-123">Receives replication data, optimizes it with caching, compression, and encryption, and sends it to Azure storage.</span></span><br/><br/> <span data-ttu-id="b6721-124">O servidor de processo também manipula a instalação por push do Serviço de mobilidade em computadores protegidos e executa a descoberta automática de máquinas virtuais VMware.</span><span class="sxs-lookup"><span data-stu-id="b6721-124">The process server also handles push installation of the Mobility service to protected machines, and performs automatic discovery of VMware VMs.</span></span><br/><br/> <span data-ttu-id="b6721-125">À medida que a implantação cresce, você pode adicionar outros servidores de processo dedicados separados para lidar com o aumento do volume de tráfego de replicação.</span><span class="sxs-lookup"><span data-stu-id="b6721-125">As your deployment grows you can add additional separate dedicated process servers to handle increasing volumes of replication traffic.</span></span>
 <span data-ttu-id="b6721-126">**Servidor de destino mestre**</span><span class="sxs-lookup"><span data-stu-id="b6721-126">**Master target server**</span></span> | <span data-ttu-id="b6721-127">Instalado por padrão no servidor de configuração local.</span><span class="sxs-lookup"><span data-stu-id="b6721-127">Installed by default on the on-premises configuration server.</span></span> | <span data-ttu-id="b6721-128">Lida com os dados de replicação durante o failback do Azure.</span><span class="sxs-lookup"><span data-stu-id="b6721-128">Handles replication data during failback from Azure.</span></span><br/><br/> <span data-ttu-id="b6721-129">Se os volumes de tráfego de failback forem altos, você poderá implantar um servidor de destino mestre separado para failback.</span><span class="sxs-lookup"><span data-stu-id="b6721-129">If volumes of failback traffic are high, you can deploy a separate master target server for failback.</span></span>
<span data-ttu-id="b6721-130">**Servidores VMware**</span><span class="sxs-lookup"><span data-stu-id="b6721-130">**VMware servers**</span></span> | <span data-ttu-id="b6721-131">VMs VMware são hospedadas em servidores ESXi vSphere, e recomendamos que um servidor vCenter gerencie os hosts.</span><span class="sxs-lookup"><span data-stu-id="b6721-131">VMware VMs are hosted on vSphere ESXi servers, and we recommend a vCenter server to manage the hosts.</span></span> | <span data-ttu-id="b6721-132">Adicione servidores VMware ao seu cofre dos Serviços de Recuperação.</span><span class="sxs-lookup"><span data-stu-id="b6721-132">You add VMware servers to your Recovery Services vault.</span></span>
<span data-ttu-id="b6721-133">**Computadores replicados**</span><span class="sxs-lookup"><span data-stu-id="b6721-133">**Replicated machines**</span></span> | <span data-ttu-id="b6721-134">O serviço de Mobilidade será instalado em cada VM VMware que você replicar.</span><span class="sxs-lookup"><span data-stu-id="b6721-134">The Mobility service will be installed on each VMware VM you replicate.</span></span> <span data-ttu-id="b6721-135">Ele pode ser instalado manualmente em cada computador ou com uma instalação por push do servidor de processo.</span><span class="sxs-lookup"><span data-stu-id="b6721-135">It can be installed manually on each machine, or with a push installation from the process server.</span></span>

<span data-ttu-id="b6721-136">**Figura 1: VMware para componentes do Azure**</span><span class="sxs-lookup"><span data-stu-id="b6721-136">**Figure 1: VMware to Azure components**</span></span>

![Componentes](./media/vmware-walkthrough-architecture/arch-enhanced.png)

## <a name="replication-process"></a><span data-ttu-id="b6721-138">Processo de replicação</span><span class="sxs-lookup"><span data-stu-id="b6721-138">Replication process</span></span>

1. <span data-ttu-id="b6721-139">Configure a implantação, incluindo os componentes locais e os componentes do Azure.</span><span class="sxs-lookup"><span data-stu-id="b6721-139">You set up the deployment, including on-premises and Azure components.</span></span> <span data-ttu-id="b6721-140">No cofre dos Serviços de Recuperação, você especifica a origem e o destino da replicação, configura o servidor de configuração, cria uma política de replicação, implanta o Serviço de mobilidade, habilita a replicação e executa um failover de teste.</span><span class="sxs-lookup"><span data-stu-id="b6721-140">In the Recovery Services vault, you specify the replication source and target, set up the configuration server, create a replication policy, deploy the Mobility service, enable replication, and run a test failover.</span></span>
2. <span data-ttu-id="b6721-141">Os computadores são replicados de acordo com a política de replicação e uma cópia inicial dos dados é replicada para o armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="b6721-141">Machines replicate in accordance with the replication policy, and an initial copy of the data is replicated to Azure storage.</span></span>
3. <span data-ttu-id="b6721-142">Após a conclusão da replicação inicial, a replicação de alterações delta para o Azure é iniciada.</span><span class="sxs-lookup"><span data-stu-id="b6721-142">After initial replication finishes, replication of delta changes to Azure begins.</span></span> <span data-ttu-id="b6721-143">As alterações acompanhadas para uma máquina são mantidas em um arquivo .hrl.</span><span class="sxs-lookup"><span data-stu-id="b6721-143">Tracked changes for a machine are held in a .hrl file.</span></span>
    - <span data-ttu-id="b6721-144">As máquinas que estão sendo replicadas se comunicam com o servidor de configuração na porta HTTPS 443 de entrada para o gerenciamento de replicação.</span><span class="sxs-lookup"><span data-stu-id="b6721-144">Replicating machines communicate with the configuration server on port HTTPS 443 inbound, for replication management.</span></span>
    - <span data-ttu-id="b6721-145">Os computadores que estão sendo replicados enviam dados de replicação para o servidor em processo na porta HTTPS 9443 de entrada (pode ser modificada).</span><span class="sxs-lookup"><span data-stu-id="b6721-145">Replicating machines send replication data to the process server on port HTTPS 9443 inbound (can be modified).</span></span>
    - <span data-ttu-id="b6721-146">O servidor de configuração coordena o gerenciamento de replicação com o Azure pela porta HTTPS 443 de saída.</span><span class="sxs-lookup"><span data-stu-id="b6721-146">The configuration server orchestrates replication management with Azure over port HTTPS 443 outbound.</span></span>
    - <span data-ttu-id="b6721-147">O servidor de processo recebe dados de máquinas de origem, otimiza-os e criptografa-os e os envia para o armazenamento do Azure pela porta 443 de saída.</span><span class="sxs-lookup"><span data-stu-id="b6721-147">The process server receives data from source machines, optimizes and encrypts it, and sends it to Azure storage over port 443 outbound.</span></span>
    - <span data-ttu-id="b6721-148">Se você habilitar a consistência de várias VMS, as máquinas no grupo de replicação se comunicarão entre si pela porta 20004.</span><span class="sxs-lookup"><span data-stu-id="b6721-148">If you enable multi-VM consistency, then machines in the replication group communicate with each other over port 20004.</span></span> <span data-ttu-id="b6721-149">Várias VMS serão usadas se você agrupar vários computadores em grupos de replicação que compartilham pontos de recuperação consistentes com o aplicativo e com falhas ao realizar o failover.</span><span class="sxs-lookup"><span data-stu-id="b6721-149">Multi-VM is used if you group multiple machines into replication groups that share crash-consistent and app-consistent recovery points when they fail over.</span></span> <span data-ttu-id="b6721-150">Isso é útil se os computadores estão executando a mesma carga de trabalho e precisam ser consistentes.</span><span class="sxs-lookup"><span data-stu-id="b6721-150">This is useful if machines are running the same workload and need to be consistent.</span></span>
4. <span data-ttu-id="b6721-151">O tráfego é replicado para pontos de extremidade públicos do armazenamento do Azure, pela Internet.</span><span class="sxs-lookup"><span data-stu-id="b6721-151">Traffic is replicated to Azure storage public endpoints, over the internet.</span></span> <span data-ttu-id="b6721-152">Como alternativa, você pode usar o [emparelhamento público](../expressroute/expressroute-circuit-peerings.md#public-peering) do Azure ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="b6721-152">Alternately, you can use Azure ExpressRoute [public peering](../expressroute/expressroute-circuit-peerings.md#public-peering).</span></span> <span data-ttu-id="b6721-153">Não há suporte para a replicação do tráfego através de uma VPN de site a site de um site local para o Azure.</span><span class="sxs-lookup"><span data-stu-id="b6721-153">Replicating traffic over a site-to-site VPN from an on-premises site to Azure isn't supported.</span></span>


<span data-ttu-id="b6721-154">**Figura 2: replicação do VMware para o Azure**</span><span class="sxs-lookup"><span data-stu-id="b6721-154">**Figure 2: VMware to Azure replication**</span></span>

![Avançado](./media/vmware-walkthrough-architecture/v2a-architecture-henry.png)

## <a name="failover-and-failback-process"></a><span data-ttu-id="b6721-156">Processo de failover e failback</span><span class="sxs-lookup"><span data-stu-id="b6721-156">Failover and failback process</span></span>

1. <span data-ttu-id="b6721-157">Depois de verificar que o teste de failover está funcionando conforme o esperado, execute failovers não planejados para o Azure conforme o necessário.</span><span class="sxs-lookup"><span data-stu-id="b6721-157">After you verify that test failover is working as expected, you can run unplanned failovers to Azure as required.</span></span> <span data-ttu-id="b6721-158">Não há suporte para failover planejado.</span><span class="sxs-lookup"><span data-stu-id="b6721-158">Planned failover isn't supported.</span></span>
2. <span data-ttu-id="b6721-159">Faça o failover de um único computador, ou crie [planos de recuperação](site-recovery-create-recovery-plans.md) para realizar o failover de várias VMs.</span><span class="sxs-lookup"><span data-stu-id="b6721-159">You can fail over a single machine, or create [recovery plans](site-recovery-create-recovery-plans.md), to fail over multiple VMs.</span></span>
3. <span data-ttu-id="b6721-160">Ao executar um failover, VMs de réplica são criadas no Azure.</span><span class="sxs-lookup"><span data-stu-id="b6721-160">When you run a failover, replica VMs are created in Azure.</span></span> <span data-ttu-id="b6721-161">Você confirma um failover para começar a acessar a carga de trabalho por meio da VM do Azure de réplica.</span><span class="sxs-lookup"><span data-stu-id="b6721-161">You commit a failover to start accessing the workload from the replica Azure VM.</span></span>
4. <span data-ttu-id="b6721-162">Quando o site primário local estiver disponível novamente, você poderá executar o failback.</span><span class="sxs-lookup"><span data-stu-id="b6721-162">When your primary on-premises site is available again, you can fail back.</span></span> <span data-ttu-id="b6721-163">Você configura uma infraestrutura de failback, inicia a replicação da máquina do site secundário para o primário e executa um failover não planejado do site secundário.</span><span class="sxs-lookup"><span data-stu-id="b6721-163">You set up a failback infrastructure, start replicating the machine from the secondary site to the primary, and run an unplanned failover from the secondary site.</span></span> <span data-ttu-id="b6721-164">Depois que você confirmar esse failover, os dados estarão novamente no local e será necessário habilitar a replicação no Azure de novo.</span><span class="sxs-lookup"><span data-stu-id="b6721-164">After you commit this failover, data will be back on-premises, and you need to enable replication to Azure again.</span></span> [<span data-ttu-id="b6721-165">Saiba mais</span><span class="sxs-lookup"><span data-stu-id="b6721-165">Learn more</span></span>](site-recovery-failback-azure-to-vmware.md)

<span data-ttu-id="b6721-166">Há alguns requisitos de failback:</span><span class="sxs-lookup"><span data-stu-id="b6721-166">There are a few failback requirements:</span></span>


- <span data-ttu-id="b6721-167">**Servidor de processo temporário no Azure**: se você deseja fazer failback do Azure após o failover, precisa criar uma VM do Azure configurada como um servidor de processo para lidar com a replicação do Azure.</span><span class="sxs-lookup"><span data-stu-id="b6721-167">**Temporary process server in Azure**: If you want to fail back from Azure after failover you'll need to set up an Azure VM configured as a process server, to handle replication from Azure.</span></span> <span data-ttu-id="b6721-168">Você pode excluir a VM após a conclusão do failback.</span><span class="sxs-lookup"><span data-stu-id="b6721-168">You can delete this VM after failback finishes.</span></span>
- <span data-ttu-id="b6721-169">**Conexão de VPN**: em caso de failback, você precisará de uma conexão de VPN (ou Azure ExpressRoute) configurada da rede do Azure para o site local.</span><span class="sxs-lookup"><span data-stu-id="b6721-169">**VPN connection**: For failback you'll need a VPN connection (or Azure ExpressRoute) set up from the Azure network to the on-premises site.</span></span>
- <span data-ttu-id="b6721-170">**Servidor de destino mestre separado local**: o servidor de destino mestre local lida com o failback.</span><span class="sxs-lookup"><span data-stu-id="b6721-170">**Separate on-premises master target server**: The on-premises master target server handles failback.</span></span> <span data-ttu-id="b6721-171">O servidor de destino mestre está instalado por padrão no servidor de gerenciamento, mas se você estiver fazendo failback de volumes de tráfego maiores, deverá configurar um servidor de destino mestre separado local com essa finalidade.</span><span class="sxs-lookup"><span data-stu-id="b6721-171">The master target server is installed by default on the management server, but if you're failing back larger volumes of traffic you should set up a separate on-premises master target server for this purpose.</span></span>
- <span data-ttu-id="b6721-172">**Política de failback**: para replicar volta para seu site local, você precisa de uma política de failback.</span><span class="sxs-lookup"><span data-stu-id="b6721-172">**Failback policy**: To replicate back to your on-premises site, you need a failback policy.</span></span> <span data-ttu-id="b6721-173">Isso é criado automaticamente quando você cria sua política de replicação.</span><span class="sxs-lookup"><span data-stu-id="b6721-173">This is automatically created when you created your replication policy.</span></span>
- <span data-ttu-id="b6721-174">**Infraestrutura VMware**: você deve fazer failback para uma VM VMware local.</span><span class="sxs-lookup"><span data-stu-id="b6721-174">**VMware infrastructure**: You must fail back to an on-premises VMware VM.</span></span> <span data-ttu-id="b6721-175">Isso significa que você precisa de uma infraestrutura VMware no local, mesmo se estiver replicando servidores físicos do local para o Azure.</span><span class="sxs-lookup"><span data-stu-id="b6721-175">This means you need an on-premises VMware infrastructure, even if you're replicating on-premises physical servers to Azure.</span></span>

<span data-ttu-id="b6721-176">**Figura 3: failback físico/de VMware**</span><span class="sxs-lookup"><span data-stu-id="b6721-176">**Figure 3: VMware/physical failback**</span></span>

![Failback](./media/vmware-walkthrough-architecture/enhanced-failback.png)


## <a name="next-steps"></a><span data-ttu-id="b6721-178">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="b6721-178">Next steps</span></span>

<span data-ttu-id="b6721-179">Ir para a [Etapa 2: Verificar os pré-requisitos e as limitações](vmware-walkthrough-prerequisites.md)</span><span class="sxs-lookup"><span data-stu-id="b6721-179">Go to [Step 2: Verify prerequisites and limitations](vmware-walkthrough-prerequisites.md)</span></span>
