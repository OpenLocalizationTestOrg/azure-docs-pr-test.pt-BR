---
title: "Correlação no Azure Application Insights Telemetry | Microsoft Docs"
description: "Correlação no Application Insights Telemetry"
services: application-insights
documentationcenter: .net
author: SergeyKanzhelev
manager: carmonm
ms.service: application-insights
ms.workload: TBD
ms.tgt_pltfrm: ibiza
ms.devlang: multiple
ms.topic: article
ms.date: 04/25/2017
ms.author: bwren
ms.openlocfilehash: 747c00842f4df9c7fbd816c99771ba8a267106a4
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/18/2017
---
# <a name="telemetry-correlation-in-application-insights"></a><span data-ttu-id="eeee6-103">Correlação de telemetria no Application Insights</span><span class="sxs-lookup"><span data-stu-id="eeee6-103">Telemetry correlation in Application Insights</span></span>

<span data-ttu-id="eeee6-104">No mundo dos microsserviços, cada operação lógica requer que trabalho seja feito em vários componentes do serviço.</span><span class="sxs-lookup"><span data-stu-id="eeee6-104">In the world of micro services, every logical operation requires work done in various components of the service.</span></span> <span data-ttu-id="eeee6-105">Cada um desses componentes pode ser monitorado separadamente pelo [Application Insights](app-insights-overview.md).</span><span class="sxs-lookup"><span data-stu-id="eeee6-105">Each of these components can be separately monitored by [Application Insights](app-insights-overview.md).</span></span> <span data-ttu-id="eeee6-106">O componente do aplicativo Web se comunica com o componente de provedor de autenticação para validar as credenciais do usuário e com o componente de API para obter dados para visualização.</span><span class="sxs-lookup"><span data-stu-id="eeee6-106">The web app component communicates with authentication provider component to validate user credentials, and with the API component to get data for visualization.</span></span> <span data-ttu-id="eeee6-107">O componente de API, por sua vez, pode consultar dados de outros serviços e usar componentes de provedor de cache, além de notificar o componente de cobrança sobre essa chamada.</span><span class="sxs-lookup"><span data-stu-id="eeee6-107">The API component in its turn can query data from other services and use cache-provider components and notify the billing component about this call.</span></span> <span data-ttu-id="eeee6-108">O Application Insights dá suporte à correlação de telemetria distribuída.</span><span class="sxs-lookup"><span data-stu-id="eeee6-108">Application Insights supports distributed telemetry correlation.</span></span> <span data-ttu-id="eeee6-109">Ele permite detectar qual componente é responsável pela degradação de desempenho ou falha.</span><span class="sxs-lookup"><span data-stu-id="eeee6-109">It allows you to detect which component is responsible for failures or performance degradation.</span></span>

<span data-ttu-id="eeee6-110">Este artigo explica o modelo de dados usado pelo Application Insights para correlacionar a telemetria enviada por vários componentes.</span><span class="sxs-lookup"><span data-stu-id="eeee6-110">This article explains the data model used by Application Insights to correlate telemetry sent by multiple components.</span></span> <span data-ttu-id="eeee6-111">Ele aborda os protocolos e as técnicas de propagação de contexto.</span><span class="sxs-lookup"><span data-stu-id="eeee6-111">It covers the context propagation techniques and protocols.</span></span> <span data-ttu-id="eeee6-112">Ele também aborda a implementação dos conceitos de correlação em plataformas e idiomas diferentes.</span><span class="sxs-lookup"><span data-stu-id="eeee6-112">It also covers the implementation of the correlation concepts on different languages and platforms.</span></span>

## <a name="telemetry-correlation-data-model"></a><span data-ttu-id="eeee6-113">Modelo de dados de correlação de telemetria</span><span class="sxs-lookup"><span data-stu-id="eeee6-113">Telemetry correlation data model</span></span>

<span data-ttu-id="eeee6-114">O Application Insights define um [modelo de dados](application-insights-data-model.md) para correlação de telemetria distribuída.</span><span class="sxs-lookup"><span data-stu-id="eeee6-114">Application Insights defines a [data model](application-insights-data-model.md) for distributed telemetry correlation.</span></span> <span data-ttu-id="eeee6-115">Para associar a telemetria à operação lógica, cada item de telemetria tem o campo de contexto chamado `operation_Id`.</span><span class="sxs-lookup"><span data-stu-id="eeee6-115">To associate telemetry with the logical operation, every telemetry item has a context field called `operation_Id`.</span></span> <span data-ttu-id="eeee6-116">Esse identificador é compartilhado por todos os itens de telemetria no rastreamento distribuído.</span><span class="sxs-lookup"><span data-stu-id="eeee6-116">This identifier is shared by every telemetry item in the distributed trace.</span></span> <span data-ttu-id="eeee6-117">Portanto, mesmo com a perda de telemetria de uma única camada, você ainda pode associar telemetria relatada por outros componentes.</span><span class="sxs-lookup"><span data-stu-id="eeee6-117">So even with loss of telemetry from a single layer you still can associate telemetry reported by other components.</span></span>

<span data-ttu-id="eeee6-118">Operação lógica distribuída normalmente consiste de um conjunto de operações menores – solicitações processadas por um dos componentes.</span><span class="sxs-lookup"><span data-stu-id="eeee6-118">Distributed logical operation typically consists of a set of smaller operations - requests processed by one of the components.</span></span> <span data-ttu-id="eeee6-119">Essas operações são definidas por [telemetria de solicitação](application-insights-data-model-request-telemetry.md).</span><span class="sxs-lookup"><span data-stu-id="eeee6-119">Those operations are defined by [request telemetry](application-insights-data-model-request-telemetry.md).</span></span> <span data-ttu-id="eeee6-120">Toda telemetria de solicitação tem seu próprio `id` que a identifica de modo exclusivo, globalmente.</span><span class="sxs-lookup"><span data-stu-id="eeee6-120">Every request telemetry has its own `id` that uniquely globally identifies it.</span></span> <span data-ttu-id="eeee6-121">E toda a telemetria (rastreamentos, exceções, etc.) associada a essa solicitação deve definir o `operation_parentId` para o valor da `id` da solicitação.</span><span class="sxs-lookup"><span data-stu-id="eeee6-121">And all telemetry - traces, exceptions, etc. associated with this request should set the `operation_parentId` to the value of the request `id`.</span></span>

<span data-ttu-id="eeee6-122">Toda operação de saída como http chama outro componente representado por [telemetria de dependência](application-insights-data-model-dependency-telemetry.md).</span><span class="sxs-lookup"><span data-stu-id="eeee6-122">Every outgoing operation like http call to another component represented by [dependency telemetry](application-insights-data-model-dependency-telemetry.md).</span></span> <span data-ttu-id="eeee6-123">A telemetria de dependência também define sua própria `id`, que é globalmente exclusiva.</span><span class="sxs-lookup"><span data-stu-id="eeee6-123">Dependency telemetry also defines its own `id` that is globally unique.</span></span> <span data-ttu-id="eeee6-124">A telemetria de solicitação, iniciada por essa chamada de dependência, usa-a como `operation_parentId`.</span><span class="sxs-lookup"><span data-stu-id="eeee6-124">Request telemetry, initiated by this dependency call, uses it as `operation_parentId`.</span></span>

<span data-ttu-id="eeee6-125">Você pode compilar o modo de exibição de operação lógica distribuída usando `operation_Id`, `operation_parentId` e `request.id` com `dependency.id`.</span><span class="sxs-lookup"><span data-stu-id="eeee6-125">You can build the view of distributed logical operation using `operation_Id`, `operation_parentId`, and `request.id` with `dependency.id`.</span></span> <span data-ttu-id="eeee6-126">Esses campos também definem a ordem de causalidade das chamadas de telemetria.</span><span class="sxs-lookup"><span data-stu-id="eeee6-126">Those fields also define the causality order of telemetry calls.</span></span>

<span data-ttu-id="eeee6-127">No ambiente de microsserviços, rastreamentos de componentes podem ir para os diferentes armazenamentos.</span><span class="sxs-lookup"><span data-stu-id="eeee6-127">In micro services environment, traces from components may go to the different storages.</span></span> <span data-ttu-id="eeee6-128">Todo componente pode ter sua própria chave de instrumentação no Application Insights.</span><span class="sxs-lookup"><span data-stu-id="eeee6-128">Every component may have its own instrumentation key in Application Insights.</span></span> <span data-ttu-id="eeee6-129">Para obter a telemetria para a operação lógica, você precisa consultar dados de cada armazenamento.</span><span class="sxs-lookup"><span data-stu-id="eeee6-129">To get telemetry for the logical operation, you need to query data from every storage.</span></span> <span data-ttu-id="eeee6-130">Quando o número de armazenamentos é enorme, você precisa ter uma dica sobre onde procurar em seguida.</span><span class="sxs-lookup"><span data-stu-id="eeee6-130">When number of storages is huge, you need to have a hint on where to look next.</span></span>

<span data-ttu-id="eeee6-131">O modelo de dados do Application Insights define dois campos para resolver esse problema: `request.source` e `dependency.target`.</span><span class="sxs-lookup"><span data-stu-id="eeee6-131">Application Insights data model defines two fields to solve this problem: `request.source` and `dependency.target`.</span></span> <span data-ttu-id="eeee6-132">O primeiro campo identifica o componente que iniciou a solicitação de dependência, e o segundo identifica qual componente retornou a resposta da chamada de dependência.</span><span class="sxs-lookup"><span data-stu-id="eeee6-132">The first field identifies the component that initiated the dependency request, and the second identifies which component returned the response of the dependency call.</span></span>


## <a name="example"></a><span data-ttu-id="eeee6-133">Exemplo</span><span class="sxs-lookup"><span data-stu-id="eeee6-133">Example</span></span>

<span data-ttu-id="eeee6-134">Vejamos um exemplo de um aplicativo PREÇOS DE AÇÕES mostrando o preço de mercado atual de uma ação usando a API externa chamada API AÇÕES.</span><span class="sxs-lookup"><span data-stu-id="eeee6-134">Let's take an example of an application STOCK PRICES showing the current market price of a stock using the external API called STOCKS API.</span></span> <span data-ttu-id="eeee6-135">O aplicativo STOCK PRICES tem uma página `Stock page` aberta pelo navegador da Web cliente usando `GET /Home/Stock`.</span><span class="sxs-lookup"><span data-stu-id="eeee6-135">The STOCK PRICES application has a page `Stock page` opened by the client web browser using `GET /Home/Stock`.</span></span> <span data-ttu-id="eeee6-136">O aplicativo consulta a STOCK API usando uma chamada HTTP `GET /api/stock/value`.</span><span class="sxs-lookup"><span data-stu-id="eeee6-136">The application queries the STOCK API by using an HTTP call `GET /api/stock/value`.</span></span>

<span data-ttu-id="eeee6-137">Você pode analisar telemetria resultante da execução de uma consulta:</span><span class="sxs-lookup"><span data-stu-id="eeee6-137">You can analyze resulting telemetry running a query:</span></span>

```
(requests | union dependencies | union pageViews) 
| where operation_Id == "STYz"
| project timestamp, itemType, name, id, operation_ParentId, operation_Id
```

<span data-ttu-id="eeee6-138">Na exibição resultante, observe que todos os itens de telemetria compartilham a raiz `operation_Id`.</span><span class="sxs-lookup"><span data-stu-id="eeee6-138">In the result view note that all telemetry items share the root `operation_Id`.</span></span> <span data-ttu-id="eeee6-139">Quando a chamada AJAX é feita da página – a nova ID exclusiva `qJSXU` é atribuída à telemetria de dependência e a ID de pageView é usada como `operation_ParentId`.</span><span class="sxs-lookup"><span data-stu-id="eeee6-139">When ajax call made from the page - new unique id `qJSXU` is assigned to the dependency telemetry and pageView's id is used as `operation_ParentId`.</span></span> <span data-ttu-id="eeee6-140">A solicitação do servidor, por sua vez, usa a ID do AJAX como `operation_ParentId`, etc.</span><span class="sxs-lookup"><span data-stu-id="eeee6-140">In turn server request uses ajax's id as `operation_ParentId`, etc.</span></span>

| <span data-ttu-id="eeee6-141">itemType</span><span class="sxs-lookup"><span data-stu-id="eeee6-141">itemType</span></span>   | <span data-ttu-id="eeee6-142">name</span><span class="sxs-lookup"><span data-stu-id="eeee6-142">name</span></span>                      | <span data-ttu-id="eeee6-143">ID</span><span class="sxs-lookup"><span data-stu-id="eeee6-143">id</span></span>           | <span data-ttu-id="eeee6-144">operation_ParentId</span><span class="sxs-lookup"><span data-stu-id="eeee6-144">operation_ParentId</span></span> | <span data-ttu-id="eeee6-145">operation_Id</span><span class="sxs-lookup"><span data-stu-id="eeee6-145">operation_Id</span></span> |
|------------|---------------------------|--------------|--------------------|--------------|
| <span data-ttu-id="eeee6-146">pageView</span><span class="sxs-lookup"><span data-stu-id="eeee6-146">pageView</span></span>   | <span data-ttu-id="eeee6-147">Página de ações</span><span class="sxs-lookup"><span data-stu-id="eeee6-147">Stock page</span></span>                |              | <span data-ttu-id="eeee6-148">STYz</span><span class="sxs-lookup"><span data-stu-id="eeee6-148">STYz</span></span>               | <span data-ttu-id="eeee6-149">STYz</span><span class="sxs-lookup"><span data-stu-id="eeee6-149">STYz</span></span>         |
| <span data-ttu-id="eeee6-150">dependência</span><span class="sxs-lookup"><span data-stu-id="eeee6-150">dependency</span></span> | <span data-ttu-id="eeee6-151">GET /Home/Stock</span><span class="sxs-lookup"><span data-stu-id="eeee6-151">GET /Home/Stock</span></span>           | <span data-ttu-id="eeee6-152">qJSXU</span><span class="sxs-lookup"><span data-stu-id="eeee6-152">qJSXU</span></span>        | <span data-ttu-id="eeee6-153">STYz</span><span class="sxs-lookup"><span data-stu-id="eeee6-153">STYz</span></span>               | <span data-ttu-id="eeee6-154">STYz</span><span class="sxs-lookup"><span data-stu-id="eeee6-154">STYz</span></span>         |
| <span data-ttu-id="eeee6-155">solicitação</span><span class="sxs-lookup"><span data-stu-id="eeee6-155">request</span></span>    | <span data-ttu-id="eeee6-156">GET Home/Stock</span><span class="sxs-lookup"><span data-stu-id="eeee6-156">GET Home/Stock</span></span>            | <span data-ttu-id="eeee6-157">KqKwlrSt9PA=</span><span class="sxs-lookup"><span data-stu-id="eeee6-157">KqKwlrSt9PA=</span></span> | <span data-ttu-id="eeee6-158">qJSXU</span><span class="sxs-lookup"><span data-stu-id="eeee6-158">qJSXU</span></span>              | <span data-ttu-id="eeee6-159">STYz</span><span class="sxs-lookup"><span data-stu-id="eeee6-159">STYz</span></span>         |
| <span data-ttu-id="eeee6-160">dependência</span><span class="sxs-lookup"><span data-stu-id="eeee6-160">dependency</span></span> | <span data-ttu-id="eeee6-161">GET /api/stock/value</span><span class="sxs-lookup"><span data-stu-id="eeee6-161">GET /api/stock/value</span></span>      | <span data-ttu-id="eeee6-162">bBrf2L7mm2g=</span><span class="sxs-lookup"><span data-stu-id="eeee6-162">bBrf2L7mm2g=</span></span> | <span data-ttu-id="eeee6-163">KqKwlrSt9PA=</span><span class="sxs-lookup"><span data-stu-id="eeee6-163">KqKwlrSt9PA=</span></span>       | <span data-ttu-id="eeee6-164">STYz</span><span class="sxs-lookup"><span data-stu-id="eeee6-164">STYz</span></span>         |

<span data-ttu-id="eeee6-165">Agora, quando a chamada `GET /api/stock/value` é feita para um serviço externo, você deseja saber a identidade desse servidor.</span><span class="sxs-lookup"><span data-stu-id="eeee6-165">Now when the call `GET /api/stock/value` made to an external service you want to know the identity of that server.</span></span> <span data-ttu-id="eeee6-166">Assim, você pode definir o campo `dependency.target` adequadamente.</span><span class="sxs-lookup"><span data-stu-id="eeee6-166">So you can set `dependency.target` field appropriately.</span></span> <span data-ttu-id="eeee6-167">Quando o serviço externo não dá suporte a monitoramento – `target` é definido como o nome do host do serviço como `stock-prices-api.com`.</span><span class="sxs-lookup"><span data-stu-id="eeee6-167">When the external service does not support monitoring - `target` is set to the host name of the service like `stock-prices-api.com`.</span></span> <span data-ttu-id="eeee6-168">No entanto, se esse serviço se identifica retornando um cabeçalho HTTP predefinido – `target` contém a identidade do serviço que permite que o Application Insights crie o rastreamento distribuído consultando a telemetria desse serviço.</span><span class="sxs-lookup"><span data-stu-id="eeee6-168">However if that service identifies itself by returning a predefined HTTP header - `target` contains the service identity that allows Application Insights to build distributed trace by querying telemetry from that service.</span></span> 

## <a name="correlation-headers"></a><span data-ttu-id="eeee6-169">Cabeçalhos de correlação</span><span class="sxs-lookup"><span data-stu-id="eeee6-169">Correlation headers</span></span>

<span data-ttu-id="eeee6-170">Estamos trabalhando na proposta de RFC para o [protocolo HTTP de correlação](https://github.com/lmolkova/correlation/blob/master/http_protocol_proposal_v1.md).</span><span class="sxs-lookup"><span data-stu-id="eeee6-170">We are working on RFC proposal for the [correlation HTTP protocol](https://github.com/lmolkova/correlation/blob/master/http_protocol_proposal_v1.md).</span></span> <span data-ttu-id="eeee6-171">Essa proposta define dois cabeçalhos:</span><span class="sxs-lookup"><span data-stu-id="eeee6-171">This proposal defines two headers:</span></span>

- <span data-ttu-id="eeee6-172">`Request-Id` – portar a ID globalmente exclusiva da chamada</span><span class="sxs-lookup"><span data-stu-id="eeee6-172">`Request-Id` carry the globally unique id of the call</span></span>
- <span data-ttu-id="eeee6-173">`Correlation-Context` – portar a coleção de pares nome/valor das propriedades de rastreamento distribuído</span><span class="sxs-lookup"><span data-stu-id="eeee6-173">`Correlation-Context` - carry the name value pairs collection of the distributed trace properties</span></span>

<span data-ttu-id="eeee6-174">O padrão também define dois esquemas de geração de `Request-Id` – simples e hierárquico.</span><span class="sxs-lookup"><span data-stu-id="eeee6-174">The standard also defines two schemas of `Request-Id` generation - flat and hierarchical.</span></span> <span data-ttu-id="eeee6-175">Com o esquema simples, há uma chave `Id` conhecida definida para a coleção `Correlation-Context`.</span><span class="sxs-lookup"><span data-stu-id="eeee6-175">With the flat schema, there is a well-known `Id` key defined for the `Correlation-Context` collection.</span></span>

<span data-ttu-id="eeee6-176">O Application Insights define a [extensão](https://github.com/lmolkova/correlation/blob/master/http_protocol_proposal_v2.md) para o protocolo HTTP de correlação.</span><span class="sxs-lookup"><span data-stu-id="eeee6-176">Application Insights defines the [extension](https://github.com/lmolkova/correlation/blob/master/http_protocol_proposal_v2.md) for the correlation HTTP protocol.</span></span> <span data-ttu-id="eeee6-177">Ele usa pares de nome/valor de `Request-Context` para propagar a coleção de propriedades usadas pelo computador chamado ou chamador imediato.</span><span class="sxs-lookup"><span data-stu-id="eeee6-177">It uses `Request-Context` name value pairs to propagate the collection of properties used by the immediate caller or callee.</span></span> <span data-ttu-id="eeee6-178">O SDK do Application Insights usa esse cabeçalho para definir os campos `dependency.target` e `request.source`.</span><span class="sxs-lookup"><span data-stu-id="eeee6-178">Application Insights SDK uses this header to set `dependency.target` and `request.source` fields.</span></span>

## <a name="open-tracing-and-application-insights"></a><span data-ttu-id="eeee6-179">Rastreamento aberto e Application Insights</span><span class="sxs-lookup"><span data-stu-id="eeee6-179">Open tracing and Application Insights</span></span>

<span data-ttu-id="eeee6-180">Aparência dos modelos de dados de [Rastreamento Aberto](http://opentracing.io/) e do Application Insights</span><span class="sxs-lookup"><span data-stu-id="eeee6-180">[Open Tracing](http://opentracing.io/) and Application Insights data models looks</span></span> 

- <span data-ttu-id="eeee6-181">`request`, `pageView` mapeia para **Span** com `span.kind = server`</span><span class="sxs-lookup"><span data-stu-id="eeee6-181">`request`, `pageView` maps to **Span** with `span.kind = server`</span></span>
- <span data-ttu-id="eeee6-182">`dependency` mapeia para **Span** com `span.kind = client`</span><span class="sxs-lookup"><span data-stu-id="eeee6-182">`dependency` maps to **Span** with `span.kind = client`</span></span>
- <span data-ttu-id="eeee6-183">`id` de um `request` e `dependency` mapeia para **Span.Id**</span><span class="sxs-lookup"><span data-stu-id="eeee6-183">`id` of a `request` and `dependency` maps to **Span.Id**</span></span>
- <span data-ttu-id="eeee6-184">`operation_Id` mapeia para **TraceId**</span><span class="sxs-lookup"><span data-stu-id="eeee6-184">`operation_Id` maps to **TraceId**</span></span>
- <span data-ttu-id="eeee6-185">`operation_ParentId` mapeia para **Reference** do tipo `ChileOf`</span><span class="sxs-lookup"><span data-stu-id="eeee6-185">`operation_ParentId` maps to **Reference** of type `ChileOf`</span></span>

<span data-ttu-id="eeee6-186">Consulte [modelo de dados](application-insights-data-model.md) para modelo de dados e tipos do Application Insights.</span><span class="sxs-lookup"><span data-stu-id="eeee6-186">See [data model](application-insights-data-model.md) for Application Insights types and data model.</span></span>

<span data-ttu-id="eeee6-187">Consulte [especificação](https://github.com/opentracing/specification/blob/master/specification.md) e [semantic_conventions](https://github.com/opentracing/specification/blob/master/semantic_conventions.md) para obter definições dos conceitos de rastreamento aberto.</span><span class="sxs-lookup"><span data-stu-id="eeee6-187">See [specification](https://github.com/opentracing/specification/blob/master/specification.md) and [semantic_conventions](https://github.com/opentracing/specification/blob/master/semantic_conventions.md) for definitions of Open Tracing concepts.</span></span>


## <a name="telemetry-correlation-in-net"></a><span data-ttu-id="eeee6-188">Correlação de telemetria em .NET</span><span class="sxs-lookup"><span data-stu-id="eeee6-188">Telemetry correlation in .NET</span></span>

<span data-ttu-id="eeee6-189">Ao longo do tempo, o .NET definiu várias maneiras de correlacionar os logs de diagnóstico e de telemetria.</span><span class="sxs-lookup"><span data-stu-id="eeee6-189">Over time .NET defined number of ways to correlate telemetry and diagnostics logs.</span></span> <span data-ttu-id="eeee6-190">Há `System.Diagnostics.CorrelationManager` permitindo rastrear [LogicalOperationStack e ActivityId](https://msdn.microsoft.com/library/system.diagnostics.correlationmanager.aspx).</span><span class="sxs-lookup"><span data-stu-id="eeee6-190">There is `System.Diagnostics.CorrelationManager` allowing to track [LogicalOperationStack and ActivityId](https://msdn.microsoft.com/library/system.diagnostics.correlationmanager.aspx).</span></span> <span data-ttu-id="eeee6-191">`System.Diagnostics.Tracing.EventSource` e o ETW (Rastreamento de Eventos para Windows) definem o método [SetCurrentThreadActivityId](https://msdn.microsoft.com/library/system.diagnostics.tracing.eventsource.setcurrentthreadactivityid.aspx).</span><span class="sxs-lookup"><span data-stu-id="eeee6-191">`System.Diagnostics.Tracing.EventSource` and Windows ETW define the method [SetCurrentThreadActivityId](https://msdn.microsoft.com/library/system.diagnostics.tracing.eventsource.setcurrentthreadactivityid.aspx).</span></span> <span data-ttu-id="eeee6-192">`ILogger` usa [Escopos de log](https://docs.microsoft.com/aspnet/core/fundamentals/logging#log-scopes).</span><span class="sxs-lookup"><span data-stu-id="eeee6-192">`ILogger` uses [Log Scopes](https://docs.microsoft.com/aspnet/core/fundamentals/logging#log-scopes).</span></span> <span data-ttu-id="eeee6-193">WCF e HTTP conectam a propagação de contexto "atual".</span><span class="sxs-lookup"><span data-stu-id="eeee6-193">WCF and Http wire up "current" context propagation.</span></span>

<span data-ttu-id="eeee6-194">No entanto, esses métodos não habilitam o suporte a rastreamento distribuído automático.</span><span class="sxs-lookup"><span data-stu-id="eeee6-194">However those methods didn't enable automatic distributed tracing support.</span></span> <span data-ttu-id="eeee6-195">`DiagnosticsSource` é uma maneira de dar suporte automático à correlação entre computadores.</span><span class="sxs-lookup"><span data-stu-id="eeee6-195">`DiagnosticsSource` is a way to support automatic cross machine correlation.</span></span> <span data-ttu-id="eeee6-196">Bibliotecas .NET dão suporte à origem de diagnóstico e permitem propagação automática entre computadores do contexto de correlação por meio de transporte como HTTP.</span><span class="sxs-lookup"><span data-stu-id="eeee6-196">.NET libraries support Diagnostics Source and allow automatic cross machine propagation of the correlation context via the transport like http.</span></span>

<span data-ttu-id="eeee6-197">O [Guia para atividades](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md) em Origem de Diagnóstico explica as noções básicas do acompanhamento de atividades.</span><span class="sxs-lookup"><span data-stu-id="eeee6-197">The [guide to Activities](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md) in Diagnostics Source explains the basics of tracking Activities.</span></span> 

<span data-ttu-id="eeee6-198">O ASP.NET Core 2.0 dá suporte à extração de cabeçalhos HTTP e inicia a nova atividade.</span><span class="sxs-lookup"><span data-stu-id="eeee6-198">ASP.NET Core 2.0 supports extraction of Http Headers and starting the new Activity.</span></span> 

<span data-ttu-id="eeee6-199">A versão inicial `<fill in>` de `System.Net.HttpClient` dá suporte à injeção automática de cabeçalhos HTTP de correlação e ao acompanhamento da chamada HTTP como uma atividade.</span><span class="sxs-lookup"><span data-stu-id="eeee6-199">`System.Net.HttpClient` starting version `<fill in>` supports automatic injection of the correlation Http Headers and tracking the http call as an Activity.</span></span>

<span data-ttu-id="eeee6-200">Há um novo módulo HTTP [Microsoft.AspNet.TelemetryCorrelation](https://www.nuget.org/packages/Microsoft.AspNet.TelemetryCorrelation/) para o ASP.NET Clássico.</span><span class="sxs-lookup"><span data-stu-id="eeee6-200">There is a new Http Module [Microsoft.AspNet.TelemetryCorrelation](https://www.nuget.org/packages/Microsoft.AspNet.TelemetryCorrelation/) for the ASP.NET Classic.</span></span> <span data-ttu-id="eeee6-201">Este módulo implementa a correlação de telemetria usando DiagnosticsSource.</span><span class="sxs-lookup"><span data-stu-id="eeee6-201">This module implements telemetry correlation using DiagnosticsSource.</span></span> <span data-ttu-id="eeee6-202">Ele inicia a atividade com base nos cabeçalhos de solicitação de entrada.</span><span class="sxs-lookup"><span data-stu-id="eeee6-202">It starts activity based on incoming request headers.</span></span> <span data-ttu-id="eeee6-203">Ele correlaciona telemetria de diferentes estágios do processamento da solicitação.</span><span class="sxs-lookup"><span data-stu-id="eeee6-203">It also correlates telemetry from the different stages of request processing.</span></span> <span data-ttu-id="eeee6-204">Isso se dá mesmo nos casos em que todos os estágios do processamento de IIS são executados em um thread de gerenciamento diferente.</span><span class="sxs-lookup"><span data-stu-id="eeee6-204">Even for the cases when every stage of IIS processing runs on a different manage threads.</span></span>

<span data-ttu-id="eeee6-205">A versão inicial `2.4.0-beta1` do SDK do Application Insights usa DiagnosticsSource e Atividade para coletar a telemetria e associá-la à atividade atual.</span><span class="sxs-lookup"><span data-stu-id="eeee6-205">Application Insights SDK starting version `2.4.0-beta1` uses DiagnosticsSource and Activity to collect telemetry and associate it with the current activity.</span></span> 

## <a name="next-steps"></a><span data-ttu-id="eeee6-206">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="eeee6-206">Next steps</span></span>

- [<span data-ttu-id="eeee6-207">Escrever telemetria personalizada</span><span class="sxs-lookup"><span data-stu-id="eeee6-207">Write custom telemetry</span></span>](app-insights-api-custom-events-metrics.md)
- <span data-ttu-id="eeee6-208">Integrar todos os componentes do seu microsserviço no Application Insights.</span><span class="sxs-lookup"><span data-stu-id="eeee6-208">Onboard all components of your micro service on Application Insights.</span></span> <span data-ttu-id="eeee6-209">Confira as [plataformas com suporte](app-insights-platforms.md).</span><span class="sxs-lookup"><span data-stu-id="eeee6-209">Check out [supported platforms](app-insights-platforms.md).</span></span>
- <span data-ttu-id="eeee6-210">Consulte [modelo de dados](application-insights-data-model.md) para modelo de dados e tipos do Application Insights.</span><span class="sxs-lookup"><span data-stu-id="eeee6-210">See [data model](application-insights-data-model.md) for Application Insights types and data model.</span></span>
- <span data-ttu-id="eeee6-211">Saiba como [estender e filtrar a telemetria](app-insights-api-filtering-sampling.md).</span><span class="sxs-lookup"><span data-stu-id="eeee6-211">Learn how to [extend and filter telemetry](app-insights-api-filtering-sampling.md).</span></span>
