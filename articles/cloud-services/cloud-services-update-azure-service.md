---
title: "Como atualizar um serviço de nuvem | Microsoft Docs"
description: "Saiba como atualizar os serviços de nuvem no Azure. Saiba como uma atualização em um serviço de nuvem é realizada para garantir a disponibilidade."
services: cloud-services
documentationcenter: 
author: Thraka
manager: timlt
editor: 
ms.assetid: c6a8b5e6-5c99-454c-9911-5c7ae8d1af63
ms.service: cloud-services
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/19/2017
ms.author: adegeo
ms.openlocfilehash: 2ba9676ed2afce7f18446642527971f5001b5ca7
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="how-to-update-a-cloud-service"></a><span data-ttu-id="bf955-104">Como atualizar um serviço de nuvem</span><span class="sxs-lookup"><span data-stu-id="bf955-104">How to update a cloud service</span></span>

<span data-ttu-id="bf955-105">A atualização de um serviço de nuvem, incluindo suas funções e o SO convidado, é um processo que envolve três etapas.</span><span class="sxs-lookup"><span data-stu-id="bf955-105">Updating a cloud service, including both its roles and guest OS, is a three step process.</span></span> <span data-ttu-id="bf955-106">Primeiro, os binários e os arquivos de configuração do novo serviço de nuvem, ou a versão do sistema operacional, devem ser carregados.</span><span class="sxs-lookup"><span data-stu-id="bf955-106">First, the binaries and configuration files for the new cloud service or OS version must be uploaded.</span></span> <span data-ttu-id="bf955-107">Em seguida, o Azure reserva recursos de computação e de rede para o serviço de nuvem com base nos requisitos da nova versão do serviço de nuvem.</span><span class="sxs-lookup"><span data-stu-id="bf955-107">Next, Azure reserves compute and network resources for the cloud service based on the requirements of the new cloud service version.</span></span> <span data-ttu-id="bf955-108">Por fim, o Azure executa uma atualização sem interrupção a fim de atualizar de forma incremental o locatário para a nova versão ou o SO convidado, preservando a disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="bf955-108">Finally, Azure performs a rolling upgrade to incrementally update the tenant to the new version or guest OS, while preserving your availability.</span></span> <span data-ttu-id="bf955-109">Este artigo discute os detalhes desta última etapa – a atualização sem interrupção.</span><span class="sxs-lookup"><span data-stu-id="bf955-109">This article discusses the details of this last step – the rolling upgrade.</span></span>

## <a name="update-an-azure-service"></a><span data-ttu-id="bf955-110">Atualizar um serviço do Azure</span><span class="sxs-lookup"><span data-stu-id="bf955-110">Update an Azure Service</span></span>
<span data-ttu-id="bf955-111">O Azure organiza suas instâncias de função em agrupamentos lógicos chamados de domínios de atualização (UD).</span><span class="sxs-lookup"><span data-stu-id="bf955-111">Azure organizes your role instances into logical groupings called upgrade domains (UD).</span></span> <span data-ttu-id="bf955-112">Os domínios de atualização (UD) são conjuntos lógicos de instâncias de função que são atualizados como um grupo.</span><span class="sxs-lookup"><span data-stu-id="bf955-112">Upgrade domains (UD) are logical sets of role instances that are updated as a group.</span></span>  <span data-ttu-id="bf955-113">O Azure atualiza um serviço de nuvem um UD por vez, o que permite que instâncias em outros UDs continuem a atender ao tráfego.</span><span class="sxs-lookup"><span data-stu-id="bf955-113">Azure updates a cloud service one UD at a time, which allows instances in other UDs to continue serving traffic.</span></span>

<span data-ttu-id="bf955-114">O número padrão de domínios de atualização é de cinco.</span><span class="sxs-lookup"><span data-stu-id="bf955-114">The default number of upgrade domains is 5.</span></span> <span data-ttu-id="bf955-115">Você pode especificar um número diferente de domínios de atualização incluindo o atributo upgradeDomainCount no arquivo de definição do serviço (.csdef).</span><span class="sxs-lookup"><span data-stu-id="bf955-115">You can specify a different number of upgrade domains by including the upgradeDomainCount attribute in the service’s definition file (.csdef).</span></span> <span data-ttu-id="bf955-116">Para saber mais sobre o atributo upgradeDomainCount, veja [Esquema WebRole](https://msdn.microsoft.com/library/azure/gg557553.aspx) ou [Esquema WorkerRole](https://msdn.microsoft.com/library/azure/gg557552.aspx).</span><span class="sxs-lookup"><span data-stu-id="bf955-116">For more information about the upgradeDomainCount attribute, see [WebRole Schema](https://msdn.microsoft.com/library/azure/gg557553.aspx) or [WorkerRole Schema](https://msdn.microsoft.com/library/azure/gg557552.aspx).</span></span>

<span data-ttu-id="bf955-117">Quando você executa uma atualização in-loco de uma ou mais funções em seu serviço, o Azure atualiza conjuntos de instâncias de função de acordo com o domínio de atualização ao qual elas pertencem.</span><span class="sxs-lookup"><span data-stu-id="bf955-117">When you perform an in-place update of one or more roles in your service, Azure updates sets of role instances according to the upgrade domain to which they belong.</span></span> <span data-ttu-id="bf955-118">O Azure atualiza todas as instâncias em um determinado domínio de atualização. Ele faz isso interrompendo as atualizações, atualizando-as, colocando-as online novamente e, em seguida, passando-as para o próximo domínio.</span><span class="sxs-lookup"><span data-stu-id="bf955-118">Azure updates all of the instances in a given upgrade domain – stopping them, updating them, bringing them back on-line – then moves onto the next domain.</span></span> <span data-ttu-id="bf955-119">Ao interromper somente as instâncias em execução no domínio de atualização atual, o Azure garante que uma atualização ocorrerá com o menor impacto possível no serviço em execução.</span><span class="sxs-lookup"><span data-stu-id="bf955-119">By stopping only the instances running in the current upgrade domain, Azure makes sure that an update occurs with the least possible impact to the running service.</span></span> <span data-ttu-id="bf955-120">Para saber mais, veja [Como atualizar os lucros](#howanupgradeproceeds) posteriormente neste artigo.</span><span class="sxs-lookup"><span data-stu-id="bf955-120">For more information, see [How the update proceeds](#howanupgradeproceeds) later in this article.</span></span>

> [!NOTE]
> <span data-ttu-id="bf955-121">Embora os termos **atualização** e **upgrade** tenham uma pequena diferença dentro do contexto do Azure, eles podem ser usados de forma intercambiável para os processos e descrições dos recursos neste documento.</span><span class="sxs-lookup"><span data-stu-id="bf955-121">While the terms **update** and **upgrade** have slightly different meaning in the context Azure, they can be used interchangeably for the processes and descriptions of the features in this document.</span></span>
>
>

<span data-ttu-id="bf955-122">O serviço deve definir pelo menos duas instâncias de uma função para que essa função seja atualizada in-loco sem tempo de inatividade.</span><span class="sxs-lookup"><span data-stu-id="bf955-122">Your service must define at least two instances of a role for that role to be updated in-place without downtime.</span></span> <span data-ttu-id="bf955-123">Se o serviço for composto por apenas uma instância de uma função, seu serviço ficará indisponível até a conclusão da atualização in-loco.</span><span class="sxs-lookup"><span data-stu-id="bf955-123">If the service consists of only one instance of one role, your service will be unavailable until the in-place update has finished.</span></span>

<span data-ttu-id="bf955-124">Este tópico aborda as seguintes informações sobre as atualizações do Azure:</span><span class="sxs-lookup"><span data-stu-id="bf955-124">This topic covers the following information about Azure updates:</span></span>

* [<span data-ttu-id="bf955-125">Alterações permitidas no serviço durante uma atualização</span><span class="sxs-lookup"><span data-stu-id="bf955-125">Allowed service changes during an update</span></span>](#AllowedChanges)
* [<span data-ttu-id="bf955-126">Como uma atualização é realizada</span><span class="sxs-lookup"><span data-stu-id="bf955-126">How an upgrade proceeds</span></span>](#howanupgradeproceeds)
* [<span data-ttu-id="bf955-127">Reversão de uma atualização</span><span class="sxs-lookup"><span data-stu-id="bf955-127">Rollback of an update</span></span>](#RollbackofanUpdate)
* [<span data-ttu-id="bf955-128">Inicialização de várias operações de mutação em uma implantação em andamento</span><span class="sxs-lookup"><span data-stu-id="bf955-128">Initiating multiple mutating operations on an ongoing deployment</span></span>](#multiplemutatingoperations)
* [<span data-ttu-id="bf955-129">Distribuição de funções em domínios de atualização</span><span class="sxs-lookup"><span data-stu-id="bf955-129">Distribution of roles across upgrade domains</span></span>](#distributiondfroles)

<a name="AllowedChanges"></a>

## <a name="allowed-service-changes-during-an-update"></a><span data-ttu-id="bf955-130">Alterações permitidas no serviço durante uma atualização</span><span class="sxs-lookup"><span data-stu-id="bf955-130">Allowed service changes during an update</span></span>
<span data-ttu-id="bf955-131">A tabela a seguir mostra as alterações permitidas em um serviço durante uma atualização:</span><span class="sxs-lookup"><span data-stu-id="bf955-131">The following table shows the allowed changes to a service during an update:</span></span>

| <span data-ttu-id="bf955-132">Alterações permitidas na hospedagem, serviços e funções</span><span class="sxs-lookup"><span data-stu-id="bf955-132">Changes permitted to hosting, services, and roles</span></span> | <span data-ttu-id="bf955-133">Atualização in-loco</span><span class="sxs-lookup"><span data-stu-id="bf955-133">In-place update</span></span> | <span data-ttu-id="bf955-134">Em estágios (permuta de VIP)</span><span class="sxs-lookup"><span data-stu-id="bf955-134">Staged (VIP swap)</span></span> | <span data-ttu-id="bf955-135">Excluir e reimplantar</span><span class="sxs-lookup"><span data-stu-id="bf955-135">Delete and re-deploy</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="bf955-136">Versão do sistema operacional</span><span class="sxs-lookup"><span data-stu-id="bf955-136">Operating system version</span></span> |<span data-ttu-id="bf955-137">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-137">Yes</span></span> |<span data-ttu-id="bf955-138">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-138">Yes</span></span> |<span data-ttu-id="bf955-139">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-139">Yes</span></span> |
| <span data-ttu-id="bf955-140">Nível de confiança do .NET</span><span class="sxs-lookup"><span data-stu-id="bf955-140">.NET trust level</span></span> |<span data-ttu-id="bf955-141">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-141">Yes</span></span> |<span data-ttu-id="bf955-142">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-142">Yes</span></span> |<span data-ttu-id="bf955-143">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-143">Yes</span></span> |
| <span data-ttu-id="bf955-144">Tamanho da máquina virtual<sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="bf955-144">Virtual machine size<sup>1</sup></span></span> |<span data-ttu-id="bf955-145">Sim<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="bf955-145">Yes<sup>2</sup></span></span> |<span data-ttu-id="bf955-146">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-146">Yes</span></span> |<span data-ttu-id="bf955-147">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-147">Yes</span></span> |
| <span data-ttu-id="bf955-148">Configurações de armazenamento local</span><span class="sxs-lookup"><span data-stu-id="bf955-148">Local storage settings</span></span> |<span data-ttu-id="bf955-149">Apenas aumento<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="bf955-149">Increase only<sup>2</sup></span></span> |<span data-ttu-id="bf955-150">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-150">Yes</span></span> |<span data-ttu-id="bf955-151">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-151">Yes</span></span> |
| <span data-ttu-id="bf955-152">Adicionar ou remover funções em um serviço</span><span class="sxs-lookup"><span data-stu-id="bf955-152">Add or remove roles in a service</span></span> |<span data-ttu-id="bf955-153">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-153">Yes</span></span> |<span data-ttu-id="bf955-154">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-154">Yes</span></span> |<span data-ttu-id="bf955-155">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-155">Yes</span></span> |
| <span data-ttu-id="bf955-156">Número de instâncias de uma função específica</span><span class="sxs-lookup"><span data-stu-id="bf955-156">Number of instances of a particular role</span></span> |<span data-ttu-id="bf955-157">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-157">Yes</span></span> |<span data-ttu-id="bf955-158">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-158">Yes</span></span> |<span data-ttu-id="bf955-159">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-159">Yes</span></span> |
| <span data-ttu-id="bf955-160">Número ou tipo de pontos de extremidade de um serviço</span><span class="sxs-lookup"><span data-stu-id="bf955-160">Number or type of endpoints for a service</span></span> |<span data-ttu-id="bf955-161">Sim<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="bf955-161">Yes<sup>2</sup></span></span> |<span data-ttu-id="bf955-162">Não</span><span class="sxs-lookup"><span data-stu-id="bf955-162">No</span></span> |<span data-ttu-id="bf955-163">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-163">Yes</span></span> |
| <span data-ttu-id="bf955-164">Nomes e valores dos parâmetros de configuração</span><span class="sxs-lookup"><span data-stu-id="bf955-164">Names and values of configuration settings</span></span> |<span data-ttu-id="bf955-165">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-165">Yes</span></span> |<span data-ttu-id="bf955-166">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-166">Yes</span></span> |<span data-ttu-id="bf955-167">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-167">Yes</span></span> |
| <span data-ttu-id="bf955-168">Valores (mas não nomes) dos parâmetros de configuração</span><span class="sxs-lookup"><span data-stu-id="bf955-168">Values (but not names) of configuration settings</span></span> |<span data-ttu-id="bf955-169">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-169">Yes</span></span> |<span data-ttu-id="bf955-170">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-170">Yes</span></span> |<span data-ttu-id="bf955-171">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-171">Yes</span></span> |
| <span data-ttu-id="bf955-172">Adicionar novos certificados</span><span class="sxs-lookup"><span data-stu-id="bf955-172">Add new certificates</span></span> |<span data-ttu-id="bf955-173">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-173">Yes</span></span> |<span data-ttu-id="bf955-174">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-174">Yes</span></span> |<span data-ttu-id="bf955-175">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-175">Yes</span></span> |
| <span data-ttu-id="bf955-176">Alterar certificados existentes</span><span class="sxs-lookup"><span data-stu-id="bf955-176">Change existing certificates</span></span> |<span data-ttu-id="bf955-177">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-177">Yes</span></span> |<span data-ttu-id="bf955-178">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-178">Yes</span></span> |<span data-ttu-id="bf955-179">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-179">Yes</span></span> |
| <span data-ttu-id="bf955-180">Implantar novo código</span><span class="sxs-lookup"><span data-stu-id="bf955-180">Deploy new code</span></span> |<span data-ttu-id="bf955-181">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-181">Yes</span></span> |<span data-ttu-id="bf955-182">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-182">Yes</span></span> |<span data-ttu-id="bf955-183">Sim</span><span class="sxs-lookup"><span data-stu-id="bf955-183">Yes</span></span> |

<span data-ttu-id="bf955-184"><sup>1</sup>Alteração de tamanho limitado ao subconjunto de tamanhos disponíveis para o serviço de nuvem.</span><span class="sxs-lookup"><span data-stu-id="bf955-184"><sup>1</sup> Size change limited to the subset of sizes available for the cloud service.</span></span>

<span data-ttu-id="bf955-185"><sup>2</sup> Exige o Azure SDK 1.5 ou versões posteriores.</span><span class="sxs-lookup"><span data-stu-id="bf955-185"><sup>2</sup> Requires Azure SDK 1.5 or later versions.</span></span>

> [!WARNING]
> <span data-ttu-id="bf955-186">A alteração do tamanho da máquina virtual destruirá os dados locais.</span><span class="sxs-lookup"><span data-stu-id="bf955-186">Changing the virtual machine size will destroy local data.</span></span>
>
>

<span data-ttu-id="bf955-187">Os itens a seguir não têm suporte durante uma atualização:</span><span class="sxs-lookup"><span data-stu-id="bf955-187">The following items are not supported during an update:</span></span>

* <span data-ttu-id="bf955-188">Alteração do nome de uma função.</span><span class="sxs-lookup"><span data-stu-id="bf955-188">Changing the name of a role.</span></span> <span data-ttu-id="bf955-189">Remova e, em seguida, adicione a função com o novo nome.</span><span class="sxs-lookup"><span data-stu-id="bf955-189">Remove and then add the role with the new name.</span></span>
* <span data-ttu-id="bf955-190">Alteração da contagem de Domínio de atualização.</span><span class="sxs-lookup"><span data-stu-id="bf955-190">Changing of the Upgrade Domain count.</span></span>
* <span data-ttu-id="bf955-191">Redução do tamanho dos recursos locais.</span><span class="sxs-lookup"><span data-stu-id="bf955-191">Decreasing the size of the local resources.</span></span>

<span data-ttu-id="bf955-192">Se você estiver fazendo outras atualizações na definição do serviço, como a redução do tamanho do recurso local, será necessário executar uma atualização de permuta de VIP.</span><span class="sxs-lookup"><span data-stu-id="bf955-192">If you are making other updates to your service's definition, such as decreasing the size of local resource, you must perform a VIP swap update instead.</span></span> <span data-ttu-id="bf955-193">Para saber mais, consulte, consulte [Implantação de permuta](https://msdn.microsoft.com/library/azure/ee460814.aspx).</span><span class="sxs-lookup"><span data-stu-id="bf955-193">For more information, see [Swap Deployment](https://msdn.microsoft.com/library/azure/ee460814.aspx).</span></span>

<a name="howanupgradeproceeds"></a>

## <a name="how-an-upgrade-proceeds"></a><span data-ttu-id="bf955-194">Como uma atualização é realizada</span><span class="sxs-lookup"><span data-stu-id="bf955-194">How an upgrade proceeds</span></span>
<span data-ttu-id="bf955-195">Você pode decidir se deseja atualizar todas as funções ou uma única função no serviço.</span><span class="sxs-lookup"><span data-stu-id="bf955-195">You can decide whether you want to update all of the roles in your service or a single role in the service.</span></span> <span data-ttu-id="bf955-196">Em ambos os casos, todas as instâncias de cada função que está sendo atualizada e pertence ao primeiro domínio de atualização serão interrompidas, atualizadas e colocadas novamente online.</span><span class="sxs-lookup"><span data-stu-id="bf955-196">In either case, all instances of each role that is being upgraded and belong to the first upgrade domain are stopped, upgraded, and brought back online.</span></span> <span data-ttu-id="bf955-197">Quando estiverem online novamente, as instâncias no segundo domínio de atualização serão interrompidas, atualizadas e colocadas novamente online.</span><span class="sxs-lookup"><span data-stu-id="bf955-197">Once they are back online, the instances in the second upgrade domain are stopped, upgraded, and brought back online.</span></span> <span data-ttu-id="bf955-198">Um serviço de nuvem pode ter no máximo uma atualização ativa por vez.</span><span class="sxs-lookup"><span data-stu-id="bf955-198">A cloud service can have at most one upgrade active at a time.</span></span> <span data-ttu-id="bf955-199">A atualização é sempre executada na versão mais recente do serviço de nuvem.</span><span class="sxs-lookup"><span data-stu-id="bf955-199">The upgrade is always performed against the latest version of the cloud service.</span></span>

<span data-ttu-id="bf955-200">O diagrama a seguir ilustra como a atualização ocorre se você estiver atualizando todas as funções no serviço:</span><span class="sxs-lookup"><span data-stu-id="bf955-200">The following diagram illustrates how the upgrade proceeds if you are upgrading all of the roles in the service:</span></span>

<span data-ttu-id="bf955-201">![Atualizar serviço](media/cloud-services-update-azure-service/IC345879.png "Atualizar serviço")</span><span class="sxs-lookup"><span data-stu-id="bf955-201">![Upgrade service](media/cloud-services-update-azure-service/IC345879.png "Upgrade service")</span></span>

<span data-ttu-id="bf955-202">Este próximo diagrama ilustra como a atualização ocorre se você estiver atualizando somente uma única função:</span><span class="sxs-lookup"><span data-stu-id="bf955-202">This next diagram illustrates how the update proceeds if you are upgrading only a single role:</span></span>

<span data-ttu-id="bf955-203">![Atualizar função](media/cloud-services-update-azure-service/IC345880.png "Atualizar função")</span><span class="sxs-lookup"><span data-stu-id="bf955-203">![Upgrade role](media/cloud-services-update-azure-service/IC345880.png "Upgrade role")</span></span>  

<span data-ttu-id="bf955-204">Durante uma atualização automática, o Azure Fabric Controller avalia periodicamente a integridade do serviço de nuvem a fim de determinar quando é seguro passar ao próximo UD.</span><span class="sxs-lookup"><span data-stu-id="bf955-204">During an automatic update, the Azure Fabric Controller periodically evaluates the health of the cloud service to determine when it’s safe to walk the next UD.</span></span> <span data-ttu-id="bf955-205">Essa avaliação de integridade é executada de acordo com a função e considera apenas instâncias na versão mais recente (ou seja, instâncias de UDs que já foram descritos).</span><span class="sxs-lookup"><span data-stu-id="bf955-205">This health evaluation is performed on a per-role basis and considers only instances in the latest version (i.e. instances from UDs that have already been walked).</span></span> <span data-ttu-id="bf955-206">Ela verifica se um número mínimo de instâncias de função, para cada função, atingiu um estado de terminal satisfatório.</span><span class="sxs-lookup"><span data-stu-id="bf955-206">It verifies that a minimum number of role instances, for each role, have achieved a satisfactory terminal state.</span></span>

### <a name="role-instance-start-timeout"></a><span data-ttu-id="bf955-207">Tempo limite de inicialização de instância de função</span><span class="sxs-lookup"><span data-stu-id="bf955-207">Role Instance Start Timeout</span></span>
<span data-ttu-id="bf955-208">O controlador de malha aguardará 30 minutos para cada instância de função atingir um estado iniciado.</span><span class="sxs-lookup"><span data-stu-id="bf955-208">The Fabric Controller will wait 30 minutes for each role instance to reach a Started state.</span></span> <span data-ttu-id="bf955-209">Se a duração do tempo limite expirar, o controlador de malha prosseguirá para a próxima instância de função.</span><span class="sxs-lookup"><span data-stu-id="bf955-209">If the timeout duration elapses, the Fabric Controller will continue walking to the next role instance.</span></span>

### <a name="impact-to-drive-data-during-cloud-service-upgrades"></a><span data-ttu-id="bf955-210">Impacto nos dados da unidade durante atualizações do Serviço de nuvem</span><span class="sxs-lookup"><span data-stu-id="bf955-210">Impact to drive data during Cloud Service upgrades</span></span>

<span data-ttu-id="bf955-211">Ao atualizar um serviço de uma única instância para várias instâncias, seu serviço será interrompido enquanto a atualização estiver em execução, devido ao modo como o Azure atualiza os serviços.</span><span class="sxs-lookup"><span data-stu-id="bf955-211">When upgrading a service from a single instance to multiple instances your service will be brought down while the upgrade is performed due to the way Azure upgrades services.</span></span> <span data-ttu-id="bf955-212">A garantia de disponibilidade do serviço do contrato de nível de serviço só se aplica aos serviços implantados com mais de uma instância.</span><span class="sxs-lookup"><span data-stu-id="bf955-212">The service level agreement guaranteeing service availability only applies to services that are deployed with more than one instance.</span></span> <span data-ttu-id="bf955-213">A lista a seguir descreve como os dados em cada unidade são afetados por cada cenário de atualização de serviço do Azure:</span><span class="sxs-lookup"><span data-stu-id="bf955-213">The following list describes how the data on each drive is affected by each Azure service upgrade scenario:</span></span>

|<span data-ttu-id="bf955-214">Cenário</span><span class="sxs-lookup"><span data-stu-id="bf955-214">Scenario</span></span>|<span data-ttu-id="bf955-215">Unidade C</span><span class="sxs-lookup"><span data-stu-id="bf955-215">C Drive</span></span>|<span data-ttu-id="bf955-216">Unidade D</span><span class="sxs-lookup"><span data-stu-id="bf955-216">D Drive</span></span>|<span data-ttu-id="bf955-217">Unidade E</span><span class="sxs-lookup"><span data-stu-id="bf955-217">E Drive</span></span>|
|--------|-------|-------|-------|
|<span data-ttu-id="bf955-218">Reinicialização da VM</span><span class="sxs-lookup"><span data-stu-id="bf955-218">VM reboot</span></span>|<span data-ttu-id="bf955-219">Preservado</span><span class="sxs-lookup"><span data-stu-id="bf955-219">Preserved</span></span>|<span data-ttu-id="bf955-220">Preservado</span><span class="sxs-lookup"><span data-stu-id="bf955-220">Preserved</span></span>|<span data-ttu-id="bf955-221">Preservado</span><span class="sxs-lookup"><span data-stu-id="bf955-221">Preserved</span></span>|
|<span data-ttu-id="bf955-222">Reinicialização do portal</span><span class="sxs-lookup"><span data-stu-id="bf955-222">Portal reboot</span></span>|<span data-ttu-id="bf955-223">Preservado</span><span class="sxs-lookup"><span data-stu-id="bf955-223">Preserved</span></span>|<span data-ttu-id="bf955-224">Preservado</span><span class="sxs-lookup"><span data-stu-id="bf955-224">Preserved</span></span>|<span data-ttu-id="bf955-225">Destruído</span><span class="sxs-lookup"><span data-stu-id="bf955-225">Destroyed</span></span>|
|<span data-ttu-id="bf955-226">Nova imagem do Portal</span><span class="sxs-lookup"><span data-stu-id="bf955-226">Portal reimage</span></span>|<span data-ttu-id="bf955-227">Preservado</span><span class="sxs-lookup"><span data-stu-id="bf955-227">Preserved</span></span>|<span data-ttu-id="bf955-228">Destruído</span><span class="sxs-lookup"><span data-stu-id="bf955-228">Destroyed</span></span>|<span data-ttu-id="bf955-229">Destruído</span><span class="sxs-lookup"><span data-stu-id="bf955-229">Destroyed</span></span>|
|<span data-ttu-id="bf955-230">Atualização in-loco</span><span class="sxs-lookup"><span data-stu-id="bf955-230">In-Place Upgrade</span></span>|<span data-ttu-id="bf955-231">Preservado</span><span class="sxs-lookup"><span data-stu-id="bf955-231">Preserved</span></span>|<span data-ttu-id="bf955-232">Preservado</span><span class="sxs-lookup"><span data-stu-id="bf955-232">Preserved</span></span>|<span data-ttu-id="bf955-233">Destruído</span><span class="sxs-lookup"><span data-stu-id="bf955-233">Destroyed</span></span>|
|<span data-ttu-id="bf955-234">Migração de nó</span><span class="sxs-lookup"><span data-stu-id="bf955-234">Node migration</span></span>|<span data-ttu-id="bf955-235">Destruído</span><span class="sxs-lookup"><span data-stu-id="bf955-235">Destroyed</span></span>|<span data-ttu-id="bf955-236">Destruído</span><span class="sxs-lookup"><span data-stu-id="bf955-236">Destroyed</span></span>|<span data-ttu-id="bf955-237">Destruído</span><span class="sxs-lookup"><span data-stu-id="bf955-237">Destroyed</span></span>|

<span data-ttu-id="bf955-238">Observe que, na lista acima, a unidade E: representa a unidade raiz da função e não deve ser codificada.</span><span class="sxs-lookup"><span data-stu-id="bf955-238">Note that, in the above list, the E: drive represents the role’s root drive, and should not be hard-coded.</span></span> <span data-ttu-id="bf955-239">Em vez disso, use a variável de ambiente **%RoleRoot%** para representar a unidade.</span><span class="sxs-lookup"><span data-stu-id="bf955-239">Instead, use the **%RoleRoot%** environment variable to represent the drive.</span></span>

<span data-ttu-id="bf955-240">Para minimizar o tempo de inatividade ao atualizar um serviço de instância única, implante um novo serviço de várias instâncias no servidor de preparo e execute uma permuta de VIP.</span><span class="sxs-lookup"><span data-stu-id="bf955-240">To minimize the downtime when upgrading a single-instance service, deploy a new multi-instance service to the staging server and perform a VIP swap.</span></span>

<a name="RollbackofanUpdate"></a>

## <a name="rollback-of-an-update"></a><span data-ttu-id="bf955-241">Reversão de uma atualização</span><span class="sxs-lookup"><span data-stu-id="bf955-241">Rollback of an update</span></span>
<span data-ttu-id="bf955-242">O Azure fornece flexibilidade no gerenciamento de serviços durante uma atualização, permitindo que você inicie outras operações em um serviço, após a aceitação da solicitação de atualização inicial pelo controlador de malha do Azure.</span><span class="sxs-lookup"><span data-stu-id="bf955-242">Azure provides flexibility in managing services during an update by letting you initiate additional operations on a service, after the initial update request is accepted by the Azure Fabric Controller.</span></span> <span data-ttu-id="bf955-243">Uma reversão só pode ser realizada quando uma atualização (mudança de configuração) ou upgrade estiver no estado **em andamento** na implantação.</span><span class="sxs-lookup"><span data-stu-id="bf955-243">A rollback can only be performed when an update (configuration change) or upgrade is in the **in progress** state on the deployment.</span></span> <span data-ttu-id="bf955-244">Uma atualização ou upgrade é considerada em andamento desde que exista pelo menos uma instância do serviço que ainda não foi atualizada para a nova versão.</span><span class="sxs-lookup"><span data-stu-id="bf955-244">An update or upgrade is considered to be in-progress as long as there is at least one instance of the service which has not yet been updated to the new version.</span></span> <span data-ttu-id="bf955-245">Para testar se há permissão para uma reversão, verifique se o valor do sinalizador RollbackAllowed, retornado pelas operações [Obter Implantação](https://msdn.microsoft.com/library/azure/ee460804.aspx) e [Obter Propriedades do Serviço de Nuvem](https://msdn.microsoft.com/library/azure/ee460806.aspx), está definido como true.</span><span class="sxs-lookup"><span data-stu-id="bf955-245">To test whether a rollback is allowed, check the value of the RollbackAllowed flag, returned by [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) and [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx) operations, is set to true.</span></span>

> [!NOTE]
> <span data-ttu-id="bf955-246">Só faz sentido chamar a Reversão em uma atualização ou upgrade **in-loco** porque os upgrades de permuta de VIP envolvem a substituição de toda uma instância em execução do seu serviço por outra.</span><span class="sxs-lookup"><span data-stu-id="bf955-246">It only makes sense to call Rollback on an **in-place** update or upgrade because VIP swap upgrades involve replacing one entire running instance of your service with another.</span></span>
>
>

<span data-ttu-id="bf955-247">A Reversão de uma atualização em andamento tem os seguintes efeitos sobre a implantação:</span><span class="sxs-lookup"><span data-stu-id="bf955-247">Rollback of an in-progress update has the following effects on the deployment:</span></span>

* <span data-ttu-id="bf955-248">Quaisquer instâncias de função que ainda não foram atualizadas para a nova versão não serão atualizadas, porque essas instâncias já estão executando a versão de destino do serviço.</span><span class="sxs-lookup"><span data-stu-id="bf955-248">Any role instances which had not yet been updated or upgraded to the new version are not updated or upgraded, because those instances are already running the target version of the service.</span></span>
* <span data-ttu-id="bf955-249">Quaisquer instâncias de função que já foram atualizadas para a nova versão do arquivo de pacote (\*.cspkg) do serviço ou do arquivo de configuração (\*.cscfg) do serviço (ou ambos os arquivos) serão revertidas para a versão pré-atualização desses arquivos.</span><span class="sxs-lookup"><span data-stu-id="bf955-249">Any role instances which had already been updated or upgraded to the new version of the service package (\*.cspkg) file or the service configuration (\*.cscfg) file (or both files) are reverted to the pre-upgrade version of these files.</span></span>

<span data-ttu-id="bf955-250">Essa funcionalidade é fornecida pelos seguintes recursos:</span><span class="sxs-lookup"><span data-stu-id="bf955-250">This functionally is provided by the following features:</span></span>

* <span data-ttu-id="bf955-251">A operação [Reversão de Atualização ou Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx), que pode ser chamada em uma atualização de configuração (disparada chamando [Alterar configuração de implantação](https://msdn.microsoft.com/library/azure/ee460809.aspx)) ou upgrade (disparado chamando [Implantação de atualização](https://msdn.microsoft.com/library/azure/ee460793.aspx)) desde que haja pelo menos uma instância do serviço que ainda não tenha sido atualizada para a nova versão.</span><span class="sxs-lookup"><span data-stu-id="bf955-251">The [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) operation, which can be called on a configuration update (triggered by calling [Change Deployment Configuration](https://msdn.microsoft.com/library/azure/ee460809.aspx)) or an upgrade (triggered by calling [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx)) as long as there is at least one instance in the service which has not yet been updated to the new version.</span></span>
* <span data-ttu-id="bf955-252">O elemento Bloqueado e o elemento RollbackAllowed, que retornam como parte do corpo da resposta das operações [Obter a implantação](https://msdn.microsoft.com/library/azure/ee460804.aspx) e [Obter propriedades do serviço de nuvem](https://msdn.microsoft.com/library/azure/ee460806.aspx):</span><span class="sxs-lookup"><span data-stu-id="bf955-252">The Locked element and the RollbackAllowed element, which are returned as part of the response body of the [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) and [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx) operations:</span></span>

  1. <span data-ttu-id="bf955-253">O elemento Locked permite a você detectar quando uma operação de mutação pode ser chamada em uma determinada implantação.</span><span class="sxs-lookup"><span data-stu-id="bf955-253">The Locked element allows you to detect when a mutating operation can be invoked on a given deployment.</span></span>
  2. <span data-ttu-id="bf955-254">O elemento RollbackAllowed permite detectar quando a operação [Reversão de atualização ou upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) pode ser chamada em uma determinada implantação.</span><span class="sxs-lookup"><span data-stu-id="bf955-254">The RollbackAllowed element allows you to detect when the [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) operation can be called on a given deployment.</span></span>

  <span data-ttu-id="bf955-255">Para executar uma reversão, você não precisa verificar os elementos Locked e RollbackAllowed.</span><span class="sxs-lookup"><span data-stu-id="bf955-255">In order to perform a rollback, you do not have to check both the Locked and the RollbackAllowed elements.</span></span> <span data-ttu-id="bf955-256">Basta confirmar se RollbackAllowed está definido como true.</span><span class="sxs-lookup"><span data-stu-id="bf955-256">It suffices to confirm that RollbackAllowed is set to true.</span></span> <span data-ttu-id="bf955-257">Esses elementos retornam apenas se esses métodos forem chamados usando o cabeçalho de solicitação definido como "x-ms-version: 2011-10-01" ou uma versão posterior.</span><span class="sxs-lookup"><span data-stu-id="bf955-257">These elements are only returned if these methods are invoked by using the request header set to “x-ms-version: 2011-10-01” or a later version.</span></span> <span data-ttu-id="bf955-258">Para saber mais sobre os cabeçalhos de controle de versão, consulte [Controle de versão do serviço de gerenciamento](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span><span class="sxs-lookup"><span data-stu-id="bf955-258">For more information about versioning headers, see [Service Management Versioning](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span></span>

<span data-ttu-id="bf955-259">Há algumas situações nas quais não há suporte para uma reversão de uma atualização ou upgrade, entre elas:</span><span class="sxs-lookup"><span data-stu-id="bf955-259">There are some situations where a rollback of an update or upgrade is not supported, these are as follows:</span></span>

* <span data-ttu-id="bf955-260">Redução nos recursos locais - se a atualização aumentar os recursos locais para uma função, a plataforma do Azure não permitirá a reversão.</span><span class="sxs-lookup"><span data-stu-id="bf955-260">Reduction in local resources - If the update increases the local resources for a role the Azure platform does not allow rolling back.</span></span>
* <span data-ttu-id="bf955-261">Limites de cota - se a atualização foi uma operação de redução vertical, talvez você não tenha cota de computação suficiente para concluir a operação de reversão.</span><span class="sxs-lookup"><span data-stu-id="bf955-261">Quota limitations - If the update was a scale down operation you may no longer have sufficient compute quota to complete the rollback operation.</span></span> <span data-ttu-id="bf955-262">Cada assinatura do Azure tem uma cota associada que especifica o número máximo de núcleos que podem ser consumidos por todos os serviços hospedados que pertencem a essa assinatura.</span><span class="sxs-lookup"><span data-stu-id="bf955-262">Each Azure subscription has a quota associated with it that specifies the maximum number of cores which can be consumed by all hosted services that belong to that subscription.</span></span> <span data-ttu-id="bf955-263">Se a execução de uma reversão de uma determinada atualização colocar sua assinatura acima da cota, a reversão não será habilitada.</span><span class="sxs-lookup"><span data-stu-id="bf955-263">If performing a rollback of a given update would put your subscription over quota then that a rollback will not be enabled.</span></span>
* <span data-ttu-id="bf955-264">Condição de corrida - Se a atualização inicial tiver sido concluída, não será possível realizar uma reversão.</span><span class="sxs-lookup"><span data-stu-id="bf955-264">Race condition - If the initial update has completed, a rollback is not possible.</span></span>

<span data-ttu-id="bf955-265">Um exemplo de quando a reversão de uma atualização pode ser útil é se você estiver usando a operação [Implantação de atualização](https://msdn.microsoft.com/library/azure/ee460793.aspx) no modo manual para controlar a taxa com a qual uma grande atualização in-loco em seu serviço hospedado do Azure é implantada.</span><span class="sxs-lookup"><span data-stu-id="bf955-265">An example of when the rollback of an update might be useful is if you are using the [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx) operation in manual mode to control the rate at which a major in-place upgrade to your Azure hosted service is rolled out.</span></span>

<span data-ttu-id="bf955-266">Durante a implantação da atualização você chama a [Implantação de atualização](https://msdn.microsoft.com/library/azure/ee460793.aspx) no modo manual e começa a percorrer os domínios de atualização.</span><span class="sxs-lookup"><span data-stu-id="bf955-266">During the rollout of the upgrade you call [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx) in manual mode and begin to walk upgrade domains.</span></span> <span data-ttu-id="bf955-267">Se, em algum momento, enquanto monitora a atualização, você observar algumas instâncias de função nos primeiros domínios de atualização ficarem sem resposta, chame a operação [Reversão de atualização ou upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) na implantação, e isso deixará as instâncias que ainda não tinham sido atualizadas sem alteração e reverterá as instâncias que foram atualizadas para o pacote de serviço e configuração anteriores.</span><span class="sxs-lookup"><span data-stu-id="bf955-267">If at some point, as you monitor the upgrade, you note some role instances in the first upgrade domains that you examine have become unresponsive, you can call the [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) operation on the deployment, which will leave untouched the instances which had not yet been upgraded and rollback instances which had been upgraded to the previous service package and configuration.</span></span>

<a name="multiplemutatingoperations"></a>

## <a name="initiating-multiple-mutating-operations-on-an-ongoing-deployment"></a><span data-ttu-id="bf955-268">Inicialização de várias operações de mutação em uma implantação em andamento</span><span class="sxs-lookup"><span data-stu-id="bf955-268">Initiating multiple mutating operations on an ongoing deployment</span></span>
<span data-ttu-id="bf955-269">Em alguns casos, convém iniciar várias operações de mutação simultâneas em uma implantação em andamento.</span><span class="sxs-lookup"><span data-stu-id="bf955-269">In some cases you may want to initiate multiple simultaneous mutating operations on an ongoing deployment.</span></span> <span data-ttu-id="bf955-270">Por exemplo, você pode executar uma atualização de serviço e, enquanto a atualização estiver sendo revertida em seu serviço, convém fazer algumas alterações por exemplo, reverter a atualização, aplicar outra atualização ou até mesmo excluir a implantação.</span><span class="sxs-lookup"><span data-stu-id="bf955-270">For example, you may perform a service update and, while that update is being rolled out across your service, you want to make some change, e.g. to roll the update back, apply a different update, or even delete the deployment.</span></span> <span data-ttu-id="bf955-271">Um caso em que isso pode ser necessário é se uma atualização de serviço contiver um código com bugs que faz com que uma instância de função atualizada apresente falhas repetidamente.</span><span class="sxs-lookup"><span data-stu-id="bf955-271">A case in which this might be necessary is if a service upgrade contains buggy code which causes an upgraded role instance to repeatedly crash.</span></span> <span data-ttu-id="bf955-272">Nesse caso, o controlador de malha do Azure não poderá progredir com a aplicação dessa atualização, pois há um número insuficiente de instâncias íntegras no domínio atualizado.</span><span class="sxs-lookup"><span data-stu-id="bf955-272">In this case, the Azure Fabric Controller will not be able to make progress in applying that upgrade because an insufficient number of instances in the upgraded domain are healthy.</span></span> <span data-ttu-id="bf955-273">Esse estado é conhecido como *implantação paralisada*.</span><span class="sxs-lookup"><span data-stu-id="bf955-273">This state is referred to as a *stuck deployment*.</span></span> <span data-ttu-id="bf955-274">Você pode resolver a paralisação da implantação revertendo a atualização ou aplicando uma nova atualização sobre a atualização com falha.</span><span class="sxs-lookup"><span data-stu-id="bf955-274">You can unstick the deployment by rolling back the update or applying a fresh update over top of the failing one.</span></span>

<span data-ttu-id="bf955-275">Após o recebimento da solicitação inicial de atualização ou upgrade pelo controlador de malha do Azure, você pode iniciar operações de mutação subsequentes.</span><span class="sxs-lookup"><span data-stu-id="bf955-275">Once the initial request to update or upgrade the service has been received by the Azure Fabric Controller, you can start subsequent mutating operations.</span></span> <span data-ttu-id="bf955-276">Ou seja, não é necessário esperar que a operação inicial seja concluída antes de iniciar outra operação de mutação.</span><span class="sxs-lookup"><span data-stu-id="bf955-276">That is, you do not have to wait for the initial operation to complete before you can start another mutating operation.</span></span>

<span data-ttu-id="bf955-277">Iniciar uma segunda operação de atualização enquanto a primeira atualização está em andamento terá um desempenho semelhante à operação de reversão.</span><span class="sxs-lookup"><span data-stu-id="bf955-277">Initiating a second update operation while the first update is ongoing will perform similar to the rollback operation.</span></span> <span data-ttu-id="bf955-278">Se a segunda atualização estiver em modo automático, o primeiro domínio de atualização será atualizado imediatamente, possivelmente fazendo com que vários domínios de atualização fiquem offline no mesmo período.</span><span class="sxs-lookup"><span data-stu-id="bf955-278">If the second update is in automatic mode, the first upgrade domain will be upgraded immediately, possibly leading to instances from multiple upgrade domains being offline at the same point in time.</span></span>

<span data-ttu-id="bf955-279">As operações de mutação são as seguintes: [Alterar configuração de implantação](https://msdn.microsoft.com/library/azure/ee460809.aspx), [Implantação de atualização](https://msdn.microsoft.com/library/azure/ee460793.aspx), [Status da implantação de atualização](https://msdn.microsoft.com/library/azure/ee460808.aspx), [Excluir implantação](https://msdn.microsoft.com/library/azure/ee460815.aspx) e [Reversão de atualização ou upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx).</span><span class="sxs-lookup"><span data-stu-id="bf955-279">The mutating operations are as follows: [Change Deployment Configuration](https://msdn.microsoft.com/library/azure/ee460809.aspx), [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx), [Update Deployment Status](https://msdn.microsoft.com/library/azure/ee460808.aspx), [Delete Deployment](https://msdn.microsoft.com/library/azure/ee460815.aspx), and [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx).</span></span>

<span data-ttu-id="bf955-280">Duas operações, [Obter a implantação](https://msdn.microsoft.com/library/azure/ee460804.aspx) e [Obter propriedades do serviço de nuvem](https://msdn.microsoft.com/library/azure/ee460806.aspx), retornam o sinalizador Locked, que pode ser examinado a fim de determinar se uma operação de mutação pode ser chamada em uma determinada implantação.</span><span class="sxs-lookup"><span data-stu-id="bf955-280">Two operations, [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) and [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx), return the Locked flag which can be examined to determine whether a mutating operation can be invoked on a given deployment.</span></span>

<span data-ttu-id="bf955-281">Para chamar a versão desses métodos que retorna o sinalizador Locked, você deve definir o cabeçalho de solicitação como "x-ms-version: 2011-10-01" ou posterior.</span><span class="sxs-lookup"><span data-stu-id="bf955-281">In order to call the version of these methods which returns the Locked flag, you must set request header to “x-ms-version: 2011-10-01” or a later.</span></span> <span data-ttu-id="bf955-282">Para saber mais sobre os cabeçalhos de controle de versão, consulte [Controle de versão do serviço de gerenciamento](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span><span class="sxs-lookup"><span data-stu-id="bf955-282">For more information about versioning headers, see [Service Management Versioning](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span></span>

<a name="distributiondfroles"></a>

## <a name="distribution-of-roles-across-upgrade-domains"></a><span data-ttu-id="bf955-283">Distribuição de funções em domínios de atualização</span><span class="sxs-lookup"><span data-stu-id="bf955-283">Distribution of roles across upgrade domains</span></span>
<span data-ttu-id="bf955-284">O Azure distribui instâncias de uma função uniformemente por um determinado número de domínios de atualização, que pode ser configurado como parte do arquivo de definição (.csdef) do serviço.</span><span class="sxs-lookup"><span data-stu-id="bf955-284">Azure distributes instances of a role evenly across a set number of upgrade domains, which can be configured as part of the service definition (.csdef) file.</span></span> <span data-ttu-id="bf955-285">O número máximo de domínios de atualização é de 20 e o padrão é cinco.</span><span class="sxs-lookup"><span data-stu-id="bf955-285">The max number of upgrade domains is 20 and the default is 5.</span></span> <span data-ttu-id="bf955-286">Para saber mais sobre como modificar o arquivo de definição de serviço, consulte [Esquema de definição de serviço do Azure (arquivo .csdef)](cloud-services-model-and-package.md#csdef).</span><span class="sxs-lookup"><span data-stu-id="bf955-286">For more information about how to modify the service definition file, see [Azure Service Definition Schema (.csdef File)](cloud-services-model-and-package.md#csdef).</span></span>

<span data-ttu-id="bf955-287">Por exemplo, se a sua função tiver dez instâncias, por padrão cada domínio de atualização conterá duas instâncias.</span><span class="sxs-lookup"><span data-stu-id="bf955-287">For example, if your role has ten instances, by default each upgrade domain contains two instances.</span></span> <span data-ttu-id="bf955-288">Se a sua função tiver 14 instâncias, quatro dos domínios de atualização conterão três instâncias e um quinto domínio conterá duas.</span><span class="sxs-lookup"><span data-stu-id="bf955-288">If your role has 14 instances, then four of the upgrade domains contain three instances, and a fifth domain contains two.</span></span>

<span data-ttu-id="bf955-289">Os domínios de atualização são identificados com um índice baseado em zero: o primeiro domínio de atualização tem uma ID de 0 e o segundo domínio de atualização tem uma ID de 1 e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="bf955-289">Upgrade domains are identified with a zero-based index: the first upgrade domain has an ID of 0, and the second upgrade domain has an ID of 1, and so on.</span></span>

<span data-ttu-id="bf955-290">O diagrama a seguir ilustra como é a distribuição de um serviço que contém duas funções quando o serviço define dois domínios de atualização.</span><span class="sxs-lookup"><span data-stu-id="bf955-290">The following diagram illustrates how a service than contains two roles are distributed when the service defines two upgrade domains.</span></span> <span data-ttu-id="bf955-291">O serviço está executando oito instâncias da função Web e nove instâncias da função de trabalho.</span><span class="sxs-lookup"><span data-stu-id="bf955-291">The service is running eight instances of the web role and nine instances of the worker role.</span></span>

<span data-ttu-id="bf955-292">![Distribuição de domínios de atualização](media/cloud-services-update-azure-service/IC345533.png "Distribuição de domínios de atualização")</span><span class="sxs-lookup"><span data-stu-id="bf955-292">![Distribution of Upgrade Domains](media/cloud-services-update-azure-service/IC345533.png "Distribution of Upgrade Domains")</span></span>

> [!NOTE]
> <span data-ttu-id="bf955-293">Observe que o Azure controla como as instâncias são alocadas nos domínios de atualização.</span><span class="sxs-lookup"><span data-stu-id="bf955-293">Note that Azure controls how instances are allocated across upgrade domains.</span></span> <span data-ttu-id="bf955-294">Não é possível especificar quais instâncias são alocadas para cada domínio.</span><span class="sxs-lookup"><span data-stu-id="bf955-294">It's not possible to specify which instances are allocated to which domain.</span></span>
>
>

## <a name="next-steps"></a><span data-ttu-id="bf955-295">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="bf955-295">Next steps</span></span>
[<span data-ttu-id="bf955-296">Como gerenciar serviços de nuvem</span><span class="sxs-lookup"><span data-stu-id="bf955-296">How to Manage Cloud Services</span></span>](cloud-services-how-to-manage.md)  
[<span data-ttu-id="bf955-297">Como monitorar serviços de nuvem</span><span class="sxs-lookup"><span data-stu-id="bf955-297">How to Monitor Cloud Services</span></span>](cloud-services-how-to-monitor.md)  
[<span data-ttu-id="bf955-298">Como configurar os Serviços de Nuvem</span><span class="sxs-lookup"><span data-stu-id="bf955-298">How to Configure Cloud Services</span></span>](cloud-services-how-to-configure.md)  
