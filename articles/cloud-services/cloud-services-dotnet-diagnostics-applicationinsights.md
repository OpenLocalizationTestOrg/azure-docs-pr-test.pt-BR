---
title: "Solucionar problemas de Serviços de Nuvem usando o Application Insights | Microsoft Docs"
description: "Saiba como solucionar problemas do serviço de nuvem usando o Application Insights para processar dados do Diagnóstico do Azure."
services: cloud-services
documentationcenter: .net
author: sbtron
manager: timlt
editor: tysonn
ms.assetid: e93f387b-ef29-4731-ae41-0676722accb6
ms.service: cloud-services
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 05/23/2017
ms.author: saurabh
ms.openlocfilehash: 4001ca908ff00b1a40829d687589080e9b07b18a
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="troubleshoot-cloud-services-using-application-insights"></a><span data-ttu-id="33842-103">Solucionar problemas de Serviços de Nuvem usando o Application Insights</span><span class="sxs-lookup"><span data-stu-id="33842-103">Troubleshoot Cloud Services using Application Insights</span></span>
<span data-ttu-id="33842-104">Com o [Azure SDK 2.8](https://azure.microsoft.com/downloads/) e a extensão de diagnóstico do Azure 1.5, você pode enviar seus dados do Diagnóstico do Azure para seu serviço de nuvem diretamente para o Application Insights.</span><span class="sxs-lookup"><span data-stu-id="33842-104">With [Azure SDK 2.8](https://azure.microsoft.com/downloads/) and Azure diagnostics extension 1.5, you can send Azure Diagnostics data for your Cloud Service directly to Application Insights.</span></span> <span data-ttu-id="33842-105">Os logs coletados pelo Diagnóstico do Azure&mdash;incluindo logs de aplicativo, Logs de Eventos do Windows, Logs do ETW e contadores de desempenho&mdash;podem ser enviados ao Application Insights.</span><span class="sxs-lookup"><span data-stu-id="33842-105">The logs collected by Azure Diagnostics&mdash;including application logs, Windows Event Logs, ETW Logs, and performance counters&mdash;can be sent to Application Insights.</span></span> <span data-ttu-id="33842-106">Em seguida, você pode visualizar essas informações na interface do usuário do portal do Application Insights.</span><span class="sxs-lookup"><span data-stu-id="33842-106">You can then visualize this information in the Application Insights portal UI.</span></span> <span data-ttu-id="33842-107">Então, você pode usar o SDK do Application Insights para obter informações sobre as métricas e os logs que vêm do seu aplicativo, bem sobre dados em nível de sistema e infraestrutura que vêm do Diagnóstico do Azure.</span><span class="sxs-lookup"><span data-stu-id="33842-107">You can then use the Application Insights SDK to get insights into metrics and logs that come from your application, as well as the system and infrastructure-level data that comes from Azure Diagnostics.</span></span>

## <a name="configure-azure-diagnostics-to-send-data-to-application-insights"></a><span data-ttu-id="33842-108">Configurar o Diagnóstico do Azure para enviar dados para o Application Insights</span><span class="sxs-lookup"><span data-stu-id="33842-108">Configure Azure Diagnostics to send data to Application Insights</span></span>
<span data-ttu-id="33842-109">Siga estas etapas para configurar seu projeto de serviço de nuvem e enviar os dados do Diagnóstico do Azure para o Application Insights.</span><span class="sxs-lookup"><span data-stu-id="33842-109">Follow these steps to set up your cloud service project to send Azure Diagnostics data to Application Insights.</span></span>

1. <span data-ttu-id="33842-110">No Gerenciador de Soluções do Visual Studio, clique com o botão direito do mouse em uma função e selecione **Propriedades** para abrir o Designer de função.</span><span class="sxs-lookup"><span data-stu-id="33842-110">In Visual Studio Solution Explorer, right-click a role and select **Properties** to open the Role designer.</span></span>

    ![Propriedades da função Gerenciador de Soluções][1]

2. <span data-ttu-id="33842-112">Na seção **Diagnóstico** do Designer de função, selecione a opção **Enviar dados de diagnóstico ao Application Insights**.</span><span class="sxs-lookup"><span data-stu-id="33842-112">In the **Diagnostics** section of the Role designer, select the **Send diagnostics data to Application Insights** option.</span></span>

    ![O designer de função envia dados de diagnóstico para o application insights][2]

3. <span data-ttu-id="33842-114">Na caixa de diálogo que abre em pop-up, selecione o recurso do Application Insights ao qual você gostaria de enviar os dados de diagnóstico do Azure.</span><span class="sxs-lookup"><span data-stu-id="33842-114">In the dialog box that pops up, select the Application Insights resource that you want to send the Azure diagnostics data to.</span></span> <span data-ttu-id="33842-115">A caixa de diálogo permite selecionar um recurso do Application Insights existente na sua assinatura ou especificar manualmente uma chave de instrumentação para um recurso do Application Insights.</span><span class="sxs-lookup"><span data-stu-id="33842-115">The dialog box allows you to select an existing Application Insights resource from your subscription or to manually specify an instrumentation key for an Application Insights resource.</span></span> <span data-ttu-id="33842-116">Para saber mais sobre como criar um recurso do Application Insights, confira [Criar um novo recurso do Application Insights](../application-insights/app-insights-create-new-resource.md).</span><span class="sxs-lookup"><span data-stu-id="33842-116">For more information on creating an Application Insights resource, see [Create a new Application Insights resource](../application-insights/app-insights-create-new-resource.md).</span></span>

    ![selecionar recurso do application insights][3]

    <span data-ttu-id="33842-118">Depois de adicionar o recurso do Application Insights, a chave de instrumentação para esse recurso fica armazenada como uma definição de configuração de serviço com o nome **APPINSIGHTS_INSTRUMENTATIONKEY**.</span><span class="sxs-lookup"><span data-stu-id="33842-118">Once you have added the Application Insights resource, the instrumentation key for that resource is stored as a service configuration setting with the name **APPINSIGHTS_INSTRUMENTATIONKEY**.</span></span> <span data-ttu-id="33842-119">Você pode alterar essa configuração para cada ambiente ou configuração de serviço.</span><span class="sxs-lookup"><span data-stu-id="33842-119">You can change this configuration setting for each service configuration or environment.</span></span> <span data-ttu-id="33842-120">Para fazer isso, selecione uma configuração diferente na lista **Configuração do serviço** e especifique uma nova chave de instrumentação para essa configuração.</span><span class="sxs-lookup"><span data-stu-id="33842-120">To do so, select a different configuration from the **Service Configuration** list and specify a new instrumentation key for that configuration.</span></span>

    ![selecionar configuração de serviço][4]

    <span data-ttu-id="33842-122">A configuração **APPINSIGHTS_INSTRUMENTATIONKEY** é usada pelo Visual Studio para configurar a extensão de diagnóstico com as informações apropriadas do recurso do Application Insights durante a publicação.</span><span class="sxs-lookup"><span data-stu-id="33842-122">The **APPINSIGHTS_INSTRUMENTATIONKEY** configuration setting is used by Visual Studio to configure the diagnostics extension with the appropriate Application Insights resource information during publishing.</span></span> <span data-ttu-id="33842-123">A configuração é uma maneira conveniente de definir chaves de instrumentação diferentes para configurações de serviço diferentes.</span><span class="sxs-lookup"><span data-stu-id="33842-123">The configuration setting is a convenient way of defining different instrumentation keys for different service configurations.</span></span> <span data-ttu-id="33842-124">O Visual Studio converterá essa configuração e a inserirá na configuração pública da extensão de diagnóstico durante o processo de publicação.</span><span class="sxs-lookup"><span data-stu-id="33842-124">Visual Studio will translate that setting and insert it into the diagnostics extension public configuration during the publish process.</span></span> <span data-ttu-id="33842-125">Para simplificar o processo de configuração da extensão de diagnóstico com o PowerShell, a saída de pacote do Visual Studio também contém o XML de configuração pública com a chave de instrumentação do Application Insights adequada.</span><span class="sxs-lookup"><span data-stu-id="33842-125">To simplify the process of configuring the diagnostics extension with PowerShell, the package output from Visual Studio also contains the public configuration XML with the appropriate Application Insights instrumentation key.</span></span> <span data-ttu-id="33842-126">Os arquivos de configuração públicos são criados na pasta Extensões e seguem o padrão *PaaSDiagnostics.&lt;RoleName&gt;.PubConfig.xml*.</span><span class="sxs-lookup"><span data-stu-id="33842-126">The public config files are created in the Extensions folder and follow the pattern *PaaSDiagnostics.&lt;RoleName&gt;.PubConfig.xml*.</span></span> <span data-ttu-id="33842-127">Quaisquer implantações baseadas em PowerShell podem usar esse padrão para mapear cada configuração para uma função.</span><span class="sxs-lookup"><span data-stu-id="33842-127">Any PowerShell-based deployments can use this pattern to map each configuration to a role.</span></span>

4) <span data-ttu-id="33842-128">Para configurar o diagnóstico do Azure para enviar todos os contadores de desempenho e logs em nível de erro coletados pelo agente de diagnóstico do Azure ao Application Insights, habilite a opção **Enviar dados de diagnóstico ao Application Insights**.</span><span class="sxs-lookup"><span data-stu-id="33842-128">To configure Azure diagnostics to send all performance counters and error-level logs collected by the Azure diagnostics agent to Application Insights, enable the **Send diagnostics data to Application Insights** option.</span></span> 

    <span data-ttu-id="33842-129">Se você quiser configurar em mais detalhes quais dados são enviados ao Application Insights, edite manualmente o arquivo *diagnostics.wadcfgx* para cada função.</span><span class="sxs-lookup"><span data-stu-id="33842-129">If you want to further configure what data is sent to Application Insights, you must manually edit the *diagnostics.wadcfgx* file for each role.</span></span> <span data-ttu-id="33842-130">Confira [Configurar o Diagnóstico do Azure para enviar dados ao Application Insights](#configure-azure-diagnostics-to-send-data-to-application-insights) para saber mais sobre como atualizar a configuração manualmente.</span><span class="sxs-lookup"><span data-stu-id="33842-130">See [Configure Azure Diagnostics to send data to Application Insights](#configure-azure-diagnostics-to-send-data-to-application-insights) to learn more about manually updating the configuration.</span></span>

<span data-ttu-id="33842-131">Quando o serviço de nuvem estiver configurado para enviar dados de diagnóstico do Azure ao Application Insights, você poderá implantá-lo no Azure como faria normalmente, verificando se a extensão de diagnóstico do Azure está habilitada.</span><span class="sxs-lookup"><span data-stu-id="33842-131">When the cloud service is configured to send Azure diagnostics data to application insights, you can deploy it to Azure normally, making sure the Azure diagnostics extension is enabled.</span></span> <span data-ttu-id="33842-132">Para saber mais, confira [Como publicar um serviço de nuvem usando o Visual Studio](../vs-azure-tools-publishing-a-cloud-service.md).</span><span class="sxs-lookup"><span data-stu-id="33842-132">For more information, see  [Publishing a Cloud Service using Visual Studio](../vs-azure-tools-publishing-a-cloud-service.md).</span></span>  

## <a name="viewing-azure-diagnostics-data-in-application-insights"></a><span data-ttu-id="33842-133">Exibindo dados do Diagnóstico do Azure no Application Insights</span><span class="sxs-lookup"><span data-stu-id="33842-133">Viewing Azure diagnostics data in Application Insights</span></span>
<span data-ttu-id="33842-134">A telemetria de diagnóstico do Azure aparecerá no recurso do Application Insights configurado para seu serviço de nuvem.</span><span class="sxs-lookup"><span data-stu-id="33842-134">The Azure diagnostic telemetry shows up in the Application Insights resource configured for your cloud service.</span></span>

<span data-ttu-id="33842-135">Os tipos de log de diagnóstico do Azure mapeiam para conceitos do Application Insights destas maneiras:</span><span class="sxs-lookup"><span data-stu-id="33842-135">Azure diagnostics log types map to Application Insights concepts in these ways:</span></span>

* <span data-ttu-id="33842-136">Contadores de desempenho são exibidos como Métricas Personalizadas no Application Insights.</span><span class="sxs-lookup"><span data-stu-id="33842-136">Performance counters are displayed as Custom Metrics in Application Insights.</span></span>
* <span data-ttu-id="33842-137">Logs de Eventos do Windows são mostrados como Rastreamentos e Eventos Personalizados no Application Insights.</span><span class="sxs-lookup"><span data-stu-id="33842-137">Windows Event Logs are shown as Traces and Custom Events in Application Insights.</span></span>
* <span data-ttu-id="33842-138">Logs de Aplicativo, logs de ETW e logs de Infraestrutura de Diagnóstico são mostrados como Rastreamentos no Application Insights.</span><span class="sxs-lookup"><span data-stu-id="33842-138">Application logs, ETW logs, and any Diagnostics Infrastructure logs are shown as Traces in Application Insights.</span></span>

<span data-ttu-id="33842-139">Para exibir dados de diagnóstico do Azure no Application Insights, siga um destes procedimentos:</span><span class="sxs-lookup"><span data-stu-id="33842-139">To view Azure diagnostics data in Application Insights, do one of the following:</span></span>

* <span data-ttu-id="33842-140">Use o [Metrics Explorer](../application-insights/app-insights-metrics-explorer.md) para visualizar quaisquer contadores de desempenho personalizados ou contagens de diferentes tipos de eventos do Log de Eventos do Windows.</span><span class="sxs-lookup"><span data-stu-id="33842-140">Use [Metrics explorer](../application-insights/app-insights-metrics-explorer.md) to visualize any custom performance counters or counts of different types of Windows Event Log events.</span></span>

    ![Métricas personalizadas no Metrics Explorer][5]

* <span data-ttu-id="33842-142">Use [Pesquisar](../application-insights/app-insights-diagnostic-search.md) para pesquisar entre os logs de rastreamento enviados pelo Diagnóstico do Azure.</span><span class="sxs-lookup"><span data-stu-id="33842-142">Use [Search](../application-insights/app-insights-diagnostic-search.md) to search across the  trace logs sent by Azure Diagnostics.</span></span> <span data-ttu-id="33842-143">Por exemplo, se uma exceção sem tratamento tiver feito uma função falhar e reciclar, informações sobre a exceção aparecerão no canal *Aplicativo* do *Log de Eventos do Windows*.</span><span class="sxs-lookup"><span data-stu-id="33842-143">For example, if an unhandled exception has caused the role to crash and recycle, information about the exception shows up in the *Application* channel of *Windows Event Log*.</span></span> <span data-ttu-id="33842-144">Você pode usar a pesquisa para ver o erro do Log de Eventos do Windows e obter o rastreamento de pilha completo para a exceção para ajudar a encontrar a causa do problema.</span><span class="sxs-lookup"><span data-stu-id="33842-144">You can use search to look at the Windows Event Log error and get the full stack trace for the exception to help find the cause of the issue.</span></span>

    ![Pesquisar rastreamentos][6]

## <a name="next-steps"></a><span data-ttu-id="33842-146">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="33842-146">Next Steps</span></span>
* <span data-ttu-id="33842-147">[Adicionar o SDK do Application Insights ao seu serviço de nuvem](../application-insights/app-insights-cloudservices.md) para enviar dados sobre solicitações, exceções, dependências e telemetria personalizada do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="33842-147">[Add the Application Insights SDK to your cloud service](../application-insights/app-insights-cloudservices.md) to send data about requests, exceptions, dependencies, and any custom telemetry from your application.</span></span> <span data-ttu-id="33842-148">Quando essas informações são combinadas aos dados do Diagnóstico do Azure, você pode obter uma exibição completa do seu aplicativo e do sistema no mesmo recurso do Application Insights.</span><span class="sxs-lookup"><span data-stu-id="33842-148">When combined with the Azure Diagnostics data, this information you can get a complete view of your application and system, all in the same Application Insight resource.</span></span>  

<!--Image references-->
[1]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/solution-explorer-properties.png
[2]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/role-designer-sendtoappinsights.png
[3]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/select-appinsights-resource.png
[4]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/role-designer-appinsights-serviceconfig.png
[5]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/metrics-explorer-custom-metrics.png
[6]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/search-windowseventlog-error.png
