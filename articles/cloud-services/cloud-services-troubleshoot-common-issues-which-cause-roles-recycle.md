---
title: "Causas comuns da reciclagem de funções do Serviço de Nuvem | Microsoft Docs"
description: "Uma função de serviço de nuvem que é reciclada repentinamente pode causar um tempo de inatividade significativo. Veja alguns problemas comuns que causam a reciclagem de funções, que podem ajudar a reduzir o tempo de inatividade."
services: cloud-services
documentationcenter: 
author: simonxjx
manager: felixwu
editor: 
tags: top-support-issue
ms.assetid: 533930d1-8035-4402-b16a-cf887b2c4f85
ms.service: cloud-services
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: tbd
ms.date: 7/26/2017
ms.author: v-six
ms.openlocfilehash: e55009c72b977ee4a30f6c71043bde483849f78f
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/29/2017
---
# <a name="common-issues-that-cause-roles-to-recycle"></a><span data-ttu-id="c4b0d-104">Problemas comuns que causam a reciclagem de funções</span><span class="sxs-lookup"><span data-stu-id="c4b0d-104">Common issues that cause roles to recycle</span></span>
<span data-ttu-id="c4b0d-105">Este artigo discute algumas das causas comuns dos problemas de implantação e fornece dicas de solução de problemas para ajudá-lo a resolvê-los.</span><span class="sxs-lookup"><span data-stu-id="c4b0d-105">This article discusses some of the common causes of deployment problems and provides troubleshooting tips to help you resolve these problems.</span></span> <span data-ttu-id="c4b0d-106">Uma indicação de que existe um problema com um aplicativo é quando há uma falha na inicialização da instância de função ou se ela alterna entre os estados inicializando, ocupado e parando.</span><span class="sxs-lookup"><span data-stu-id="c4b0d-106">An indication that a problem exists with an application is when the role instance fails to start, or it cycles between the initializing, busy, and stopping states.</span></span>

[!INCLUDE [support-disclaimer](../../includes/support-disclaimer.md)]

## <a name="missing-runtime-dependencies"></a><span data-ttu-id="c4b0d-107">Dependências de tempo de execução ausentes</span><span class="sxs-lookup"><span data-stu-id="c4b0d-107">Missing runtime dependencies</span></span>
<span data-ttu-id="c4b0d-108">Se uma função em seu aplicativo depender de um assembly que não faça parte do .NET Framework ou da biblioteca gerenciada pelo Azure, você deverá incluir explicitamente esse assembly no pacote de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="c4b0d-108">If a role in your application relies on any assembly that is not part of the .NET Framework or the Azure managed library, you must explicitly include that assembly in the application package.</span></span> <span data-ttu-id="c4b0d-109">Tenha em mente que outras estruturas da Microsoft não estão disponíveis no Azure por padrão.</span><span class="sxs-lookup"><span data-stu-id="c4b0d-109">Keep in mind that other Microsoft frameworks are not available on Azure by default.</span></span> <span data-ttu-id="c4b0d-110">Se a sua função depender de uma estrutura desse tipo, você deverá adicionar esses assemblies ao pacote de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="c4b0d-110">If your role relies on such a framework, you must add those assemblies to the application package.</span></span>

<span data-ttu-id="c4b0d-111">Antes de compilar e empacotar seu aplicativo, verifique o seguinte:</span><span class="sxs-lookup"><span data-stu-id="c4b0d-111">Before you build and package your application, verify the following:</span></span>

* <span data-ttu-id="c4b0d-112">Se estiver usando o Visual Studio, verifique se a propriedade de **Copy Local** está definida como **True** para cada assembly referenciado em seu projeto que não faça parte do SDK do Azure ou do .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="c4b0d-112">If using Visual studio, make sure the **Copy Local** property is set to **True** for each referenced assembly in your project that is not part of the Azure SDK or the .NET Framework.</span></span>
* <span data-ttu-id="c4b0d-113">Verifique se o arquivo web.config não faz referência a nenhum assembly não usado no elemento compilation.</span><span class="sxs-lookup"><span data-stu-id="c4b0d-113">Make sure the web.config file does not reference any unused assemblies in the compilation element.</span></span>
* <span data-ttu-id="c4b0d-114">A **Ação de Compilação** de cada arquivo .cshtml é definida como **Conteúdo**.</span><span class="sxs-lookup"><span data-stu-id="c4b0d-114">The **Build Action** of every .cshtml file is set to **Content**.</span></span> <span data-ttu-id="c4b0d-115">Isso garante que os arquivos sejam exibidos corretamente no pacote e habilita outros arquivos referenciados a aparecerem nele.</span><span class="sxs-lookup"><span data-stu-id="c4b0d-115">This ensures that the files will appear correctly in the package and enables other referenced files to appear in the package.</span></span>

## <a name="assembly-targets-wrong-platform"></a><span data-ttu-id="c4b0d-116">Plataforma incorreta de destinos de assembly</span><span class="sxs-lookup"><span data-stu-id="c4b0d-116">Assembly targets wrong platform</span></span>
<span data-ttu-id="c4b0d-117">O Azure é um ambiente de 64 bits.</span><span class="sxs-lookup"><span data-stu-id="c4b0d-117">Azure is a 64-bit environment.</span></span> <span data-ttu-id="c4b0d-118">Portanto, os assemblies do .NET compilados para um destino de 32 bits não funcionarão no Azure.</span><span class="sxs-lookup"><span data-stu-id="c4b0d-118">Therefore, .NET assemblies compiled for a 32-bit target won't work on Azure.</span></span>

## <a name="role-throws-unhandled-exceptions-while-initializing-or-stopping"></a><span data-ttu-id="c4b0d-119">A função gera exceções sem tratamento durante a inicialização ou interrupção</span><span class="sxs-lookup"><span data-stu-id="c4b0d-119">Role throws unhandled exceptions while initializing or stopping</span></span>
<span data-ttu-id="c4b0d-120">Todas as exceções geradas pelos métodos da classe [RoleEntryPoint], que inclui os métodos [OnStart], [OnStop] e [Execute], são exceções sem tratamento.</span><span class="sxs-lookup"><span data-stu-id="c4b0d-120">Any exceptions that are thrown by the methods of the [RoleEntryPoint] class, which includes the [OnStart], [OnStop], and [Run] methods, are unhandled exceptions.</span></span> <span data-ttu-id="c4b0d-121">Se ocorrer uma exceção sem tratamento em um desses métodos, a função será reciclada.</span><span class="sxs-lookup"><span data-stu-id="c4b0d-121">If an unhandled exception occurs in one of these methods, the role will recycle.</span></span> <span data-ttu-id="c4b0d-122">Se a função estiver sendo reciclada repetidamente, ela poderá gerar uma exceção sem tratamento a cada tentativa de inicialização.</span><span class="sxs-lookup"><span data-stu-id="c4b0d-122">If the role is recycling repeatedly, it may be throwing an unhandled exception each time it tries to start.</span></span>

## <a name="role-returns-from-run-method"></a><span data-ttu-id="c4b0d-123">A função é retornada do método Run</span><span class="sxs-lookup"><span data-stu-id="c4b0d-123">Role returns from Run method</span></span>
<span data-ttu-id="c4b0d-124">O método [Execute] se destina a ser executado por tempo indeterminado.</span><span class="sxs-lookup"><span data-stu-id="c4b0d-124">The [Run] method is intended to run indefinitely.</span></span> <span data-ttu-id="c4b0d-125">Se o seu código substituir o método [Execute] , ele deverá ser suspenso por tempo indeterminado.</span><span class="sxs-lookup"><span data-stu-id="c4b0d-125">If your code overrides the [Run] method, it should sleep indefinitely.</span></span> <span data-ttu-id="c4b0d-126">Se o método [Execute] for retornado, a função será reciclada.</span><span class="sxs-lookup"><span data-stu-id="c4b0d-126">If the [Run] method returns, the role recycles.</span></span>

## <a name="incorrect-diagnosticsconnectionstring-setting"></a><span data-ttu-id="c4b0d-127">Configuração incorreta de DiagnosticsConnectionString</span><span class="sxs-lookup"><span data-stu-id="c4b0d-127">Incorrect DiagnosticsConnectionString setting</span></span>
<span data-ttu-id="c4b0d-128">Se o aplicativo usar o Diagnóstico do Azure, o arquivo de configuração de serviço deverá especificar a definição de configuração `DiagnosticsConnectionString` .</span><span class="sxs-lookup"><span data-stu-id="c4b0d-128">If application uses Azure Diagnostics, your service configuration file must specify the `DiagnosticsConnectionString` configuration setting.</span></span> <span data-ttu-id="c4b0d-129">Essa configuração deve especificar uma conexão HTTPS à sua conta de armazenamento no Azure.</span><span class="sxs-lookup"><span data-stu-id="c4b0d-129">This setting should specify an HTTPS connection to your storage account in Azure.</span></span>

<span data-ttu-id="c4b0d-130">Para garantir que a configuração `DiagnosticsConnectionString` esteja correta antes de implantar seu pacote de aplicativos no Azure, verifique o seguinte:</span><span class="sxs-lookup"><span data-stu-id="c4b0d-130">To ensure that your `DiagnosticsConnectionString` setting is correct before you deploy your application package to Azure, verify the following:</span></span>  

* <span data-ttu-id="c4b0d-131">A configuração `DiagnosticsConnectionString` aponta para uma conta de armazenamento válida no Azure.</span><span class="sxs-lookup"><span data-stu-id="c4b0d-131">The `DiagnosticsConnectionString` setting points to a valid storage account in Azure.</span></span>  
  <span data-ttu-id="c4b0d-132">Por padrão, essa configuração aponta para a conta de armazenamento emulada, portanto você deve alterar explicitamente essa configuração antes de implantar o pacote de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="c4b0d-132">By default, this setting points to the emulated storage account, so you must explicitly change this setting before you deploy your application package.</span></span> <span data-ttu-id="c4b0d-133">Se você não alterar essa configuração, uma exceção será gerada quando a instância de função tentar iniciar o monitor de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="c4b0d-133">If you do not change this setting, an exception is thrown when the role instance attempts to start the diagnostic monitor.</span></span> <span data-ttu-id="c4b0d-134">Isso poderá fazer com que a instância de função seja reciclada por tempo indeterminado.</span><span class="sxs-lookup"><span data-stu-id="c4b0d-134">This may cause the role instance to recycle indefinitely.</span></span>
* <span data-ttu-id="c4b0d-135">A cadeia de conexão é especificada no [formato](../storage/common/storage-configure-connection-string.md)a seguir.</span><span class="sxs-lookup"><span data-stu-id="c4b0d-135">The connection string is specified in the following [format](../storage/common/storage-configure-connection-string.md).</span></span> <span data-ttu-id="c4b0d-136">(O protocolo deve ser especificado como HTTPS). Substitua *MyAccountName* pelo nome da sua conta de armazenamento e *MyAccountKey* pela sua chave de acesso:</span><span class="sxs-lookup"><span data-stu-id="c4b0d-136">(The protocol must be specified as HTTPS.) Replace *MyAccountName* with the name of your storage account, and *MyAccountKey* with your access key:</span></span>    

        DefaultEndpointsProtocol=https;AccountName=MyAccountName;AccountKey=MyAccountKey

  <span data-ttu-id="c4b0d-137">Se estiver desenvolvendo seu aplicativo com as Ferramentas do Azure para o Microsoft Visual Studio, você poderá usar as páginas de propriedade para definir esse valor.</span><span class="sxs-lookup"><span data-stu-id="c4b0d-137">If you are developing your application by using Azure Tools for Microsoft Visual Studio, you can use the property pages to set this value.</span></span>

## <a name="exported-certificate-does-not-include-private-key"></a><span data-ttu-id="c4b0d-138">O certificado exportado não inclui a chave privada</span><span class="sxs-lookup"><span data-stu-id="c4b0d-138">Exported certificate does not include private key</span></span>
<span data-ttu-id="c4b0d-139">Para executar uma função web por meio do SSL, você deve garantir que seu certificado de gerenciamento exportado inclui a chave privada.</span><span class="sxs-lookup"><span data-stu-id="c4b0d-139">To run a web role under SSL, you must ensure that your exported management certificate includes the private key.</span></span> <span data-ttu-id="c4b0d-140">Se você usar o *Gerenciador de Certificados do Windows* para exportar o certificado, selecione **Sim** para a opção **Exportar a chave privada**.</span><span class="sxs-lookup"><span data-stu-id="c4b0d-140">If you use the *Windows Certificate Manager* to export the certificate, be sure to select **Yes** for the **Export the private key** option.</span></span> <span data-ttu-id="c4b0d-141">O certificado deve ser exportado no formato PFX, que é o único formato atualmente com suporte.</span><span class="sxs-lookup"><span data-stu-id="c4b0d-141">The certificate must be exported in the PFX format, which is the only format currently supported.</span></span>

## <a name="next-steps"></a><span data-ttu-id="c4b0d-142">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="c4b0d-142">Next steps</span></span>
<span data-ttu-id="c4b0d-143">Confira mais [artigos sobre solução de problemas](https://azure.microsoft.com/documentation/articles/?tag=top-support-issue&product=cloud-services) para serviços de nuvem.</span><span class="sxs-lookup"><span data-stu-id="c4b0d-143">View more [troubleshooting articles](https://azure.microsoft.com/documentation/articles/?tag=top-support-issue&product=cloud-services) for cloud services.</span></span>

<span data-ttu-id="c4b0d-144">Veja mais cenários de reciclagem da função na [Série de blogs de Kevin Williamson](http://blogs.msdn.com/b/kwill/archive/2013/08/09/windows-azure-paas-compute-diagnostics-data.aspx).</span><span class="sxs-lookup"><span data-stu-id="c4b0d-144">View more role recycling scenarios at [Kevin Williamson's blog series](http://blogs.msdn.com/b/kwill/archive/2013/08/09/windows-azure-paas-compute-diagnostics-data.aspx).</span></span>

[RoleEntryPoint]: https://msdn.microsoft.com/library/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx
[OnStart]: https://msdn.microsoft.com/library/microsoft.windowsazure.serviceruntime.roleentrypoint.onstart.aspx
[OnStop]: https://msdn.microsoft.com/library/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx
[Execute]: https://msdn.microsoft.com/library/microsoft.windowsazure.serviceruntime.roleentrypoint.run.aspx
