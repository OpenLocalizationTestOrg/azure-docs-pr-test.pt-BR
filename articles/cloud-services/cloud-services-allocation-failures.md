---
title: "aaaTroubleshooting falha de alocação de serviço de nuvem | Microsoft Docs"
description: "Solução de problemas de falha de alocação ao implantar Serviços de Nuvem no Azure"
services: azure-service-management, cloud-services
documentationcenter: 
author: simonxjx
manager: felixwu
editor: 
tags: top-support-issue
ms.assetid: 529157eb-e4a1-4388-aa2b-09e8b923af74
ms.service: cloud-services
ms.workload: na
ms.tgt_pltfrm: ibiza
ms.devlang: na
ms.topic: article
ms.date: 7/26/2017
ms.author: v-six
ms.openlocfilehash: dfd5cc4663ccc6ed1b27ca9df579182737363b0e
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="troubleshooting-allocation-failure-when-you-deploy-cloud-services-in-azure"></a><span data-ttu-id="2d74d-103">Solução de problemas de falha de alocação ao implantar Serviços de Nuvem no Azure</span><span class="sxs-lookup"><span data-stu-id="2d74d-103">Troubleshooting allocation failure when you deploy Cloud Services in Azure</span></span>
## <a name="summary"></a><span data-ttu-id="2d74d-104">Resumo</span><span class="sxs-lookup"><span data-stu-id="2d74d-104">Summary</span></span>
<span data-ttu-id="2d74d-105">Quando você implanta instâncias tooa serviço de nuvem ou adiciona novo web ou instâncias de função de trabalho, o Microsoft Azure aloca recursos de computação.</span><span class="sxs-lookup"><span data-stu-id="2d74d-105">When you deploy instances tooa Cloud Service or add new web or worker role instances, Microsoft Azure allocates compute resources.</span></span> <span data-ttu-id="2d74d-106">Ocasionalmente, você poderá receber erros ao executar essas operações, mesmo antes de atingir Olá limites de assinatura do Azure.</span><span class="sxs-lookup"><span data-stu-id="2d74d-106">You may occasionally receive errors when performing these operations even before you reach hello Azure subscription limits.</span></span> <span data-ttu-id="2d74d-107">Este artigo explica as causas de saudação de alguns Olá comuns de falhas de alocação e sugere possíveis correções.</span><span class="sxs-lookup"><span data-stu-id="2d74d-107">This article explains hello causes of some of hello common allocation failures and suggests possible remediation.</span></span> <span data-ttu-id="2d74d-108">informações de saudação também podem ser útil ao planejar a implantação Olá dos seus serviços.</span><span class="sxs-lookup"><span data-stu-id="2d74d-108">hello information may also be useful when you plan hello deployment of your services.</span></span>

[!INCLUDE [support-disclaimer](../../includes/support-disclaimer.md)]

### <a name="background--how-allocation-works"></a><span data-ttu-id="2d74d-109">Histórico – Como funciona a alocação</span><span class="sxs-lookup"><span data-stu-id="2d74d-109">Background – How allocation works</span></span>
<span data-ttu-id="2d74d-110">servidores de saudação em datacenters do Azure são particionadas em clusters.</span><span class="sxs-lookup"><span data-stu-id="2d74d-110">hello servers in Azure datacenters are partitioned into clusters.</span></span> <span data-ttu-id="2d74d-111">Ocorre uma nova tentativa de solicitação de alocação de serviço de nuvem em vários clusters.</span><span class="sxs-lookup"><span data-stu-id="2d74d-111">A new cloud service allocation request is attempted in multiple clusters.</span></span> <span data-ttu-id="2d74d-112">Quando a primeira instância de saudação é serviço de nuvem implantado tooa (na preparação ou produção), que o serviço de nuvem é fixado tooa cluster.</span><span class="sxs-lookup"><span data-stu-id="2d74d-112">When hello first instance is deployed tooa cloud service(in either staging or production), that cloud service gets pinned tooa cluster.</span></span> <span data-ttu-id="2d74d-113">Mais detalhes as implantações de serviço de nuvem Olá acontecerá em Olá mesmo cluster.</span><span class="sxs-lookup"><span data-stu-id="2d74d-113">Any further deployments for hello cloud service will happen in hello same cluster.</span></span> <span data-ttu-id="2d74d-114">Neste artigo, vamos nos referir toothis como "fixado tooa cluster".</span><span class="sxs-lookup"><span data-stu-id="2d74d-114">In this article, we'll refer toothis as "pinned tooa cluster".</span></span> <span data-ttu-id="2d74d-115">O diagrama 1 abaixo ilustra o caso de saudação de uma alocação normal que é tentada em vários clusters; Diagrama 2 mostra o caso de saudação de uma alocação tooCluster fixo que 2 porque o que é onde Olá CS_1 de serviço de nuvem existente está hospedado.</span><span class="sxs-lookup"><span data-stu-id="2d74d-115">Diagram 1 below illustrates hello case of a normal allocation which is attempted in multiple clusters; Diagram 2 illustrates hello case of an allocation that's pinned tooCluster 2 because that's where hello existing Cloud Service CS_1 is hosted.</span></span>

![Diagrama de alocação](./media/cloud-services-allocation-failure/Allocation1.png)

### <a name="why-allocation-failure-happens"></a><span data-ttu-id="2d74d-117">Motivos das falhas de alocação</span><span class="sxs-lookup"><span data-stu-id="2d74d-117">Why allocation failure happens</span></span>
<span data-ttu-id="2d74d-118">Quando uma solicitação de alocação é fixado tooa cluster, há uma possibilidade maior de falha toofind liberar recursos desde que o pool de recursos disponíveis de saudação é limitado tooa cluster.</span><span class="sxs-lookup"><span data-stu-id="2d74d-118">When an allocation request is pinned tooa cluster, there's a higher chance of failing toofind free resources since hello available resource pool is limited tooa cluster.</span></span> <span data-ttu-id="2d74d-119">Além disso, se sua solicitação de alocação está fixado tooa cluster, mas tipo de saudação do recurso solicitado não é suportado por cluster, a solicitação falhará mesmo que o cluster Olá tem recurso gratuito.</span><span class="sxs-lookup"><span data-stu-id="2d74d-119">Furthermore, if your allocation request is pinned tooa cluster but hello type of resource you requested is not supported by that cluster, your request will fail even if hello cluster has free resource.</span></span> <span data-ttu-id="2d74d-120">Diagrama de 3 abaixo ilustra o caso de Olá onde uma alocação fixada falha porque cluster do candidato apenas Olá não tem recursos gratuitos.</span><span class="sxs-lookup"><span data-stu-id="2d74d-120">Diagram 3 below illustrates hello case where a pinned allocation fails because hello only candidate cluster does not have free resources.</span></span> <span data-ttu-id="2d74d-121">Diagrama 4 ilustra caso Olá onde uma alocação fixada falha porque não dá suporte a cluster de candidato apenas Olá Olá solicitado tamanho da VM, mesmo que o cluster Olá tem liberar recursos.</span><span class="sxs-lookup"><span data-stu-id="2d74d-121">Diagram 4 illustrates hello case where a pinned allocation fails because hello only candidate cluster does not support hello requested VM size, even though hello cluster has free resources.</span></span>

![Falha na alocação fixada](./media/cloud-services-allocation-failure/Allocation2.png)

## <a name="troubleshooting-allocation-failure-for-cloud-services"></a><span data-ttu-id="2d74d-123">Solucionando problemas de falha de alocação para serviços de nuvem</span><span class="sxs-lookup"><span data-stu-id="2d74d-123">Troubleshooting allocation failure for cloud services</span></span>
### <a name="error-message"></a><span data-ttu-id="2d74d-124">Mensagem de erro</span><span class="sxs-lookup"><span data-stu-id="2d74d-124">Error Message</span></span>
<span data-ttu-id="2d74d-125">Você pode ver Olá a seguinte mensagem de erro:</span><span class="sxs-lookup"><span data-stu-id="2d74d-125">You may see hello following error message:</span></span>

    "Azure operation '{operation id}' failed with code Compute.ConstrainedAllocationFailed. Details: Allocation failed; unable toosatisfy constraints in request. hello requested new service deployment is bound tooan Affinity Group, or it targets a Virtual Network, or there is an existing deployment under this hosted service. Any of these conditions constrains hello new deployment toospecific Azure resources. Please retry later or try reducing hello VM size or number of role instances. Alternatively, if possible, remove hello aforementioned constraints or try deploying tooa different region."

### <a name="common-issues"></a><span data-ttu-id="2d74d-126">Problemas comuns</span><span class="sxs-lookup"><span data-stu-id="2d74d-126">Common Issues</span></span>
<span data-ttu-id="2d74d-127">Aqui estão Olá cenários comuns de alocação que causam um alocação solicitação toobe tooa fixados único cluster.</span><span class="sxs-lookup"><span data-stu-id="2d74d-127">Here are hello common allocation scenarios that cause an allocation request toobe pinned tooa single cluster.</span></span>

* <span data-ttu-id="2d74d-128">Em seguida, implantar tooStaging Slot - se um serviço de nuvem tem uma implantação em nenhum slot, serviço de nuvem inteira Olá é cluster específico tooa fixados.</span><span class="sxs-lookup"><span data-stu-id="2d74d-128">Deploying tooStaging Slot - If a cloud service has a deployment in either slot, then hello entire cloud service is pinned tooa specific cluster.</span></span>  <span data-ttu-id="2d74d-129">Isso significa que se uma implantação já existe no slot de produção de hello, em seguida, uma nova implantação de preparo só pode ser alocada no mesmo cluster como o slot de produção de hello de saudação.</span><span class="sxs-lookup"><span data-stu-id="2d74d-129">This means that if a deployment already exists in hello production slot, then a new staging deployment can only be allocated in hello same cluster as hello production slot.</span></span> <span data-ttu-id="2d74d-130">Se o cluster hello está se aproximando da capacidade, a solicitação de saudação pode falhar.</span><span class="sxs-lookup"><span data-stu-id="2d74d-130">If hello cluster is nearing capacity, hello request may fail.</span></span>
* <span data-ttu-id="2d74d-131">Dimensionamento - adicionando novas instâncias tooan serviço de nuvem existente deve alocar no hello mesmo cluster.</span><span class="sxs-lookup"><span data-stu-id="2d74d-131">Scaling - Adding new instances tooan existing cloud service must allocate in hello same cluster.</span></span>  <span data-ttu-id="2d74d-132">Solicitações pequenas de dimensionamento normalmente podem ser alocadas, mas nem sempre.</span><span class="sxs-lookup"><span data-stu-id="2d74d-132">Small scaling requests can usually be allocated, but not always.</span></span> <span data-ttu-id="2d74d-133">Se o cluster hello está se aproximando da capacidade, a solicitação de saudação pode falhar.</span><span class="sxs-lookup"><span data-stu-id="2d74d-133">If hello cluster is nearing capacity, hello request may fail.</span></span>
* <span data-ttu-id="2d74d-134">Grupo de afinidade - um novo serviço de nuvem vazio do tooan de implantação pode ser alocado pela malha hello em qualquer cluster nessa região, a menos que o serviço de nuvem Olá é fixado tooan grupo de afinidade.</span><span class="sxs-lookup"><span data-stu-id="2d74d-134">Affinity Group - A new deployment tooan empty cloud service can be allocated by hello fabric in any cluster in that region, unless hello cloud service is pinned tooan affinity group.</span></span> <span data-ttu-id="2d74d-135">Implantações toohello mesmo grupo de afinidade será tentado no hello mesmo cluster.</span><span class="sxs-lookup"><span data-stu-id="2d74d-135">Deployments toohello same affinity group will be attempted on hello same cluster.</span></span> <span data-ttu-id="2d74d-136">Se o cluster hello está se aproximando da capacidade, a solicitação de saudação pode falhar.</span><span class="sxs-lookup"><span data-stu-id="2d74d-136">If hello cluster is nearing capacity, hello request may fail.</span></span>
* <span data-ttu-id="2d74d-137">Rede virtual do grupo de afinidade - redes virtuais mais antigas foram tooaffinity empatados grupos em vez de regiões, e serviços de nuvem nessas redes virtuais seria cluster do grupo de afinidade toohello fixados.</span><span class="sxs-lookup"><span data-stu-id="2d74d-137">Affinity Group vNet - Older Virtual Networks were tied tooaffinity groups instead of regions, and cloud services in these Virtual Networks would be pinned toohello affinity group cluster.</span></span> <span data-ttu-id="2d74d-138">Tipo de toothis de implantações de rede virtual será tentado no cluster Olá fixado.</span><span class="sxs-lookup"><span data-stu-id="2d74d-138">Deployments toothis type of virtual network will be attempted on hello pinned cluster.</span></span> <span data-ttu-id="2d74d-139">Se o cluster hello está se aproximando da capacidade, a solicitação de saudação pode falhar.</span><span class="sxs-lookup"><span data-stu-id="2d74d-139">If hello cluster is nearing capacity, hello request may fail.</span></span>

## <a name="solutions"></a><span data-ttu-id="2d74d-140">Soluções</span><span class="sxs-lookup"><span data-stu-id="2d74d-140">Solutions</span></span>
1. <span data-ttu-id="2d74d-141">Reimplantação tooa novo serviço de nuvem - esta solução é provavelmente toobe mais bem-sucedida pois permite Olá plataforma toochoose de todos os clusters nessa região.</span><span class="sxs-lookup"><span data-stu-id="2d74d-141">Redeploy tooa new cloud service - This solution is likely toobe most successful as it allows hello platform toochoose from all clusters in that region.</span></span>

   * <span data-ttu-id="2d74d-142">Implantar Olá carga de trabalho tooa novo serviço de nuvem</span><span class="sxs-lookup"><span data-stu-id="2d74d-142">Deploy hello workload tooa new cloud service</span></span>  
   * <span data-ttu-id="2d74d-143">Atualizar Olá CNAME ou um registro toopoint tráfego toohello novo serviço de nuvem</span><span class="sxs-lookup"><span data-stu-id="2d74d-143">Update hello CNAME or A record toopoint traffic toohello new cloud service</span></span>
   * <span data-ttu-id="2d74d-144">Depois que o tráfego de zero será site antigo toohello, você pode excluir serviço de nuvem antigo hello.</span><span class="sxs-lookup"><span data-stu-id="2d74d-144">Once zero traffic is going toohello old site, you can delete hello old cloud service.</span></span> <span data-ttu-id="2d74d-145">Essa solução não causará qualquer tempo de inatividade.</span><span class="sxs-lookup"><span data-stu-id="2d74d-145">This solution should incur zero downtime.</span></span>
2. <span data-ttu-id="2d74d-146">Excluir os slots de preparo e produção - essa solução irá preservar seu nome DNS existente, mas fará com que o aplicativo de tooyour de tempo de inatividade.</span><span class="sxs-lookup"><span data-stu-id="2d74d-146">Delete both production and staging slots - This solution will preserve your existing DNS name, but will cause downtime tooyour application.</span></span>

   * <span data-ttu-id="2d74d-147">Excluir a produção de hello e de preparo slots de um serviço de nuvem existente para que o serviço de nuvem hello está vazio e, em seguida,</span><span class="sxs-lookup"><span data-stu-id="2d74d-147">Delete hello production and staging slots of an existing cloud service so that hello cloud service is empty, and then</span></span>
   * <span data-ttu-id="2d74d-148">Crie uma nova implantação no serviço de nuvem existente hello.</span><span class="sxs-lookup"><span data-stu-id="2d74d-148">Create a new deployment in hello existing cloud service.</span></span> <span data-ttu-id="2d74d-149">Isso tentará novamente tooallocation em todos os clusters na região de saudação.</span><span class="sxs-lookup"><span data-stu-id="2d74d-149">This will re-attempt tooallocation on all clusters in hello region.</span></span> <span data-ttu-id="2d74d-150">Certifique-se de que o serviço de nuvem Olá não é grupo de afinidade tooan associado.</span><span class="sxs-lookup"><span data-stu-id="2d74d-150">Ensure hello cloud service is not tied tooan affinity group.</span></span>
3. <span data-ttu-id="2d74d-151">IP reservado - esta solução irá preservar o IP existentes de endereço, mas fará com que o aplicativo de tooyour de tempo de inatividade.</span><span class="sxs-lookup"><span data-stu-id="2d74d-151">Reserved IP -  This solution will preserve your existing IP address, but will cause downtime tooyour application.</span></span>  

   * <span data-ttu-id="2d74d-152">Criar um IP reservado para sua implantação existente usando o Powershell</span><span class="sxs-lookup"><span data-stu-id="2d74d-152">Create a ReservedIP for your existing deployment using Powershell</span></span>

     ```
     New-AzureReservedIP -ReservedIPName {new reserved IP name} -Location {location} -ServiceName {existing service name}
     ```
   * <span data-ttu-id="2d74d-153">Siga #2 acima, tornando toospecify se Olá ReservedIP novo no CSCFG do serviço de saudação.</span><span class="sxs-lookup"><span data-stu-id="2d74d-153">Follow #2 from above, making sure toospecify hello new ReservedIP in hello service's CSCFG.</span></span>
4. <span data-ttu-id="2d74d-154">Remover o grupo de afinidade para novas implantações: grupos de afinidade não são mais recomendados.</span><span class="sxs-lookup"><span data-stu-id="2d74d-154">Remove affinity group for new deployments - Affinity Groups are no longer recommended.</span></span> <span data-ttu-id="2d74d-155">Siga as etapas para #1 acima toodeploy um novo serviço de nuvem.</span><span class="sxs-lookup"><span data-stu-id="2d74d-155">Follow steps for #1 above toodeploy a new cloud service.</span></span> <span data-ttu-id="2d74d-156">Certifique-se de que o serviço de nuvem não esteja em um grupo de afinidade.</span><span class="sxs-lookup"><span data-stu-id="2d74d-156">Ensure cloud service is not in an affinity group.</span></span>
5. <span data-ttu-id="2d74d-157">Converter tooa rede Virtual Regional - consulte [como toomigrate de tooa de grupos de afinidade de rede Virtual Regional (VNet)](../virtual-network/virtual-networks-migrate-to-regional-vnet.md).</span><span class="sxs-lookup"><span data-stu-id="2d74d-157">Convert tooa Regional Virtual Network - See [How toomigrate from Affinity Groups tooa Regional Virtual Network (VNet)](../virtual-network/virtual-networks-migrate-to-regional-vnet.md).</span></span>
