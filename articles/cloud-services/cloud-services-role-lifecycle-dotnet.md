---
title: "eventos de ciclo de vida do serviço de nuvem aaaHandle | Microsoft Docs"
description: "Saiba como métodos de ciclo de vida de saudação de uma função de serviço de nuvem podem ser usados no .NET"
services: cloud-services
documentationcenter: .net
author: Thraka
manager: timlt
editor: 
ms.assetid: 39b30acd-57b9-48b7-a7c4-40ea3430e451
ms.service: cloud-services
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/18/2017
ms.author: adegeo
ms.openlocfilehash: cc0ccc5f055b965202b6e081a6ab72ad5d39b034
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/06/2017
---
# <a name="customize-hello-lifecycle-of-a-web-or-worker-role-in-net"></a><span data-ttu-id="5c0bd-103">Personalizar a saudação do ciclo de vida de uma função Web ou de trabalho no .NET</span><span class="sxs-lookup"><span data-stu-id="5c0bd-103">Customize hello Lifecycle of a Web or Worker role in .NET</span></span>
<span data-ttu-id="5c0bd-104">Quando você cria uma função de trabalho, você estende Olá [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) classe que fornece métodos para você toooverride que permitem a você responder a eventos de toolifecycle.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-104">When you create a worker role, you extend hello [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) class which provides methods for you toooverride that let you respond toolifecycle events.</span></span> <span data-ttu-id="5c0bd-105">Para funções web essa classe é opcional, portanto, você deve usar toorespond toolifecycle eventos.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-105">For web roles this class is optional, so you must use it toorespond toolifecycle events.</span></span>

## <a name="extend-hello-roleentrypoint-class"></a><span data-ttu-id="5c0bd-106">Estender a classe RoleEntryPoint de saudação</span><span class="sxs-lookup"><span data-stu-id="5c0bd-106">Extend hello RoleEntryPoint class</span></span>
<span data-ttu-id="5c0bd-107">Olá [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) classe inclui métodos que são chamados pelo Azure quando ele **inicia**, **executa**, ou **interrompe** uma função web ou de trabalho.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-107">hello [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) class includes methods that are called by Azure when it **starts**, **runs**, or **stops** a web or worker role.</span></span> <span data-ttu-id="5c0bd-108">Opcionalmente, você pode substituir esses métodos toomanage função inicialização, as sequências de desligamento de função ou thread de execução de saudação da função hello.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-108">You can optionally override these methods toomanage role initialization, role shutdown sequences, or hello execution thread of hello role.</span></span> 

<span data-ttu-id="5c0bd-109">Ao estender **RoleEntryPoint**, você deve estar atento a saudação comportamentos dos métodos Olá a seguir:</span><span class="sxs-lookup"><span data-stu-id="5c0bd-109">When extending **RoleEntryPoint**, you should be aware of hello following behaviors of hello methods:</span></span>

* <span data-ttu-id="5c0bd-110">Olá [OnStart](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstart.aspx) e [OnStop](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) métodos retornam um valor booliano, portanto, é possível tooreturn **false** entre esses métodos.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-110">hello [OnStart](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstart.aspx) and [OnStop](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) methods return a boolean value, so it is possible tooreturn **false** from these methods.</span></span>
  
   <span data-ttu-id="5c0bd-111">Se seu código retorna **false**, o processo de saudação da função será finalizado abruptamente, sem executar nenhuma sequência de desligamento, você pode ter em vigor.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-111">If your code returns **false**, hello role process is abruptly terminated, without running any shutdown sequence you may have in place.</span></span> <span data-ttu-id="5c0bd-112">Em geral, evite retornar **false** de saudação **OnStart** método.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-112">In general, you should avoid returning **false** from hello **OnStart** method.</span></span>
* <span data-ttu-id="5c0bd-113">Qualquer exceção não capturada em uma sobrecarga de um método **RoleEntryPoint** será tratada como uma exceção sem tratamento.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-113">Any uncaught exception within an overload of a **RoleEntryPoint** method is treated as an unhandled exception.</span></span>
  
   <span data-ttu-id="5c0bd-114">Se uma exceção ocorrer dentro de um dos métodos de ciclo de vida de saudação, o Azure aumentará Olá [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) evento, e, em seguida, o processo de saudação é encerrado.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-114">If an exception occurs within one of hello lifecycle methods, Azure will raise hello [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) event, and then hello process is terminated.</span></span> <span data-ttu-id="5c0bd-115">Depois que sua função ficar offline, ela será reiniciada pelo Azure.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-115">After your role has been taken offline, it will be restarted by Azure.</span></span> <span data-ttu-id="5c0bd-116">Quando uma exceção não tratada ocorre, hello [parando](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.stopping.aspx) evento não será gerado e Olá **OnStop** método não for chamado.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-116">When an unhandled exception occurs, hello [Stopping](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.stopping.aspx) event is not raised, and hello **OnStop** method is not called.</span></span>

<span data-ttu-id="5c0bd-117">Se sua função não for iniciado ou estiver Reciclando entre hello inicializando, ocupados e parando estados, seu código poderá estar lançando uma exceção sem tratamento dentro de um dos eventos de ciclo de vida Olá que reinicia cada função de saudação do tempo.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-117">If your role does not start, or is recycling between hello initializing, busy, and stopping states, your code may be throwing an unhandled exception within one of hello lifecycle events each time hello role restarts.</span></span> <span data-ttu-id="5c0bd-118">Nesse caso, use Olá [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) evento toodetermine Olá causa da exceção hello e manipulá-lo adequadamente.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-118">In this case, use hello [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) event toodetermine hello cause of hello exception and handle it appropriately.</span></span> <span data-ttu-id="5c0bd-119">Sua função também pode estar retornando do hello [executar](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.run.aspx) método, o que faz com que o hello função toorestart.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-119">Your role may also be returning from hello [Run](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.run.aspx) method, which causes hello role toorestart.</span></span> <span data-ttu-id="5c0bd-120">Para obter mais informações sobre estados de implantação, consulte [tooRecycle problemas que causa funções comuns](cloud-services-troubleshoot-common-issues-which-cause-roles-recycle.md).</span><span class="sxs-lookup"><span data-stu-id="5c0bd-120">For more information about deployment states, see [Common Issues Which Cause Roles tooRecycle](cloud-services-troubleshoot-common-issues-which-cause-roles-recycle.md).</span></span>

> [!NOTE]
> <span data-ttu-id="5c0bd-121">Se você estiver usando Olá **ferramentas do Azure para Microsoft Visual Studio** toodevelop seu aplicativo, modelos de projeto de função hello estendem automaticamente Olá **RoleEntryPoint** classe para você, no hello *WebRole.cs* e *WorkerRole.cs* arquivos.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-121">If you are using hello **Azure Tools for Microsoft Visual Studio** toodevelop your application, hello role project templates automatically extend hello **RoleEntryPoint** class for you, in hello *WebRole.cs* and *WorkerRole.cs* files.</span></span>
> 
> 

## <a name="onstart-method"></a><span data-ttu-id="5c0bd-122">Método OnStart</span><span class="sxs-lookup"><span data-stu-id="5c0bd-122">OnStart method</span></span>
<span data-ttu-id="5c0bd-123">Olá **OnStart** método é chamado quando sua instância de função é trazida online pelo Azure.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-123">hello **OnStart** method is called when your role instance is brought online by Azure.</span></span> <span data-ttu-id="5c0bd-124">Durante a execução de saudação código OnStart, instância de função hello está marcada como **ocupado** e nenhum tráfego externo será direcionado tooit pelo Balanceador de carga de saudação.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-124">While hello OnStart code is executing, hello role instance is marked as **Busy** and no external traffic will be directed tooit by hello load balancer.</span></span> <span data-ttu-id="5c0bd-125">Você pode substituir o trabalho de inicialização de tooperform esse método, como implementar manipuladores de eventos e iniciar [diagnóstico do Azure](cloud-services-how-to-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="5c0bd-125">You can override this method tooperform initialization work, such as implementing event handlers and starting [Azure Diagnostics](cloud-services-how-to-monitor.md).</span></span>

<span data-ttu-id="5c0bd-126">Se **OnStart** retorna **true**, instância de saudação é inicializada com êxito e o Azure chamará Olá **RoleEntryPoint** método.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-126">If **OnStart** returns **true**, hello instance is successfully initialized and Azure calls hello **RoleEntryPoint.Run** method.</span></span> <span data-ttu-id="5c0bd-127">Se **OnStart** retorna **false**, função hello encerra imediatamente, sem executar quaisquer sequências de desligamento planejado.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-127">If **OnStart** returns **false**, hello role terminates immediately, without executing any planned shutdown sequences.</span></span>

<span data-ttu-id="5c0bd-128">Olá mostra exemplo de código a seguir como Olá toooverride **OnStart** método.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-128">hello following code example shows how toooverride hello **OnStart** method.</span></span> <span data-ttu-id="5c0bd-129">Este método configura e inicia um monitor de diagnóstico quando a instância de função hello inicia e define uma transferência de conta de armazenamento tooa dados de log:</span><span class="sxs-lookup"><span data-stu-id="5c0bd-129">This method configures and starts a diagnostic monitor when hello role instance starts and sets up a transfer of logging data tooa storage account:</span></span>

```csharp
public override bool OnStart()
{
    var config = DiagnosticMonitor.GetDefaultInitialConfiguration();

    config.DiagnosticInfrastructureLogs.ScheduledTransferLogLevelFilter = LogLevel.Error;
    config.DiagnosticInfrastructureLogs.ScheduledTransferPeriod = TimeSpan.FromMinutes(5);

    DiagnosticMonitor.Start("DiagnosticsConnectionString", config);

    return true;
}
```

## <a name="onstop-method"></a><span data-ttu-id="5c0bd-130">Método OnStop</span><span class="sxs-lookup"><span data-stu-id="5c0bd-130">OnStop method</span></span>
<span data-ttu-id="5c0bd-131">Olá **OnStop** método é chamado depois que uma instância de função foi colocada offline pelo Azure e antes de sair do processo de saudação.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-131">hello **OnStop** method is called after a role instance has been taken offline by Azure and before hello process exits.</span></span> <span data-ttu-id="5c0bd-132">Você pode substituir esse código de toocall método necessário para sua toocleanly de instância de função desligar.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-132">You can override this method toocall code required for your role instance toocleanly shut down.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="5c0bd-133">Código em execução no hello **OnStop** método tem um tempo limitado toofinish quando ele é chamado para razões diferentes de um desligamento iniciado pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-133">Code running in hello **OnStop** method has a limited time toofinish when it is called for reasons other than a user-initiated shutdown.</span></span> <span data-ttu-id="5c0bd-134">Depois que essa hora decorre, processo Olá é finalizado e, portanto você deve garantir que o código no hello **OnStop** método pode ser executado rapidamente ou tolerar toocompletion não está em execução.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-134">After this time elapses, hello process is terminated, so you must make sure that code in hello **OnStop** method can run quickly or tolerates not running toocompletion.</span></span> <span data-ttu-id="5c0bd-135">Olá **OnStop** método é chamado após Olá **parando** é gerado.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-135">hello **OnStop** method is called after hello **Stopping** event is raised.</span></span>
> 
> 

## <a name="run-method"></a><span data-ttu-id="5c0bd-136">Método Run</span><span class="sxs-lookup"><span data-stu-id="5c0bd-136">Run method</span></span>
<span data-ttu-id="5c0bd-137">Você pode substituir Olá **executar** método tooimplement um thread de execução longa para sua instância de função.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-137">You can override hello **Run** method tooimplement a long-running thread for your role instance.</span></span>

<span data-ttu-id="5c0bd-138">Substituindo Olá **executar** método não é necessário; a implementação do padrão de saudação inicia um thread que está sempre em suspensão.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-138">Overriding hello **Run** method is not required; hello default implementation starts a thread that sleeps forever.</span></span> <span data-ttu-id="5c0bd-139">Se você substituir Olá **executar** método, seu código deve ser bloqueado indefinidamente.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-139">If you do override hello **Run** method, your code should block indefinitely.</span></span> <span data-ttu-id="5c0bd-140">Se hello **executar** método retorna, Olá função será reciclada automaticamente normalmente; em outras palavras, o Azure gera Olá **parando** Olá eventos e chamadas **OnStop** método para que as sequências de desligamento podem ser executadas antes da função hello é colocada offline.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-140">If hello **Run** method returns, hello role is automatically gracefully recycled; in other words, Azure raises hello **Stopping** event and calls hello **OnStop** method so that your shutdown sequences may be executed before hello role is taken offline.</span></span>

### <a name="implementing-hello-aspnet-lifecycle-methods-for-a-web-role"></a><span data-ttu-id="5c0bd-141">Implementação de métodos de ciclo de vida do ASP.NET Olá para uma função web</span><span class="sxs-lookup"><span data-stu-id="5c0bd-141">Implementing hello ASP.NET lifecycle methods for a web role</span></span>
<span data-ttu-id="5c0bd-142">Você pode usar métodos de ciclo de vida do ASP.NET hello, além disso toothose fornecido pelo Olá **RoleEntryPoint** classe toomanage sequências de inicialização e desligamento para uma função web.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-142">You can use hello ASP.NET lifecycle methods, in addition toothose provided by hello **RoleEntryPoint** class, toomanage initialization and shutdown sequences for a web role.</span></span> <span data-ttu-id="5c0bd-143">Isso pode ser útil para fins de compatibilidade se você estiver portando um tooAzure de aplicativo ASP.NET existente.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-143">This may be useful for compatibility purposes if you are porting an existing ASP.NET application tooAzure.</span></span> <span data-ttu-id="5c0bd-144">métodos de ciclo de vida do ASP.NET Olá são chamados de dentro de saudação **RoleEntryPoint** métodos.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-144">hello ASP.NET lifecycle methods are called from within hello **RoleEntryPoint** methods.</span></span> <span data-ttu-id="5c0bd-145">Olá **aplicativo\_iniciar** método é chamado após Olá **RoleEntryPoint** conclusão do método.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-145">hello **Application\_Start** method is called after hello **RoleEntryPoint.OnStart** method finishes.</span></span> <span data-ttu-id="5c0bd-146">Olá **aplicativo\_final** método é chamado antes de saudação **RoleEntryPoint** método é chamado.</span><span class="sxs-lookup"><span data-stu-id="5c0bd-146">hello **Application\_End** method is called before hello **RoleEntryPoint.OnStop** method is called.</span></span>

## <a name="next-steps"></a><span data-ttu-id="5c0bd-147">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="5c0bd-147">Next steps</span></span>
<span data-ttu-id="5c0bd-148">Saiba como muito[criar um pacote de serviço de nuvem](cloud-services-model-and-package.md).</span><span class="sxs-lookup"><span data-stu-id="5c0bd-148">Learn how too[create a cloud service package](cloud-services-model-and-package.md).</span></span>

