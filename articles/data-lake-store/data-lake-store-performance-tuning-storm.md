---
title: Diretrizes de ajuste de desempenho para Storm do Azure Data Lake Store | Microsoft Docs
description: Diretrizes de ajuste de desempenho para Storm do Azure Data Lake Store
services: data-lake-store
documentationcenter: 
author: stewu
manager: amitkul
editor: stewu
ms.assetid: ebde7b9f-2e51-4d43-b7ab-566417221335
ms.service: data-lake-store
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 12/19/2016
ms.author: stewu
ms.openlocfilehash: 1dfa93643f45a96ded3fd022aa8b1c71d487acb4
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="performance-tuning-guidance-for-storm-on-hdinsight-and-azure-data-lake-store"></a><span data-ttu-id="b40e8-103">Diretrizes de ajuste do desempenho para Storm no HDInsight e Azure Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="b40e8-103">Performance tuning guidance for Storm on HDInsight and Azure Data Lake Store</span></span>

<span data-ttu-id="b40e8-104">Entenda os fatores que devem ser considerados ao ajustar o desempenho de uma topologia Storm do Azure.</span><span class="sxs-lookup"><span data-stu-id="b40e8-104">Understand the factors that should be considered when you tune the performance of an Azure Storm topology.</span></span> <span data-ttu-id="b40e8-105">Por exemplo, é importante compreender as características do trabalho feito pelos spouts e bolts (se o trabalho está com uso intensivo de memória ou de E/S).</span><span class="sxs-lookup"><span data-stu-id="b40e8-105">For example, it's important to understand the characteristics of the work done by the spouts and the bolts (whether the work is I/O or memory intensive).</span></span> <span data-ttu-id="b40e8-106">Este artigo abrange uma gama de diretrizes de ajuste de desempenho, incluindo a solução de problemas comuns.</span><span class="sxs-lookup"><span data-stu-id="b40e8-106">This article covers a range of performance tuning guidelines, including troubleshooting common issues.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="b40e8-107">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="b40e8-107">Prerequisites</span></span>

* <span data-ttu-id="b40e8-108">**Uma assinatura do Azure**.</span><span class="sxs-lookup"><span data-stu-id="b40e8-108">**An Azure subscription**.</span></span> <span data-ttu-id="b40e8-109">Consulte [Obter avaliação gratuita do Azure](https://azure.microsoft.com/pricing/free-trial/).</span><span class="sxs-lookup"><span data-stu-id="b40e8-109">See [Get Azure free trial](https://azure.microsoft.com/pricing/free-trial/).</span></span>
* <span data-ttu-id="b40e8-110">**Uma conta do repositório Azure Data Lake**.</span><span class="sxs-lookup"><span data-stu-id="b40e8-110">**An Azure Data Lake Store account**.</span></span> <span data-ttu-id="b40e8-111">Para obter instruções sobre como criar uma, consulte [Introdução ao Azure Data Lake Store](data-lake-store-get-started-portal.md).</span><span class="sxs-lookup"><span data-stu-id="b40e8-111">For instructions on how to create one, see [Get started with Azure Data Lake Store](data-lake-store-get-started-portal.md).</span></span>
* <span data-ttu-id="b40e8-112">**Um cluster HDInsight do Azure** com acesso a uma conta do Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="b40e8-112">**An Azure HDInsight cluster** with access to a Data Lake Store account.</span></span> <span data-ttu-id="b40e8-113">Confira [Criar um cluster HDInsight com o Data Lake Store](data-lake-store-hdinsight-hadoop-use-portal.md).</span><span class="sxs-lookup"><span data-stu-id="b40e8-113">See [Create an HDInsight cluster with Data Lake Store](data-lake-store-hdinsight-hadoop-use-portal.md).</span></span> <span data-ttu-id="b40e8-114">Certifique-se de habilitar a área de trabalho remota para o cluster.</span><span class="sxs-lookup"><span data-stu-id="b40e8-114">Make sure you enable Remote Desktop for the cluster.</span></span>
* <span data-ttu-id="b40e8-115">**Executando um cluster Storm no Data Lake Store**.</span><span class="sxs-lookup"><span data-stu-id="b40e8-115">**Running a Storm cluster on Data Lake Store**.</span></span> <span data-ttu-id="b40e8-116">Para obter mais informações, consulte [Storm no HDInsight](https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-storm-overview).</span><span class="sxs-lookup"><span data-stu-id="b40e8-116">For more information, see [Storm on HDInsight](https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-storm-overview).</span></span>
* <span data-ttu-id="b40e8-117">**Diretrizes de ajuste de desempenho do Data Lake Store**.</span><span class="sxs-lookup"><span data-stu-id="b40e8-117">**Performance tuning guidelines on Data Lake Store**.</span></span>  <span data-ttu-id="b40e8-118">Para ver conceitos gerais de desempenho, consulte [Diretrizes de ajuste de desempenho do Data Lake Store](https://docs.microsoft.com/en-us/azure/data-lake-store/data-lake-store-performance-tuning-guidance).</span><span class="sxs-lookup"><span data-stu-id="b40e8-118">For general performance concepts, see [Data Lake Store Performance Tuning Guidance](https://docs.microsoft.com/en-us/azure/data-lake-store/data-lake-store-performance-tuning-guidance).</span></span>  

## <a name="tune-the-parallelism-of-the-topology"></a><span data-ttu-id="b40e8-119">Ajuste do paralelismo da topologia</span><span class="sxs-lookup"><span data-stu-id="b40e8-119">Tune the parallelism of the topology</span></span>

<span data-ttu-id="b40e8-120">Você pode conseguir um melhor desempenho ao aumentar a simultaneidade de E/S de e para o Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="b40e8-120">You might be able to improve performance by increasing the concurrency of the I/O to and from Data Lake Store.</span></span> <span data-ttu-id="b40e8-121">Uma topologia Storm tem um conjunto de configurações que determinam o paralelismo:</span><span class="sxs-lookup"><span data-stu-id="b40e8-121">A Storm topology has a set of configurations that determine the parallelism:</span></span>
* <span data-ttu-id="b40e8-122">Número de processos de trabalho (os trabalhos são distribuídos uniformemente entre as VMs).</span><span class="sxs-lookup"><span data-stu-id="b40e8-122">Number of worker processes (the workers are evenly distributed across the VMs).</span></span>
* <span data-ttu-id="b40e8-123">Número de instâncias de executor de spout.</span><span class="sxs-lookup"><span data-stu-id="b40e8-123">Number of spout executor instances.</span></span>
* <span data-ttu-id="b40e8-124">Número de instâncias de bolt executor.</span><span class="sxs-lookup"><span data-stu-id="b40e8-124">Number of bolt executor instances.</span></span>
* <span data-ttu-id="b40e8-125">Número de tarefas de spout.</span><span class="sxs-lookup"><span data-stu-id="b40e8-125">Number of spout tasks.</span></span>
* <span data-ttu-id="b40e8-126">Número de tarefas de bolt.</span><span class="sxs-lookup"><span data-stu-id="b40e8-126">Number of bolt tasks.</span></span>

<span data-ttu-id="b40e8-127">Por exemplo, em um cluster com 4 VMs e 4 processos de trabalho, 32 executores de spout e 32 tarefas de spout, 256 executores de bolt e 512 tarefas de bolt, considere o seguinte:</span><span class="sxs-lookup"><span data-stu-id="b40e8-127">For example, on a cluster with 4 VMs and 4 worker processes, 32 spout executors and 32 spout tasks, and 256 bolt executors and 512 bolt tasks, consider the following:</span></span>

<span data-ttu-id="b40e8-128">Cada supervisor, que é um nó de trabalho, tem um único processo de trabalho de máquina virtual Java (JVM).</span><span class="sxs-lookup"><span data-stu-id="b40e8-128">Each supervisor, which is a worker node, has a single worker Java virtual machine (JVM) process.</span></span> <span data-ttu-id="b40e8-129">Esse processo JVM gerencia 4 threads de spout e 64 threads de bolt.</span><span class="sxs-lookup"><span data-stu-id="b40e8-129">This JVM process manages 4 spout threads and 64 bolt threads.</span></span> <span data-ttu-id="b40e8-130">Em cada thread, as tarefas são executadas sequencialmente.</span><span class="sxs-lookup"><span data-stu-id="b40e8-130">Within each thread, tasks are run sequentially.</span></span> <span data-ttu-id="b40e8-131">Com a configuração anterior, cada thread de spout tem 1 tarefa, e cada thread de bolt tem 2 tarefas.</span><span class="sxs-lookup"><span data-stu-id="b40e8-131">With the preceding configuration, each spout thread has 1 task, and each bolt thread has 2 tasks.</span></span>

<span data-ttu-id="b40e8-132">No Storm, aqui estão os diversos componentes envolvidos e como eles afetam o nível de paralelismo que você tem:</span><span class="sxs-lookup"><span data-stu-id="b40e8-132">In Storm, here are the various components involved, and how they affect the level of parallelism you have:</span></span>
* <span data-ttu-id="b40e8-133">O nó principal (chamado Nimbus no Storm) é usado para enviar e gerenciar trabalhos.</span><span class="sxs-lookup"><span data-stu-id="b40e8-133">The head node (called Nimbus in Storm) is used to submit and manage jobs.</span></span> <span data-ttu-id="b40e8-134">Esses nós não têm impacto sobre o grau de paralelismo.</span><span class="sxs-lookup"><span data-stu-id="b40e8-134">These nodes have no impact on the degree of parallelism.</span></span>
* <span data-ttu-id="b40e8-135">Nós de supervisor.</span><span class="sxs-lookup"><span data-stu-id="b40e8-135">The supervisor nodes.</span></span> <span data-ttu-id="b40e8-136">No HDInsight, isso corresponde a uma VM do Azure de nó de trabalho.</span><span class="sxs-lookup"><span data-stu-id="b40e8-136">In HDInsight, this corresponds to a worker node Azure VM.</span></span>
* <span data-ttu-id="b40e8-137">As tarefas de trabalho são processos Storm em execução nas VMs.</span><span class="sxs-lookup"><span data-stu-id="b40e8-137">The worker tasks are Storm processes running in the VMs.</span></span> <span data-ttu-id="b40e8-138">Cada tarefa de trabalho corresponde a uma instância da JVM.</span><span class="sxs-lookup"><span data-stu-id="b40e8-138">Each worker task corresponds to a JVM instance.</span></span> <span data-ttu-id="b40e8-139">O Storm distribui o número de processos de trabalho que você especificar para os nós de trabalho tão uniformemente quanto possível.</span><span class="sxs-lookup"><span data-stu-id="b40e8-139">Storm distributes the number of worker processes you specify to the worker nodes as evenly as possible.</span></span>
* <span data-ttu-id="b40e8-140">Instâncias de executores de bolt e spout.</span><span class="sxs-lookup"><span data-stu-id="b40e8-140">Spout and bolt executor instances.</span></span> <span data-ttu-id="b40e8-141">Cada instância de executor corresponde a um thread em execução dentro dos trabalhos (JVMs).</span><span class="sxs-lookup"><span data-stu-id="b40e8-141">Each executor instance corresponds to a thread running within the workers (JVMs).</span></span>
* <span data-ttu-id="b40e8-142">Tarefas do Storm.</span><span class="sxs-lookup"><span data-stu-id="b40e8-142">Storm tasks.</span></span> <span data-ttu-id="b40e8-143">Essas são tarefas lógicas que cada um desses threads executa.</span><span class="sxs-lookup"><span data-stu-id="b40e8-143">These are logical tasks that each of these threads run.</span></span> <span data-ttu-id="b40e8-144">Isso não altera o nível de paralelismo, então você deve avaliar se precisa de várias tarefas por executor ou não.</span><span class="sxs-lookup"><span data-stu-id="b40e8-144">This does not change the level of parallelism, so you should evaluate if you need multiple tasks per executor or not.</span></span>

### <a name="get-the-best-performance-from-data-lake-store"></a><span data-ttu-id="b40e8-145">Obter o melhor desempenho do Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="b40e8-145">Get the best performance from Data Lake Store</span></span>

<span data-ttu-id="b40e8-146">Ao trabalhar com o Data Lake Store, você obtém o melhor desempenho se fizer o seguinte:</span><span class="sxs-lookup"><span data-stu-id="b40e8-146">When working with Data Lake Store, you get the best performance if you do the following:</span></span>
* <span data-ttu-id="b40e8-147">Una seus pequenos acréscimos em tamanhos maiores (o ideal é 4 MB).</span><span class="sxs-lookup"><span data-stu-id="b40e8-147">Coalesce your small appends into larger sizes (ideally 4 MB).</span></span>
* <span data-ttu-id="b40e8-148">Faça o máximo possível de solicitações simultâneas.</span><span class="sxs-lookup"><span data-stu-id="b40e8-148">Do as many concurrent requests as you can.</span></span> <span data-ttu-id="b40e8-149">Como cada thread de bolt está fazendo leituras de bloqueio, é recomendável ter entre 8 e 12 threads por núcleo.</span><span class="sxs-lookup"><span data-stu-id="b40e8-149">Because each bolt thread is doing blocking reads, you want to have somewhere in the range of 8-12 threads per core.</span></span> <span data-ttu-id="b40e8-150">Isso mantém o NIC e a CPU bem utilizados.</span><span class="sxs-lookup"><span data-stu-id="b40e8-150">This keeps the NIC and the CPU well utilized.</span></span> <span data-ttu-id="b40e8-151">Uma VM maior permite mais solicitações simultâneas.</span><span class="sxs-lookup"><span data-stu-id="b40e8-151">A larger VM enables more concurrent requests.</span></span>  

### <a name="example-topology"></a><span data-ttu-id="b40e8-152">Exemplo de topologia</span><span class="sxs-lookup"><span data-stu-id="b40e8-152">Example topology</span></span>

<span data-ttu-id="b40e8-153">Suponhamos que você tenha um cluster de 8 nós de trabalho com a VM D13v2 do Azure.</span><span class="sxs-lookup"><span data-stu-id="b40e8-153">Let’s assume you have an 8 worker node cluster with a D13v2 Azure VM.</span></span> <span data-ttu-id="b40e8-154">Uma VM tem 8 núcleos, portanto, entre os 8 nós de trabalho, você tem 64 núcleos no total.</span><span class="sxs-lookup"><span data-stu-id="b40e8-154">This VM has 8 cores, so among the 8 worker nodes, you have 64 total cores.</span></span>

<span data-ttu-id="b40e8-155">Digamos que façamos oito threads de bolt por núcleo.</span><span class="sxs-lookup"><span data-stu-id="b40e8-155">Let’s say we do 8 bolt threads per core.</span></span> <span data-ttu-id="b40e8-156">Dados 64 núcleos, isso significa que desejamos um total de 512 instâncias de executor de bolt (ou seja, threads).</span><span class="sxs-lookup"><span data-stu-id="b40e8-156">Given 64 cores, that means we want 512 total bolt executor instances (that is, threads).</span></span> <span data-ttu-id="b40e8-157">Nesse caso, digamos que podemos começar com uma JVM por VM e usar principalmente a simultaneidade de threads na JVM para obter a simultaneidade.</span><span class="sxs-lookup"><span data-stu-id="b40e8-157">In this case, let’s say we start with one JVM per VM, and mainly use the thread concurrency within the JVM to achieve concurrency.</span></span> <span data-ttu-id="b40e8-158">Isso significa que precisamos de oito tarefas de trabalho (uma por VM do Azure) e 512 executores de bolt.</span><span class="sxs-lookup"><span data-stu-id="b40e8-158">That means we need 8 worker tasks (one per Azure VM), and 512 bolt executors.</span></span> <span data-ttu-id="b40e8-159">Dada essa configuração, o Storm tenta distribuir os trabalhos uniformemente entre os nós de trabalho (também conhecidos como nós de supervisor), dando a cada nó de trabalho 1 JVM.</span><span class="sxs-lookup"><span data-stu-id="b40e8-159">Given this configuration, Storm tries to distribute the workers evenly across worker nodes (also known as supervisor nodes), giving each worker node 1 JVM.</span></span> <span data-ttu-id="b40e8-160">Dentro dos supervisores, o Storm tenta distribuir os executores uniformemente entre supervisores, dando a cada supervisor (ou seja, JVM) 8 threads.</span><span class="sxs-lookup"><span data-stu-id="b40e8-160">Now within the supervisors, Storm tries to distribute the executors evenly between supervisors, giving each supervisor (that is, JVM) 8 threads each.</span></span>

## <a name="tune-additional-parameters"></a><span data-ttu-id="b40e8-161">Ajuste de parâmetros adicionais</span><span class="sxs-lookup"><span data-stu-id="b40e8-161">Tune additional parameters</span></span>
<span data-ttu-id="b40e8-162">Depois que tiver a topologia básica, você pode considerar se deseja ajustar qualquer um dos parâmetros:</span><span class="sxs-lookup"><span data-stu-id="b40e8-162">After you have the basic topology, you can consider whether you want to tweak any of the parameters:</span></span>
* <span data-ttu-id="b40e8-163">**Número de JVMs por nó de trabalho.**</span><span class="sxs-lookup"><span data-stu-id="b40e8-163">**Number of JVMs per worker node.**</span></span> <span data-ttu-id="b40e8-164">Se você tiver uma grande estrutura de dados (por exemplo, uma tabela de pesquisa) hospedada na memória, cada JVM vai precisar de uma cópia separada.</span><span class="sxs-lookup"><span data-stu-id="b40e8-164">If you have a large data structure (for example, a lookup table) that you host in memory, each JVM requires a separate copy.</span></span> <span data-ttu-id="b40e8-165">Como alternativa, você pode usar a estrutura de dados em vários threads, se tiver menos JVMs.</span><span class="sxs-lookup"><span data-stu-id="b40e8-165">Alternatively, you can use the data structure across many threads if you have fewer JVMs.</span></span> <span data-ttu-id="b40e8-166">Para E/S do bolt, o número de JVMs não faz tanta diferença quanto o número de threads adicionados entre essas JVMs.</span><span class="sxs-lookup"><span data-stu-id="b40e8-166">For the bolt’s I/O, the number of JVMs does not make as much of a difference as the number of threads added across those JVMs.</span></span> <span data-ttu-id="b40e8-167">Para simplificar, é uma boa ideia ter uma JVM por trabalho.</span><span class="sxs-lookup"><span data-stu-id="b40e8-167">For simplicity, it's a good idea to have one JVM per worker.</span></span> <span data-ttu-id="b40e8-168">No entanto, dependendo do que o bolt esteja fazendo ou de que processamento de aplicativo você esteja precisando, talvez seja necessário alterar esse número.</span><span class="sxs-lookup"><span data-stu-id="b40e8-168">Depending on what your bolt is doing or what application processing you require, though, you may need to change this number.</span></span>
* <span data-ttu-id="b40e8-169">**Número de executores de spout.**</span><span class="sxs-lookup"><span data-stu-id="b40e8-169">**Number of spout executors.**</span></span> <span data-ttu-id="b40e8-170">Como o exemplo anterior usa bolts para gravar no Data Lake Store, o número de spouts não é diretamente relevante para o desempenho do bolt.</span><span class="sxs-lookup"><span data-stu-id="b40e8-170">Because the preceding example uses bolts for writing to Data Lake Store, the number of spouts is not directly relevant to the bolt performance.</span></span> <span data-ttu-id="b40e8-171">No entanto, dependendo do volume de processamento ou de E/S ocorrendo no spout, é recomendável ajustar os spouts para melhor desempenho.</span><span class="sxs-lookup"><span data-stu-id="b40e8-171">However, depending on the amount of processing or I/O happening in the spout, it's a good idea to tune the spouts for best performance.</span></span> <span data-ttu-id="b40e8-172">Você precisa ter spouts suficientes para conseguir manter os bolts trabalhando.</span><span class="sxs-lookup"><span data-stu-id="b40e8-172">Ensure that you have enough spouts to be able to keep the bolts busy.</span></span> <span data-ttu-id="b40e8-173">As taxas de saída dos spouts devem coincidir com a taxa de transferência dos bolts.</span><span class="sxs-lookup"><span data-stu-id="b40e8-173">The output rates of the spouts should match the throughput of the bolts.</span></span> <span data-ttu-id="b40e8-174">A configuração real depende do spout.</span><span class="sxs-lookup"><span data-stu-id="b40e8-174">The actual configuration depends on the spout.</span></span>
* <span data-ttu-id="b40e8-175">**Número de tarefas.**</span><span class="sxs-lookup"><span data-stu-id="b40e8-175">**Number of tasks.**</span></span> <span data-ttu-id="b40e8-176">Cada bolt é executado como um único thread.</span><span class="sxs-lookup"><span data-stu-id="b40e8-176">Each bolt runs as a single thread.</span></span> <span data-ttu-id="b40e8-177">Tarefas adicionais por bolt não fornecem simultaneidade adicional.</span><span class="sxs-lookup"><span data-stu-id="b40e8-177">Additional tasks per bolt don't provide any additional concurrency.</span></span> <span data-ttu-id="b40e8-178">A situação em que elas são benéficas é se o processo de confirmação da tupla utilizar uma grande proporção de seu tempo de execução de bolt.</span><span class="sxs-lookup"><span data-stu-id="b40e8-178">The only time they are of benefit is if your process of acknowledging the tuple takes a large proportion of your bolt execution time.</span></span> <span data-ttu-id="b40e8-179">É recomendável agrupar muitas tuplas em um acréscimo maior antes de enviar uma confirmação do bolt.</span><span class="sxs-lookup"><span data-stu-id="b40e8-179">It's a good idea to group many tuples into a larger append before you send an acknowledgement from the bolt.</span></span> <span data-ttu-id="b40e8-180">Portanto, na maioria dos casos, várias tarefas não oferecem qualquer benefício adicional.</span><span class="sxs-lookup"><span data-stu-id="b40e8-180">So, in most cases, multiple tasks provide no additional benefit.</span></span>
* <span data-ttu-id="b40e8-181">**Agrupamento local ou aleatório.**</span><span class="sxs-lookup"><span data-stu-id="b40e8-181">**Local or shuffle grouping.**</span></span> <span data-ttu-id="b40e8-182">Quando essa configuração é habilitada, tuplas são enviadas a bolts dentro do mesmo processo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="b40e8-182">When this setting is enabled, tuples are sent to bolts within the same worker process.</span></span> <span data-ttu-id="b40e8-183">Isso reduz as chamadas de rede e comunicação entre processos.</span><span class="sxs-lookup"><span data-stu-id="b40e8-183">This reduces inter-process communication and network calls.</span></span> <span data-ttu-id="b40e8-184">Isso é recomendado para a maioria das topologias.</span><span class="sxs-lookup"><span data-stu-id="b40e8-184">This is recommended for most topologies.</span></span>

<span data-ttu-id="b40e8-185">Esse cenário básico é um bom ponto de partida.</span><span class="sxs-lookup"><span data-stu-id="b40e8-185">This basic scenario is a good starting point.</span></span> <span data-ttu-id="b40e8-186">Teste com seus próprios dados para ajustar os parâmetros anteriores para obter o desempenho ideal.</span><span class="sxs-lookup"><span data-stu-id="b40e8-186">Test with your own data to tweak the preceding parameters to achieve optimal performance.</span></span>

## <a name="tune-the-spout"></a><span data-ttu-id="b40e8-187">Ajustar o spout</span><span class="sxs-lookup"><span data-stu-id="b40e8-187">Tune the spout</span></span>

<span data-ttu-id="b40e8-188">Você pode modificar as seguintes configurações para ajustar o spout.</span><span class="sxs-lookup"><span data-stu-id="b40e8-188">You can modify the following settings to tune the spout.</span></span>

- <span data-ttu-id="b40e8-189">**Tempo limite de tupla: topology.message.timeout.secs**.</span><span class="sxs-lookup"><span data-stu-id="b40e8-189">**Tuple timeout: topology.message.timeout.secs**.</span></span> <span data-ttu-id="b40e8-190">Essa configuração determina quanto tempo uma mensagem leva para ser concluída e receber a confirmação antes de ser considerada com falha.</span><span class="sxs-lookup"><span data-stu-id="b40e8-190">This setting determines the amount of time a message takes to complete, and receive acknowledgement, before it is considered failed.</span></span>

- <span data-ttu-id="b40e8-191">**Memória máxima por processo de trabalho: worker.childopts**.</span><span class="sxs-lookup"><span data-stu-id="b40e8-191">**Max memory per worker process: worker.childopts**.</span></span> <span data-ttu-id="b40e8-192">Essa configuração permite especificar parâmetros de linha de comando adicionais para os trabalhos Java.</span><span class="sxs-lookup"><span data-stu-id="b40e8-192">This setting lets you specify additional command-line parameters to the Java workers.</span></span> <span data-ttu-id="b40e8-193">A configuração mais comumente usada aqui é XmX, que determina o máximo de memória alocado para o heap de uma JVM.</span><span class="sxs-lookup"><span data-stu-id="b40e8-193">The most commonly used setting here is XmX, which determines the maximum memory allocated to a JVM’s heap.</span></span>

- <span data-ttu-id="b40e8-194">**Máx. de spouts pendentes: topology.max.spout.pending**.</span><span class="sxs-lookup"><span data-stu-id="b40e8-194">**Max spout pending: topology.max.spout.pending**.</span></span> <span data-ttu-id="b40e8-195">Essa configuração determina o número de tuplas que podem estar em voo (ainda não confirmadas em todos os nós na topologia) por thread de spout em qualquer tempo.</span><span class="sxs-lookup"><span data-stu-id="b40e8-195">This setting determines the number of tuples that can in be flight (not yet acknowledged at all nodes in the topology) per spout thread at any time.</span></span>

 <span data-ttu-id="b40e8-196">Um bom cálculo a fazer é estimar o tamanho de cada uma de suas tuplas.</span><span class="sxs-lookup"><span data-stu-id="b40e8-196">A good calculation to do is to estimate the size of each of your tuples.</span></span> <span data-ttu-id="b40e8-197">Em seguida, calcule quanta memória um thread de spout tem.</span><span class="sxs-lookup"><span data-stu-id="b40e8-197">Then figure out how much memory one spout thread has.</span></span> <span data-ttu-id="b40e8-198">A memória total alocada para um thread dividida por esse valor deve fornecer o limite superior para o parâmetro de máx. de spouts pendentes.</span><span class="sxs-lookup"><span data-stu-id="b40e8-198">The total memory allocated to a thread, divided by this value, should give you the upper bound for the max spout pending parameter.</span></span>

## <a name="tune-the-bolt"></a><span data-ttu-id="b40e8-199">Ajustar o bolt</span><span class="sxs-lookup"><span data-stu-id="b40e8-199">Tune the bolt</span></span>
<span data-ttu-id="b40e8-200">Ao gravar para o Data Lake Store, defina a política de sincronização de tamanho (buffer no lado do cliente) para 4 MB.</span><span class="sxs-lookup"><span data-stu-id="b40e8-200">When you're writing to Data Lake Store, set a size sync policy (buffer on the client side) to 4 MB.</span></span> <span data-ttu-id="b40e8-201">Uma liberação ou hsync() será executada somente quando o tamanho do buffer tiver esse valor.</span><span class="sxs-lookup"><span data-stu-id="b40e8-201">A flushing or hsync() is then performed only when the buffer size is the at this value.</span></span> <span data-ttu-id="b40e8-202">O driver do Data Lake Store na VM de trabalho faz esse buffer automaticamente, a menos que você execute explicitamente um hsync().</span><span class="sxs-lookup"><span data-stu-id="b40e8-202">The Data Lake Store driver on the worker VM automatically does this buffering, unless you explicitly perform an hsync().</span></span>

<span data-ttu-id="b40e8-203">O bolt do Storm do Data Lake Store padrão tem um parâmetro de política de sincronização de tamanho (fileBufferSize) que pode ser usado para ajustar esse parâmetro.</span><span class="sxs-lookup"><span data-stu-id="b40e8-203">The default Data Lake Store Storm bolt has a size sync policy parameter (fileBufferSize) that can be used to tune this parameter.</span></span>

<span data-ttu-id="b40e8-204">Em topologias com uso intensivo de E/S, é recomendável fazer com que cada thread de bolt grave seu próprio arquivo e definir uma política de rotação de arquivo (fileRotationSize).</span><span class="sxs-lookup"><span data-stu-id="b40e8-204">In I/O-intensive topologies, it's a good idea to have each bolt thread write to its own file, and to set a file rotation policy (fileRotationSize).</span></span> <span data-ttu-id="b40e8-205">Quando o arquivo atingir um determinado tamanho, o fluxo será automaticamente liberado e a gravação ocorrerá em um novo arquivo.</span><span class="sxs-lookup"><span data-stu-id="b40e8-205">When the file reaches a certain size, the stream is automatically flushed and a new file is written to.</span></span> <span data-ttu-id="b40e8-206">O tamanho do arquivo recomendado para a rotação é de 1 GB.</span><span class="sxs-lookup"><span data-stu-id="b40e8-206">The recommended file size for rotation is 1 GB.</span></span>

### <a name="handle-tuple-data"></a><span data-ttu-id="b40e8-207">Manipulação de dados de tupla</span><span class="sxs-lookup"><span data-stu-id="b40e8-207">Handle tuple data</span></span>

<span data-ttu-id="b40e8-208">No Storm, um spout permanece com uma tupla até que ela seja explicitamente confirmada pelo bolt.</span><span class="sxs-lookup"><span data-stu-id="b40e8-208">In Storm, a spout holds on to a tuple until it is explicitly acknowledged by the bolt.</span></span> <span data-ttu-id="b40e8-209">Se uma tupla foi lida pelo bolt, mas ainda não foi confirmada, o spout pode não ter persistido no back-end Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="b40e8-209">If a tuple has been read by the bolt but has not been acknowledged yet, the spout might not have persisted into Data Lake Store back end.</span></span> <span data-ttu-id="b40e8-210">Após a confirmação da tupla, o spout pode ter sua persistência garantida pelo bolt e, em seguida, pode excluir os dados de origem de qualquer fonte da qual esteja lendo.</span><span class="sxs-lookup"><span data-stu-id="b40e8-210">After a tuple is acknowledged, the spout can be guaranteed persistence by the bolt, and can then delete the source data from whatever source it is reading from.</span></span>  

<span data-ttu-id="b40e8-211">Para melhor desempenho no Data Lake Store, faça com que 4 MB de dados de tupla sejam armazenados em buffer.</span><span class="sxs-lookup"><span data-stu-id="b40e8-211">For best performance on Data Lake Store, have the bolt buffer 4 MB of tuple data.</span></span> <span data-ttu-id="b40e8-212">Em seguida, grave no back-end do Data Lake Store como uma gravação de 4 MB.</span><span class="sxs-lookup"><span data-stu-id="b40e8-212">Then write to the Data Lake Store back end as one 4-MB write.</span></span> <span data-ttu-id="b40e8-213">Depois que os dados tiverem sido gravados com êxito no repositório (chamando hflush()), o bolt poderá confirmar os dados de volta para o spout.</span><span class="sxs-lookup"><span data-stu-id="b40e8-213">After the data has been successfully written to the store (by calling hflush()), the bolt can acknowledge the data back to the spout.</span></span> <span data-ttu-id="b40e8-214">É isso que o bolt de exemplo fornecido aqui faz.</span><span class="sxs-lookup"><span data-stu-id="b40e8-214">This is what the example bolt supplied here does.</span></span> <span data-ttu-id="b40e8-215">Também é aceitável manter um número maior de tuplas antes de fazer a chamada de hflush() e confirmar as tuplas.</span><span class="sxs-lookup"><span data-stu-id="b40e8-215">It is also acceptable to hold a larger number of tuples before the hflush() call is made and the tuples acknowledged.</span></span> <span data-ttu-id="b40e8-216">No entanto, isso aumenta o número de tuplas em voo que o spout precisa armazenar e, portanto, aumenta a quantidade de memória exigida por JVM.</span><span class="sxs-lookup"><span data-stu-id="b40e8-216">However, this increases the number of tuples in flight that the spout needs to hold, and therefore increases the amount of memory required per JVM.</span></span>

> [!NOTE]
<span data-ttu-id="b40e8-217">Determinados aplicativos podem ter um requisito de confirmar tuplas com maior frequência (em tamanhos de dados menores que 4 MB), por motivos não relacionados a desempenho.</span><span class="sxs-lookup"><span data-stu-id="b40e8-217">Applications might have a requirement to acknowledge tuples more frequently (at data sizes less than 4 MB) for other non-performance reasons.</span></span> <span data-ttu-id="b40e8-218">No entanto, isso pode afetar a taxa de transferência de E/S para o back-end de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="b40e8-218">However, that might affect the I/O throughput to the storage back end.</span></span> <span data-ttu-id="b40e8-219">Avalie com cuidado essa compensação em relação ao desempenho de E/S do bolt.</span><span class="sxs-lookup"><span data-stu-id="b40e8-219">Carefully weigh this tradeoff against the bolt’s I/O performance.</span></span>

<span data-ttu-id="b40e8-220">Se a taxa de entrada de tuplas não for alta, fazendo com que o buffer de 4 MB demore muito para ser preenchido, é recomendável mitigar isso:</span><span class="sxs-lookup"><span data-stu-id="b40e8-220">If the incoming rate of tuples is not high, so the 4-MB buffer takes a long time to fill, consider mitigating this by:</span></span>
* <span data-ttu-id="b40e8-221">Reduzindo o número de bolts, de modo que haja menos buffers a preencher.</span><span class="sxs-lookup"><span data-stu-id="b40e8-221">Reducing the number of bolts, so there are fewer buffers to fill.</span></span>
* <span data-ttu-id="b40e8-222">Adotando uma política baseada em tempo ou em contagem, na qual um hflush() é disparado a cada x liberações ou a cada y milissegundos e as tuplas acumuladas até esse ponto são confirmadas de volta.</span><span class="sxs-lookup"><span data-stu-id="b40e8-222">Having a time-based or count-based policy, where an hflush() is triggered every x flushes or every y milliseconds, and the tuples accumulated so far are acknowledged back.</span></span>

<span data-ttu-id="b40e8-223">Observe que neste caso a taxa de transferência é menor, mas de todo modo, com uma taxa de eventos baixa, a taxa de transferência máxima não é o objetivo principal.</span><span class="sxs-lookup"><span data-stu-id="b40e8-223">Note that the throughput in this case is lower, but with a slow rate of events, maximum throughput is not the biggest objective anyway.</span></span> <span data-ttu-id="b40e8-224">Essas reduções ajudam a reduzir o tempo total necessário para o fluxo de uma tupla até o repositório.</span><span class="sxs-lookup"><span data-stu-id="b40e8-224">These mitigations help you reduce the total time that it takes for a tuple to flow through to the store.</span></span> <span data-ttu-id="b40e8-225">Isso pode ser relevante se você quiser um pipeline em tempo real, mesmo com uma taxa baixa de evento.</span><span class="sxs-lookup"><span data-stu-id="b40e8-225">This might matter if you want a real-time pipeline even with a low event rate.</span></span> <span data-ttu-id="b40e8-226">Observe também que, se a taxa de entrada de tuplas for baixa, você precisará ajustar o parâmetro topology.message.timeout_secs para que as tuplas não atinjam o tempo limite enquanto estiverem sendo armazenadas em buffer ou processadas.</span><span class="sxs-lookup"><span data-stu-id="b40e8-226">Also note that if your incoming tuple rate is low, you should adjust the topology.message.timeout_secs parameter, so the tuples don’t time out while they are getting buffered or processed.</span></span>

## <a name="monitor-your-topology-in-storm"></a><span data-ttu-id="b40e8-227">Monitorar a topologia no Storm</span><span class="sxs-lookup"><span data-stu-id="b40e8-227">Monitor your topology in Storm</span></span>  
<span data-ttu-id="b40e8-228">Enquanto a topologia estiver em execução, você pode monitorá-la na interface do usuário do Storm.</span><span class="sxs-lookup"><span data-stu-id="b40e8-228">While your topology is running, you can monitor it in the Storm user interface.</span></span> <span data-ttu-id="b40e8-229">Aqui estão os principais parâmetros examinar:</span><span class="sxs-lookup"><span data-stu-id="b40e8-229">Here are the main parameters to look at:</span></span>

* <span data-ttu-id="b40e8-230">**Latência total de execução do processo.**</span><span class="sxs-lookup"><span data-stu-id="b40e8-230">**Total process execution latency.**</span></span> <span data-ttu-id="b40e8-231">Tempo médio que uma tupla leva para ser emitida pelo spout, processada pelo bolt e confirmada.</span><span class="sxs-lookup"><span data-stu-id="b40e8-231">This is the average time one tuple takes to be emitted by the spout, processed by the bolt, and acknowledged.</span></span>

* <span data-ttu-id="b40e8-232">**Latência total de processo do bolt.**</span><span class="sxs-lookup"><span data-stu-id="b40e8-232">**Total bolt process latency.**</span></span> <span data-ttu-id="b40e8-233">Tempo médio gasto pela tupla no bolt até receber uma confirmação.</span><span class="sxs-lookup"><span data-stu-id="b40e8-233">This is the average time spent by the tuple at the bolt until it receives an acknowledgement.</span></span>

* <span data-ttu-id="b40e8-234">**Latência total de execute do bolt.**</span><span class="sxs-lookup"><span data-stu-id="b40e8-234">**Total bolt execute latency.**</span></span> <span data-ttu-id="b40e8-235">Tempo médio gasto pelo bolt no método execute.</span><span class="sxs-lookup"><span data-stu-id="b40e8-235">This is the average time spent by the bolt in the execute method.</span></span>

* <span data-ttu-id="b40e8-236">**Número de falhas.**</span><span class="sxs-lookup"><span data-stu-id="b40e8-236">**Number of failures.**</span></span> <span data-ttu-id="b40e8-237">Refere-se ao número de tuplas que deixaram de ser completamente processadas antes que atingissem o tempo limite.</span><span class="sxs-lookup"><span data-stu-id="b40e8-237">This refers to the number of tuples that failed to be fully processed before they timed out.</span></span>

* <span data-ttu-id="b40e8-238">**Capacidade.**</span><span class="sxs-lookup"><span data-stu-id="b40e8-238">**Capacity.**</span></span> <span data-ttu-id="b40e8-239">Medida da ocupação do sistema.</span><span class="sxs-lookup"><span data-stu-id="b40e8-239">This is a measure of how busy your system is.</span></span> <span data-ttu-id="b40e8-240">Se esse número é 1, os bolts estão trabalhando tão rápido quanto possível.</span><span class="sxs-lookup"><span data-stu-id="b40e8-240">If this number is 1, your bolts are working as fast as they can.</span></span> <span data-ttu-id="b40e8-241">Se for menor que 1, aumente o paralelismo.</span><span class="sxs-lookup"><span data-stu-id="b40e8-241">If it is less than 1, increase the parallelism.</span></span> <span data-ttu-id="b40e8-242">Se for maior que 1, reduza o paralelismo.</span><span class="sxs-lookup"><span data-stu-id="b40e8-242">If it is greater than 1, reduce the parallelism.</span></span>

## <a name="troubleshoot-common-problems"></a><span data-ttu-id="b40e8-243">Solução de problemas comuns</span><span class="sxs-lookup"><span data-stu-id="b40e8-243">Troubleshoot common problems</span></span>
<span data-ttu-id="b40e8-244">Eis alguns cenários comuns de solução de problemas.</span><span class="sxs-lookup"><span data-stu-id="b40e8-244">Here are a few common troubleshooting scenarios.</span></span>
* <span data-ttu-id="b40e8-245">**Grande número de tuplas atingindo o tempo limite.**</span><span class="sxs-lookup"><span data-stu-id="b40e8-245">**Many tuples are timing out.**</span></span> <span data-ttu-id="b40e8-246">Procure em cada nó na topologia para determinar onde está o afunilamento.</span><span class="sxs-lookup"><span data-stu-id="b40e8-246">Look at each node in the topology to determine where the bottleneck is.</span></span> <span data-ttu-id="b40e8-247">O motivo mais comum para isso é que os bolts não estão conseguindo acompanhar os spouts.</span><span class="sxs-lookup"><span data-stu-id="b40e8-247">The most common reason for this is that the bolts are not able to keep up with the spouts.</span></span> <span data-ttu-id="b40e8-248">Isso faz com que as tuplas congestionem os buffers internos que estão aguardando para ser processados.</span><span class="sxs-lookup"><span data-stu-id="b40e8-248">This leads to tuples clogging the internal buffers while waiting to be processed.</span></span> <span data-ttu-id="b40e8-249">Considere aumentar o valor de tempo limite ou diminuir o máx. de spouts pendentes.</span><span class="sxs-lookup"><span data-stu-id="b40e8-249">Consider increasing the timeout value or decreasing the max spout pending.</span></span>

* <span data-ttu-id="b40e8-250">**Há uma latência alta de execução do processo total, mas uma latência baixa de processo do bolt.**</span><span class="sxs-lookup"><span data-stu-id="b40e8-250">**There is a high total process execution latency, but a low bolt process latency.**</span></span> <span data-ttu-id="b40e8-251">Nesse caso, é possível que as tuplas não estejam sendo reconhecidas rápido o suficiente.</span><span class="sxs-lookup"><span data-stu-id="b40e8-251">In this case, it is possible that the tuples are not being acknowledged fast enough.</span></span> <span data-ttu-id="b40e8-252">Verifique se há um número suficiente de confirmadores.</span><span class="sxs-lookup"><span data-stu-id="b40e8-252">Check that there are a sufficient number of acknowledgers.</span></span> <span data-ttu-id="b40e8-253">Outra possibilidade é que estejam aguardando na fila por tempo demais antes que os bolts comecem a processá-las.</span><span class="sxs-lookup"><span data-stu-id="b40e8-253">Another possibility is that they are waiting in the queue for too long before the bolts start processing them.</span></span> <span data-ttu-id="b40e8-254">Diminua o máx. de spouts pendentes.</span><span class="sxs-lookup"><span data-stu-id="b40e8-254">Decrease the max spout pending.</span></span>

* <span data-ttu-id="b40e8-255">**Latência de execute do bolt elevada.**</span><span class="sxs-lookup"><span data-stu-id="b40e8-255">**There is a high bolt execute latency.**</span></span> <span data-ttu-id="b40e8-256">Isso significa que o método execute() do seu bolt está demorando muito.</span><span class="sxs-lookup"><span data-stu-id="b40e8-256">This means that the execute() method of your bolt is taking too long.</span></span> <span data-ttu-id="b40e8-257">Otimize o código ou examine os tamanhos de gravação e o comportamento de liberação.</span><span class="sxs-lookup"><span data-stu-id="b40e8-257">Optimize the code, or look at write sizes and flush behavior.</span></span>

### <a name="data-lake-store-throttling"></a><span data-ttu-id="b40e8-258">Limitação do Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="b40e8-258">Data Lake Store throttling</span></span>
<span data-ttu-id="b40e8-259">Se atingir os limites de largura de banda fornecidos pelo Data Lake Store, você pode ver falhas de tarefa.</span><span class="sxs-lookup"><span data-stu-id="b40e8-259">If you hit the limits of bandwidth provided by Data Lake Store, you might see task failures.</span></span> <span data-ttu-id="b40e8-260">Verifique os logs de tarefa para erros de limitação.</span><span class="sxs-lookup"><span data-stu-id="b40e8-260">Check task logs for throttling errors.</span></span> <span data-ttu-id="b40e8-261">Você pode diminuir o paralelismo aumentando o tamanho do contêiner.</span><span class="sxs-lookup"><span data-stu-id="b40e8-261">You can decrease the parallelism by increasing container size.</span></span>    

<span data-ttu-id="b40e8-262">Para verificar se há problemas de limitação, habilite o log de depuração no lado do cliente:</span><span class="sxs-lookup"><span data-stu-id="b40e8-262">To check if you are getting throttled, enable the debug logging on the client side:</span></span>

1. <span data-ttu-id="b40e8-263">Em **Ambari** > **Storm** > **Config** > **Advanced storm-worker-log4j**, altere **&lt;root level="info"&gt;** para **&lt;root level=”debug”&gt;**.</span><span class="sxs-lookup"><span data-stu-id="b40e8-263">In **Ambari** > **Storm** > **Config** > **Advanced storm-worker-log4j**, change **&lt;root level="info"&gt;** to **&lt;root level=”debug”&gt;**.</span></span> <span data-ttu-id="b40e8-264">Reinicie todos os nós/serviços para que a configuração entre em vigor.</span><span class="sxs-lookup"><span data-stu-id="b40e8-264">Restart all the nodes/service for the configuration to take effect.</span></span>
2. <span data-ttu-id="b40e8-265">Monitore os logs de topologia Storm em nós de trabalho (em /var/log/storm/worker-artifacts/&lt;TopologyName&gt;/&lt;port&gt;/worker.log) para exceções de limitação do Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="b40e8-265">Monitor the Storm topology logs on worker nodes (under /var/log/storm/worker-artifacts/&lt;TopologyName&gt;/&lt;port&gt;/worker.log) for Data Lake Store throttling exceptions.</span></span>

## <a name="next-steps"></a><span data-ttu-id="b40e8-266">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="b40e8-266">Next steps</span></span>
<span data-ttu-id="b40e8-267">Ajuste de desempenho adicional para o Storm pode ser referenciado [neste blog](https://blogs.msdn.microsoft.com/shanyu/2015/05/14/performance-tuning-for-hdinsight-storm-and-microsoft-azure-eventhubs/).</span><span class="sxs-lookup"><span data-stu-id="b40e8-267">Additional performance tuning for Storm can be referenced in [this blog](https://blogs.msdn.microsoft.com/shanyu/2015/05/14/performance-tuning-for-hdinsight-storm-and-microsoft-azure-eventhubs/).</span></span>

<span data-ttu-id="b40e8-268">Para obter um exemplo adicional de execução, consulte [esse aqui no GitHub](https://github.com/hdinsight/storm-performance-automation).</span><span class="sxs-lookup"><span data-stu-id="b40e8-268">For an additional example to run, see [this one on GitHub](https://github.com/hdinsight/storm-performance-automation).</span></span>
