---
title: "Arquitetura do Azure HDInsight ingressado no domínio | Microsoft Docs"
description: "Aprenda a planejar o HDInsight associado ao domínio."
services: hdinsight
documentationcenter: 
author: saurinsh
manager: jhubbard
editor: cgronlun
tags: azure-portal
ms.assetid: 7dc6847d-10d4-4b5c-9c83-cc513cf91965
ms.service: hdinsight
ms.custom: hdinsightactive
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 02/03/2017
ms.author: saurinsh
ms.openlocfilehash: 7e34f47f09466a40993b4cc797ff1cad2bdaeafe
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="plan-azure-domain-joined-hadoop-clusters-in-hdinsight"></a><span data-ttu-id="697e8-103">Planejar clusters Hadoop do Azure associados ao domínio no HDInsight</span><span class="sxs-lookup"><span data-stu-id="697e8-103">Plan Azure domain-joined Hadoop clusters in HDInsight</span></span>

<span data-ttu-id="697e8-104">O Hadoop tradicional é um cluster de usuário único.</span><span class="sxs-lookup"><span data-stu-id="697e8-104">The traditional Hadoop is a single-user cluster.</span></span> <span data-ttu-id="697e8-105">Ele é adequado para a maioria das empresas que têm equipes de aplicativos menores que criam grandes cargas de trabalho de dados.</span><span class="sxs-lookup"><span data-stu-id="697e8-105">It is suitable for most companies that have smaller application teams building large data workloads.</span></span> <span data-ttu-id="697e8-106">À medida que o Hadoop ganha popularidade, muitas empresas estão mudando para um modelo em que clusters são gerenciados por equipes de TI, e várias equipes de aplicativo compartilham clusters.</span><span class="sxs-lookup"><span data-stu-id="697e8-106">As Hadoop gains popularity, many enterprises are moving toward a model in which clusters are managed by IT teams and multiple application teams share clusters.</span></span> <span data-ttu-id="697e8-107">Assim, as funcionalidades que envolvem clusters multiusuários estão entre as funcionalidades mais solicitadas no Azure HDInsight.</span><span class="sxs-lookup"><span data-stu-id="697e8-107">Thus, functionalities involving multiuser clusters are among the most requested functionalities in Azure HDInsight.</span></span>

<span data-ttu-id="697e8-108">Em vez de criar sua própria autorização e autenticação multiusuário, o HDInsight recorre ao provedor de identidade mais popular – o AD (Active Directory).</span><span class="sxs-lookup"><span data-stu-id="697e8-108">Instead of building its own multiuser authentication and authorization, HDInsight relies on the most popular identity provider--Active Directory (AD).</span></span> <span data-ttu-id="697e8-109">A funcionalidade de segurança eficiente no AD pode ser usada para gerenciar a autorização multiusuário no HDInsight.</span><span class="sxs-lookup"><span data-stu-id="697e8-109">The powerful security functionality in AD can be used to manage multiuser authorization in HDInsight.</span></span> <span data-ttu-id="697e8-110">Integrando HDInsight com o AD, você pode se comunicar com os clusters, usando suas credenciais do AD.</span><span class="sxs-lookup"><span data-stu-id="697e8-110">By integrating HDInsight with AD, you can communicate with the clusters by using your AD credentials.</span></span> <span data-ttu-id="697e8-111">O HDInsight mapeia o usuário do AD para um usuário do Hadoop local, para que todos os serviços em execução no HDInsight (Ambari, servidor Hive, Ranger, servidor Spark Thrift e outros) funcionem sem problemas para o usuário autenticado.</span><span class="sxs-lookup"><span data-stu-id="697e8-111">HDInsight maps an AD user to a local Hadoop user, so all the services running on HDInsight (Ambari, Hive server, Ranger, Spark thrift server, and others) work seamlessly for the authenticated user.</span></span>

## <a name="integrate-hdinsight-with-ad-and-ad-on-iaas-vm"></a><span data-ttu-id="697e8-112">Integrar o HDInsight com o AD e o AD em VM IaaS</span><span class="sxs-lookup"><span data-stu-id="697e8-112">Integrate HDInsight with AD and AD on IaaS VM</span></span>

<span data-ttu-id="697e8-113">Integrando o HDInsight com o Azure AD ou o AD em VM IaaS, os nós do cluster HDInsight são ingressados em um domínio.</span><span class="sxs-lookup"><span data-stu-id="697e8-113">By integrating HDInsight with Azure AD or AD on Iaas VM, the HDInsight cluster nodes are domain-joined to a domain.</span></span> <span data-ttu-id="697e8-114">O HDInsight cria entidades de serviço para os serviços do Hadoop em execução no cluster e os coloca em uma UO (unidade organizacional) especificada no Azure AD ou AD em VM IaaS.</span><span class="sxs-lookup"><span data-stu-id="697e8-114">HDInsight creates service principals for the Hadoop services running on the cluster and places them within a specified organizational unit (OU) in Azure AD or AD on IaaS VM.</span></span> <span data-ttu-id="697e8-115">O HDInsight também cria mapeamentos de DNS reversos no domínio para os endereços IP de nós que ingressaram no domínio.</span><span class="sxs-lookup"><span data-stu-id="697e8-115">HDInsight also creates reverse DNS mappings in the domain for the IP addresses of the nodes that are joined to the domain.</span></span>

<span data-ttu-id="697e8-116">Você pode obter essa configuração, usando várias arquiteturas.</span><span class="sxs-lookup"><span data-stu-id="697e8-116">You can achieve this setup by using multiple architectures.</span></span> <span data-ttu-id="697e8-117">É possível escolher uma das arquiteturas a seguir.</span><span class="sxs-lookup"><span data-stu-id="697e8-117">You can choose from the following architectures.</span></span>

<span data-ttu-id="697e8-118">**HDInsight integrado ao AD em execução no Azure IaaS**</span><span class="sxs-lookup"><span data-stu-id="697e8-118">**HDInsight integrated with AD running on Azure IaaS**</span></span>

<span data-ttu-id="697e8-119">Essa é a arquitetura mais simples para a integração do HDInsight com o Active Directory.</span><span class="sxs-lookup"><span data-stu-id="697e8-119">This is the simplest architecture for integrating HDInsight with Active Directory.</span></span> <span data-ttu-id="697e8-120">O controlador de domínio do AD é executado em uma ou várias, VMs (máquinas virtuais) no Azure.</span><span class="sxs-lookup"><span data-stu-id="697e8-120">The AD domain controller runs on one (or multiple) virtual machines (VMs) in Azure.</span></span> <span data-ttu-id="697e8-121">Essas VMs são normalmente em uma rede virtual.</span><span class="sxs-lookup"><span data-stu-id="697e8-121">These VMs are usually in a virtual network.</span></span> <span data-ttu-id="697e8-122">Configure outra rede virtual para o cluster HDInsight.</span><span class="sxs-lookup"><span data-stu-id="697e8-122">You set up another virtual network for the HDInsight cluster.</span></span> <span data-ttu-id="697e8-123">Para que o HDInsight tenha uma linha de visão para o Active Directory, você precisa emparelhar essas redes virtuais usando o [emparelhamento de VNet para VNet](../virtual-network/virtual-network-create-peering.md).</span><span class="sxs-lookup"><span data-stu-id="697e8-123">For HDInsight to have a line of sight to Active Directory, you need to peer these virtual networks by using [VNet-to-VNet peering](../virtual-network/virtual-network-create-peering.md).</span></span> <span data-ttu-id="697e8-124">Se você criar o Active Directory em ARM, você poderá criar o Active Directory e o HDInsight na mesma VNet e não precisará fazer o emparelhamento.</span><span class="sxs-lookup"><span data-stu-id="697e8-124">If you create the Active Directory in ARM, then you can create the Active Directory and HDInsight in the same VNet and you don't need to do peering.</span></span> 

![Topologia de cluster do HDInsight de associação de domínio](./media/hdinsight-domain-joined-architecture/hdinsight-domain-joined-architecture_1.png)

> [!NOTE]
> <span data-ttu-id="697e8-126">Nessa arquitetura, você não pode usar o Azure Data Lake Store com o cluster HDInsight.</span><span class="sxs-lookup"><span data-stu-id="697e8-126">In this architecture, you cannot use Azure Data Lake Store with the HDInsight cluster.</span></span>


<span data-ttu-id="697e8-127">Pré-requisitos para o Active Directory:</span><span class="sxs-lookup"><span data-stu-id="697e8-127">Prerequisites for Active Directory:</span></span>

* <span data-ttu-id="697e8-128">Deve-se criar uma [unidade organizacional](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md), na qual você coloca as VMs do cluster do HDInsight e as entidades de serviço usadas pelo cluster.</span><span class="sxs-lookup"><span data-stu-id="697e8-128">An [organizational unit](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md) must be created, within which you place the HDInsight cluster VMs and the service principals used by the cluster.</span></span>
* <span data-ttu-id="697e8-129">[Protocolos de acesso de diretório leve](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md) (LDAPs) devem ser configurados para se comunicar com o AD.</span><span class="sxs-lookup"><span data-stu-id="697e8-129">[Lightweight Directory Access Protocols](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md) (LDAPs) must be set up for communicating with AD.</span></span> <span data-ttu-id="697e8-130">O certificado usado para configurar o LDAPS deve ser um certificado real (não um certificado autoassinado).</span><span class="sxs-lookup"><span data-stu-id="697e8-130">The certificate used to set up LDAPS must be a real certificate (not a self-signed certificate).</span></span>
* <span data-ttu-id="697e8-131">As zonas DNS reversas devem ser criadas no domínio para o intervalo de endereços IP da sub-rede HDInsight (por exemplo 10.2.0.0/24 na figura anterior).</span><span class="sxs-lookup"><span data-stu-id="697e8-131">Reverse DNS zones must be created on the domain for the IP address range of the HDInsight subnet (for example, 10.2.0.0/24 in the previous picture).</span></span>
* <span data-ttu-id="697e8-132">Uma conta de serviço ou uma conta de usuário é necessária.</span><span class="sxs-lookup"><span data-stu-id="697e8-132">A service account or a user account is needed.</span></span> <span data-ttu-id="697e8-133">Use essa conta para criar o cluster HDInsight.</span><span class="sxs-lookup"><span data-stu-id="697e8-133">Use this account to create the HDInsight cluster.</span></span> <span data-ttu-id="697e8-134">Essa conta deve ter as seguintes permissões:</span><span class="sxs-lookup"><span data-stu-id="697e8-134">This account must have the following permissions:</span></span>

    - <span data-ttu-id="697e8-135">Permissões para criar objetos de entidade de serviço e objetos de computador na unidade organizacional</span><span class="sxs-lookup"><span data-stu-id="697e8-135">Permissions to create service principal objects and machine objects within the organizational unit</span></span>
    - <span data-ttu-id="697e8-136">Permissões para criar regras de proxy DNS reversas</span><span class="sxs-lookup"><span data-stu-id="697e8-136">Permissions to create reverse DNS proxy rules</span></span>
    - <span data-ttu-id="697e8-137">Permissões para ingressar computadores no domínio do Active Directory</span><span class="sxs-lookup"><span data-stu-id="697e8-137">Permissions to join machines to the Active Directory domain</span></span>

<span data-ttu-id="697e8-138">**HDInsight integrado ao Azure AD somente de nuvem**</span><span class="sxs-lookup"><span data-stu-id="697e8-138">**HDInsight integrated with cloud-only Azure AD**</span></span>

<span data-ttu-id="697e8-139">Para o Azure AD somente na nuvem, configure um controlador de domínio para que o HDInsight possa ser integrado ao Azure AD.</span><span class="sxs-lookup"><span data-stu-id="697e8-139">For cloud-only Azure AD, configure a domain controller so that HDInsight can be integrated with Azure AD.</span></span> <span data-ttu-id="697e8-140">Isso é feito usando o [Azure Active Directory Domain Services](../active-directory-domain-services/active-directory-ds-overview.md) (Azure AD DS).</span><span class="sxs-lookup"><span data-stu-id="697e8-140">This is achieved by using [Azure Active Directory Domain Services](../active-directory-domain-services/active-directory-ds-overview.md) (Azure AD DS).</span></span> <span data-ttu-id="697e8-141">O Azure AD DS cria computadores de controlador de domínio na nuvem e fornece endereços IP para eles.</span><span class="sxs-lookup"><span data-stu-id="697e8-141">Azure AD DS creates domain controller machines on the cloud and provides IP addresses for them.</span></span> <span data-ttu-id="697e8-142">Ele cria dois controladores de domínio para alta disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="697e8-142">It creates two domain controllers for high availability.</span></span>

<span data-ttu-id="697e8-143">Atualmente, o Azure AD DS só existe em redes virtuais clássicas.</span><span class="sxs-lookup"><span data-stu-id="697e8-143">Currently, Azure AD DS exists only in classic virtual networks.</span></span> <span data-ttu-id="697e8-144">Isso só é acessível por meio do portal clássico do Azure.</span><span class="sxs-lookup"><span data-stu-id="697e8-144">It is only accessible by using the Azure classic portal.</span></span> <span data-ttu-id="697e8-145">A rede virtual HDInsight existe no portal do Azure e precisa ser emparelhada com a rede virtual clássica usando o emparelhamento de VNet para VNet.</span><span class="sxs-lookup"><span data-stu-id="697e8-145">The HDInsight virtual network exists in the Azure portal, which needs to be peered with the classic virtual network by using VNet-to-VNet peering.</span></span>

> [!NOTE]
> <span data-ttu-id="697e8-146">Emparelhamento entre uma rede virtual clássica e uma rede virtual do Azure Resource Manager requer que ambas as redes virtuais estão na mesma região e a mesma assinatura do Azure.</span><span class="sxs-lookup"><span data-stu-id="697e8-146">Peering between a classic virtual network and an Azure Resource Manager virtual network requires that both virtual networks are in the same region and under the same Azure subscription.</span></span>

![Topologia de cluster do HDInsight de associação de domínio](./media/hdinsight-domain-joined-architecture/hdinsight-domain-joined-architecture_2.png)

<span data-ttu-id="697e8-148">Pré-requisitos do Azure AD:</span><span class="sxs-lookup"><span data-stu-id="697e8-148">Prerequisites for Azure AD:</span></span>

* <span data-ttu-id="697e8-149">Deve-se criar uma [unidade organizacional](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md), na qual você deseja colocar as VMs do cluster do HDInsight e as entidades de serviço usadas pelo cluster.</span><span class="sxs-lookup"><span data-stu-id="697e8-149">An [organizational unit](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md) must be created within which you place the HDInsight cluster VMs and the service principals used by the cluster.</span></span>
* <span data-ttu-id="697e8-150">O [LDAPS](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md) deve ser configurado quando você configura o AD DS.</span><span class="sxs-lookup"><span data-stu-id="697e8-150">[LDAPS](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md) must be set up when you configure Azure AD DS.</span></span> <span data-ttu-id="697e8-151">O certificado usado para configurar o LDAPS deve ser um certificado real (não um certificado autoassinado).</span><span class="sxs-lookup"><span data-stu-id="697e8-151">The certificate used to set up LDAPS must be a real certificate (not a self-signed certificate).</span></span>
* <span data-ttu-id="697e8-152">As zonas DNS reversas devem ser criadas no domínio para o intervalo de endereços IP da sub-rede HDInsight (por exemplo 10.2.0.0/24 na figura anterior).</span><span class="sxs-lookup"><span data-stu-id="697e8-152">Reverse DNS zones must be created on the domain for the IP address range of the HDInsight subnet (for example, 10.2.0.0/24 in the previous picture).</span></span>
* <span data-ttu-id="697e8-153">Os [hashes de senha](../active-directory-domain-services/active-directory-ds-getting-started-password-sync.md) devem ser sincronizados do Azure AD para o Azure AD DS.</span><span class="sxs-lookup"><span data-stu-id="697e8-153">[Password hashes](../active-directory-domain-services/active-directory-ds-getting-started-password-sync.md) must be synced from Azure AD to Azure AD DS.</span></span>
* <span data-ttu-id="697e8-154">Uma conta de serviço ou uma conta de usuário é necessária.</span><span class="sxs-lookup"><span data-stu-id="697e8-154">A service account or a user account is needed.</span></span> <span data-ttu-id="697e8-155">Use essa conta para criar o cluster HDInsight.</span><span class="sxs-lookup"><span data-stu-id="697e8-155">Use this account to create the HDInsight cluster.</span></span> <span data-ttu-id="697e8-156">Essa conta deve ter as seguintes permissões:</span><span class="sxs-lookup"><span data-stu-id="697e8-156">This account must have the following permissions:</span></span>

    - <span data-ttu-id="697e8-157">Permissões para criar objetos de entidade de serviço e objetos de computador na unidade organizacional</span><span class="sxs-lookup"><span data-stu-id="697e8-157">Permissions to create service principal objects and machine objects within the organizational unit</span></span>
    - <span data-ttu-id="697e8-158">Permissões para criar regras de proxy DNS reversas</span><span class="sxs-lookup"><span data-stu-id="697e8-158">Permissions to create reverse DNS proxy rules</span></span>
    - <span data-ttu-id="697e8-159">Permissões para ingressar computadores no domínio do Azure AD</span><span class="sxs-lookup"><span data-stu-id="697e8-159">Permissions to join machines to the Azure AD domain</span></span>

## <a name="next-steps"></a><span data-ttu-id="697e8-160">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="697e8-160">Next steps</span></span>
* <span data-ttu-id="697e8-161">Para configurar um cluster HDInsight ingressado em um domínio, confira [Configurar clusters HDInsight ingressados em domínio](hdinsight-domain-joined-configure.md).</span><span class="sxs-lookup"><span data-stu-id="697e8-161">To configure a domain-joined HDInsight cluster, see [Configure domain-joined HDInsight clusters](hdinsight-domain-joined-configure.md).</span></span>
* <span data-ttu-id="697e8-162">Para gerenciar clusters HDInsight ingressados em um domínio, confira [Gerenciar clusters HDInsight ingressados em domínio](hdinsight-domain-joined-manage.md).</span><span class="sxs-lookup"><span data-stu-id="697e8-162">To manage domain-joined HDInsight clusters, see [Manage domain-joined HDInsight clusters](hdinsight-domain-joined-manage.md).</span></span>
* <span data-ttu-id="697e8-163">Para configurar políticas do Hive e executar consultas do Hive, confira [Configurar políticas do Hive para clusters HDInsight ingressados no domínio](hdinsight-domain-joined-run-hive.md).</span><span class="sxs-lookup"><span data-stu-id="697e8-163">To configure Hive policies and run Hive queries, see [Configure Hive policies for domain-joined HDInsight clusters](hdinsight-domain-joined-run-hive.md).</span></span>
* <span data-ttu-id="697e8-164">Para executar consultas Hive usando SSH em clusters HDInsight adicionados ao domínio, confira [Usar SSH com HDInsight](hdinsight-hadoop-linux-use-ssh-unix.md).</span><span class="sxs-lookup"><span data-stu-id="697e8-164">To run Hive queries by using SSH on domain-joined HDInsight clusters, see [Use SSH with HDInsight](hdinsight-hadoop-linux-use-ssh-unix.md).</span></span>
