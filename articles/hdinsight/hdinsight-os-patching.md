---
title: "Configurar o agendamento de aplicação de patch no SO para clusters HDInsight baseados em Linux – Azure | Microsoft Docs"
description: "Saiba como configurar o agendamento de aplicação de patch no SO para clusters HDInsight baseados em Linux."
services: hdinsight
documentationcenter: 
author: bprakash
manager: asadk
editor: bprakash
ms.assetid: 
ms.service: hdinsight
ms.custom: hdinsightactive
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 03/21/2017
ms.author: bhanupr
ms.openlocfilehash: af3c5a19ae8e2e606e4b0506f9f6dddb41192e40
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="os-patching-for-hdinsight"></a><span data-ttu-id="1e879-103">Aplicação de patch no HDInsight</span><span class="sxs-lookup"><span data-stu-id="1e879-103">OS patching for HDInsight</span></span> 
<span data-ttu-id="1e879-104">Como um serviço Hadoop gerenciado, o HDInsight se encarrega da aplicação de patch no SO das VMs subjacentes usadas por clusters HDInsight.</span><span class="sxs-lookup"><span data-stu-id="1e879-104">As a managed Hadoop service, HDInsight takes care of patching the OS of the underlying VMs used by HDInsight clusters.</span></span> <span data-ttu-id="1e879-105">Desde 1º de agosto de 2016, alteramos a política de aplicação de patch no SO convidado para clusters HDInsight baseados em Linux (versão 3.4 ou superior).</span><span class="sxs-lookup"><span data-stu-id="1e879-105">As of August 1, 2016, we have changed the guest OS patching policy for Linux-based HDInsight clusters (version 3.4 or greater).</span></span> <span data-ttu-id="1e879-106">O objetivo da nova política é reduzir significativamente o número de reinicializações devido à aplicação de patch.</span><span class="sxs-lookup"><span data-stu-id="1e879-106">The goal of the new policy is to significantly reduce the number of reboots due to patching.</span></span> <span data-ttu-id="1e879-107">A nova política continuará corrigindo VMs (máquinas virtuais) em clusters Linux todas as segundas-feiras ou quintas-feiras, começando às 0:00 UTC de maneira irregular entre nós em qualquer cluster determinado.</span><span class="sxs-lookup"><span data-stu-id="1e879-107">The new policy will continue to patch virtual machines (VMs) on Linux clusters every Monday or Thursday starting at 12AM UTC in a staggered fashion across nodes in any given cluster.</span></span> <span data-ttu-id="1e879-108">No entanto, qualquer determinada VM será reinicializada somente, no máximo, uma vez a cada 30 dias devido à aplicação de patch do SO convidado.</span><span class="sxs-lookup"><span data-stu-id="1e879-108">However, any given VM will only reboot at most once every 30 days due to guest OS patching.</span></span> <span data-ttu-id="1e879-109">Além disso, a primeira reinicialização para um cluster recém-criado não ocorrerá antes de 30 dias a contar da data de criação do cluster.</span><span class="sxs-lookup"><span data-stu-id="1e879-109">In addition, the first reboot for a newly created cluster will not happen sooner than 30 days from the cluster creation date.</span></span> <span data-ttu-id="1e879-110">Os patches terão efeito após a reinicialização das VMs.</span><span class="sxs-lookup"><span data-stu-id="1e879-110">Patches will be effective once the VMs are rebooted.</span></span>

## <a name="how-to-configure-the-os-patching-schedule-for-linux-based-hdinsight-clusters"></a><span data-ttu-id="1e879-111">Como configurar o agendamento de aplicação de patch no SO para clusters HDInsight baseados em Linux</span><span class="sxs-lookup"><span data-stu-id="1e879-111">How to configure the OS patching schedule for Linux-based HDInsight clusters</span></span>
<span data-ttu-id="1e879-112">As máquinas virtuais em um cluster HDInsight precisam ser reinicializadas ocasionalmente para que os patches de segurança importantes possam ser instalados.</span><span class="sxs-lookup"><span data-stu-id="1e879-112">The virtual machines in an HDInsight cluster need to be rebooted occasionally so that important security patches can be installed.</span></span> <span data-ttu-id="1e879-113">Desde 1º de agosto de 2016, novos clusters HDInsight baseados em Linux (versão 3.4 ou superior) são reinicializados usando a seguinte agenda:</span><span class="sxs-lookup"><span data-stu-id="1e879-113">As of August 1, 2016, new Linux-based HDInsight clusters (version 3.4 or greater,) are rebooted using the following schedule:</span></span>

1. <span data-ttu-id="1e879-114">Uma máquina virtual no cluster só pode ser reinicializada para patches no máximo uma vez a cada 30 dias.</span><span class="sxs-lookup"><span data-stu-id="1e879-114">A virtual machine in the cluster can only reboot for patches at most, once within a 30-day period.</span></span>
2. <span data-ttu-id="1e879-115">A reinicialização começa à 00h UTC.</span><span class="sxs-lookup"><span data-stu-id="1e879-115">The reboot occurs starting at 12AM UTC.</span></span>
3. <span data-ttu-id="1e879-116">O processo de reinicialização é realizado em estágios entre as máquinas virtuais no cluster, assim o cluster ainda fica disponível durante o processo de reinicialização.</span><span class="sxs-lookup"><span data-stu-id="1e879-116">The reboot process is staggered across virtual machines in the cluster, so the cluster is still available during the reboot process.</span></span>
4. <span data-ttu-id="1e879-117">A primeira reinicialização de um cluster recém-criado não ocorrerá antes de 30 dias a contar da data de criação do cluster.</span><span class="sxs-lookup"><span data-stu-id="1e879-117">The first reboot for a newly created cluster will not happen sooner than 30 days after the cluster creation date.</span></span>

<span data-ttu-id="1e879-118">Com a ação de script descrita neste artigo, você pode modificar a agenda de aplicação de patch no SO da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="1e879-118">Using the script action described in this article, you can modify the OS patching schedule as follows:</span></span>
1. <span data-ttu-id="1e879-119">Habilitar ou desabilitar reinicializações automáticas</span><span class="sxs-lookup"><span data-stu-id="1e879-119">Enable or disable automatic reboots</span></span>
2. <span data-ttu-id="1e879-120">Definir a frequência de reinicializações (dias entre reinicializações)</span><span class="sxs-lookup"><span data-stu-id="1e879-120">Set the frequency of reboots (days between reboots)</span></span>
3. <span data-ttu-id="1e879-121">Definir o dia da semana no qual uma reinicialização ocorre</span><span class="sxs-lookup"><span data-stu-id="1e879-121">Set the day of the week when a reboot occurs</span></span>

> [!NOTE]
> <span data-ttu-id="1e879-122">Essa ação de script só funcionará com clusters HDInsight baseados em Linux criados após 1º de agosto de 2016.</span><span class="sxs-lookup"><span data-stu-id="1e879-122">This script action will only work with Linux-based HDInsight clusters created after August 1st, 2016.</span></span> <span data-ttu-id="1e879-123">Os patches terão efeito somente após a reinicialização das VMs.</span><span class="sxs-lookup"><span data-stu-id="1e879-123">Patches will be effective only when VMs are rebooted.</span></span> 
>

## <a name="how-to-use-the-script"></a><span data-ttu-id="1e879-124">Como usar o script</span><span class="sxs-lookup"><span data-stu-id="1e879-124">How to use the script</span></span> 

<span data-ttu-id="1e879-125">Ao usar esse script você precisará das seguintes informações:</span><span class="sxs-lookup"><span data-stu-id="1e879-125">When using this script requires the following information:</span></span>
1. <span data-ttu-id="1e879-126">O local de script: https://hdiconfigactions.blob.core.windows.net/linuxospatchingrebootconfigv01/os-patching-reboot-config.sh.</span><span class="sxs-lookup"><span data-stu-id="1e879-126">The script location: https://hdiconfigactions.blob.core.windows.net/linuxospatchingrebootconfigv01/os-patching-reboot-config.sh.</span></span>
    <span data-ttu-id="1e879-127">O HDInsight usa esse URI para localizar e executar o script em todas as máquinas virtuais no cluster.</span><span class="sxs-lookup"><span data-stu-id="1e879-127">HDInsight uses this URI to find and run the script on all the virtual machines in the cluster.</span></span>
  
2. <span data-ttu-id="1e879-128">Os tipos de nós do cluster ao qual o script é aplicado: nó de cabeçalho, nó de trabalho, zookeeper.</span><span class="sxs-lookup"><span data-stu-id="1e879-128">The cluster node types that the script is applied to: headnode, workernode, zookeeper.</span></span> <span data-ttu-id="1e879-129">Esse script deve ser aplicado a todos os tipos de nó do cluster.</span><span class="sxs-lookup"><span data-stu-id="1e879-129">This script must be applied to all node types in the cluster.</span></span> <span data-ttu-id="1e879-130">Se não for aplicado a um tipo de nó, as máquinas virtuais desse tipo de nó continuarão a usar a agenda anterior de aplicação de patches.</span><span class="sxs-lookup"><span data-stu-id="1e879-130">If it is not applied to a node type, then the virtual machines for that node type will continue to use the previous patching schedule.</span></span>


3.  <span data-ttu-id="1e879-131">Parâmetro: esse script aceita três parâmetros numéricos:</span><span class="sxs-lookup"><span data-stu-id="1e879-131">Parameter: This script accepts three numeric parameters:</span></span>

    | <span data-ttu-id="1e879-132">.</span><span class="sxs-lookup"><span data-stu-id="1e879-132">Parameter</span></span> | <span data-ttu-id="1e879-133">Definição</span><span class="sxs-lookup"><span data-stu-id="1e879-133">Definition</span></span> |
    | --- | --- |
    | <span data-ttu-id="1e879-134">Habilitar/desabilitar reinicializações automáticas</span><span class="sxs-lookup"><span data-stu-id="1e879-134">Enable/disable automatic reboots</span></span> |<span data-ttu-id="1e879-135">0 ou 1.</span><span class="sxs-lookup"><span data-stu-id="1e879-135">0 or 1.</span></span> <span data-ttu-id="1e879-136">Um valor 0 desabilita reinicializações automáticas, enquanto 1 habilita as reinicializações automáticas.</span><span class="sxs-lookup"><span data-stu-id="1e879-136">A value of 0 disables automatic reboots while 1 enables automatic reboots.</span></span> |
    | <span data-ttu-id="1e879-137">Frequência</span><span class="sxs-lookup"><span data-stu-id="1e879-137">Frequency</span></span> |<span data-ttu-id="1e879-138">7 a 90 (inclusive).</span><span class="sxs-lookup"><span data-stu-id="1e879-138">7 to 90 (inclusive).</span></span> <span data-ttu-id="1e879-139">O número de dias a aguardar antes de reinicializar as máquinas virtuais, para patches que exijam uma reinicialização.</span><span class="sxs-lookup"><span data-stu-id="1e879-139">The number of days to wait before rebooting the virtual machines for patches that require a reboot.</span></span> |
    | <span data-ttu-id="1e879-140">Dia da semana</span><span class="sxs-lookup"><span data-stu-id="1e879-140">Day of week</span></span> |<span data-ttu-id="1e879-141">1 a 7 (inclusive).</span><span class="sxs-lookup"><span data-stu-id="1e879-141">1 to 7 (inclusive).</span></span> <span data-ttu-id="1e879-142">Um valor 1 indica que a reinicialização deve ocorrer em uma segunda-feira, e 7 indica domingo. For exemplo, usar os parâmetros 1 60 2 resulta em reinicializações automáticas a cada 60 dias (no máximo), às terças-feiras.</span><span class="sxs-lookup"><span data-stu-id="1e879-142">A value of 1 indicates the reboot should occur on a Monday, and 7 indicates a Sunday.For example, using parameters of 1 60 2 results in automatic reboots every 60 days (at most) on Tuesday.</span></span> |
    | <span data-ttu-id="1e879-143">Persistência</span><span class="sxs-lookup"><span data-stu-id="1e879-143">Persistence</span></span> |<span data-ttu-id="1e879-144">Ao aplicar uma ação de script em um cluster existente, você pode marcar o script como persistente.</span><span class="sxs-lookup"><span data-stu-id="1e879-144">When applying a script action to an existing cluster, you can mark the script as persisted.</span></span> <span data-ttu-id="1e879-145">Os scripts persistentes são aplicados quando novos nós de trabalho são adicionados ao cluster por meio de operações de dimensionamento.</span><span class="sxs-lookup"><span data-stu-id="1e879-145">Persisted scripts are applied when new workernodes are added to the cluster through scaling operations.</span></span> |

> [!NOTE]
> <span data-ttu-id="1e879-146">Marque esse script como persistente ao aplicar a um cluster existente.</span><span class="sxs-lookup"><span data-stu-id="1e879-146">You must mark this script as persisted when applying to an existing cluster.</span></span> <span data-ttu-id="1e879-147">Caso contrário, quaisquer nós novos criado por meio de operações de dimensionamento usarão o agendamento de aplicação de patch padrão.</span><span class="sxs-lookup"><span data-stu-id="1e879-147">Otherwise, any new nodes created through scaling      operations will use the default patching schedule.</span></span>
<span data-ttu-id="1e879-148">Se você aplicar o script como parte do processo de criação de cluster, ele será persistido automaticamente.</span><span class="sxs-lookup"><span data-stu-id="1e879-148">If you apply the script as part of the cluster creation process, it is persisted automatically.</span></span>
>

## <a name="next-steps"></a><span data-ttu-id="1e879-149">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="1e879-149">Next steps</span></span>

<span data-ttu-id="1e879-150">Para conhecer as etapas específicas sobre como usar a ação de script, confira as seções a seguir em [Personalizar clusters HDInsight baseados em Linux usando a ação de script](hdinsight-hadoop-customize-cluster-linux.md):</span><span class="sxs-lookup"><span data-stu-id="1e879-150">For specific steps on using the script action, see the following sections in the [Customize Linuz-based HDInsight clusters using script action](hdinsight-hadoop-customize-cluster-linux.md):</span></span>

* [<span data-ttu-id="1e879-151">Usar uma ação de script durante a criação do cluster</span><span class="sxs-lookup"><span data-stu-id="1e879-151">Use a script action during cluster creation</span></span>](hdinsight-hadoop-customize-cluster-linux.md#use-a-script-action-during-cluster-creation)
* [<span data-ttu-id="1e879-152">Aplicar uma ação de script em um cluster em execução</span><span class="sxs-lookup"><span data-stu-id="1e879-152">Apply a script action to a running cluster</span></span>](hdinsight-hadoop-customize-cluster-linux.md#apply-a-script-action-to-a-running-cluster)
