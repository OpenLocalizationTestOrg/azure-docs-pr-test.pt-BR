---
title: "Gerenciador de Tráfego do Azure – métodos de roteamento de tráfego | Microsoft Docs"
description: "Estes artigos o ajudam a entender os diferentes métodos de roteamento de tráfego usados pelo Gerenciador de Tráfego"
services: traffic-manager
documentationcenter: 
author: KumudD
manager: timlt
editor: 
ms.assetid: db1efbf6-6762-4c7a-ac99-675d4eeb54d0
ms.service: traffic-manager
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 07/13/2017
ms.author: kumud
ms.openlocfilehash: fe776e24a4f78b389c6096694055b38befa3c419
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/03/2017
---
# <a name="traffic-manager-routing-methods"></a><span data-ttu-id="83f35-103">Métodos de roteamento do Gerenciador de Tráfego</span><span class="sxs-lookup"><span data-stu-id="83f35-103">Traffic Manager routing methods</span></span>

<span data-ttu-id="83f35-104">O Gerenciador de Tráfego do Azure dá suporte a três métodos de roteamento de tráfego para determinar como rotear o tráfego de rede para os vários pontos de extremidade de serviço.</span><span class="sxs-lookup"><span data-stu-id="83f35-104">Azure Traffic Manager supports four traffic-routing methods to determine how to route network traffic to the various service endpoints.</span></span> <span data-ttu-id="83f35-105">O Gerenciador de Tráfego aplica o método de roteamento de tráfego para cada consulta DNS recebida.</span><span class="sxs-lookup"><span data-stu-id="83f35-105">Traffic Manager applies the traffic-routing method to each DNS query it receives.</span></span> <span data-ttu-id="83f35-106">O método de roteamento de tráfego determina qual ponto de extremidade foi retornado na resposta DNS.</span><span class="sxs-lookup"><span data-stu-id="83f35-106">The traffic-routing method determines which endpoint returned in the DNS response.</span></span>

<span data-ttu-id="83f35-107">Quatro métodos de roteamento de tráfego estão disponíveis no Gerenciador de Tráfego:</span><span class="sxs-lookup"><span data-stu-id="83f35-107">There are four traffic routing methods available in Traffic Manager:</span></span>

* <span data-ttu-id="83f35-108">**[Prioridade](#priority):** selecione **Prioridade** quando desejar usar um ponto de extremidade de serviço primário para todo o tráfego e fornecer backups, caso os pontos de extremidade primário ou de backup não estejam disponíveis.</span><span class="sxs-lookup"><span data-stu-id="83f35-108">**[Priority](#priority):** Select **Priority** when you want to use a primary service endpoint for all traffic, and provide backups in case the primary or the backup endpoints are unavailable.</span></span>
* <span data-ttu-id="83f35-109">**[Ponderado](#weighted):** selecione **Ponderado** quando quiser distribuir o tráfego entre um conjunto de pontos de extremidade, seja uniformemente ou de acordo com os pesos que você definir.</span><span class="sxs-lookup"><span data-stu-id="83f35-109">**[Weighted](#weighted):** Select **Weighted** when you want to distribute traffic across a set of endpoints, either evenly or according to weights, which you define.</span></span>
* <span data-ttu-id="83f35-110">**[Desempenho](#performance):** selecione **Desempenho** quando tiver pontos de extremidade em diferentes regiões e quiser que os usuários finais usem o ponto de extremidade “mais próximo” em termos de menor latência de rede.</span><span class="sxs-lookup"><span data-stu-id="83f35-110">**[Performance](#performance):** Select **Performance** when you have endpoints in different geographic locations and you want end users to use the "closest" endpoint in terms of the lowest network latency.</span></span>
* <span data-ttu-id="83f35-111">**[Geográfico](#geographic):** selecione **Geográfico** para que os usuários sejam direcionados para pontos de extremidade específicos (Azure, Externo ou Aninhado) com base no local geográfico dos quais as respectivas consultas DNS são originadas.</span><span class="sxs-lookup"><span data-stu-id="83f35-111">**[Geographic](#geographic):** Select **Geographic** so that users are directed to specific endpoints (Azure, External, or Nested) based on which geographic location their DNS query originates from.</span></span> <span data-ttu-id="83f35-112">Isso permite que os clientes do Gerenciador de Tráfego habilitem cenários em que saber a região geográfica de um usuário e roteá-lo com base nela é importante.</span><span class="sxs-lookup"><span data-stu-id="83f35-112">This empowers Traffic Manager customers to enable scenarios where knowing a user’s geographic region and routing them based on that is important.</span></span> <span data-ttu-id="83f35-113">Os exemplos incluem conformidade com normas de soberania de dados, localização de conteúdo e experiência do usuário, bem como medição do tráfego de diferentes regiões.</span><span class="sxs-lookup"><span data-stu-id="83f35-113">Examples include complying with data sovereignty mandates, localization of content & user experience and measuring traffic from different regions.</span></span>

<span data-ttu-id="83f35-114">Todos os perfis do Gerenciador de Tráfego incluem o monitoramento da integridade do ponto de extremidade e o failover automático do ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="83f35-114">All Traffic Manager profiles include monitoring of endpoint health and automatic endpoint failover.</span></span> <span data-ttu-id="83f35-115">Para obter mais informações, consulte [Monitoramento do Ponto de Extremidade do Gerenciador de Tráfego](traffic-manager-monitoring.md).</span><span class="sxs-lookup"><span data-stu-id="83f35-115">For more information, see [Traffic Manager Endpoint Monitoring](traffic-manager-monitoring.md).</span></span> <span data-ttu-id="83f35-116">Um único perfil do Gerenciador de Tráfego pode usar apenas um único método de roteamento de tráfego.</span><span class="sxs-lookup"><span data-stu-id="83f35-116">A single Traffic Manager profile can use only one traffic routing method.</span></span> <span data-ttu-id="83f35-117">Você pode selecionar um método de roteamento de tráfego diferente para o seu perfil a qualquer momento.</span><span class="sxs-lookup"><span data-stu-id="83f35-117">You can select a different traffic routing method for your profile at any time.</span></span> <span data-ttu-id="83f35-118">As alterações são aplicadas em até um minuto e não há tempo de inatividade.</span><span class="sxs-lookup"><span data-stu-id="83f35-118">Changes are applied within one minute, and no downtime is incurred.</span></span> <span data-ttu-id="83f35-119">Métodos de roteamento de tráfego podem ser combinados usando perfis aninhados do Gerenciador de Tráfego.</span><span class="sxs-lookup"><span data-stu-id="83f35-119">Traffic-routing methods can be combined by using nested Traffic Manager profiles.</span></span> <span data-ttu-id="83f35-120">O aninhamento permite configurações sofisticadas e flexíveis de roteamento de tráfego para atender às necessidades de aplicativos maiores e mais complexos.</span><span class="sxs-lookup"><span data-stu-id="83f35-120">Nesting enables sophisticated and flexible traffic-routing configurations that meet the needs of larger, complex applications.</span></span> <span data-ttu-id="83f35-121">Para obter mais informações, consulte [perfis aninhados do Gerenciador de Tráfego](traffic-manager-nested-profiles.md).</span><span class="sxs-lookup"><span data-stu-id="83f35-121">For more information, see [nested Traffic Manager profiles](traffic-manager-nested-profiles.md).</span></span>

## <span data-ttu-id="83f35-122"><a name = "priority"></a>Método de roteamento de tráfego por prioridade</span><span class="sxs-lookup"><span data-stu-id="83f35-122"><a name = "priority"></a>Priority traffic-routing method</span></span>

<span data-ttu-id="83f35-123">Frequentemente, as organizações desejam fornecer confiabilidade para seus serviços implantando um ou mais serviços de backup, caso seu serviço primário fique inativo.</span><span class="sxs-lookup"><span data-stu-id="83f35-123">Often an organization wants to provide reliability for its services by deploying one or more backup services in case their primary service goes down.</span></span> <span data-ttu-id="83f35-124">O método de roteamento de tráfego por “Prioridade” permite que os clientes do Azure implementem esse padrão de failover com facilidade.</span><span class="sxs-lookup"><span data-stu-id="83f35-124">The 'Priority' traffic-routing method allows Azure customers to easily implement this failover pattern.</span></span>

![Método de roteamento de tráfego por “Prioridade” do Gerenciador de Tráfego do Azure][1]

<span data-ttu-id="83f35-126">O perfil do Gerenciador de Tráfego contém uma lista priorizada de pontos de extremidade de serviço.</span><span class="sxs-lookup"><span data-stu-id="83f35-126">The Traffic Manager profile contains a prioritized list of service endpoints.</span></span> <span data-ttu-id="83f35-127">Por padrão, o Gerenciador de Tráfego envia todo o tráfego para o ponto de extremidade primário (prioridade mais alta).</span><span class="sxs-lookup"><span data-stu-id="83f35-127">By default, Traffic Manager sends all traffic to the primary (highest-priority) endpoint.</span></span> <span data-ttu-id="83f35-128">Se o ponto de extremidade primário não estiver disponível, o Gerenciador de Tráfego encaminhará o tráfego para o segundo ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="83f35-128">If the primary endpoint is not available, Traffic Manager routes the traffic to the second endpoint.</span></span> <span data-ttu-id="83f35-129">Se os pontos de extremidade primário e secundário não estiverem disponíveis, o tráfego passará para o terceiro e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="83f35-129">If both the primary and secondary endpoints are not available, the traffic goes to the third, and so on.</span></span> <span data-ttu-id="83f35-130">A disponibilidade do ponto de extremidade é baseada no status configurado (habilitado ou desabilitado) e no monitoramento contínuo do ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="83f35-130">Availability of the endpoint is based on the configured status (enabled or disabled) and the ongoing endpoint monitoring.</span></span>

### <a name="configuring-endpoints"></a><span data-ttu-id="83f35-131">Configurando pontos de extremidade</span><span class="sxs-lookup"><span data-stu-id="83f35-131">Configuring endpoints</span></span>

<span data-ttu-id="83f35-132">Com o Azure Resource Manager, você configura a prioridade do ponto de extremidade usando explicitamente a propriedade “priority” para cada ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="83f35-132">With Azure Resource Manager, you configure the endpoint priority explicitly using the 'priority' property for each endpoint.</span></span> <span data-ttu-id="83f35-133">Essa propriedade é um valor entre 1 e 1000.</span><span class="sxs-lookup"><span data-stu-id="83f35-133">This property is a value between 1 and 1000.</span></span> <span data-ttu-id="83f35-134">Valores mais baixos representam uma prioridade mais alta.</span><span class="sxs-lookup"><span data-stu-id="83f35-134">Lower values represent a higher priority.</span></span> <span data-ttu-id="83f35-135">Pontos de extremidade não podem compartilhar os valores de prioridade.</span><span class="sxs-lookup"><span data-stu-id="83f35-135">Endpoints cannot share priority values.</span></span> <span data-ttu-id="83f35-136">A configuração da propriedade é opcional.</span><span class="sxs-lookup"><span data-stu-id="83f35-136">Setting the property is optional.</span></span> <span data-ttu-id="83f35-137">Quando é omitida, uma prioridade padrão baseada na ordem do ponto de extremidade é usada.</span><span class="sxs-lookup"><span data-stu-id="83f35-137">When omitted, a default priority based on the endpoint order is used.</span></span>

##<span data-ttu-id="83f35-138"><a name = "weighted"></a>Método de roteamento de tráfego ponderado</span><span class="sxs-lookup"><span data-stu-id="83f35-138"><a name = "weighted"></a>Weighted traffic-routing method</span></span>
<span data-ttu-id="83f35-139">O método de roteamento de tráfego “Ponderado” permite que você distribua o tráfego de maneira uniforme ou use uma ponderação predefinida.</span><span class="sxs-lookup"><span data-stu-id="83f35-139">The 'Weighted' traffic-routing method allows you to distribute traffic evenly or to use a pre-defined weighting.</span></span>

![Método de roteamento de tráfego “Ponderado” do Gerenciador de Tráfego do Azure][2]

<span data-ttu-id="83f35-141">No método de roteamento de tráfego Ponderado, você atribui um peso a cada ponto de extremidade na configuração do perfil do Gerenciador de Tráfego.</span><span class="sxs-lookup"><span data-stu-id="83f35-141">In the Weighted traffic-routing method, you assign a weight to each endpoint in the Traffic Manager profile configuration.</span></span> <span data-ttu-id="83f35-142">Cada peso é um inteiro de 1 a 1000.</span><span class="sxs-lookup"><span data-stu-id="83f35-142">The weight is an integer from 1 to 1000.</span></span> <span data-ttu-id="83f35-143">Esse parâmetro é opcional.</span><span class="sxs-lookup"><span data-stu-id="83f35-143">This parameter is optional.</span></span> <span data-ttu-id="83f35-144">Se ele for omitido, os Gerenciadores de Tráfego usarão um peso padrão de “1”.</span><span class="sxs-lookup"><span data-stu-id="83f35-144">If omitted, Traffic Managers uses a default weight of '1'.</span></span>

<span data-ttu-id="83f35-145">Para cada consulta DNS recebida, o Gerenciador de Tráfego escolhe aleatoriamente um ponto de extremidade disponível.</span><span class="sxs-lookup"><span data-stu-id="83f35-145">For each DNS query received, Traffic Manager randomly chooses an available endpoint.</span></span> <span data-ttu-id="83f35-146">A probabilidade de escolher um ponto de extremidade baseia-se nos pesos atribuídos a todos os pontos de extremidade disponíveis.</span><span class="sxs-lookup"><span data-stu-id="83f35-146">The probability of choosing an endpoint is based on the weights assigned to all available endpoints.</span></span> <span data-ttu-id="83f35-147">Usar o mesmo peso em todos os pontos de extremidade resulta em uma distribuição uniforme do tráfego.</span><span class="sxs-lookup"><span data-stu-id="83f35-147">Using the same weight across all endpoints results in an even traffic distribution.</span></span> <span data-ttu-id="83f35-148">Usar pesos maiores ou menores em pontos de extremidade específicos faz com que esses pontos de extremidade sejam retornados com maior ou menor frequência nas respostas DNS.</span><span class="sxs-lookup"><span data-stu-id="83f35-148">Using higher or lower weights on specific endpoints causes those endpoints to be returned more or less frequently in the DNS responses.</span></span>

<span data-ttu-id="83f35-149">O método ponderado permite alguns cenários úteis:</span><span class="sxs-lookup"><span data-stu-id="83f35-149">The weighted method enables some useful scenarios:</span></span>

* <span data-ttu-id="83f35-150">Atualização gradual de aplicativo: aloque um percentual do tráfego para roteá-lo para um novo ponto de extremidade e aumentar gradualmente o tráfego até que ele chegue a 100%.</span><span class="sxs-lookup"><span data-stu-id="83f35-150">Gradual application upgrade: Allocate a percentage of traffic to route to a new endpoint, and gradually increase the traffic over time to 100%.</span></span>
* <span data-ttu-id="83f35-151">Migração de aplicativos para o Azure: crie um perfil com pontos de extremidade externos e do Azure.</span><span class="sxs-lookup"><span data-stu-id="83f35-151">Application migration to Azure: Create a profile with both Azure and external endpoints.</span></span> <span data-ttu-id="83f35-152">Ajuste o peso dos pontos de extremidade para dar preferência aos novos pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="83f35-152">Adjust the weight of the endpoints to prefer the new endpoints.</span></span>
* <span data-ttu-id="83f35-153">Estouro de nuvem para capacidade adicional: expanda rapidamente uma implantação local na nuvem colocando-a atrás de um perfil do Gerenciador de Tráfego.</span><span class="sxs-lookup"><span data-stu-id="83f35-153">Cloud-bursting for additional capacity: Quickly expand an on-premises deployment into the cloud by putting it behind a Traffic Manager profile.</span></span> <span data-ttu-id="83f35-154">Quando precisar de capacidade extra na nuvem, você poderá adicionar ou habilitar mais pontos de extremidade e especificar qual parte do tráfego vai para cada ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="83f35-154">When you need extra capacity in the cloud, you can add or enable more endpoints and specify what portion of traffic goes to each endpoint.</span></span>

<span data-ttu-id="83f35-155">O novo portal do Azure do Resource Manager dá suporte à configuração de roteamento de tráfego ponderado.</span><span class="sxs-lookup"><span data-stu-id="83f35-155">The Resource Manager Azure portal supports the configuration of weighted traffic routing.</span></span>  <span data-ttu-id="83f35-156">Você também pode configurar pesos usando as versões do Azure PowerShell, a CLI e as APIs REST do Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="83f35-156">You can configure weights using the Resource Manager versions of Azure PowerShell, CLI, and the REST APIs.</span></span>

<span data-ttu-id="83f35-157">É importante entender que as respostas DNS são armazenadas em cache por clientes e pelos servidores DNS recursivo que os clientes usam para resolver nomes DNS.</span><span class="sxs-lookup"><span data-stu-id="83f35-157">It is important to understand that DNS responses are cached by clients and by the recursive DNS servers that the clients use to resolve DNS names.</span></span> <span data-ttu-id="83f35-158">Esse cache pode ter um impacto nas distribuições de tráfego ponderado.</span><span class="sxs-lookup"><span data-stu-id="83f35-158">This caching can have an impact on weighted traffic distributions.</span></span> <span data-ttu-id="83f35-159">Quando o número de clientes e de servidores DNS recursivo é grande, a distribuição de tráfego funciona conforme esperado.</span><span class="sxs-lookup"><span data-stu-id="83f35-159">When the number of clients and recursive DNS servers is large, traffic distribution works as expected.</span></span> <span data-ttu-id="83f35-160">No entanto, quando o número de clientes ou de servidores DNS recursivo é pequeno, o cache pode distorcer consideravelmente a distribuição de tráfego.</span><span class="sxs-lookup"><span data-stu-id="83f35-160">However, when the number of clients or recursive DNS servers is small, caching can significantly skew the traffic distribution.</span></span>

<span data-ttu-id="83f35-161">Os casos de uso comuns incluem:</span><span class="sxs-lookup"><span data-stu-id="83f35-161">Common use cases include:</span></span>

* <span data-ttu-id="83f35-162">Ambientes de desenvolvimento e teste</span><span class="sxs-lookup"><span data-stu-id="83f35-162">Development and testing environments</span></span>
* <span data-ttu-id="83f35-163">Comunicações de aplicativo para aplicativo</span><span class="sxs-lookup"><span data-stu-id="83f35-163">Application-to-application communications</span></span>
* <span data-ttu-id="83f35-164">Aplicativos voltados para uma base de usuários estreita que compartilha uma infraestrutura comum de DNS recursivo (por exemplo, funcionários de uma empresa que se conectam por meio de um proxy)</span><span class="sxs-lookup"><span data-stu-id="83f35-164">Applications aimed at a narrow user-base that share a common recursive DNS infrastructure (for example, employees of company connecting through a proxy)</span></span>

<span data-ttu-id="83f35-165">Esses efeitos do caching de DNS são comuns a todos os sistemas de roteamento de tráfego baseados em DNS, e não específicos ao Gerenciador de Tráfego do Azure.</span><span class="sxs-lookup"><span data-stu-id="83f35-165">These DNS caching effects are common to all DNS-based traffic routing systems, not just Azure Traffic Manager.</span></span> <span data-ttu-id="83f35-166">Em alguns casos, limpar explicitamente o cache DNS pode fornecer uma solução alternativa.</span><span class="sxs-lookup"><span data-stu-id="83f35-166">In some cases, explicitly clearing the DNS cache may provide a workaround.</span></span> <span data-ttu-id="83f35-167">Em outros casos, um método alternativo de roteamento de tráfego pode ser mais apropriado.</span><span class="sxs-lookup"><span data-stu-id="83f35-167">In other cases, an alternative traffic-routing method may be more appropriate.</span></span>

## <span data-ttu-id="83f35-168"><a name = "performance"></a>Método de roteamento de tráfego por desempenho</span><span class="sxs-lookup"><span data-stu-id="83f35-168"><a name = "performance"></a>Performance traffic-routing method</span></span>

<span data-ttu-id="83f35-169">A implantação de pontos de extremidade em duas ou mais localizações do mundo pode melhorar a capacidade de resposta de vários aplicativos, encaminhando o tráfego para a localização “mais próxima” a você.</span><span class="sxs-lookup"><span data-stu-id="83f35-169">Deploying endpoints in two or more locations across the globe can improve the responsiveness of many applications by routing traffic to the location that is 'closest' to you.</span></span> <span data-ttu-id="83f35-170">O método de roteamento de tráfego por “Desempenho” fornece essa funcionalidade.</span><span class="sxs-lookup"><span data-stu-id="83f35-170">The 'Performance' traffic-routing method provides this capability.</span></span>

![Método de roteamento de tráfego por “Desempenho” do Gerenciador de Tráfego do Azure][3]

<span data-ttu-id="83f35-172">O ponto de extremidade “mais próximo” não é necessariamente o mais próximo em termos de distância geográfica.</span><span class="sxs-lookup"><span data-stu-id="83f35-172">The 'closest' endpoint is not necessarily closest as measured by geographic distance.</span></span> <span data-ttu-id="83f35-173">Em vez disso, o método de roteamento de tráfego por “Desempenho” determina o ponto de extremidade mais próximo medindo a latência de rede.</span><span class="sxs-lookup"><span data-stu-id="83f35-173">Instead, the 'Performance' traffic-routing method determines the closest endpoint by measuring network latency.</span></span> <span data-ttu-id="83f35-174">O Gerenciador de Tráfego mantém uma Tabela de Latência da Internet para controlar o tempo da viagem de ida e volta entre intervalos de endereços IP e em cada data center do Azure.</span><span class="sxs-lookup"><span data-stu-id="83f35-174">Traffic Manager maintains an Internet Latency Table to track the round-trip time between IP address ranges and each Azure datacenter.</span></span>

<span data-ttu-id="83f35-175">O Gerenciador de Tráfego pesquisa o endereço IP de origem da solicitação DNS de entrada na Tabela de Latência da Internet.</span><span class="sxs-lookup"><span data-stu-id="83f35-175">Traffic Manager looks up the source IP address of the incoming DNS request in the Internet Latency Table.</span></span> <span data-ttu-id="83f35-176">O Gerenciador de Tráfego escolhe um ponto de extremidade disponível no data center do Azure que tem a latência mais baixa para esse intervalo de endereços IP e retorna o ponto de extremidade na resposta DNS.</span><span class="sxs-lookup"><span data-stu-id="83f35-176">Traffic Manager chooses an available endpoint in the Azure datacenter that has the lowest latency for that IP address range, then returns that endpoint in the DNS response.</span></span>

<span data-ttu-id="83f35-177">Como explicamos em [Como funciona o Gerenciador de Tráfego](traffic-manager-overview.md#how-traffic-manager-works), o Gerenciador de Tráfego não recebe consultas DNS diretamente de clientes.</span><span class="sxs-lookup"><span data-stu-id="83f35-177">As explained in [How Traffic Manager Works](traffic-manager-overview.md#how-traffic-manager-works), Traffic Manager does not receive DNS queries directly from clients.</span></span> <span data-ttu-id="83f35-178">Em vez disso, as consultas DNS são recebidas do serviço DNS recursivo que os clientes são configurados para usar.</span><span class="sxs-lookup"><span data-stu-id="83f35-178">Rather, DNS queries come from the recursive DNS service that the clients are configured to use.</span></span> <span data-ttu-id="83f35-179">Portanto, o endereço IP usado para determinar o ponto de extremidade “mais próximo” não é o endereço IP do cliente, mas o endereço IP do serviço DNS recursivo.</span><span class="sxs-lookup"><span data-stu-id="83f35-179">Therefore, the IP address used to determine the 'closest' endpoint is not the client's IP address, but it is the IP address of the recursive DNS service.</span></span> <span data-ttu-id="83f35-180">Na prática, esse endereço IP é um bom proxy para o cliente.</span><span class="sxs-lookup"><span data-stu-id="83f35-180">In practice, this IP address is a good proxy for the client.</span></span>


<span data-ttu-id="83f35-181">Regularmente, o Gerenciador de Tráfego atualiza a Tabela de Latência da Internet para verificar se há alterações na Internet global e em novas regiões do Azure.</span><span class="sxs-lookup"><span data-stu-id="83f35-181">Traffic Manager regularly updates the Internet Latency Table to account for changes in the global Internet and new Azure regions.</span></span> <span data-ttu-id="83f35-182">No entanto, o desempenho do aplicativo varia de acordo com as variações em tempo real na carga pela Internet.</span><span class="sxs-lookup"><span data-stu-id="83f35-182">However, application performance varies based on real-time variations in load across the Internet.</span></span> <span data-ttu-id="83f35-183">O roteamento de tráfego por desempenho não monitora a carga em um ponto de extremidade de serviço específico.</span><span class="sxs-lookup"><span data-stu-id="83f35-183">Performance traffic-routing does not monitor load on a given service endpoint.</span></span> <span data-ttu-id="83f35-184">No entanto, se um ponto de extremidade ficar indisponível, o Gerenciador de Tráfego não incluirá isso nas respostas a consultas DNS.</span><span class="sxs-lookup"><span data-stu-id="83f35-184">However, if an endpoint becomes unavailable, Traffic Manager does not include it in DNS query responses.</span></span>


<span data-ttu-id="83f35-185">Pontos a serem observados:</span><span class="sxs-lookup"><span data-stu-id="83f35-185">Points to note:</span></span>

* <span data-ttu-id="83f35-186">Se seu perfil contiver vários pontos de extremidade na mesma região do Azure, o Gerenciador de Tráfego distribuirá o tráfego de maneira uniforme pelos pontos de extremidade disponíveis nessa região.</span><span class="sxs-lookup"><span data-stu-id="83f35-186">If your profile contains multiple endpoints in the same Azure region, then Traffic Manager distributes traffic evenly across the available endpoints in that region.</span></span> <span data-ttu-id="83f35-187">Se preferir uma distribuição de tráfego diferente em uma região, use os [perfis aninhados do Gerenciador de Tráfego](traffic-manager-nested-profiles.md).</span><span class="sxs-lookup"><span data-stu-id="83f35-187">If you prefer a different traffic distribution within a region, you can use [nested Traffic Manager profiles](traffic-manager-nested-profiles.md).</span></span>
* <span data-ttu-id="83f35-188">Se todos os pontos de extremidade habilitados na região do Azure mais próximo estiverem degradados, o Gerenciador de Tráfego moverá o tráfego para os pontos de extremidade na próxima região do Azure mais próxima.</span><span class="sxs-lookup"><span data-stu-id="83f35-188">If all enabled endpoints in the closest Azure region are degraded, Traffic Manager moves traffic to the endpoints in the next closest Azure region.</span></span> <span data-ttu-id="83f35-189">Se desejar definir uma sequência de failover preferencial, use os [perfis aninhados do Gerenciador de Tráfego](traffic-manager-nested-profiles.md).</span><span class="sxs-lookup"><span data-stu-id="83f35-189">If you want to define a preferred failover sequence, use [nested Traffic Manager profiles](traffic-manager-nested-profiles.md).</span></span>
* <span data-ttu-id="83f35-190">Ao usar o método de roteamento de tráfego por Desempenho com pontos de extremidade externos ou aninhados, você precisará especificar a localização desses pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="83f35-190">When using the Performance traffic routing method with external endpoints or nested endpoints, you need to specify the location of those endpoints.</span></span> <span data-ttu-id="83f35-191">Escolha a região do Azure mais próxima de sua implantação.</span><span class="sxs-lookup"><span data-stu-id="83f35-191">Choose the Azure region closest to your deployment.</span></span> <span data-ttu-id="83f35-192">Essas localizações são os valores com suporte na Tabela de Latência da Internet.</span><span class="sxs-lookup"><span data-stu-id="83f35-192">Those locations are the values supported by the Internet Latency Table.</span></span>
* <span data-ttu-id="83f35-193">O algoritmo que escolhe o ponto de extremidade é determinístico.</span><span class="sxs-lookup"><span data-stu-id="83f35-193">The algorithm that chooses the endpoint is deterministic.</span></span> <span data-ttu-id="83f35-194">Consultas DNS repetidas do mesmo cliente são direcionadas ao mesmo ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="83f35-194">Repeated DNS queries from the same client are directed to the same endpoint.</span></span> <span data-ttu-id="83f35-195">Normalmente, os clientes usam servidores DNS recursivo diferentes quando estão viajando.</span><span class="sxs-lookup"><span data-stu-id="83f35-195">Typically, clients use different recursive DNS servers when traveling.</span></span> <span data-ttu-id="83f35-196">O cliente pode ser encaminhado para outro ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="83f35-196">The client may be routed to a different endpoint.</span></span> <span data-ttu-id="83f35-197">O roteamento também pode ser afetado pelas atualizações à Tabela de Latência da Internet.</span><span class="sxs-lookup"><span data-stu-id="83f35-197">Routing can also be affected by updates to the Internet Latency Table.</span></span> <span data-ttu-id="83f35-198">Portanto, o método de roteamento de tráfego por Desempenho não garante que um cliente sempre seja encaminhado para o mesmo ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="83f35-198">Therefore, the Performance traffic-routing method does not guarantee that a client is always routed to the same endpoint.</span></span>
* <span data-ttu-id="83f35-199">Quando a Tabela de Latência da Internet é alterada, você pode observar que alguns clientes foram direcionados para um ponto de extremidade diferente.</span><span class="sxs-lookup"><span data-stu-id="83f35-199">When the Internet Latency Table changes, you may notice that some clients are directed to a different endpoint.</span></span> <span data-ttu-id="83f35-200">Essa alteração de roteamento é mais precisa com base nos dados de latência atuais.</span><span class="sxs-lookup"><span data-stu-id="83f35-200">This routing change is more accurate based on current latency data.</span></span> <span data-ttu-id="83f35-201">Essas atualizações são essenciais para manter a precisão do roteamento de tráfego por Desempenho à medida que a Internet evolui continuamente.</span><span class="sxs-lookup"><span data-stu-id="83f35-201">These updates are essential to maintain the accuracy of Performance traffic-routing as the Internet continually evolves.</span></span>

## <span data-ttu-id="83f35-202"><a name = "geographic"></a>Método de roteamento de tráfego geográfico</span><span class="sxs-lookup"><span data-stu-id="83f35-202"><a name = "geographic"></a>Geographic traffic-routing method</span></span>

<span data-ttu-id="83f35-203">Os perfis do Gerenciador de Tráfego podem ser configurados para usar o método de roteamento geográfico de modo que os usuários sejam direcionados para pontos de extremidade específicos (Azure, Externo ou Aninhado) com base no local geográfico em que as respectivas consultas DNS são originadas.</span><span class="sxs-lookup"><span data-stu-id="83f35-203">Traffic Manager profiles can be configured to use the Geographic routing method so that users are directed to specific endpoints (Azure, External or Nested) based on which geographic location their DNS query originates from.</span></span> <span data-ttu-id="83f35-204">Isso permite que os clientes do Gerenciador de Tráfego habilitem cenários em que saber a região geográfica de um usuário e roteá-lo com base nela é importante.</span><span class="sxs-lookup"><span data-stu-id="83f35-204">This empowers Traffic Manager customers to enable scenarios where knowing a user’s geographic region and routing them based on that is important.</span></span> <span data-ttu-id="83f35-205">Os exemplos incluem conformidade com normas de soberania de dados, localização de conteúdo e experiência do usuário, bem como medição do tráfego de diferentes regiões.</span><span class="sxs-lookup"><span data-stu-id="83f35-205">Examples include complying with data sovereignty mandates, localization of content & user experience and measuring traffic from different regions.</span></span>
<span data-ttu-id="83f35-206">Quando um perfil é configurado para roteamento geográfico, cada ponto de extremidade associado a esse perfil precisa ter um conjunto de regiões geográficas atribuído a ele.</span><span class="sxs-lookup"><span data-stu-id="83f35-206">When a profile is configured for geographic routing, each endpoint associated with that profile needs to have a set of geographic regions assigned to it.</span></span> <span data-ttu-id="83f35-207">Uma região geográfica pode estar nos seguintes níveis de granularidade</span><span class="sxs-lookup"><span data-stu-id="83f35-207">A geographic region can be at following levels of granularity</span></span> 
- <span data-ttu-id="83f35-208">Mundo – qualquer região</span><span class="sxs-lookup"><span data-stu-id="83f35-208">World– any region</span></span>
- <span data-ttu-id="83f35-209">Agrupamento Regional – por exemplo, África, Oriente Médio, Austrália/Pacífico etc.</span><span class="sxs-lookup"><span data-stu-id="83f35-209">Regional Grouping – for example, Africa, Middle East, Australia/Pacific etc.</span></span> 
- <span data-ttu-id="83f35-210">País/região – por exemplo, Irlanda, Peru, RAE de Hong Kong etc.</span><span class="sxs-lookup"><span data-stu-id="83f35-210">Country/Region – for example, Ireland, Peru, Hong Kong SAR etc.</span></span> 
- <span data-ttu-id="83f35-211">Estado/Província – por exemplo, EUA-Califórnia, Austrália-Queensland, Canadá-Alberta etc. (observação: esse nível de granularidade conta com suporte apenas em Estados/províncias da Austrália, do Canadá, do Reino Unido e dos EUA).</span><span class="sxs-lookup"><span data-stu-id="83f35-211">State/Province – for example, USA-California, Australia-Queensland, Canada-Alberta etc. (note: this granularity level is supported only for states / provinces in Australia, Canada, UK, and USA).</span></span>

<span data-ttu-id="83f35-212">Quando uma região ou um conjunto de regiões é atribuído a um ponto de extremidade, todas as solicitações dessas regiões são roteadas apenas para esse ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="83f35-212">When a region or a set of regions is assigned to an endpoint, any requests from those regions gets routed only to that endpoint.</span></span> <span data-ttu-id="83f35-213">O Gerenciador de Tráfego usa o endereço IP de origem da consulta DNS para determinar a região da qual um usuário está consultando. Em geral, será o endereço IP do resolvedor DNS local que está fazendo a consulta em nome do usuário.</span><span class="sxs-lookup"><span data-stu-id="83f35-213">Traffic Manager uses the source IP address of the DNS query to determine the region from which a user is querying from – usually this is the IP address of the local DNS resolver doing the query on behalf of the user.</span></span>  

![Método de roteamento de tráfego "Geográfico" do Gerenciador de Tráfego do Azure](./media/traffic-manager-routing-methods/geographic.png)

<span data-ttu-id="83f35-215">O Gerenciador de Tráfego lê o endereço IP de origem da consulta DNS e decide de qual região geográfica ela se origina.</span><span class="sxs-lookup"><span data-stu-id="83f35-215">Traffic Manager reads the source IP address of the DNS query and decides which geographic region it is originating from.</span></span> <span data-ttu-id="83f35-216">Ele então verifica se há um ponto de extremidade com essa região geográfica mapeada para ele.</span><span class="sxs-lookup"><span data-stu-id="83f35-216">It then looks to see if there is an endpoint that has this geographic region mapped to it.</span></span> <span data-ttu-id="83f35-217">Essa pesquisa começa no nível mais baixo de granularidade (Estado/Província em que tem suporte, do contrário, no nível de País/Região) e percorre todo o caminho até o nível mais alto, que é **Mundo**.</span><span class="sxs-lookup"><span data-stu-id="83f35-217">This lookup starts at the lowest granularity level (State/Province where it is supported, else at the Country/Region level) and goes all the way up to the highest level, which is **World**.</span></span> <span data-ttu-id="83f35-218">A primeira correspondência encontrada que usa essa passagem será designada como o ponto de extremidade para retorno na resposta da consulta.</span><span class="sxs-lookup"><span data-stu-id="83f35-218">The first match found using this traversal is designated as the endpoint to return in the query response.</span></span> <span data-ttu-id="83f35-219">Quando houver correspondência com um ponto de extremidade do tipo Aninhado, um ponto de extremidade nesse perfil filho será retornado, com base em seu método de roteamento.</span><span class="sxs-lookup"><span data-stu-id="83f35-219">When matching with a Nested type endpoint, an endpoint within that child profile is returned, based on its routing method.</span></span> <span data-ttu-id="83f35-220">Os seguintes pontos se aplicam a esse comportamento:</span><span class="sxs-lookup"><span data-stu-id="83f35-220">The following points are applicable to this behavior:</span></span>

- <span data-ttu-id="83f35-221">Uma região geográfica poderá ser mapeada apenas para um ponto de extremidade em um perfil do Gerenciador de Tráfego quando o tipo de roteamento for Roteamento Geográfico.</span><span class="sxs-lookup"><span data-stu-id="83f35-221">A geographic region can be mapped only to one endpoint in a Traffic Manager profile when the routing type is Geographic Routing.</span></span> <span data-ttu-id="83f35-222">Isso garante que o roteamento dos usuários seja determinístico e que os clientes possam habilitar cenários que exijam limites geográficos inequívocos.</span><span class="sxs-lookup"><span data-stu-id="83f35-222">This ensures that routing of users is deterministic, and customers can enable scenarios that require unambiguous geographic boundaries.</span></span>
- <span data-ttu-id="83f35-223">Se a região de um usuário estiver sob mapeamento geográficos de dois pontos de extremidade diferentes, o Gerenciador de Tráfego selecionará o ponto de extremidade com a granularidade mais baixa e não considerará as solicitações de roteamento dessa região para o outro ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="83f35-223">If a user’s region comes under two different endpoints’ geographic mapping, Traffic Manager selects the endpoint with the lowest granularity and does not consider routing requests from that region to the other endpoint.</span></span> <span data-ttu-id="83f35-224">Por exemplo, considere um perfil de tipo de Roteamento Geográfico com dois pontos de extremidade: Ponto de Extremidade 1 e Ponto de Extremidade 2.</span><span class="sxs-lookup"><span data-stu-id="83f35-224">For example, consider a Geographic Routing type profile with two endpoints - Endpoint1 and Endpoint2.</span></span> <span data-ttu-id="83f35-225">O Ponto de Extremidade 1 está configurado para receber tráfego da Irlanda e o Ponto de Extremidade 2 está configurado para receber tráfego da Europa.</span><span class="sxs-lookup"><span data-stu-id="83f35-225">Endpoint1 is configured to receive traffic from Ireland and Endpoint2 is configured to receive traffic from Europe.</span></span> <span data-ttu-id="83f35-226">Se uma solicitação for originada da Irlanda, ela sempre será roteada para o Ponto de Extremidade 1.</span><span class="sxs-lookup"><span data-stu-id="83f35-226">If a request originates from Ireland, it is always routed to Endpoint1.</span></span>
- <span data-ttu-id="83f35-227">Uma que uma região pode ser mapeada apenas para um ponto de extremidade, o Gerenciador de Tráfego a retornará, independentemente de o ponto de extremidade estar íntegro ou não.</span><span class="sxs-lookup"><span data-stu-id="83f35-227">Since a region can be mapped only to one endpoint, Traffic Manager returns it regardless of whether the endpoint is healthy or not.</span></span>

    >[!IMPORTANT]
    ><span data-ttu-id="83f35-228">É enfaticamente recomendado que os clientes que usem o método de roteamento geográfico o associem aos pontos de extremidade do tipo Aninhado com perfis filho contendo pelo menos dois pontos de extremidade cada.</span><span class="sxs-lookup"><span data-stu-id="83f35-228">It is strongly recommended that customers using the geographic routing method associate it with the Nested type endpoints that has child profiles containing at least two endpoints within each.</span></span>
- <span data-ttu-id="83f35-229">Se for encontrada uma correspondência de ponto de extremidade e esse ponto de extremidade estiver no estado **Parado** o Gerenciador de Tráfego retornará uma resposta NODATA.</span><span class="sxs-lookup"><span data-stu-id="83f35-229">If an endpoint match is found and that endpoint is in the **Stopped** state, Traffic Manager returns a NODATA response.</span></span> <span data-ttu-id="83f35-230">Nesse caso, mais nenhuma pesquisa será feita acima na hierarquia da região geográfica.</span><span class="sxs-lookup"><span data-stu-id="83f35-230">In this case, no further lookups is made higher up in the geographic region hierarchy.</span></span> <span data-ttu-id="83f35-231">Esse comportamento também vale para tipos de ponto de extremidade aninhados quando o perfil filho está no estado **Parado** ou **Desabilitado**.</span><span class="sxs-lookup"><span data-stu-id="83f35-231">This behavior is also applicable for nested endpoint types when the child profile is in the **Stopped** or **Disabled** state.</span></span>
- <span data-ttu-id="83f35-232">Se um ponto de extremidade exibir o status **Desabilitado**, ele não será incluído no processo de correspondência de região.</span><span class="sxs-lookup"><span data-stu-id="83f35-232">If an endpoint displays a **Disabled** status, it won’t be included in the region matching process.</span></span> <span data-ttu-id="83f35-233">Esse comportamento também vale para tipos de ponto de ponto de extremidade aninhados quando o ponto de extremidade está no estado **Desabilitado**.</span><span class="sxs-lookup"><span data-stu-id="83f35-233">This behavior is also applicable for nested endpoint types when the endpoint is in the **Disabled** state.</span></span>
- <span data-ttu-id="83f35-234">Se uma consulta estiver vindo proveniente de uma região geográfica que não tenha mapeamento no perfil, o Gerenciador de Tráfego retornará uma resposta NODATA.</span><span class="sxs-lookup"><span data-stu-id="83f35-234">If a query is coming from a geographic region that has no mapping in that profile, Traffic Manager returns a NODATA response.</span></span> <span data-ttu-id="83f35-235">Portanto, é enfaticamente aconselhável que os clientes que usem roteamento geográfico com um ponto de extremidade, idealmente do tipo Aninhado com pelo menos dois pontos de extremidade no perfil filho, com a região **Mundo** atribuída a ele.</span><span class="sxs-lookup"><span data-stu-id="83f35-235">Therefore, it is strongly recommended that customers use geographic routing with one endpoint, ideally of type Nested with at least two endpoints within the child profile, with the region **World** assigned to it.</span></span> <span data-ttu-id="83f35-236">Isso também garante que os endereços IP que não são mapeados para uma região sejam manipulados.</span><span class="sxs-lookup"><span data-stu-id="83f35-236">This also ensures that any IP addresses that do not map to a region are handled.</span></span>

<span data-ttu-id="83f35-237">Como explicamos em [Como funciona o Gerenciador de Tráfego](traffic-manager-how-traffic-manager-works.md), o Gerenciador de Tráfego não recebe consultas DNS diretamente de clientes.</span><span class="sxs-lookup"><span data-stu-id="83f35-237">As explained in [How Traffic Manager Works](traffic-manager-how-traffic-manager-works.md), Traffic Manager does not receive DNS queries directly from clients.</span></span> <span data-ttu-id="83f35-238">Em vez disso, as consultas DNS são recebidas do serviço DNS recursivo que os clientes são configurados para usar.</span><span class="sxs-lookup"><span data-stu-id="83f35-238">Rather, DNS queries come from the recursive DNS service that the clients are configured to use.</span></span> <span data-ttu-id="83f35-239">Portanto, o endereço IP usado para determinar a região não é o endereço IP do cliente, mas o endereço IP do serviço DNS recursivo.</span><span class="sxs-lookup"><span data-stu-id="83f35-239">Therefore, the IP address used to determine the region is not the client's IP address, but it is the IP address of the recursive DNS service.</span></span> <span data-ttu-id="83f35-240">Na prática, esse endereço IP é um bom proxy para o cliente.</span><span class="sxs-lookup"><span data-stu-id="83f35-240">In practice, this IP address is a good proxy for the client.</span></span>


## <a name="next-steps"></a><span data-ttu-id="83f35-241">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="83f35-241">Next steps</span></span>

<span data-ttu-id="83f35-242">Aprenda a desenvolver aplicativos de alta disponibilidade usando o [monitoramento de ponto de extremidade do Gerenciador de Tráfego](traffic-manager-monitoring.md)</span><span class="sxs-lookup"><span data-stu-id="83f35-242">Learn how to develop high-availability applications using [Traffic Manager endpoint monitoring](traffic-manager-monitoring.md)</span></span>

<span data-ttu-id="83f35-243">Aprenda a [criar um perfil do Gerenciador de Tráfego](traffic-manager-create-profile.md)</span><span class="sxs-lookup"><span data-stu-id="83f35-243">Learn how to [create a Traffic Manager profile](traffic-manager-create-profile.md)</span></span>

<!--Image references-->
[1]: ./media/traffic-manager-routing-methods/priority.png
[2]: ./media/traffic-manager-routing-methods/weighted.png
[3]: ./media/traffic-manager-routing-methods/performance.png



