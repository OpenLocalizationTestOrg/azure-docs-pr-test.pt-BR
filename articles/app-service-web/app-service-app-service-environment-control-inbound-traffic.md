---
title: "Como controlar o tráfego de entrada para um ambiente de serviço de aplicativo"
description: "Saiba mais sobre como configurar regras de segurança de rede para controlar o tráfego de entrada para um ambiente de serviço de aplicativo."
services: app-service
documentationcenter: 
author: ccompy
manager: erikre
editor: 
ms.assetid: 4cc82439-8791-48a4-9485-de6d8e1d1a08
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/11/2017
ms.author: stefsch
ms.openlocfilehash: ee0a2248a1cd5d76f87b280de05410b94f96c8af
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="how-to-control-inbound-traffic-to-an-app-service-environment"></a><span data-ttu-id="20c0f-103">Como controlar o tráfego de entrada para um ambiente de serviço de aplicativo</span><span class="sxs-lookup"><span data-stu-id="20c0f-103">How To Control Inbound Traffic to an App Service Environment</span></span>
## <a name="overview"></a><span data-ttu-id="20c0f-104">Visão geral</span><span class="sxs-lookup"><span data-stu-id="20c0f-104">Overview</span></span>
<span data-ttu-id="20c0f-105">Um Ambiente de Serviço de Aplicativo pode ser criado **tanto** em uma rede virtual do Azure Resource Manager, **quanto** em uma [rede virtual][virtualnetwork] de modelo de implantação clássico.</span><span class="sxs-lookup"><span data-stu-id="20c0f-105">An App Service Environment can be created in **either** an Azure Resource Manager virtual network, **or** a classic deployment model [virtual network][virtualnetwork].</span></span>  <span data-ttu-id="20c0f-106">Uma nova rede virtual e uma nova sub-rede podem ser definidas no momento em que um Ambiente de Serviço de Aplicativo é criado.</span><span class="sxs-lookup"><span data-stu-id="20c0f-106">A new virtual network and new subnet can be defined at the time an App Service Environment is created.</span></span>  <span data-ttu-id="20c0f-107">Como alternativa, um Ambiente de Serviço de Aplicativo pode ser criado em uma rede virtual e uma sub-rede existentes.</span><span class="sxs-lookup"><span data-stu-id="20c0f-107">Alternatively, an App Service Environment can be created in a pre-existing virtual network and pre-existing subnet.</span></span>  <span data-ttu-id="20c0f-108">Com uma alteração feita em junho de 2016, os ASEs agora podem ser implantados nas redes virtuais que usam os intervalos de endereço públicos ou espaços de endereço RFC1918 (ou seja,</span><span class="sxs-lookup"><span data-stu-id="20c0f-108">With a change made in June 2016, ASEs can also be deployed into virtual networks that use either public address ranges, or RFC1918 address spaces (i.e.</span></span> <span data-ttu-id="20c0f-109">endereços privados).</span><span class="sxs-lookup"><span data-stu-id="20c0f-109">private addresses).</span></span>  <span data-ttu-id="20c0f-110">Para saber mais sobre a criação de um Ambiente de Serviço de Aplicativo, veja [Como criar um ambiente de serviço de aplicativo][HowToCreateAnAppServiceEnvironment].</span><span class="sxs-lookup"><span data-stu-id="20c0f-110">For more details on creating an App Service Environment see [How To Create an App Service Environment][HowToCreateAnAppServiceEnvironment].</span></span>

<span data-ttu-id="20c0f-111">Um ambiente de serviço de aplicativo sempre deve ser criado em uma sub-rede, porque uma sub-rede fornece um limite de rede que pode ser usado para bloquear o tráfego de entrada por trás de dispositivos e serviços de upstream, de modo que o tráfego HTTP e HTTPS é aceito apenas de endereços IP upstream específicos.</span><span class="sxs-lookup"><span data-stu-id="20c0f-111">An App Service Environment must always be created within a subnet because a subnet provides a network boundary which can be used to lock down inbound traffic behind upstream devices and services such that HTTP and HTTPS traffic is only accepted from specific upstream IP addresses.</span></span>

<span data-ttu-id="20c0f-112">O tráfego de rede de entrada e saída em uma sub-rede é controlado usando um [grupo de segurança de rede][NetworkSecurityGroups].</span><span class="sxs-lookup"><span data-stu-id="20c0f-112">Inbound and outbound network traffic on a subnet is controlled using a [network security group][NetworkSecurityGroups].</span></span> <span data-ttu-id="20c0f-113">Controlar o tráfego de entrada requer a criação de regras de segurança de rede em um grupo de segurança de rede, seguida da atribuição do grupo de segurança de rede à sub-rede que contém o ambiente de serviço de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="20c0f-113">Controlling inbound traffic requires creating network security rules in a network security group, and then assigning the network security group the subnet containing the App Service Environment.</span></span>

<span data-ttu-id="20c0f-114">Quando um grupo de segurança de rede é atribuído a uma sub-rede, o tráfego de entrada para aplicativos no ambiente de serviço de aplicativo é permitido/bloqueado com base em regras de permissão e bloqueio definidas no grupo de segurança de rede.</span><span class="sxs-lookup"><span data-stu-id="20c0f-114">Once a network security group is assigned to a subnet, inbound traffic to apps in the App Service Environment is allowed/blocked based on the allow and deny rules defined in the network security group.</span></span>

[!INCLUDE [app-service-web-to-api-and-mobile](../../includes/app-service-web-to-api-and-mobile.md)]

## <a name="inbound-network-ports-used-in-an-app-service-environment"></a><span data-ttu-id="20c0f-115">Portas de entrada de rede usadas em um Ambiente de Serviço de Aplicativo</span><span class="sxs-lookup"><span data-stu-id="20c0f-115">Inbound Network Ports Used in an App Service Environment</span></span>
<span data-ttu-id="20c0f-116">Antes de bloquear o tráfego de rede de entrada com um grupo de segurança de rede, é importante saber o conjunto de portas de rede requeridas e opcionais usadas por um ambiente de serviço de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="20c0f-116">Before locking down inbound network traffic with a network security group, it is important to know the set of required and optional network ports used by an App Service Environment.</span></span>  <span data-ttu-id="20c0f-117">Fechar acidentalmente o tráfego para algumas portas pode resultar em perda de funcionalidade em um ambiente de serviço de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="20c0f-117">Accidentally closing off traffic to some ports can result in loss of functionality in an App Service Environment.</span></span>

<span data-ttu-id="20c0f-118">A seguir está uma lista de portas usadas por um Ambiente de Serviço de Aplicativo.</span><span class="sxs-lookup"><span data-stu-id="20c0f-118">The following is a list of ports used by an App Service Environment.</span></span> <span data-ttu-id="20c0f-119">Todas as portas são **TCP**, a menos que indicado o claramente contrário:</span><span class="sxs-lookup"><span data-stu-id="20c0f-119">All ports are **TCP**, unless otherwise clearly noted:</span></span>

* <span data-ttu-id="20c0f-120">454: **Porta requerida** usada pela infraestrutura do Azure para gerenciamento e manutenção de Ambientes de Serviço de Aplicativo via SSL.</span><span class="sxs-lookup"><span data-stu-id="20c0f-120">454:  **Required port** used by Azure infrastructure for managing and maintaining App Service Environments via SSL.</span></span>  <span data-ttu-id="20c0f-121">Não bloqueie o tráfego para essa porta.</span><span class="sxs-lookup"><span data-stu-id="20c0f-121">Do not block traffic to this port.</span></span>  <span data-ttu-id="20c0f-122">Essa porta é sempre associada ao VIP público de um ASE.</span><span class="sxs-lookup"><span data-stu-id="20c0f-122">This port is always bound to the public VIP of an ASE.</span></span>
* <span data-ttu-id="20c0f-123">455: **Porta requerida** usada pela infraestrutura do Azure para gerenciamento e manutenção de Ambientes de Serviço de Aplicativo via SSL.</span><span class="sxs-lookup"><span data-stu-id="20c0f-123">455:  **Required port** used by Azure infrastructure for managing and maintaining App Service Environments via SSL.</span></span>  <span data-ttu-id="20c0f-124">Não bloqueie o tráfego para essa porta.</span><span class="sxs-lookup"><span data-stu-id="20c0f-124">Do not block traffic to this port.</span></span>  <span data-ttu-id="20c0f-125">Essa porta é sempre associada ao VIP público de um ASE.</span><span class="sxs-lookup"><span data-stu-id="20c0f-125">This port is always bound to the public VIP of an ASE.</span></span>
* <span data-ttu-id="20c0f-126">80: porta padrão para tráfego HTTP de entrada para aplicativos executados em Planos de Serviço de Aplicativo em um Ambiente de Serviço de Aplicativo.</span><span class="sxs-lookup"><span data-stu-id="20c0f-126">80:  Default port for inbound HTTP traffic to apps running in App Service Plans in an App Service Environment.</span></span>  <span data-ttu-id="20c0f-127">Em um ASE habilitado para ILB, essa porta é associada ao endereço ILB do ASE.</span><span class="sxs-lookup"><span data-stu-id="20c0f-127">On an ILB-enabled ASE, this port is bound to the ILB address of the ASE.</span></span>
* <span data-ttu-id="20c0f-128">443: porta padrão para tráfego SSL de entrada para aplicativos executados em Planos de Serviço de Aplicativo em um Ambiente de Serviço de Aplicativo.</span><span class="sxs-lookup"><span data-stu-id="20c0f-128">443: Default port for inbound SSL traffic to apps running in App Service Plans in an App Service Environment.</span></span>  <span data-ttu-id="20c0f-129">Em um ASE habilitado para ILB, essa porta é associada ao endereço ILB do ASE.</span><span class="sxs-lookup"><span data-stu-id="20c0f-129">On an ILB-enabled ASE, this port is bound to the ILB address of the ASE.</span></span>
* <span data-ttu-id="20c0f-130">21: canal de controle para FTP.</span><span class="sxs-lookup"><span data-stu-id="20c0f-130">21:  Control channel for FTP.</span></span>  <span data-ttu-id="20c0f-131">Essa porta pode ser bloqueada com segurança se o FTP não está sendo usado.</span><span class="sxs-lookup"><span data-stu-id="20c0f-131">This port can be safely blocked if FTP is not being used.</span></span>  <span data-ttu-id="20c0f-132">Em um ASE habilitado para ILB, essa porta pode ser associada ao endereço ILB de um ASE.</span><span class="sxs-lookup"><span data-stu-id="20c0f-132">On an ILB-enabled ASE, this port can be bound to the ILB address for an ASE.</span></span>
* <span data-ttu-id="20c0f-133">990: canal de controle para FTPS.</span><span class="sxs-lookup"><span data-stu-id="20c0f-133">990:  Control channel for FTPS.</span></span>  <span data-ttu-id="20c0f-134">Essa porta poderá ser bloqueada com segurança se o FTPS não estiver sendo usado.</span><span class="sxs-lookup"><span data-stu-id="20c0f-134">This port can be safely blocked if FTPS is not being used.</span></span>  <span data-ttu-id="20c0f-135">Em um ASE habilitado para ILB, essa porta pode ser associada ao endereço ILB de um ASE.</span><span class="sxs-lookup"><span data-stu-id="20c0f-135">On an ILB-enabled ASE, this port can be bound to the ILB address for an ASE.</span></span>
* <span data-ttu-id="20c0f-136">10001-10020: canais de dados para FTP.</span><span class="sxs-lookup"><span data-stu-id="20c0f-136">10001-10020: Data channels for FTP.</span></span>  <span data-ttu-id="20c0f-137">Assim como acontece com o canal de controle, essas portas podem ser bloqueadas com segurança se o FTP não estiver sendo usado.</span><span class="sxs-lookup"><span data-stu-id="20c0f-137">As with the control channel, these ports can be safely blocked if FTP is not being used.</span></span>  <span data-ttu-id="20c0f-138">Em um ASE habilitado para ILB, essa porta pode ser associada ao endereço ILB do ASE.</span><span class="sxs-lookup"><span data-stu-id="20c0f-138">On an ILB-enabled ASE, this port can be bound to the ASE's ILB address.</span></span>
* <span data-ttu-id="20c0f-139">4016: usado para depuração remota com o Visual Studio 2012.</span><span class="sxs-lookup"><span data-stu-id="20c0f-139">4016: Used for remote debugging with Visual Studio 2012.</span></span>  <span data-ttu-id="20c0f-140">Essa porta pode ser bloqueada com segurança se o recurso não está sendo usado.</span><span class="sxs-lookup"><span data-stu-id="20c0f-140">This port can be safely blocked if the feature is not being used.</span></span>  <span data-ttu-id="20c0f-141">Em um ASE habilitado para ILB, essa porta é associada ao endereço ILB do ASE.</span><span class="sxs-lookup"><span data-stu-id="20c0f-141">On an ILB-enabled ASE, this port is bound to the ILB address of the ASE.</span></span>
* <span data-ttu-id="20c0f-142">4018: usado para depuração remota com o Visual Studio 2013.</span><span class="sxs-lookup"><span data-stu-id="20c0f-142">4018: Used for remote debugging with Visual Studio 2013.</span></span>  <span data-ttu-id="20c0f-143">Essa porta pode ser bloqueada com segurança se o recurso não está sendo usado.</span><span class="sxs-lookup"><span data-stu-id="20c0f-143">This port can be safely blocked if the feature is not being used.</span></span>  <span data-ttu-id="20c0f-144">Em um ASE habilitado para ILB, essa porta é associada ao endereço ILB do ASE.</span><span class="sxs-lookup"><span data-stu-id="20c0f-144">On an ILB-enabled ASE, this port is bound to the ILB address of the ASE.</span></span>
* <span data-ttu-id="20c0f-145">4020: usado para depuração remota com o Visual Studio 2015.</span><span class="sxs-lookup"><span data-stu-id="20c0f-145">4020: Used for remote debugging with Visual Studio 2015.</span></span>  <span data-ttu-id="20c0f-146">Essa porta pode ser bloqueada com segurança se o recurso não está sendo usado.</span><span class="sxs-lookup"><span data-stu-id="20c0f-146">This port can be safely blocked if the feature is not being used.</span></span>  <span data-ttu-id="20c0f-147">Em um ASE habilitado para ILB, essa porta é associada ao endereço ILB do ASE.</span><span class="sxs-lookup"><span data-stu-id="20c0f-147">On an ILB-enabled ASE, this port is bound to the ILB address of the ASE.</span></span>

## <a name="outbound-connectivity-and-dns-requirements"></a><span data-ttu-id="20c0f-148">Requisitos de DNS e conectividade de saída</span><span class="sxs-lookup"><span data-stu-id="20c0f-148">Outbound Connectivity and DNS Requirements</span></span>
<span data-ttu-id="20c0f-149">Para que um Ambiente de Serviço de Aplicativo funcione corretamente, ele requer acesso de saída a vários pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="20c0f-149">For an App Service Environment to function properly, it also requires outbound access to various endpoints.</span></span> <span data-ttu-id="20c0f-150">Uma lista completa dos pontos de extremidade externos usado por um ASE está na seção "Conectividade de rede necessária" do artigo [Configuração de rede para o ExpressRoute](app-service-app-service-environment-network-configuration-expressroute.md#required-network-connectivity) .</span><span class="sxs-lookup"><span data-stu-id="20c0f-150">A full list of the external endpoints used by an ASE is in the "Required Network Connectivity" section of the [Network Configuration for ExpressRoute](app-service-app-service-environment-network-configuration-expressroute.md#required-network-connectivity) article.</span></span>

<span data-ttu-id="20c0f-151">Ambientes de Serviço de Aplicativo exigem uma infraestrutura DNS válida configurada para a rede virtual.</span><span class="sxs-lookup"><span data-stu-id="20c0f-151">App Service Environments require a valid DNS infrastructure configured for the virtual network.</span></span>  <span data-ttu-id="20c0f-152">Se por algum motivo, a configuração do DNS for alterada após ter sido criado um Ambiente do Serviço de Aplicativo, os desenvolvedores podem forçar um Ambiente do Serviço de Aplicativo para captar a nova configuração de DNS.</span><span class="sxs-lookup"><span data-stu-id="20c0f-152">If for any reason the DNS configuration is changed after an App Service Environment has been created, developers can force an App Service Environment to pick up the new DNS configuration.</span></span>  <span data-ttu-id="20c0f-153">Acionar uma reinicialização do ambiente sem interrupção usando o ícone "Reiniciar" localizado na parte superior da folha de gerenciamento do Ambiente de Serviço de Aplicativo no [Portal do Azure][NewPortal] fará com que o ambiente capture a nova configuração de DNS.</span><span class="sxs-lookup"><span data-stu-id="20c0f-153">Triggering a rolling environment reboot using the "Restart" icon located at the top of the App Service Environment management blade in the [Azure portal][NewPortal] will cause the environment to pick up the new DNS configuration.</span></span>

<span data-ttu-id="20c0f-154">Também é recomendável que todos os servidores DNS personalizados na rede virtual sejam configurados com antecedência antes da criação de um ambiente do Serviço de Aplicativo.</span><span class="sxs-lookup"><span data-stu-id="20c0f-154">It is also recommended that any custom DNS servers on the vnet be setup ahead of time prior to creating an App Service Environment.</span></span>  <span data-ttu-id="20c0f-155">Se a configuração DNS de uma rede virtual for alterada enquanto um Ambiente de Serviço de Aplicativo estiver sendo criado, isso resultará em falha do processo de criação do Ambiente de Serviço de Aplicativo.</span><span class="sxs-lookup"><span data-stu-id="20c0f-155">If a virtual network's DNS configuration is changed while an App Service Environment is being created, that will result in the App Service Environment creation process failing.</span></span>  <span data-ttu-id="20c0f-156">Do mesmo modo, se um servidor DNS personalizado existir na outra extremidade de um gateway de VPN e estiver inacessível ou indisponível, o processo de criação do Ambiente do Serviço de Aplicativo também falhará.</span><span class="sxs-lookup"><span data-stu-id="20c0f-156">In a similar vein, if a custom DNS server exists on the other end of a VPN gateway, and the DNS server is unreachable or unavailable, the App Service Environment creation process will also fail.</span></span>

## <a name="creating-a-network-security-group"></a><span data-ttu-id="20c0f-157">Criando um grupo de segurança de rede</span><span class="sxs-lookup"><span data-stu-id="20c0f-157">Creating a Network Security Group</span></span>
<span data-ttu-id="20c0f-158">Para saber mais sobre como funcionam os grupos de segurança de rede, veja as seguintes [informações][NetworkSecurityGroups].</span><span class="sxs-lookup"><span data-stu-id="20c0f-158">For full details on how network security groups work see the following [information][NetworkSecurityGroups].</span></span>  <span data-ttu-id="20c0f-159">O exemplo de Gerenciamento do Serviço do Azure abaixo mostra alguns destaques sobre os grupos de segurança de rede, concentrando-se em como configurar e aplicar um grupo de segurança de rede a uma sub-rede que contém um Ambiente de Serviço de Aplicativo.</span><span class="sxs-lookup"><span data-stu-id="20c0f-159">The Azure Service Management example below touches on highlights of network security groups, with a focus on configuring and applying a network security group to a subnet that contains an App Service Environment.</span></span>

<span data-ttu-id="20c0f-160">**Observação:** os grupos de segurança de rede podem ser configurados graficamente usando o [Portal do Azure](https://portal.azure.com) ou por meio do Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="20c0f-160">**Note:** Network security groups can be configured graphically using the [Azure Portal](https://portal.azure.com) or through Azure PowerShell.</span></span>

<span data-ttu-id="20c0f-161">Grupos de segurança de rede são criados pela primeira vez como uma entidade autônoma associada a uma assinatura.</span><span class="sxs-lookup"><span data-stu-id="20c0f-161">Network security groups are first created as a standalone entity associated with a subscription.</span></span> <span data-ttu-id="20c0f-162">Como os grupos de segurança de rede são criados em uma região do Azure, certifique-se de que o grupo de segurança de rede é criado na mesma região que o ambiente de serviço de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="20c0f-162">Since network security groups are created in an Azure region, ensure that the network security group is created in the same region as the App Service Environment.</span></span>

<span data-ttu-id="20c0f-163">A seguir, demonstra-se como criar um grupo de segurança de rede:</span><span class="sxs-lookup"><span data-stu-id="20c0f-163">The following demonstrates creating a network security group:</span></span>

    New-AzureNetworkSecurityGroup -Name "testNSGexample" -Location "South Central US" -Label "Example network security group for an app service environment"

<span data-ttu-id="20c0f-164">Depois de um grupo de segurança de rede ter sido criado, uma ou mais regras de segurança de rede são adicionadas a ele.</span><span class="sxs-lookup"><span data-stu-id="20c0f-164">Once a network security group is created, one or more network security rules are added to it.</span></span>  <span data-ttu-id="20c0f-165">Já que o conjunto de regras pode ser alterado ao longo do tempo, recomenda-se espaçar o esquema de numeração usado para as prioridades de regra, para tornar mais fácil inserir regras adicionais ao longo do tempo.</span><span class="sxs-lookup"><span data-stu-id="20c0f-165">Since the set of rules may change over time, it is recommended to space out the numbering scheme used for rule priorities to make it easy to insert additional rules over time.</span></span>

<span data-ttu-id="20c0f-166">O exemplo a seguir mostra uma regra que concede explicitamente o acesso às portas de gerenciamento requeridas pela infraestrutura do Azure para gerenciar e manter um ambiente de serviço de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="20c0f-166">The example below shows a rule that explicitly grants access to the management ports needed by the Azure infrastructure to manage and maintain an App Service Environment.</span></span>  <span data-ttu-id="20c0f-167">Observe que todo o tráfego de gerenciamento passa por SSL e é protegido por certificados de cliente, portanto, mesmo que as portas estejam abertas elas são inacessíveis por qualquer entidade que não seja a infraestrutura de gerenciamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="20c0f-167">Note that all management traffic flows over SSL and is secured by client certificates, so even though the ports are opened they are inaccessible by any entity other than Azure management infrastructure.</span></span>

    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "ALLOW AzureMngmt" -Type Inbound -Priority 100 -Action Allow -SourceAddressPrefix 'INTERNET'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '454-455' -Protocol TCP


<span data-ttu-id="20c0f-168">Ao bloquear o acesso às portas 80 e 443 para “ocultar” um ambiente de serviço de aplicativo por trás de serviços ou dispositivos upstream, você precisará saber o endereço IP upstream.</span><span class="sxs-lookup"><span data-stu-id="20c0f-168">When locking down access to port 80 and 443 to "hide" an App Service Environment behind upstream devices or services, you will need to know the upstream IP address.</span></span>  <span data-ttu-id="20c0f-169">Por exemplo, se você estiver usando um firewall de aplicativo Web (WAF), o WAF terá seu próprio endereço (ou endereços) IP, que ele utilizará ao usar proxy de tráfego para um ambiente de serviço de aplicativo downstream.</span><span class="sxs-lookup"><span data-stu-id="20c0f-169">For example, if you are using a web application firewall (WAF), the WAF will have its own IP address (or addresses) which it uses when proxying traffic to a downstream App Service Environment.</span></span>  <span data-ttu-id="20c0f-170">Você precisará usar esse endereço IP no parâmetro *SourceAddressPrefix* de uma regra de segurança de rede.</span><span class="sxs-lookup"><span data-stu-id="20c0f-170">You will need to use this IP address in the *SourceAddressPrefix* parameter of a network security rule.</span></span>

<span data-ttu-id="20c0f-171">No exemplo abaixo, o tráfego de entrada de um determinado endereço IP upstream é explicitamente permitido.</span><span class="sxs-lookup"><span data-stu-id="20c0f-171">In the example below, inbound traffic from a specific upstream IP address is explicitly allowed.</span></span>  <span data-ttu-id="20c0f-172">O endereço *1.2.3.4* é usado como um espaço reservado para o endereço IP de um WAF upstream.</span><span class="sxs-lookup"><span data-stu-id="20c0f-172">The address *1.2.3.4* is used as a placeholder for the IP address of an upstream WAF.</span></span>  <span data-ttu-id="20c0f-173">Altere o valor para coincidir com o endereço usado pelo serviço ou dispositivo upstream.</span><span class="sxs-lookup"><span data-stu-id="20c0f-173">Change the value to match the address used by your upstream device or service.</span></span>

    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "RESTRICT HTTP" -Type Inbound -Priority 200 -Action Allow -SourceAddressPrefix '1.2.3.4/32'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '80' -Protocol TCP
    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "RESTRICT HTTPS" -Type Inbound -Priority 300 -Action Allow -SourceAddressPrefix '1.2.3.4/32'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '443' -Protocol TCP

<span data-ttu-id="20c0f-174">Se desejar suporte a FTP, as regras a seguir podem usadas como um modelo para conceder acesso à porta de controle de FTP e às portas de canal de dados.</span><span class="sxs-lookup"><span data-stu-id="20c0f-174">If FTP support is desired, the following rules can be used as a template to grant access to the FTP control port and data channel ports.</span></span>  <span data-ttu-id="20c0f-175">Como o FTP é um protocolo com monitoramento de estado, você não poderá rotear o tráfego FTP por meio de um dispositivo de proxy ou firewall HTTP/HTTPS tradicional.</span><span class="sxs-lookup"><span data-stu-id="20c0f-175">Since FTP is a stateful protocol, you may not be able to route FTP traffic through a traditional HTTP/HTTPS firewall or proxy device.</span></span>  <span data-ttu-id="20c0f-176">Nesse caso, será necessário definir o *SourceAddressPrefix* para um valor diferente - por exemplo, o intervalo de endereços IP de computadores de desenvolvedor ou de implantação, nos quais clientes FTP estão em execução.</span><span class="sxs-lookup"><span data-stu-id="20c0f-176">In this case you will need to set the *SourceAddressPrefix* to a different value - for example the IP address range of developer or deployment machines on which FTP clients are running.</span></span> 

    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "RESTRICT FTPCtrl" -Type Inbound -Priority 400 -Action Allow -SourceAddressPrefix '1.2.3.4/32'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '21' -Protocol TCP
    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "RESTRICT FTPDataRange" -Type Inbound -Priority 500 -Action Allow -SourceAddressPrefix '1.2.3.4/32'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '10001-10020' -Protocol TCP

<span data-ttu-id="20c0f-177">(**Observação:** o intervalo de portas do canal de dados pode mudar durante o período de visualização.)</span><span class="sxs-lookup"><span data-stu-id="20c0f-177">(**Note:**  the data channel port range may change during the preview period.)</span></span>

<span data-ttu-id="20c0f-178">Se a depuração remota com o Visual Studio é usada, as regras a seguir demonstram como conceder acesso.</span><span class="sxs-lookup"><span data-stu-id="20c0f-178">If remote debugging with Visual Studio is used, the following rules demonstrate how to grant access.</span></span>  <span data-ttu-id="20c0f-179">Há uma regra separada para cada versão do Visual Studio para a qual há suporte, já que cada versão usa uma porta diferente para a depuração remota.</span><span class="sxs-lookup"><span data-stu-id="20c0f-179">There is a separate rule for each supported version of Visual Studio since each version uses a different port for remote debugging.</span></span>  <span data-ttu-id="20c0f-180">Assim como acontece com acesso ao FTP, o tráfego de depuração remota pode não fluir corretamente por meio de um dispositivo de proxy ou WAF tradicional.</span><span class="sxs-lookup"><span data-stu-id="20c0f-180">As with FTP access, remote debugging traffic may not flow properly through a traditional WAF or proxy device.</span></span>  <span data-ttu-id="20c0f-181">O *SourceAddressPrefix* pode ser definido, em vez disso, como o intervalo de endereços IP dos computadores de desenvolvedor executando o Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="20c0f-181">The *SourceAddressPrefix* can instead be set to the IP address range of developer machines running Visual Studio.</span></span>

    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "RESTRICT RemoteDebuggingVS2012" -Type Inbound -Priority 600 -Action Allow -SourceAddressPrefix '1.2.3.4/32'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '4016' -Protocol TCP
    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "RESTRICT RemoteDebuggingVS2013" -Type Inbound -Priority 700 -Action Allow -SourceAddressPrefix '1.2.3.4/32'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '4018' -Protocol TCP
    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "RESTRICT RemoteDebuggingVS2015" -Type Inbound -Priority 800 -Action Allow -SourceAddressPrefix '1.2.3.4/32'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '4020' -Protocol TCP

## <a name="assigning-a-network-security-group-to-a-subnet"></a><span data-ttu-id="20c0f-182">Atribuir um grupo de segurança de rede a uma sub-rede</span><span class="sxs-lookup"><span data-stu-id="20c0f-182">Assigning a Network Security Group to a Subnet</span></span>
<span data-ttu-id="20c0f-183">Um grupo de segurança de rede tem uma regra de segurança padrão que nega o acesso a todo o tráfego externo.</span><span class="sxs-lookup"><span data-stu-id="20c0f-183">A network security group has a default security rule which denies access to all external traffic.</span></span>  <span data-ttu-id="20c0f-184">O resultado da combinação entre as regras de segurança de rede descritas acima e a regra de segurança padrão bloqueando o tráfego de entrada é que somente o tráfego de intervalos de endereços de origem associado a uma ação *Permitir* poderá enviar tráfego a aplicativos em execução em um ambiente de serviço de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="20c0f-184">The result from combining the network security rules described above, and the default security rule blocking inbound traffic, is that only traffic from source address ranges associated with an *Allow* action will be able to send traffic to apps running in an App Service Environment.</span></span>

<span data-ttu-id="20c0f-185">Depois que um grupo de segurança de rede é preenchido com regras de segurança, ele precisa ser atribuído à sub-rede que contém o ambiente de serviço de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="20c0f-185">After a network security group is populated with security rules, it needs to be assigned to the subnet containing the App Service Environment.</span></span>  <span data-ttu-id="20c0f-186">O comando de atribuição referencia tanto o nome da rede virtual onde reside o ambiente de serviço de aplicativo como o nome da sub-rede onde o ambiente de serviço de aplicativo foi criado.</span><span class="sxs-lookup"><span data-stu-id="20c0f-186">The assignment command references both the name of the virtual network where the App Service Environment resides, as well as the name of the subnet where the App Service Environment was created.</span></span>  

<span data-ttu-id="20c0f-187">O exemplo a seguir mostra um grupo de segurança de rede que está sendo atribuído a uma sub-rede e rede virtual:</span><span class="sxs-lookup"><span data-stu-id="20c0f-187">The example below shows a network security group being assigned to a subnet and virtual network:</span></span>

    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityGroupToSubnet -VirtualNetworkName 'testVNet' -SubnetName 'Subnet-test'

<span data-ttu-id="20c0f-188">Depois que a atribuição de grupo de segurança de rede for bem-sucedida (a atribuição é uma operação demorada e pode levar alguns minutos para ser concluída), somente tráfego de entrada correspondendo às regras *Permitir* alcançará com êxito os aplicativos no ambiente de serviço de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="20c0f-188">Once the network security group assignment succeeds (the assignment is a long-running operations and can take a few minutes to complete), only inbound traffic matching *Allow* rules will successfully reach apps in the App Service Environment.</span></span>

<span data-ttu-id="20c0f-189">Para fins de exatidão, o exemplo a seguir mostra como remover e, portanto, dissociar o grupo de segurança de rede da sub-rede:</span><span class="sxs-lookup"><span data-stu-id="20c0f-189">For completeness the following example shows how to remove and thus dis-associate the network security group from the subnet:</span></span>

    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Remove-AzureNetworkSecurityGroupFromSubnet -VirtualNetworkName 'testVNet' -SubnetName 'Subnet-test'

## <a name="special-considerations-for-explicit-ip-ssl"></a><span data-ttu-id="20c0f-190">Considerações especiais para IP-SSL explícito</span><span class="sxs-lookup"><span data-stu-id="20c0f-190">Special Considerations for Explicit IP-SSL</span></span>
<span data-ttu-id="20c0f-191">Se um aplicativo for configurado com um endereço IP-SSL explícito (aplicável *somente* a ASEs que têm um VIP público), ao invés de usar o endereço IP padrão do Ambiente do Serviço de Aplicativo, o tráfego HTTP e HTTPS fluirá para a sub-rede por um conjunto de portas diferente das portas 80 e 443.</span><span class="sxs-lookup"><span data-stu-id="20c0f-191">If an app is configured with an explicit IP-SSL address (applicable *only* to ASEs that have a public VIP), instead of using the default IP address of the App Service Environment, both HTTP and HTTPS traffic flows into the subnet over a different set of ports other than ports 80 and 443.</span></span>

<span data-ttu-id="20c0f-192">O par individual de portas usadas por cada endereço IP-SSL pode ser encontrado na interface do usuário pela folha UX de detalhes do Ambiente de Serviço de Aplicativo.</span><span class="sxs-lookup"><span data-stu-id="20c0f-192">The individual pair of ports used by each IP-SSL address can be found in the portal user interface from the App Service Environment's details UX blade.</span></span>  <span data-ttu-id="20c0f-193">Selecione "Todas as configurações"--> "Endereços IP".</span><span class="sxs-lookup"><span data-stu-id="20c0f-193">Select "All settings" --> "IP addresses".</span></span>  <span data-ttu-id="20c0f-194">A folha "Endereços IP" mostra uma tabela de todos os endereços IP-SSL configurados explicitamente para o Ambiente de Serviço de Aplicativo, juntamente com o par de portas especial que é usado para rotear o tráfego HTTP e HTTPS associado a cada endereço IP-SSL.</span><span class="sxs-lookup"><span data-stu-id="20c0f-194">The "IP addresses" blade shows a table of all explicitly configured IP-SSL addresses for the App Service Environment, along with the special port pair that is used to route HTTP and HTTPS traffic associated with each IP-SSL address.</span></span>  <span data-ttu-id="20c0f-195">É esse par de portas que precisa ser usado para os parâmetros DestinationPortRange ao configurar regras em um grupo de segurança de rede.</span><span class="sxs-lookup"><span data-stu-id="20c0f-195">It is this port pair that needs to be used for the DestinationPortRange parameters when configuring rules in a network security group.</span></span>

<span data-ttu-id="20c0f-196">Quando um aplicativo em um ASE é configurado para usar IP-SSL, os clientes externos não verão e não precisarão se preocupar com o mapeamento de par de portas especial.</span><span class="sxs-lookup"><span data-stu-id="20c0f-196">When an app on an ASE is configured to use IP-SSL, external customers will not see and do not need to worry about the special port pair mapping.</span></span>  <span data-ttu-id="20c0f-197">O tráfego para os aplicativos fluirá normalmente para o endereço IP-SSL configurado.</span><span class="sxs-lookup"><span data-stu-id="20c0f-197">Traffic to the apps will flow normally to the configured IP-SSL address.</span></span>  <span data-ttu-id="20c0f-198">A conversão para o par de portas especial ocorrerá internamente de forma automática durante o segmento final do roteamento do tráfego para a sub-rede que contém o ASE.</span><span class="sxs-lookup"><span data-stu-id="20c0f-198">The translation to the special port pair automatically happens internally during the final leg of routing traffic into the subnet containing the ASE.</span></span> 

## <a name="getting-started"></a><span data-ttu-id="20c0f-199">Introdução</span><span class="sxs-lookup"><span data-stu-id="20c0f-199">Getting started</span></span>
<span data-ttu-id="20c0f-200">Para começar a usar Ambientes de Serviço de Aplicativo, veja [Introdução ao ambiente de Serviço de Aplicativo][IntroToAppServiceEnvironment]</span><span class="sxs-lookup"><span data-stu-id="20c0f-200">To get started with App Service Environments, see [Introduction to App Service Environment][IntroToAppServiceEnvironment]</span></span>

<span data-ttu-id="20c0f-201">Todos os artigos e os Como fazer para Ambientes de Serviço de Aplicativo estão disponíveis no [LEIAME para Ambientes de Serviço de Aplicativo](../app-service/app-service-app-service-environments-readme.md).</span><span class="sxs-lookup"><span data-stu-id="20c0f-201">All articles and How-To's for App Service Environments are available in the [README for Application Service Environments](../app-service/app-service-app-service-environments-readme.md).</span></span>

<span data-ttu-id="20c0f-202">Para saber mais sobre aplicativos que se conectam com segurança a recursos do back-end a partir de um Ambiente de Serviço de Aplicativo, veja [Conexão segura a recursos de back-end a partir de um ambiente do Serviço de Aplicativo][SecurelyConnecttoBackend]</span><span class="sxs-lookup"><span data-stu-id="20c0f-202">For details around apps securely connecting to backend resource from an App Service Environment, see [Securely connecting to Backend resources from an App Service Environment][SecurelyConnecttoBackend]</span></span>

<span data-ttu-id="20c0f-203">Para saber mais sobre a plataforma de Serviço de Aplicativo do Azure, veja [Serviço de Aplicativo do Azure][AzureAppService].</span><span class="sxs-lookup"><span data-stu-id="20c0f-203">For more information about the Azure App Service platform, see [Azure App Service][AzureAppService].</span></span>

[!INCLUDE [app-service-web-whats-changed](../../includes/app-service-web-whats-changed.md)]

[!INCLUDE [app-service-web-try-app-service](../../includes/app-service-web-try-app-service.md)]

<!-- LINKS -->
[virtualnetwork]: https://azure.microsoft.com/documentation/articles/virtual-networks-faq/
[HowToCreateAnAppServiceEnvironment]: http://azure.microsoft.com/documentation/articles/app-service-web-how-to-create-an-app-service-environment/
[NetworkSecurityGroups]: https://azure.microsoft.com/documentation/articles/virtual-networks-nsg/
[AzureAppService]: http://azure.microsoft.com/documentation/articles/app-service-value-prop-what-is/
[IntroToAppServiceEnvironment]:  http://azure.microsoft.com/documentation/articles/app-service-app-service-environment-intro/
[SecurelyConnecttoBackend]:  http://azure.microsoft.com/documentation/articles/app-service-app-service-environment-securely-connecting-to-backend-resources/
[NewPortal]:  https://portal.azure.com  

<!-- IMAGES -->

