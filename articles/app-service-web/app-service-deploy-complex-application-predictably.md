---
title: "Provisionar e implantar microsserviços previsíveis no Azure"
description: "Saiba como implantar um aplicativo composto por microsserviços no Serviço de Aplicativo do Azure como uma única unidade e de maneira previsível usando modelos de grupo de recursos JSON e scripts do PowerShell."
services: app-service
documentationcenter: 
author: cephalin
manager: erikre
editor: jimbe
ms.assetid: bb51e565-e462-4c60-929a-2ff90121f41d
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/06/2016
ms.author: cephalin
ms.openlocfilehash: 844f42e61ba443a4b74a52f622113e87a7781913
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/11/2017
---
# <a name="provision-and-deploy-microservices-predictably-in-azure"></a><span data-ttu-id="5dc6c-103">Provisionar e implantar microsserviços previsíveis no Azure</span><span class="sxs-lookup"><span data-stu-id="5dc6c-103">Provision and deploy microservices predictably in Azure</span></span>
<span data-ttu-id="5dc6c-104">Este tutorial mostra como provisionar e implantar um aplicativo composto por [microsserviços](https://en.wikipedia.org/wiki/Microservices) no [Serviço de Aplicativo do Azure](/services/app-service/) como uma única unidade e de maneira previsível usando modelos do grupo de recursos JSON e scripts do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-104">This tutorial shows how to provision and deploy an application composed of [microservices](https://en.wikipedia.org/wiki/Microservices) in [Azure App Service](/services/app-service/) as a single unit and in a predictable manner using JSON resource group templates and PowerShell scripting.</span></span> 

<span data-ttu-id="5dc6c-105">Ao provisionar e implantar aplicativos em alta escala que são compostos por microsserviços totalmente separados, a repetitividade e a previsibilidade são essenciais para se obter êxito.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-105">When provisioning and deploying high-scale applications that are composed of highly decoupled microservices, repeatability and predictability are crucial to success.</span></span> <span data-ttu-id="5dc6c-106">[Serviço de Aplicativo do Azure](/services/app-service/) permite criar microsserviços que incluem aplicativos Web, aplicativos móveis, aplicativos de API e aplicativos lógicos.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-106">[Azure App Service](/services/app-service/) enables you to create microservices that include web apps, mobile apps, API apps, and logic apps.</span></span> <span data-ttu-id="5dc6c-107">O [Azure Resource Manager](../azure-resource-manager/resource-group-overview.md) permite gerenciar todos os microsserviços como uma unidade, juntamente com as dependências de recurso, como as configurações de controle do código-fonte e banco de dados.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-107">[Azure Resource Manager](../azure-resource-manager/resource-group-overview.md) enables you to manage all the microservices as a unit, together with resource dependencies such as database and source control settings.</span></span> <span data-ttu-id="5dc6c-108">Agora, você também pode implantar esse aplicativo usando modelos JSON e scripts simples do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-108">Now, you can also deploy such an application using JSON templates and simple PowerShell scripting.</span></span> 

[!INCLUDE [app-service-web-to-api-and-mobile](../../includes/app-service-web-to-api-and-mobile.md)]

## <a name="what-you-will-do"></a><span data-ttu-id="5dc6c-109">O que você fará</span><span class="sxs-lookup"><span data-stu-id="5dc6c-109">What you will do</span></span>
<span data-ttu-id="5dc6c-110">No tutorial, você implantará um aplicativo que inclui:</span><span class="sxs-lookup"><span data-stu-id="5dc6c-110">In the tutorial, you will deploy an application that includes:</span></span>

* <span data-ttu-id="5dc6c-111">Dois aplicativos Web (isto é, dois microsserviços)</span><span class="sxs-lookup"><span data-stu-id="5dc6c-111">Two web apps (i.e. two microservices)</span></span>
* <span data-ttu-id="5dc6c-112">Um banco de dados SQL de back-end</span><span class="sxs-lookup"><span data-stu-id="5dc6c-112">A backend SQL Database</span></span>
* <span data-ttu-id="5dc6c-113">Configurações do aplicativo, cadeias de conexão e controle do código-fonte</span><span class="sxs-lookup"><span data-stu-id="5dc6c-113">App settings, connection strings, and source control</span></span>
* <span data-ttu-id="5dc6c-114">Application Insights, alertas, configurações de dimensionamento automático</span><span class="sxs-lookup"><span data-stu-id="5dc6c-114">Application insights, alerts, autoscaling settings</span></span>

## <a name="tools-you-will-use"></a><span data-ttu-id="5dc6c-115">Ferramentas que você utilizará</span><span class="sxs-lookup"><span data-stu-id="5dc6c-115">Tools you will use</span></span>
<span data-ttu-id="5dc6c-116">Neste tutorial, você utilizará as ferramentas a seguir.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-116">In this tutorial, you will use the following tools.</span></span> <span data-ttu-id="5dc6c-117">Como não se trata de uma discussão abrangente sobre ferramentas, escolherei o cenário de ponta a ponta e oferecerei uma breve introdução a respeito cada uma, indicando também onde você pode encontrar mais informações sobre ela.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-117">Since it’s not comprehensive discussion on tools, I’m going to stick to the end-to-end scenario and just give you a brief intro to each, and where you can find more information on it.</span></span> 

### <a name="azure-resource-manager-templates-json"></a><span data-ttu-id="5dc6c-118">Modelos do Gerenciador de Recursos do Azure (JSON)</span><span class="sxs-lookup"><span data-stu-id="5dc6c-118">Azure Resource Manager templates (JSON)</span></span>
<span data-ttu-id="5dc6c-119">Sempre que você cria um aplicativo Web no Serviço de Aplicativo do Azure, por exemplo, o Gerenciador de Recursos do Azure usa um modelo JSON para criar todo o grupo de recursos com os recursos do componente.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-119">Every time you create a web app in Azure App Service, for example, Azure Resource Manager uses a JSON template to create the entire resource group with the component resources.</span></span> <span data-ttu-id="5dc6c-120">Um modelo complexo do [Azure Marketplace](/marketplace) como o aplicativo [WordPress Escalonável](/marketplace/partners/wordpress/scalablewordpress/) pode incluir o banco de dados MySQL, contas de armazenamento, o Plano do Serviço de Aplicativo, o próprio aplicativo Web, regras de alerta, configurações do aplicativo, configurações de dimensionamento automático e muito mais, e todos esses modelos estão disponíveis para você por meio do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-120">A complex template from the [Azure Marketplace](/marketplace) like the [Scalable WordPress](/marketplace/partners/wordpress/scalablewordpress/) app can include the MySQL database, storage accounts, the App Service plan, the web app itself, alert rules, app settings, autoscale settings, and more, and all these templates are available to you through PowerShell.</span></span> <span data-ttu-id="5dc6c-121">Para obter informações sobre como baixar e usar esses modelos, confira [Usando o Azure PowerShell com o Gerenciador de Recursos do Azure](../powershell-azure-resource-manager.md).</span><span class="sxs-lookup"><span data-stu-id="5dc6c-121">For information on how to download and use these templates, see [Using Azure PowerShell with Azure Resource Manager](../powershell-azure-resource-manager.md).</span></span>

<span data-ttu-id="5dc6c-122">Para obter mais informações sobre os modelos do Gerenciador de Recursos do Azure, consulte [Criação de Modelos do Gerenciador de Recursos do Azure](../azure-resource-manager/resource-group-authoring-templates.md)</span><span class="sxs-lookup"><span data-stu-id="5dc6c-122">For more information on the Azure Resource Manager templates, see [Authoring Azure Resource Manager Templates](../azure-resource-manager/resource-group-authoring-templates.md)</span></span>

### <a name="azure-sdk-26-for-visual-studio"></a><span data-ttu-id="5dc6c-123">SDK do Azure para Visual Studio 2.6</span><span class="sxs-lookup"><span data-stu-id="5dc6c-123">Azure SDK 2.6 for Visual Studio</span></span>
<span data-ttu-id="5dc6c-124">O SDK mais recente contém melhorias para o suporte a modelos do Gerenciador de Recursos no editor JSON.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-124">The newest SDK contains improvements to the Resource Manager template support in the JSON editor.</span></span> <span data-ttu-id="5dc6c-125">Você pode usar isto para criar rapidamente um modelo de grupo de recursos do zero ou abrir um modelo do JSON existente (como um modelo baixado da galeria) para modificação, preencher o arquivo de parâmetros e até mesmo implantar o grupo de recursos diretamente de uma solução de Grupo de Recursos do Azure.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-125">You can use this to quickly create a resource group template from scratch or open an existing JSON template (such as a downloaded gallery template) for modification, populate the parameters file, and even deploy the resource group directly from an Azure Resource Group solution.</span></span>

<span data-ttu-id="5dc6c-126">Para obter mais informações, consulte [SDK do Azure para Visual Studio 2.6](https://azure.microsoft.com/blog/2015/04/29/announcing-the-azure-sdk-2-6-for-net/).</span><span class="sxs-lookup"><span data-stu-id="5dc6c-126">For more information, see [Azure SDK 2.6 for Visual Studio](https://azure.microsoft.com/blog/2015/04/29/announcing-the-azure-sdk-2-6-for-net/).</span></span>

### <a name="azure-powershell-080-or-later"></a><span data-ttu-id="5dc6c-127">Azure PowerShell 0.8.0 ou posterior</span><span class="sxs-lookup"><span data-stu-id="5dc6c-127">Azure PowerShell 0.8.0 or later</span></span>
<span data-ttu-id="5dc6c-128">A partir da versão 0.8.0, a instalação do Azure PowerShell inclui o módulo do Gerenciador de Recursos do Azure, além do módulo do Azure.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-128">Beginning in version 0.8.0, the Azure PowerShell installation includes the Azure Resource Manager module in addition to the Azure module.</span></span> <span data-ttu-id="5dc6c-129">Este novo módulo permite que você escreva script para implantação de grupos de recursos.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-129">This new module enables you to script the deployment of resource groups.</span></span>

<span data-ttu-id="5dc6c-130">Para obter mais informações, consulte [Usando o PowerShell do Azure com o Gerenciador de Recursos do Azure](../powershell-azure-resource-manager.md)</span><span class="sxs-lookup"><span data-stu-id="5dc6c-130">For more information, see [Using Azure PowerShell with Azure Resource Manager](../powershell-azure-resource-manager.md)</span></span>

### <a name="azure-resource-explorer"></a><span data-ttu-id="5dc6c-131">Gerenciador de Recursos do Azure</span><span class="sxs-lookup"><span data-stu-id="5dc6c-131">Azure Resource Explorer</span></span>
<span data-ttu-id="5dc6c-132">Essa [ferramenta de visualização](https://resources.azure.com) permite que você explore as definições de JSON de todos os grupos de recursos em sua assinatura e os recursos individuais.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-132">This [preview tool](https://resources.azure.com) enables you to explore the JSON definitions of all the resource groups in your subscription and the individual resources.</span></span> <span data-ttu-id="5dc6c-133">Na ferramenta, você pode editar as definições de JSON de um recurso, excluir uma hierarquia inteira de recursos e criar novos recursos.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-133">In the tool, you can edit the JSON definitions of a resource, delete an entire hierarchy of resources, and create new resources.</span></span>  <span data-ttu-id="5dc6c-134">As informações prontamente disponíveis nessa ferramenta serão muito úteis para criação de modelos, porque mostram quais propriedades você precisa definir para um determinado tipo de recurso, os valores corretos, etc. Você pode até mesmo criar seu grupo de recursos no [Portal do Azure](https://portal.azure.com/) e, em seguida, inspecionar suas definições JSON no gerenciador para ajudá-lo a classificar o grupo de recursos segundo os modelos.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-134">The information readily available in this tool is very helpful for template authoring because it shows you what properties you need to set for a particular type of resource, the correct values, etc. You can even create your resource group in the [Azure Portal](https://portal.azure.com/), then inspect its JSON definitions in the explorer tool to help you templatize the resource group.</span></span>

### <a name="deploy-to-azure-button"></a><span data-ttu-id="5dc6c-135">Botão Implantar no Azure</span><span class="sxs-lookup"><span data-stu-id="5dc6c-135">Deploy to Azure button</span></span>
<span data-ttu-id="5dc6c-136">Se você usa GitHub para controle do código-fonte, você pode colocar um [botão Implantar no Azure](https://azure.microsoft.com/blog/2014/11/13/deploy-to-azure-button-for-azure-websites-2/) em seu arquivo LEIAME.MD, que permite uma implantação pronta para uso da interface do usuário para Azure.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-136">If you use GitHub for source control, you can put a [Deploy to Azure button](https://azure.microsoft.com/blog/2014/11/13/deploy-to-azure-button-for-azure-websites-2/) into your README.MD, which enables a turn-key deployment UI to Azure.</span></span> <span data-ttu-id="5dc6c-137">Embora seja possível fazê-lo para qualquer aplicativo Web simples, você pode estender isso para habilitar a implantação de um grupo de recursos inteiro, colocando um arquivo azuredeploy.json na raiz do repositório.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-137">While you can do this for any simple web app, you can extend this to enable deploying an entire resource group by putting an azuredeploy.json file in the repository root.</span></span> <span data-ttu-id="5dc6c-138">Esse arquivo JSON, que contém o modelo de grupo de recursos, será usado pelo botão Implantar no Azure para criar o grupo de recursos.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-138">This JSON file, which contains the resource group template, will be used by the Deploy to Azure button to create the resource group.</span></span> <span data-ttu-id="5dc6c-139">Para obter um exemplo, consulte a amostra [ToDoApp](https://github.com/azure-appservice-samples/ToDoApp) , que você usará neste tutorial.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-139">For an example, see the [ToDoApp](https://github.com/azure-appservice-samples/ToDoApp) sample, which you will use in this tutorial.</span></span>

## <a name="get-the-sample-resource-group-template"></a><span data-ttu-id="5dc6c-140">Obter o modelo de grupo de recursos de exemplo</span><span class="sxs-lookup"><span data-stu-id="5dc6c-140">Get the sample resource group template</span></span>
<span data-ttu-id="5dc6c-141">Agora vamos direto ao ponto.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-141">So now let’s get right to it.</span></span>

1. <span data-ttu-id="5dc6c-142">Navegue até o exemplo de Serviço de Aplicativo [ToDoApp](https://github.com/azure-appservice-samples/ToDoApp) .</span><span class="sxs-lookup"><span data-stu-id="5dc6c-142">Navigate to the [ToDoApp](https://github.com/azure-appservice-samples/ToDoApp) App Service sample.</span></span>
2. <span data-ttu-id="5dc6c-143">Em readme.md, clique em **Implantar no Azure**.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-143">In readme.md, click **Deploy to Azure**.</span></span>
3. <span data-ttu-id="5dc6c-144">Você é levado para o site [implantar-no-azure](https://deploy.azure.com) e solicitado a inserir parâmetros de implantação.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-144">You’re taken to the [deploy-to-azure](https://deploy.azure.com) site and asked to input deployment parameters.</span></span> <span data-ttu-id="5dc6c-145">Observe que a maioria dos campos é preenchida com o nome do repositório e algumas cadeias de caracteres aleatórias para você.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-145">Notice that most of the fields are populated with the repository name and some random strings for you.</span></span> <span data-ttu-id="5dc6c-146">Você pode alterar todos os campos se desejar, mas as únicas coisas que você precisa inserir são o logon administrativo do SQL Server e a senha; então, clique em **Próximo**.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-146">You can change all the fields if you want, but the only things you have to enter are the SQL Server administrative login and the password, then click **Next**.</span></span>
   
   ![](./media/app-service-deploy-complex-application-predictably/gettemplate-1-deploybuttonui.png)
4. <span data-ttu-id="5dc6c-147">Em seguida, clique em **Implantar** para iniciar o processo de implantação.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-147">Next, click **Deploy** to start the deployment process.</span></span> <span data-ttu-id="5dc6c-148">Quando o processo for concluído, clique no link http://todoapp*XXXX*.azurewebsites.net para procurar o aplicativo implantado.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-148">Once the process runs to completion, click the http://todoapp*XXXX*.azurewebsites.net link to browse the deployed application.</span></span> 
   
   ![](./media/app-service-deploy-complex-application-predictably/gettemplate-2-deployprogress.png)
   
   <span data-ttu-id="5dc6c-149">A interface do usuário deve estar um pouco lenta quando você navega pela primeira vez por ela porque os aplicativos estão sendo iniciados, mas esteja convencido de que se trata de um aplicativo totalmente funcional.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-149">The UI would be a little slow when you first browse to it because the apps are just starting up, but convince yourself that it’s a fully-functional application.</span></span>
5. <span data-ttu-id="5dc6c-150">De volta à página Implantar, clique no link **Gerenciar** para ver o novo aplicativo no Portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-150">Back in the Deploy page, click the **Manage** link to see the new application in the Azure Portal.</span></span>
6. <span data-ttu-id="5dc6c-151">Na lista suspensa **Essentials** , clique no link grupo de recursos.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-151">In the **Essentials** dropdown, click the resource group link.</span></span> <span data-ttu-id="5dc6c-152">Observe também que o aplicativo Web já está conectado ao repositório GitHub em **Projeto Externo**.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-152">Note also that the web app is already connected to the GitHub repository under **External Project**.</span></span> 
   
   ![](./media/app-service-deploy-complex-application-predictably/gettemplate-3-portalresourcegroup.png)
7. <span data-ttu-id="5dc6c-153">Na folha do grupo de recursos, observe que já existem dois aplicativos Web e um banco de dados SQL no grupo de recursos.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-153">In the resource group blade, note that there are already two web apps and one SQL Database in the resource group.</span></span>
   
   ![](./media/app-service-deploy-complex-application-predictably/gettemplate-4-portalresourcegroupclicked.png)

<span data-ttu-id="5dc6c-154">Tudo o que você acabou de ver em poucos minutos é um aplicativo de dois microsserviços totalmente implantado, com todos os componentes, dependências, configurações, banco de dados e publicação contínua, configurado por uma orquestração automatizada no Gerenciador de Recursos do Azure.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-154">Everything that you just saw in a few short minutes is a fully deployed two-microservice application, with all the components, dependencies, settings, database, and continuous publishing, set up by an automated orchestration in Azure Resource Manager.</span></span> <span data-ttu-id="5dc6c-155">Tudo isso foi feito por duas coisas:</span><span class="sxs-lookup"><span data-stu-id="5dc6c-155">All this was done by two things:</span></span>

* <span data-ttu-id="5dc6c-156">O botão Implantar no Azure</span><span class="sxs-lookup"><span data-stu-id="5dc6c-156">The Deploy to Azure button</span></span>
* <span data-ttu-id="5dc6c-157">O arquivo azuredeploy.json na raiz do repositório</span><span class="sxs-lookup"><span data-stu-id="5dc6c-157">azuredeploy.json in the repo root</span></span>

<span data-ttu-id="5dc6c-158">Você pode implantar esse mesmo aplicativo dezenas, centenas ou milhares de vezes e ter sempre exatamente a mesma configuração.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-158">You can deploy this same application tens, hundreds, or thousands of times and have the exact same configuration every time.</span></span> <span data-ttu-id="5dc6c-159">A capacidade de repetição e a previsibilidade dessa abordagem permitem que você implante aplicativos de grande escala com facilidade e confiança.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-159">The repeatability and the predictability of this approach enables you to deploy high-scale applications with ease and confidence.</span></span>

## <a name="examine-or-edit-azuredeployjson"></a><span data-ttu-id="5dc6c-160">Examinar (ou editar) AZUREDEPLOY.JSON</span><span class="sxs-lookup"><span data-stu-id="5dc6c-160">Examine (or edit) AZUREDEPLOY.JSON</span></span>
<span data-ttu-id="5dc6c-161">Agora vamos examinar como o repositório GitHub foi configurado.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-161">Now let’s look at how the GitHub repository was set up.</span></span> <span data-ttu-id="5dc6c-162">Você usará o editor de JSON no SDK do .NET do Azure, portanto, se você ainda não tiver instalado o [SDK .NET do Azure 2.6](/downloads/), faça isso agora.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-162">You will be using the JSON editor in the Azure .NET SDK, so if you haven’t already installed [Azure .NET SDK 2.6](/downloads/), do it now.</span></span>

1. <span data-ttu-id="5dc6c-163">Clone o repositório [ToDoApp](https://github.com/azure-appservice-samples/ToDoApp) usando sua ferramenta git favorita.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-163">Clone the [ToDoApp](https://github.com/azure-appservice-samples/ToDoApp) repository using your favorite git tool.</span></span> <span data-ttu-id="5dc6c-164">Na captura de tela abaixo, faço isso no Team Explorer no Visual Studio 2013.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-164">In the screenshot below, I’m doing this in the Team Explorer in Visual Studio 2013.</span></span>
   
   ![](./media/app-service-deploy-complex-application-predictably/examinejson-1-vsclone.png)
2. <span data-ttu-id="5dc6c-165">Na raiz do repositório, abra azuredeploy.json no Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-165">From the repository root, open azuredeploy.json in Visual Studio.</span></span> <span data-ttu-id="5dc6c-166">Se você não vir o painel Estrutura de Tópicos JSON, precisará instalar o SDK .NET do Azure.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-166">If you don’t see the JSON Outline pane, you need to install Azure .NET SDK.</span></span>
   
   ![](./media/app-service-deploy-complex-application-predictably/examinejson-2-vsjsoneditor.png)

<span data-ttu-id="5dc6c-167">Não vou descrever todos os detalhes do formato JSON, mas a seção [Mais Recursos](#resources) contém links para aprender a linguagem de modelo de grupo de recursos.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-167">I’m not going to describe every detail of the JSON format, but the [More Resources](#resources) section has links for learning the resource group template language.</span></span> <span data-ttu-id="5dc6c-168">Aqui, eu vou mostrar a você recursos interessantes que podem ajudá-lo a começar a fazer seu próprio modelo personalizado para implantação do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-168">Here, I’m just going to show you the interesting features that can help you get started in making your own custom template for app deployment.</span></span>

### <a name="parameters"></a><span data-ttu-id="5dc6c-169">Parâmetros</span><span class="sxs-lookup"><span data-stu-id="5dc6c-169">Parameters</span></span>
<span data-ttu-id="5dc6c-170">Dê uma olhada na seção de parâmetros para ver que a maioria desses parâmetros são aquilo que o botão **Implantar no Azure** solicita que você insira.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-170">Take a look at the parameters section to see that most of these parameters are what the **Deploy to Azure** button prompts you to input.</span></span> <span data-ttu-id="5dc6c-171">O site por trás do botão **Implantar no Azure** preenche a Interface do Usuário de entrada, usando os parâmetros definidos em azuredeploy.json.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-171">The site behind the **Deploy to Azure** button populates the input UI using the parameters defined in azuredeploy.json.</span></span> <span data-ttu-id="5dc6c-172">Esses parâmetros são usados em todas as definições de recurso, como nomes de recurso, valores de propriedade, etc.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-172">These parameters are used throughout the resource definitions, such as resource names, property values, etc.</span></span>

### <a name="resources"></a><span data-ttu-id="5dc6c-173">Recursos</span><span class="sxs-lookup"><span data-stu-id="5dc6c-173">Resources</span></span>
<span data-ttu-id="5dc6c-174">No nó recursos, você pode ver que 4 recursos do nível mais alto estão definidos, incluindo uma instância do SQL Server, um plano do Serviço de Aplicativo e dois aplicativos Web.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-174">In the resources node, you can see that 4 top-level resources are defined, including a SQL Server instance, an App Service plan, and two web apps.</span></span> 

#### <a name="app-service-plan"></a><span data-ttu-id="5dc6c-175">Plano do Serviço de Aplicativo</span><span class="sxs-lookup"><span data-stu-id="5dc6c-175">App Service plan</span></span>
<span data-ttu-id="5dc6c-176">Vamos começar com um recurso simples de nível raiz em JSON.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-176">Let’s start with a simple root-level resource in the JSON.</span></span> <span data-ttu-id="5dc6c-177">Na Estrutura de Tópicos JSON, clique no plano de Serviço de Aplicativo chamado **[hostingPlanName]** para realçar o código do JSON correspondente.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-177">In the JSON Outline, click the App Service plan named **[hostingPlanName]** to highlight the corresponding JSON code.</span></span> 

![](./media/app-service-deploy-complex-application-predictably/examinejson-3-appserviceplan.png)

<span data-ttu-id="5dc6c-178">Observe que o elemento `type` especifica a cadeia de caracteres em um plano do Serviço de Aplicativo (isso era chamado de farm de servidores, há muito tempo atrás) enquanto outros elementos e propriedades são preenchidos com os parâmetros definidos no arquivo JSON, sendo que este recurso não tem nenhum recurso aninhado.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-178">Note that the `type` element specifies the string for an App Service plan (it was called a server farm a long, long time ago), and other elements and properties are filled in using the parameters defined in the JSON file, and this resource doesn’t have any nested resources.</span></span>

> [!NOTE]
> <span data-ttu-id="5dc6c-179">Observe também que o valor de `apiVersion` informa ao Azure com qual versão da API REST usar a definição de recurso JSON, e ele pode afetar como o recurso deve ser formatado dentro do `{}`.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-179">Note also that the value of `apiVersion` tells Azure which version of the REST API to use the JSON resource definition with, and it can affect how the resource should be formatted inside the `{}`.</span></span> 
> 
> 

#### <a name="sql-server"></a><span data-ttu-id="5dc6c-180">SQL Server</span><span class="sxs-lookup"><span data-stu-id="5dc6c-180">SQL Server</span></span>
<span data-ttu-id="5dc6c-181">Em seguida, clique no recurso do SQL Server chamado **SQLServer** na Estrutura de Tópicos JSON.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-181">Next, click on the SQL Server resource named **SQLServer** in the JSON Outline.</span></span>

![](./media/app-service-deploy-complex-application-predictably/examinejson-4-sqlserver.png)

<span data-ttu-id="5dc6c-182">Observe o seguinte sobre o código JSON realçado:</span><span class="sxs-lookup"><span data-stu-id="5dc6c-182">Note the following about the highlighted JSON code:</span></span>

* <span data-ttu-id="5dc6c-183">O uso de parâmetros garante que os recursos criados sejam nomeados e configurados de modo que torne-os consistentes entre si.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-183">The use of parameters ensures that the created resources are named and configured in a way that makes them consistent with one another.</span></span>
* <span data-ttu-id="5dc6c-184">O recurso SQLServer tem dois recursos aninhados, cada um com um valor diferente para `type`.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-184">The SQLServer resource has two nested resources, each has a different value for `type`.</span></span>
* <span data-ttu-id="5dc6c-185">Os recursos aninhados dentro de `“resources”: […]`, em que o banco de dados e as regras de firewall são definidas, têm um elemento `dependsOn` que especifica a ID de recurso do recurso SQLServer no nível de raiz.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-185">The nested resources inside `“resources”: […]`, where the database and the firewall rules are defined, have a `dependsOn` element that specifies the resource ID of the root-level SQLServer resource.</span></span> <span data-ttu-id="5dc6c-186">Isso informa ao Gerenciador de Recursos do Azure que, "antes de você criar esse recurso, o outro recurso já deve existir; e se o outro recurso estiver definido no modelo, crie-o primeiro".</span><span class="sxs-lookup"><span data-stu-id="5dc6c-186">This tells Azure Resource Manager, “before you create this resource, that other resource must already exist; and if that other resource is defined in the template, then create that one first”.</span></span>
  
  > [!NOTE]
  > <span data-ttu-id="5dc6c-187">Para obter informações detalhadas sobre como usar a função `resourceId()`, consulte [Funções do Modelo do Azure Resource Manager](../azure-resource-manager/resource-group-template-functions-resource.md#resourceid).</span><span class="sxs-lookup"><span data-stu-id="5dc6c-187">For detailed information on how to use the `resourceId()` function, see [Azure Resource Manager Template Functions](../azure-resource-manager/resource-group-template-functions-resource.md#resourceid).</span></span>
  > 
  > 
* <span data-ttu-id="5dc6c-188">O efeito do elemento `dependsOn` é que o Gerenciador de Recursos do Azure pode saber quais recursos podem ser criados em paralelo e quais recursos devem ser criados sequencialmente.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-188">The effect of the `dependsOn` element is that Azure Resource Manager can know which resources can be created in parallel and which resources must be created sequentially.</span></span> 

#### <a name="web-app"></a><span data-ttu-id="5dc6c-189">Aplicativo Web</span><span class="sxs-lookup"><span data-stu-id="5dc6c-189">Web app</span></span>
<span data-ttu-id="5dc6c-190">Agora, vamos passar para os aplicativos Web em si, que são mais complicados.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-190">Now, let’s move on to the actual web apps themselves, which are more complicated.</span></span> <span data-ttu-id="5dc6c-191">Clique no aplicativo Web [variables(‘apiSiteName’)] na estrutura de tópicos JSON para destacar seu código JSON.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-191">Click the [variables(‘apiSiteName’)] web app in the JSON Outline to highlight its JSON code.</span></span> <span data-ttu-id="5dc6c-192">Você perceberá que as coisas estão ficando muito mais interessantes.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-192">You’ll notice that things are getting much more interesting.</span></span> <span data-ttu-id="5dc6c-193">Para esse fim, falarei sobre um dos recursos por vez:</span><span class="sxs-lookup"><span data-stu-id="5dc6c-193">For this purpose, I’ll talk about the features one by one:</span></span>

##### <a name="root-resource"></a><span data-ttu-id="5dc6c-194">Recurso raiz</span><span class="sxs-lookup"><span data-stu-id="5dc6c-194">Root resource</span></span>
<span data-ttu-id="5dc6c-195">O aplicativo Web depende de dois recursos diferentes.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-195">The web app depends on two different resources.</span></span> <span data-ttu-id="5dc6c-196">Isso significa que o Gerenciador de Recursos do Azure criará o aplicativo Web somente depois que ambos o plano do Serviço de Aplicativo e a instância do SQL Server forem criados.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-196">This means that Azure Resource Manager will create the web app only after both the App Service plan and the SQL Server instance are created.</span></span>

![](./media/app-service-deploy-complex-application-predictably/examinejson-5-webapproot.png)

##### <a name="app-settings"></a><span data-ttu-id="5dc6c-197">Configurações do aplicativo</span><span class="sxs-lookup"><span data-stu-id="5dc6c-197">App settings</span></span>
<span data-ttu-id="5dc6c-198">As configurações do aplicativo também serão definidas como um recurso aninhado.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-198">The app settings are also defined as a nested resource.</span></span>

![](./media/app-service-deploy-complex-application-predictably/examinejson-6-webappsettings.png)

<span data-ttu-id="5dc6c-199">No elemento `properties` para `config/appsettings`, você tem duas configurações de aplicativo no formato `“<name>” : “<value>”`.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-199">In the `properties` element for `config/appsettings`, you have two app settings in the format `“<name>” : “<value>”`.</span></span>

* <span data-ttu-id="5dc6c-200">`PROJECT` é uma [configuração KUDU](https://github.com/projectkudu/kudu/wiki/Customizing-deployments) que, em uma solução do Visual Studio com vários projetos, informa à implantação do Azure qual projeto usar.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-200">`PROJECT` is a [KUDU setting](https://github.com/projectkudu/kudu/wiki/Customizing-deployments) that tells Azure deployment which project to use in a multi-project Visual Studio solution.</span></span> <span data-ttu-id="5dc6c-201">Mostrarei posteriormente como o controle do código-fonte está configurado, mas já que o código ToDoApp está em uma solução do Visual Studio com vários projetos, precisamos dessa configuração.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-201">I will show you later how source control is configured, but since the ToDoApp code is in a multi-project Visual Studio solution, we need this setting.</span></span>
* <span data-ttu-id="5dc6c-202">`clientUrl` é simplesmente um aplicativo de configuração que o código do aplicativo usa.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-202">`clientUrl` is simply an app setting that the application code uses.</span></span>

##### <a name="connection-strings"></a><span data-ttu-id="5dc6c-203">Cadeias de conexão</span><span class="sxs-lookup"><span data-stu-id="5dc6c-203">Connection strings</span></span>
<span data-ttu-id="5dc6c-204">As cadeias de conexão também serão definidas como um recurso aninhado.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-204">The connection strings are also defined as a nested resource.</span></span>

![](./media/app-service-deploy-complex-application-predictably/examinejson-7-webappconnstr.png)

<span data-ttu-id="5dc6c-205">No elemento `properties` para `config/connectionstrings`, cada cadeia de conexão também é definida como um par nome:valor, com o formato específico de `“<name>” : {“value”: “…”, “type”: “…”}`.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-205">In the `properties` element for `config/connectionstrings`, each connection string is also defined as a name:value pair, with the specific format of `“<name>” : {“value”: “…”, “type”: “…”}`.</span></span> <span data-ttu-id="5dc6c-206">Para o elemento `type`, os valores possíveis são `MySql`, `SQLServer`, `SQLAzure` e `Custom`.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-206">For the `type` element, possible values are `MySql`, `SQLServer`, `SQLAzure`, and `Custom`.</span></span>

> [!TIP]
> <span data-ttu-id="5dc6c-207">Para obter uma lista definitiva de tipos de cadeia de conexão, execute o seguinte comando no Azure PowerShell: \[Enum]::GetNames("Microsoft.WindowsAzure.Commands.Utilities.Websites.Services.WebEntities.DatabaseType")</span><span class="sxs-lookup"><span data-stu-id="5dc6c-207">For a definitive list of the connection string types, run the following command in Azure PowerShell: \[Enum]::GetNames("Microsoft.WindowsAzure.Commands.Utilities.Websites.Services.WebEntities.DatabaseType")</span></span>
> 
> 

##### <a name="source-control"></a><span data-ttu-id="5dc6c-208">Controle do código-fonte</span><span class="sxs-lookup"><span data-stu-id="5dc6c-208">Source control</span></span>
<span data-ttu-id="5dc6c-209">As configurações do controle do código-fonte também serão definidas como um recurso aninhado.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-209">The source control settings are also defined as a nested resource.</span></span> <span data-ttu-id="5dc6c-210">O Gerenciador de Recursos do Azure usa esse recurso para configurar a publicação contínua (consulte a advertência sobre `IsManualIntegration` posteriormente) e também para iniciar a implantação do código do aplicativo automaticamente durante o processamento do arquivo JSON.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-210">Azure Resource Manager uses this resource to configure continuous publishing (see caveat on `IsManualIntegration` later) and also to kick off the deployment of application code automatically during the processing of the JSON file.</span></span>

![](./media/app-service-deploy-complex-application-predictably/examinejson-8-webappsourcecontrol.png)

<span data-ttu-id="5dc6c-211">`RepoUrl` e `branch` devem ser bastante intuitivos e devem apontar para o repositório Git e o nome da ramificação por meio da qual publicar.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-211">`RepoUrl` and `branch` should be pretty intuitive and should point to the Git repository and the name of the branch to publish from.</span></span> <span data-ttu-id="5dc6c-212">Mais uma vez, estes são definidos pelos parâmetros de entrada.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-212">Again, these are defined by input parameters.</span></span> 

<span data-ttu-id="5dc6c-213">Observe no elemento `dependsOn` que, além do recurso de aplicativo Web, `sourcecontrols/web` também depende de `config/appsettings` e `config/connectionstrings`.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-213">Note in the `dependsOn` element that, in addition to the web app resource itself, `sourcecontrols/web` also depends on `config/appsettings` and `config/connectionstrings`.</span></span> <span data-ttu-id="5dc6c-214">Isso ocorre porque quando `sourcecontrols/web` é configurado, o processo de implantação do Azure tentará automaticamente implantar, compilar e iniciar o código do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-214">This is because once `sourcecontrols/web` is configured, the Azure deployment process will automatically attempt to deploy, build, and start the application code.</span></span> <span data-ttu-id="5dc6c-215">Portanto, inserir essa dependência ajuda você a garantir que o aplicativo tenha acesso às configurações e cadeias de conexão necessárias do aplicativo antes de o código desse aplicativo ser executado.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-215">Therefore, inserting this dependency helps you make sure that the application has access to the required app settings and connection strings before the application code is run.</span></span> 

> [!NOTE]
> <span data-ttu-id="5dc6c-216">Observe também que `IsManualIntegration` é definido como `true`.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-216">Note also that `IsManualIntegration` is set to `true`.</span></span> <span data-ttu-id="5dc6c-217">Esta propriedade é necessária neste tutorial porque, na verdade, você não tem o repositório GitHub e, portanto, não pode efetivamente conceder permissão ao Azure para configurar a publicação contínua por meio do [ToDoApp](https://github.com/azure-appservice-samples/ToDoApp) (ou seja,</span><span class="sxs-lookup"><span data-stu-id="5dc6c-217">This property is necessary in this tutorial because you do not actually own the GitHub repository, and thus cannot actually grant permission to Azure to configure continuous publishing from [ToDoApp](https://github.com/azure-appservice-samples/ToDoApp) (i.e.</span></span> <span data-ttu-id="5dc6c-218">enviar atualizações automáticas de repositório por push ao Azure).</span><span class="sxs-lookup"><span data-stu-id="5dc6c-218">push automatic repository updates to Azure).</span></span> <span data-ttu-id="5dc6c-219">Você pode usar o valor padrão `false` para o repositório especificado somente se tiver configurado as credenciais do proprietário para o GitHub no [Portal do Azure](https://portal.azure.com/) previamente.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-219">You can use the default value `false` for the specified repository only if you have configured the owner’s GitHub credentials in the [Azure portal](https://portal.azure.com/) before.</span></span> <span data-ttu-id="5dc6c-220">Em outras palavras, se você configurou o controle do código-fonte para GitHub ou BitBucket para qualquer aplicativo no [Portal do Azure](https://portal.azure.com/) previamente, usando suas credenciais de usuário, então o Azure lembrará dessas credenciais e as utilizará sempre que você implantar qualquer aplicativo do GitHub ou BitBucket no futuro.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-220">In other words, if you have set up source control to GitHub or BitBucket for any app in the [Azure Portal](https://portal.azure.com/) previously, using your user credentials, then Azure will remember the credentials and use them whenever you deploy any app from GitHub or BitBucket in the future.</span></span> <span data-ttu-id="5dc6c-221">No entanto, se você ainda não tiver feito isso, a implantação do modelo JSON falhará quando o Gerenciador de Recursos do Azure tentar definir configurações de controle do código-fonte do aplicativo Web, porque ele não poderá fazer logon no GitHub ou BitBucket com as credenciais do proprietário do repositório.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-221">However, if you haven’t done this already, deployment of the JSON template will fail when Azure Resource Manager tries to configure the web app’s source control settings because it cannot log into GitHub or BitBucket with the repository owner’s credentials.</span></span>
> 
> 

## <a name="compare-the-json-template-with-deployed-resource-group"></a><span data-ttu-id="5dc6c-222">Comparar o modelo JSON com grupo de recursos implantado</span><span class="sxs-lookup"><span data-stu-id="5dc6c-222">Compare the JSON template with deployed resource group</span></span>
<span data-ttu-id="5dc6c-223">Aqui, você pode percorrer todas as folhas do aplicativo Web no [Portal do Azure](https://portal.azure.com/), mas há outra ferramenta que é tão útil quanto esta, ou mais.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-223">Here, you can go through all the web app’s blades in the [Azure Portal](https://portal.azure.com/), but there’s another tool that’s just as useful, if not more.</span></span> <span data-ttu-id="5dc6c-224">Vá para a ferramenta de visualização [Gerenciador de Recursos do Azure](https://resources.azure.com) , que oferece uma representação JSON de todos os grupos de recursos em suas assinaturas, como eles existem realmente no back-end do Azure.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-224">Go to the [Azure Resource Explorer](https://resources.azure.com) preview tool, which gives you a JSON representation of all the resource groups in your subscriptions, as they actually exist in the Azure backend.</span></span> <span data-ttu-id="5dc6c-225">Você também pode ver como a hierarquia JSON do grupo de recursos no Azure corresponde à hierarquia no arquivo de modelo que é usado para criá-la.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-225">You can also see how the resource group’s JSON hierarchy in Azure corresponds with the hierarchy in the template file that’s used to create it.</span></span>

<span data-ttu-id="5dc6c-226">Por exemplo, quando vou para a ferramenta [Gerenciador de Recursos do Azure](https://resources.azure.com) e expando os nós no gerenciador, posso ver o grupo de recursos e os recursos de nível raiz que são coletados em seus respectivos tipos de recurso.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-226">For example, when I go to the [Azure Resource Explorer](https://resources.azure.com) tool and expand the nodes in the explorer, I can see the resource group and the root-level resources that are collected under their respective resource types.</span></span>

![](./media/app-service-deploy-complex-application-predictably/ARM-1-treeview.png)

<span data-ttu-id="5dc6c-227">Se você acessar hierarquias mais baixas de um aplicativo Web, você deve ser capaz de ver os detalhes de configuração de aplicativo Web como a captura de tela a seguir:</span><span class="sxs-lookup"><span data-stu-id="5dc6c-227">If you drill down to a web app, you should be able to see web app configuration details similar to the below screenshot:</span></span>

![](./media/app-service-deploy-complex-application-predictably/ARM-2-jsonview.png)

<span data-ttu-id="5dc6c-228">Novamente, os recursos aninhados devem ter uma hierarquia muito semelhante àquela no seu arquivo de modelo JSON, e você verá as configurações do aplicativo, cadeias de conexão, etc., adequadamente refletidas no painel JSON.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-228">Again, the nested resources should have a hierarchy very similar to those in your JSON template file, and you should see the app settings, connection strings, etc., properly reflected in the JSON pane.</span></span> <span data-ttu-id="5dc6c-229">A ausência de configurações pode indicar um problema com o arquivo JSON, e pode ajudá-lo a solucionar problemas no arquivo de modelo JSON.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-229">The absence of settings here may indicate an issue with your JSON file and can help you troubleshoot your JSON template file.</span></span>

## <a name="deploy-the-resource-group-template-yourself"></a><span data-ttu-id="5dc6c-230">Implantar o modelo de grupo de recursos por conta própria</span><span class="sxs-lookup"><span data-stu-id="5dc6c-230">Deploy the resource group template yourself</span></span>
<span data-ttu-id="5dc6c-231">O botão **Implantar no Azure** é ótimo, mas só permite que você implante o modelo de grupo de recursos em azuredeploy.json se você já tiver enviado azuredeploy.json por push para o GitHub.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-231">The **Deploy to Azure** button is great, but it allows you to deploy the resource group template in azuredeploy.json only if you have already pushed azuredeploy.json to GitHub.</span></span> <span data-ttu-id="5dc6c-232">O SDK .NET do Azure também fornece as ferramentas para implantar qualquer arquivo de modelo JSON diretamente do computador local.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-232">The Azure .NET SDK also provides the tools for you to deploy any JSON template file directly from your local machine.</span></span> <span data-ttu-id="5dc6c-233">Para fazer isso, siga as etapas abaixo:</span><span class="sxs-lookup"><span data-stu-id="5dc6c-233">To do this, follow the steps below:</span></span>

1. <span data-ttu-id="5dc6c-234">No Visual Studio, clique em **Arquivo** > **Novo** > **Projeto**.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-234">In Visual Studio, click **File** > **New** > **Project**.</span></span>
2. <span data-ttu-id="5dc6c-235">Clique em **Visual C#** > **Nuvem** > **Grupo de Recursos do Azure**, em seguida, clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-235">Click **Visual C#** > **Cloud** > **Azure Resource Group**, then click **OK**.</span></span>
   
   ![](./media/app-service-deploy-complex-application-predictably/deploy-1-vsproject.png)
3. <span data-ttu-id="5dc6c-236">Em **Selecionar Modelo do Azure**, selecione **Modelo em Branco** e clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-236">In **Select Azure Template**, select **Blank Template** and click **OK**.</span></span>
4. <span data-ttu-id="5dc6c-237">Arraste azuredeploy.json para a pasta **Modelo** do novo projeto.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-237">Drag azuredeploy.json into the **Template** folder of your new project.</span></span>
   
   ![](./media/app-service-deploy-complex-application-predictably/deploy-2-copyjson.png)
5. <span data-ttu-id="5dc6c-238">No Gerenciador de Soluções, abra o azuredeploy.json copiado.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-238">From Solution Explorer, open the copied azuredeploy.json.</span></span>
6. <span data-ttu-id="5dc6c-239">Apenas para fins de demonstração, vamos adicionar alguns recursos padrão do Application Insight em nosso arquivo JSON, clicando em **Adicionar Recurso**.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-239">Just for the sake of the demonstration, let’s add some standard Application Insight resources to our JSON file, by clicking **Add Resource**.</span></span> <span data-ttu-id="5dc6c-240">Se estiver interessado apenas na implantação do arquivo JSON, vá direto para as etapas de implantação.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-240">If you’re just interested in deploying the JSON file, skip to the deploy steps.</span></span>
   
   ![](./media/app-service-deploy-complex-application-predictably/deploy-3-newresource.png)
7. <span data-ttu-id="5dc6c-241">Selecione **Application Insights para Aplicativos Web**, certifique-se de que um aplicativo Web e um Plano do Serviço de Aplicativo existentes estão selecionados e, em seguida, clique em **Adicionar**.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-241">Select **Application Insights for Web Apps**, then make sure an existing App Service plan and web app is selected, and then click **Add**.</span></span>
   
   ![](./media/app-service-deploy-complex-application-predictably/deploy-4-newappinsight.png)
   
   <span data-ttu-id="5dc6c-242">Você será capaz de ver vários recursos novos que, dependendo do recurso e do que ele faz, têm dependências no plano do Serviço de Aplicativo ou então no aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-242">You’ll now be able to see several new resources that, depending on the resource and what it does, have dependencies on either the App Service plan or the web app.</span></span> <span data-ttu-id="5dc6c-243">Esses recursos não estão habilitados segundo sua definição existente e você vai mudar isso.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-243">These resources are not enabled by their existing definition and you’re going to change that.</span></span>
   
   ![](./media/app-service-deploy-complex-application-predictably/deploy-5-appinsightresources.png)
8. <span data-ttu-id="5dc6c-244">Na estrutura de tópicos JSON, clique em **appInsights AutoScale** para destacar seu código JSON.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-244">In the JSON Outline, click **appInsights AutoScale** to highlight its JSON code.</span></span> <span data-ttu-id="5dc6c-245">Essa é a configuração de dimensionamento para seu plano do Serviço de Aplicativo.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-245">This is the scaling setting for your App Service plan.</span></span>
9. <span data-ttu-id="5dc6c-246">No código realçado JSON, localize as propriedades `location` e `enabled` e defina-as conforme mostrado abaixo.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-246">In the highlighted JSON code, locate the `location` and `enabled` properties and set them as shown below.</span></span>
   
   ![](./media/app-service-deploy-complex-application-predictably/deploy-6-autoscalesettings.png)
10. <span data-ttu-id="5dc6c-247">Na estrutura de tópicos JSON, clique em **CPUHigh appInsights** para destacar seu código JSON.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-247">In the JSON Outline, click **CPUHigh appInsights** to highlight its JSON code.</span></span> <span data-ttu-id="5dc6c-248">Este é um alerta.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-248">This is an alert.</span></span>
11. <span data-ttu-id="5dc6c-249">Localize as propriedades `location` e `isEnabled` e defina-as conforme mostrado abaixo.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-249">Locate the `location` and `isEnabled` properties and set them as shown below.</span></span> <span data-ttu-id="5dc6c-250">Faça o mesmo para os outros três alertas (lâmpadas roxas).</span><span class="sxs-lookup"><span data-stu-id="5dc6c-250">Do the same for the other three alerts (purple bulbs).</span></span>
    
    ![](./media/app-service-deploy-complex-application-predictably/deploy-7-alerts.png)
12. <span data-ttu-id="5dc6c-251">Agora, você está pronto para implantar.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-251">You’re now ready to deploy.</span></span> <span data-ttu-id="5dc6c-252">Clique no projeto com o botão direito do mouse e selecione **Implantar** > **New Implantarment**.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-252">Right-click the project and select **Deploy** > **New Deployment**.</span></span>
    
    ![](./media/app-service-deploy-complex-application-predictably/deploy-8-newdeployment.png)
13. <span data-ttu-id="5dc6c-253">Faça logon na conta do Azure se ainda não fez isso.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-253">Log into your Azure account if you haven’t already done so.</span></span>
14. <span data-ttu-id="5dc6c-254">Selecione um grupo de recursos existente em sua assinatura ou crie um novo, selecione **azuredeploy.json** e, em seguida, clique em **Editar parâmetros**.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-254">Select an existing resource group in your subscription or create a new one, select **azuredeploy.json**, and then click **Edit Parameters**.</span></span>
    
    ![](./media/app-service-deploy-complex-application-predictably/deploy-9-deployconfig.png)
    
    <span data-ttu-id="5dc6c-255">Agora você poderá editar todos os parâmetros definidos no arquivo de modelo em uma boa tabela.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-255">You’ll now be able to edit all the parameters defined in the template file in a nice table.</span></span> <span data-ttu-id="5dc6c-256">Parâmetros que definem padrões já terão seus valores padrão, enquanto parâmetros que definem uma lista de valores permitidos serão mostrados como listas suspensas.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-256">Parameters that define defaults will already have their default values, and parameters that define a list of allowed values will be shown as dropdowns.</span></span>
    
    ![](./media/app-service-deploy-complex-application-predictably/deploy-10-parametereditor.png)
15. <span data-ttu-id="5dc6c-257">Preencha todos os parâmetros vazios e use o [Endereço de repositório do GitHub para ToDoApp](https://github.com/azure-appservice-samples/ToDoApp.git) na **repoUrl**.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-257">Fill in all the empty parameters, and use the [GitHub repo address for ToDoApp](https://github.com/azure-appservice-samples/ToDoApp.git) in **repoUrl**.</span></span> <span data-ttu-id="5dc6c-258">Em seguida, clique em **Salvar**.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-258">Then, click **Save**.</span></span>
    
    ![](./media/app-service-deploy-complex-application-predictably/deploy-11-parametereditorfilled.png)
    
    > [!NOTE]
    > <span data-ttu-id="5dc6c-259">O dimensionamento automático é um recurso oferecido no patamar **Standard** ou mais alto, enquanto alertas de nível de plano são recursos oferecidos no patamar **Básico** ou superior; você precisará definir o parâmetro **sku** como **Standard** ou **Premium** para ver todos os seus novos recursos do App Insights se iluminarem.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-259">Autoscaling is a feature offered in **Standard** tier or higher, and plan-level alerts are features offered in **Basic** tier or higher, you’ll need to set the **sku** parameter to **Standard** or **Premium** in order to see all your new App Insights resources light up.</span></span>
    > 
    > 
16. <span data-ttu-id="5dc6c-260">Clique em **Implantar**.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-260">Click **Deploy**.</span></span> <span data-ttu-id="5dc6c-261">Se você selecionou **Salvar senhas**, a senha será salva no arquivo de parâmetros **em texto sem formatação**.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-261">If you selected **Save passwords**, the password will be saved in the parameter file **in plain text**.</span></span> <span data-ttu-id="5dc6c-262">Caso contrário, será solicitado que você insira a senha do banco de dados durante o processo de implantação.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-262">Otherwise, you’ll be asked to input the database password during the deployment process.</span></span>

<span data-ttu-id="5dc6c-263">É isso!</span><span class="sxs-lookup"><span data-stu-id="5dc6c-263">That’s it!</span></span> <span data-ttu-id="5dc6c-264">Agora, basta ir para o [Portal do Azure](https://portal.azure.com/) e até a ferramenta [Gerenciador de Recursos do Azure](https://resources.azure.com) para ver os novos alertas e configurações de dimensionamento automático adicionados ao seu aplicativo JSON implantado.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-264">Now you just need to go to the [Azure Portal](https://portal.azure.com/) and the [Azure Resource Explorer](https://resources.azure.com) tool to see the new alerts and autoscale settings added to your JSON deployed application.</span></span>

<span data-ttu-id="5dc6c-265">As etapas cumpridas nesta seção realizaram principalmente o seguinte:</span><span class="sxs-lookup"><span data-stu-id="5dc6c-265">Your steps in this section mainly accomplished the following:</span></span>

1. <span data-ttu-id="5dc6c-266">Prepararam o arquivo de modelo</span><span class="sxs-lookup"><span data-stu-id="5dc6c-266">Prepared the template file</span></span>
2. <span data-ttu-id="5dc6c-267">Criaram um arquivo de parâmetros para acompanhar o arquivo de modelo</span><span class="sxs-lookup"><span data-stu-id="5dc6c-267">Created a parameter file to go with the template file</span></span>
3. <span data-ttu-id="5dc6c-268">Implantaram o arquivo de modelo juntamente com o arquivo de parâmetros</span><span class="sxs-lookup"><span data-stu-id="5dc6c-268">Deployed the template file with the parameter file</span></span>

<span data-ttu-id="5dc6c-269">A última etapa é facilmente realizada por um cmdlet do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-269">The last step is easily done by a PowerShell cmdlet.</span></span> <span data-ttu-id="5dc6c-270">Para ver o que o Visual Studio fez quando implantou seu aplicativo, abra Scripts\Deploy AzureResourceGroup.ps1.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-270">To see what Visual Studio did when it deployed your application, open Scripts\Deploy-AzureResourceGroup.ps1.</span></span> <span data-ttu-id="5dc6c-271">Há muito código lá, mas vou destacar todo o código relevante que necessário para implantar o arquivo de modelo com o arquivo de parâmetros.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-271">There’s a lot of code there, but I’m just going to highlight all the pertinent code you need to deploy the template file with the parameter file.</span></span>

![](./media/app-service-deploy-complex-application-predictably/deploy-12-powershellsnippet.png)

<span data-ttu-id="5dc6c-272">O último cmdlet, `New-AzureResourceGroup`, é o que executa efetivamente a ação.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-272">The last cmdlet, `New-AzureResourceGroup`, is the one that actually performs the action.</span></span> <span data-ttu-id="5dc6c-273">Tudo isso deve demonstrar a você que, com a ajuda de ferramentas, é relativamente fácil implantar seu aplicativo em nuvem de modo previsível.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-273">All this should demonstrate to you that, with the help of tooling, it is relatively straightforward to deploy your cloud application predictably.</span></span> <span data-ttu-id="5dc6c-274">Sempre que você executar o cmdlet no mesmo modelo com o mesmo arquivo de parâmetros, você obterá o mesmo resultado.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-274">Every time you run the cmdlet on the same template with the same parameter file, you’re going to get the same result.</span></span>

## <a name="summary"></a><span data-ttu-id="5dc6c-275">Resumo</span><span class="sxs-lookup"><span data-stu-id="5dc6c-275">Summary</span></span>
<span data-ttu-id="5dc6c-276">No DevOps, repetitividade e previsibilidade são essenciais para qualquer implantação bem-sucedida de um aplicativo composto por microsserviços de alta escala.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-276">In DevOps, repeatability and predictability are keys to any successful deployment of a high-scale application composed of microservices.</span></span> <span data-ttu-id="5dc6c-277">Neste tutorial, você implantou um aplicativo de dois microsserviços no Azure como um único grupo de recursos usando o modelo do Gerenciador de Recursos do Azure.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-277">In this tutorial, you have deployed a two-microservice application to Azure as a single resource group using the Azure Resource Manager template.</span></span> <span data-ttu-id="5dc6c-278">Espera-se que ele tenha dado a você o conhecimento necessário para iniciar a conversão de seu aplicativo do Azure em um modelo e possa ser provisionado e implantado de maneira previsível.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-278">Hopefully, it has given you the knowledge you need in order to start converting your application in Azure into a template and can provision and deploy it predictably.</span></span> 

## <a name="next-steps"></a><span data-ttu-id="5dc6c-279">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="5dc6c-279">Next Steps</span></span>
<span data-ttu-id="5dc6c-280">Descubra como [aplicar metodologias Agile e publicar continuamente o aplicativo de microsserviços](app-service-agile-software-development.md) e técnicas de implantação avançadas como a [implantação flighting](app-service-web-test-in-production-controlled-test-flight.md) com facilidade.</span><span class="sxs-lookup"><span data-stu-id="5dc6c-280">Find out how to [apply agile methodologies and continuously publish your microservices application with ease](app-service-agile-software-development.md) and advanced deployment techniques like [flighting deployment](app-service-web-test-in-production-controlled-test-flight.md) easily.</span></span>

<a name="resources"></a>

## <a name="more-resources"></a><span data-ttu-id="5dc6c-281">Mais recursos</span><span class="sxs-lookup"><span data-stu-id="5dc6c-281">More resources</span></span>
* [<span data-ttu-id="5dc6c-282">Idioma de modelo do Gerenciador de Recursos do Azure</span><span class="sxs-lookup"><span data-stu-id="5dc6c-282">Azure Resource Manager Template Language</span></span>](../azure-resource-manager/resource-group-authoring-templates.md)
* [<span data-ttu-id="5dc6c-283">Criando modelos do Gerenciador de Recursos do Azure</span><span class="sxs-lookup"><span data-stu-id="5dc6c-283">Authoring Azure Resource Manager Templates</span></span>](../azure-resource-manager/resource-group-authoring-templates.md)
* [<span data-ttu-id="5dc6c-284">Funções de modelo do Gerenciador de Recursos do Azure</span><span class="sxs-lookup"><span data-stu-id="5dc6c-284">Azure Resource Manager Template Functions</span></span>](../azure-resource-manager/resource-group-template-functions.md)
* [<span data-ttu-id="5dc6c-285">Implantar um aplicativo com o modelo do Gerenciador de Recursos do Azure</span><span class="sxs-lookup"><span data-stu-id="5dc6c-285">Deploy an application with Azure Resource Manager template</span></span>](../azure-resource-manager/resource-group-template-deploy.md)
* [<span data-ttu-id="5dc6c-286">Usando o Azure PowerShell com o Gerenciador de Recursos do Azure</span><span class="sxs-lookup"><span data-stu-id="5dc6c-286">Using Azure PowerShell with Azure Resource Manager</span></span>](../azure-resource-manager/powershell-azure-resource-manager.md)
* [<span data-ttu-id="5dc6c-287">Solucionando problemas de implantações de grupos de recursos no Azure</span><span class="sxs-lookup"><span data-stu-id="5dc6c-287">Troubleshooting Resource Group Deployments in Azure</span></span>](../azure-resource-manager/resource-manager-common-deployment-errors.md)

