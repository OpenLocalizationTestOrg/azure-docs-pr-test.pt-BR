---
title: "Guia de segurança do Armazenamento do Azure | Microsoft Docs"
description: "Detalha os vários métodos de proteger o Armazenamento do Azure, incluindo, entre outros, RBAC, Criptografia do Serviço de Armazenamento, Criptografia do Cliente, SMB 3.0 e Azure Disk Encryption."
services: storage
documentationcenter: .net
author: robinsh
manager: timlt
editor: tysonn
ms.assetid: 6f931d94-ef5a-44c6-b1d9-8a3c9c327fb2
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: dotnet
ms.topic: article
ms.date: 12/08/2016
ms.author: robinsh
ms.openlocfilehash: e71d9baf36ea7acb8dc8fa1daf9ddde3a2856f85
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/29/2017
---
# <a name="azure-storage-security-guide"></a><span data-ttu-id="c8662-103">Guia de segurança do Armazenamento do Azure</span><span class="sxs-lookup"><span data-stu-id="c8662-103">Azure Storage security guide</span></span>
## <a name="overview"></a><span data-ttu-id="c8662-104">Visão geral</span><span class="sxs-lookup"><span data-stu-id="c8662-104">Overview</span></span>
<span data-ttu-id="c8662-105">O Armazenamento do Azure fornece um conjunto abrangente de recursos de segurança que, juntos, permitem aos desenvolvedores criar aplicativos seguros.</span><span class="sxs-lookup"><span data-stu-id="c8662-105">Azure Storage provides a comprehensive set of security capabilities which together enable developers to build secure applications.</span></span> <span data-ttu-id="c8662-106">A conta de armazenamento pode ser protegida usando o Controle de Acesso Baseado em Função e o Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="c8662-106">The storage account itself can be secured using Role-Based Access Control and Azure Active Directory.</span></span> <span data-ttu-id="c8662-107">Os dados podem ser protegidos em trânsito, entre um aplicativo e o Azure usando a [Criptografia do cliente](../storage-client-side-encryption.md), HTTPS ou SMB 3.0.</span><span class="sxs-lookup"><span data-stu-id="c8662-107">Data can be secured in transit between an application and Azure by using [Client-Side Encryption](../storage-client-side-encryption.md), HTTPS, or SMB 3.0.</span></span> <span data-ttu-id="c8662-108">Os dados podem ser definidos para serem criptografados automaticamente quando gravados no Armazenamento do Azure usando a [SSE (Criptografia do Serviço de Armazenamento)](storage-service-encryption.md).</span><span class="sxs-lookup"><span data-stu-id="c8662-108">Data can be set to be automatically encrypted when written to Azure Storage using [Storage Service Encryption (SSE)](storage-service-encryption.md).</span></span> <span data-ttu-id="c8662-109">Os discos do sistema operacional e de dados usados pelas máquinas virtuais podem ser definidos para serem criptografados usando o [Azure Disk Encryption](../../security/azure-security-disk-encryption.md).</span><span class="sxs-lookup"><span data-stu-id="c8662-109">OS and Data disks used by virtual machines can be set to be encrypted using [Azure Disk Encryption](../../security/azure-security-disk-encryption.md).</span></span> <span data-ttu-id="c8662-110">O acesso delegado aos objetos de dados no Armazenamento do Azure pode ser concedido usando [Assinaturas de Acesso Compartilhado](../storage-dotnet-shared-access-signature-part-1.md).</span><span class="sxs-lookup"><span data-stu-id="c8662-110">Delegated access to the data objects in Azure Storage can be granted using [Shared Access Signatures](../storage-dotnet-shared-access-signature-part-1.md).</span></span>

<span data-ttu-id="c8662-111">Este artigo apresentará uma visão geral de cada um desses recursos de segurança que podem ser usados com o Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="c8662-111">This article will provide an overview of each of these security features that can be used with Azure Storage.</span></span> <span data-ttu-id="c8662-112">São fornecidos links para artigos que darão detalhes de cada recurso, para que você possa investigar mais cada tópico mais aprofundadamente.</span><span class="sxs-lookup"><span data-stu-id="c8662-112">Links are provided to articles that will give details of each feature so you can easily do further investigation on each topic.</span></span>

<span data-ttu-id="c8662-113">Estes são os tópicos abordados neste artigo:</span><span class="sxs-lookup"><span data-stu-id="c8662-113">Here are the topics to be covered in this article:</span></span>

* <span data-ttu-id="c8662-114">[Segurança do plano de gerenciamento](#management-plane-security) – proteção da conta de armazenamento</span><span class="sxs-lookup"><span data-stu-id="c8662-114">[Management Plane Security](#management-plane-security) – Securing your Storage Account</span></span>

  <span data-ttu-id="c8662-115">O plano de gerenciamento consiste em recursos usados para gerenciar a conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-115">The management plane consists of the resources used to manage your storage account.</span></span> <span data-ttu-id="c8662-116">Nesta seção, falaremos sobre o Modelo de implantação do Azure Resource Manager e como usar o RBAC (Controle de Acesso Baseado em Função) para controlar o acesso às contas de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-116">In this section, we'll talk about the Azure Resource Manager deployment model and how to use Role-Based Access Control (RBAC) to control access to your storage accounts.</span></span> <span data-ttu-id="c8662-117">Também falaremos sobre como gerenciar as chaves da conta de armazenamento e como regenerá-las.</span><span class="sxs-lookup"><span data-stu-id="c8662-117">We will also talk about managing your storage account keys and how to regenerate them.</span></span>
* <span data-ttu-id="c8662-118">[Segurança do plano de dados](#data-plane-security) – proteção do acesso aos seus dados</span><span class="sxs-lookup"><span data-stu-id="c8662-118">[Data Plane Security](#data-plane-security) – Securing Access to Your Data</span></span>

  <span data-ttu-id="c8662-119">Nesta seção, examinaremos a permissão de acesso aos objetos de dados reais na sua conta de armazenamento como blobs, arquivos, filas e tabelas, usando as Assinaturas de Acesso Compartilhado e as Políticas de Acesso Armazenado.</span><span class="sxs-lookup"><span data-stu-id="c8662-119">In this section, we'll look at allowing access to the actual data objects in your Storage account, such as blobs, files, queues, and tables, using Shared Access Signatures and Stored Access Policies.</span></span> <span data-ttu-id="c8662-120">Vamos abordar a SAS de nível de serviço e de nível de conta.</span><span class="sxs-lookup"><span data-stu-id="c8662-120">We will cover both service-level SAS and account-level SAS.</span></span> <span data-ttu-id="c8662-121">Também veremos como limitar o acesso a um endereço IP específico (ou a um intervalo de endereços IP), como limitar o protocolo usado para HTTPS e como revogar uma Assinatura de Acesso Compartilhado sem esperar que ela expire.</span><span class="sxs-lookup"><span data-stu-id="c8662-121">We'll also see how to limit access to a specific IP address (or range of IP addresses), how to limit the protocol used to HTTPS, and how to revoke a Shared Access Signature without waiting for it to expire.</span></span>
* [<span data-ttu-id="c8662-122">Criptografia em trânsito</span><span class="sxs-lookup"><span data-stu-id="c8662-122">Encryption in Transit</span></span>](#encryption-in-transit)

  <span data-ttu-id="c8662-123">Esta seção ensina a proteger os dados quando você os transfere para dentro ou para fora do Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="c8662-123">This section discusses how to secure data when you transfer it into or out of Azure Storage.</span></span> <span data-ttu-id="c8662-124">Falaremos sobre o uso recomendado de HTTPS e a criptografia usada pelo SMB 3.0 para Compartilhamentos de Arquivos do Azure.</span><span class="sxs-lookup"><span data-stu-id="c8662-124">We'll talk about the recommended use of HTTPS and the encryption used by SMB 3.0 for Azure File shares.</span></span> <span data-ttu-id="c8662-125">Também examinaremos a Criptografia do Cliente, que permite criptografar os dados antes que eles sejam transferidos para o Armazenamento em um aplicativo cliente e a descriptografá-los depois que eles são transferidos para fora do Armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-125">We will also take a look at Client-side Encryption, which enables you to encrypt the data before it is transferred into Storage in a client application, and to decrypt the data after it is transferred out of Storage.</span></span>
* [<span data-ttu-id="c8662-126">Criptografia em repouso</span><span class="sxs-lookup"><span data-stu-id="c8662-126">Encryption at Rest</span></span>](#encryption-at-rest)

  <span data-ttu-id="c8662-127">Falaremos sobre a SSE (Criptografia do Serviço de Armazenamento) e como é possível habilitá-la em uma conta de armazenamento, resultando na criptografia automática dos blobs de blocos, dos blobs de páginas e dos blobs de acréscimo quando gravados no Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="c8662-127">We will talk about Storage Service Encryption (SSE), and how you can enable it for a storage account, resulting in your block blobs, page blobs, and append blobs being automatically encrypted when written to Azure Storage.</span></span> <span data-ttu-id="c8662-128">Também veremos como você pode usar o Azure Disk Encryption e explorar as diferenças básicas e os casos do Disk Encryption em relação ao SSE e à Criptografia do cliente.</span><span class="sxs-lookup"><span data-stu-id="c8662-128">We will also look at how you can use Azure Disk Encryption and explore the basic differences and cases of Disk Encryption versus SSE versus Client-Side Encryption.</span></span> <span data-ttu-id="c8662-129">Examinaremos rapidamente a compatibilidade de FIPS com os computadores do governo norte-americano.</span><span class="sxs-lookup"><span data-stu-id="c8662-129">We will briefly look at FIPS compliance for U.S. Government computers.</span></span>
* <span data-ttu-id="c8662-130">Uso da [Análise de Armazenamento](#storage-analytics) para auditar o acesso do Armazenamento do Azure</span><span class="sxs-lookup"><span data-stu-id="c8662-130">Using [Storage Analytics](#storage-analytics) to audit access of Azure Storage</span></span>

  <span data-ttu-id="c8662-131">Esta seção descreve como encontrar informações nos logs de análise de armazenamento de uma solicitação.</span><span class="sxs-lookup"><span data-stu-id="c8662-131">This section discusses how to find information in the storage analytics logs for a request.</span></span> <span data-ttu-id="c8662-132">Analisaremos dados reais do log de análise de armazenamento para saber como diferenciar uma solicitação que foi feita com a chave de conta de Armazenamento, com uma Assinatura de Acesso Compartilhado ou anonimamente e se ela foi bem-sucedida ou se falhou.</span><span class="sxs-lookup"><span data-stu-id="c8662-132">We'll take a look at real storage analytics log data and see how to discern whether a request is made with the Storage account key, with a Shared Access signature, or anonymously, and whether it succeeded or failed.</span></span>
* [<span data-ttu-id="c8662-133">Habilitando clientes com base no navegador usando CORS</span><span class="sxs-lookup"><span data-stu-id="c8662-133">Enabling Browser-Based Clients using CORS</span></span>](#Cross-Origin-Resource-Sharing-CORS)

  <span data-ttu-id="c8662-134">Esta seção trata de como permitir o CORS (compartilhamento de recursos entre origens).</span><span class="sxs-lookup"><span data-stu-id="c8662-134">This section talks about how to allow cross-origin resource sharing (CORS).</span></span> <span data-ttu-id="c8662-135">Falaremos sobre acesso entre domínios e como lidar com ele usando os recursos do CORS incorporados no Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="c8662-135">We'll talk about cross-domain access, and how to handle it with the CORS capabilities built into Azure Storage.</span></span>

## <a name="management-plane-security"></a><span data-ttu-id="c8662-136">Segurança do plano de gerenciamento</span><span class="sxs-lookup"><span data-stu-id="c8662-136">Management Plane Security</span></span>
<span data-ttu-id="c8662-137">O plano de gerenciamento consiste em operações que afetam a conta de armazenamento em si.</span><span class="sxs-lookup"><span data-stu-id="c8662-137">The management plane consists of operations that affect the storage account itself.</span></span> <span data-ttu-id="c8662-138">Por exemplo, você pode criar ou excluir uma conta de armazenamento, obter uma lista de contas de armazenamento em uma assinatura, recuperar as chaves da conta de armazenamento ou regenerar as chaves da conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-138">For example, you can create or delete a storage account, get a list of storage accounts in a subscription, retrieve the storage account keys, or regenerate the storage account keys.</span></span>

<span data-ttu-id="c8662-139">Ao criar uma nova conta de armazenamento, você seleciona um modelo de implantação: Clássico ou Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="c8662-139">When you create a new storage account, you select a deployment model of Classic or Resource Manager.</span></span> <span data-ttu-id="c8662-140">O modelo Clássico de criação de recursos no Azure permite apenas acesso tudo ou nada à assinatura e, por sua vez, à conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-140">The Classic model of creating resources in Azure only allows all-or-nothing access to the subscription, and in turn, the storage account.</span></span>

<span data-ttu-id="c8662-141">Este guia se concentra no modelo Resource Manager, que é o meio recomendado para a criação de contas de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-141">This guide focuses on the Resource Manager model which is the recommended means for creating storage accounts.</span></span> <span data-ttu-id="c8662-142">Com as contas de armazenamento do Gerenciador de Recursos, em vez de fornecer acesso à toda a assinatura, você pode controlar o acesso em um nível mais limitado no plano de gerenciamento usando o RBAC (Controle de Acesso Baseado em Função).</span><span class="sxs-lookup"><span data-stu-id="c8662-142">With the Resource Manager storage accounts, rather than giving access to the entire subscription, you can control access on a more finite level to the management plane using Role-Based Access Control (RBAC).</span></span>

### <a name="how-to-secure-your-storage-account-with-role-based-access-control-rbac"></a><span data-ttu-id="c8662-143">Como proteger a conta de armazenamento com o RBAC (Controle de Acesso Baseado em Função)</span><span class="sxs-lookup"><span data-stu-id="c8662-143">How to secure your storage account with Role-Based Access Control (RBAC)</span></span>
<span data-ttu-id="c8662-144">Vamos falar sobre o que é o RBAC e como você pode usá-lo.</span><span class="sxs-lookup"><span data-stu-id="c8662-144">Let's talk about what RBAC is, and how you can use it.</span></span> <span data-ttu-id="c8662-145">Cada assinatura do Azure tem um Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="c8662-145">Each Azure subscription has an Azure Active Directory.</span></span> <span data-ttu-id="c8662-146">Os usuários, grupos e aplicativos desse diretório podem receber acesso para gerenciar recursos na assinatura do Azure que usam o modelo de implantação Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="c8662-146">Users, groups, and applications from that directory can be granted access to manage resources in the Azure subscription that use the Resource Manager deployment model.</span></span> <span data-ttu-id="c8662-147">Esse acesso é chamado de RBAC (Controle de Acesso Baseado em Função).</span><span class="sxs-lookup"><span data-stu-id="c8662-147">This is referred to as Role-Based Access Control (RBAC).</span></span> <span data-ttu-id="c8662-148">Para gerenciar esse acesso, é possível usar o [Portal do Azure](https://portal.azure.com/), as [ferramentas da CLI do Azure](../../cli-install-nodejs.md), o [PowerShell](/powershell/azureps-cmdlets-docs) ou as [APIs REST do Provedor de Recursos de Armazenamento do Azure](https://msdn.microsoft.com/library/azure/mt163683.aspx).</span><span class="sxs-lookup"><span data-stu-id="c8662-148">To manage this access, you can use the [Azure portal](https://portal.azure.com/), the [Azure CLI tools](../../cli-install-nodejs.md), [PowerShell](/powershell/azureps-cmdlets-docs), or the [Azure Storage Resource Provider REST APIs](https://msdn.microsoft.com/library/azure/mt163683.aspx).</span></span>

<span data-ttu-id="c8662-149">Com o modelo Resource Manager, você coloca a conta de armazenamento em um grupo de recursos e controla o acesso ao plano de gerenciamento dessa conta de armazenamento específica usando o Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="c8662-149">With the Resource Manager model, you put the storage account in a resource group and control access to the management plane of that specific storage account using Azure Active Directory.</span></span> <span data-ttu-id="c8662-150">Por exemplo, é possível permitir que usuários específicos acessem as chaves da conta de armazenamento, enquanto outros usuários podem exibir informações sobre a conta de armazenamento, mas não podem acessar suas chaves.</span><span class="sxs-lookup"><span data-stu-id="c8662-150">For example, you can give specific users the ability to access the storage account keys, while other users can view information about the storage account, but cannot access the storage account keys.</span></span>

#### <a name="granting-access"></a><span data-ttu-id="c8662-151">Concessão de acesso</span><span class="sxs-lookup"><span data-stu-id="c8662-151">Granting Access</span></span>
<span data-ttu-id="c8662-152">O acesso é concedido atribuindo-se a função RBAC apropriada a usuários, grupos e aplicativos no escopo correto.</span><span class="sxs-lookup"><span data-stu-id="c8662-152">Access is granted by assigning the appropriate RBAC role to users, groups, and applications, at the right scope.</span></span> <span data-ttu-id="c8662-153">Para conceder acesso à assinatura inteira, você atribui uma função no nível de assinatura.</span><span class="sxs-lookup"><span data-stu-id="c8662-153">To grant access to the entire subscription, you assign a role at the subscription level.</span></span> <span data-ttu-id="c8662-154">É possível conceder acesso a todos os recursos em um grupo de recursos concedendo permissões ao próprio grupo de recursos.</span><span class="sxs-lookup"><span data-stu-id="c8662-154">You can grant access to all of the resources in a resource group by granting permissions to the resource group itself.</span></span> <span data-ttu-id="c8662-155">Você também pode atribuir funções específicas a recursos específicos, como contas de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-155">You can also assign specific roles to specific resources, such as storage accounts.</span></span>

<span data-ttu-id="c8662-156">Veja os principais pontos que você precisa saber sobre como usar o RBAC para acessar as operações de gerenciamento de uma conta de armazenamento do Azure:</span><span class="sxs-lookup"><span data-stu-id="c8662-156">Here are the main points that you need to know about using RBAC to access the management operations of an Azure Storage account:</span></span>

* <span data-ttu-id="c8662-157">Ao atribuir acesso, você basicamente atribui uma função à conta que você quer ter acesso.</span><span class="sxs-lookup"><span data-stu-id="c8662-157">When you assign access, you basically assign a role to the account that you want to have access.</span></span> <span data-ttu-id="c8662-158">Você pode controlar o acesso às operações usadas para gerenciar essa conta de armazenamento, mas não aos objetos de dados da conta.</span><span class="sxs-lookup"><span data-stu-id="c8662-158">You can control access to the operations used to manage that storage account, but not to the data objects in the account.</span></span> <span data-ttu-id="c8662-159">Por exemplo, é possível conceder permissão para recuperar as propriedades da conta de armazenamento (como a redundância), mas não a um contêiner ou dados dentro de um contêiner no Armazenamento de Blobs.</span><span class="sxs-lookup"><span data-stu-id="c8662-159">For example, you can grant permission to retrieve the properties of the storage account (such as redundancy), but not to a container or data within a container inside Blob Storage.</span></span>
* <span data-ttu-id="c8662-160">Para que alguém tenha permissão para acessar os objetos de dados na conta de armazenamento, você pode conceder a ele permissão para ler as chaves da conta de armazenamento, e esse usuário poderá então usar essas chaves para acessar os blobs, as filas, as tabelas e os arquivos.</span><span class="sxs-lookup"><span data-stu-id="c8662-160">For someone to have permission to access the data objects in the storage account, you can give them permission to read the storage account keys, and that user can then use those keys to access the blobs, queues, tables, and files.</span></span>
* <span data-ttu-id="c8662-161">As funções podem ser atribuídas a uma conta de usuário específica, a um grupo de usuários ou a um aplicativo específico.</span><span class="sxs-lookup"><span data-stu-id="c8662-161">Roles can be assigned to a specific user account, a group of users, or to a specific application.</span></span>
* <span data-ttu-id="c8662-162">Cada função tem uma lista de Ações e de Não Ações.</span><span class="sxs-lookup"><span data-stu-id="c8662-162">Each role has a list of Actions and Not Actions.</span></span> <span data-ttu-id="c8662-163">Por exemplo, a função Colaborador de Máquina Virtual tem uma Ação de "listKeys" que permite que as chaves da conta de armazenamento sejam lidas.</span><span class="sxs-lookup"><span data-stu-id="c8662-163">For example, the Virtual Machine Contributor role has an Action of "listKeys" that allows the storage account keys to be read.</span></span> <span data-ttu-id="c8662-164">O Colaborador tem "Não Ações", tais como atualizar o acesso de usuários no Active Directory.</span><span class="sxs-lookup"><span data-stu-id="c8662-164">The Contributor has "Not Actions" such as updating the access for users in the Active Directory.</span></span>
* <span data-ttu-id="c8662-165">As funções de armazenamento incluem (entre outras):</span><span class="sxs-lookup"><span data-stu-id="c8662-165">Roles for storage include (but are not limited to) the following:</span></span>

  * <span data-ttu-id="c8662-166">Proprietário – ele pode gerenciar tudo, inclusive o acesso.</span><span class="sxs-lookup"><span data-stu-id="c8662-166">Owner – They can manage everything, including access.</span></span>
  * <span data-ttu-id="c8662-167">Colaborador – ele pode fazer tudo que o proprietário pode fazer, menos atribuir acesso.</span><span class="sxs-lookup"><span data-stu-id="c8662-167">Contributor – They can do anything the owner can do except assign access.</span></span> <span data-ttu-id="c8662-168">Alguém com essa função pode exibir e regenerar as chaves da conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-168">Someone with this role can view and regenerate the storage account keys.</span></span> <span data-ttu-id="c8662-169">Com as chaves da conta de armazenamento, ele pode acessar os objetos de dados.</span><span class="sxs-lookup"><span data-stu-id="c8662-169">With the storage account keys, they can access the data objects.</span></span>
  * <span data-ttu-id="c8662-170">Leitor – ele pode exibir informações sobre a conta de armazenamento, exceto os segredos.</span><span class="sxs-lookup"><span data-stu-id="c8662-170">Reader – They can view information about the storage account, except secrets.</span></span> <span data-ttu-id="c8662-171">Por exemplo, se você atribuir a alguém uma função com permissões de leitor na conta de armazenamento, ele poderá exibir as propriedades da conta de armazenamento, mas não poderá fazer alterações nas propriedades nem exibir as chaves da conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-171">For example, if you assign a role with reader permissions on the storage account to someone, they can view the properties of the storage account, but they can't make any changes to the properties or view the storage account keys.</span></span>
  * <span data-ttu-id="c8662-172">Colaborador da Conta de Armazenamento – ele pode gerenciar a conta de armazenamento; ele pode ler os grupos de recursos e os recursos da assinatura, bem como criar e gerenciar implantações de grupo de recursos da assinatura.</span><span class="sxs-lookup"><span data-stu-id="c8662-172">Storage Account Contributor – They can manage the storage account – they can read the subscription's resource groups and resources, and create and manage subscription resource group deployments.</span></span> <span data-ttu-id="c8662-173">Eles também podem acessar as chaves da conta de armazenamento que, por sua vez, significa que eles podem acessar o plano de dados.</span><span class="sxs-lookup"><span data-stu-id="c8662-173">They can also access the storage account keys, which in turn means they can access the data plane.</span></span>
  * <span data-ttu-id="c8662-174">Administrador de Acesso do Usuário – ele pode gerenciar o acesso do usuário à conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-174">User Access Administrator – They can manage user access to the storage account.</span></span> <span data-ttu-id="c8662-175">Por exemplo, ele pode conceder acesso de Leitor a um usuário específico.</span><span class="sxs-lookup"><span data-stu-id="c8662-175">For example, they can grant Reader access to a specific user.</span></span>
  * <span data-ttu-id="c8662-176">Colaborador de Máquina Virtual – ele pode gerenciar máquinas virtuais, mas não a conta de armazenamento à qual ele está conectado.</span><span class="sxs-lookup"><span data-stu-id="c8662-176">Virtual Machine Contributor – They can manage virtual machines but not the storage account to which they are connected.</span></span> <span data-ttu-id="c8662-177">Essa função pode listar as chaves da conta de armazenamento, o que significa que o usuário a quem você atribui essa função pode atualizar o plano de dados.</span><span class="sxs-lookup"><span data-stu-id="c8662-177">This role can list the storage account keys, which means that the user to whom you assign this role can update the data plane.</span></span>

    <span data-ttu-id="c8662-178">Para que um usuário crie uma máquina virtual, ele deve poder criar o arquivo VHD correspondente em uma conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-178">In order for a user to create a virtual machine, they have to be able to create the corresponding VHD file in a storage account.</span></span> <span data-ttu-id="c8662-179">Para fazer isso, ele precisa poder recuperar a chave da conta de armazenamento e passá-la à API que está criando a VM.</span><span class="sxs-lookup"><span data-stu-id="c8662-179">To do that, they need to be able to retrieve the storage account key and pass it to the API creating the VM.</span></span> <span data-ttu-id="c8662-180">Portanto, ele deve ter essa permissão para que possa listar as chaves da conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-180">Therefore, they must have this permission so they can list the storage account keys.</span></span>
* <span data-ttu-id="c8662-181">A capacidade de definir funções personalizadas é um recurso que permite compor um conjunto de ações usando uma lista de ações disponíveis que podem ser executadas nos recursos do Azure.</span><span class="sxs-lookup"><span data-stu-id="c8662-181">The ability to define custom roles is a feature that allows you to compose a set of actions from a list of available actions that can be performed on Azure resources.</span></span>
* <span data-ttu-id="c8662-182">O usuário precisa ser configurado no Azure Active Directory antes de você atribuir uma função a ele.</span><span class="sxs-lookup"><span data-stu-id="c8662-182">The user has to be set up in your Azure Active Directory before you can assign a role to them.</span></span>
* <span data-ttu-id="c8662-183">Usando o PowerShell ou a CLI do Azure, você pode criar um relatório de quem concedeu/revogou que tipo de acesso a/de quem e em que escopo.</span><span class="sxs-lookup"><span data-stu-id="c8662-183">You can create a report of who granted/revoked what kind of access to/from whom and on what scope using PowerShell or the Azure CLI.</span></span>

#### <a name="resources"></a><span data-ttu-id="c8662-184">Recursos</span><span class="sxs-lookup"><span data-stu-id="c8662-184">Resources</span></span>
* [<span data-ttu-id="c8662-185">Controle de acesso baseado em função do Active Directory do Azure</span><span class="sxs-lookup"><span data-stu-id="c8662-185">Azure Active Directory Role-based Access Control</span></span>](../../active-directory/role-based-access-control-configure.md)

  <span data-ttu-id="c8662-186">Esse artigo explica o Controle de Acesso Baseado em Função do Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="c8662-186">This article explains the Azure Active Directory Role-based Access Control and how it works.</span></span>
* [<span data-ttu-id="c8662-187">RBAC: funções internas</span><span class="sxs-lookup"><span data-stu-id="c8662-187">RBAC: Built in Roles</span></span>](../../active-directory/role-based-access-built-in-roles.md)

  <span data-ttu-id="c8662-188">Esse artigo detalha todas as funções disponíveis internas no RBAC.</span><span class="sxs-lookup"><span data-stu-id="c8662-188">This article details all of the built-in roles available in RBAC.</span></span>
* [<span data-ttu-id="c8662-189">Noções básicas sobre a implantação do Gerenciador de Recursos e a implantação clássica</span><span class="sxs-lookup"><span data-stu-id="c8662-189">Understanding Resource Manager deployment and classic deployment</span></span>](../../azure-resource-manager/resource-manager-deployment-model.md)

  <span data-ttu-id="c8662-190">Esse artigo explica os modelos de implantação clássica e implantação Resource Manager, além de explicar os benefícios de usar o Resource Manager e os grupos de recursos.</span><span class="sxs-lookup"><span data-stu-id="c8662-190">This article explains the Resource Manager deployment and classic deployment models, and explains the benefits of using the Resource Manager and resource groups.</span></span> <span data-ttu-id="c8662-191">Explica como os Provedores de Computação, Rede e Armazenamento do Azure funcionam no modelo do Gerenciador de Recursos.</span><span class="sxs-lookup"><span data-stu-id="c8662-191">It explains how the Azure Compute, Network, and Storage Providers work under the Resource Manager model.</span></span>
* [<span data-ttu-id="c8662-192">Gerenciar o controle de acesso com base em função com a API REST</span><span class="sxs-lookup"><span data-stu-id="c8662-192">Managing Role-Based Access Control with the REST API</span></span>](../../active-directory/role-based-access-control-manage-access-rest.md)

  <span data-ttu-id="c8662-193">Esse artigo mostra como usar a API REST para gerenciar o RBAC.</span><span class="sxs-lookup"><span data-stu-id="c8662-193">This article shows how to use the REST API to manage RBAC.</span></span>
* [<span data-ttu-id="c8662-194">Azure Storage Resource Provider REST API Reference (Referência à API REST do provedor de recursos de armazenamento do Azure)</span><span class="sxs-lookup"><span data-stu-id="c8662-194">Azure Storage Resource Provider REST API Reference</span></span>](https://msdn.microsoft.com/library/azure/mt163683.aspx)

  <span data-ttu-id="c8662-195">Essa é a referência das APIs que você pode usar para gerenciar sua conta de armazenamento de modo programático.</span><span class="sxs-lookup"><span data-stu-id="c8662-195">This is the reference for the APIs you can use to manage your storage account programmatically.</span></span>
* [<span data-ttu-id="c8662-196">Developer’s guide to auth with Azure Resource Manager API (Guia do desenvolvedor para autenticação com a API do Azure Resource Manager)</span><span class="sxs-lookup"><span data-stu-id="c8662-196">Developer's guide to auth with Azure Resource Manager API</span></span>](http://www.dushyantgill.com/blog/2015/05/23/developers-guide-to-auth-with-azure-resource-manager-api/)

  <span data-ttu-id="c8662-197">Este artigo mostra como autenticar usando as APIs do Gerenciador de Recursos.</span><span class="sxs-lookup"><span data-stu-id="c8662-197">This article shows how to authenticate using the Resource Manager APIs.</span></span>
* [<span data-ttu-id="c8662-198">Role-Based Access Control for Microsoft Azure from Ignite (Controle de Acesso Baseado em Função do Microsoft Azure do Ignite)</span><span class="sxs-lookup"><span data-stu-id="c8662-198">Role-Based Access Control for Microsoft Azure from Ignite</span></span>](https://channel9.msdn.com/events/Ignite/2015/BRK2707)

  <span data-ttu-id="c8662-199">Este é um link para um vídeo da conferência MS Ignite de 2015, no Channel 9.</span><span class="sxs-lookup"><span data-stu-id="c8662-199">This is a link to a video on Channel 9 from the 2015 MS Ignite conference.</span></span> <span data-ttu-id="c8662-200">Nessa sessão, falam sobre gerenciamento de acesso e recursos de relatório no Azure, além de explorar práticas recomendadas em torno de proteção do acesso às assinaturas do Azure usando o Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="c8662-200">In this session, they talk about access management and reporting capabilities in Azure, and explore best practices around securing access to Azure subscriptions using Azure Active Directory.</span></span>

### <a name="managing-your-storage-account-keys"></a><span data-ttu-id="c8662-201">Gerenciando as chaves da conta de armazenamento</span><span class="sxs-lookup"><span data-stu-id="c8662-201">Managing Your Storage Account Keys</span></span>
<span data-ttu-id="c8662-202">As chaves da conta de armazenamento são cadeias de caracteres de 512 bits criadas pelo Azure que, com o nome da conta de armazenamento, podem ser usadas para acessar os objetos de dados armazenados na conta de armazenamento, por exemplo, blobs, entidades em uma tabela, mensagens na fila e arquivos em um Compartilhamento de Arquivos do Azure.</span><span class="sxs-lookup"><span data-stu-id="c8662-202">Storage account keys are 512-bit strings created by Azure that, along with the storage account name, can be used to access the data objects stored in the storage account, e.g. blobs, entities within a table, queue messages, and files on an Azure File share.</span></span> <span data-ttu-id="c8662-203">O controle do acesso às chaves da conta de armazenamento controla o acesso ao plano de dados dessa conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-203">Controlling access to the storage account keys controls access to the data plane for that storage account.</span></span>

<span data-ttu-id="c8662-204">Cada conta de armazenamento tem duas chaves, conhecidas como "Chave 1" e "Chave 2" no [Portal do Azure](http://portal.azure.com/) e nos cmdlets do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="c8662-204">Each storage account has two keys referred to as "Key 1" and "Key 2" in the [Azure portal](http://portal.azure.com/) and in the PowerShell cmdlets.</span></span> <span data-ttu-id="c8662-205">Elas podem ser regeneradas manualmente usando um dos vários métodos, incluindo, entre outros, o [Portal do Azure](https://portal.azure.com/), o PowerShell, a CLI do Azure ou, de modo programático, a Biblioteca de Cliente de Armazenamento .NET ou a API REST dos Serviços de Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="c8662-205">These can be regenerated manually using one of several methods, including, but not limited to using the [Azure portal](https://portal.azure.com/), PowerShell, the Azure CLI, or programmatically using the .NET Storage Client Library or the Azure Storage Services REST API.</span></span>

<span data-ttu-id="c8662-206">Há vários motivos para regenerar suas chaves da conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-206">There are any number of reasons to regenerate your storage account keys.</span></span>

* <span data-ttu-id="c8662-207">Você pode regenerá-las regularmente por motivos de segurança.</span><span class="sxs-lookup"><span data-stu-id="c8662-207">You might regenerate them on a regular basis for security reasons.</span></span>
* <span data-ttu-id="c8662-208">Você poderia regenerar as chaves da conta de armazenamento se alguém conseguisse invadir um aplicativo e acessasse a chave que estava codificada ou salva em um arquivo de configuração, dando a ele acesso completo à sua conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-208">You would regenerate your storage account keys if someone managed to hack into an application and retrieve the key that was hardcoded or saved in a configuration file, giving them full access to your storage account.</span></span>
* <span data-ttu-id="c8662-209">Outro caso para nova geração de chave é se sua equipe estivesse usando um aplicativo Gerenciador de Armazenamento que mantivesse a chave da conta de armazenamento e um dos membros da equipe saísse.</span><span class="sxs-lookup"><span data-stu-id="c8662-209">Another case for key regeneration is if your team is using a Storage Explorer application that retains the storage account key, and one of the team members leaves.</span></span> <span data-ttu-id="c8662-210">O aplicativo continuaria funcionando, dando a ele acesso à sua conta de armazenamento depois que ele fosse embora.</span><span class="sxs-lookup"><span data-stu-id="c8662-210">The application would continue to work, giving them access to your storage account after they're gone.</span></span> <span data-ttu-id="c8662-211">Na verdade, esse é o principal motivo para a criação das Assinaturas de Acesso Compartilhado de nível de conta – você pode usar uma SAS de nível de conta em vez de armazenar as chaves de acesso em um arquivo de configuração.</span><span class="sxs-lookup"><span data-stu-id="c8662-211">This is actually the primary reason they created account-level Shared Access Signatures – you can use an account-level SAS instead of storing the access keys in a configuration file.</span></span>

#### <a name="key-regeneration-plan"></a><span data-ttu-id="c8662-212">Plano de nova geração de chave</span><span class="sxs-lookup"><span data-stu-id="c8662-212">Key regeneration plan</span></span>
<span data-ttu-id="c8662-213">Você não desejará apenas regenerar a chave que está usando sem nenhum planejamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-213">You don't want to just regenerate the key you are using without some planning.</span></span> <span data-ttu-id="c8662-214">Se fizer isso, você poderá cortar todo o acesso a essa conta de armazenamento, o que pode causar uma grande interrupção.</span><span class="sxs-lookup"><span data-stu-id="c8662-214">If you do that, you could cut off all access to that storage account, which can cause major disruption.</span></span> <span data-ttu-id="c8662-215">É por isso que há duas chaves.</span><span class="sxs-lookup"><span data-stu-id="c8662-215">This is why there are two keys.</span></span> <span data-ttu-id="c8662-216">Você deve regenerar uma chave de cada vez.</span><span class="sxs-lookup"><span data-stu-id="c8662-216">You should regenerate one key at a time.</span></span>

<span data-ttu-id="c8662-217">Antes de regenerar suas chaves, certifique-se de que tenha uma lista de todos os seus aplicativos que dependem da conta de armazenamento, bem como de todos os outros serviços que está usando no Azure.</span><span class="sxs-lookup"><span data-stu-id="c8662-217">Before you regenerate your keys, be sure you have a list of all of your applications that are dependent on the storage account, as well as any other services you are using in Azure.</span></span> <span data-ttu-id="c8662-218">Por exemplo, se você estiver usando os Serviços de Mídia do Azure que dependem da sua conta de armazenamento, será preciso ressincronizar as chaves de acesso com o serviço de mídia depois de regenerar a chave.</span><span class="sxs-lookup"><span data-stu-id="c8662-218">For example, if you are using Azure Media Services that are dependent on your storage account, you must re-sync the access keys with your media service after you regenerate the key.</span></span> <span data-ttu-id="c8662-219">Se estiver usando quaisquer aplicativos, como um Explorador de Armazenamento, você precisará fornecer as novas chaves para esses aplicativos também.</span><span class="sxs-lookup"><span data-stu-id="c8662-219">If you are using any applications such as a storage explorer, you will need to provide the new keys to those applications as well.</span></span> <span data-ttu-id="c8662-220">Observe que se você tiver VMs cujos arquivos VHD são armazenados na conta de armazenamento, eles não serão afetados pela regeneração das chaves da conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-220">Note that if you have VMs whose VHD files are stored in the storage account, they will not be affected by regenerating the storage account keys.</span></span>

<span data-ttu-id="c8662-221">É possível regenerar suas chaves no Portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="c8662-221">You can regenerate your keys in the Azure portal.</span></span> <span data-ttu-id="c8662-222">Depois que as chaves forem regeneradas, elas poderão levar até 10 minutos para serem sincronizadas entre os Serviços de Armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-222">Once keys are regenerated they can take up to 10 minutes to be synchronized across Storage Services.</span></span>

<span data-ttu-id="c8662-223">Quando você estiver pronto, aqui está o processo geral que detalha como você deve alterar sua chave.</span><span class="sxs-lookup"><span data-stu-id="c8662-223">When you're ready, here's the general process detailing how you should change your key.</span></span> <span data-ttu-id="c8662-224">Nesse caso, a suposição é a de que você esteja usando no momento a Chave 1 e que vai mudar tudo para usar a Chave 2 no lugar.</span><span class="sxs-lookup"><span data-stu-id="c8662-224">In this case, the assumption is that you are currently using Key 1 and you are going to change everything to use Key 2 instead.</span></span>

1. <span data-ttu-id="c8662-225">Regenere a Chave 2 para garantir que ela seja protegida.</span><span class="sxs-lookup"><span data-stu-id="c8662-225">Regenerate Key 2 to ensure that it is secure.</span></span> <span data-ttu-id="c8662-226">Você pode fazer isso no Portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="c8662-226">You can do this in the Azure portal.</span></span>
2. <span data-ttu-id="c8662-227">Em todos os aplicativos em que a chave de armazenamento é armazenada, altere a chave de armazenamento para usar o novo valor da Chave 2.</span><span class="sxs-lookup"><span data-stu-id="c8662-227">In all of the applications where the storage key is stored, change the storage key to use Key 2's new value.</span></span> <span data-ttu-id="c8662-228">Teste e publique o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c8662-228">Test and publish the application.</span></span>
3. <span data-ttu-id="c8662-229">Depois que todos os aplicativos e serviços estiverem funcionando perfeitamente, regenere a Chave 1.</span><span class="sxs-lookup"><span data-stu-id="c8662-229">After all of the applications and services are up and running successfully, regenerate Key 1.</span></span> <span data-ttu-id="c8662-230">Isso garante que qualquer pessoa a quem você não concedeu expressamente a nova chave não terá mais acesso à conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-230">This ensures that anybody to whom you have not expressly given the new key will no longer have access to the storage account.</span></span>

<span data-ttu-id="c8662-231">Se, no momento, você estiver usando a Chave 2, será possível usar o mesmo processo, mas inverta os nomes das chaves.</span><span class="sxs-lookup"><span data-stu-id="c8662-231">If you are currently using Key 2, you can use the same process, but reverse the key names.</span></span>

<span data-ttu-id="c8662-232">É possível fazer a migração em dois dias, alterando cada aplicativo para usar a nova chave e publicando-o.</span><span class="sxs-lookup"><span data-stu-id="c8662-232">You can migrate over a couple of days, changing each application to use the new key and publishing it.</span></span> <span data-ttu-id="c8662-233">Depois de fazer isso com todos, você deverá voltar e regenerar a chave antiga, pois ela não funciona mais.</span><span class="sxs-lookup"><span data-stu-id="c8662-233">After all of them are done, you should then go back and regenerate the old key so it no longer works.</span></span>

<span data-ttu-id="c8662-234">Outra opção é colocar a chave de conta de armazenamento em um [Cofre de Chaves do Azure](https://azure.microsoft.com/services/key-vault/) como um segredo e fazer com que os aplicativos recuperam a chave de lá.</span><span class="sxs-lookup"><span data-stu-id="c8662-234">Another option is to put the storage account key in an [Azure Key Vault](https://azure.microsoft.com/services/key-vault/) as a secret and have your applications retrieve the key from there.</span></span> <span data-ttu-id="c8662-235">Assim, quando você regenerar a chave e atualizar o Cofre de Chaves do Azure, os aplicativos não precisarão ser reimplantados porque eles selecionarão a nova chave no Cofre de Chaves do Azure automaticamente.</span><span class="sxs-lookup"><span data-stu-id="c8662-235">Then when you regenerate the key and update the Azure Key Vault, the applications will not need to be redeployed because they will pick up the new key from the Azure Key Vault automatically.</span></span> <span data-ttu-id="c8662-236">Observe que você pode fazer com que o aplicativo leia a chave toda vez que for preciso ou pode armazená-la em cache na memória e, caso ela falhe na hora que você for usá-la, recupere-a novamente no Cofre de Chaves do Azure.</span><span class="sxs-lookup"><span data-stu-id="c8662-236">Note that you can have the application read the key each time you need it, or you can cache it in memory and if it fails when using it, retrieve the key again from the Azure Key Vault.</span></span>

<span data-ttu-id="c8662-237">Usar o Cofre de Chaves do Azure também acrescenta outro nível de segurança para suas chaves de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-237">Using Azure Key Vault also adds another level of security for your storage keys.</span></span> <span data-ttu-id="c8662-238">Ao usar esse método, você nunca terá a chave de armazenamento codificada em um arquivo de configuração, o que remove a possibilidade de alguém obter acesso às chaves sem permissão específica.</span><span class="sxs-lookup"><span data-stu-id="c8662-238">If you use this method, you will never have the storage key hardcoded in a configuration file, which removes that avenue of somebody getting access to the keys without specific permission.</span></span>

<span data-ttu-id="c8662-239">Outra vantagem de usar o Cofre de Chaves do Azure é que você também pode controlar o acesso às suas chaves usando o Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="c8662-239">Another advantage of using Azure Key Vault is you can also control access to your keys using Azure Active Directory.</span></span> <span data-ttu-id="c8662-240">Isso significa que é possível conceder acesso a um punhado de aplicativos que precisam recuperar as chaves no Cofre de Chaves do Azure e saber que outros aplicativos não poderão acessar as chaves sem que você conceda especificamente permissão a eles.</span><span class="sxs-lookup"><span data-stu-id="c8662-240">This means you can grant access to the handful of applications that need to retrieve the keys from Azure Key Vault, and know that other applications will not be able to access the keys without granting them permission specifically.</span></span>

<span data-ttu-id="c8662-241">Observação: é recomendável usar apenas uma das chaves em todos os aplicativos ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="c8662-241">Note: it is recommended to use only one of the keys in all of your applications at the same time.</span></span> <span data-ttu-id="c8662-242">Se você usar a Chave 1 em alguns lugares e a Chave 2 em outros, nãos será possível alternar as chaves sem que algum aplicativo perca o acesso.</span><span class="sxs-lookup"><span data-stu-id="c8662-242">If you use Key 1 in some places and Key 2 in others, you will not be able to rotate your keys without some application losing access.</span></span>

#### <a name="resources"></a><span data-ttu-id="c8662-243">Recursos</span><span class="sxs-lookup"><span data-stu-id="c8662-243">Resources</span></span>
* [<span data-ttu-id="c8662-244">Sobre as contas de armazenamento do Azure</span><span class="sxs-lookup"><span data-stu-id="c8662-244">About Azure Storage Accounts</span></span>](storage-create-storage-account.md#regenerate-storage-access-keys)

  <span data-ttu-id="c8662-245">Esse artigo fornece uma visão geral das contas de armazenamento e aborda a exibição, a cópia e a regeneração das chaves de acesso de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-245">This article gives an overview of storage accounts and discusses viewing, copying, and regenerating storage access keys.</span></span>
* [<span data-ttu-id="c8662-246">Azure Storage Resource Provider REST API Reference (Referência à API REST do provedor de recursos de armazenamento do Azure)</span><span class="sxs-lookup"><span data-stu-id="c8662-246">Azure Storage Resource Provider REST API Reference</span></span>](https://msdn.microsoft.com/library/mt163683.aspx)

  <span data-ttu-id="c8662-247">Esse artigo contém links para artigos específicos sobre como recuperar as chaves da conta de armazenamento e como regenerar as chaves da conta de armazenamento para uma Conta do Azure usando a API REST.</span><span class="sxs-lookup"><span data-stu-id="c8662-247">This article contains links to specific articles about retrieving the storage account keys and regenerating the storage account keys for an Azure Account using the REST API.</span></span> <span data-ttu-id="c8662-248">Observação: isto é para as contas de armazenamento do Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="c8662-248">Note: This is for  Resource Manager storage accounts.</span></span>
* [<span data-ttu-id="c8662-249">Operations on storage accounts (Operações nas contas de armazenamento)</span><span class="sxs-lookup"><span data-stu-id="c8662-249">Operations on storage accounts</span></span>](https://msdn.microsoft.com/library/ee460790.aspx)

  <span data-ttu-id="c8662-250">Esse artigo na Referência da API REST do Gerenciador de Serviço de Armazenamento contém links para artigos específicos sobre recuperação e regeneração das chaves da conta de armazenamento usando a API REST.</span><span class="sxs-lookup"><span data-stu-id="c8662-250">This article in the Storage Service Manager REST API Reference contains links to specific articles on retrieving and regenerating the storage account keys using the REST API.</span></span> <span data-ttu-id="c8662-251">Observação: isso se aplica às contas de armazenamento da implantação Clássica.</span><span class="sxs-lookup"><span data-stu-id="c8662-251">Note: This is for the Classic storage accounts.</span></span>
* [<span data-ttu-id="c8662-252">Say goodbye to key management – manage access to Azure Storage data using Azure AD (Diga adeus ao gerenciamento de chaves – gerencie o acesso aos dados do Armazenamento do Azure usando o Azure AD)</span><span class="sxs-lookup"><span data-stu-id="c8662-252">Say goodbye to key management – manage access to Azure Storage data using Azure AD</span></span>](http://www.dushyantgill.com/blog/2015/04/26/say-goodbye-to-key-management-manage-access-to-azure-storage-data-using-azure-ad/)

  <span data-ttu-id="c8662-253">Esse artigo mostra como usar o Active Directory para controlar o acesso às chaves de Armazenamento do Azure no Cofre de Chaves do Azure.</span><span class="sxs-lookup"><span data-stu-id="c8662-253">This article shows how to use Active Directory to control access to your Azure Storage keys in Azure Key Vault.</span></span> <span data-ttu-id="c8662-254">Ele também mostra como usar um trabalho de Automação do Azure para regenerar as chaves por hora.</span><span class="sxs-lookup"><span data-stu-id="c8662-254">It also shows how to use an Azure Automation job to regenerate the keys on an hourly basis.</span></span>

## <a name="data-plane-security"></a><span data-ttu-id="c8662-255">Segurança do plano de dados</span><span class="sxs-lookup"><span data-stu-id="c8662-255">Data Plane Security</span></span>
<span data-ttu-id="c8662-256">A Segurança do Plano de Dados refere-se aos métodos usados para proteger os objetos de dados armazenados no Armazenamento do Azure – blobs, filas, tabelas e arquivos.</span><span class="sxs-lookup"><span data-stu-id="c8662-256">Data Plane Security refers to the methods used to secure the data objects stored in Azure Storage – the blobs, queues, tables, and files.</span></span> <span data-ttu-id="c8662-257">Já vimos métodos para criptografar os dados e a segurança durante a transferência de dados. Mas e quanto a permitir acesso aos objetos?</span><span class="sxs-lookup"><span data-stu-id="c8662-257">We've seen methods to encrypt the data and security during transit of the data, but how do you go about allowing access to the objects?</span></span>

<span data-ttu-id="c8662-258">Basicamente, há dois métodos para controlar o acesso aos objetos de dados em si.</span><span class="sxs-lookup"><span data-stu-id="c8662-258">There are basically two methods for controlling access to the data objects themselves.</span></span> <span data-ttu-id="c8662-259">O primeiro é controlando o acesso às chaves da conta de armazenamento e o segundo é usando as Assinaturas de Acesso Compartilhado para conceder acesso a objetos de dados específicos por um período específico.</span><span class="sxs-lookup"><span data-stu-id="c8662-259">The first is by controlling access to the storage account keys, and the second is using Shared Access Signatures to grant access to specific data objects for a specific amount of time.</span></span>

<span data-ttu-id="c8662-260">Uma exceção a ser observada é que você pode permitir acesso público aos seus blobs definindo o nível de acesso adequadamente para o contêiner que mantém os blobs.</span><span class="sxs-lookup"><span data-stu-id="c8662-260">One exception to note is that you can allow public access to your blobs by setting the access level for the container that holds the blobs accordingly.</span></span> <span data-ttu-id="c8662-261">Se você definir o acesso de um contêiner para Blob ou Contêiner, isso permitirá acesso público de leitura para os blobs desse contêiner.</span><span class="sxs-lookup"><span data-stu-id="c8662-261">If you set access for a container to Blob or Container, it will allow public read access for the blobs in that container.</span></span> <span data-ttu-id="c8662-262">Isso significa que qualquer pessoa com uma URL apontando para um blob nesse contêiner poderá abri-lo em um navegador sem usar uma Assinatura de Acesso Compartilhado ou sem ter as chaves da conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-262">This means anyone with a URL pointing to a blob in that container can open it in a browser without using a Shared Access Signature or having the storage account keys.</span></span>

### <a name="storage-account-keys"></a><span data-ttu-id="c8662-263">Chaves da conta de armazenamento</span><span class="sxs-lookup"><span data-stu-id="c8662-263">Storage Account Keys</span></span>
<span data-ttu-id="c8662-264">As chaves da conta de armazenamento são cadeias de caracteres de 512 bits criadas pelo Azure que, com o nome da conta de armazenamento, podem ser usadas para acessar os objetos de dados armazenados na conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-264">Storage account keys are 512-bit strings created by Azure that, along with the storage account name, can be used to access the data objects stored in the storage account.</span></span>

<span data-ttu-id="c8662-265">Por exemplo, você pode ler blobs, gravar nas filas, criar tabelas e modificar arquivos.</span><span class="sxs-lookup"><span data-stu-id="c8662-265">For example, you can read blobs, write to queues, create tables, and modify files.</span></span> <span data-ttu-id="c8662-266">Muitas dessas ações podem ser executadas no Portal do Azure ou usando um dos muitos aplicativos do Gerenciador de Armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-266">Many of these actions can be performed through the Azure portal, or using one of many Storage Explorer applications.</span></span> <span data-ttu-id="c8662-267">Você também pode escrever código para usar a API REST ou uma das Bibliotecas de Cliente de Armazenamento para executar essas operações.</span><span class="sxs-lookup"><span data-stu-id="c8662-267">You can also write code to use the REST API or one of the Storage Client Libraries to perform these operations.</span></span>

<span data-ttu-id="c8662-268">Conforme discutido na seção sobre [Segurança do plano de gerenciamento](#management-plane-security), o acesso às chaves de armazenamento para uma conta de armazenamento Clássica pode ser concedido dando acesso completo à assinatura do Azure.</span><span class="sxs-lookup"><span data-stu-id="c8662-268">As discussed in the section on the [Management Plane Security](#management-plane-security), access to the storage keys for a Classic storage account can be granted by giving full access to the Azure subscription.</span></span> <span data-ttu-id="c8662-269">O acesso às chaves de armazenamento para uma conta de armazenamento usando o modelo Azure Resource Manager pode ser controlado por meio do RBAC (Controle de Acesso Baseado em Função).</span><span class="sxs-lookup"><span data-stu-id="c8662-269">Access to the storage keys for a storage account using the Azure Resource Manager model can be controlled through Role-Based Access Control (RBAC).</span></span>

### <a name="how-to-delegate-access-to-objects-in-your-account-using-shared-access-signatures-and-stored-access-policies"></a><span data-ttu-id="c8662-270">Como delegar acesso a objetos em sua conta usando Assinaturas de Acesso Compartilhado e Políticas de Acesso Armazenado</span><span class="sxs-lookup"><span data-stu-id="c8662-270">How to delegate access to objects in your account using Shared Access Signatures and Stored Access Policies</span></span>
<span data-ttu-id="c8662-271">Uma Assinatura de Acesso Compartilhado é uma cadeia de caracteres que contém um token de segurança que pode ser anexado a um URI que permite delegar acesso aos objetos de armazenamento e especificar restrições, como as permissões e o intervalo de data/hora de acesso.</span><span class="sxs-lookup"><span data-stu-id="c8662-271">A Shared Access Signature is a string containing a security token that can be attached to a URI that allows you to delegate access to storage objects and specify constraints such as the permissions and the date/time range of access.</span></span>

<span data-ttu-id="c8662-272">Você pode conceder acesso a blobs, contêineres, mensagens de fila, arquivos e tabelas.</span><span class="sxs-lookup"><span data-stu-id="c8662-272">You can grant access to blobs, containers, queue messages, files, and tables.</span></span> <span data-ttu-id="c8662-273">Com tabelas, na verdade, você pode conceder permissão para acessar um intervalo de entidades na tabela especificando os intervalos de chaves de linha e partição ao quais você quer que o usuário tenha acesso.</span><span class="sxs-lookup"><span data-stu-id="c8662-273">With tables, you can actually grant permission to access a range of entities in the table by specifying the partition and row key ranges to which you want the user to have access.</span></span> <span data-ttu-id="c8662-274">Por exemplo, se você tiver dados armazenados com uma chave de partição de estado geográfico, será possível conceder a alguém acesso apenas aos dados da Califórnia.</span><span class="sxs-lookup"><span data-stu-id="c8662-274">For example, if you have data stored with a partition key of geographical state, you could give someone access to just the data for California.</span></span>

<span data-ttu-id="c8662-275">Em outro exemplo, você pode fornecer a um aplicativo Web um token SAS que o permita gravar entradas em uma fila, bem como fornecer a um aplicativo de função de trabalho um token SAS para obter mensagens da fila e processá-las.</span><span class="sxs-lookup"><span data-stu-id="c8662-275">In another example, you might give a web application a SAS token that enables it to write entries to a queue, and give a worker role application a SAS token to get messages from the queue and process them.</span></span> <span data-ttu-id="c8662-276">Ou você pode fornecer a um cliente um token SAS que ele pode usar para carregar imagens em um contêiner no Armazenamento de Blobs, bem como fornecer a um aplicativo Web permissão para ler essas imagens.</span><span class="sxs-lookup"><span data-stu-id="c8662-276">Or you could give one customer a SAS token they can use to upload pictures to a container in Blob Storage, and give a web application permission to read those pictures.</span></span> <span data-ttu-id="c8662-277">Em ambos os casos, há uma separação de interesses – cada aplicativo pode receber apenas o acesso que eles precisam para realizar as respectivas tarefas.</span><span class="sxs-lookup"><span data-stu-id="c8662-277">In both cases, there is a separation of concerns – each application can be given just the access that they require in order to perform their task.</span></span> <span data-ttu-id="c8662-278">Isso é possível graças às Assinaturas de Acesso Compartilhado.</span><span class="sxs-lookup"><span data-stu-id="c8662-278">This is possible through the use of Shared Access Signatures.</span></span>

#### <a name="why-you-want-to-use-shared-access-signatures"></a><span data-ttu-id="c8662-279">Por que usar as Assinaturas de Acesso Compartilhado</span><span class="sxs-lookup"><span data-stu-id="c8662-279">Why you want to use Shared Access Signatures</span></span>
<span data-ttu-id="c8662-280">Por que você ia querer usar uma SAS em vez de apenas fornecer sua chave da conta de armazenamento, o que é muito mais fácil?</span><span class="sxs-lookup"><span data-stu-id="c8662-280">Why would you want to use an SAS instead of just giving out your storage account key, which is so much easier?</span></span> <span data-ttu-id="c8662-281">Fornecer a chave da conta de armazenamento é como compartilhar as chaves do seu reino de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-281">Giving out your storage account key is like sharing the keys of your storage kingdom.</span></span> <span data-ttu-id="c8662-282">Isto é, ela concede acesso a tudo.</span><span class="sxs-lookup"><span data-stu-id="c8662-282">It grants complete access.</span></span> <span data-ttu-id="c8662-283">Um indivíduo poderia usar as chaves e carregar toda a biblioteca de músicas dele na sua conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-283">Someone could use your keys and upload their entire music library to your storage account.</span></span> <span data-ttu-id="c8662-284">Ele também poderia substituir seus arquivos por versões infectadas por vírus ou até mesmo roubar seus dados.</span><span class="sxs-lookup"><span data-stu-id="c8662-284">They could also replace your files with virus-infected versions, or steal your data.</span></span> <span data-ttu-id="c8662-285">Dar acesso ilimitado à sua conta de armazenamento é algo que não se pode fazer de modo leviano.</span><span class="sxs-lookup"><span data-stu-id="c8662-285">Giving away unlimited access to your storage account is something that should not be taken lightly.</span></span>

<span data-ttu-id="c8662-286">Com as Assinaturas de Acesso Compartilhado, você pode dar a um cliente apenas as permissões necessárias por um período limitado.</span><span class="sxs-lookup"><span data-stu-id="c8662-286">With Shared Access Signatures, you can give a client just the permissions required for a limited amount of time.</span></span> <span data-ttu-id="c8662-287">Por exemplo, se uma pessoa estiver carregando um blob em sua conta, você poderá conceder acesso de gravação a ela apenas pelo tempo suficiente para carregar o blob (dependendo do tamanho do blob, é claro).</span><span class="sxs-lookup"><span data-stu-id="c8662-287">For example, if someone is uploading a blob to your account, you can grant them write access for just enough time to upload the blob (depending on the size of the blob, of course).</span></span> <span data-ttu-id="c8662-288">E se você mudar de ideia, poderá revogar esse acesso.</span><span class="sxs-lookup"><span data-stu-id="c8662-288">And if you change your mind, you can revoke that access.</span></span>

<span data-ttu-id="c8662-289">Além disso, você pode especificar que as solicitações feitas usando uma SAS sejam restritas a um determinado endereço IP ou intervalo de endereços IP fora do Azure.</span><span class="sxs-lookup"><span data-stu-id="c8662-289">Additionally, you can specify that requests made using a SAS are restricted to a certain IP address or IP address range external to Azure.</span></span> <span data-ttu-id="c8662-290">Você também pode exigir que as solicitações sejam feitas usando um protocolo específico (HTTPS ou HTTP/HTTPS).</span><span class="sxs-lookup"><span data-stu-id="c8662-290">You can also require that requests are made using a specific protocol (HTTPS or HTTP/HTTPS).</span></span> <span data-ttu-id="c8662-291">Isso significa que se você deseja permitir apenas o tráfego HTTPS, será possível definir o protocolo necessário para apenas HTTPS, e o tráfego HTTP será bloqueado.</span><span class="sxs-lookup"><span data-stu-id="c8662-291">This means if you only want to allow HTTPS traffic, you can set the required protocol to HTTPS only, and HTTP traffic will be blocked.</span></span>

#### <a name="definition-of-a-shared-access-signature"></a><span data-ttu-id="c8662-292">Definição de uma Assinatura de Acesso Compartilhado</span><span class="sxs-lookup"><span data-stu-id="c8662-292">Definition of a Shared Access Signature</span></span>
<span data-ttu-id="c8662-293">Uma Assinatura de Acesso Compartilhado é um conjunto de parâmetros de consulta acrescentado à URL que aponta para o recurso</span><span class="sxs-lookup"><span data-stu-id="c8662-293">A Shared Access Signature is a set of query parameters appended to the URL pointing at the resource</span></span>

<span data-ttu-id="c8662-294">que fornece informações sobre o acesso permitido e por quanto tempo o acesso é permitido.</span><span class="sxs-lookup"><span data-stu-id="c8662-294">that provides information about the access allowed and the length of time for which the access is permitted.</span></span> <span data-ttu-id="c8662-295">Veja um exemplo; este URI fornece acesso de leitura a um blob por cinco minutos.</span><span class="sxs-lookup"><span data-stu-id="c8662-295">Here is an example; this URI provides read access to a blob for five minutes.</span></span> <span data-ttu-id="c8662-296">Observe que os parâmetros de consulta SAS devem ser Codificados pela URL, como %3A para dois-pontos (:) e %20 para um espaço.</span><span class="sxs-lookup"><span data-stu-id="c8662-296">Note that SAS query parameters must be URL Encoded, such as %3A for colon (:) or %20 for a space.</span></span>

```
http://mystorage.blob.core.windows.net/mycontainer/myblob.txt (URL to the blob)
?sv=2015-04-05 (storage service version)
&st=2015-12-10T22%3A18%3A26Z (start time, in UTC time and URL encoded)
&se=2015-12-10T22%3A23%3A26Z (end time, in UTC time and URL encoded)
&sr=b (resource is a blob)
&sp=r (read access)
&sip=168.1.5.60-168.1.5.70 (requests can only come from this range of IP addresses)
&spr=https (only allow HTTPS requests)
&sig=Z%2FRHIX5Xcg0Mq2rqI3OlWTjEg2tYkboXr1P9ZUXDtkk%3D (signature used for the authentication of the SAS)
```

#### <a name="how-the-shared-access-signature-is-authenticated-by-the-azure-storage-service"></a><span data-ttu-id="c8662-297">Como a Assinatura de Acesso Compartilhado é autenticada pelo Serviço de Armazenamento do Azure</span><span class="sxs-lookup"><span data-stu-id="c8662-297">How the Shared Access Signature is authenticated by the Azure Storage Service</span></span>
<span data-ttu-id="c8662-298">Quando o serviço de armazenamento recebe a solicitação, ele usa os parâmetros de consulta de entrada e cria uma assinatura usando o mesmo método que o programa de chamada.</span><span class="sxs-lookup"><span data-stu-id="c8662-298">When the storage service receives the request, it takes the input query parameters and creates a signature using the same method as the calling program.</span></span> <span data-ttu-id="c8662-299">Ele então compara as duas assinaturas.</span><span class="sxs-lookup"><span data-stu-id="c8662-299">It then compares the two signatures.</span></span> <span data-ttu-id="c8662-300">Se elas coincidirem, o serviço de armazenamento poderá verificar a versão do serviço de armazenamento para garantir que ele seja válido, verificar se a data e a hora atuais estão dentro da janela especificada, ter certeza de que o acesso solicitado corresponde à solicitação feita, etc.</span><span class="sxs-lookup"><span data-stu-id="c8662-300">If they agree, then the storage service can check the storage service version to make sure it's valid, verify that the current date and time are within the specified window, make sure the access requested corresponds to the request made, etc.</span></span>

<span data-ttu-id="c8662-301">Por exemplo, se a URL acima estivesse apontando para um arquivo em vez de para um blob, essa solicitação falharia, pois ela especifica que a Assinatura de Acesso Compartilhado é para um blob.</span><span class="sxs-lookup"><span data-stu-id="c8662-301">For example, with our URL above, if the URL was pointing to a file instead of a blob, this request would fail because it specifies that the Shared Access Signature is for a blob.</span></span> <span data-ttu-id="c8662-302">Se o comando REST que está sendo chamado fosse para atualizar um blob, ele falharia, pois a Assinatura de Acesso Compartilhado especifica que somente o acesso de leitura é permitido.</span><span class="sxs-lookup"><span data-stu-id="c8662-302">If the REST command being called was to update a blob, it would fail because the Shared Access Signature specifies that only read access is permitted.</span></span>

#### <a name="types-of-shared-access-signatures"></a><span data-ttu-id="c8662-303">Tipos de Assinatura de Acesso Compartilhado</span><span class="sxs-lookup"><span data-stu-id="c8662-303">Types of Shared Access Signatures</span></span>
* <span data-ttu-id="c8662-304">Uma SAS de nível de serviço pode ser usada para acessar recursos específicos em uma conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-304">A service-level SAS can be used to access specific resources in a storage account.</span></span> <span data-ttu-id="c8662-305">Alguns exemplos disso são a recuperação de uma lista de blobs em um contêiner, o download de um blob, a atualização de uma entidade em uma tabela, a adição de mensagens a uma fila ou o carregamento de um arquivo em um compartilhamento de arquivos.</span><span class="sxs-lookup"><span data-stu-id="c8662-305">Some examples of this are retrieving a list of blobs in a container, downloading a blob, updating an entity in a table, adding messages to a queue or uploading a file to a file share.</span></span>
* <span data-ttu-id="c8662-306">Uma SAS de nível de conta pode ser usada para acessar tudo aquilo para o que ela pode ser usada.</span><span class="sxs-lookup"><span data-stu-id="c8662-306">An account-level SAS can be used to access anything that a service-level SAS can be used for.</span></span> <span data-ttu-id="c8662-307">Além disso, ela pode fornecer opções para recursos que não são permitidas com uma SAS de nível de serviço, como a capacidade de criar contêineres, tabelas, filas e compartilhamentos de arquivo.</span><span class="sxs-lookup"><span data-stu-id="c8662-307">Additionally, it can give options to resources that are not permitted with a service-level SAS, such as the ability to create containers, tables, queues, and file shares.</span></span> <span data-ttu-id="c8662-308">Você também pode especificar acesso a vários serviços ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="c8662-308">You can also specify access to multiple services at once.</span></span> <span data-ttu-id="c8662-309">Por exemplo, você pode conceder a uma pessoa acesso aos blobs e aos arquivos na sua conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-309">For example, you might give someone access to both blobs and files in your storage account.</span></span>

#### <a name="creating-an-sas-uri"></a><span data-ttu-id="c8662-310">Criação de um URI de SAS</span><span class="sxs-lookup"><span data-stu-id="c8662-310">Creating an SAS URI</span></span>
1. <span data-ttu-id="c8662-311">Você pode criar um URI ad hoc sob demanda, definindo todos os parâmetros de consulta todas as vezes.</span><span class="sxs-lookup"><span data-stu-id="c8662-311">You can create an ad hoc URI on demand, defining all of the query parameters each time.</span></span>

   <span data-ttu-id="c8662-312">Isso é realmente flexível, mas se você tiver um conjunto lógico de parâmetros que sempre são semelhantes, usar uma Política de Acesso Armazenado é uma opção mais adequada.</span><span class="sxs-lookup"><span data-stu-id="c8662-312">This is really flexible, but if you have a logical set of parameters that are similar each time, using a Stored Access Policy is a better idea.</span></span>
2. <span data-ttu-id="c8662-313">É possível criar uma Política de Acesso Armazenado para um contêiner inteiro, um compartilhamento de arquivos, uma tabela ou uma fila.</span><span class="sxs-lookup"><span data-stu-id="c8662-313">You can create a Stored Access Policy for an entire container, file share, table, or queue.</span></span> <span data-ttu-id="c8662-314">Desse modo, você pode usar isso como a base para os URIs SAS que cria.</span><span class="sxs-lookup"><span data-stu-id="c8662-314">Then you can use this as the basis for the SAS URIs you create.</span></span> <span data-ttu-id="c8662-315">As permissões com base em Políticas de Acesso Armazenado podem ser facilmente revogadas.</span><span class="sxs-lookup"><span data-stu-id="c8662-315">Permissions based on Stored Access Policies can be easily revoked.</span></span> <span data-ttu-id="c8662-316">Você pode ter até cinco políticas definidas em cada contêiner, fila, tabela ou compartilhamento de arquivos.</span><span class="sxs-lookup"><span data-stu-id="c8662-316">You can have up to 5 policies defined on each container, queue, table, or file share.</span></span>

   <span data-ttu-id="c8662-317">Por exemplo, se muitas pessoas lessem os blobs em um contêiner específico, você poderia criar uma Política de Acesso Armazenado que informasse "fornecer acesso de leitura" e todas as outras configurações que seriam as mesmas todas as vezes.</span><span class="sxs-lookup"><span data-stu-id="c8662-317">For example, if you were going to have many people read the blobs in a specific container, you could create a Stored Access Policy that says "give read access" and any other settings that will be the same each time.</span></span> <span data-ttu-id="c8662-318">Assim, você poderia criar um URI de SAS usando as configurações da Política de Acesso Armazenado e especificando a data/hora de expiração.</span><span class="sxs-lookup"><span data-stu-id="c8662-318">Then you can create an SAS URI using the settings of the Stored Access Policy and specifying the expiration date/time.</span></span> <span data-ttu-id="c8662-319">A vantagem disso é que você não precisa especificar todos os parâmetros de consulta todas as vezes.</span><span class="sxs-lookup"><span data-stu-id="c8662-319">The advantage of this is that you don't have to specify all of the query parameters every time.</span></span>

#### <a name="revocation"></a><span data-ttu-id="c8662-320">Revogação</span><span class="sxs-lookup"><span data-stu-id="c8662-320">Revocation</span></span>
<span data-ttu-id="c8662-321">Suponha que a SAS foi comprometida ou que você queira alterá-la devido a requisitos de conformidade normativa ou segurança corporativa.</span><span class="sxs-lookup"><span data-stu-id="c8662-321">Suppose your SAS has been compromised, or you want to change it because of corporate security or regulatory compliance requirements.</span></span> <span data-ttu-id="c8662-322">Como você revoga o acesso a um recurso usando essa SAS?</span><span class="sxs-lookup"><span data-stu-id="c8662-322">How do you revoke access to a resource using that SAS?</span></span> <span data-ttu-id="c8662-323">Depende de como você criou o URI da SAS.</span><span class="sxs-lookup"><span data-stu-id="c8662-323">It depends on how you created the SAS URI.</span></span>

<span data-ttu-id="c8662-324">Se estiver usando URIs ad hoc, você terá três opções.</span><span class="sxs-lookup"><span data-stu-id="c8662-324">If you are using ad hoc URI's, you have three options.</span></span> <span data-ttu-id="c8662-325">Você pode emitir tokens SAS com políticas de expiração curta e simplesmente aguardar a SAS expirar.</span><span class="sxs-lookup"><span data-stu-id="c8662-325">You can issue SAS tokens with short expiration policies and simply wait for the SAS to expire.</span></span> <span data-ttu-id="c8662-326">Você pode renomear ou excluir o recurso (supondo que o escopo do token fosse para um único objeto).</span><span class="sxs-lookup"><span data-stu-id="c8662-326">You can rename or delete the resource (assuming the token was scoped to a single object).</span></span> <span data-ttu-id="c8662-327">Você pode alterar as chaves da conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-327">You can change the storage account keys.</span></span> <span data-ttu-id="c8662-328">Essa última opção pode ter um grande impacto dependendo de quantos serviços estão usando essa conta de armazenamento, o que provavelmente não é algo que você queira fazer sem algum planejamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-328">This last option can have a big impact, depending on how many services are using that storage account, and probably isn't something you want to do without some planning.</span></span>

<span data-ttu-id="c8662-329">Se estiver usando uma SAS derivada de uma Política de Acesso Armazenado, você poderá remover o acesso revogando a Política de Acesso Armazenado. Basta alterá-la para que ela expire ou removê-la completamente.</span><span class="sxs-lookup"><span data-stu-id="c8662-329">If you are using a SAS derived from a Stored Access Policy, you can remove access by revoking the Stored Access Policy – you can just change it so it has already expired, or you can remove it altogether.</span></span> <span data-ttu-id="c8662-330">Isso entra em vigor imediatamente e invalida cada SAS criada usando essa Política de Acesso Armazenado.</span><span class="sxs-lookup"><span data-stu-id="c8662-330">This takes effect immediately, and invalidates every SAS created using that Stored Access Policy.</span></span> <span data-ttu-id="c8662-331">Atualizar ou remover a Política de Acesso Armazenado pode afetar pessoas que estão acessando um contêiner, um compartilhamento de arquivos, uma tabela ou uma fila específicos por meio de SAS, mas se os clientes estiverem gravando, eles solicitam uma nova SAS quando a antiga se tornar inválida; isso funciona sem problemas.</span><span class="sxs-lookup"><span data-stu-id="c8662-331">Updating or removing the Stored Access Policy may impact people accessing that specific container, file share, table, or queue via SAS, but if the clients are written so they request a new SAS when the old one becomes invalid, this will work fine.</span></span>

<span data-ttu-id="c8662-332">Como usar uma SAS derivada de uma Política de Acesso Armazenado dá a possibilidade de revogar essa SAS imediatamente, a prática recomendada é, sempre que possível, usar Políticas de Acesso Armazenado.</span><span class="sxs-lookup"><span data-stu-id="c8662-332">Because using a SAS derived from a Stored Access Policy gives you the ability to revoke that SAS immediately, it is the recommended best practice to always use Stored Access Policies when possible.</span></span>

#### <a name="resources"></a><span data-ttu-id="c8662-333">Recursos</span><span class="sxs-lookup"><span data-stu-id="c8662-333">Resources</span></span>
<span data-ttu-id="c8662-334">Para obter informações mais detalhadas sobre como usar as Assinatura de Acesso Compartilhado e as Políticas de Acesso Armazenado, com exemplos, veja os artigos a seguir:</span><span class="sxs-lookup"><span data-stu-id="c8662-334">For more detailed information on using Shared Access Signatures and Stored Access Policies, complete with examples, please refer to the following articles:</span></span>

* <span data-ttu-id="c8662-335">Estes são os artigos de referência.</span><span class="sxs-lookup"><span data-stu-id="c8662-335">These are the reference articles.</span></span>

  * [<span data-ttu-id="c8662-336">Service SAS (SAS de serviço)</span><span class="sxs-lookup"><span data-stu-id="c8662-336">Service SAS</span></span>](https://msdn.microsoft.com/library/dn140256.aspx)

    <span data-ttu-id="c8662-337">Esse artigo fornece exemplos de como usar uma SAS de nível de serviço com blobs, mensagens da fila, intervalos de tabelas e arquivos.</span><span class="sxs-lookup"><span data-stu-id="c8662-337">This article provides examples of using a service-level SAS with blobs, queue messages, table ranges, and files.</span></span>
  * [<span data-ttu-id="c8662-338">Constructing a service SAS (Criação de uma SAS de serviço)</span><span class="sxs-lookup"><span data-stu-id="c8662-338">Constructing a service SAS</span></span>](https://msdn.microsoft.com/library/dn140255.aspx)
  * [<span data-ttu-id="c8662-339">Constructing an account SAS (Criação de uma SAS de conta)</span><span class="sxs-lookup"><span data-stu-id="c8662-339">Constructing an account SAS</span></span>](https://msdn.microsoft.com/library/mt584140.aspx)
* <span data-ttu-id="c8662-340">Estes são os tutoriais de como usar a biblioteca de cliente .NET para criar Assinatura de Acesso Compartilhado e Políticas de Acesso Armazenado.</span><span class="sxs-lookup"><span data-stu-id="c8662-340">These are tutorials for using the .NET client library to create Shared Access Signatures and Stored Access Policies.</span></span>

  * [<span data-ttu-id="c8662-341">Uso de SAS (Assinaturas de Acesso Compartilhado)</span><span class="sxs-lookup"><span data-stu-id="c8662-341">Using Shared Access Signatures (SAS)</span></span>](../storage-dotnet-shared-access-signature-part-1.md)
  * [<span data-ttu-id="c8662-342">Assinaturas de acesso compartilhado, Parte 2: criar e usar uma SAS com o serviço Blob</span><span class="sxs-lookup"><span data-stu-id="c8662-342">Shared Access Signatures, Part 2: Create and Use a SAS with the Blob Service</span></span>](../blobs/storage-dotnet-shared-access-signature-part-2.md)

    <span data-ttu-id="c8662-343">Esse artigo inclui uma explicação do modelo SAS, exemplos de Assinatura de Acesso Compartilhado e recomendações para uso da prática recomendada de SAS.</span><span class="sxs-lookup"><span data-stu-id="c8662-343">This article includes an explanation of the SAS model, examples of Shared Access Signatures, and recommendations for the best practice use of SAS.</span></span> <span data-ttu-id="c8662-344">Também é abordada a revogação da permissão concedida.</span><span class="sxs-lookup"><span data-stu-id="c8662-344">Also discussed is the revocation of the permission granted.</span></span>
* <span data-ttu-id="c8662-345">Limite do acesso por endereço IP (ACLs de IP)</span><span class="sxs-lookup"><span data-stu-id="c8662-345">Limiting access by IP Address (IP ACLs)</span></span>

  * [<span data-ttu-id="c8662-346">O que é uma ACL (Lista de Controle de Acesso) do ponto de extremidade?</span><span class="sxs-lookup"><span data-stu-id="c8662-346">What is an endpoint Access Control List (ACLs)?</span></span>](../../virtual-network/virtual-networks-acl.md)
  * [<span data-ttu-id="c8662-347">Constructing a Service SAS (Criação de uma SAS de serviço)</span><span class="sxs-lookup"><span data-stu-id="c8662-347">Constructing a Service SAS</span></span>](https://msdn.microsoft.com/library/azure/dn140255.aspx)

    <span data-ttu-id="c8662-348">Esse é o artigo de referência para a SAS de nível de serviço; ele inclui um exemplo de ACL de IP.</span><span class="sxs-lookup"><span data-stu-id="c8662-348">This is the reference article for service-level SAS; it includes an example of IP ACLing.</span></span>
  * [<span data-ttu-id="c8662-349">Constructing an Account SAS (Criação de uma SAS de conta)</span><span class="sxs-lookup"><span data-stu-id="c8662-349">Constructing an Account SAS</span></span>](https://msdn.microsoft.com/library/azure/mt584140.aspx)

    <span data-ttu-id="c8662-350">Esse é o artigo de referência para a SAS de nível de conta; ele inclui um exemplo de ACLing de IP.</span><span class="sxs-lookup"><span data-stu-id="c8662-350">This is the reference article for account-level SAS; it includes an example of IP ACLing.</span></span>
* <span data-ttu-id="c8662-351">Autenticação</span><span class="sxs-lookup"><span data-stu-id="c8662-351">Authentication</span></span>

  * [<span data-ttu-id="c8662-352">Autenticação para os Serviços de Armazenamento do Azure</span><span class="sxs-lookup"><span data-stu-id="c8662-352">Authentication for the Azure Storage Services</span></span>](https://msdn.microsoft.com/library/azure/dd179428.aspx)
* <span data-ttu-id="c8662-353">Tutorial de introdução às Assinaturas de Acesso Compartilhado</span><span class="sxs-lookup"><span data-stu-id="c8662-353">Shared Access Signatures Getting Started Tutorial</span></span>

  * [<span data-ttu-id="c8662-354">SAS Getting Started Tutorial (Tutorial de introdução à SAS)</span><span class="sxs-lookup"><span data-stu-id="c8662-354">SAS Getting Started Tutorial</span></span>](https://github.com/Azure-Samples/storage-dotnet-sas-getting-started)

## <a name="encryption-in-transit"></a><span data-ttu-id="c8662-355">Criptografia em trânsito</span><span class="sxs-lookup"><span data-stu-id="c8662-355">Encryption in Transit</span></span>
### <a name="transport-level-encryption--using-https"></a><span data-ttu-id="c8662-356">Criptografia no nível de transporte – usando HTTPS</span><span class="sxs-lookup"><span data-stu-id="c8662-356">Transport-Level Encryption – Using HTTPS</span></span>
<span data-ttu-id="c8662-357">Outra etapa que você deve executar para garantir a segurança dos dados do Armazenamento do Azure é criptografá-los entre o cliente e o Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="c8662-357">Another step you should take to ensure the security of your Azure Storage data is to encrypt the data between the client and Azure Storage.</span></span> <span data-ttu-id="c8662-358">A primeira recomendação é sempre usar o protocolo [HTTPS](https://en.wikipedia.org/wiki/HTTPS) , que garante a comunicação segura na Internet pública.</span><span class="sxs-lookup"><span data-stu-id="c8662-358">The first recommendation is to always use the [HTTPS](https://en.wikipedia.org/wiki/HTTPS) protocol, which ensures secure communication over the public Internet.</span></span>

<span data-ttu-id="c8662-359">Para ter um canal de comunicação seguro, você sempre deve usar o HTTPS ao chamar as APIs REST ou acessar objetos no armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-359">To have a secure communication channel, you should always use HTTPS when calling the REST APIs or accessing objects in storage.</span></span> <span data-ttu-id="c8662-360">Além disso, as **Assinaturas de Acesso Compartilhado**, que podem ser usadas para delegar acesso a objetos do Armazenamento do Azure, incluem uma opção para especificar que apenas o protocolo HTTPS pode ser utilizado ao usar as Assinaturas de Acesso Compartilhado, garantindo que qualquer pessoa que envie links com tokens SAS usará o protocolo adequado.</span><span class="sxs-lookup"><span data-stu-id="c8662-360">Also, **Shared Access Signatures**, which can be used to delegate access to Azure Storage objects, include an option to specify that only the HTTPS protocol can be used when using Shared Access Signatures, ensuring that anybody sending out links with SAS tokens will use the proper protocol.</span></span>

<span data-ttu-id="c8662-361">É possível impor o uso de HTTPS ao chamar as APIs REST para acessar objetos em contas de armazenamento habilitando a opção [Transferência segura necessária](../storage-require-secure-transfer.md) na conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-361">You can enforce the use of HTTPS when calling the REST APIs to access objects in storage accounts by enabling [Secure transfer required](../storage-require-secure-transfer.md) for the storage account.</span></span> <span data-ttu-id="c8662-362">As conexões que usam HTTP serão recusadas depois que essa opção for habilitada.</span><span class="sxs-lookup"><span data-stu-id="c8662-362">Connections using HTTP will be refused once this is enabled.</span></span>

### <a name="using-encryption-during-transit-with-azure-file-shares"></a><span data-ttu-id="c8662-363">Usar criptografia durante a transferência com Compartilhamentos de Arquivos do Azure</span><span class="sxs-lookup"><span data-stu-id="c8662-363">Using encryption during transit with Azure File shares</span></span>
<span data-ttu-id="c8662-364">O Armazenamento de Arquivos do Azure dá suporte a HTTPS ao usar a API REST, mas é mais frequentemente usado como um compartilhamento de arquivos SMB conectado a uma VM.</span><span class="sxs-lookup"><span data-stu-id="c8662-364">Azure File storage supports HTTPS when using the REST API, but is more commonly used as an SMB file share attached to a VM.</span></span> <span data-ttu-id="c8662-365">O SMB 2.1 não é compatível com a criptografia, de modo que as conexões só são permitidas dentro da mesma região no Azure.</span><span class="sxs-lookup"><span data-stu-id="c8662-365">SMB 2.1 does not support encryption, so connections are only allowed within the same region in Azure.</span></span> <span data-ttu-id="c8662-366">No entanto, o SMB 3.0 dá suporte à criptografia e está disponível no Windows Server 2012 R2, Windows 8, Windows 8.1 e Windows 10, permitindo o acesso entre regiões e, até mesmo, o acesso na área de trabalho.</span><span class="sxs-lookup"><span data-stu-id="c8662-366">However, SMB 3.0 supports encryption, and it's available in Windows Server 2012 R2, Windows 8, Windows 8.1, and Windows 10, allowing cross-region access and even access on the desktop.</span></span>

<span data-ttu-id="c8662-367">Observe que, embora os Compartilhamentos de Arquivos do Azure possam ser usados com o Unix, o cliente SMB do Linux ainda não dá suporte à criptografia, de modo que o acesso é permitido apenas de dentro de uma região do Azure.</span><span class="sxs-lookup"><span data-stu-id="c8662-367">Note that while Azure File shares can be used with Unix, the Linux SMB client does not yet support encryption, so access is only allowed within an Azure region.</span></span> <span data-ttu-id="c8662-368">O suporte à criptografia para Linux está no roteiro dos desenvolvedores do Linux responsáveis pela funcionalidade SMB.</span><span class="sxs-lookup"><span data-stu-id="c8662-368">Encryption support for Linux is on the roadmap of Linux developers responsible for SMB functionality.</span></span> <span data-ttu-id="c8662-369">Quando a criptografia for adicionada, você terá a mesma capacidade de acessar um Compartilhamento de Arquivos do Azure no Linux que tem no Windows.</span><span class="sxs-lookup"><span data-stu-id="c8662-369">When they add encryption, you will have the same ability for accessing an Azure File share on Linux as you do for Windows.</span></span>

<span data-ttu-id="c8662-370">É possível impor o uso de criptografia com o serviço Arquivos do Azure habilitando a opção [Transferência segura necessária](../storage-require-secure-transfer.md) na conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-370">You can enforce the use of encryption with the Azure Files service by enabling [Secure transfer required](../storage-require-secure-transfer.md) for the storage account.</span></span> <span data-ttu-id="c8662-371">Se você estiver usando as APIs REST, o HTTPS será necessário.</span><span class="sxs-lookup"><span data-stu-id="c8662-371">If using the REST APIs, HTTPs is required.</span></span> <span data-ttu-id="c8662-372">Para o SMB, apenas as conexões SMB que dão suporte à criptografia se conectarão com êxito.</span><span class="sxs-lookup"><span data-stu-id="c8662-372">For SMB, only SMB connections that support encryption will connect successfully.</span></span>

#### <a name="resources"></a><span data-ttu-id="c8662-373">Recursos</span><span class="sxs-lookup"><span data-stu-id="c8662-373">Resources</span></span>
* [<span data-ttu-id="c8662-374">Como utilizar o Armazenamento de Arquivos do Azure com Linux</span><span class="sxs-lookup"><span data-stu-id="c8662-374">How to use Azure File storage with Linux</span></span>](../storage-how-to-use-files-linux.md)

  <span data-ttu-id="c8662-375">Esse artigo mostra como montar um Compartilhamento de Arquivos do Azure em um sistema Linux e carregar/baixar arquivos.</span><span class="sxs-lookup"><span data-stu-id="c8662-375">This article shows how to mount an Azure File share on a Linux system and upload/download files.</span></span>
* [<span data-ttu-id="c8662-376">Introdução ao Armazenamento de Arquivos do Azure no Windows</span><span class="sxs-lookup"><span data-stu-id="c8662-376">Get started with Azure File storage on Windows</span></span>](../storage-dotnet-how-to-use-files.md)

  <span data-ttu-id="c8662-377">Esse artigo fornece uma visão geral dos Compartilhamentos de Arquivos do Azure e de como montá-los e usá-los com o PowerShell e o .NET.</span><span class="sxs-lookup"><span data-stu-id="c8662-377">This article gives an overview of Azure File shares and how to mount and use them using PowerShell and .NET.</span></span>
* [<span data-ttu-id="c8662-378">Por dentro do Armazenamento de Arquivos do Azure</span><span class="sxs-lookup"><span data-stu-id="c8662-378">Inside Azure File storage</span></span>](https://azure.microsoft.com/blog/inside-azure-file-storage/)

  <span data-ttu-id="c8662-379">Esse artigo anuncia a disponibilidade geral do Armazenamento de Arquivos do Azure e fornece detalhes técnicos sobre a criptografia SMB 3.0.</span><span class="sxs-lookup"><span data-stu-id="c8662-379">This article announces the general availability of Azure File storage and provides technical details about the SMB 3.0 encryption.</span></span>

### <a name="using-client-side-encryption-to-secure-data-that-you-send-to-storage"></a><span data-ttu-id="c8662-380">Uso da criptografia do cliente para proteger os dados enviados para o armazenamento</span><span class="sxs-lookup"><span data-stu-id="c8662-380">Using Client-side encryption to secure data that you send to storage</span></span>
<span data-ttu-id="c8662-381">Outra opção que ajuda a garantir que os dados sejam protegidos enquanto estão sendo transferidos entre um aplicativo cliente e o Armazenamento é a Criptografia do Cliente.</span><span class="sxs-lookup"><span data-stu-id="c8662-381">Another option that helps you ensure that your data is secure while being transferred between a client application and Storage is Client-side Encryption.</span></span> <span data-ttu-id="c8662-382">Os dados são criptografados antes de serem transferidos para o Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="c8662-382">The data is encrypted before being transferred into Azure Storage.</span></span> <span data-ttu-id="c8662-383">Na recuperação dos dados do Armazenamento do Azure, os dados são descriptografados depois que são recebidos no cliente.</span><span class="sxs-lookup"><span data-stu-id="c8662-383">When retrieving the data from Azure Storage, the data is decrypted after it is received on the client side.</span></span> <span data-ttu-id="c8662-384">Mesmo que os dados estejam criptografados durante a transferência, é recomendável usar também o HTTPS, pois ele tem as verificações de integridade de dados internas que ajudam a reduzir os erros de rede que afetam a integridade dos dados.</span><span class="sxs-lookup"><span data-stu-id="c8662-384">Even though the data is encrypted going across the wire, we recommend that you also use HTTPS, as it has data integrity checks built in which help mitigate network errors affecting the integrity of the data.</span></span>

<span data-ttu-id="c8662-385">A criptografia do cliente também é um método para criptografar os dados em repouso, já que os dados são armazenados em sua forma criptografada.</span><span class="sxs-lookup"><span data-stu-id="c8662-385">Client-side encryption is also a method for encrypting your data at rest, as the data is stored in its encrypted form.</span></span> <span data-ttu-id="c8662-386">Falaremos sobre isso mais detalhadamente na seção sobre [Criptografia em repouso](#encryption-at-rest).</span><span class="sxs-lookup"><span data-stu-id="c8662-386">We'll talk about this in more detail in the section on [Encryption at Rest](#encryption-at-rest).</span></span>

## <a name="encryption-at-rest"></a><span data-ttu-id="c8662-387">Criptografia em repouso</span><span class="sxs-lookup"><span data-stu-id="c8662-387">Encryption at Rest</span></span>
<span data-ttu-id="c8662-388">Há três recursos do Azure que fornecem criptografia em repouso.</span><span class="sxs-lookup"><span data-stu-id="c8662-388">There are three Azure features that provide encryption at rest.</span></span> <span data-ttu-id="c8662-389">O Azure Disk Encryption é usado para criptografar os discos de dados e do sistema operacional em Máquinas Virtuais IaaS.</span><span class="sxs-lookup"><span data-stu-id="c8662-389">Azure Disk Encryption is used to encrypt the OS and data disks in IaaS Virtual Machines.</span></span> <span data-ttu-id="c8662-390">Os outros dois – Criptografia do Cliente e SSE – são usados para criptografar dados no Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="c8662-390">The other two – Client-side Encryption and SSE – are both used to encrypt data in Azure Storage.</span></span> <span data-ttu-id="c8662-391">Examinaremos cada um deles e, em seguida, faremos uma comparação e veremos quando cada um deles pode ser usado.</span><span class="sxs-lookup"><span data-stu-id="c8662-391">Let's look at each of these, and then do a comparison and see when each one can be used.</span></span>

<span data-ttu-id="c8662-392">Embora seja possível usar a Criptografia do Cliente para criptografar os dados em trânsito (que também são armazenados em sua forma criptografada no Armazenamento), talvez você prefira simplesmente usar HTTPS durante a transferência e que os dados sejam criptografados automaticamente de alguma maneira quando são armazenados.</span><span class="sxs-lookup"><span data-stu-id="c8662-392">While you can use Client-side Encryption to encrypt the data in transit (which is also stored in its encrypted form in Storage), you may prefer to simply use HTTPS during the transfer, and have some way for the data to be automatically encrypted when it is stored.</span></span> <span data-ttu-id="c8662-393">Há duas maneiras de fazer isso: com o Azure Disk Encryption e com a SSE.</span><span class="sxs-lookup"><span data-stu-id="c8662-393">There are two ways to do this -- Azure Disk Encryption and SSE.</span></span> <span data-ttu-id="c8662-394">Uma é usada para criptografar os dados diretamente nos discos de dados e do sistema operacional usados pelas VMs e a outra é usada para criptografar os dados gravados no Armazenamento de Blobs do Azure.</span><span class="sxs-lookup"><span data-stu-id="c8662-394">One is used to directly encrypt the data on OS and data disks used by VMs, and the other is used to encrypt data written to Azure Blob Storage.</span></span>

### <a name="storage-service-encryption-sse"></a><span data-ttu-id="c8662-395">SSE (Criptografia do Serviço de Armazenamento)</span><span class="sxs-lookup"><span data-stu-id="c8662-395">Storage Service Encryption (SSE)</span></span>
<span data-ttu-id="c8662-396">A SSE permite solicitar que o serviço de armazenamento criptografe automaticamente os dados ao gravá-los no Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="c8662-396">SSE allows you to request that the storage service automatically encrypt the data when writing it to Azure Storage.</span></span> <span data-ttu-id="c8662-397">Quando você lê os dados no Armazenamento do Azure, eles são descriptografados pelo serviço de armazenamento antes de serem retornados.</span><span class="sxs-lookup"><span data-stu-id="c8662-397">When you read the data from Azure Storage, it will be decrypted by the storage service before being returned.</span></span> <span data-ttu-id="c8662-398">Isso permite proteger os dados sem precisar modificar código nem adicionar código a nenhum aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c8662-398">This enables you to secure your data without having to modify code or add code to any applications.</span></span>

<span data-ttu-id="c8662-399">Essa é uma configuração que se aplica à conta de armazenamento inteira.</span><span class="sxs-lookup"><span data-stu-id="c8662-399">This is a setting that applies to the whole storage account.</span></span> <span data-ttu-id="c8662-400">Você pode habilitar e desabilitar esse recurso alterando o valor da configuração.</span><span class="sxs-lookup"><span data-stu-id="c8662-400">You can enable and disable this feature by changing the value of the setting.</span></span> <span data-ttu-id="c8662-401">Para fazer isso, você pode usar o Portal do Azure, o PowerShell, a CLI do Azure, a API REST do Provedor de Recursos de Armazenamento ou a Biblioteca de Cliente de Armazenamento .NET.</span><span class="sxs-lookup"><span data-stu-id="c8662-401">To do this, you can use the Azure portal, PowerShell, the Azure CLI, the Storage Resource Provider REST API, or the .NET Storage Client Library.</span></span> <span data-ttu-id="c8662-402">Por padrão, a SSE é desativada.</span><span class="sxs-lookup"><span data-stu-id="c8662-402">By default, SSE is turned off.</span></span>

<span data-ttu-id="c8662-403">Neste momento, as chaves usadas para a criptografia são gerenciadas pela Microsoft.</span><span class="sxs-lookup"><span data-stu-id="c8662-403">At this time, the keys used for the encryption are managed by Microsoft.</span></span> <span data-ttu-id="c8662-404">Podemos gerar as chaves originalmente e gerenciar o armazenamento seguro das chaves, bem como a rotação regular, conforme definido pela política interna do Microsoft.</span><span class="sxs-lookup"><span data-stu-id="c8662-404">We generate the keys originally, and manage the secure storage of the keys as well as the regular rotation as defined by internal Microsoft policy.</span></span> <span data-ttu-id="c8662-405">No futuro, você adicionará a capacidade de gerenciar suas próprias chaves de criptografia e fornecerá um caminho de migração de chaves gerenciadas pela Microsoft para chaves gerenciadas pelo cliente.</span><span class="sxs-lookup"><span data-stu-id="c8662-405">In the future, you will get the ability to manage your own encryption keys, and provide a migration path from Microsoft-managed keys to customer-managed keys.</span></span>

<span data-ttu-id="c8662-406">Esse recurso está disponível para as contas de Armazenamento Standard e Premium criadas usando o modelo de implantação do Gerenciador de Recursos.</span><span class="sxs-lookup"><span data-stu-id="c8662-406">This feature is available for Standard and Premium Storage accounts created using the Resource Manager deployment model.</span></span> <span data-ttu-id="c8662-407">A SSE se aplica somente aos blobs de blocos, aos blobs de páginas e aos blobs de acréscimo.</span><span class="sxs-lookup"><span data-stu-id="c8662-407">SSE applies only to block blobs, page blobs, and append blobs.</span></span> <span data-ttu-id="c8662-408">Os outros tipos de dados, incluindo tabelas, filas e arquivos, não serão criptografados.</span><span class="sxs-lookup"><span data-stu-id="c8662-408">The other types of data, including tables, queues, and files, will not be encrypted.</span></span>

<span data-ttu-id="c8662-409">Os dados são criptografados somente quando a SSE é habilitada e os dados são gravados no Armazenamento de Blobs.</span><span class="sxs-lookup"><span data-stu-id="c8662-409">Data is only encrypted when SSE is enabled and the data is written to Blob Storage.</span></span> <span data-ttu-id="c8662-410">Habilitar ou desabilitar a SSE não afeta os dados existentes.</span><span class="sxs-lookup"><span data-stu-id="c8662-410">Enabling or disabling SSE does not impact existing data.</span></span> <span data-ttu-id="c8662-411">Em outras palavras, quando você habilita essa criptografia, os dados que já existem não são criptografados e nem serão descriptografados quando você desabilitar a SSE.</span><span class="sxs-lookup"><span data-stu-id="c8662-411">In other words, when you enable this encryption, it will not go back and encrypt data that already exists; nor will it decrypt the data that already exists when you disable SSE.</span></span>

<span data-ttu-id="c8662-412">Para usar esse recurso com uma conta de armazenamento clássico, você pode criar uma nova conta de armazenamento do Gerenciador de Recursos e usar AzCopy para copiar os dados para a nova conta.</span><span class="sxs-lookup"><span data-stu-id="c8662-412">If you want to use this feature with a Classic storage account, you can create a new Resource Manager storage account and use AzCopy to copy the data to the new account.</span></span>

### <a name="client-side-encryption"></a><span data-ttu-id="c8662-413">Criptografia do cliente</span><span class="sxs-lookup"><span data-stu-id="c8662-413">Client-side Encryption</span></span>
<span data-ttu-id="c8662-414">Mencionamos a criptografia do cliente ao abordar a criptografia dos dados em trânsito.</span><span class="sxs-lookup"><span data-stu-id="c8662-414">We mentioned client-side encryption when discussing the encryption of the data in transit.</span></span> <span data-ttu-id="c8662-415">Esse recurso permite criptografar os dados de modo programático em um aplicativo cliente antes de enviá-los para serem gravados no Armazenamento do Azure, assim como descriptografá-los de modo programático depois de recuperá-los no Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="c8662-415">This feature allows you to programmatically encrypt your data in a client application before sending it across the wire to be written to Azure Storage, and to programmatically decrypt your data after retrieving it from Azure Storage.</span></span>

<span data-ttu-id="c8662-416">Ele fornece criptografia em trânsito, mas também fornece o recurso de Criptografia em Repouso.</span><span class="sxs-lookup"><span data-stu-id="c8662-416">This does provide encryption in transit, but it also provides the feature of Encryption at Rest.</span></span> <span data-ttu-id="c8662-417">Observe que, embora os dados sejam criptografados em trânsito, ainda é aconselhável usar HTTPS para aproveitar as verificações de integridade de dados internas, que ajudam a reduzir os erros de rede que afetam a integridade dos dados.</span><span class="sxs-lookup"><span data-stu-id="c8662-417">Note that although the data is encrypted in transit, we still recommend using HTTPS to take advantage of the built-in data integrity checks which help mitigate network errors affecting the integrity of the data.</span></span>

<span data-ttu-id="c8662-418">Um exemplo de onde é possível usar esse recurso é quando você tiver um aplicativo Web que armazene blobs e recupere blobs, e quando você quiser que o aplicativo e os dados sejam protegidos ao máximo.</span><span class="sxs-lookup"><span data-stu-id="c8662-418">An example of where you might use this is if you have a web application that stores blobs and retrieves blobs, and you want the application and data to be as secure as possible.</span></span> <span data-ttu-id="c8662-419">Nesse caso, você usa a criptografia do cliente.</span><span class="sxs-lookup"><span data-stu-id="c8662-419">In that case, you would use client-side encryption.</span></span> <span data-ttu-id="c8662-420">O tráfego entre o cliente e o Serviço Blob do Azure contém o recurso criptografado, e ninguém pode interpretar os dados em trânsito e reconstitui-los em seus blobs privados.</span><span class="sxs-lookup"><span data-stu-id="c8662-420">The traffic between the client and the Azure Blob Service contains the encrypted resource, and nobody can interpret the data in transit and reconstitute it into your private blobs.</span></span>

<span data-ttu-id="c8662-421">A criptografia do cliente é incorporada no Java e nas bibliotecas de cliente de armazenamento .NET que, por sua vez, usam as APIs do Cofre de Chaves do Azure, o que a torna muito fácil de implementar.</span><span class="sxs-lookup"><span data-stu-id="c8662-421">Client-side encryption is built into the Java and the .NET storage client libraries, which in turn use the Azure Key Vault APIs, making it pretty easy for you to implement.</span></span> <span data-ttu-id="c8662-422">O processo de criptografia e descriptografia de dados usa a técnica de envelope e armazena os metadados usados pela criptografia em cada objeto de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-422">The process of encrypting and decrypting the data uses the envelope technique, and stores metadata used by the encryption in each storage object.</span></span> <span data-ttu-id="c8662-423">Por exemplo, no caso de blobs, ele os armazena nos metadados do blob e, no caso de filas, ele os adiciona a cada mensagem da fila.</span><span class="sxs-lookup"><span data-stu-id="c8662-423">For example, for blobs, it stores it in the blob metadata, while for queues, it adds it to each queue message.</span></span>

<span data-ttu-id="c8662-424">Para a criptografia em si, você pode gerar e gerenciar suas próprias chaves de criptografia.</span><span class="sxs-lookup"><span data-stu-id="c8662-424">For the encryption itself, you can generate and manage your own encryption keys.</span></span> <span data-ttu-id="c8662-425">Você também pode usar as chaves geradas pela Biblioteca de Cliente de Armazenamento do Azure ou fazer com que o Cofre de Chaves do Azure as gere.</span><span class="sxs-lookup"><span data-stu-id="c8662-425">You can also use keys generated by the Azure Storage Client Library, or you can have the Azure Key Vault generate the keys.</span></span> <span data-ttu-id="c8662-426">É possível armazenar as chaves de criptografia em seu armazenamento de chaves local ou armazená-las no Cofre de Chaves do Azure.</span><span class="sxs-lookup"><span data-stu-id="c8662-426">You can store your encryption keys in your on-premises key storage, or you can store them in an Azure Key Vault.</span></span> <span data-ttu-id="c8662-427">O Cofre de Chaves do Azure permite conceder a usuários específicos acesso aos segredos do Cofre de Chaves do Azure usando o Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="c8662-427">Azure Key Vault allows you to grant access to the secrets in Azure Key Vault to specific users using Azure Active Directory.</span></span> <span data-ttu-id="c8662-428">Isso significa que não é qualquer pessoa que pode ler o Azure Key Vault e recuperar as chaves que você está usando para criptografia do lado do cliente.</span><span class="sxs-lookup"><span data-stu-id="c8662-428">This means that not just anybody can read the Azure Key Vault and retrieve the keys you're using for client-side encryption.</span></span>

#### <a name="resources"></a><span data-ttu-id="c8662-429">Recursos</span><span class="sxs-lookup"><span data-stu-id="c8662-429">Resources</span></span>
* [<span data-ttu-id="c8662-430">Criptografar e Descriptografar Blobs no Armazenamento do Microsoft Azure usando o Cofre da Chave do Azure</span><span class="sxs-lookup"><span data-stu-id="c8662-430">Encrypt and decrypt blobs in Microsoft Azure Storage using Azure Key Vault</span></span>](../blobs/storage-encrypt-decrypt-blobs-key-vault.md)

  <span data-ttu-id="c8662-431">Esse artigo mostra como usar a criptografia do cliente com o Cofre de Chaves do Azure, incluindo como criar o KEK e armazená-lo no cofre usando o PowerShell.</span><span class="sxs-lookup"><span data-stu-id="c8662-431">This article shows how to use client-side encryption with Azure Key Vault, including how to create the KEK and store it in the vault using PowerShell.</span></span>
* [<span data-ttu-id="c8662-432">Criptografia do lado do cliente e o Cofre da Chave do Azure para o Armazenamento do Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="c8662-432">Client-Side Encryption and Azure Key Vault for Microsoft Azure Storage</span></span>](../storage-client-side-encryption.md)

  <span data-ttu-id="c8662-433">Esse artigo fornece uma explicação da criptografia do cliente, bem como exemplos de como usar a biblioteca de cliente de armazenamento para criptografar e descriptografar recursos dos quatro serviços de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-433">This article gives an explanation of client-side encryption, and provides examples of using the storage client library to encrypt and decrypt resources from the four storage services.</span></span> <span data-ttu-id="c8662-434">Ele também fala sobre o Cofre de Chaves do Azure.</span><span class="sxs-lookup"><span data-stu-id="c8662-434">It also talks about Azure Key Vault.</span></span>

### <a name="using-azure-disk-encryption-to-encrypt-disks-used-by-your-virtual-machines"></a><span data-ttu-id="c8662-435">Usando o Azure Disk Encryption para criptografar discos usados pelas máquinas virtuais</span><span class="sxs-lookup"><span data-stu-id="c8662-435">Using Azure Disk Encryption to encrypt disks used by your virtual machines</span></span>
<span data-ttu-id="c8662-436">O Azure Disk Encryption é um novo recurso.</span><span class="sxs-lookup"><span data-stu-id="c8662-436">Azure Disk Encryption is a new feature.</span></span> <span data-ttu-id="c8662-437">Esse recurso permite criptografar os discos do sistema operacional e de dados usados por uma Máquina Virtual IaaS.</span><span class="sxs-lookup"><span data-stu-id="c8662-437">This feature allows you to encrypt the OS disks and Data disks used by an IaaS Virtual Machine.</span></span> <span data-ttu-id="c8662-438">No Windows, as unidades são criptografadas usando a tecnologia de criptografia BitLocker padrão do setor.</span><span class="sxs-lookup"><span data-stu-id="c8662-438">For Windows, the drives are encrypted using industry-standard BitLocker encryption technology.</span></span> <span data-ttu-id="c8662-439">No Linux, os discos são criptografados usando a tecnologia DM-Crypt.</span><span class="sxs-lookup"><span data-stu-id="c8662-439">For Linux, the disks are encrypted using the DM-Crypt technology.</span></span> <span data-ttu-id="c8662-440">Esse recurso é integrado ao Cofre de Chaves do Azure para permitir que você controle e gerencie as chaves de criptografia de disco.</span><span class="sxs-lookup"><span data-stu-id="c8662-440">This is integrated with Azure Key Vault to allow you to control and manage the disk encryption keys.</span></span>

<span data-ttu-id="c8662-441">A solução dá suporte aos seguintes cenários para VMs IaaS quando habilitados no Microsoft Azure:</span><span class="sxs-lookup"><span data-stu-id="c8662-441">The solution supports the following scenarios for IaaS VMs when they are enabled in Microsoft Azure:</span></span>

* <span data-ttu-id="c8662-442">Integração com o Cofre da Chave do Azure</span><span class="sxs-lookup"><span data-stu-id="c8662-442">Integration with Azure Key Vault</span></span>
* <span data-ttu-id="c8662-443">VMs da camada Standard: [VMs IaaS das séries A, D, DS, G, GS e assim por diante](https://azure.microsoft.com/pricing/details/virtual-machines/)</span><span class="sxs-lookup"><span data-stu-id="c8662-443">Standard tier VMs: [A, D, DS, G, GS, and so forth series IaaS VMs](https://azure.microsoft.com/pricing/details/virtual-machines/)</span></span>
* <span data-ttu-id="c8662-444">Como habilitar a criptografia em VMs IaaS Windows e Linux</span><span class="sxs-lookup"><span data-stu-id="c8662-444">Enabling encryption on Windows and Linux IaaS VMs</span></span>
* <span data-ttu-id="c8662-445">Como desabilitar a criptografia em unidades do sistema operacional e de dados para VMs IaaS do Windows</span><span class="sxs-lookup"><span data-stu-id="c8662-445">Disabling encryption on OS and data drives for Windows IaaS VMs</span></span>
* <span data-ttu-id="c8662-446">Como desabilitar a criptografia em unidades de dados para VMs IaaS do Linux</span><span class="sxs-lookup"><span data-stu-id="c8662-446">Disabling encryption on data drives for Linux IaaS VMs</span></span>
* <span data-ttu-id="c8662-447">Ativando a criptografia em VMs IaaS que estão executando o sistema operacional cliente Windows</span><span class="sxs-lookup"><span data-stu-id="c8662-447">Enabling encryption on IaaS VMs that are running Windows client OS</span></span>
* <span data-ttu-id="c8662-448">Como habilitar a criptografia em volumes com caminhos de montagem</span><span class="sxs-lookup"><span data-stu-id="c8662-448">Enabling encryption on volumes with mount paths</span></span>
* <span data-ttu-id="c8662-449">Habilitação da criptografia em VMs do Linux que estão configuradas com distribuição de discos (RAID) usando o mdadm</span><span class="sxs-lookup"><span data-stu-id="c8662-449">Enabling encryption on Linux VMs that are configured with disk striping (RAID) by using mdadm</span></span>
* <span data-ttu-id="c8662-450">Como habilitar a criptografia em VMs do Linux usando LVM para discos de dados</span><span class="sxs-lookup"><span data-stu-id="c8662-450">Enabling encryption on Linux VMs by using LVM for data disks</span></span>
* <span data-ttu-id="c8662-451">Ativando a criptografia em VMs do Windows que são configurados usando espaços de armazenamento</span><span class="sxs-lookup"><span data-stu-id="c8662-451">Enabling encryption on Windows VMs that are configured by using storage spaces</span></span>
* <span data-ttu-id="c8662-452">Há suporte para todas as regiões públicas do Azure</span><span class="sxs-lookup"><span data-stu-id="c8662-452">All Azure public regions are supported</span></span>

<span data-ttu-id="c8662-453">A solução não dá suporte aos seguintes cenários, recursos e tecnologia na versão:</span><span class="sxs-lookup"><span data-stu-id="c8662-453">The solution does not support the following scenarios, features, and technology in the release:</span></span>

* <span data-ttu-id="c8662-454">VMs IaaS da camada Básica</span><span class="sxs-lookup"><span data-stu-id="c8662-454">Basic tier IaaS VMs</span></span>
* <span data-ttu-id="c8662-455">Como desabilitar a criptografia em unidades do sistema operacional para VMs IaaS do Linux</span><span class="sxs-lookup"><span data-stu-id="c8662-455">Disabling encryption on an OS drive for Linux IaaS VMs</span></span>
* <span data-ttu-id="c8662-456">VMs de IaaS que são criadas usando o método de criação de VM clássico</span><span class="sxs-lookup"><span data-stu-id="c8662-456">IaaS VMs that are created by using the classic VM creation method</span></span>
* <span data-ttu-id="c8662-457">Integração com o Serviço de Gerenciamento de Chaves no local</span><span class="sxs-lookup"><span data-stu-id="c8662-457">Integration with your on-premises Key Management Service</span></span>
* <span data-ttu-id="c8662-458">Armazenamento de Arquivos do Azure (sistema de arquivos compartilhados), NFS (Network File System), volumes dinâmicos e VMs do Windows configuradas com Sistemas RAID baseados em software</span><span class="sxs-lookup"><span data-stu-id="c8662-458">Azure File storage (shared file system), Network File System (NFS), dynamic volumes, and Windows VMs that are configured with software-based RAID systems</span></span>


> [!NOTE]
> <span data-ttu-id="c8662-459">No momento, há suporte para a criptografia de disco do sistema operacional Linux nas seguintes distribuições Linux: RHEL 7.2, CentOS 7.2n e Ubuntu 16.04.</span><span class="sxs-lookup"><span data-stu-id="c8662-459">Linux OS disk encryption is currently supported on the following Linux distributions: RHEL 7.2, CentOS 7.2n, and Ubuntu 16.04.</span></span>
>
>

<span data-ttu-id="c8662-460">Esse recurso garante que todos os dados nos discos da máquina virtual sejam criptografados em repouso no Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="c8662-460">This feature ensures that all data on your virtual machine disks is encrypted at rest in Azure Storage.</span></span>

#### <a name="resources"></a><span data-ttu-id="c8662-461">Recursos</span><span class="sxs-lookup"><span data-stu-id="c8662-461">Resources</span></span>
* [<span data-ttu-id="c8662-462">Azure Disk Encryption para VMs IaaS Windows e Linux</span><span class="sxs-lookup"><span data-stu-id="c8662-462">Azure Disk Encryption for Windows and Linux IaaS VMs</span></span>](https://docs.microsoft.com/en-us/azure/security/azure-security-disk-encryption)

### <a name="comparison-of-azure-disk-encryption-sse-and-client-side-encryption"></a><span data-ttu-id="c8662-463">Comparação do Azure Disk Encryption, da SSE e da Criptografia do Cliente</span><span class="sxs-lookup"><span data-stu-id="c8662-463">Comparison of Azure Disk Encryption, SSE, and Client-Side Encryption</span></span>
#### <a name="iaas-vms-and-their-vhd-files"></a><span data-ttu-id="c8662-464">VMs IaaS e seus arquivos VHD</span><span class="sxs-lookup"><span data-stu-id="c8662-464">IaaS VMs and their VHD files</span></span>
<span data-ttu-id="c8662-465">Para discos usados pelas VMs IaaS, é recomendável usar o Azure Disk Encryption.</span><span class="sxs-lookup"><span data-stu-id="c8662-465">For disks used by IaaS VMs, we recommend using Azure Disk Encryption.</span></span> <span data-ttu-id="c8662-466">Você pode ativar a SSE para criptografar os arquivos VHD usados para apoiar os discos no Armazenamento do Azure, mas ela só criptografa os dados recém-criados.</span><span class="sxs-lookup"><span data-stu-id="c8662-466">You can turn on SSE to encrypt the VHD files that are used to back those disks in Azure Storage, but it only encrypts newly written data.</span></span> <span data-ttu-id="c8662-467">Isso significa que, se você criar uma VM e habilitar a SSE na conta de armazenamento que mantém o arquivo VHD, somente as alterações serão criptografadas, não o arquivo VHD original.</span><span class="sxs-lookup"><span data-stu-id="c8662-467">This means if you create a VM and then enable SSE on the storage account that holds the VHD file, only the changes will be encrypted, not the original VHD file.</span></span>

<span data-ttu-id="c8662-468">Se você criar uma VM usando uma imagem do Azure Marketplace, o Azure executará uma [cópia superficial](https://en.wikipedia.org/wiki/Object_copying) da imagem na sua conta de armazenamento no Armazenamento do Azure, e ela não será criptografada mesmo que você tenha habilitado a SSE.</span><span class="sxs-lookup"><span data-stu-id="c8662-468">If you create a VM using an image from the Azure Marketplace, Azure performs a [shallow copy](https://en.wikipedia.org/wiki/Object_copying) of the image to your storage account in Azure Storage, and it is not encrypted even if you have SSE enabled.</span></span> <span data-ttu-id="c8662-469">Depois de criar a VM e iniciar a atualização da imagem, a SSE começará a criptografia dos dados.</span><span class="sxs-lookup"><span data-stu-id="c8662-469">After it creates the VM and starts updating the image, SSE will start encrypting the data.</span></span> <span data-ttu-id="c8662-470">Por esse motivo, é melhor usar o Azure Disk Encryption em VMs criadas das imagens no Azure Marketplace, caso você queira usá-las totalmente criptografadas.</span><span class="sxs-lookup"><span data-stu-id="c8662-470">For this reason, it's best to use Azure Disk Encryption on VMs created from images in the Azure Marketplace if you want them fully encrypted.</span></span>

<span data-ttu-id="c8662-471">Ao transferir uma VM local previamente criptografada para o Azure, você pode carregar as chaves de criptografia no Cofre de Chaves do Azure e continuar usando a criptografia que estava usando no local para essa VM.</span><span class="sxs-lookup"><span data-stu-id="c8662-471">If you bring a pre-encrypted VM into Azure from on-premises, you will be able to upload the encryption keys to Azure Key Vault, and continue using the encryption for that VM that you were using on-premises.</span></span> <span data-ttu-id="c8662-472">O Azure Disk Encryption está habilitado para lidar com esse cenário.</span><span class="sxs-lookup"><span data-stu-id="c8662-472">Azure Disk Encryption is enabled to handle this scenario.</span></span>

<span data-ttu-id="c8662-473">Caso você tenha um VHD não criptografado no local, será possível carregá-lo na galeria como uma imagem personalizada e provisionar uma VM dela.</span><span class="sxs-lookup"><span data-stu-id="c8662-473">If you have non-encrypted VHD from on-premises, you can upload it into the gallery as a custom image and provision a VM from it.</span></span> <span data-ttu-id="c8662-474">Se fizer isso usando os modelos do Gerenciador de Recursos, você poderá pedir para ativar o Azure Disk Encryption quando a VM for inicializada.</span><span class="sxs-lookup"><span data-stu-id="c8662-474">If you do this using the Resource Manager templates, you can ask it to turn on Azure Disk Encryption when it boots up the VM.</span></span>

<span data-ttu-id="c8662-475">Ao adicionar um disco de dados e montá-lo na VM, você pode ativar o Azure Disk Encryption nesse disco de dados.</span><span class="sxs-lookup"><span data-stu-id="c8662-475">When you add a data disk and mount it on the VM, you can turn on Azure Disk Encryption on that data disk.</span></span> <span data-ttu-id="c8662-476">Ele criptografará esse disco de dados localmente primeiro e, em seguida, a camada de gerenciamento de serviço fará uma gravação lenta no armazenamento para que o conteúdo do armazenamento seja criptografado.</span><span class="sxs-lookup"><span data-stu-id="c8662-476">It will encrypt that data disk locally first, and then the service management layer will do a lazy write against storage so the storage content is encrypted.</span></span>

#### <a name="client-side-encryption"></a><span data-ttu-id="c8662-477">Criptografia do cliente</span><span class="sxs-lookup"><span data-stu-id="c8662-477">Client-side encryption</span></span>
<span data-ttu-id="c8662-478">A criptografia do cliente é o método mais seguro de criptografar dados, pois ela os criptografa antes da transferência, além de criptografar os dados em repouso.</span><span class="sxs-lookup"><span data-stu-id="c8662-478">Client-side encryption is the most secure method of encrypting your data, because it encrypts it before transit, and encrypts the data at rest.</span></span> <span data-ttu-id="c8662-479">No entanto, ela exige a adição de código aos aplicativos usando armazenamento, o que talvez não seja conveniente.</span><span class="sxs-lookup"><span data-stu-id="c8662-479">However, it does require that you add code to your applications using storage, which you may not want to do.</span></span> <span data-ttu-id="c8662-480">Nesses casos, é possível usar HTTPs para os dados em trânsito e a SSE para criptografar os dados em repouso.</span><span class="sxs-lookup"><span data-stu-id="c8662-480">In those cases, you can use HTTPs for your data in transit, and SSE to encrypt the data at rest.</span></span>

<span data-ttu-id="c8662-481">Com a criptografia do cliente, você pode criptografar entidades de tabela, mensagens da fila e blobs.</span><span class="sxs-lookup"><span data-stu-id="c8662-481">With client-side encryption, you can encrypt table entities, queue messages, and blobs.</span></span> <span data-ttu-id="c8662-482">Com a SSE, você pode criptografar apenas os blobs.</span><span class="sxs-lookup"><span data-stu-id="c8662-482">With SSE, you can only encrypt blobs.</span></span> <span data-ttu-id="c8662-483">Se precisar que dados de tabela e fila sejam criptografados, você deverá usar a criptografia do cliente.</span><span class="sxs-lookup"><span data-stu-id="c8662-483">If you need table and queue data to be encrypted, you should use client-side encryption.</span></span>

<span data-ttu-id="c8662-484">A criptografia do cliente é totalmente gerenciada pelo aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c8662-484">Client-side encryption is managed entirely by the application.</span></span> <span data-ttu-id="c8662-485">Essa é a abordagem mais segura, mas exige que você faça alterações programáticas no aplicativo e implemente processos de gerenciamento de chaves.</span><span class="sxs-lookup"><span data-stu-id="c8662-485">This is the most secure approach, but does require you to make programmatic changes to your application and put key management processes in place.</span></span> <span data-ttu-id="c8662-486">Você a usa quando deseja segurança extra durante a transferência e que os dados armazenados sejam criptografados.</span><span class="sxs-lookup"><span data-stu-id="c8662-486">You would use this when you want the extra security during transit, and you want your stored data to be encrypted.</span></span>

<span data-ttu-id="c8662-487">A criptografia do cliente significa mais carga no cliente, e você deve levar isso em conta em seus planos de escalabilidade, especialmente se estiver criptografando e transferindo muitos dados.</span><span class="sxs-lookup"><span data-stu-id="c8662-487">Client-side encryption is more load on the client, and you have to account for this in your scalability plans, especially if you are encrypting and transferring a lot of data.</span></span>

#### <a name="storage-service-encryption-sse"></a><span data-ttu-id="c8662-488">SSE (Criptografia do Serviço de Armazenamento)</span><span class="sxs-lookup"><span data-stu-id="c8662-488">Storage Service Encryption (SSE)</span></span>
<span data-ttu-id="c8662-489">A SSE é gerenciada pelo Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="c8662-489">SSE is managed by Azure Storage.</span></span> <span data-ttu-id="c8662-490">O uso da SSE não fornece segurança aos dados em trânsito, mas ela criptografa os dados conforme eles são gravados no Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="c8662-490">Using SSE does not provide for the security of the data in transit, but it does encrypt the data as it is written to Azure Storage.</span></span> <span data-ttu-id="c8662-491">Não há impacto no desempenho ao usar esse recurso.</span><span class="sxs-lookup"><span data-stu-id="c8662-491">There is no impact on the performance when using this feature.</span></span>

<span data-ttu-id="c8662-492">Você pode criptografar apenas os blobs de blocos, os blobs de acréscimo e os blobs de páginas usando a SSE.</span><span class="sxs-lookup"><span data-stu-id="c8662-492">You can only encrypt block blobs, append blobs, and page blobs using SSE.</span></span> <span data-ttu-id="c8662-493">Se precisar criptografar dados de tabela ou fila, pense em usar a criptografia do cliente.</span><span class="sxs-lookup"><span data-stu-id="c8662-493">If you need to encrypt table data or queue data, you should consider using client-side encryption.</span></span>

<span data-ttu-id="c8662-494">Se tiver um arquivo ou uma biblioteca de arquivos VHD que usa como base para a criação de novas máquinas virtuais, você poderá criar uma nova conta de armazenamento, habilitar a SSE e carregar os arquivos VHD nessa conta.</span><span class="sxs-lookup"><span data-stu-id="c8662-494">If you have an archive or library of VHD files that you use as a basis for creating new virtual machines, you can create a new storage account, enable SSE, and then upload the VHD files to that account.</span></span> <span data-ttu-id="c8662-495">Esses arquivos VHD serão criptografados pelo Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="c8662-495">Those VHD files will be encrypted by Azure Storage.</span></span>

<span data-ttu-id="c8662-496">Se você tiver o Azure Disk Encryption habilitado nos discos em uma VM e a SSE habilitada na conta de armazenamento que mantém os arquivos VHD, isso funcionará bem; os dados recém-gravados serão criptografados duas vezes.</span><span class="sxs-lookup"><span data-stu-id="c8662-496">If you have Azure Disk Encryption enabled for the disks in a VM and SSE enabled on the storage account holding the VHD files, it will work fine; it will result in any newly-written data being encrypted twice.</span></span>

## <a name="storage-analytics"></a><span data-ttu-id="c8662-497">Análise de Armazenamento</span><span class="sxs-lookup"><span data-stu-id="c8662-497">Storage Analytics</span></span>
### <a name="using-storage-analytics-to-monitor-authorization-type"></a><span data-ttu-id="c8662-498">Usando a Análise de Armazenamento para monitorar o tipo de autorização</span><span class="sxs-lookup"><span data-stu-id="c8662-498">Using Storage Analytics to monitor authorization type</span></span>
<span data-ttu-id="c8662-499">Para cada conta de armazenamento, você pode habilitar a Análise de Armazenamento do Azure para realizar o registro em log e armazenar dados de métricas.</span><span class="sxs-lookup"><span data-stu-id="c8662-499">For each storage account, you can enable Azure Storage Analytics to perform logging and store metrics data.</span></span> <span data-ttu-id="c8662-500">Essa é uma excelente ferramenta a ser usada quando você quiser verificar as métricas de desempenho de uma conta de armazenamento ou quando precisar solucionar problemas de uma conta de armazenamento porque está tendo problemas de desempenho.</span><span class="sxs-lookup"><span data-stu-id="c8662-500">This is a great tool to use when you want to check the performance metrics of a storage account, or need to troubleshoot a storage account because you are having performance problems.</span></span>

<span data-ttu-id="c8662-501">Outra parte dos dados que você pode ver nos logs da análise de armazenamento é o método de autenticação usado por uma pessoa quando ela acessa o armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-501">Another piece of data you can see in the storage analytics logs is the authentication method used by someone when they access storage.</span></span> <span data-ttu-id="c8662-502">Por exemplo, no Armazenamento de Blobs, você pode ver se a pessoa usou uma Assinatura de Acesso Compartilhado ou as chaves da conta de armazenamento, ou se o blob acessado era público.</span><span class="sxs-lookup"><span data-stu-id="c8662-502">For example, with Blob Storage, you can see if they used a Shared Access Signature or the storage account keys, or if the blob accessed was public.</span></span>

<span data-ttu-id="c8662-503">Isso pode ser muito útil se você estiver protegendo rigorosamente o acesso ao armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-503">This can be really helpful if you are tightly guarding access to storage.</span></span> <span data-ttu-id="c8662-504">Por exemplo, no Armazenamento de Blobs, é possível definir todos os contêineres para privado e implementar o uso de um serviço SAS em todos os aplicativos.</span><span class="sxs-lookup"><span data-stu-id="c8662-504">For example, in Blob Storage you can set all of the containers to private and implement the use of an SAS service throughout your applications.</span></span> <span data-ttu-id="c8662-505">Desse modo, você pode verificar os logs regularmente para ver se seus blobs são acessados usando as chaves da conta de armazenamento, que pode indicar uma violação de segurança ou se os blobs são públicos, mas não deveriam ser.</span><span class="sxs-lookup"><span data-stu-id="c8662-505">Then you can check the logs regularly to see if your blobs are accessed using the storage account keys, which may indicate a breach of security, or if the blobs are public but they shouldn't be.</span></span>

#### <a name="what-do-the-logs-look-like"></a><span data-ttu-id="c8662-506">Como os logs devem ser?</span><span class="sxs-lookup"><span data-stu-id="c8662-506">What do the logs look like?</span></span>
<span data-ttu-id="c8662-507">Depois de habilitar o registro em log e as métricas da conta de armazenamento usando o Portal do Azure, os dados de análise começarão a se acumular rapidamente.</span><span class="sxs-lookup"><span data-stu-id="c8662-507">After you enable the storage account metrics and logging through the Azure portal, analytics data will start to accumulate quickly.</span></span> <span data-ttu-id="c8662-508">O registro em log e as métricas para cada serviço são distintos; o registro em log é feito apenas quando há atividade na conta de armazenamento, enquanto as métricas são registradas a cada minuto, de hora em hora, ou todos os dias, de acordo com a configuração.</span><span class="sxs-lookup"><span data-stu-id="c8662-508">The logging and metrics for each service is separate; the logging is only written when there is activity in that storage account, while the metrics will be logged every minute, every hour, or every day, depending on how you configure it.</span></span>

<span data-ttu-id="c8662-509">Os logs são armazenados em blobs de blocos em um contêiner chamado $logs na conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-509">The logs are stored in block blobs in a container named $logs in the storage account.</span></span> <span data-ttu-id="c8662-510">Esse contêiner é criado automaticamente quando a Análise de Armazenamento é habilitada.</span><span class="sxs-lookup"><span data-stu-id="c8662-510">This container is automatically created when Storage Analytics is enabled.</span></span> <span data-ttu-id="c8662-511">Uma vez criado, esse contêiner não pode ser excluído, embora você possa excluir seu conteúdo.</span><span class="sxs-lookup"><span data-stu-id="c8662-511">Once this container is created, you can't delete it, although you can delete its contents.</span></span>

<span data-ttu-id="c8662-512">No contêiner $logs, há uma pasta para cada serviço e há subpastas para ano/mês/dia/hora.</span><span class="sxs-lookup"><span data-stu-id="c8662-512">Under the $logs container, there is a folder for each service, and then there are subfolders for the year/month/day/hour.</span></span> <span data-ttu-id="c8662-513">Em hora, os logs simplesmente são numerados.</span><span class="sxs-lookup"><span data-stu-id="c8662-513">Under hour, the logs are simply numbered.</span></span> <span data-ttu-id="c8662-514">Esta é a aparência da estrutura do diretório:</span><span class="sxs-lookup"><span data-stu-id="c8662-514">This is what the directory structure will look like:</span></span>

![Exibição dos arquivos de log](./media/storage-security-guide/image1.png)

<span data-ttu-id="c8662-516">Cada solicitação no Armazenamento do Azure é registrada.</span><span class="sxs-lookup"><span data-stu-id="c8662-516">Every request to Azure Storage is logged.</span></span> <span data-ttu-id="c8662-517">Veja um instantâneo de um arquivo de log, mostrando os primeiros campos.</span><span class="sxs-lookup"><span data-stu-id="c8662-517">Here's a snapshot of a log file, showing the first few fields.</span></span>

![Instantâneo de um arquivo de log](./media/storage-security-guide/image2.png)

<span data-ttu-id="c8662-519">É possível ver que você pode usar os logs para rastrear qualquer tipo de chamada para uma conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-519">You can see that you can use the logs to track any kind of calls to a storage account.</span></span>

#### <a name="what-are-all-of-those-fields-for"></a><span data-ttu-id="c8662-520">Para que servem todos esses campos?</span><span class="sxs-lookup"><span data-stu-id="c8662-520">What are all of those fields for?</span></span>
<span data-ttu-id="c8662-521">Há um artigo listado nos recursos abaixo que fornece a lista dos muitos campos nos logs e para que eles são usados.</span><span class="sxs-lookup"><span data-stu-id="c8662-521">There is an article listed in the resources below that provides the list of the many fields in the logs and what they are used for.</span></span> <span data-ttu-id="c8662-522">Veja a lista de campos na ordem:</span><span class="sxs-lookup"><span data-stu-id="c8662-522">Here is the list of fields in order:</span></span>

![Instantâneo de campos em um arquivo de log](./media/storage-security-guide/image3.png)

<span data-ttu-id="c8662-524">Estamos interessados nas entradas para GetBlob e em como elas são autenticadas, de modo que precisamos procurar entradas com operation-type "Get-Blob" e verificar request-status (4<sup>a</sup> coluna) e authorization-type (8<sup>a</sup> coluna).</span><span class="sxs-lookup"><span data-stu-id="c8662-524">We're interested in the entries for GetBlob, and how they are authenticated, so we need to look for entries with operation-type "Get-Blob", and check the request-status (4<sup>th</sup> column) and the authorization-type (8<sup>th</sup> column).</span></span>

<span data-ttu-id="c8662-525">Por exemplo, nas primeiras linhas na lista acima, request-status é "Success" e authorization-type é "authenticated".</span><span class="sxs-lookup"><span data-stu-id="c8662-525">For example, in the first few rows in the listing above, the request-status is "Success" and the authorization-type is "authenticated".</span></span> <span data-ttu-id="c8662-526">Isso significa que a solicitação foi validada usando a chave da conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-526">This means the request was validated using the storage account key.</span></span>

#### <a name="how-are-my-blobs-being-authenticated"></a><span data-ttu-id="c8662-527">Como meu blobs estão sendo autenticados?</span><span class="sxs-lookup"><span data-stu-id="c8662-527">How are my blobs being authenticated?</span></span>
<span data-ttu-id="c8662-528">Temos três casos que nos interessam.</span><span class="sxs-lookup"><span data-stu-id="c8662-528">We have three cases that we are interested in.</span></span>

1. <span data-ttu-id="c8662-529">O blob é público e é acessado usando uma URL sem uma Assinatura de Acesso Compartilhado.</span><span class="sxs-lookup"><span data-stu-id="c8662-529">The blob is public and it is accessed using a URL without a Shared Access Signature.</span></span> <span data-ttu-id="c8662-530">Nesse caso, request-status é "AnonymousSuccess" e authorization-type é "anonymous".</span><span class="sxs-lookup"><span data-stu-id="c8662-530">In this case, the request-status is "AnonymousSuccess" and the authorization-type is "anonymous".</span></span>

   <span data-ttu-id="c8662-531">1.0;2015-11-17T02:01:29.0488963Z;GetBlob;**AnonymousSuccess**;200;124;37;**anonymous**;;mystorage…</span><span class="sxs-lookup"><span data-stu-id="c8662-531">1.0;2015-11-17T02:01:29.0488963Z;GetBlob;**AnonymousSuccess**;200;124;37;**anonymous**;;mystorage…</span></span>
2. <span data-ttu-id="c8662-532">O blob é privado e foi usado com uma Assinatura de Acesso Compartilhado.</span><span class="sxs-lookup"><span data-stu-id="c8662-532">The blob is private and was used with a Shared Access Signature.</span></span> <span data-ttu-id="c8662-533">Nesse caso, request-status é "SASSuccess" e authorization-type é "sas".</span><span class="sxs-lookup"><span data-stu-id="c8662-533">In this case, the request-status is "SASSuccess" and the authorization-type is "sas".</span></span>

   <span data-ttu-id="c8662-534">1.0;2015-11-16T18:30:05.6556115Z;GetBlob;**SASSuccess**;200;416;64;**sas**;;mystorage…</span><span class="sxs-lookup"><span data-stu-id="c8662-534">1.0;2015-11-16T18:30:05.6556115Z;GetBlob;**SASSuccess**;200;416;64;**sas**;;mystorage…</span></span>
3. <span data-ttu-id="c8662-535">O blob é privado e a chave de armazenamento foi usada para acessá-lo.</span><span class="sxs-lookup"><span data-stu-id="c8662-535">The blob is private and the storage key was used to access it.</span></span> <span data-ttu-id="c8662-536">Nesse caso, request-status é "**Success**" e authorization-type é "**authenticated**".</span><span class="sxs-lookup"><span data-stu-id="c8662-536">In this case, the request-status is "**Success**" and the authorization-type is "**authenticated**".</span></span>

   <span data-ttu-id="c8662-537">1.0;2015-11-16T18:32:24.3174537Z;GetBlob;**Success**;206;59;22;**authenticated**;mystorage…</span><span class="sxs-lookup"><span data-stu-id="c8662-537">1.0;2015-11-16T18:32:24.3174537Z;GetBlob;**Success**;206;59;22;**authenticated**;mystorage…</span></span>

<span data-ttu-id="c8662-538">Você pode usar o Analisador de Mensagem da Microsoft para exibir e analisar esses logs.</span><span class="sxs-lookup"><span data-stu-id="c8662-538">You can use the Microsoft Message Analyzer to view and analyze these logs.</span></span> <span data-ttu-id="c8662-539">Ele inclui recursos de pesquisa e filtro.</span><span class="sxs-lookup"><span data-stu-id="c8662-539">It includes search and filter capabilities.</span></span> <span data-ttu-id="c8662-540">Por exemplo, você talvez queira procurar instâncias de GetBlob para ver se o uso é o esperado, isto é, para garantir que ninguém esteja acessando a conta de armazenamento inapropriadamente.</span><span class="sxs-lookup"><span data-stu-id="c8662-540">For example, you might want to search for instances of GetBlob to see if the usage is what you expect, i.e. to make sure someone is not accessing your storage account inappropriately.</span></span>

#### <a name="resources"></a><span data-ttu-id="c8662-541">Recursos</span><span class="sxs-lookup"><span data-stu-id="c8662-541">Resources</span></span>
* [<span data-ttu-id="c8662-542">Análise de Armazenamento</span><span class="sxs-lookup"><span data-stu-id="c8662-542">Storage Analytics</span></span>](../storage-analytics.md)

  <span data-ttu-id="c8662-543">Esse artigo é uma visão geral da análise de armazenamento e de como habilitá-la.</span><span class="sxs-lookup"><span data-stu-id="c8662-543">This article is an overview of storage analytics and how to enable them.</span></span>
* [<span data-ttu-id="c8662-544">Formato de Log de análise de armazenamento</span><span class="sxs-lookup"><span data-stu-id="c8662-544">Storage Analytics Log Format</span></span>](https://msdn.microsoft.com/library/azure/hh343259.aspx)

  <span data-ttu-id="c8662-545">Esse artigo ilustra o Formato de Log da Análise de Armazenamento, além de detalhar os campos disponíveis nele, incluindo authentication-type, que indica o tipo de autenticação usado para a solicitação.</span><span class="sxs-lookup"><span data-stu-id="c8662-545">This article illustrates the Storage Analytics Log Format, and details the fields available therein, including authentication-type, which indicates the type of authentication used for the request.</span></span>
* [<span data-ttu-id="c8662-546">Monitorar uma conta de armazenamento no Portal do Azure</span><span class="sxs-lookup"><span data-stu-id="c8662-546">Monitor a Storage Account in the Azure portal</span></span>](../storage-monitor-storage-account.md)

  <span data-ttu-id="c8662-547">Esse artigo mostra como configurar o monitoramento de métricas e registro em log para uma conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-547">This article shows how to configure monitoring of metrics and logging for a storage account.</span></span>
* [<span data-ttu-id="c8662-548">Solução de problemas ponta a ponta usando Métricas de Armazenamento do Azure e Registro em Log, AzCopy e Analisador de Mensagem</span><span class="sxs-lookup"><span data-stu-id="c8662-548">End-to-End Troubleshooting using Azure Storage Metrics and Logging, AzCopy, and Message Analyzer</span></span>](../storage-e2e-troubleshooting.md)

  <span data-ttu-id="c8662-549">Esse artigo aborda a solução de problemas usando a Análise de Armazenamento e mostra como usar o Analisador de Mensagem da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="c8662-549">This article talks about troubleshooting using the Storage Analytics and shows how to use the Microsoft Message Analyzer.</span></span>
* [<span data-ttu-id="c8662-550">Guia Operacional do Analisador de Mensagem da Microsoft</span><span class="sxs-lookup"><span data-stu-id="c8662-550">Microsoft Message Analyzer Operating Guide</span></span>](https://technet.microsoft.com/library/jj649776.aspx)

  <span data-ttu-id="c8662-551">Esse artigo é a referência do Analisador de Mensagem da Microsoft e inclui links para um tutorial, início rápido e resumo do recurso.</span><span class="sxs-lookup"><span data-stu-id="c8662-551">This article is the reference for the Microsoft Message Analyzer and includes links to a tutorial, quick start, and feature summary.</span></span>

## <a name="cross-origin-resource-sharing-cors"></a><span data-ttu-id="c8662-552">CORS (Compartilhamento de Recursos entre Origens)</span><span class="sxs-lookup"><span data-stu-id="c8662-552">Cross-Origin Resource Sharing (CORS)</span></span>
### <a name="cross-domain-access-of-resources"></a><span data-ttu-id="c8662-553">Acesso de recursos entre domínios</span><span class="sxs-lookup"><span data-stu-id="c8662-553">Cross-domain access of resources</span></span>
<span data-ttu-id="c8662-554">Quando um navegador da Web em execução em um domínio faz uma solicitação HTTP a um recurso de outro domínio, isso é chamado de solicitação HTTP entre origens.</span><span class="sxs-lookup"><span data-stu-id="c8662-554">When a web browser running in one domain makes an HTTP request for a resource from a different domain, this is called a cross-origin HTTP request.</span></span> <span data-ttu-id="c8662-555">Por exemplo, uma página HTML no site da contoso.com faz uma solicitação para um jpeg hospedado em fabrikam.blob.core.windows.net.</span><span class="sxs-lookup"><span data-stu-id="c8662-555">For example, an HTML page served from contoso.com makes a request for a jpeg hosted on fabrikam.blob.core.windows.net.</span></span> <span data-ttu-id="c8662-556">Por motivos de segurança, os navegadores restringem as solicitações HTTP entre origens iniciadas dentro de scripts, como JavaScript.</span><span class="sxs-lookup"><span data-stu-id="c8662-556">For security reasons, browsers restrict cross-origin HTTP requests initiated from within scripts, such as JavaScript.</span></span> <span data-ttu-id="c8662-557">Isso significa que quando algum código JavaScript em uma página da Web de contoso.com solicita esse jpeg em fabrikam.blob.core.windows.net, o navegador não permite a solicitação.</span><span class="sxs-lookup"><span data-stu-id="c8662-557">This means that when some JavaScript code on a web page on contoso.com requests that jpeg on fabrikam.blob.core.windows.net, the browser will not allow the request.</span></span>

<span data-ttu-id="c8662-558">O que isso tem a ver com o Armazenamento do Azure?</span><span class="sxs-lookup"><span data-stu-id="c8662-558">What does this have to do with Azure Storage?</span></span> <span data-ttu-id="c8662-559">Bem, se você estiver armazenando ativos estáticos, como arquivos de dados XML ou JSON no Armazenamento de Blobs usando uma conta de armazenamento chamada Fabrikam, o domínio para os ativos será fabrikam.blob.core.windows.net e o aplicativo Web contoso.com não poderá acessá-los usando JavaScript porque os domínios são diferentes.</span><span class="sxs-lookup"><span data-stu-id="c8662-559">Well, if you are storing static assets such as JSON or XML data files in Blob Storage using a storage account called Fabrikam, the domain for the assets will be fabrikam.blob.core.windows.net, and the contoso.com web application will not be able to access them using JavaScript because the domains are different.</span></span> <span data-ttu-id="c8662-560">Isso também se aplicará se você estiver tentando chamar um dos Serviços de Armazenamento do Azure (como o Armazenamento de Tabelas) que retornam dados JSON para serem processados pelo cliente JavaScript.</span><span class="sxs-lookup"><span data-stu-id="c8662-560">This is also true if you're trying to call one of the Azure Storage Services – such as Table Storage – that return JSON data to be processed by the JavaScript client.</span></span>

#### <a name="possible-solutions"></a><span data-ttu-id="c8662-561">Soluções possíveis</span><span class="sxs-lookup"><span data-stu-id="c8662-561">Possible solutions</span></span>
<span data-ttu-id="c8662-562">Uma maneira de resolver isso é atribuir um domínio personalizado, como "storage.contoso.com" a fabrikam.blob.core.windows.net.</span><span class="sxs-lookup"><span data-stu-id="c8662-562">One way to resolve this is to assign a custom domain like "storage.contoso.com" to fabrikam.blob.core.windows.net.</span></span> <span data-ttu-id="c8662-563">O problema é que você só pode atribuir esse domínio personalizado a uma conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-563">The problem is that you can only assign that custom domain to one storage account.</span></span> <span data-ttu-id="c8662-564">E se os ativos estiverem armazenados em várias contas de armazenamento?</span><span class="sxs-lookup"><span data-stu-id="c8662-564">What if the assets are stored in multiple storage accounts?</span></span>

<span data-ttu-id="c8662-565">Outra maneira de resolver esse problema é ter o aplicativo Web que atua como proxy para as chamadas de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-565">Another way to resolve this is to have the web application act as a proxy for the storage calls.</span></span> <span data-ttu-id="c8662-566">Isso significa que se você estiver carregando um arquivo no Armazenamento de Blobs, o aplicativo Web o gravará localmente e, em seguida, o copiará no Armazenamento de Blobs, ou lerá todo ele na memória e depois o gravará no Armazenamento de Blobs.</span><span class="sxs-lookup"><span data-stu-id="c8662-566">This means if you are uploading a file to Blob Storage, the web application would either write it locally and then copy it to Blob Storage, or it would read all of it into memory and then write it to Blob Storage.</span></span> <span data-ttu-id="c8662-567">Como alternativa, você escrever um aplicativo Web dedicado (como uma API Web) que carrega os arquivos localmente e os grava no Armazenamento de Blobs.</span><span class="sxs-lookup"><span data-stu-id="c8662-567">Alternately, you could write a dedicated web application (such as a Web API) that uploads the files locally and writes them to Blob Storage.</span></span> <span data-ttu-id="c8662-568">De qualquer forma, é preciso prestar contas a essa função ao determinar a escalabilidade necessária.</span><span class="sxs-lookup"><span data-stu-id="c8662-568">Either way, you have to account for that function when determining the scalability needs.</span></span>

#### <a name="how-can-cors-help"></a><span data-ttu-id="c8662-569">Como o CORS pode ajudar?</span><span class="sxs-lookup"><span data-stu-id="c8662-569">How can CORS help?</span></span>
<span data-ttu-id="c8662-570">O Armazenamento do Azure permite habilitar o CORS – Compartilhamento de Recursos entre Origens.</span><span class="sxs-lookup"><span data-stu-id="c8662-570">Azure Storage allows you to enable CORS – Cross Origin Resource Sharing.</span></span> <span data-ttu-id="c8662-571">Para cada conta de armazenamento, é possível especificar os domínios que podem acessar os recursos na conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-571">For each storage account, you can specify domains that can access the resources in that storage account.</span></span> <span data-ttu-id="c8662-572">Por exemplo, no caso descrito acima, podemos pode habilitar o CORS na conta de armazenamento fabrikam.blob.core.windows.net e configurá-lo para permitir o acesso em contoso.com. Assim, o aplicativo Web de contoso.com pode acessar diretamente os recursos em fabrikam.blob.core.windows.net.</span><span class="sxs-lookup"><span data-stu-id="c8662-572">For example, in our case outlined above, we can enable CORS on the fabrikam.blob.core.windows.net storage account and configure it to allow access to contoso.com. Then the web application contoso.com can directly access the resources in fabrikam.blob.core.windows.net.</span></span>

<span data-ttu-id="c8662-573">Observe que o CORS permite o acesso, mas não fornece autenticação, que é obrigatória para todo acesso não público dos recursos de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-573">One thing to note is that CORS allows access, but it does not provide authentication, which is required for all non-public access of storage resources.</span></span> <span data-ttu-id="c8662-574">Isso significa que você poderá acessar blobs somente se eles forem públicos ou se incluir uma Assinatura de Acesso Compartilhado dando a você permissão adequada.</span><span class="sxs-lookup"><span data-stu-id="c8662-574">This means you can only access blobs if they are public or you include a Shared Access Signature giving you the appropriate permission.</span></span> <span data-ttu-id="c8662-575">Arquivos, filas e tabelas não têm acesso público e exigem uma SAS.</span><span class="sxs-lookup"><span data-stu-id="c8662-575">Tables, queues, and files have no public access, and require a SAS.</span></span>

<span data-ttu-id="c8662-576">Por padrão, o CORS está desabilitado em todos os serviços</span><span class="sxs-lookup"><span data-stu-id="c8662-576">By default, CORS is disabled on all services.</span></span> <span data-ttu-id="c8662-577">Você pode habilitar o CORS usando a API REST ou a biblioteca de cliente de armazenamento para chamar um dos métodos e definir as políticas de serviço.</span><span class="sxs-lookup"><span data-stu-id="c8662-577">You can enable CORS by using the REST API or the storage client library to call one of the methods to set the service policies.</span></span> <span data-ttu-id="c8662-578">Ao fazer isso, você inclui uma regra de CORS, que está em XML.</span><span class="sxs-lookup"><span data-stu-id="c8662-578">When you do that, you include a CORS rule, which is in XML.</span></span> <span data-ttu-id="c8662-579">Veja um exemplo de uma regra de CORS que foi definida usando a operação Definir Propriedades de Serviço para o Serviço Blob de uma conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-579">Here's an example of a CORS rule that has been set using the Set Service Properties operation for the Blob Service for a storage account.</span></span> <span data-ttu-id="c8662-580">Você pode executar essa operação usando a biblioteca de cliente de armazenamento ou as APIs REST do Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="c8662-580">You can perform that operation using the storage client library or the REST APIs for Azure Storage.</span></span>

```xml
<Cors>    
    <CorsRule>
        <AllowedOrigins>http://www.contoso.com, http://www.fabrikam.com</AllowedOrigins>
        <AllowedMethods>PUT,GET</AllowedMethods>
        <AllowedHeaders>x-ms-meta-data*,x-ms-meta-target*,x-ms-meta-abc</AllowedHeaders>
        <ExposedHeaders>x-ms-meta-*</ExposedHeaders>
        <MaxAgeInSeconds>200</MaxAgeInSeconds>
    </CorsRule>
<Cors>
```

<span data-ttu-id="c8662-581">Veja o que cada linha significa:</span><span class="sxs-lookup"><span data-stu-id="c8662-581">Here's what each row means:</span></span>

* <span data-ttu-id="c8662-582">**AllowedOrigins** Informa quais domínios não correspondentes podem solicitar e receber dados do serviço de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-582">**AllowedOrigins** This tells which non-matching domains can request and receive data from the storage service.</span></span> <span data-ttu-id="c8662-583">Isso significa que contoso.com e fabrikam.com podem solicitar dados do Armazenamento de Blobs para uma conta de armazenamento específica.</span><span class="sxs-lookup"><span data-stu-id="c8662-583">This says that both contoso.com and fabrikam.com can request data from Blob Storage for a specific storage account.</span></span> <span data-ttu-id="c8662-584">Você também pode defini-lo para um caractere curinga (\*) a fim de permitir que todos os domínios acessem solicitações.</span><span class="sxs-lookup"><span data-stu-id="c8662-584">You can also set this to a wildcard (\*) to allow all domains to access requests.</span></span>
* <span data-ttu-id="c8662-585">**AllowedMethods** Essa é a lista de métodos (verbos de solicitação HTTP) que podem ser usados ao fazer a solicitação.</span><span class="sxs-lookup"><span data-stu-id="c8662-585">**AllowedMethods** This is the list of methods (HTTP request verbs) that can be used when making the request.</span></span> <span data-ttu-id="c8662-586">Neste exemplo, apenas PUT e GET são permitidos.</span><span class="sxs-lookup"><span data-stu-id="c8662-586">In this example, only PUT and GET are allowed.</span></span> <span data-ttu-id="c8662-587">Você pode defini-lo para um caractere curinga (\*) a fim de permitir que todos os métodos sejam usados.</span><span class="sxs-lookup"><span data-stu-id="c8662-587">You can set this to a wildcard (\*) to allow all methods to be used.</span></span>
* <span data-ttu-id="c8662-588">**AllowedHeaders** Esses são os cabeçalhos de solicitação que o domínio de origem pode especificar ao fazer a solicitação.</span><span class="sxs-lookup"><span data-stu-id="c8662-588">**AllowedHeaders** This is the request headers that the origin domain can specify when making the request.</span></span> <span data-ttu-id="c8662-589">No exemplo acima, todos os cabeçalhos de metadados, começando com x-ms-meta-data, x-ms-meta-target e x-ms-meta-abc, são permitidos.</span><span class="sxs-lookup"><span data-stu-id="c8662-589">In this example, all metadata headers starting with x-ms-meta-data, x-ms-meta-target, and x-ms-meta-abc are permitted.</span></span> <span data-ttu-id="c8662-590">O caractere curinga (\*) indica que todos os cabeçalhos que começam com o prefixo especificado são permitidos.</span><span class="sxs-lookup"><span data-stu-id="c8662-590">The wildcard character (\*) indicates that any header beginning with the specified prefix is allowed.</span></span>
* <span data-ttu-id="c8662-591">**ExposedHeaders** Informa que os cabeçalhos de resposta devem ser expostos pelo navegador ao emissor da solicitação.</span><span class="sxs-lookup"><span data-stu-id="c8662-591">**ExposedHeaders** This tells which response headers should be exposed by the browser to the request issuer.</span></span> <span data-ttu-id="c8662-592">Neste exemplo, qualquer cabeçalho que começar com "x-ms-meta-" será exposto.</span><span class="sxs-lookup"><span data-stu-id="c8662-592">In this example, any header starting with "x-ms-meta-" will be exposed.</span></span>
* <span data-ttu-id="c8662-593">**MaxAgeInSeconds** Essa é a quantidade máxima de tempo que um navegador armazenará em cache a solicitação OPTIONS de simulação.</span><span class="sxs-lookup"><span data-stu-id="c8662-593">**MaxAgeInSeconds** This is the maximum amount of time that a browser will cache the preflight OPTIONS request.</span></span> <span data-ttu-id="c8662-594">(Para obter mais informações sobre a solicitação de simulação, verifique o primeiro artigo abaixo).</span><span class="sxs-lookup"><span data-stu-id="c8662-594">(For more information about the preflight request, check the first article below.)</span></span>

#### <a name="resources"></a><span data-ttu-id="c8662-595">Recursos</span><span class="sxs-lookup"><span data-stu-id="c8662-595">Resources</span></span>
<span data-ttu-id="c8662-596">Para obter mais informações sobre o CORS e como habilitá-lo, verifique estes recursos.</span><span class="sxs-lookup"><span data-stu-id="c8662-596">For more information about CORS and how to enable it, please check out these resources.</span></span>

* [<span data-ttu-id="c8662-597">Suporte para o compartilhamento de recursos entre origens (CORS) para os serviços de armazenamento do Azure</span><span class="sxs-lookup"><span data-stu-id="c8662-597">Cross-Origin Resource Sharing (CORS) Support for the Azure Storage Services on Azure.com</span></span>](../storage-cors-support.md)

  <span data-ttu-id="c8662-598">Este artigo fornece uma visão geral do CORS e como definir as regras para os diferentes serviços de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c8662-598">This article provides an overview of CORS and how to set the rules for the different storage services.</span></span>
* <span data-ttu-id="c8662-599">[Cross-Origin Resource Sharing (CORS) Support for the Azure Storage Services on MSDN (Suporte ao CORS [Compartilhamento de Recursos entre Origens] para os Serviços de Armazenamento do Azure no MSDN)](https://msdn.microsoft.com/library/azure/dn535601.aspx)</span><span class="sxs-lookup"><span data-stu-id="c8662-599">[Cross-Origin Resource Sharing (CORS) Support for the Azure Storage Services on MSDN](https://msdn.microsoft.com/library/azure/dn535601.aspx)</span></span>

  <span data-ttu-id="c8662-600">Esta é a documentação de referência do suporte ao CORS para os Serviços de Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="c8662-600">This is the reference documentation for CORS support for the Azure Storage Services.</span></span> <span data-ttu-id="c8662-601">Ela tem links para artigos que se aplicam a cada serviço de armazenamento, além de mostrar um exemplo e explicar cada elemento no arquivo CORS.</span><span class="sxs-lookup"><span data-stu-id="c8662-601">This has links to articles applying to each storage service, and shows an example and explains each element in the CORS file.</span></span>
* [<span data-ttu-id="c8662-602">Microsoft Azure Storage: Introducing CORS (Armazenamento do Microsoft Azure: introdução ao CORS)</span><span class="sxs-lookup"><span data-stu-id="c8662-602">Microsoft Azure Storage: Introducing CORS</span></span>](http://blogs.msdn.com/b/windowsazurestorage/archive/2014/02/03/windows-azure-storage-introducing-cors.aspx)

  <span data-ttu-id="c8662-603">Esse é um link para o artigo do blog inicial que anuncia o CORS e mostra como usá-lo.</span><span class="sxs-lookup"><span data-stu-id="c8662-603">This is a link to the initial blog article announcing CORS and showing how to use it.</span></span>

## <a name="frequently-asked-questions-about-azure-storage-security"></a><span data-ttu-id="c8662-604">Perguntas frequentes sobre a segurança do Armazenamento do Azure</span><span class="sxs-lookup"><span data-stu-id="c8662-604">Frequently asked questions about Azure Storage security</span></span>
1. <span data-ttu-id="c8662-605">**Como poderei verificar a integridade dos blobs que estou transferindo para dentro ou para fora do Armazenamento do Azure se eu não puder usar o protocolo HTTPS?**</span><span class="sxs-lookup"><span data-stu-id="c8662-605">**How can I verify the integrity of the blobs I'm transferring into or out of Azure Storage if I can't use the HTTPS protocol?**</span></span>

   <span data-ttu-id="c8662-606">Se, por algum motivo, você precisar usar HTTP em vez de HTTPS e estiver trabalhando com blobs de bloco, você poderá usar a verificação MD5 para ajudar a averiguar a integridade dos blobs que estão sendo transferidos.</span><span class="sxs-lookup"><span data-stu-id="c8662-606">If for any reason you need to use HTTP instead of HTTPS and you are working with block blobs, you can use MD5 checking to help verify the integrity of the blobs being transferred.</span></span> <span data-ttu-id="c8662-607">Isso ajudará na proteção contra erros na camada de rede/transporte, mas não necessariamente contra ataques de intermediários.</span><span class="sxs-lookup"><span data-stu-id="c8662-607">This will help with protection from network/transport layer errors, but not necessarily with intermediary attacks.</span></span>

   <span data-ttu-id="c8662-608">Se você puder usar HTTPS, que fornece segurança em nível de transporte, o uso da verificação MD5 será redundante e desnecessário.</span><span class="sxs-lookup"><span data-stu-id="c8662-608">If you can use HTTPS, which provides transport level security, then using MD5 checking is redundant and unnecessary.</span></span>

   <span data-ttu-id="c8662-609">Para saber mais, confira [Azure Blob MD5 Overview](http://blogs.msdn.com/b/windowsazurestorage/archive/2011/02/18/windows-azure-blob-md5-overview.aspx)(Visão geral do MD5 do Blob do Azure).</span><span class="sxs-lookup"><span data-stu-id="c8662-609">For more information, please check out the [Azure Blob MD5 Overview](http://blogs.msdn.com/b/windowsazurestorage/archive/2011/02/18/windows-azure-blob-md5-overview.aspx).</span></span>
2. <span data-ttu-id="c8662-610">**E quanto à conformidade com o padrão FIPS do governo dos EUA norte-americano?**</span><span class="sxs-lookup"><span data-stu-id="c8662-610">**What about FIPS-Compliance for the U.S. Government?**</span></span>

   <span data-ttu-id="c8662-611">O FIPS (Federal Information Processing Standard) dos Estados Unidos da América define algoritmos criptográficos aprovados para uso pelos sistemas de computadores do governo federal dos EUA para proteção de dados confidenciais.</span><span class="sxs-lookup"><span data-stu-id="c8662-611">The United States Federal Information Processing Standard (FIPS) defines cryptographic algorithms approved for use by U.S. Federal government computer systems for the protection of sensitive data.</span></span> <span data-ttu-id="c8662-612">Habilitar o modo FIPS em um servidor ou desktop Windows informa ao sistema operacional que apenas algoritmos criptográficos validados pelo FIPS devem ser usados.</span><span class="sxs-lookup"><span data-stu-id="c8662-612">Enabling FIPS mode on a Windows server or desktop tells the OS that only FIPS-validated cryptographic algorithms should be used.</span></span> <span data-ttu-id="c8662-613">Se um aplicativo usar algoritmos fora de conformidade, ele será interrompido.</span><span class="sxs-lookup"><span data-stu-id="c8662-613">If an application uses non-compliant algorithms, the applications will break.</span></span> <span data-ttu-id="c8662-614">Com as versões 4.5.2 ou superiores do .NET Framework, o aplicativo alterna automaticamente os algoritmos da criptografia para usar algoritmos em conformidade com o FIPS quando o computador estiver no modo FIPS.</span><span class="sxs-lookup"><span data-stu-id="c8662-614">With.NET Framework versions 4.5.2 or higher, the application automatically switches the cryptography algorithms to use FIPS-compliant algorithms when the computer is in FIPS mode.</span></span>

   <span data-ttu-id="c8662-615">A Microsoft deixa que cada cliente decida se habilita ou não o modo FIPS.</span><span class="sxs-lookup"><span data-stu-id="c8662-615">Microsoft leaves it up to each customer to decide whether to enable FIPS mode.</span></span> <span data-ttu-id="c8662-616">Acreditamos que não há nenhum motivo convincente para os clientes que não estão sujeitos a normas governamentais habilitarem o modo FIPS por padrão.</span><span class="sxs-lookup"><span data-stu-id="c8662-616">We believe there is no compelling reason for customers who are not subject to government regulations to enable FIPS mode by default.</span></span>

   <span data-ttu-id="c8662-617">**Recursos**</span><span class="sxs-lookup"><span data-stu-id="c8662-617">**Resources**</span></span>

* [<span data-ttu-id="c8662-618">Por que não estamos recomendando mais o "Modo FIPS"</span><span class="sxs-lookup"><span data-stu-id="c8662-618">Why We're Not Recommending "FIPS Mode" Anymore</span></span>](http://blogs.technet.com/b/secguide/archive/2014/04/07/why-we-re-not-recommending-fips-mode-anymore.aspx)

  <span data-ttu-id="c8662-619">Esse artigo de blog fornece uma visão geral do FIPS e explica por que o modo FIPS não é habilitado por padrão.</span><span class="sxs-lookup"><span data-stu-id="c8662-619">This blog article gives an overview of FIPS and explains why they don't enable FIPS mode by default.</span></span>
* [<span data-ttu-id="c8662-620">FIPS 140 Validation (Validação do FIPS 140)</span><span class="sxs-lookup"><span data-stu-id="c8662-620">FIPS 140 Validation</span></span>](https://technet.microsoft.com/library/cc750357.aspx)

  <span data-ttu-id="c8662-621">Esse artigo fornece informações sobre como os produtos da Microsoft e os módulos criptográficos cumprem o padrão FIPS para o governo federal dos EUA.</span><span class="sxs-lookup"><span data-stu-id="c8662-621">This article provides information on how Microsoft products and cryptographic modules comply with the FIPS standard for the U.S. Federal government.</span></span>
* [<span data-ttu-id="c8662-622">"Criptografia de sistema: usar algoritmos em conformidade com o FIPS para criptografia, hash e assinatura", efeitos das configurações de segurança no Windows XP e em versões posteriores do Windows</span><span class="sxs-lookup"><span data-stu-id="c8662-622">"System cryptography: Use FIPS compliant algorithms for encryption, hashing, and signing" security settings effects in Windows XP and in later versions of Windows</span></span>](https://support.microsoft.com/kb/811833)

  <span data-ttu-id="c8662-623">Esse artigo fala sobre o uso do modo FIPS em computadores Windows antigos.</span><span class="sxs-lookup"><span data-stu-id="c8662-623">This article talks about the use of FIPS mode in older Windows computers.</span></span>
