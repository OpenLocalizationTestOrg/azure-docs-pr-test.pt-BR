---
title: "Backup e recuperação de desastre de discos de IaaS do Azure | Microsoft Docs"
description: "Neste artigo, explicaremos como planejar o Backup e DR (Recuperação de Desastre) de VMs (máquinas virtuais) e Discos de IaaS no Azure. Este documento aborda Discos Gerenciados e Discos Não Gerenciados"
services: storage
cloud: Azure
documentationcenter: na
author: luywang
manager: kavithag
ms.assetid: 
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/19/2017
ms.author: luywang
ms.openlocfilehash: 03d38bc3383b5fd39eca5ca67c315b34b98f0c39
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/29/2017
---
# <a name="backup-and-disaster-recovery-for-azure-iaas-disks"></a><span data-ttu-id="0c2b5-104">Backup e recuperação de desastre de discos de IaaS do Azure</span><span class="sxs-lookup"><span data-stu-id="0c2b5-104">Backup and disaster recovery for Azure IaaS disks</span></span>

<span data-ttu-id="0c2b5-105">Neste artigo, explicaremos como planejar o Backup e DR (Recuperação de Desastre) de VMs (máquinas virtuais) e Discos de IaaS no Azure.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-105">In this article, we will explain how to plan for Backup and Disaster Recovery (DR) of IaaS virtual machines (VMs) and Disks in Azure.</span></span> <span data-ttu-id="0c2b5-106">Este documento aborda Discos Gerenciados e Discos Não Gerenciados.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-106">This document covers both Managed and Unmanaged Disks.</span></span>

<span data-ttu-id="0c2b5-107">Primeiro, falaremos sobre as funcionalidades internas de tolerância a falhas da plataforma Azure que ajudam a proteger contra falhas locais.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-107">We’ll first talk about the built-in fault tolerance capabilities in the Azure platform which help guard against local failures.</span></span> <span data-ttu-id="0c2b5-108">Em seguida, abordaremos os cenários de desastre que são não totalmente abrangidos pelas funcionalidades internas, que é o tópico principal abordado neste documento.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-108">We’ll then discuss the disaster scenarios not fully covered by the built-in capabilities, which is the main topic addressed by this document.</span></span> <span data-ttu-id="0c2b5-109">Também mostraremos vários exemplos de cenários de carga de trabalho nos quais diferentes considerações de Backup e DR podem se aplicar.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-109">We’ll also show several examples of workload scenarios where different Backup and DR considerations may apply.</span></span> <span data-ttu-id="0c2b5-110">Depois, examinaremos possíveis soluções para DR de discos de IaaS.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-110">We’ll then review possible solutions for DR of IaaS Disks.</span></span> 

## <a name="introduction"></a><span data-ttu-id="0c2b5-111">Introdução</span><span class="sxs-lookup"><span data-stu-id="0c2b5-111">Introduction</span></span>

<span data-ttu-id="0c2b5-112">A plataforma Azure usa vários métodos para redundância e tolerância a falhas para ajudar a proteger os clientes contra falhas de hardware localizadas que podem ocorrer.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-112">The Azure platform uses various methods for redundancy and fault tolerance to help protect customers from localized hardware failures that can occur.</span></span> <span data-ttu-id="0c2b5-113">Falhas locais podem incluir problemas com um computador de servidor de armazenamento do Azure que armazena parte dos dados de um disco virtual ou as falhas de um SSD ou HD nesse servidor.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-113">Local failures may include problems with an Azure storage server machine that stores part of the data for a virtual disk or failures of an SSD or HDD on that server.</span></span> <span data-ttu-id="0c2b5-114">Essas falhas de componente de hardware isoladas podem ocorrer durante as operações normais e a plataforma foi projetada para ser resiliente a essas falhas.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-114">Such isolated hardware component failures can happen during normal operations and the platform is designed to be resilient to these failures.</span></span> <span data-ttu-id="0c2b5-115">Desastres graves podem resultar em falhas ou na incapacidade de acesso de um grande número de servidores de armazenamento ou de um datacenter inteiro.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-115">Major disasters can result in failures or inaccessibility of a large numbers of storage servers or a whole datacenter.</span></span> <span data-ttu-id="0c2b5-116">Embora as VMs e os discos normalmente sejam protegidos contra falhas localizadas, etapas adicionais são necessárias para proteger a carga de trabalho contra falhas catastróficas de toda a região (por exemplo, um desastre grave) que podem afetar a VM e os discos.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-116">While your VMs and disks are normally protected from localized failures, additional steps are necessary to protect your workload from region-wide catastrophic failures (such as a major disaster) that can affect your VM and disks.</span></span>

<span data-ttu-id="0c2b5-117">Além da possibilidade de falhas na plataforma, podem ocorrer problemas com os dados ou o aplicativo do cliente.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-117">In addition to the possibility of platform failures, problems with the customer application or data can occur.</span></span> <span data-ttu-id="0c2b5-118">Por exemplo, uma nova versão do aplicativo pode inadvertidamente fazer uma alteração significativa nos dados.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-118">For example, a new version of your application may inadvertently make a breaking change to the data.</span></span> <span data-ttu-id="0c2b5-119">Nesse caso, talvez você deseje reverter o aplicativo e os dados para uma versão anterior que contém o último estado válido conhecido.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-119">In that case, you may want to revert the application and the data to a prior version containing the last known good state.</span></span> <span data-ttu-id="0c2b5-120">Isso exige a manutenção de backups regulares.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-120">This requires maintaining regular backups.</span></span>

<span data-ttu-id="0c2b5-121">Para a recuperação de desastre regional, você deve fazer backup dos discos da VM de IaaS em outra região.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-121">For regional disaster recovery, you must backup your IaaS VM disks to a different region.</span></span> 

<span data-ttu-id="0c2b5-122">Antes de examinarmos as opções de Backup e DR, vamos recapitular alguns métodos disponíveis para o tratamento de falhas localizadas.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-122">Before we look at Backup and DR options, let’s recap a few methods available for handling localized failures.</span></span>

### <a name="azure-iaas-resiliency"></a><span data-ttu-id="0c2b5-123">Resiliência de IaaS do Azure</span><span class="sxs-lookup"><span data-stu-id="0c2b5-123">Azure IaaS Resiliency</span></span>

<span data-ttu-id="0c2b5-124">*Resiliência* refere-se à tolerância a falhas normais que ocorrem em componentes de hardware.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-124">*Resiliency* refers to the tolerance for normal failures that occur in hardware components.</span></span> <span data-ttu-id="0c2b5-125">A resiliência é a capacidade de se recuperar de falhas e continuar funcionando.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-125">Resiliency is the ability to recover from failures and continue to function.</span></span> <span data-ttu-id="0c2b5-126">Não se trata de evitar falhas, mas responder a elas de uma maneira que evite o tempo de inatividade ou a perda de dados.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-126">It's not about avoiding failures, but responding to failures in a way that avoids downtime or data loss.</span></span> <span data-ttu-id="0c2b5-127">A meta de resiliência é retornar o aplicativo a um estado totalmente funcional após uma falha.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-127">The goal of resiliency is to return the application to a fully functioning state following a failure.</span></span> <span data-ttu-id="0c2b5-128">As Máquinas Virtuais e os Discos do Azure foram projetados para serem resilientes a falhas comuns de hardware.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-128">Azure Virtual Machines and Disks are designed to be resilient to common hardware faults.</span></span> <span data-ttu-id="0c2b5-129">Vamos dar uma olhada em como a plataforma de IaaS do Azure fornece essa resiliência.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-129">Let us look at how the Azure IaaS platform provides this resiliency.</span></span>

<span data-ttu-id="0c2b5-130">Uma máquina virtual consiste principalmente em duas partes: (1) um servidor de computação e (2) os discos persistentes.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-130">A virtual machine consists mainly of two parts: (1) A compute server, and (2) the persistent disks.</span></span> <span data-ttu-id="0c2b5-131">Ambos afetam a tolerância a falhas de uma máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-131">Both affect the fault tolerance of a virtual machine.</span></span>

<span data-ttu-id="0c2b5-132">Se o servidor host de computação do Azure que hospeda a VM tiver uma falha de hardware (o que é raro), o Azure restaurará automaticamente a VM em outro servidor, pois foi projetado para isso.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-132">If the Azure compute host server that houses your VM experiences a hardware failure (which is rare), Azure is designed to automatically restore the VM on another server.</span></span> <span data-ttu-id="0c2b5-133">Se isso ocorrer, será feita uma reinicialização e a VM será copiada em backup após algum tempo.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-133">If this happens, you will experience a reboot, and the VM will be back up after some time.</span></span> <span data-ttu-id="0c2b5-134">O Azure detecta essas falhas de hardware automaticamente e executa recuperações para ajudar a garantir que a VM do cliente estará disponível assim que possível.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-134">Azure automatically detects such hardware failures and executes recoveries to help ensure the customer VM will be available as soon as possible.</span></span>

<span data-ttu-id="0c2b5-135">Em relação aos discos de IaaS, a durabilidade dos dados é essencial para a plataforma de armazenamento persistente.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-135">Regarding IaaS disks, durability of data is critical for the persistent storage platform.</span></span> <span data-ttu-id="0c2b5-136">Os clientes do Azure têm aplicativos de negócios importantes em execução na IaaS e eles dependem da persistência dos dados.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-136">Azure customers have important business applications running on IaaS and they depend on the persistence of the data.</span></span> <span data-ttu-id="0c2b5-137">O Azure projeta a proteção para esses discos de IaaS com três cópias redundantes dos dados armazenados localmente, fornecendo alta durabilidade contra falhas locais.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-137">Azure designs protection for these IaaS disks with three redundant copies of data stored locally, providing high durability against local failures.</span></span> <span data-ttu-id="0c2b5-138">Se um dos componentes de hardware que contém o disco falhar, a VM não será afetada porque há duas cópias adicionais para dar suporte às solicitações do disco.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-138">If one of the hardware components that holds your disk fails, your VM is not impacted because there are two additional copies to support disk requests.</span></span> <span data-ttu-id="0c2b5-139">Isso funcionará bem, mesmo se dois componentes de hardware diferentes que dão suporte a um disco falharem ao mesmo tempo (o que seria muito raro).</span><span class="sxs-lookup"><span data-stu-id="0c2b5-139">It works fine even if two different hardware components supporting a disk fail at the same time (which would be very rare).</span></span> <span data-ttu-id="0c2b5-140">Para ajudar a garantir que sempre mantemos três réplicas, o serviço de Armazenamento do Azure gera automaticamente uma nova cópia dos dados em segundo plano se uma das três cópias não fica disponível.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-140">To help ensure we always maintain three replicas, the Azure Storage service automatically spawns a new copy of data in the background if one of the three copies becomes unavailable.</span></span> <span data-ttu-id="0c2b5-141">Portanto, não deve ser necessário usar o RAID com discos do Azure para a tolerância a falhas.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-141">Therefore, it should not be necessary to use RAID with Azure disks for fault tolerance.</span></span> <span data-ttu-id="0c2b5-142">Uma simples configuração RAID 0 deve ser suficiente para a distribuição dos discos, se necessário, para criar volumes maiores.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-142">A simple RAID 0 configuration should be sufficient for striping the disks if necessary to create larger volumes.</span></span>

<span data-ttu-id="0c2b5-143">Devido a essa arquitetura, o **Azure proporcionou durabilidade de nível empresarial de modo consistente para discos de IaaS, com uma [Taxa de Falha Anualizada](https://en.wikipedia.org/wiki/Annualized_failure_rate) líder do setor de 0%.**</span><span class="sxs-lookup"><span data-stu-id="0c2b5-143">Because of this architecture, **Azure has consistently delivered enterprise-grade durability for IaaS disks, with an industry-leading ZERO % [Annualized Failure Rate](https://en.wikipedia.org/wiki/Annualized_failure_rate).**</span></span>

<span data-ttu-id="0c2b5-144">Falhas de hardware localizadas no host de computação ou na plataforma de armazenamento podem, às vezes, resultar em indisponibilidade temporária para a VM que é coberta pelo [SLA do Azure](https://azure.microsoft.com/support/legal/sla/virtual-machines/) em relação à Disponibilidade da VM.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-144">Localized hardware faults on the compute host or in the storage platform can sometimes result in temporary unavailability for the VM which is covered by the [Azure SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines/) for VM Availability.</span></span> <span data-ttu-id="0c2b5-145">O Azure também fornece um SLA líder do setor para instâncias de VM individuais que usam discos do Armazenamento Premium.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-145">Azure also provides an industry-leading SLA for single VM instances that use Premium Storage disks.</span></span>

<span data-ttu-id="0c2b5-146">Para proteger cargas de trabalho do aplicativo contra o tempo de inatividade devido à indisponibilidade temporária de um disco ou de uma VM, os clientes podem utilizar [Conjuntos de Disponibilidade](../../virtual-machines/windows/manage-availability.md).</span><span class="sxs-lookup"><span data-stu-id="0c2b5-146">To safeguard application workloads from downtime due to the temporary unavailability of a disk or VM, customers can leverage [Availability Sets](../../virtual-machines/windows/manage-availability.md).</span></span> <span data-ttu-id="0c2b5-147">Duas ou mais máquinas virtuais em um conjunto de disponibilidade fornecem redundância para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-147">Two or more virtual machines in an availability set provides redundancy for the application.</span></span> <span data-ttu-id="0c2b5-148">Em seguida, o Azure cria essas VMs e esses discos em domínios de falha separados com diferentes componentes de energia, rede e servidor.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-148">Azure then creates these VMs and disks in separate fault domains with different power, network, and server components.</span></span> <span data-ttu-id="0c2b5-149">Portanto, as falhas de hardware localizadas geralmente não afetam várias VMs no conjunto ao mesmo tempo, fornecendo alta disponibilidade para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-149">Thus, localized hardware failures typically do not affect multiple VMs in the set at the same time, providing high availability for your application.</span></span> <span data-ttu-id="0c2b5-150">É considerada uma melhor prática usar conjuntos de disponibilidade quando a alta disponibilidade é necessária.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-150">It is considered a good practice to use availability sets when high availability is required.</span></span> <span data-ttu-id="0c2b5-151">Para obter mais informações, consulte os aspectos da Recuperação de Desastre detalhados abaixo.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-151">For more information, see the Disaster Recovery aspects detailed below.</span></span>

### <a name="backup-and-disaster-recovery"></a><span data-ttu-id="0c2b5-152">Backup e recuperação de desastre</span><span class="sxs-lookup"><span data-stu-id="0c2b5-152">Backup and Disaster Recovery</span></span>

<span data-ttu-id="0c2b5-153">DR (recuperação de desastre) é a capacidade de recuperação de incidentes raros, exceto graves: falhas não transitórias em larga escala, como interrupções de serviço que afetam toda a região.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-153">Disaster recovery (DR) is the ability to recover from rare but major incidents: non-transient, wide-scale failures, such as service disruption that affects an entire region.</span></span> <span data-ttu-id="0c2b5-154">A recuperação de desastre inclui backup e arquivamento de dados e pode incluir a intervenção manual, como a restauração um banco de dados com base em um backup.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-154">Disaster recovery includes data backup and archiving, and may include manual intervention, such as restoring a database from backup.</span></span>

<span data-ttu-id="0c2b5-155">A proteção interna da plataforma Azure contra falhas localizadas pode não proteger totalmente VMs/discos, no caso de desastres graves que podem causar interrupções em larga escala.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-155">The Azure platform’s built-in protection against localized failures may not fully protect the VMs/disks in the case of major disasters which can cause large-scale outages.</span></span> <span data-ttu-id="0c2b5-156">Isso inclui eventos catastróficos, como um data center atingido por um furacão, terremoto, incêndio ou falhas de unidade de hardware em grande escala.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-156">This includes catastrophic events such as a data center being hit by a hurricane, earthquake, fire, or large scale hardware unit failures.</span></span> <span data-ttu-id="0c2b5-157">Além disso, você pode encontrar falhas devido a problemas de dados ou do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-157">In addition, you may encounter failures due to application or data issues.</span></span>

<span data-ttu-id="0c2b5-158">Para ajudar a proteger as cargas de trabalho de IaaS contra interrupções, você deve planejar a redundância e os backups para permitir a recuperação.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-158">To help protect your IaaS workloads from outages, you should plan for redundancy and backups to enable recovery.</span></span> <span data-ttu-id="0c2b5-159">Para a recuperação de desastre, você deve planejar a redundância e o backup em uma localização geográfica diferente fora do site primário.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-159">For disaster recovery, you should plan redundancy and backup in a different geographic location away from the primary site.</span></span> <span data-ttu-id="0c2b5-160">Isso ajuda a garantir que o backup não é afetado pelo mesmo evento que originalmente afetou a VM ou os discos.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-160">This helps ensure your backup is not affected by the same event that originally impacted the VM or disks.</span></span> <span data-ttu-id="0c2b5-161">Para obter mais informações, consulte [Recuperação de desastre para aplicativos criados no Azure](https://docs.microsoft.com/azure/architecture/resiliency/disaster-recovery-azure-applications).</span><span class="sxs-lookup"><span data-stu-id="0c2b5-161">For more information, see [Disaster Recovery for Applications built on Azure](https://docs.microsoft.com/azure/architecture/resiliency/disaster-recovery-azure-applications).</span></span>

<span data-ttu-id="0c2b5-162">Suas considerações de DR podem incluir os seguintes aspectos:</span><span class="sxs-lookup"><span data-stu-id="0c2b5-162">Your DR considerations may include the following aspects:</span></span>

1. <span data-ttu-id="0c2b5-163">HA (Alta Disponibilidade) é a capacidade do aplicativo de continuar em execução em um estado íntegro, sem tempo de inatividade significativo.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-163">High Availability (HA) is the ability of the application to continue running in a healthy state, without significant downtime.</span></span> <span data-ttu-id="0c2b5-164">Por “estado íntegro” queremos dizer o aplicativo está respondendo e os usuários podem se conectar ao aplicativo e interagir com ele.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-164">By "healthy state," we mean the application is responsive, and users can connect to the application and interact with it.</span></span> <span data-ttu-id="0c2b5-165">Alguns aplicativos e bancos de dados críticos podem precisar estar sempre disponíveis, mesmo quando há falhas na plataforma.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-165">Certain mission-critical applications and databases may be required to be available always, even when there are failures in the platform.</span></span> <span data-ttu-id="0c2b5-166">Para essas cargas de trabalho, talvez você precise planejar a redundância para o aplicativo, bem como para os dados.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-166">For these workloads, you may need to plan redundancy for the application as well as the data.</span></span>

2. <span data-ttu-id="0c2b5-167">Durabilidade de Dados: em alguns casos, a principal consideração é garantir que os dados são preservados no caso de um desastre.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-167">Data Durability: In some cases, the main consideration is ensuring the data is preserved in the case of a disaster.</span></span> <span data-ttu-id="0c2b5-168">Portanto, talvez seja necessário fazer um backup dos dados em outro site.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-168">Therefore, you may need a backup of your data in a different site.</span></span> <span data-ttu-id="0c2b5-169">Para essas cargas de trabalho, talvez não seja necessário ter a redundância total para o aplicativo, mas um backup regular dos discos.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-169">For such workloads, you may not need full redundancy for the application, but a regular backup of the disks.</span></span>

## <a name="backup-and-dr-scenarios"></a><span data-ttu-id="0c2b5-170">Cenários de backup e DR</span><span class="sxs-lookup"><span data-stu-id="0c2b5-170">Backup and DR Scenarios</span></span>

<span data-ttu-id="0c2b5-171">Vamos examinar alguns exemplos típicos de cenários de carga de trabalho do aplicativo e as considerações sobre o planejamento da Recuperação de Desastre.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-171">Let’s look at a few typical examples of application workload scenarios and the considerations for planning Disaster Recovery.</span></span>

### <a name="scenario-1-major-database-solutions"></a><span data-ttu-id="0c2b5-172">Cenário 1: principais soluções de banco de dados</span><span class="sxs-lookup"><span data-stu-id="0c2b5-172">Scenario 1: Major Database Solutions</span></span>

<span data-ttu-id="0c2b5-173">Considere um servidor de banco de dados de produção como o SQL Server ou o Oracle que pode dar suporte à Alta Disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-173">Consider a production database server like SQL Server or Oracle that can support High Availability.</span></span> <span data-ttu-id="0c2b5-174">Usuários e aplicativos de produção críticos dependem desse banco de dados.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-174">Critical production applications and users depend on this database.</span></span> <span data-ttu-id="0c2b5-175">O plano de Recuperação de Desastre para esse sistema pode precisar dar suporte aos seguintes requisitos:</span><span class="sxs-lookup"><span data-stu-id="0c2b5-175">The Disaster Recovery plan for this system may need to support the following requirements:</span></span>

1. <span data-ttu-id="0c2b5-176">Os dados devem ser protegidos e recuperáveis.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-176">Data must be protected and recoverable.</span></span>
2.  <span data-ttu-id="0c2b5-177">O servidor deve estar disponível para uso.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-177">Server must be available for use.</span></span>

<span data-ttu-id="0c2b5-178">Isso pode exigir a manutenção de uma réplica do banco de dados em outra região como um backup.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-178">This may require maintaining a replica of the database in a different region as a backup.</span></span> <span data-ttu-id="0c2b5-179">Dependendo dos requisitos de disponibilidade do servidor e de recuperação de dados, a solução pode variar de um site de réplica Ativo-Ativo ou Ativo-Passivo para backups offline periódicos dos dados.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-179">Depending on the requirements for server availability and data recovery, the solution could range from an Active-Active or Active-Passive replica site to periodic offline backups of the data.</span></span> <span data-ttu-id="0c2b5-180">Bancos de dados relacionais, como o SQL Server e o Oracle, fornecem várias opções de replicação.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-180">Relational databases such as SQL Server and Oracle provide various options for replication.</span></span> <span data-ttu-id="0c2b5-181">Para o SQL Server, [Grupos de Disponibilidade AlwaysOn do SQL Server](https://msdn.microsoft.com/library/hh510230.aspx) podem ser usados para alta disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-181">For SQL Server, [SQL Server Always On Availability Groups](https://msdn.microsoft.com/library/hh510230.aspx) can be used for high availability.</span></span>

<span data-ttu-id="0c2b5-182">Bancos de dados NoSQL como o MongoDB também dão suporte a [réplicas](https://docs.mongodb.com/manual/replication/) para redundância.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-182">NoSQL databases like MongoDB also support [replicas](https://docs.mongodb.com/manual/replication/) for redundancy.</span></span> <span data-ttu-id="0c2b5-183">As réplicas para alta disponibilidade podem ser usadas.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-183">The replicas for high availability can be used.</span></span>

### <a name="scenario-2-a-cluster-of-redundant-vms"></a><span data-ttu-id="0c2b5-184">Cenário 2: um cluster de VMs redundantes</span><span class="sxs-lookup"><span data-stu-id="0c2b5-184">Scenario 2: A cluster of redundant VMs</span></span>

<span data-ttu-id="0c2b5-185">Considere uma carga de trabalho manipulada por um cluster de VMs que fornece redundância e balanceamento de carga.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-185">Consider a workload handled by a cluster of VMs that provide redundancy and load balancing.</span></span> <span data-ttu-id="0c2b5-186">Um exemplo seria um cluster do Cassandra implantado em uma região.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-186">One example would be a Cassandra cluster deployed in a region.</span></span> <span data-ttu-id="0c2b5-187">Esse tipo de arquitetura já fornece um alto nível de redundância nessa região.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-187">This type of architecture already provides a high level of redundancy within that region.</span></span> <span data-ttu-id="0c2b5-188">No entanto, para proteger a carga de trabalho contra uma falha de nível regional, você deve considerar a distribuição do cluster em duas regiões ou a realização de backups periódicos em outra região.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-188">However, to protect the workload from a regional level failure, you should consider spreading the cluster across two regions or making periodic backups to another region.</span></span>

### <a name="scenario-3-iaas-application-workload"></a><span data-ttu-id="0c2b5-189">Cenário 3: carga de trabalho de aplicativos IaaS</span><span class="sxs-lookup"><span data-stu-id="0c2b5-189">Scenario 3: IaaS Application Workload</span></span>

<span data-ttu-id="0c2b5-190">Isso pode ser uma carga de trabalho de produção típica em execução em uma VM do Azure.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-190">This could be a typical production workload running on an Azure VM.</span></span> <span data-ttu-id="0c2b5-191">Por exemplo, pode ser um servidor Web ou servidor de arquivos que mantém o conteúdo e outros recursos de um site.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-191">For example, it could be a web server or file server holding the content and other resources of a site.</span></span> <span data-ttu-id="0c2b5-192">Também pode ser um aplicativo de negócios personalizado em execução em uma VM que armazenou seus dados, recursos e o estado do aplicativo nos discos da VM.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-192">It could also be a custom-built business application running on a VM that stored its data, resources, and application state on the VM disks.</span></span> <span data-ttu-id="0c2b5-193">Nesse caso, é importante fazer backups regularmente.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-193">In this case, it is important to make sure you take backups on a regular basis.</span></span> <span data-ttu-id="0c2b5-194">A frequência de backup deve se basear na natureza da carga de trabalho da VM.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-194">Backup frequency should be based on the nature of the VM workload.</span></span> <span data-ttu-id="0c2b5-195">Por exemplo, se o aplicativo é executado diariamente e modifica dados, o backup deve ser feito a cada hora.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-195">For example, if the application runs every day and modifies data, then the backup should be taken every hour.</span></span>

<span data-ttu-id="0c2b5-196">Outro exemplo é um servidor de relatórios que efetua pull de dados de outras fontes e gera relatórios agregados.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-196">Another example is a reporting server that pull data from other sources and generates aggregated reports.</span></span> <span data-ttu-id="0c2b5-197">A perda dessa VM ou desses discos levará à perda dos relatórios.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-197">Loss of this VM or disks will lead to the loss of the reports.</span></span> <span data-ttu-id="0c2b5-198">No entanto, talvez seja possível executar o processo de relatórios e regenerar o resultado.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-198">However, it may be possible to rerun the reporting process and regenerate the output.</span></span> <span data-ttu-id="0c2b5-199">Nesse caso, não há realmente uma perda de dados, mesmo se o servidor de relatórios for atingido por um desastre e, portanto, você pode ter um nível mais alto de tolerância para a perda de parte dos dados no servidor de relatórios.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-199">In that case, you don’t really have a loss of data even if the reporting server is hit with a disaster, so you could have a higher level of tolerance for losing part of the data on the reporting server.</span></span> <span data-ttu-id="0c2b5-200">Nesse caso, backups menos frequentes são uma opção para reduzir o custo.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-200">In that case, less frequent backups is an option to reduce the cost.</span></span>

### <a name="scenario-4-iaas-application-data-issues"></a><span data-ttu-id="0c2b5-201">Cenário 4: problemas de dados de aplicativos IaaS</span><span class="sxs-lookup"><span data-stu-id="0c2b5-201">Scenario 4: IaaS Application data issues</span></span>

<span data-ttu-id="0c2b5-202">Você tem um aplicativo que calcula, mantém e fornece dados comerciais críticos, como informações sobre preços.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-202">You have an application that computes, maintains, and serves critical commercial data such as pricing information.</span></span> <span data-ttu-id="0c2b5-203">Uma nova versão do aplicativo tinha um bug de software que calculava os preços incorretamente e corrompeu os dados comerciais existentes fornecidos pela plataforma.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-203">A new version of your application had a software bug which incorrectly computed the pricing and corrupted the existing commerce data served by the platform.</span></span> <span data-ttu-id="0c2b5-204">Aqui, a melhor decisão será reverter para a versão anterior do aplicativo e dos dados primeiro.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-204">Here, the best course of action would be to revert to the earlier version of the application and the data first.</span></span> <span data-ttu-id="0c2b5-205">Para possibilitar isso, faça backups periódicos do sistema.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-205">To enable this, take periodic backups of your system.</span></span>

## <a name="disaster-recovery-solution-azure-backup-service"></a><span data-ttu-id="0c2b5-206">Solução de Recuperação de Desastre: Serviço de Backup do Azure</span><span class="sxs-lookup"><span data-stu-id="0c2b5-206">Disaster Recovery Solution: Azure Backup Service</span></span>

<span data-ttu-id="0c2b5-207">O [Serviço de Backup do Azure](https://azure.microsoft.com/services/backup/) pode ser usado para Backup e DR e funciona com [Managed Disks](../../virtual-machines/windows/managed-disks-overview.md), bem como com [Discos Não Gerenciados](../../virtual-machines/windows/about-disks-and-vhds.md#unmanaged-disks).</span><span class="sxs-lookup"><span data-stu-id="0c2b5-207">[Azure Backup Service](https://azure.microsoft.com/services/backup/) is can be used for Backup and DR, and it works with [Managed Disks](../../virtual-machines/windows/managed-disks-overview.md) as well as [Unmanaged Disks](../../virtual-machines/windows/about-disks-and-vhds.md#unmanaged-disks).</span></span> <span data-ttu-id="0c2b5-208">Crie um trabalho de backup com backups baseados em tempo, fácil restauração de VM e políticas de retenção de backup.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-208">You can create a backup job with time-based backups, easy VM restoration and backup retention policies.</span></span> 

<span data-ttu-id="0c2b5-209">Se você usar [discos do Armazenamento Premium](storage-premium-storage.md), [Managed Disks](../../virtual-machines/windows/managed-disks-overview.md) ou outros tipos de disco com a opção [LRS (armazenamento com redundância local)](storage-redundancy.md#locally-redundant-storage), é especialmente importante utilizar backups periódicos de DR.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-209">If you use [Premium Storage disks](storage-premium-storage.md), [Managed Disks](../../virtual-machines/windows/managed-disks-overview.md), or other disk types with the [locally redundant storage (LRS)](storage-redundancy.md#locally-redundant-storage) option, it is especially important to leverage periodic DR backups.</span></span> <span data-ttu-id="0c2b5-210">O Backup do Azure armazena os dados no cofre dos Serviços de Recuperação para retenção de longo prazo.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-210">Azure Backup stores the data in your Recovery Services vault for long term retention.</span></span> <span data-ttu-id="0c2b5-211">Escolha a opção [GRS (armazenamento com redundância geográfica)](storage-redundancy.md#geo-redundant-storage) para o cofre dos Serviços de Recuperação de Backup.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-211">Choose the [Geo-redundant storage (GRS)](storage-redundancy.md#geo-redundant-storage) option for the Backup Recovery Services vault.</span></span> <span data-ttu-id="0c2b5-212">Isso garantirá que os backups são replicados em outra região do Azure para proteger contra desastres regionais.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-212">That will ensure backups are replicated to a different Azure region for safeguarding from regional disasters.</span></span>

<span data-ttu-id="0c2b5-213">Para [Discos Não Gerenciados](../../virtual-machines/windows/about-disks-and-vhds.md#unmanaged-disks), use o tipo de armazenamento LRS para discos de IaaS, mas verifique se o Backup do Azure está habilitado com a opção GRS no cofre dos Serviços de Recuperação.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-213">For [Unmanaged Disks](../../virtual-machines/windows/about-disks-and-vhds.md#unmanaged-disks), you can use the LRS storage type for IaaS disks, but ensure that Azure Backup is enabled with the GRS option for the Recovery Services Vault.</span></span>

<span data-ttu-id="0c2b5-214">**Se você usar a opção [GRS](storage-redundancy.md#geo-redundant-storage)/[RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage) para os Discos Não Gerenciados, ainda precisará de instantâneos consistentes para Backup e DR.**</span><span class="sxs-lookup"><span data-stu-id="0c2b5-214">**If you use the [GRS](storage-redundancy.md#geo-redundant-storage)/[RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage) option for your Unmanaged Disks, you still need consistent snapshots for Backup and DR.**</span></span> <span data-ttu-id="0c2b5-215">Use o [Serviço de Backup do Azure](https://azure.microsoft.com/services/backup/) ou [instantâneos consistentes](#alternative-solution-consistent-snapshots).</span><span class="sxs-lookup"><span data-stu-id="0c2b5-215">You must use either [Azure Backup Service](https://azure.microsoft.com/services/backup/) or [consistent snapshots](#alternative-solution-consistent-snapshots).</span></span>

<span data-ttu-id="0c2b5-216">Veja a seguir um resumo das soluções de DR.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-216">The following is a summary of solutions for DR.</span></span>

| <span data-ttu-id="0c2b5-217">Cenário</span><span class="sxs-lookup"><span data-stu-id="0c2b5-217">Scenario</span></span> | <span data-ttu-id="0c2b5-218">Replicação automática</span><span class="sxs-lookup"><span data-stu-id="0c2b5-218">Automatic Replication</span></span> | <span data-ttu-id="0c2b5-219">Solução de DR</span><span class="sxs-lookup"><span data-stu-id="0c2b5-219">DR Solution</span></span> |
| --- | --- | --- |
| <span data-ttu-id="0c2b5-220">*Discos do Armazenamento Premium*</span><span class="sxs-lookup"><span data-stu-id="0c2b5-220">*Premium Storage Disks*</span></span> | <span data-ttu-id="0c2b5-221">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="0c2b5-221">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span></span> | [<span data-ttu-id="0c2b5-222">Serviço de Backup do Azure</span><span class="sxs-lookup"><span data-stu-id="0c2b5-222">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/) |
| <span data-ttu-id="0c2b5-223">*Managed Disks*</span><span class="sxs-lookup"><span data-stu-id="0c2b5-223">*Managed Disks*</span></span> | <span data-ttu-id="0c2b5-224">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="0c2b5-224">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span></span> | [<span data-ttu-id="0c2b5-225">Serviço de Backup do Azure</span><span class="sxs-lookup"><span data-stu-id="0c2b5-225">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/) |
| <span data-ttu-id="0c2b5-226">*Discos LRS Não Gerenciados*</span><span class="sxs-lookup"><span data-stu-id="0c2b5-226">*Unmanaged LRS Disks*</span></span> | <span data-ttu-id="0c2b5-227">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="0c2b5-227">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span></span> | [<span data-ttu-id="0c2b5-228">Serviço de Backup do Azure</span><span class="sxs-lookup"><span data-stu-id="0c2b5-228">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/) |
| <span data-ttu-id="0c2b5-229">*Discos GRS Não Gerenciados*</span><span class="sxs-lookup"><span data-stu-id="0c2b5-229">*Unmanaged GRS Disks*</span></span> | <span data-ttu-id="0c2b5-230">Várias regiões ([GRS](storage-redundancy.md#geo-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="0c2b5-230">Cross region ([GRS](storage-redundancy.md#geo-redundant-storage))</span></span> | [<span data-ttu-id="0c2b5-231">Serviço de Backup do Azure</span><span class="sxs-lookup"><span data-stu-id="0c2b5-231">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/)<br/>[<span data-ttu-id="0c2b5-232">Instantâneos consistentes</span><span class="sxs-lookup"><span data-stu-id="0c2b5-232">Consistent snapshots</span></span>](#alternative-solution-consistent-snapshots) |
| <span data-ttu-id="0c2b5-233">*Discos RA-GRS Não Gerenciados*</span><span class="sxs-lookup"><span data-stu-id="0c2b5-233">*Unmanaged RA-GRS Disks*</span></span> | <span data-ttu-id="0c2b5-234">Várias regiões ([RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="0c2b5-234">Cross region ([RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage))</span></span> | [<span data-ttu-id="0c2b5-235">Serviço de Backup do Azure</span><span class="sxs-lookup"><span data-stu-id="0c2b5-235">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/)<br/>[<span data-ttu-id="0c2b5-236">Instantâneos consistentes</span><span class="sxs-lookup"><span data-stu-id="0c2b5-236">Consistent snapshots</span></span>](#alternative-solution-consistent-snapshots) |

<span data-ttu-id="0c2b5-237">A alta disponibilidade pode ser mais bem alcançada com o uso do Managed Disks em um Conjunto de Disponibilidade, junto com o Backup do Azure.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-237">High availability can best by met through the use of Managed Disks in an Availability Set along with Azure Backup.</span></span> <span data-ttu-id="0c2b5-238">Se você estiver usando Discos Não Gerenciados, ainda poderá usar o Backup do Azure para DR.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-238">If you are using Unmanaged Disks, you can still  use Azure Backup for DR.</span></span> <span data-ttu-id="0c2b5-239">Caso não possa usar o Backup do Azure, tirar [instantâneos consistentes](#alternative-solution-consistent-snapshots), conforme descrito em uma seção posterior, é uma solução alternativa para Backup e DR.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-239">If you are unable to use Azure Backup, then taking [consistent snapshots](#alternative-solution-consistent-snapshots) as described in a later section is an alternative solution for Backup and DR.</span></span>

<span data-ttu-id="0c2b5-240">Suas escolhas de alta disponibilidade, backup e DR nos níveis do Aplicativo ou da Infraestrutura podem ser representadas conforme mostrado abaixo:</span><span class="sxs-lookup"><span data-stu-id="0c2b5-240">Your choices for high availability, backup and DR at Application or Infrastructure levels can be represented as below:</span></span>

| <span data-ttu-id="0c2b5-241">*Level*</span><span class="sxs-lookup"><span data-stu-id="0c2b5-241">*Level*</span></span> | <span data-ttu-id="0c2b5-242">Alta disponibilidade</span><span class="sxs-lookup"><span data-stu-id="0c2b5-242">High Availability</span></span>   | <span data-ttu-id="0c2b5-243">Backup/DR</span><span class="sxs-lookup"><span data-stu-id="0c2b5-243">Backup / DR</span></span> |
| --- | --- | --- |
| <span data-ttu-id="0c2b5-244">*Aplicativo*</span><span class="sxs-lookup"><span data-stu-id="0c2b5-244">*Application*</span></span> | <span data-ttu-id="0c2b5-245">SQL AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="0c2b5-245">SQL Always On</span></span> | <span data-ttu-id="0c2b5-246">Serviço de Backup do Azure</span><span class="sxs-lookup"><span data-stu-id="0c2b5-246">Azure Backup</span></span> |
| <span data-ttu-id="0c2b5-247">*Infraestrutura*</span><span class="sxs-lookup"><span data-stu-id="0c2b5-247">*Infrastructure*</span></span>  | <span data-ttu-id="0c2b5-248">Conjunto de disponibilidade</span><span class="sxs-lookup"><span data-stu-id="0c2b5-248">Availability Set</span></span>  | <span data-ttu-id="0c2b5-249">GRS com instantâneos consistentes</span><span class="sxs-lookup"><span data-stu-id="0c2b5-249">GRS with consistent snapshots</span></span> |

### <a name="using-the-azure-backup-service"></a><span data-ttu-id="0c2b5-250">Usando o Serviço de Backup do Azure</span><span class="sxs-lookup"><span data-stu-id="0c2b5-250">Using the Azure Backup Service</span></span>

<span data-ttu-id="0c2b5-251">O [Backup do Azure](../../backup/backup-azure-vms-introduction.md) pode fazer backup das VMs que executam Windows ou Linux no Cofre dos Serviços de Recuperação do Azure.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-251">[Azure Backup](../../backup/backup-azure-vms-introduction.md) can backup your VMs running Windows or Linux to the Azure Recovery Services Vault.</span></span> <span data-ttu-id="0c2b5-252">Fazer backup e restaurar dados críticos para os negócios é complicado, pois os dados críticos para os negócios precisam ser copiados em backup enquanto os aplicativos que produzem os dados estão em execução.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-252">Backing up and restoring business-critical data is complicated by the fact that business-critical data must be backed up while the applications that produce the data are running.</span></span> <span data-ttu-id="0c2b5-253">Para resolver isso, o Backup do Azure fornece backups consistentes com o aplicativo para cargas de trabalho da Microsoft usando o VSS (Serviço de Sombra de Volume) para garantir que os dados são gravados corretamente no armazenamento.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-253">To address this, Azure Backup provides application-consistent backups for Microsoft workloads by using the Volume Shadow Service (VSS) to ensure that data is written correctly to storage.</span></span> <span data-ttu-id="0c2b5-254">Para VMs Linux, somente backups consistentes com os arquivos são possíveis, pois o Linux não tem uma funcionalidade equivalente ao VSS.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-254">For Linux VMs, only file-consistent backups are possible, since Linux does not have functionality equivalent to VSS.</span></span>

![](./media/storage-backup-and-disaster-recovery-for-azure-iaas-disks/backup-and-disaster-recovery-for-azure-iaas-disks-1.png)   

<span data-ttu-id="0c2b5-255">Quando o Backup do Azure inicia um trabalho de backup no horário agendado, ele dispara a extensão de backup instalada na VM para tirar um instantâneo pontual.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-255">When Azure Backup initiates a backup job at the scheduled time, it triggers the backup extension installed in the VM to take a point-in-time snapshot.</span></span> <span data-ttu-id="0c2b5-256">Um instantâneo é tirado em conjunto com o VSS para obter um instantâneo consistente dos discos na máquina virtual sem precisar desligá-la.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-256">A snapshot is taken in coordination with VSS to get a consistent snapshot of the disks in the virtual machine without having to shut it down.</span></span> <span data-ttu-id="0c2b5-257">A extensão de backup na VM libera todas as gravações antes de tirar o instantâneo consistente de todos os discos.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-257">The backup extension in the VM flushes all writes before taking the consistent snapshot of all the disks.</span></span> <span data-ttu-id="0c2b5-258">Depois de tirar o instantâneo, os dados são transferidos pelo Backup do Azure para o cofre de backup.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-258">After the snapshot is taken, the data is transferred by Azure Backup to the backup vault.</span></span> <span data-ttu-id="0c2b5-259">Para tornar o processo de backup mais eficiente, o serviço identifica e transfere apenas os blocos de dados que foram alterados desde o último backup.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-259">To make the backup process more efficient, the service identifies and transfers only the blocks of data that have changed since the last backup.</span></span>


<span data-ttu-id="0c2b5-260">Para restaurar, exiba os backups disponíveis por meio do Backup do Azure e, em seguida, inicie uma restauração.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-260">To restore, you can view the available backups through Azure Backup and then initiate a restore.</span></span> <span data-ttu-id="0c2b5-261">Crie e restaure backups do Azure por meio do [portal do Azure](https://portal.azure.com/), [usando o PowerShell](../../backup/backup-azure-vms-automation.md ) ou usando a [CLI do Azure](https://docs.microsoft.com/azure/xplat-cli-install).</span><span class="sxs-lookup"><span data-stu-id="0c2b5-261">You can create and restore Azure backups through the [Azure portal](https://portal.azure.com/), [using PowerShell](../../backup/backup-azure-vms-automation.md ), or using the [Azure CLI](https://docs.microsoft.com/azure/xplat-cli-install).</span></span> <span data-ttu-id="0c2b5-262">Para obter mais informações, consulte Backup do Azure.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-262">For more information, see Azure Backup.</span></span>

### <a name="steps-to-enable-backup"></a><span data-ttu-id="0c2b5-263">Etapas para habilitar o backup</span><span class="sxs-lookup"><span data-stu-id="0c2b5-263">Steps to Enable Backup</span></span>

<span data-ttu-id="0c2b5-264">As etapas a seguir normalmente são usadas para habilitar os backups das VMs usando o [Portal do Azure](https://portal.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="0c2b5-264">The following steps are typically used to enable backups of your VMs using the [Azure Portal](https://portal.azure.com/).</span></span> <span data-ttu-id="0c2b5-265">Haverá algumas variações dependendo do cenário exato.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-265">There will be some variations depending on your exact scenario.</span></span> <span data-ttu-id="0c2b5-266">Consulte a documentação do [Backup do Azure](../../backup/backup-azure-vms-introduction.md) para obter detalhes completos.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-266">Refer to the [Azure Backup](../../backup/backup-azure-vms-introduction.md) documentation for full details.</span></span> <span data-ttu-id="0c2b5-267">O Backup do Azure também [dá suporte a VMs com o Managed Disks](https://azure.microsoft.com/blog/azure-managed-disk-backup/).</span><span class="sxs-lookup"><span data-stu-id="0c2b5-267">Azure Backup also [supports VMs with Managed Disks](https://azure.microsoft.com/blog/azure-managed-disk-backup/).</span></span>

1.  <span data-ttu-id="0c2b5-268">Crie um cofre dos serviços de recuperação para uma VM usando as seguintes etapas:</span><span class="sxs-lookup"><span data-stu-id="0c2b5-268">Create a recovery services vault for a VM using the following steps:</span></span>

    <span data-ttu-id="0c2b5-269">a.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-269">a.</span></span>  <span data-ttu-id="0c2b5-270">Usando o [portal do Azure](https://portal.azure.com/), procure todos os recursos e localize “cofres dos Serviços de Recuperação”.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-270">Using the [Azure portal](https://portal.azure.com/), browse all resources and find “Recovery Services vaults”.</span></span>

    <span data-ttu-id="0c2b5-271">b.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-271">b.</span></span>  <span data-ttu-id="0c2b5-272">No menu de cofres dos Serviços de Recuperação, clique em Adicionar e siga as etapas para criar um novo cofre na mesma região da VM.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-272">On the Recovery Services vaults menu, click Add and follow the steps to create a new vault in the same region as the VM.</span></span> <span data-ttu-id="0c2b5-273">Por exemplo, se a VM estiver na região Oeste dos EUA, escolha Oeste dos EUA para o cofre.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-273">For example, if your VM is in West US region, pick West US for the vault.</span></span>

2.  <span data-ttu-id="0c2b5-274">Verifique a replicação de Armazenamento do cofre recém-criado.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-274">Verify the Storage replication for the newly created vault.</span></span> <span data-ttu-id="0c2b5-275">Para fazer isso, acesse o cofre na folha de cofres dos Serviços de Recuperação e acesse as configurações/Configuração de Backup.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-275">To do this, access the vault from the Recovery Services vaults blade and go to the settings/Backup Configuration.</span></span> <span data-ttu-id="0c2b5-276">Verifique se a opção GRS está selecionada por padrão.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-276">Ensure the GRS option is selected by default.</span></span> <span data-ttu-id="0c2b5-277">Isso garantirá que o cofre é replicado automaticamente em um data center secundário.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-277">This will ensure that your vault is automatically replicated to a secondary data center.</span></span> <span data-ttu-id="0c2b5-278">Por exemplo, o cofre no Oeste dos EUA será replicado automaticamente no Leste dos EUA.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-278">For example, your vault in West US will be automatically replicated to East US.</span></span>

3.  <span data-ttu-id="0c2b5-279">Configure a política de backup e selecione a VM na mesma interface do usuário.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-279">Configure the backup policy and select the VM from the same UI.</span></span>

4.  <span data-ttu-id="0c2b5-280">Verifique se o Agente de Backup está instalado na VM.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-280">Make sure the Backup Agent is installed on the VM.</span></span> <span data-ttu-id="0c2b5-281">Se a VM for criada usando uma imagem da galeria do Azure, o agente de Backup já estará instalado.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-281">If your VM is created using an Azure gallery image, then the Backup agent is already installed.</span></span> <span data-ttu-id="0c2b5-282">Caso contrário (ou seja, se você estiver usando uma imagem personalizada), use as instruções para [Instalar o Agente de VM na máquina virtual](../../backup/backup-azure-arm-vms-prepare.md#install-the-vm-agent-on-the-virtual-machine).</span><span class="sxs-lookup"><span data-stu-id="0c2b5-282">Otherwise (that is, if you are using a custom image), use instructions to [Install the VM Agent on the virtual machine](../../backup/backup-azure-arm-vms-prepare.md#install-the-vm-agent-on-the-virtual-machine).</span></span>

5.  <span data-ttu-id="0c2b5-283">Verifique se a VM permite a conectividade de rede para que o serviço de backup funcione.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-283">Make sure that the VM allows network connectivity for the backup service to function.</span></span> <span data-ttu-id="0c2b5-284">Siga estas instruções para a [Conectividade de rede](../../backup/backup-azure-arm-vms-prepare.md#network-connectivity).</span><span class="sxs-lookup"><span data-stu-id="0c2b5-284">Follow these instructions for [Network connectivity](../../backup/backup-azure-arm-vms-prepare.md#network-connectivity).</span></span>

6.  <span data-ttu-id="0c2b5-285">Depois que as etapas acima forem concluídas, o backup será executado em intervalos regulares, conforme especificado na política de backup.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-285">Once the above steps are completed, the backup will run at regular intervals as specified in the backup policy.</span></span> <span data-ttu-id="0c2b5-286">Se necessário, dispare o primeiro backup manualmente no painel do cofre do portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-286">If necessary, you can trigger the first backup manually from the vault dashboard on the Azure portal.</span></span>

<span data-ttu-id="0c2b5-287">Para automatizar o Backup do Azure usando scripts, consulte [Cmdlets do PowerShell para backup de VM](../../backup/backup-azure-vms-automation.md).</span><span class="sxs-lookup"><span data-stu-id="0c2b5-287">For automating Azure Backup using scripts, please refer to [PowerShell cmdlets for VM backup](../../backup/backup-azure-vms-automation.md).</span></span>

### <a name="steps-for-recovery"></a><span data-ttu-id="0c2b5-288">Etapas de recuperação</span><span class="sxs-lookup"><span data-stu-id="0c2b5-288">Steps for Recovery</span></span>

<span data-ttu-id="0c2b5-289">Se você precisar reparar ou recriar uma VM, restaure a VM por meio de um dos pontos de recuperação de backup no cofre.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-289">If you need to repair or rebuild a VM, you can restore the VM from any of the backup recovery points in the vault.</span></span> <span data-ttu-id="0c2b5-290">Há duas opções diferentes para realizar a recuperação:</span><span class="sxs-lookup"><span data-stu-id="0c2b5-290">There are a couple of different options for performing the recovery:</span></span>

1.  <span data-ttu-id="0c2b5-291">Você pode criar uma nova VM como uma representação pontual da VM copiada em backup.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-291">You can create a new VM as a point-in-time representation of your backed-up VM.</span></span>

2.  <span data-ttu-id="0c2b5-292">Você pode restaurar os discos e, em seguida, usar o modelo para a VM para personalizar e recriar a VM restaurada.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-292">You can restore the disks and then use the template for the VM to customize and rebuild the restored VM.</span></span> 

<span data-ttu-id="0c2b5-293">Consulte as instruções para [Usar o portal do Azure para restaurar máquinas virtuais](../../backup/backup-azure-arm-restore-vms.md#restoring-a-vm-during-azure-datacenter-disaster).</span><span class="sxs-lookup"><span data-stu-id="0c2b5-293">See instructions to [Use Azure portal to restore virtual machines](../../backup/backup-azure-arm-restore-vms.md#restoring-a-vm-during-azure-datacenter-disaster).</span></span> <span data-ttu-id="0c2b5-294">O documento também explica as etapas específicas para a restauração de VMs copiadas em backup para o data center emparelhado usando o cofre de backup com redundância geográfica no caso de um desastre no data center primário.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-294">The document also explains the specific steps for restoring backed-up VMs to the paired data center using your geo-redundant backup vault in the case of a disaster at the primary data center.</span></span> <span data-ttu-id="0c2b5-295">Nesse caso, o Backup do Azure usa o serviço de Computação da região secundária para criar a máquina virtual restaurada.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-295">In that case, Azure Backup uses the Compute service from the secondary region to create the restored virtual machine.</span></span>

<span data-ttu-id="0c2b5-296">Use também o PowerShell para [restaurar uma VM](../../backup/backup-azure-vms-automation.md#restore-an-azure-vm) ou [criar uma nova VM com base em discos restaurados](../../backup/backup-azure-vms-automation.md#create-a-vm-from-restored-disks).</span><span class="sxs-lookup"><span data-stu-id="0c2b5-296">You can also use PowerShell for [restoring a VM](../../backup/backup-azure-vms-automation.md#restore-an-azure-vm) or for [creating a new VM from restored disks](../../backup/backup-azure-vms-automation.md#create-a-vm-from-restored-disks).</span></span>

## <a name="alternative-solution-consistent-snapshots"></a><span data-ttu-id="0c2b5-297">Solução alternativa: instantâneos consistentes</span><span class="sxs-lookup"><span data-stu-id="0c2b5-297">Alternative Solution: Consistent Snapshots</span></span>

<span data-ttu-id="0c2b5-298">Se não for possível usar o Serviço de Backup do Azure, implemente seu próprio mecanismo de backup usando instantâneos.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-298">If you are unable to use the Azure Backup Service, you can implement your own backup mechanism using snapshots.</span></span> <span data-ttu-id="0c2b5-299">É complicado criar instantâneos consistentes para todos os discos usados por uma VM e, em seguida, replicar esses instantâneos em outra região.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-299">It is complicated to create consistent snapshots for all disks used by a VM and then replicate those snapshots to another region.</span></span> <span data-ttu-id="0c2b5-300">Por esse motivo, o Azure considera o uso do Serviço de Backup uma opção melhor do que a criação de uma solução personalizada.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-300">For this reason, Azure considers leveraging the Backup Service a better option than building a custom solution.</span></span> <span data-ttu-id="0c2b5-301">Se você usar o armazenamento RA-GRS/GRS para discos, os instantâneos serão replicados automaticamente em um data center secundário.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-301">If you use RA-GRS/GRS storage for disks, snapshots are automatically replicated to a secondary data center.</span></span> <span data-ttu-id="0c2b5-302">Se você usar o armazenamento LRS para discos, precisará replicar os dados por conta própria.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-302">If you use LRS storage for disks, you will need to replicate the data yourself.</span></span> <span data-ttu-id="0c2b5-303">Para obter mais informações, consulte [Fazer backup de discos não gerenciados de VM do Azure com instantâneos incrementais](../../virtual-machines/windows/incremental-snapshots.md).</span><span class="sxs-lookup"><span data-stu-id="0c2b5-303">For more information, see [Back up Azure unmanaged VM disks with incremental snapshots](../../virtual-machines/windows/incremental-snapshots.md).</span></span>

<span data-ttu-id="0c2b5-304">Um instantâneo é uma representação de um objeto em um ponto específico no tempo.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-304">A snapshot is a representation of an object at a specific point in time.</span></span> <span data-ttu-id="0c2b5-305">Um instantâneo incorrerá em cobrança pelo tamanho incremental dos dados que ele mantém.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-305">A snapshot will incur billing for the incremental size of the data it holds.</span></span> <span data-ttu-id="0c2b5-306">Para obter mais informações, consulte [Criar um instantâneo de blob](../blobs/storage-blob-snapshots.md).</span><span class="sxs-lookup"><span data-stu-id="0c2b5-306">For more information, see [Create a blob snapshot](../blobs/storage-blob-snapshots.md).</span></span>

### <a name="creating-snapshots-while-the-vm-is-running"></a><span data-ttu-id="0c2b5-307">Criando instantâneos enquanto a VM está em execução</span><span class="sxs-lookup"><span data-stu-id="0c2b5-307">Creating snapshots while the VM is running</span></span>

<span data-ttu-id="0c2b5-308">Embora você possa tirar um instantâneo a qualquer momento, se a VM estiver em execução, ainda haverá dados sendo transmitidos para os discos e os instantâneos poderão conter operações parciais que estavam em trânsito.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-308">While you can take a snapshot at any time, if the VM is running, there is still data being streamed to the disks, and the snapshots may contain partial operations that were in flight.</span></span> <span data-ttu-id="0c2b5-309">Além disso, se houver vários discos envolvidos, os instantâneos de discos diferentes poderão ter ocorrido em momentos diferentes, o que significa que esses instantâneos podem não estar coordenados.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-309">Also, if there are several disks involved, the snapshots of different disks may have occurred at different times, which means these snapshots may not be coordinated.</span></span> <span data-ttu-id="0c2b5-310">Isso é especialmente problemático para volumes distribuídos cujos arquivos podem ser corrompidos se alterações estavam sendo feitas durante o backup.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-310">This is especially problematic for striped volumes whose files can be corrupted if changes were being made during backup.</span></span>

<span data-ttu-id="0c2b5-311">Para evitar essa situação, o processo de backup deve implementar as seguintes etapas:</span><span class="sxs-lookup"><span data-stu-id="0c2b5-311">To avoid this situation, the backup process must implement the following steps:</span></span>

1.  <span data-ttu-id="0c2b5-312">Congelar todos os discos</span><span class="sxs-lookup"><span data-stu-id="0c2b5-312">Freeze all the disks</span></span>

2.  <span data-ttu-id="0c2b5-313">Liberar todas as gravações pendentes</span><span class="sxs-lookup"><span data-stu-id="0c2b5-313">Flush all the pending writes</span></span>

3.  <span data-ttu-id="0c2b5-314">Em seguida, [criar um instantâneo de blob](../blobs/storage-blob-snapshots.md) para todos os discos</span><span class="sxs-lookup"><span data-stu-id="0c2b5-314">Then, [create a blob snapshot](../blobs/storage-blob-snapshots.md) for all the disks</span></span>

<span data-ttu-id="0c2b5-315">Alguns aplicativos do Windows como o SQL Server fornecem um mecanismo de backup coordenado por meio do VSS para criar backups consistentes com o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-315">Some Windows applications like SQL Server provide a coordinated backup mechanism via VSS to create application-consistent backups.</span></span> <span data-ttu-id="0c2b5-316">No Linux, use uma ferramenta como o fsfreeze para coordenar os discos, o que fornecerá backups consistentes com os arquivos, mas não instantâneos consistentes com o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-316">On Linux, you can use a tool like fsfreeze for coordinating the disks, which will provide file-consistent backups, but not application-consistent snapshots.</span></span> <span data-ttu-id="0c2b5-317">Esse processo é complicado; portanto, considere o uso de [Backup do Azure](../../backup/backup-azure-vms-introduction.md) ou de uma solução de backup de terceiros que já implementa isso.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-317">This process is complicated, so and you should consider using [Azure Backup](../../backup/backup-azure-vms-introduction.md) or a third-party backup solution which already implement this.</span></span>

<span data-ttu-id="0c2b5-318">O processo acima resultará em uma coleção de instantâneos coordenados para todos os discos de VM, representando uma exibição pontual específica da VM.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-318">The above process will result in a collection of coordinated snapshots for all the VM disks, representing a specific point-in-time view of the VM.</span></span> <span data-ttu-id="0c2b5-319">Esse é um ponto de restauração de backup para a VM.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-319">This is a backup restore point for the VM.</span></span> <span data-ttu-id="0c2b5-320">Repita o processo em intervalos agendados para criar backups periódicos.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-320">You can repeat the process at scheduled intervals to create periodic backups.</span></span> <span data-ttu-id="0c2b5-321">Veja abaixo as etapas para [copiar os backups para outra região](#copy-the-snapshots-to-another-region) para DR.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-321">See below for the steps to [copy the backups to another region](#copy-the-snapshots-to-another-region) for DR.</span></span>

### <a name="creating-snapshots-while-the-vm-is-offline"></a><span data-ttu-id="0c2b5-322">Criando instantâneos enquanto a VM está offline</span><span class="sxs-lookup"><span data-stu-id="0c2b5-322">Creating snapshots while the VM is offline</span></span>

<span data-ttu-id="0c2b5-323">Outra opção para criar backups consistentes é desligar a VM e tirar instantâneos de blob de cada disco.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-323">Another option to create consistent backups is shutting down the VM and taking blob snapshots of each disk.</span></span> <span data-ttu-id="0c2b5-324">Isso é mais fácil do que coordenar instantâneos de uma VM em execução, mas exige alguns minutos de inatividade.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-324">This is easier than coordinating snapshots of a running VM, but it requires a few minutes of downtime.</span></span> <span data-ttu-id="0c2b5-325">Para esse processo, siga estas etapas:</span><span class="sxs-lookup"><span data-stu-id="0c2b5-325">For this process, follow these steps:</span></span>

1. <span data-ttu-id="0c2b5-326">Desligue a VM.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-326">Shut down the VM.</span></span>

2. <span data-ttu-id="0c2b5-327">Crie um instantâneo de cada blob do VHD, o que leva apenas alguns segundos.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-327">Create a snapshot of each VHD blob, which only takes a few seconds.</span></span>

    <span data-ttu-id="0c2b5-328">Para criar um instantâneo, use o [PowerShell](storage-powershell-guide-full.md#how-to-manage-azure-blob-snapshots), a [API REST do Armazenamento do Azure](https://msdn.microsoft.com/library/azure/ee691971.aspx), a [CLI do Azure](https://docs.microsoft.com/azure/xplat-cli-install) ou uma das Bibliotecas de Clientes do Armazenamento do Azure, como [a biblioteca de clientes do Armazenamento para .NET](https://msdn.microsoft.com/library/azure/hh488361.aspx).</span><span class="sxs-lookup"><span data-stu-id="0c2b5-328">To create a snapshot, you can use [PowerShell](storage-powershell-guide-full.md#how-to-manage-azure-blob-snapshots), the [Azure Storage Rest API](https://msdn.microsoft.com/library/azure/ee691971.aspx), [Azure CLI](https://docs.microsoft.com/azure/xplat-cli-install), or one of the Azure Storage Client Libraries such as [the Storage client library for .NET](https://msdn.microsoft.com/library/azure/hh488361.aspx).</span></span>

3. <span data-ttu-id="0c2b5-329">Inicie a VM, o que encerra o tempo de inatividade.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-329">Start the VM, which ends the downtime.</span></span> <span data-ttu-id="0c2b5-330">Normalmente, todo o processo é concluído em alguns minutos.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-330">Typically the entire process completes within a few minutes.</span></span>

<span data-ttu-id="0c2b5-331">Esse processo gera uma coleção de instantâneos consistentes para todos os discos, fornecendo um ponto de restauração de backup para a VM.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-331">This process yields a collection of consistent snapshots for all the disks, providing a backup restore point for the VM.</span></span> <span data-ttu-id="0c2b5-332">Veja abaixo as etapas para copiar os instantâneos para outra região para DR.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-332">See below for the steps to copy the snapshots to another region for DR.</span></span>

### <a name="copy-the-snapshots-to-another-region"></a><span data-ttu-id="0c2b5-333">Copiar os instantâneos para outra região</span><span class="sxs-lookup"><span data-stu-id="0c2b5-333">Copy the snapshots to another region</span></span>

<span data-ttu-id="0c2b5-334">A criação de instantâneos por si só pode não ser suficiente para DR.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-334">Creation of the snapshots alone may not be sufficient for DR.</span></span> <span data-ttu-id="0c2b5-335">Também é necessário replicar os backups de instantâneo em outra região.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-335">You must also replicate the snapshot backups to another region.</span></span>

<span data-ttu-id="0c2b5-336">Se você estiver usando GRS ou RA-GRS para os discos, os instantâneos serão replicados na região secundária automaticamente.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-336">If you are using GRS or RA-GRS for your disks, then the snapshots are replicated to the secondary region automatically.</span></span> <span data-ttu-id="0c2b5-337">Pode haver alguns minutos de retardo antes da replicação e se o data center primário ficar inoperante antes que os instantâneos concluam a replicação, você não poderá acessar os instantâneos no data center secundário.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-337">There can be a few minutes of lag before the replication, and if the primary data center goes down before the snapshots finish replicating, you will not be able to access the snapshots from the secondary data center.</span></span> <span data-ttu-id="0c2b5-338">A probabilidade de que isso ocorra é pequena.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-338">The likelihood of this is small.</span></span>

> [!Note] 
> <span data-ttu-id="0c2b5-339">Apenas ter os discos em uma conta GRS ou RA-GRS não protege a VM contra desastres.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-339">Only having the disks in a GRS or RA-GRS account does not protect the VM from disasters.</span></span> <span data-ttu-id="0c2b5-340">Também é necessário criar instantâneos coordenados ou usar o Backup do Azure.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-340">You must also create coordinated snapshots or use Azure Backup.</span></span> <span data-ttu-id="0c2b5-341">Isso é necessário para recuperar uma VM para um estado consistente.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-341">This is required to recover a VM to a consistent state.</span></span>

<span data-ttu-id="0c2b5-342">Se estiver usando o LRS, copie os instantâneos para outra conta de armazenamento imediatamente após a criação do instantâneo.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-342">If you are using LRS, you must copy the snapshots to a different storage account immediately after creating the snapshot.</span></span> <span data-ttu-id="0c2b5-343">O destino de cópia pode ser uma conta de armazenamento LRS em outra região, resultando na cópia em uma região remota.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-343">The copy target could be an LRS storage account in a different region, resulting in the copy being in a remote region.</span></span> <span data-ttu-id="0c2b5-344">Você também pode copiar o instantâneo para uma conta de armazenamento RA-GRS na mesma região.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-344">You can also copy the snapshot to an RA-GRS storage account in the same region.</span></span> <span data-ttu-id="0c2b5-345">Nesse caso, o instantâneo será replicado lentamente na região secundária remota.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-345">In this case, the snapshot will be lazily replicated to the remote secondary region.</span></span> <span data-ttu-id="0c2b5-346">O backup é protegido contra desastres no site primário após a conclusão da cópia e da replicação.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-346">Your backup is protected from disasters at the primary site once the copying and replication is complete.</span></span>

<span data-ttu-id="0c2b5-347">Para copiar os instantâneos incrementais para DR com eficiência, examine as instruções em [Fazer backup de discos não gerenciados de VM do Azure com instantâneos incrementais](../../virtual-machines/windows/incremental-snapshots.md).</span><span class="sxs-lookup"><span data-stu-id="0c2b5-347">To copy your incremental snapshots for DR efficiently, review the instructions in [Back up Azure unmanaged VM disks with incremental snapshots](../../virtual-machines/windows/incremental-snapshots.md).</span></span>

![](./media/storage-backup-and-disaster-recovery-for-azure-iaas-disks/backup-and-disaster-recovery-for-azure-iaas-disks-2.png)   

### <a name="recovery-from-snapshots"></a><span data-ttu-id="0c2b5-348">Recuperação com base em instantâneos</span><span class="sxs-lookup"><span data-stu-id="0c2b5-348">Recovery from Snapshots</span></span>

<span data-ttu-id="0c2b5-349">Para recuperar um instantâneo, copie-o para criar um novo blob.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-349">To retrieve a snapshot, copy it to make a new blob.</span></span> <span data-ttu-id="0c2b5-350">Se estiver copiando o instantâneo da conta primária, copie o instantâneo sobre o blob base do instantâneo, revertendo o disco para o instantâneo; isso é conhecido como promoção do instantâneo.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-350">If you are copying the snapshot from the primary account, you can copy the snapshot over to the base blob of the snapshot, thus reverting the disk to the snapshot; this is known as promoting the snapshot.</span></span> <span data-ttu-id="0c2b5-351">Se estiver copiando o backup de instantâneo de uma conta secundária (no caso do RA-GRS), ele deverá ser copiado para uma conta primária.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-351">If you are copying the snapshot backup from a secondary account (in the case of RA-GRS), it must be copied to a primary account.</span></span> <span data-ttu-id="0c2b5-352">Copie um instantâneo [usando o PowerShell](storage-powershell-guide-full.md#how-to-copy-a-snapshot-of-a-blob) ou o utilitário AzCopy.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-352">You can copy a snapshot [using PowerShell](storage-powershell-guide-full.md#how-to-copy-a-snapshot-of-a-blob) or using the AzCopy utility.</span></span> <span data-ttu-id="0c2b5-353">Para obter mais informações, consulte [Transferir dados com o Utilitário de Linha de Comando AzCopy](storage-use-azcopy.md).</span><span class="sxs-lookup"><span data-stu-id="0c2b5-353">For more information, see [Transfer data with the AzCopy Command-Line Utility](storage-use-azcopy.md).</span></span>

<span data-ttu-id="0c2b5-354">No caso de VMs com vários discos, é necessário copiar todos os instantâneos que fazem parte do mesmo ponto de restauração coordenado.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-354">In the case of VMs with multiple disks, you must copy all the snapshots that are part of the same coordinated restore point.</span></span> <span data-ttu-id="0c2b5-355">Depois de copiar os instantâneos para blobs de VHD graváveis, use os blobs para recriar a VM usando o modelo da VM.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-355">Once you copy the snapshots to writable VHD blobs, you can use the blobs to recreate your VM using the template for the VM.</span></span>

## <a name="other-options"></a><span data-ttu-id="0c2b5-356">Outras opções</span><span class="sxs-lookup"><span data-stu-id="0c2b5-356">Other options</span></span>

### <a name="sql-server"></a><span data-ttu-id="0c2b5-357">SQL Server</span><span class="sxs-lookup"><span data-stu-id="0c2b5-357">SQL Server</span></span>

<span data-ttu-id="0c2b5-358">O SQL Server em execução em uma VM tem suas próprias funcionalidades internas para fazer backup do banco de dados do SQL Server para o armazenamento de Blobs do Azure ou um compartilhamento de arquivos.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-358">SQL Server running in a VM has its own built-in capabilities to backup your SQL Server database to Azure Blob storage or a file share.</span></span> <span data-ttu-id="0c2b5-359">Se a conta de armazenamento for GRS ou RA-GRS, você poderá acessar esses backups no data center secundário da conta de armazenamento em caso de desastre, com as mesmas restrições, conforme abordado anteriormente.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-359">If the storage account is GRS or RA-GRS, you can access those backups in the storage account’s secondary data center in the event of a disaster, with the same restrictions as discussed previously.</span></span> <span data-ttu-id="0c2b5-360">Para obter mais informações, consulte [Backup e Restauração para SQL Server em Máquinas Virtuais do Azure](../../virtual-machines/windows/sql/virtual-machines-windows-sql-backup-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="0c2b5-360">For more information, see [Backup and Restore for SQL Server in Azure Virtual Machines](../../virtual-machines/windows/sql/virtual-machines-windows-sql-backup-recovery.md).</span></span> <span data-ttu-id="0c2b5-361">Além de backup e restauração, os [Grupos de Disponibilidade AlwaysOn do SQL Server](../../virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr.md) podem manter réplicas secundárias de bancos de dados para reduzir consideravelmente o tempo de recuperação de desastre.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-361">In addition to backup and restore, [SQL Server Always On Availability Groups](../../virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr.md) can maintain secondary replicas of databases to greatly reduce the disaster recovery time.</span></span>

## <a name="other-considerations"></a><span data-ttu-id="0c2b5-362">Outras considerações</span><span class="sxs-lookup"><span data-stu-id="0c2b5-362">Other considerations</span></span>

<span data-ttu-id="0c2b5-363">Este artigo abordou como fazer backup ou tirar instantâneos das VMs e de seus discos para dar suporte à recuperação de desastre e como usá-los para recuperação.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-363">This article has discussed how to backup or take snapshots of your VMs and their disks to support disaster recovery, and how to use those to recover.</span></span> <span data-ttu-id="0c2b5-364">Com o modelo do Azure Resource Manager, muitas pessoas usam modelos para criar suas VMs e outra infraestrutura no Azure.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-364">With the Azure Resource Manager model, many people use templates to create their VMs and other infrastructure in Azure.</span></span> <span data-ttu-id="0c2b5-365">Use um modelo para criar uma VM que tem sempre a mesma configuração.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-365">You can use a template to create a VM that has the same configuration every time.</span></span> <span data-ttu-id="0c2b5-366">Se você usar imagens personalizadas para criar as VMs, também deverá verificar se as imagens são protegidas usando uma conta RA-GRS para armazená-las.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-366">If you use custom images for creating your VMs, you must also make sure your images are protected by using an RA-GRS account to store them.</span></span>

<span data-ttu-id="0c2b5-367">Consequentemente, o processo de backup pode ser uma combinação de duas coisas:</span><span class="sxs-lookup"><span data-stu-id="0c2b5-367">Consequently, your backup process may be a combination of two things:</span></span>

1. <span data-ttu-id="0c2b5-368">Fazer backup dos dados (discos)</span><span class="sxs-lookup"><span data-stu-id="0c2b5-368">Backup the data (disks)</span></span>
2. <span data-ttu-id="0c2b5-369">Fazer backup da configuração (modelos, imagens personalizadas)</span><span class="sxs-lookup"><span data-stu-id="0c2b5-369">Backup the configuration (templates, custom images)</span></span>

<span data-ttu-id="0c2b5-370">Dependendo da opção de backup escolhida, talvez você precise administrar o backup dos dados e da configuração ou o serviço de backup pode administrar tudo isso para você.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-370">Depending on the backup option you choose, you may have to handle the backup of both the data and the configuration, or the backup service may handle all of that for you.</span></span>

## <a name="appendix---understanding-the-impact-of-lrs-grs-and-ra-grs"></a><span data-ttu-id="0c2b5-371">Apêndice – Noções básicas do impacto do LRS, GRS e RA-GRS</span><span class="sxs-lookup"><span data-stu-id="0c2b5-371">Appendix - Understanding the impact of LRS, GRS, and RA-GRS</span></span>

<span data-ttu-id="0c2b5-372">Para contas de armazenamento no Azure, há três tipos de redundância de dados que devem ser considerados em relação à recuperação de desastre – LRS (redundância local), GRS (redundância geográfica) ou RA-GRS (redundância geográfica com acesso de leitura).</span><span class="sxs-lookup"><span data-stu-id="0c2b5-372">For storage accounts in Azure, there are three types of data redundancy that you should consider regarding disaster recovery – locally redundant (LRS), geo-redundant (GRS), or geo-redundant with read access (RA-GRS).</span></span> 

<span data-ttu-id="0c2b5-373">O LRS (Armazenamento com Redundância Local) retém três cópias dos dados no mesmo data center.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-373">Locally Redundant Storage (LRS) retains three copies of the data in the same data center.</span></span> <span data-ttu-id="0c2b5-374">Ao gravar os dados, todas as três cópias são atualizadas antes que uma operação bem-sucedida seja retornada ao chamador, de modo que você saiba que elas são idênticas.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-374">When writing the data, all three copies are updated before success is returned to the caller, so you know they are identical.</span></span> <span data-ttu-id="0c2b5-375">O disco está protegido contra falhas locais, pois é muito improvável que todas as três cópias sejam afetadas ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-375">Your disk is protected from local failures, since it is extremely unlikely that all three copies would be impacted at the same time.</span></span> <span data-ttu-id="0c2b5-376">No caso do LRS, não há nenhuma redundância geográfica e, portanto, o disco não está protegido contra falhas catastróficas que podem afetar todo um data center ou toda uma unidade de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-376">In the case of LRS, there is no geo-redundancy, so the disk is not protected from catastrophic failures that can impact an entire data center or storage unit.</span></span>

<span data-ttu-id="0c2b5-377">Com o GRS e o RA-GRS, três cópias dos dados são retidas na região primária (escolhida por você) e mais três cópias dos dados são retidas em uma região secundária correspondente (definida pelo Azure).</span><span class="sxs-lookup"><span data-stu-id="0c2b5-377">With GRS and RA-GRS, three copies of your data are retained in the primary region (selected by you), and three more copies of your data are retained in a corresponding secondary region (set by Azure).</span></span> <span data-ttu-id="0c2b5-378">Por exemplo, se você armazenar dados no Oeste dos EUA, os dados serão replicados no Leste dos EUA.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-378">For example, if you store data in West US, the data will be replicated to East US.</span></span> <span data-ttu-id="0c2b5-379">Isso é feito de forma assíncrona e há um pequeno atraso entre as atualizações no primário e no secundário.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-379">This is done asynchronously, and there is a small delay between updates to the primary and secondary.</span></span> <span data-ttu-id="0c2b5-380">As réplicas dos discos no site secundário são consistentes por disco (com o atraso), mas as réplicas de vários discos ativos podem não estar sincronizadas **entre si**.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-380">Replicas of the disks on the secondary site are consistent on a per-disk basis (with the delay), but replicas of multiple active disks may not be in sync **with each other**.</span></span> <span data-ttu-id="0c2b5-381">Para ter réplicas consistentes em vários discos, são necessários instantâneos consistentes.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-381">To have consistent replicas across multiple disks, consistent snapshots are needed.</span></span>

<span data-ttu-id="0c2b5-382">A principal diferença entre o GRS e o RA-GRS é que, com o RA-GRS, você pode ler a cópia secundária a qualquer momento.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-382">The main difference between GRS and RA-GRS is that with RA-GRS, you can read the secondary copy at any time.</span></span> <span data-ttu-id="0c2b5-383">Se houver um problema que torna os dados na região primária inacessíveis, a equipe do Azure envidará todos os esforços para restaurar o acesso.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-383">If there is a problem that renders the data in the primary region inaccessible, the Azure team will make every effort to restore access.</span></span> <span data-ttu-id="0c2b5-384">Enquanto o primário estiver inoperante, se você tiver o RA-GRS habilitado, poderá acessar os dados no data center secundário.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-384">While the primary is down, if you have RA-GRS enabled, you can access the data in the secondary data center.</span></span> <span data-ttu-id="0c2b5-385">Portanto, se você pretende ler na réplica enquanto o primário estiver inacessível, o RA-GRS deve ser considerado.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-385">Therefore, if you plan to read from the replica while the primary is inaccessible, then RA-GRS should be considered.</span></span>

<span data-ttu-id="0c2b5-386">Se isso acabar se tornando uma interrupção significativa, a equipe do Azure poderá disparar um failover geográfico e alterar as entradas DNS primárias para que apontem para o armazenamento secundário.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-386">If it turns out to be a significant outage, the Azure team may trigger a geo-failover and change the primary DNS entries to point to secondary storage.</span></span> <span data-ttu-id="0c2b5-387">Neste ponto, se você tiver o GRS ou o RA-GRS habilitado, poderá acessar os dados na região que costumava ser a secundária.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-387">At this point, if you have either GRS or RA-GRS enabled, you can access the data in the region that used to be the secondary.</span></span> <span data-ttu-id="0c2b5-388">Em outras palavras, se sua conta de armazenamento for GRS e houver um problema, você poderá acessar o armazenamento secundário somente se houver um failover geográfico.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-388">In other words, if your storage account is GRS and there is a problem, you can access the secondary storage only if there is a geo-failover.</span></span>

<span data-ttu-id="0c2b5-389">Para obter mais informações, consulte [O que fazer se ocorrer uma interrupção do Armazenamento do Azure](storage-disaster-recovery-guidance.md).</span><span class="sxs-lookup"><span data-stu-id="0c2b5-389">For more information, see [What to do if an Azure Storage outage occurs](storage-disaster-recovery-guidance.md).</span></span> 

<span data-ttu-id="0c2b5-390">Observe que a Microsoft controla a ocorrência de um failover.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-390">Note that Microsoft controls whether a failover occurs.</span></span> <span data-ttu-id="0c2b5-391">O failover não é controlado por conta de armazenamento e, portanto, isso não é decidido por clientes individuais.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-391">Failover is not controlled per storage account, therefore it is not decided by individual customers.</span></span> <span data-ttu-id="0c2b5-392">Para implementar a Recuperação de Desastre em contas de armazenamento ou discos de máquina virtual específicos, use as técnicas descritas anteriormente neste artigo.</span><span class="sxs-lookup"><span data-stu-id="0c2b5-392">To implement Disaster Recovery for specific storage accounts or virtual machine disks, you must use the techniques described previously in this article.</span></span>
