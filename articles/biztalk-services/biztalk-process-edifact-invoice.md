---
title: "Tutorial: Processar faturas EDIFACT usando os Serviços BizTalk do Azure | Microsoft Docs"
description: "Como criar e configurar o conector do Box ou aplicativo de API e usá-lo em um aplicativo lógico no Serviço de Aplicativo do Azure"
services: biztalk-services
documentationcenter: .net,nodejs,java
author: msftman
manager: erikre
editor: 
ms.assetid: 7e0b93fa-3e2b-4a9c-89ef-abf1d3aa8fa9
ms.service: biztalk-services
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: integration
ms.date: 05/31/2016
ms.author: deonhe
ms.openlocfilehash: 4597ee28e4c3b797c0ab050b21a126a95d9e8191
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/03/2017
---
# <a name="tutorial-process-edifact-invoices-using-azure-biztalk-services"></a><span data-ttu-id="b6edb-103">Tutorial: Processar faturas EDIFACT usando os Serviços BizTalk do Azure</span><span class="sxs-lookup"><span data-stu-id="b6edb-103">Tutorial: Process EDIFACT invoices using Azure BizTalk Services</span></span>

> [!INCLUDE [BizTalk Services is being retired, and replaced with Azure Logic Apps](../../includes/biztalk-services-retirement.md)]

<span data-ttu-id="b6edb-104">Você pode usar o Portal dos Serviços BizTalk para configurar e implantar contratos X12 e EDIFACT.</span><span class="sxs-lookup"><span data-stu-id="b6edb-104">You can use the BizTalk Services Portal to configure and deploy X12 and EDIFACT agreements.</span></span> <span data-ttu-id="b6edb-105">Neste tutorial, vamos examinar como criar um contrato EDIFACT para trocar faturas entre parceiros comerciais.</span><span class="sxs-lookup"><span data-stu-id="b6edb-105">In this tutorial, we look at how to create an EDIFACT agreement for exchanging invoices between trading partners.</span></span> <span data-ttu-id="b6edb-106">Este tutorial foi escrito em torno de uma solução comercial de ponta a ponta envolvendo dois parceiros comerciais, Northwind e Contoso, que trocam mensagens EDIFACT.</span><span class="sxs-lookup"><span data-stu-id="b6edb-106">This tutorial is written around an end-to-end business solution involving two trading partners, Northwind and Contoso that exchange EDIFACT messages.</span></span>  

## <a name="sample-based-on-this-tutorial"></a><span data-ttu-id="b6edb-107">Exemplo baseado neste tutorial</span><span class="sxs-lookup"><span data-stu-id="b6edb-107">Sample based on this tutorial</span></span>
<span data-ttu-id="b6edb-108">Este tutorial foi criado com base em uma amostra, **Enviando faturas EDIFACT usando os Serviços BizTalk**, que está disponível para download na [Galeria de Códigos do MSDN](http://go.microsoft.com/fwlink/?LinkId=401005).</span><span class="sxs-lookup"><span data-stu-id="b6edb-108">This tutorial is written around a sample, **Sending EDIFACT Invoices Using BizTalk Services**, which is available to download from the [MSDN Code Gallery](http://go.microsoft.com/fwlink/?LinkId=401005).</span></span> <span data-ttu-id="b6edb-109">Você pode usar o exemplo e percorrer este tutorial para entender como o exemplo foi criado.</span><span class="sxs-lookup"><span data-stu-id="b6edb-109">You could use the sample and go through this tutorial to understand how the sample was built.</span></span> <span data-ttu-id="b6edb-110">Ou você pode usar este tutorial para criar sua própria solução do zero.</span><span class="sxs-lookup"><span data-stu-id="b6edb-110">Or, you could use this tutorial to create your own solution ground-up.</span></span> <span data-ttu-id="b6edb-111">Este tutorial é destinado a uma segunda abordagem, para que você entenda como a solução foi criada.</span><span class="sxs-lookup"><span data-stu-id="b6edb-111">This tutorial is targeted towards the second approach so that you understand how this solution was built.</span></span> <span data-ttu-id="b6edb-112">Além disso, tanto quanto possível, o tutorial é consistente com o exemplo e usa os mesmos nomes para artefatos (por exemplo, esquemas, transformações) usados no exemplo.</span><span class="sxs-lookup"><span data-stu-id="b6edb-112">Also, as much as possible, the tutorial is consistent with the sample and uses the same names for artifacts (for example, schemas, transforms) as used in the sample.</span></span>  

> [!NOTE]
> <span data-ttu-id="b6edb-113">Como essa solução envolve o envio de uma mensagem de uma ponte EAI para uma ponte EDI, ela reutiliza o [Exemplo de encadeamento de Ponte dos Serviços BizTalk](http://code.msdn.microsoft.com/BizTalk-Bridge-chaining-2246b104) .</span><span class="sxs-lookup"><span data-stu-id="b6edb-113">Because this solution involves sending a message from an EAI bridge to an EDI bridge, it reuses the [BizTalk Services Bridge chaining sample](http://code.msdn.microsoft.com/BizTalk-Bridge-chaining-2246b104) sample.</span></span>  
> 
> 

## <a name="what-does-the-solution-do"></a><span data-ttu-id="b6edb-114">O que faz a solução?</span><span class="sxs-lookup"><span data-stu-id="b6edb-114">What does the solution do?</span></span>
<span data-ttu-id="b6edb-115">Nesta solução, a Northwind recebe faturas EDIFACT da Contoso.</span><span class="sxs-lookup"><span data-stu-id="b6edb-115">In this solution, Northwind receives EDIFACT invoices from Contoso.</span></span> <span data-ttu-id="b6edb-116">As faturas não estão em formato EDI padrão.</span><span class="sxs-lookup"><span data-stu-id="b6edb-116">These invoices are not in a standard EDI format.</span></span> <span data-ttu-id="b6edb-117">Portanto, antes de enviar a fatura para a Northwind, ela deve ser transformada em um documento de fatura EDIFACT (também chamado INVOIC).</span><span class="sxs-lookup"><span data-stu-id="b6edb-117">So, before sending the invoice to Northwind, it must be transformed to an EDIFACT invoice (also called INVOIC) document.</span></span> <span data-ttu-id="b6edb-118">Após o recebimento, a Northwind deve processar a fatura EDIFACT e retornar uma mensagem de controle (também chamada CONTRL) para a Contoso.</span><span class="sxs-lookup"><span data-stu-id="b6edb-118">On receipt, Northwind must process the EDIFACT invoice, and return a control message (also called CONTRL) to Contoso.</span></span>

![][1]  

<span data-ttu-id="b6edb-119">Para obter esse cenário de negócios, a Contoso usa os recursos fornecidos pelos Serviços BizTalk do Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="b6edb-119">To achieve this business scenario, Contoso uses the features provided with Microsoft Azure BizTalk Services.</span></span>

* <span data-ttu-id="b6edb-120">A Contoso usa pontes EAI para transformar a fatura original em EDIFACT INVOIC.</span><span class="sxs-lookup"><span data-stu-id="b6edb-120">Contoso uses EAI bridges to transform the original invoice to EDIFACT INVOIC.</span></span>
* <span data-ttu-id="b6edb-121">A ponte EAI, em seguida, envia a mensagem a uma ponte de envio EDI implantada como parte de um contrato configurado no Portal dos Serviços BizTalk.</span><span class="sxs-lookup"><span data-stu-id="b6edb-121">The EAI bridge then sends the message to an EDI send bridge deployed as part of an agreement configured in the BizTalk Services Portal.</span></span>
* <span data-ttu-id="b6edb-122">A ponte de envio EDI processa a EDIFACT INVOIC e a encaminha para a Northwind.</span><span class="sxs-lookup"><span data-stu-id="b6edb-122">The EDI send bridge processes the EDIFACT INVOIC and routes it to Northwind.</span></span>
* <span data-ttu-id="b6edb-123">Depois de receber a fatura, a Northwind retorna uma mensagem CONTRL à ponte de recebimento EDI implantada como parte do contrato.</span><span class="sxs-lookup"><span data-stu-id="b6edb-123">After receiving the invoice, Northwind returns a CONTRL message to the EDI receive bridge deployed as part of the agreement.</span></span>  

> [!NOTE]
> <span data-ttu-id="b6edb-124">Opcionalmente, essa solução também demonstra como usar o processamento em lotes para enviar faturas em lotes em vez de enviar cada fatura separadamente.</span><span class="sxs-lookup"><span data-stu-id="b6edb-124">Optionally, this solution also demonstrates how to use batching to send the invoices in batches, instead of sending each invoice separately.</span></span>  
> 
> 

<span data-ttu-id="b6edb-125">Para concluir o cenário, usamos as filas do Barramento de Serviço para enviar a fatura da Contoso para a Northwind ou receber a confirmação da Northwind.</span><span class="sxs-lookup"><span data-stu-id="b6edb-125">To complete the scenario, we use Service Bus queues to send invoice from Contoso to Northwind or receive acknowledgement from Northwind.</span></span> <span data-ttu-id="b6edb-126">Essas filas podem ser criadas usando um aplicativo cliente, que está disponível para download e está incluído no pacote de exemplo disponível como parte deste tutorial.</span><span class="sxs-lookup"><span data-stu-id="b6edb-126">These queues can be created using a client application, which is available as a download and is included in the sample package that is available as part of this tutorial.</span></span>  

## <a name="prerequisites"></a><span data-ttu-id="b6edb-127">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="b6edb-127">Prerequisites</span></span>
* <span data-ttu-id="b6edb-128">Você deve ter um namespace do Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="b6edb-128">You must have a Service Bus namespace.</span></span> <span data-ttu-id="b6edb-129">Para obter instruções sobre como criar um namespace, confira [Como criar ou modificar um namespace do Barramento de Serviço](https://msdn.microsoft.com/library/azure/hh674478.aspx).</span><span class="sxs-lookup"><span data-stu-id="b6edb-129">For instructions on creating a namespace, see [How To: Create or Modify a Service Bus Service Namespace](https://msdn.microsoft.com/library/azure/hh674478.aspx).</span></span> <span data-ttu-id="b6edb-130">Vamos supor que você já tenha um namespace de Barramento de serviço provisionado, chamado **edifactbts**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-130">Let us assume that you already have a Service Bus namespace provisioned, called **edifactbts**.</span></span>
* <span data-ttu-id="b6edb-131">Você deve ter uma assinatura dos Serviços BizTalk.</span><span class="sxs-lookup"><span data-stu-id="b6edb-131">You must have a BizTalk Services subscription.</span></span> <span data-ttu-id="b6edb-132">Para obter instruções, confira [Criar um Serviço BizTalk usando o portal clássico do Azure](http://go.microsoft.com/fwlink/?LinkID=302280).</span><span class="sxs-lookup"><span data-stu-id="b6edb-132">For instructions, see [Create a BizTalk Service using Azure classic portal](http://go.microsoft.com/fwlink/?LinkID=302280).</span></span> <span data-ttu-id="b6edb-133">Para este tutorial, suponhamos que você tenha uma assinatura dos Serviços BizTalk chamada **contosowabs**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-133">For this tutorial, let us assume you have a BizTalk Services subscription, called **contosowabs**.</span></span>
* <span data-ttu-id="b6edb-134">Registre sua assinatura dos Serviços BizTalk no Portal dos Serviços BizTalk.</span><span class="sxs-lookup"><span data-stu-id="b6edb-134">Register your BizTalk Services subscription on the BizTalk Services Portal.</span></span> <span data-ttu-id="b6edb-135">Para obter instruções, confira [Registrar uma implantação de Serviço BizTalk no Portal dos Serviços BizTalk](https://msdn.microsoft.com/library/hh689837.aspx)</span><span class="sxs-lookup"><span data-stu-id="b6edb-135">For instructions, see [Registering a BizTalk Service Deployment on the BizTalk Services Portal](https://msdn.microsoft.com/library/hh689837.aspx)</span></span>
* <span data-ttu-id="b6edb-136">Você deve ter o Visual Studio instalado.</span><span class="sxs-lookup"><span data-stu-id="b6edb-136">You must have Visual Studio installed.</span></span>
* <span data-ttu-id="b6edb-137">Você deve ter o SDK dos Serviços BizTalk instalado.</span><span class="sxs-lookup"><span data-stu-id="b6edb-137">You must have BizTalk Services SDK installed.</span></span> <span data-ttu-id="b6edb-138">Você pode baixar o SDK em [http://go.microsoft.com/fwlink/?LinkId=235057](http://go.microsoft.com/fwlink/?LinkId=235057)</span><span class="sxs-lookup"><span data-stu-id="b6edb-138">You can download the SDK from [http://go.microsoft.com/fwlink/?LinkId=235057](http://go.microsoft.com/fwlink/?LinkId=235057)</span></span>  

## <a name="step-1-create-the-service-bus-queues"></a><span data-ttu-id="b6edb-139">Etapa 1: Criar as filas do Barramento de Serviço</span><span class="sxs-lookup"><span data-stu-id="b6edb-139">Step 1: Create the Service Bus queues</span></span>
<span data-ttu-id="b6edb-140">Essa solução usa filas do Barramento de Serviço para trocar mensagens entre parceiros comerciais.</span><span class="sxs-lookup"><span data-stu-id="b6edb-140">This solution uses Service Bus queues to exchange messages between trading partners.</span></span> <span data-ttu-id="b6edb-141">A Contoso e a Northwind enviam mensagens às filas de onde as pontes EAI e/ou EDI irão consumi-las.</span><span class="sxs-lookup"><span data-stu-id="b6edb-141">Contoso and Northwind send messages to the queues from where the EAI and/or EDI bridges consume them.</span></span> <span data-ttu-id="b6edb-142">Para essa solução, você precisa de três filas do Barramento de Serviço:</span><span class="sxs-lookup"><span data-stu-id="b6edb-142">For this solution, you need three Service Bus queues:</span></span>

* <span data-ttu-id="b6edb-143">**northwindreceive** – A Northwind recebe a fatura da Contoso por essa fila.</span><span class="sxs-lookup"><span data-stu-id="b6edb-143">**northwindreceive** – Northwind receives the invoice from Contoso over this queue.</span></span>
* <span data-ttu-id="b6edb-144">**contosoreceive** – A Contoso recebe a confirmação da Northwind por essa fila.</span><span class="sxs-lookup"><span data-stu-id="b6edb-144">**contosoreceive** – Contoso receives the acknowledgement from Northwind over this queue.</span></span>
* <span data-ttu-id="b6edb-145">**suspended** – Todas as mensagens suspensas são roteadas para essa fila.</span><span class="sxs-lookup"><span data-stu-id="b6edb-145">**suspended** – All suspended messages are routed to this queue.</span></span> <span data-ttu-id="b6edb-146">As mensagens são suspensas quando falham durante o processamento.</span><span class="sxs-lookup"><span data-stu-id="b6edb-146">Messages are suspended if they fail during processing.</span></span>

<span data-ttu-id="b6edb-147">Você pode criar essas filas do Barramento de Serviço usando um aplicativo cliente incluído no pacote de exemplo.</span><span class="sxs-lookup"><span data-stu-id="b6edb-147">You can create these Service Bus queues by using a client application included in the sample package.</span></span>  

1. <span data-ttu-id="b6edb-148">No local de onde você baixou o exemplo, abra **Tutorial Sending Invoices Using BizTalk Services EDI Bridges.sln**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-148">From the location where you downloaded the sample, open **Tutorial Sending Invoices Using BizTalk Services EDI Bridges.sln**.</span></span>
2. <span data-ttu-id="b6edb-149">Pressione **F5** para compilar e iniciar o aplicativo **Tutorial Cliente**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-149">Press **F5** to build and start the **Tutorial Client** application.</span></span>
3. <span data-ttu-id="b6edb-150">Na tela, insira o namespace, o nome do emissor e a chave do emissor do ACS do Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="b6edb-150">In the screen, enter the Service Bus ACS namespace, issuer name, and issuer key.</span></span>
   
   ![][2]  
4. <span data-ttu-id="b6edb-151">Uma caixa de mensagem solicitará a criação de três filas no namespace do Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="b6edb-151">A message box prompts that three queues will be created in your Service Bus namespace.</span></span> <span data-ttu-id="b6edb-152">Clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-152">Click **OK**.</span></span>
5. <span data-ttu-id="b6edb-153">Deixe o Tutorial Cliente em execução.</span><span class="sxs-lookup"><span data-stu-id="b6edb-153">Leave the Tutorial Client running.</span></span> <span data-ttu-id="b6edb-154">Abra, clique em **Barramento de Serviço** > ***seu namespace do Barramento de Serviço*** > **Filas** e verifique se as três filas foram criadas.</span><span class="sxs-lookup"><span data-stu-id="b6edb-154">Open the , click **Service Bus** > ***your Service Bus namespace*** > **Queues**, and verify that the three queues are created.</span></span>  

## <a name="step-2-create-and-deploy-trading-partner-agreement"></a><span data-ttu-id="b6edb-155">Etapa 2: Criar e implantar o acordo entre parceiros comerciais</span><span class="sxs-lookup"><span data-stu-id="b6edb-155">Step 2: Create and deploy trading partner agreement</span></span>
<span data-ttu-id="b6edb-156">Crie um acordo entre os parceiros comerciais Contoso e Northwind.</span><span class="sxs-lookup"><span data-stu-id="b6edb-156">Create a trading partner agreement between Contoso and Northwind.</span></span> <span data-ttu-id="b6edb-157">Um acordo entre parceiros comerciais define o contrato comercial entre os dois parceiros comerciais, como o esquema de mensagem a ser usado, qual protocolo de mensagens usar, etc. Um acordo entre parceiros comerciais inclui duas pontes EDI, uma para enviar mensagens a parceiros comerciais (chamada **ponte de envio EDI**) e uma para receber mensagens de parceiros comerciais (chamada **ponte de recebimento EDI**).</span><span class="sxs-lookup"><span data-stu-id="b6edb-157">A trading partner agreement defines a trade contract between the two business partners, such as which message schema to use, which messaging protocol to use, etc. A trading partner agreement includes two EDI bridges, one to send messages to trading partners (called the **EDI Send bridge**) and one to receive messages from trading partners (called the **EDI Receive bridge**).</span></span>

<span data-ttu-id="b6edb-158">No contexto desta solução, a ponte de envio EDI corresponde ao lado do envio do acordo e é usada para enviar a fatura EDIFACT da Contoso para a Northwind.</span><span class="sxs-lookup"><span data-stu-id="b6edb-158">In the context of this solution, the EDI send bridge corresponds to the send-side of the agreement and is used to send the EDIFACT invoice from Contoso to Northwind.</span></span> <span data-ttu-id="b6edb-159">Da mesma forma, a ponte de recebimento EDI corresponde ao lado de recebimento do acordo e é usada para receber as confirmações da Northwind.</span><span class="sxs-lookup"><span data-stu-id="b6edb-159">Similarly, the EDI receive bridge corresponds to the receive-side of the agreement and is used to receive acknowledgements from Northwind.</span></span>  

### <a name="create-the-trading-partners"></a><span data-ttu-id="b6edb-160">Criar os parceiros comerciais</span><span class="sxs-lookup"><span data-stu-id="b6edb-160">Create the trading partners</span></span>
<span data-ttu-id="b6edb-161">Para começar, crie parceiros comerciais para a Contoso e para a Northwind.</span><span class="sxs-lookup"><span data-stu-id="b6edb-161">To start with, create trading partners for Contoso and Northwind.</span></span>  

1. <span data-ttu-id="b6edb-162">No Portal dos Serviços BizTalk, na guia **Parceiros** clique em **Adicionar**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-162">In the BizTalk Services Portal, on the **Partners** tab, click **Add**.</span></span>
2. <span data-ttu-id="b6edb-163">Na página Novo parceiro, insira **Contoso** como um nome de parceiro e clique em **Salvar**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-163">In the New partner page, enter **Contoso** as a partner name, and then click **Save**.</span></span>
3. <span data-ttu-id="b6edb-164">Repita as etapas para criar um segundo parceiro, **Northwind**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-164">Repeat the step to create the second partner, **Northwind**.</span></span>  

### <a name="create-the-agreement"></a><span data-ttu-id="b6edb-165">Criar o acordo</span><span class="sxs-lookup"><span data-stu-id="b6edb-165">Create the agreement</span></span>
<span data-ttu-id="b6edb-166">Acordos entre parceiros comerciais são criados entre os perfis comerciais dos parceiros comerciais.</span><span class="sxs-lookup"><span data-stu-id="b6edb-166">Trading partner agreements are created between business profiles of trading partners.</span></span> <span data-ttu-id="b6edb-167">Essa solução usa perfis de parceiros padrão que são criados automaticamente quando criamos os parceiros.</span><span class="sxs-lookup"><span data-stu-id="b6edb-167">This solution uses the default partner profiles that are automatically created when we created the partners.</span></span>  

1. <span data-ttu-id="b6edb-168">No Portal dos Serviços BizTalk, clique em **Contratos** > **Adicionar**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-168">In the BizTalk Services Portal, click **Agreements** > **Add**.</span></span>
2. <span data-ttu-id="b6edb-169">Na página **Configurações Gerais** do novo acordo, especifique os valores conforme mostrado na imagem abaixo e clique em **Continuar**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-169">In the new agreement’s **General Settings** page, specify the values as shown in the image below, and then click **Continue**.</span></span>
   
   ![][3]  
   
   <span data-ttu-id="b6edb-170">Depois de clicar em **Continuar**, duas guias, **Configurações de Recebimento** e **Configurações de Envio**, se tornarem disponíveis.</span><span class="sxs-lookup"><span data-stu-id="b6edb-170">After you click **Continue**, two tabs, **Receive Settings** and **Send Settings** become available.</span></span>
3. <span data-ttu-id="b6edb-171">Criar o contrato de envio entre a Contoso e a Northwind.</span><span class="sxs-lookup"><span data-stu-id="b6edb-171">Create the send agreement between Contoso and Northwind.</span></span> <span data-ttu-id="b6edb-172">Este contrato determina como a Contoso envia a fatura EDIFACT para a Northwind.</span><span class="sxs-lookup"><span data-stu-id="b6edb-172">This agreement governs how Contoso sends the EDIFACT invoice to Northwind.</span></span>
   
   1. <span data-ttu-id="b6edb-173">Clique em **Configurações de Envio**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-173">Click **Send Settings**.</span></span>
   2. <span data-ttu-id="b6edb-174">Mantenha os valores padrão nas guias **URL de entrada**, **Transformar** e **Em lote**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-174">Retain the default values on the **Inbound URL**, **Transform**, and **Batching** tabs.</span></span>
   3. <span data-ttu-id="b6edb-175">Na guia **Protocolo**, na seção **Esquemas**, carregue o esquema **EFACT_D93A_INVOIC.xsd**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-175">On the **Protocol** tab, under the **Schemas** section, upload the **EFACT_D93A_INVOIC.xsd** schema.</span></span> <span data-ttu-id="b6edb-176">Esse esquema está disponível com o pacote de exemplo.</span><span class="sxs-lookup"><span data-stu-id="b6edb-176">This schema is available with the sample package.</span></span>
      
      ![][4]  
   4. <span data-ttu-id="b6edb-177">Na guia **Transporte** , especifique os detalhes das filas do Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="b6edb-177">On the **Transport** tab, specify the details for the Service Bus queues.</span></span> <span data-ttu-id="b6edb-178">Para o contrato do lado de envio, usamos a fila **northwindreceive** para enviar a fatura EDIFACT à Northwind e a fila **suspended** para rotear todas as mensagens que falham durante o processamento e são suspensas.</span><span class="sxs-lookup"><span data-stu-id="b6edb-178">For the send-side agreement, we use the **northwindreceive** queue to send the EDIFACT invoice to Northwind, and the **suspended** queue to route any messages that fail during processing and are suspended.</span></span> <span data-ttu-id="b6edb-179">Você criou essas filas na **Etapa 1: criar as filas do Barramento de Serviço** (neste tópico).</span><span class="sxs-lookup"><span data-stu-id="b6edb-179">You created these queues in **Step 1: Create the Service Bus queues** (in this topic).</span></span>
      
      ![][5]  
      
      <span data-ttu-id="b6edb-180">Em **Configurações de Transporte > Tipo de transporte** e **Configurações de Suspensão de Mensagem > Tipo de transporte**, selecione o Barramento de Serviço do Azure e forneça os valores conforme mostrado na imagem.</span><span class="sxs-lookup"><span data-stu-id="b6edb-180">Under **Transport Settings > Transport type** and **Message Suspension Settings > Transport type**, select Azure Service Bus and provide the values as shown in the image.</span></span>
4. <span data-ttu-id="b6edb-181">Criar o contrato de recebimento entre a Contoso e a Northwind.</span><span class="sxs-lookup"><span data-stu-id="b6edb-181">Create the receive agreement between Contoso and Northwind.</span></span> <span data-ttu-id="b6edb-182">Esse contrato determina como a Contoso recebe a confirmação da Northwind.</span><span class="sxs-lookup"><span data-stu-id="b6edb-182">This agreement governs how Contoso receives the acknowledgement from Northwind.</span></span>
   
   1. <span data-ttu-id="b6edb-183">Clique em **Configurações de Recebimento**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-183">Click **Receive Settings**.</span></span>
   2. <span data-ttu-id="b6edb-184">Mantenha os valores padrão nas guias **Transporte** e **Transformar**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-184">Retain the default values on the **Transport** and **Transform** tabs.</span></span>
   3. <span data-ttu-id="b6edb-185">Na guia **Protocolo**, na seção **Esquemas**, carregue o esquema **EFACT_4.1_CONTRL.xsd**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-185">On the **Protocol** tab, under the **Schemas** section, upload the **EFACT_4.1_CONTRL.xsd** schema.</span></span> <span data-ttu-id="b6edb-186">Esse esquema está disponível com o pacote de exemplo.</span><span class="sxs-lookup"><span data-stu-id="b6edb-186">This schema is available with the sample package.</span></span>
   4. <span data-ttu-id="b6edb-187">Na guia **Roteamento** , crie um filtro para garantir que somente as confirmações da Northwind são roteadas para a Contoso.</span><span class="sxs-lookup"><span data-stu-id="b6edb-187">On the **Route** tab, create a filter to ensure that only acknowledgements from Northwind are routed to Contoso.</span></span> <span data-ttu-id="b6edb-188">Em **Configurações de Roteamento**, clique em **Adicionar** para criar o filtro de roteamento.</span><span class="sxs-lookup"><span data-stu-id="b6edb-188">Under **Route Settings**, click **Add** to create the routing filter.</span></span>
      
      ![][6]  
      
      1. <span data-ttu-id="b6edb-189">Forneça os valores de **Nome da Regra**, **Regra da rota**, e **Destino da rota** conforme mostrado na imagem.</span><span class="sxs-lookup"><span data-stu-id="b6edb-189">Provide values for **Rule Name**, **Route rule**, and **Route destination** as shown in the image.</span></span>
      2. <span data-ttu-id="b6edb-190">Clique em **Salvar**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-190">Click **Save**.</span></span>
   5. <span data-ttu-id="b6edb-191">Novamente na guia **Roteamento** , especifique para onde as confirmações suspensas (confirmações que apresentaram falha durante o processamento) serão roteadas.</span><span class="sxs-lookup"><span data-stu-id="b6edb-191">On the **Route** tab again, specify where suspended acknowledgements (acknowledgements that fail during processing) are routed to.</span></span> <span data-ttu-id="b6edb-192">Defina o tipo de transporte para o Barramento de Serviço do Azure, faça o roteamento do tipo de destino para **Fila**, do tipo de autenticação para **Assinatura de Acesso Compartilhado** (SAS), forneça a cadeia de conexão SAS para o namespace do Barramento de Serviço e insira o nome da fila como **suspended**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-192">Set the transport type to Azure Service Bus, route destination type to **Queue**, authentication type to **Shared Access Signature** (SAS), provide the SAS connection string for the Service Bus namespace, and then enter the queue name as **suspended**.</span></span>
5. <span data-ttu-id="b6edb-193">Por fim, clique em **Implantar** para implantar o contrato.</span><span class="sxs-lookup"><span data-stu-id="b6edb-193">Finally, click **Deploy** to deploy the agreement.</span></span> <span data-ttu-id="b6edb-194">Observe os pontos de extremidade onde os contratos de envio e de recebimento foram implantados.</span><span class="sxs-lookup"><span data-stu-id="b6edb-194">Note the endpoints where the send and receive agreements get deployed.</span></span>
   
   * <span data-ttu-id="b6edb-195">Na guia **Configurações de Envio**, em **URL de entrada**, observe o ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="b6edb-195">On the **Send Settings** tab, under **Inbound URL**, note the endpoint.</span></span> <span data-ttu-id="b6edb-196">Para enviar uma mensagem da Contoso para a Northwind usando a ponte de envio EDI, você deve enviar uma mensagem para esse ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="b6edb-196">To send a message from Contoso to Northwind using the EDI send bridge, you must send a message to this endpoint.</span></span>
   * <span data-ttu-id="b6edb-197">Na guia **Configurações de Recebimento**, em **Transporte**, observe o ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="b6edb-197">On the **Receive Settings** tab, under **Transport**, note the endpoint.</span></span> <span data-ttu-id="b6edb-198">Para enviar uma mensagem da Northwind para a Contoso usando a ponte de recebimento EDI, você deve enviar uma mensagem para esse ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="b6edb-198">To send a message from Northwind to Contoso using the EDI receive bridge, you must send a message to this endpoint.</span></span>  

## <a name="step-3-create-and-deploy-the-biztalk-services-project"></a><span data-ttu-id="b6edb-199">Etapa 3: Criar e implantar o projeto dos Serviços BizTalk</span><span class="sxs-lookup"><span data-stu-id="b6edb-199">Step 3: Create and deploy the BizTalk Services project</span></span>
<span data-ttu-id="b6edb-200">Na etapa anterior, você implantou os contratos de envio e recebimento EDI para processar confirmações e faturas EDIFACT.</span><span class="sxs-lookup"><span data-stu-id="b6edb-200">In the previous step, you deployed the EDI send and receive agreements to process EDIFACT invoices and acknowledgements.</span></span> <span data-ttu-id="b6edb-201">Esses contratos podem processar apenas mensagens que estão em conformidade com o esquema de mensagem EDIFACT padrão.</span><span class="sxs-lookup"><span data-stu-id="b6edb-201">These agreements can only process messages that conform to the standard EDIFACT message schema.</span></span> <span data-ttu-id="b6edb-202">No entanto, de acordo com o cenário para essa solução, a Contoso envia uma fatura para a Northwind em um esquema de propriedade interna.</span><span class="sxs-lookup"><span data-stu-id="b6edb-202">However, per the scenario for this solution, Contoso sends an invoice to Northwind in an in-house proprietary schema.</span></span> <span data-ttu-id="b6edb-203">Portanto, antes da mensagem ser enviada para a ponte de envio EDI, ela deve ser transformada do esquema interno para o esquema de fatura EDIFACT padrão.</span><span class="sxs-lookup"><span data-stu-id="b6edb-203">So, before the message is sent to the EDI send bridge, it must be transformed from the in-house schema to the standard EDIFACT invoice schema.</span></span> <span data-ttu-id="b6edb-204">O projeto EAI dos Serviços BizTalk faz isso.</span><span class="sxs-lookup"><span data-stu-id="b6edb-204">The BizTalk Services EAI project does that.</span></span>

<span data-ttu-id="b6edb-205">O projeto dos Serviços BizTalk, **InvoiceProcessingBridge**, que transforma a mensagem também está incluído no exemplo que você baixou.</span><span class="sxs-lookup"><span data-stu-id="b6edb-205">The BizTalk Services project, **InvoiceProcessingBridge**, that transforms the message is also included as part of the sample you downloaded.</span></span> <span data-ttu-id="b6edb-206">O projeto inclui os seguintes artefatos:</span><span class="sxs-lookup"><span data-stu-id="b6edb-206">The project includes the following artifacts:</span></span>

* <span data-ttu-id="b6edb-207">**INHOUSEINVOICE. XSD** – Esquema da fatura interna que é enviada para a Northwind.</span><span class="sxs-lookup"><span data-stu-id="b6edb-207">**INHOUSEINVOICE.XSD** – Schema of the in-house invoice that is sent to Northwind.</span></span>
* <span data-ttu-id="b6edb-208">**EFACT_D93A_INVOIC. XSD** – Esquema da fatura EDIFACT padrão.</span><span class="sxs-lookup"><span data-stu-id="b6edb-208">**EFACT_D93A_INVOIC.XSD** – Schema of the standard EDIFACT invoice.</span></span>
* <span data-ttu-id="b6edb-209">**EFACT_4.1_CONTRL. XSD** – Esquema da confirmação EDIFACT que Northwind envia para a Contoso.</span><span class="sxs-lookup"><span data-stu-id="b6edb-209">**EFACT_4.1_CONTRL.XSD** – Schema of the EDIFACT acknowledgement that Northwind sends to Contoso.</span></span>
* <span data-ttu-id="b6edb-210">**INHOUSEINVOICE_to_D93AINVOIC. TRFM** – A transformação que mapeia o esquema de fatura interna para o esquema de fatura EDIFACT padrão.</span><span class="sxs-lookup"><span data-stu-id="b6edb-210">**INHOUSEINVOICE_to_D93AINVOIC.TRFM** – The transform that maps the in-house invoice schema to the standard EDIFACT invoice schema.</span></span>  

### <a name="create-the-biztalk-services-project"></a><span data-ttu-id="b6edb-211">Criar o projeto dos Serviços BizTalk</span><span class="sxs-lookup"><span data-stu-id="b6edb-211">Create the BizTalk Services project</span></span>
1. <span data-ttu-id="b6edb-212">Na solução do Visual Studio, expanda o projeto InvoiceProcessingBridge e abra o arquivo **Messageflowitinerary** .</span><span class="sxs-lookup"><span data-stu-id="b6edb-212">In the Visual Studio solution, expand the InvoiceProcessingBridge project, and then open the **MessageFlowItinerary.bcs** file.</span></span>
2. <span data-ttu-id="b6edb-213">Clique em qualquer lugar na tela e defina a **URL do Serviço BizTalk** na caixa de propriedade para especificar o nome da sua assinatura dos Serviços BizTalk.</span><span class="sxs-lookup"><span data-stu-id="b6edb-213">Click anywhere on the canvas and set the **BizTalk Service URL** in the property box to specify your BizTalk Services subscription name.</span></span> <span data-ttu-id="b6edb-214">Por exemplo: `https://contosowabs.biztalk.windows.net`.</span><span class="sxs-lookup"><span data-stu-id="b6edb-214">For example, `https://contosowabs.biztalk.windows.net`.</span></span>
   
   ![][7]  
3. <span data-ttu-id="b6edb-215">Na caixa de ferramentas, arraste uma **Ponte unidirecional de Xml** para a tela.</span><span class="sxs-lookup"><span data-stu-id="b6edb-215">From the toolbox, drag an **Xml One-Way Bridge** to the canvas.</span></span> <span data-ttu-id="b6edb-216">Defina as propriedades **Entity Name** e **Relative Address** da ponte para **ProcessInvoiceBridge**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-216">Set the **Entity Name** and **Relative Address** properties of the bridge to **ProcessInvoiceBridge**.</span></span> <span data-ttu-id="b6edb-217">Clique duas vezes em **ProcessInvoiceBridge** para abrir a superfície de configuração da ponte.</span><span class="sxs-lookup"><span data-stu-id="b6edb-217">Double-click **ProcessInvoiceBridge** to open the bridge configuration surface.</span></span>
4. <span data-ttu-id="b6edb-218">Na caixa **Tipos de Mensagem**, clique no sinal de adição (**+**) para especificar o esquema da mensagem de entrada.</span><span class="sxs-lookup"><span data-stu-id="b6edb-218">Within the **Message Types** box, click the plus (**+**) button to specify the schema of the incoming message.</span></span> <span data-ttu-id="b6edb-219">Como a mensagem de entrada para a ponte EAI é sempre a fatura interna, defina-a como **INHOUSEINVOICE**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-219">Because the incoming message for the EAI bridge is always the in-house invoice, set this to **INHOUSEINVOICE**.</span></span>
   
   ![][8]  
5. <span data-ttu-id="b6edb-220">Clique na forma **Transformação Cml** e na caixa de propriedade; para a propriedade **Maps**, clique no botão de reticências (**...**).</span><span class="sxs-lookup"><span data-stu-id="b6edb-220">Click the **Xml Transform** shape, and in the property box, for the **Maps** property, click the ellipsis (**...**) button.</span></span> <span data-ttu-id="b6edb-221">Na caixa de diálogo **Seleção de Mapas**, selecione o arquivo de transformação **INHOUSEINVOICE_to_D93AINVOIC** e clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-221">In the **Maps Selection** dialog box, select the **INHOUSEINVOICE_to_D93AINVOIC** transform file, and then click **OK**.</span></span>
   
   ![][9]  
6. <span data-ttu-id="b6edb-222">Volte para **MessageFlowItinerary.bcs** e, na caixa de ferramentas, arraste um **Ponto de extremidade de serviço externo bidirecional** à direita do **ProcessInvoiceBridge**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-222">Go back to **MessageFlowItinerary.bcs**, and from the toolbox, drag a **Two-Way External Service Endpoint** to the right of the **ProcessInvoiceBridge**.</span></span> <span data-ttu-id="b6edb-223">Defina a propriedade **Entity Name** como **EDIBridge**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-223">Set its **Entity Name** property to **EDIBridge**.</span></span>
7. <span data-ttu-id="b6edb-224">No Gerenciador de Soluções, expanda o **MessageFlowItinerary.bcs** e clique duas vezes no arquivo **EDIBridge.config**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-224">In the Solution Explorer, expand the **MessageFlowItinerary.bcs** and double-click the **EDIBridge.config** file.</span></span> <span data-ttu-id="b6edb-225">Substitua o conteúdo de **EDIBridge.config** com o seguinte:</span><span class="sxs-lookup"><span data-stu-id="b6edb-225">Replace the content of the **EDIBridge.config** with the following.</span></span>
   
   > [!NOTE]
   > <span data-ttu-id="b6edb-226">Por que preciso editar o arquivo .config?</span><span class="sxs-lookup"><span data-stu-id="b6edb-226">Why do I need to edit the .config file?</span></span> <span data-ttu-id="b6edb-227">O ponto de extremidade de serviço externo que adicionamos à tela do designer de ponte representa as pontes EDI que foram implantadas anteriormente.</span><span class="sxs-lookup"><span data-stu-id="b6edb-227">The external service endpoint that we added to the bridge designer canvas represents the EDI bridges that we deployed earlier.</span></span> <span data-ttu-id="b6edb-228">As pontes EDI são bidirecionais, com lado de envio e de recebimento.</span><span class="sxs-lookup"><span data-stu-id="b6edb-228">EDI bridges are two-way bridges, with a send and receive side.</span></span> <span data-ttu-id="b6edb-229">No entanto, a ponte EAI que adicionamos ao designer de ponte é uma ponte unidirecional.</span><span class="sxs-lookup"><span data-stu-id="b6edb-229">However, the EAI bridge that we added to the bridge designer is a one-way bridge.</span></span> <span data-ttu-id="b6edb-230">Portanto, para lidar com os padrões de troca de mensagem diferentes das duas pontes, usamos um comportamento de ponte personalizado, incluindo sua configuração no arquivo.config.</span><span class="sxs-lookup"><span data-stu-id="b6edb-230">So, to handle the different message exchange patterns of the two bridges, we use a custom bridge behavior by including its configuration in the .config file.</span></span> <span data-ttu-id="b6edb-231">Além disso, o comportamento personalizado também lida com a autenticação para o ponto de extremidade de ponte de envio EDI. Esse comportamento personalizado está disponível como um exemplo separado em [Exemplo de encadeamento de ponte dos Serviços BizTalk – EAI para EDI](http://code.msdn.microsoft.com/BizTalk-Bridge-chaining-2246b104).</span><span class="sxs-lookup"><span data-stu-id="b6edb-231">Additionally, the custom behavior also handles the authentication to the EDI send bridge endpoint.This custom behavior is available as a separate sample at [BizTalk Services Bridge chaining sample - EAI to EDI](http://code.msdn.microsoft.com/BizTalk-Bridge-chaining-2246b104).</span></span> <span data-ttu-id="b6edb-232">Essa solução reutiliza o exemplo.</span><span class="sxs-lookup"><span data-stu-id="b6edb-232">This solution reuses the sample.</span></span>  
   > 
   > 
   
   ```
   <?xml version="1.0" encoding="utf-8"?>
   <configuration>
     <system.serviceModel>
       <extensions>
         <behaviorExtensions>
           <add name="BridgeAuthentication" 
                 type="Microsoft.BizTalk.Bridge.Behaviour.BridgeBehaviorElement, Microsoft.BizTalk.Bridge.Behaviour, Version=1.0.0.0, Culture=neutral, PublicKeyToken=ae58f69b69495c05" />
         </behaviorExtensions>
       </extensions>
       <behaviors>
         <endpointBehaviors>
           <behavior name="BridgeAuthenticationConfiguration">
             <!-- Enter the ACS namespace, issuer name and issuer secret of the BizTalk Services deployment -->
             <BridgeAuthentication acsnamespace="[YOUR ACS NAMESPACE]" 
                                   issuername="owner" 
                                   issuersecret="[YOUR ACS SECRET]" />
             <webHttp />
           </behavior>
         </endpointBehaviors>
       </behaviors>
       <bindings>
         <webHttpBinding>
           <binding name="BridgeBindingConfiguration">
             <security mode="Transport" />
           </binding>
         </webHttpBinding>
       </bindings>
       <client>
         <clear />
         <!--
           Go BizTalk Portal > Agreement > Send Settings > Inbound URL
           Copy the Endpoint URL and paste it in the below address field
         -->
         <endpoint name="TwoWayExternalServiceEndpointReference1" 
                   address="[YOUR EDI BRIDGE SEND URI]" 
                   behaviorConfiguration="BridgeAuthenticationConfiguration" 
                   binding="webHttpBinding" 
                   bindingConfiguration="BridgeBindingConfiguration" 
                   contract="System.ServiceModel.Routing.IRequestReplyRouter" />
       </client>
     </system.serviceModel>
   </configuration>
   
   ```
8. <span data-ttu-id="b6edb-233">Atualize o arquivo EDIBridge.config para incluir detalhes de configuração</span><span class="sxs-lookup"><span data-stu-id="b6edb-233">Update the EDIBridge.config file to include configuration details</span></span>
   
   * <span data-ttu-id="b6edb-234">Em *<behaviors>*, forneça o namespace do ACS e a chave associada à assinatura dos Serviços BizTalk.</span><span class="sxs-lookup"><span data-stu-id="b6edb-234">Under *<behaviors>*, provide the ACS namespace and key associated with the BizTalk Services subscription.</span></span>
   * <span data-ttu-id="b6edb-235">Em *<client>*, forneça o ponto de extremidade no qual o contrato de envio EDI está implantado.</span><span class="sxs-lookup"><span data-stu-id="b6edb-235">Under *<client>*, provide the endpoint where the EDI send agreement is deployed.</span></span>
   
   <span data-ttu-id="b6edb-236">Salve as alterações e feche o arquivo de configuração.</span><span class="sxs-lookup"><span data-stu-id="b6edb-236">Save changes and close the configuration file.</span></span>
9. <span data-ttu-id="b6edb-237">Na Caixa de Ferramentas, clique no **Conector** e adicione os componentes **ProcessInvoiceBridge** e **EDIBridge**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-237">From the Toolbox, click the **Connector** and join the **ProcessInvoiceBridge** and **EDIBridge** components.</span></span> <span data-ttu-id="b6edb-238">Selecione o conector e, na caixa Propriedades, defina **Condição de Filtro** como **Corresponder Tudo**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-238">Select the connector, and in Properties box, set **Filter Condition** to **Match All**.</span></span> <span data-ttu-id="b6edb-239">Isso garante que todas as mensagens processadas pela ponte EAI sejam roteadas para a ponte EDI.</span><span class="sxs-lookup"><span data-stu-id="b6edb-239">This ensures that all messages processed by the EAI bridge are routed to the EDI bridge.</span></span>
   
   ![][10]  
10. <span data-ttu-id="b6edb-240">Salve as alterações na solução.</span><span class="sxs-lookup"><span data-stu-id="b6edb-240">Save changes to the solution.</span></span>  

### <a name="deploy-the-project"></a><span data-ttu-id="b6edb-241">Implantar o projeto</span><span class="sxs-lookup"><span data-stu-id="b6edb-241">Deploy the project</span></span>
1. <span data-ttu-id="b6edb-242">No computador onde você criou o projeto dos Serviços BizTalk, baixe e instale o certificado SSL para sua assinatura dos Serviços BizTalk.</span><span class="sxs-lookup"><span data-stu-id="b6edb-242">On the computer where you created the BizTalk Services project, download and install the SSL certificate for your BizTalk Services subscription.</span></span> <span data-ttu-id="b6edb-243">Em Serviços BizTalk, clique em **Painel** e em **Baixar Certificado SSL**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-243">From , under BizTalk Services, click **Dashboard**, and then click **Download SSL Certificate**.</span></span> <span data-ttu-id="b6edb-244">Clique duas vezes no certificado e siga os prompts para concluir a instalação.</span><span class="sxs-lookup"><span data-stu-id="b6edb-244">Double-click the certificate and follow the prompt to complete the installation.</span></span> <span data-ttu-id="b6edb-245">Não deixe de instalar o certificado no repositório de certificados **Autoridades confiáveis de certificação de raiz** .</span><span class="sxs-lookup"><span data-stu-id="b6edb-245">Make sure you install the certificate under **Trusted Root Certification Authorities** certificate store.</span></span>
2. <span data-ttu-id="b6edb-246">No Gerenciador de Soluções do Visual Studio, clique com o botão direito do mouse no projeto **InvoiceProcessingBridge** e em **Implantar**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-246">In Visual Studio Solution Explorer, right-click the **InvoiceProcessingBridge** project, and then click **Deploy**.</span></span>
3. <span data-ttu-id="b6edb-247">Forneça os valores conforme mostrado na imagem e clique em **Implantar**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-247">Provide the values as shown in the image, and then click **Deploy**.</span></span> <span data-ttu-id="b6edb-248">É possível obter as credenciais do ACS para os Serviços BizTalk clicando em **Informações de Conexão** no painel dos Serviços BizTalk.</span><span class="sxs-lookup"><span data-stu-id="b6edb-248">You can get the ACS credentials for BizTalk Services by clicking **Connection Information** from the BizTalk Services dashboard.</span></span>
   
   ![][11]  
   
   <span data-ttu-id="b6edb-249">No painel de saída, copie o ponto de extremidade onde a ponte EAI foi implantada, por exemplo, `https://contosowabs.biztalk.windows.net/default/ProcessInvoiceBridge`.</span><span class="sxs-lookup"><span data-stu-id="b6edb-249">From the output pane, copy the endpoint where the EAI bridge is deployed, for example, `https://contosowabs.biztalk.windows.net/default/ProcessInvoiceBridge`.</span></span> <span data-ttu-id="b6edb-250">Você precisará dessa URL de ponto de extremidade mais tarde.</span><span class="sxs-lookup"><span data-stu-id="b6edb-250">You will need this endpoint URL later.</span></span>  

## <a name="step-4-test-the-solution"></a><span data-ttu-id="b6edb-251">Etapa 4: Testar a solução</span><span class="sxs-lookup"><span data-stu-id="b6edb-251">Step 4: Test the solution</span></span>
<span data-ttu-id="b6edb-252">Neste tópico, veremos como testar a solução usando o aplicativo **Cliente de Tutorial** fornecido como parte do exemplo.</span><span class="sxs-lookup"><span data-stu-id="b6edb-252">In this topic, we look at how to test the solution by using the **Tutorial Client** application provided as part of the sample.</span></span>  

1. <span data-ttu-id="b6edb-253">No Visual Studio, pressione F5 para iniciar o **Cliente de Tutorial**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-253">In Visual Studio, press F5 to start the **Tutorial Client**.</span></span>
2. <span data-ttu-id="b6edb-254">A tela deverá ter valores pré-populados da etapa de criação de filas do Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="b6edb-254">The screen must have the values prepopulated from the step where we created the Service Bus queues.</span></span> <span data-ttu-id="b6edb-255">Clique em **Avançar**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-255">Click **Next**.</span></span>
3. <span data-ttu-id="b6edb-256">Na próxima janela, forneça as credenciais de ACS para a assinatura dos Serviços BizTalk e os pontos de extremidade onde as pontes EAI e EDI (recebimento) foram implantadas.</span><span class="sxs-lookup"><span data-stu-id="b6edb-256">In the next window, provide ACS credentials for BizTalk Services subscription, and the endpoints where EAI and EDI (receive) bridges are deployed.</span></span>
   
   <span data-ttu-id="b6edb-257">O ponto de extremidade de ponte EAI foi copiado na etapa anterior.</span><span class="sxs-lookup"><span data-stu-id="b6edb-257">You had copied the EAI bridge endpoint in the previous step.</span></span> <span data-ttu-id="b6edb-258">Para o ponto de extremidade da ponte de recebimento EDI, no Portal dos Serviços BizTalk, acesse o contrato > Configurações de Recebimento > Transporte > Ponto de Extremidade.</span><span class="sxs-lookup"><span data-stu-id="b6edb-258">For EDI receive bridge endpoint, in the BizTalk Services Portal, go to the agreement > Receive Settings > Transport > Endpoint.</span></span>
   
   ![][12]  
4. <span data-ttu-id="b6edb-259">Na próxima janela, em Contoso, clique no botão **Enviar Fatura Interna** .</span><span class="sxs-lookup"><span data-stu-id="b6edb-259">In the next window, under Contoso, click the **Send In-house Invoice** button.</span></span> <span data-ttu-id="b6edb-260">Na caixa de diálogo Abrir arquivo, abra o arquivo INHOUSEINVOICE.txt.</span><span class="sxs-lookup"><span data-stu-id="b6edb-260">In the File open dialog box, open the INHOUSEINVOICE.txt file.</span></span> <span data-ttu-id="b6edb-261">Examine o conteúdo do arquivo e clique em **OK** para enviar a fatura.</span><span class="sxs-lookup"><span data-stu-id="b6edb-261">Examine the content of the file and then click **OK** to send the invoice.</span></span>
   
   ![][13]  
5. <span data-ttu-id="b6edb-262">Em poucos segundos, a fatura é recebida pela Northwind.</span><span class="sxs-lookup"><span data-stu-id="b6edb-262">In a few seconds the invoice is received at Northwind.</span></span> <span data-ttu-id="b6edb-263">Clique no link **Exibir Mensagem** para ver a fatura recebida pela Northwind.</span><span class="sxs-lookup"><span data-stu-id="b6edb-263">Click the **View Message** link to see the invoice received by Northwind.</span></span> <span data-ttu-id="b6edb-264">Observe como a fatura recebida pela Northwind está no esquema padrão EDIFACT enquanto aquela enviada pela Contoso estava no esquema interno.</span><span class="sxs-lookup"><span data-stu-id="b6edb-264">Notice how the invoice received by Northwind is in standard EDIFACT schema while the one sent by Contoso was an in-house schema.</span></span>
   
   ![][14]  
6. <span data-ttu-id="b6edb-265">Selecione a fatura e clique em **Enviar Confirmação**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-265">Select the invoice and then click **Send Acknowledgement**.</span></span> <span data-ttu-id="b6edb-266">Na caixa de diálogo exibida, observe que o ID da troca é igual ao da fatura recebida e da confirmação enviada.</span><span class="sxs-lookup"><span data-stu-id="b6edb-266">In the dialog box that pops up, notice that the interchange ID is same in the received invoice and the acknowledgement being sent.</span></span> <span data-ttu-id="b6edb-267">Clique em OK na caixa de diálogo **Enviar Confirmação** .</span><span class="sxs-lookup"><span data-stu-id="b6edb-267">Click OK in the **Send Acknowledgement** dialog box.</span></span>
   
   ![][15]  
7. <span data-ttu-id="b6edb-268">Em poucos segundos, a fatura será recebida pela Contoso.</span><span class="sxs-lookup"><span data-stu-id="b6edb-268">In a few seconds, the acknowledgement is successfully received at Contoso.</span></span>
   
   ![][16]  

## <a name="step-5-optional-send-edifact-invoice-in-batches"></a><span data-ttu-id="b6edb-269">Etapa 5 (opcional): Enviar fatura EDIFACT em lotes</span><span class="sxs-lookup"><span data-stu-id="b6edb-269">Step 5 (optional): Send EDIFACT invoice in batches</span></span>
<span data-ttu-id="b6edb-270">As pontes EDI dos Serviços BizTalk também dão suporte ao processamento em lotes de mensagens de saída.</span><span class="sxs-lookup"><span data-stu-id="b6edb-270">BizTalk Services EDI bridges also supports batching of outgoing messages.</span></span> <span data-ttu-id="b6edb-271">Esse recurso é útil para parceiros receptores que preferem receber um lote de mensagens (atendendo a um determinado critério) em vez de mensagens individuais.</span><span class="sxs-lookup"><span data-stu-id="b6edb-271">This feature is useful for receiving partners that prefer to receive a batch of messages (meeting certain criterion) instead of individual messages.</span></span>

<span data-ttu-id="b6edb-272">O aspecto mais importante ao trabalhar em lotes é a versão real do lote, também chamada de critério de liberação.</span><span class="sxs-lookup"><span data-stu-id="b6edb-272">The most important aspect when working with batches is the actual release of the batch, also called the release criteria.</span></span> <span data-ttu-id="b6edb-273">Os critérios de liberação podem basear-se em como o parceiro receptor deseja receber mensagens.</span><span class="sxs-lookup"><span data-stu-id="b6edb-273">The release criteria can be based on how the receiving partner wants to receive messages.</span></span> <span data-ttu-id="b6edb-274">Se o envio em lote estiver habilitado, a ponte EDI não enviará a mensagem de saída para o parceiro receptor até que os critérios de liberação sejam atendidos.</span><span class="sxs-lookup"><span data-stu-id="b6edb-274">If batching is enabled, the EDI bridge does not send the outgoing message to the receiving partner until the release criteria is fulfilled.</span></span> <span data-ttu-id="b6edb-275">Por exemplo, um critério de lote baseado no tamanho da mensagem liberará um lote somente quando ' n' mensagens estiverem agrupadas.</span><span class="sxs-lookup"><span data-stu-id="b6edb-275">For example, a batching criteria based on message size dispatches a batch only when ‘n’ messages are batched.</span></span> <span data-ttu-id="b6edb-276">Um critério de lote também pode ser um baseado em tempo, para que um lote seja enviado em uma hora fixa todo dia.</span><span class="sxs-lookup"><span data-stu-id="b6edb-276">A batch criteria can also be time-based, such that a batch is sent at a fixed time every day.</span></span> <span data-ttu-id="b6edb-277">Nesta solução, experimentamos os critérios de acordo com o tamanho da mensagem.</span><span class="sxs-lookup"><span data-stu-id="b6edb-277">In this solution, we try the message-size based criteria.</span></span>

1. <span data-ttu-id="b6edb-278">No Portal dos Serviços BizTalk, clique no contrato que você criou anteriormente.</span><span class="sxs-lookup"><span data-stu-id="b6edb-278">In the BizTalk Services Portal, click the agreement you created earlier.</span></span> <span data-ttu-id="b6edb-279">Clique em Configurações de Envio > Em lote > Adicionar Lotes.</span><span class="sxs-lookup"><span data-stu-id="b6edb-279">Click Send Settings > Batching > Add Batch.</span></span>
2. <span data-ttu-id="b6edb-280">Para o nome do lote, digite **InvoiceBatch**, forneça uma descrição e clique em **Avançar**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-280">For batch name, enter **InvoiceBatch**, provide a description, and then click **Next**.</span></span>
3. <span data-ttu-id="b6edb-281">Especifique os critérios de lote, que definem quais mensagens devem ser agrupadas.</span><span class="sxs-lookup"><span data-stu-id="b6edb-281">Specify a batch criteria, that defines which messages must be batched.</span></span> <span data-ttu-id="b6edb-282">Nesta solução, agrupamos todas as mensagens.</span><span class="sxs-lookup"><span data-stu-id="b6edb-282">In this solution, we batch all messages.</span></span> <span data-ttu-id="b6edb-283">Selecione a opção Usar definições avançadas e digite **1 = 1**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-283">So, select the Use advanced definitions option, and enter **1 = 1**.</span></span> <span data-ttu-id="b6edb-284">Essa é uma condição que será sempre verdadeira e, portanto, todas as mensagens serão agrupadas.</span><span class="sxs-lookup"><span data-stu-id="b6edb-284">This is a condition which will always be true, and hence all messages will be batched.</span></span> <span data-ttu-id="b6edb-285">Clique em **Avançar**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-285">Click **Next**.</span></span>
   
   ![][17]  
4. <span data-ttu-id="b6edb-286">Especifique um critério de liberação de lote.</span><span class="sxs-lookup"><span data-stu-id="b6edb-286">Specify a batch release criteria.</span></span> <span data-ttu-id="b6edb-287">Na caixa suspensa, selecione **MessageCountBased** e, para **Contagem**, especifique **3**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-287">From the drop-box, select **MessageCountBased**, and for **Count**, specify **3**.</span></span> <span data-ttu-id="b6edb-288">Isso significa que um lote de três mensagens será enviado para a Northwind.</span><span class="sxs-lookup"><span data-stu-id="b6edb-288">This means that a batch of three messages will be sent to Northwind.</span></span> <span data-ttu-id="b6edb-289">Clique em **Avançar**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-289">Click **Next**.</span></span>
   
   ![][18]  
5. <span data-ttu-id="b6edb-290">Examine o resumo e clique em **Salvar**.</span><span class="sxs-lookup"><span data-stu-id="b6edb-290">Review the summary and then click **Save**.</span></span> <span data-ttu-id="b6edb-291">Clique em **Implantar** para reimplantar o contrato.</span><span class="sxs-lookup"><span data-stu-id="b6edb-291">Click **Deploy** to redeploy the agreement.</span></span>
6. <span data-ttu-id="b6edb-292">Volte para o **Cliente de Tutorial**, clique em **Enviar Fatura Interna** e siga os prompts para enviar a fatura.</span><span class="sxs-lookup"><span data-stu-id="b6edb-292">Go back to the **Tutorial Client**, click **Send In-house Invoice**, and follow the prompts to send the invoice.</span></span> <span data-ttu-id="b6edb-293">Você observará que nenhuma fatura foi recebida na Northwind porque o tamanho do lote não foi atendido.</span><span class="sxs-lookup"><span data-stu-id="b6edb-293">You will notice that no invoice is received at Northwind because the batch size is not met.</span></span> <span data-ttu-id="b6edb-294">Repita essa etapa mais duas vezes, para que você tenha três mensagens de faturas enviadas para a Northwind.</span><span class="sxs-lookup"><span data-stu-id="b6edb-294">Repeat this step two more times, so that you have three invoice messages sent to Northwind.</span></span> <span data-ttu-id="b6edb-295">Isso satisfaz os critérios de liberação de lote de três mensagens e agora você deverá ver uma fatura na Northwind.</span><span class="sxs-lookup"><span data-stu-id="b6edb-295">This satisfies the batch release criteria of 3 messages and you should now see an invoice at Northwind.</span></span>

<!--Image references-->
[1]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-1.PNG  
[2]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-2.PNG  
[3]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-3.PNG
[4]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-4.PNG  
[5]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-5.PNG  
[6]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-6.PNG  
[7]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-7.PNG  
[8]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-8.PNG
[9]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-9.PNG  
[10]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-10.PNG  
[11]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-11.PNG  
[12]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-12.PNG  
[13]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-13.PNG
[14]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-14.PNG  
[15]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-15.PNG  
[16]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-16.PNG  
[17]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-17.PNG  
[18]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-18.PNG

