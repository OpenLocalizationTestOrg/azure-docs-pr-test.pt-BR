---
title: "Configuração de diagnóstico para os serviços de nuvem e máquinas virtuais do Azure | Microsoft Docs"
description: "Descreve como configurar informações de diagnóstico para depurar serviços de nuvem e máquinas virtuais (VMs) do Azure no Visual Studio."
services: visual-studio-online
documentationcenter: na
author: kraigb
manager: ghogen
editor: 
ms.assetid: e70cd7b4-6298-43aa-adea-6fd618414c26
ms.service: multiple
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: multiple
ms.date: 11/11/2016
ms.author: kraigb
ms.openlocfilehash: 2516c0eb8ce470577731db9b844d5b9038465477
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/29/2017
---
# <a name="configuring-diagnostics-for-azure-cloud-services-and-virtual-machines"></a><span data-ttu-id="6f018-103">Configurando o diagnóstico para os serviços de nuvem do Azure e máquinas virtuais</span><span class="sxs-lookup"><span data-stu-id="6f018-103">Configuring Diagnostics for Azure Cloud Services and Virtual Machines</span></span>
<span data-ttu-id="6f018-104">Quando você precisar solucionar problemas de um serviço de nuvem do Azure ou da máquina virtual do Azure, pode configurar o diagnóstico do Azure com mais facilidade usando o Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="6f018-104">When you need to troubleshoot an Azure cloud service or Azure virtual machine, you can configure Azure diagnostics more easily by using Visual Studio.</span></span> <span data-ttu-id="6f018-105">O diagnóstico do Azure captura dados do sistema e dados do log em máquinas virtuais e instâncias de máquinas virtuais que executam o serviço de nuvem e transfere os dados para uma conta de armazenamento de sua escolha.</span><span class="sxs-lookup"><span data-stu-id="6f018-105">Azure diagnostics captures system data and logging data on the virtual machines and virtual machine instances that run your cloud service and transfers that data into a storage account of your choice.</span></span> <span data-ttu-id="6f018-106">Consulte [Habilitar o registro em log de diagnóstico para aplicativos Web no Serviço de Aplicativo do Azure](app-service-web/web-sites-enable-diagnostic-log.md) para obter mais informações sobre o registro em log de diagnóstico no Azure.</span><span class="sxs-lookup"><span data-stu-id="6f018-106">See [Enable diagnostics logging for web apps in Azure App Service](app-service-web/web-sites-enable-diagnostic-log.md) for more information about diagnostics logging in Azure.</span></span>

<span data-ttu-id="6f018-107">Este tópico mostra como habilitar e configurar o diagnóstico do Azure no Visual Studio, antes e depois da implantação, bem como em máquinas virtuais do Azure.</span><span class="sxs-lookup"><span data-stu-id="6f018-107">This topic shows you how to enable and configure Azure diagnostics in Visual Studio, both before and after deployment, as well as in Azure virtual machines.</span></span> <span data-ttu-id="6f018-108">Ele também mostra como selecionar os tipos de informações de diagnóstico para coletar e exibir as informações depois que são coletadas.</span><span class="sxs-lookup"><span data-stu-id="6f018-108">It also shows you how to select the types of diagnostics information to collect and how to view the information after it's collected.</span></span>

<span data-ttu-id="6f018-109">Você pode configurar o Diagnóstico do Azure das seguintes maneiras:</span><span class="sxs-lookup"><span data-stu-id="6f018-109">You can configure Azure Diagnostics in the following ways:</span></span>

* <span data-ttu-id="6f018-110">Você pode alterar as definições de configuração de diagnóstico na caixa de diálogo **Configuração de diagnóstico** no Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="6f018-110">You can change diagnostics configuration settings through the **Diagnostics Configuration** dialog box in Visual Studio.</span></span> <span data-ttu-id="6f018-111">As configurações são salvas em um arquivo chamado diagnostics.wadcfgx (diagnostics.wadcfg no SDK do Azure 2.4 ou anterior).</span><span class="sxs-lookup"><span data-stu-id="6f018-111">The settings are saved in a file called diagnostics.wadcfgx (diagnostics.wadcfg in Azure SDK 2.4 or earlier).</span></span> <span data-ttu-id="6f018-112">Como alternativa, você pode modificar diretamente o arquivo de configuração.</span><span class="sxs-lookup"><span data-stu-id="6f018-112">Alternatively, you can directly modify the configuration file.</span></span> <span data-ttu-id="6f018-113">Se você atualizar manualmente o arquivo, as alterações de configuração entrarão em vigor na próxima vez que implantar o serviço de nuvem no Azure ou executar o serviço no emulador.</span><span class="sxs-lookup"><span data-stu-id="6f018-113">If you manually update the file, the configuration changes will take effect the next time you deploy the cloud service to Azure or run the service in the emulator.</span></span>
* <span data-ttu-id="6f018-114">Usar **Cloud Explorer** ou **Gerenciador de Servidores** no Visual Studio para alterar as configurações de diagnóstico para um serviço de nuvem ou máquina virtual em execução.</span><span class="sxs-lookup"><span data-stu-id="6f018-114">Use **Cloud Explorer** or **Server Explorer** in Visual Studio to change the diagnostics settings for a running cloud service or virtual machine.</span></span>

## <a name="azure-26-diagnostics-changes"></a><span data-ttu-id="6f018-115">Alterações de diagnóstico do Azure 2.6</span><span class="sxs-lookup"><span data-stu-id="6f018-115">Azure 2.6 diagnostics changes</span></span>
<span data-ttu-id="6f018-116">Para projetos do SDK do Azure 2.6 no Visual Studio, as seguintes alterações foram feitas.</span><span class="sxs-lookup"><span data-stu-id="6f018-116">For Azure SDK 2.6 projects in Visual Studio, the following changes were made.</span></span> <span data-ttu-id="6f018-117">(Essas alterações também se aplicam a versões mais recentes do SDK do Azure).</span><span class="sxs-lookup"><span data-stu-id="6f018-117">(These changes also apply to later versions of Azure SDK.)</span></span>

* <span data-ttu-id="6f018-118">O emulador local agora dá suporte a diagnósticos.</span><span class="sxs-lookup"><span data-stu-id="6f018-118">The local emulator now supports diagnostics.</span></span> <span data-ttu-id="6f018-119">Isso significa que você pode coletar dados de diagnóstico e garantir que seu aplicativo está criando os rastreamentos corretos enquanto está desenvolvendo e testando no Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="6f018-119">This means you can collect diagnostics data and ensure your application is creating the right traces while you're developing and testing in Visual Studio.</span></span> <span data-ttu-id="6f018-120">A cadeia de conexão `UseDevelopmentStorage=true` habilita a coleta de dados de diagnóstico durante a execução do seu projeto de serviço de nuvem no Visual Studio usando o emulador de armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="6f018-120">The connection string `UseDevelopmentStorage=true` enables diagnostics data collection while you're running your cloud service project in Visual Studio by using the Azure storage emulator.</span></span> <span data-ttu-id="6f018-121">Todos os dados de diagnóstico são coletados na conta de armazenamento (armazenamento de desenvolvimento).</span><span class="sxs-lookup"><span data-stu-id="6f018-121">All diagnostics data is collected in the (Development Storage) storage account.</span></span>
* <span data-ttu-id="6f018-122">A cadeia de conexão da conta de armazenamento de diagnóstico (Microsoft.WindowsAzure.Plugins.Diagnostics.ConnectionString) é armazenada novamente no arquivo de configuração de serviço (.cscfg).</span><span class="sxs-lookup"><span data-stu-id="6f018-122">The diagnostics storage account connection string (Microsoft.WindowsAzure.Plugins.Diagnostics.ConnectionString) is stored once again in the service configuration (.cscfg) file.</span></span> <span data-ttu-id="6f018-123">No SDK do Azure 2.5, a conta de armazenamento de diagnóstico foi especificada no arquivo diagnostics.wadcfgx.</span><span class="sxs-lookup"><span data-stu-id="6f018-123">In Azure SDK 2.5 the diagnostics storage account was specified in the diagnostics.wadcfgx file.</span></span>

<span data-ttu-id="6f018-124">Há algumas diferenças perceptíveis entre como a cadeia de conexão funcionava no SDK do Azure 2.4 e anteriores e como funciona no SDK do Azure 2.6 e posteriores.</span><span class="sxs-lookup"><span data-stu-id="6f018-124">There are some notable differences between how the connection string worked in Azure SDK 2.4 and earlier and how it works in Azure SDK 2.6 and later.</span></span>

* <span data-ttu-id="6f018-125">No SDK do Azure 2.4 e anteriores, a cadeia de conexão era usada como um tempo de execução pelo plug-in de diagnóstico para obter as informações de conta de armazenamento para transferir os logs de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="6f018-125">In Azure SDK 2.4 and earlier, the connection string was used as a runtime by the diagnostics plugin to get the storage account information for transferring diagnostics logs.</span></span>
* <span data-ttu-id="6f018-126">No SDK do Azure 2.6 e posteriores, a cadeia de conexão de diagnóstico é usada pelo Visual Studio para configurar a extensão de diagnóstico com as informações da conta de armazenamento apropriadas durante a publicação.</span><span class="sxs-lookup"><span data-stu-id="6f018-126">In Azure SDK 2.6 and later, the diagnostics connection string is used by Visual Studio to configure the diagnostics extension with the appropriate storage account information during publishing.</span></span> <span data-ttu-id="6f018-127">A cadeia de conexão permite definir contas de armazenamento diferentes para diferentes configurações de serviço que o Visual Studio usará ao publicar.</span><span class="sxs-lookup"><span data-stu-id="6f018-127">The connection string lets you define different storage accounts for different service configurations that Visual Studio will use when publishing.</span></span> <span data-ttu-id="6f018-128">No entanto, como o plug-in de diagnóstico não está mais disponível (após o SDK do Azure 2.5), o arquivo .cscfg sozinho por si só não é capaz de habilitar a extensão de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="6f018-128">However, because the diagnostics plugin is no longer available (after Azure SDK 2.5), the .cscfg file by itself can't enable the Diagnostics Extension.</span></span> <span data-ttu-id="6f018-129">Você precisa habilitar a extensão separadamente por meio de ferramentas como o Visual Studio ou o PowerShell.</span><span class="sxs-lookup"><span data-stu-id="6f018-129">You have to enable the extension separately through tools such as Visual Studio or PowerShell.</span></span>
* <span data-ttu-id="6f018-130">Para simplificar o processo de configuração da extensão de diagnóstico com o PowerShell, a saída do pacote do Visual Studio também contém o XML de configuração pública para a extensão de diagnóstico para cada função.</span><span class="sxs-lookup"><span data-stu-id="6f018-130">To simplify the process of configuring the diagnostics extension with PowerShell, the package output from Visual Studio also contains the public configuration XML for the diagnostics extension for each role.</span></span> <span data-ttu-id="6f018-131">O Visual Studio usa a cadeia de conexão de diagnóstico para preencher as informações da conta de armazenamento presentes na configuração pública.</span><span class="sxs-lookup"><span data-stu-id="6f018-131">Visual Studio uses the diagnostics connection string to populate the storage account information present in the public configuration.</span></span> <span data-ttu-id="6f018-132">Os arquivos de configuração pública são criados na pasta Extensões e seguem o padrão PaaSDiagnostics.&lt;RoleName>.PubConfig.xml.</span><span class="sxs-lookup"><span data-stu-id="6f018-132">The public config files are created in the Extensions folder and follow the pattern PaaSDiagnostics.&lt;RoleName>.PubConfig.xml.</span></span> <span data-ttu-id="6f018-133">Todas as implantações baseadas em PowerShell podem usar esse padrão para mapear cada configuração para uma função.</span><span class="sxs-lookup"><span data-stu-id="6f018-133">Any PowerShell based deployments can use this pattern to map each configuration to a Role.</span></span>
* <span data-ttu-id="6f018-134">A cadeia de conexão no arquivo .cscfg também é usada pelo [Portal do Azure](http://go.microsoft.com/fwlink/p/?LinkID=525040) para acessar os dados de diagnóstico para que possam aparecer na guia **Monitoramento** . A cadeia de conexão é necessária para configurar o serviço para mostrar dados do monitoramento detalhado no portal.</span><span class="sxs-lookup"><span data-stu-id="6f018-134">The connection string in the .cscfg file is also used by the [Azure portal](http://go.microsoft.com/fwlink/p/?LinkID=525040) to access the diagnostics data so it can appear in the **Monitoring** tab. The connection string is needed to configure the service to show verbose monitoring data in the portal.</span></span>

## <a name="migrating-projects-to-azure-sdk-26-and-later"></a><span data-ttu-id="6f018-135">Migrando projetos para o SDK do Azure 2.6 e posteriores</span><span class="sxs-lookup"><span data-stu-id="6f018-135">Migrating projects to Azure SDK 2.6 and later</span></span>
<span data-ttu-id="6f018-136">Ao migrar do SDK do Azure 2.5 para SDK do Azure 2.6 ou posteriores, se você tiver uma conta de armazenamento de diagnóstico especificada no arquivo de .wadcfgx, lá ela permanecerá.</span><span class="sxs-lookup"><span data-stu-id="6f018-136">When migrating from Azure SDK 2.5 to Azure SDK 2.6 or later, if you had a diagnostics storage account specified in the .wadcfgx file, then it will stay there.</span></span> <span data-ttu-id="6f018-137">Para aproveitar a flexibilidade de usar diferentes contas de armazenamento para diferentes configurações de armazenamento, você terá de adicionar manualmente a cadeia de conexão ao seu projeto.</span><span class="sxs-lookup"><span data-stu-id="6f018-137">To take advantage of the flexibility of using different storage accounts for different storage configurations, you'll have to manually add the connection string to your project.</span></span> <span data-ttu-id="6f018-138">Se estiver migrando um projeto do SDK 2.4 ou anterior do Azure para o SDK 2.6 do Azure, as cadeias de conexão de diagnóstico serão preservadas.</span><span class="sxs-lookup"><span data-stu-id="6f018-138">If you're migrating a project from Azure SDK 2.4 or earlier to Azure SDK 2.6, then the diagnostics connection strings are preserved.</span></span> <span data-ttu-id="6f018-139">No entanto, observe as alterações na forma como as cadeias de conexão são tratadas no SDK do Azure 2.6 conforme especificado na seção anterior.</span><span class="sxs-lookup"><span data-stu-id="6f018-139">However, please note the changes in how connection strings are treated in Azure SDK 2.6 as specified in the previous section.</span></span>

### <a name="how-visual-studio-determines-the-diagnostics-storage-account"></a><span data-ttu-id="6f018-140">Como o Visual Studio determina a conta de armazenamento de diagnóstico</span><span class="sxs-lookup"><span data-stu-id="6f018-140">How Visual Studio determines the diagnostics storage account</span></span>
* <span data-ttu-id="6f018-141">Se uma cadeia de conexão de diagnóstico é especificada no arquivo .cscfg, o Visual Studio a usa para configurar a extensão de diagnóstico durante a publicação e ao gerar os arquivos xml de configuração pública durante o empacotamento.</span><span class="sxs-lookup"><span data-stu-id="6f018-141">If a diagnostics connection string is specified in the .cscfg file, Visual Studio uses it to configure the diagnostics extension when publishing, and when generating the public configuration xml files during packaging.</span></span>
* <span data-ttu-id="6f018-142">Se nenhuma cadeia de conexão de diagnóstico é especificada no arquivo .cscfg, o Visual Studio voltará a usar a conta de armazenamento especificada no arquivo .wadcfgx para configurar a extensão de diagnóstico durante a publicação e ao gerar os arquivos xml de configuração pública durante o empacotamento.</span><span class="sxs-lookup"><span data-stu-id="6f018-142">If no diagnostics connection string is specified in the .cscfg file, then Visual Studio falls back to using the storage account specified in the .wadcfgx file to configure the diagnostics extension when publishing, and generating the public configuration xml files when packaging.</span></span>
* <span data-ttu-id="6f018-143">A cadeia de conexão de diagnóstico no arquivo .cscfg tem precedência sobre a conta de armazenamento no arquivo .wadcfgx.</span><span class="sxs-lookup"><span data-stu-id="6f018-143">The diagnostics connection string in the .cscfg file takes precedence over the storage account in the .wadcfgx file.</span></span> <span data-ttu-id="6f018-144">Se uma cadeia de conexão de diagnóstico é especificada no arquivo .cscfg, o Visual Studio a usa e ignora a conta de armazenamento em .wadcfgx.</span><span class="sxs-lookup"><span data-stu-id="6f018-144">If a diagnostics connection string is specified in the .cscfg file, then Visual Studio uses that and ignores the storage account in .wadcfgx.</span></span>

### <a name="what-does-the-update-development-storage-connection-strings-checkbox-do"></a><span data-ttu-id="6f018-145">O que faz a caixa de seleção "Atualizar cadeias de conexão do armazenamento de desenvolvimento..."</span><span class="sxs-lookup"><span data-stu-id="6f018-145">What does the "Update development storage connection strings…"</span></span> <span data-ttu-id="6f018-146">faz a caixa de seleção?</span><span class="sxs-lookup"><span data-stu-id="6f018-146">checkbox do?</span></span>
<span data-ttu-id="6f018-147">A caixa de seleção **Atualizar cadeias de conexão do armazenamento de desenvolvimento para Diagnóstico e cache com credenciais de conta de armazenamento do Microsoft Azure durante a publicação no Microsoft Azure** oferece uma maneira conveniente para atualizar qualquer cadeia de conexão de conta de armazenamento de desenvolvimento com a conta de armazenamento do Azure especificada durante a publicação.</span><span class="sxs-lookup"><span data-stu-id="6f018-147">The checkbox for **Update development storage connection strings for Diagnostics and Caching with Microsoft Azure storage account credentials when publishing to Microsoft Azure** gives you a convenient way to update any development storage account connection strings with the Azure storage account specified during publishing.</span></span>

<span data-ttu-id="6f018-148">Por exemplo, suponha que você selecione esta caixa de seleção e a cadeia de conexão de diagnóstico especifique `UseDevelopmentStorage=true`.</span><span class="sxs-lookup"><span data-stu-id="6f018-148">For example, suppose you select this checkbox and the diagnostics connection string specifies `UseDevelopmentStorage=true`.</span></span> <span data-ttu-id="6f018-149">Quando você publicar o projeto no Azure, o Visual Studio atualizará automaticamente a cadeia de conexão de diagnóstico com a conta de armazenamento que você especificou no Assistente de publicação.</span><span class="sxs-lookup"><span data-stu-id="6f018-149">When you publish the project to Azure, Visual Studio will automatically update the diagnostics connection string with the storage account you specified in the Publish wizard.</span></span> <span data-ttu-id="6f018-150">No entanto, se uma conta de armazenamento real foi especificada como a cadeia de conexão de diagnóstico, então essa conta será usada.</span><span class="sxs-lookup"><span data-stu-id="6f018-150">However, if a real storage account was specified as the diagnostics connection string, then that account is used instead.</span></span>

## <a name="diagnostics-functionality-differences-between-azure-sdk-24-and-earlier-and-azure-sdk-25-and-later"></a><span data-ttu-id="6f018-151">Diferenças de funcionalidade de diagnóstico entre SDK do Azure 2.4 e anteriores e SDK do Azure 2.5 e posteriores</span><span class="sxs-lookup"><span data-stu-id="6f018-151">Diagnostics functionality differences between Azure SDK 2.4 and earlier and Azure SDK 2.5 and later</span></span>
<span data-ttu-id="6f018-152">Se você estiver atualizando seu projeto do SDK do Azure 2.4 para o SDK do Azure 2.5 ou posterior, considere as seguintes diferenças de funcionalidade de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="6f018-152">If you're upgrading your project from Azure SDK 2.4 to Azure SDK 2.5 or later, you should bear in mind the following diagnostics functionality differences.</span></span>

* <span data-ttu-id="6f018-153">**APIs de configuração estão preteridos** – A configuração programática de diagnóstico está disponível no SDK do Azure 2.4 ou anteriores, mas foi preterida no SDK do Azure 2.5 e posteriores.</span><span class="sxs-lookup"><span data-stu-id="6f018-153">**Configuration APIs are deprecated** – Programmatic configuration of diagnostics is available in Azure SDK 2.4 or earlier versions, but is deprecated in Azure SDK 2.5 and later.</span></span> <span data-ttu-id="6f018-154">Se sua configuração de diagnóstico está definida atualmente no código, você precisará reconfigurar as configurações do zero no projeto migrado para que o diagnóstico continue a funcionar.</span><span class="sxs-lookup"><span data-stu-id="6f018-154">If your diagnostics configuration is currently defined in code, you'll need to reconfigure those settings from scratch in the migrated project in order for diagnostics to keep working.</span></span> <span data-ttu-id="6f018-155">O arquivo de configuração de diagnóstico do SDK do Azure 2.4 é diagnostics.wadcfg e para o SDK do Azure 2.5 e posteriores, diagnostics.wadcfgx.</span><span class="sxs-lookup"><span data-stu-id="6f018-155">The diagnostics configuration file for Azure SDK 2.4 is diagnostics.wadcfg, and diagnostics.wadcfgx for Azure SDK 2.5 and later.</span></span>
* <span data-ttu-id="6f018-156">**Diagnóstico para aplicativos de serviço de nuvem só podem ser configurados no nível de função, não no nível de instância.**</span><span class="sxs-lookup"><span data-stu-id="6f018-156">**Diagnostics for cloud service applications can only be configured at the role level, not at the instance level.**</span></span>
* <span data-ttu-id="6f018-157">**Sempre que você implanta seu aplicativo, a configuração de diagnóstico é atualizada** – isso pode causar problemas de paridade, se você altera a configuração de diagnóstico do Gerenciador de Servidores e, em seguida, reimplanta o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="6f018-157">**Every time you deploy your app, the diagnostics configuration is updated** – This can cause parity issues if you change your diagnostics configuration from Server Explorer and then redeploy your app.</span></span>
* <span data-ttu-id="6f018-158">**No SDK do Azure 2.5 e posteriores, despejos de memória são configurados no arquivo de configuração de diagnóstico, não no código** – se você tiver despejos de memória configurados no código, precisará transferir manualmente a configuração de código para o arquivo de configuração, pois os despejos de memória não são transferidos durante a migração para o SDK do Azure 2.6.</span><span class="sxs-lookup"><span data-stu-id="6f018-158">**In Azure SDK 2.5 and later, crash dumps are configured in the diagnostics configuration file, not in code** – If you have crash dumps configured in code, you'll have to manually transfer the configuration from code to the configuration file, because the crash dumps aren't transferred during the migration to Azure SDK 2.6.</span></span>

## <a name="enable-diagnostics-in-cloud-service-projects-before-deploying-them"></a><span data-ttu-id="6f018-159">Habilitar o diagnóstico em projetos de serviço de nuvem antes de implantá-los</span><span class="sxs-lookup"><span data-stu-id="6f018-159">Enable diagnostics in cloud service projects before deploying them</span></span>
<span data-ttu-id="6f018-160">No Visual Studio, você pode escolher coletar dados de diagnóstico para funções executadas no Azure, quando executa o serviço no emulador antes de implantá-lo.</span><span class="sxs-lookup"><span data-stu-id="6f018-160">In Visual Studio, you can choose to collect diagnostics data for roles that run in Azure, when you run the service in the emulator before deploying it.</span></span> <span data-ttu-id="6f018-161">Todas as alterações às configurações de diagnóstico no Visual Studio são salvas no arquivo de configuração diagnostics.wadcfgx.</span><span class="sxs-lookup"><span data-stu-id="6f018-161">All changes to diagnostics settings in Visual Studio are saved in the diagnostics.wadcfgx configuration file.</span></span> <span data-ttu-id="6f018-162">Essas definições de configurações especificam a conta de armazenamento na qual os dados de diagnóstico são salvos quando você implanta seu serviço de nuvem.</span><span class="sxs-lookup"><span data-stu-id="6f018-162">These configuration settings specify the storage account where diagnostics data is saved when you deploy your cloud service.</span></span>

[!INCLUDE [cloud-services-wad-warning](../includes/cloud-services-wad-warning.md)]

### <a name="to-enable-diagnostics-in-visual-studio-before-deployment"></a><span data-ttu-id="6f018-163">Para habilitar o diagnóstico no Visual Studio antes da implantação</span><span class="sxs-lookup"><span data-stu-id="6f018-163">To enable diagnostics in Visual Studio before deployment</span></span>
1. <span data-ttu-id="6f018-164">No menu de atalho da função que lhe interessa, escolha **Propriedades** e, em seguida, escolha a guia **Configuração** na janela **Propriedades** da função.</span><span class="sxs-lookup"><span data-stu-id="6f018-164">On the shortcut menu for the role that interests you, choose **Properties**, and then choose the **Configuration** tab in the role’s **Properties** window.</span></span>
2. <span data-ttu-id="6f018-165">Na seção **Diagnóstico**, verifique se a caixa de seleção **Habilitar Diagnóstico** está marcada.</span><span class="sxs-lookup"><span data-stu-id="6f018-165">In the **Diagnostics** section, make sure that the **Enable Diagnostics** check box is selected.</span></span>
   
    ![Acessando a opção Habilitar Diagnóstico](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796660.png)
3. <span data-ttu-id="6f018-167">Escolha o botão de reticências (...) para especificar a conta de armazenamento onde você deseja que os dados de diagnóstico sejam armazenados.</span><span class="sxs-lookup"><span data-stu-id="6f018-167">Choose the ellipsis (…) button to specify the storage account where you want the diagnostics data to be stored.</span></span> <span data-ttu-id="6f018-168">A conta de armazenamento que você escolher será o local onde os dados de diagnósticos serão armazenados.</span><span class="sxs-lookup"><span data-stu-id="6f018-168">The storage account you choose will be the location where diagnostics data is stored.</span></span>
   
    ![Especifique a conta de armazenamento a ser usada](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796661.png)
4. <span data-ttu-id="6f018-170">Na caixa de diálogo **Criar cadeia de conexão de armazenamento** , especifique se você deseja se conectar usando o Emulador de armazenamento do Azure, uma assinatura do Azure ou credenciais inseridas manualmente.</span><span class="sxs-lookup"><span data-stu-id="6f018-170">In the **Create Storage Connection String** dialog box, specify whether you want to connect using the Azure Storage Emulator, an Azure subscription, or manually entered credentials.</span></span>
   
    ![Caixa de diálogo Conta de armazenamento](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796662.png)
   
   * <span data-ttu-id="6f018-172">Se você escolher a opção Emulador de Armazenamento do Microsoft Azure, a cadeia de conexão é definida como UseDevelopmentStorage=true.</span><span class="sxs-lookup"><span data-stu-id="6f018-172">If you choose the Microsoft Azure Storage Emulator option, the connection string is set to UseDevelopmentStorage=true.</span></span>
   * <span data-ttu-id="6f018-173">Se você escolher a opção sua assinatura, pode escolher a assinatura do Azure que deseja usar e o nome da conta.</span><span class="sxs-lookup"><span data-stu-id="6f018-173">If you choose the Your subscription option, you can choose the Azure subscription you want to use and the account name.</span></span> <span data-ttu-id="6f018-174">Você pode escolher o botão Gerenciar contas para gerenciar suas assinaturas do Azure.</span><span class="sxs-lookup"><span data-stu-id="6f018-174">You can choose the Manage Accounts button to manage your Azure subscriptions.</span></span>
   * <span data-ttu-id="6f018-175">Se você escolher a opção Credenciais inseridas manualmente, será solicitado a inserir o nome e a chave da conta do Azure que deseja usar.</span><span class="sxs-lookup"><span data-stu-id="6f018-175">If you choose the Manually entered credentials option, you're prompted to enter the name and key of the Azure account you want to use.</span></span>
5. <span data-ttu-id="6f018-176">Escolha o botão **Configurar** para exibir a caixa de diálogo **Configuração de diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="6f018-176">Choose the **Configure** button to view the **Diagnostics configuration** dialog box.</span></span> <span data-ttu-id="6f018-177">Cada guia (exceto **Geral** e **Diretórios de log**) representa uma fonte de dados de diagnóstico que você pode coletar.</span><span class="sxs-lookup"><span data-stu-id="6f018-177">Each tab (except for **General** and **Log Directories**) represents a diagnostic data source that you can collect.</span></span> <span data-ttu-id="6f018-178">A guia padrão, **Geral**, oferece as seguintes opções de coleta de dados de diagnóstico: **Somente erros**, **Todas as informações** e **Plano personalizado**.</span><span class="sxs-lookup"><span data-stu-id="6f018-178">The default tab, **General**, offers you the following diagnostics data collection options: **Errors only**, **All information**, and **Custom plan**.</span></span> <span data-ttu-id="6f018-179">A opção padrão, **Somente erros**, traz a menor quantidade de armazenamento porque não transfere avisos ou mensagens de rastreamento.</span><span class="sxs-lookup"><span data-stu-id="6f018-179">The default option, **Errors only**, takes the least amount of storage because it doesn’t transfer warnings or tracing messages.</span></span> <span data-ttu-id="6f018-180">A opção Todas as informações transfere a maioria das informações e é, portanto, a opção mais cara em termos de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="6f018-180">The All information option transfers the most information and is, therefore, the most expensive option in terms of storage.</span></span>
   
    ![Habilitar a configuração e diagnóstico do Azure](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC758144.png)
6. <span data-ttu-id="6f018-182">Neste exemplo, selecione a opção **Plano personalizado** , assim você pode personalizar os dados coletados.</span><span class="sxs-lookup"><span data-stu-id="6f018-182">For this example, select the **Custom plan** option so you can customize the data collected.</span></span>
7. <span data-ttu-id="6f018-183">A caixa **Cota de disco em MB** especifica a quantidade de espaço que você deseja alocar na sua conta de armazenamento para dados de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="6f018-183">The **Disk Quota in MB** box specifies how much space you want to allocate in your storage account for diagnostics data.</span></span> <span data-ttu-id="6f018-184">Você pode alterar o valor padrão se desejar.</span><span class="sxs-lookup"><span data-stu-id="6f018-184">You can change the default value if you want.</span></span>
8. <span data-ttu-id="6f018-185">Em cada guia de dados de diagnóstico que deseja coletar, selecione a caixa de seleção **Habilitar transferência de <log type>**.</span><span class="sxs-lookup"><span data-stu-id="6f018-185">On each tab of diagnostics data you want to collect, select its **Enable Transfer of <log type>** check box.</span></span> <span data-ttu-id="6f018-186">Por exemplo, se você quiser coletar logs de aplicativo, selecione a caixa de seleção **Habilitar transferência dos Logs de aplicativo** da guia **Logs de aplicativos**. Além disso, especifique outras informações necessárias para cada tipo de dados de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="6f018-186">For example, if you want to collect application logs, select the **Enable transfer of Application Logs** check box on the **Application Logs** tab. Also, specify any other information required by each diagnostics data type.</span></span> <span data-ttu-id="6f018-187">Consulte a seção **Configurar fontes de dados de diagnóstico** posteriormente neste tópico para obter informações de configuração em cada guia.</span><span class="sxs-lookup"><span data-stu-id="6f018-187">See the section **Configure diagnostics data sources** later in this topic for configuration information on each tab.</span></span>
9. <span data-ttu-id="6f018-188">Depois de habilitar a coleção de todos os dados de diagnóstico que você deseja, escolha o botão **OK** .</span><span class="sxs-lookup"><span data-stu-id="6f018-188">After you’ve enabled collection of all the diagnostics data you want, choose the **OK** button.</span></span>
10. <span data-ttu-id="6f018-189">Execute seu projeto de serviço de nuvem do Azure no Visual Studio, como de costume.</span><span class="sxs-lookup"><span data-stu-id="6f018-189">Run your Azure cloud service project in Visual Studio as usual.</span></span> <span data-ttu-id="6f018-190">Como você usa seu aplicativo, as informações de log habilitadas são salvas na conta de armazenamento do Azure especificada.</span><span class="sxs-lookup"><span data-stu-id="6f018-190">As you use your application, the log information that you enabled is saved to the Azure storage account you specified.</span></span>

## <a name="enable-diagnostics-in-azure-virtual-machines"></a><span data-ttu-id="6f018-191">Habilitar o diagnóstico em máquinas virtuais do Azure</span><span class="sxs-lookup"><span data-stu-id="6f018-191">Enable diagnostics in Azure virtual machines</span></span>
<span data-ttu-id="6f018-192">No Visual Studio, você pode escolher coletar dados de diagnóstico para máquinas virtuais do Azure.</span><span class="sxs-lookup"><span data-stu-id="6f018-192">In Visual Studio, you can choose to collect diagnostics data for Azure virtual machines.</span></span>

### <a name="to-enable-diagnostics-in-azure-virtual-machines"></a><span data-ttu-id="6f018-193">Para habilitar o diagnóstico em máquinas virtuais do Azure</span><span class="sxs-lookup"><span data-stu-id="6f018-193">To enable diagnostics in Azure virtual machines</span></span>
1. <span data-ttu-id="6f018-194">No **Gerenciador de Servidores**, escolha o nó do Azure e conecte-se à sua assinatura do Azure, se você ainda não estiver conectado.</span><span class="sxs-lookup"><span data-stu-id="6f018-194">In **Server Explorer**, choose the Azure node and then connect to your Azure subscription, if you're not already connected.</span></span>
2. <span data-ttu-id="6f018-195">Expanda o nó **Máquinas virtuais** .</span><span class="sxs-lookup"><span data-stu-id="6f018-195">Expand the **Virtual Machines** node.</span></span> <span data-ttu-id="6f018-196">Você pode criar uma nova máquina virtual ou selecione uma que já está lá.</span><span class="sxs-lookup"><span data-stu-id="6f018-196">You can create a new virtual machine, or select one that's already there.</span></span>
3. <span data-ttu-id="6f018-197">No menu de atalho para a máquina virtual que lhe interessa, escolha **Configurar**.</span><span class="sxs-lookup"><span data-stu-id="6f018-197">On the shortcut menu for the virtual machine that interests you, choose **Configure**.</span></span> <span data-ttu-id="6f018-198">Esta mostra a caixa de diálogo configuração da máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="6f018-198">This shows the virtual machine configuration dialog box.</span></span>
   
    ![Configurando uma máquina virtual do Azure](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796663.png)
4. <span data-ttu-id="6f018-200">Se ainda não estiver instalado, adicione a extensão do diagnóstico do Microsoft Monitoring Agent.</span><span class="sxs-lookup"><span data-stu-id="6f018-200">If it's not already installed, add the Microsoft Monitoring Agent Diagnostics extension.</span></span> <span data-ttu-id="6f018-201">Essa extensão permite que você colete dados de diagnóstico da máquina virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="6f018-201">This extension lets you gather diagnostics data for the Azure virtual machine.</span></span> <span data-ttu-id="6f018-202">Na lista de extensões instalada, escolha o menu suspenso Selecionar uma extensão disponível e clique em Diagnóstico de Microsoft Monitoring Agent.</span><span class="sxs-lookup"><span data-stu-id="6f018-202">In the Installed Extensions list, choose the Select an available extension drop-down menu and then choose Microsoft Monitoring Agent Diagnostics.</span></span>
   
    ![Instalando uma extensão de máquina virtual do Azure](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC766024.png)
   
   > [!NOTE]
   > <span data-ttu-id="6f018-204">Outras extensões de diagnóstico estão disponíveis para as máquinas virtuais.</span><span class="sxs-lookup"><span data-stu-id="6f018-204">Other diagnostics extensions are available for your virtual machines.</span></span> <span data-ttu-id="6f018-205">Para obter mais informações, consulte recursos e extensões de VM do Azure.</span><span class="sxs-lookup"><span data-stu-id="6f018-205">For more information, see Azure VM Extensions and Features.</span></span>
   > 
   > 
5. <span data-ttu-id="6f018-206">Escolha o botão **Adicionar** para adicionar a extensão e exibir sua caixa de diálogo **Configuração de diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="6f018-206">Choose the **Add** button to add the extension and view its **Diagnostics configuration** dialog box.</span></span>
6. <span data-ttu-id="6f018-207">Escolha o botão **Configurar** para especificar uma conta de armazenamento e, em seguida, escolha o botão **OK**.</span><span class="sxs-lookup"><span data-stu-id="6f018-207">Choose the **Configure** button to specify a storage account and then choose the **OK** button.</span></span>
   
    <span data-ttu-id="6f018-208">Cada guia (exceto **Geral** e **Diretórios de log**) representa uma fonte de dados de diagnóstico que você pode coletar.</span><span class="sxs-lookup"><span data-stu-id="6f018-208">Each tab (except for **General** and **Log Directories**) represents a diagnostic data source that you can collect.</span></span>
   
    ![Habilitar a configuração e diagnóstico do Azure](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC758144.png)
   
    <span data-ttu-id="6f018-210">A guia padrão, **Geral**, oferece as seguintes opções de coleta de dados de diagnóstico: **Somente erros**, **Todas as informações** e **Plano personalizado**.</span><span class="sxs-lookup"><span data-stu-id="6f018-210">The default tab, **General**, offers you the following diagnostics data collection options: **Errors only**, **All information**, and **Custom plan**.</span></span> <span data-ttu-id="6f018-211">A opção padrão, **Somente erros**, traz a menor quantidade de armazenamento porque não transfere avisos ou mensagens de rastreamento.</span><span class="sxs-lookup"><span data-stu-id="6f018-211">The default option, **Errors only**, takes the least amount of storage because it doesn’t transfer warnings or tracing messages.</span></span> <span data-ttu-id="6f018-212">A opção **Todas as informações** transfere a maioria das informações e é, portanto, a opção mais cara em termos de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="6f018-212">The **All information** option transfers the most information and is, therefore, the most expensive option in terms of storage.</span></span>
7. <span data-ttu-id="6f018-213">Neste exemplo, selecione a opção **Plano personalizado** , assim você pode personalizar os dados coletados.</span><span class="sxs-lookup"><span data-stu-id="6f018-213">For this example, select the **Custom plan** option so you can customize the data collected.</span></span>
8. <span data-ttu-id="6f018-214">A caixa **Cota de disco em MB** especifica a quantidade de espaço que você deseja alocar na sua conta de armazenamento para dados de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="6f018-214">The **Disk Quota in MB** box specifies how much space you want to allocate in your storage account for diagnostics data.</span></span> <span data-ttu-id="6f018-215">Você pode alterar o valor padrão se desejar.</span><span class="sxs-lookup"><span data-stu-id="6f018-215">You can change the default value if you want.</span></span>
9. <span data-ttu-id="6f018-216">Em cada guia de dados de diagnóstico que deseja coletar, selecione a caixa de seleção **Habilitar transferência de <log type>**.</span><span class="sxs-lookup"><span data-stu-id="6f018-216">On each tab of diagnostics data you want to collect, select its **Enable Transfer of <log type>** check box.</span></span>
   
    <span data-ttu-id="6f018-217">Por exemplo, se você quiser coletar logs de aplicativo, selecione a caixa de seleção **Habilitar transferência dos Logs de aplicativo** da guia **Logs de aplicativos**. Além disso, especifique outras informações necessárias para cada tipo de dados de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="6f018-217">For example, if you want to collect application logs, select the **Enable transfer of Application Logs** check box on the **Application Logs** tab. Also, specify any other information required by each diagnostics data type.</span></span> <span data-ttu-id="6f018-218">Consulte a seção **Configurar fontes de dados de diagnóstico** posteriormente neste tópico para obter informações de configuração em cada guia.</span><span class="sxs-lookup"><span data-stu-id="6f018-218">See the section **Configure diagnostics data sources** later in this topic for configuration information on each tab.</span></span>
10. <span data-ttu-id="6f018-219">Depois de habilitar a coleção de todos os dados de diagnóstico que você deseja, escolha o botão **OK** .</span><span class="sxs-lookup"><span data-stu-id="6f018-219">After you’ve enabled collection of all the diagnostics data you want, choose the **OK** button.</span></span>
11. <span data-ttu-id="6f018-220">Salve o projeto atualizado.</span><span class="sxs-lookup"><span data-stu-id="6f018-220">Save the updated project.</span></span>
    
     <span data-ttu-id="6f018-221">Você verá uma mensagem na janela **Log de atividades do Microsoft Azure** que a máquina virtual foi atualizada.</span><span class="sxs-lookup"><span data-stu-id="6f018-221">You'll see a message in the **Microsoft Azure Activity Log** window that the virtual machine has been updated.</span></span>

## <a name="configure-diagnostics-data-sources"></a><span data-ttu-id="6f018-222">Configurar fontes de dados de diagnóstico</span><span class="sxs-lookup"><span data-stu-id="6f018-222">Configure diagnostics data sources</span></span>
<span data-ttu-id="6f018-223">Após habilitar a coleção de dados de diagnóstico, você pode escolher exatamente quais fontes de dados que deseja coletar e quais informações são coletadas.</span><span class="sxs-lookup"><span data-stu-id="6f018-223">After you enable diagnostics data collection, you can choose exactly what data sources you want to collect and what information is collected.</span></span> <span data-ttu-id="6f018-224">A seguir está uma lista de guias na caixa de diálogo **Configuração de diagnóstico** e o que significa cada opção de configuração.</span><span class="sxs-lookup"><span data-stu-id="6f018-224">The following is a list of tabs in the **Diagnostics configuration** dialog box and what each configuration option means.</span></span>

### <a name="application-logs"></a><span data-ttu-id="6f018-225">Logs de aplicativos</span><span class="sxs-lookup"><span data-stu-id="6f018-225">Application logs</span></span>
<span data-ttu-id="6f018-226">**Logs de aplicativos** contêm informações de diagnóstico produzidas por um aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="6f018-226">**Application logs** contain diagnostics information produced by a web application.</span></span> <span data-ttu-id="6f018-227">Por exemplo, se você quiser coletar logs de aplicativo, selecione a caixa de seleção **Habilitar transferência dos logs de aplicativo** .</span><span class="sxs-lookup"><span data-stu-id="6f018-227">If you want to capture application logs, select the **Enable transfer of Application Logs** check box.</span></span> <span data-ttu-id="6f018-228">Você pode aumentar ou diminuir o número de minutos quando os logs de aplicativo são transferidos para sua conta de armazenamento, alterando o valor **Período de transferência (min)** .</span><span class="sxs-lookup"><span data-stu-id="6f018-228">You can increase or decrease the number of minutes when the application logs are transferred to your storage account by changing the **Transfer Period (min)** value.</span></span> <span data-ttu-id="6f018-229">Você também pode alterar a quantidade de informações capturadas no log definindo o valor de nível de log.</span><span class="sxs-lookup"><span data-stu-id="6f018-229">You can also change the amount of information captured in the log by setting the Log level value.</span></span> <span data-ttu-id="6f018-230">Por exemplo, você pode escolher **Detalhado** para obter mais informações ou escolher **Crítico** para capturar apenas os erros críticos.</span><span class="sxs-lookup"><span data-stu-id="6f018-230">For example, you can choose **Verbose** to get more information or choose **Critical** to capture only critical errors.</span></span> <span data-ttu-id="6f018-231">Se você tiver um provedor de diagnósticos específico que emite os logs de aplicativo, pode capturá-los adicionando o GUID do provedor na caixa **GUID do provedor** .</span><span class="sxs-lookup"><span data-stu-id="6f018-231">If you have a specific diagnostics provider that emits application logs, you can capture them by adding the provider’s GUID to the **Provider GUID** box.</span></span>

  ![Logs de aplicativos](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC758145.png)

  <span data-ttu-id="6f018-233">Consulte [Habilitar o registro em log de diagnóstico para aplicativos Web no Serviço de Aplicativo do Azure](app-service-web/web-sites-enable-diagnostic-log.md) para obter mais informações sobre os logs de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="6f018-233">See [Enable diagnostics logging for web apps in Azure App Service](app-service-web/web-sites-enable-diagnostic-log.md) for more information about application logs.</span></span>

### <a name="windows-event-logs"></a><span data-ttu-id="6f018-234">Logs de eventos do Windows</span><span class="sxs-lookup"><span data-stu-id="6f018-234">Windows event logs</span></span>
<span data-ttu-id="6f018-235">Por exemplo, se você quiser capturar logs de evento do Windows, selecione a caixa de seleção **Habilitar transferência dos logs de evento do Windows** .</span><span class="sxs-lookup"><span data-stu-id="6f018-235">If you want to capture Windows event logs, select the **Enable transfer of Windows Event Logs** check box.</span></span> <span data-ttu-id="6f018-236">Você pode aumentar ou diminuir o número de minutos quando os logs de eventos são transferidos para sua conta de armazenamento, alterando o valor **Período de transferência (min)** .</span><span class="sxs-lookup"><span data-stu-id="6f018-236">You can increase or decrease the number of minutes when the event logs are transferred to your storage account by changing the **Transfer Period (min)** value.</span></span> <span data-ttu-id="6f018-237">Selecione as caixas de seleção para os tipos de eventos que você deseja controlar.</span><span class="sxs-lookup"><span data-stu-id="6f018-237">Select the check boxes for the types of events that you want to track.</span></span>

  ![Logs de eventos](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796664.png)

<span data-ttu-id="6f018-239">Se você estiver usando o SDK do Azure 2.6 ou posterior e deseja especificar uma fonte de dados personalizada, insira a fonte na caixa de texto **<Data source name>** e, em seguida, escolha o botão **Adicionar** ao lado dela.</span><span class="sxs-lookup"><span data-stu-id="6f018-239">If you're using Azure SDK 2.6 or later and want to specify a custom data source, enter it in the **<Data source name>** text box and then choose the **Add** button next to it.</span></span> <span data-ttu-id="6f018-240">A fonte de dados é adicionada ao arquivo diagnostics.cfcfg.</span><span class="sxs-lookup"><span data-stu-id="6f018-240">The data source is added to the diagnostics.cfcfg file.</span></span>

<span data-ttu-id="6f018-241">Se você estiver usando o SDK do Azure 2.5 e deseja especificar uma fonte de dados personalizada, você pode adicioná-la para a seção `WindowsEventLog` do arquivo diagnostics.wadcfgx, como o exemplo a seguir.</span><span class="sxs-lookup"><span data-stu-id="6f018-241">If you're using Azure SDK 2.5 and want to specify a custom data source, you can add it to the `WindowsEventLog` section of the diagnostics.wadcfgx file, such as in the following example.</span></span>

```
<WindowsEventLog scheduledTransferPeriod="PT1M">
   <DataSource name="Application!*" />
   <DataSource name="CustomDataSource!*" />
</WindowsEventLog>
```
### <a name="performance-counters"></a><span data-ttu-id="6f018-242">Contadores de desempenho</span><span class="sxs-lookup"><span data-stu-id="6f018-242">Performance counters</span></span>
<span data-ttu-id="6f018-243">As informações do contador de desempenho podem ajudá-lo a localizar afunilamentos do sistema e ajustar o sistema e desempenho do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="6f018-243">Performance counter information can help you locate system bottlenecks and fine-tune system and application performance.</span></span> <span data-ttu-id="6f018-244">Consulte [Criar e usar contadores de desempenho em um aplicativo do Azure](https://msdn.microsoft.com/library/azure/hh411542.aspx) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="6f018-244">See [Create and Use Performance Counters in an Azure Application](https://msdn.microsoft.com/library/azure/hh411542.aspx) for more information.</span></span> <span data-ttu-id="6f018-245">Se você deseja capturar os contadores de desempenho, selecione a caixa de seleção **Habilitar a transferência de contadores de desempenho** .</span><span class="sxs-lookup"><span data-stu-id="6f018-245">If you want to capture performance counters, select the **Enable transfer of Performance Counters** check box.</span></span> <span data-ttu-id="6f018-246">Você pode aumentar ou diminuir o número de minutos quando os logs de eventos são transferidos para sua conta de armazenamento, alterando o valor **Período de transferência (min)** .</span><span class="sxs-lookup"><span data-stu-id="6f018-246">You can increase or decrease the number of minutes when the event logs are transferred to your storage account by changing the **Transfer Period (min)** value.</span></span> <span data-ttu-id="6f018-247">Selecione as caixas de seleção para os contadores de desempenho que você deseja controlar.</span><span class="sxs-lookup"><span data-stu-id="6f018-247">Select the check boxes for the performance counters that you want to track.</span></span>

  ![Contadores de desempenho](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC758147.png)

<span data-ttu-id="6f018-249">Para controlar um contador de desempenho que não está listado, insira-o usando a sintaxe sugerida e escolha o botão **Adicionar** .</span><span class="sxs-lookup"><span data-stu-id="6f018-249">To track a performance counter that isn’t listed, enter it by using the suggested syntax and then choose the **Add** button.</span></span> <span data-ttu-id="6f018-250">O sistema operacional na máquina virtual determina quais contadores de desempenho que você pode controlar. Para obter mais informações sobre a sintaxe, consulte [Especificando um caminho de contador](https://msdn.microsoft.com/library/windows/desktop/aa373193.aspx).</span><span class="sxs-lookup"><span data-stu-id="6f018-250">The operating system on the virtual machine determines which performance counters you can track. For more information about syntax, see [Specifying a Counter Path](https://msdn.microsoft.com/library/windows/desktop/aa373193.aspx).</span></span>

### <a name="infrastructure-logs"></a><span data-ttu-id="6f018-251">Logs de infraestrutura</span><span class="sxs-lookup"><span data-stu-id="6f018-251">Infrastructure logs</span></span>
<span data-ttu-id="6f018-252">Se você desejar capturar logs de infraestrutura que contêm informações sobre a infraestrutura de diagnóstico do Azure, o módulo RemoteAccess e o módulo RemoteForwarder, selecione a caixa de seleção **Habilitar a transferência de Logs de infraestrutura** .</span><span class="sxs-lookup"><span data-stu-id="6f018-252">If you want to capture infrastructure logs, which contain information about the Azure diagnostic infrastructure, the RemoteAccess module, and the RemoteForwarder module, select the **Enable transfer of Infrastructure Logs** check box.</span></span> <span data-ttu-id="6f018-253">Você pode aumentar ou diminuir o número de minutos quando os logs de eventos são transferidos para sua conta de armazenamento alterando o valor do Período de transferência (min).</span><span class="sxs-lookup"><span data-stu-id="6f018-253">You can increase or decrease the number of minutes when the logs are transferred to your storage account by changing the Transfer Period (min) value.</span></span>

  ![Logs de infraestrutura de diagnósticos](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC758148.png)

  <span data-ttu-id="6f018-255">Para saber mais, consulte [Coletar dados do log usando o Diagnóstico do Azure](https://msdn.microsoft.com/library/azure/gg433048.aspx) .</span><span class="sxs-lookup"><span data-stu-id="6f018-255">See [Collect Logging Data by Using Azure Diagnostics](https://msdn.microsoft.com/library/azure/gg433048.aspx) for more information.</span></span>

### <a name="log-directories"></a><span data-ttu-id="6f018-256">Diretórios de log</span><span class="sxs-lookup"><span data-stu-id="6f018-256">Log directories</span></span>
<span data-ttu-id="6f018-257">Se você deseja capturar os diretórios de log que contêm os dados coletados dos diretórios de log das solicitações de Serviços de Informações da Internet (IIS), solicitações com falha ou pastas que você escolher, selecione a caixa de seleção **Habilitar transferência de diretórios de Log** .</span><span class="sxs-lookup"><span data-stu-id="6f018-257">If you want to capture log directories, which contain data collected from log directories for Internet Information Services (IIS) requests, failed requests, or folders that you choose, select the **Enable transfer of Log Directories** check box.</span></span> <span data-ttu-id="6f018-258">Você pode aumentar ou diminuir o número de minutos quando os logs de eventos são transferidos para sua conta de armazenamento alterando o valor do **Período de transferência (min)** .</span><span class="sxs-lookup"><span data-stu-id="6f018-258">You can increase or decrease the number of minutes when the logs are transferred to your storage account by changing the **Transfer Period (min)** value.</span></span>

<span data-ttu-id="6f018-259">Você pode marcar as caixas dos logs que deseja coletar, tais como os logs **Logs do IIS** e **Solicitação com falha**.</span><span class="sxs-lookup"><span data-stu-id="6f018-259">You can select the boxes of the logs you want to collect, such as **IIS Logs** and **Failed Request** Logs.</span></span> <span data-ttu-id="6f018-260">Os nomes de contêiner de armazenamento padrão são fornecidos, mas você pode alterar os nomes, se desejar.</span><span class="sxs-lookup"><span data-stu-id="6f018-260">Default storage container names are provided, but you can change the names if you want.</span></span>

<span data-ttu-id="6f018-261">Além disso, você pode capturar logs de qualquer pasta.</span><span class="sxs-lookup"><span data-stu-id="6f018-261">Also, you can capture logs from any folder.</span></span> <span data-ttu-id="6f018-262">Basta especificar o caminho na seção **Log do diretório absoluto** e, em seguida, escolha o botão **Adicionar diretório**.</span><span class="sxs-lookup"><span data-stu-id="6f018-262">Just specify the path in the **Log from Absolute Directory** section and then choose the **Add Directory** button.</span></span> <span data-ttu-id="6f018-263">Os logs serão capturados para os contêineres especificados.</span><span class="sxs-lookup"><span data-stu-id="6f018-263">The logs will be captured to the specified containers.</span></span>

  ![Diretórios de log](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796665.png)

### <a name="etw-logs"></a><span data-ttu-id="6f018-265">Logs do ETW</span><span class="sxs-lookup"><span data-stu-id="6f018-265">ETW logs</span></span>
<span data-ttu-id="6f018-266">Se você usar [ETW](https://msdn.microsoft.com/library/windows/desktop/bb968803\(v=vs.85\).aspx) (Rastreamento de Eventos para Windows) e desejar capturar logs de ETW, selecione a caixa de seleção **Habilitar transferência de logs de ETW**.</span><span class="sxs-lookup"><span data-stu-id="6f018-266">If you use [Event Tracing for Windows](https://msdn.microsoft.com/library/windows/desktop/bb968803\(v=vs.85\).aspx) (ETW) and want to capture ETW logs, select the **Enable transfer of ETW Logs** check box.</span></span> <span data-ttu-id="6f018-267">Você pode aumentar ou diminuir o número de minutos quando os logs de eventos são transferidos para sua conta de armazenamento alterando o valor do **Período de transferência (min)** .</span><span class="sxs-lookup"><span data-stu-id="6f018-267">You can increase or decrease the number of minutes when the logs are transferred to your storage account by changing the **Transfer Period (min)** value.</span></span>

<span data-ttu-id="6f018-268">Os eventos são capturados das origens de eventos e manifestos de evento que você especificar.</span><span class="sxs-lookup"><span data-stu-id="6f018-268">The events are captured from event sources and event manifests that you specify.</span></span> <span data-ttu-id="6f018-269">Para especificar uma origem de evento, insira um nome na seção **Origens de evento** e, em seguida, escolha o botão **Adicionar origem de evento**.</span><span class="sxs-lookup"><span data-stu-id="6f018-269">To specify an event source, enter a name in the **Event Sources** section and then choose the **Add Event Source** button.</span></span> <span data-ttu-id="6f018-270">Da mesma forma, você pode especificar um manifesto de evento na seção **Manifestos de evento**s e, em seguida, escolha o botão **Adicionar manifesto de evento**.</span><span class="sxs-lookup"><span data-stu-id="6f018-270">Similarly, you can specify an event manifest in the **Event Manifests** section and then choose the **Add Event Manifest** button.</span></span>

  ![Logs do ETW](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC766025.png)

  <span data-ttu-id="6f018-272">A estrutura do ETW tem suporte no ASP.NET por meio de classes no namespace [System.Diagnostics.aspx] (https://msdn.microsoft.com/library/system.diagnostics(v=vs.110).</span><span class="sxs-lookup"><span data-stu-id="6f018-272">The ETW framework is supported in ASP.NET through classes in the [System.Diagnostics.aspx](https://msdn.microsoft.com/library/system.diagnostics(v=vs.110) namespace.</span></span> <span data-ttu-id="6f018-273">O namespace Microsoft.WindowsAzure.Diagnostics, que herda e estende as classes padrão [System.Diagnostics.aspx] (https://msdn.microsoft.com/library/system.diagnostics(v=vs.110), permite o uso de [System.Diagnostics.aspx] (https://msdn.microsoft.com/library/system.diagnostics(v=vs.110) como uma estrutura de registros no ambiente do Azure.</span><span class="sxs-lookup"><span data-stu-id="6f018-273">The Microsoft.WindowsAzure.Diagnostics namespace, which inherits from and extends standard [System.Diagnostics.aspx](https://msdn.microsoft.com/library/system.diagnostics(v=vs.110) classes, enables the use of [System.Diagnostics.aspx](https://msdn.microsoft.com/library/system.diagnostics(v=vs.110) as a logging framework in the Azure environment.</span></span> <span data-ttu-id="6f018-274">Para obter mais informações, consulte [Tomar controle de registro em log e rastreamento no Microsoft Azure](https://msdn.microsoft.com/magazine/ff714589.aspx) e [Habilitando o diagnóstico no serviços de nuvem e Máquinas virtuais do Azure](cloud-services/cloud-services-dotnet-diagnostics.md).</span><span class="sxs-lookup"><span data-stu-id="6f018-274">For more information, see [Take Control of Logging and Tracing in Microsoft Azure](https://msdn.microsoft.com/magazine/ff714589.aspx) and [Enabling Diagnostics in Azure Cloud Services and Virtual Machines](cloud-services/cloud-services-dotnet-diagnostics.md).</span></span>

### <a name="crash-dumps"></a><span data-ttu-id="6f018-275">Despejos de falhas</span><span class="sxs-lookup"><span data-stu-id="6f018-275">Crash dumps</span></span>
<span data-ttu-id="6f018-276">Se você quiser capturar informações de quando falha uma instância de função, selecione a caixa de seleção **Habilitar transferência de despejos de memória**.</span><span class="sxs-lookup"><span data-stu-id="6f018-276">If you want to capture information about when a role instance crashes, select the **Enable transfer of Crash Dumps** check box.</span></span> <span data-ttu-id="6f018-277">(Pelo fato do ASP.NET manipular mais exceções, isso geralmente é útil somente para uma função de trabalho.) Você pode aumentar ou diminuir o percentual de espaço de armazenamento dedicado aos despejos de memória, alterando o valor **Cota de diretório (%)**.</span><span class="sxs-lookup"><span data-stu-id="6f018-277">(Because ASP.NET handles most exceptions, this is generally useful only for worker roles.) You can increase or decrease the percentage of storage space devoted to the crash dumps by changing the **Directory Quota (%)** value.</span></span> <span data-ttu-id="6f018-278">Você pode alterar o contêiner de armazenamento no qual os despejos de memória são armazenados e selecionar se deseja capturar um despejo **Completo** ou **Mini**.</span><span class="sxs-lookup"><span data-stu-id="6f018-278">You can change the storage container where the crash dumps are stored, and you can select whether you want to capture a **Full** or **Mini** dump.</span></span>

<span data-ttu-id="6f018-279">Os processos que estão sendo controlados no momento são listados.</span><span class="sxs-lookup"><span data-stu-id="6f018-279">The processes currently being tracked are listed.</span></span> <span data-ttu-id="6f018-280">Selecione as caixas de seleção para os processos que você deseja capturar.</span><span class="sxs-lookup"><span data-stu-id="6f018-280">Select the check boxes for the processes that you want to capture.</span></span> <span data-ttu-id="6f018-281">Para adicionar outro processo à lista, insira o nome do processo e, em seguida, escolha o botão **Adicionar processo** .</span><span class="sxs-lookup"><span data-stu-id="6f018-281">To add another process to the list, enter the process name and then choose the **Add Process** button.</span></span>

  ![Despejos de falhas](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC766026.png)

  <span data-ttu-id="6f018-283">Consulte [Tomar controle do registro em log e rastreamento no Microsoft Azure](https://msdn.microsoft.com/magazine/ff714589.aspx) e [Diagnóstico do Microsoft Azure parte 4: componentes de registro de log personalizados e alterações do Diagnóstico do Azure 1.3](http://justazure.com/microsoft-azure-diagnostics-part-4-custom-logging-components-azure-diagnostics-1-3-changes/) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="6f018-283">See [Take Control of Logging and Tracing in Microsoft Azure](https://msdn.microsoft.com/magazine/ff714589.aspx) and [Microsoft Azure Diagnostics Part 4: Custom Logging Components and Azure Diagnostics 1.3 Changes](http://justazure.com/microsoft-azure-diagnostics-part-4-custom-logging-components-azure-diagnostics-1-3-changes/) for more information.</span></span>

## <a name="view-the-diagnostics-data"></a><span data-ttu-id="6f018-284">Exibir os dados de diagnóstico</span><span class="sxs-lookup"><span data-stu-id="6f018-284">View the diagnostics data</span></span>
<span data-ttu-id="6f018-285">Depois que você coletou os dados de diagnóstico para um serviço de nuvem ou uma máquina virtual, pode exibi-lo.</span><span class="sxs-lookup"><span data-stu-id="6f018-285">After you’ve collected the diagnostics data for a cloud service or a virtual machine, you can view it.</span></span>

### <a name="to-view-cloud-service-diagnostics-data"></a><span data-ttu-id="6f018-286">Para exibir dados de diagnóstico do serviço de nuvem</span><span class="sxs-lookup"><span data-stu-id="6f018-286">To view cloud service diagnostics data</span></span>
1. <span data-ttu-id="6f018-287">Implante seu serviço de nuvem como de costume e, em seguida, execute-o.</span><span class="sxs-lookup"><span data-stu-id="6f018-287">Deploy your cloud service as usual and then run it.</span></span>
2. <span data-ttu-id="6f018-288">Você pode exibir os dados de diagnóstico em um relatório que o Visual Studio gera ou em tabelas na conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="6f018-288">You can view the diagnostics data in either a report that Visual Studio generates or tables in your storage account.</span></span> <span data-ttu-id="6f018-289">Para exibir os dados em um relatório, abra **Cloud Explorer** ou **Gerenciador de Servidores**, abra o menu de atalho do nó para a função que lhe interessa e, em seguida, escolha **Exibir dados de diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="6f018-289">To view the data in a report, open **Cloud Explorer** or **Server Explorer**, open the shortcut menu of the node for the role that interests you, and then choose **View Diagnostic Data**.</span></span>
   
    ![Exibir dados de diagnóstico](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC748912.png)
   
    <span data-ttu-id="6f018-291">Um relatório que mostra os dados disponíveis é exibido.</span><span class="sxs-lookup"><span data-stu-id="6f018-291">A report that shows the available data appears.</span></span>
   
    ![Relatório do Microsoft Azure Diagnostics no Visual Studio](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796666.png)
   
    <span data-ttu-id="6f018-293">Se os dados mais recentes não aparecem, você terá que esperar o período de transferência.</span><span class="sxs-lookup"><span data-stu-id="6f018-293">If the most recent data doesn't appear, you might have to wait for the transfer period to elapse.</span></span>
   
    <span data-ttu-id="6f018-294">Escolha o link **Atualizar** para atualizar os dados imediatamente ou escolha um intervalo na caixa de listagem suspensa **Atualização automática** para ter os dados atualizados automaticamente.</span><span class="sxs-lookup"><span data-stu-id="6f018-294">Choose the **Refresh** link to immediately update the data, or choose an interval in the **Auto-Refresh** dropdown list box to have the data updated automatically.</span></span> <span data-ttu-id="6f018-295">Para exportar os dados de erro, escolha o botão **Exportar para CSV** para criar um arquivo de valores separados por vírgula que pode ser aberto em uma planilha.</span><span class="sxs-lookup"><span data-stu-id="6f018-295">To export the error data, choose the **Export to CSV** button to create a comma-separated value file you can open in a spreadsheet.</span></span>
   
    <span data-ttu-id="6f018-296">Em **Cloud Explorer** ou **Gerenciador de Servidores**, abra a conta de armazenamento que está associada à implantação.</span><span class="sxs-lookup"><span data-stu-id="6f018-296">In **Cloud Explorer** or **Server Explorer**, open the storage account that's associated with the deployment.</span></span>
3. <span data-ttu-id="6f018-297">Abra as tabelas de diagnóstico no Visualizador de tabela e, em seguida, analise os dados coletados.</span><span class="sxs-lookup"><span data-stu-id="6f018-297">Open the diagnostics tables in the table viewer, and then review the data that you collected.</span></span> <span data-ttu-id="6f018-298">Para logs do IIS e os logs personalizados, você pode abrir um contêiner de blob.</span><span class="sxs-lookup"><span data-stu-id="6f018-298">For IIS logs and custom logs, you can open a blob container.</span></span> <span data-ttu-id="6f018-299">Examinando a tabela a seguir, você pode encontrar a tabela ou o contêiner de blob que contém os dados que lhe interessam.</span><span class="sxs-lookup"><span data-stu-id="6f018-299">By reviewing the following table, you can find the table or blob container that contains the data that interests you.</span></span> <span data-ttu-id="6f018-300">Além dos dados para esse arquivo de log, as entradas de tabela contêm EventTickCount, DeploymentId, função e RoleInstance para ajudá-lo a identificar qual máquina virtual e a função que geraram os dados e quando.</span><span class="sxs-lookup"><span data-stu-id="6f018-300">In addition to the data for that log file, the table entries contain EventTickCount, DeploymentId, Role, and RoleInstance to help you identify what virtual machine and role generated the data and when.</span></span> 
   
   | <span data-ttu-id="6f018-301">Dados de diagnóstico</span><span class="sxs-lookup"><span data-stu-id="6f018-301">Diagnostic data</span></span> | <span data-ttu-id="6f018-302">Descrição</span><span class="sxs-lookup"><span data-stu-id="6f018-302">Description</span></span> | <span data-ttu-id="6f018-303">Local</span><span class="sxs-lookup"><span data-stu-id="6f018-303">Location</span></span> |
   | --- | --- | --- |
   | <span data-ttu-id="6f018-304">Logs de aplicativos</span><span class="sxs-lookup"><span data-stu-id="6f018-304">Application Logs</span></span> |<span data-ttu-id="6f018-305">Logs que seu código gera chamando os métodos da classe System.Diagnostics.Trace.</span><span class="sxs-lookup"><span data-stu-id="6f018-305">Logs that your code generates by calling methods of the System.Diagnostics.Trace class.</span></span> |<span data-ttu-id="6f018-306">WADLogsTable</span><span class="sxs-lookup"><span data-stu-id="6f018-306">WADLogsTable</span></span> |
   | <span data-ttu-id="6f018-307">Logs de eventos</span><span class="sxs-lookup"><span data-stu-id="6f018-307">Event Logs</span></span> |<span data-ttu-id="6f018-308">Esses dados são dos logs de eventos do Windows nas máquinas virtuais.</span><span class="sxs-lookup"><span data-stu-id="6f018-308">This data is from the Windows event logs on the virtual machines.</span></span> <span data-ttu-id="6f018-309">O Windows armazena informações desses logs, mas os aplicativos e os serviços também as usam para relatar erros ou informações de log.</span><span class="sxs-lookup"><span data-stu-id="6f018-309">Windows stores information in these logs, but applications and services also use them to report errors or log information.</span></span> |<span data-ttu-id="6f018-310">WADWindowsEventLogsTable</span><span class="sxs-lookup"><span data-stu-id="6f018-310">WADWindowsEventLogsTable</span></span> |
   | <span data-ttu-id="6f018-311">Contadores de desempenho</span><span class="sxs-lookup"><span data-stu-id="6f018-311">Performance Counters</span></span> |<span data-ttu-id="6f018-312">Você pode coletar dados de qualquer contador de desempenho disponível na máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="6f018-312">You can collect data on any performance counter that’s available on the virtual machine.</span></span> <span data-ttu-id="6f018-313">O sistema operacional fornece contadores de desempenho, que inclui estatísticas, como tempo de processador e uso de memória.</span><span class="sxs-lookup"><span data-stu-id="6f018-313">The operating system provides performance counters, which include many statistics such as memory usage and processor time.</span></span> |<span data-ttu-id="6f018-314">WADPerformanceCountersTable</span><span class="sxs-lookup"><span data-stu-id="6f018-314">WADPerformanceCountersTable</span></span> |
   | <span data-ttu-id="6f018-315">Logs de infraestrutura</span><span class="sxs-lookup"><span data-stu-id="6f018-315">Infrastructure Logs</span></span> |<span data-ttu-id="6f018-316">Esses logs são gerados por meio da própria infraestrutura de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="6f018-316">These logs are generated from the diagnostics infrastructure itself.</span></span> |<span data-ttu-id="6f018-317">WADDiagnosticInfrastructureLogsTable</span><span class="sxs-lookup"><span data-stu-id="6f018-317">WADDiagnosticInfrastructureLogsTable</span></span> |
   | <span data-ttu-id="6f018-318">Logs IIS</span><span class="sxs-lookup"><span data-stu-id="6f018-318">IIS Logs</span></span> |<span data-ttu-id="6f018-319">Esses logs registram solicitações da Web.</span><span class="sxs-lookup"><span data-stu-id="6f018-319">These logs record web requests.</span></span> <span data-ttu-id="6f018-320">Se seu serviço de nuvem obtém uma quantidade significativa de tráfego, esses logs podem ser muito longos. Portanto, você deve coletar e armazenar esses dados somente quando forem necessários.</span><span class="sxs-lookup"><span data-stu-id="6f018-320">If your cloud service gets a significant amount of traffic, these logs can be quite lengthy, so you should collect and store this data only when you need it.</span></span> |<span data-ttu-id="6f018-321">Você pode encontrar os logs de solicitação com falha no contêiner de blob em wad-iis-failedreqlogs em um caminho para essa implantação, função e instância.</span><span class="sxs-lookup"><span data-stu-id="6f018-321">You can find failed-request logs in the blob container under wad-iis-failedreqlogs under a path for that deployment, role, and instance.</span></span> <span data-ttu-id="6f018-322">Você pode encontrar logs completos em wad-iis-logfiles.</span><span class="sxs-lookup"><span data-stu-id="6f018-322">You can find complete logs under wad-iis-logfiles.</span></span> <span data-ttu-id="6f018-323">As entradas para cada arquivo são feitas na tabela WADDirectories.</span><span class="sxs-lookup"><span data-stu-id="6f018-323">Entries for each file are made in the WADDirectories table.</span></span> |
   | <span data-ttu-id="6f018-324">Despejos de falhas</span><span class="sxs-lookup"><span data-stu-id="6f018-324">Crash dumps</span></span> |<span data-ttu-id="6f018-325">Essas informações fornecem imagens binárias do processo do serviço de nuvem (normalmente uma função de trabalho).</span><span class="sxs-lookup"><span data-stu-id="6f018-325">This information provides binary images of your cloud service’s process (typically a worker role).</span></span> |<span data-ttu-id="6f018-326">contêiner de blob wad-crush-dumps</span><span class="sxs-lookup"><span data-stu-id="6f018-326">wad-crush-dumps blob container</span></span> |
   | <span data-ttu-id="6f018-327">Arquivos de log personalizados</span><span class="sxs-lookup"><span data-stu-id="6f018-327">Custom log files</span></span> |<span data-ttu-id="6f018-328">Logs de dados que você predefiniu.</span><span class="sxs-lookup"><span data-stu-id="6f018-328">Logs of data that you predefined.</span></span> |<span data-ttu-id="6f018-329">Você pode especificar no código o local dos arquivos de log personalizados na sua conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="6f018-329">You can specify in code the location of custom log files in your storage account.</span></span> <span data-ttu-id="6f018-330">Por exemplo, você pode especificar um contêiner de blob personalizado.</span><span class="sxs-lookup"><span data-stu-id="6f018-330">For example, you can specify a custom blob container.</span></span> |
4. <span data-ttu-id="6f018-331">Se os dados de qualquer tipo estão truncados, você pode tentar aumentar o buffer para este tipo de dados ou encurtar o intervalo entre as transferências de dados da máquina virtual para sua conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="6f018-331">If data of any type is truncated, you can try increasing the buffer for that data type or shortening the interval between transfers of data from the virtual machine to your storage account.</span></span>
5. <span data-ttu-id="6f018-332">(opcional) Limpe os dados da conta de armazenamento, ocasionalmente, para reduzir os custos gerais de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="6f018-332">(optional) Purge data from the storage account occasionally to reduce overall storage costs.</span></span>
6. <span data-ttu-id="6f018-333">Quando você faz uma implantação completa, o arquivo diagnostics.cscfg (.wadcfgx do SDK do Azure 2.5) é atualizado no Azure e seu serviço de nuvem seleciona as alterações para a configuração do diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="6f018-333">When you do a full deployment, the diagnostics.cscfg file (.wadcfgx for Azure SDK 2.5) is updated in Azure, and your cloud service picks up any changes to your diagnostics configuration.</span></span> <span data-ttu-id="6f018-334">Se, em vez disso, você atualizar uma implantação existente, o arquivo .cscfg não será atualizado no Azure.</span><span class="sxs-lookup"><span data-stu-id="6f018-334">If you, instead, update an existing deployment, the .cscfg file isn’t updated in Azure.</span></span> <span data-ttu-id="6f018-335">Você ainda pode alterar as configurações de diagnóstico, porém, seguindo as etapas da próxima seção.</span><span class="sxs-lookup"><span data-stu-id="6f018-335">You can still change diagnostics settings, though, by following the steps in the next section.</span></span> <span data-ttu-id="6f018-336">Para obter mais informações sobre como executar uma implantação completa e atualizar uma implantação existente, consulte [Assistente de publicação de aplicativo no Azure](vs-azure-tools-publish-azure-application-wizard.md).</span><span class="sxs-lookup"><span data-stu-id="6f018-336">For more information about performing a full deployment and updating an existing deployment, see [Publish Azure Application Wizard](vs-azure-tools-publish-azure-application-wizard.md).</span></span>

### <a name="to-view-virtual-machine-diagnostics-data"></a><span data-ttu-id="6f018-337">Para exibir dados de diagnóstico de máquina virtual</span><span class="sxs-lookup"><span data-stu-id="6f018-337">To view virtual machine diagnostics data</span></span>
1. <span data-ttu-id="6f018-338">No menu de atalho para a máquina virtual, escolha **Exibir dados de diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="6f018-338">On the shortcut menu for the virtual machine, choose **View Diagnostics Data**.</span></span>
   
    ![Exibir dados de diagnóstico na máquina virtual do Azure](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC766027.png)
   
    <span data-ttu-id="6f018-340">Isso abre a janela **Resumo de diagnóstico** .</span><span class="sxs-lookup"><span data-stu-id="6f018-340">This opens the **Diagnostics summary** window.</span></span>
   
    ![Resumo de diagnóstico de máquina virtual do Azure](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796667.png)  
   
    <span data-ttu-id="6f018-342">Se os dados mais recentes não aparecem, você terá que esperar o período de transferência.</span><span class="sxs-lookup"><span data-stu-id="6f018-342">If the most recent data doesn't appear, you might have to wait for the transfer period to elapse.</span></span>
   
    <span data-ttu-id="6f018-343">Escolha o link **Atualizar** para atualizar os dados imediatamente ou escolha um intervalo na caixa de listagem suspensa **Atualização automática** para ter os dados atualizados automaticamente.</span><span class="sxs-lookup"><span data-stu-id="6f018-343">Choose the **Refresh** link to immediately update the data, or choose an interval in the **Auto-Refresh** dropdown list box to have the data updated automatically.</span></span> <span data-ttu-id="6f018-344">Para exportar os dados de erro, escolha o botão **Exportar para CSV** para criar um arquivo de valores separados por vírgula que pode ser aberto em uma planilha.</span><span class="sxs-lookup"><span data-stu-id="6f018-344">To export the error data, choose the **Export to CSV** button to create a comma-separated value file you can open in a spreadsheet.</span></span>

## <a name="configure-cloud-service-diagnostics-after-deployment"></a><span data-ttu-id="6f018-345">Configurar o diagnóstico de serviço de nuvem após a implantação</span><span class="sxs-lookup"><span data-stu-id="6f018-345">Configure cloud service diagnostics after deployment</span></span>
<span data-ttu-id="6f018-346">Se você estiver investigando um problema com um serviço de nuvem que já está em execução, talvez deseje coletar os dados que não especificou antes de implantar originalmente a função.</span><span class="sxs-lookup"><span data-stu-id="6f018-346">If you're investigating a problem with a cloud service that already running, you might want to collect data that you didn't specify before you originally deployed the role.</span></span> <span data-ttu-id="6f018-347">Nesse caso, você pode começar a coletar dados usando as configurações no Gerenciador de Servidores.</span><span class="sxs-lookup"><span data-stu-id="6f018-347">In this case, you can start to collect that data by using the settings in Server Explorer.</span></span> <span data-ttu-id="6f018-348">Você pode configurar o diagnóstico para uma única instância ou todas as instâncias de uma função, dependendo se você abrir a caixa de diálogo Configuração de diagnóstico no menu de atalho para a instância ou a função.</span><span class="sxs-lookup"><span data-stu-id="6f018-348">You can configure diagnostics for either a single instance or all the instances in a role, depending on whether you open the Diagnostics Configuration dialog box from the shortcut menu for the instance or the role.</span></span> <span data-ttu-id="6f018-349">Se você configurar o nó da função, todas as alterações se aplicam a todas as instâncias.</span><span class="sxs-lookup"><span data-stu-id="6f018-349">If you configure the role node, any changes apply to all instances.</span></span> <span data-ttu-id="6f018-350">Se você configurar o nó da instância, todas as alterações se aplicam a apenas àquela instância.</span><span class="sxs-lookup"><span data-stu-id="6f018-350">If you configure the instance node, any changes apply to that instance only.</span></span>

### <a name="to-configure-diagnostics-for-a-running-cloud-service"></a><span data-ttu-id="6f018-351">Para configurar o diagnóstico para um serviço de nuvem em execução</span><span class="sxs-lookup"><span data-stu-id="6f018-351">To configure diagnostics for a running cloud service</span></span>
1. <span data-ttu-id="6f018-352">No Gerenciador de Servidores, expanda o nó **Serviços de nuvem** e em seguida, expanda os nós para localizar a função ou instância que você deseja investigar ou ambas.</span><span class="sxs-lookup"><span data-stu-id="6f018-352">In Server Explorer, expand the **Cloud Services** node, and then expand nodes to locate the role or instance that you want to investigate or both.</span></span>
   
    ![Configurando o diagnóstico](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC748913.png)
2. <span data-ttu-id="6f018-354">No menu de atalho para um nó da instância ou um nó de função, escolha **Atualizar configurações de diagnóstico**, e, em seguida, escolha as configurações de diagnóstico que você deseja coletar.</span><span class="sxs-lookup"><span data-stu-id="6f018-354">On the shortcut menu for an instance node or a role node, choose **Update Diagnostics Settings**, and then choose the diagnostic settings that you want to collect.</span></span>
   
    <span data-ttu-id="6f018-355">Para obter informações sobre as definições de configuração, consulte **Configurar fontes de dados de diagnóstico** neste tópico.</span><span class="sxs-lookup"><span data-stu-id="6f018-355">For information about the configuration settings, see **Configure diagnostics data sources** in this topic.</span></span> <span data-ttu-id="6f018-356">Para obter informações sobre como exibir os dados de diagnóstico, consulte **Exibir os dados de diagnóstico** neste tópico.</span><span class="sxs-lookup"><span data-stu-id="6f018-356">For information about how to view the diagnostics data, see **View the diagnostics data** in this topic.</span></span>
   
    <span data-ttu-id="6f018-357">Se você alterar a coleta de dados no **Gerenciador de Servidores**, essas alterações permanecerão em vigor até que você reimplante totalmente o seu serviço de nuvem.</span><span class="sxs-lookup"><span data-stu-id="6f018-357">If you change data collection in **Server Explorer**, these changes remain in effect until you fully redeploy your cloud service.</span></span> <span data-ttu-id="6f018-358">Se você usar as configurações de publicação padrão, as alterações não são substituídas, uma vez que a configuração de publicação padrão é atualizar a implantação existente, em vez de fazer uma reimplantação completa.</span><span class="sxs-lookup"><span data-stu-id="6f018-358">If you use the default publish settings, the changes are not overwritten, since the default publish setting is to update the existing deployment, rather than do a full redeployment.</span></span> <span data-ttu-id="6f018-359">Para verificar se as configurações estão limpas no momento da implantação, vá para a guia **Configurações avançadas** no Assistente de publicação e limpe a caixa de seleção **Atualização de implantação** .</span><span class="sxs-lookup"><span data-stu-id="6f018-359">To make sure the settings clear at deployment time, go to the **Advanced Settings** tab in the Publish wizard and clear the **Deployment update** checkbox.</span></span> <span data-ttu-id="6f018-360">Quando você reimplanta com essa caixa de seleção desmarcada, as configurações revertem aquelas no arquivo .wadcfgx (ou wadcfg) conforme definido no Editor de propriedades da função.</span><span class="sxs-lookup"><span data-stu-id="6f018-360">When you redeploy with that checkbox cleared, the settings revert to those in the .wadcfgx (or .wadcfg) file as set through the Properties editor for the role.</span></span> <span data-ttu-id="6f018-361">Se você atualizar a implantação, o Azure mantém as configurações antigas.</span><span class="sxs-lookup"><span data-stu-id="6f018-361">If you update your deployment, Azure keeps the old settings.</span></span>

## <a name="troubleshoot-azure-cloud-service-issues"></a><span data-ttu-id="6f018-362">Solucionar problemas do serviço de nuvem do Azure</span><span class="sxs-lookup"><span data-stu-id="6f018-362">Troubleshoot Azure cloud service issues</span></span>
<span data-ttu-id="6f018-363">Se você tiver problemas com seus projetos de serviço de nuvem, como uma função travar no status "ocupado", repetidamente recicla ou lança um erro interno do servidor, existem ferramentas e técnicas que você pode usar para diagnosticar e corrigir esses problemas.</span><span class="sxs-lookup"><span data-stu-id="6f018-363">If you experience problems with your cloud service projects, such as a role that gets stuck in a "busy" status, repeatedly recycles, or throws an internal server error, there are tools and techniques you can use to diagnose and fix these problems.</span></span> <span data-ttu-id="6f018-364">Para obter exemplos específicos de problemas e soluções comuns, bem como uma visão geral dos conceitos e ferramentas usadas para diagnosticar e corrigir esses erros, consulte [Dados de diagnóstico de computação de PaaS do Azure](http://blogs.msdn.com/b/kwill/archive/2013/08/09/windows-azure-paas-compute-diagnostics-data.aspx).</span><span class="sxs-lookup"><span data-stu-id="6f018-364">For specific examples of common problems and solutions, as well as an overview of the concepts and tools used to diagnose and fix such errors, see [Azure PaaS Compute Diagnostics Data](http://blogs.msdn.com/b/kwill/archive/2013/08/09/windows-azure-paas-compute-diagnostics-data.aspx).</span></span>

## <a name="q--a"></a><span data-ttu-id="6f018-365">Perguntas e respostas</span><span class="sxs-lookup"><span data-stu-id="6f018-365">Q & A</span></span>
<span data-ttu-id="6f018-366">**Qual é o tamanho do buffer e que tamanho o buffer deve ter?**</span><span class="sxs-lookup"><span data-stu-id="6f018-366">**What is the buffer size, and how large should it be?**</span></span>

<span data-ttu-id="6f018-367">Em cada instância de máquina virtual, as cotas limitam quantos dados de diagnóstico podem ser armazenados no sistema de arquivos local.</span><span class="sxs-lookup"><span data-stu-id="6f018-367">On each virtual machine instance, quotas limit how much diagnostic data can be stored on the local file system.</span></span> <span data-ttu-id="6f018-368">Além disso, você pode especificar um tamanho do buffer para cada tipo de dados de diagnóstico disponíveis.</span><span class="sxs-lookup"><span data-stu-id="6f018-368">In addition, you specify a buffer size for each type of diagnostic data that's available.</span></span> <span data-ttu-id="6f018-369">Esse tamanho do buffer age como uma cota individual para esse tipo de dados.</span><span class="sxs-lookup"><span data-stu-id="6f018-369">This buffer size acts like an individual quota for that type of data.</span></span> <span data-ttu-id="6f018-370">Verificando a parte inferior da caixa de diálogo, você pode determinar a cota geral e a quantidade de memória que permanece.</span><span class="sxs-lookup"><span data-stu-id="6f018-370">By checking the bottom of the dialog box, you can determine the overall quota and the amount of memory that remains.</span></span> <span data-ttu-id="6f018-371">Se você especificar buffers maiores ou mais tipos de dados, abordará a cota geral.</span><span class="sxs-lookup"><span data-stu-id="6f018-371">If you specify larger buffers or more types of data, you'll approach the overall quota.</span></span> <span data-ttu-id="6f018-372">Você pode alterar a cota geral modificando o arquivo de configuração diagnostics.wadcfg/.wadcfgx.</span><span class="sxs-lookup"><span data-stu-id="6f018-372">You can change the overall quota by modifying the diagnostics.wadcfg/.wadcfgx configuration file.</span></span> <span data-ttu-id="6f018-373">Os dados de diagnóstico são armazenados no mesmo sistema de arquivos como os dados do seu aplicativo. Portanto, se seu aplicativo usa muito espaço em disco, você não deve aumentar a cota de diagnóstico geral.</span><span class="sxs-lookup"><span data-stu-id="6f018-373">The diagnostics data is stored on the same filesystem as your application’s data, so if your application uses a lot of disk space, you shouldn’t increase the overall diagnostics quota.</span></span>

<span data-ttu-id="6f018-374">**Qual é o período de transferência e por qual tempo deve ser?**</span><span class="sxs-lookup"><span data-stu-id="6f018-374">**What is the transfer period, and how long should it be?**</span></span>

<span data-ttu-id="6f018-375">O período de transferência é a quantidade de tempo que decorreu as capturas de dados.</span><span class="sxs-lookup"><span data-stu-id="6f018-375">The transfer period is the amount of time that elapses between data captures.</span></span> <span data-ttu-id="6f018-376">Depois de cada período de transferência, os dados são movidos do sistema de arquivos local de uma máquina virtual para tabelas em sua conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="6f018-376">After each transfer period, data is moved from the local filesystem on a virtual machine to tables in your storage account.</span></span> <span data-ttu-id="6f018-377">Se a quantidade de dados que são coletados excede a cota antes do final de um período de transferência, dados antigos serão descartados.</span><span class="sxs-lookup"><span data-stu-id="6f018-377">If the amount of data that's collected exceeds the quota before the end of a transfer period, older data is discarded.</span></span> <span data-ttu-id="6f018-378">Você talvez queira reduzir o período de transferência se está perdendo dados porque seus dados excedem o tamanho do buffer ou a cota geral.</span><span class="sxs-lookup"><span data-stu-id="6f018-378">You might want to decrease the transfer period if you're losing data because your data exceeds the buffer size or the overall quota.</span></span>

<span data-ttu-id="6f018-379">**Os carimbos de data/hora estão inseridos em que fuso horário?**</span><span class="sxs-lookup"><span data-stu-id="6f018-379">**What time zone are the time stamps in?**</span></span>

<span data-ttu-id="6f018-380">Os carimbos de data/hora estão no fuso horário local do data center que hospeda o serviço de nuvem.</span><span class="sxs-lookup"><span data-stu-id="6f018-380">The time stamps are in the local time zone of the data center that hosts your cloud service.</span></span> <span data-ttu-id="6f018-381">As seguintes três colunas de carimbo de data/hora nas tabelas de log são usadas.</span><span class="sxs-lookup"><span data-stu-id="6f018-381">The following three timestamp columns in the log tables are used.</span></span>

* <span data-ttu-id="6f018-382">**PreciseTimeStamp** é o carimbo de data/hora de ETW do evento.</span><span class="sxs-lookup"><span data-stu-id="6f018-382">**PreciseTimeStamp** is the ETW timestamp of the event.</span></span> <span data-ttu-id="6f018-383">Ou seja, a hora em que o evento é registrado no cliente.</span><span class="sxs-lookup"><span data-stu-id="6f018-383">That is, the time the event is logged from the client.</span></span>
* <span data-ttu-id="6f018-384">**TIMESTAMP** é o PreciseTimeStamp arredondado para baixo até o limite de frequência de upload.</span><span class="sxs-lookup"><span data-stu-id="6f018-384">**TIMESTAMP** is PreciseTimeStamp rounded down to the upload frequency boundary.</span></span> <span data-ttu-id="6f018-385">Portanto, se a frequência de upload é 5 minutos e a hora do evento 00:17:12, TIMESTAMP será 00:15:00.</span><span class="sxs-lookup"><span data-stu-id="6f018-385">So, if your upload frequency is 5 minutes and the event time 00:17:12, TIMESTAMP will be 00:15:00.</span></span>
* <span data-ttu-id="6f018-386">**Timestamp** é o carimbo de data/hora em que a entidade foi criada na tabela do Azure.</span><span class="sxs-lookup"><span data-stu-id="6f018-386">**Timestamp** is the timestamp at which the entity was created in the Azure table.</span></span>

<span data-ttu-id="6f018-387">**Como gerenciar custos ao coletar informações de diagnóstico?**</span><span class="sxs-lookup"><span data-stu-id="6f018-387">**How do I manage costs when collecting diagnostic information?**</span></span>

<span data-ttu-id="6f018-388">As configurações padrão (**Nível de log** definido como **Erro** e **Período de transferência** definido como **1 minuto**) são projetadas para minimizar os custos.</span><span class="sxs-lookup"><span data-stu-id="6f018-388">The default settings (**Log level** set to **Error** and **Transfer period** set to **1 minute**) are designed to minimize cost.</span></span> <span data-ttu-id="6f018-389">Os custos de computação aumentarão se você coleta mais dados de diagnóstico ou diminui o período de transferência.</span><span class="sxs-lookup"><span data-stu-id="6f018-389">Your compute costs will increase if you collect more diagnostic data or decrease the transfer period.</span></span> <span data-ttu-id="6f018-390">Não colete mais dados do que você precisa e não se esqueça de desabilitar a coleta de dados quando não precisa mais dela.</span><span class="sxs-lookup"><span data-stu-id="6f018-390">Don’t collect more data than you need, and don’t forget to disable data collection when you no longer need it.</span></span> <span data-ttu-id="6f018-391">Você sempre poderá habilitá-lo novamente, mesmo em tempo de execução, conforme mostrado na seção anterior.</span><span class="sxs-lookup"><span data-stu-id="6f018-391">You can always enable it again, even at runtime, as shown in the previous section.</span></span>

<span data-ttu-id="6f018-392">**Como posso coletar logs de solicitação com falha do IIS?**</span><span class="sxs-lookup"><span data-stu-id="6f018-392">**How do I collect failed-request logs from IIS?**</span></span>

<span data-ttu-id="6f018-393">Por padrão, o IIS não coleta logs de solicitação com falha.</span><span class="sxs-lookup"><span data-stu-id="6f018-393">By default, IIS doesn’t collect failed-request logs.</span></span> <span data-ttu-id="6f018-394">Você pode configurar o IIS para coletá-los se editar o arquivo web.config para sua função web.</span><span class="sxs-lookup"><span data-stu-id="6f018-394">You can configure IIS to collect them if you edit the web.config file for your web role.</span></span>

<span data-ttu-id="6f018-395">**Não estou obtendo informações de rastreamento de métodos RoleEntryPoint como OnStart. O que está errado?**</span><span class="sxs-lookup"><span data-stu-id="6f018-395">**I’m not getting trace information from RoleEntryPoint methods like OnStart. What’s wrong?**</span></span>

<span data-ttu-id="6f018-396">Os métodos de RoleEntryPoint são chamados no contexto de WAIISHost.exe, não o IIS.</span><span class="sxs-lookup"><span data-stu-id="6f018-396">The methods of RoleEntryPoint are called in the context of WAIISHost.exe, not IIS.</span></span> <span data-ttu-id="6f018-397">Portanto, as informações de configuração no web.config que normalmente habilitam o rastreamento não se aplicam.</span><span class="sxs-lookup"><span data-stu-id="6f018-397">Therefore, the configuration information in web.config that normally enables tracing doesn’t apply.</span></span> <span data-ttu-id="6f018-398">Para resolver esse problema, adicione um arquivo .config ao seu projeto de função web e nomeie o arquivo para corresponder ao assembly de saída que contém o código RoleEntryPoint.</span><span class="sxs-lookup"><span data-stu-id="6f018-398">To resolve this issue, add a .config file to your web role project, and name the file to match the output assembly that contains the RoleEntryPoint code.</span></span> <span data-ttu-id="6f018-399">No projeto de função web padrão, o nome do arquivo .config seria WAIISHost.exe.config. Em seguida, adicione as seguintes linhas ao arquivo:</span><span class="sxs-lookup"><span data-stu-id="6f018-399">In the default web role project, the name of the .config file would be WAIISHost.exe.config. Then add the following lines to this file:</span></span>

```
<system.diagnostics>
  <trace>
      <listeners>
          <add name “AzureDiagnostics” type=”Microsoft.WindowsAzure.Diagnostics.DiagnosticMonitorTraceListener”>
              <filter type=”” />
          </add>
      </listeners>
  </trace>
</system.diagnostics>
```

<span data-ttu-id="6f018-400">Agora, na janela **Propriedades**, defina a propriedade **Copiar para Diretório de saída** como **Copiar sempre**.</span><span class="sxs-lookup"><span data-stu-id="6f018-400">Now, in the **Properties** window, set the **Copy to Output Directory** property to **Copy always**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="6f018-401">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="6f018-401">Next steps</span></span>
<span data-ttu-id="6f018-402">Para saber mais sobre o registro em log de diagnósticos no Azure, consulte [Habilitando o diagnóstico nos Serviços de Nuvem do Azure e Máquinas Virtuais](cloud-services/cloud-services-dotnet-diagnostics.md) e [Habilitar o registro em log de diagnóstico para aplicativos Web no Serviço de Aplicativo do Azure](app-service-web/web-sites-enable-diagnostic-log.md).</span><span class="sxs-lookup"><span data-stu-id="6f018-402">To learn more about diagnostics logging in Azure, see [Enabling Diagnostics in Azure Cloud Services and Virtual Machines](cloud-services/cloud-services-dotnet-diagnostics.md) and [Enable diagnostics logging for web apps in Azure App Service](app-service-web/web-sites-enable-diagnostic-log.md).</span></span>

