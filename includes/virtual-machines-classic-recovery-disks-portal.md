<span data-ttu-id="c41a8-101">Se ocorrer um erro de disco ou de inicialização na VM (máquina virtual) no Azure, talvez você precise realizar etapas de solução de problemas no próprio disco rígido virtual.</span><span class="sxs-lookup"><span data-stu-id="c41a8-101">If your virtual machine (VM) in Azure encounters a boot or disk error, you may need to perform troubleshooting steps on the virtual hard disk itself.</span></span> <span data-ttu-id="c41a8-102">Um exemplo comum seria uma atualização de aplicativo com falha que impede a inicialização bem-sucedida da VM.</span><span class="sxs-lookup"><span data-stu-id="c41a8-102">A common example would be a failed application update that prevents the VM from booting successfully.</span></span> <span data-ttu-id="c41a8-103">Este artigo descreve como usar o portal do Azure para conectar o disco rígido virtual a outra VM para corrigir erros e recriar a VM original.</span><span class="sxs-lookup"><span data-stu-id="c41a8-103">This article describes how to use Azure portal to connect your virtual hard disk to another VM to fix any errors and then re-create your original VM.</span></span>

## <a name="recovery-process-overview"></a><span data-ttu-id="c41a8-104">Visão geral do processo de recuperação</span><span class="sxs-lookup"><span data-stu-id="c41a8-104">Recovery process overview</span></span>
<span data-ttu-id="c41a8-105">O processo de solução de problemas é o seguinte:</span><span class="sxs-lookup"><span data-stu-id="c41a8-105">The troubleshooting process is as follows:</span></span>

1. <span data-ttu-id="c41a8-106">Exclua a máquina virtual que está tendo problemas, mas mantenha os discos rígidos virtuais.</span><span class="sxs-lookup"><span data-stu-id="c41a8-106">Delete the VM that's encountering issues, but retain the virtual hard disks.</span></span>
2. <span data-ttu-id="c41a8-107">Anexe e monte o disco rígido virtual em outra VM para solucionar problemas.</span><span class="sxs-lookup"><span data-stu-id="c41a8-107">Attach and mount the virtual hard disk to another VM for troubleshooting.</span></span>
3. <span data-ttu-id="c41a8-108">Conecte-se à VM de solução de problemas.</span><span class="sxs-lookup"><span data-stu-id="c41a8-108">Connect to the troubleshooting VM.</span></span> <span data-ttu-id="c41a8-109">Edite os arquivos ou execute as ferramentas para corrigir erros no disco rígido virtual original.</span><span class="sxs-lookup"><span data-stu-id="c41a8-109">Edit files or run tools to fix errors on the original virtual hard disk.</span></span>
4. <span data-ttu-id="c41a8-110">Desmonte e desanexe o disco rígido virtual da VM de solução de problemas.</span><span class="sxs-lookup"><span data-stu-id="c41a8-110">Unmount and detach the virtual hard disk from the troubleshooting VM.</span></span>
5. <span data-ttu-id="c41a8-111">Crie uma VM usando o disco rígido virtual original.</span><span class="sxs-lookup"><span data-stu-id="c41a8-111">Create a VM by using the original virtual hard disk.</span></span>

## <a name="delete-the-original-vm"></a><span data-ttu-id="c41a8-112">Excluir a VM original</span><span class="sxs-lookup"><span data-stu-id="c41a8-112">Delete the original VM</span></span>
<span data-ttu-id="c41a8-113">Discos rígidos virtuais e VMs são dois recursos distintos no Azure.</span><span class="sxs-lookup"><span data-stu-id="c41a8-113">Virtual hard disks and VMs are two distinct resources in Azure.</span></span> <span data-ttu-id="c41a8-114">Um disco rígido virtual é o local em que o sistema operacional, os aplicativos e as configurações são armazenados.</span><span class="sxs-lookup"><span data-stu-id="c41a8-114">A virtual hard disk is where the operating system, applications, and configurations are stored.</span></span> <span data-ttu-id="c41a8-115">A VM é apenas os metadados que definem o tamanho ou a localização e que fazem referência a recursos como um disco rígido virtual ou a NIC (placa de interface de rede) virtual.</span><span class="sxs-lookup"><span data-stu-id="c41a8-115">The VM is just metadata that defines the size or location and that references resources such as a virtual hard disk or virtual network interface card (NIC).</span></span> <span data-ttu-id="c41a8-116">Cada disco rígido virtual recebe a atribuição de uma concessão quando o disco é anexado a uma máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="c41a8-116">Each virtual hard disk gets a lease assigned when that disk is attached to a VM.</span></span> <span data-ttu-id="c41a8-117">Embora os discos de dados possam ser anexados e desanexados mesmo durante a execução da VM, o disco do sistema operacional não pode ser desanexado, a menos que o recurso de VM seja excluído.</span><span class="sxs-lookup"><span data-stu-id="c41a8-117">Although data disks can be attached and detached even while the VM is running, the OS disk cannot be detached unless the VM resource is deleted.</span></span> <span data-ttu-id="c41a8-118">A concessão continua associando o disco do sistema operacional a uma VM mesmo quando a VM está em um estado parado e desalocado.</span><span class="sxs-lookup"><span data-stu-id="c41a8-118">The lease continues to associate the OS disk to a VM even when that VM is in a stopped and deallocated state.</span></span>

<span data-ttu-id="c41a8-119">A primeira etapa para recuperar a VM é excluir o recurso de VM em si.</span><span class="sxs-lookup"><span data-stu-id="c41a8-119">The first step to recovering your VM is to delete the VM resource itself.</span></span> <span data-ttu-id="c41a8-120">A exclusão da VM deixa os discos rígidos virtuais na conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c41a8-120">Deleting the VM leaves the virtual hard disks in your storage account.</span></span> <span data-ttu-id="c41a8-121">Depois que a VM for excluída, você pode anexar o disco rígido virtual a outra VM para solucionar os erros.</span><span class="sxs-lookup"><span data-stu-id="c41a8-121">After the VM is deleted, you can attach the virtual hard disk to another VM to troubleshoot and resolve the errors.</span></span> 

1. <span data-ttu-id="c41a8-122">Entre no [Portal do Azure](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="c41a8-122">Sign in to the [Azure portal](https://portal.azure.com).</span></span> 
2. <span data-ttu-id="c41a8-123">No menu à esquerda, clique em **Máquinas Virtuais (clássicas)**.</span><span class="sxs-lookup"><span data-stu-id="c41a8-123">On the menu on the left side, click **Virtual Machines (classic)**.</span></span>
3. <span data-ttu-id="c41a8-124">Selecione a máquina virtual que tem o problema, clique em **Discos** e identifique o nome do disco rígido virtual.</span><span class="sxs-lookup"><span data-stu-id="c41a8-124">Select the VM that has the problem, click **Disks**, and then identify the name of the virtual hard disk.</span></span> 
4. <span data-ttu-id="c41a8-125">Selecione o disco rígido virtual do sistema operacional e verifique o **Local** para identificar a conta de armazenamento que contém o disco rígido virtual.</span><span class="sxs-lookup"><span data-stu-id="c41a8-125">Select the OS virtual hard disk and check the **Location** to identify the storage account that contains that virtual hard disk.</span></span> <span data-ttu-id="c41a8-126">No exemplo a seguir, a cadeia de caracteres imediatamente antes de “.blob.core.windows.net“ é o nome da conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c41a8-126">In the following example, the string immediately before ".blob.core.windows.net" is the storage account name.</span></span>

    ```
    https://portalvhds73fmhrw5xkp43.blob.core.windows.net/vhds/SCCM2012-2015-08-28.vhd
    ```

    ![A imagem sobre o local da VM](./media/virtual-machines-classic-recovery-disks-portal/vm-location.png)

5. <span data-ttu-id="c41a8-128">Clique com o botão direito do mouse na máquina virtual e selecione **Excluir**.</span><span class="sxs-lookup"><span data-stu-id="c41a8-128">Right-click the VM and then select **Delete**.</span></span> <span data-ttu-id="c41a8-129">Verifique se os discos não estão selecionados ao excluir a máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="c41a8-129">Make sure that the disks are not selected when you delete the VM.</span></span>
6. <span data-ttu-id="c41a8-130">Crie uma nova VM de recuperação.</span><span class="sxs-lookup"><span data-stu-id="c41a8-130">Create a new recovery VM.</span></span> <span data-ttu-id="c41a8-131">Essa VM deve estar na mesma região e no mesmo grupo de recursos (Serviço de Nuvem) da VM com problemas.</span><span class="sxs-lookup"><span data-stu-id="c41a8-131">This VM must be in the same region and resource group (Cloud Service) as the problem VM.</span></span>
7. <span data-ttu-id="c41a8-132">Selecione a VM de recuperação e clique em **Discos** > **Anexar Existente**.</span><span class="sxs-lookup"><span data-stu-id="c41a8-132">Select the recovery VM, and then select **Disks** > **Attach Existing**.</span></span>
8. <span data-ttu-id="c41a8-133">Para selecionar o disco rígido virtual existente, clique em **Arquivo VHD**:</span><span class="sxs-lookup"><span data-stu-id="c41a8-133">To select your existing virtual hard disk, click **VHD File**:</span></span>

    ![Procurar VHD existente](./media/virtual-machines-classic-recovery-disks-portal/select-vhd-location.png)

9. <span data-ttu-id="c41a8-135">Selecione a conta de armazenamento > contêiner VHD > disco rígido virtual e clique no botão **Selecionar** para confirmar sua escolha.</span><span class="sxs-lookup"><span data-stu-id="c41a8-135">Select the storage account > VHD container > the virtual hard disk, click the **Select** button to confirm your choice.</span></span>

    ![Selecionar o VHD existente](./media/virtual-machines-classic-recovery-disks-portal/select-vhd.png)

10. <span data-ttu-id="c41a8-137">Com o VHD agora selecionado, clique e **OK** para anexar o disco rígido virtual existente.</span><span class="sxs-lookup"><span data-stu-id="c41a8-137">With your VHD now selected, select **OK** to attach the existing virtual hard disk.</span></span>
11. <span data-ttu-id="c41a8-138">Depois de alguns segundos, o painel **Discos** da VM exibe o disco rígido virtual existente conectado como um disco de dados:</span><span class="sxs-lookup"><span data-stu-id="c41a8-138">After a few seconds, the **Disks** pane for your VM will display your existing virtual hard disk connected as a data disk:</span></span>

    ![Disco rígido virtual existente anexado como um disco de dados](./media/virtual-machines-classic-recovery-disks-portal/attached-disk.png)

## <a name="fix-issues-on-the-original-virtual-hard-disk"></a><span data-ttu-id="c41a8-140">Corrigir problemas no disco rígido virtual original</span><span class="sxs-lookup"><span data-stu-id="c41a8-140">Fix issues on the original virtual hard disk</span></span>
<span data-ttu-id="c41a8-141">Quando o disco rígido virtual existente é montado, você pode realizar as etapas de manutenção e solução de problemas necessárias.</span><span class="sxs-lookup"><span data-stu-id="c41a8-141">When the existing virtual hard disk is mounted, you can now perform any maintenance and troubleshooting steps as needed.</span></span> <span data-ttu-id="c41a8-142">Depois de resolver os problemas, continue com as próximas etapas.</span><span class="sxs-lookup"><span data-stu-id="c41a8-142">Once you have addressed the issues, continue with the following steps.</span></span>

## <a name="unmount-and-detach-the-original-virtual-hard-disk"></a><span data-ttu-id="c41a8-143">Desmontar e desanexar o disco rígido virtual original</span><span class="sxs-lookup"><span data-stu-id="c41a8-143">Unmount and detach the original virtual hard disk</span></span>
<span data-ttu-id="c41a8-144">Depois de resolver os erros, desmonte e desanexe o disco rígido virtual existente da VM de solução de problemas.</span><span class="sxs-lookup"><span data-stu-id="c41a8-144">Once any errors are resolved, unmount and detach the existing virtual hard disk from your troubleshooting VM.</span></span> <span data-ttu-id="c41a8-145">Não é possível usar o disco rígido virtual com nenhuma outra VM até que a concessão que anexa o disco rígido virtual à VM de solução de problemas seja liberada.</span><span class="sxs-lookup"><span data-stu-id="c41a8-145">You cannot use your virtual hard disk together with any other VM until the lease that attaches the virtual hard disk to the troubleshooting VM is released.</span></span>  

1. <span data-ttu-id="c41a8-146">Entre no [Portal do Azure](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="c41a8-146">Sign in to the [Azure portal](https://portal.azure.com).</span></span> 
2. <span data-ttu-id="c41a8-147">No menu à esquerda, selecione **Máquinas Virtuais (clássicas)**.</span><span class="sxs-lookup"><span data-stu-id="c41a8-147">On the menu on the left side, select **Virtual Machines (classic)**.</span></span>
3. <span data-ttu-id="c41a8-148">Localize a VM de recuperação.</span><span class="sxs-lookup"><span data-stu-id="c41a8-148">Locate the recovery VM.</span></span> <span data-ttu-id="c41a8-149">Selecione os discos, clique com o botão direito do mouse no disco e clique em **Desanexar**.</span><span class="sxs-lookup"><span data-stu-id="c41a8-149">Select Disks, right-click the disk, and then select **Detach**.</span></span>

## <a name="create-a-vm-from-the-original-hard-disk"></a><span data-ttu-id="c41a8-150">Criar uma máquina virtual do disco rígido original</span><span class="sxs-lookup"><span data-stu-id="c41a8-150">Create a VM from the original hard disk</span></span>

<span data-ttu-id="c41a8-151">Para criar uma VM com base no disco rígido virtual original, use o [portal clássico do Azure](https://manage.windowsazure.com).</span><span class="sxs-lookup"><span data-stu-id="c41a8-151">To create a VM from your original virtual hard disk, use [Azure classic portal](https://manage.windowsazure.com).</span></span>

1. <span data-ttu-id="c41a8-152">Entre no [portal clássico do Azure](https://manage.windowsazure.com).</span><span class="sxs-lookup"><span data-stu-id="c41a8-152">Sign into [Azure classic portal](https://manage.windowsazure.com).</span></span>
2. <span data-ttu-id="c41a8-153">Na parte inferior do portal, selecione **Novo** > **Computação** > **Máquina Virtual** > **Da Galeria**.</span><span class="sxs-lookup"><span data-stu-id="c41a8-153">At the bottom of the portal, select **New** > **Compute** > **Virtual Machine** > **From Gallery**.</span></span>
3. <span data-ttu-id="c41a8-154">Na seção **Escolher uma Imagem**, clique em **Meus discos** e selecione o disco rígido virtual original.</span><span class="sxs-lookup"><span data-stu-id="c41a8-154">In the **Choose an Image** section, select **My disks**, and then select the original virtual hard disk.</span></span> <span data-ttu-id="c41a8-155">Verifique as informações de local.</span><span class="sxs-lookup"><span data-stu-id="c41a8-155">Check the location information.</span></span> <span data-ttu-id="c41a8-156">É a região em que a máquina virtual deve ser implantada.</span><span class="sxs-lookup"><span data-stu-id="c41a8-156">This is the region where the VM must be deployed.</span></span> <span data-ttu-id="c41a8-157">Clique no botão Avançar.</span><span class="sxs-lookup"><span data-stu-id="c41a8-157">Select the next button.</span></span>
4. <span data-ttu-id="c41a8-158">Na seção **Configuração de máquina Virtual**, digite o nome da VM e selecione um tamanho para a máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="c41a8-158">In the **Virtual machine configuration** section, type the VM name and select a size for the VM.</span></span>