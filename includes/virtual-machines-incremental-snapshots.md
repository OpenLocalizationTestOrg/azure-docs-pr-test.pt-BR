# <a name="back-up-azure-unmanaged-vm-disks-with-incremental-snapshots"></a><span data-ttu-id="cefcf-101">Faça backup dos discos não gerenciados de VM do Azure com instantâneos incrementais</span><span class="sxs-lookup"><span data-stu-id="cefcf-101">Back up Azure unmanaged VM disks with incremental snapshots</span></span>
## <a name="overview"></a><span data-ttu-id="cefcf-102">Visão geral</span><span class="sxs-lookup"><span data-stu-id="cefcf-102">Overview</span></span>
<span data-ttu-id="cefcf-103">O Armazenamento do Azure oferece a capacidade de fazer instantâneos dos blobs.</span><span class="sxs-lookup"><span data-stu-id="cefcf-103">Azure Storage provides the capability to take snapshots of blobs.</span></span> <span data-ttu-id="cefcf-104">Os instantâneos capturam o estado do blob no momento em questão.</span><span class="sxs-lookup"><span data-stu-id="cefcf-104">Snapshots capture the blob state at that point in time.</span></span> <span data-ttu-id="cefcf-105">Neste artigo, descrevemos um cenário no qual você pode manter backups dos discos de máquinas virtuais usando instantâneos.</span><span class="sxs-lookup"><span data-stu-id="cefcf-105">In this article, we describe a scenario in which you can maintain backups of virtual machine disks using snapshots.</span></span> <span data-ttu-id="cefcf-106">Você pode usar essa metodologia quando optar por não usar o Serviço de Backup e Recuperação do Azure e desejar criar uma estratégia de backup personalizada para seus discos da máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="cefcf-106">You can use this methodology when you choose not to use Azure Backup and Recovery Service, and wish to create a custom backup strategy for your virtual machine disks.</span></span>

<span data-ttu-id="cefcf-107">Os discos de máquinas virtuais do Azure são armazenados como blobs de página no Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="cefcf-107">Azure virtual machine disks are stored as page blobs in Azure Storage.</span></span> <span data-ttu-id="cefcf-108">Como estamos descrevendo uma estratégia de backup para discos de máquina virtual neste artigo, faremos referência aos instantâneos no contexto dos blobs de página.</span><span class="sxs-lookup"><span data-stu-id="cefcf-108">Since we are describing a backup strategy for virtual machine disks in this article, we refer to snapshots in the context of page blobs.</span></span> <span data-ttu-id="cefcf-109">Para saber mais sobre instantâneos, consulte [Criando um instantâneo de um Blob](https://docs.microsoft.com/rest/api/storageservices/Creating-a-Snapshot-of-a-Blob).</span><span class="sxs-lookup"><span data-stu-id="cefcf-109">To learn more about snapshots, refer to [Creating a Snapshot of a Blob](https://docs.microsoft.com/rest/api/storageservices/Creating-a-Snapshot-of-a-Blob).</span></span>

## <a name="what-is-a-snapshot"></a><span data-ttu-id="cefcf-110">O que é um instantâneo?</span><span class="sxs-lookup"><span data-stu-id="cefcf-110">What is a snapshot?</span></span>
<span data-ttu-id="cefcf-111">Um instantâneo de blob é uma versão somente leitura de um blob capturada em um dado momento.</span><span class="sxs-lookup"><span data-stu-id="cefcf-111">A blob snapshot is a read-only version of a blob that is captured at a point in time.</span></span> <span data-ttu-id="cefcf-112">Quando um instantâneo tiver sido criado, ele pode ser lido, copiado ou excluído, mas não modificado.</span><span class="sxs-lookup"><span data-stu-id="cefcf-112">Once a snapshot has been created, it can be read, copied, or deleted, but not modified.</span></span> <span data-ttu-id="cefcf-113">Os instantâneos fornecem uma maneira de fazer backup de um blob da maneira como ele aparece em um momento específico.</span><span class="sxs-lookup"><span data-stu-id="cefcf-113">Snapshots provide a way to back up a blob as it appears at a moment in time.</span></span> <span data-ttu-id="cefcf-114">Até a versão 2015-04-05 do REST você podia copiar instantâneos completos.</span><span class="sxs-lookup"><span data-stu-id="cefcf-114">Until REST version 2015-04-05, you had the ability to copy full snapshots.</span></span> <span data-ttu-id="cefcf-115">Com a versão 2015-07-08 do REST e as versões superiores, você pode copiar instantâneos incrementais.</span><span class="sxs-lookup"><span data-stu-id="cefcf-115">With the REST version 2015-07-08 and above, you can also copy incremental snapshots.</span></span>

## <a name="full-snapshot-copy"></a><span data-ttu-id="cefcf-116">Cópia de instantâneo completo</span><span class="sxs-lookup"><span data-stu-id="cefcf-116">Full snapshot copy</span></span>
<span data-ttu-id="cefcf-117">Instantâneos podem ser copiados para outra conta de armazenamento como um blob para manter backups do blob de base.</span><span class="sxs-lookup"><span data-stu-id="cefcf-117">Snapshots can be copied to another storage account as a blob to keep backups of the base blob.</span></span> <span data-ttu-id="cefcf-118">Você também pode copiar um instantâneo sobre seu blob de base, que é semelhante a restaurar o blob para uma versão anterior.</span><span class="sxs-lookup"><span data-stu-id="cefcf-118">You can also copy a snapshot over its base blob, which is like restoring the blob to an earlier version.</span></span> <span data-ttu-id="cefcf-119">Quando um instantâneo é copiado de uma conta de armazenamento para outra, ele ocupa o mesmo espaço que o blob de páginas de base.</span><span class="sxs-lookup"><span data-stu-id="cefcf-119">When a snapshot is copied from one storage account to another, it occupies the same space as the base page blob.</span></span> <span data-ttu-id="cefcf-120">Portanto, copiar instantâneos inteiros de uma conta de armazenamento para outra é um processo lento que consume muito espaço na conta de armazenamento de destino.</span><span class="sxs-lookup"><span data-stu-id="cefcf-120">Therefore, copying whole snapshots from one storage account to another is slow and consumes much space in the target storage account.</span></span>

> [!NOTE]
> <span data-ttu-id="cefcf-121">Se você copiar o blob de base para outro destino, os instantâneos do blob não serão copiados com ele.</span><span class="sxs-lookup"><span data-stu-id="cefcf-121">If you copy the base blob to another destination, the snapshots of the blob are not copied along with it.</span></span> <span data-ttu-id="cefcf-122">Da mesma forma, se você substituir um blob de base por uma cópia, os instantâneos associados ao blob de base não serão afetados e permanecerão intactos com o nome do blob de base.</span><span class="sxs-lookup"><span data-stu-id="cefcf-122">Similarly, if you overwrite a base blob with a copy, snapshots associated with the base blob are not affected and stay intact under the base blob name.</span></span>
> 
> 

### <a name="back-up-disks-using-snapshots"></a><span data-ttu-id="cefcf-123">Fazer backup de discos usando instantâneos</span><span class="sxs-lookup"><span data-stu-id="cefcf-123">Back up disks using snapshots</span></span>
<span data-ttu-id="cefcf-124">Como estratégia de backup para seus discos de máquina virtual, você pode fazer instantâneos periódicos do blob de páginas ou de disco e copiá-los para outra conta de armazenamento usando ferramentas como a operação [Copiar Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) ou [AzCopy](../articles/storage/common/storage-use-azcopy.md).</span><span class="sxs-lookup"><span data-stu-id="cefcf-124">As a backup strategy for your virtual machine disks, you can take periodic snapshots of the disk or page blob, and copy them to another storage account using tools like [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) operation or [AzCopy](../articles/storage/common/storage-use-azcopy.md).</span></span> <span data-ttu-id="cefcf-125">Você pode copiar um instantâneo para um blob de páginas de destino com um nome diferente.</span><span class="sxs-lookup"><span data-stu-id="cefcf-125">You can copy a snapshot to a destination page blob with a different name.</span></span> <span data-ttu-id="cefcf-126">O blob de páginas de destino resultante é um blob de páginas gravável, e não um instantâneo.</span><span class="sxs-lookup"><span data-stu-id="cefcf-126">The resulting destination page blob is a writeable page blob and not a snapshot.</span></span> <span data-ttu-id="cefcf-127">Mais adiante neste artigo, descreveremos as etapas para fazer backups dos discos de máquinas virtuais usando instantâneos.</span><span class="sxs-lookup"><span data-stu-id="cefcf-127">Later in this article, we describe steps to take backups of virtual machine disks using snapshots.</span></span>

### <a name="restore-disks-using-snapshots"></a><span data-ttu-id="cefcf-128">Restaurar discos usando instantâneos</span><span class="sxs-lookup"><span data-stu-id="cefcf-128">Restore disks using snapshots</span></span>
<span data-ttu-id="cefcf-129">Quando for o momento de restaurar o disco para uma versão estável que foi anteriormente capturada em um dos instantâneos de backup, você pode copiar um instantâneo sobre o blob de páginas de base.</span><span class="sxs-lookup"><span data-stu-id="cefcf-129">When it is time to restore your disk to a stable version that was previously captured in one of the backup snapshots, you can copy a snapshot over the base page blob.</span></span> <span data-ttu-id="cefcf-130">Após ser promovido a blob de páginas de base, o instantâneo permanece, mas sua origem é substituída por uma cópia que pode ser lida e gravada.</span><span class="sxs-lookup"><span data-stu-id="cefcf-130">After the snapshot is promoted to the base page blob, the snapshot remains, but its source is overwritten with a copy that can be both read and written.</span></span> <span data-ttu-id="cefcf-131">Mais adiante neste artigo, descreveremos as etapas para restaurar uma versão anterior do disco por meio do instantâneo.</span><span class="sxs-lookup"><span data-stu-id="cefcf-131">Later in this article we describe steps to restore a previous version of your disk from its snapshot.</span></span>

### <a name="implementing-full-snapshot-copy"></a><span data-ttu-id="cefcf-132">Implementando uma cópia completa do instantâneo</span><span class="sxs-lookup"><span data-stu-id="cefcf-132">Implementing full snapshot copy</span></span>
<span data-ttu-id="cefcf-133">Você pode implementar uma cópia completa do instantâneo fazendo o seguinte</span><span class="sxs-lookup"><span data-stu-id="cefcf-133">You can implement a full snapshot copy by doing the following,</span></span>

* <span data-ttu-id="cefcf-134">Primeiro, faça um instantâneo do blob de base usando a operação de [Snapshot Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) .</span><span class="sxs-lookup"><span data-stu-id="cefcf-134">First, take a snapshot of the base blob using the [Snapshot Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) operation.</span></span>
* <span data-ttu-id="cefcf-135">Em seguida, copie o instantâneo para uma conta de armazenamento de destino usando [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span><span class="sxs-lookup"><span data-stu-id="cefcf-135">Then, copy the snapshot to a target storage account using [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span></span>
* <span data-ttu-id="cefcf-136">Repita esse processo para manter cópias de backup de seu blob de base.</span><span class="sxs-lookup"><span data-stu-id="cefcf-136">Repeat this process to maintain backup copies of your base blob.</span></span>

## <a name="incremental-snapshot-copy"></a><span data-ttu-id="cefcf-137">Cópia de instantâneo incremental</span><span class="sxs-lookup"><span data-stu-id="cefcf-137">Incremental snapshot copy</span></span>
<span data-ttu-id="cefcf-138">O novo recurso na API [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) é uma maneira muito melhor para fazer backup de instantâneos de seus blobs de página ou discos.</span><span class="sxs-lookup"><span data-stu-id="cefcf-138">The new feature in the [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) API provides a much better way to back up the snapshots of your page blobs or disks.</span></span> <span data-ttu-id="cefcf-139">A API retorna a lista de alterações entre o blob de base e os instantâneos, o que reduz a quantidade de espaço de armazenamento usada na conta de backup.</span><span class="sxs-lookup"><span data-stu-id="cefcf-139">The API returns the list of changes between the base blob and the snapshots, which reduces the amount of storage space used on the backup account.</span></span> <span data-ttu-id="cefcf-140">A API dá suporte a blobs de página no Armazenamento Premium e no Armazenamento Standard.</span><span class="sxs-lookup"><span data-stu-id="cefcf-140">The API supports page blobs on Premium Storage as well as Standard Storage.</span></span> <span data-ttu-id="cefcf-141">Com essa API, você pode criar soluções de backup mais rápidas e eficientes para VMs do Azure.</span><span class="sxs-lookup"><span data-stu-id="cefcf-141">Using this API, you can build faster and more efficient backup solutions for Azure VMs.</span></span> <span data-ttu-id="cefcf-142">Essa API será disponibilizada com o REST versão 2015-07-08 ou superior.</span><span class="sxs-lookup"><span data-stu-id="cefcf-142">This API will be available with the REST version 2015-07-08 and higher.</span></span>

<span data-ttu-id="cefcf-143">A Cópia de instantâneo incremental permite copiar de uma conta de armazenamento para outra a diferença entre:</span><span class="sxs-lookup"><span data-stu-id="cefcf-143">Incremental Snapshot Copy allows you to copy from one storage account to another the difference between,</span></span>

* <span data-ttu-id="cefcf-144">o blob de base e seu instantâneo OU</span><span class="sxs-lookup"><span data-stu-id="cefcf-144">Base blob and its Snapshot OR</span></span>
* <span data-ttu-id="cefcf-145">quaisquer dois instantâneos do blob de base</span><span class="sxs-lookup"><span data-stu-id="cefcf-145">Any two snapshots of the base blob</span></span>

<span data-ttu-id="cefcf-146">Se as condições a seguir forem atendidas,</span><span class="sxs-lookup"><span data-stu-id="cefcf-146">Provided the following conditions are met,</span></span>

* <span data-ttu-id="cefcf-147">O blob foi criado em 1º de janeiro de 2016 ou posteriormente.</span><span class="sxs-lookup"><span data-stu-id="cefcf-147">The blob was created on Jan-1-2016 or later.</span></span>
* <span data-ttu-id="cefcf-148">O blob não foi substituído por [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) ou [Copiar Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) entre dois instantâneos.</span><span class="sxs-lookup"><span data-stu-id="cefcf-148">The blob was not overwritten with [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) or [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) between two snapshots.</span></span>

<span data-ttu-id="cefcf-149">**Observação**: este recurso está disponível para os Blobs de Página do Azure Premium e Standard.</span><span class="sxs-lookup"><span data-stu-id="cefcf-149">**Note**: This feature is available for Premium and Standard Azure Page Blobs.</span></span>

<span data-ttu-id="cefcf-150">Quando você tem uma estratégia de backup personalizada usando instantâneos, copiar os instantâneos de uma conta de armazenamento para outra pode ser um processo lento que consome muito espaço de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="cefcf-150">When you have a custom backup strategy using snapshots, copying the snapshots from one storage account to another can be slow and can consume much storage space.</span></span> <span data-ttu-id="cefcf-151">Em vez de copiar todo o instantâneo para uma conta de armazenamento de backup, você pode gravar a diferença em um blob de páginas de backup.</span><span class="sxs-lookup"><span data-stu-id="cefcf-151">Instead of copying the entire snapshot to a backup storage account, you can write the difference between consecutive snapshots to a backup page blob.</span></span> <span data-ttu-id="cefcf-152">Dessa forma, o tempo para copiar e o espaço para armazenar backups são reduzidos substancialmente.</span><span class="sxs-lookup"><span data-stu-id="cefcf-152">This way, the time to copy and the space to store backups is substantially reduced.</span></span>

### <a name="implementing-incremental-snapshot-copy"></a><span data-ttu-id="cefcf-153">Implementando a Cópia de instantâneo incremental</span><span class="sxs-lookup"><span data-stu-id="cefcf-153">Implementing Incremental Snapshot Copy</span></span>
<span data-ttu-id="cefcf-154">Você pode implementar a cópia de instantâneo incremental fazendo o seguinte</span><span class="sxs-lookup"><span data-stu-id="cefcf-154">You can implement incremental snapshot copy by doing the following,</span></span>

* <span data-ttu-id="cefcf-155">Faça um instantâneo do blob de base usando [Snapshot Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob).</span><span class="sxs-lookup"><span data-stu-id="cefcf-155">Take a snapshot of the base blob using [Snapshot Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob).</span></span>
* <span data-ttu-id="cefcf-156">Em seguida, copie o instantâneo para uma conta de armazenamento de backup de destino usando [Copiar Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span><span class="sxs-lookup"><span data-stu-id="cefcf-156">Copy the snapshot to the target backup storage account using [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span></span> <span data-ttu-id="cefcf-157">Esse é o blob de páginas de backup.</span><span class="sxs-lookup"><span data-stu-id="cefcf-157">This is the backup page blob.</span></span> <span data-ttu-id="cefcf-158">Tire um instantâneo do blob de páginas de backup e armazene-o na conta de backup.</span><span class="sxs-lookup"><span data-stu-id="cefcf-158">Take a snapshot of the backup page blob and store it in the backup account.</span></span>
* <span data-ttu-id="cefcf-159">Faça outro instantâneo do blob de base usando Blob de Instantâneo.</span><span class="sxs-lookup"><span data-stu-id="cefcf-159">Take another snapshot of the base blob using Snapshot Blob.</span></span>
* <span data-ttu-id="cefcf-160">Obtenha a diferença entre o primeiro e o segundo instantâneo do blob de base usando [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges).</span><span class="sxs-lookup"><span data-stu-id="cefcf-160">Get the difference between the first and second snapshots of the base blob using [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges).</span></span> <span data-ttu-id="cefcf-161">Use o novo parâmetro **prevsnapshot** para especificar o valor de DateTime do instantâneo do qual você deseja obter a diferença.</span><span class="sxs-lookup"><span data-stu-id="cefcf-161">Use the new parameter **prevsnapshot**, to specify the DateTime value of the snapshot you want to get the difference with.</span></span> <span data-ttu-id="cefcf-162">Quando esse parâmetro estiver presente, a resposta REST inclui apenas as páginas que foram alteradas entre o instantâneo de destino e o instantâneo anterior, incluindo páginas em branco.</span><span class="sxs-lookup"><span data-stu-id="cefcf-162">When this parameter is present, the REST response includes only the pages that were changed between target snapshot and previous snapshot including clear pages.</span></span>
* <span data-ttu-id="cefcf-163">Use [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) para aplicar essas alterações ao blob de páginas de backup.</span><span class="sxs-lookup"><span data-stu-id="cefcf-163">Use [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) to apply these changes to the backup page blob.</span></span>
* <span data-ttu-id="cefcf-164">Por fim, tire um instantâneo do blob de páginas de backup e armazene-o na conta de armazenamento de backup.</span><span class="sxs-lookup"><span data-stu-id="cefcf-164">Finally, take a snapshot of the backup page blob and store it in the backup storage account.</span></span>

<span data-ttu-id="cefcf-165">Na próxima seção, descreveremos com mais detalhes como você pode manter backups de discos usando a Cópia de instantâneo incremental</span><span class="sxs-lookup"><span data-stu-id="cefcf-165">In the next section, we will describe in more detail how you can maintain backups of disks using Incremental Snapshot Copy</span></span>

## <a name="scenario"></a><span data-ttu-id="cefcf-166">Cenário</span><span class="sxs-lookup"><span data-stu-id="cefcf-166">Scenario</span></span>
<span data-ttu-id="cefcf-167">Nesta seção, descrevemos um cenário que envolve uma estratégia de backup personalizada para discos de máquina virtual usando instantâneos.</span><span class="sxs-lookup"><span data-stu-id="cefcf-167">In this section, we describe a scenario that involves a custom backup strategy for virtual machine disks using snapshots.</span></span>

<span data-ttu-id="cefcf-168">Considere uma VM do Azure da série DS com um disco P30 de armazenamento premium anexado.</span><span class="sxs-lookup"><span data-stu-id="cefcf-168">Consider a DS-series Azure VM with a premium storage P30 disk attached.</span></span> <span data-ttu-id="cefcf-169">O disco P30 chamado *mypremiumdisk* é armazenado em uma conta de armazenamento premium chamada *mypremiumaccount*.</span><span class="sxs-lookup"><span data-stu-id="cefcf-169">The P30 disk called *mypremiumdisk* is stored in a premium storage account called *mypremiumaccount*.</span></span> <span data-ttu-id="cefcf-170">Uma conta de armazenamento standard chamada *mybackupstdaccount* é usada para armazenar o backup do *mypremiumdisk*.</span><span class="sxs-lookup"><span data-stu-id="cefcf-170">A standard storage account called *mybackupstdaccount* is used for storing the backup of *mypremiumdisk*.</span></span> <span data-ttu-id="cefcf-171">Gostaríamos de manter um instantâneo de *mypremiumdisk* a cada 12 horas.</span><span class="sxs-lookup"><span data-stu-id="cefcf-171">We would like to keep a snapshot of *mypremiumdisk* every 12 hours.</span></span>

<span data-ttu-id="cefcf-172">Para saber mais sobre a criação discos e contas de armazenamento, consulte [Sobre as contas de armazenamento do Azure](../articles/storage/storage-create-storage-account.md).</span><span class="sxs-lookup"><span data-stu-id="cefcf-172">To learn about creating storage account and disks, refer to [About Azure storage accounts](../articles/storage/storage-create-storage-account.md).</span></span>

<span data-ttu-id="cefcf-173">Para saber mais sobre como fazer backup de VMs do Azure, consulte [Planejar backups de VMs do Azure](../articles/backup/backup-azure-vms-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="cefcf-173">To learn about backing up Azure VMs, refer to [Plan Azure VM backups](../articles/backup/backup-azure-vms-introduction.md).</span></span>

## <a name="steps-to-maintain-backups-of-a-disk-using-incremental-snapshots"></a><span data-ttu-id="cefcf-174">Etapas para manter backups de um disco usando instantâneos incrementais</span><span class="sxs-lookup"><span data-stu-id="cefcf-174">Steps to maintain backups of a disk using incremental snapshots</span></span>
<span data-ttu-id="cefcf-175">As etapas descritas a seguir descrevem como tirar instantâneos do *mypremiumdisk* e manter os backups em *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="cefcf-175">The following steps describe how to take snapshots of *mypremiumdisk* and maintain the backups in *mybackupstdaccount*.</span></span> <span data-ttu-id="cefcf-176">O backup será um blob de páginas padrão chamado *mybackupstdpageblob*.</span><span class="sxs-lookup"><span data-stu-id="cefcf-176">The backup is a standard page blob called *mybackupstdpageblob*.</span></span> <span data-ttu-id="cefcf-177">O blob de páginas de backup sempre reflete o mesmo estado que o último instantâneo de *mypremiumdisk*.</span><span class="sxs-lookup"><span data-stu-id="cefcf-177">The backup page blob always reflects the same state as the last snapshot of *mypremiumdisk*.</span></span>

1. <span data-ttu-id="cefcf-178">Crie o blob de páginas de backup para o disco de armazenamento premium, tirando um instantâneo de *mypremiumdisk* chamado *mypremiumdisk_ss1*.</span><span class="sxs-lookup"><span data-stu-id="cefcf-178">Create the backup page blob for your premium storage disk, by taking a snapshot of *mypremiumdisk* called *mypremiumdisk_ss1*.</span></span>
2. <span data-ttu-id="cefcf-179">Copie esse instantâneo para mybackupstdaccount como um blob de páginas chamado *mybackupstdpageblob*.</span><span class="sxs-lookup"><span data-stu-id="cefcf-179">Copy this snapshot to mybackupstdaccount as a page blob called *mybackupstdpageblob*.</span></span>
3. <span data-ttu-id="cefcf-180">Faça um instantâneo de *mybackupstdpageblob* chamado *mybackupstdpageblob_ss1* usando [Blob de Instantâneo](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) e armazene-o em *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="cefcf-180">Take a snapshot of *mybackupstdpageblob* called *mybackupstdpageblob_ss1*, using [Snapshot Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) and store it in *mybackupstdaccount*.</span></span>
4. <span data-ttu-id="cefcf-181">Durante a janela de backup, crie outro instantâneo de *mypremiumdisk*, digamos que *mypremiumdisk_ss2* e armazene-o em *mypremiumaccount*.</span><span class="sxs-lookup"><span data-stu-id="cefcf-181">During the backup window, create another snapshot of *mypremiumdisk*, say *mypremiumdisk_ss2*, and store it in *mypremiumaccount*.</span></span>
5. <span data-ttu-id="cefcf-182">Obtenha as alterações incrementais entre os dois instantâneos, *mypremiumdisk_ss2* e *mypremiumdisk_ss1*, usando [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) na *mypremiumdisk_ss2* com o parâmetro **prevsnapshot** definido como o carimbo de data/hora de *mypremiumdisk_ss1*.</span><span class="sxs-lookup"><span data-stu-id="cefcf-182">Get the incremental changes between the two snapshots, *mypremiumdisk_ss2* and *mypremiumdisk_ss1*, using [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) on *mypremiumdisk_ss2* with the **prevsnapshot** parameter set to the timestamp of *mypremiumdisk_ss1*.</span></span> <span data-ttu-id="cefcf-183">Grave essas alterações incrementais do blob de páginas de backup *mybackupstdpageblob* em *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="cefcf-183">Write these incremental changes to the backup page blob *mybackupstdpageblob* in *mybackupstdaccount*.</span></span> <span data-ttu-id="cefcf-184">Se houver intervalos excluídos nas alterações incrementais, eles deverão ser excluídos do blob de páginas de backup.</span><span class="sxs-lookup"><span data-stu-id="cefcf-184">If there are deleted ranges in the incremental changes, they must be cleared from the backup page blob.</span></span> <span data-ttu-id="cefcf-185">Use [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) para gravar as alterações incrementais no blob de páginas de backup.</span><span class="sxs-lookup"><span data-stu-id="cefcf-185">Use [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) to write incremental changes to the backup page blob.</span></span>
6. <span data-ttu-id="cefcf-186">Faça um instantâneo do blob de páginas de backup *mybackupstdpageblob*, denominado *mybackupstdpageblob_ss2*.</span><span class="sxs-lookup"><span data-stu-id="cefcf-186">Take a snapshot of the backup page blob *mybackupstdpageblob*, called *mybackupstdpageblob_ss2*.</span></span> <span data-ttu-id="cefcf-187">Exclua o instantâneo anterior *mypremiumdisk_ss1* da conta de armazenamento premium.</span><span class="sxs-lookup"><span data-stu-id="cefcf-187">Delete the previous snapshot *mypremiumdisk_ss1* from premium storage account.</span></span>
7. <span data-ttu-id="cefcf-188">Repita as etapas 4 a 6 em cada janela de backup.</span><span class="sxs-lookup"><span data-stu-id="cefcf-188">Repeat steps 4-6 every backup window.</span></span> <span data-ttu-id="cefcf-189">Dessa forma, você pode manter backups de *mypremiumdisk* em uma conta de armazenamento padrão.</span><span class="sxs-lookup"><span data-stu-id="cefcf-189">In this way, you can maintain backups of *mypremiumdisk* in a standard storage account.</span></span>

![Fazer backup de disco usando instantâneos incrementais](../articles/virtual-machines/windows/media/incremental-snapshots/storage-incremental-snapshots-1.png)

## <a name="steps-to-restore-a-disk-from-snapshots"></a><span data-ttu-id="cefcf-191">Etapas para restaurar um disco por meio de instantâneos</span><span class="sxs-lookup"><span data-stu-id="cefcf-191">Steps to restore a disk from snapshots</span></span>
<span data-ttu-id="cefcf-192">As etapas a seguir descrevem como restaurar o disco premium *mypremiumdisk* para um instantâneo anterior da conta de armazenamento de backup *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="cefcf-192">The following steps, describe how to restore the premium disk, *mypremiumdisk* to an earlier snapshot from the backup storage account *mybackupstdaccount*.</span></span>

1. <span data-ttu-id="cefcf-193">Identifique o ponto para o qual você deseja restaurar o disco premium.</span><span class="sxs-lookup"><span data-stu-id="cefcf-193">Identify the point in time that you wish to restore the premium disk to.</span></span> <span data-ttu-id="cefcf-194">Digamos que seja o instantâneo *mybackupstdpageblob_ss2*, que está armazenado na conta de armazenamento de backup *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="cefcf-194">Let's say that it is snapshot *mybackupstdpageblob_ss2*, which is stored in the backup storage account *mybackupstdaccount*.</span></span>
2. <span data-ttu-id="cefcf-195">Em mybackupstdaccount, promova o instantâneo *mybackupstdpageblob_ss2* como o novo blob de páginas de base de backup *mybackupstdpageblobrestored*.</span><span class="sxs-lookup"><span data-stu-id="cefcf-195">In mybackupstdaccount, promote the snapshot *mybackupstdpageblob_ss2* as the new backup base page blob *mybackupstdpageblobrestored*.</span></span>
3. <span data-ttu-id="cefcf-196">Faça um instantâneo do blob de páginas de backup denominado *mybackupstdpageblobrestored_ss1*.</span><span class="sxs-lookup"><span data-stu-id="cefcf-196">Take a snapshot of this restored backup page blob, called *mybackupstdpageblobrestored_ss1*.</span></span>
4. <span data-ttu-id="cefcf-197">Copie o blob de páginas restauradas *mybackupstdpageblobrestored* de *mybackupstdaccount* para *mypremiumaccount* como o novo disco *premium mypremiumdiskrestored*.</span><span class="sxs-lookup"><span data-stu-id="cefcf-197">Copy the restored page blob *mybackupstdpageblobrestored* from *mybackupstdaccount* to *mypremiumaccount* as the new premium disk *mypremiumdiskrestored*.</span></span>
5. <span data-ttu-id="cefcf-198">Tirar um instantâneo do *mypremiumdiskrestored*, chamado *mypremiumdiskrestored_ss1* para fazer backups incrementais futuros.</span><span class="sxs-lookup"><span data-stu-id="cefcf-198">Take a snapshot of *mypremiumdiskrestored*, called *mypremiumdiskrestored_ss1* for making future incremental backups.</span></span>
6. <span data-ttu-id="cefcf-199">Aponte a VM da série DS para o disco restaurado *mypremiumdiskrestored* e desanexe o antigo *mypremiumdisk da VM*.</span><span class="sxs-lookup"><span data-stu-id="cefcf-199">Point the DS series VM to the restored disk *mypremiumdiskrestored* and detach the old *mypremiumdisk* from the VM.</span></span>
7. <span data-ttu-id="cefcf-200">Inicie o processo de backup descrito na seção anterior para o disco restaurado *mypremiumdiskrestored* usando *mybackupstdpageblobrestored* como o blob de páginas de backup.</span><span class="sxs-lookup"><span data-stu-id="cefcf-200">Begin the Backup process described in previous section for the restored disk *mypremiumdiskrestored*, using the *mybackupstdpageblobrestored* as the backup page blob.</span></span>

![Restaurar disco por meio de instantâneos](../articles/virtual-machines/windows/media/incremental-snapshots/storage-incremental-snapshots-2.png)

## <a name="next-steps"></a><span data-ttu-id="cefcf-202">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="cefcf-202">Next Steps</span></span>
<span data-ttu-id="cefcf-203">Use os links a seguir para saber mais sobre como criar instantâneos de um blob e planejar a infraestrutura de backup da VM.</span><span class="sxs-lookup"><span data-stu-id="cefcf-203">Use the following links to learn more about creating snapshots of a blob and planning your VM backup infrastructure.</span></span>

* [<span data-ttu-id="cefcf-204">Criando um instantâneo de um Blob</span><span class="sxs-lookup"><span data-stu-id="cefcf-204">Creating a Snapshot of a Blob</span></span>](https://docs.microsoft.com/rest/api/storageservices/Creating-a-Snapshot-of-a-Blob)
* [<span data-ttu-id="cefcf-205">Planejar sua Infraestrutura de backup de VM</span><span class="sxs-lookup"><span data-stu-id="cefcf-205">Plan your VM Backup Infrastructure</span></span>](../articles/backup/backup-azure-vms-introduction.md)

