# <a name="securing-docker-containers-in-azure-container-service"></a><span data-ttu-id="b9116-101">Protegendo os contêineres do Docker no Serviço de Contêiner do Azure</span><span class="sxs-lookup"><span data-stu-id="b9116-101">Securing Docker containers in Azure Container Service</span></span>

<span data-ttu-id="b9116-102">Este artigo apresenta as considerações e as recomendações para proteger os contêineres do Docker implantados no Serviço de Contêiner do Azure.</span><span class="sxs-lookup"><span data-stu-id="b9116-102">This article introduces considerations and recommendations for securing Docker containers deployed in Azure Container Service.</span></span> <span data-ttu-id="b9116-103">Muitas dessas considerações se aplicam geralmente contêineres tooDocker implantados no Azure ou em outros ambientes.</span><span class="sxs-lookup"><span data-stu-id="b9116-103">Many of these considerations apply generally tooDocker containers deployed in Azure or other environments.</span></span> 

## <a name="image-security"></a><span data-ttu-id="b9116-104">Segurança da imagem</span><span class="sxs-lookup"><span data-stu-id="b9116-104">Image security</span></span>

<span data-ttu-id="b9116-105">Os contêineres são criados a partir de imagens que são armazenadas em um ou mais repositórios.</span><span class="sxs-lookup"><span data-stu-id="b9116-105">Containers are built from images that are stored in one or more repositories.</span></span> <span data-ttu-id="b9116-106">Esses repositórios podem pertencer toopublic ou registros de contêiner privado.</span><span class="sxs-lookup"><span data-stu-id="b9116-106">These repositories can belong toopublic or private container registries.</span></span> <span data-ttu-id="b9116-107">Um exemplo de um registro público é o [Docker Hub](https://hub.docker.com/).</span><span class="sxs-lookup"><span data-stu-id="b9116-107">An example of a public registry is [Docker Hub](https://hub.docker.com/).</span></span> <span data-ttu-id="b9116-108">Um exemplo de um registro particular é hello [registro confiável do Docker](https://docs.docker.com/datacenter/dtr/2.0/), que pode ser instalado localmente ou em uma nuvem privada virtual.</span><span class="sxs-lookup"><span data-stu-id="b9116-108">An example of a private registry is hello [Docker Trusted Registry](https://docs.docker.com/datacenter/dtr/2.0/), which can be installed on-premises or in a virtual private cloud.</span></span> <span data-ttu-id="b9116-109">Há também serviços de registro de contêiner privado baseados em nuvem incluindo [Registro de Contêiner do Azure](../articles/container-registry/container-registry-intro.md).</span><span class="sxs-lookup"><span data-stu-id="b9116-109">There are also cloud-based private container registry services including [Azure Container Registry](../articles/container-registry/container-registry-intro.md).</span></span>

### <a name="public-and-private-images"></a><span data-ttu-id="b9116-110">Imagens públicas e privadas</span><span class="sxs-lookup"><span data-stu-id="b9116-110">Public and private images</span></span>
<span data-ttu-id="b9116-111">Em geral, assim como acontece com qualquer pacote de software publicado publicamente, uma imagem de contêiner disponível publicamente não garante a segurança.</span><span class="sxs-lookup"><span data-stu-id="b9116-111">In general, as with any publicly published software package, a publicly available container image does not guarantee security.</span></span> <span data-ttu-id="b9116-112">As imagens de contêiner são compostas por várias camadas de software e cada camada de software pode ter vulnerabilidades.</span><span class="sxs-lookup"><span data-stu-id="b9116-112">Container images consist of multiple software layers, and each software layer could have vulnerabilities.</span></span> <span data-ttu-id="b9116-113">Seja toounderstand chave Olá origem da imagem de contêiner hello, incluindo Olá proprietário da imagem da saudação (toodetermine se é uma fonte confiável ou não), Olá camadas de software consiste em e Olá versões de software.</span><span class="sxs-lookup"><span data-stu-id="b9116-113">It is key toounderstand hello origin of hello container image, including hello owner of hello image (toodetermine if it is a reliable source or not), hello software layers it consists of, and hello software versions.</span></span> 

<span data-ttu-id="b9116-114">Por exemplo, se você for toohello oficial [nginx repositório](https://hub.docker.com/_/nginx/) no Hub do Docker e navegue toohello **marcas** guia, consulte vulnerabilidades codificado por cores em cada imagem.</span><span class="sxs-lookup"><span data-stu-id="b9116-114">For example, if you go toohello official [nginx repository](https://hub.docker.com/_/nginx/) in Docker Hub and navigate toohello **Tags** tab, you see color-coded vulnerabilities in each image.</span></span> <span data-ttu-id="b9116-115">Cada cor representa vulnerabilidade de saudação de uma camada de software de imagem de saudação.</span><span class="sxs-lookup"><span data-stu-id="b9116-115">Each color depicts hello vulnerability of a software layer of hello image.</span></span> <span data-ttu-id="b9116-116">Para saber mais sobre a verificação de vulnerabilidades no Docker Hub, veja [Noções básicas sobre repositórios oficiais no Docker Hub](https://blog.docker.com/2015/06/understanding-official-repos-docker-hub/).</span><span class="sxs-lookup"><span data-stu-id="b9116-116">For more about vulnerability scanning in Docker Hub, see [Understanding official repos on Docker Hub](https://blog.docker.com/2015/06/understanding-official-repos-docker-hub/).</span></span>

![Imagens de nginx no Docker Hub](./media/container-service-security/docker-hub-nginx.png)

<span data-ttu-id="b9116-118">As empresas muito cuidado sobre segurança e tooprotect-se contra ataques de segurança devem armazenar e recuperar imagens de um registro particular, como o registro de contêiner do Azure ou registro confiável do Docker.</span><span class="sxs-lookup"><span data-stu-id="b9116-118">Enterprises care deeply about security, and tooprotect themselves from security attack should store and retrieve images from a private registry, such as Azure Container Registry or Docker Trusted Registry.</span></span> <span data-ttu-id="b9116-119">Em adição tooproviding um registro particular gerenciado, registro de contêiner do Azure suporta [autenticação baseada em entidade de serviço](../articles/container-registry/container-registry-authentication.md) por meio do Active Directory do Azure para fluxos de autenticação básica, incluindo o acesso baseado em função para somente leitura, gravação e permissões de proprietário.</span><span class="sxs-lookup"><span data-stu-id="b9116-119">In addition tooproviding a managed private registry, Azure Container Registry supports [service principal-based authentication](../articles/container-registry/container-registry-authentication.md) through Azure Active Directory for basic authentication flows, including role-based access for read-only, write, and owner permissions.</span></span>

### <a name="image-security-scanning"></a><span data-ttu-id="b9116-120">Verificação de segurança de imagem</span><span class="sxs-lookup"><span data-stu-id="b9116-120">Image security scanning</span></span>

<span data-ttu-id="b9116-121">Mesmo ao usar um registro particular, é uma imagem de toouse boa ideia verificar soluções para validação de segurança adicional.</span><span class="sxs-lookup"><span data-stu-id="b9116-121">Even when using a private registry, it is a good idea toouse image scanning solutions for additional security validation.</span></span> <span data-ttu-id="b9116-122">Cada camada de software em uma imagem de contêiner é potencialmente propensas toovulnerabilities independente de outras camadas na imagem de contêiner de saudação.</span><span class="sxs-lookup"><span data-stu-id="b9116-122">Each software layer in a container image is potentially prone toovulnerabilities independent of other layers in hello container image.</span></span> <span data-ttu-id="b9116-123">Como cada vez mais empresas começar a implantar suas cargas de trabalho de produção com base nas tecnologias de contêiner, varredura de imagem se torna importante tooensure prevenção de ameaças de segurança em suas organizações.</span><span class="sxs-lookup"><span data-stu-id="b9116-123">As increasingly companies start deploying their production workloads based on container technologies, image scanning becomes important tooensure prevention of security threats against their organizations.</span></span> 

<span data-ttu-id="b9116-124">Monitoramento e verificação de soluções, como segurança [Twistlock](https://www.twistlock.com/2016/11/07/twistlock-supports-azure-container-registry) e [Aqua segurança](http://blog.aquasec.com/image-vulnerability-scanning-in-azure-container-registry), entre outros, pode ser usado tooscan imagens de contêiner em um registro particular e identificar vulnerabilidades potenciais.</span><span class="sxs-lookup"><span data-stu-id="b9116-124">Security monitoring and scanning solutions such as [Twistlock](https://www.twistlock.com/2016/11/07/twistlock-supports-azure-container-registry) and [Aqua Security](http://blog.aquasec.com/image-vulnerability-scanning-in-azure-container-registry), among others, can be used tooscan container images in a private registry and identify potential vulnerabilities.</span></span> <span data-ttu-id="b9116-125">É importante fornecer toounderstand profundidade de saudação de verificação que Olá diferentes soluções.</span><span class="sxs-lookup"><span data-stu-id="b9116-125">It is important toounderstand hello depth of scanning that hello different solutions provide.</span></span> <span data-ttu-id="b9116-126">Por exemplo, algumas soluções podem apenas realizar a verificação cruzada entre as camadas de imagem em relação a vulnerabilidades conhecidas.</span><span class="sxs-lookup"><span data-stu-id="b9116-126">For example, some solutions might only cross-verify image layers against known vulnerabilities.</span></span> <span data-ttu-id="b9116-127">Essas soluções podem não ser capaz de tooverify software de camada de imagem criado por meio de determinados software do Gerenciador de pacote.</span><span class="sxs-lookup"><span data-stu-id="b9116-127">These solutions might not be able tooverify image-layer software built through certain package manager software.</span></span> <span data-ttu-id="b9116-128">Outras soluções têm integração de verificação mais profunda e podem encontrar vulnerabilidades em qualquer software de pacote.</span><span class="sxs-lookup"><span data-stu-id="b9116-128">Other solutions have deeper scanning integration and can find vulnerabilities in any packaged software.</span></span>

### <a name="production-deployment-rules-and-audit"></a><span data-ttu-id="b9116-129">Regras de implantação de produção e auditoria</span><span class="sxs-lookup"><span data-stu-id="b9116-129">Production deployment rules and audit</span></span>
<span data-ttu-id="b9116-130">Quando um aplicativo é implantado na produção, é essencial tooset alguns tooensure de regras que as imagens usadas em ambientes de produção são seguras e não conter nenhuma vulnerabilidades.</span><span class="sxs-lookup"><span data-stu-id="b9116-130">Once an application is deployed in production, it is essential tooset a few rules tooensure that images used in production environments are secure and contain no vulnerabilities.</span></span>

* <span data-ttu-id="b9116-131">Como regra, não imagens com vulnerabilidades, ainda menores, devem ser permitidas toorun em um ambiente de produção.</span><span class="sxs-lookup"><span data-stu-id="b9116-131">As a rule, images with vulnerabilities, even minor, should not be allowed toorun in a production environment.</span></span> <span data-ttu-id="b9116-132">Além disso, todas as imagens de implantação em produção devem idealmente ser salvo em um registro privada, selecione tooa acessível apenas alguns.</span><span class="sxs-lookup"><span data-stu-id="b9116-132">In addition, all images deployed in production should ideally be saved in a private registry accessible tooa select few.</span></span> <span data-ttu-id="b9116-133">Também é número de saudação tookeep importante de produção imagens pequenas tooensure, que podem ser gerenciadas com eficiência.</span><span class="sxs-lookup"><span data-stu-id="b9116-133">It is also important tookeep hello number of production images small tooensure that they can be managed effectively.</span></span>

* <span data-ttu-id="b9116-134">Desde que seja toopinpoint rígido Olá origem do software usando uma imagem de contêiner disponível publicamente, é imagens de toobuild uma boa prática de Conhecimento de tooensure de origem de origem de saudação da camada de saudação.</span><span class="sxs-lookup"><span data-stu-id="b9116-134">Since it is hard toopinpoint hello origin of software from a publicly available container image, it is a good practice toobuild images from source tooensure knowledge of hello origin of hello layer.</span></span> <span data-ttu-id="b9116-135">Quando um superfícies de vulnerabilidade de uma imagem de contêiner automática interna, os clientes poderão encontrar uma resolução mais rápida de tooa de caminho.</span><span class="sxs-lookup"><span data-stu-id="b9116-135">When a vulnerability surfaces in a self-built container image, customers can find a quicker path tooa resolution.</span></span> <span data-ttu-id="b9116-136">Com uma imagem pública, os clientes precisariam toofind raiz de saudação de uma imagem pública toofix-lo ou obter outra imagem segura de publicador hello.</span><span class="sxs-lookup"><span data-stu-id="b9116-136">With a public image, customers would need toofind hello root of a public image toofix it or obtain another secure image from hello publisher.</span></span>

* <span data-ttu-id="b9116-137">Uma imagem digitalizada totalmente implantada na produção não é garantida toobe backup toodate para tempo de vida de saudação do aplicativo hello.</span><span class="sxs-lookup"><span data-stu-id="b9116-137">A thoroughly scanned image deployed in production is not guaranteed toobe up toodate for hello lifetime of hello application.</span></span> <span data-ttu-id="b9116-138">Vulnerabilidades de segurança podem ser relatadas para camadas de imagem de saudação que não eram anteriormente conhecidas ou introduzidas após a implantação de produção de hello.</span><span class="sxs-lookup"><span data-stu-id="b9116-138">Security vulnerabilities might be reported for layers of hello image that were not previously known or were introduced after hello production deployment.</span></span> <span data-ttu-id="b9116-139">Auditoria periódica de imagens de implantação na produção é imagens tooidentify necessárias que estão desatualizados ou não foram atualizadas dentro de alguns instantes.</span><span class="sxs-lookup"><span data-stu-id="b9116-139">Periodic auditing of images deployed in production is necessary tooidentify images that are out of date or have not been updated in a while.</span></span> <span data-ttu-id="b9116-140">Você pode usar metodologias de implantação de verde e azul e implantar imagens de contêiner tooupdate mecanismos de atualização sem tempo de inatividade.</span><span class="sxs-lookup"><span data-stu-id="b9116-140">One might use blue-green deployment methodologies and rolling upgrade mechanisms tooupdate container images without downtime.</span></span> <span data-ttu-id="b9116-141">Verificação de imagem pode ser feito com ferramentas descritas Olá anterior da seção.</span><span class="sxs-lookup"><span data-stu-id="b9116-141">Image scanning can be done with tools described in hello preceding section.</span></span> 

* <span data-ttu-id="b9116-142">Um pipeline de CI (integração contínua) verificação de segurança integrada e imagens toobuild podem ajudar a manter registros privados seguros com imagens seguras de contêiner.</span><span class="sxs-lookup"><span data-stu-id="b9116-142">A continuous integration (CI) pipeline toobuild images and integrated security scanning can help maintain secure private registries with secure container images.</span></span> <span data-ttu-id="b9116-143">Olá verificação de vulnerabilidade incorporados a solução de CI Olá garante imagens que passarem em todos os testes de saudação são enviados por push toohello registro privada implantadas de quais produção cargas de trabalho.</span><span class="sxs-lookup"><span data-stu-id="b9116-143">hello vulnerability scanning built into hello CI solution ensures that images that pass all hello tests are pushed toohello private registry from which production workloads are deployed.</span></span> <span data-ttu-id="b9116-144">Uma falha de pipeline CI garante que vulnerável imagens não são inseridas no registro privada hello, usado para implantações de carga de trabalho de produção.</span><span class="sxs-lookup"><span data-stu-id="b9116-144">A CI pipeline failure ensures that vulnerable images are not pushed into hello private registry used for production workload deployments.</span></span> <span data-ttu-id="b9116-145">Isso também automatiza a verificação de segurança de imagem se houver um número significativo de imagens.</span><span class="sxs-lookup"><span data-stu-id="b9116-145">It also automates image security scanning if there are a significant number of images.</span></span> <span data-ttu-id="b9116-146">Caso contrário, a auditoria manual de imagens em busca de vulnerabilidades de segurança pode ser muito demorada e sujeita a erros.</span><span class="sxs-lookup"><span data-stu-id="b9116-146">Otherwise, manually auditing images for security vulnerabilities can be painstakingly lengthy and error prone.</span></span>

## <a name="host-level-container-isolation"></a><span data-ttu-id="b9116-147">Isolamento de contêiner de nível de host</span><span class="sxs-lookup"><span data-stu-id="b9116-147">Host-level container isolation</span></span>
<span data-ttu-id="b9116-148">Quando um cliente implanta aplicativos de contêiner nos recursos do Azure, eles são implantados em um nível de assinatura em grupos de recursos e não são multilocatários.</span><span class="sxs-lookup"><span data-stu-id="b9116-148">When a customer deploys container applications on Azure resources, they are deployed at a subscription level in resource groups and are not multi-tenant.</span></span> <span data-ttu-id="b9116-149">Isso significa que se um cliente compartilha uma assinatura com outras pessoas, não há nenhum limites que podem ser criados entre duas implantações em Olá mesmo assinatura.</span><span class="sxs-lookup"><span data-stu-id="b9116-149">This means that if a customer shares a subscription with others, there are no boundaries that can be built between two deployments in hello same subscription.</span></span> <span data-ttu-id="b9116-150">Portanto, a segurança de nível de contêiner não estará garantida.</span><span class="sxs-lookup"><span data-stu-id="b9116-150">Therefore, container-level security is not guaranteed.</span></span> 

<span data-ttu-id="b9116-151">Também é toounderstand crítico que contêineres compartilham kernel hello e recursos de saudação do host de saudação (que, no serviço de contêiner do Azure, é uma VM do Azure em um cluster).</span><span class="sxs-lookup"><span data-stu-id="b9116-151">It is also critical toounderstand that containers share hello kernel and hello resources of hello host (which in Azure Container Service is an Azure VM in a cluster).</span></span> <span data-ttu-id="b9116-152">Portanto, os contêineres em produção devem ser executados no modo de usuário sem privilégios.</span><span class="sxs-lookup"><span data-stu-id="b9116-152">Therefore, containers running in production must be run in non-privileged user mode.</span></span> <span data-ttu-id="b9116-153">Executando um contêiner com privilégios de raiz pode comprometer a todo o ambiente de saudação.</span><span class="sxs-lookup"><span data-stu-id="b9116-153">Running a container with root privileges can compromise hello entire environment.</span></span> <span data-ttu-id="b9116-154">Com acesso de nível raiz em um contêiner, um hacker pode acessar toohello privilégios de raiz totais no host de saudação.</span><span class="sxs-lookup"><span data-stu-id="b9116-154">With root-level access in a container, a hacker can gain access toohello full root privileges on hello host.</span></span> <span data-ttu-id="b9116-155">Além disso, é importante toorun contêineres com sistemas de arquivos somente leitura.</span><span class="sxs-lookup"><span data-stu-id="b9116-155">In addition, it is important toorun containers with read-only file systems.</span></span> <span data-ttu-id="b9116-156">Isso impede que alguém que tenha acesso toohello comprometido contêiner toowrite scripts mal-intencionados toohello sistema de arquivos e acessar arquivos tooother.</span><span class="sxs-lookup"><span data-stu-id="b9116-156">This prevents someone who has access toohello compromised container toowrite malicious scripts toohello file system and gain access tooother files.</span></span> <span data-ttu-id="b9116-157">Da mesma forma, é importante toolimit Olá os recursos (como memória, CPU e largura de banda de rede) alocados tooa contêiner.</span><span class="sxs-lookup"><span data-stu-id="b9116-157">Similarly, it is important toolimit hello resources (such as memory, CPU, and network bandwidth) allocated tooa container.</span></span> <span data-ttu-id="b9116-158">Isso ajuda a impedir que hackers precisam de mais recursos e buscando atividades ilegais como fraude de cartão de crédito ou de mineração bitcoin, que pode impedir que outros contêineres em execução no cluster ou host hello.</span><span class="sxs-lookup"><span data-stu-id="b9116-158">This helps prevent hackers from hogging resources and pursuing illegal activities such as credit card fraud or bitcoin mining, which could prevent other containers from running on hello host or cluster.</span></span>

## <a name="orchestrator-considerations"></a><span data-ttu-id="b9116-159">Considerações sobre o Orchestrator</span><span class="sxs-lookup"><span data-stu-id="b9116-159">Orchestrator considerations</span></span>

<span data-ttu-id="b9116-160">Cada orquestrador disponível no Serviço de Contêiner do Azure tem suas próprias considerações de segurança.</span><span class="sxs-lookup"><span data-stu-id="b9116-160">Each orchestrator available in Azure Container Service has its own security considerations.</span></span> <span data-ttu-id="b9116-161">Por exemplo, você deve limitar direto nós tooorchestrator de acesso SSH no serviço de contêiner.</span><span class="sxs-lookup"><span data-stu-id="b9116-161">For example, you should limit direct SSH access tooorchestrator nodes in Container Service.</span></span> <span data-ttu-id="b9116-162">Em vez disso, você deve usar a interface do usuário de cada orchestrator ou ferramentas de linha de comando (como `kubectl` para Kubernetes) toomanage ambiente de contêiner Olá sem acessar Olá hosts.</span><span class="sxs-lookup"><span data-stu-id="b9116-162">Instead, you should use each orchestrator's UI or command-line tools (such as `kubectl` for Kubernetes) toomanage hello container environment without accessing hello hosts.</span></span> <span data-ttu-id="b9116-163">Para obter mais informações, consulte [criar um cluster de conexão remota tooa Kubernetes, o controlador de domínio/sistema operacional ou o Docker Swarm](../articles/container-service/kubernetes/container-service-connect.md).</span><span class="sxs-lookup"><span data-stu-id="b9116-163">For more information, see [Make a remote connection tooa Kubernetes, DC/OS, or Docker Swarm cluster](../articles/container-service/kubernetes/container-service-connect.md).</span></span>

<span data-ttu-id="b9116-164">Para obter informações adicionais de segurança específicas do orchestrator, consulte Olá recursos a seguir:</span><span class="sxs-lookup"><span data-stu-id="b9116-164">For additional orchestrator-specific security information, see hello following resources:</span></span>

* <span data-ttu-id="b9116-165">**Kubernetes**: [práticas recomendadas de segurança para implantação de Kubernetes](http://blog.kubernetes.io/2016/08/security-best-practices-kubernetes-deployment.html)</span><span class="sxs-lookup"><span data-stu-id="b9116-165">**Kubernetes**: [Security Best Practices for Kubernetes Deployment](http://blog.kubernetes.io/2016/08/security-best-practices-kubernetes-deployment.html)</span></span>

* <span data-ttu-id="b9116-166">**DC/OS**: [proteção do cluster](https://dcos.io/docs/1.8/administration/securing-your-cluster/)</span><span class="sxs-lookup"><span data-stu-id="b9116-166">**DC/OS**: [Securing Your Cluster](https://dcos.io/docs/1.8/administration/securing-your-cluster/)</span></span>

* <span data-ttu-id="b9116-167">**Docker Swarm**: [segurança do Docker](https://www.docker.com/docker-security)</span><span class="sxs-lookup"><span data-stu-id="b9116-167">**Docker Swarm**: [Docker Security](https://www.docker.com/docker-security)</span></span>

## <a name="next-steps"></a><span data-ttu-id="b9116-168">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="b9116-168">Next steps</span></span>

* <span data-ttu-id="b9116-169">Para obter mais informações sobre a segurança de arquitetura e o contêiner do Docker, consulte [tooContainer Introdução segurança](https://www.docker.com/sites/default/files/WP_IntrotoContainerSecurity_08.19.2016.pdf).</span><span class="sxs-lookup"><span data-stu-id="b9116-169">For more about Docker architecture and container security, see [Introduction tooContainer Security](https://www.docker.com/sites/default/files/WP_IntrotoContainerSecurity_08.19.2016.pdf).</span></span>

* <span data-ttu-id="b9116-170">Para obter informações sobre a segurança da plataforma Windows Azure, consulte Olá [Central de segurança do Azure](https://www.microsoft.com/en-us/trustcenter/cloudservices/azure).</span><span class="sxs-lookup"><span data-stu-id="b9116-170">For information about Azure platform security, see hello [Azure Security Center](https://www.microsoft.com/en-us/trustcenter/cloudservices/azure).</span></span>
