# <a name="securing-docker-containers-in-azure-container-service"></a><span data-ttu-id="cd021-101">Protegendo os contêineres do Docker no Serviço de Contêiner do Azure</span><span class="sxs-lookup"><span data-stu-id="cd021-101">Securing Docker containers in Azure Container Service</span></span>

<span data-ttu-id="cd021-102">Este artigo apresenta as considerações e as recomendações para proteger os contêineres do Docker implantados no Serviço de Contêiner do Azure.</span><span class="sxs-lookup"><span data-stu-id="cd021-102">This article introduces considerations and recommendations for securing Docker containers deployed in Azure Container Service.</span></span> <span data-ttu-id="cd021-103">Várias dessas considerações aplicam-se em geral aos contêineres do Docker implantados no Azure ou outros ambientes.</span><span class="sxs-lookup"><span data-stu-id="cd021-103">Many of these considerations apply generally to Docker containers deployed in Azure or other environments.</span></span> 

## <a name="image-security"></a><span data-ttu-id="cd021-104">Segurança da imagem</span><span class="sxs-lookup"><span data-stu-id="cd021-104">Image security</span></span>

<span data-ttu-id="cd021-105">Os contêineres são criados a partir de imagens que são armazenadas em um ou mais repositórios.</span><span class="sxs-lookup"><span data-stu-id="cd021-105">Containers are built from images that are stored in one or more repositories.</span></span> <span data-ttu-id="cd021-106">Esses repositórios podem pertencer a registros de contêineres públicos ou privados.</span><span class="sxs-lookup"><span data-stu-id="cd021-106">These repositories can belong to public or private container registries.</span></span> <span data-ttu-id="cd021-107">Um exemplo de um registro público é o [Docker Hub](https://hub.docker.com/).</span><span class="sxs-lookup"><span data-stu-id="cd021-107">An example of a public registry is [Docker Hub](https://hub.docker.com/).</span></span> <span data-ttu-id="cd021-108">Um exemplo de um registro privado é o [Docker Trusted Registry](https://docs.docker.com/datacenter/dtr/2.0/), que pode ser instalado localmente ou em uma nuvem privada virtual.</span><span class="sxs-lookup"><span data-stu-id="cd021-108">An example of a private registry is the [Docker Trusted Registry](https://docs.docker.com/datacenter/dtr/2.0/), which can be installed on-premises or in a virtual private cloud.</span></span> <span data-ttu-id="cd021-109">Há também serviços de registro de contêiner privado baseados em nuvem incluindo [Registro de Contêiner do Azure](../articles/container-registry/container-registry-intro.md).</span><span class="sxs-lookup"><span data-stu-id="cd021-109">There are also cloud-based private container registry services including [Azure Container Registry](../articles/container-registry/container-registry-intro.md).</span></span>

### <a name="public-and-private-images"></a><span data-ttu-id="cd021-110">Imagens públicas e privadas</span><span class="sxs-lookup"><span data-stu-id="cd021-110">Public and private images</span></span>
<span data-ttu-id="cd021-111">Em geral, assim como acontece com qualquer pacote de software publicado publicamente, uma imagem de contêiner disponível publicamente não garante a segurança.</span><span class="sxs-lookup"><span data-stu-id="cd021-111">In general, as with any publicly published software package, a publicly available container image does not guarantee security.</span></span> <span data-ttu-id="cd021-112">As imagens de contêiner são compostas por várias camadas de software e cada camada de software pode ter vulnerabilidades.</span><span class="sxs-lookup"><span data-stu-id="cd021-112">Container images consist of multiple software layers, and each software layer could have vulnerabilities.</span></span> <span data-ttu-id="cd021-113">É fundamental compreender a origem da imagem do contêiner, incluindo o proprietário da imagem (para determinar se é uma fonte confiável ou não), as camadas de software que a compõem e as versões do software.</span><span class="sxs-lookup"><span data-stu-id="cd021-113">It is key to understand the origin of the container image, including the owner of the image (to determine if it is a reliable source or not), the software layers it consists of, and the software versions.</span></span> 

<span data-ttu-id="cd021-114">Por exemplo, se você for ao [repositório nginx](https://hub.docker.com/_/nginx/) original no Docker Hub e navegar até a guia **Marcas**, verá vulnerabilidades codificadas por cores em cada imagem.</span><span class="sxs-lookup"><span data-stu-id="cd021-114">For example, if you go to the official [nginx repository](https://hub.docker.com/_/nginx/) in Docker Hub and navigate to the **Tags** tab, you see color-coded vulnerabilities in each image.</span></span> <span data-ttu-id="cd021-115">Cada cor representa a vulnerabilidade de uma camada de software da imagem.</span><span class="sxs-lookup"><span data-stu-id="cd021-115">Each color depicts the vulnerability of a software layer of the image.</span></span> <span data-ttu-id="cd021-116">Para saber mais sobre a verificação de vulnerabilidades no Docker Hub, veja [Noções básicas sobre repositórios oficiais no Docker Hub](https://blog.docker.com/2015/06/understanding-official-repos-docker-hub/).</span><span class="sxs-lookup"><span data-stu-id="cd021-116">For more about vulnerability scanning in Docker Hub, see [Understanding official repos on Docker Hub](https://blog.docker.com/2015/06/understanding-official-repos-docker-hub/).</span></span>

![Imagens de nginx no Docker Hub](./media/container-service-security/docker-hub-nginx.png)

<span data-ttu-id="cd021-118">As empresas preocupam-se profundamente com segurança e, para se protegerem contra ataques, devem armazenar e recuperar imagens de um registro privado, como o Registro de Contêiner do Azure ou Docker Trusted Registry.</span><span class="sxs-lookup"><span data-stu-id="cd021-118">Enterprises care deeply about security, and to protect themselves from security attack should store and retrieve images from a private registry, such as Azure Container Registry or Docker Trusted Registry.</span></span> <span data-ttu-id="cd021-119">Além de fornecer um registro privado gerenciado, o Registro de Contêiner do Azure dá suporte à [autenticação baseada em entidade de serviço](../articles/container-registry/container-registry-authentication.md) através do Active Directory do Azure para fluxos de autenticação básica, incluindo o acesso baseado em função para permissões de somente leitura, gravação e proprietário.</span><span class="sxs-lookup"><span data-stu-id="cd021-119">In addition to providing a managed private registry, Azure Container Registry supports [service principal-based authentication](../articles/container-registry/container-registry-authentication.md) through Azure Active Directory for basic authentication flows, including role-based access for read-only, write, and owner permissions.</span></span>

### <a name="image-security-scanning"></a><span data-ttu-id="cd021-120">Verificação de segurança de imagem</span><span class="sxs-lookup"><span data-stu-id="cd021-120">Image security scanning</span></span>

<span data-ttu-id="cd021-121">Mesmo ao usar um registro privado, é uma boa ideia usar soluções de verificação de imagem para obter validação de segurança adicional.</span><span class="sxs-lookup"><span data-stu-id="cd021-121">Even when using a private registry, it is a good idea to use image scanning solutions for additional security validation.</span></span> <span data-ttu-id="cd021-122">Cada camada de software em uma imagem de contêiner é potencialmente propensa a vulnerabilidades independentes de outras camadas na imagem de contêiner.</span><span class="sxs-lookup"><span data-stu-id="cd021-122">Each software layer in a container image is potentially prone to vulnerabilities independent of other layers in the container image.</span></span> <span data-ttu-id="cd021-123">À medida que cada vez mais empresas começam a implantar cargas de trabalho de produção com base nas tecnologias de contêiner, a verificação de imagem torna-se importante para garantir a prevenção de ameaças à segurança em suas organizações.</span><span class="sxs-lookup"><span data-stu-id="cd021-123">As increasingly companies start deploying their production workloads based on container technologies, image scanning becomes important to ensure prevention of security threats against their organizations.</span></span> 

<span data-ttu-id="cd021-124">As soluções de verificação e monitoramento de segurança, como [Twistlock](https://www.twistlock.com/2016/11/07/twistlock-supports-azure-container-registry) e [Aqua Security](http://blog.aquasec.com/image-vulnerability-scanning-in-azure-container-registry), dentre outros, podem ser usadas para verificar as imagens de contêiner em um registro privado e identificar possíveis vulnerabilidades.</span><span class="sxs-lookup"><span data-stu-id="cd021-124">Security monitoring and scanning solutions such as [Twistlock](https://www.twistlock.com/2016/11/07/twistlock-supports-azure-container-registry) and [Aqua Security](http://blog.aquasec.com/image-vulnerability-scanning-in-azure-container-registry), among others, can be used to scan container images in a private registry and identify potential vulnerabilities.</span></span> <span data-ttu-id="cd021-125">É importante compreender a profundidade da verificação fornecida pelas diferentes soluções.</span><span class="sxs-lookup"><span data-stu-id="cd021-125">It is important to understand the depth of scanning that the different solutions provide.</span></span> <span data-ttu-id="cd021-126">Por exemplo, algumas soluções podem apenas realizar a verificação cruzada entre as camadas de imagem em relação a vulnerabilidades conhecidas.</span><span class="sxs-lookup"><span data-stu-id="cd021-126">For example, some solutions might only cross-verify image layers against known vulnerabilities.</span></span> <span data-ttu-id="cd021-127">Essas soluções podem não ser capazes de verificar o software de camada de imagem criada por meio de determinados softwares de gerenciadores de pacote.</span><span class="sxs-lookup"><span data-stu-id="cd021-127">These solutions might not be able to verify image-layer software built through certain package manager software.</span></span> <span data-ttu-id="cd021-128">Outras soluções têm integração de verificação mais profunda e podem encontrar vulnerabilidades em qualquer software de pacote.</span><span class="sxs-lookup"><span data-stu-id="cd021-128">Other solutions have deeper scanning integration and can find vulnerabilities in any packaged software.</span></span>

### <a name="production-deployment-rules-and-audit"></a><span data-ttu-id="cd021-129">Regras de implantação de produção e auditoria</span><span class="sxs-lookup"><span data-stu-id="cd021-129">Production deployment rules and audit</span></span>
<span data-ttu-id="cd021-130">Quando um aplicativo é implantado em produção, é essencial estabelecer algumas regras para garantir que as imagens usadas em ambientes de produção sejam seguras e não contenham vulnerabilidades.</span><span class="sxs-lookup"><span data-stu-id="cd021-130">Once an application is deployed in production, it is essential to set a few rules to ensure that images used in production environments are secure and contain no vulnerabilities.</span></span>

* <span data-ttu-id="cd021-131">Como regra, as imagens com vulnerabilidades, até mesmo pequenas, não devem ter permissão para serem executadas em um ambiente de produção.</span><span class="sxs-lookup"><span data-stu-id="cd021-131">As a rule, images with vulnerabilities, even minor, should not be allowed to run in a production environment.</span></span> <span data-ttu-id="cd021-132">Além disso, todas as imagens implantadas em produção idealmente devem ser salvas em um registro privado acessível para um seleto grupo.</span><span class="sxs-lookup"><span data-stu-id="cd021-132">In addition, all images deployed in production should ideally be saved in a private registry accessible to a select few.</span></span> <span data-ttu-id="cd021-133">Também é importante manter poucas imagens de produção para garantir que elas possam ser gerenciadas com eficiência.</span><span class="sxs-lookup"><span data-stu-id="cd021-133">It is also important to keep the number of production images small to ensure that they can be managed effectively.</span></span>

* <span data-ttu-id="cd021-134">Como é difícil identificar a origem do software de uma imagem de contêiner disponível publicamente, é uma boa prática para criar imagens de origem para garantir o conhecimento da origem da camada.</span><span class="sxs-lookup"><span data-stu-id="cd021-134">Since it is hard to pinpoint the origin of software from a publicly available container image, it is a good practice to build images from source to ensure knowledge of the origin of the layer.</span></span> <span data-ttu-id="cd021-135">Quando surge uma vulnerabilidade em uma imagem de contêiner criada automaticamente, os clientes podem encontrar um caminho mais rápido para uma resolução.</span><span class="sxs-lookup"><span data-stu-id="cd021-135">When a vulnerability surfaces in a self-built container image, customers can find a quicker path to a resolution.</span></span> <span data-ttu-id="cd021-136">Com uma imagem pública, os clientes precisam encontrar a raiz de uma imagem pública para corrigi-la ou obter outra imagem segura do publicador.</span><span class="sxs-lookup"><span data-stu-id="cd021-136">With a public image, customers would need to find the root of a public image to fix it or obtain another secure image from the publisher.</span></span>

* <span data-ttu-id="cd021-137">Não há garantia de que uma imagem digitalizada totalmente implantada em produção esteja atualizada durante o tempo de vida do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="cd021-137">A thoroughly scanned image deployed in production is not guaranteed to be up to date for the lifetime of the application.</span></span> <span data-ttu-id="cd021-138">As vulnerabilidades de segurança podem ser reportadas para camadas da imagem que não eram conhecidas anteriormente ou que foram introduzidas após a implantação em produção.</span><span class="sxs-lookup"><span data-stu-id="cd021-138">Security vulnerabilities might be reported for layers of the image that were not previously known or were introduced after the production deployment.</span></span> <span data-ttu-id="cd021-139">A auditoria periódica das imagens implantadas em produção é necessária para identificar as imagens que estão desatualizadas ou que não foram atualizadas há um tempo.</span><span class="sxs-lookup"><span data-stu-id="cd021-139">Periodic auditing of images deployed in production is necessary to identify images that are out of date or have not been updated in a while.</span></span> <span data-ttu-id="cd021-140">É possível usar metodologias de implantação blue-green e mecanismos de atualização sem interrupção para atualizar as imagens de contêiner sem tempo de inatividade.</span><span class="sxs-lookup"><span data-stu-id="cd021-140">One might use blue-green deployment methodologies and rolling upgrade mechanisms to update container images without downtime.</span></span> <span data-ttu-id="cd021-141">A verificação de imagem pode ser feita com as ferramentas descritas na seção anterior.</span><span class="sxs-lookup"><span data-stu-id="cd021-141">Image scanning can be done with tools described in the preceding section.</span></span> 

* <span data-ttu-id="cd021-142">Um pipeline de CI (integração contínua) para criar imagens e a verificação de segurança integrada pode ajudar a manter registros particulares seguros com imagens de contêiner protegidas.</span><span class="sxs-lookup"><span data-stu-id="cd021-142">A continuous integration (CI) pipeline to build images and integrated security scanning can help maintain secure private registries with secure container images.</span></span> <span data-ttu-id="cd021-143">A verificação de vulnerabilidade incorporada à solução de CI garante que as imagens que passam em todos os testes sejam enviadas para o registro privado a partir do qual as cargas de trabalho de produção são implantadas.</span><span class="sxs-lookup"><span data-stu-id="cd021-143">The vulnerability scanning built into the CI solution ensures that images that pass all the tests are pushed to the private registry from which production workloads are deployed.</span></span> <span data-ttu-id="cd021-144">Uma falha de pipeline de CI garante que as imagens vulneráveis não sejam enviadas para o registro privado usado para implantações de cargas de trabalho de produção.</span><span class="sxs-lookup"><span data-stu-id="cd021-144">A CI pipeline failure ensures that vulnerable images are not pushed into the private registry used for production workload deployments.</span></span> <span data-ttu-id="cd021-145">Isso também automatiza a verificação de segurança de imagem se houver um número significativo de imagens.</span><span class="sxs-lookup"><span data-stu-id="cd021-145">It also automates image security scanning if there are a significant number of images.</span></span> <span data-ttu-id="cd021-146">Caso contrário, a auditoria manual de imagens em busca de vulnerabilidades de segurança pode ser muito demorada e sujeita a erros.</span><span class="sxs-lookup"><span data-stu-id="cd021-146">Otherwise, manually auditing images for security vulnerabilities can be painstakingly lengthy and error prone.</span></span>

## <a name="host-level-container-isolation"></a><span data-ttu-id="cd021-147">Isolamento de contêiner de nível de host</span><span class="sxs-lookup"><span data-stu-id="cd021-147">Host-level container isolation</span></span>
<span data-ttu-id="cd021-148">Quando um cliente implanta aplicativos de contêiner nos recursos do Azure, eles são implantados em um nível de assinatura em grupos de recursos e não são multilocatários.</span><span class="sxs-lookup"><span data-stu-id="cd021-148">When a customer deploys container applications on Azure resources, they are deployed at a subscription level in resource groups and are not multi-tenant.</span></span> <span data-ttu-id="cd021-149">Isso significa que, se um cliente compartilhar uma assinatura com outras pessoas, não haverá nenhum limite que possa ser criado entre duas implantações na mesma assinatura.</span><span class="sxs-lookup"><span data-stu-id="cd021-149">This means that if a customer shares a subscription with others, there are no boundaries that can be built between two deployments in the same subscription.</span></span> <span data-ttu-id="cd021-150">Portanto, a segurança de nível de contêiner não estará garantida.</span><span class="sxs-lookup"><span data-stu-id="cd021-150">Therefore, container-level security is not guaranteed.</span></span> 

<span data-ttu-id="cd021-151">Também é fundamental entender que os contêineres compartilham o kernel e os recursos do host (que, no Serviço de Contêiner do Azure, é uma VM do Azure em um cluster).</span><span class="sxs-lookup"><span data-stu-id="cd021-151">It is also critical to understand that containers share the kernel and the resources of the host (which in Azure Container Service is an Azure VM in a cluster).</span></span> <span data-ttu-id="cd021-152">Portanto, os contêineres em produção devem ser executados no modo de usuário sem privilégios.</span><span class="sxs-lookup"><span data-stu-id="cd021-152">Therefore, containers running in production must be run in non-privileged user mode.</span></span> <span data-ttu-id="cd021-153">Executar um contêiner com privilégios de raiz pode comprometer todo o ambiente.</span><span class="sxs-lookup"><span data-stu-id="cd021-153">Running a container with root privileges can compromise the entire environment.</span></span> <span data-ttu-id="cd021-154">Com o acesso de nível de raiz em um contêiner, um hacker pode ter privilégios de raiz completos no host.</span><span class="sxs-lookup"><span data-stu-id="cd021-154">With root-level access in a container, a hacker can gain access to the full root privileges on the host.</span></span> <span data-ttu-id="cd021-155">Além disso, é importante executar contêineres com sistemas de arquivos somente leitura.</span><span class="sxs-lookup"><span data-stu-id="cd021-155">In addition, it is important to run containers with read-only file systems.</span></span> <span data-ttu-id="cd021-156">Isso impede que alguém que tenha acesso ao contêiner comprometido grave scripts mal-intencionados no sistema de arquivos e obtenha acesso a outros arquivos.</span><span class="sxs-lookup"><span data-stu-id="cd021-156">This prevents someone who has access to the compromised container to write malicious scripts to the file system and gain access to other files.</span></span> <span data-ttu-id="cd021-157">Da mesma forma, é importante limitar os recursos (como memória, CPU e largura de banda de rede) alocados para um contêiner.</span><span class="sxs-lookup"><span data-stu-id="cd021-157">Similarly, it is important to limit the resources (such as memory, CPU, and network bandwidth) allocated to a container.</span></span> <span data-ttu-id="cd021-158">Isso ajuda a impedir que hackers consigam mais recursos e busquem atividades ilegais como fraude de cartão de crédito ou mineração de bitcoin, que pode impedir a execução de outros contêineres no host ou cluster.</span><span class="sxs-lookup"><span data-stu-id="cd021-158">This helps prevent hackers from hogging resources and pursuing illegal activities such as credit card fraud or bitcoin mining, which could prevent other containers from running on the host or cluster.</span></span>

## <a name="orchestrator-considerations"></a><span data-ttu-id="cd021-159">Considerações sobre o Orchestrator</span><span class="sxs-lookup"><span data-stu-id="cd021-159">Orchestrator considerations</span></span>

<span data-ttu-id="cd021-160">Cada orquestrador disponível no Serviço de Contêiner do Azure tem suas próprias considerações de segurança.</span><span class="sxs-lookup"><span data-stu-id="cd021-160">Each orchestrator available in Azure Container Service has its own security considerations.</span></span> <span data-ttu-id="cd021-161">Por exemplo, você deve limitar o acesso direto de SSH para nós do orquestrador no serviço de contêiner.</span><span class="sxs-lookup"><span data-stu-id="cd021-161">For example, you should limit direct SSH access to orchestrator nodes in Container Service.</span></span> <span data-ttu-id="cd021-162">Em vez disso, use a interface de usuário de cada orquestrador ou ferramentas de linha de comando (como `kubectl` para Kubernetes) para gerenciar o ambiente de contêiner sem acessar os hosts.</span><span class="sxs-lookup"><span data-stu-id="cd021-162">Instead, you should use each orchestrator's UI or command-line tools (such as `kubectl` for Kubernetes) to manage the container environment without accessing the hosts.</span></span> <span data-ttu-id="cd021-163">Para saber mais, veja [Fazer uma conexão remota com um cluster Kubernetes, DC/OS ou Docker Swarm](../articles/container-service/kubernetes/container-service-connect.md).</span><span class="sxs-lookup"><span data-stu-id="cd021-163">For more information, see [Make a remote connection to a Kubernetes, DC/OS, or Docker Swarm cluster](../articles/container-service/kubernetes/container-service-connect.md).</span></span>

<span data-ttu-id="cd021-164">Para saber mais adicionais de segurança específicas do orquestrador, veja os seguintes recursos:</span><span class="sxs-lookup"><span data-stu-id="cd021-164">For additional orchestrator-specific security information, see the following resources:</span></span>

* <span data-ttu-id="cd021-165">**Kubernetes**: [práticas recomendadas de segurança para implantação de Kubernetes](http://blog.kubernetes.io/2016/08/security-best-practices-kubernetes-deployment.html)</span><span class="sxs-lookup"><span data-stu-id="cd021-165">**Kubernetes**: [Security Best Practices for Kubernetes Deployment](http://blog.kubernetes.io/2016/08/security-best-practices-kubernetes-deployment.html)</span></span>

* <span data-ttu-id="cd021-166">**DC/OS**: [proteção do cluster](https://dcos.io/docs/1.8/administration/securing-your-cluster/)</span><span class="sxs-lookup"><span data-stu-id="cd021-166">**DC/OS**: [Securing Your Cluster](https://dcos.io/docs/1.8/administration/securing-your-cluster/)</span></span>

* <span data-ttu-id="cd021-167">**Docker Swarm**: [segurança do Docker](https://www.docker.com/docker-security)</span><span class="sxs-lookup"><span data-stu-id="cd021-167">**Docker Swarm**: [Docker Security](https://www.docker.com/docker-security)</span></span>

## <a name="next-steps"></a><span data-ttu-id="cd021-168">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="cd021-168">Next steps</span></span>

* <span data-ttu-id="cd021-169">Para saber mais sobre a arquitetura do Docker e a segurança do contêiner, veja [Introdução à segurança do contêiner](https://www.docker.com/sites/default/files/WP_IntrotoContainerSecurity_08.19.2016.pdf).</span><span class="sxs-lookup"><span data-stu-id="cd021-169">For more about Docker architecture and container security, see [Introduction to Container Security](https://www.docker.com/sites/default/files/WP_IntrotoContainerSecurity_08.19.2016.pdf).</span></span>

* <span data-ttu-id="cd021-170">Para saber mais sobre segurança da plataforma do Azure, veja a [Central de Segurança do Azure](https://www.microsoft.com/en-us/trustcenter/cloudservices/azure).</span><span class="sxs-lookup"><span data-stu-id="cd021-170">For information about Azure platform security, see the [Azure Security Center](https://www.microsoft.com/en-us/trustcenter/cloudservices/azure).</span></span>