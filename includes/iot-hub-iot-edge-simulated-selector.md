> [!div class="op_single_selector"]
> * [<span data-ttu-id="061be-101">Linux</span><span class="sxs-lookup"><span data-stu-id="061be-101">Linux</span></span>](../articles/iot-hub/iot-hub-linux-iot-edge-simulated-device.md)
> * [<span data-ttu-id="061be-102">Windows</span><span class="sxs-lookup"><span data-stu-id="061be-102">Windows</span></span>](../articles/iot-hub/iot-hub-windows-iot-edge-simulated-device.md)

<span data-ttu-id="061be-103">Este passo a passo do [Exemplo de Upload para a Nuvem de Dispositivo Simulado] mostra como usar o [Azure IoT Edge][lnk-sdk] para enviar a telemetria do dispositivo para a nuvem ao Hub IoT por meio de dispositivos simulados.</span><span class="sxs-lookup"><span data-stu-id="061be-103">This walkthrough of the [Simulated Device Cloud Upload sample] shows you how to use [Azure IoT Edge][lnk-sdk] to send device-to-cloud telemetry to IoT Hub from simulated devices.</span></span>

<span data-ttu-id="061be-104">Este passo a passo aborda:</span><span class="sxs-lookup"><span data-stu-id="061be-104">This walkthrough covers:</span></span>

* <span data-ttu-id="061be-105">**Arquitetura**: informações de arquitetura sobre o [Exemplo de Upload para a Nuvem de Dispositivo Simulado].</span><span class="sxs-lookup"><span data-stu-id="061be-105">**Architecture**: architectural information about the [Simulated Device Cloud Upload sample].</span></span>
* <span data-ttu-id="061be-106">**Criar e executar**: as etapas necessárias para criar e executar a amostra.</span><span class="sxs-lookup"><span data-stu-id="061be-106">**Build and run**: the steps required to build and run the sample.</span></span>

## <a name="architecture"></a><span data-ttu-id="061be-107">Arquitetura</span><span class="sxs-lookup"><span data-stu-id="061be-107">Architecture</span></span>

<span data-ttu-id="061be-108">O [Exemplo de Upload para a Nuvem de Dispositivo Simulado] mostra como criar um gateway que envia a telemetria dos dispositivos simulados para um Hub IoT.</span><span class="sxs-lookup"><span data-stu-id="061be-108">The [Simulated Device Cloud Upload sample] shows how to create a gateway that sends telemetry from simulated devices to an IoT hub.</span></span> <span data-ttu-id="061be-109">Um dispositivo pode não ser capaz de se conectar diretamente com o Hub IoT porque o dispositivo:</span><span class="sxs-lookup"><span data-stu-id="061be-109">A device may not be able to connect directly to IoT Hub because the device:</span></span>

* <span data-ttu-id="061be-110">Não usa um protocolo de comunicação compreendido pelo Hub IoT.</span><span class="sxs-lookup"><span data-stu-id="061be-110">Does not use a communications protocol understood by IoT Hub.</span></span>
* <span data-ttu-id="061be-111">Não é inteligente o suficiente para lembrar a identidade atribuída a ele pelo Hub IoT.</span><span class="sxs-lookup"><span data-stu-id="061be-111">Is not smart enough to remember the identity assigned to it by IoT Hub.</span></span>

<span data-ttu-id="061be-112">Um gateway de IoT Edge pode resolver esses problemas das seguintes maneiras:</span><span class="sxs-lookup"><span data-stu-id="061be-112">An IoT Edge gateway can solve these problems in the following ways:</span></span>

* <span data-ttu-id="061be-113">O gateway compreende o protocolo usado pelos dispositivos simulados, recebe dos dispositivos a telemetria do dispositivo para a nuvem e encaminha essas mensagens ao Hub IoT usando um protocolo compreendido pelo Hub IoT.</span><span class="sxs-lookup"><span data-stu-id="061be-113">The gateway understands the protocol used by the device, receives device-to-cloud telemetry from the device, and forwards those messages to IoT Hub using a protocol understood by the IoT hub.</span></span>

* <span data-ttu-id="061be-114">O gateway mapeia identidades do Hub IoT para os dispositivos e atua como um proxy quando um dispositivo envia mensagens para o Hub IoT.</span><span class="sxs-lookup"><span data-stu-id="061be-114">The gateway maps IoT Hub identities to devices and acts as a proxy when a device sends messages to IoT Hub.</span></span>

<span data-ttu-id="061be-115">O diagrama a seguir mostra os principais componentes do exemplo, incluindo os módulos do Edge IoT:</span><span class="sxs-lookup"><span data-stu-id="061be-115">The following diagram shows the main components of the sample, including the IoT Edge modules:</span></span>

![][1]

<span data-ttu-id="061be-116">Os módulos não transmitem mensagens diretamente entre si.</span><span class="sxs-lookup"><span data-stu-id="061be-116">The modules do not pass messages directly to each other.</span></span> <span data-ttu-id="061be-117">Os módulos publicam mensagens em um agente interno, que entrega as mensagens para outros módulos usando um mecanismo de assinatura.</span><span class="sxs-lookup"><span data-stu-id="061be-117">The modules publish messages to an internal broker that delivers the messages to the other modules using a subscription mechanism.</span></span> <span data-ttu-id="061be-118">Para obter mais informações, consulte [Introdução ao Edge IoT do Azure][lnk-gw-getstarted].</span><span class="sxs-lookup"><span data-stu-id="061be-118">For more information, see [Get started with Azure IoT Edge][lnk-gw-getstarted].</span></span>

### <a name="protocol-ingestion-module"></a><span data-ttu-id="061be-119">Módulo de ingestão de protocolo</span><span class="sxs-lookup"><span data-stu-id="061be-119">Protocol ingestion module</span></span>

<span data-ttu-id="061be-120">Esse módulo é o ponto de partida para obtenção de dados de dispositivos, por meio do gateway, e inserção na nuvem.</span><span class="sxs-lookup"><span data-stu-id="061be-120">This module is the starting point for receiving data from devices, through the gateway, and into the cloud.</span></span> <span data-ttu-id="061be-121">No exemplo, o módulo:</span><span class="sxs-lookup"><span data-stu-id="061be-121">In the sample, the module:</span></span>

1. <span data-ttu-id="061be-122">Cria dados de temperatura simulados.</span><span class="sxs-lookup"><span data-stu-id="061be-122">Creates simulated temperature data.</span></span> <span data-ttu-id="061be-123">Se você estiver usando dispositivos físicos, o módulo lerá os dados desses dispositivos físicos.</span><span class="sxs-lookup"><span data-stu-id="061be-123">If you use physical devices, the module reads data from those physical devices.</span></span>
1. <span data-ttu-id="061be-124">Cria uma mensagem.</span><span class="sxs-lookup"><span data-stu-id="061be-124">Creates a message.</span></span>
1. <span data-ttu-id="061be-125">Coloca os dados de temperatura simulados no conteúdo da mensagem.</span><span class="sxs-lookup"><span data-stu-id="061be-125">Places the simulated temperature data into the message content.</span></span>
1. <span data-ttu-id="061be-126">Adiciona uma propriedade com um endereço MAC falso para a mensagem.</span><span class="sxs-lookup"><span data-stu-id="061be-126">Adds a property with a fake MAC address to the message.</span></span>
1. <span data-ttu-id="061be-127">Disponibiliza a mensagem para o próximo módulo na cadeia.</span><span class="sxs-lookup"><span data-stu-id="061be-127">Makes the message available to the next module in the chain.</span></span>

<span data-ttu-id="061be-128">O módulo chamado **Ingestão de protocolo X**, no diagrama acima, é chamado de **Dispositivo simulado** no código-fonte.</span><span class="sxs-lookup"><span data-stu-id="061be-128">The module called **Protocol X ingestion** in the previous diagram is called **Simulated device** in the source code.</span></span>

### <a name="mac-lt-gt-iot-hub-id-module"></a><span data-ttu-id="061be-129">Módulo de identificação do MAC &lt;-&gt; Hub IoT</span><span class="sxs-lookup"><span data-stu-id="061be-129">MAC &lt;-&gt; IoT Hub ID module</span></span>

<span data-ttu-id="061be-130">Este módulo procura mensagens que tenham uma propriedade de endereço Mac.</span><span class="sxs-lookup"><span data-stu-id="061be-130">This module scans for messages that have a Mac address property.</span></span> <span data-ttu-id="061be-131">No exemplo, o módulo de inclusão de protocolo adiciona a propriedade de endereço MAC.</span><span class="sxs-lookup"><span data-stu-id="061be-131">In the sample, the protocol ingestion module adds the MAC address property.</span></span> <span data-ttu-id="061be-132">Se o módulo encontrar essa propriedade, ele adicionará outra propriedade com uma chave de dispositivo do Hub IoT para a mensagem.</span><span class="sxs-lookup"><span data-stu-id="061be-132">If the module finds such a property, it adds another property with an IoT Hub device key to the message.</span></span> <span data-ttu-id="061be-133">Então, o módulo disponibiliza a mensagem para o próximo módulo na cadeia.</span><span class="sxs-lookup"><span data-stu-id="061be-133">The module then makes the message available to the next module in the chain.</span></span>

<span data-ttu-id="061be-134">O desenvolvedor configura um mapeamento entre endereços MAC e as identidades de Hub IoT para associar os dispositivos simulados com identidades de dispositivo Hub IoT.</span><span class="sxs-lookup"><span data-stu-id="061be-134">The developer sets up a mapping between MAC addresses and IoT Hub identities to associate the simulated devices with IoT Hub device identities.</span></span> <span data-ttu-id="061be-135">O desenvolvedor adiciona o mapeamento manualmente como parte da configuração do módulo.</span><span class="sxs-lookup"><span data-stu-id="061be-135">The developer adds the mapping manually as part of the module configuration.</span></span>

> [!NOTE]
> <span data-ttu-id="061be-136">Esta amostra usa um endereço MAC como um identificador de dispositivo exclusivo e o correlaciona com uma identidade de dispositivo Hub IoT.</span><span class="sxs-lookup"><span data-stu-id="061be-136">This sample uses a MAC address as a unique device identifier and correlates it with an IoT Hub device identity.</span></span> <span data-ttu-id="061be-137">No entanto, é possível escrever seu próprio módulo que usa um identificador exclusivo diferente.</span><span class="sxs-lookup"><span data-stu-id="061be-137">However, you can write your own module that uses a different unique identifier.</span></span> <span data-ttu-id="061be-138">Por exemplo, os dispositivos podem ter números de série exclusivos ou os dados telemétricos podem incluir um nome de dispositivo incorporado exclusivo.</span><span class="sxs-lookup"><span data-stu-id="061be-138">For example, your devices may have unique serial numbers or the telemetry data may include a unique embedded device name.</span></span>

### <a name="iot-hub-communication-module"></a><span data-ttu-id="061be-139">Módulo de comunicação do Hub IoT</span><span class="sxs-lookup"><span data-stu-id="061be-139">IoT Hub communication module</span></span>

<span data-ttu-id="061be-140">Este módulo usa mensagens com uma propriedade de chave de dispositivo Hub IoT que foi atribuída pelo módulo anterior.</span><span class="sxs-lookup"><span data-stu-id="061be-140">This module takes messages with an IoT Hub device key property that was assigned by the previous module.</span></span> <span data-ttu-id="061be-141">O módulo envia o conteúdo da mensagem ao Hub IoT usando o protocolo HTTP.</span><span class="sxs-lookup"><span data-stu-id="061be-141">The module sends the message content to IoT Hub using the HTTP protocol.</span></span> <span data-ttu-id="061be-142">HTTP é um dos três protocolos compreendidos pelo Hub IoT.</span><span class="sxs-lookup"><span data-stu-id="061be-142">HTTP is one of the three protocols understood by IoT Hub.</span></span>

<span data-ttu-id="061be-143">Em vez de abrir uma conexão para cada dispositivo simulado, esse módulo abre uma conexão HTTP única do gateway para o Hub IoT.</span><span class="sxs-lookup"><span data-stu-id="061be-143">Instead of opening a connection for each simulated device, this module opens a single HTTP connection from the gateway to the IoT hub.</span></span> <span data-ttu-id="061be-144">Então, o módulo multiplica as conexões de todos os dispositivos simulados por essa conexão.</span><span class="sxs-lookup"><span data-stu-id="061be-144">The module then multiplexes connections from all the simulated devices over that connection.</span></span> <span data-ttu-id="061be-145">Essa abordagem permite que um único gateway se conecte com diversos dispositivos.</span><span class="sxs-lookup"><span data-stu-id="061be-145">This approach enables a single gateway to connect many more devices.</span></span>

## <a name="before-you-get-started"></a><span data-ttu-id="061be-146">Antes de começar</span><span class="sxs-lookup"><span data-stu-id="061be-146">Before you get started</span></span>

<span data-ttu-id="061be-147">Antes de começar, é necessário:</span><span class="sxs-lookup"><span data-stu-id="061be-147">Before you get started, you must:</span></span>

* <span data-ttu-id="061be-148">[Crie um Hub IoT][lnk-create-hub] em sua assinatura do Azure. Você precisará do nome do hub para concluir este passo a passo.</span><span class="sxs-lookup"><span data-stu-id="061be-148">[Create an IoT hub][lnk-create-hub] in your Azure subscription, you need the name of your hub to complete this walkthrough.</span></span> <span data-ttu-id="061be-149">Se não tiver uma conta, você poderá criar uma [conta gratuita][lnk-free-trial] em apenas alguns minutos.</span><span class="sxs-lookup"><span data-stu-id="061be-149">If you don't have an account, you can create a [free account][lnk-free-trial] in just a couple of minutes.</span></span>
* <span data-ttu-id="061be-150">Adicione dois dispositivos ao hub IoT e anote as IDs e chaves de dispositivo.</span><span class="sxs-lookup"><span data-stu-id="061be-150">Add two devices to your IoT hub and make a note of their ids and device keys.</span></span> <span data-ttu-id="061be-151">É possível usar o [gerenciador de dispositivo][lnk-device-explorer] ou a ferramenta [iothub-explorer][lnk-iothub-explorer] para adicionar seus dispositivos ao Hub IoT criado na etapa anterior e recuperar suas chaves.</span><span class="sxs-lookup"><span data-stu-id="061be-151">You can use the [device explorer][lnk-device-explorer] or [iothub-explorer][lnk-iothub-explorer] tool to add your devices to the IoT hub you created in the previous step and retrieve their keys.</span></span>

![][2]

<!-- Images -->
[1]: media/iot-hub-iot-edge-simulated-selector/image1.png
[2]: media/iot-hub-iot-edge-simulated-selector/image2.png

<!-- Links -->
<span data-ttu-id="061be-152">[Exemplo de Upload para a Nuvem de Dispositivo Simulado]: https://github.com/Azure/iot-edge/blob/master/samples/simulated_device_cloud_upload/README.md</span><span class="sxs-lookup"><span data-stu-id="061be-152">[Simulated Device Cloud Upload sample]: https://github.com/Azure/iot-edge/blob/master/samples/simulated_device_cloud_upload/README.md</span></span>
[lnk-sdk]: https://github.com/Azure/iot-edge
[lnk-gw-getstarted]: ../articles/iot-hub/iot-hub-linux-iot-edge-get-started.md
[lnk-free-trial]: https://azure.microsoft.com/pricing/free-trial/
[lnk-device-explorer]: https://github.com/Azure/azure-iot-sdk-csharp/tree/master/tools/DeviceExplorer
[lnk-iothub-explorer]: https://github.com/Azure/iothub-explorer/blob/master/readme.md
[lnk-create-hub]: ../articles/iot-hub/iot-hub-create-through-portal.md