## <a name="prepare-for-akv-integration"></a><span data-ttu-id="106c9-101">Preparar-se para a integração de AKV</span><span class="sxs-lookup"><span data-stu-id="106c9-101">Prepare for AKV Integration</span></span>
<span data-ttu-id="106c9-102">toouse tooconfigure de integração do Cofre de chave do Azure VM do SQL Server, existem vários pré-requisitos:</span><span class="sxs-lookup"><span data-stu-id="106c9-102">toouse Azure Key Vault Integration tooconfigure your SQL Server VM, there are several prerequisites:</span></span> 

1. [<span data-ttu-id="106c9-103">Instalar o Azure Powershell</span><span class="sxs-lookup"><span data-stu-id="106c9-103">Install Azure Powershell</span></span>](#install-azure-powershell)
2. [<span data-ttu-id="106c9-104">Criar um Active Directory do Azure</span><span class="sxs-lookup"><span data-stu-id="106c9-104">Create an Azure Active Directory</span></span>](#create-an-azure-active-directory)
3. [<span data-ttu-id="106c9-105">Criar um cofre de chave</span><span class="sxs-lookup"><span data-stu-id="106c9-105">Create a key vault</span></span>](#create-a-key-vault)

<span data-ttu-id="106c9-106">Olá seções a seguir descrevem esses pré-requisitos e as informações de saudação precisar cmdlets do PowerShell toocollect toolater executar hello.</span><span class="sxs-lookup"><span data-stu-id="106c9-106">hello following sections describe these prerequisites and hello information you need toocollect toolater run hello PowerShell cmdlets.</span></span>

### <a name="install-azure-powershell"></a><span data-ttu-id="106c9-107">Instalar o Azure Powershell</span><span class="sxs-lookup"><span data-stu-id="106c9-107">Install Azure PowerShell</span></span>
<span data-ttu-id="106c9-108">Verifique se você instalou Olá SDK mais recente do PowerShell do Azure.</span><span class="sxs-lookup"><span data-stu-id="106c9-108">Make sure you have installed hello latest Azure PowerShell SDK.</span></span> <span data-ttu-id="106c9-109">Para obter mais informações, consulte [como tooinstall e configurar o Azure PowerShell](/powershell/azureps-cmdlets-docs).</span><span class="sxs-lookup"><span data-stu-id="106c9-109">For more information, see [How tooinstall and configure Azure PowerShell](/powershell/azureps-cmdlets-docs).</span></span>

### <a name="create-an-azure-active-directory"></a><span data-ttu-id="106c9-110">Criar um Active Directory do Azure</span><span class="sxs-lookup"><span data-stu-id="106c9-110">Create an Azure Active Directory</span></span>
<span data-ttu-id="106c9-111">Primeiro, é necessário toohave um [Active Directory do Azure](https://azure.microsoft.com/trial/get-started-active-directory/) (AAD) em sua assinatura.</span><span class="sxs-lookup"><span data-stu-id="106c9-111">First, you need toohave an [Azure Active Directory](https://azure.microsoft.com/trial/get-started-active-directory/) (AAD) in your subscription.</span></span> <span data-ttu-id="106c9-112">Entre muitos benefícios, isso permite que você toogrant permissão tooyour Cofre de chaves para determinados aplicativos e usuários.</span><span class="sxs-lookup"><span data-stu-id="106c9-112">Among many benefits, this allows you toogrant permission tooyour key vault for certain users and applications.</span></span>

<span data-ttu-id="106c9-113">Em seguida, registre um aplicativo com o AAD</span><span class="sxs-lookup"><span data-stu-id="106c9-113">Next, register an application with AAD.</span></span> <span data-ttu-id="106c9-114">Isso lhe dará uma conta de entidade de serviço que tenha acesso tooyour Cofre de chaves que a VM será necessário.</span><span class="sxs-lookup"><span data-stu-id="106c9-114">This will give you a Service Principal account that has access tooyour key vault which your VM will need.</span></span> <span data-ttu-id="106c9-115">Artigo de Cofre de chaves do Azure hello, você pode encontrar estas etapas no hello [registrar um aplicativo com o Azure Active Directory](../articles/key-vault/key-vault-get-started.md#register) seção, ou você pode ver as etapas de saudação com capturas de tela hello **obter uma identidade para o aplicativo hello seção** de [esta postagem de blog](http://blogs.technet.com/b/kv/archive/2015/01/09/azure-key-vault-step-by-step.aspx).</span><span class="sxs-lookup"><span data-stu-id="106c9-115">In hello Azure Key Vault article, you can find these steps in hello [Register an application with Azure Active Directory](../articles/key-vault/key-vault-get-started.md#register) section, or you can see hello steps with screen shots in hello **Get an identity for hello application section** of [this blog post](http://blogs.technet.com/b/kv/archive/2015/01/09/azure-key-vault-step-by-step.aspx).</span></span> <span data-ttu-id="106c9-116">Antes de concluir essas etapas, observe que você precisa Olá toocollect informações durante o registro que é necessário mais tarde, quando você habilitar a integração do cofre da chave do Azure em sua VM do SQL a seguir.</span><span class="sxs-lookup"><span data-stu-id="106c9-116">Before completing these steps, note that you need toocollect hello following information during this registration that is needed later when you enable Azure Key Vault Integration on your SQL VM.</span></span>

* <span data-ttu-id="106c9-117">Depois que o aplicativo hello é adicionado, localize Olá **ID do cliente** em Olá **configurar** guia.   ![ID de cliente do Azure Active Directory](./media/virtual-machines-sql-server-akv-prepare/aad-client-id.png)</span><span class="sxs-lookup"><span data-stu-id="106c9-117">After hello application is added, find hello **CLIENT ID**  on hello **CONFIGURE** tab.   ![Azure Active Directory Client ID](./media/virtual-machines-sql-server-akv-prepare/aad-client-id.png)</span></span>
  
    <span data-ttu-id="106c9-118">ID de saudação do cliente é atribuído posterior toohello **$spName** parâmetro (nome da entidade de serviço) em Olá PowerShell script tooenable integração do cofre da chave do Azure.</span><span class="sxs-lookup"><span data-stu-id="106c9-118">hello client ID is assigned later toohello **$spName** (Service Principal name) parameter in hello PowerShell script tooenable Azure Key Vault Integration.</span></span> 
* <span data-ttu-id="106c9-119">Além disso, durante essas etapas quando você cria sua chave, o copie o segredo Olá para sua chave como é mostrado Olá captura de tela a seguir.</span><span class="sxs-lookup"><span data-stu-id="106c9-119">Also, during these steps when you create your key, copy hello secret for your key as is shown in hello following screenshot.</span></span> <span data-ttu-id="106c9-120">Essa chave secreta é atribuída posterior toohello **$spSecret** parâmetro (entidade de serviço secreto) no script do PowerShell hello.</span><span class="sxs-lookup"><span data-stu-id="106c9-120">This key secret is assigned later toohello **$spSecret** (Service Principal secret) parameter in hello PowerShell script.</span></span>  
    <span data-ttu-id="106c9-121">![Segredo do Azure Active Directory](./media/virtual-machines-sql-server-akv-prepare/aad-sp-secret.png)</span><span class="sxs-lookup"><span data-stu-id="106c9-121">![Azure Active Directory Secret](./media/virtual-machines-sql-server-akv-prepare/aad-sp-secret.png)</span></span>
* <span data-ttu-id="106c9-122">É necessário autorizar este novo saudação de toohave de ID de cliente as seguintes permissões de acesso: **criptografar**, **descriptografar**, **wrapKey**, **unwrapKey**, **sinal**, e **verificar**.</span><span class="sxs-lookup"><span data-stu-id="106c9-122">You must authorize this new client ID toohave hello following access permissions: **encrypt**, **decrypt**, **wrapKey**, **unwrapKey**, **sign**, and **verify**.</span></span> <span data-ttu-id="106c9-123">Isso é feito com hello [Set-AzureRmKeyVaultAccessPolicy](https://msdn.microsoft.com/library/azure/mt603625.aspx) cmdlet.</span><span class="sxs-lookup"><span data-stu-id="106c9-123">This is done with hello [Set-AzureRmKeyVaultAccessPolicy](https://msdn.microsoft.com/library/azure/mt603625.aspx) cmdlet.</span></span> <span data-ttu-id="106c9-124">Para obter mais informações, consulte [autorizar Olá aplicativo toouse Olá chave ou segredo](../articles/key-vault/key-vault-get-started.md#authorize).</span><span class="sxs-lookup"><span data-stu-id="106c9-124">For more information see [Authorize hello application toouse hello key or secret](../articles/key-vault/key-vault-get-started.md#authorize).</span></span>

### <a name="create-a-key-vault"></a><span data-ttu-id="106c9-125">Criar um cofre de chave</span><span class="sxs-lookup"><span data-stu-id="106c9-125">Create a key vault</span></span>
<span data-ttu-id="106c9-126">Em ordem toouse Azure Key Vault toostore Olá chaves que será usado para criptografia na sua VM, você precisa de Cofre de chaves de tooa de acesso.</span><span class="sxs-lookup"><span data-stu-id="106c9-126">In order toouse Azure Key Vault toostore hello keys you will use for encryption in your VM, you need access tooa key vault.</span></span> <span data-ttu-id="106c9-127">Se você ainda não definiu o seu Cofre de chaves, crie um seguindo as etapas Olá Olá [guia de Introdução ao Azure Key Vault](../articles/key-vault/key-vault-get-started.md) tópico.</span><span class="sxs-lookup"><span data-stu-id="106c9-127">If you have not already set up your key vault, create one by following hello steps in hello [Getting Started with Azure Key Vault](../articles/key-vault/key-vault-get-started.md) topic.</span></span> <span data-ttu-id="106c9-128">Antes de concluir essas etapas, observe que há algumas informações necessárias toocollect durante esse conjunto de backup que é necessário mais tarde, quando você habilitar a integração do cofre da chave do Azure em sua VM do SQL.</span><span class="sxs-lookup"><span data-stu-id="106c9-128">Before completing these steps, note that there is some information you need toocollect during this set up that is needed later when you enable Azure Key Vault Integration on your SQL VM.</span></span>

<span data-ttu-id="106c9-129">Quando você obter toohello criar uma etapa de Cofre de chaves, Olá Observação retornado **vaultUri** propriedade, que é a URL do Cofre de chaves de saudação.</span><span class="sxs-lookup"><span data-stu-id="106c9-129">When you get toohello Create a key vault step, note hello returned **vaultUri** property, which is hello key vault URL.</span></span> <span data-ttu-id="106c9-130">No exemplo hello fornecido na etapa, mostrada abaixo, nome do Cofre de chaves de saudação é ContosoKeyVault, portanto, a URL de Cofre de chaves de saudação seria https://contosokeyvault.vault.azure.net/.</span><span class="sxs-lookup"><span data-stu-id="106c9-130">In hello example provided in that step, shown below, hello key vault name is ContosoKeyVault, therefore hello key vault URL would be https://contosokeyvault.vault.azure.net/.</span></span>

    New-AzureRmKeyVault -VaultName 'ContosoKeyVault' -ResourceGroupName 'ContosoResourceGroup' -Location 'East Asia'

<span data-ttu-id="106c9-131">URL de Cofre de chaves Olá recebe toohello posterior **$akvURL** parâmetro hello PowerShell script tooenable integração do cofre da chave do Azure.</span><span class="sxs-lookup"><span data-stu-id="106c9-131">hello key vault URL is assigned later toohello **$akvURL** parameter in hello PowerShell script tooenable Azure Key Vault Integration.</span></span>

